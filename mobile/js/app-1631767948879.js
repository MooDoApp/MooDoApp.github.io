/*! For license information please see app-1631767948879.js.LICENSE.txt */
(()=>{var e={8778:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(3124),c=n.n(s),l=n(8572),u=n(8855),d=n(8651),h=n(4472),p=n(4654);const f=new(function(){function e(){i()(this,e),this.accountID=void 0}return o()(e,[{key:"setAccountID",value:function(e){this.accountID=e}},{key:"findMatchLike",value:function(e,t){for(var n=0,r=t.max,i=p.default.pluginManager.getPluginGmail(),a=i.getLabels(this.accountID,e,r),o=[],s=0;s<a.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;a[s].isSystemLabel()||o.insertSorted(a[s],i.labelSortFn)}return o.map((function(e){return{id:e.getLabelID(),type:"gmailLabel",text:e.getName()}}))}},{key:"findMatchExact",value:function(e){}},{key:"getRNList",value:function(){}}]),e}());var g,m=n(2262),v=n(3656),y=n(5193),k=n(9148);const _=new(g=function(){function e(){i()(this,e)}return o()(e,[{key:"tagComparator",value:function(e,t){return e.localeCompare(t)}},{key:"tagComparatorNumber",value:function(e,t){var n=e.count,r=t.count;return n===r?e.text.localeCompare(t.text):r-n}},{key:"findMatchExact",value:function(e){}},{key:"findMatchLike",value:function(e,t){var n=t.max,r=t.root,i={},a=[],o=e.toLowerCase(),s={each:function(e){if(!e.isComplete()){var t=e.getTagsLower();if(t)for(var n=0,r=0;r<t.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=t[r];if(!o||s.startsWith(o)){if(!i[s]){var c={id:s,type:"tag",text:s,count:0};i[s]=c,a.push(c)}i[s].count++}}}}};return r?s.item=r:s.itemStore=p.default.itemStoreManager.getDefaultItemStore(),d.Z.searchVMLIs(s),a.sort(this.tagComparatorNumber),a.length>n&&(a=a.slice(0,n)),a}},{key:"printStats",value:function(e){var t=0;d.Z.log("--- Tag stats ---",e);for(var n=this.findMatchLike("",{max:100}),r=0;r<n.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;console.log(n[r].text,n[r].count)}}},{key:"getAll",value:function(){return this.findMatchLike("",{})}},{key:"getRNList",value:function(e){var t=[];return this.findMatchLike(e,{}).forEach((function(e){t.push({text:e.text,rightText:e.count})})),t.sort(this.tagComparatorNumber),t}}]),e}(),c()(g.prototype,"tagComparatorNumber",[l.ZP],Object.getOwnPropertyDescriptor(g.prototype,"tagComparatorNumber"),g.prototype),c()(g.prototype,"getRNList",[l.ZP],Object.getOwnPropertyDescriptor(g.prototype,"getRNList"),g.prototype),g);var Z,w=n(4327);const b=new(Z=function(){function e(){var t=this;i()(this,e),this.matches=new k.Z,this._isShowing=!1,this._isTempDisabled=!1,this._showNoMatches=!1,this._searchInfo=void 0,this.owner=void 0,this.elementInput=void 0,this.text=void 0,this._prefixes=[u.Z.ContactPrefix,u.Z.TagPrefix,u.Z.PrefixItemAutocomplete,u.Z.InlinePrefix.ItemLink,u.Z.InlinePrefix.ItemMirror],this._prefixMap={},this._prefixMap[u.Z.ContactPrefix]=v.Z,this._prefixMap[u.Z.TagPrefix]=_,this._prefixMap[u.Z.PrefixItemAutocomplete]=m.Z,this._prefixMap[u.Z.InlinePrefix.ItemLink]=m.Z,this._prefixMap[u.Z.InlinePrefix.ItemMirror]=m.Z,w.Z.listen("selectedIndexChanged",(function(){t.matches.clear()})),this.supportedModes=null}return o()(e,[{key:"isShowing",value:function(){return this._isShowing}},{key:"getText",value:function(){return this.text}},{key:"getProviderForPrefix",value:function(e){return this._prefixMap[e]}},{key:"_checkPrefixes",value:function(e,t){for(var n=0,r=e.startsWith("-")?1:0,i=this._prefixes,a=0;a<i.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=i[a];if((o!==u.Z.PrefixItemAutocomplete||t.canAutocompleteItems)&&(o!==u.Z.InlinePrefix.ItemLink&&o!==u.Z.InlinePrefix.ItemMirror||t.canAutocompleteLinkedItems)&&e.substr(r,o.length)===o)return{length:r+o.length,prefix:o}}}},{key:"_findClosestWithPrefix",value:function(e,t,n,r,i){for(var a,o=0,s=e.split(/ /),c=0,l=-1,h=-1,p=-1,f=0,g=0;g<s.length&&c<=t;++g){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var m=s[g],v=m.replace(/[*_]+$/,"");s[l]===a&&(f=0);var y=this._checkPrefixes(v,i);y?(l=g,p=(h=c)+m.length,f=y.length,a=y.prefix):f&&a!==u.Z.TagPrefix&&(p+=m.length+1),c+=m.length+1}if(f&&t>=h&&t<=p){var k=e.substr(h+f,p-h-f);return d.Z.shouldLog(u.Z.LogLevels.Autocomplete)&&d.Z.log("closest is",a,"--",k),{mode:n,text:e,prefix:a,searchText:k,start:h+f,end:p,paneObject:r}}}},{key:"_findClosestDelimited",value:function(e,t,n,r){var i,a=0;i="item"===n?[e]:e.split(",");for(var o=!1,s=0,c=-1,l=-1,h=0;h<i.length&&s<=t;++h){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var p=i[h];c=s+this._numStartSpaces(p),l=s+p.length-this._numEndSpaces(p),c<t&&t<=l&&p.length>0?(o=!0,d.Z.shouldLog(u.Z.LogLevels.Autocomplete)&&d.Z.log("phrase",p,p.length),d.Z.shouldLog(u.Z.LogLevels.Autocomplete)&&d.Z.log("start char",c,e[c]),d.Z.shouldLog(u.Z.LogLevels.Autocomplete)&&d.Z.log("end char",l,e[l])):o=!1,s+=p.length+1}if(o||this._showNoMatches){var f=e.substr(c,l-c+1);return d.Z.shouldLog(u.Z.LogLevels.Autocomplete)&&d.Z.log("closest is",f),{mode:n,text:e,searchText:f,start:c,end:l,paneObject:r}}}},{key:"_findClosestVMLIElement",value:function(e,t,n,r,i){for(var a,o,s,c=0,l=0,u=!1,d=t.elements,h=0;h<d.length&&!1===u;h++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var p=d[h].getStyledText(void 0);if(a=l+this._numStartSpaces(p),o=l+p.length-1-this._numEndSpaces(p),a<n&&n<=o+1&&p.length>0){u=h,s=p.trim();break}l+=p.length}if(!1!==u)return{mode:r,text:e,prefix:"",searchText:s,start:a,end:o,el:d[u],paneObject:i}}},{key:"_numStartSpaces",value:function(e){for(var t=0,n=0,r=0;r<e.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[r])break;n++}return n}},{key:"_numEndSpaces",value:function(e){for(var t=0,n=0,r=e.length-1;r>=0;r--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[r])break;n++}return n}},{key:"insertMatch",value:function(e){var t=this._searchInfo,n=t.start,r=t.end,i=t.paneObject,a=t.text;if(i){var o=i.item,s=n+e.length;return{text:o.elsNew.spliceText(e,n,r-n,i),offset:s}}return{text:a.substr(0,n)+(e+" ")+a.substr(r),offset:n+e.length+1}}},{key:"onSelectedFromPane",value:function(e){var t=e.owner,n=t.item,r=t.pane,i=this._searchInfo.prefix===u.Z.InlinePrefix.ItemLink,a=this._searchInfo.prefix===u.Z.InlinePrefix.ItemMirror;if(i||a){var o=e.item.getMirroredItemOrSelf().id,s=h.Z.getStartOffsetWithPrefix(),c=e.owner.getDisplayText({isSelected:!0}).prevIndexOf(i?"[":"(",s)-1,l=s-c,d=n.elsNew.spliceText("".concat(i?"[[":"((").concat(o).concat(i?"]]":"))"),c,l,e.owner);n.setText(d,u.Z.ChangeType.Local);var p=n.elsNew.findElement(e.owner,(function(e){return e.props.itemLink===o}));p&&(a?(r.updateItems(!0,!0),h.Z.selectIndex(e.owner.index,-1)):h.Z.selectObject(e.owner,p.offset+p.length))}else n.setText(e.value,u.Z.ChangeType.Local),h.Z.selectObject(e.owner,e.offset)}},{key:"prefixForMode",value:function(e){return"contact"===e&&u.Z.ContactPrefix||"tag"===e&&u.Z.TagPrefix||void 0}},{key:"updateFromPane",value:function(e){var t=e.owner,n=e.index,r=e.start,i=e.element,a=e.forceShow;if(i&&!t.item.isPrefixCodeBlock()&&t.item.elsNew.isElementAtOffsetEditable(t,r)){var o=t.getDisplayText({forAutocomplete:!0})||"";!a&&r<=1&&("#"===o||"+"===o)||this.update({mode:"all",text:o,pane:t.pane,item:t.item,offset:r,owner:t,paneObject:t,fromPane:!0,indexInPane:n,elementDisplay:i,position:void 0,onSelected:this.onSelectedFromPane,canAutocompleteLinkedItems:!0,allDocs:!0})}else this.hide()}},{key:"update",value:function(e){var t=e.text,n=e.offset,r=e.mode,i=e.paneObject,a=e.item,o=e.allDocs,s=n+(a?a.getPrefixLength():0);if(e.owner===this.owner&&e.elementInput===this.elementInput||(this._isTempDisabled=!1),this._showNoMatches=!!e.showNoMatches||"move"===r,this.text=t,"/"===(a&&a.getParsedTextWithoutPrefix()))p.default.menus.openContextMenu({componentName:"ReactContextMenuSlashHelp",paneObject:i,element:e.elementDisplay});else if(this._isTempDisabled)this.matches.set([]),this._showNoMatches||this.hide();else{this.owner=e.owner,this.elementInput=e.elementInput;var c=null,l=null;this._searchInfo="all"===r?this._findClosestWithPrefix(t,s,r,i,e):this._findClosestDelimited(t,s,r,i);if(this._searchInfo){switch(this.text=this._searchInfo.searchText,r){case"all":l=this.getProviderForPrefix(this._searchInfo.prefix),this._showNoMatches||(this._showNoMatches=l===m.Z);break;case"move":l=m.Z,o=!0;break;case"item":l=m.Z;break;case"email":c=(l=this._prefixMap[u.Z.ContactPrefix]).findEmailsLike(this._searchInfo.searchText.trim(),100);break;case"contact":l=this._prefixMap[u.Z.ContactPrefix];break;case"tag":l=this._prefixMap[u.Z.TagPrefix];break;case"gmailLabel":var h=p.default.pluginManager.getPluginGmail().getAccountIDFromItem(a);(l=f).setAccountID(h);break;default:try{d.Z.PAssert(226,!1,"Unknown autocomplete mode: ",r)}catch(k){d.Z.reportError(k)}}if(this.activeProvider=l,this.isSearchingItems=l===m.Z,null===c){var g,v=e.pane;g=v&&v.type===u.Z.PaneMode.Task?v.getRootItem():a||y.Z.getDefaultDocument().getRootItem(),c=l.findMatchLike(this._searchInfo.searchText,{max:100,root:g,owner:a,allDocs:o})}1===c.length&&l.findMatchExact(this._searchInfo.searchText,c)&&(c=[])}this._searchInfo&&0!==c.length||!a||a.getRawText().includes(u.Z.CharDate)||t[s-1]!==u.Z.PrefixDate||!(s<2||" "===t[s-2]||t[s-2]===u.Z.AttachChar)||t[s]&&" "!==t[s]&&t[s]!==u.Z.AttachChar||p.default.menus.openDate(Object.assign({paneObject:i,item:a,textOffset:s,element:e.elementDisplay,selectAfter:!0,onClosed:function(){var t=e.owner&&e.owner.onDatePickerClosed;t&&t()}},e)),c=c||[],e.supportSearchItemAutocomplete&&"all"===r&&0===c.length&&e.parsedEls&&(this._searchInfo=this._findClosestVMLIElement(t,e.parsedEls,s,r,i)),this.matches.set(c),this._isShowing||!(c.length>0||this._showNoMatches)||this._isTempDisabled||e.noShow?0===c.length&&(this._showNoMatches||this.hide(),this._isTempDisabled=!1):this.show(e)}}},{key:"clearDisabled",value:function(){this._isTempDisabled=!1}},{key:"onClosed",value:function(){this._isShowing=!1,this._owner=null,this.matches.clear()}},{key:"show",value:function(e){this._isShowing=!0,this._showNoMatches=!!e._showNoMatches,this._owner=e.owner,e.componentName="ReactAutocomplete",e.onClosed=this.onClosed,p.default.menus.openContextMenu(e)}},{key:"showPopup",value:function(e){this._isShowing=!0,this._showNoMatches=!0;var t=e;t.componentName="ReactAutocomplete",t.onClosed=this.onClosed,p.default.menus.openContextMenu(t)}},{key:"hide",value:function(){this._isShowing&&(this._isShowing=!1,p.default.menus.closeContextMenu("ReactAutocomplete")),this.activeProvider=void 0,this.matches.length&&this.matches.clear()}},{key:"getTextFromMatch",value:function(e){return e.text}},{key:"onSelectedMatch",value:function(e){var t=this.insertMatch(e.text),n={value:t.text,offset:t.offset,owner:this.owner,item:e.item};this.owner.onAutocompleteSelected?this.owner.onAutocompleteSelected(n):this.onSelectedFromPane(n),this.onClosed()}},{key:"getMode",value:function(){var e;return null===(e=this._searchInfo)||void 0===e?void 0:e.mode}}]),e}(),c()(Z.prototype,"onSelectedFromPane",[l.ZP],Object.getOwnPropertyDescriptor(Z.prototype,"onSelectedFromPane"),Z.prototype),c()(Z.prototype,"onClosed",[l.ZP],Object.getOwnPropertyDescriptor(Z.prototype,"onClosed"),Z.prototype),Z)},2262:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var r,i=n(4575),a=n.n(i),o=n(3913),s=n.n(o),c=n(3124),l=n.n(c),u=n(8572),d=n(8651),h=n(5193),p=n(9689);const f=new(r=function(){function e(){a()(this,e)}return s()(e,[{key:"findMatchLike",value:function(e,t){var n=t.max,r=t.root,i=t.owner,a=t.allDocs,o=[],s=0,c=p.Z.getSearchArr(e).searchArr,l=function(e){var t=[];return d.Z.searchVMLIs({item:e.getRootItem(),comparator:function(e){return e!==i&&!e.isComplete()&&!e.isDisplayComplete()},each:function(e){var r=!1;if(c.length>0){var i=e.getSearchText();r=p.Z.checkItemTextSearchArr(e,i,c)}else r=e.isPrefixHeader();var a=e.elsNew.elements[0].props.link;if((r=r&&(!a||!a.showImage))&&(t.push({id:e.id,type:"item",text:e.getParsedText(),item:e}),s++),s>=n)return!1}}),t},u=r.getDocumentOwner();if(a){var f=function(e){var t=l(e);t.length&&(o.push({id:e.id,type:"header",text:e.text.get()}),o.pushArray(t))};f(u),h.Z.getDocumentsArray().forEach((function(e){return e!==u&&f(e)}))}else o=l(u);return o}},{key:"findMatchExact",value:function(e,t){}},{key:"getRNList",value:function(e,t){var n=t.max,r=t.root,i=[];return this.findMatchLike(e,{max:n,root:r}).forEach((function(e){i.push({type:"item",text:e.text,extraInfo:e.item})})),i}}]),e}(),l()(r.prototype,"getRNList",[u.ZP],Object.getOwnPropertyDescriptor(r.prototype,"getRNList"),r.prototype),r)},5986:(e,t,n)=>{"use strict";n.d(t,{Z:()=>S});var r,i=n(9713),a=n.n(i),o=n(8926),s=n.n(o),c=n(4575),l=n.n(c),u=n(3913),d=n.n(u),h=n(3124),p=n.n(h),f=n(7757),g=n.n(f),m=(n(7411),n(1186)),v=n(8572),y=n(8855),k=n(8651),_=(n(7100),n(4654)),Z=n(5193),w=n(8270),b=n(7978),P=10*y.Z.MSPerMinute;const S=new(r=function(){function e(){l()(this,e)}return d()(e,[{key:"init",value:function(){_.default.settings.backupFrequency.listen(this.onTimeChanged),k.Z.isBoolean(_.default.settings.needsBackup.get())&&_.default.settings.needsBackup.set({})}},{key:"docNeedsBackup",value:function(e,t){var n=_.default.settings.needsBackup.get();return n&&n[e.id]&&(t||Date.now()-n[e.id]>P)}},{key:"setNeedsBackup",value:function(e,t){"{"===_.default.settings.needsBackup.get()[0]&&_.default.settings.needsBackup.clear();var n=Date.now();if(t){if(!e.isLocalOnly()||_.default.settings.backupLocal.get()){var r=_.default.settings.needsBackup.get();r&&r[e.id]||_.default.settings.needsBackup.setProperty(e.id,n)}}else _.default.settings.needsBackup.deleteProperty(e.id)}},{key:"onTimeChanged",value:function(){this.needsBackupDrive={},m.Z.onLoaded(this.checkBackupDrive)}},{key:"onDataSaved",value:function(e){this.setNeedsBackup(e,!0)}},{key:"checkBackup",value:function(){this.checkBackupAuto()}},{key:"checkBackupAutoDoc",value:function(e,t){0}},{key:"checkBackupAuto",value:function(){var e=this;Z.Z.getDocumentsArray().forEach((function(t){return e.checkBackupAutoDoc(t)}))}},{key:"checkBackupDriveDoc",value:function(e){}},{key:"checkBackupDrive",value:function(){0}},{key:"backupDrive",value:function(){var e=s()(g().mark((function e(){return g().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(Z.Z.getDocumentsArray().map(this.backupDocumentDrive)));case 1:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backupAuto",value:function(){var e=s()(g().mark((function e(){return g().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(Z.Z.getDocumentsArray().map(this.backupDocumentAuto)));case 1:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backupAll",value:function(){var e=s()(g().mark((function e(){return g().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.backupAuto(),this.backupDrive()]));case 1:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backupDocumentAll",value:function(){var e=s()(g().mark((function e(t){return g().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.backupDocumentAuto(t),this.backupDocumentDrive(t)]));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"backupDocumentStorage",value:function(){var e=s()(g().mark((function e(t){var n,r,i;return g().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:e.next=22;break;case 5:return i=e.sent,e.prev=6,e.next=9,_.default.cloudStorage.uploadString(r,i);case 9:if(!e.sent){e.next=17;break}return t.addBackup(n),e.next=14,b.Z.getAPIForDocument(t);case 14:e.sent.addBackup(n),this.setNeedsBackup(t,!1);case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(6),k.Z.reportError(e.t0);case 22:case"end":return e.stop()}}}),e,this,[[6,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"backupDocumentAuto",value:function(){var e=s()(g().mark((function e(t){return g().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.backupDocumentStorage(t));case 2:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"backupDocumentDrive",value:function(){var e=s()(g().mark((function e(t){var n,r,i,o;return g().wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:e.next=11;break;case 5:return r=e.sent,i=new Blob([r],{type:"application/json"}),o=(new Date).toString("yy/MM/dd h:mm tt"),i.name=t.text.get()+" "+o,e.abrupt("return",new Promise((function(e){new w.Z(i,n,{named:y.Z.DriveFolder.Backup},a()({docId:t.id},y.Z.DriveBackupKey,!0),(function(){}),(function(){var n=_.default.settings.backupsDrive.get();n&&k.Z.isObject(n)||(n={}),_.default.settings.backupsDrive.set(Object.assign({},n,a()({},t.id,Date.now()))),e()}),(function(t){k.Z.reportError(t,"Backup error"),e()})).upload()})));case 10:delete this.needsBackupDrive[t.id];case 11:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"downloadBackup",value:function(){var e=s()(g().mark((function e(t,n){var r,i;return g().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return r=_.default.cloudStorage.getCloudBackupFilename(t.id,n),e.next=3,_.default.cloudStorage.getString(r);case 3:if(!(i=e.sent)){e.next=12;break}return e.prev=5,e.abrupt("return",{data:JSON.parse(i),str:i});case 9:e.prev=9,e.t0=e.catch(5),k.Z.reportError(e.t0);case 12:case"end":return e.stop()}}}),e,null,[[5,9]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"isDriveBackupAuthorized",value:function(){return m.Z.getDefaultAccountID()&&m.Z.isAuthorizedForScopes(m.Z.getDefaultAccountID(),[y.Z.GScope.Drive])}},{key:"authorize",value:function(e){m.Z.getDefaultAccountID()?m.Z.authAccount(m.Z.getDefaultAccountID(),[y.Z.GScope.Drive],(function(t){e(t)})):e(void 0)}},{key:"enable",value:function(){var e=this;this.authorize((function(t){t&&(_.default.settings.backupFrequency.set(y.Z.DefaultBackupFrequency),e.backupDrive())}))}},{key:"getLastBackup",value:function(){return Z.Z.getDocumentsArray().reduce((function(e,t){return Math.max(e,t.getLastBackup())}),0)}}]),e}(),p()(r.prototype,"onTimeChanged",[v.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onTimeChanged"),r.prototype),p()(r.prototype,"checkBackup",[v.ZP],Object.getOwnPropertyDescriptor(r.prototype,"checkBackup"),r.prototype),p()(r.prototype,"checkBackupAutoDoc",[v.ZP],Object.getOwnPropertyDescriptor(r.prototype,"checkBackupAutoDoc"),r.prototype),p()(r.prototype,"checkBackupAuto",[v.ZP],Object.getOwnPropertyDescriptor(r.prototype,"checkBackupAuto"),r.prototype),p()(r.prototype,"checkBackupDriveDoc",[v.ZP],Object.getOwnPropertyDescriptor(r.prototype,"checkBackupDriveDoc"),r.prototype),p()(r.prototype,"checkBackupDrive",[v.ZP],Object.getOwnPropertyDescriptor(r.prototype,"checkBackupDrive"),r.prototype),p()(r.prototype,"backupDocumentStorage",[v.ZP],Object.getOwnPropertyDescriptor(r.prototype,"backupDocumentStorage"),r.prototype),p()(r.prototype,"backupDocumentAuto",[v.ZP],Object.getOwnPropertyDescriptor(r.prototype,"backupDocumentAuto"),r.prototype),p()(r.prototype,"backupDocumentDrive",[v.ZP],Object.getOwnPropertyDescriptor(r.prototype,"backupDocumentDrive"),r.prototype),r)},9145:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(4654),c=n(1015),l=n(6150);const u=new(function(){function e(){i()(this,e),this._items=[]}return o()(e,[{key:"beginBatch",value:function(e){var t=e.item,n=e.pane,r=e.undo;t&&(this._items.push(t),l.Z.beginBatch(t)),n&&!this._pane&&(this._pane=!0,s.default.PaneUpdateBatcher.beginUpdateItems()),r&&!this._undo&&(this._undo=!0,c.Z.beginAction())}},{key:"commitBatch",value:function(e,t){this._items.length>0&&(this._items.map((function(e){return l.Z.commitBatch(e)})),this._items=[]),this._pane&&(this._pane=!1,s.default.PaneUpdateBatcher.commitUpdateItems(e,t)),this._undo&&(this._undo=!1,c.Z.endAction())}},{key:"doBatch",value:function(e,t){this.beginBatch(e),t(),this.commitBatch()}}]),e}())},3017:(e,t,n)=>{"use strict";n.d(t,{Z:()=>L});var r=n(8926),i=n.n(r),a=n(4575),o=n.n(a),s=n(3913),c=n.n(s),l=n(3124),u=n.n(l),d=n(7757),h=n.n(d),p=n(8572),f=n(8855),g=n(8651),m=n(7100),v=n(4654),y=n(5252),k=n(7274);const _=function(){function e(t){o()(this,e),t.panes&&(t.panes=g.Z.arrayUniques(t.panes,"id")),this.id=t.id,this.name=new k.Z(t.name),this.panes=t.panes||[],this.index=t.index,this.defaultPanes=t.defaultPanes,this.parent=new k.Z(t.parent),this.dateModified=t.d}return c()(e,[{key:"getSaveInfo",value:function(){var e={id:this.id,name:this.name.get(),index:this.index,parent:this.parent.get()||null,d:this.dateModified};return this.panes&&(e.panes=this.panes.map(g.Z.cloneWithoutUndefineds)),this.defaultPanes&&(e.defaultPanes=this.defaultPanes.map(g.Z.cloneWithoutUndefineds)),e}}]),e}();var Z,w=n(6744),b=n(5193),P=n(9148),S=n(170),D=function(){function e(t){o()(this,e),this.id=t.id,this.dateModified=t.d,this.name=new k.Z(t.name),this.index=t.index,this.isCollapsed=new k.Z(t.isCollapsed)}return c()(e,[{key:"getSaveInfo",value:function(){return{id:this.id,name:this.name.get(),index:this.index,isCollapsed:this.isCollapsed.get(),isFolder:!0,d:this.dateModified}}}]),e}(),I=n(9105),E=n(8047),x=n(7048),C="Mobile",A=1;const L=new(Z=function(){function e(){var t=this;o()(this,e),this._isSaving=!1,this._isAdding=!1,this._localState=void 0,this._boards=new P.Z,this.boardsSorted=new x.Z([this._boards],(function(e){return e.filter((function(e){return e instanceof D||!e.parent||!t.getById(e.parent.get())})).reduce((function(t,n){return t.concat(n instanceof D?[n].concat(e.filter((function(e){return!n.isCollapsed.get()&&e instanceof _&&e.parent.get()===n.id}))):n)}),[])})),this.selected=new k.Z,this.selectedFolder=new k.Z,this.selectedHash=y.Z.getURLParam("board")}return c()(e,[{key:"init",value:function(){this.load()}},{key:"setIsAdding",value:function(e){this._isAdding=e}},{key:"isAdding",value:function(){return this._isAdding}},{key:"addFolder",value:function(e,t){var n=new D({id:this.getNextID(),name:e,index:""+this._boards.length()});return this._boards.push(n),this.moveTo(this._boards.length()-1,t),n}},{key:"addToFolder",value:function(e,t){e.parent.set(t.id),this.saveBoard(e),this._boards.notify()}},{key:"removeFromFolder",value:function(e){e.parent.set(void 0),this.saveBoard(e),this._boards.notify()}},{key:"add",value:function(e){this.setIsAdding(!0);var t=new _({id:this.getNextID(),name:this.getNextName(),panes:e||[],index:""+this._boards.length()});return this._boards.push(t),this.saveBoard(t),t}},{key:"removeBoard",value:function(e,t){this._boards.length()>1&&(this._boards.remove(e),this.selected.get()===e&&this.selectFirstBoard(),t&&w.Z.deleteBoard(e.id),b.Z.deleteBoard(e.id),this._localState&&delete this._localState[e.id])}},{key:"length",value:function(){return this._boards.length()}},{key:"ensureSelected",value:function(){this.selected.get()||this.selectFirstBoard(!0),v.default.PaneManager.updateDisplayPanes()}},{key:"selectFirstBoard",value:function(e){var t=this.getBoards();this.selectBoard(t[0],e)}},{key:"selectBoard",value:function(e,t){if(e){var n;this.selected.set(e,t),e.parent.get()&&(n=this.getById(e.parent.get())),this.selectedFolder.set(n);var r=m.Z.isNativeApp();this.selectedHash||r?(y.Z.insertURLParam("board",e.id,!0),r&&v.default.ElectronBridge.selectBoard(e.id,e.name.get())):v.default.settings.selectedBoard.set(e.id)}}},{key:"_findMatchingLocalPane",value:function(e,t){var n;if(t)for(var r=0,i=0;i<t.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(t[i].id===e){n=t[i];break}}return n}},{key:"_generateUsablePaneState",value:function(e,t){for(var n=0,r=[],i=0;i<e.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=e[i],o=this._findMatchingLocalPane(a.id,t)||a;r.push(g.Z.cloneWithoutUndefineds({id:a.id,name:a.name,item:a.item,document:a.document||b.Z.getDefaultDocument().id,type:a.type,showarch:a.showarch,search:a.search,viewState:a.viewState||(a.viewMode?{viewMode:a.viewMode}:void 0),displayLocalItems:a.displayLocalItems,displayCalendars:a.displayCalendars,blocksCollapsed:a.blocksCollapsed,documentSortMode:a.documentSortMode,itemState:a.itemState,isOverviewVisible:a.isOverviewVisible,widthManual:a.widthManual,widthManualExpanded:a.widthManualExpanded,scrollIndex:o?o.scrollIndex:0,isExpanded:!!o&&o.isExpanded,selectedItem:o?o.selectedItem:void 0}))}return r}},{key:"hasLoadedPaneState",value:function(){return!!this._localState}},{key:"getPaneState",value:function(){var e=this.get();return e?this._generateUsablePaneState(e.panes||[],this._localState[e.id]):[]}},{key:"_generateSyncPaneState",value:function(e){for(var t=0,n=[],r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[r];n.push({id:i.id,name:i.name,item:i.item,type:i.type,document:i.document,showarch:i.showarch,search:i.search,viewState:i.viewState,itemState:i.itemState,isOverviewVisible:i.isOverviewVisible,displayCalendars:i.displayCalendars,displayLocalItems:i.displayLocalItems,widthManual:i.widthManual,widthManualExpanded:i.widthManualExpanded,blocksCollapsed:i.blocksCollapsed,documentSortMode:i.documentSortMode})}return n}},{key:"_generateLocalPaneState",value:function(e){for(var t=0,n=[],r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[r];n.push({id:i.id,scrollIndex:i.scrollIndex,isExpanded:i.isExpanded,selectedItem:i.selectedItem})}return n}},{key:"savePaneState",value:function(e,t){if(this._boards.length()>0)try{this._saveSyncState(e),this._saveLocalState(e),this.saveBoard(this.get(),t)}catch(n){g.Z.reportError(n,{numBoards:this._boards.length()})}}},{key:"_saveLocalState",value:function(e){var t=this.get().id;try{g.Z.PAssert(203,t,"Must have a valid board ID")}catch(r){g.Z.reportError(r)}var n=this._generateLocalPaneState(e);g.Z.deepEqual(n,this._localState[t])||(this._localState=g.Z.clone(this._localState),this._localState[t]=n)}},{key:"_saveSyncState",value:function(e){var t=this.get();try{g.Z.PAssert(204,t,"Selected board does not exist")}catch(n){g.Z.reportError(n)}t&&(t.panes=this._generateSyncPaneState(e))}},{key:"renameBoard",value:function(e,t){if(e.name.get()!==t){for(var n=0,r=!1,i=0;i<this._boards.length();i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this._boards.get()[i];if(a!==e&&a.name.get()===t)return r=!0,!1}r||(e.name.set(t),this.saveBoard(e),this.selected.notify())}return!0}},{key:"saveBoardDefault",value:function(e){e.defaultPanes=g.Z.clone(e.panes),this.saveBoard(e)}},{key:"restoreBoardDefault",value:function(e){e.panes=g.Z.clone(e.defaultPanes),this.selected.notify()}},{key:"get",value:function(){return this.selected.get()}},{key:"createDefaultState",value:function(){if(0===this._boards.length()){var e=b.Z.getDefaultDocument(),t=[];if(e){var n=e.getRootItem();t=[new _({id:b.Z.generateID(),name:"Tasks",index:"0",panes:[{id:v.default.PaneManager.getNextPaneID(),document:e.id,item:n.id,type:f.Z.PaneMode.Task,viewState:{viewMode:"Outline"},isOverviewVisible:!0}]}),new _({id:b.Z.generateID(),name:"Today",index:"1",panes:[{id:v.default.PaneManager.getNextPaneID(),document:e.id,item:n.id,type:f.Z.PaneMode.Task,viewState:{viewMode:"Agenda_Today"},isOverviewVisible:!0}]}),new _({id:b.Z.generateID(),name:"Calendar",index:"2",panes:[{id:v.default.PaneManager.getNextPaneID(),document:e.id,item:n.id,type:f.Z.PaneMode.Task,viewState:{viewMode:"Calendar_Week"}}]})],v.default.pluginManager.isEnabled(f.Z.PluginID.Gmail)&&t.splice(2,0,new _({id:b.Z.generateID(),name:"Email",index:"1,0",panes:[{id:v.default.PaneManager.getNextPaneID(),type:f.Z.PaneMode.Gmail,isOverviewVisible:!0,isExpanded:!0}]}))}return this._boards.set(t),this.saveAll(),this.selectFirstBoard(!0),t}}},{key:"getNextName",value:function(){var e,t,n=0,r=this._boards.get(),i=1;do{var a=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e=!1,t="Board "+i,i++;for(var o=0;o<r.length;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(r[o].name.get()===t){e=!0;break}}}while(e);return t}},{key:"getNextID",value:function(){return 1e3*Math.floor(Math.random())+"I"+Date.now()+"Z"+ ++A}},{key:"load",value:function(){var e,t,n=b.Z.getBoards(),r=Object.keys(n).map((function(e){var t=n[e];return t.isFolder?new D(t):new _(t)}));r.sort(I.Z.compareItemIndex);try{e=v.default.settings.localPaneState.get()||{}}catch(a){e={}}if(this._localState=e,g.Z.isDemoMode()||r.find((function(e){return e.id===C}))||r.push(this.createDefaultMobileState(r)),r&&r.length>0)if(this._boards.set(r),t=C,g.Z.isNumber(t))this.selectBoardAtIndex(t,!0);else{var i=this.getById(t);i instanceof _?this.selectBoard(i,!0):this.selectBoardAtIndex(0,!0)}}},{key:"setBoards",value:function(e){this._boards.set(e),this.ensureSelected()}},{key:"saveAll",value:function(){var e=this;this.trackPaneState()&&this._boards.forEach((function(t){e.saveBoard(t)}))}},{key:"saveBoard",value:function(e,t){if(this.trackPaneState()&&e){var n=e.getSaveInfo();b.Z.saveBoard(n,t),v.default.settings.localPaneState.set(g.Z.cloneWithoutUndefineds(this._localState))}}},{key:"trackPaneState",value:function(){return!g.Z.isDemoMode()}},{key:"onSettingChanged",value:function(){this._isSaving||this.load()}},{key:"moveTo",value:function(e,t){if(e!==t){var n=this.boardsSorted.get(),r=n[e];n.splice(e,1);var i=n[t-1],a=n[t];if(r instanceof D){if(i instanceof _&&i.parent.get()===r.id)return}else{var o=i?i instanceof D?i.isCollapsed.get()?null:i.id:i.parent.get():null;r.parent.set(o)}var s=(0,S.b)(null===i||void 0===i?void 0:i.index,null===a||void 0===a?void 0:a.index);r.index=s,this._boards.sort(I.Z.compareItemIndex),this.saveBoard(r)}}},{key:"cloneBoard",value:function(e,t){var n;(e=e||this.get(),t)?n=[t.getSaveInfoForClone()]:n=e.panes;try{g.Z.PAssert(205,n,"Must have valid panes to clone a board")}catch(i){g.Z.reportError(i)}var r=this.add(n);return this.selectBoard(r),r}},{key:"getById",value:function(e){return this._boards.get().find((function(t){return t.id===e}))}},{key:"onRemoteUpdate",value:function(e,t){var n=t.id,r=t.name,i=t.panes,a=t.parent,o=t.index,s=t.defaultPanes,c=t.isFolder,l=t.d,u=this.getById(n),d=this.get();if(e===f.Z.CrudActions.Removed)u&&this.removeBoard(u);else if(u)if(u instanceof _){var h,p=(null===(h=u.panes)||void 0===h?void 0:h.map((function(e){return g.Z.removeNullUndefined(e)})))||[],m=u.name.get()!==r||u.index!==o||u.parent.get()!=a||!p.equals(i,!0);E.Z.beginBatch();try{m&&(u.name.set(r),u.index=o,u.panes=i,u.dateModified=l,u.parent.set(a),u.defaultPanes=s,this._boards.sort(I.Z.compareItemIndex),d&&(this.selectBoard(d,u===d),v.default.PaneManager.onRemoteUpdate(i)))}catch(y){g.Z.reportError(y,u.name)}E.Z.endBatch()}else u.name.set(r),u.index=o,this._boards.sort(I.Z.compareItemIndex);else this._boards.insertSorted(c?new D(t):new _(t),I.Z.compareItemIndex),this.selectBoard(d)}},{key:"ensureUniqueIndices",value:function(){for(var e=0,t=this._boards.get(),n=1;n<t.length;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t[n-1],i=t[n],a=t[n+1];i.index&&i.index!==r.index||(i.index=(0,S.b)(null===r||void 0===r?void 0:r.index,null===a||void 0===a?void 0:a.index),this.saveBoard(i))}}},{key:"hotkeyPrevBoard",value:function(){var e=this.getSelectedIndex()-1;e<0&&(e=this.length()-1),this.selectBoardAtIndex(e)}},{key:"hotkeyNextBoard",value:function(){var e=this.getSelectedIndex()+1;e>=this.length()&&(e=0),this.selectBoardAtIndex(e)}},{key:"getSelectedIndex",value:function(){return this.getBoards().indexOf(this.get())}},{key:"getBoards",value:function(){return this._boards.get().filter((function(e){return e instanceof _}))}},{key:"selectBoardAtIndex",value:function(e,t){var n=this.boardsSorted.get().filter((function(e){return e instanceof _}));e>=0&&e<n.length&&this.selectBoard(n[e],t)}},{key:"clear",value:function(){this._boards.clear()}},{key:"setFolderCollapsed",value:function(e,t){e.isCollapsed.set(t),this.saveBoard(e),this._boards.notify()}},{key:"getFolders",value:function(){return this._boards.get().filter((function(e){return e instanceof D}))}},{key:"getBoardFolderAsTemplate",value:function(){var e=i()(h().mark((function e(t){var n,r,i,a,o,s;return h().wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:return n=this._boards.get().filter((function(e){return e instanceof _&&e.parent.get()===t.id})),r=g.Z.arrayUniques(g.Z.arrayFlat(n.map((function(e){return e.panes.map((function(e){return e.type===f.Z.PaneMode.Task&&e.document}))}))).filter((function(e){return!!e}))),i=r.map((function(e){return b.Z.getDocumentById(e)})),e.next=5,Promise.all(i.map((function(e){return e.toJSONObject({includeNotes:!0})})));case 5:return a=e.sent,o={},n.forEach((function(e){return o[e.id]=e.getSaveInfo()})),s={version:1,dateBasis:Date.now(),documents:a,boards:o},e.abrupt("return",s);case 10:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDefaultMobileState",value:function(e){var t=b.Z.getDefaultDocument(),n=t.getRootItem(),r=new _({id:C,name:C,index:""+e.length,panes:[{id:"Inbox",type:f.Z.PaneMode.Inbox},{id:"Outline",document:t.id,item:n.id,type:f.Z.PaneMode.Task,viewState:{viewMode:"Outline"}},{id:"Agenda",document:t.id,item:n.id,type:f.Z.PaneMode.Task,viewState:{viewMode:"Agenda_All"}}]});return this.saveBoard(r),r}},{key:"numPanesTotal",value:function(e){return g.Z.sum(this._boards.get(),(function(t){return t instanceof D||e&&t.id===C?0:t.panes.length}))}}]),e}(),u()(Z.prototype,"saveAll",[p.ZP],Object.getOwnPropertyDescriptor(Z.prototype,"saveAll"),Z.prototype),u()(Z.prototype,"saveBoard",[p.ZP],Object.getOwnPropertyDescriptor(Z.prototype,"saveBoard"),Z.prototype),u()(Z.prototype,"hotkeyPrevBoard",[p.ZP],Object.getOwnPropertyDescriptor(Z.prototype,"hotkeyPrevBoard"),Z.prototype),u()(Z.prototype,"hotkeyNextBoard",[p.ZP],Object.getOwnPropertyDescriptor(Z.prototype,"hotkeyNextBoard"),Z.prototype),u()(Z.prototype,"selectBoardAtIndex",[p.ZP],Object.getOwnPropertyDescriptor(Z.prototype,"selectBoardAtIndex"),Z.prototype),Z)},461:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});var r=n(8926),i=n.n(r),a=n(4575),o=n.n(a),s=n(3913),c=n.n(s),l=n(7757),u=n.n(l),d=n(7411),h=n(8855),p=n(8651),f=(n(5252),n(9105));const g=new(function(){function e(){o()(this,e),this.url=h.Z.CloudFunctionsURL}return c()(e,[{key:"run",value:function(){var e=i()(u().mark((function e(t){var n,r,i,a,o,s,c,l,d,p=arguments;return u().wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:return n=p.length>1&&void 0!==p[1]?p[1]:{},r=n.query,i=n.body,a=n.retry,e.next=3,this.createURL(t,r,a);case 3:if(!(o=e.sent)){e.next=31;break}return s=i?{method:"POST",body:JSON.stringify(i)}:void 0,e.prev=6,e.next=9,fetch(o,s);case 9:if(200!==(c=e.sent).status){e.next=17;break}return e.next=13,c.json();case 13:return l=e.sent,e.abrupt("return",{value:l,errorCode:void 0,error:void 0});case 17:return e.next=19,c.json();case 19:if(d=e.sent,a||"Unauthorized idToken"!==d.message){e.next=23;break}return console.log("Retrying becaus of invalid idToken"),e.abrupt("return",this.run(t,{query:r,body:i,retry:!0}));case 23:return e.abrupt("return",{value:void 0,errorCode:d.errorCode||d.status||c.status,error:d.message,braintreeError:d.braintreeError,braintreeErrorCode:d.braintreeErrorCode});case 24:e.next=29;break;case 26:return e.prev=26,e.t0=e.catch(6),e.abrupt("return",{value:void 0,error:e.t0.message||e.t0});case 29:e.next=32;break;case 31:return e.abrupt("return",{value:void 0,errorCode:h.Z.PrivateAPIErrorCodes.MissingIDToken,error:"User does not have a valid id_token"});case 32:case"end":return e.stop()}}}),e,this,[[6,26]])})));return function(t){return e.apply(this,arguments)}}()},{key:"createURL",value:function(){var e=i()(u().mark((function e(t){var n,r,i,a,o,s,c,l=arguments;return u().wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:return n=l.length>1&&void 0!==l[1]?l[1]:{},r=l.length>2?l[2]:void 0,e.next=4,d.Z.getUser();case 4:return i=e.sent,e.next=7,i.getIdToken(!!r);case 7:a=e.sent;try{p.Z.PAssert(240,a,"User does not have a valid id_token")}catch(h){p.Z.reportError(h)}if(!a){e.next=15;break}for(c in n.id_token=a,o=this.url+t+"?",s=[],n)n.hasOwnProperty(c)&&n[c]&&s.push(c+"="+encodeURIComponent(n[c]));return e.abrupt("return",o+s.join("&"));case 15:return e.abrupt("return",void 0);case 16:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendFeedback",value:function(e){return this.run("user/sendFeedback",{body:e})}},{key:"setUserProperties",value:function(e){var t=f.Z.userOut(e);return this.run("user/setUserProperties",{body:t})}},{key:"shareDocument",value:function(e){return this.run("sharing/shareDocument",{body:e})}},{key:"listTransactions",value:function(){return this.run("billing/listTransactions")}},{key:"getBillingToken",value:function(){return this.run("billing/getBillingToken")}},{key:"updateOrPurchasePlan",value:function(e){return this.run("billing/updateOrPurchasePlan",{body:e})}},{key:"oneTimePurchase",value:function(e){return this.run("billing/oneTimePurchase",{body:e})}},{key:"changePlan",value:function(e){return this.run("billing/changePlan",{body:e})}},{key:"cancelPremium",value:function(){return this.run("billing/cancelPremium")}},{key:"updatePremiumStatus",value:function(){return this.run("billing/updatePremiumStatus")}},{key:"deleteAccount",value:function(){return this.run("user/deleteAccount")}},{key:"acceptInvite",value:function(e){return this.run("sharing/acceptInvite",{body:{token:e}})}},{key:"todoistImport",value:function(e){return this.run("oauth/todoist",{body:{code:e}})}},{key:"getTemplateProperties",value:function(){var e=i()(u().mark((function e(t){var n;return u().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.run("templates/getProps",{query:{folderID:t}});case 2:return(n=e.sent).value&&(n.value.id=t),e.abrupt("return",n);case 5:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createTemplate",value:function(e,t,n,r){return this.run("templates/create",{body:{name:t,folderID:e,value:r,created:n}})}},{key:"updateIAP",value:function(){var e=i()(u().mark((function e(t){return u().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.run("billing/updateIAP",{body:t}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAccessToken",value:function(e,t){return this.run("auth/getAccessToken",{query:{email:e,refresh_part:t}})}},{key:"onAuthCode",value:function(e){return this.run("auth/onAuthCode",{body:e})}},{key:"saveRefreshToken",value:function(e){return this.run("auth/saveRefreshToken",{body:e})}}]),e}())},8855:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var r,i=n(9713),a=n.n(i);Error.stackTraceLimit=1/0;var o={ScrollLock:3,Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,NumLock:19,CapsLock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Insert:45,Delete:46,D0:48,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,Colon:58,LAngle:60,RAngle:62,At:64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,ContextMenu:93,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,NumpadMultiply:106,NumPlus:107,NumpadAdd:107,Minus:109,NumpadSubtract:109,NumpadDecimal:110,NumpadDivide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,VolumeMute:181,VolumeDown:182,VolumeUp:183,Semicolon:186,Equal:187,Plus:187,Comma:188,Dash:189,Period:190,Slash:191,Tilde:192,BracketLeft:219,Backslash:220,BracketRight:221,Quote:222,Backquote:229},s={CarriageReturn:10},c={};Object.keys(s).forEach((function(e){return c[e]=String.fromCharCode(s[e])}));var l={None:0,Note:32,Archived:128,Complete:4096,P3:8192,P2:16384,P1:32768,Starred:65536,HasPageToken:131072,DisplayComplete:262144},u={Calendar:"https://www.googleapis.com/auth/calendar",CalendarRO:"https://www.googleapis.com/auth/calendar.readonly",Contacts:"https://www.googleapis.com/auth/contacts.readonly",Drive:"https://www.googleapis.com/auth/drive.file",DriveMetadataRO:"https://www.googleapis.com/auth/drive.metadata.readonly",DriveFull:"https://www.googleapis.com/auth/drive",DriveReadOnly:"https://www.googleapis.com/auth/drive.readonly",GmailCompose:"https://www.googleapis.com/auth/gmail.compose",GmailModify:"https://www.googleapis.com/auth/gmail.modify",TasksRO:"https://www.googleapis.com/auth/tasks.readonly",UserInfoEmail:"https://www.googleapis.com/auth/userinfo.email",UserInfoProfile:"https://www.googleapis.com/auth/userinfo.profile",DriveAppData:"https://www.googleapis.com/auth/drive.appdata",Plus:"",DriveInstall:"https://www.googleapis.com/auth/drive.install",Email:"email",Profile:"Profile"},d="api.moo.do",h="https://".concat(d),p="597847337936-8oiuh4nlenctu9bpginvqq768g32apkt";const f={FirebaseAppID:"597847337936",FirebaseProjectID:"api-project-597847337936",APIKey:"AIzaSyCgYrT1vXClB5Y9lRl0iOTtM4W4aBvLn50",ClientID:"".concat(p,".apps.googleusercontent.com"),ClientIDReversed:"com.googleusercontent.apps.".concat(p),APIBaseURL:d,APIFullURL:h,CloudFunctionsURL:"".concat(h,"/appapi/1/"),EmailOpenTime:250,ItemTransitionTime:150,DoubleClickTime:500,EmailPreviewSizeMin:600,EmailPreviewSizeMaxFlex:800,EmailPreviewSizeMax:1200,ExpandedPaneWidth:400,HelpWidth:360,PaneWidthMin:300,StdPaneWidthMin:400,StdPaneWidthMax:900,PaneWidthMax:1400,OverviewWidth:260,OverviewItemHeightDesktop:26,EmailItemHeight:80,RightMenuWidth:100,TrialDuration:14,MSPerMinute:6e4,MSPerHour:36e5,MSPerDay:864e5,MSPerWeek:6048e5,DefaultEventDuration:36e5,MaxBatchSize:45,TooltipDelay:1e3,HorizScrollbarHeight:18,DesktopToolbarHeight:32,PaneHeaderButtonWidth:32,PaneHeaderButtonHeight:36,PaneHeaderButtonIconHeight:28,PaneHeadingHeightSmall:40,PaneHeaderHeight:48,CalendarResizeHandleHeight:8,CalendarTimesWidth:50,DesktopMenuWidthDefault:120,DesktopMenuWidthMax:240,DesktopMenuWidthMinBig:70,DesktopMenuWidthSmall:36,RootItemName:"Home",MinEmailScale:.25,SidebarDragHandleSize:16,SearchHeight:22,PaneAddItemBoxHeight:36,DateFormat:{DMY:"dmy",DMYDot:"dmydot",MDY:"mdy",YMD:"ymd",YMDDot:"ymddot"},MatchState:{Unknown:void 0,No:0,Yes:1,Negated:2,ChildYes:3},EmailResponseMode:{None:"None",Reply:"Reply",ReplyAll:"Reply All",Forward:"Forward",Compose:"New Message"},PluginType:{Unknown:0,Storage:1,Calendar:2,Email:3},SyncResult:{Success:0,FailureOAuth:1,FailureNoWrite:2,FailureNoRead:3,FailureNetwork:4,FailureUnknown:5},Primary:{No:0,Yes:1,Either:2,Both:3,Never:4,Only:5},Shift:{No:0,Yes:1,Either:2},FavoriteGroup:{EmailRoot:1},DropEffect:{Copy:"copy",Move:"move"},HoveredID:{Plugin:"plugin",Collapser:"collapser",Checkbox:"checkbox",Bullet:"bullet"},TaskViewModesNew:["Outline","List","Calendar","-","Archived","Deleted"],PaneModesNonTask:["Email","Files","Legacy Email"],TaskViewGroups:["None","Project","Tag","Contact","Priority","Agenda","Date","Created","Modified","Completed"],TaskViewSorts:["None","Alphabetical","NumItems","Priority","Date","Created","Completed","Modified"],TaskAgendaOptions:["Today","Week","Month","All"],TaskCalendarOptions:["Day","Custom","Week","Month"],TaskViewModesPremium:{Groups_Tag:!0,Groups_Contact:!0,Groups_Priority:!0},TaskViewModeText:{Outline:"Outline",List_Flat:"Flat List",Groups_Project:"Project",Groups_Tag:"Tag",Groups_Contact:"Contact",Groups_Priority:"Priority",Agenda_Today:"Today",Agenda_Week:"Week",Agenda_Month:"Month",Agenda_All:"All",Calendar_Day:"Day",Calendar_Custom:"# Days",Calendar_Week:"Week",Calendar_Month:"Month",Archived:"Archive",Deleted:"Deleted"},TaskViewModeTextSimple:{Outline:"Outline",List_Flat:"Flat List",Groups_Project:"Projects",Groups_Tag:"Tags",Groups_Contact:"Contacts",Groups_Priority:"Priorities",Agenda_Today:"Agenda",Agenda_Week:"Agenda",Agenda_All:"Agenda",Calendar_Day:"Calendar",Calendar_Custom:"Calendar",Calendar_Week:"Calendar",Calendar_Month:"Calendar",Archived:"Archived Items",Deleted:"Deleted Items"},TaskViewModeIcon:{Outline:"icon-format_list_bulleted",List_Flat:"icon-reorder",Groups_Project:"icon-project",Groups_Tag:"icon-hash",Groups_Contact:"icon-user",Groups_Priority:"icon-exclamation",Agenda_Today:"icon-today",Agenda_Week:"icon-view-groups",Agenda_Month:"icon-reorder",Agenda_All:"icon-format_align_justify",Calendar_Day:"icon-view_carousel",Calendar_Custom:"icon-view_week",Calendar_Week:"icon-cal-week",Calendar_Month:"icon-view_comfy",Archived:"icon-inbox",Deleted:"icon-delete"},TaskViewModeIconNew:{Outline:"MdFormatListBulleted",List_Flat:"IoMdList",Groups_Project:"icon-project",Groups_Tag:"FaHashtag",Groups_Contact:"MdPerson",Groups_Priority:"FaExclamation",Agenda_Today:"MdViewAgenda",Agenda_Week:"MdViewAgenda",Agenda_Month:"MdViewAgenda",Agenda_All:"MdViewAgenda",Calendar_Day:"IoIosCalendar",Calendar_Custom:"IoIosCalendar",Calendar_Week:"IoIosCalendar",Calendar_Month:"IoIosCalendar",Archived:"MdMoveToInbox",Deleted:"IoMdTrash"},TaskViewModeIconSizeNew:{Groups_Tag:13,Groups_Priority:13},TaskViewModeTextNew:{Calendar_Day:"Day",Calendar_Custom:"# Days",Calendar_Week:"Week",Calendar_Month:"Month"},TaskSortModeText:{None:"None",Alphabetical:"A-Z",NumItems:"# Items",Priority:"!!!",Date:"Date",Created:"Created",Completed:"Completed",Modified:"Modified"},DocumentSortMode:{Alphabetical:"Alphabetical",Modified:"Modified"},CalendarMonthViewWeekHeight:150,CalendarMonthViewMonthTitleHeight:50,CalendarMonthViewNumWeeksPad:52,CalendarDayViewNumDaysPad:364,CalendarDayViewMaxAllDayHeight:164,CalendarDayViewBlockHeight:50,CalendarMaxSyncWeeks:52,CalendarMinSyncWeeks:-52,HTTPStatusCode:{Network:0,Success:200,Created:201,PermRedirect:308,BadRequest:400,Unauthorized:401,Forbidden:403,NotFound:404,Timeout:408,Conflict:409,Gone:410,TooMany:429,ServerError:500,BadGateway:502,Unavailable:503,GatewayTimeout:504},PluginAction:{Gmail:{Archive:1,Unarchive:2,Trash:3,Untrash:4,AddLabel:5,RemoveLabel:6,Star:7,Unstar:8,MarkRead:9,MarkUnread:10,SetPriority:11,Move:12,Snooze:13,ScheduleSend:14,DiscardDraft:15}},DFormat:{LongDayTime:0,ShortDayTime:1,ShortTime:2,ShortDate:3,MonthDay:4,MonthDayYear:5,LongStrDate:6,DayYearTime:7,MonthDayYearShort:8,DayMonthDateYear:9,MonthDayLong:10,MonthDayYearLong:11,DayDate:12,NoPadShortDayTime:13,MonthDayShort:14},HelpMode:{None:0,Normal:1,Hotkeys:3},Analytics:{Dimensions:{PremiumStatus:"dimension1"}},Feature:{ClonePane:"clonePane",OAuth:"oauth"},GmailViewMode:{Date:"Date",Priority:"Priority"},MaxGmailSyncTime:{Premium:120,Free:5},MessageListVisibility:{Hide:"hide",Show:"show"},LabelListVisibility:{Hide:"labelHide",Show:"labelShow",ShowIfUnread:"labelShowIfUnread"},GoogleError:{FailedPrecondition:"failedPrecondition",InsufficientPermissions:"insufficientPermissions",Forbidden:"forbidden",DailyLimitExceeded:"dailyLimitExceeded",UserRateLimitExceeded:"userRateLimitExceeded",RateLimitExceeded:"rateLimitExceeded",SharingRateLimitExceeded:"sharingRateLimitExceeded",QuotaExceeded:"quotaExceeded"},GoogleErrorDomain:{UsageLimits:"usageLimits"},KeyboardToolbarHeight:44,KeyboardToolbarMode:{Item:0,Search:1,Modal:2},DocLoadSkipReason:{None:"None",Already:"Already Loading",Main:"Main Not Loaded",Drive:"Drive Not Loaded",NotAuth:"Not Authorized",LoginState:"Not Logged In"},TopBarMode:{Normal:"Normal",Multiselect:"Selected",Contact:"Contacts",Date:"Date",Tag:"Tag",Note:"Note"},ComponentDisplay:{Desktop:1,Mobile:2,Everywhere:3},RequestPriority:{Low:0,Default:50,UserBlocking:100},Orientation:{Vertical:0,Horizontal:1,Portrait:0,Landscape:1},DragDropPosition:{Above:-1,On:0,Below:1},SetMode:{Toggle:-1,No:0,Yes:1},SelectOption:{Delay:1,DoNothing:2,AllowPrefix:3},DisplayTheme:{Simple:"Classic",OutlineLight:"Light",OutlineHeavy:"Outliner",Markdown:"Markdown",SpacingCompact:"SpacingCompact",SpacingComfortable:"SpacingComfortable",PrefixesFaded:"PrefixesFaded",PrefixesStrong:"PrefixesStrong"},LocalWriteReason:{Enabled:-1,DemoMode:1,QuotaError:2,NoLocal:3,NoPermission:4,Generic:5},ConversionID:{Purchase:"ha4uCMXduXUQ6vTp0QM",Signup:"LAulCIvcuXUQ6vTp0QM"},IntroVideoID:"qE14CrQiXwc",Prefix:{Header:"#",Header2:"^",Bullet:"-",Bullet2:"*",Task:"[",Task2:"[]",Task3:"]",Task4:"[ ]",NumList:"1.",CodeBlock:"```"},InlinePrefix:{ItemLink:"[[",ItemMirror:"(("},SearchFilterTexts:{Star:"*",Pri1:"!!!",Pri2:"!!",Pri3:"!"},MinimumTokenExpireTimeMS:6e4,MinimumTokenExpireTime:60,ToastTimeoutDefault:5e3,PrefixWidth:20,PrefixOffsetFromItem:8,PrefixWidthPlusOffset:28,PaddingAgendaTime:30,HeightAgendaParents:18,LineLeftPad:5,ItemTextVPad:5,TextSpace:"\ufeff",TextSpaceRegexp:/\uFEFF/g,AttachChar:"\u2000",EmbedAttachChar:"\u2001",RNSpace:"\u2002",CharDate:"\ufefe",PerPaneStateField:{Element:"element",OverviewElement:"oelement",Collapsed:"collapsed",CollapsedOverview:"collapsedOverview",CollapsedSearch:"collapsedSearch"},ItemStoreFilter:{None:0,Dates:1,Contacts:2,Priority:4},NumKeys:[o.D1,o.D2,o.D3,o.D4,o.D5,o.D6,o.D7,o.D8,o.D9,o.D0],ContactPrefix:"+",TagPrefix:"#",PrefixDate:"!",PrefixItemAutocomplete:"$",KeyCode:o,KeyCodesModifiers:[o.LeftMeta,o.ContextMenu,o.Ctrl,o.Alt,o.Shift],KeyCodesArrows:[o.ArrowUp,o.ArrowDown,o.ArrowLeft,o.ArrowRight],PrivateAPIErrorCodes:{Success:0,UnknownFailure:1,Unexpected:2,DatabaseReadError:3,DatabaseWriteError:4,MissingParameter:5,InvalidParameter:6,UnauthorizedUser:7,ErrorSendingEmail:8,AlreadyReferred:9,ErrorContactingRemote:10,BraintreeUnknown:11,InvalidToken:12,InvalidReferralCode:13,NoSignupFound:14,TrialOver:15,RemoteServerError:16,TokenMissing:17,BraintreePaypalBlock:18,BraintreeInvalidCCN:19,AlreadyExists:20,DomainPolicy:21,InvalidCode:22,RejectedEmail:23,AlreadyPremium:24,MissingIDToken:25},SearchDates:{Overdue:"@overdue",Before:"before:",After:"after:",Date:"date:",Between:"between:"},Regexp:{MDLink:/(!?)\[([^\[]*)\]\(([^\s]+)(\s=\d{0,3}x)?(?=\))\)/g,Prefix:/^(```[A-Za-z]*|\#+|\^|\-|\*|\[(?: ?\])?|\]|[0-9]+\.) /gi,HR:/^(?:(\#+|\^|\-|\*|\[(?: ?\])?|\]|\((?: ?\))?|\)|\+|[0-9]+\.) )?(-{3,})$/gi,Interlink:/\[\[([\w|~|-]*)\]\]/g,InterlinkMirror:/\(\(([\w|~|-]*)\)\)/g,InterlinkWithText:/\[\[([\w|~|-]*)(?:[^\[\]]*)\]\]/g,MDFormat:/[*_~`=]/g,DataImage:/(?:!?(?:\[\]\()?)(data:image\/(?:[a-zA-Z]*);base64,(?:[^\"\)\s]*))(\s=\d{0,3}x)?(?:\)?)/gi,WebURLWithProtocol:/(^|[\(\[\s-])(!?)(?:(?:(?:(https?|ftp|evernote|onenote|bear|file):\/{2,3})([^\s/$.?#'"]+(?:[^\s'",]|(?:,[$\S]))*)))(?=[ \.,'"\)\]]|$)/gi,WebURL:/(^|[\(\[\s-])(!?)((?:[a-zA-Z.]{2,}\.(?:com?|org|net)|www\.[a-zA-Z.]{2,})[\w/#?=&]*)/gi},DefaultBackupFrequency:36e5,DriveFolder:{Root:"root",Attach:"attach",Backup:"backup"},CrudActions:{Added:"Added",Modified:"Modified",Removed:"Removed"},TestDocName:"demo",LocalStoreMode:{Mirror:"mirror"},LogLevels:{Off:0,Error:1,Warning:2,Timing:4,Data:8,Status:16,Search:32,Timeline:64,Input:128,Tracker:256,Profile:512,PageLoad:1024,Toolbar:2048,Picker:4096,Intro:8192,Import:16384,Version:32768,Settings:65536,Selection:131072,Edit:262144,NativeAuth:524288,DateRoll:1048576,DebugDOM:2097152,RepeatDate:4194304,Connection:8388608,Plugin:16777216,Folders:33554432,Verbose:67108864,Account:134217728,React:268435456,Autocomplete:536870912,Compose:1073741824},URLPart:{Search:1,Hash:2},PremiumStatus:{Unknown:0,Never:1,Trial:2,TrialOver:3,Active:4,PastDue:5,CanceledUser:6,CanceledPastDue:7},UninitializedVersion:-1,DETAILED_STATS:!1,DEBUG_DATE:!1,OAuthSchemeType:{Invalid:-1,None:0,Web:1,Native:2,Count:2},RepeatFreq:{Once:0,Daily:1,Weekly:2,Monthly:3,DayOfMonth:4,Yearly:5,EndOfMonthOffset:6,NthMonthInst:7},ChangeType:{None:0,Local:1,Remote:2,Auto:4,Structure:33554432,Text:67108864,Property:134217728,UndoRedo:2097152,PluginLoad:4194304,ItemLoad:8388608,DocLoad:65536,Locations:7,All:234881024,AllLocal:234881025,AllRemote:234881026,Valid:250675207},DataChangeType:{Add:1,Remove:2,Change:3},VMLIFlag:l,VersionType:{Structure:1,Text:2},SearchResultStatus:{Done:1,TooMany:2,None:3,Error:4},PaneMode:{Task:"PaneTask",Archived:"PaneArchived",Drive:"PaneDrive",Gmail:"PaneGmail",Inbox:"PaneInbox"},LoadState:{Connecting:0,NeedPassword:1,LoadingDocs:2,Connected:3},LoginState:{NONE:0,LOGGED_OUT:1,LOGGED_IN:2},ButtonCode:{None:-1,Left:0,Middle:1,Right:2},Direction:{Up:-1,None:0,Down:1},MessageAction:{Default:0,Reload:1,LoginScreen:2,Demo:3,ResetClient:4,None:5,SyncContacts:6,OpenURL:7,Okay:8,Blog:9,Undo:10,Contact:11,OpenSettings:12,OpenAccountSettings:13,OpenGoogleDrive:14,OpenDisplaySettings:15,StartDemo:16,OpenGeneralSettings:18,OpenCalendarSettings:19,OpenUpgrade:20,OpenFilesSettings:21},MessageType:{Info:0,Warning:1,Error:2,Fatal:3,Subtitle:4,Intro:5,RequiredUpdate:6,InfoGray:7},MessageID:{Undefined:0,ConnectionError:1,OfflineUndo:2,FatalError:3,DocChange:4,OfflineWarn:5,OnlineInfo:6,CacheReset:7,RequiredUpdate:8,Updated:9,SyncContacts:10,ExitDemo:11,Reauthorize:12,ShareFailure:13,ThisIsDemo:14,MailbirdClick:15,InviteFailure:16,InviteSuccess:17,PremiumRequired:18,TrialOver:19,TrialEndSoon:20,DisabledFolderDrop:21,WarnLargeFile:22,InviteInvalid:23,NoSharingWarning:24,LostPermission:25,CalendarSync:26,EmailSendFail:28,EmailUpdateFail:29,EmailLabelFail:30,EmailSyncFail:31,DemoPluginClick:33,PromptScriptStart:34,SnoozeOffline:35,NeedDrivePermission:36,LostLinked:38,GmailDisabled:39,LocalWritesDisabled:40,FlatSearchMultiSelect:43,FlatSearchTab:45,ReadOnlyCalendar:46,CalendarSaveFail:47,QuotaError:48,ReselectEmail:49,ReactError:50,PaneLoadTimeout:51,SetupGmailViews:52,GmailViewsNeedSignin:53},SaveFlag:{None:0,Prop:1,Text:2,All:3},DateType:{Once:1,Repeat:2},StorageType:{InMemory:1,LocalStorage:2,IndexedDB:3},PluginID:{Date:"Date",Moodo:"Moodo",Contacts:"Contacts",Drive:"Drive",Mailbird:"Mailbird",Gmail:"Gmail",GCalendar:"GCalendar",Email:"Email"},PluginNames:{Date:"Date",Moodo:"Moodo",Contacts:"Google Contacts",Drive:"Google Drive",Mailbird:"Mailbird",Gmail:"Gmail",GCalendar:"Google Calendar",Email:"Email"},PluginSettingsID:{Date:{IsEnabled:"isEnabled"},Moodo:{IsEnabled:"isEnabled"},Mailbird:{IsEnabled:"isEnabled"},Gmail:{IsEnabled:"isEnabled",ArchiveOnSchedule:"archiveOnSchedule",ArchiveOnOrganize:"archiveOnOrganize",InsertSignatureAboveReplies:"insertSignatureAboveReplies",SyncTime:"syncTime",SyncAccounts:"syncAccounts"},Drive:{IsEnabled:"isEnabled",LastChangeId:"lastChangeId",DriveRootId:"driveRootId"},GCalendar:{IsEnabled:"isEnabled",ImportCalendars:"importCalendars",ExportCalendar:"exportCalendar",WeeksPast:"weeksPast",WeeksFuture:"weeksFuture",DisplayOverdueInAgenda:"displayOverdueInAgenda",SyncNewEvents:"syncNewEvents",SyncDraggedEvents:"syncDraggedEvents",CreateLocalEvents:"createLocalEvents",SyncPopup:"syncPopup"}},PluginLoad:{None:0,Preview:1,Full:2,Runtime:4,Autocomplete:8,Inline:16},PluginDependency:{DemoMode:"DemoMode",PremiumSub:"PremiumSub",EarlyAccess:"EarlyAccess"},PluginRenderTypes:{Generic:0,StyledText:1,UnstyledText:2,Measure:3,RichText:4},Modals:{ReportBug:"reportBug",ImportData:"importData",ExportData:"exportData",ShareDoc:"shareDoc",MobileSettings:"mobileSettings",Settings:"settings",Confirm:"confirm",ConfirmComplex:"confirmComplex",Alert:"alert",Options:"options",Billing:"billing",DeleteAccount:"deleteAccount",EmailPreview:"emailPreview",ReportProblem:"reportProblem",EmailCompose:"emailCompose",EmailReply:"emailReply",Invoices:"invoices",Prompt:"prompt",Lightbox:"lightbox",EnterCode:"enterCode",Backups:"backups",ConfirmEncrypt:"confirmEncrypt",Date:"date",Note:"note",AutocompleteList:"autocompleteList",Contact:"contact",ExternalLink:"ExternalLink",DropBucket:"dropBucket",ModalPane:"modalPane",ModalAccountSettings:"accountSettings",ErrorCookies:"ErrorCookies",CreateTemplate:"CreateTemplate",ItemEditor:"ItemEditor",About:"About",GmailAuth:"GmailAuth",OutlookAuth:"OutlookAuth",CheckEncryption:"CheckEncryption"},DisplayMode:{Default:0,InIframe:1,NoBoards:2,Invisible:4,NoScrollbars:8,NoBackground:16,ShowHelp:64,NoPanePadding:128,NoPaneStyle:256,NoRightClick:512,ShowDemoExit:1024,NoMinPaneSize:2048,FullMin:8191},Checkpoint:{MainRun:1,RequireLoaded:2,PageLoad:4,LocalDocLoad:8,InitData:16,DBLoaded:32,OnInitializedData:64,InitializeMain:128,LoadDefaultFile:256,DocLoadRequested:512,DocLoaded:1024,MaskRequired:2047},PlatformOS:{Unknown:0,iPhone:1,iPad:2,iPod:3,Android:4,Mac:5,Windows:6,Linux:7,ChromeOS:8},PlatformBrowser:{Unknown:0,Electron:1,Mailbird:2,Chrome:3,Firefox:4,Safari:5,IE:6,Edge:7,Opera:8},PlatformConfig:{DesktopWindows:0,DesktopMac:1,DesktopOther:2,ChromeApp:3,AndroidBrowser:4,AndroidApp:5,iOSBrowser:6,iOSApp:7,WinPhoneBrowser:8,WinPhoneApp:9,MobileOther:10,Unknown:11,EmbedDesktopApp:12,EmbedMobileApp:13,ElectronMac:14,ElectronWindows:15,ElectronUnknown:16},AppPlatform:{iOS:0,Android:1,Embed:2,Electron:3},EmbedApps:{Mailbird:"mailbird"},DeployVariable:{Environment:"Environment"},GScope:u,GScopeArray:[u.Calendar,u.CalendarRO,u.Contacts,u.Drive,u.DriveMetadataRO,u.DriveFull,u.DriveReadOnly,u.GmailCompose,u.GmailModify,u.TasksRO,u.UserInfoEmail,u.UserInfoProfile,u.DriveAppData,u.Plus,u.Email,u.Profile,u.DriveInstall,"openid"],ScopesDefault:[u.UserInfoEmail,u.UserInfoProfile],jsVersion:"1631767948879",__devServerURL:"##DEV_SERVER_URL##",__MAX_ERRORS_REPORTED:50,EncryptionSentinel:"MDsentinel",EncryptionKeys:{Global:"Global",UserPassword:"UserPassword"},PMask:l.P1|l.P2|l.P3,PriorityClass:(r={},a()(r,l.None," "),a()(r,l.P1," t-priority1"),a()(r,l.P2," t-priority2"),a()(r,l.P3," t-priority3"),r),OverviewPaddingStart:0,OverviewPaddingIncrement:10,ColorBrand:"#0099dd",DocumentAccessRoles:{Read:0,Write:1,Admin:2},Colors:{Brand:"#0099dd",Red:"#C9302C",Star:"#ffb",Complete:"#d6d6d6",Mobile:{Header:"#f6f6f6"}},SPThresholdRight:42,ItemPaddingRightVirtuoso:36,ItemPaddingRightVirtuosoAgenda:50,PluginPad:8,MinItemWidth:50,ModalMaxWidthPerc:90,ModalMaxHeightPerc:90,RegexpFlags:{WebUrl:1,MDLink:2,Date:4,Markdown:8,HR:16,Email:32,Contact:64,Tag:128,ItemLink:256,Plugin:512,Prefix:1024,FileUrl:2048,MarkdownEscaped:4096,DataImage:8192,ItemMirror:16384,All:32767},MobileItemIndentStart:10,OverviewItemHeightMobile:36,CollapserWidth:36,WidthAgendaTime:70,Markdown:{bold:"**",italic:"*",underline:"__",strike:"~~",highlight:"==",code:"`"},TransitionSpring:{type:"spring",duration:.4,bounce:.21},TransitionSpringDamped:{type:"spring",duration:.3,bounce:.18},TransitionSpring2:{type:"spring",duration:.3,bounce:.21},TransitionSpring3:{type:"spring",duration:.25,bounce:.21},TransitionSpring4:{type:"spring",duration:.2,bounce:.21},TransitionSpring5:{type:"spring",duration:.15,bounce:.21},TransitionSpring6:{type:"spring",duration:.1,bounce:.21},TransitionSpring7:{type:"spring",duration:.05,bounce:.21},TransitionSpringFastestest:{type:"spring",damping:200,stiffness:4e3},TransitionSpringFastest:{type:"spring",damping:56,stiffness:1e3},TransitionSpringFaster:{type:"spring",damping:40,stiffness:600},TransitionSpringFast:{type:"spring",duration:.3,bounce:.21},TransitionSpringMediumer:{type:"spring",damping:30,stiffness:500},TransitionSpringMedium:{type:"spring",damping:25,stiffness:400},TransitionSpringSlow:{type:"spring",damping:20,stiffness:400},TransitionSpringSlower:{type:"spring",damping:15,stiffness:400},TransitionTime:{duration:1},TransitionImmediate:{duration:0},PaddingTopBlockHeader:32,TopBoxHeight:36,TextPaddingLeft:5,SizeReductionInlineCode:2,ListOverscan:300,Mobile:{TopBarHeight:48,BottomBarHeight:48},CharCode:s,Chars:c,ItemClass:"itemInPane itemNew paneItemElement",KeyboardToolbarButtonHeight:36,Tailwind:{SettingsHeader:"text-xs font-bold uppercase c-foreground-very-faded"},CharCodeInvalid:String.fromCharCode(65533),MaxAccounts:{Basic:3,Free:1,Unknown:1},PremiumPlans:{Basic:{month:"frr6",year:"p9m6"},Pro:{month:"gbf2",year:"8c7w"},Legacy:{month:"pmjw",year:"5pm2"}},DriveBackupKey:"Legend_backup"}},3656:(e,t,n)=>{"use strict";n.d(t,{Z:()=>P});var r=n(8926),i=n.n(r),a=n(4575),o=n.n(a),s=n(3913),c=n.n(s),l=n(3124),u=n.n(l),d=n(7757),h=n.n(d),p=n(1186),f=n(8572),g=n(8855),m=n(6744),v=n(8651),y=n(4654),k=n(5193),_=n(9148),Z=/^(?:\+?1[-. ]?)?(?:\(?([0-9]{3})\)?[-. ]?)?([0-9]{3})[-. ]?([0-9]{4})$/;const w=function(){function e(t){var n=0,r=0;o()(this,e);try{v.Z.PAssert(241,v.Z.isObject(t),"Should always supply a valid object to init a contact")}catch(c){v.Z.reportError(c)}this.id=t.id,this.type="contact",this.text=t.text||"",this.phoneNumbers=t.phoneNumbers||[],this.emails=t.emails||[];for(var i=0;i<this.phoneNumbers.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this.phoneNumbers[i];a.link=this.formatPhone(a.number),a.type=a.type?a.type[0].toLowerCase():""}for(var s=0;s<this.emails.length;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this.emails[s].link="mailto:"+this.emails[s].address}}return c()(e,[{key:"formatPhone",value:function(e){if(Z.test(e)){var t=e.match(Z),n="";return t[1]&&(n+="+1-"+t[1]+"-"),"tel:"+(n+=t[2]+"-"+t[3])}var r=e.replace(/\D+/g,"");try{v.Z.PAssert(242,r&&""!==r,"Invalid phone number format: "+e)}catch(i){v.Z.reportError(i)}return e.startsWith("+")&&(r="+"+r),"tel:"+r}}]),e}();var b;const P=new(b=function(){function e(){o()(this,e),this._contactCache={},this._contacts=new _.Z,this._contactsByID={},this._contactsByName={},this.areContactsLoaded=!1}return c()(e,[{key:"init",value:function(){var e=this;y.default.settings.syncAccounts.listen((function(){return e.refreshContacts()}))}},{key:"loadContacts",value:function(e){if(!this.areContactsLoaded){var t=e||m.Z.getContacts();try{v.Z.PAssert(91,0===this._contacts.get().length,"Should only load contacts once")}catch(o){v.Z.reportError(o)}if(this.areContactsLoaded=!0,t){for(var n=0,r=[],i=0;i<t.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=t[i];a.name&&(a.text=a.name,t[i].text=a.name,delete t[i].name),a.text&&(this._contactsByName[v.Z.escape(a.text)]=a,r.push(a));try{v.Z.PAssert(92,a.id,"Each contact must have a valid id")}catch(o){v.Z.reportError(o)}}this._contacts.set(r)}else this.clearContacts()}}},{key:"updateContact",value:function(e){try{v.Z.PAssert(93,e.id,"Incoming contacts must have a valid id")}catch(i){v.Z.reportError(i)}try{v.Z.PAssert(94,e.text,"All contacts are expected to have a text")}catch(i){v.Z.reportError(i)}var t,n=v.Z.escape(e.text),r=this._contactsByName[n];return e.emails&&e.emails.length&&(e.emails.forEach((function(e){return e.address=e.address.toLowerCase()})),e.emails=v.Z.arrayUniques(e.emails,"address")),r?(e.emails&&!v.Z.deepEqual(e.emails,r.emails)&&(r.emails=v.Z.arrayUnionByKey(r.emails||[],e.emails,"address"),t=!0),e.phoneNumbers&&!v.Z.deepEqual(e.phoneNumbers,r.phoneNumbers)&&(r.phoneNumbers=v.Z.arrayUnionByKey(r.phoneNumbers||[],e.phoneNumbers,"number"),t=!0)):(this._contacts.push(e),e.text&&(this._contactsByName[n]=e),t=!0),this._contactCache[e.id]&&(this._contactCache[e.id]=new w(e)),t}},{key:"clearContacts",value:function(){this._contactCache={},this._contacts.clear(),this._contactsByName={}}},{key:"numContacts",value:function(){return this._contacts.get().length}},{key:"getContacts",value:function(){return this._contactsByName}},{key:"getAll",value:function(){return this._contacts.get()}},{key:"contactComparator",value:function(e,t){return e.text&&t.text?e.text.localeCompare(t.text):e.text&&!t.text?1:!e.text&&t.text?-1:void 0}},{key:"getRNList",value:function(e){var t=[];return this.findMatchLike(e,{}).forEach((function(e){var n=e.text.split(" "),r=n.map((function(e){return e[0]})).slice(0,Math.min(2,n.length)).join(""),i=e.emails;t.push({text:e.text,iconText:r,subText:i.length?i[0].address:void 0})})),t.sort(this.contactComparator),t}},{key:"emailComparator",value:function(e,t){return e.address.toLowerCase()===t.address.toLowerCase()}},{key:"emailComparatorSort",value:function(e,t){return e.address&&t.address?e.address.toLowerCase().localeCompare(t.address.toLowerCase()):e.address&&!t.address?1:!e.address&&t.address?-1:void 0}},{key:"phoneComparator",value:function(e,t){return e===t||e.number===t.number}},{key:"ensureCacheObject",value:function(e){try{v.Z.PAssert(95,e,"Must have valid data to store in cache")}catch(n){v.Z.reportError(n)}if(this._contactCache[e.id])return this._contactCache[e.id];var t=new w(e);return this._contactCache[e.id]=t,t}},{key:"findMatchExact",value:function(e){var t=this._contactsByName[v.Z.escape(e)];if(t)return this.ensureCacheObject(t)}},{key:"findMatchLike",value:function(e,t){var n=0,r=t.max;try{v.Z.PAssert(96,void 0!==e,"Must provide a valid contact part")}catch(p){v.Z.reportError(p)}for(var i=e.toUpperCase(),a=[],o=this._contacts.get(),s=0;s<o.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var c=o[s],l=!1;if(c.text.toUpperCase().indexOf(i)>=0&&(l=!0),!l&&c.emails)for(var u=0,d=0;!l&&d<c.emails.length;++d){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(c.emails[d].address.toUpperCase().indexOf(i)>=0){l=!0;break}}if(!l&&c.phoneNumbers){var h=0;for(d=0;!l&&d<c.phoneNumbers.length;++d){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(c.phoneNumbers[d].number.indexOf(i)>=0){l=!0;break}}}if(l&&(a.push(this.ensureCacheObject(c)),a.length>=r))break}return a.sort(this.contactComparator),a}},{key:"findContactByEmail",value:function(e){for(var t=0,n=0;n<this._contacts.get().length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._contacts.get()[n];if(r.emails)for(var i=0,a=0;a<r.emails.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(r.emails[a].address===e)return r}}}},{key:"findEmailsLike",value:function(e,t){var n=0;try{v.Z.PAssert(97,void 0!==e,"Must provide a valid email part")}catch(d){v.Z.reportError(d)}t=t||20;for(var r=[],i=e.toUpperCase(),a=0;a<this._contacts.get().length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=this._contacts.get()[a];if(o&&o.emails){var s=0,c=!1;o.text&&o.text.toUpperCase().indexOf(i)>=0&&(c=!0);for(var l=0;l<o.emails.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var u=o.emails[l].address;(c||u.toUpperCase().indexOf(i)>=0)&&r.push({id:o.id,type:"contact",text:o.text,email:u})}}if(r.length>=t)break}return r.sort(this.emailComparatorSort),r}},{key:"save",value:function(e){m.Z.saveContacts(this._contacts.get(),e)}},{key:"handleRemoteContactLoad",value:function(e,t){for(var n=0,r=(this.numContacts(),[]),i=0;i<e.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=e[i],o={id:a.resourceName.replace("people/",""),accountID:t,text:""};if(a.names&&a.names.length>0){var s=a.names[0].displayName;o.text=s,"'"===o.text[0]&&(o.text=o.text.substr(1))}if(!o.text&&a.organizations){for(var c=0,l=0;l<a.organizations.length;l++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var u=a.organizations[l];u.metadata&&u.metadata.primary&&(o.text=u.name)}o.text||(o.text=a.organizations[0].name)}if(a.emailAddresses){var d=0;o.emails=[];for(var h=0;h<a.emailAddresses.length;h++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var p=a.emailAddresses[h],f=p.metadata&&p.metadata.primary,m={address:p.value};f&&(m.isPrimary=f),p.type&&(m.type=p.type),o.emails.push(m),!o.text&&m.isPrimary&&(o.text=m.address)}!o.text&&o.emails.length>0&&(o.text=o.emails[0].address)}if(a.phoneNumbers){var y=0;o.phoneNumbers=[];for(var k=0;k<a.phoneNumbers.length;k++){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;var _=a.phoneNumbers[k],Z=_.metadata&&_.metadata.primary,w={number:_.value};Z&&(w.isPrimary=Z),_.type&&(w.type=_.type),o.phoneNumbers.push(w)}}o.text?this.updateContact(o)&&r.indexOfWithProperty("id",o.id)<0&&r.push(o):v.Z.shouldLog(g.Z.LogLevels.Data)&&v.Z.log("Contact entry with no name or email address",a)}return r.length&&this.save(r),r}},{key:"syncContactInfo",value:function(){var e=i()(h().mark((function e(t){var n=this;return h().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){p.Z.getAccountAuthToken(t,[g.Z.GScope.Contacts],(function(r){var a,o=[],s=r&&r.access_token,c=function(){var r=i()(h().mark((function r(i){var s,c;return h().wrap((function(r){for(var l=0,u=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(r.prev=r.next){case 0:return r.next=2,i.json();case 2:if((s=r.sent)&&s.connections){try{v.Z.PAssert(98,v.Z.isArray(s.connections),"Connections are not array")}catch(d){v.Z.reportError(d)}v.Z.isArray(s.connections)&&o.pushArray(s.connections),s.nextPageToken?a(s.nextPageToken):(c=n.handleRemoteContactLoad(o,t),e(c))}case 4:case"end":return r.stop()}}}),r)})));return function(e){return r.apply(this,arguments)}}();a=function(){var e=i()(h().mark((function e(t){var n,r;return h().wrap((function(e){for(var i=0,a=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return n="https://people.googleapis.com/v1/people/me/connections?personFields=names,emailAddresses,phoneNumbers,organizations&access_token=".concat(s)+(t?"&pageToken=".concat(t):""),e.next=3,v.Z.XHR({type:"GET",url:n});case 3:r=e.sent,c(r);case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}(),s&&a()}))})));case 1:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isEnabled",value:function(){return this.getSyncAccounts().length>0}},{key:"getSyncAccounts",value:function(){var e=y.default.settings.syncAccounts.get();return Object.keys(e).filter((function(t){return!!e[t][g.Z.PluginID.Contacts]}))}},{key:"refreshContacts",value:function(e){var t=this;p.Z.onLoaded(i()(h().mark((function n(){var r,i,a;return h().wrap((function(n){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(n.prev=n.next){case 0:if(!((r=t.getSyncAccounts()).length>0)){n.next=10;break}return n.next=4,Promise.all(r.map(t.syncContactInfo));case 4:i=n.sent,(a=i.flat()).length>0&&(y.default.PaneUpdateBatcher.beginUpdateItems(),k.Z.parseAll(g.Z.ChangeType.Auto),y.default.PaneUpdateBatcher.updateAllItems(!1,!0),y.default.PaneUpdateBatcher.commitUpdateItems()),e&&e(a),n.next=11;break;case 10:e&&e([]);case 11:case"end":return n.stop()}}}),n)}))))}}]),e}(),u()(b.prototype,"getRNList",[f.ZP],Object.getOwnPropertyDescriptor(b.prototype,"getRNList"),b.prototype),u()(b.prototype,"syncContactInfo",[f.ZP],Object.getOwnPropertyDescriptor(b.prototype,"syncContactInfo"),b.prototype),u()(b.prototype,"refreshContacts",[f.ZP],Object.getOwnPropertyDescriptor(b.prototype,"refreshContacts"),b.prototype),b)},5193:(e,t,n)=>{"use strict";n.d(t,{Z:()=>W});var r,i=n(8926),a=n.n(i),o=n(4575),s=n.n(o),c=n(3913),l=n.n(c),u=n(3124),d=n.n(u),h=n(7757),p=n.n(h),f=n(7411),g=n(8572),m=n(5441),v=n(2205),y=n.n(v),k=n(8585),_=n.n(k),Z=n(9754),w=n.n(Z),b=n(8855),P=n(8651),S=n(4654),D=n(7733),I=n(5340),E=n(4327),x=n(9352),C=n(3761);function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=w()(e);if(t){var i=w()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return _()(this,n)}}const L=new(r=function(e){y()(n,e);var t=A(n);function n(){var e;return s()(this,n),(e=t.call(this,!0)).dataCache={},e.dirtyDocs={},E.Z.listen("onUnload",e.writeDocuments),e}return l()(n,[{key:"init",value:function(){var e=a()(p().mark((function e(t,n){var r,i=this;return p().wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:this.cbOnDocumentsChanged=n,r=window.___electronAllDocs,S.default.ElectronBridge.listenToDocChanges(this.onFileChanged),S.default.crypto.onLoad((function(){S.default.crypto.onUpdated.listen(i.reload);var e=function(){var e=a()(p().mark((function e(n){var r;return p().wrap((function(e){for(var o=0,s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!n){e.next=7;break}return e.next=3,Promise.all(n.map(function(){var e=a()(p().mark((function e(t){var n;return p().wrap((function(e){for(var r=0,a=0,o=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,i.parseJSON(t);case 2:if(!(n=e.sent)){e.next=6;break}return n.items&&n.items.forEach((function(e){i.dataCache[e.id]=e})),e.abrupt("return",i.createDoc(n,n.id));case 6:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:r=e.sent.filter((function(e){return void 0!==e})),t(r),e.next=8;break;case 7:t([]);case 8:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}();r?r.value?e(r.value):(S.default.toasts.pushMessage({text:"Error loading local files. Please check that the directory is correct in the settings.",actionText:"SETTINGS",action:function(){return S.default.menus.openSettings("Desktop")},hold:!0}),t([])):S.default.ElectronBridge.getAllDocs(e)}));case 4:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createDoc",value:function(e,t){if(!W.getDocumentById(e.id)){var n=x.Z.create(e);return n.createVMLIs(),this.documents[n.id]=n,n}S.default.toasts.pushMessage("Detected duplicate document data in local document:<br/>".concat(t,".json"))}},{key:"parseJSON",value:function(){var e=a()(p().mark((function e(t){var n;return p().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,n=JSON.parse(t),e.abrupt("return",this.parseJSONObject(n));case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"parseJSONObject",value:function(){var e=a()(p().mark((function e(t){var n;return p().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(e.prev=0,!(t.moodoVer&&t.doc&&t.doc.root&&t.doc.id)){e.next=10;break}return e.next=4,C.Z.parseJSON(t);case 4:if(!(n=e.sent)){e.next=9;break}return n.id=t.doc.id,n.backing=this,e.abrupt("return",n);case 9:console.log("No data for",t);case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(0);case 14:case"end":return e.stop()}}}),e,this,[[0,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"reload",value:function(){var e=this,t={};Object.keys(this.documents).forEach((function(e){return t[e]=!0})),S.default.ElectronBridge.getAllDocs(function(){var n=a()(p().mark((function n(r,i){return p().wrap((function(n){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(n.prev=n.next){case 0:return i=i||[],n.next=3,Promise.all(i.map(function(){var n=a()(p().mark((function n(r){var i,a;return p().wrap((function(n){for(var o=0,s=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(n.prev=n.next){case 0:return n.prev=0,i=JSON.parse(r),n.next=4,e.onFileChanged(b.Z.CrudActions.Modified,i);case 4:(a=n.sent)&&delete t[a.id],n.next=10;break;case 8:n.prev=8,n.t0=n.catch(0);case 10:case"end":return n.stop()}}}),n,null,[[0,8]])})));return function(e){return n.apply(this,arguments)}}()));case 3:Object.keys(t).forEach((function(t){return e.onFileChanged(b.Z.CrudActions.Removed,t)})),e.cbOnDocumentsChanged({documents:e.documents,documentsEncrypted:{},documentsDeleted:{}});case 5:case"end":return n.stop()}}}),n)})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"onFileChanged",value:function(){var e=a()(p().mark((function e(t,n){var r,i,a,o,s,c=this;return p().wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:if(t!==b.Z.CrudActions.Removed||"string"!==typeof n){e.next=6;break}r=n,(i=this.documents[r])&&(i.delete(!0),delete this.documents[r]),e.next=14;break;case 6:return e.next=8,this.parseJSONObject(n);case 8:if(!(a=e.sent)){e.next=14;break}return(o=this.documents[a.id])?(s=a.items,o.text.set(a.text),this.checkFileItems(o,s)):(o=this.createDoc(a,n.id),this.cbOnDocumentsChanged({documents:this.documents,documentsEncrypted:{},documentsDeleted:{}})),o&&a.items&&a.items.forEach((function(e){c.dataCache[e.id]=e})),e.abrupt("return",o);case 14:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkFileItems",value:function(e,t){var n=0,r=this,i={};e.getAllItems().forEach((function(e){return i[e.id]=!0}));for(var a=function(a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=t[a];if(!o.isRoot){var s=r.getItemData(t[a].id),c=!1,l={id:o.id};s?Object.keys(o).forEach((function(e){s[e]!==o[e]&&("id"!==e&&(c=!0),l[e]=o[e])})):(l=o,c=!0),c&&I.Z.onRemoteChange(e,s,o.id,l)}delete i[o.id]},o=0;o<t.length;o++)a(o);Object.keys(i).forEach((function(t){var n=r.getItemData(t),i={id:t,isDeleted:!0};I.Z.onRemoteChange(e,n,t,i)}))}},{key:"writeDocuments",value:function(){var e=this;Object.keys(this.dirtyDocs).forEach((function(t){var n=e.dirtyDocs[t];delete e.dirtyDocs[t],n.toJSON({exportArchived:!0,includeNotes:!0,encrypt:S.default.settings.encryptLocalFiles.get()}).then((function(e){S.default.ElectronBridge.saveDoc("".concat(n.id,".json"),e,(function(e){e&&(console.log(e),S.default.toasts.pushMessage("Error saving ".concat(n.text.get(),". Please check that the destination file is writeable.")))}))}))}))}},{key:"setDocNeedsWrite",value:function(e){this.dirtyDocs[e.id]=e,clearTimeout(this.timeoutWrite),this.timeoutWrite=setTimeout(this.writeDocuments,1e3)}},{key:"getItemData",value:function(e){return this.dataCache[e]}},{key:"saveItem",value:function(e,t,n,r,i){var a=new Date;t.dateModified=a,this.dataCache[t.id]=t.getFullSaveData(),P.Z.isLocalChange(r)&&!P.Z.isUndoRedoChange(r)&&this.setDocNeedsWrite(e)}},{key:"deleteItem",value:function(e,t,n){delete this.dataCache[t.id],P.Z.isLocalChange(n)&&!P.Z.isUndoRedoChange(n)&&this.setDocNeedsWrite(e)}},{key:"addItem",value:function(e,t){var n=this;t.forEachChildRecursive((function(t){n.saveItem(e,t,void 0,b.Z.ChangeType.Local,b.Z.SaveFlag.Prop)}),!0,!0)}},{key:"moveItem",value:function(e,t){var n=this,r=e.getDocumentOwner(),i=t.getDocumentOwner();r===i?this.saveItem(e.getDocumentOwner(),e,void 0,b.Z.ChangeType.Local,b.Z.SaveFlag.Prop):(e.forEachChildRecursive((function(e){n.saveItem(r,e,void 0,b.Z.ChangeType.Local,b.Z.SaveFlag.Prop)}),!0,!0),this.setDocNeedsWrite(i))}},{key:"moveItemDocument",value:function(e,t){this.saveItem(e.getDocumentOwner(),e,void 0,b.Z.ChangeType.Local,b.Z.SaveFlag.Prop);var n=W.getDocumentById(t);t&&this.setDocNeedsWrite(n)}},{key:"setNote",value:function(e,t,n,r,i){this.saveItem(e,t,void 0,b.Z.ChangeType.Local,b.Z.SaveFlag.Prop),n&&this.saveItem(e,n,void 0,b.Z.ChangeType.Local,b.Z.SaveFlag.Prop)}},{key:"addDocument",value:function(){var e=a()(p().mark((function e(t){var n;return p().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:n=t.getRootItem(),this.documents[t.id]=t,this.saveItem(t,n,void 0,b.Z.ChangeType.Local,b.Z.SaveFlag.Prop);case 3:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"saveDocument",value:function(e){this.setDocNeedsWrite(e)}},{key:"deleteDocument",value:function(e,t){S.default.ElectronBridge.deleteDoc("".concat(e.id,".json"))}},{key:"undeleteDocument",value:function(e,t){}},{key:"renameDocument",value:function(e,t){this.setDocNeedsWrite(e)}},{key:"unlistenDocument",value:function(e){}},{key:"getSetting",value:function(e){return""}},{key:"setSetting",value:function(e,t){0}},{key:"saveBoard",value:function(e){0}},{key:"deleteBoard",value:function(e){0}},{key:"getBoards",value:function(){return[]}},{key:"clearAllData",value:function(){return Promise.resolve()}},{key:"generateId",value:function(){return P.Z.generateTempId()}},{key:"numDocuments",value:function(){return Object.keys(this.documents).length}}]),n}(D.K),d()(r.prototype,"reload",[g.ZP],Object.getOwnPropertyDescriptor(r.prototype,"reload"),r.prototype),d()(r.prototype,"onFileChanged",[g.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onFileChanged"),r.prototype),d()(r.prototype,"writeDocuments",[g.ZP],Object.getOwnPropertyDescriptor(r.prototype,"writeDocuments"),r.prototype),r);var M,T=n(6744),R=n(7100),O=n(1015),F=n(5986),N=n(3017),B=n(7978),U=n(7274),j=n(9148),H=n(170),V=n(9105);const W=new(M=function(){function e(){s()(this,e),this.isLoaded=new U.Z(!1),this._isRemoteEnabled=!P.Z.isDemoMode(),this._documentsById={},this._itemCache={},this.tempItemData={},this.documentsArray=new j.Z,this.documentsEncryptedArray=new j.Z,this.documentsDeletedArray=new j.Z,this._sources=[],this.settingProvider=P.Z.isDemoMode()?m.Z:B.Z,this._idProvider=this.settingProvider.generateId,this.loadState=B.Z.loadState,this.onlineStatus=new U.Z(f.Z.isOnline()?"Connecting":"Offline"),this.isLoadedLocal=new U.Z(!1),this.isLoadedRemote=new U.Z(!1),this.loadProgress=new U.Z,P.Z.isDemoMode()?this._sources=[m.Z]:(this._sources.push(B.Z),R.Z.supportLocalFiles()&&this._sources.push(L))}return l()(e,[{key:"init",value:function(){this._emptyDocument=this.createEmptyDocument("Empty",m.Z),window.__clearLocalData=this.clearLocalData}},{key:"loadLocal",value:function(e){var t=this;this._cbOnLoad=e,this._sourcesWaiting=this._sources.length,this._sources.forEach((function(e){return e.init(t.onSourceLoaded,t.onSourceDocumentsChanged)})),this._isRemoteEnabled&&F.Z.init(),P.Z.registerEvent("ItemCreated","ItemAction","Create"),P.Z.registerEvent("ItemCompleted","ItemAction","Complete"),this.isLoadedLocal.set(!0)}},{key:"__mockonSourceLoaded",value:function(e){this.onSourceLoaded(e)}},{key:"onSourceLoaded",value:function(e){var t=this;S.default.crypto.onLoad((function(){if(t._sourcesWaiting--,e.forEach((function(e){e.canDecrypt()&&(t._documentsById[e.id]=e,t.documentsArray.includes(e)||t.documentsArray.push(e,!1))})),0===t._sourcesWaiting){var n=t.documentsArray.get().filter((function(e){return void 0===e.index}));n.length>0&&((n=n.sort((function(e,t){return t.getDateModified()-e.getDateModified()}))).forEach((function(e,t){return e.setIndex(t+"")})),t.documentsArray.set(n,!1)),t.documentsArray.sort(V.Z.compareItemIndex),void 0!==S.default.settings.lastSync.get()&&S.default.PaneManager.loadInitialState(),t.isLoaded.set(!0),setTimeout((function(){return S.default.timeline.updateNotifications()}),1e3),t._cbOnLoad&&t._cbOnLoad(e)}}))}},{key:"onSourceDocumentsChanged",value:function(e){var t=this,n=e.documents,r=e.documentsEncrypted,i=e.documentsDeleted,a=this.documentsArray.get();Object.keys(n).forEach((function(e){var r=n[e];t._documentsById[r.id]&&a.includes(r)?r.canDecrypt()||a.remove(r):r.canDecrypt()&&(t._documentsById[r.id]=r,a.push(r))})),(a=a.filter((function(e){return e.canDecrypt()}))).sort(V.Z.compareItemIndex),this.documentsArray.set(a),r&&this.documentsEncryptedArray.set(P.Z.objectToArray(r)),i&&this.documentsDeletedArray.set(P.Z.objectToArray(i)),this.isLoadedRemote.set(!0)}},{key:"getDefaultBacking",value:function(){return this._sources[0]}},{key:"getDocumentById",value:function(e){return this._documentsById[e]}},{key:"getDefaultDocument",value:function(){var e=this.documentsArray.get().find((function(e){return!e.isDeleted.get()}));return e||this.addEmptyDocument("My First Document",this.getDefaultBacking())}},{key:"getDocumentsArray",value:function(e){var t=this.documentsArray.get();return e||(t=t.filter((function(e){return!e.isDeleted.get()}))),t}},{key:"getDeletedDocuments",value:function(){return this.documentsArray.get().filter((function(e){return e.isDeleted.get()}))}},{key:"hasDocuments",value:function(){return this.getDocumentsArray().length>0}},{key:"runOnAllDocuments",value:function(e){this.getDocumentsArray().forEach((function(t){return e(t)}))}},{key:"parseAll",value:function(e){this.runOnAllDocuments((function(t){t.parseAll(e)}))}},{key:"runOnAllDocumentRoots",value:function(e){this.getDocumentsArray().forEach((function(t){return e(t.getRootItem())}))}},{key:"getItemDataLocal",value:function(e,t){return e?e.getBacking().getItemData(t):this.tempItemData[t]}},{key:"addTempItemData",value:function(e){this.tempItemData[e.id]=e}},{key:"removeTempItemData",value:function(e){delete this.tempItemData[e.id]}},{key:"getDocumentBacking",value:function(e){return e.getBacking()}},{key:"getItemBacking",value:function(e){var t=e.getDocumentOwner();try{P.Z.PAssert(79,t,"Item document must exist")}catch(n){P.Z.reportError(n)}return t.getBacking()}},{key:"_getPreviousState",value:function(e,t){try{P.Z.PAssert(80,e.getDocumentOwner(),"Missing document owner",e.getRawText())}catch(i){P.Z.reportError(i)}var n=e.getDocumentOwner().getBacking().getItemData(e.id),r={};return n&&Object.keys(t).forEach((function(e){r[e]=n[e]})),r}},{key:"saveItem",value:function(e,t,n,r,i){var a=e.parent()||e.isRoot;try{P.Z.PAssert(81,a,"Item must have parent unless root")}catch(s){P.Z.reportError(s)}if(a&&(e.index||e.isNote()||(this.updateItemIndex(e),t.index=e.index),t.id=e.id,P.Z.isLocalChange(n)&&O.Z.pushModified(e,t,this._getPreviousState(e,t)),e.shouldSave())){var o=e.getDocumentOwner();o.getBacking().saveItem(o,e,P.Z.clone(t),n,r),P.Z.isDemoMode()||F.Z.onDataSaved(o)}}},{key:"updateItemIndex",value:function(e){var t=e.parent();if(!e.isNote())if(t&&t.items.length()>1){var n=t.items.get(),r=n.indexOf(e),i=!e.isNote()&&r>0?n[r-1]:null,a=!e.isNote()&&r<n.length-1?n[r+1]:null;0,e.index=(0,H.b)(i?i.index:null,a?a.index:null)}else e.index="0"}},{key:"addItem",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!r){this.updateItemIndex(t),O.Z.pushAdded(e,t);var i=t.getDocumentOwner();i.getBacking().addItem(i,t)}}},{key:"deleteItem",value:function(e,t,n){if(P.Z.isLocalChange(n)){O.Z.pushRemoved(e,t);var r=t.getDocumentOwner();r.getBacking().deleteItem(r,t,n)}}},{key:"moveItem",value:function(e,t,n,r){if(this.updateItemIndex(e),P.Z.isLocalChange(r)){var i=e.getDocumentOwner(),a={parent:e.parent().id,index:e.index},o={parent:t.id,index:n};O.Z.pushModified(e,a,o),i.getBacking().moveItem(e,t)}}},{key:"moveItemDocument",value:function(e,t,n){P.Z.isLocalChange(n)&&e.getDocumentOwner().getBacking().moveItemDocument(e,t)}},{key:"setNote",value:function(e,t,n,r){var i=e.getDocumentOwner();i.getBacking().setNote(i,e,t,n,r)}},{key:"generateID",value:function(){return this._idProvider()}},{key:"getEmptyDocument",value:function(){return this._emptyDocument}},{key:"addDocument",value:function(e){e.createVMLIs();var t=e.getBacking().addDocument(e);this._documentsById[e.id]=e;var n=this.documentsArray.get()[0];if(n){var r=(0,H.b)(null,n.index);e.setIndex(r)}else e.setIndex("0");return this.documentsArray.splice(0,0,e,!1),t}},{key:"createEmptyDocument",value:function(e,t){t=t||this.getDefaultBacking();var n={id:this.generateID(),isRoot:!0,text:"Root",items:[{id:this.generateID(),text:""}]},r=x.Z.create({text:e,rootData:n,backing:t});return r.createVMLIs(),r}},{key:"addEmptyDocument",value:function(e,t){var n=this.createEmptyDocument(e,t);return this.addDocument(n),n}},{key:"saveDocument",value:function(e){e.getBacking().saveDocument(e)}},{key:"renameDocument",value:function(e,t){e.setText(t),this.saveDocument(e)}},{key:"removeDocument",value:function(e){this.documentsArray.remove(e)}},{key:"moveDocument",value:function(e,t){var n=this.documentsArray.get(),r=n.map((function(e){return e.id})),i=n.indexOf(e);P.Z.arrayMove(n,t,i);var a=n.map((function(e){return e.id}));if(!r.equals(a)){var o=this.documentsArray.get(),s=n.indexOf(e),c=s>=1&&o[s-1],l=s<o.length-1&&o[s+1],u=(0,H.b)(null===c||void 0===c?void 0:c.index,null===l||void 0===l?void 0:l.index);e.setIndex(u),this.documentsArray.notify()}}},{key:"setSetting",value:function(e,t,n,r){n?this.settingProvider.setSetting(e,t,r):T.Z.setSetting(e,{v:t})}},{key:"saveBoard",value:function(e,t){this.settingProvider.saveBoard(e,t)}},{key:"deleteBoard",value:function(e){return this.settingProvider.deleteBoard(e)}},{key:"getBoards",value:function(){return this.settingProvider.getBoards()}},{key:"setItem",value:function(e){this._itemCache[e.id]=e}},{key:"getItem",value:function(e){return this._itemCache[e]}},{key:"clearItem",value:function(e){delete this._itemCache[e]}},{key:"createVMLI",value:function(e,t){return S.default.itemStoreManager.getDefaultItemStore().createItemRaw(e,t)}},{key:"createTempVMLI",value:function(e,t){return t.noSave=!0,t.canDestroy=!0,t.isTemp=!0,e.id||(e.id=this.generateID()),S.default.itemStoreManager.getTempItemStore().createItemRaw(e,t)}},{key:"destroyTempVMLI",value:function(e){S.default.itemStoreManager.getTempItemStore().destroyItem(e)}},{key:"clearLocalData",value:function(){var e=a()(p().mark((function e(){return p().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return N.Z.clear(),e.next=3,T.Z.clearAllData();case 3:setTimeout((function(){P.Z.reload()}),0);case 4:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"hasPendingRemoteUpdates",value:function(){return Object.keys(B.Z.itemsPending).length>0}},{key:"isConnected",value:function(){return"Online"===this.onlineStatus.get()}},{key:"onConnectedPromise",value:function(){var e=a()(p().mark((function e(){var t=this;return p().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.isConnected()?Promise.resolve():new Promise((function(e){t.onlineStatus.onValue("Online",(function(){return e()}))})));case 1:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"__clearAllData",value:function(){confirm("Are you sure you want to clear everything?")&&(N.Z.clear(),Promise.all(this._sources.map((function(e){return e.clearAllData()}))).then((function(){P.Z.reload()})))}},{key:"getBackingRemote",value:function(){return P.Z.isDemoMode()?m.Z:B.Z}},{key:"getBackingLocal",value:function(){return R.Z.supportLocalFiles()?L:void 0}},{key:"onlineText",value:function(){var e=this.onlineStatus.get();return P.Z.isDemoMode()?"DEMO":e}},{key:"setLoadProgress",value:function(e){this.loadProgress.set(e)}}]),e}(),d()(M.prototype,"onSourceLoaded",[g.ZP],Object.getOwnPropertyDescriptor(M.prototype,"onSourceLoaded"),M.prototype),d()(M.prototype,"onSourceDocumentsChanged",[g.ZP],Object.getOwnPropertyDescriptor(M.prototype,"onSourceDocumentsChanged"),M.prototype),d()(M.prototype,"clearLocalData",[g.ZP],Object.getOwnPropertyDescriptor(M.prototype,"clearLocalData"),M.prototype),d()(M.prototype,"__clearAllData",[g.ZP],Object.getOwnPropertyDescriptor(M.prototype,"__clearAllData"),M.prototype),M)},7733:(e,t,n)=>{"use strict";n.d(t,{K:()=>f,n:()=>g});var r=n(2205),i=n.n(r),a=n(8585),o=n.n(a),s=n(9754),c=n.n(s),l=n(4575),u=n.n(l),d=n(3913),h=n.n(d);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=c()(e);if(t){var i=c()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return o()(this,n)}}var f=function(){function e(t){u()(this,e),this.isLocalOnly=t,this.documents={}}return h()(e,[{key:"renameDocument",value:function(e,t){}},{key:"deleteDocAPIItems",value:function(e,t){}}]),e}(),g=function(e){i()(n,e);var t=p(n);function n(){return u()(this,n),t.apply(this,arguments)}return n}(f)},7978:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Te});var r,i,a=n(3038),o=n.n(a),s=n(8926),c=n.n(s),l=n(4575),u=n.n(l),d=n(3913),h=n.n(d),p=n(2205),f=n.n(p),g=n(8585),m=n.n(g),v=n(9754),y=n.n(v),k=n(3124),_=n.n(k),Z=n(7757),w=n.n(Z),b=n(7411),P=n(1186),S=n(8572),D=n(8855),I=n(6744),E=n(9514),x=n(8651),C=n(4654),A=n(5252),L=n(3017),M=n(461),T=n(5193),R=n(7733),O=n(5340),F=n(6374),N=n(9105),B=n(9352),U=n(7274),j=n(8),H=n.n(j),V=!1,W=(r=function(){function e(t,n,r){u()(this,e),this.session=E.Z.database(),this.path=t,this.ref=this.session.ref(t),n&&(this.ref=this.ref.orderByChild("d").startAt(n)),this.cbOnUpdate=r,this._batch={},this.updatesSent={},this.readyToResolve={},this.reqNum=0,this.setupHandlers()}return h()(e,[{key:"onUpdate",value:function(e){this.cbOnUpdate=e}},{key:"dispose",value:function(){this.ref.off()}},{key:"update",value:function(){var e=c()(w().mark((function e(t,n){return w().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.createPromise(t,n,!1));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=c()(w().mark((function e(t,n){return w().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.createPromise(t,n,!0));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createPromise",value:function(){var e=c()(w().mark((function e(t,n,r){var i=this;return w().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var a;i._batch[t]={resolve:e,id:t,item:Object.assign((null===(a=i._batch[t])||void 0===a?void 0:a.item)||{},n),remove:r},x.Z.timeoutOnce("FirebaseRefUpdate_"+i.path,i._runUpdates,200)})));case 1:case"end":return e.stop()}}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"setupHandlers",value:function(){var e=this;this.ref.on("value",(function(t){e.isLoaded||(e.isLoaded=!0,e.cbOnUpdate("load",t))})),this.ref.on("child_added",(function(t){e.checkSnapshot("Added",t)})),this.ref.on("child_changed",(function(t){e.checkSnapshot("Modified",t)})),this.ref.on("child_removed",(function(t){e.checkSnapshot("Removed",t)}))}},{key:"checkSnapshot",value:function(e,t){if(this.isLoaded&&!this._isSendingUpdate){var n=t.val();this.resolveIfSent(e,t.key,n)||this.cbOnUpdate(e,t)}}},{key:"_runUpdates",value:function(){var e=c()(w().mark((function e(){var t,n,r,i=this;return w().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,t={},this._isSendingUpdate=!0,n=this._batch,Object.values(this._batch).forEach((function(e){var n=e.id,r=e.item,a=e.remove,o=e.resolve;a?t[i.path+"/"+n]=null:Object.assign(t,i._getUpdateVals(n,r)),i.setSent(a?D.Z.CrudActions.Removed:D.Z.CrudActions.Modified,n,r,o)})),this._batch={},r=this.session.ref().update(t),this._isSendingUpdate=!1,e.next=11,r;case 11:V,Object.values(n).forEach((function(e){var t=e.id;e.item,e.resolve;i.resolveIfBothReady({id:t,sent:!0})})),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(0),this._isSendingUpdate=!1,x.Z.reportError(e.t0);case 19:case"end":return e.stop()}}}),e,this,[[0,15]])})));return function(){return e.apply(this,arguments)}}()},{key:"_getUpdateVals",value:function(e,t){var n=this,r={};return Object.keys(t).forEach((function(i){"id"!==i&&(r["".concat(n.path,"/").concat(e,"/").concat(i)]=t[i])})),r}},{key:"setSent",value:function(e,t,n,r){var i=this.reqNum++;return this.updatesSent[t]||(this.updatesSent[t]={}),this.updatesSent[t][i]={type:e,value:n,resolve:r},i}},{key:"resolveIfSent",value:function(e,t,n,r){var i=this,a=this.updatesSent[t];if(a)for(var o=0,s=Object.keys(a),c=function(c){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l=+s[c],u=void 0,d=a[l].value;if(r)u=a[l].type===D.Z.CrudActions.Removed;else{if(d.d&&d.d[".sv"]&&"Added"===e&&a[l].type===D.Z.CrudActions.Modified)return{v:!0};u=Object.keys(d).filter((function(e){return"d"!==e&&"id"!==e})).every((function(e){return d[e]===n[e]}))}if(u){s.length;var h=a[l].resolve;return i.resolveIfBothReady({id:t,i:c,value:n,resolve:h,received:!0}),{v:!0}}},l=0;l<s.length;l++){var u=c(l);if("object"===H()(u))return u.v}}},{key:"resolveIfBothReady",value:function(e){var t,n=e.id,r=(t=this.readyToResolve)[n]||(t[n]={id:n});Object.assign(r,e);var i=r.i,a=r.sent,o=r.received;if((a||r.sent)&&(o||r.received)){var s=0;0;for(var c=this.updatesSent[n],l=Object.keys(c),u=i;u>=0;u--){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;delete this.updatesSent[n][+l[u]]}var d=this.updatesSent[n]&&0===Object.keys(this.updatesSent[n]).length;delete this.readyToResolve[n],r.resolve({value:r.value,isDone:d})}else a?r.sent=!0:o&&(r.received=!0)}}]),e}(),_()(r.prototype,"onUpdate",[S.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onUpdate"),r.prototype),_()(r.prototype,"_runUpdates",[S.ZP],Object.getOwnPropertyDescriptor(r.prototype,"_runUpdates"),r.prototype),r);const z=(i=function(){function e(t){var n=t.path,r=t.lastDateModified,i=t.extraModifiedPath,a=t.encryptedFields;u()(this,e),this.path=n,this.session=E.Z.database(),this.extraModifiedPath=i,this.encryptedFields=a,this.reqNum=0,this.ref=new W(n,r,this._onRefUpdate)}return h()(e,[{key:"update",value:function(){var e=c()(w().mark((function e(t){return w().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.ref.update(t.id,t));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"remove",value:function(e){return this.ref.remove(e.id,e)}},{key:"getPathForItem",value:function(e){return"".concat(this.path,"/").concat(e.id,"/")}},{key:"toChangeInternal",value:function(e,t,n){return t.id=e,{type:n,value:t}}},{key:"_onRefUpdate",value:function(e,t){var n=this;if(this.cbOnUpdate){var r=t.key,i=t.val();if("load"===e){var a=Object.keys(i||{}).map((function(e){return n.toChangeInternal(e,i[e],"load")}));this.cbOnUpdate(a,!0)}else{var o=[this.toChangeInternal(r,i,e)];this.cbOnUpdate(o,!0)}}}},{key:"onUpdate",value:function(e){this.cbOnUpdate=e}},{key:"getRefValue",value:function(){var e=c()(w().mark((function e(){var t=this;return w().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){t.session.ref(t.path).on("value",(function(t){var n=t.val();e(n)}))})));case 1:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()}]),e}(),_()(i.prototype,"_onRefUpdate",[S.ZP],Object.getOwnPropertyDescriptor(i.prototype,"_onRefUpdate"),i.prototype),i);var q;const G=new(q=function(){function e(){u()(this,e)}return h()(e,[{key:"init",value:function(){return this.session||(this.database=this.session=E.Z.database()),this.serverTime=E.Z.database.ServerValue.TIMESTAMP,this}},{key:"create",value:function(e){return new z(e)}},{key:"onOnlineChange",value:function(e){this.session.ref(".info/connected").on("value",(function(t){e(!0===t.val())}))}},{key:"generateId",value:function(){return E.Z.database().ref().push().key}}]),e}(),_()(q.prototype,"onOnlineChange",[S.ZP],Object.getOwnPropertyDescriptor(q.prototype,"onOnlineChange"),q.prototype),_()(q.prototype,"generateId",[S.ZP],Object.getOwnPropertyDescriptor(q.prototype,"generateId"),q.prototype),q);var K=n(9713),Y=n.n(K);const X=function(){function e(t,n){u()(this,e),this.dateModifieds=n,this.path=t,this.session=E.Z.database(),this.dataCache={},this.isLoaded=!1,this.isLoadedSubpath={},this.ignoreLocalChange=!1,this.refsSubpaths={},this.cbsOnUpdate={},this.cbsOnLoad={},this.updatesSent={},this.reqNum=0}return h()(e,[{key:"toChangeInternal",value:function(e,t,n){var r=e.ref.path.slice(2),i=e.val(),a={},o=this.dataCache,s="Removed"===t;if("object"===H()(i)){var c=r.slice(1),l={},u=l;c.forEach((function(e,t){t===c.length-1?u[e]=i:(u[e]={},u=u[e])})),a=l,r.forEach((function(e,n){n===r.length-1?"Removed"===t?delete o[e]:o[e]!==i&&(s=!0,o[e]=i):(o[e]||(o[e]={}),o=o[e])}))}else{var d=e.key;o[n]||(o[n]={}),o=o[n],"Removed"!==t?o[d]!==i&&(s=!0,o[d]=i):o&&delete o[d],a[d]=i}if(s)return{type:t,value:a}}},{key:"set",value:function(){var e=c()(w().mark((function e(t,n){var r,i,a,o,s,c=0;return w().wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:r=t.split("/"),i=r[0],a=r.slice(1).join("/"),o=this.dataCache,s=0;case 5:if(!(s<r.length-1)){e.next=18;break}if(!(c++>5e3&&__infLoop&&__infLoop(c))){e.next=8;break}throw new RangeError;case 8:if(o){e.next=10;break}return e.abrupt("return",Promise.resolve({value:void 0,isDone:!0}));case 10:if(r[s]){e.next=13;break}return e.abrupt("continue",15);case 13:o[r[s]]||(o[r[s]]={}),o=o[r[s]];case 15:s++,e.next=5;break;case 18:o[a]=n;try{x.Z.PAssert(1256,this.refsSubpaths[i],"Trying to set a value on a tree node that doesn't exist",i)}catch(u){x.Z.reportError(u)}if(!this.refsSubpaths[i]){e.next=22;break}return e.abrupt("return",this.refsSubpaths[i].update(a,n));case 22:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=c()(w().mark((function e(t){var n,r,i;return w().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:n=t.split("/"),r=n[0],i=n.slice(1).join("/");try{x.Z.PAssert(1257,this.refsSubpaths[r],"Trying to remove a value on a tree node that doesn't exist",r)}catch(o){x.Z.reportError(o)}if(!this.refsSubpaths[r]){e.next=6;break}return e.abrupt("return",this.refsSubpaths[r].remove(i));case 6:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendChangeCB",value:function(e,t,n){n(t)}},{key:"onLoad",value:function(e,t){var n=this;this.session.ref(this.path).on("value",(function(t){if(!n.isLoaded){n.isLoaded=!0;var r=t.val()||{};n.dataCache=r,e(r)}}),(function(e){x.Z.log("Firebase error",e),t?t(e):x.Z.reportError(e,"Missing cbError handler: "+n.path)}))}},{key:"onLoadSubpath",value:function(e,t){this.isLoadedSubpath[e]=!1,this.cbsOnLoad[e]=t,this.ensureFirebaseRef(e)}},{key:"onUpdate",value:function(e,t,n){this.cbsOnUpdate[e]=t,this.ensureFirebaseRef(e)}},{key:"offUpdate",value:function(e,t){var n;null===(n=this.refsSubpaths[e])||void 0===n||n.dispose()}},{key:"setSent",value:function(e,t){var n=this.reqNum++;return this.updatesSent[e]||(this.updatesSent[e]={}),this.updatesSent[e][n]=t,n}},{key:"ensureFirebaseRef",value:function(e){return this.refsSubpaths[e]||(this.refsSubpaths[e]=new W(this.path+"/"+e,this.dateModifieds[e],this.onRefUpdate.bind(this,e))),this.refsSubpaths[e]}},{key:"onRefUpdate",value:function(e,t,n){if("load"===t){var r,i;this.isLoadedSubpath[e]=!0,this.isLoaded=!0;var a=n.val();this.dataCache[e]=a,null===(r=(i=this.cbsOnLoad)[e])||void 0===r||r.call(i,a)}else{var o=this.cbsOnUpdate[e];if(o){var s=this.toChangeInternal(n,t,e);s&&this.sendChangeCB(n,s,o)}}}}]),e}();var Q={a:"AuthToken",b:"Board",p:"Property",s:"Setting",l:"Plugin"};const J=function(){function e(t,n){var r=this;u()(this,e),this.dateModifieds=n,this.uid=t,this.session=E.Z.database(),this.treeApi=new X("users/".concat(t),n),Object.keys(Q).forEach((function(e){var t=Q[e];r["on"+t+"Update"]=r.treeApi.onUpdate.bind(r.treeApi,e),r["set"+t]=function(t,n){return r.treeApi.set(e+"/"+t,n)},r["remove"+t]=function(t){return r.treeApi.remove(e+"/"+t)}}))}return h()(e,[{key:"onLoad",value:function(){var e=c()(w().mark((function e(t){var n,r,i=this;return w().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return n={},e.next=3,Promise.all(Object.keys(Q).map((function(e){return new Promise((function(t){return i.treeApi.onLoadSubpath(e,(function(r){n[e]=r,t()}))}))})));case 3:r={properties:n.p,settings:n.s,authTokens:n.a,boards:n.b,plugins:n.l},t(r);case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPathForSettings",value:function(){return"users/".concat(this.uid,"/s/")}},{key:"deleteFully",value:function(){var e,t=(e={},Y()(e,"/users/".concat(this.uid,"/a"),null),Y()(e,"/users/".concat(this.uid,"/b"),null),Y()(e,"/users/".concat(this.uid,"/s"),null),Y()(e,"/users/".concat(this.uid,"/l"),null),e);return this.session.ref().update(t)}}]),e}();var $=function(e,t,n){return Object.assign(n,Y()({},e,t))},ee={identity:function(e){return e},true:function(e){return!0},index:function(e,t){return t}},te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ee.identity,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ee.true,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;return $(e(r,i),t(r,i),n)},ne=function(e,t,n){return te(void 0,void 0,e,t,n)},re=function(e,t){var n={id:e.id},r=function(r){void 0===t[r]?n[r]=null:e[r]!==t[r]&&(n[r]=t[r])};return Object.keys(e).forEach(r),Object.keys(t).forEach(r),n},ie=function(e,t,n){return"Removed"===e||"Added"===e?{type:e,value:n}:{type:e,value:t?re(t,n):n}},ae=function(e,t){return{type:t,value:e}},oe=function(e){return function(t){return[t].map((n=e,function(e){return ie(e.type,n[e.value.id],e.value)}))[0];var n}},se=function(e,t){var n,r=t.value;return e=(n="id",function(e,t,r){return te(function(e){return function(t){return function(e,t){return t?t[e]:void 0}(e,t)}}(n),ee.identity,e,t,r)})(e,r),"Removed"===t.type&&delete e[r.id],e},ce=function(e){return e.changes.map((function(e){return e.value}))},le=function(e){var t=e.changes,n=e.prevStore;return t.map(oe(n))},ue=function(e){return e._store={},e},de=function(e){var t=e.changes,n=(e.type,e.prevStore,e.api);return n._store=t.reduce(se,n._store),n},he=function(e){var t=e.item,n=e.api,r=e.changeType,i=Object.assign({},n._store),a=ae(t,r);de({changes:[a],prevStore:i,api:n})},pe=function(e){return function(t,n){return he({item:n,api:t,changeType:e})}},fe={load:function(e){var t=e.changes,n=e.api,r=e.prevStore;return de({api:n,type:"update",changes:t,prevStore:r})},normalizeChanges:le,addItem:pe("Added"),removeItem:pe("Removed"),modifyItem:pe("Modified")},ge={load:function(e){var t=e.changes,n=e.api,r=e.prevStore;return de({changes:t,api:ue(n),prevStore:r})},normalizeChanges:ce},me=n(319),ve=n.n(me);function ye(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return ke(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ke(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}function ke(e,t){var n=0;(null==t||t>e.length)&&(t=e.length);for(var r=0,i=new Array(t);r<t;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;i[r]=e[r]}return i}var _e,Ze=function(e,t,n){return e.push(t),n},we=function(e,t,n){var r=e.indexOf(t);return r>-1&&e.splice(r,1),n},be=function(e,t,n){var r,i=ye(e);try{var a=0,o=function(){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var e=r.value;setTimeout((function(){return e.apply(void 0,ve()(t))}),0)};for(i.s();!(r=i.n()).done;)o()}catch(s){i.e(s)}finally{i.f()}return n},Pe=function(e){return function(t,n){return function(e,t,n){var r=Object.assign({},n._store),i=n._loadingState,a="load"===i?n._loader:n._updater,o="load"===i;if(o||(e=e.filter((function(e){var t=e.value;return"Removed"===e.type||!r[t.id]||t.d!==r[t.id].d}))),o&&(n._loadingState="update","load"===i&&n._earlyEdits.length&&(n._earlyEdits.forEach((function(e){be(n._callbacks.update,[e])})),n._earlyEdits=[])),"update"===n._loadingState){if(o||e.length>0){n=a.load({api:n,changes:e,prevStore:r});var s=a.normalizeChanges({api:n,changes:e,prevStore:r});be(n._callbacks[i],[{responses:s,changes:e},t]),be(n._callbacks["".concat(i,"Debug")],[{responses:s,changes:e,api:n},t])}}else n._earlyEdits.push({changes:e,api:n});return n}(t,n,e)}},Se=function(e){var t=e.id,n=e.store;return n[t]?Object.assign({},n[t]):void 0},De=[],Ie=function(e){var t=e.db,n=e.config,r=e.hasServerTime,i=e.ignore,a=void 0===i?De:i,o=e.backend,s=e.path,c=e.lastDateModified,l=e.extraModifiedPath,u=e.encryptedFields,d={_config:n,_database:t,_store:{},_callbacks:{update:[],load:[],updateDebug:[],loadDebug:[]},_ignore:a.reduce(ne,{}),_loadingState:"load",_earlyEdits:[],_backend:o.create({db:t,path:s,hasServerTime:r,lastDateModified:c,extraModifiedPath:l,encryptedFields:u}),_loader:ge,_updater:fe};return d._backend.onUpdate(Pe(d)),d.get=function(e){return Se({id:e,store:d._store})},d.getFromRemote=function(e){return d._backend.getFromRemote(e)},d.update=function(e,t){return function(e,t){var n,r=e.item,i=e.backend,a=e.api,o=(n=a._ignore,function(e){return function(e,t){if(!e)return e;var n={};for(var r in e)r in t||(n[r]=e[r]);return n}(e,n)})(r);return a._updater.modifyItem(a,o),i.update(o,t)}({item:e,backend:d._backend,api:d},t)},d.getPathForItem=function(e){return function(e){var t=e.item;return e.backend.getPathForItem(t)}({item:e,backend:d._backend})},d.remove=function(e,t){return function(e,t){var n=e.item,r=e.backend,i=e.api;return i._updater.removeItem(i,n),console.log("remove",n),r.remove(n,t)}({item:e,backend:d._backend,api:d},t)},d.onLoad=function(e){return Ze(d._callbacks.load,e)},d.offLoad=function(e){return we(d._callbacks.load,e)},d.onUpdate=function(e){return Ze(d._callbacks.update,e)},d.offUpdate=function(e){return we(d._callbacks.update,e)},d.onLoadDebug=function(e){return Ze(d._callbacks.loadDebug,e)},d.offLoadDebug=function(e){return we(d._callbacks.loadDebug,e)},d.onUpdateDebug=function(e){return Ze(d._callbacks.updateDebug,e)},d.offUpdateDebug=function(e){return we(d._callbacks.updateDebug,e)},d.setSent=function(e,t){return d._backend.setSent(e,t)},d.getRefValue=function(){return d._backend.getRefValue()},d};const Ee=(_e=function(){function e(t,n,r){u()(this,e),this.docID=t,this.uid=n,this.userDocuments=r,this.treeApi=new X("documents/".concat(t),{}),this.cbs=[],this.cbsAcl=[]}return h()(e,[{key:"onLoad",value:function(e,t){this.treeApi.onLoad((function(t){e(t)}),t)}},{key:"onUpdate",value:function(e,t){this.cbs.push(e),this.treeApi.onUpdate("p",e,t)}},{key:"offUpdate",value:function(e){this.cbs.remove(e),this.treeApi.offUpdate("p",e)}},{key:"onAclUpdate",value:function(e,t){this.cbsAcl.push(e),this.treeApi.onUpdate("a",e,t)}},{key:"offAclUpdate",value:function(e){this.cbs.remove(e),this.treeApi.offUpdate("p",e)}},{key:"onAPIItemsUpdate",value:function(e,t){this.cbs.push(e),this.treeApi.onUpdate("z",e,t)}},{key:"offAPIItemsUpdate",value:function(e){this.cbs.remove(e),this.treeApi.offUpdate("z",e)}},{key:"deleteAPIItems",value:function(e,t){var n={};return t.forEach((function(t){return n["/documents/".concat(e,"/z/").concat(t)]=null})),G.database.ref().update(n)}},{key:"create",value:function(e,t){var n,r=Object.assign({},e),i={t:r.p.t};r.p.d&&(i.d=r.p.d),delete r.id;var a=(n={},Y()(n,"/documents/".concat(this.docID),r),Y()(n,"/userdocuments/".concat(this.uid,"/").concat(this.docID),i),n);if(t)for(var o=0,s=0;s<t.length;s++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var c=t[s],l=c.id;delete c.id,a["/items/".concat(this.docID,"/").concat(l)]=c}return G.database.ref().update(a)}},{key:"unlisten",value:function(){this.cbs.forEach(this.offUpdate),G.database.ref("/items/".concat(this.docID)).off(),G.database.ref("/userdocuments/".concat(this.uid,"/").concat(this.docID)).off(),G.database.ref("/documents/".concat(this.docID,"/a")).off(),G.database.ref("/documents/".concat(this.docID)).off()}},{key:"deleteFully",value:function(){var e;this.unlisten();var t=(e={},Y()(e,"/items/".concat(this.docID),null),Y()(e,"/userdocuments/".concat(this.uid,"/").concat(this.docID),null),Y()(e,"/documents/".concat(this.docID),null),e);return G.database.ref().update(t)}},{key:"update",value:function(e,t){var n=Object.assign({},e);delete n.id;var r={};t?r["/documents/".concat(this.docID,"/p")]=n.p:r["/documents/".concat(this.docID)]=n,n.p.d&&(r["/userdocuments/".concat(this.uid,"/").concat(this.docID,"/d")]=n.p.d),n.p.t&&(r["/userdocuments/".concat(this.uid,"/").concat(this.docID,"/t")]=n.p.t),G.database.ref().update(r)}},{key:"addBackup",value:function(e){G.database.ref("/documents/".concat(this.docID,"/c")).set(Y()({},e,""))}}]),e}(),_()(_e.prototype,"offUpdate",[S.ZP],Object.getOwnPropertyDescriptor(_e.prototype,"offUpdate"),_e.prototype),_()(_e.prototype,"offAclUpdate",[S.ZP],Object.getOwnPropertyDescriptor(_e.prototype,"offAclUpdate"),_e.prototype),_()(_e.prototype,"offAPIItemsUpdate",[S.ZP],Object.getOwnPropertyDescriptor(_e.prototype,"offAPIItemsUpdate"),_e.prototype),_e);const xe=function(){function e(t,n){u()(this,e),this.uid=t,this.docs={},this.documentsWaiting={},this.db={firebase:E.Z,session:E.Z.database()},G.init(),this.onOnlineChange=G.onOnlineChange,this.serverTime=G.serverTime,this.generateId=G.generateId,this.user=new J(t,n),this.userDocuments=Ie({db:this.db,backend:G,path:"userdocuments/".concat(t),encryptedFields:{s:!0}})}return h()(e,[{key:"loadDocuments",value:function(e){this.userDocuments.onLoad((function(t){var n=t.responses;e(n)}))}},{key:"onDocumentsUpdate",value:function(e){this.userDocuments.onUpdate(e)}},{key:"createDocumentAPI",value:function(e,t,n){var r=this;if(!(e in this.docs)){try{x.Z.PAssert(460,!t||!isNaN(t)&&t<Date.now(),"Date modified is not number: "+t)}catch(s){x.Z.reportError(s)}var i,a=n||new Ee(e,this.uid,this.userDocuments),o=t&&!isNaN(t)?t+1:void 0;this.docs[e]={info:a,items:function(){return i||(i=Ie({db:r.db,hasServerTime:!0,backend:G,path:"items/".concat(e),lastDateModified:o,extraModifiedPath:"documents/".concat(e,"/p/d"),encryptedFields:{t:!0}})),i}}}return this.docs[e]}},{key:"getDocumentAPI",value:function(){var e=c()(w().mark((function e(t){var n,r=this;return w().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.docs[t]){e.next=4;break}return e.abrupt("return",this.docs[t]);case 4:return this.documentsWaiting[t]||(this.documentsWaiting[t]=[]),n=new Promise((function(e){r.documentsWaiting[t].push(e)})),e.abrupt("return",n);case 7:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onDocumentAPILoaded",value:function(){var e=this;Object.keys(this.documentsWaiting).forEach((function(t){var n=e.documentsWaiting[t];n&&n.forEach((function(n){return n(e.docs[t])}))}))}},{key:"addDocument",value:function(e,t){var n=this,r=e.id,i=this.docs[r];if(!i){var a=new Ee(r,this.uid,this.userDocuments);return a.create(e,t).then((function(){return n.createDocumentAPI(r,void 0,a)}))}return Promise.resolve(i)}},{key:"forgetDocument",value:function(e){this.docs[e];return delete this.docs[e],!0}},{key:"commitBatch",value:function(e){return this.db.session.ref().update(e)}}]),e}();var Ce,Ae=n(8047),Le=n(7994);function Me(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=y()(e);if(t){var i=y()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return m()(this,n)}}const Te=new(Ce=function(e){f()(n,e);var t=Me(n);function n(){var e;return u()(this,n),(e=t.call(this,!1)).documentsEncrypted={},e.documentsDeleted={},e._isLoaded=!1,e.loadState=new U.Z(D.Z.LoadState.Connecting),e}return h()(n,[{key:"init",value:function(e,t){if(this._seenLocal={},this._coalescedChanges={},this._itemsChangedQueue=[],this._isLoaded=!1,this.cbOnLoad=e,this.cbOnDocumentsChanged=t,this.savedDocInfo={},I.Z.init(this,this.onLoadLocal),A.Z.hasURLParam("invite")){var n=A.Z.getURLParam("invite");b.Z.onAuthed(c()(w().mark((function e(){return w().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,M.Z.acceptInvite(n);case 2:e.sent.error||A.Z.removeURLParam("invite");case 4:case"end":return e.stop()}}}),e)}))))}}},{key:"onLoadLocal",value:function(e,t){var n=this,r=t.documentsPending,i=t.itemsPending,a=t.settingsPending,o=t.boardsPending,s=t.isPreload;e||(e=[]),e.forEach((function(e){return n.documents[e.id]=e})),this.documentsPending=r,this.itemsPending=i,this.settingsPending=a,this.boardsPending=o,this.cbOnLoad&&this.cbOnLoad(e),s||(this.cbOnLoad=void 0,C.default.settings.userId.onHasValue((function(){n.createStore()})))}},{key:"notifyDocumentsChanged",value:function(){this.cbOnDocumentsChanged({documents:this.documents,documentsEncrypted:this.documentsEncrypted,documentsDeleted:this.documentsDeleted})}},{key:"onLoadRemoteDocuments",value:function(){this._isLoaded=!0,this.notifyDocumentsChanged(),C.default.PaneManager.loadInitialState(),L.Z.ensureSelected(),C.default.settings.lastSync.set(Date.now()),this.api.onDocumentAPILoaded()}},{key:"createStore",value:function(){var e=this,t=0,n=I.Z.getAllPluginsNew();n&&(t=x.Z.max(Object.keys(n).map((function(e){return n[e].dateModified+1}))));var r,i,a=new xe(b.Z.getUid(),{l:t});this.api=a;var o=function(){var t=c()(w().mark((function t(){return w().wrap((function(t){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(t.prev=t.next){case 0:return C.default.settings.lastSync.get()||T.Z.setLoadProgress("Downloading and decrypting documents..."),Object.keys(e.documents).forEach((function(t){!e.documentsPending[t]&&i.indexOfWithProperty("id",t)<0&&(e.documentsPending[t]=!0)})),t.prev=2,t.next=5,Promise.all(Object.keys(e.documentsPending).map((function(t){var n=e.documents[t];if(n&&!n.isDeleted.get()&&(!i||i.indexOfWithProperty("id",n.id)<0))return e.addDocument(n,!1)})));case 5:return e.documentsPending={},I.Z.beginBatch(),t.next=9,Promise.all(i.map((function(t){return e.loadDocumentData(N.Z.documentInFlat(t))})));case 9:T.Z.setLoadProgress(void 0),e.onLoadRemoteDocuments(),e.loadState.set(D.Z.LoadState.Connected),I.Z.commitBatch(),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(2),x.Z.reportError(t.t0);case 18:case"end":return t.stop()}}}),t,null,[[2,15]])})));return function(){return t.apply(this,arguments)}}(),s=function(){r&&i&&o()};a.user.onLoad((function(t){var n=C.default.settings.getSettingAbbrev("userEncryptionSentinel"),i=t.settings,o=!1;t.properties?(e.userProperties=N.Z.userIn(t.properties),C.default.billingManager.loadUserProperties(e.userProperties)):(o=!0,C.default.billingManager.loadUserProperties({})),t.boards&&!x.Z.isEmpty(t.boards)||(o=!0),o&&e.onFirstSync(t),e.checkUserEncryption(i&&i[n]&&i[n].v,(function(){C.default.settings.lastSync.get()||T.Z.setLoadProgress("Downloading documents..."),e.loadState.set(D.Z.LoadState.LoadingDocs),i&&e.onSettingsChange("Modified",i,!0),e.settingsPending&&Object.keys(e.settingsPending).forEach(function(){var t=c()(w().mark((function t(n){var r,i;return w().wrap((function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:return r=C.default.settings.getSettingInfoFromAbbrev(n),t.next=3,C.default.settings.getRemoteSaveValue(r.key,r.group,C.default.crypto.getKeyInfo(C.default.settings.getBestUserEncryption()));case 3:void 0!==(i=t.sent)&&e._setSettingRemote(n,i);case 5:case"end":return t.stop()}}}),t)})));return function(e){return t.apply(this,arguments)}}());var n=t.boards;e.boardsPending&&Object.keys(e.boardsPending).forEach((function(t){var r=L.Z.getById(t),i=n[t];try{x.Z.PAssert(206,r,"Pending board that does not exist")}catch(a){x.Z.reportError(a)}r&&(!i||r.dateModified>=i.d?e._saveBoardRemote(r.getSaveInfo()):delete e.boardsPending[t])})),n&&e.onBoardsChange("Modified",n,!0),Le.Z.initWithAPI(a,t.plugins),r=!0;var o=t.authTokens;e.onAuthTokensChange("Added",o),s(),setTimeout((function(){C.default.settings.userEncryptionSentinel.listen((function(t){t?e.checkUserEncryption(t):C.default.settings.removeEncryptionKey(D.Z.EncryptionKeys.UserPassword)}))}),0)}))})),a.user.onPropertyUpdate((function(e){var t=e.type,n=e.value;"Removed"===t&&Object.keys(n).forEach((function(e){return n[e]=null}));var r=N.Z.userIn(n);C.default.billingManager.loadUserProperties(r)})),a.user.onSettingUpdate((function(t){var n=t.type,r=t.value;e.onSettingsChange(n,r,!1)})),a.user.onBoardUpdate((function(t){var n=t.type,r=t.value;e.onBoardsChange(n,r,!1)})),a.user.onAuthTokenUpdate((function(t){var n=t.type,r=t.value;e.onAuthTokensChange(n,r)})),a.loadDocuments((function(e){i=e,s()})),a.onDocumentsUpdate((function(t,n){var r=t.responses;I.Z.beginBatch(),Promise.all(r.map((function(t){var n=t.type,r=t.value;if("Removed"!==n)return e.loadDocumentData(N.Z.documentInFlat(r));e.documents[r.id]&&(e.documents[r.id].delete(!0),delete e.documents[r.id])}))).then((function(){I.Z.commitBatch(),e.notifyDocumentsChanged()})).catch((function(e){return x.Z.reportError(e)}))})),a.onOnlineChange((function(t){e.updateOnlineStatus(t)})),this._isLoaded||(this._isLoaded=!0),this._runCoalescedChanges()}},{key:"onFirstSync",value:function(){var e=c()(w().mark((function e(t){var n;return w().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:!(n=b.Z.getGoogleProvider())||C.default.settings.syncAccounts.get()&&!x.Z.isEmpty(C.default.settings.syncAccounts.get())||C.default.settings.syncAccounts.setProperty(n.email,{}),t.boards&&!x.Z.isEmpty(t.boards)||L.Z.createDefaultState(),C.default.intro.showHelp(),C.default.billingManager.setJoinDate(Date.now());case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadSingleDocument",value:function(){var e=c()(w().mark((function e(t,n){var r;return w().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.loadDocumentData(t,n);case 3:return r=e.sent,this.notifyDocumentsChanged(),e.abrupt("return",r);case 8:e.prev=8,e.t0=e.catch(0),x.Z.reportError(e.t0);case 11:case"end":return e.stop()}}}),e,this,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadDocumentData",value:function(){var e=c()(w().mark((function e(t,n){var r,i,a,o,s,l,u,d,h,p,f=this;return w().wrap((function(e){for(var g=0;;){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;switch(e.prev=e.next){case 0:if(!(i=this.documents[t.id])){e.next=6;break}r=i.getDateModified(),e.next=9;break;case 6:if(!t.encryptionSentinel||C.default.crypto.canDecryptSentinel(t.encryptionSentinel)){e.next=9;break}return this.documentsEncrypted[t.id]=t,e.abrupt("return",void 0);case 9:return e.prev=9,a=this.api.createDocumentAPI(t.id,r),e.next=13,new Promise((function(e){c()(w().mark((function r(){var o,s,c,l;return w().wrap((function(r){for(var u=0,d=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(r.prev=r.next){case 0:if(!f.savedDocInfo[t.id]){r.next=5;break}Object.assign(f.savedDocInfo[t.id].docProps,t),e(f.savedDocInfo[t.id]),r.next=15;break;case 5:if(s=a.info,!n){r.next=10;break}r.t0=t,r.next=13;break;case 10:return r.next=12,new Promise((function(e){s.onLoad((function(n){n.id=t.id;var r=N.Z.documentIn(n);e(r)}),(function(t){console.error("Doc load error",t),e(null)}))}));case 12:r.t0=r.sent;case 13:(c=r.t0)?!n&&c.isDeleted?(f.documentsDeleted[t.id]={info:c,api:a},e(void 0)):(s.onUpdate(f.onDocInfoChange.bind(f,t),x.Z.reportError),s.onAclUpdate(f.onDocAclChange.bind(f,t),x.Z.reportError),s.onAPIItemsUpdate(f.onDocAPIItemsChange.bind(f,i),x.Z.reportError),(l=a.items()).onLoad((function(n){var r=n.responses;if(o=r,null===c)e(void 0);else if(c&&o){var i={docProps:c,docItemsEncrypted:o};f.savedDocInfo[t.id]=i,e(i)}})),l.onUpdate(f.onItemsChange.bind(f,t))):e(void 0);case 15:case"end":return r.stop()}}}),r)})))()}));case 13:if(!(o=e.sent)){e.next=32;break}if(s=o.docProps,l=o.docItemsEncrypted,u=this.getEncryptionForDocument(s)){e.next=21;break}return t.encryptionSentinel=s.encryptionSentinel,this.documentsEncrypted[t.id]=t,e.abrupt("return",Promise.resolve(void 0));case 21:return d=r||0,e.next=24,Promise.all(l.map((function(e){return f.decryptItemIn(e,C.default.crypto,u)}))).then((function(e){return e.forEach((function(e){e.docId=s.id,d=Math.max(d,e.dateModified)})),F.Z.createItemHierarchy(e,I.Z.getItemsMap()),i&&e.length>0&&f.resolveItemConflicts(i,e),e}));case 24:return h=e.sent,i&&Object.keys(this.itemsPending).forEach((function(e){var t=I.Z.getItemData(e),n=T.Z.getItem(e),r=f.itemsPending[e];if(t&&t.docId===i.id){try{x.Z.PAssert(207,n||t.isArchived||t.isDeleted,"Pending update that has no parent")}catch(s){x.Z.reportError(s)}if(n||t.isArchived||t.isDeleted){var a=Object.keys(r);if(a.length>0){var o={id:e};a.forEach((function(e){o[e]=t[e]})),f._saveItemRemote(i,o,n)}}}})),h.length>0&&I.Z.ensureMirror(h,!0,!1),i?this.documentsPending[i.id]?(this._saveDocumentRemote(i),delete this.documentsPending[i.id]):i.onRemoteUpdate(s):s.root&&((p=x.Z.clone(s)).backing=this,p.rootData=this.getItemData(s.root),p.rootData&&(delete p.pendingSync,(i=B.Z.fromData(p,this)).createVMLIs())),i&&(this.documents[i.id]=i,delete this.documentsEncrypted[i.id],delete this.documentsDeleted[i.id],I.Z.saveDocument(i)),i||console.log("Failed to find root item"),e.abrupt("return",i);case 32:e.next=39;break;case 34:e.prev=34,e.t0=e.catch(9),console.log(e.t0),x.Z.reportError(e.t0);case 39:case"end":return e.stop()}}}),e,this,[[9,34]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getItemData",value:function(e){var t=this._coalescedChanges[e],n=I.Z.getItemData(e,!0);return t&&"Removed"!==t.type&&(n=Object.assign({},n,t.info)),n}},{key:"getItemSaveData",value:function(e){return e.getFullSaveData()}},{key:"importItem",value:function(e,t){var n=this;e.getDocumentOwner(),e.parent();t.push(e),e.hasNote()&&this.importItem(e.getNote(),t),e.getItems().forEach((function(e,r){e.index=""+r,n.importItem(e,t)})),this._seenLocal[e.id]=!0}},{key:"onSettingsChange",value:function(e,t,n){var r=this,i=t;Object.keys(t).forEach((function(n){var a=t[n];r.settingsPending[n]&&(i===t&&(i=x.Z.clone(t)),delete i[n],t[n]={v:C.default.settings.getValueFromAbbrev(n)}),a.v&&(a.v="Removed"===e?void 0:r.decodeValue(a.v))})),"Removed"===e&&I.Z.deleteSettings(i),C.default.settings.load(t,n,!0)}},{key:"onBoardsChange",value:function(e,t,n){var r=this;n&&L.Z.getBoards().forEach((function(e){t[e.id]||(console.log("Local board not on remote",e.id),L.Z.removeBoard(e,!0))})),Object.keys(t).forEach((function(n){if(!r.boardsPending[n]){t[n].id=n;var i=N.Z.boardIn(t[n]);"Removed"===e?I.Z.deleteBoard(n):I.Z.saveBoard(i),L.Z.onRemoteUpdate(e,i)}})),L.Z.ensureUniqueIndices()}},{key:"onAuthTokensChange",value:function(e,t){var n={};t&&"Removed"!==e&&Object.keys(t).forEach((function(e){var r=e.replace(/,/g,"."),i=t[e],a=i.s?i.s.split(" "):void 0,o={email:r,scopes:a?a.map((function(e){return D.Z.GScopeArray[e]})):void 0};try{x.Z.PAssert(209,"Have an auth token without scopes")}catch(s){x.Z.reportError(s)}n[r]=o})),P.Z.loadWithTokens(n)}},{key:"onDocAclChange",value:function(e,t,n){var r=t.type,i=t.value,a=this.documents[e.id];a&&("Removed"===r&&Object.keys(i).forEach((function(e){i[e]=void 0})),a.onAclUpdate(i)&&I.Z.saveDocument(a))}},{key:"onDocInfoChange",value:function(e,t,n){var r=t.type,i=t.value,a=this.documents[e.id];if(a&&("Removed"===r&&Object.keys(i).forEach((function(e){i[e]=null})),i)){var o={text:i.t,encryptionSentinel:i.s,isDeleted:i.x};a&&(a.onRemoteUpdate(o),o.encryptionSentinel&&!a.canDecrypt()&&(this.documentsEncrypted[a.id]=a.getSaveInfo(),delete this.documents[a.id],delete this.savedDocInfo[a.id],this.notifyDocumentsChanged(),C.default.PaneManager.runForEachPane((function(e){e.document.get()===a&&e.setDocument(T.Z.getDefaultDocument())}))),I.Z.saveDocument(a))}}},{key:"onDocAPIItemsChange",value:function(e,t){var n=t.type,r=t.value;"Removed"!==n&&(null===e||void 0===e||e.onRemoteUpdate({itemsPlaintext:r}))}},{key:"deleteDocAPIItems",value:function(){var e=c()(w().mark((function e(t,n){return w().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.getAPIForDocument(t);case 2:e.sent.deleteAPIItems(t.id,n);case 4:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_processItemsChange",value:function(){var e=c()(w().mark((function e(){var t,n,r,i,a,o,s,l,u,d,h,p,f,g,m,v,y,k=this;return w().wrap((function(e){for(var _=0;;){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;switch(e.prev=e.next){case 0:if(this._isProcessingItemsChanged||this._pauseProcessingItemsChanged||!(this._itemsChangedQueue.length>0)){e.next=34;break}if(this._isProcessingItemsChanged=!0,t=this._itemsChangedQueue[0],n=t.docInfo,r=t.responses,i=t.changes,a=t.isRemote,this._itemsChangedQueue.splice(0,1),o=[],s=this.documents[n.id],e.prev=6,!s){e.next=27;break}return l=0,e.next=11,Promise.all(r.map(function(){var e=c()(w().mark((function e(t){var n;return w().wrap((function(e){for(var r=0,i=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!t.value.t){e.next=6;break}return e.next=3,k.decryptItemIn(t.value,C.default.crypto,s.getBestEncryption());case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=N.Z.itemIn(t.value);case 7:return n=e.t0,e.abrupt("return",{type:t.type,value:n});case 9:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:u=e.sent,a&&C.default.PaneUpdateBatcher.beginUpdateItems(),d=s.getDateModified()||0,h=0;case 15:if(!(h<u.length)){e.next=25;break}if(!(l++>5e3&&__infLoop&&__infLoop(l))){e.next=18;break}throw new RangeError;case 18:p=u[h],f=p.type,g=p.value,m=g,d=Math.max(d,g.dateModified),a?(v=T.Z.getItem(m.id),("Removed"!==f||!v||v.getDocumentOwner().id===n.id&&v.getDocumentOwner()===T.Z.getItem(g.parent).getDocumentOwner())&&(this.handleRemoteItemChange(this.documents[n.id],g.id,g,i[h].value),"Removed"===f?I.Z.deleteItem(g):(m.docId=n.id,v&&(m.regexpFlags=v.regexpFlags),o.push(m)))):(y=T.Z.getItem(g.id))&&this.checkMissingParentRoot(g,i[h].value,y);case 22:h++,e.next=15;break;case 25:a&&(C.default.PaneUpdateBatcher.commitUpdateItems(),o.length>0&&I.Z.ensureMirror(o,!0)),s&&(this.updateLastSync(d),I.Z.saveDocument(s));case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(6),x.Z.reportError(e.t0);case 32:this._isProcessingItemsChanged=!1,this._itemsChangedQueue.length>0&&this._processItemsChange();case 34:case"end":return e.stop()}}}),e,this,[[6,29]])})));return function(){return e.apply(this,arguments)}}()},{key:"onItemsChange",value:function(e,t,n){var r=t.responses,i=t.changes;(r=r.filter((function(e){var t=e.value,n=Object.keys(t).length;return void 0!==t.id&&n--,n>0}))).length>0&&(this._itemsChangedQueue.push({docInfo:e,responses:r,changes:i,isRemote:n}),this._processItemsChange())}},{key:"convertItemUndefineds",value:function(e,t){var n=this.getItemData(e);return Object.keys(t).forEach((function(e){void 0===t[e]&&(void 0===n[e]?delete t[e]:t[e]=null)})),t}},{key:"_coalesceChange",value:function(e,t,n,r){var i=this._coalescedChanges[t],a=!i;r.id||(r.id=t),i&&("Modified"===i.type?i.info=Object.assign(i.info,r):i.type),a&&(i=this._coalescedChanges[t]={id:t,time:Date.now(),doc:e,type:n,info:r}),this.isCoalescing?this.needsCoalesceAfterFinish=!0:this._timeoutCoalesce||(this._timeoutCoalesce=setTimeout(this._runCoalescedChanges,0))}},{key:"_runCoalescedChanges",value:function(){var e=c()(w().mark((function e(){return w().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return this._timeoutCoalesce=void 0,this.needsCoalesceAfterFinish=!1,this.isCoalescing=!0,e.prev=3,e.next=6,this._runCoalescedChangesInside();case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),x.Z.reportError(e.t0);case 11:this.isCoalescing=!1,this.needsCoalesceAfterFinish&&!this._timeoutCoalesce&&(this._timeoutCoalesce=setTimeout(this._runCoalescedChanges,0));case 13:case"end":return e.stop()}}}),e,this,[[3,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"_runCoalescedChangesInside",value:function(){var e=c()(w().mark((function e(){var t,n,r,i,a,o,s=this;return w().wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(!this._isLoaded){e.next=18;break}if(t=x.Z.objectValues(this._coalescedChanges),this._coalescedChanges={},!(t.length>0)){e.next=18;break}if(n=t.sort((function(e,t){return e.time-t.time})),r=[],Ae.Z.beginBatch(),n.forEach((function(e){var t=e.id,n=e.doc,i=e.info,a=T.Z.getItem(t);"Added"===e.type?s.importItem(a,r):"Modified"===e.type?x.Z.isEmpty(i)||s._saveItem(n,t,a,i):"Removed"===e.type&&s._saveItem(n,t,a,i)})),i=[],a=[],o={},r.map((function(e){if(!o[e.id]){o[e.id]=!0;var t=e.getFullSaveData(),n=s._prepDataSaveLocal(e.id,t),r=n.localChanges,c=n.remoteChanges;i.push(r),a.push({item:e,itemData:c})}})),Ae.Z.endBatch(),this.checkItemsPending(),!(i.length>0)){e.next=17;break}return e.next=17,I.Z.ensureMirror(i,!1);case 17:a.forEach((function(e){var t=e.item,n=e.itemData;s._saveItemRemote(t._documentOwner,n,t)}));case 18:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"saveItem",value:function(e,t,n,r,i){x.Z.isLocalChange(r)?x.Z.isUndoRedoChange(r)||this._coalesceChange(e,t.id,"Modified",n):I.Z.saveItem(n,!1,t)}},{key:"addItem",value:function(e,t){var n=this.getItemSaveData(t);this._coalesceChange(e,t.id,"Added",n)}},{key:"deleteItem",value:function(e,t,n){this._coalesceChange(e,t.id,"Modified",{id:t.id,isDeleted:!0})}},{key:"setNote",value:function(e,t,n,r,i){if(x.Z.isLocalChange(i))if(n){var a=this.getItemSaveData(n);this._coalesceChange(e,n.id,"Modified",a)}else r&&this._coalesceChange(e,r.id,"Modified",{id:r.id,isDeleted:!0})}},{key:"moveItem",value:function(e,t){var n=e.parent(),r=e.index,i=e.getDocumentOwner(),a=t.getDocumentOwner(),o={id:e.id,parent:n.id,index:r};i!==a&&(o.docId=i.id,o.oldDocId=a.id),this._coalesceChange(i,e.id,"Modified",o)}},{key:"moveItemDocument",value:function(e,t){var n=e.getDocumentOwner();try{x.Z.PAssert(210,n.id!==t,"Trying to move document to the same document")}catch(i){x.Z.reportError(i)}if(n.id!==t){var r={id:e.id,docId:n.id,oldDocId:t};this._coalesceChange(n,e.id,"Modified",r)}}},{key:"_prepDataSaveLocal",value:function(e,t){t.parent&&x.Z.isVMLI(t.parent)&&(t.parent=t.parent.id);var n=x.Z.extend({id:e},t),r=I.Z.getItemData(e)||{},i=r.pendingSync||{};Object.keys(t).forEach((function(e){"id"!==e&&"dateModified"!==e&&void 0===i[e]&&(i[e]=r[e])}));var a=Object.assign({pendingSync:i},n);return delete a.dateModified,this.itemsPending[e]=Object.assign(this.itemsPending[e]||{},i),{localChanges:a,remoteChanges:n}}},{key:"_saveItem",value:function(e,t,n,r){var i=this._prepDataSaveLocal(t,r),a=i.localChanges,o=i.remoteChanges;I.Z.saveItem(a,!1,n),this._saveItemRemote(e,this.convertItemUndefineds(t,o),n),this.checkItemsPending()}},{key:"_saveItemRemote",value:function(){var e=c()(w().mark((function e(t,n,r){var i,a,o,s,c,l,u,d;return w().wrap((function(e){for(var h=0;;){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,T.Z.onConnectedPromise();case 2:if(!this.api){e.next=32;break}return i=n.docId,(a=n.oldDocId)&&r&&(n=Object.assign(r.getFullSaveData(),{oldDocId:a})),this.ensureSafetyOfItemData(n),e.next=10,this.encryptItemForSaveRemote(t,n);case 10:if(o=e.sent,!N.Z.validateOutFields(o,!0)){e.next=31;break}return e.next=15,this.getAPIForDocumentItems(t);case 15:if(s=e.sent,!i&&!t.id||!a){e.next=20;break}return e.next=19,this.getAPIForDocumentItems({id:a});case 19:c=e.sent;case 20:return e.next=22,s.update(o);case 22:if(l=e.sent,u=l.value,!c){e.next=27;break}return e.next=27,c.remove({id:n.id});case 27:return u&&(delete this.itemsPending[n.id],this.checkItemsPending(),r&&r.setDateModified(new Date(u.d)),d={id:n.id,docId:t.id,pendingSync:void 0,dateModified:u.d},I.Z.saveItem(d,!0),this.updateLastSync(u.d)),e.abrupt("return",u);case 31:0;case 32:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"ensureSafetyOfItemData",value:function(e){e&&e.hasOwnProperty("parent")&&(void 0===e.parent||null===e.parent)&&(x.Z.reportError(new Error("BAD ERROR: Saving null or undefined parent to item"),x.Z.removeNullUndefined(Object.assign({},e,{text:void 0}))),delete e.parent)}},{key:"generateId",value:function(){return E.Z.database().ref().push().key}},{key:"addDocument",value:function(){var e=c()(w().mark((function e(t,n){var r,i,a,o,s=this;return w().wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:(r=t.getRootItem())||t.createVMLIs();try{x.Z.PAssert(211,r,"Trying to add a document without a root item")}catch(l){x.Z.reportError(l)}if(!r){e.next=11;break}if(i=t.getSaveInfo(),a=this.getItemSaveDataRecursive(r),!1!==n&&(this.documents[t.id]=t,I.Z.saveDocument(t,{pendingSync:Date.now()}),I.Z.ensureMirror(a,!0)),this.documentsPending&&(this.documentsPending[t.id]=t),!this.api){e.next=11;break}return o=N.Z.documentOut(i),e.abrupt("return",Promise.all(a.map((function(e){return s.encryptItemForSaveRemote(t,e)}))).then((function(e){s.api.addDocument(o,e).then((function(e){var n=e.items();n.onLoad(x.Z.emptyFn),n.onUpdate(s.onItemsChange.bind(s,i)),e.info.onLoad(x.Z.emptyFn,x.Z.reportError),e.info.onUpdate(s.onDocInfoChange.bind(s,i),x.Z.reportError),e.info.onAclUpdate(s.onDocAclChange.bind(s,i),x.Z.reportError),e.info.onAPIItemsUpdate(s.onDocAPIItemsChange.bind(s,t),x.Z.reportError)}))})).catch((function(e){return x.Z.reportError(e)})));case 11:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"encryptItemForSaveRemote",value:function(){var e=c()(w().mark((function e(t,n){return w().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return n.dateModified=this.api.serverTime,delete n.pendingSync,delete n.docId,delete n.oldDocId,delete n.regexpFlags,delete n.noteItem,e.abrupt("return",N.Z.encryptItemOut(n,C.default.crypto,t.getBestEncryption()));case 8:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"saveDocument",value:function(e,t){t?I.Z.saveDocument(e):(this.documentsPending[e.id]=!0,I.Z.saveDocument(e,{pendingSync:Date.now()}),this._saveDocumentRemote(e))}},{key:"_saveDocumentRemote",value:function(){var e=c()(w().mark((function e(t){var n,r;return w().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(n=t.getSaveInfo(),r=N.Z.documentOut(n,{onlyUpdate:!0}),!N.Z.validateOutFields(r,!0)){e.next=9;break}return e.next=5,this.getAPIForDocument(t);case 5:e.sent.update(r,!0),e.next=10;break;case 9:0;case 10:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItemSaveDataRecursive",value:function(e,t){var n=this,r=!t;return t||(t=[]),t.push(e),e.hasNote()&&t.push(e.getNote()),e.hasChildren()&&e.getItems().forEach((function(e){n.getItemSaveDataRecursive(e,t)})),r&&(t=t.map((function(e){return n.getItemSaveData(e)}))),t}},{key:"encodeValue",value:function(e){return x.Z.isObject(e)||x.Z.isArray(e)?JSON.stringify(e):e}},{key:"decodeValue",value:function(e){if(e&&e.length>1&&("{"===e[0]||"["===e[0]))try{e=JSON.parse(e)}catch(t){0}return e}},{key:"getSetting",value:function(e){return I.Z.getSetting(e)}},{key:"setSetting",value:function(e,t,n){var r=Date.now();I.Z.setSetting(e,{pendingSync:r,v:t}),this._setSettingRemote(e,n)}},{key:"_setSettingRemote",value:function(){var e=c()(w().mark((function e(t,n){var r,i,a,o,s,c;return w().wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,T.Z.onConnectedPromise();case 2:if(!this.api){e.next=12;break}return void 0===n||null===n?r=this.api.user.removeSetting(t):(n=this.encodeValue(n),this.settingsPending[t]=!0,i={v:n,d:this.api.serverTime},r=this.api.user.setSetting(t,i)),e.next=6,r;case 6:a=e.sent,o=a.value,s=a.isDone,o&&(delete this.settingsPending[t],(c=I.Z.getSetting(t)).d=o.d,s&&delete c.pendingSync,I.Z.setSetting(t,c)),e.next=12;break;case 12:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"encryptSettings",value:function(e,t,n){var r=this;return Promise.all(C.default.settings.getEncryptedSettings().map(function(){var i=c()(w().mark((function i(a){var s,c,l,u,d,h;return w().wrap((function(i){for(var p=0;;){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;switch(i.prev=i.next){case 0:return s=o()(a,3),c=s[0],l=s[1],u=s[2],i.next=3,C.default.settings.getEncryptedValue(c,u,n);case 3:d=i.sent,d=r.encodeValue(d),h={v:d,d:r.api.serverTime},t["users/".concat(e,"/s/").concat(l)]=h;case 7:case"end":return i.stop()}}}),i)})));return function(e){return i.apply(this,arguments)}}()))}},{key:"saveBoard",value:function(e,t){var n=this,r=Date.now(),i=Object.assign({pendingSync:r},e);I.Z.saveBoard(i),t||x.Z.timeoutOnce("saveBoardRemote"+e.id,(function(){return n._saveBoardRemote(e)}),100)}},{key:"_saveBoardRemote",value:function(){var e=c()(w().mark((function e(t){var n,r,i,a,o,s,c,l;return w().wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.api){e.next=15;break}return delete(n=x.Z.clone(t)).id,delete n.pendingSync,this.boardsPending[t.id]=!0,(r=x.Z.removeNullUndefined(N.Z.boardOut(n))).d=this.api.serverTime,e.next=9,this.api.user.setBoard(t.id,r);case 9:i=e.sent,a=i.value,o=i.isDone,a&&(delete this.boardsPending[t.id],s=I.Z.getBoard(t.id),(c=a.d)&&((l=L.Z.getById(t.id))&&(l.dateModified=c),s.d=c),o&&(delete s.pendingSync,I.Z.saveBoard(s))),e.next=15;break;case 15:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteBoard",value:function(e){I.Z.deleteBoard(e),this.api&&this.api.user.removeBoard(e)}},{key:"getBoards",value:function(){return I.Z.getBoards()}},{key:"deleteAuthToken",value:function(e){this.api&&(e=e.replace(/\./g,","),this.api.user.removeAuthToken(e))}},{key:"getAPIForDocument",value:function(){var e=c()(w().mark((function e(t){var n;return w().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.api.getDocumentAPI(t.id);case 2:return n=e.sent,e.abrupt("return",n.info);case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAPIForDocumentItems",value:function(){var e=c()(w().mark((function e(t){var n;return w().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.api.getDocumentAPI(t.id);case 2:return n=e.sent,e.abrupt("return",n.items());case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAPIForItem",value:function(e){return this.getAPIForDocumentItems(e.getDocumentOwner())}},{key:"clearAllData",value:function(){var e=c()(w().mark((function e(){var t=this;return w().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,I.Z.clearAllData();case 3:return e.next=5,Promise.all(Object.keys(this.documents).map(function(){var e=c()(w().mark((function e(n){return w().wrap((function(e){for(var r=0,i=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!t.documents[n].isAdmin()){e.next=6;break}return e.next=4,t.getAPIForDocument({id:n});case 4:e.sent.deleteFully();case 6:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return e.abrupt("return",this.api.user.deleteFully());case 8:e.prev=8,e.t0=e.catch(0),x.Z.reportError(e.t0);case 11:case"end":return e.stop()}}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"deleteDocument",value:function(e,t){e.isDeleted.set(!0),T.Z.documentsArray.notify(),this.saveDocument(e,t),this.notifyDocumentsChanged()}},{key:"undeleteDocument",value:function(e,t){e.isDeleted.set(!1),T.Z.documentsArray.notify(),this.saveDocument(e,t)}},{key:"unlistenDocument",value:function(){var e=c()(w().mark((function e(t){return w().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.getAPIForDocument(t);case 2:e.sent.unlisten(),this.api.forgetDocument(t.id),delete this.documents[t.id];case 6:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateOnlineStatus",value:function(e){var t=T.Z.onlineStatus,n=t.get();e||"Connecting"!==n?(x.Z.clearTimeoutOnce("initialOffline"),t.set(e?"Online":"Offline")):b.Z.isOnline()?x.Z.timeoutOnce("initialOffline",(function(){return t.set("Offline")}),2e3):t.set("Offline")}},{key:"resolveItemConflicts",value:function(e,t){var n=this;C.default.PaneUpdateBatcher.beginUpdateItems(),t.forEach((function(t){var r=n.itemsPending[t.id],i=T.Z.getItem(t.id),a=n.getItemData(t.id);r&&i&&(Object.keys(r).forEach((function(o){var s=a[o],c=t[o];if(c===r[o]||c===s)s===c&&delete r[o],delete t[o];else if("text"!==o||t.isDeleted)delete t[o];else{var l="Sync Conflict: ".concat(c,"  ;  ").concat(s);r[o]=t.text,n.handleRemoteItemChange(e,i.id,{text:l}),I.Z.saveItem({id:i.id,text:l,docId:e.id},!0,i),delete t[o]}})),t.isDeleted&&(t.isDeleted=!1,r.isDeleted=!0,n.handleRemoteItemChange(e,t.id,t),i||(i=T.Z.getItem(t.id)),i&&I.Z.saveItem({id:i.id,isDeleted:!1,docId:e.id},!0,i)));var o=t.id;x.Z.isEmpty(t)||n.handleRemoteItemChange(e,o,t)})),C.default.PaneUpdateBatcher.commitUpdateItems()}},{key:"handleRemoteItemChange",value:function(e,t,n,r){var i,a,o=this.getItemData(t);o?(a={id:t,docId:e.id},Object.keys(n).forEach((function(e){o[e]!==n[e]&&("dateModified"!==e&&"id"!==e&&(i=!0),a[e]=n[e])})),Object.keys(o).forEach((function(e){"items"!==e&&e in n&&void 0!==o[e]&&void 0===n[e]&&(a[e]=void 0,i=!0)})),this.checkMissingParentRoot(n,r,T.Z.getItem(t)),i&&o.isDeleted&&!n.isDeleted&&(a.text||a.flags||a)&&(a.isDeleted=!1,I.Z.saveItem({id:t,isDeleted:!1,docId:e.id},!0))):(i=!0,a=n),i&&O.Z.onRemoteChange(e,o,t,a)}},{key:"checkMissingParentRoot",value:function(e,t,n){if(e&&t&&!t.q&&!t.p&&n){try{x.Z.PAssert(212,!1,"BAD ERROR: Detected item with no parent")}catch(i){x.Z.reportError(i)}var r=Object.assign({},n.getFullSaveData(),e);return this._saveItemRemote(n.getDocumentOwner(),r,n)}}},{key:"getEncryptionForDocument",value:function(e){return e.encryptionSentinel?C.default.crypto.getKeyBySentinel(e.encryptionSentinel):e.acl&&Object.keys(e.acl).length>1?C.default.crypto.getGlobalKey():C.default.crypto.getKey(C.default.settings.getBestUserEncryption())}},{key:"_getItemWithText",value:function(e){return{id:e.id,text:e.getRawText()}}},{key:"checkUserEncryption",value:function(e,t){var n=this;if(e){var r=function(){var r;n.loadState.set(D.Z.LoadState.NeedPassword),n._pauseProcessingItemsChanged=!0,C.default.menus.promptComplex({title:"Enter password",text:"Please enter your encryption password to unlock your data.",noCancel:!0,fields:[{type:"password"}],validate:function(){var t=c()(w().mark((function t(n){var i,a,s;return w().wrap((function(t){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(t.prev=t.next){case 0:if(i=o()(n,1),!(a=i[0])){t.next=19;break}return t.prev=2,t.next=5,C.default.crypto.setKey({name:D.Z.EncryptionKeys.UserPassword,password:a,sentinelSalt:b.Z.getEncryptionUid()});case 5:if(s=t.sent,e!==s.sentinel){t.next=10;break}r=s.key,t.next=12;break;case 10:return C.default.crypto.removeKey(D.Z.EncryptionKeys.UserPassword),t.abrupt("return","The password was invalid. Please try again.");case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(2),console.log(t.t0);case 17:t.next=20;break;case 19:return t.abrupt("return","You must enter a password");case 20:case"end":return t.stop()}}}),t,null,[[2,14]])})));return function(e){return t.apply(this,arguments)}}(),callback:function(){var e=c()(w().mark((function e(){return w().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!r){e.next=6;break}return e.next=3,C.default.settings.addEncryptionKey(D.Z.EncryptionKeys.UserPassword,r);case 3:t&&t(),n._pauseProcessingItemsChanged=!1,n._processItemsChange();case 6:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()})},i=C.default.settings.getEncryptionKey(D.Z.EncryptionKeys.UserPassword);i?C.default.crypto.decryptText(i,e,b.Z.getEncryptionUid()).then((function(e){e===D.Z.EncryptionSentinel?t&&t():r()})):r()}else t&&t()}},{key:"_reEncryptDocumentItems",value:function(){var e=c()(w().mark((function e(t,n,r,i){var a,o;return w().wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.getAPIForDocumentItems(n);case 2:return a=e.sent,e.next=5,this.getServerItemDataForDoc(n,i);case 5:return o=e.sent,e.abrupt("return",Promise.all(o.map(function(){var e=c()(w().mark((function e(n){var i,o,s;return w().wrap((function(e){for(var c=0,l=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,N.Z.encryptItemOut({id:n.id,text:n.text},C.default.crypto,r.key);case 2:i=e.sent,N.Z.validateOutFields(i,!0)&&(s=a.getPathForItem(i),t[s+"t"]=null!==(o=i.t)&&void 0!==o?o:"");case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}())));case 7:case"end":return e.stop()}}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"updateDocumentEncryption",value:function(){var e=c()(w().mark((function e(t,n,r){var i,a;return w().wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return i={},n&&n!==C.default.crypto.getKeyInfo(D.Z.EncryptionKeys.Global)?(a=x.Z.cloneObject(C.default.settings.encryptionKeys.get()))[t.id]=n.key:n=C.default.crypto.getKeyInfo(D.Z.EncryptionKeys.Global),i["documents/".concat(t.id,"/p/s")]=n.sentinel,i["userdocuments/".concat(b.Z.getUid(),"/").concat(t.id,"/s")]=n.sentinel,e.prev=4,e.next=7,this._reEncryptDocumentItems(i,t,n,r);case 7:return console.log(i),e.next=10,this.api.commitBatch(i);case 10:a&&(t.encryptionSentinel.set(n.sentinel),C.default.settings.setEncryptionKeys(x.Z.clone(a))),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(4),x.Z.reportError(e.t0);case 16:case"end":return e.stop()}}}),e,this,[[4,13]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"updateUserEncryption",value:function(){var e=c()(w().mark((function e(t,n){var r,i,a,o,s,c,l,u=this;return w().wrap((function(e){for(var d=0;;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.api){e.next=33;break}return r={},a=x.Z.clone(C.default.settings.encryptionKeys.get()),o=x.Z.clone(a),t!==C.default.crypto.getGlobalKeyInfo()?(i=t.sentinel,a[t.name]=t.key):(i=null,delete a[D.Z.EncryptionKeys.UserPassword]),s=C.default.settings.getSettingAbbrev("userEncryptionSentinel"),r[this.api.user.getPathForSettings()+s]={v:i,d:this.api.serverTime},c=Object.keys(this.documents).filter((function(e){return!u.documents[e].encryptionSentinel.get()&&!u.documents[e].isShared()})),e.prev=8,e.next=11,Promise.all(c.map((function(e){return u._reEncryptDocumentItems(r,u.documents[e],t,n)})));case 11:return l=b.Z.getUid(),e.next=14,Le.Z.reEncrypt("users/".concat(l,"/l/"),r,t);case 14:return e.next=16,this.encryptSettings(l,r,t);case 16:return e.next=18,C.default.settings.setEncryptionKeys(a);case 18:return e.prev=18,e.next=21,this.api.commitBatch(r);case 21:null===i&&C.default.crypto.removeKey(D.Z.EncryptionKeys.UserPassword),e.next=28;break;case 24:e.prev=24,e.t0=e.catch(18),C.default.settings.setEncryptionKeys(o),x.Z.reportError(e.t0);case 28:e.next=33;break;case 30:e.prev=30,e.t1=e.catch(8),x.Z.reportError(e.t1);case 33:case"end":return e.stop()}}}),e,this,[[8,30],[18,24]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_checkItemsPendingTimeout",value:function(){var e=this,t={};Object.keys(this.itemsPending).forEach((function(e){var n=I.Z.getItemData(e).docId;n&&(t[n]=!0)})),Object.keys(this.documents).forEach((function(n){e.documents[n].isSyncing.set(!!t[n])}))}},{key:"checkItemsPending",value:function(){x.Z.timeoutOnce("checkItemsPending",this._checkItemsPendingTimeout,100)}},{key:"decryptItemIn",value:function(e,t,n){return N.Z.decryptItemIn(e,t,n)}},{key:"commitBatch",value:function(e){return this.api.commitBatch(e)}},{key:"getServerItemDataForDoc",value:function(){var e=c()(w().mark((function e(t,n,r){var i,a,o,s,l=this;return w().wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.getAPIForDocumentItems(t);case 2:return i=e.sent,e.next=5,i.getRefValue();case 5:return a=e.sent,o=n||t.getBestEncryption(),e.next=9,Promise.all(Object.keys(a).map(function(){var e=c()(w().mark((function e(t){var n,i;return w().wrap((function(e){for(var s=0,c=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:return n=a[t],e.next=3,l.decryptItemIn(Object.assign(n,{id:t}),C.default.crypto,o);case 3:return i=e.sent,e.abrupt("return",r?Object.assign(i,{encryptedText:n.t}):i);case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 9:return s=e.sent,e.abrupt("return",s);case 11:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"checkEncryptionProblemsInAllDocs",value:function(){var e=c()(w().mark((function e(t){var n,r,i=this;return w().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return n=Object.values(this.documents).filter((function(e){return!e.isDeleted.get()})),e.next=3,Promise.all(n.map(function(){var e=c()(w().mark((function e(t){return w().wrap((function(e){for(var n=0,r=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.t0=t,e.next=3,i.detectEncryptionProblems(t);case 3:return e.t1=e.sent,e.abrupt("return",{doc:e.t0,problems:e.t1});case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:if(!((r=(r=e.sent).filter((function(e){return e.problems.length>0}))).length>0)){e.next=14;break}if(e.t0=!t,e.t0){e.next=11;break}return e.next=10,C.default.menus.confirm(t,void 0,{textYes:"OK",textNo:"IGNORE",noIsCancel:!0});case 10:e.t0=e.sent;case 11:if(!e.t0){e.next=14;break}return C.default.menus.openModal(D.Z.Modals.CheckEncryption,{docProblems:r}),e.abrupt("return",!0);case 14:return e.abrupt("return",!1);case 15:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"detectEncryptionProblems",value:function(){var e=c()(w().mark((function e(t,n){var r;return w().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(n){e.next=4;break}return e.next=3,this.getServerItemDataForDoc(t,void 0,!0);case 3:n=e.sent;case 4:return r=n.filter((function(e){return x.Z.containsInvalidCharacter(e.text)})),e.abrupt("return",r);case 6:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fixEncryptionProblems",value:function(){var e=c()(w().mark((function e(t){var n=this;return w().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:t&&t.forEach((function(e){var t=e.docID,r=e.id,i=e.text,a=T.Z.getDocumentById(t),o=T.Z.getItem(r);if(a){var s={id:r,text:i},c=I.Z.getItemData(r);o?o.setText(i,D.Z.ChangeType.Local):(c&&I.Z.saveItem(x.Z.clone(s),!1),n._saveItemRemote(a,s))}}));case 1:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateLastSync",value:function(e){var t=C.default.settings.lastSync;(!t.get()||e>t.get())&&t.set(e)}}]),n}(R.n),_()(Ce.prototype,"onLoadLocal",[S.ZP],Object.getOwnPropertyDescriptor(Ce.prototype,"onLoadLocal"),Ce.prototype),_()(Ce.prototype,"onLoadRemoteDocuments",[S.ZP],Object.getOwnPropertyDescriptor(Ce.prototype,"onLoadRemoteDocuments"),Ce.prototype),_()(Ce.prototype,"_runCoalescedChanges",[S.ZP],Object.getOwnPropertyDescriptor(Ce.prototype,"_runCoalescedChanges"),Ce.prototype),_()(Ce.prototype,"clearAllData",[S.ZP],Object.getOwnPropertyDescriptor(Ce.prototype,"clearAllData"),Ce.prototype),_()(Ce.prototype,"_checkItemsPendingTimeout",[S.ZP],Object.getOwnPropertyDescriptor(Ce.prototype,"_checkItemsPendingTimeout"),Ce.prototype),Ce)},5340:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(8855),c=n(5193);const l=new(function(){function e(){i()(this,e),this._itemsWithoutParent=[]}return o()(e,[{key:"onRemoteChange",value:function(e,t,n,r,i){var a=c.Z.getItem(n),o=s.Z.ChangeType.Remote;r.parent||t&&(r.parent=t.parent);var l=c.Z.getItem(r.parent);if(l)if(a){if(32===(32&r.flags))!!(a.isDeleted()||r.isDeleted?void 0:a)!==l.hasNote()&&l.setNote(a.isDeleted()||r.isDeleted?void 0:a,o);a.onChangeRemote(r,o)}else if(!t||!t.isDeleted){var u=Object.assign({},t,r);(a=c.Z.createVMLI(u,{parent:l,changeType:o,documentOwner:e})).onChangeRemoteParentOrIndex({id:u.id,parent:u.parent,index:u.index,flags:u.flags})}i||(l||this._itemsWithoutParent.push({doc:e,localValue:t,itemId:n,value:r}),this.tryMissingItems())}},{key:"tryMissingItems",value:function(){for(var e=0,t=0;t<this._itemsWithoutParent.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(c.Z.getItem(this._itemsWithoutParent[t].value.parent)){var n=this._itemsWithoutParent[t],r=n.doc,i=n.localValue,a=n.itemId,o=n.value;this.onRemoteChange(r,i,a,o,!0),this._itemsWithoutParent.splice(t,1),t--}}}}]),e}())},9603:(e,t,n)=>{"use strict";n.d(t,{Z:()=>P});var r,i=n(4575),a=n.n(i),o=n(3913),s=n.n(o),c=n(3124),l=n.n(c),u=n(8572),d=n(9276),h=n(8855),p=(n(7484),n(8651)),f=n(7151),g=n(4654),m=n(1095),v=n(4327),y=n(7274),k=/(Mo|Di|Mi|Do|Fr|Sa|So), \d/,_={Mo:"Mon",Di:"Tue",Mi:"Wed",Do:"Thu",Fr:"Fri",Sa:"Sat",So:"Sun"},Z=/^((?:lun|mar|mer|jeu|ven|sam|dim)\. )\d/,w=/(\d{1,2} )((?:janv|f\xe9vr|avr|juin|juil||sept|oct|nov|d\xe9c)\.?)( \d{4})/,b={janv:"janvier","f\xe9vr":"f\xe9vrier",avr:"avril",juin:"juin",juil:"juillet",sept:"septembre",oct:"octobre",nov:"novembre","d\xe9c":"d\xe9cembre"};const P=new(r=function(){function e(){a()(this,e),this.todayObs=new y.Z(this.today),this.resetToday(),v.Z.listen("beforeDateChanged",this.resetToday)}return s()(e,[{key:"parseDate",value:function(e){return new Date(e)}},{key:"parseText",value:function(e){var t,n=(e=e.toLowerCase()).substring(e.indexOf("every")),r=e.includes("every")&&f.Ci.parseText(n,void 0);if(r){try{p.Z.PAssert(466,!(r.options.interval<0),"Interval set to negative",e)}catch(w){p.Z.reportError(w)}var i=r.options,a=r.fromDate,o=r.duration;a||(a=new Date,a=this.toUTCDate(a));var s=Object.assign({dtstart:a},i);delete s.interval;var c=new f.Ci(s).after(a,!0);if(c){c=this.UTCtoLocal(c);var l=i.byhour?i.byhour[0]:0,u=i.byminute?i.byminute[0]:0;c.setHours(l),c.setMinutes(u),c.setSeconds(0),c.setMilliseconds(0),c=new Date(this.toUTCDate(c).getTime()),i.dtstart=c,i.until&&(i.until=new Date(c.getTime()+i.until.getTime()-a.getTime())),t=m.Z.fromRRuleOptions(i,o?o*h.Z.MSPerMinute:void 0)}}else{var v=e.replace(/\./g,"/"),y=d.parse(v,void 0,{forwardDate:!0})[0];if(y){var k=g.default.parseDate(y.text);if(k){var _,Z=e.substring(y.index+y.text.length).trim().match(f.ag.tokens.duration);Z&&(_=Math.round(+Z[1]*("h"===Z[2][0]?h.Z.MSPerHour:h.Z.MSPerMinute))),t=new m.Z(k,{duration:_})}}}return t}},{key:"toUTCDate",value:function(e){return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()))}},{key:"UTCtoLocal",value:function(e){return new Date(e.getTime()+e.getTimezoneOffset()*h.Z.MSPerMinute)}},{key:"toHumanText",value:function(e,t){if(!e)return"";var n=+this.clearTime(e)-this.todayTime,r="";return t||(n<0&&n>=-864e5?r="Yesterday":this.isToday(e)?r="Today":n>0&&n<1728e5&&(r="Tomorrow")),r||(r=this.getHumanText(e)),e.hasTimeOfDay()&&(r+=" "+this.getTimeText(e)),r}},{key:"resetToday",value:function(){this.today=Date.today(),this.todayTime=this.today.getTime(),this.datesCleared={},this.humanText={},this.timeText={},this.todayObs.set(this.today)}},{key:"getToday",value:function(){return this.today}},{key:"getTodayTime",value:function(){return this.todayTime}},{key:"isToday",value:function(e){try{p.Z.PAssert(467,e&&p.Z.isDateValid(e),"Date is invalid",e)}catch(n){p.Z.reportError(n)}var t=+e;return t>=this.todayTime&&t<this.todayTime+h.Z.MSPerDay}},{key:"_clearTime",value:function(e){return this.datesCleared[e]=new Date(e),this.datesCleared[e].setHours(0,0,0,0),this.datesCleared[e]}},{key:"clearTime",value:function(e){var t=+e;return this.datesCleared[t]||this._clearTime(t)}},{key:"clearTimeClone",value:function(e){return this.clearTime(e).clone()}},{key:"getTodayPlusDays",value:function(e){return this.getDatePlusDays(this.getToday(),e)}},{key:"getDatePlusDays",value:function(e,t){var n=+e+t*h.Z.MSPerDay;return this.datesCleared[n]||(this.datesCleared[n]=new Date(n))}},{key:"getDatePlusMS",value:function(e,t){return new Date(+e+t)}},{key:"getTodayPlusMS",value:function(e){return this.getDatePlusMS(this.getToday(),e)}},{key:"isSameDay",value:function(e,t){return+this.clearTime(e)===+this.clearTime(t)}},{key:"getHumanText",value:function(e){var t=+e;return this.humanText[t]||(this.humanText[t]=e.toString(g.default.International.getFormat(e.getFullYear()!==this.today.getFullYear()?h.Z.DFormat.MonthDayYear:h.Z.DFormat.MonthDay))),this.humanText[t]}},{key:"getTimeText",value:function(e){var t=+e;return this.timeText[t]||(this.timeText[t]=e.toString("h:mmtt").toLowerCase())}},{key:"getNextRoundTime",value:function(e){var t=(null===e||void 0===e?void 0:e.clone())||new Date;return t.setHours(t.getHours()+1,0,0,0),t}},{key:"parseInternationalDate",value:function(e){if(e){var t=e.match(k);if(t){var n=t[1],r=_[n];r&&(e=e.replace(n,r).replace("-","/"))}var i=e.match(Z);i&&(e=(e=e.substr(i[1].length)).replace(w,(function(e,t,n,r){return t+b[n.replace(".","")]+r})))}return d.parseDate(e)}},{key:"testGetNext",value:function(e,t,n){}},{key:"testOnDate",value:function(e,t,n){}}]),e}(),l()(r.prototype,"resetToday",[u.ZP],Object.getOwnPropertyDescriptor(r.prototype,"resetToday"),r.prototype),l()(r.prototype,"_clearTime",[u.ZP],Object.getOwnPropertyDescriptor(r.prototype,"_clearTime"),r.prototype),r)},4327:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var r=n(4575),i=n.n(r),a=n(2205),o=n.n(a),s=n(8585),c=n.n(s),l=n(9754),u=n.n(l);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=u()(e);if(t){var i=u()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return c()(this,n)}}const h=new(function(e){o()(n,e);var t=d(n);function n(){return i()(this,n),t.apply(this,arguments)}return n}(n(92).Z))},8270:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});var r=n(8926),i=n.n(r),a=n(4575),o=n.n(a),s=n(3913),c=n.n(s),l=n(7757),u=n.n(l),d=n(8651),h=n(8855),p=n(9541),f=n(1186);const g=function(){function e(t,n,r,i,a,s,c){o()(this,e),this.file=t,this.properties=i,this.contentType=t.type,this.accountID=n,this.folder=r,this.onComplete=s||d.Z.emptyFn,this.onError=c||d.Z.emptyFn,this.onProgress=a||d.Z.emptyFn,this._callbacks=[],this.offset=0,this._isDone=!1,this._isRunning=!1,this._hasStarted=!1,this._isCanceled=!1,this._hasError=!1;this.url=this._buildURL(void 0,{uploadType:"resumable"}),this._percent=0}return c()(e,[{key:"upload",value:function(){var e=this;this._hasStarted=!0,f.Z.getAccountAuthToken(this.accountID,[h.Z.GScope.Drive],function(){var t=i()(u().mark((function t(n){var r,i,a,o,s,c;return u().wrap((function(t){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(t.prev=t.next){case 0:if(!n){t.next=26;break}if(r={Authorization:"Bearer "+n.access_token,"Content-Type":"application/json","X-Upload-Content-Length":e.file.size,"X-Upload-Content-Type":e.contentType},!e.folder.named){t.next=8;break}return t.next=5,p.Z.getFolder(e.accountID,e.folder.named);case 5:t.t0=t.sent,t.next=9;break;case 8:t.t0=e.folder.id;case 9:i=t.t0,a={title:e.file.customName||e.file.name,mimeType:e.contentType,parents:i?[{id:i}]:[]},e.properties&&(a.properties=Object.keys(e.properties).map((function(t){return{key:t,value:e.properties[t],visibility:"PRIVATE"}})));try{o=JSON.stringify(a)}catch(u){d.Z.reportError(u)}if(!o){t.next=25;break}return t.prev=14,t.next=17,d.Z.XHR({url:e.url,type:"POST",headers:r,data:o,autoRetry:!0});case 17:(s=t.sent).status<h.Z.HTTPStatusCode.BadRequest?(c=s.getResponseHeader("Location"),e.url=c,e._runUpload()):e._onError(s),t.next=23;break;case 21:t.prev=21,t.t1=t.catch(14);case 23:t.next=26;break;case 25:e._onError();case 26:case"end":return t.stop()}}}),t,null,[[14,21]])})));return function(e){return t.apply(this,arguments)}}())}},{key:"_runUpload",value:function(){var e=this;try{d.Z.PAssert(447,this.url,"Must have a valid remote URL to run upload")}catch(i){d.Z.reportError(i)}this._isRunning=!0;var t=Math.min(this.offset+1048576,this.file.size),n=this.file.slice(this.offset,t),r={"Content-Type":this.contentType,"Content-Range":"bytes "+this.offset+"-"+(t-1)+"/"+this.file.size,"X-Upload-Content-Type":this.contentType};d.Z.XHR({url:this.url,type:"PUT",headers:r,data:n,autoRetry:!0}).then((function(t){if(t.status===h.Z.HTTPStatusCode.Success||t.status===h.Z.HTTPStatusCode.Created)e.isCanceled()||e._onComplete(t);else if(t.status===h.Z.HTTPStatusCode.PermRedirect){var n=e._extractRange(t.getResponseHeader("Range"));e.offset=n,e._onProgress(e.offset/e.file.size),e.isCanceled()||e._runUpload()}else e._onError(t)}))}},{key:"resume",value:function(){var e=this;try{d.Z.PAssert(448,!this.isDone(),"Should not resume a completed upload")}catch(n){d.Z.reportError(n)}try{d.Z.PAssert(449,this._hasStarted,"Must have started an upload to resume it")}catch(n){d.Z.reportError(n)}try{d.Z.PAssert(450,this.url,"Must have a valid remote URL to resume upload")}catch(n){d.Z.reportError(n)}if(this._hasError=!1,this._isCanceled=!1,this._isRunning)0;else if(this._isRunning=!0,this._hasStarted&&this.url){var t={"Content-Range":"bytes */"+this.file.size,"X-Upload-Content-Type":this.contentType};d.Z.XHR({url:this.url,type:"PUT",headers:t,autoRetry:!0}).then((function(t){if(t.status===h.Z.HTTPStatusCode.PermRedirect){var n=e._extractRange(t.getResponseHeader("Range"));e.offset=n,e._onProgress(e.offset/e.file.size),e._runUpload()}else e._onError(t)}))}else this.upload()}},{key:"cancel",value:function(){try{d.Z.PAssert(451,!this._isDone,"Cannot cancel an upload that is already complete")}catch(e){d.Z.reportError(e)}this._isCanceled=!0,this._isRunning=!1}},{key:"_onError",value:function(e){this._hasError=!0,this._isRunning=!1,this.onError()}},{key:"_onComplete",value:function(e){var t=0;try{d.Z.PAssert(452,!this._isDone,"Should not call the complete CB twice")}catch(i){d.Z.reportError(i)}try{d.Z.PAssert(453,!this._isCanceled,"Should not be able to complete a canceled upload")}catch(i){d.Z.reportError(i)}this._isDone=!0,this._isRunning=!1;var n={};if(e&&e.response)try{n=JSON.parse(e.response)}catch(a){d.Z.reportError(a)}this._onProgress(1),this.onComplete(n);for(var r=0;r<this._callbacks.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{this._callbacks[r](n)}catch(a){d.Z.reportError(a)}}this._callbacks=[]}},{key:"_onProgress",value:function(e){try{d.Z.PAssert(454,!this._hasError,"Should not make forward progress when an error has occurred")}catch(t){d.Z.reportError(t)}this._percent=e,this.onProgress(e)}},{key:"_extractRange",value:function(e){return d.Z.parseInt(e.match(/\d+/g).pop())+1}},{key:"_buildQueryString",value:function(e){return e=e||{},Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")}},{key:"_buildURL",value:function(e,t){var n="https://www.googleapis.com/upload/drive/v2/files/";e&&(n+=e);var r=this._buildQueryString(t);return r&&(n+="?"+r),n}},{key:"notifyOnComplete",value:function(e){try{d.Z.PAssert(455,this._callbacks.indexOf(e)<0,"Should not include fn twice")}catch(t){d.Z.reportError(t)}try{d.Z.PAssert(456,!this.isDone(),"Should not notify on complete after done")}catch(t){d.Z.reportError(t)}try{d.Z.PAssert(457,!this.hasError(),"Should not notify on complete after error")}catch(t){d.Z.reportError(t)}this._callbacks.push(e)}},{key:"isCanceled",value:function(){return this._isCanceled}},{key:"isDone",value:function(){return this._isDone}},{key:"isRunning",value:function(){return this._isRunning}},{key:"hasError",value:function(){return this._hasError}},{key:"getPercent",value:function(){return this._percent}}]),e}()},5216:(e,t,n)=>{"use strict";n.d(t,{Z:()=>B});var r,i=n(4575),a=n.n(i),o=n(3913),s=n.n(o),c=n(3124),l=n.n(c),u=n(8572),d=n(8855),h=n(8651),p=n(4654),f=n(3656),g=n(1392),m=n(3868),v=", . ? ! ) ( : ; [ ] ' \" _".split(" "),y=", . ? ! ; :".split(" "),k=0,_=window.__PARSE_STATS={total:0,parseText:0,parseNote:0,parseSinglePlugin:0},Z=/(^#|[\(\s-]#)([^\s\[\]\(\)*#\'\"\uFEFE]*)/g,w=/(?:(?:\u2001|\u2003)(p:[^\u2001\u2003]+)(?:\u2001|\u2003))/gi,b=d.Z.Regexp.Prefix,P=d.Z.Regexp.WebURL,S=d.Z.Regexp.WebURLWithProtocol,D=/^(\#+|\^|\-|\*|\[(?: ?\])?|\]|[0-9]+\.) (```[A-Za-z]*|\\`\\`\\`|\\=\\=\\=|\#+|\^|\-|\*|\[(?: ?\])?|\]|[0-9]+\.) /gi,I=d.Z.Regexp.MDLink,E=/^(-{3,})$/g,x=/^(={3,})$/g,C=/\b([^<>\s]+@[^<>\s]+\.[^<>\s]+)\b/gi,A=d.Z.Regexp.Interlink,L=d.Z.Regexp.InterlinkMirror,M=/\\([\*_=~])/g,T=/\\(`)/g,R=d.Z.Regexp.DataImage,O=/file:\/{3}(\S)*/,F={regexp:/(^|[^\\])(`)([^`]+?)\2/g,isCode:!0},N=[{regexp:/(^|[^\\])(\*\*\*)(.+?)\2/g},{regexp:/(^|[^\\])(\*\*)(.+?)\2/g},{regexp:/(^|[^\\])(\*)(.+?)\2/g},{isStrike:!0,regexp:/(^|[^\\])(~~)(.+?)\2/g},{isUnderline:!0,regexp:/(^|[^\\])(__)(.+?)\2/g},{isHighlight:!0,regexp:/(^|[^\\])(==)(.+?)\2/g}];const B=new(r=function(){function e(){a()(this,e)}return s()(e,[{key:"isFlagSet",value:function(e,t){return(e&t)===t}},{key:"trimPunc",value:function(e){return e.replace(/[:,\.\'\"\)\]\*_]*$/g,"")}},{key:"insertElNew",value:function(e,t,n,r){return e.insert(t,n,r)}},{key:"_notifyParse",value:function(e){_.total++,_[e]++}},{key:"runParseSinglePlugin",value:function(e,t){return this.parseSinglePlugin(e.getRawText(),t)}},{key:"parseSinglePlugin",value:function(e,t){if(this._notifyParse("parseSinglePlugin"),!e||0===e.length)return{parsedText:void 0,els:void 0};try{h.Z.PAssert(270,!k,"We do not support recursive calls to parse")}catch(o){h.Z.reportError(o)}var n,r;if(k++,"\u2001"===e[0]||"\u2003"===e[0]){var i=!h.Z.isFlagSet(t,d.Z.ChangeType.ItemLoad),a=p.default.pluginManager.parseAttachmentEmbedString(e.slice(1,-1),i);r=[a],e=d.Z.AttachChar,i&&(n=[new g.Z(d.Z.AttachChar,a.displayElement.attrs)])}else n=[new g.Z(e)];return k--,{parsedText:e,attachments:r,elsNew:n}}},{key:"parseNoteNew",value:function(e){return this._notifyParse("parseNote"),{elsNew:new m.Z(e.getRawText())}}},{key:"runParseTextNew",value:function(e,t){return this.parseTextNew(e,e.getRawText(),f.Z.getContacts(),void 0,t)}},{key:"whiteoutText",value:function(e,t,n){return e=e.substr(0,t)+" ".repeat(n)+e.substr(t+n)}},{key:"insertLink",value:function(e,t,n,r,i,a,o){if(r){var s=!!h.Z.parseEvernoteLink(r),c=h.Z.isOneNoteLink(r),l=h.Z.isBearLink(r),u=h.Z.isFileLink(r),d={text:a,href:r,appLink:(s?"evernote":c&&"onenote")||l&&"bear"||u&&"file"||void 0,isImage:i||h.Z.isUrlImage(r),showImage:i,imageSize:o&&+o.replace(/\s|=|x/g,"")};return this.insertElNew(e,t,n,{link:d})}}},{key:"parseFormat",value:function(e,t,n,r){var i,a=0,o=n.regexp,s=n.isUnderline,c=n.isStrike,l=n.isCode,u=n.isHighlight;for(o.lastIndex=0;null!==(i=o.exec(t));){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!this.isInTag(i)){var h=i[1].length,p=i[2].length,f=i[3],g={};s?g.underline=!0:c?g.strike=!0:l?g.code=!0:u?g.highlight=!0:(p>=2&&(g.bold=!0),2!==p&&(g.italic=!0));var m=i.index+h;this.insertElNew(e,m,p,Object.assign({formatting:!0},g)),this.insertElNew(e,m+p,f.length,g),this.insertElNew(e,m+p+f.length,p,Object.assign({formatting:!0},g)),t=this.whiteoutText(t,m+p+f.length,p),t=this.whiteoutText(t,m,p),o.lastIndex=0,r|=d.Z.RegexpFlags.Markdown}}return{regexpFlags:r,itemText:t}}},{key:"parseTextNew",value:function(e,t,n,r,i){e||(e={}),this._notifyParse("parseText");try{h.Z.PAssert(271,!k,"We do not support recursive calls to parse")}catch(Be){h.Z.reportError(Be)}k++;var a,o,s,c,l,u,f,g,_=t,D=t,B=0,U=0,j=i||!e.regexpFlags?d.Z.RegexpFlags.All:e.regexpFlags,H=new m.Z(t);if(t&&t.length>0&&(!r&&j>0&&(j&d.Z.RegexpFlags.Prefix)===d.Z.RegexpFlags.Prefix&&(b.lastIndex=0,null!==(a=b.exec(t))&&(f=a[1],B=a[0].length,f&&(g=0===f.indexOf("#")||0===f.indexOf("^")?"header":"["===f||"[]"===f||"[ ]"===f||"]"===f?"task":"*"===f||"-"===f?"bullet":f.startsWith("```")?"code":"numList",this.insertElNew(H,0,B,{prefixType:g}),D=(t=this.whiteoutText(t,a.index,B)).substr(B),U|=d.Z.RegexpFlags.Prefix))),"code"!==g)){if(j>0&&(j&d.Z.RegexpFlags.DataImage)===d.Z.RegexpFlags.DataImage)for(var V=0;null!==(a=R.exec(t));){if(V++>5e3&&__infLoop&&__infLoop(V))throw new RangeError;this.insertLink(H,a.index,a[0].length,a[1],!0,void 0,a[2]),t=this.whiteoutText(t,a.index,a[0].length),U|=d.Z.RegexpFlags.DataImage}if(j>0&&(j&d.Z.RegexpFlags.Plugin)===d.Z.RegexpFlags.Plugin){var W=0;for(w.lastIndex=0;null!==(a=w.exec(t));){if(W++>5e3&&__infLoop&&__infLoop(W))throw new RangeError;var z=p.default.pluginManager.parseAttachmentEmbedString(a[1],!0);this.insertElNew(H,a.index,a[0].length,{plugin:z}),t=this.whiteoutText(t,a.index,a[0].length),c?c.push(z):c=[z],U|=d.Z.RegexpFlags.Plugin}}if(j>0&&(j&d.Z.RegexpFlags.Date)===d.Z.RegexpFlags.Date){var q=t.indexOf(d.Z.CharDate);if(q>=0&&e){var G={p:d.Z.PluginID.Date,id:e.id,itemID:e.id};G.displayElement=p.default.pluginManager.createDisplayElement(G,!0),this.insertElNew(H,q,1,{date:G}),c?c.push(G):c=[G],U|=d.Z.RegexpFlags.Date}}if(j>0&&(j&d.Z.RegexpFlags.MDLink)===d.Z.RegexpFlags.MDLink){var K=0;for(I.lastIndex=0;null!==(a=I.exec(t));){if(K++>5e3&&__infLoop&&__infLoop(K))throw new RangeError;var Y="!"===a[1],X=a[2],Q=a[3];if(Q){var J=a[0].length;if(Q.endsWith(")")){var $=h.Z.cropStringWithMatchingParens(Q);$.length!==Q.length&&(J-=Q.length-$.length,Q=$)}Y?this.insertLink(H,a.index,J,Q,!0,X,a[4]):this.insertLink(H,a.index,J,Q,!1,X),t=this.whiteoutText(t,a.index,J),U|=d.Z.RegexpFlags.MDLink}}}if(!e||j>0&&(j&d.Z.RegexpFlags.WebUrl)===d.Z.RegexpFlags.WebUrl){var ee=0,te=0;for(S.lastIndex=0;null!==(a=S.exec(t));){if(ee++>5e3&&__infLoop&&__infLoop(ee))throw new RangeError;var ne=a[4]||a[5],re=a[3];if(!ne)break;var ie=a[1].length,ae=(re?re+"://":"")+ne,oe="!"===a[2],se=a.index+ie,ce=a[0].length-ie;this.insertLink(H,se,ce,ae,oe)&&(t=this.whiteoutText(t,se,ce)),U|=d.Z.RegexpFlags.WebUrl}for(P.lastIndex=0;null!==(a=P.exec(t));){if(te++>5e3&&__infLoop&&__infLoop(te))throw new RangeError;var le=a[3];if(!le)break;var ue=a[1].length,de="!"===a[2],he=a.index+ue,pe=a[0].length-ue;this.insertLink(H,he,pe,le,de)&&(t=this.whiteoutText(t,he,pe)),U|=d.Z.RegexpFlags.WebUrl}}if(!e||j>0&&(j&d.Z.RegexpFlags.FileUrl)===d.Z.RegexpFlags.FileUrl){var fe=0;for(O.lastIndex=0;null!==(a=O.exec(t));){if(fe++>5e3&&__infLoop&&__infLoop(fe))throw new RangeError;var ge=a[0];this.insertLink(H,a.index,a[0].length,ge,!1)&&(t=this.whiteoutText(t,a.index,a[0].length)),U|=d.Z.RegexpFlags.FileUrl}}if(j>0&&(j&d.Z.RegexpFlags.MarkdownEscaped)===d.Z.RegexpFlags.MarkdownEscaped)for(var me=0;null!==(a=T.exec(t));){if(me++>5e3&&__infLoop&&__infLoop(me))throw new RangeError;this.insertElNew(H,a.index,2,{escaped:a[1]}),U|=d.Z.RegexpFlags.MarkdownEscaped}if(j>0&&(j&d.Z.RegexpFlags.Markdown)===d.Z.RegexpFlags.Markdown){var ve=this.parseFormat(H,t,F,U);U=ve.regexpFlags,t=ve.itemText}if(j>0&&(j&d.Z.RegexpFlags.MarkdownEscaped)===d.Z.RegexpFlags.MarkdownEscaped)for(var ye=0;null!==(a=M.exec(t));){if(ye++>5e3&&__infLoop&&__infLoop(ye))throw new RangeError;this.insertElNew(H,a.index,2,{escaped:a[1]}),U|=d.Z.RegexpFlags.MarkdownEscaped}if(j>0&&(j&d.Z.RegexpFlags.Markdown)===d.Z.RegexpFlags.Markdown)for(var ke=0,_e=0;_e<N.length;_e++){if(ke++>5e3&&__infLoop&&__infLoop(ke))throw new RangeError;var Ze=this.parseFormat(H,t,N[_e],U);U=Ze.regexpFlags,t=Ze.itemText}if(j>0&&(j&d.Z.RegexpFlags.HR)===d.Z.RegexpFlags.HR&&(E.lastIndex=0,null!==(a=E.exec(D))&&(this.insertElNew(H,a.index+B,a[0].length,{hr:!0}),U|=d.Z.RegexpFlags.HR),x.lastIndex=0,null!==(a=x.exec(D))&&(this.insertElNew(H,a.index+B,a[0].length,{hr:!0,hrHeavy:!0}),U|=d.Z.RegexpFlags.HR)),!c&&j>0&&(j&d.Z.RegexpFlags.Email)===d.Z.RegexpFlags.Email){var we=0;for(C.lastIndex=0;null!==(a=C.exec(t));){if(we++>5e3&&__infLoop&&__infLoop(we))throw new RangeError;this.insertElNew(H,a.index,a[0].length,{email:!0}),U|=d.Z.RegexpFlags.Email}}if(j>0&&(j&d.Z.RegexpFlags.Contact)===d.Z.RegexpFlags.Contact&&n&&Object.keys(n).length>0){var be=t.split(d.Z.ContactPrefix);if(be.length>1){var Pe=0,Se=be[0].length;be=be.slice(1);for(var De=0;De<be.length;De++){if(Pe++>5e3&&__infLoop&&__infLoop(Pe))throw new RangeError;var Ie=be[De],Ee=void 0;if(" "!==Ie[0]&&!v.includes(Ie[0]))for(var xe=0,Ce=0;Ce<Ie.length;Ce++){if(xe++>5e3&&__infLoop&&__infLoop(xe))throw new RangeError;var Ae=Ie.substr(0,Ce+1);n[Ae]&&(Ee=Ae)}Ee&&(s?s.push(Ee):s=[Ee],this.insertElNew(H,Se,Ee.length+1,{contact:!0}),U|=d.Z.RegexpFlags.Contact),Se+=Ie.length+d.Z.ContactPrefix.length}}}if(j>0&&(j&d.Z.RegexpFlags.Tag)===d.Z.RegexpFlags.Tag){var Le=0;for(Z.lastIndex=0;null!==(a=Z.exec(t));){var Me=0;if(Le++>5e3&&__infLoop&&__infLoop(Le))throw new RangeError;for(var Te=a.index+a[1].length-1,Re=a[2].length+1,Oe=a[2];y.indexOf(Oe.charAt(Oe.length-1))>=0;){if(Me++>5e3&&__infLoop&&__infLoop(Me))throw new RangeError;Re--,Oe=Oe.substr(0,Oe.length-1)}Oe&&(o?o.push(Oe):o=[Oe]),this.insertElNew(H,Te,Re,{tag:!0}),U|=d.Z.RegexpFlags.Tag}}if(j>0&&(j&d.Z.RegexpFlags.ItemLink)===d.Z.RegexpFlags.ItemLink){var Fe=0;for(A.lastIndex=0;null!==(a=A.exec(t));){if(Fe++>5e3&&__infLoop&&__infLoop(Fe))throw new RangeError;l||(l=[]),l.push(a[1]),this.insertElNew(H,a.index,a[0].length,{itemLink:a[1]}),U|=d.Z.RegexpFlags.ItemLink}}if(j>0&&(j&d.Z.RegexpFlags.ItemMirror)===d.Z.RegexpFlags.ItemMirror){var Ne=0;for(L.lastIndex=0;null!==(a=L.exec(t));){if(Ne++>5e3&&__infLoop&&__infLoop(Ne))throw new RangeError;l||(l=[]),l.push(a[1]),u=!0,this.insertElNew(H,a.index,a[0].length,{itemLink:a[1],mirror:u}),U|=d.Z.RegexpFlags.ItemMirror}}c&&(w.lastIndex=0,_=_.replace(w,d.Z.AttachChar))}return k--,{tags:o,attachments:c,contacts:s,prefix:f,prefixType:g,elsNew:H,parsedText:_,itemLinks:l,isMirror:u,regexpFlags:U}}},{key:"isInTag",value:function(e){for(var t=0,n=e.index;n>=0;n--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "===e.input[n])return!1;if("#"===e.input[n])return!0}return!1}},{key:"checkMultiplePrefixes",value:function(e){D.lastIndex=0;var t=D.exec(e);return t&&(e=t[2]+" "+e.substr(t[0].length)),e=e.replace(/^\\`\\`\\` /,"``` ").replace(/^\\=\\=\\=/,"===")}}]),e}(),l()(r.prototype,"runParseSinglePlugin",[u.ZP],Object.getOwnPropertyDescriptor(r.prototype,"runParseSinglePlugin"),r.prototype),l()(r.prototype,"runParseTextNew",[u.ZP],Object.getOwnPropertyDescriptor(r.prototype,"runParseTextNew"),r.prototype),r)},92:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(8651);const c=function(){function e(){i()(this,e)}return o()(e,[{key:"_ensureListeners",value:function(){return this._listeners||(this._listeners={}),this._listeners}},{key:"clearListeners",value:function(){this._listeners=void 0}},{key:"listen",value:function(){for(var e=0,t=0,n=0,r=this._ensureListeners(),i=arguments.length,a=new Array(i),o=0;o<i;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a[o]=arguments[o]}for(var c=0;c<a.length-1;++c){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{s.Z.PAssert(288,"callbacks"!==a[c],"Invalid event name/grouping")}catch(u){s.Z.reportError(u)}try{s.Z.PAssert(289,s.Z.isString(a[c])||s.Z.isFunction(a[c]),"Only accept string or functions for listen")}catch(u){s.Z.reportError(u)}r[a[c]]||(r[a[c]]={callbacks:[]}),r=r[a[c]]}var l=a[a.length-1];try{s.Z.PAssert(290,s.Z.isFunction(l),"Listeners must always be valid functions")}catch(u){s.Z.reportError(u)}try{s.Z.PAssert(291,r.callbacks.indexOf(l)<0,"Should never listen with the same function twice")}catch(u){s.Z.reportError(u)}r.callbacks.push(l)}},{key:"isListening",value:function(){for(var e=0,t=0,n=0,r=this._ensureListeners(),i=arguments.length,a=new Array(i),o=0;o<i;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a[o]=arguments[o]}var c=a[a.length-1];try{s.Z.PAssert(292,s.Z.isFunction(c),"Listeners must always be valid functions")}catch(u){s.Z.reportError(u)}for(var l=0;l<a.length-1;++l){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r[a[l]]&&(r=r[a[l]])}return r&&r.callbacks&&r.callbacks.indexOf(c)>=0}},{key:"unlisten",value:function(){for(var e=0,t=0,n=0,r=this._ensureListeners(),i=arguments.length,a=new Array(i),o=0;o<i;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a[o]=arguments[o]}var c=a[a.length-1];try{s.Z.PAssert(293,s.Z.isFunction(c),"Listeners must always be valid functions")}catch(u){s.Z.reportError(u)}for(var l=0;l<a.length-1;++l){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{s.Z.PAssert(294,"callbacks"!==a[l],"Invalid event name/grouping")}catch(u){s.Z.reportError(u)}try{s.Z.PAssert(295,s.Z.isString(a[l]),"Only accept string for unlisten")}catch(u){s.Z.reportError(u)}try{s.Z.PAssert(296,r[a[l]],"Cannot unlisten something that has never been listened")}catch(u){s.Z.reportError(u)}r[a[l]]&&(r=r[a[l]])}try{s.Z.PAssert(297,r&&r.callbacks&&r.callbacks.indexOf(c)>=0,"Cannot unlisten something that has never been listened")}catch(u){s.Z.reportError(u)}r.callbacks&&r.callbacks.remove(c)}},{key:"fireEvent",value:function(){for(var e=0,t=0,n=0,r=!0,i=this._ensureListeners(),a=arguments.length,o=new Array(a),c=0;c<a;c++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;o[c]=arguments[c]}var l=o[o.length-1];try{s.Z.PAssert(298,void 0===l||s.Z.isArray(l),"Last argument to fireEvent must be an array")}catch(p){s.Z.reportError(p)}for(var u=0;u<o.length-1;++u){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{s.Z.PAssert(299,"callbacks"!==o[u],"Invalid event name/grouping")}catch(p){s.Z.reportError(p)}try{s.Z.PAssert(300,s.Z.isString(o[u])||s.Z.isArray(o[u]),"Only accept strings for firing event")}catch(p){s.Z.reportError(p)}if(!i[o[u]])break;var d=0;i=i[o[u]];for(var h=0;h<i.callbacks.length;++h){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;try{r=i.callbacks[h].apply(this,l)&&r}catch(f){s.Z.reportError(f)}}}return r}}]),e}()},9105:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var r=function(e){var t={};return Object.keys(e).forEach((function(n){t[e[n]]=n})),t},i=function(e){return"string"===typeof e},a={billingID:"b",displayName:"n",gid:"g",earlyAdopter:"x",email:"e",fname:"f",lname:"l",inviteCode:"i",invoiceAddress:"a",invoiceCompany:"c",invoiceEmail:"d",joinDate:"j",monthlyInvoice:"m",nextBillingDate:"o",planID:"h",picture:"p",premiumCode:"k",premiumSignupDate:"q",premiumEndDate:"r",premiumStatus:"s",subscriptionID:"v",trialDuration:"u",trialExtended:"w",trialStart:"t",isUnsubscribed:"y",appleIAPPlan:"z",appleIAPTransactionId:"aa"},o=r(a),s={items:!0},c={dateCreated:"c",dateCompleted:"e",dateModified:"d",date:"b",flags:"f",id:"id",index:"i",isArchived:"r",isDeleted:"x",note:"n",parent:"p",pendingSync:"m",text:"t",docId:"o",isRoot:"q",itemLinks:"l",regexpFlags:"g",oldDocId:"h"},l=r(c),u={id:"id",accountID:"a",text:"t",emails:"e",phoneNumbers:"p"},d=r(u),h={id:"id",data:"a",cmpData:"b",dateCreated:"c",dateModified:"d",dateCompleted:"f",plugin:"l",docId:"o",parent:"p",notInDoc:"e",itemId:"i",isComplete:"x",isRead:"r",origin:"g"},p=r(h),f={service:"s",accountID:"a",subject:"t",plaintext:"p",date:"d",contacts:"c",snippet:"n",labels:"l",numMessages:"m",hasAttachment:"h",needsResolve:"o",addedFromLabel:"z"},g=r(f),m={validateInFields:function(e,t){return!(t&&(!e.id||"undefined"===e.id))&&(Object.keys(e).forEach((function(e){if(e.length<2||"undefined"===e)return!1})),!0)},validateOutFields:function(e,t){return!(t&&(!e.id||"undefined"===e.id))&&(Object.keys(e).forEach((function(e){if(e.length>2||"undefined"===e)return!1})),!0)},itemFieldMapIn:l,itemFieldMapOut:c,documentIn:function(e){return{id:e.id,acl:e.a,dateModified:e.p.d,text:e.p.t,encryptionSentinel:e.p.s,root:e.r,version:e.v,pendingSync:e.m,backups:e.c,isDeleted:e.p.x,itemsPlaintext:e.z}},documentOut:function(e,t){var n={id:e.id,p:{t:e.text}};return e.isDeleted&&(n.p.x=e.isDeleted),e.dateModified&&(n.p.d=e.dateModified),e.encryptionSentinel&&(n.p.s=e.encryptionSentinel),t&&t.onlyUpdate||(n.a=e.acl,n.r=e.root,n.v=e.version),t&&t.forLocal&&e.pendingSync&&(n.m=e.pendingSync),n},documentInFlat:function(e,t){return{id:e.id,acl:e.a,dateModified:e.d,text:e.t,encryptionSentinel:e.s,root:e.r,version:e.v,pendingSync:e.m,backups:e.c,isDeleted:e.x}},documentOutFlat:function(e,t){var n={id:e.id,d:e.dateModified,t:e.text,x:e.isDeleted};return e.encryptionSentinel&&(n.s=e.encryptionSentinel),t||(n.a=e.acl,n.r=e.root,n.v=e.version),e.pendingSync&&(n.m=e.pendingSync),n},userIn:function(e){var t={};return Object.keys(e).forEach((function(n){o[n]&&"undefined"!==o[n]&&(t[o[n]]=e[n])})),t},userOut:function(e){var t={};return Object.keys(e).forEach((function(n){a[n]&&void 0!==a[n]&&"undefined"!==a[n]&&(t[a[n]]=e[n])})),t},itemIn:function(e){var t={};return Object.keys(e).forEach((function(n){l[n]&&"undefined"!==l[n]&&(t[l[n]]=e[n])})),t},itemOut:function(e){var t={};return Object.keys(e).forEach((function(n){void 0!==e[n]&&!s[n]&&c[n]&&"undefined"!==c[n]&&(t[c[n]]=e[n])})),t},decryptItem:function(e,t,n){return e.text?t.decryptText(n,e.text,e.id).then((function(t){return e.text=t,e})):Promise.resolve(e)},encryptItem:function(e,t,n){return e.text?t.encryptText(n,e.text,e.id).then((function(t){return e.text=t,e})):Promise.resolve(e)},encryptItemOut:function(e,t,n){return m.encryptItem(e,t,n).then((function(e){return m.itemOut(e)}))},decryptItemIn:function(e,t,n){var r=m.itemIn(e);return m.decryptItem(r,t,n)},boardIn:function(e){var t=Object.assign({},e);return i(e.panes)&&(t.panes=JSON.parse(e.panes)),i(e.defaultPanes)&&(t.defaultPanes=JSON.parse(e.defaultPanes)),t},boardOut:function(e){var t=Object.assign({},e);return e.panes&&(t.panes=JSON.stringify(e.panes)),e.defaultPanes&&(t.defaultPanes=JSON.stringify(e.defaultPanes)),t},compareItemIndex:function(e,t){var n=0,r=null!==e.index?e.index:0,i=null!==t.index?t.index:0;if(void 0===r||void 0===i)return 0;"number"===typeof r&&(r=""+r),"number"===typeof i&&(i=""+i);for(var a=r.split(","),o=i.split(","),s=0;s<a.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(void 0===o[s])return 1;var c=+a[s],l=+o[s];if(c!==l)return c-l}return-1},_baseIn:function(e,t,n){if(e[n]){var r={};return Object.keys(e).forEach((function(n){t[n]&&"undefined"!==t[n]&&(r[t[n]]=e[n])})),r}return e},_baseOut:function(e,t){var n={};return Object.keys(e).forEach((function(r){t[r]&&void 0!==t[r]&&"undefined"!==t[r]&&(n[t[r]]=e[r])})),n},contactIn:function(e){return m._baseIn(e,d,"t")},contactOut:function(e){return m._baseOut(e,u)},pluginIn:function(e){return m._baseIn(e,p,"a")},pluginOut:function(e){return m._baseOut(e,h)},emailMetaDataIn:function(e){var t,n=m._baseIn(e,g,"a");return n.contacts=(null===(t=e.c)||void 0===t?void 0:t.map((function(e){return{text:e.t,email:e.e}})))||[],n},emailMetaDataOut:function(e){var t=m._baseOut(e,f);return e.contacts&&(t.c=e.contacts.map((function(e){return m.removeNullUndefined({t:e.text,e:e.email})}))),t},removeNullUndefined:function(e){var t={};return Object.keys(e).forEach((function(n){null!==e[n]&&void 0!==e[n]&&(t[n]=e[n])})),t}};const v=m},9541:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var r=n(8926),i=n.n(r),a=n(4575),o=n.n(a),s=n(3913),c=n.n(s),l=n(7757),u=n.n(l),d=n(8855),h=n(8651),p=n(4654),f=n(1558),g=n(7948);const m=new(function(){function e(){o()(this,e),this.FOLDER_MIMETYPE="application/vnd.google-apps.folder",this.promisesGetting={},this.folders={root:{type:"root",title:"_Moo.do Files (Do not delete)",id:void 0,prop:"MooDoDefaultRoot"},attach:{type:"attach",title:"Shared Attachments",id:void 0,prop:"MooDoDefaultAttach",parent:"root"},backup:{type:"backup",title:"Moo.do Backups",id:void 0,prop:"MooDoDefaultBackup",parent:"root"}}}return c()(e,[{key:"createFolderStructure",value:function(){var e=i()(u().mark((function e(t,n){var r,i,a;return u().wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:r=n.type;try{h.Z.PAssert(907,!h.Z.isDemoMode(),"Should not be creating "+r+"folder in demo mode")}catch(s){h.Z.reportError(s)}try{h.Z.PAssert(908,void 0===n.id,"Must not already have a "+r+"folder")}catch(s){h.Z.reportError(s)}if(!n.parent){e.next=7;break}if(this.folders[n.parent].id){e.next=7;break}return e.next=7,this.getFolder(t,this.folders[n.parent]);case 7:return i=f.Z.fns("drive").files.insert.packedFn,a={resource:{mimeType:this.FOLDER_MIMETYPE,title:n.title,writersCanShare:!1,folderColorRgb:"#FF7537",properties:[{key:n.prop,value:"TRUE",visibility:"PRIVATE"}]}},n.parent&&(a.resource.parents=[{id:this.folders[n.parent].id}]),e.abrupt("return",new Promise((function(e){p.default.remoteAPI().runRemoteSingleRequest(t,i,a,(function(t){h.Z.shouldLog(d.Z.LogLevels.Folders)&&h.Z.log("Successfully created "+r+" folder",t),e(t.id)}),(function(t){h.Z.shouldLog(d.Z.LogLevels.Folders)&&h.Z.log("Error creating "+r+" folder",t),e(void 0)}),void 0,g.f.SingleFolder)})));case 11:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getSetting",value:function(e,t){return p.default.settings.driveFolders.getProperty(e+"-"+t)}},{key:"setSetting",value:function(e,t,n){t=e+"-"+t,p.default.settings.driveFolders.setProperty(t,n)}},{key:"getFolderByType",value:function(){var e=i()(u().mark((function e(t,n){return u().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.getFolder(t,this.folders[n]));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getFolder",value:function(){var e=i()(u().mark((function e(t,n){var r,a,o=this;return u().wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:r="string"===typeof n?this.folders[n]:n;try{h.Z.PAssert(909,r,"Trying to get invalid folder")}catch(c){h.Z.reportError(c)}try{h.Z.PAssert(910,!h.Z.isDemoMode(),"Should not be creating file structure in demo mode")}catch(c){h.Z.reportError(c)}if(r){e.next=5;break}return e.abrupt("return",void 0);case 5:if(!r.id){e.next=9;break}return e.abrupt("return",r.id);case 9:return a=t+JSON.stringify(n),this.promisesGetting[a]||(this.promisesGetting[a]=new Promise(function(){var e=i()(u().mark((function e(n){var s,l,f,g,m,v,y,k,_;return u().wrap((function(e){for(var Z=0,w=0;;){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;if(Z++>5e3&&__infLoop&&__infLoop(Z))throw new RangeError;switch(e.prev=e.next){case 0:if(!r.parent){e.next=3;break}return e.next=3,o.getFolderByType(t,r.parent);case 3:s=o.getSetting(t,r.type),l=function(e){delete o.promisesGetting[a],n(e)},f=function(){var e=i()(u().mark((function e(){var n;return u().wrap((function(e){for(var i=0,a=0,s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=3,o.createFolderStructure(t,r);case 3:(n=e.sent)?(r.id=n,o.setSetting(t,r.type,n),l(n)):l(void 0);case 5:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}(),s?(g=function(e){e?(r.id=s,l(s)):f()},m=function(e){o.setSetting(t,r.type,void 0),e&&e.error&&404===e.error.code?f():l(void 0)},p.default.remoteAPI().driveFilesGet(t,s,g,m)):(v="properties has {key='"+r.prop+"' and value='TRUE' and visibility='PRIVATE'} and 'me' in owners and trashed=false",y={getAllPages:!0},k=function(e){if(e.length>0){try{h.Z.PAssert(911,1===e.length,"Must have a single root folder present")}catch(c){h.Z.reportError(c)}h.Z.shouldLog(d.Z.LogLevels.Folders)&&h.Z.log("Successfully found root folder",e),r.id=e[0].id,o.setSetting(t,r.type,r.id),l(r.id)}else f()},_=function(e){h.Z.shouldLog(d.Z.LogLevels.Folders)&&h.Z.log("Error getting root folder",e),l(void 0)},p.default.remoteAPI().driveFilesList(t,v,k,_,y));case 7:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}())),e.abrupt("return",this.promisesGetting[a]);case 12:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"copyFileToFolder",value:function(e,t,n,r){p.default.remoteAPI().driveParentsInsert(e,t,n,(function(e){h.Z.shouldLog(d.Z.LogLevels.Folders)&&h.Z.log("Error sharing file ",e),r(!0,e)}),(function(e){h.Z.shouldLog(d.Z.LogLevels.Folders)&&h.Z.log("Successfully shared file ",e),r(!1,e)}))}},{key:"getRootFolder",value:function(e){return this.getFolderByType(e,d.Z.DriveFolder.Root)}},{key:"getDocumentFolder",value:function(e,t){var n={type:t,title:t,id:void 0,parent:d.Z.DriveFolder.Root,prop:t};return this.getFolder(e,n)}}]),e}())},6604:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(3038),i=n.n(r),a=n(9955);function o(){var e=(0,a.useReducer)((function(e){return e+1}),0);return i()(e,2)[1]}},5802:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(9955);function i(e){var t=(0,r.useRef)();return t.current=e,t}},2971:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(9955);function i(e){var t=(0,r.useRef)(),n=t.current;return t.current=e,n}},8721:(e,t,n)=>{"use strict";n.d(t,{Z:()=>y});var r=n(8926),i=n.n(r),a=n(4575),o=n.n(a),s=n(3913),c=n.n(s),l=n(7757),u=n.n(l),d=n(7411),h=n(8855),p=n(8651),f=n(7100),g=n(4654),m=n(9105),v=n(5193);const y=new(function(){function e(){o()(this,e)}return c()(e,[{key:"_wrapOPML",value:function(e){return'<?xml version="1.0"?><opml version="2.0"><head><ownerEmail>'.concat(d.Z.getAccountEmail(),"</ownerEmail></head><body>\n").concat(e,"\n</body>\n</opml>")}},{key:"_addItemToArray",value:function(e,t,n){var r=t.getFullSaveData();if(!n&&r.note&&delete r.note,e.push(r),t.hasChildren())for(var i=0,a=t.getItems(),o=0;o<a.length;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=a[o];this._addItemToArray(e,s,n)}n&&t.hasNote()&&e.push(t.getNote().getFullSaveData())}},{key:"getBestEncryptionOut",value:function(){var e=g.default.settings.encryptionKeys.get();return e&&e[h.Z.EncryptionKeys.UserPassword]?h.Z.EncryptionKeys.UserPassword:h.Z.EncryptionKeys.Global}},{key:"getItemsData",value:function(){var e=i()(u().mark((function e(t,n){var r,i,a,o;return u().wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:if(r=n.includeNotes,i=n.encrypt,a=n.encryptionKey,o=[],this._addItemToArray(o,t,r),!i){e.next=8;break}try{p.Z.PAssert(276,a,"getItemsData missing encryptionKey")}catch(c){p.Z.reportError(c)}return e.abrupt("return",Promise.all(o.map((function(e){return m.Z.encryptItemOut(e,g.default.crypto,a)}))));case 8:return e.abrupt("return",Promise.resolve(o.map((function(e){return m.Z.itemOut(e)}))));case 9:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"toDropHtml",value:function(e){var t="";if(!e.isArchived()&&(t+="<li>"+p.Z.escape(e.getParsedText())+"</li>",e.hasChildren())){var n=0;t+="<ul>";for(var r=0;r<e.numChildren();++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t+=this.toDropHtml(e.getChild(r))}t+="</ul>"}return t}},{key:"generateOPML",value:function(e,t){var n,r=this,i=0,a="",o=0,s=function(){a+="</outline>",o--};for(e.forEach((function(e,i){if(!e.isNote()){if(n)for(var c=0,l=e.levelsDeep.get()-n.levelsDeep.get(),u=Math.min(o,-l),d=0;d<u;d++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;s()}var h=r.printLI(e,{opml:!0},void 0,void 0,void 0,void 0,!1,t);a+=h.opml,e.hasChildren()&&o++,n=e}}));o>0;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;s()}return this._wrapOPML(a)}},{key:"generateExport",value:function(e,t,n,r,i,a,o){var s,c,l,u,d=this,h=0,p=1,f=t.html,g=t.moodo,m=t.plain,v=t.markdown;f&&(s="<ul>"),g&&(c="<ul>"),m&&(l=""),v&&(u="");var y=function(){f&&(s+="</li>"),g&&(c+="</li>")},k=function(){f&&(s+="<ul>"),g&&(c+="<ul>"),p++},_=function(){f&&(s+="</ul>"),g&&(c+="</ul>"),p--};for(e.forEach((function(h,Z){var w,b;(e.length>1||void 0!==n&&n!==r)&&(i===a&&n===r||(w=0===Z?n:0,b=a.item===h&&(h.hasNote()&&Z===e.length-2||!h.isNote()&&Z===e.length-1)?r:void 0));var P=e.length>1||n===h.getPrefixLength()&&r===i.getDisplayLength(),S=d.printLI(h,t,w,i,b,a,P,o);m&&(l+=(l?"\r\n":"")+"\t".repeat(Math.max(0,p-1))+S.plain),v&&(u+=(u?"\r\n":"")+"\t".repeat(Math.max(0,p-1))+S.markdown),f&&(s+=S.html),g&&(c+=S.moodo);var D=e[Z+1];if(D){var I=D.getLevelsDeepWithNoteExtra()-h.getLevelsDeepWithNoteExtra();if(D.parent()===h&&I>0)k();else{var E=Math.min(p,-I);if(y(),!(0===E&&p>0)){for(var x=0,C=0;C<E;C++){if(x++>5e3&&__infLoop&&__infLoop(x))throw new RangeError;_(),y()}p<=0&&k()}}}}));p>0;){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;y(),_()}return{html:s,moodo:c,plain:l,markdown:u}}},{key:"printLI",value:function(e,t,n,r,i,a,o,s){var c,l=t.html,u=t.moodo,d=t.plain,p=t.opml,f=t.markdown,g=e.elsNew,m=s||o?e.getPrefixForExport():"",v=s||o&&!e.isPrefixCodeBlock()?e.getPrefixForExport():"",y=[],k=e.getPriority();if(void 0!==i){var _=g.split(a,i)[0];_&&(g=_)}if(void 0!==n&&0!==n){var Z=g.split(r,n)[1];Z&&(g=Z)}var w,b=(g=g.withoutPrefix()).getRawText();if(e.isNote()&&y.push("note"),k&&(k===h.Z.VMLIFlag.P1?y.push("high"):k===h.Z.VMLIFlag.P2?y.push("medium"):k===h.Z.VMLIFlag.P3&&y.push("low")),e.isComplete()&&y.push("complete"),e.isStarred()&&y.push("starred"),b.includes(h.Z.CharDate)){var P=e.getMooDate();P&&(w=P.toData())}return e.itemsLinkedTo.length()>0&&(c=e.id),{html:l?this.generateHTML(v+g.getHTML(e),y,w,c):"",plain:d?v+g.getPlaintext(e):"",moodo:u?this.generateHTML(m+b,y,w,c):"",opml:p&&!e.isNote()?this.generateOPMLItem(e,m+g.getHTML(e,!1,!0),y,w,c):"",markdown:f?v+g.getMarkdown(e):""}}},{key:"generateHTML",value:function(e,t,n,r){return"<li"+(t.length>0?' class="'+t.join(" ")+'"':"")+(n?' data-date="'.concat(n,'"'):"")+(r?' id="'.concat(r,'"'):"")+">"+e}},{key:"generateOPMLItem",value:function(e,t,n,r,i){return"<outline"+(i?' id="'.concat(i,'"'):"")+(e.hasNote()?' _note="'.concat(p.Z.escape(e.getNote().getRawText()),'"'):"")+(n.length>0?" "+n.map((function(e){return"".concat(e,'="true"')})).join(" "):"")+(r?' date="'.concat(r,'"'):"")+' text="'.concat(p.Z.escape(t),'"')+(e.hasChildren()?">":" />")}},{key:"rewriteItemIDs",value:function(e,t){for(var n=0,r={},i=0;i<e.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=e[i],o=a.id;o&&(a.id=v.Z.generateID(),r[o]=a.id)}Object.keys(r).length>0&&function(){for(var n=0,i=function(e,n){var i=p.Z.isVMLI(e)?e.getRawText():e.text,a=i.replace(h.Z.Regexp.InterlinkWithText,(function(e,n){var i=(t||!v.Z.getItem(n)||v.Z.getItem(n).isDeleted())&&r[n];return i?"[[".concat(i,"]]"):e}));a!==i&&(p.Z.isVMLI(e)?e.setText(a,n):e.text=a)},a=0;a<e.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=e[a];if(i(o,h.Z.ChangeType.Remote),p.Z.isVMLI(o)){var s=o.itemsLinkedTo.get();s&&s.forEach((function(t){e.includes(t)||i(t,h.Z.ChangeType.Local)}))}}}()}},{key:"convertItemDatas",value:function(e){var t=this;e.forEach((function(e){return t.convertItemData(e)}))}},{key:"convertItemData",value:function(e){var t=e.text;t.startsWith("[x]")&&(e.text=t.replace("[x]","[]"),e.isComplete=!0);var n=f.Z.parseTextForFilePath(t);if(n.startsWith("file:///")){console.log(t.match(/[^/]*$/));var r=t.match(/[^/]*$/)[0];e.text="[".concat(r,"](").concat(n,")")}}}]),e}())},7948:(e,t,n)=>{"use strict";var r;n.d(t,{f:()=>r}),function(e){e[e.SingleFile=1]="SingleFile",e[e.FolderStruct=2]="FolderStruct",e[e.SubFolder=3]="SubFolder",e[e.Search=4]="Search",e[e.DataPage=5]="DataPage",e[e.ChangeList=6]="ChangeList",e[e.SingleFolder=7]="SingleFolder"}(r||(r={}))},6150:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var r,i=n(9713),a=n.n(i),o=n(4575),s=n.n(o),c=n(3913),l=n.n(c),u=n(3124),d=n.n(u),h=n(8572),p=n(8651),f=n(4654),g=n(4327);const m=new(r=function(){function e(){s()(this,e),this._batchTimeout=void 0,this.itemsBatchingUpdates={}}return l()(e,[{key:"beginBatch",value:function(e){p.Z.isEmpty(this.itemsBatchingUpdates)&&(this._batchTimeout=setTimeout(this._runUpdates,500)),this.itemsBatchingUpdates[e.id]||(this.itemsBatchingUpdates[e.id]={item:e})}},{key:"commitBatch",value:function(e){var t=this.itemsBatchingUpdates[e.id];t&&(this._runUpdate(e,t),delete this.itemsBatchingUpdates[e.id])}},{key:"itemItemsChanged",value:function(e){this.updateItem(e,"Items")}},{key:"itemTextChanged",value:function(e){this.updateItem(e,"Text")}},{key:"itemLinkedToChanged",value:function(e){this.updateItem(e,"LinkedTo")}},{key:"itemDateChanged",value:function(e){this.updateItem(e,"Date")}},{key:"itemRepeatDateCompleted",value:function(e){this.updateItem(e,"RepeatDateCompleted")}},{key:"itemPriorityChanged",value:function(e){this.updateItem(e,"Priority")}},{key:"itemTagsChanged",value:function(e,t){this.updateItem(e,"Tags",t)}},{key:"itemContactsChanged",value:function(e,t){this.updateItem(e,"Contacts",t)}},{key:"itemModifiedChanged",value:function(e){this.updateItem(e,"Modified")}},{key:"itemFontChanged",value:function(e){this.updateItem(e,"Font")}},{key:"itemHeaderChanged",value:function(e){this.updateItem(e,"Header")}},{key:"itemSearchChanged",value:function(e){this.updateItem(e,"Search")}},{key:"itemCompleteChanged",value:function(e){this.updateItem(e,"Complete")}},{key:"itemIndentChanged",value:function(e){this.updateItem(e,"Indent")}},{key:"updateItem",value:function(e,t,n){if(n=n||!0,this.itemsBatchingUpdates[e.id]){var r=this.itemsBatchingUpdates[e.id];r||(r=this.itemsBatchingUpdates[e.id]={item:e}),r[t]=n,this._batchTimeout&&clearTimeout(this._batchTimeout),this._batchTimeout=setTimeout(this._runUpdates,500)}else this._runUpdate(e,a()({item:e},t,n))}},{key:"_runUpdate",value:function(e,t){g.Z.fireEvent("clearMeasureCacheItem",[e.id]),!e.isDestroyed()&&e.getItemStore()&&e.getItemStore().onItemChanged(e,t)}},{key:"_runUpdates",value:function(){var e=this;p.Z.batchRenderUpdates((function(){for(var t in f.default.PaneUpdateBatcher.beginUpdateItems(),e.itemsBatchingUpdates)if(e.itemsBatchingUpdates.hasOwnProperty(t)){var n=e.itemsBatchingUpdates[t];e._runUpdate(n.item,n)}e.itemsBatchingUpdates={},f.default.PaneUpdateBatcher.commitUpdateItems()}))}}]),e}(),d()(r.prototype,"_runUpdate",[h.ZP],Object.getOwnPropertyDescriptor(r.prototype,"_runUpdate"),r.prototype),d()(r.prototype,"_runUpdates",[h.ZP],Object.getOwnPropertyDescriptor(r.prototype,"_runUpdates"),r.prototype),r)},9966:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a);const s=function(){function e(t,n){i()(this,e),this.__isListener=!0,this.target=t,this.cb=n,this._disposed=!1}return o()(e,[{key:"dispose",value:function(){this._disposed=!0,this.target.unlistenListener(this)}},{key:"isDisposed",value:function(){return this._disposed}}]),e}()},180:(e,t,n)=>{"use strict";n.d(t,{nw:()=>i,wR:()=>a,MY:()=>r});var r,i=["initialize","authGoogleAccount","closeKeyboard","openURL","refreshAuthGoogleAccount","setColorTheme","setNotifications","signInWithApple","signInWithGoogle","setUseBeta","setPref","checkForUpdates","restartApp","notifyLoaded","requestIAPSubscription","getIAPSubscriptions","endIAPConnection","openGmail","openEmail","setEmailAccounts","loadEmailLabel","resolveEmailMessageID","sendAction"],a=["onAppInfo","onAppearanceChange","onBackButton","onKeyboardChange","onShake","onThemeCb","onCodePushStatus","onAppStateChange","onIAPUpdated","onEmailThreads"];!function(e){e[e.UP_TO_DATE=0]="UP_TO_DATE",e[e.UPDATE_INSTALLED=1]="UPDATE_INSTALLED",e[e.UPDATE_IGNORED=2]="UPDATE_IGNORED",e[e.UNKNOWN_ERROR=3]="UNKNOWN_ERROR",e[e.SYNC_IN_PROGRESS=4]="SYNC_IN_PROGRESS",e[e.CHECKING_FOR_UPDATE=5]="CHECKING_FOR_UPDATE",e[e.AWAITING_USER_ACTION=6]="AWAITING_USER_ACTION",e[e.DOWNLOADING_PACKAGE=7]="DOWNLOADING_PACKAGE",e[e.INSTALLING_UPDATE=8]="INSTALLING_UPDATE"}(r||(r={}))},1095:(e,t,n)=>{"use strict";n.d(t,{Z:()=>w});var r=n(3038),i=n.n(r),a=n(8),o=n.n(a),s=n(4575),c=n.n(s),l=n(3913),u=n.n(l),d=n(8855),h=n(8651),p=n(7151),f=n(9603),g=1e5,m={notify:"n",duration:"d",gcalId:"c",gcalCalendar:"b",completes:"x",repeatComplete:"r"},v=h.Z.invertObject(m),y={freq:"f",byweekday:"w",byday:"b",byhour:"h",bymonth:"m",bymonthday:"t",byyearday:"y",byweekno:"n",byminute:"o",bysecond:"s",dtstart:"d",until:"u",interval:"i",count:"c"},k=h.Z.invertObject(y),_=Object.keys(m),Z=d.Z.CalendarDayViewNumDaysPad;const w=function(){function e(t,n){if(c()(this,e),t instanceof Date)this.date=t,this.dateCleared=f.Z.clearTime(t);else{this.rruleset=t;try{h.Z.PAssert(272,this.rruleset._rrule[0],"MooDate missing rrule in constructor",(function(){return o()(t)}))}catch(r){h.Z.reportError(r)}}n&&this.copyOptionsFrom(n,!0)}return u()(e,[{key:"getNext",value:function(e,t,n){var r=this;if(this.date)return this.date;var i=this.rruleset._rrule[0];try{h.Z.PAssert(273,i,(function(){return"MooDate missing rrule: "+r.toData()}))}catch(c){h.Z.reportError(c)}if(i){e||(e=new Date(0));var a=this.rruleset._rrule[0].options,o=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()));a.dtstart&&a.dtstart>o?(o=a.dtstart,n&&(o=f.Z.getDatePlusMS(o,d.Z.MSPerMinute))):(t||!(a.freq<p.Di.DAILY)&&(a.freq!==p.Di.DAILY||a.byhour&&0!==a.byhour[0])||(e=f.Z.clearTime(e)),o=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes())));var s=this.rruleset.after(o,!0);return s&&(s=f.Z.UTCtoLocal(s)),s}}},{key:"getStart",value:function(){if(this.date)return this.date;var e,t,n=this.rruleset._rrule[0].options,r=f.Z.UTCtoLocal(n.dtstart);return null!==(e=n.byhour)&&void 0!==e&&e[0]&&r.setHours(n.byhour[0]),null!==(t=n.byminute)&&void 0!==t&&t[0]&&r.setMinutes(n.byminute[0]),r}},{key:"getEnd",value:function(e){var t=this.getDuration()||(e?0:d.Z.DefaultEventDuration);if(this.date)return new Date(this.date.getTime()+t);var n=this.rruleset._rrule[0].options;if(n.until){var r,i,a=f.Z.UTCtoLocal(n.until);return null!==(r=n.byhour)&&void 0!==r&&r[0]&&a.setHours(n.byhour[0]),null!==(i=n.byminute)&&void 0!==i&&i[0]&&a.setMinutes(n.byminute[0]),a.addMilliseconds(t),a}return new Date(this.getStart().getTime()+t)}},{key:"isOnDate",value:function(e){if(this.date){if(this.duration){var t=this.date.clone().addMilliseconds(this.duration);return e>=this.dateCleared&&e<=t}return+e===+this.dateCleared}return this._nextDates||this._generateDates(),!0===this._nextDatesMap[+e]}},{key:"getDate",value:function(){return this.date}},{key:"getFirstDate",value:function(){return this._nextDates||this._generateDates(),this._nextDates[0]}},{key:"_generateDates",value:function(){var e=this;if(!this.date&&!this._nextDates){var t=Date.now()+Z*d.Z.MSPerDay,n=this.rruleset.all((function(e,n){return n<Z&&+e<t}));this._nextDates=n.map((function(e){return f.Z.clearTime(f.Z.UTCtoLocal(e))})),this._nextDatesMap={},this._nextDates.forEach((function(t){return e._nextDatesMap[+t]=!0}))}}},{key:"getAllDates",value:function(){return this.date?[this.date]:(this._nextDates||this._generateDates(),this._nextDates)}},{key:"isSingleDate",value:function(){return!!this.date}},{key:"isRange",value:function(){if(this.date)return!1;var e=this.rruleset._rrule[0].options;return 3===e.freq&&1===e.interval&&e.until}},{key:"hasTime",value:function(){var e;return null===(e=this.date||this.getFirstDate())||void 0===e?void 0:e.hasTimeOfDay()}},{key:"setDate",value:function(e){if(this.date&&e&&!e.hasTimeOfDay()){var t=this.date.getTimeOfDay();this.date=f.Z.clearTime(e).clone().addMilliseconds(t)}else this.date=e;this.dateCleared=f.Z.clearTime(this.date),this.rruleset=void 0,this._nextDates=void 0}},{key:"setDuration",value:function(e){this.duration=e}},{key:"getDuration",value:function(){return this.duration}},{key:"setUntil",value:function(e){if(this.rruleset){var t=f.Z.toUTCDate(e),n=this.rruleset._rrule[0];n.options.until=t,n.origOptions.until=t,this._nextDates=void 0}}},{key:"hasUntil",value:function(){var e;return!(null===(e=this.rruleset)||void 0===e||!e._rrule[0].options.until)}},{key:"setHours",value:function(e){var t=Math.floor(e),n=Math.round(60*(e-t));if(this.date)this.date.setHours(t),this.date.setMinutes(n);else{var r=this.rruleset._rrule[0];r.options.byhour=[t],r.origOptions.byhour=[t],r.options.byminute=[n],r.origOptions.byminute=[n],this._nextDates=void 0}}},{key:"clearTime",value:function(){if(this.date)this.date.setHours(0,0,0,0);else{var e=this.rruleset._rrule[0];e.options.byhour=[0],delete e.origOptions.byhour,e.options.byminute=[0],delete e.origOptions.byminute,this._nextDates=void 0}this.duration=0}},{key:"toText",value:function(e){var t,n=this;if(this.date)t=f.Z.toHumanText(this.date);else{var r=this.rruleset._rrule[0];try{h.Z.PAssert(274,r,"MooDate has no rrule",(function(){return n.toData()}))}catch(o){h.Z.reportError(o)}if(r)if(e){var i=this.getNext();t=f.Z.toHumanText(i)}else t=r.toText()}if(t&&!e&&this.duration){var a=Math.round(this.duration/d.Z.MSPerMinute);t+=" "+(a>=60?h.Z.round(a/60,2)+"hr":Math.round(a)+"m")}return t||""}},{key:"getGCalId",value:function(){return this.gcalId}},{key:"getGCalCalendar",value:function(){return this.gcalCalendar}},{key:"setGCalId",value:function(e){this.gcalId=e}},{key:"setGCalCalendar",value:function(e){this.gcalCalendar=e}},{key:"setGCalIdAndCalendar",value:function(e,t){this.gcalId=e,this.gcalCalendar=t}},{key:"removeGCal",value:function(){this.gcalId=void 0,this.gcalCalendar=void 0}},{key:"clone",value:function(){return e.fromData(this.toData())}},{key:"isRepeatDate",value:function(){return!!this.rruleset}},{key:"getTime",value:function(){if(this.date)return this.date.getTimeOfDay();var e=this.getNext();return e||(e=this.rruleset&&this.rruleset.before(new Date))&&(e=f.Z.UTCtoLocal(e)),e?e.getTimeOfDay():void 0}},{key:"copyOptionsFrom",value:function(e,t){(!0===t||t.includes("notify"))&&(this.notify=e.notify),(!0===t||t.includes("duration"))&&(this.duration=e.duration),(!0===t||t.includes("gcalId"))&&(this.gcalId=e.gcalId),(!0===t||t.includes("gcalCalendar"))&&(this.gcalCalendar=e.gcalCalendar),(!0===t||t.includes("repeatComplete"))&&(this.repeatComplete=!!e.repeatComplete),!0===t&&(this.completes=e.completes)}},{key:"copyFrom",value:function(e,t){e.rruleset?(this.rruleset=e.rruleset,this.date=void 0):e.date&&(this.date=e.date,this.dateCleared=f.Z.clearTime(e.date),this.rruleset=void 0),this.copyOptionsFrom(e,t),this._nextDates=void 0}},{key:"complete",value:function(){if(this.isRepeatDate()){var e=new Date;this.completes?this.completes.push(e):this.completes=[e];var t,n=this.rruleset._rrule[0];if(this.repeatComplete){var r=this.getTime(),i=e.addSeconds(1);0===r&&(i=f.Z.clearTime(i));var a=f.Z.toUTCDate(i);n.origOptions.dtstart=a,n.options.dtstart=a,n=this.rruleset._rrule[0]=p.Ci.fromString(this.rruleset.toString());var o=f.Z.getTodayPlusDays(1);e=this.getNext(o,!0,!0)}return(t=this.getNext(new Date(0),!0,!0))&&(t=f.Z.toUTCDate(t),n.origOptions.dtstart=t,n.options.dtstart=t,this._nextDates=void 0),!!t}}},{key:"setRepeatOnComplete",value:function(e){this.repeatComplete=e}},{key:"toICal",value:function(){if(this.isRepeatDate())return this.rruleset.toString()}},{key:"setRRuleOptions",value:function(e){var t=new p.pF;t.rrule(new p.Ci(e)),this.rruleset=t,this.date=void 0,this._nextDates=void 0}},{key:"updateRRuleOptions",value:function(t){var n,r=null===(n=this.rruleset)||void 0===n?void 0:n._rrule[0];r?(r.options=Object.assign(r.options,t),r.origOptions=Object.assign(r.origOptions,t),this.date=void 0,this.rruleset.options=Object.assign(this.rruleset.options,t),this.rruleset.origOptions=Object.assign(this.rruleset.origOptions,t),this.rruleset=e.fromData(this.toData()).rruleset,this._nextDates=void 0):this.setRRuleOptions(t)}},{key:"setRange",value:function(t,n,r){var i=e.getOptionsFromRange(t,n,r);i instanceof Date?this.setDate(t):this.setRRuleOptions(i)}},{key:"getRRuleOptions",value:function(){if(this.rruleset)return this.rruleset._rrule[0].options}},{key:"getRepeatFrequency",value:function(){if(this.rruleset){var e=this.rruleset._rrule[0].options,t=this.freqToText(e.freq);if(t)return e.interval+t}}},{key:"freqToText",value:function(e){switch(e){case 0:return"y";case 1:return"m";case 2:return"w";case 3:return"d";case 4:return"h"}}},{key:"toData",value:function(){var e=this,t=[],n=[];if(_.forEach((function(t){var r=e[t];r&&("completes"===t?r=r.filter((function(e){return!isNaN(+e)})).map((function(e){return+e})).join(","):"duration"===t&&(r=Math.round(r/g)),n.push("".concat(m[t],":").concat(r)))})),n.length&&t.push(n.join(";")),this.date){var r=+this.date;if(!n.length)return""+r;t.push(r)}else t.push(this.rruleset._rrule.map((function(e){var t=e.origOptions;return Object.keys(t).map((function(e){var n=t[e];if(!h.Z.isNullOrUndefined(n))return e=e.toLowerCase(),n instanceof Date?n=Math.round(+n/g):h.Z.isArray(n)&&n[0]&&n[0]instanceof p.OG?n=n.map((function(e){return e.weekday+(e.n&&e.n>0?"-"+e.n:"")})).join(","):h.Z.isNumber(n)&&(n=Math.round(n)),"".concat(y[e],":").concat(n)})).filter((function(e){return!!e})).join(";")})).join("\n"));return t.join("\\")}}],[{key:"fromData",value:function(t){if(t&&"NaN"!==t){var n,r,a=+t;if(!h.Z.isNumber(a)){var o=t.split("\\");if(o.length>1)n={},o[0].split(";").forEach((function(e){var t=e.split(":"),r=i()(t,2),a=r[0],o=r[1];"completes"===v[a]?o=o.split(",").map((function(e){return new Date(e)})):"duration"===v[a]&&(o*=g),n[v[a]]=o})),t=o[1]}if(t&&"NaN"!==t){if(a=+t,h.Z.isNumber(a))r=new Date(a);else try{r=new p.pF,t.split("n").forEach((function(e){var n={};if(e.split(";").forEach((function(e){var t,r=e.split(":"),a=i()(r,2),o=a[0],s=a[1],c=k[o];if(o===y.byweekday)s=s.split(",").map((function(e){var t=e.split("-"),n=i()(t,2),r=n[0],a=n[1],o=""!==r&&h.Z.isNumber(+r)?+r:void 0,s=""!==a&&h.Z.isNumber(+a)&&+a>0?+a:void 0;return new p.OG(o,s)}));else if((null===(t=s)||void 0===t?void 0:t.indexOf(","))>0)s=s.split(",").map((function(e){return+e}));else if(h.Z.isNumber(+s)){var l=s.indexOf(".");l>0&&(s=s.substr(0,l)),"dtstart"===c||"until"===c||s.length>6?s=new Date(+s*g):(s=+s,"interval"===c&&s<0&&(s=Math.abs(s)))}c&&(n[c]=s)})),n&&!h.Z.isEmpty(n)){r.rrule(new p.Ci(n));try{h.Z.PAssert(275,r._rrule[0],"RRuleSet created with no rrule",t)}catch(a){h.Z.reportError(a)}}r._rrule[0]}))}catch(s){h.Z.reportError(s,"Error parsing date string: "+t)}return new e(r,n)}}}},{key:"fromRRuleOptions",value:function(t,n){var r=new p.pF;return r.rrule(new p.Ci(t)),new e(r,{duration:n})}},{key:"getOptionsFromRange",value:function(e,t,n){var r,i,a;if(void 0!==n&&(i=60*(n-(r=Math.floor(n))),e.setHours(r),e.setMinutes(i)),e=e.clone(),t=t.clone(),!e.equals(t)){i&&(e.setHours(i),t.setHours(i));var o={freq:p.Di.DAILY,dtstart:f.Z.toUTCDate(e),until:f.Z.toUTCDate(t)};r&&(o.byhour=r?[r]:void 0),i&&(o.byminute=i?[i]:void 0),a=o}return a}},{key:"fromRange",value:function(t,n,r){var i,a=e.getOptionsFromRange(t,n,r);return a?(i=new p.pF).rrule(new p.Ci(a)):i=t,new e(i)}},{key:"now",value:function(){return new e(new Date)}}]),e}()},9352:(e,t,n)=>{"use strict";n.d(t,{Z:()=>C});var r,i=n(8926),a=n.n(i),o=n(9713),s=n.n(o),c=n(4575),l=n.n(c),u=n(3913),d=n.n(u),h=n(3124),p=n.n(h),f=n(7757),g=n.n(f),m=n(7411),v=n(8572),y=n(8855),k=n(6744),_=n(8651),Z=n(4654),w=n(5441),b=n(5193),P=n(7978),S=n(9105),D=n(8721),I=n(6150),E=n(7274),x=n(461);const C=(r=function(){function e(t){var n=t.id,r=t.text,i=t.rootData,a=t.acl,o=t.backing,s=t.encryptionSentinel,c=t.backups,u=t.isDeleted;l()(this,e);try{_.Z.PAssert(213,n,"Document must have id")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(214,a,"Document must have acl")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(215,i&&i.isRoot,"Document must have root item set to root")}catch(d){_.Z.reportError(d)}i&&!i.isRoot&&(i.isRoot=!0),this.id=n,this.text=new E.Z(r),this._root=i,this._backing=o,this._isLocalOnly=o.isLocalOnly,this.isSyncing=new E.Z(!1),this.acl=new E.Z(a),this.encryptionSentinel=new E.Z(s),this.isDecrypted=this.canDecrypt(),this.backups=new E.Z(c),this.isDeleted=new E.Z(u),this._numItems=0,i.archivedItems&&(this._archivedItemsData=i.archivedItems,delete i.archivedItems),i.deletedItems&&(this._deletedItemsData=i.deletedItems,delete i.deletedItems),this._index=Z.default.settings.documentIndices.getProperty(n)}return d()(e,[{key:"createVMLIs",value:function(){if(!this._rootItem&&!this.isDeleted.get()){var e=Z.default.itemStoreManager.getDefaultItemStore();this._rootItem=e.createItemRaw(this._root,{documentOwner:this,changeType:y.Z.ChangeType.Auto,isRoot:!0}),e.addItemToRoot(this._rootItem)}}},{key:"_ensureRootItem",value:function(e,t){e||(this["_root".concat(t,"Item")]=Z.default.itemStoreManager.getDefaultItemStore().createItemRaw({id:void 0,text:"".concat(t," Root"),docId:this.id},{documentOwner:this,changeType:y.Z.ChangeType.Auto,isRoot:!0}))}},{key:"ensureRootArchivedItem",value:function(){this._ensureRootItem(this._rootArchivedItem,"Archived")}},{key:"ensureRootDeletedItem",value:function(){this._ensureRootItem(this._rootDeletedItem,"Deleted")}},{key:"_ensureHelper",value:function(e,t,n,r){if(e(),this[t]){var i=this[t];delete this[t];var a=this[n];I.Z.beginBatch(a),i.forEach(r),I.Z.commitBatch(a)}}},{key:"ensureArchivedItems",value:function(){this._ensureHelper(this.ensureRootArchivedItem,"_archivedItemsData","_rootArchivedItem",this.createArchivedVMLI)}},{key:"ensureDeletedItems",value:function(){this._ensureHelper(this.ensureRootDeletedItem,"_deletedItemsData","_rootDeletedItem",this.createDeletedVMLI)}},{key:"_createVMLI",value:function(e,t,n){t.isNote||!t.text&&!("Deleted"===n?t.deletedItems:t.archivedItems)||e.items.push(Z.default.itemStoreManager.getDefaultItemStore().createItemRaw(t,{parent:e,documentOwner:this,changeType:y.Z.ChangeType.Auto}))}},{key:"createArchivedVMLI",value:function(e){this._createVMLI(this._rootArchivedItem,e,"Archived")}},{key:"createDeletedVMLI",value:function(e){this._createVMLI(this._rootDeletedItem,e,"Deleted")}},{key:"_archiveDeleteHelper",value:function(e,t,n,r,i,a,o){var s=e.parent();o||s[n]()||(s.items.remove(e),r(),this[i].items.push(e));a(e,!0,t)}},{key:"archiveItem",value:function(e,t,n){this._archiveDeleteHelper(e,t,"isArchived",this.ensureRootArchivedItem,"_rootArchivedItem",this.propagateArchive,n)}},{key:"_unActionHelper",value:function(e,t,n,r,i){var a=e.parent(),o=a&&!a[n]()&&a!==r?a:this._rootItem;a&&a!==o&&a.items.indexOf(e)>=0&&a.items.remove(e),r&&r.items.remove(e),e.setParent(o),o.items.includes(e)||e.isNote()||o.items.insertSorted(e,S.Z.compareItemIndex),i(e,!1,t)}},{key:"_propagateHelper",value:function(e,t,n,r,i,a,o){var c=this;e[r](t,n);var l=s()({id:e.id},i,t);o&&(l[o]=t),b.Z.saveItem(e,l,n,y.Z.SaveFlag.All),a&&e.items.get()&&e.items.forEach((function(e){return c._propagateHelper(e,t,n,r,i,a)}))}},{key:"unArchiveItem",value:function(e,t){this._unActionHelper(e,t,"isArchived",this._rootArchivedItem,this.propagateArchive)}},{key:"propagateArchive",value:function(e,t,n){this._propagateHelper(e,t,n,"setArchived","isArchived",!0)}},{key:"deleteItem",value:function(e,t,n){this._archiveDeleteHelper(e,t,"isDeleted",this.ensureRootDeletedItem,"_rootDeletedItem",this.propagateDelete,n)}},{key:"unDeleteItem",value:function(e,t){this._unActionHelper(e,t,"isDeleted",this._rootDeletedItem,this.propagateDelete)}},{key:"unArchiveAndUnDeleteItem",value:function(e,t){this._unActionHelper(e,t,"isDeleted",this._rootDeletedItem,this.propagateArchiveAndDelete)}},{key:"propagateDelete",value:function(e,t,n){this._propagateHelper(e,t,n,"setDeleted","isDeleted",!t)}},{key:"propagateArchiveAndDelete",value:function(e,t,n){this._propagateHelper(e,t,n,"setDeleted","isDeleted",!t,"isArchived")}},{key:"getRootData",value:function(){return this._root}},{key:"getRootItem",value:function(){return this._rootItem}},{key:"getRootArchivedItem",value:function(){return this.ensureArchivedItems(),this._rootArchivedItem}},{key:"getRootDeletedItem",value:function(){return this.ensureDeletedItems(),this._rootDeletedItem}},{key:"getBacking",value:function(){return this._backing}},{key:"getSaveInfo",value:function(e,t){var n={id:this.id,version:1,root:this._root.id,text:this.text.get(),isDeleted:this.isDeleted.get()};return e||(n.acl=this.acl.get()),t||(n.encryptionSentinel=this.encryptionSentinel.get()),n}},{key:"setText",value:function(e,t){var n=this.text.get();this.text.set(e,t),this._isLocalOnly&&this.getBacking().renameDocument(this,n)}},{key:"index",get:function(){return this._index}},{key:"setIndex",value:function(e){this._index=e,Z.default.settings.documentIndices.setProperty(this.id,e)}},{key:"onRemoteUpdate",value:function(e){e.date,void 0!==e.backups&&this.backups.set(e.backups),void 0!==e.text&&this.setText(e.text),void 0!==e.isDeleted&&(e.isDeleted&&!this.isDeleted.get()?this.delete(!0):!e.isDeleted&&this.isDeleted.get()&&this.undelete(!0)),void 0!==e.acl&&this.acl.set(_.Z.clone(e.acl)),void 0!==e.encryptionSentinel&&this.encryptionSentinel.set(e.encryptionSentinel),e.itemsPlaintext&&this.processPlaintextItems(e.itemsPlaintext)}},{key:"processPlaintextItems",value:function(e){var t=this;Z.default.PaneUpdateBatcher.beginUpdateItems();var n=Object.keys(e);n.forEach((function(n){e[n].id=n;var r=S.Z.itemIn(e[n]);if(!b.Z.getItem(n)){var i=b.Z.createVMLI(r,{documentOwner:t,parent:t._rootItem,changeType:y.Z.ChangeType.Local});t._rootItem.insertItem(i,0)}})),Z.default.PaneUpdateBatcher.commitUpdateItems(),this._backing.deleteDocAPIItems(this,n)}},{key:"getBestEncryptionInfo",value:function(){var e=Z.default.crypto.getGlobalKeyInfo();return this.encryptionSentinel.get()?e.sentinel===this.encryptionSentinel.get()?e:Z.default.crypto.getKeyInfo(this.id):this.isShared()?e:Z.default.crypto.getKeyInfo(Z.default.settings.getBestUserEncryption())}},{key:"getBestEncryption",value:function(){return this.getBestEncryptionInfo().key}},{key:"toJSONObject",value:function(){var e=a()(g().mark((function e(){var t,n,r,i,a,o=arguments;return g().wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},n=this.getBestEncryptionInfo(),t.encryptionKey=n.key,e.next=5,D.Z.getItemsData(this.getRootItem(),t);case 5:if(r=e.sent,!t.exportArchived){e.next=11;break}return e.next=9,D.Z.getItemsData(this.getRootArchivedItem(),t);case 9:i=e.sent,r=r.concat(i);case 11:return a={moodoVer:Z.default.settings.localDataVersion.get(),doc:this.getSaveInfo(!0,!t.encrypt),items:r},t.encrypt&&(a.sentinel=n.sentinel),e.abrupt("return",a);case 14:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toJSON",value:function(){var e=a()(g().mark((function e(t){return g().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.toJSONObject(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.stringify.call(e.t0,e.t1));case 5:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"generateExport",value:function(e,t,n){return D.Z.generateExport(this.getAllItems(t),e,void 0,void 0,void 0,void 0,n)}},{key:"toHTML",value:function(e,t,n){return this.generateExport({html:!0},{includeArchived:e,includeNotes:t,noSelf:!0},n).html}},{key:"toPlaintext",value:function(e,t,n){return this.generateExport({plain:!0},{includeArchived:e,includeNotes:t,noSelf:!0},n).plain}},{key:"toOPML",value:function(e,t,n){return D.Z.generateOPML(this.getAllItems({includeArchived:e,includeNotes:t,noSelf:!0}),n)}},{key:"delete",value:function(e){var t=this;this.isDeleted.set(!0),this.getBacking().deleteDocument(this,e);var n=Z.default.itemStoreManager.getDefaultItemStore();n.removeItemFromRoot(this._rootItem),this.getAllItems().forEach((function(e){return n.removeItemFromStore(e.id)})),delete this._rootItem,Z.default.PaneManager.runForEachPane((function(e){if(e.document.get()===t){var n=b.Z.getDefaultDocument();e.setDocument(n)}}))}},{key:"undelete",value:function(e){this.isDeleted.set(!1),this.createVMLIs(),this.getBacking().undeleteDocument(this,e)}},{key:"getAllItems",value:function(e){var t=[],n=this._rootItem;return this._getAllItems(t,n,e||{}),e&&e.includeArchived&&this._getAllItems(t,this.getRootArchivedItem(),e||{}),t}},{key:"_getAllItems",value:function(e,t,n){if(t){var r=0;n&&n.noSelf||e.push(t),delete n.noSelf,n&&!1===n.includeNotes||!t.hasNote()||e.push(t.getNote());for(var i=t.items.get(),a=0;a<i.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this._getAllItems(e,i[a],n)}}}},{key:"isShared",value:function(){return Object.keys(this.acl.get()).length>1}},{key:"isAdmin",value:function(){if(this._isLocalOnly)return!0;var e=this.acl.get()[m.Z.getUid()];return e&&e.r===y.Z.DocumentAccessRoles.Admin}},{key:"getCollaborators",value:function(){var e=this.acl.get();return Object.keys(e).filter((function(e){return e!==m.Z.getEncryptionUid()})).map((function(t){return{uid:t,name:e[t].t,email:e[t].e,role:e[t].r}}))}},{key:"shareWithUser",value:function(e,t){return x.Z.shareDocument({docID:this.id,docName:this.text.get(),encryptionSentinel:this.encryptionSentinel.get(),emails:e,accessRole:t})}},{key:"onAclUpdate",value:function(e){var t=_.Z.clone(this.acl.get());if(Object.keys(e).forEach((function(n){e[n]?t[n]=e[n]:delete t[n]})),!_.Z.deepEqual(t,this.acl.get()))return this.acl.set(t),!0}},{key:"canDecrypt",value:function(){var e=this.encryptionSentinel.get();return this.isDecrypted=!e||Z.default.crypto.canDecryptSentinel(e),this.isDecrypted}},{key:"addBackup",value:function(e){this.backups.set(s()({},e,""))}},{key:"getLastBackup",value:function(){var e=this.backups.get();if(e){var t=Object.keys(e).sort();return+t[t.length-1]}return 0}},{key:"getLastBackupDrive",value:function(){var e=Z.default.settings.backupsDrive.get();return e&&e[this.id]||0}},{key:"isLocalOnly",value:function(){return this._isLocalOnly}},{key:"parseAll",value:function(e){_.Z.parseSubtree(this.getRootItem(),e)}},{key:"incrementNumItems",value:function(e){this._numItems+=e}},{key:"numItems",value:function(){return this._numItems}},{key:"getDateModified",value:function(){return k.Z.getDocModified(this.id)}}],[{key:"create",value:function(t){var n=t.id,r=t.text,i=t.rootData,a=t.backing;return new e({id:n||b.Z.generateID(),rootData:i,text:r,acl:s()({},m.Z.getUid(),{r:y.Z.DocumentAccessRoles.Admin,e:m.Z.getAccountEmail(),t:m.Z.getAccountName()}),backing:a||(_.Z.isDemoMode()?w.Z:P.Z),encryptionSentinel:void 0})}},{key:"fromData",value:function(t,n){var r={};return Object.keys(t.acl).forEach((function(e){var n=t.acl[e];r[e]=_.Z.isNumber(n)?{r:n,t:m.Z.getAccountName(),e:m.Z.getAccountEmail()}:n})),new e({id:t.id,rootData:t.rootData,text:t.text,acl:r,backing:n,encryptionSentinel:t.encryptionSentinel,isDeleted:t.isDeleted})}}]),e}(),p()(r.prototype,"ensureRootArchivedItem",[v.ZP],Object.getOwnPropertyDescriptor(r.prototype,"ensureRootArchivedItem"),r.prototype),p()(r.prototype,"ensureRootDeletedItem",[v.ZP],Object.getOwnPropertyDescriptor(r.prototype,"ensureRootDeletedItem"),r.prototype),p()(r.prototype,"createArchivedVMLI",[v.ZP],Object.getOwnPropertyDescriptor(r.prototype,"createArchivedVMLI"),r.prototype),p()(r.prototype,"createDeletedVMLI",[v.ZP],Object.getOwnPropertyDescriptor(r.prototype,"createDeletedVMLI"),r.prototype),p()(r.prototype,"propagateArchive",[v.ZP],Object.getOwnPropertyDescriptor(r.prototype,"propagateArchive"),r.prototype),p()(r.prototype,"propagateDelete",[v.ZP],Object.getOwnPropertyDescriptor(r.prototype,"propagateDelete"),r.prototype),p()(r.prototype,"propagateArchiveAndDelete",[v.ZP],Object.getOwnPropertyDescriptor(r.prototype,"propagateArchiveAndDelete"),r.prototype),r)},404:(e,t,n)=>{"use strict";n.d(t,{W:()=>M,a:()=>T});var r=n(319),i=n.n(r),a=n(4575),o=n.n(a),s=n(3913),c=n.n(s),l=n(1506),u=n.n(l),d=n(2205),h=n.n(d),p=n(8585),f=n.n(p),g=n(9754),m=n.n(g),v=n(8),y=n.n(v),k=n(8855),_=n(8651),Z=n(9955),w=n(4654),b=n(5252),P=n(4327),S=n(7274),D=n(9148),I=n(6470);function E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var x=0;function C(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}var A=function(e,t,n){var r=0;if(C(e,t))return!0;if("object"!==y()(e)||null===e||"object"!==y()(t)||null===t)return!1;var i,a=Object.keys(e),o=Object.keys(t);if(a.length!==o.length)return!1;for(var s=0;s<a.length;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i=void 0,!hasOwnProperty.call(t,a[s]))return!1;if(n&&!1===(i=n(a[s],e[a[s]],t[a[s]])))return!1;if(void 0===i&&!C(e[a[s]],t[a[s]]))return!1}return!0},L={constructor:!0,render:!0,componentDidMount:!0,componentWillReceiveProps:!0,UNSAFE_componentWillReceiveProps:!0,shouldComponentUpdate:!0,componentWillUpdate:!0,componentDidUpdate:!0,componentWillUnmount:!0},M=function(){return Z.useMemo((function(){return"m_"+x++}),[])},T=function(e){h()(n,e);var t=E(n);function n(e){var r;o()(this,n),r=t.call(this,e);var a=Object.getPrototypeOf(u()(r)),s=Object.getOwnPropertyNames(a).concat(Object.getOwnPropertyNames(a.__proto__)),c=_.Z.arrayDifferenceWithMap(s,L);return b.Z.binder.apply(b.Z,[u()(r)].concat(i()(c))),r.state=r.getInitialState(),r}return c()(n,[{key:"shouldComponentUpdate",value:function(e,t){return!A(this.props,e,this.arePropsEqual)||!A(this.state,t,this.areStatesEqual)}},{key:"getInitialState",value:function(){this.init&&this.init();var e=this.getState?this.getState(this.props):{};this._observables&&(e=_.Z.extend(e,this._observables));var t=null;return e&&(this.setupListeners(e),t=this.transformState(e)),t}},{key:"createObservables",value:function(e){try{_.Z.PAssert(475,!this._listeners,"You have to run createObservables in init()")}catch(r){_.Z.reportError(r)}for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];_.Z.isArray(n)?e[t]=new D.Z(n):e[t]=new S.Z(n);try{_.Z.PAssert(476,!this.hasOwnProperty(t),"Must not multi-define observable properties")}catch(r){_.Z.reportError(r)}this[t]=e[t]}try{_.Z.PAssert(477,!this.hasOwnProperty("_observables"),"Must not define an _observables property and use createObservables")}catch(r){_.Z.reportError(r)}this._observables=e}},{key:"_addListener",value:function(e){try{_.Z.PAssert(478,e&&e.target,"Must add a valid listener")}catch(t){_.Z.reportError(t)}this._ensureListeners();try{_.Z.PAssert(479,!this._hasListener(e.target),"Must not double register the same observable/trigger")}catch(t){_.Z.reportError(t)}this._listeners.push(e)}},{key:"refreshListeners",value:function(e){this.disposeListeners();var t=this.getState?this.getState(e||this.props):{};this._observables&&(t=_.Z.extend(t,this._observables)),t&&this.setupListeners(t)}},{key:"_ensureListeners",value:function(){this._listeners||(this._listeners=[],this._permanentListeners=[])}},{key:"setupListeners",value:function(e){for(var t in this._ensureListeners(),e||(e=this.getState?this.getState(this.props):{}),e)if(e.hasOwnProperty(t)){var n=e[t];n instanceof S.Z&&this._addListener(n.listen(this.onListener))}}},{key:"disposeListeners",value:function(e){if(this._listeners){for(var t=0,n=0;n<this._listeners.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._listeners[n].dispose()}if(this._listeners=[],e)for(var r=0,i=0;i<this._permanentListeners.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this._permanentListeners[i].dispose()}}e&&this.disposeDispatcherListeners()}},{key:"disposeDispatcherListeners",value:function(){if(this._dispatcherListeners){for(var e=0,t=0;t<this._dispatcherListeners.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._dispatcherListeners[t],r=n[0],i=n.slice(1);r.unlisten.apply(r,i)}this._dispatcherListeners=[]}}},{key:"listenTo",value:function(e,t){try{_.Z.PAssert(480,e&&(e instanceof I.Z||e instanceof S.Z),"Can only listen to an Observable or a Trigger object")}catch(r){_.Z.reportError(r)}if(e instanceof I.Z||e instanceof S.Z){var n=e.listen(this.onListener);!1!==t?this._addListener(n):this._permanentListeners.push(n)}}},{key:"listenToDispatcher",value:function(e,t){this._dispatcherListeners||(this._dispatcherListeners=[]);var n,r=Array.prototype.slice.call(arguments);_.Z.isString(r[0])?n=P.Z:(n=r[0],r.splice(0,1)),r.push(this.onListener),n.listen.apply(n,r);var i=[n].concat(r);this._dispatcherListeners.push(i)}},{key:"_hasListener",value:function(e){var t=0;try{_.Z.PAssert(481,e,"Must have a valid target")}catch(i){_.Z.reportError(i)}for(var n=!1,r=0;r<this._listeners.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._listeners[r].target===e){n=!0;break}}return n}},{key:"_getState",value:function(e){var t=this.getState?this.getState(e||this.props):{};return this._observables&&(t=_.Z.extend(t,this._observables)),this.transformState(t)}},{key:"transformState",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];n&&n instanceof S.Z&&(e[t]=n.get(),n instanceof D.Z&&(e[t+"_arrVer"]=n.version))}return e}},{key:"onListener",value:function(){this.updateState()}},{key:"updateState",value:function(e){var t=this.state,n=this._getState(e);if(this.onBeforeChanged){var r=this.onBeforeChanged(n,t);void 0!==r&&(n=r)}!1!==n&&(this.setState(n),this.onAfterChanged&&this.onAfterChanged(n,t))}},{key:"componentWillUnmount",value:function(){this.disposeListeners(!0),this.__hotkeys&&(w.default.hotkeys.popStack(this.__hotkeys),this.__hotkeys=void 0),this.onUnmount&&this.onUnmount(this.state),this._isMounted=!1}},{key:"getChildByKey",value:function(e){return _.Z.getReactChildByKey(this.props.children,e)}},{key:"componentDidMount",value:function(){this._isMounted=!0,this.getHotkeys?this.__hotkeys=w.default.hotkeys.pushStack(this.getHotkeys()):this.onEscapeKey&&(this.__hotkeys=w.default.hotkeys.pushStackEscape(this.onEscapeKey)),this.onMount&&this.onMount()}},{key:"getUniqueID",value:function(){return this.props["data-moo-id"]?this.props["data-moo-id"]:(this.__id||(this.__id="m_"+x++),this.__id)}},{key:"componentDidCatch",value:function(e,t){this.onComponentError&&this.onComponentError(e,t),_.Z.reportError(e,t,void 0,"React Component Error: "),w.default.toasts.pushMessage(k.Z.MessageID.ReactError)}}]),n}(Z.Component)},9607:(e,t,n)=>{"use strict";n.d(t,{Z:()=>P});var r,i=n(4575),a=n.n(i),o=n(3913),s=n.n(o),c=n(2205),l=n.n(c),u=n(8585),d=n.n(u),h=n(9754),p=n.n(h),f=n(3124),g=n.n(f),m=n(8572),v=n(8855),y=n(8651),k=n(4654),_=n(92),Z=n(7274),w=n(9148);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}const P=new(r=function(e){l()(n,e);var t=b(n);function n(){var e;return a()(this,n),(e=t.call(this)).selected={},e.numSelected=new Z.Z(0),e._queueRemoveEditables=[],e}return s()(n,[{key:"_selectedObjForPane",value:function(e){try{y.Z.PAssert(458,e,"Multiselect should always pass in a pane")}catch(n){y.Z.reportError(n)}e=e||y.Z.focusedPane;var t=this.selected[e.id];return t||(t=this.selected[e.id]={arr:new w.Z,isInverted:!1}),t}},{key:"getSelectedForPaneObs",value:function(e){return this._selectedObjForPane(e).arr}},{key:"_selectedForPane",value:function(e){return this._selectedObjForPane(e).arr.get()}},{key:"onChanged",value:function(e){this.numSelected.set(this.numSelectedInPane(e))}},{key:"isInverted",value:function(e){return this._selectedObjForPane(e).isInverted}},{key:"setInverted",value:function(e,t){this._selectedObjForPane(t).isInverted=e}},{key:"isSelected",value:function(e,t){return this._selectedForPane(t).indexOf(e)>=0}},{key:"hasSelection",value:function(e){return this._selectedForPane(e).length>0}},{key:"getSelected",value:function(e){return this._selectedForPane(e)}},{key:"getSelectedItems",value:function(e,t){return this.getSelectedObjects(e,t).map((function(e){return e.item}))}},{key:"getSelectedObjects",value:function(e,t){for(var n=0,r=this._selectedForPane(e),i=[],a=0;a<r.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=r[a];if(e.numItems()>o)if(e.usesVMLIs){var s=e.objectAtIndex(o),c=s.item;!c||!t&&c.isNote()||i.push(s)}else{var l=e.itemsSimple.get()[o];l.item&&i.push(l)}}return i}},{key:"numSelectedInPane",value:function(e){for(var t=0,n=0,r=this._selectedForPane(e),i=0;i<r.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=e.itemAtIndex(r[i]);!a||a.isNote&&a.isNote()||n++}return n}},{key:"getFirstSelectedIndex",value:function(e){var t=0;e=e||y.Z.focusedPane;for(var n=this._selectedForPane(e),r=Number.MAX_VALUE,i=!1,a=0;a<n.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=n[a];o<r&&(r=o,i=!0)}return i?r:-1}},{key:"getFirstSelectedItem",value:function(e){e=e||y.Z.focusedPane;var t=this.getFirstSelectedIndex(e);if(t>=0)return e.itemAtIndex(t)}},{key:"getLastSelectedIndex",value:function(e){var t=0;e=e||y.Z.focusedPane;for(var n=this._selectedForPane(e),r=-1,i=0;i<n.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=n[i];a>r&&(r=a)}return r}},{key:"getLastSelectedItem",value:function(e){e=e||y.Z.focusedPane;var t=this.getLastSelectedIndex(e);if(t>=0)return e.itemAtIndex(t)}},{key:"_resetPaneID",value:function(e){var t=k.default.PaneManager,n=!0;if(t.isPaneActive(e)){var r=t.getPaneById(e);r.canResetMultiselect()?(this.setSelected([],r),this.selected[e].isInverted=!1):n=!1}else delete this.selected[e];return n}},{key:"reset",value:function(e){var t=!0;if(e)e.canResetMultiselect()?this._resetPaneID(e.id):t=!1;else for(var n in this.selected)this.selected.hasOwnProperty(n)&&(t=t&&this._resetPaneID(n));t&&this.fireEvent("reset",[e])}},{key:"setSelected",value:function(e,t,n){var r=0;t=t||y.Z.focusedPane;var i=this._selectedForPane(t),a=y.Z.arrayDiff(i,e);this.setInverted(!1,t),this.getSelectedForPaneObs(t).set(e);for(var o=0;o<a.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=a[o];if(s<t.numItems()){var c=t.itemAtIndex(s);if(c)c.itemChanged.notify()}}}},{key:"toggleSelected",value:function(e,t,n){t=t||y.Z.focusedPane;var r=this.getSelectedForPaneObs(t),i=r.indexOf(e);i>=0&&!0!==n?r.remove(e):i<0&&!1!==n&&r.push(e);var a=t.itemAtIndex(e);a&&a.itemChanged.notify()}},{key:"addSelected",value:function(e,t){this.toggleSelected(e,t,!0)}},{key:"removeSelected",value:function(e,t){this.toggleSelected(e,t,!1)}},{key:"selectInOrder",value:function(e,t,n){var r=0;n=n||y.Z.focusedPane;for(var i=[],a=e;a<=t;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i.push(a)}this.setSelected(i,n)}},{key:"forEach",value:function(e,t){var n=0;k.default.PaneUpdateBatcher.beginUpdateItems(),e=e||y.Z.focusedPane;for(var r,i=this.getSelectedObjects(e),a=i.map((function(e){return e.item})),o=0;o<i.length&&!1!==r;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=i[o];r=t(s.item,o,i.length,s,a)}k.default.PaneUpdateBatcher.commitUpdateItems()}},{key:"map",value:function(e,t){var n=this.getSelectedItems(e);return n.map((function(e,r){return t(e,r,n.length)}))}},{key:"setSelectedNew",value:function(e,t){this.setInverted(!1,t),this.getSelectedForPaneObs(t).set(e)}},{key:"onClick",value:function(e,t,n){if(n.shiftKey){var r=this.getFirstSelectedIndex(t),i=this.getLastSelectedIndex(t);e<r?r=e:e>i&&(i=e),this.selectInOrder(r,i,t)}else this.setSelectedNew([e],t)}},{key:"onKeyDown",value:function(e,t){var n,r=Math.max(this.getFirstSelectedIndex(e),0),i=Math.max(this.getLastSelectedIndex(e),0);t.keyCode===v.Z.KeyCode.ArrowUp?n=Math.max(0,r-1):t.keyCode===v.Z.KeyCode.ArrowDown&&(n=Math.min(i+1,e.numItems()-1)),t.shiftKey?(this.isInverted(e)&&1===this.numSelectedInPane(e)&&this.setInverted(!1,e),this.isInverted(e)?(n=this.getFirstSelectedIndex(e),this.removeSelected(n,e)):n>=0&&n<e.numItems()&&(this.addSelected(n,e),e.scrollIndexIntoView(n))):n>=0&&this.setSelectedNew([n],e)}}]),n}(_.Z),g()(r.prototype,"reset",[m.ZP],Object.getOwnPropertyDescriptor(r.prototype,"reset"),r.prototype),r)},3234:(e,t,n)=>{"use strict";n.d(t,{Z:()=>w,c:()=>b});var r=n(7154),i=n.n(r),a=n(4575),o=n.n(a),s=n(3913),c=n.n(s),l=n(2205),u=n.n(l),d=n(8585),h=n.n(d),p=n(9754),f=n.n(p),g=n(8855),m=n(8651),v=n(9955),y=n(4654);function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}var _=function(e,t){m.Z.reportError(e,t,void 0,"React Component Error: "),y.default.toasts.pushMessage(g.Z.MessageID.ReactError)},Z=function(e){u()(n,e);var t=k(n);function n(e){var r;return o()(this,n),(r=t.call(this,e)).state={error:null},r}return c()(n,[{key:"componentDidCatch",value:function(e,t){try{var n;this.props.onError&&(n=this.props.onError()),n||_(e,t)}catch(r){}this.setState({error:e})}},{key:"render",value:function(){var e=this.props.children;return null!==this.state.error?null:e||null}}]),n}(v.Component);function w(e,t){var n=function(n){return v.createElement(Z,{onError:t},v.createElement(e,i()({},n,{onError:t})))};return v.memo(n)}function b(e,t){var n=function(n,r){return v.createElement(Z,null,v.createElement(e,i()({},n,{ref:r,onError:t})))};return n=v.forwardRef(n),v.memo(n)}},2377:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(3038),i=n.n(r),a=n(9955),o=n(7274),s=n(3170);function c(e,t,n){var r=(0,a.useMemo)((function(){return new o.Z(e)}),[]);if(t){var c=(0,s.Z)(r),l=i()(c,1)[0];return e!==l&&(null===n||void 0===n||n(e)),[r,l]}return[r]}},7077:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(9955),i=n(2971);function a(e,t){var n,a=(0,r.useRef)(),o=(0,i.Z)(e);o&&e!==o&&(null===(n=a.current)||void 0===n||n.dispose(),a.current=void 0);e&&!a.current&&(a.current=e.listen(t)),(0,r.useEffect)((function(){return function(){var e;null===(e=a.current)||void 0===e||e.dispose(),a.current=void 0}}),[])}},3170:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(9955),i=n(6604),a=n(8047);var o=function(e,t,n,r){for(var i=0,a=n.current,o=t.current,s=Math.max(e.length,o?o.length:0),c=0;c<s;c++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var l=e[c];!l||o&&l===o[c]||(null!==o&&void 0!==o&&o[c]&&a[c]&&(a[c].dispose(),a[c]=void 0),l&&(a[c]=l.listen(r)))}n.current=a,t.current=e};const s=function(){for(var e=0,t=0,n=(0,r.useRef)(),s=arguments.length,c=new Array(s),l=0;l<s;l++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;c[l]=arguments[l]}n.current=c;var u=(0,r.useRef)(),d=u.current,h=(0,i.Z)(),p=(0,r.useRef)([]),f=(0,r.useCallback)((function(){a.Z.handleChange((function(){p.current.length&&h()}))}),[]);return d!==c&&o(c,u,p,f),(0,r.useEffect)((function(){return function(){var e;null===(e=p.current)||void 0===e||e.forEach((function(e){return null===e||void 0===e?void 0:e.dispose()})),p.current=[],u.current=[]}}),[]),c.map((function(e){var t,n;return null===e||void 0===e||null===(t=(n=e).get)||void 0===t?void 0:t.call(n)}))}},7274:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});n(8);var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(9966);const c=function(){function e(t,n,r){i()(this,e),this._value=t,this._listeners=n?[new s.Z(this,n)]:void 0,this._shouldFreeze=r}return o()(e,[{key:"ignoreLoopingListenersError",value:function(){0}},{key:"get",value:function(){return this._value}},{key:"countProperties",value:function(){return Object.keys(this._value).length}},{key:"set",value:function(e,t){var n=this._value;return this._value=e,!1!==t&&this.notify(e,n,t),e}},{key:"hasValue",value:function(){return void 0!==this._value}},{key:"onHasValue",value:function(e){if(this.hasValue())e(this._value);else var t,n=this.listen((function(r,i){void 0===r||t||(t=!0,e(r,i),setTimeout((function(){n.dispose()}),0))}))}},{key:"onValue",value:function(e,t){if(this._value===e)t();else var n,r=this.listen((function(i,a){i!==e||n||(n=!0,t(),setTimeout((function(){r.dispose()}),0))}))}},{key:"onTrue",value:function(e){this.onValue(!0,e)}},{key:"promiseOnValue",value:function(e){var t=this;return new Promise((function(n){t.onValue(e,n)}))}},{key:"hasListeners",value:function(){return this._listeners&&this._listeners.length>0}},{key:"listen",value:function(e,t){this._listeners||(this._listeners=[]);var n=new s.Z(this,e);return this._listeners.push(n),t&&void 0!==this._value&&e(this._value),n}},{key:"unlistenListener",value:function(e){this._listeners&&this._listeners.remove(e)}},{key:"unlisten",value:function(e){if(this._listeners){var t=this._listeners.findIndex((function(t){return t.cb===e}));t>=0&&this._listeners.removeAt(t)}}},{key:"notify",value:function(e,t,n){0===arguments.length&&(e=this._value,t=this._value,n=!0);var r=this._listeners;if(r&&r.length>0&&(e!==t||!0===n)){var i=0;0;for(var a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[a];!1===(0===arguments.length?o.cb(this._value,void 0,n):o.cb(e,t,n))&&(r.splice(a,1),a--)}0}}}]),e}()},9148:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(6525),c=n.n(s),l=n(2205),u=n.n(l),d=n(8585),h=n.n(d),p=n(9754),f=n.n(p),g=n(8651);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}const v=function(e){u()(n,e);var t=m(n);function n(e,r,a){var o;return i()(this,n),(o=t.call(this,e,r,a))._value=e||[],o.version=0,o}return o()(n,[{key:"notify",value:function(e,t,r){0===arguments.length&&this.version++,c()(f()(n.prototype),"notify",this).apply(this,arguments)}},{key:"length",value:function(){return this._value.length}},{key:"set",value:function(e,t){if(!e||!g.Z.isArray(e)){try{g.Z.PAssert(216,!1,"Value set on an Observable array must be an array",e)}catch(n){g.Z.reportError(n)}e=[]}return this._value=e,this.version++,!1!==t&&this.notify(this._value),e}},{key:"clear",value:function(e){this.set([],e)}},{key:"pop",value:function(e){this.version++;var t=this._value.pop();return!1!==e&&this.notify(this._value),t}},{key:"remove",value:function(e,t){var n;if(g.Z.isFunction(e))for(var r=0,i=0;i<this._value.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e(this._value[i])&&(void 0===n&&(n=i),this._value.splice(i,1),i--)}else n=this._value.remove(e);return this.version++,n>=0&&!1!==t&&this.notify(this._value),n}},{key:"removeAt",value:function(e,t){var n=this._value.removeAt(e);return this.version++,!1!==t&&this.notify(this._value),n}},{key:"push",value:function(e,t){var n=this._value.push(e);return this.version++,!1!==t&&this.notify(this._value),n}},{key:"pushIfUnique",value:function(e,t){return this.includes(e)?this._value.length:this.push(e,t)}},{key:"pushArray",value:function(e,t){var n=this._value.pushArray(e);return this.version++,!1!==t&&this.notify(this._value),n}},{key:"insertSorted",value:function(e,t,n){var r=this._value.insertSorted(e,t);return this.version++,!1!==n&&this.notify(this._value),r}},{key:"sort",value:function(e,t){return this._value.sort(e),this.version++,!1!==t&&this.notify(this._value),this}},{key:"splice",value:function(e,t,n,r){var i;return i=n?this._value.splice(e,t,n):this._value.splice(e,t),this.version++,!1!==r&&this.notify(this._value),i}},{key:"indexOf",value:function(e){return this._value.indexOf(e)}},{key:"indexOfWithProperty",value:function(e,t){return this._value.indexOfWithProperty(e,t)}},{key:"includes",value:function(e){return this._value.includes(e)}},{key:"some",value:function(e){return this._value.some(e)}},{key:"forEach",value:function(e){return this._value.forEach(e)}},{key:"map",value:function(e){return this._value.map(e)}},{key:"find",value:function(e){return this._value.find(e)}},{key:"findIndex",value:function(e){return this._value.findIndex(e)}},{key:"filter",value:function(e){return this._value.filter(e)}},{key:"hasValue",value:function(){return this._value.length>0}}]),n}(n(7274).Z)},8047:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var r,i=n(4575),a=n.n(i),o=n(3913),s=n.n(o),c=n(3124),l=n.n(c),u=n(8572),d=n(8651);const h=new(r=function(){function e(){a()(this,e),this._numInBatch=0,this.batch=[]}return s()(e,[{key:"isBatching",value:function(){return this._numInBatch>0}},{key:"beginBatch",value:function(){this._numInBatch++,d.Z.timeoutOnce("batch_beginAction",this.onActionTimeout,0)}},{key:"handleChange",value:function(e){this._numInBatch>0?this.batch.includes(e)||this.batch.push(e):e()}},{key:"endBatch",value:function(e){this._numInBatch--,(this._numInBatch<=0||e)&&(this._numInBatch=0,this.batch.forEach((function(e){return e()})),this.batch=[])}},{key:"onActionTimeout",value:function(){this.batch.length>0&&this.endBatch(!0)}}]),e}(),l()(r.prototype,"onActionTimeout",[u.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onActionTimeout"),r.prototype),r)},7048:(e,t,n)=>{"use strict";n.d(t,{Z:()=>_});var r,i=n(319),a=n.n(i),o=n(4575),s=n.n(o),c=n(3913),l=n.n(c),u=n(2205),d=n.n(u),h=n(8585),p=n.n(h),f=n(9754),g=n.n(f),m=n(3124),v=n.n(m),y=n(8572);function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}const _=(r=function(e){d()(n,e);var t=k(n);function n(e,r,i){var o,c,l=0;s()(this,n),c=t.call(this,void 0,i);for(var u=0;u<e.length;u++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;e[u].listen(c.onChanged)}return c._observables=e,c.checkFn=r,c._value=(o=c).checkFn.apply(o,a()(c._observables.map((function(e){return e.get()})))),c}return l()(n,[{key:"onChanged",value:function(e,t,n){var r=this._value,i=this.checkFn.apply(this,a()(this._observables.map((function(e){return e.get()}))));(i!==r||n)&&this.set(i,n)}}]),n}(n(7274).Z),v()(r.prototype,"onChanged",[y.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onChanged"),r.prototype),r)},9998:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(6525),c=n.n(s),l=n(2205),u=n.n(l),d=n(8585),h=n.n(d),p=n(9754),f=n.n(p),g=n(8651);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}const v=function(e){u()(n,e);var t=m(n);function n(e,r){var a;return i()(this,n),(a=t.call(this,e||{},r)).version=0,a}return o()(n,[{key:"getProperty",value:function(e){return this._value[e]}},{key:"setProperty",value:function(e,t,n){if(g.Z.isString(this._value)){try{g.Z.PAssert(473,!1,"ObservableObject is string",e)}catch(i){g.Z.reportError(i)}this._value={}}var r=!1;this._value[e]!==t&&(this._value[e]=t,this.version++,r=!0),(n||!1!==n&&r)&&this.notify(this._value)}},{key:"deleteProperty",value:function(e,t){delete this._value[e],this.version++,!1!==t&&this.notify(this._value)}},{key:"hasValue",value:function(){return Object.keys(this._value).length>0}},{key:"set",value:function(e,t){return void 0!==e&&null!==e||(e={}),c()(f()(n.prototype),"set",this).call(this,e,t)}},{key:"clear",value:function(e){return this.set({},e)}},{key:"isEmpty",value:function(){return 0===Object.keys(this._value).length}}]),n}(n(7274).Z)},6186:(e,t,n)=>{"use strict";n.d(t,{Z:()=>H});var r,i=n(4575),a=n.n(i),o=n(3913),s=n.n(o),c=n(8651),l=n(8855),u=n(4654),d=n(1506),h=n.n(d),p=n(6525),f=n.n(p),g=n(2205),m=n.n(g),v=n(8585),y=n.n(v),k=n(9754),_=n.n(k),Z=n(1186),w=n(1015),b=n(7100),P=n(4472),S=n(5252),D=n(5193),I=n(4327),E=n(7274),x=n(8001),C=n(3124),A=n.n(C),L=n(8572),M=n(9603);const T=(r=function(){function e(t){for(var n in a()(this,e),t)t.hasOwnProperty(n)&&(this[n]=t[n]);this.id=t.id,this.text=t.name,this.search=this.pane.search,this.itemsMap={},this.items=[],this.numInstancesOfItem={};try{c.Z.PAssert(1294,void 0!==this.id,"Added a block without an id")}catch(r){c.Z.reportError(r)}}return s()(e,[{key:"shouldShowTime",value:function(){return!this.isOverdue&&this.isDate}},{key:"numItems",value:function(){return this.items.length}},{key:"getLastItem",value:function(){var e=this.items[this.items.length-1];return e&&e.isNote()&&(e=e.parent()),e}},{key:"comparePriority",value:function(e,t){var n=e.getPriority(),r=t.getPriority();return n>r?-1:n<r?1:0}},{key:"compareDate",value:function(e,t){try{c.Z.PAssert(1295,this.date,"This block does not have a date",this.text)}catch(h){c.Z.reportError(h)}var n=this.pane,r=e.getNextDate()||e.getDate(n),i=t.getNextDate()||t.getDate(n);if(e.isComplete()&&!t.isComplete())return-1;if(!e.isComplete()&&t.isComplete())return 1;if(e.isComplete()&&t.isComplete())return e.dateCompleted>t.dateCompleted?1:-1;if(r&&!i)return-1;if(!r&&i)return 1;if(!r&&!i)return 0;if(e.getDuration(n)>0){var a=e.getDisplayDateWithDuration(this.date);a&&(r=a)}if(t.getDuration(n)>0){var o=t.getDisplayDateWithDuration(this.date);o&&(i=o)}var s=M.Z.clearTime(r),l=M.Z.clearTime(i);if(+s!==+l)return s<l?-1:1;if(r.hasTimeOfDay()&&i.hasTimeOfDay()){var u=r.getTimeOfDay(),d=i.getTimeOfDay();return u===d?0:u<d?-1:1}return r.hasTimeOfDay()?1:i.hasTimeOfDay()?-1:0}},{key:"compareOrder",value:function(e,t){return e.index-t.index}},{key:"compareItemsAgenda",value:function(e,t){var n=e.item,r=t.item;c.Z.DAssert(n,"Must have a valid left item to compare"),c.Z.DAssert(r,"Must have a valid right item to compare"),c.Z.DAssert(!n||n.parent(),"Must have a valid left parent item"),c.Z.DAssert(!r||r.parent(),"Must have a valid right parent item"),n.isNote()&&(n=n.parent()),r.isNote()&&(r=r.parent());var i=this.isStarred||this.isImportant?0:this.compareDate(n,r);if(0===i){var a=this.isStarred?0:this.comparePriority(n,r);return 0===a?this.compareOrder(e,t):a}return i}},{key:"compareItemsCreated",value:function(e,t){return this.pane.compareDate(e.item.dateCreated,t.item.dateCreated)}},{key:"compareItemsCompleted",value:function(e,t){return this.pane.compareDate(e.item.dateCompleted,t.item.dateCompleted)}},{key:"compareItemsModified",value:function(e,t){return this.pane.compareDate(e.item.dateModified,t.item.dateModified)}},{key:"addItem",value:function(e){try{c.Z.PAssert(1296,e&&c.Z.isVMLI(e),"Must be adding a valid item: "+c.Z.getObjectInfo(e))}catch(t){c.Z.reportError(t)}this.itemsMap[e.id]||(this.items.push(e),this.itemsMap[e.id]=e)}},{key:"toggleCollapsed",value:function(){this.paneObject.setCollapsed(!this.isCollapsed())}},{key:"isCollapsed",value:function(){var e;return(null===(e=this.paneObject)||void 0===e?void 0:e.isCollapsed())||this.pane.isBlockCollapsedLegacy(this)}},{key:"sort",value:function(e){var t;if(this.pane.isViewAgenda()){var n=this.pane.getSortModeBlocks();"Date"===n?t=this.compareItemsAgenda:"Created"===n?t=this.compareItemsCreated:"Completed"===n?t=this.compareItemsCompleted:"Modified"===n&&(t=this.compareItemsModified)}else this.pane.isViewCalendarMonth()?t=this.compareItemsAgenda:this.sortMode&&"None"!==this.sortMode&&(t=this.pane.getItemComparator());if(t){var r=e.map((function(e,t){return{item:e,index:t}}));return r.sort(t),r.map((function(e){return e.item}))}return e}},{key:"_getAllItemsSorted",value:function(e,t,n,r){var i=this;t[n.id]||(t[n.id]=n,n.isHidden(this.pane)||e.push(n),r&&!this.pane.isCollapsedByID(this.pane.getPaneObjectID(n,this),n,!1)&&n.getItems().forEach((function(n){return i._getAllItemsSorted(e,t,n,!0)})))}},{key:"getAllItemsSorted",value:function(e){var t=this,n=[],r={};return this.items.forEach((function(i){return t._getAllItemsSorted(n,r,i,e)})),n=this.sort(n)}}]),e}(),A()(r.prototype,"compareItemsAgenda",[L.ZP],Object.getOwnPropertyDescriptor(r.prototype,"compareItemsAgenda"),r.prototype),A()(r.prototype,"compareItemsCreated",[L.ZP],Object.getOwnPropertyDescriptor(r.prototype,"compareItemsCreated"),r.prototype),A()(r.prototype,"compareItemsCompleted",[L.ZP],Object.getOwnPropertyDescriptor(r.prototype,"compareItemsCompleted"),r.prototype),A()(r.prototype,"compareItemsModified",[L.ZP],Object.getOwnPropertyDescriptor(r.prototype,"compareItemsModified"),r.prototype),A()(r.prototype,"toggleCollapsed",[L.ZP],Object.getOwnPropertyDescriptor(r.prototype,"toggleCollapsed"),r.prototype),r);var R=n(9320),O=n(8047),F=n(9998);function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_()(e);if(t){var i=_()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return y()(this,n)}}var B={Groups_Project:{Default:"None",Available:["None","Alphabetical","NumItems","Date","Priority","Created","Modified","Completed"]}};B.Groups_Tag=B.Groups_Contact={Default:"Alphabetical",Available:["Alphabetical","NumItems"]},B.Agenda_Today=B.Agenda_Week=B.Agenda_Month=B.Agenda_All={Default:"Date",Available:["Date","Created","Completed","Modified"]};const U=function(e){m()(n,e);var t=N(n);function n(e){var r;a()(this,n),e.document||(e.document=D.Z.getDefaultDocument());(r=t.call(this,e,{isWriteable:!0,hasNonVMLIs:!0,supportCollapsing:!0,supportCompleting:!0,supportIndent:!1,supportOffline:!0,supportMenuIcon:!0,supportViewMenu:!0,supportMultiselect:!1,supportClickOverviewScroll:!1,isDraggable:!0,overviewTracksScroll:!1,overviewCanTrackScroll:!0,combineOverdue:!0,supportHistory:!0,searchFilters:["project","task","starred","complete","priority","showOnlyMatches","showOnlyAgendaDates","showOnlyMatchingTags","showChildProjects"]})).type=l.Z.PaneMode.Task,r.paneClass="paneTask",S.Z.binder(h()(r),"getDayWidth","updateAllDay","scrollToToday","setViewMode","compareBlockDate","compareBlockName","compareBlockItemPriority","compareBlockItemCreated","compareBlockItemModified","compareBlockItemCompleted","compareItemDate","compareItemName","_itemSearchComparator","onScroll","addFnProject","addFnTag","addFnDate","onGCalendarActiveChanged","onGmailActiveChanged","onCalendarCustomDaysChanged","switchToOutline","onViewStateChanged","getItemComparator","onDayWeekStartChanged","_onSelectionChanged","setGroupMode","setSortBlocks","setSortItems","onStatusBarChange","onErroredAuthTokensChange"),r.dragHoveredBlock=new E.Z;var i=e.viewState||{};return i.viewMode||(i.viewMode=i.viewMode||"Outline"),i.sortModeBlocks=i.sortModeBlocks||{mode:"None"},i.sortModeItems=i.sortModeItems||{mode:"None"},c.Z.isString(i.sortModeBlocks)&&(i.sortModeBlocks={mode:i.sortModeBlocks}),c.Z.isString(i.sortModeItems)&&(i.sortModeItems={mode:i.sortModeItems}),r.viewState=new F.Z(i,r.onViewStateChanged),r.itemStatus=new F.Z,r.textStatus=new F.Z,r.itemInfos={},r.item.get()||r.item.set(r.getDefaultDisplayItem()),r._allPaneItems=[],r._isViewHelper={},r.topBoxHeight.set(0,!1),r.blocksCollapsed=e.blocksCollapsed||{},r.displayLocalItems=new E.Z(void 0===e.displayLocalItems||e.displayLocalItems),r.displayCalendars=new E.Z(e.displayCalendars||{}),r.numAllDay=new E.Z(0),r.setupViewState(),r.initBlocks(),u.default.settings.showStatusBar.listen(r.onStatusBarChange),Z.Z.erroredAuthTokens.listen(r.onErroredAuthTokensChange),r}return s()(n,[{key:"initBlocks",value:function(){this.blocks=[],this.blockImportant=void 0,this.blockStarred=void 0,this.days={},this.datesByItem={},this.starredItems={},this.priorityItems={},this.blocksByKey={},this.preventUpdateItemsForObject=void 0;var e=u.default.pluginManager.getPlugin(l.Z.PluginID.GCalendar);e.isActive()&&this.useItemStore(e.getDefaultItemStore());var t=u.default.pluginManager.getPlugin(l.Z.PluginID.Gmail);t.isActive()&&this.useItemStore(t.getDefaultItemStore()),u.default.pluginManager.listen("pluginActiveChanged",l.Z.PluginID.GCalendar,this.onGCalendarActiveChanged),u.default.pluginManager.listen("pluginActiveChanged",l.Z.PluginID.Gmail,this.onGmailActiveChanged),I.Z.listen("selectionChanged",this._onSelectionChanged),u.default.settings.dayWeekStart.listen(this.onDayWeekStartChanged),u.default.settings.calendarCustomDays.listen(this.onCalendarCustomDaysChanged),u.default.pluginManager.getPluginGCalendar().onCalendarsSynced.listen(this.updateItems)}},{key:"destroy",value:function(){u.default.pluginManager.unlisten("pluginActiveChanged",l.Z.PluginID.GCalendar,this.onGCalendarActiveChanged),u.default.pluginManager.unlisten("pluginActiveChanged",l.Z.PluginID.Gmail,this.onGmailActiveChanged),I.Z.unlisten("selectionChanged",this._onSelectionChanged),u.default.settings.dayWeekStart.unlisten(this.onDayWeekStartChanged),u.default.settings.calendarCustomDays.unlisten(this.onCalendarCustomDaysChanged),u.default.pluginManager.getPluginGCalendar().onCalendarsSynced.unlisten(this.updateItems),u.default.settings.showStatusBar.unlisten(this.onStatusBarChange),Z.Z.erroredAuthTokens.unlisten(this.onErroredAuthTokensChange),f()(_()(n.prototype),"destroy",this).call(this)}},{key:"onErroredAuthTokensChange",value:function(){this.setupViewState()}},{key:"onStatusBarChange",value:function(e){e&&this.updateItemsImmediate(!0)}},{key:"getPaneIcon",value:function(){return this.isViewAgenda()?"today":"format_list_bulleted"}},{key:"keydown",value:function(e){return P.Z.isValid()&&P.Z.getStartIndex()===P.Z.getEndIndex()&&this.preventUpdateForObject(P.Z.getStartObject()),f()(_()(n.prototype),"keydown",this).call(this,e)}},{key:"handleLeftSideTap",value:function(e,t){return this.clearPreventUpdate(),f()(_()(n.prototype),"handleLeftSideTap",this).call(this,e,t)}},{key:"clearPreventUpdate",value:function(e){var t=this;if(!P.Z.noUnstickMatches){var n=this.preventUpdateItemsForObject;if(n&&u.default.DragDrop.isDragging){I.Z.listen("endDrag",(function e(){I.Z.unlisten("endDrag",e),t.clearPreventUpdate()}))}else{var r,i=e;if(n)i=i||(null===(r=this.search)||void 0===r?void 0:r.unstickMatch(n.item)),this.preventUpdateItemsForObject=void 0;i&&(this.setItemsDirty(),u.default.PaneUpdateBatcher.updateAllItems())}}}},{key:"_onSelectionChanged",value:function(e){P.Z.getPane()===this&&this.preventUpdateItemsForObject?P.Z.isValid()?P.Z.getStartObject().id!==this.preventUpdateItemsForObject.id&&(u.default.PaneUpdateBatcher.beginUpdateItems(),this.clearPreventUpdate(),u.default.PaneUpdateBatcher.updateAllItems(),e&&this.restoreSelection(e),u.default.PaneUpdateBatcher.commitUpdateItems()):(this.clearPreventUpdate(),this.updateItems()):this.clearPreventUpdate()}},{key:"isCalendarItem",value:function(e){return e.belongsToItemStore(u.default.pluginManager.getPlugin(l.Z.PluginID.GCalendar).getDefaultItemStore())}},{key:"isEmailItem",value:function(e){return e.belongsToItemStore(u.default.pluginManager.getPlugin(l.Z.PluginID.Gmail).getDefaultItemStore())}},{key:"_itemSearchComparator",value:function(e){var t=this,n=this.search.isMatched(e)||e.isNote()&&this.search.isMatched(e.parent()),r=!1,i=!1;if(this.isCalendarItem(e)){var a=e.getAttachmentByPlugin(l.Z.PluginID.GCalendar);a&&("cancelled"===a.getField("status")?i=!0:a.forEachItem(void 0,(function(e){e.belongsToItemStore(a.getPlugin().getDefaultItemStore())||e.getDocumentOwner()!==t.getDocument()||(r=!0)})))}else if(this.isEmailItem(e)){var o=e.getAttachmentByPlugin(l.Z.PluginID.Gmail);if(o){var s=u.default.pluginManager.getPluginGmail();if(s.isItemArchived(e))n=!1;else s.getAttachmentPriority(o)!==l.Z.VMLIFlag.None&&(n=!0)}}return n&&!r&&!i}},{key:"getItemSearchParams",value:function(){return{itemStoreFilter:this.search.itemStoreFilter,item:this.getItem(),comparator:this._itemSearchComparator,includeNotes:!0,pane:this}}},{key:"_setItems",value:function(){this.updateBlockItems()}},{key:"getIndexOfToday",value:function(){var e;if(this.isViewCalendarMonth()){var t=this.getWeekStart(new Date);e=this.items.get().findIndex((function(e){return e.date.equals(t)}))}else if(this.isViewCalendarHoriz())e=l.Z.CalendarDayViewNumDaysPad;else if(this.isViewAgenda())for(var n=0,r=this.items.get(),i=0;i<r.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i];if((a.isOverdue||a.isToday)&&"blockHeader"===a.type){e=i;break}}return e}},{key:"_getDateInMiddle",value:function(){var e=M.Z.getToday(),t=this.getViewMode();return"Calendar_Month"===t?e=this.getMonthStart(e):"Calendar_Week"===t&&(e=this.getWeekStart(e)),e}},{key:"scrollToTop",value:function(e){this.isViewDates()?this.scrollToToday(e):f()(_()(n.prototype),"scrollToTop",this).call(this,e)}},{key:"onDayWeekStartChanged",value:function(){this.dateInMiddle=this._getDateInMiddle(),this.updateItemsImmediate(),this.scrollToToday()}},{key:"scrollToToday",value:function(e){if(this.isViewDates()){var t=this.getIndexOfToday();this.scrollIndexToTop(t,e)}}},{key:"weekCount",value:function(e,t,n){var r=new Date(e,t,1),i=n?new Date(e,t,n):new Date(e,t+1,0),a=r.getDay()+i.getDate();return Math.ceil(a/7)}},{key:"scrollJump",value:function(e,t){var n,r=this.getViewMode(),i=this.listManager.getScrollIndex(),a=this.objectAtIndex(i),o=i;if("Calendar_Month"===r){var s=a.date;if(e<0){var c=s.clone().addMonths(-1);n=this.weekCount(s.getFullYear(),s.getMonth(),s.getDate())-1,o-=this.weekCount(c.getFullYear(),c.getMonth())+n}else o+=this.weekCount(s.getFullYear(),s.getMonth())-(n=this.weekCount(s.getFullYear(),s.getMonth(),s.getDate())-1)}else if("Calendar_Custom"===r){o+=u.default.settings.calendarCustomDays.get()*e}else if("Calendar_Week"===r){var l=a.date.getDay(),d=u.default.settings.dayWeekStart.get();o+=e<0?l>d?-l+d:-7:7-l+d}else"Calendar_Day"===r&&(o+=e);this.setIgnoreRestoreScroll(),o>=0&&o<this.items.get().length&&this.scrollIndexToTop(o,t)}},{key:"compareDate",value:function(e,t){return e||t?e?t?e.compareTo(t):-1:1:0}},{key:"compareText",value:function(e,t){return e.localeCompare(t)}},{key:"comparePriority",value:function(e,t){var n=e.getPriority(this),r=t.getPriority(this);return r>n?1:r<n?-1:0}},{key:"compareBlockBase",value:function(e,t,n){try{c.Z.PAssert(1239,e,"Comparator was invalid")}catch(s){c.Z.reportError(s)}var r,i=this.getSortOrderBlocks()||1;if(e&&(r=this.compareNoKey(t,n)*i||e(t,n)),0===r||void 0===r){var a=B[this.getViewMode()].Default,o=this._getBlockSortComparator(a);if(o!==e)return o(t,n)}return r*i}},{key:"compareBlockPriority",value:function(e,t){return t.priority-e.priority}},{key:"compareNoKey",value:function(e,t){return e.id===this.blockNoKey?1:t.id===this.blockNoKey?-1:void 0}},{key:"compareNone",value:function(e,t){return e.originalIndex-t.originalIndex}},{key:"compareBlockDate",value:function(e,t){return this.compareDate(e.date,t.date)}},{key:"compareBlockName",value:function(e,t){return this.compareText(e.name,t.name)}},{key:"compareBlockNumItems",value:function(e,t){return t.items.length-e.items.length}},{key:"compareBlockItemPriority",value:function(e,t){return this.comparePriority(e.item,t.item)}},{key:"compareBlockItemCreated",value:function(e,t){return this.compareDate(e.item.dateCreated,t.item.dateCreated)}},{key:"compareBlockItemModified",value:function(e,t){return this.compareDate(e.item.dateModified,t.item.dateModified)}},{key:"compareBlockItemCompleted",value:function(e,t){return this.compareDate(e.item.dateCompleted,t.item.dateCompleted)}},{key:"_getBlockSortComparator",value:function(e){return"Alphabetical"===e&&this.compareBlockName||"Date"===e&&this.compareBlockDate||"NumItems"===e&&this.compareBlockNumItems||"Priority"===e&&this.compareBlockItemPriority||"Created"===e&&this.compareBlockItemCreated||"Modified"===e&&this.compareBlockItemModified||"None"===e&&this.compareNone}},{key:"getBlockComparator",value:function(){var e=this.getSortModeBlocks();return this.compareBlockBase.bind(this,this._getBlockSortComparator(e))}},{key:"compareItemBase",value:function(e,t,n){try{c.Z.PAssert(1240,e,"Comparator was invalid")}catch(a){c.Z.reportError(a)}var r,i=this.getSortOrderItems();return e&&(r=e(t,n)*i),0===r||void 0===r?this.compareItemNone(t,n):r}},{key:"compareItemNone",value:function(e,t){return e.index-t.index}},{key:"compareItemDate",value:function(e,t){return this.compareDate(e.item.getNextDate(),t.item.getNextDate())}},{key:"compareItemName",value:function(e,t){return this.compareText(e.item.getSearchText(this),t.item.getSearchText(this))}},{key:"compareItemNumItems",value:function(e,t){return t.item.numItems()-e.item.numItems()}},{key:"_getItemSortComparator",value:function(e){return"Alphabetical"===e&&this.compareItemName||"Date"===e&&this.compareItemDate||"NumItems"===e&&this.compareItemNumItems||"Priority"===e&&this.compareBlockItemPriority||"Created"===e&&this.compareBlockItemCreated||"Modified"===e&&this.compareBlockItemModified||"Completed"===e&&this.compareBlockItemCompleted||"None"===e&&this.compareItemNone}},{key:"getItemComparator",value:function(){var e,t=this.getSortModeBlocks();if("Date"===t)e=this.compareItemDate;else if("Created"===t)e=this.compareBlockItemCreated;else if("Modified"===t)e=this.compareBlockItemModified;else if("Completed"===t)e=this.compareBlockItemCompleted;else{var n=this.getSortModeItems();e=this._getItemSortComparator(n)}return this.compareItemBase.bind(this,e)}},{key:"getItemsOnDate",value:function(e){var t=0,n=[];for(var r=0;r<this._itemsWithDates.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._itemsWithDates[r];i.getMooDate().isOnDate(e)&&n.push(i)}return n}},{key:"findIndexOfNextBlock",value:function(){for(var e=0,t=new Date,n=this.items.get(),r=0;r<n.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=n[r];if("blockHeader"===i.type){var a=i.block;if(a.isOverdue||a.isNow||a.isToday||a.isStarred||a.isImportant||a.date>=t)return r}}return-1}},{key:"_keyHelper",value:function(e,t){var n=e["get"+t](this);if(n){if("Priority"===t)n=[n];else if(n=n.map((function(e){return{value:e,lower:e.toLowerCase()}})),this.search.showOnlyMatchingTags()){var r=this.search["get"+t]();r&&r.length>0&&(r=r.map(c.Z.toLowerCase),n=n.filter((function(e){for(var t=0,n=0;n<r.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e.lower===r[n])return!0}})))}return n}if(this.search.isMatched(e,{isYes:!0})){var i=!0,a=e.parent();if(this.getBlock(this.blockNoKey)&&!this.isViewFlatList())for(var o=0;void 0!==a&&a!==this.getItem();){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(this.itemsInBlocks[a.id]){i=!1;break}a=a.parent()}if(i)return[this.blockNoKey]}}},{key:"getMirrorOrItemForViewMode",value:function(e){var t=e.getMirroredItemOrSelf();return t&&(this.isViewCalendar()||this.isViewAutoBlocks())?t:e}},{key:"_getKeysForItem",value:function(e){e=this.getMirrorOrItemForViewMode(e);var t=this.getViewMode();if(this.isViewOutline())return this.search.showHierarchy()&&e.parent()!==this.getItem()?void 0:[""];if(this.isViewAgenda()||this.isViewCalendar()){var n=!0;if(this.isViewAgenda()&&e.hasAttachmentType(l.Z.PluginType.Calendar)&&+e.getDate()<M.Z.getTodayTime()){var r=e.getAttachmentByType(l.Z.PluginType.Calendar),i=r.getPlugin();e.getDocumentOwner()===this.getDocument()||i.shouldDisplayOverdueInAgenda()&&i.hasWritePermissionForAttach(r)||(n=!1)}if(n){var a=this._getDatesForItem(e);if(this.isViewAgenda()&&"Date"===this.getSortModeBlocks()&&!this.search.showOnlyAgendaDates()){var o=[];if(!e.isComplete()){if(e.isStarred(this)){var s="starred";u.default.timeline.getDateForKey(s)&&o.push(s)}if(e.isImportant(this)){var c="important";u.default.timeline.getDateForKey(c)&&o.push(c)}}var d=e.getTagsLower();if(d)for(var h=0,p=0;d&&p<d.length;p++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var f="#"+d[p];u.default.timeline.getDateForKey(f)&&o.push(f)}o.length>0&&(a=a?a.concat(o):o)}return a}}else if("Groups_Project"===t){var g=this.getItem(),m=e.parent();if(m===g&&!e.isPrefixHeader())return[this.blockNoKey];if(m&&m.isPrefixHeader()&&m!==g&&(this.search.showChildProjects()||m.parent()===g))return[m.id]}else{if("Groups_Tag"===t)return this._keyHelper(e,"Tags");if("Groups_Contact"===t)return this._keyHelper(e,"Contacts");if("Groups_Priority"===t)return this._keyHelper(e,"Priority")}}},{key:"isOkOnAgenda",value:function(e){return!!this._getKeysForItem(e)||this.search.showHierarchy()&&e.parent()&&this.isOkOnAgenda(e.parent())}},{key:"_getDatesForItem",value:function(e){var t,n=this,r=this.getSortModeBlocks();if(this.isViewCalendar()||"Date"===r){var i=e.getMooDate();if(e.isComplete()&&this.isViewAgenda())+e.dateCompleted>=M.Z.getTodayTime()&&(t=e.dateCompleted);else if(i){var a=i.getAllDates().filter((function(e){return n.isDateWithinRange(e)}));return a.length>10&&i.isRepeatDate()&&!i.isRange()&&(a=a.slice(0,10)),a}}else if("Created"===r||"Completed"===r||"Modified"===r){var o="Created"===r&&e.dateCreated||"Completed"===r&&e.dateCompleted||"Modified"===r&&e.dateModified;o&&(!this.startDate||o>=this.startDate)&&(t=o)}if(t&&this.isDateWithinRange(t))return[t]}},{key:"isDateWithinRange",value:function(e){return e&&(!this.endDate||+e<+this.endDate)&&this.search.isDateInRange(e)}},{key:"_getKeyForDate",value:function(e){var t=M.Z.getToday();if(!(this.combineOverdue&&e<t)){var n=l.Z.DFormat.MonthDayYearLong,r=u.default.International.getFormat(n);return e.toString(r)}return"overdue".toLowerCase()}},{key:"updateBlockItems",value:function(){var e,t=this.getViewMode();if(this.isViewCalendar()){var n=0;this._itemsWithDates=[];for(var r=0;r<this._allPaneItems.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=this._allPaneItems[r];if(!i.isDeleted()&&i.getMooDate()){var a=i.getAttachmentByType(l.Z.PluginType.Calendar),o=a&&a.getField("calendarID");(o?!1!==this.displayCalendars.get()[o]:this.displayLocalItems.get())&&this._itemsWithDates.push(i)}}"Calendar_Month"===t?this.updateCalendarMonth():this.isViewCalendarHoriz()&&(this.updateCalendarWeek(),e=!0)}else this.updateBlocks(),this.updatePaneObjects();e&&this.updateAllDay()}},{key:"updateBlocks",value:function(){var e,t=0;this.blocks=[],this.blocksByKey={},this.itemsInBlocks={},this.isViewAgenda()&&this.getBlock(M.Z.getToday());for(var n=0;n<this._allPaneItems.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._allPaneItems[n],i=!r.isNote();if(i)if(r.getMooDate()){var a=r.getAttachmentByType(l.Z.PluginType.Calendar),o=a&&a.getField("calendarID");i=o?!1!==this.displayCalendars.get()[o]:this.displayLocalItems.get()}i&&this.addToBlock(this._allPaneItems[n])}this.isViewAgenda()?e=this.compareBlockDate:this.isViewPriority()?e=this.compareBlockBase.bind(this,this.compareBlockPriority):this.supportsSortBlocks()&&(e=this.getBlockComparator()),e&&this.blocks.sort(e)}},{key:"addItemToPaneObjects",value:function(e,t,n,r,i,a,o,s,c,l,u,d){var h=void 0,p=n.getMirroredItem();p&&void 0===c&&(h=n,c=(n=p).levelsDeep.get()-h.levelsDeep.get(),s=(s||[]).concat(h.id));var f=new x.Z({type:"blockItem",item:n,id:this.getPaneObjectID(n,t,s),pane:this,block:t,parentObject:a,index:e.length,levelsDeepRoot:i,mirroringItem:h,mirroringLevelsDeep:c,mirrorRootPaneObject:l});!l&&h&&(l=f.mirrorRootPaneObject=f),this.addPaneObject(e,f,d),o&&(s=(s||[]).concat(f.id));var g=r&&n.getVisibleChildren(this);if(f.positionInMirror=h?(null===g||void 0===g?void 0:g.length)>0?-1:0:u?1:void 0,g)for(var m=0,v=f.isCollapsed(),y=0;y<g.length;y++){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;this.addItemToPaneObjects(e,t,g[y],r,i,f,!1,s,c,l,h&&y===g.length-1,d||v)}return f}},{key:"updatePaneObjects",value:function(){for(var e,t,n=0,r=[],i=this.search.showHierarchy(),a=this.isViewAutoBlocks(),o=0;o<this.blocks.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=this.blocks[o],c=void 0;if(s.item?(t=s.item).isNote()||(c=new x.Z({type:"blockItem",item:t,id:this.getPaneObjectID(t,s),pane:this,block:s,index:r.length,levelsDeepRoot:t,isBlockHeader:!0,blockPrevious:this.blocks[o-1]})):this.isViewProjectNoBlocks()||this.isViewOutline()||(c=new x.Z({type:"blockHeader",block:s,id:this.getPaneObjectIDNonItem(s.id),pane:this,index:r.length,isToday:s.isToday,isOverdue:s.isOverdue,isBlockHeader:!0,isFirstCollapsed:e&&s.isCollapsed()&&!e.isCollapsed(),blockPrevious:this.blocks[o-1]})),c&&(this.addPaneObject(r,c),s.paneObject=c),!c||!s.isCollapsed()){for(var l=0,u=!1,d=s.getAllItemsSorted(!i&&!a),h=this.isViewAutoBlocks(),p=0;p<d.length;p++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;t=d[p];var f=this.addItemToPaneObjects(r,s,t,i,t,c,h);f&&!u&&this.isViewAgenda()&&this.shouldShowTime(f)&&!t.getTime()&&(f.showAllDay=!0,u=!0)}!c||this.isViewDateMetadata()&&!s.isToday||this.addPaneObject(r,new x.Z({type:"blockAddItem",id:this.getPaneObjectIDNonItem(s.id+"_add"),pane:this,block:s,index:r.length,blockPrevious:this.blocks[o-1]}))}e=s}if(this.isViewProject()&&!this.isViewProjectNoBlocks()){var g=this.getBlock("newProject");g.isNewProject=!0,this.addPaneObject(r,new x.Z({type:"blockHeader",block:g,id:this.getPaneObjectIDNonItem(g.id),pane:this,index:r.length,blockPrevious:this.blocks[this.blocks.length-1]}))}this.addFooterItems(r),this.items.set(r)}},{key:"addToBlock",value:function(e){e=this.getMirrorOrItemForViewMode(e),this.isViewProject()&&e.isPrefixHeader()&&(this.search.showChildProjects()||e.parent()===this.getItem())&&this.getBlock(e.id,e);var t=this._getKeysForItem(e);if(t)for(var n=0,r=0;r<t.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=this.getBlock(t[r],e);i&&(i.addItem(e),this.itemsInBlocks[e.id]=!0)}}},{key:"_addFnBase",value:function(e,t,n,r,i){e=u.default.settings.getDefaultItemText(r)+e,this.clearPreventUpdate(),u.default.PaneUpdateBatcher.beginUpdateItems();var a={text:e};i&&(a=c.Z.extend(a,i));var o=this.createVMLI(a,{parent:n,changeType:l.Z.ChangeType.AllLocal,isEditable:!0});n.insertItem(o),u.default.PaneUpdateBatcher.commitUpdateItems();var s=this.indexOfItem(o,t);s>=0&&P.Z.selectIndex(s,0)}},{key:"addFnProject",value:function(e){return this._addFnBase("",e,e.id===this.blockNoKey?this.getItem():D.Z.getItem(e.id))}},{key:"addFnTag",value:function(e){return this._addFnBase(e.id===this.blockNoKey?"":" "+e.text,e,this.getItem())}},{key:"addFnDate",value:function(e){var t,n="";return this.isViewDateMetadata()||(e.isDate?(n=" "+l.Z.CharDate,t={date:e.date}):e.isStarred?t={isStarred:!0}:e.isImportant?t={priority:l.Z.VMLIFlag.P3}:n=" "+e.id),this._addFnBase(n,e,this.getItem(),void 0,t)}},{key:"addFnContact",value:function(e){return this._addFnBase(e.id===this.blockNoKey?"":" "+e.text,e,this.getItem())}},{key:"addFnPriority",value:function(e){return this._addFnBase("",e,this.getItem(),void 0,{priority:e.priority})}},{key:"getDateForSoftDate",value:function(e){var t=u.default.timeline.getDateForKey(e.toLowerCase());if(!isNaN(t)){var n=100*Math.round(t/100),r=Math.round(n/100),i=Math.round(t-n);return M.Z.getTodayPlusMS(r*l.Z.MSPerDay+i*l.Z.MSPerMinute)}}},{key:"getBlock",value:function(e,t){var n,r,i=this.isViewDates(),a=this.isViewAgenda(),o=e;if(i&&!c.Z.isString(e))n=e,o=e=this._getKeyForDate(n),"overdue"===e&&(!t.isComplete()&&u.default.timeline.getDateForKey(e)||(e=void 0),n=void 0);else if(c.Z.isObject(e)){var s=e,d=s.value,h=s.lower;try{c.Z.PAssert(1241,d&&h,"If key is object it should have this form")}catch(v){c.Z.reportError(v)}o=h,e=d}if(void 0!==e){var p,f=this.isViewAutoBlocks()?void 0:D.Z.getItem(e),g=this.getViewMode();if(!(r=this.blocksByKey[o]))if(void 0!==(p=f?f.getStyledTextAsOneLine(!0):this.isViewPriority()?e===l.Z.VMLIFlag.P1?"High Priority":e===l.Z.VMLIFlag.P2?"Medium Priority":e===l.Z.VMLIFlag.P3?"Low Priority":"(No priority)":e)){var m={pane:this,id:e,name:p,sortMode:this.supportsSortItems()&&this.getSortModeItems(),addFn:this.isViewProject()&&this.addFnProject.bind(this)||this.isViewTag()&&this.addFnTag.bind(this)||this.isViewContact()&&this.addFnContact.bind(this)||this.isViewPriority()&&this.addFnPriority.bind(this)||a&&this.addFnDate};this.isViewTag()?(m.name=e===this.blockNoKey?"(No tag)":"#"+m.name,m.isTag=!0):this.isViewContact()?(m.name=e===this.blockNoKey?"(No contact)":"+"+m.name,m.isContact=!0):this.isViewPriority()&&(m.isPriority=!0,m.priority=e),"Groups_Project"===g&&(m.name=e===this.blockNoKey?"(No project)":m.name,m.item=f,m.isEditable=!0,m.date=f&&f.getDate(this)),e===this.blockNoKey&&(m.isNoKey=!0),i&&(n?(m.date=M.Z.clearTime(n),m.isDate=!0,m.date.equals(M.Z.getToday())&&(m.isToday=!0)):(m.date=this.getDateForSoftDate(e),m.name=m.name.capitalize(),"now"===e?m.isNow=!0:"starred"===e?m.isStarred=!0:"important"===e?m.isImportant=!0:"overdue"===e&&(m.isOverdue=!0,m.noAddButton=!0))),r=new T(m),this.blocksByKey[o]=r,r.originalIndex=this.blocks.length,this.blocks.push(r)}}return r}},{key:"closestIndexOfObject",value:function(e){return this.isViewAutoBlocks()?this.indexOfItem(e.item,e.block,e.index):e.index}},{key:"onGCalendarActiveChanged",value:function(e,t){var n=e.getDefaultItemStore();t?this.useItemStore(n):this.stopUsingItemStore(n)}},{key:"onGmailActiveChanged",value:function(e,t){var n=e.getDefaultItemStore();t?this.useItemStore(n):this.stopUsingItemStore(n)}},{key:"_refreshPaneData",value:function(e){var t=u.default.pluginManager.getPluginGCalendar();t.isActive()&&t.forceRemoteEventSync(e)}},{key:"viewModeIcon",value:function(){var e=this.getViewMode();return l.Z.TaskViewModeIcon[e]}},{key:"viewModeIconNew",value:function(){var e=this.getViewMode();return"Outline"===e&&this.isViewFlatList()&&(e="List_Flat"),l.Z.TaskViewModeIconNew[e]}},{key:"viewModeIconSizeNew",value:function(){var e=this.getViewMode();return"Outline"===e&&this.isViewFlatList()&&(e="List_Flat"),l.Z.TaskViewModeIconSizeNew[e]}},{key:"viewModeTextNew",value:function(){var e,t=this.getViewMode();return null===(e=l.Z.TaskViewModeTextNew[t])||void 0===e?void 0:e.replace("#",u.default.settings.calendarCustomDays.get())}},{key:"viewModeColor",value:function(){return l.Z.Colors.Brand}},{key:"isViewDates",value:function(){return this._isViewHelper.dates}},{key:"isViewDateMetadata",value:function(){return this._isViewHelper.dateMetadata}},{key:"isViewAgenda",value:function(){return this._isViewHelper.agenda}},{key:"isViewCalendar",value:function(){return this._isViewHelper.calendar}},{key:"isViewCalendarHoriz",value:function(){return this._isViewHelper.calendarHoriz}},{key:"isViewCalendarMonth",value:function(){return this._isViewHelper.calendarMonth}},{key:"isViewProject",value:function(){return this._isViewHelper.project}},{key:"isViewProjectNoBlocks",value:function(){return this._isViewHelper.project&&(0===this.blocks.length||1===this.blocks.length&&this.blocks[0].id===this.blockNoKey)}},{key:"isViewOutline",value:function(){return this._isViewHelper.outline}},{key:"isViewFlatList",value:function(){return this._isViewHelper.flatList}},{key:"isViewTag",value:function(){return this._isViewHelper.tag}},{key:"isViewContact",value:function(){return this._isViewHelper.contact}},{key:"isViewPriority",value:function(){return this._isViewHelper.priority}},{key:"isViewAutoBlocks",value:function(){return this._isViewHelper.autoBlocks}},{key:"isViewText",value:function(){return this._isViewHelper.text}},{key:"isViewItems",value:function(){return this._isViewHelper.items}},{key:"isViewArchived",value:function(){return this._isViewHelper&&this._isViewHelper.archived}},{key:"isViewDeleted",value:function(){return this._isViewHelper&&this._isViewHelper.deleted}},{key:"canScrollToItem",value:function(){return!this.isViewCalendar()&&this.isViewItems()}},{key:"shouldShowAddBox",value:function(){return!1}},{key:"supportsGrouping",value:function(){return this._isViewHelper.supportGrouping}},{key:"isCalFilterActive",value:function(){var e=this.displayCalendars.get(),t=!this.displayLocalItems.get();for(var n in e)if(e.hasOwnProperty(n)&&!1===e[n]){t=!0;break}return t}},{key:"becomeReal",value:function(){f()(_()(n.prototype),"becomeReal",this).call(this),this.onViewStateChanged()}},{key:"onViewStateChanged",value:function(e,t){var n=this;this.isFakePane?this.setupViewStateMinor():(this.setIgnoreRestoreScroll(void 0,(function(){n.listManager.saveScrollOfTop()})),this.setupViewState(),this.listManager.clearCache(),this.updateItemsImmediate(!0,void 0,void 0,!0),u.default.PaneManager.updatePaneStateForPane(this),e&&t&&e.viewMode!==t.viewMode&&this.isViewCalendar()&&this.scrollToToday("auto"))}},{key:"setupViewStateMinor",value:function(){var e=this.getViewMode(),t=this.getSortModeBlocks(),n={agenda:"Agenda_Today"===e||"Agenda_Week"===e||"Agenda_Month"===e||"Agenda_All"===e,calendar:"Calendar_Day"===e||"Calendar_Week"===e||"Calendar_Month"===e||"Calendar_Custom"===e,calendarHoriz:"Calendar_Day"===e||"Calendar_Week"===e||"Calendar_Custom"===e,calendarMonth:"Calendar_Month"===e,project:"Groups_Project"===e,outline:"Outline"===e||"List_Flat"===e||"Archived"===e||"Deleted"===e,flatList:"List_Flat"===e||!this.search.showHierarchy(),tag:"Groups_Tag"===e,contact:"Groups_Contact"===e,priority:"Groups_Priority"===e,archived:"Archived"===e,deleted:"Deleted"===e,items:"Archived"!==e&&"Deleted"!==e,dateMetadata:"Created"===t||"Modified"===t||"Completed"===t};n.supportGrouping=!n.calendar,n.dates=n.agenda||n.calendar,n.autoBlocks=n.agenda||n.tag||n.contact||n.priority,n.text=!n.calendar,this._isViewHelper=n,this.supportsSortBlocks()&&(this.supportsSortBlocksMode(t)||this.setSortModeBlocks(B[e].Default,1,!1),"Completed"===(t=this.getSortModeBlocks())&&0===this.search.getFilterValue("completeOption")&&this.search.setFilter("completeOption",1)),this.search.setFilterEnabled("showOnlyAgendaDates",this.isViewAgenda()),this.search.setFilterEnabled("showOnlyMatchingTags",this.isViewTag()||this.isViewContact()),this.search.setFilterEnabled("showChildProjects",this.isViewProject()),(this.isViewTag()||this.isViewContact())&&this.search.setFilterTooltip("showOnlyMatchingTags","Show only matching "+(this.isViewTag()?"Tag":"Contact")+" blocks")}},{key:"setupViewState",value:function(){this.setupViewStateMinor(),this.isViewCalendar()&&(this.viewState.setProperty("viewMode","Agenda_All"),this.setupViewStateMinor());var e,t=this.getViewMode(),n=this.getSortModeBlocks(),r=this.isViewOutline(),i=this.isViewCalendar(),a=i?0:(this.isViewAgenda()||this.isViewProject()?48:l.Z.TopBoxHeight)||!1,o=this.isViewItems();if(this.canAddItem=o,this.supportCompleting=o,this.supportCheckbox=o,this.supportPerformArchive=o,this.supportIndent=o,this.supportClone=o,this.contextMenuMode=(this.isViewArchived()?"Archived":this.isViewDeleted()&&"Deleted")||"Normal",this.isEditable=o,this.isDraggable=o,this.isDropTarget=o,this.scrollToStartOnSearch=!i,this.search.setFilterEnabled("complete",o),this.blockNoKey="__block_nokey_"+t,this.supportIndent=r,this.supportMultiselect=r,this.overviewTracksScroll=r,this.supportSearchFlat=!i,this.supportCheckbox=!i,this.topBoxHeight.set(a,!1),this.paneClass=this.getPaneClass(),this.paneEmptyMessage=(this.isViewArchived()?"No archived items":this.isViewDeleted()&&"No deleted items")||this.isViewAgenda()&&"Nothing on the agenda"||this.isViewOutline()&&"Write some things here to get started"||"",this.collapsedFieldName=l.Z.PerPaneStateField.Collapsed+(this.viewState?t:""),this.isViewCalendar()&&Z.Z.erroredAuthTokens.hasValue()){var s=Object.keys(Z.Z.erroredAuthTokens.get())[0];this.toast.set({text:new E.Z("Error syncing with calendar: ".concat(s)),actionText:"FIX SYNC",doAction:function(){return Z.Z.fixAuth(s)},noClose:!0})}else this.toast.set(void 0);if((this.isViewCalendar()||this.isViewAgenda())&&(e=l.Z.ItemStoreFilter.Dates,(this.isViewCalendar()||"Date"===this.getSortModeBlocks())&&(e|=l.Z.ItemStoreFilter.Priority)),this.search.itemStoreFilter=e,this.search.onlyMatchDates=this.isViewDates(),this.shouldUpdateOnTextChanged=this.isViewAgenda()||this.isViewTag(),this.combineOverdue=this.isViewAgenda()&&"Date"===n,this.showScrollbars.set(!this.isViewCalendar()),this.isViewAgenda()){var c,d;if("Agenda_All"!==t)"Agenda_Today"===t?d=1:"Agenda_Week"===t?d=7:"Agenda_Month"===t&&(d=30),c=M.Z.getTodayPlusDays("Date"===n?d:-(d-1));"Date"===n?this.endDate=c:(this.startDate=c,this.endDate=M.Z.getTodayPlusDays(1))}var h=u.default.pluginManager.getPluginGCalendar();this.supportDataRefresh=this.isViewDates()&&h.isOn()&&"Calendars",this.isEditable=this.supportSel=o&&!this.isViewCalendar(),this.orientation.set(this.isViewCalendarHoriz()?"horizontal":"vertical"),"Calendar_Week"===t||"Calendar_Month"===t?(this.minWidthFlex=700,this.maxWidthFlex=1200,this.maxWidthSingle=1600,this.minWidth=600,this.maxWidth=1600):(this.minWidth=b.Z.windowWidth(),this.minWidthFlex=this.minWidth,this.maxWidth=this.minWidth,this.maxWidthFlex=this.minWidth),this.dateInMiddle=this._getDateInMiddle(),u.default.PaneManager.updatePaneRects()}},{key:"getPaneClass",value:function(){return"paneTask "+(this.isViewCalendar()&&"paneCalendar c-background"+(this.isViewCalendarMonth()?" calendarMonthView c-bg-app":"")||this.isViewAgenda()&&"paneAgenda"||this.isViewProject()&&"paneProject"||this.isViewTag()&&"paneTag"||this.isViewContact()&&"paneContact"||this.isViewPriority()&&"panePriority"||this.isViewOutline()&&"paneOutline"||"")}},{key:"onScroll",value:function(){this.isViewCalendarHoriz()&&(clearTimeout(this._timeoutUpdateAllDay),this._timeoutUpdateAllDay=setTimeout(this.updateAllDay,50))}},{key:"_handleDragOverPane",value:function(e,t,n,r,i,a,o){if(e&&r&&("blockHeader"===r.type||r.isBlockHeader)&&(this.isViewAgenda()&&e.supportDates||this.isViewAutoBlocks())){var s=r.block;return this.isViewAgenda()&&s.isOverdue&&(s=void 0),this.dragHoveredBlock.set(s),u.default.DragDrop.setBlockTarget(s),{block:s,targetPane:this,targetPaneObject:r}}if(!r||"blockItem"===r.type)return this.dragHoveredBlock.set(void 0),this.isViewCalendar()||u.default.DragDrop.setBlockTarget(void 0),this._handleDragOverTasks(t,n,r,i,a,o)}},{key:"_handleDragOverTasks",value:function(e,t,n,r,i,a){var o,s,d,h,p,f,g=!1,m=l.Z.DragDropPosition.Below,v=!1,y=0;if(n){o=n.getMirrorOrItem(),f=n.index,o.isNote()&&(f--,n=this.objectAtIndex(f),t=this.elementAtIndex(f),o=o.parent()),o.hasNote()&&(y=u.default.DisplaySettings.noteLineHeight());var k=t.getBoundingClientRect(),_=k.height+y,Z=this.isViewFlatList()||this.isViewAgenda()||this.isViewAutoBlocks(),w=o.hasText(),b=w?.38:.5;m=Z?l.Z.DragDropPosition.On:i<=k.top+_*b&&(!this.isViewProject()||!n.isBlockHeader||null!==a&&void 0!==a&&a.isPrefixHeader())?l.Z.DragDropPosition.Above:i<k.top+_*(1-b)&&(Z||w)&&o!==a?l.Z.DragDropPosition.On:l.Z.DragDropPosition.Below,d=t,g=!0}else if(0===this.numItems()||c.Z.hasClass(e,"paneFooter"))o=this.getItem(),v=!0,h=!0;else if(this.isViewFlatList()||!c.Z.findParent(e,"paneScroller")||this.isViewProject())if(this.isViewFlatList())o=this.getItem(),v=!0,h=!0;else{var P=this&&this.indexOfFirstItem();if(this&&P>=0)if((p=this.elementAtIndex(P))&&i<p.getBoundingClientRect().top)o=this.getFirstItem(),n=this.getFirstObject(),d=p,m=this.isViewProject()&&n.isBlockHeader&&!a.isPrefixHeader()?l.Z.DragDropPosition.On:l.Z.DragDropPosition.Above,g=!0}else{var S=this.indexOfLastItem();if(!g&&S>=0)if(i>=(p=this.elementAtIndex(S)).getBoundingClientRect().bottom)o=this.getLastItem(),n=this.getLastObject(),d=p,m=l.Z.DragDropPosition.Below,g=!0}if(g){c.Z.hasClass(d,"itemInPane")&&(d=c.Z.findChild(d,"itemInPaneText"));var D=d.getBoundingClientRect(),I=(m!==l.Z.DragDropPosition.Below?D.top:D.top+D.height+y)+(n?u.default.DisplaySettings.paddingForItemTop(n):0),E=m===l.Z.DragDropPosition.On?D.height:void 0;if(I>this.contentTop()){var x,C;if(m===l.Z.DragDropPosition.Below&&f+1<this.numItems()&&o.hasChildren())null!==(C=x=this.objectAtIndex(f+1))&&void 0!==C&&C.item||(x=void 0);x=x||n,s={left:D.left,top:I,width:D.right-D.left,height:E}}}return this.scrollFromMousePosition(r,i,"horizontal"===this.orientation.get()),{position:m,targetPaneObject:n,targetElement:d,targetItem:o,targetPane:this,linePosition:s,overview:!1,dropOnPane:v,atEnd:h}}},{key:"handleDragDrop",value:function(e,t,r,i){var a=this,o=u.default.DragDrop.blockTarget;if(!o)return f()(_()(n.prototype),"handleDragDrop",this).call(this,e,t,r,i);if(!o.date||!e.some((function(e){return e.isRepeatDate()}))){var s=function(){c.applyDropOnBlock(o,e,a,t.dataTransfer.block),a.revertDrag()},c=t.dataTransfer.pane,l=this.getDocument();return this!==c&&this.isViewCalendar()&&!c.isSimplePane&&l!==c.getDocument()?(u.default.menus.confirm("You are dropping onto the calendar of a different document. Do you want to move this item to ".concat(l.text.get(),"?"),(function(n){n&&(a._handleDragDrop(e,t.dataTransfer,{targetPane:a,targetPaneObject:void 0,targetItem:a.getRootItem(),dropOnPane:!0},t,i),s())})),!0):(s(),!0)}u.default.toasts.pushMessage("Moo.do does not yet support moving repeat dates")}},{key:"revertDrag",value:function(){f()(_()(n.prototype),"revertDrag",this).call(this),this.dragHoveredBlock.get()&&this.dragHoveredBlock.set(null)}},{key:"getSaveInfo",value:function(){var e=f()(_()(n.prototype),"getSaveInfo",this).call(this);return e.viewState=this.viewState.get(),e.displayCalendars=this.displayCalendars.get(),e.displayLocalItems=this.displayLocalItems.get(),e.blocksCollapsed=this.blocksCollapsed,e}},{key:"isBlockCollapsedLegacy",value:function(e){return!e.item&&this.blocks.length>1&&this.blocksCollapsed[e.id]}},{key:"addProject",value:function(e,t,n){return this.addItem({index:e,prefix:l.Z.Prefix.Header,text:t,toRoot:n})}},{key:"onTapAddItem",value:function(){var e=this;if(this.isOverviewVisible())f()(_()(n.prototype),"onTapAddItem",this).call(this);else{var t;1===this.search.getFilterValue("project")?t=l.Z.Prefix.Header:1===this.search.getFilterValue("task")&&(t=l.Z.Prefix.Task);var r=function(){e.addItem({index:0,prefix:t})};b.Z.app?(this.scrollIndexToTop(0,"smooth"),setTimeout(r,this.listManager.getScrollOffset()>300?200:0)):r()}}},{key:"addItem",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.index,r=t.prefix,i=t.text,a=t.toRoot;n=n||0,i=i||"",void 0===r&&(r=u.default.settings.getDefaultItemText()),u.default.PaneUpdateBatcher.beginUpdateItems(),P.Z.reset(),this.setIgnoreRestoreScroll();var o=a?this.getRootItem():this.getItem(),s={text:(r?r+" ":"")+i};this.isViewAgenda()&&(s.text=" "+l.Z.CharDate,s.date=(new Date).clearTime()),1===this.search.getFilterValue("complete")&&(s.isComplete=!0),1===this.search.getFilterValue("starred")&&(s.isStarred=!0);var d=this.search.getFilterValue("priority");d&&(s.priority=d);var h=o.addItemAtIndex(s,n,this);if(this.isViewProject()&&r===l.Z.Prefix.Header){var p=u.default.settings.getDefaultItemText();h.addItemAtIndex({text:p},n,this)}if(P.Z.setFocusedPane(this),n>=0);u.default.PaneUpdateBatcher.commitUpdateItems();var f=this.indexOfItem(h);return f>=0&&(this.scrollIndexIntoView(f),P.Z.selectIndex(f,0),b.Z.isiOS&&!b.Z.app&&(requestAnimationFrame((function(){e.scrollIndexIntoView(f)})),setTimeout((function(){P.Z.selectIndex(f,0),e.scrollIndexIntoView(f)}),100))),c.Z.sendEvent("Menu","AddItemButton"),h}},{key:"setDisplayLocal",value:function(e){this.displayLocalItems.set(e),this.updateItems()}},{key:"setDisplayCalendar",value:function(e,t){var n=c.Z.clone(this.displayCalendars.get());n[e.id]=t,this.displayCalendars.set(n),this.updateItems()}},{key:"getCollapsedDefault",value:function(e,t){return t?e!==this.getRootItem():!this.isViewOutline()&&(this.isViewProject()?!this.isItemTopLevel({item:e,isBlockHeader:e.isPrefixHeader()}):e.hasChildren())}},{key:"getWidthExtra",value:function(){if(this.isViewCalendar()&&!this.isViewCalendarMonth())return-l.Z.CalendarTimesWidth}},{key:"getMonthStart",value:function(e){return M.Z.getDatePlusDays(M.Z.clearTime(e),1-e.getDate())}},{key:"getWeekStart",value:function(e){var t=M.Z.clearTimeClone(e).previous();return 1===u.default.settings.dayWeekStart.get()?t.monday():t.sunday()}},{key:"doesWeekCrossMonth",value:function(e){if(e.clone().addDays(6).getDate()<e.getDate())return!0}},{key:"updateCalendarMonth",value:function(){var e,t,n,r=0,i=0,a=[],o=this.dateInMiddle,s=this.getWeekStart(o),c=l.Z.CalendarMonthViewNumWeeksPad;for(n=0;n<=c;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=-c-1+n;e=s.clone().addWeeks(u),(t=this.doesWeekCrossMonth(e))&&a.push(this.updateCalendarMonthWeek(a.length,e,!0,!1)),a.push(this.updateCalendarMonthWeek(a.length,e,!1,t))}for(c=2*l.Z.CalendarMonthViewNumWeeksPad+1,n=0;a.length<c;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e=s.clone().addWeeks(n),(t=this.doesWeekCrossMonth(e))&&a.length<c&&a.push(this.updateCalendarMonthWeek(a.length,e,!0,!1)),a.push(this.updateCalendarMonthWeek(a.length,e,!1,t))}this.items.set(a)}},{key:"updateCalendarMonthWeek",value:function(e,t,n,r){for(var i,a,o=0,s=[],c=1===t.getDate(),l=0;l<7;l++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=t.clone().addDays(l);i&&u.getDate()<i.getDate()&&(c=!0),!c&&r||c&&n||(s[l]={date:u,items:this.getItemsOnDate(u)},a||(a=u)),i=u}return new x.Z({type:"calendarWeek",id:this.getPaneObjectIDNonItem("week_"+t+(n?"_end":"")),pane:this,date:a,dates:s,index:e})}},{key:"heightWeek",value:function(){return l.Z.CalendarMonthViewWeekHeight}},{key:"updateCalendarWeek",value:function(){for(var e=0,t=[],n=l.Z.CalendarDayViewNumDaysPad,r=this.dateInMiddle,i=this.getViewMode(),a=-n;a<n;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=r.clone().addDays(a),s=this.getItemsOnDate(o);t.push(new x.Z({type:"calendarDay",id:this.getPaneObjectIDNonItem(i+"_day_"+(a+n)),pane:this,date:o,items:s}))}this.items.set(t)}},{key:"getDatePlacementOnDate",value:function(e,t){var n=e.getHours()+e.getMinutes()/60,r=t?t/l.Z.MSPerHour:1;if(r=Math.round(10*Math.min(r,24-e.getHours()))/10,n>0||r<24)return{time:n,duration:r}}},{key:"getItemPlacementOnDate",value:function(e,t){var n=!e.getDate(),r=e.getNextDate(t),i=e.getDuration()&&r&&e.getEndDate();if(r&&r.hasTimeOfDay()){if(n||M.Z.isSameDay(r,t))return this.getDatePlacementOnDate(r,e.getDuration());if(i&&!M.Z.isSameDay(r,t)&&M.Z.isSameDay(i,t))return{time:0,duration:i.getHours()+i.getMinutes()/60};if(i&&!M.Z.isSameDay(r,t)&&!M.Z.isSameDay(i,t))return{time:0,duration:l.Z.MSPerDay}}return!1}},{key:"numCalendarDaysInView",value:function(){var e=this.getViewMode();return("Calendar_Week"===e?7:"Calendar_Day"===e&&1)||"Calendar_Custom"===e&&u.default.settings.calendarCustomDays.get()||0}},{key:"updateAllDay",value:function(){if(!this._destroyed){for(var e=0,t=this.indexOfTop(),n=this.numCalendarDaysInView(),r=1,i=t;i<t+n;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.items.get()[i];if(a){for(var o=0,s=0,c=a.items||[],l=0;l<c.length;l++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=c[l];this.getItemPlacementOnDate(u,a.date)||s++}s>r&&(r=s)}}this.numAllDay.set(r)}}},{key:"getContentHeight",value:function(){return 1224+this.getHeightAllDay()+2}},{key:"getHeightAllDay",value:function(){return Math.min(l.Z.CalendarDayViewMaxAllDayHeight,26*this.numAllDay.get())+1}},{key:"getDayViewY",value:function(){return 409}},{key:"getDayWidth",value:function(){var e=this.getWidth(),t=this.getViewMode(),n=("Calendar_Day"===t?1:"Calendar_Week"===t&&7)||"Calendar_Custom"===t&&u.default.settings.calendarCustomDays.get();return Math.max(e/n,40)}},{key:"extraPaddingForPaneObject",value:function(e){return this.isViewAgenda(),0}},{key:"shouldShowTime",value:function(e){var t="blockItem"===e.type&&e.item;return t&&!t.isNote()&&0===e.levelsDeepNew()&&e.block&&e.block.shouldShowTime()}},{key:"isItemTopLevel",value:function(e){var t=e.item,r=!0;if(this.isViewProject()){if(e)return e.isBlockHeader;r=t.isPrefixHeader()}return this.isViewProject()&&this.search.showChildProjects()||(r=f()(_()(n.prototype),"isItemTopLevel",this).call(this,e)),r}},{key:"hasCollapsedBlocks",value:function(){if(this.isViewAutoBlocks()){for(var e=0,t=0;this.blocks&&t<this.blocks.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(this.blocks[t].paneObject.isCollapsed())return!0}return!1}}},{key:"getSupportedSortBlocksModes",value:function(){return B[this.getViewMode()].Available}},{key:"supportsSortBlocks",value:function(e){return e=e||this.getViewMode(),n.viewModeSupportsSortBlocks(e)}},{key:"supportsSortBlocksMode",value:function(e,t){return t=t||this.getViewMode(),n.viewModeSupportsSortBlocksMode(e,t)}},{key:"supportsSortItems",value:function(e){return e=e||this.getViewMode(),n.viewModeSupportsSortItems(e)||this.isViewFlatList()}},{key:"getSortModeBlocks",value:function(){if(this.supportsSortBlocks())return this.viewState.get().sortModeBlocks.mode}},{key:"getSortOrderBlocks",value:function(){if(this.supportsSortBlocks())return this.viewState.get().sortModeBlocks.order||1}},{key:"isSortedBlocks",value:function(){var e=this.getSortModeBlocks();return e&&"None"!==e}},{key:"setSortModeBlocks",value:function(e,t,n){this.setViewProp("sortModeBlocks",{mode:e,order:t},n)}},{key:"getSortModeItems",value:function(){if(this.supportsSortItems())return this.viewState.get().sortModeItems.mode}},{key:"getSortOrderItems",value:function(){if(this.supportsSortItems())return this.viewState.get().sortModeItems.order||1}},{key:"setSortModeItems",value:function(e,t,n){this.setViewProp("sortModeItems",{mode:e,order:t},n)}},{key:"isSortedItems",value:function(){var e=this.getSortModeItems();return e&&"None"!==e}},{key:"getViewMode",value:function(){return this.viewState.get().viewMode}},{key:"setViewMode",value:function(e){this.setViewProp("viewMode",e)}},{key:"setViewProp",value:function(e,t,n){var r=this.viewState.get();if(r[e]!==t){var i=c.Z.clone(r);i[e]=t,this.viewState.set(i,!1!==n)}}},{key:"createVMLI",value:function(e,t){var r=this.search.getTags();if(!this.isViewTag()&&r)for(var i=0,a=0;a<r.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[a],s="#"+o;if(e.text.indexOf(s)<0){for(var c=0,l=!1,u=t&&t.parent;u;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var d=u.getTags();if(d&&d.indexOf(o)>=0){l=!0;break}u=u.parent()}l||(e.text+=" "+s)}}return f()(_()(n.prototype),"createVMLI",this).call(this,e,t)}},{key:"getItemDisplayTime",value:function(e){var t=this.getSortModeBlocks(),n=e.item;return"Date"===t?n.getTime()||(e.showAllDay?"All day":""):"Created"===t?n._formatDateTime(n.dateCreated):"Completed"===t?n.dateCompleted?n._formatDateTime(n.dateCompleted):"no time":"Modified"===t?n.dateModified?n._formatDateTime(n.dateModified):"no time":void 0}},{key:"onCalendarCustomDaysChanged",value:function(){"Calendar_Custom"===this.getViewMode()&&this.onViewStateChanged()}},{key:"switchToOutline",value:function(){this.setViewMode("Outline")}},{key:"shouldRenderPrefix",value:function(e){return!(this.isViewProject()&&e.isBlockHeader)}},{key:"bottomListMessage",value:function(){var e;if(!(this.numItems()>0)){var t=this.search.numUnmatchedItems();t&&(e=this.isSearched()?t+" items hidden by search / filters. Click the search box above to clear your search / filters, or click to add new items.":t+" completed items hidden by filter. Click the search box above and click the checkbox filter to show completed items.")}return{text:e,clickable:!1}}},{key:"needsUpdateForDate",value:function(){return this.isViewDates()}},{key:"needsUpdateForRepeatDateCompleted",value:function(){return!1}},{key:"needsUpdateForPriority",value:function(){return this.isViewPriority()||this.isViewAgenda()}},{key:"needsUpdateForModified",value:function(){return"Modified"===this.getSortModeBlocks()||"Modified"===this.getSortModeItems()}},{key:"needsUpdateForLinkedTo",value:function(e){return this.getItem()===e}},{key:"_anyTagHasKey",value:function(e){return e&&e.some((function(e){return u.default.timeline.getDateForKey("#"+e)}))}},{key:"needsUpdateForTags",value:function(e){return this.isViewAgenda()&&this._anyTagHasKey(e)}},{key:"handleItemChanged",value:function(e,t){var r=!1;if(t.Tags&&this.isViewTag()&&(r=!0),t.Contacts&&this.isViewContact()&&(r=!0),t.Text&&e.getMirroredItem()&&(r=!0),t.Text&&u.default.settings.showStatusBar.get()){var i=this.itemInfos[e.id],a=i?e.numChars-i.chars:e.numChars,o=i?e.numWords-i.words:e.numWords;if(a||o){var s=this.textStatus.get()||{numChars:0,numWords:0},c=s.numChars,l=s.numWords;this.itemInfos[e.id]={chars:e.numChars,words:e.numWords},this.textStatus.set({numChars:c+a,numWords:l+o})}}return f()(_()(n.prototype),"handleItemChanged",this).call(this,e,t,r)}},{key:"setDocument",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.zoomItem,i=t.forLoad;f()(_()(n.prototype),"setDocument",this).call(this,e,{zoomItem:r,forLoad:i,noUpdateItems:!0}),this.onViewStateChanged()}},{key:"getItem",value:function(e){var t=this.getDocument();return e||this.isViewItems()?f()(_()(n.prototype),"getItem",this).call(this):this.isViewArchived()?t.getRootArchivedItem():this.isViewDeleted()?t.getRootDeletedItem():void 0}},{key:"getRootItem",value:function(){var e=this.getDocument();return this.isViewArchived()?e.getRootArchivedItem():this.isViewDeleted()?e.getRootDeletedItem():f()(_()(n.prototype),"getRootItem",this).call(this)}},{key:"handleRightSideTap",value:function(e){this.isViewArchived()?(e.unArchive(l.Z.ChangeType.Local),P.Z.reset()):this.isViewDeleted()?(e.unDelete(l.Z.ChangeType.Local),P.Z.reset()):f()(_()(n.prototype),"handleRightSideTap",this).call(this,e)}},{key:"getNewViewMode",value:function(){return this.isViewCalendar()?"Calendar":this.isViewArchived()?"Archived":this.isViewDeleted()?"Deleted":this.isViewAgenda()?"Agenda":this.search.showHierarchy()?"Outline":"List"}},{key:"getNewViewGroup",value:function(){if(!this.isViewCalendar()){var e=this.getViewMode(),t=("Groups_Project"===e?"Project":"Groups_Tag"===e&&"Tag")||"Groups_Contact"===e&&"Contact"||"Groups_Priority"===e&&"Priority"||this.isViewAgenda()&&"Agenda"||"None";if("Agenda"===t){var n=this.getSortModeBlocks();"Created"===n?t="Created":"Modified"===n?t="Modified":"Completed"===n?t="Completed":this.search.showOnlyAgendaDates()&&(t="Date")}return t}}},{key:"setGroupMode",value:function(e){var t="Created"===e||"Modified"===e||"Completed"===e,n=("None"===e?"Outline":"Project"===e&&"Groups_Project")||"Tag"===e&&"Groups_Tag"||"Contact"===e&&"Groups_Contact"||"Priority"===e&&"Groups_Priority"||("Agenda"===e||"Date"===e||t)&&"Agenda_All",r=t?e:"None";O.Z.beginBatch(),this.setViewMode(n),"Date"===e!==this.search.showOnlyAgendaDates()&&this.search.setFilter("showOnlyAgendaDates","Date"===e),this.setSortModeBlocks(r,1),O.Z.endBatch()}},{key:"setSortBlocks",value:function(e){var t=this.getSortOrderBlocks();this.getSortModeBlocks()===e&&(t=-this.getSortOrderBlocks()),this.setSortModeBlocks(e,t)}},{key:"setSortItems",value:function(e){var t=this.getSortOrderItems();this.getSortModeItems()===e&&t>0&&(t=-this.getSortOrderItems()),this.setSortModeItems(e,t)}},{key:"getSortModeBlocksText",value:function(){return l.Z.TaskSortModeText[this.getSortModeBlocks()]}},{key:"getSortModeItemsText",value:function(){return l.Z.TaskSortModeText[this.getSortModeItems()]}},{key:"scrollToMiddle",value:function(e){var t,n=null===(t=this.getPaneObjectsForItem(e))||void 0===t?void 0:t[0];if(n){var r=n.index;if(r<0&&e.isDescendantOf(this.item.get())&&this.search.isMatched(e)){var i=0;u.default.PaneUpdateBatcher.beginUpdateItems();for(var a=n.parentObject;a;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a.isCollapsed()&&(this.setIgnoreRestoreScroll(),a.setCollapsed(!1)),a=a.parentObject}u.default.PaneUpdateBatcher.commitUpdateItems(),r=this.indexOfItem(e)}r>=0&&this.scrollIndexToMiddle(r,"smooth")}}},{key:"canCollapse",value:function(){return!(this.isViewFlatList()&&"None"===this.getNewViewGroup())}},{key:"updateItemsImmediate",value:function(e,t,r,i){if(this.document.get()&&!this.document.get().isDeleted.get())return f()(_()(n.prototype),"updateItemsImmediate",this).call(this,e,t,r,i)}},{key:"updateHeadersOverride",value:function(){var e=this,t=[];return D.Z.getDocumentsArray().forEach((function(n){var r=n.getRootItem();t.push(r);var i={item:n.getRootItem(),noCollapsed:!0,collapseAfterDepth:1,headers:!0,overview:!0,pane:e,each:function(e){e.isComplete()||t.push(e)}};c.Z.searchVMLIs(i)})),t}},{key:"zoomIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.getDocumentOwner()?f()(_()(n.prototype),"zoomIn",this).call(this,e,t):u.default.toasts.pushMessage("Cannot zoom into calendar events.")}},{key:"canZoomToItem",value:function(e){return e.getDocumentOwner()?f()(_()(n.prototype),"canZoomToItem",this).call(this,e):(u.default.toasts.pushMessage("Cannot zoom into calendar events."),!1)}},{key:"addFooterItems",value:function(e){var t=this,n=e.length;this._numItems=n;var r=this.getItem().itemsLinkedTo.get();if(this.addPaneObject(e,new x.Z({id:"footer",type:"footer",pane:this,index:e.length,data:{numReferences:(null===r||void 0===r?void 0:r.length)||0}})),r&&r.forEach((function(n){var r=n.parent();r.isRoot||t.addPaneObject(e,new x.Z({type:"blockItem",item:n.parent(),id:t.getPaneObjectIDNonItem("rp"+n.parent().id),pane:t,index:e.length,levelsDeepRoot:r,noCollapse:!0})),t.addPaneObject(e,new x.Z({type:"blockItem",item:n,id:t.getPaneObjectIDNonItem("r"+n.id),pane:t,index:e.length,levelsDeepRoot:r}))})),u.default.settings.showStatusBar.get()){var i=0,a=0;e.forEach((function(e){if(e.item){var n=t.itemInfos[e.item.id]={chars:e.item.numChars,words:e.item.numWords};i+=n.chars,a+=n.words}})),this.textStatus.set({numChars:i,numWords:a}),this.itemStatus.set({numItemsInView:n,numItemsFiltered:Math.max(this.search.numMatches-1,0),numItemsZoomed:this.search.totalNumItemsWithoutNotes,numItemsDoc:this.getDocument().numItems(),numReferences:(null===r||void 0===r?void 0:r.length)||0})}}},{key:"getActionSheetItems",value:function(){var e=this;return[{text:"Undo",icon:"MdUndo",onPress:function(){w.Z.undo()}},{text:"Collapse All Items",icon:"FaMinus",onPress:function(){e.collapseAllRecursive(!0),e.scrollToTop()}},{text:"Expand All Items",icon:"MdAdd",onPress:function(){e.collapseAllRecursive(!1),e.scrollToTop()}},{text:"Archive Completed",icon:"MdArchive",onPress:function(){e.archiveCompleted()}}]}},{key:"resetScroll",value:function(){this.isViewDates()?this.scrollToToday():this.scrollToIndex(0,"start")}},{key:"getMobileIcon",value:function(){return this.isViewCalendar()?"IoIosCalendar":this.isViewArchived()?"MdArchive":this.isViewDeleted()?"IoMdTrash":this.isViewAgenda()?"MdToday":this.search.showHierarchy()?"MdFormatListBulleted":"MdReorder"}}],[{key:"viewModeSupportsSortBlocks",value:function(e){return!!B[e]}},{key:"viewModeSupportsSortBlocksMode",value:function(e,t){return B[t]&&B[t].Available.indexOf(e)>=0}},{key:"viewModeSupportsSortItems",value:function(e){return"Groups_Project"===e||"Groups_Tag"===e||"Groups_Contact"===e||"Groups_Priority"===e}}]),n}(R.Z);var j=n(9148);const H=new(function(){function e(){a()(this,e),this._inactivePaneTypes={},this.activePaneTypes=new j.Z,this._registeredTypes={},this.numInactivePanes=new E.Z(0),this.registerPaneType(void 0,l.Z.PaneMode.Task,"Task",U,"icon-align-left",99)}return s()(e,[{key:"paneSortCompare",value:function(e,t){return e.priority<t.priority?1:-1}},{key:"registerPaneType",value:function(e,t,n,r,i,a){this._registeredTypes[t]={plugin:e,constructor:r};var o={type:t,name:n,icon:i,text:n,priority:a,tooltip:"Add "+n+" Pane"};!e||e.isActive()?this.activePaneTypes.insertSorted(o,this.paneSortCompare):(this._inactivePaneTypes[t]=o,this.numInactivePanes.set(this.numInactivePanes.get()+1))}},{key:"activatePaneType",value:function(e){var t=this._inactivePaneTypes[e];try{c.Z.PAssert(889,t,"Must have previously registered pane type")}catch(n){c.Z.reportError(n)}this._inactivePaneTypes[e]=void 0,this.activePaneTypes.insertSorted(t,this.paneSortCompare),this.numInactivePanes.set(this.numInactivePanes.get()-1)}},{key:"deactivatePaneType",value:function(e){var t=this.activePaneTypes.get().find((function(t){return t.type===e}));this.activePaneTypes.remove((function(t){return t.type===e}));try{c.Z.PAssert(890,t,"Must have previously activated pane type")}catch(n){c.Z.reportError(n)}u.default.PaneManager.removePanesByType(e),this._inactivePaneTypes[e]=t,this.numInactivePanes.set(this.numInactivePanes.get()+1)}},{key:"canCreatePane",value:function(e){var t=this._registeredTypes[e],n=t.plugin;return n&&!t.plugin.isActive()?"the ".concat(n.name," plugin is not active."):!n||!t.plugin.isPluginBlocked()||"the ".concat(n.name," pane is a premium feature.")}},{key:"createPane",value:function(e,t){(t=t||{}).id||(t.id=u.default.PaneManager.getNextPaneID()),"PaneTimeline"===e?(e=l.Z.PaneMode.Task,t.viewState={viewMode:"Agenda_All"}):"PaneOutline"===e?(e=l.Z.PaneMode.Task,t.viewState={viewMode:"Outline"}):"PaneArchived"===e&&(e="PaneTask",t.viewState={viewMode:"Archived"});var n=this._registeredTypes[e];if(n){if(!n.plugin||n.plugin.isActive()&&!n.plugin.isPluginBlocked())try{u.default.PaneUpdateBatcher.beginUpdateItems();var r=n.constructor.getPluginID();if(r)u.default.pluginManager.getPlugin(r).onPaneActivated();var i=new n.constructor(t);return u.default.PaneUpdateBatcher.commitUpdateItems(),i}catch(a){return void c.Z.reportError(a)}}else try{c.Z.PAssert(891,!1,"Invalid pane type requested")}catch(o){c.Z.reportError(o)}}},{key:"isPaneTypeActive",value:function(e){var t=!!this._registeredTypes[e],n=!!this._inactivePaneTypes[e];return t&&!n}},{key:"getRegisteredPanes",value:function(){return this.activePaneTypes.get()}},{key:"_getTaskView",value:function(e,t,n,r){for(var i=0,a=[],o=0;o<n.length;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=n[o],c=l.Z.TaskViewModeText[s];"Calendar_Custom"===s&&(c=c.replace("#",u.default.settings.calendarCustomDays.get())),a.push({text:c,type:l.Z.PaneMode.Task,viewMode:s,icon:l.Z.TaskViewModeIcon[s],premium:!!l.Z.TaskViewModesPremium[s],canZoom:!0})}e.push({text:t,viewModes:a,border:!r})}},{key:"getAvailablePanes",value:function(e){var t=this.activePaneTypes.get(),n=this.numInactivePanes.get(),r=[];if(this._getTaskView(r,"List",["Outline","List_Flat","Archived","Deleted"]),this._getTaskView(r,"Grouped by",["Groups_Project","Groups_Tag","Groups_Contact","Groups_Priority"]),this._getTaskView(r,"Agenda",["Agenda_Today","Agenda_Week","Agenda_Month","Agenda_All"]),this._getTaskView(r,"Calendar",["Calendar_Day","Calendar_Custom","Calendar_Week","Calendar_Month"],e),!e){for(var i=0,a=0;a<t.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=t[a];if(o.type!==l.Z.PaneMode.Task){var s=o.type===l.Z.PaneMode.Gmail;r.push({text:o.text,type:o.type,icon:o.icon,canZoom:s,border:!0})}}r[r.length-1].border=!1,n>0&&r.push({enableMore:!0})}return r}}]),e}())},8001:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(4472),c=n(4654);const l=function(){function e(t){var n=this;i()(this,e),this.children=[],Object.keys(t).forEach((function(e){return n[e]=t[e]}))}return o()(e,[{key:"showMarkdown",value:function(e){return c.default.settings.showMarkdown.get()&&(this.forceIsSelected||e||s.Z.isSelected(this))}},{key:"getDisplayText",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.isSelected,n=e.noPrefix,r=e.forAutocomplete;return this.item.getDisplayText({showMarkdown:this.showMarkdown(t),noPrefix:n,forAutocomplete:r})}},{key:"getDisplayLength",value:function(e,t){return this.getDisplayText({isSelected:e,noPrefix:t}).length}},{key:"getDisplayTextWithoutPrefix",value:function(){return this.item.getDisplayText({showMarkdown:this.showMarkdown(),noPrefix:!0})}},{key:"getDisplayLengthWithoutPrefix",value:function(){return this.getDisplayTextWithoutPrefix().length}},{key:"levelsDeepNew",value:function(){return this.item?this.overview?this.item.levelsDeep.get()-1:this.pane.itemLevelsDeep(this.item,this.levelsDeepRoot)-(this.mirroringLevelsDeep||0):0}},{key:"getPrevious",value:function(){return this.pane.objectAtIndex(this.index-1)}},{key:"getNext",value:function(){return this.pane.objectAtIndex(this.index+1)}},{key:"isCollapsed",value:function(){return this.pane.isPaneObjectCollapsed(this)}},{key:"setCollapsed",value:function(e,t){return"blockHeader"===this.type&&this.block&&delete this.pane.blocksCollapsed[this.block.id],this.pane.setPaneObjectCollapsed(this,e,t)}},{key:"toggleCollapsed",value:function(e){return this.setCollapsed(this.isCollapsed(),e)}},{key:"setUncollapsedToRoot",value:function(){var e;this.setCollapsed(!1),null===(e=this.parentObject)||void 0===e||e.setUncollapsedToRoot()}},{key:"getMirrorOrItem",value:function(){return this.mirroringItem||this.item}},{key:"isInMirror",value:function(){return void 0!==this.mirroringLevelsDeep}},{key:"getElement",value:function(){return this.pane.elementAtIndex(this.index)}}]),e}()},7994:(e,t,n)=>{"use strict";n.d(t,{Z:()=>de});var r=n(8926),i=n.n(r),a=n(9713),o=n.n(a),s=n(4575),c=n.n(s),l=n(3913),u=n.n(l),d=n(3124),h=n.n(d),p=n(7757),f=n.n(p),g=n(8651),m=n(8855),v=n(4654),y=n(8572),k=n(6744),_=n(9105),Z=n(2205),w=n.n(Z),b=n(8585),P=n.n(b),S=n(9754),D=n.n(S),I=n(8133),E=n(5193),x=n(9603),C=n(7274),A=n(9148),L=n(8047),M=n(9998),T=n(6186);const R=function e(t){c()(this,e),this.id=t};const O=function(){function e(t,n){var r;c()(this,e);var i=t.isRead,a=t.data,o=t.isComplete,s=a.subject,l=a.date,u=a.snippet,d=a.accountID,h=a.service,p=a.contacts,f=a.numMessages,m=a.labels,v=a.hasAttachment,y=a.needsResolve,k=a.addedFromLabel;this.plugin=n,this.pluginData=t,this.id=t.id,this.text=this.subject=s||"",this.accountID=d,this.service=h,this.subjectLower=null===(r=this.subject)||void 0===r?void 0:r.toLowerCase(),this.needsResolve=y,this.addedFromLabel=k,this.isRead=new C.Z(i),this.numMessages=new C.Z(f);try{var _;if(n.isOldEmail(a)&&a.messages){var Z=a.messages,w=(Z=Z||[])[Z.length-1];if(w){var b,P=w.snippet,S=w.date;if(_=S,S)try{this.date=g.Z.isNumber(S)?new Date(S):this.plugin.parseDate(S)}catch(I){try{g.Z.PAssert(912,!1,"Error parsing dateString",S)}catch(E){g.Z.reportError(E)}}this.snippet=null===(b=P||u||"")||void 0===b?void 0:b.replace(/[\r\n]/g,"")}else this.snippet=u||"";this.participants=a.participants||n.getParticipants(Z)||[],this.isComplete=o,this.labels=g.Z.arrayUniques2(g.Z.arrayFlat(Z.map((function(e){return e.labelIds})).filter((function(e){return!!e}))))||[],this.numMessages.set(Z.length)}else this.participants=p||[],this.snippet=u,this.date=g.Z.isString(l)?this.plugin.parseDate(l):l,this.labels=m||[],this.hasAttachment=v;if(!g.Z.isArray(this.participants)){try{g.Z.PAssert(913,!1,"No valid participants",this.participants)}catch(E){g.Z.reportError(E)}this.participants=[]}this.participants=this.participants.filter((function(e){return!!e}));var D=g.Z.isDateValid(this.date);try{g.Z.PAssert(914,D,(function(){var e;return"Date is invalid: ".concat(l,", ").concat(_,", ").concat(n.isOldEmail(a),", ").concat(n.isOldEmail(a)&&(null===(e=a.messages)||void 0===e?void 0:e.length))}))}catch(E){g.Z.reportError(E)}D||(this.date=new Date,this.isDateInvalid=!0),this.isStarred=new C.Z(this.labels.includes("starred"))}catch(I){g.Z.reportError(I,"Error in email constructor")}}return u()(e,[{key:"updateFromData",value:function(e,t){this.text=this.subject=e.subject,this.date=g.Z.isDateValid(e.date)?e.date:this.plugin.parseDate(e.date),this.labels=this.labels?this.updateLabels(this.labels,e.labels):e.labels,this.isRead.set(e.read),this.isStarred.set(e.labels.includes("starred"))}},{key:"updateLabels",value:function(e,t){var n=g.Z.arrayUnion(e,t);return(t.includes("archive")||t.includes("deleted"))&&n.remove("inbox"),t.includes("inbox")&&n.remove("archive"),n}},{key:"setRead",value:function(e,t){if(this.isRead.get()!==e){this.isRead.set(e);var n={isRead:e};this.plugin.isItemSaved(this.id)&&g.Z.isLocalChange(t)&&this.plugin.saveData(this.id,n),de.onMetadataChanged(this,n)}}},{key:"archive",value:function(){this.plugin.sendAction(this.accountID,this.service,"archive",this.id),this.labels.remove("inbox")}},{key:"delete",value:function(){var e=i()(f().mark((function e(){return f().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:this.plugin.isItemSaved(this.id)&&this.plugin.deleteSavedItem(this),this.plugin.sendAction(this.accountID,this.service,"delete",this.id),this.labels.push("trash");case 3:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onAddToDropBucket",value:function(){var e=i()(f().mark((function e(){var t;return f().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.needsResolve){e.next=5;break}return e.next=3,I.LA.resolveEmailMessageID(this.accountID,this.service,this.id);case 3:(t=e.sent)&&t!==this.id&&(this.plugin.changeItemID(this.id,t),this.id=this.pluginData.id=t);case 5:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();var F=n(319),N=n.n(F),B=n(3038),U=n.n(B),j=n(1506),H=n.n(j),V=n(6525),W=n.n(V),z=n(8778),q=n(5216),G=n(9607),K=n(7048);function Y(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=D()(e);if(t){var i=D()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return P()(this,n)}}var X=function(e){w()(n,e);var t=Y(n);function n(e,r,i){var a;return c()(this,n),i=Object.assign({title:r,contextMenuMode:r,dropEffect:function(){return m.Z.DropEffect.Copy},isWriteable:!1,isDropTarget:!1,overrideCopyBehavior:!1,canAddItem:!1,supportCollapsing:!0,supportCompleting:!1,supportCheckbox:!1,supportOffline:!1,supportPerformArchive:!1,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportClickOverviewScroll:!1,supportClone:!1,supportDates:!1,supportSel:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,searchFilters:[],supportsDocuments:!1,usesVMLIs:!1},i),(a=t.call(this,e,i)).isSimplePane=!0,a.allItemsSimple=[],a.itemsSimple=new A.Z,a.titles=new C.Z,a}return u()(n,[{key:"usesItemStore",value:function(){return!1}},{key:"simpleObjectAtIndex",value:function(e){return this.itemsSimple.get()[e]}},{key:"onMetadataChanged",value:function(e,t){}}]),n}(n(9320).Z);var Q;function J(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=D()(e);if(t){var i=D()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return P()(this,n)}}var $="All Accounts",ee="Saved";const te=(Q=function(e){w()(n,e);var t=J(n);function n(e){var r,i;c()(this,n),(i=t.call(this,e,"Email",{maxWidthFlex:m.Z.ExpandedPaneWidth,maxWidth:m.Z.ExpandedPaneWidth+200,maxWidthSingle:m.Z.ExpandedPaneWidth,widthBiggerInSingle:!1,supportDataRefresh:"Emails",searchFilters:[{name:"unread",initialValue:1,icon:"icon-drafts",tooltip:"unread emails",matchFnBoolean:function(e){return!e.isRead.get()}}]})).type=m.Z.PaneMode.Inbox,i.paneClass="paneInbox",i.pluginNew=de.getPluginNew("Email");var a=(null===(r=e.item)||void 0===r?void 0:r.split(":"))||[],o=U()(a,3),s=o[0],l=o[1],u=o[2];return i._zoomedItem=new C.Z({accountID:s||$,label:l||"inbox",service:u||"g"},i.onZoomedItemChanged),i.zoomedItem=new K.Z([i._zoomedItem],(function(e){return v.default.supportEmailViews()?e:{accountID:ee,label:"inbox"}})),i.onZoomedItemChanged(i.zoomedItem.get()),G.Z.getSelectedForPaneObs(H()(i)).listen(i.onMultiselectChanged),i}return u()(n,[{key:"init",value:function(){W()(D()(n.prototype),"init",this).call(this),this.updateItemsImmediate(),this.pluginNew.items.listen(this.onPluginItemsChange),this.updateLabel(),this.lastFocusRefresh=0,window.addEventListener("focus",this.onWindowFocus),window.addEventListener("visibilitychange",this.onWindowFocus)}},{key:"destroy",value:function(){this.pluginNew.items.unlisten(this.onPluginItemsChange),window.removeEventListener("focus",this.onWindowFocus),window.removeEventListener("visibilitychange",this.onWindowFocus),W()(D()(n.prototype),"destroy",this).call(this)}},{key:"onWindowFocus",value:function(){if("visible"===document.visibilityState){var e=Date.now();e-this.lastFocusRefresh>m.Z.MSPerMinute&&(this.lastFocusRefresh=e,this._refreshPaneData())}}},{key:"onPluginItemsChange",value:function(){this.updateItemsImmediate()}},{key:"updateItemsImmediate",value:function(e,t,n,r){var i=this,a=G.Z.getSelectedObjects(this);this.checkChildren();var o=this.pluginNew.items.get(),s=[],c=0;o.forEach((function(e){i.isItemInView(e)&&i.search.isMatchedSimple(e.id)&&s.push({id:e.id,index:c++,item:e,pane:i,type:"item"})})),this.allItemsSimple=o,this.itemsSimple.set(s);var l=G.Z.getSelectedObjects(this);if(a&&l&&!l.map((function(e){return e.id})).equals(a.map((function(e){return e.id})))){var u=a.find((function(e){return s.find((function(t){return e.id===t.id}))}));if(u){var d=s.find((function(e){return u.id===e.id}));d&&G.Z.setSelectedNew([d.index],this)}else l.length>0&&v.default.EmailPreview.isOpenOnPane(this)&&this.openEmail(l[0].index)}}},{key:"isItemInView",value:function(e){var t=this.zoomedItem.get(),n=t.accountID,r=t.label,i=this.pluginNew.isItemSaved(e.id),a=e.labels.includes("trash"),o=e.labels.includes("spam");return(n===ee||n===$&&!this.pluginNew.numHiddenViewsEmails)&&i&&!e.isComplete||(n===$||e.accountID===n)&&(a&&"trash"===r||!a&&!o&&("all"===r||e.labels.includes(r)))}},{key:"createVMLIsToDrop",value:function(e,t){var n=this,r=t.targetItem||t.targetPane.getItem();return e.items.map((function(e){return n.createVMLIFromItem(e.id,r)}))}},{key:"createVMLIFromItem",value:function(e,t){return E.Z.createVMLI({text:this.pluginNew.getEmbedString(e)},{parent:t,documentOwner:t.getDocumentOwner(),changeType:m.Z.ChangeType.Local})}},{key:"numItems",value:function(){return this.itemsSimple.length()}},{key:"checkChildren",value:function(){var e=this;this.pluginNew.items.get().forEach((function(t){return t&&e.search.checkItemSimple(t,[t.subjectLower].concat(N()(t.participants.map((function(e){return e.text+e.email})))))}))}},{key:"autocompleteCopy",value:function(){var e=this,t=G.Z.getFirstSelectedIndex(this);z.Z.showPopup({pane:this,mode:"move",text:"Select item to move to",elementDisplay:this.listManager.getElementByIndex(t),documentSelector:!0,onSelected:function(t){var n=t.item;G.Z.forEach(e,(function(t){var r=e.createVMLIFromItem(t.id,n);n.insertItem(r),e.onMoveToDocument(t)}))}})}},{key:"autocompleteCreateTask",value:function(){var e=this,t=G.Z.getFirstSelectedIndex(this);v.default.menus.openItemEditor({element:this.listManager.getElementByIndex(t),pane:this,selectIndex:0,addOnSave:!0,selectDocument:!0,side:"bottom",positionOffset:{left:10},beginSave:function(){v.default.PaneUpdateBatcher.beginUpdateItems()},endSave:function(t){Date.now();G.Z.forEach(e,(function(n){var r=e.createVMLIFromItem(n.id,t);t.insertItem(r),e.onMoveToDocument(n)})),v.default.PaneUpdateBatcher.commitUpdateItems()}})}},{key:"doMultiselectAction",value:function(){var e=i()(f().mark((function e(t){var n,r,i,a,o,s,c,l=this;return f().wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if("MarkRead"!==t){e.next=4;break}n=function(e){e.setRead(!0,m.Z.ChangeType.Local),l.pluginNew.sendAction(e.accountID,e.service,"read",e.id)},e.next=38;break;case 4:if("MarkUnread"!==t){e.next=8;break}n=function(e){e.setRead(!1,m.Z.ChangeType.Local),l.pluginNew.sendAction(e.accountID,e.service,"unread",e.id)},e.next=38;break;case 8:if("OpenInGmail"!==t){e.next=12;break}n=function(e){l.pluginNew.openInGmail(e)},e.next=38;break;case 12:if("CopyToItem"!==t){e.next=16;break}this.autocompleteCopy(),e.next=38;break;case 16:if("CopyToNewItem"!==t){e.next=20;break}this.autocompleteCreateTask(),e.next=38;break;case 20:if("Star"!==t){e.next=24;break}n=function(e){void 0===i&&(i=!e.isStarred.get()),e.isStarred.set(i),l.pluginNew.sendAction(e.accountID,e.service,i?"star":"unstar",e.id)},e.next=38;break;case 24:if("Archive"!==t){e.next=29;break}n=function(e){e.archive()},r=!0,e.next=38;break;case 29:if("Delete"!==t){e.next=38;break}if(o=(null===(a=this.zoomedItem.get())||void 0===a?void 0:a.accountID)===ee,s=!0,!o){e.next=37;break}return c=G.Z.numSelectedInPane(this),e.next=36,v.default.menus.confirm("Are you sure you want to unsave ".concat(c>1?"these emails":"this email","?"));case 36:s=e.sent;case 37:s&&(n=function(e){e.delete()},r=!0);case 38:n&&G.Z.forEach(this,n),r&&this.updateItems();case 40:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onHotkey",value:function(e,t){if(G.Z.hasSelection(this)){if("Up"===e||"Down"===e)G.Z.onKeyDown(this,t);else if("Open"===e){var n=G.Z.getSelected(this);1===n.length&&this.openEmail(n[0])}else this.doMultiselectAction(e);g.Z.preventAndStop(t)}}},{key:"openEmail",value:function(e,t){var n=this.itemsSimple.get()[e];if(n){var r=q.Z.parseSinglePlugin(this.pluginNew.getEmbedString(n.id),m.Z.ChangeType.ItemLoad).attachments;if(r){var i=v.default.pluginManager.getAttachment(r[0],!0);if(i){var a=this.lastEmailOpened,o=v.default.EmailPreview.isOpenOnPane(n.pane)&&v.default.EmailPreview.isOpenOnThread(i);t&&o&&(!a||a.id!==i.id||a.time<Date.now()-1e3)?v.default.EmailPreview.close():o||(this.lastEmailOpened={id:i.id,time:Date.now()},v.default.EmailPreview.open(void 0,i,this),n.item.setRead(!0,m.Z.ChangeType.Local))}}}}},{key:"onMultiselectChanged",value:function(e){1===e.length?v.default.EmailPreview.isOpen()&&this.openEmail(e[0]):v.default.EmailPreview.reset()}},{key:"onDoubleClick",value:function(e){this.openEmail(e,!0)}},{key:"onMetadataChanged",value:function(e,t){var n=t.isComplete,r=t.isRead;(void 0!==n&&this.search.isFilteredOn("complete")||void 0!==r&&this.search.isFilteredOn("unread"))&&this.updateItems(!0)}},{key:"getMobileIcon",value:function(){return"MdInbox"}},{key:"getSwipeMenuItems",value:function(e){var t=this,n=this.pluginNew.getById(e.id);return{left:[this.pluginNew.isItemSaved(n.id)?{icon:"delete",text:"Remove from Saved",backgroundColor:"#a30",onActivated:function(){n.delete(),t.updateItems()}}:{icon:"archive",text:"Archive",backgroundColor:"#0c0",onActivated:function(){n.archive(),t.updateItems()}}],right:[{icon:"delete",backgroundColor:"#a30",onActivated:function(){n.delete(),t.updateItems()}}]}}},{key:"getSaveInfo",value:function(){var e=W()(D()(n.prototype),"getSaveInfo",this).call(this),t=this._zoomedItem.get(),r=t.accountID,i=t.label;return e.item=r+":"+i,e}},{key:"onRemoteUpdate",value:function(e){var t;W()(D()(n.prototype),"onRemoteUpdate",this).call(this,e);var r=this.zoomedItem.get(),i=r.accountID,a=r.label,o=r.service,s=(null===(t=e.item)||void 0===t?void 0:t.split(":"))||[],c=U()(s,3),l=c[0],u=c[1],d=c[2];i===l&&a===u&&o===d||this.setAccountIDAndLabel(l,d,u,!0)}},{key:"setAccountIDAndLabel",value:function(e,t,n,r){var i={accountID:e,service:t,label:n};this._zoomedItem.set(i),this.updateLabel(),this.updateItemsImmediate(),r||this.saveState()}},{key:"updateLabel",value:function(){var e=this.zoomedItem.get(),t=e.accountID,n=e.label,r=e.service;this.pluginNew.loadLabel(t,r,n)}},{key:"onEndReached",value:function(){var e=this,t=this.zoomedItem.get(),n=t.accountID,r=t.label,i=t.service;n!==ee&&(n===$?v.default.settings.emailViewAccounts.forEach((function(t){e.pluginNew.loadNextPage(t.e,t.s,r)})):this.pluginNew.loadNextPage(n,i,r))}},{key:"onZoomedItemChanged",value:function(e){var t=e.accountID,n=e.label;if(v.default.supportEmailViews()){var r=t===$||t===ee?[t]:[t,this.pluginNew.getLabelName(n)];this.titles.set(r)}}},{key:"onMoveToDocument",value:function(e){v.default.settings.archiveEmailsOnOrganize.get()&&(e.archive(),this.updateItems())}},{key:"notifyDropFrom",value:function(e){var t=e.getAttachmentByType(m.Z.PluginType.Email);if(t){var n=this.pluginNew.getById(t.id);n&&this.onMoveToDocument(n)}}},{key:"_refreshPaneData",value:function(){var e=this.zoomedItem.get(),t=e.accountID,n=e.label,r=e.service;t===$?this.pluginNew.refreshAccounts():t!==ee&&this.pluginNew.refreshAccount(t,r,n)}},{key:"_applyDropOnBlockItem",value:function(e,t,r,i){var a=e.item||r.getItem();a&&a.insertItem(t,0),t.moveTo({parent:e.item||r.getItem(),index:0},m.Z.ChangeType.Local),W()(D()(n.prototype),"_applyDropOnBlockItem",this).call(this,e,t,r,i)}},{key:"getActionSheetItems",value:function(){var e=this;return[{text:"Refresh Emails",icon:"MdRefresh",onPress:function(){e.refreshPaneData()}}]}},{key:"setFocused",value:function(e){W()(D()(n.prototype),"setFocused",this).call(this,e),this.isLoaded&&this.refreshPaneData()}}]),n}(X),h()(Q.prototype,"onWindowFocus",[y.ZP],Object.getOwnPropertyDescriptor(Q.prototype,"onWindowFocus"),Q.prototype),h()(Q.prototype,"onPluginItemsChange",[y.ZP],Object.getOwnPropertyDescriptor(Q.prototype,"onPluginItemsChange"),Q.prototype),h()(Q.prototype,"onMultiselectChanged",[y.ZP],Object.getOwnPropertyDescriptor(Q.prototype,"onMultiselectChanged"),Q.prototype),h()(Q.prototype,"onZoomedItemChanged",[y.ZP],Object.getOwnPropertyDescriptor(Q.prototype,"onZoomedItemChanged"),Q.prototype),h()(Q.prototype,"_refreshPaneData",[y.ZP],Object.getOwnPropertyDescriptor(Q.prototype,"_refreshPaneData"),Q.prototype),Q);var ne;function re(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=D()(e);if(t){var i=D()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return P()(this,n)}}var ie=["subject","accountID","snippet"],ae=["text","email"],oe=["inbox","starred","all","sent","trash"],se=["inbox","archive","sent","deleted"],ce={inbox:"Inbox",starred:"Starred",all:"All Mail",sent:"Sent",trash:"Trash",archive:"Archive",deleted:"Deleted"};const le=(ne=function(e){w()(n,e);var t=re(n);function n(){var e;return c()(this,n),(e=t.call(this,"Email")).items=new A.Z,e.savedItemsMap={},e.itemsHiddenViews={},e.apiPromises=[],e.pagesLoaded={},e.hiddenWebviews={},e.isFirstLoaded=new C.Z,e.isLoadingMore=new C.Z,e.accountsComposing=new M.Z,e.accountsNeedSignin=new M.Z,T.Z.registerPaneType(void 0,m.Z.PaneMode.Inbox,"Inbox",te,"inbox",0),e.updateItems(),I.LA.onEmailThreads((function(t){var n=t.accountID,r=t.service,i=t.threads,a=t.label;e.addItemsFromViews(n,r,i,a)})),e}return u()(n,[{key:"numHiddenViewsEmails",get:function(){return this._numHiddenViewsEmails}},{key:"initWithAPI",value:function(e){this.api=e,this.apiPromises.forEach((function(e){return e()}))}},{key:"awaitAPI",value:function(){var e=i()(f().mark((function e(){var t=this;return f().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(this.api){e.next=2;break}return e.abrupt("return",new Promise((function(e){t.apiPromises.push(e)})));case 2:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateItems",value:function(){var e=this,t=k.Z.getTableData("pluginsNew"),n=Object.keys(t).map((function(n){var r=t[n],i=e.savedItemsMap[n];if(!i)try{i=e.savedItemsMap[n]=new O(r,e)}catch(a){g.Z.reportError(a)}return i})).filter((function(e){return!!e})),r=Object.values(this.itemsHiddenViews);this._numHiddenViewsEmails=r.length,n.pushOnlyUniques(r,g.Z.comparatorById),n=n.sort(this.sortByDate),this.items.set(n,!0)}},{key:"sortByDate",value:function(e,t){return!e.date||!t.date||isNaN(t.date.getTime())||isNaN(e.date.getTime())?0:t.date.compareTo(e.date)}},{key:"getById",value:function(e){return this.savedItemsMap[e]||this.itemsHiddenViews[e]}},{key:"isItemSaved",value:function(e){return!!this.savedItemsMap[e]}},{key:"getDataById",value:function(e){return k.Z.getPluginNew(e)}},{key:"changeItemID",value:function(e,t){this.itemsHiddenViews[t]=this.itemsHiddenViews[e]}},{key:"onUpdate",value:function(){var e=i()(f().mark((function e(t){var n,r,a,o,s,c,l,u,d,h,p,y,Z,w,b,P,S,D,I,x,C,A,L,M,T,R;return f().wrap((function(e){for(var O=0;;){if(O++>5e3&&__infLoop&&__infLoop(O))throw new RangeError;switch(e.prev=e.next){case 0:if(e.prev=0,n=t.id,k.Z.getPluginNew(n),r=t.data,a=!1,r&&(this.isOldEmail(r)?(a=!0,u=null===(o=(l=r).messages)||void 0===o?void 0:o[l.messages.length-1],d={accountID:l.accountID,service:l.service,subject:l.subject,contacts:l.messages?this.getParticipants(l.messages):[],date:new Date(l.date||(null===u||void 0===u?void 0:u.date)),numMessages:r.numMessages||(null===(s=l.messages)||void 0===s?void 0:s.length),plaintext:l.plaintext,snippet:null===(c=r.snippet||(null===u||void 0===u?void 0:u.snippet))||void 0===c?void 0:c.trim()},r=d):r.a&&(r=_.Z.emailMetaDataIn(r))),!r){e.next=36;break}if(h=g.Z.cloneDeep(r),p=g.Z.cloneDeep(r),y=v.default.crypto.getKeyInfo(v.default.settings.getBestUserEncryption()),Z=y.key,g.Z.isString(r.date)&&(r.date=this.parseDate(r.date)),!r.plaintext){e.next=23;break}return e.next=15,Promise.all(ie.map(function(){var e=i()(f().mark((function e(t){return f().wrap((function(e){for(var i=0,a=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(!r[t]){e.next=4;break}return e.next=3,v.default.crypto.encryptText(Z,r[t],n);case 3:p[t]=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 15:if(!p.contacts){e.next=18;break}return e.next=18,Promise.all(p.contacts.map(function(){var e=i()(f().mark((function e(t){return f().wrap((function(e){for(var r=0,a=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,Promise.all(ae.map(function(){var e=i()(f().mark((function e(r){return f().wrap((function(e){for(var i=0,a=0,o=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!t[r]){e.next=4;break}return e.next=3,v.default.crypto.encryptText(Z,t[r],n);case 3:t[r]=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 18:h.plaintext=null,p.plaintext=null,a=!0,e.next=28;break;case 23:return e.next=25,Promise.all(ie.map(function(){var e=i()(f().mark((function e(t){return f().wrap((function(e){for(var i=0,a=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(!r[t]){e.next=4;break}return e.next=3,v.default.crypto.decryptText(Z,r[t],n);case 3:h[t]=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 25:if(!h.contacts){e.next=28;break}return e.next=28,Promise.all(h.contacts.map(function(){var e=i()(f().mark((function e(t){return f().wrap((function(e){for(var r=0,a=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(!t){e.next=3;break}return e.next=3,Promise.all(ae.map(function(){var e=i()(f().mark((function e(r){return f().wrap((function(e){for(var i=0,a=0,o=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!t[r]){e.next=4;break}return e.next=3,v.default.crypto.decryptText(Z,t[r],n);case 3:t[r]=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 28:w=t.notInDoc,delete t.notInDoc,delete t.cmpData,t.data=h,k.Z.savePluginNew(t),w&&(b=t.docId,P=t.parent,D=(S=r).accountID,I=S.subject,(x=E.Z.getDocumentById(b))&&(C=x.getRootItem(),A={id:t.itemId,text:this.getAttachmentEmbedStringForID(n,D,I,"g"),dateCreated:t.dateCreated,dateModified:t.dateCreated,parent:P},L=E.Z.createVMLI(A,{documentOwner:x,parent:C,changeType:m.Z.ChangeType.Local}),C.insertItem(L,0),a=!0)),a&&(t.notInDoc=null,M=_.Z.emailMetaDataOut(p)||p,T=Object.assign({},t,{data:M}),R=_.Z.pluginOut(T),this.api.user.setPlugin(n,R)),this.updateItems();case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(0),console.log(e.t0);case 41:case"end":return e.stop()}}}),e,this,[[0,38]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isOldEmail",value:function(e){return!(!e.id&&!e.messages)}},{key:"translateLocalData",value:function(e,t){if(this.isOldEmail(t)){t.messages.forEach((function(e){e.labelIds||(e.labelIds=[])}));var n=t.messages[0];return Object.assign({id:e||t.threadId,to:n.to,from:n.from,snippet:n.snippet,labelIds:[]},t)}var r;return Object.assign({id:e,to:t.accountID,from:null===(r=t.contacts)||void 0===r?void 0:r[0],snippet:t.snippet,labelIds:[]},t)}},{key:"getEmbedString",value:function(e){var t=this.getById(e),n=t.id,r=t.pluginData.data,i=r.accountID,a=r.subject,o=r.service;if(t&&i)return this.getAttachmentEmbedStringForID(n,i,a,o)}},{key:"getAttachmentEmbedStringForID",value:function(e,t,n,r){return"".concat(m.Z.EmbedAttachChar,"p:").concat(m.Z.PluginID.Email,",id:").concat(e,",a:").concat(t,",s:").concat(r,",t:").concat(encodeURIComponent(n)).concat(m.Z.EmbedAttachChar)}},{key:"reEncrypt",value:function(){var e=i()(f().mark((function e(t,n,r){var a;return f().wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return a=k.Z.getAllPluginsNew(),e.next=3,Promise.all(Object.keys(a).map(function(){var e=i()(f().mark((function e(o){var s,c,l;return f().wrap((function(e){for(var u=0,d=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(e.prev=e.next){case 0:return s=a[o].data,c={},e.next=4,Promise.all(ie.map(function(){var e=i()(f().mark((function e(t){return f().wrap((function(e){for(var n=0,i=0,a=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(!s[t]||g.Z.isNumber(s[t])){e.next=4;break}return e.next=3,v.default.crypto.encryptText(r.key,s[t],o);case 3:c[t]=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:if(!s.contacts){e.next=8;break}return e.next=7,Promise.all(s.contacts.map(function(){var e=i()(f().mark((function e(t,n){var a;return f().wrap((function(e){for(var n=0,s=0,c=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:return a={},e.next=3,Promise.all(ae.map(function(){var e=i()(f().mark((function e(n){return f().wrap((function(e){for(var i=0,s=0,c=0,l=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:if(!t[n]){e.next=4;break}return e.next=3,v.default.crypto.encryptText(r.key,t[n],o);case 3:a[n]=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 7:c.contacts=e.sent;case 8:l=_.Z.emailMetaDataOut(c),Object.keys(l).forEach((function(e){n["".concat(t).concat(o,"/a/").concat(e)]=l[e]}));case 10:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getParticipants",value:function(e){return g.Z.arrayUniques2(e.map((function(e){return e.from}))).filter((function(e){return!!e})).map((function(e){return g.Z.parseEmailAddresses(e)[0]}))}},{key:"saveData",value:function(){var e=i()(f().mark((function e(t,n){var r,i,a;return f().wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.awaitAPI();case 2:(r=this.getDataById(t))&&(i=Object.assign({},r,n),k.Z.savePluginNew(i),a=_.Z.pluginOut(n),this.api.user.setPlugin(t,a));case 4:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteSavedItem",value:function(){var e=i()(f().mark((function e(t){var n;return f().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(n=t.id,!this.getDataById(n)){e.next=8;break}return e.next=5,this.awaitAPI();case 5:k.Z.deletePluginNew(n),this.api.user.removePlugin(n),this.updateItems();case 8:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addItemsFromViews",value:function(e,t,n,r){var i=this,a={};n.forEach((function(e){e.addedFromLabel=r})),n.forEach((function(n){var r,o=i.itemsHiddenViews[n.id]||i.savedItemsMap[n.id];o?o.updateFromData(n,t):(o=new O({id:n.id,plugin:"Email",cmpData:"",data:Object.assign(n,{accountID:e,service:t,date:i.parseDate(n.date),contacts:null===(r=n.contacts)||void 0===r?void 0:r.map((function(e){return{text:e.name,email:e.emailAddress}})),snippet:n.snippet,labels:n.labels}),isRead:n.read},i),i.itemsHiddenViews[n.id]=o);a[o.id]=!0})),Object.values(this.itemsHiddenViews).forEach((function(n){n.service===t&&n.accountID===e&&!a[n.id]&&n.addedFromLabel===r&&n.labels.includes(r)&&n.labels.remove(r)})),L.Z.beginBatch(),this.isFirstLoaded.set(!0),this.isLoadingMore.set(!1),this.updateItems(),L.Z.endBatch()}},{key:"setHiddenWebview",value:function(e,t,n){this.hiddenWebviews[t+":"+e]=n}},{key:"setResolver",value:function(e){this.resolverWebview=e}},{key:"sendAction",value:function(e,t,n,r){return I.LA.sendAction(e,t,n,r)}},{key:"loadLabel",value:function(e,t,n,r){var i=this;this.isFirstLoaded.get()?(this.isLoadingMore.set(!0),I.LA.loadEmailLabel(e,t,n,r),g.Z.timeoutOnce("email_loadNextPage",(function(){i.isLoadingMore.set(!1)}),5e3)):this.isFirstLoaded.onHasValue((function(){setTimeout((function(){i.loadLabel(e,t,n,r)}),0)}))}},{key:"loadNextPage",value:function(e,t,n){var r=this.pagesLoaded[e];r||(r=this.pagesLoaded[e]={}),r[n]=(r[n]||1)+1,this.loadLabel(e,t,n,r[n])}},{key:"resolveThreadHash",value:function(){var e=i()(f().mark((function e(t,n){return f().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.resolverWebview.resolve(t,n));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getLabels",value:function(e){return"g"===e.s?oe:se}},{key:"getLabelName",value:function(e){return ce[e]||e}},{key:"composeEmail",value:function(){var e=i()(f().mark((function e(t){var n,r,i;return f().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(1!==(n=v.default.settings.emailViewAccounts.get()).length){e.next=6;break}i=n[0],r=i.s+":"+i.e,e.next=9;break;case 6:return e.next=8,v.default.menus.openContextMenuList("Select account",g.Z.element("newEmailButtonView"),n.map((function(e){return{id:e.s+":"+e.e,value:e.e}})),!1,void 0,t);case 8:r=e.sent;case 9:r&&this.accountsComposing.setProperty(r,!0);case 10:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAccounts",value:function(){var e=i()(f().mark((function e(){var t=this;return f().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:v.default.settings.emailViewAccounts.forEach((function(e){return t.refreshAccount(e.e,e.s,"inbox")}));case 1:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshAccount",value:function(){var e=i()(f().mark((function e(t,n,r){return f().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:I.LA.loadEmailLabel(t,n,r);case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"setAccountNeedsSignin",value:function(e){var t=this,n=e.e,r=e.s,i=e.b;this.accountsNeedSignin.setProperty(r+":"+n,!0),v.default.toasts.pushMessage("g"===r?m.Z.MessageID.GmailViewsNeedSignin:{text:"Moo.do is not signed into your Outlook account: ".concat(n,". Please sign in to continue syncing your emails."),action:function(){v.default.menus.openModal(m.Z.Modals.OutlookAuth,{business:i,account:e,callback:function(e){var n=e.accountID;n&&t.setAccountFixed(n,"o")}})},actionText:"SIGN IN"})}},{key:"setAccountFixed",value:function(e,t){var n;v.default.settings.addEmailViewAccount(e,t),this.accountsNeedSignin.deleteProperty(t+":"+e),null===(n=this.hiddenWebviews[t+":"+e])||void 0===n||n.reload()}},{key:"getURLForOutlookAccount",value:function(e){return"https://outlook.".concat(null!==e&&void 0!==e&&e.b?"office":"live",".com")}},{key:"getAccount",value:function(e,t){return v.default.settings.emailViewAccounts.find((function(n){return n.e===e&&n.s===t}))}},{key:"parseDate",value:function(e){if(g.Z.isDateValid(e))return e;try{var t=x.Z.parseInternationalDate(e);return+t>Date.now()&&t.setFullYear(t.getFullYear()-1),t}catch(n){return new Date}}},{key:"openInGmail",value:function(e){this.openInGmailByID(e.id,e.pluginData.data.accountID)}},{key:"openInGmailByAttach",value:function(e){var t;this.openInGmailByID(e.id,(null===(t=e.getInlineData())||void 0===t?void 0:t.accountID)||"")}},{key:"openInGmailByID",value:function(e,t){var n="https://mail.google.com/mail/u/".concat(t,"#inbox/").concat(e);v.default.openUrl(n)}}]),n}(R),h()(ne.prototype,"refreshAccounts",[y.ZP],Object.getOwnPropertyDescriptor(ne.prototype,"refreshAccounts"),ne.prototype),ne);var ue;const de=new(ue=function(){function e(){c()(this,e)}return u()(e,[{key:"init",value:function(){this.pluginNew_Email=new le,this.loadedRemote=new C.Z}},{key:"initWithAPI",value:function(e,t){var n=this;this.pluginNew_Email.initWithAPI(e),t&&Object.keys(t).forEach((function(e){return n.onPluginsUpdate({type:"Added",value:o()({},e,t[e])})})),e.user.onPluginUpdate(this.onPluginsUpdate)}},{key:"onPluginsUpdate",value:function(e){var t=this,n=e.type,r=e.value,i=Object.keys(r)[0];if("Removed"===n)k.Z.deletePluginNew(i);else{var a=r[i],o=Object.assign({id:i},_.Z.pluginIn(a));this.onPluginUpdate(o)}g.Z.timeoutOnce("PluginManagerNew_loadedRemote",(function(){return t.loadedRemote.set(!0)}),1e3)}},{key:"onPluginUpdate",value:function(){var e=i()(f().mark((function e(t){return f().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:this.getPluginNew(t.plugin).onUpdate(t);case 2:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPluginNew",value:function(e){return this.pluginNew_Email}},{key:"getPluginDataTranslated",value:function(e){var t=this.getPluginInfo(e);if(t){var n=t.plugin,r=t.data;return n.translateLocalData(e,r)}}},{key:"getPluginData",value:function(e){return k.Z.getPluginNew(e)}},{key:"getPluginInfo",value:function(e){var t=this.getPluginData(e);if(t){var n=this.getPluginNew(t.plugin);if(n)return{plugin:n,data:t.data}}}},{key:"reEncrypt",value:function(){var e=i()(f().mark((function e(t,n,r){return f().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.pluginNew_Email.reEncrypt(t,n,r));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onMetadataChanged",value:function(e,t){v.default.PaneManager.runForEachPane((function(n){return n.onMetadataChanged(e,t)}),m.Z.PaneMode.Inbox)}}]),e}(),h()(ue.prototype,"onPluginsUpdate",[y.ZP],Object.getOwnPropertyDescriptor(ue.prototype,"onPluginsUpdate"),ue.prototype),ue)},2269:(e,t,n)=>{"use strict";n.d(t,{Z:()=>_});var r,i=n(4575),a=n.n(i),o=n(3913),s=n.n(o),c=n(3124),l=n.n(c),u=n(7411),d=n(8572),h=n(8855),p=n(8651),f=n(7100),g=n(4654),m=n(5252),v=n(3656),y=n(7274),k=n(9148);const _=new(r=function(){function e(){a()(this,e),this.pluginsAvailable=[h.Z.PluginID.Contacts,h.Z.PluginID.Drive,h.Z.PluginID.GCalendar,h.Z.PluginID.Gmail],this.pluginsAvailableNew=[h.Z.PluginID.Contacts,h.Z.PluginID.Drive,h.Z.PluginID.GCalendar],this._pluginEnabledObservables={},this._pluginOptionObservables={},this.isRefreshingContacts=new y.Z(!1),this.GCalendarsAvailable=new k.Z,this.GCalendarSyncErrors=new k.Z(void 0),this.GCalendarAddFailure=new y.Z(!1),this.GCalendarListFailure=new y.Z(!1),this.GCalendarListLoading=new y.Z(!1),this.GmailNumSyncd=new y.Z(0),this.GmailCacheSize=new y.Z(0),this.GmailSyncAccounts=new k.Z,this.isSaveEnabled=new y.Z(!1),this.hasRefreshed=!1,m.Z.forceBind("calendarComparator",this)}return s()(e,[{key:"init",value:function(){var e=g.default.pluginManager.getPluginGCalendar().getImportCalendarList();e&&this.GCalendarsAvailable.set(e)}},{key:"checkRefresh",value:function(){this.hasRefreshed||this.refreshPluginStatus()}},{key:"refreshPluginStatus",value:function(e){var t=0;this.hasRefreshed=!0;for(var n=0;n<this.pluginsAvailable.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.pluginsAvailable[n],i=void 0;i=r===h.Z.PluginID.Contacts?v.Z.isEnabled():g.default.pluginManager.isAuthorized(r),this.updatePluginStatus(r,i)}e&&e!==h.Z.PluginID.GCalendar||(this.updatePluginOptionStatus(h.Z.PluginID.GCalendar,h.Z.PluginSettingsID.GCalendar.ImportCalendars,!0),this.updatePluginOptionStatus(h.Z.PluginID.GCalendar,h.Z.PluginSettingsID.GCalendar.ExportCalendar))}},{key:"refresh",value:function(e){this.refreshPluginStatus(),e&&e!==h.Z.PluginID.GCalendar||(this.GCalendarAddFailure.set(!1),this.GCalendarListFailure.set(!1),this.updateCalendarList()),e&&e!==h.Z.PluginID.Gmail||this.updateGmailInfo()}},{key:"calendarComparator",value:function(e,t){return e.summary.localeCompare(t.summary)}},{key:"updateGmailInfo",value:function(){var e=g.default.pluginManager.getPluginGmail();this.GmailNumSyncd.set(e.getSyncdMessageCount()),this.GmailSyncAccounts.set(e.getSyncAccounts())}},{key:"updateCalendarList",value:function(){var e=this;if(g.default.pluginManager.isAuthorized(h.Z.PluginID.GCalendar)){var t=g.default.pluginManager.getPluginGCalendar();this.GCalendarListLoading.set(!0),t.getFullCalendarList((function(t){e.GCalendarListLoading.set(!1,!1),t?(t.sort(e.calendarComparator),e.GCalendarsAvailable.set(t),e.GCalendarListFailure.set(!1)):e.GCalendarListFailure.set(!0)}))}}},{key:"getEnabledPlugins",value:function(){this.checkRefresh();var e=this._pluginEnabledObservables;return Object.keys(e).filter((function(t){return e[t].get()}))}},{key:"getPluginEnabledObservable",value:function(e){return this.checkRefresh(),this._pluginEnabledObservables[e]}},{key:"isPluginEnabled",value:function(e){return this.checkRefresh(),this._pluginEnabledObservables[e].get()}},{key:"getPluginOptionObservable",value:function(e,t){return this.checkRefresh(),this._pluginOptionObservables[e][t]}},{key:"getPluginOptions",value:function(e){return this.checkRefresh(),this._pluginOptionObservables[e]}},{key:"isPluginAnOption",value:function(e){return e===h.Z.PluginID.Mailbird?f.Z.embed===h.Z.EmbedApps.Mailbird:this.pluginsAvailable.indexOf(e)>=0}},{key:"updatePluginStatus",value:function(e,t,n){this._pluginEnabledObservables[e]?this._pluginEnabledObservables[e].set(t,n):this._pluginEnabledObservables[e]=new y.Z(t)}},{key:"updatePluginOptionStatus",value:function(e,t,n){var r=g.default.pluginManager.getSetting(e,t);this._pluginOptionObservables[e]||(this._pluginOptionObservables[e]={}),this._pluginOptionObservables[e][t]?this._pluginOptionObservables[e][t].set(r||n&&[]):this._pluginOptionObservables[e][t]=n?new k.Z(r):new y.Z(r)}},{key:"onFailedAuthenticate",value:function(e){g.default.toasts.pushMessage({text:"We failed to successfully authenticate you for "+e+", please try again.",actionText:"OKAY"})}},{key:"_wasPluginAuthorized",value:function(e,t){var n;if(e===h.Z.PluginID.Contacts)t.indexOf(h.Z.GScope.Contacts)>=0&&(n=!0);else{var r=g.default.pluginManager.getPlugin(e),i=u.Z.getUserSync();i&&(n=r.verifyAuthorization(i.email))}try{p.Z.PAssert(100,n,"Should always be successful at authorizing plugins")}catch(a){p.Z.reportError(a)}return n}},{key:"_enablePlugin",value:function(e){var t=this,n=this.getPluginEnabledObservable(e),r=g.default.pluginManager.getPlugin(e);g.default.pluginManager.authorizePlugin(e,!0,(function(i){i?(n.set(!0),g.default.pluginManager.onPluginAuthorized(r,!0),t.refresh(e),p.Z.sendEvent(e,"PluginEnabled")):(t.onFailedAuthenticate(e),p.Z.sendEvent(e,"PluginEnableFailed"))}))}},{key:"enablePlugin",value:function(e){e!==h.Z.PluginID.Contacts&&this._enablePlugin(e)}},{key:"disablePlugin",value:function(e){var t=this.getPluginEnabledObservable(e);e===h.Z.PluginID.Contacts?(p.Z.sendEvent("Settings","DisableContacts"),v.Z.clearContacts(),t.set(!1)):g.default.pluginManager.deauthorizePlugin(e,(function(){t.set(!1),p.Z.sendEvent(e,"PluginDisabled")}))}},{key:"togglePlugin",value:function(e){!this._pluginEnabledObservables[e].get()?this.enablePlugin(e):this.disablePlugin(e)}},{key:"togglePluginOption",value:function(e,t){var n=this,r=this._pluginOptionObservables[e][t],i=!r.get();g.default.pluginManager.setSetting(e,t,i),i?g.default.pluginManager.authorizePlugin(e,!0,(function(a){a?(g.default.pluginManager.onAuthorizedSetting(e,t,i),r.set(!0),p.Z.sendEvent(e,"OptionEnabled_"+t)):(n.onFailedAuthenticate(t),g.default.pluginManager.setSetting(e,t,!i),p.Z.sendEvent(e,"OptionEnableFailed_"+t))})):(r.set(!1),p.Z.sendEvent(e,"OptionDisabled_"+t))}},{key:"setPluginOption",value:function(e,t,n,r,i){var a=this,o=this._pluginOptionObservables[e][t],s=o.get();g.default.pluginManager.setSetting(e,t,n),n&&r?g.default.pluginManager.authorizePlugin(e,!0,(function(r){r?(g.default.pluginManager.onAuthorizedSetting(e,t,n),o.set(n),p.Z.sendEvent(e,"OptionSet_"+t+"_"+n),i&&i(!0)):(a.onFailedAuthenticate(t),g.default.pluginManager.setSetting(e,t,s),p.Z.sendEvent(e,"OptionEnableFailed_"+t+"_"+n),i&&i(!1))})):(o.set(n),p.Z.sendEvent(e,"OptionSet_"+t+"_"+n),i&&i(!0))}},{key:"isNotificationsEnabled",value:function(){return g.default.billingManager.hasPremiumFeatures()&&!g.default.settings.disableNotifications.get()}},{key:"toggleNotifications",value:function(){var e=g.default.settings.disableNotifications.get();g.default.settings.disableNotifications.set(!e),e?g.default.timeline.updateNotifications():g.default.timeline.clearNotifications()}},{key:"onTapRefreshContacts",value:function(e,t){var n=this,r=!1;return this.isRefreshingContacts.get()||(this.isRefreshingContacts.set(!0),r=!0,v.Z.refreshContacts((function(){n.isRefreshingContacts.set(!1),t&&t()})),p.Z.sendEvent("Menu","RefreshContacts")),r}},{key:"addCalendar",value:function(e,t){var n=this,r=g.default.pluginManager.getPluginGCalendar();this.GCalendarListLoading.set(!0),r.createCalendar(e,t,(function(e){n.GCalendarListLoading.set(!1),e?n.updateCalendarList():n.GCalendarAddFailure.set(!0)}))}},{key:"notifySyncError",value:function(e){this.GCalendarSyncErrors.set(e||[])}},{key:"updatePluginsEnabled",value:function(){var e=this,t=p.Z.clone(g.default.settings.syncAccounts.get()||{});[h.Z.PluginID.Contacts].forEach((function(n){var r=Object.keys(t).some((function(e){return t[e][n]}));r!==e.isPluginEnabled(n)&&(r?(console.log("Enabling",n),e.enablePlugin(n)):(console.log("Disabling",n),e.disablePlugin(n)))}))}}]),e}(),l()(r.prototype,"onTapRefreshContacts",[d.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onTapRefreshContacts"),r.prototype),r)},9515:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a);const s=function(){function e(t){i()(this,e),this._limit=t,this._offset=0,this._buffer=[]}return o()(e,[{key:"get",value:function(e){return this._buffer[e]}},{key:"push",value:function(e){this._buffer[this._offset]=e,this._offset=(this._limit+this._offset+1)%this._limit}},{key:"peek",value:function(){var e=(this._limit+this._offset-1)%this._limit;return this._buffer[e]}},{key:"pop",value:function(){var e=(this._limit+this._offset-1)%this._limit,t=this._buffer[e];return t&&(this._buffer[e]=void 0,this._offset=e),t}},{key:"hasData",value:function(){return!!this.peek()}},{key:"reset",value:function(){this._offset=0,this._buffer=[]}},{key:"buffer",value:function(){return this._buffer}},{key:"limit",value:function(e){this._limit=e}},{key:"ordered",value:function(){return this._buffer.slice(this._offset).concat(this._buffer.slice(0,this._offset))}},{key:"entries",value:function(){for(var e=0,t=this.ordered(),n=0;n<t.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;console.log("---- Entry ["+n+"] ----"),console.log(t[n])}}}]),e}()},9689:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});var r=n(3038),i=n.n(r),a=n(4575),o=n.n(a),s=n(3913),c=n.n(s),l=n(4654),u=n(8855),d=n(8651),h=n(9603),p=/([^\+]+)\+(\d+)/,f=u.Z.MatchState;const g=new(function(){function e(){o()(this,e)}return c()(e,[{key:"checkItemTextSearchArr",value:function(e,t,n){for(var r=0,i=[],a=0;a<n.length;a++){var o=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var s=n[a],c=0;c<s.length;c++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l=s[c],u=l.text;try{d.Z.PAssert(915,u,"Each value in the search array should be valid at this point")}catch(p){d.Z.reportError(p)}if(!l.isNegated){var h=this.checkItemText(e,t,l);i[a]=h?f.Yes:f.No}if(i[a]===f.No)break}}return this.orMatchStates(i)}},{key:"getSearchArr",value:function(e){var t,n=0,r=0,a=e.toLowerCase().trim(),o=/(-*)["\u201c\u201d]([^"\u201c\u201d]*)["\u201c\u201d]|[^\s"\u201c\u201d]+/gi,s=[],c=0;do{if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;null!=(t=o.exec(a))&&s.push(t[2]?(t[1]?t[1]:"")+(t[2]?t[2]:""):t[0]),c++}while(null!=t&&c<1e3);for(var l=[],p=[],f=0,g=0;g<s.length;++g){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var m=s[g],v=m.length>1&&m.startsWith("-"),y=v?m.substr(1):m;if(y&&"and"!==y&&"$"!==y&&"-"!==y)if(g>0&&("or"===y||"|"===y||"||"===y))f++;else{l[f]||(l[f]=[]);var k={text:y,isNegated:v};if(y.startsWith(u.Z.SearchDates.Before)||y.startsWith(u.Z.SearchDates.After)||y.startsWith(u.Z.SearchDates.Date)||y.startsWith(u.Z.SearchDates.Between)){y.endsWith(":")&&(y+=s[++g]);var _=y.split(":"),Z=i()(_,2),w=Z[0],b=Z[1],P=void 0,S=void 0;if(b){if("date"!==w||"overdue"!==b&&"any"!==b&&"none"!==b)if("between"===w){var D=b.split(","),I=i()(D,2),E=I[0],x=I[1];E&&x&&(P=this.dateFromSearchText(E),S=this.dateFromSearchText(x))}else P=this.dateFromSearchText(b);else P=b;P&&(k.dateInfo={prefix:w,dateText:b,date:P,date2:S,dateCleared:P&&!d.Z.isString(P)&&h.Z.clearTime(P),dateCleared2:S&&h.Z.clearTime(S)})}}l[f].push(k),v||p.push(y)}}return{searchArr:l,searchWords:p}}},{key:"checkItemText",value:function(e,t,n,r){var i=!0,a=n.text;if(n.dateInfo)i=this._matchItemDate(e,n);else if(a.length>0){i=!1;var o=a===u.Z.SearchFilterTexts.Pri1,s=a===u.Z.SearchFilterTexts.Pri2,c=a===u.Z.SearchFilterTexts.Pri3;if(d.Z.isPrefixTask(a))i=e.isPrefixTask();else if(a===u.Z.SearchFilterTexts.Star)i=e.isStarred(r);else if(o||s||c){i=e.getPriority(r)===(o&&u.Z.VMLIFlag.P1||s&&u.Z.VMLIFlag.P2||c&&u.Z.VMLIFlag.P3)}else i=a===u.Z.Prefix.Bullet?e.isPrefixBullet():a===u.Z.Prefix.Header||a===u.Z.Prefix.Header2?e.isPrefixHeader():a===u.Z.InlinePrefix.ItemLink?e.hasItemLinks():i||(null===t||void 0===t?void 0:t.indexOf(a))>=0}return i}},{key:"dateFromSearchText",value:function(e){var t=e.match(p);return t?l.default.parseDate(t[1]).addDays(+t[2]):l.default.parseDate(e)}},{key:"_matchItemDate",value:function(e,t){var n=e.getNextDate(),r=t.dateInfo,i=r.prefix,a=r.date,o=r.date2,s=r.dateCleared;r.dateCleared2;if(n){var c=e.getMooDate();if("any"===a)return!0;if("none"===a)return!1;if("overdue"===a&&(a=h.Z.getToday(),i="before"),c.isRepeatDate()){if("before"===i)return c.getFirstDate()<a;if("date"===i)return c.isOnDate(a);if("after"===i)return!!c.getNext(a);if("between"===i)return!!c.getNext(a)&&c.getFirstDate()<o;0}return!a||"before"===i&&n<a||"date"===i&&+h.Z.clearTime(n)===+s||"after"===i&&n>=a||"between"===i&&n>=a&&n<=o}if("none"===a)return!0}},{key:"orMatchStates",value:function(e){for(var t,n=0,r=0;r<e.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(t===f.Unknown&&e[r]===f.Negated)t=f.Negated;else if(t!==f.Yes&&e[r]===f.No)t=f.No;else if(e[r]===f.Yes||e[r]===f.Unknown){t=f.Yes;break}}return t}}]),e}())},1831:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var r,i=n(8926),a=n.n(i),o=n(3038),s=n.n(o),c=n(4575),l=n.n(c),u=n(3913),d=n.n(u),h=n(3124),p=n.n(h),f=n(7757),g=n.n(f),m=n(8572),v=n(8651),y=n(4654),k=n(7274),_=["text","header","h1","h2","h3","h4","tag","app","pane","paneHeader","paneHeading","inlineCode","codeBlock","sidebar","star","bullet","note","date","dateSynced","highlight","format","itemLinkBracket","itemLink","tag","checkbox","vertLines","contact","caret","prefixHeader","numlist","collapser","link","board","blockHeader","border","sidebarButton","overviewItem","selection","popup","popupButton","popupDivider","priority","priority1","priority2","priority3","priorityComplete"],Z={app:{backgroundColor:"#FFFFFF"},pane:{backgroundColor:"#FFFFFF"},paneHeader:{backgroundColor:"#FFFFFF"},"paneHeader.selected":{borderColor:"#0099DD"},text:{color:"#444444"},header:{color:"#444444"},sidebar:{backgroundColor:"#222426"},codeBlock:{backgroundColor:"#E9EAEC"},inlineCode:{backgroundColor:"#E9EAEC"},star:{backgroundColor:"#FFFABB"},note:{color:"#999999"},date:{backgroundColor:"#FFEEEE",color:"#D33115"},dateSynced:{backgroundColor:"#FFC0C0"},highlight:{backgroundColor:"#A4D7FF"},format:{color:"#00000050"},itemLinkBracket:{color:"#00000030"},itemLink:{color:"#0099DD"},tag:{color:"#0099DD"},vertLines:{opacity:.06},contact:{color:"#22AA66"},caret:{backgroundColor:"#222222"},bullet:{backgroundColor:"#0000004A"},checkbox:{borderColor:"#0000004A"},prefixHeader:{color:"#0000004A"},numlist:{color:"#0000004A"},collapser:{color:"#0000004A"},link:{color:"#549BD8"},"blockHeader.collapsed":{color:"#444444"},border:{borderColor:"#E3E3E3"},sidebarButton:{color:"#999"},"sidebarButton:hover":{backgroundColor:"#525459",color:"#DFE0E0"},"board.selected":{backgroundColor:"#525459"},"overviewItem.selected":{backgroundColor:"#E5E7E9",color:"#444444"},"overviewItem:hover":{backgroundColor:"#E9EAEB"},selection:{backgroundColor:"#B2D8FD"},popup:{backgroundColor:"#FFFFFF",borderColor:"#DDDDDD",boxShadow:"0px 5px 5px -3px rgba(0,0,0,0.2),\n                    0px 4px 5px 1px rgba(0,0,0,0.07),\n                    0px 1px 7px 2px rgba(0,0,0,0.06)"},popupButton:{color:"#777777"},"popupButton:hover":{backgroundColor:"#ECEFF1",color:"#444444"},popupDivider:{backgroundColor:"#DDDDDD"},priority1:{backgroundColor:"#FF3300"},priority2:{backgroundColor:"#FFAA00"},priority3:{backgroundColor:"#FFDD33"},priorityComplete:{backgroundColor:"#DDDDDD"}},w={app:{backgroundColor:"#1D1D1E"},pane:{backgroundColor:"#1D1D1E"},paneHeader:{backgroundColor:"#1D1D1E",borderColor:"#2F2F2F"},"paneHeader.selected":{borderColor:"#0099DD"},text:{color:"#DFE0E0"},header:{color:"#DFE0E0"},sidebar:{backgroundColor:"#151516"},codeBlock:{backgroundColor:"#2E2F30"},inlineCode:{backgroundColor:"#2E2F30"},star:{backgroundColor:"#5E5B0E"},note:{color:"#999999"},date:{backgroundColor:"#4D1D1E"},dateSynced:{backgroundColor:"#6D3138"},highlight:{backgroundColor:"#0077BB"},format:{color:"#FFFFFF50"},itemLinkBracket:{color:"#FFFFFF20"},itemLink:{color:"#0099DD"},tag:{color:"#0099DD"},vertLines:{opacity:.05},contact:{color:"#22AA66"},caret:{backgroundColor:"#FFFFFF"},bullet:{backgroundColor:"#FFFFFF4A"},checkbox:{borderColor:"#FFFFFF4A"},prefixHeader:{color:"#FFFFFF4A"},numlist:{color:"#FFFFFF4A"},collapser:{color:"#FFFFFF4A"},link:{color:"#549BD8"},"blockHeader.collapsed":{color:"#DFE0E0"},border:{borderColor:"#2F2F2F"},sidebarButton:{color:"#999"},"sidebarButton:hover":{backgroundColor:"#525459",color:"#DFE0E0"},"board.selected":{backgroundColor:"#525459"},"overviewItem.selected":{backgroundColor:"#424449",color:"#DFE0E0"},"overviewItem:hover":{backgroundColor:"#424449"},selection:{backgroundColor:"#2D445D"},popup:{backgroundColor:"#2A2B2B",borderColor:"#363636",boxShadow:"0px 0 4px 1px rgba(0,0,0,0.1),\n                      0px 0 8px rgba(0,0,0,0.2),\n                      0px 3px 20px rgba(0,0,0,0.2)"},popupButton:{color:"#ccc"},"popupButton:hover":{backgroundColor:"#52545A",color:"#DFE0E0"},popupDivider:{backgroundColor:"#4A4A4A"},priority1:{backgroundColor:"#FF3300"},priority2:{backgroundColor:"#FFAA00"},priority3:{backgroundColor:"#FFDD33"},priorityComplete:{backgroundColor:"#333333"}},b={text:{fontSize:"15px",lineHeight:"1.5",fontWeight:400},paneHeading:{fontSize:"2.25em",lineHeight:"1.3"},header:{paddingTop:"1em"},h1:{fontSize:"1.8em",fontWeight:"bold"},h2:{fontSize:"1.5em",fontWeight:"bold"},h3:{fontSize:"1.25em",fontWeight:"bold"},h4:{fontWeight:"bold"},inlineCode:{fontSize:"0.875em",padding:"4px",borderRadius:"4px"},codeBlock:{fontSize:"0.875em",borderRadius:"4px"},star:{borderRadius:"4px"},note:{fontSize:"12px",lineHeight:"1.1",lineClamp:1},date:{fontSize:"0.8em",fontWeight:"bold",borderRadius:"4px",padding:"3px 6px",margin:"0 4px"},highlight:{borderRadius:"4px",padding:"1px 4px 3px 4px",margin:"0 2px"},tag:{fontWeight:"bold"},checkbox:{borderWidth:"1px",borderRadius:"4px"},caret:{width:"1px"},link:{textDecoration:"underline"},blockHeader:{fontSize:"1.8em",fontWeight:"bold",paddingTop:"1em"},popup:{borderWidth:"1px"},priority:{width:"5px"}},P={Light:{},Dark:{bullet:{backgroundColor:"#aaa"},checkbox:{borderColor:"#aaa",backgroundColor:"#474747"},prefixHeader:{color:"#aaa"},numlist:{color:"#aaa"}}},S=v.Z.assignDeep({},b,{text:{fontSize:"15px",lineHeight:"1.3",fontWeight:400},header:{paddingTop:"0.5em"},paneHeading:{fontSize:"2em",lineHeight:"1.25"},h1:{fontSize:"1.6em",fontWeight:"bold"},h2:{fontSize:"1.4em",fontWeight:"bold"},h3:{fontSize:"1.2em",fontWeight:"bold"}}),D={Light:Z,Dark:w},I={Comfortable:b,Compact:S},E={lineClamp:["webkit"]};const x=new(r=function(){function e(){l()(this,e),this.noteLineClamp=new k.Z}return d()(e,[{key:"init",value:function(){y.default.settings.ui.listen(this._updateCSS),y.default.DisplaySettings.systemColorTheme.listen(this._updateCSS),y.default.billingManager.onLoaded.onTrue(this._updateCSS)}},{key:"printRule",value:function(e,t,n){return t}},{key:"printKey",value:function(e){return e.replace(/([A-Z])/g,"-$1").toLowerCase()}},{key:"keyIn",value:function(e){return e.replace(/-([a-z])/g,(function(e,t){return t.toUpperCase()}))}},{key:"parseRGB",value:function(e){return e.replace(/rgba?\((\d*),\s?(\d*),\s?(\d*)(?:,\s?(\d*(?:\.\d*)?))?\)/,(function(e,t,n,r,i){return"#".concat(v.Z.rgbToHex(t,n,r,i&&Math.round(255*+i)).toUpperCase())}))}},{key:"addRules",value:function(e,t,n){var r=this;Object.entries(t).map((function(t){var i=s()(t,2),a=i[0],o=i[1];"inherit"!==a&&Object.entries(o).forEach((function(t){var i=s()(t,2),o=i[0],c=i[1];e[a]||(e[a]={});var l=r.printRule(o,c,n);void 0!==l&&""!==l&&(e[a][o]=l)}))}))}},{key:"printRules",value:function(e){var t=this;return Object.entries(e).map((function(e){var n=s()(e,2),r=n[0],i=n[1],a=r.split(/[:\.]/)[0];return"".concat(_.includes(a)?".t-":"").concat(r," { ").concat(Object.entries(i).map((function(e){var n=s()(e,2),r=n[0],i=n[1];return"".concat(t.printKey(r),": ").concat(i,";").concat(E[r]?E[r].map((function(e){return" -".concat(e,"-").concat(t.printKey(r),": ").concat(i,";")})).join(" "):"")})).join(" ")," }")})).join(" ")}},{key:"_updateCSS",value:function(){var e=a()(g().mark((function e(){var t,n,r,i,a,o,s,c,l,u=this;return g().wrap((function(e){for(var d=0;;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,y.default.billingManager.onLoaded.promiseOnValue(!0);case 2:t=y.default.settings.ui,n=this.getBaseThemeName(),r=D[n],i="PrefixesStrong"===t.displayPrefixes.get(),a="SpacingCompact"===t.displaySpacing.get(),o=a?I.Compact:I.Comfortable,s=this.getUserColorTheme(),c=this.getUserLayoutTheme(),l=y.default.billingManager.hasProFeatures(),this.createSheet((function(){var e,a,d={};if(i&&u.addRules(d,P[n]),l&&s){var h=D[s.inherit];u.addRules(d,h),u.addRules(d,s)}else u.addRules(d,r);if(l&&c){var p;a=!(null===(p=c.text)||void 0===p||!p.fontSize);var f=I[c.inherit];u.addRules(d,f,!0),u.addRules(d,c,!0)}else u.addRules(d,o,!0);a||(d.text.fontSize=t.fontSize.get()+"px");var g=+(null===(e=d.note)||void 0===e?void 0:e.lineClamp);return u.noteLineClamp.set(v.Z.isNumber(g)?g:1),u.printRules(d)}));case 12:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"createSheet",value:function(e){if(this.sheet){var t=this.sheet;t.parentNode.removeChild(t)}var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.id="Moo.do-theme",r.type="text/css",r.innerHTML=e(),this.sheet=r,n.appendChild(r)}},{key:"getBaseThemeName",value:function(){return v.Z.uppercaseFirst(y.default.DisplaySettings.getColorTheme())}},{key:"getUserColorTheme",value:function(){var e=y.default.settings.ui,t=this.getBaseThemeName();return e.colorThemes.getProperty(t)}},{key:"getUserLayoutTheme",value:function(){var e=y.default.settings.ui,t=e.selectedLayout.get();return t?e.layouts.getProperty(t):void 0}},{key:"fillInSelectors",value:function(e){_.forEach((function(t){e[t]?Object.keys(e[t]).forEach((function(n){var r=e[t][n];void 0!==r&&""!==r||delete e[t][n]})):e[t]={}}))}},{key:"getColorThemeOptions",value:function(){var e=v.Z.uppercaseFirst(y.default.DisplaySettings.getColorTheme()),t=v.Z.merge({inherit:e},D[e],this.getUserColorTheme());return this.fillInSelectors(t),t}},{key:"getLayoutThemeOptions",value:function(){var e=y.default.settings.ui.displaySpacing.get().replace("Spacing",""),t=v.Z.merge({inherit:e},I[e],this.getUserLayoutTheme());return this.fillInSelectors(t),t}},{key:"resetColorTheme",value:function(e){y.default.settings.ui.colorThemes.deleteProperty(e)}},{key:"resetLayoutTheme",value:function(e){y.default.settings.ui.layouts.deleteProperty(e)}},{key:"_applyThemeProps",value:function(e,t){var n={inherit:t.inherit};return Object.entries(t).forEach((function(t){var r=s()(t,2),i=r[0],a=r[1];if("inherit"!==i){var o=Object.entries(a),c=e[i];o.length>0?o.forEach((function(e){var t=s()(e,2),r=t[0],a=t[1],o=null===c||void 0===c?void 0:c[r];o!==a&&o!==+a&&(n[i]||(n[i]={}),n[i][r]=a)})):c&&Object.keys(c).length>0&&(n[i]||(n[i]={}),Object.keys(c).forEach((function(e){n[i][e]=""})))}})),n}},{key:"applyColorTheme",value:function(e,t){var n="Dark"===t.inherit?w:Z,r=this._applyThemeProps(n,t);y.default.settings.ui.colorThemes.setProperty(e,r)}},{key:"applyLayoutTheme",value:function(e,t){var n="Compact"===t.inherit?S:b,r=this._applyThemeProps(n,t);y.default.settings.ui.layouts.setProperty(e,r),y.default.settings.ui.selectedLayout.set(e)}}]),e}(),p()(r.prototype,"_updateCSS",[m.ZP],Object.getOwnPropertyDescriptor(r.prototype,"_updateCSS"),r.prototype),r)},6470:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(9966);const c=function(){function e(t){i()(this,e),this._listeners=[],this._enabled=!0,t&&this.listen(t)}return o()(e,[{key:"listen",value:function(e){var t=new s.Z(this,e);return this._addListener(t),t}},{key:"_addListener",value:function(e){this._listeners.push(e)}},{key:"_hasListener",value:function(e){return this._listeners.indexOf(e)>=0}},{key:"unlisten",value:function(e){var t=this._listeners.findIndex((function(t){return t.cb===e}));t>=0&&this._listeners.removeAt(t)}},{key:"unlistenListener",value:function(e){this._listeners.remove(e)}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1}},{key:"notify",value:function(){if(this._enabled)for(var e=0,t=0;t<this._listeners.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;arguments.length>0?this._listeners[t].cb(arguments.length<=0?void 0:arguments[0]):this._listeners[t].cb()}}}]),e}()},1392:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(8855),c=n(8651),l=n(4654),u=n(5193);const d=function(){function e(t,n){i()(this,e),this.text=t,this.props=n||{}}return o()(e,[{key:"getText",value:function(){return this.text}},{key:"setText",value:function(e,t){var n=this.props;if(n.link)if(e){s.Z.Regexp.MDLink.lastIndex=0;var r=s.Z.Regexp.MDLink.exec(e);r?(n.link.text=r[2],n.link.href=r[3],n.link.showImage=n.link.isImage&&"!"===r[1],this.text=this.getRawText(!0)):void 0===n.link.text?n.link.href=e:t?delete n.link:n.link.text=e}else delete n.link;this.text=e}},{key:"setPropsText",value:function(e,t){var n=t||this.props;return n.link&&n.link.text&&(n.link.text=e),n}},{key:"canWrap",value:function(){var e=this.props;return!(e.date||this.isImage()||e.plugin||e.hr||e.itemLink||e.link&&e.link.appLink)}},{key:"mergeProps",value:function(e){this.props=Object.assign({},this.props,e)}},{key:"isBold",value:function(){var e=this.props;return!!(e.bold||e.contact||e.date||e.tag)}},{key:"isEditable",value:function(){var e=this.props;return!(e.plugin||e.date||e.itemLink||this.isImage())}},{key:"isImage",value:function(){var e=this.props;return e.link&&e.link.showImage&&e.link.isImage||e.plugin&&"Drive"===e.plugin.p&&!!e.plugin.showInline&&"false"!==e.plugin.showInline}},{key:"isEditableAtStart",value:function(){return!this.props.link}},{key:"isEditableAtEnd",value:function(){return!this.props.link}},{key:"getRawText",value:function(e){var t=this.props,n=this.text;if(t.formatting&&!e)return"";if(t.link){var r=t.link.text,i=t.link,a=i.href,o=i.imageSize,c=i.showImage,u=o?" =".concat(o,"x"):"";if(o&&!r)return r=a,"![](".concat(a).concat(u,")");if(r)return(c?"!":"")+(r!==a||o?"[".concat(r,"](").concat(a).concat(u,")"):a)}if(t.itemLink&&n)return t.mirror?"((".concat(t.itemLink,"))"):"[[".concat(t.itemLink,"]]");if(n&&t.date)return s.Z.CharDate;if(n&&t.plugin){var d=l.default.pluginManager.getPlugin(t.plugin.p),h=d.getAttachment(t.plugin.id);return d.getAttachmentEmbedString(h)}return n}},{key:"getMarkdown",value:function(e){var t=this.props,n=this.getRawText(!0);if(n){if(t.plugin)n="[[".concat(n,"]]");else if(t.date){var r=null===e||void 0===e?void 0:e.getMooDate();n="!(".concat(r.toText(),")")}e.isStarred()&&(n="==".concat(n,"=="));var i=e.getPriority();if(i){var a=(i===s.Z.VMLIFlag.P1?1:i===s.Z.VMLIFlag.P2&&2)||i===s.Z.VMLIFlag.P3&&3;n+=" {priority:".concat(a,"}")}}return n}},{key:"getStyledText",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.props,i=r.plugin||r.date,a=n.forAutocomplete,o=n.showMarkdown,s=n.linkedItemDepth,d=n.escape,h=n.noPrefix;if(i){var p=l.default.pluginManager.getPlugin(i.p);if(p&&null!==i&&void 0!==i&&i.id){try{c.Z.PAssert(471,i.id,"If a plugin is specified, must have the ID for that plugin as well")}catch(_){c.Z.reportError(_)}var f=p.getAttachment(i.id);if(t=p.getDisplayText(f,e),this.props.date&&e.isRepeatDate()){var g=e.getMooDate().getRepeatFrequency();t+="\u27f3"+(g||"")}}else{try{c.Z.PAssert(472,!1,"Plugin ".concat(null===i||void 0===i?void 0:i.p," failed to load ").concat(i.id))}catch(_){c.Z.reportError(_)}t="Plugin ".concat(null===i||void 0===i?void 0:i.p," failed to load ").concat(i.id)}}else{var m=this.text;if(r.itemLink)if(s>1)m="";else{var v,y,k=u.Z.getItem(r.itemLink);if(k)y=k.getDisplayText({showMarkdown:!1,noPrefix:!0,linkedItemDepth:(s||0)+1})||"(Linked item has no text)";else;m="".concat(a?"  ":"[[").concat(null!==(v=y)&&void 0!==v?v:"(Deleted item)").concat(a?"  ":"]]")}else!r.prefixType||n&&h?n&&o||(r.formatting?m="":!d&&r.escaped?m=r.escaped:(r.link&&(m=r.link.text||r.link.href),"string"===typeof r.underline&&(m=r.underline),"string"===typeof r.bold&&(m=r.bold),"string"===typeof r.italic&&(m=r.italic),"string"===typeof r.strike&&(m=r.strike),"string"===typeof r.highlight&&(m=r.highlight),"string"===typeof r.code&&(m=r.code))):"numList"===r.prefixType&&(m=e.numListNumber()+". ");t=m}return t}},{key:"getFixedWidth",value:function(e){return this.props.prefixType?s.Z.PrefixWidth:this.props.hr?e.pane.maxWidthOfPaneObject(e):void 0}},{key:"getClassNames",value:function(e,t,n,r){var i=this.props,a="";if(i.prefixType&&(a+=" itemPrefix prefix"+i.prefixType.capitalize(),"task"===i.prefixType&&(a+=" icon-square-o")),i.link){a+=" mdSpan link t-link pressable"+(t?"":" cursor-pointer");var o=i.link.appLink;o&&(a+=" appLink inlineBordered inlineBorderedBG heightLineHeight "+o)}return i.itemLink&&(a+=" itemLink pressable"),i.email&&(a+=" email t-contact pressable"),i.contact&&(a+=" contact t-contact pressable"),i.tag&&this.text.length>1&&(a+=" tag t-tag pressable"),i.hr&&(a+=" mdHR flex-1 relative "+(i.hrHeavy?"heavy c-border-ultra-heavy":"c-border-heavy")),i.diffAdded&&(a+=" c-bg-green py-1"),i.diffRemoved&&(a+=" c-bg-red py-1"),e||(i.formatting&&(a+=" mdFormat t-format"),i.underline&&(a+=" mdUnderline"),i.bold&&(a+=" mdBold"),i.italic&&(a+=" mdItalic"),i.strike&&(a+=" mdStrike"),i.highlight&&(a+=" theme-inline t-highlight",i.formatting&&(null!==r&&void 0!==r&&r.props.highlight&&(a+=" mdFormatB"),null!==n&&void 0!==n&&n.props.highlight&&(a+=" mdFormatA"))),i.code&&(a+=" mdCode t-inlineCode")),a}},{key:"getStyle",value:function(){}},{key:"isPropFormat",value:function(e){return"bold"===e||"underline"===e||"italic"===e||"strike"===e||"formatting"===e||"code"===e||"highlight"===e}},{key:"hasFormat",value:function(){var e=this;return Object.keys(this.props).some((function(t){return e.isPropFormat(t)}))}},{key:"hasOnlyFormat",value:function(){var e=this;return this.hasFormat()&&!Object.keys(this.props).some((function(t){return!e.isPropFormat(t)}))}},{key:"getFormats",value:function(){var e=this.props;return{bold:e.bold,italic:e.italic,underline:e.underline,strike:e.strike,highlight:e.highlight,code:e.code}}},{key:"isFormatEqualTo",value:function(e){var t=this.props,n=e.props;return!t.bold===!n.bold&&!t.italic===!n.italic&&!t.underline===!n.underline&&!t.strike===!n.strike&&!t.code===!n.code&&!t.highlight===!n.highlight}},{key:"padSpaces",value:function(e,t,n){return(t?" ":"")+e+(n?"":" ")}},{key:"getHTML",value:function(e,t,n,r){var i=this.props,a=this.text;if(i.prefixType||i.formatting)return"";if(i.link)return i.link.isImage&&i.link.showImage?'<img src="'.concat(i.link.href,'"></img>'):'<a href="'.concat(i.link.href,'">').concat(i.link.text||i.link.href,"</a>");if(i.date&&e.getMooDate())return this.padSpaces(e.getMooDate().toText(),t,n);if(i.plugin){var o=l.default.pluginManager.getPlugin(i.plugin.p),s=o.getAttachment(i.plugin.id),c=o.getURLForAttachment(s),d=o.getAttachmentTitleString(s);return this.padSpaces('<a href="'.concat(c,'">').concat(d,"</a>"),t,n)}if(i.itemLink){var h=u.Z.getItem(i.itemLink);h&&!r&&(a=h.getStyledTextAsOneLine())}return"string"===typeof i.underline&&(a=i.underline),"string"===typeof i.bold&&(a=i.bold),"string"===typeof i.italic&&(a=i.italic),"string"===typeof i.strike&&(a=i.strike),"string"===typeof i.highlight&&(a=i.highlight),"string"===typeof i.code&&(a=i.code),i.escaped&&(a=i.escaped),i.bold&&(a="<b>".concat(a,"</b>")),i.italic&&(a="<i>".concat(a,"</i>")),i.underline&&(a="<u>".concat(a,"</u>")),i.strike&&(a="<s>".concat(a,"</s>")),i.highlight&&(a='<span class="t-highlight">'.concat(a,"</span>")),i.code&&(a='<span class="mdCode t-inlineCode">'.concat(a,"</span>")),a}},{key:"getPlaintext",value:function(e,t){var n=this.props,r=this.text;if(n.prefixType)return"";if(n.link)return n.link.text||n.link.href;if(n.itemLink)if(t>1)r="";else{var i=u.Z.getItem(n.itemLink);i&&(r=i.getPlaintext(void 0,(t||0)+1))}if(n.escaped)return n.escaped;if(n.date&&e.getMooDate())return e.getMooDate().toText();if(n.plugin){var a=l.default.pluginManager.getPlugin(n.plugin.p),o=a.getAttachment(n.plugin.id);return a.getAttachmentTitleString(o)}return r}},{key:"escapeTextIfEscaped",value:function(e,t){return this.props.escaped&&!t?c.Z.escapeItemText(e):e}},{key:"split",value:function(t,n){var r,i,a,o=null===(r=t.showMarkdown)||void 0===r?void 0:r.call(t),s=this.getStyledText(t.item,{showMarkdown:o});if(n>0){var l=this.escapeTextIfEscaped(s.slice(0,n),o);i=new e(l,this.setPropsText(l,c.Z.cloneDeep(this.props)))}if(n<s.length){var u=this.escapeTextIfEscaped(s.slice(n),o);a=new e(u,this.setPropsText(u,c.Z.cloneDeep(this.props)))}return[i,a]}},{key:"hasMobileExtraLength",value:function(){var e=this.props;if(e.plugin){var t=e.plugin.p;if(t===s.Z.PluginID.Gmail||t===s.Z.PluginID.Drive)return!0}return e.itemLink||e.link&&e.link.appLink}},{key:"getMobileRenderedText",value:function(e){return this.hasMobileExtraLength()?"".concat(s.Z.RNSpace).concat(s.Z.RNSpace).concat(s.Z.RNSpace).concat(e).concat(s.Z.RNSpace):e}},{key:"getMobileRenderedTextExtraLength",value:function(){return this.hasMobileExtraLength()?4:0}},{key:"clone",value:function(){return new e(this.text,c.Z.cloneDeep(this.props))}},{key:"spliceText",value:function(e,t,n){var r=this.props;if(r.link){var i=(r.link.text?"text":r.link.href&&"href")||!1;if(i)return r.link[i]=c.Z.spliceText(r.link[i],e,t,n),this.text="text"===i?this.getRawText(!0):r.link.href,this.text}return this.text=c.Z.spliceText(this.text,e,t,n),this.text}}]),e}()},3868:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var r=n(3038),i=n.n(r),a=n(4575),o=n.n(a),s=n(3913),c=n.n(s),l=n(8855),u=n(8651),d=n(1392);const h=function(){function e(t){o()(this,e),this.elements="string"===typeof t?[new d.Z(t)]:t}return c()(e,[{key:"insert",value:function(e,t,n,r){for(var i,a=0,o=t,s=0,c=0;c<this.elements.length;++c){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=this.elements[c],u=r?l.getStyledText(r.item,{showMarkdown:r.showMarkdown()}):l.getText();if(!l.props.code&&s<e+t&&e<s+u.length){var h=0,p=Math.max(e-s,0),f=Math.min(o,u.length),g=p+o,m=u.length-g;if(p>0){var v=u.substr(0,p);this.elements.splice(c,0,new d.Z(v,l.props)),h++}var y=u.substr(p,f);if((i=new d.Z(y,l.props)).mergeProps(n),this.elements.splice(c+h,1,i),h++,m>0){var k=u.substr(g,m);this.elements.splice(c+h,0,new d.Z(k,l.props));break}c+=h-1,o-=f}s+=u.length}return i}},{key:"insertEl",value:function(e,t,n){var r=this.split(t,n),a=i()(r,2),o=a[0],s=a[1];this.elements=o.elements.concat(e).concat(s?s.elements:[])}},{key:"getDisplayText",value:function(e,t){return this.elements.map((function(n){var r,i;return t.noPrefix&&n.props.prefixType||t.noDates&&n.props.date||t.noDataImages&&null!==(r=n.props.link)&&void 0!==r&&null!==(i=r.href)&&void 0!==i&&i.startsWith("data:image")?"":n.getStyledText(e,t)})).join("")}},{key:"getRawText",value:function(e){var t=!1,n=!1,r=!1,i=!1,a=!1,o=!1,s="";return e?this.elements.map((function(t){return t.getRawText(e)})).join(""):(this.elements.forEach((function(e){var c=e.props,u=e.getRawText();!c.formatting&&u&&(!!c.bold!==t&&(s+=l.Z.Markdown.bold),!!c.italic!==n&&(s+=l.Z.Markdown.italic),!!c.underline!==r&&(s+=l.Z.Markdown.underline),!!c.strike!==i&&(s+=l.Z.Markdown.strike),!!c.highlight!==a&&(s+=l.Z.Markdown.highlight),!!c.code!==o&&(s+=l.Z.Markdown.code),s+=u,t=!!c.bold,n=!!c.italic,r=!!c.underline,i=!!c.strike,a=!!c.highlight,o=!!c.code)})),t&&(s+=l.Z.Markdown.bold),n&&(s+=l.Z.Markdown.italic),r&&(s+=l.Z.Markdown.underline),i&&(s+=l.Z.Markdown.strike),a&&(s+=l.Z.Markdown.highlight),o&&(s+=l.Z.Markdown.code),s)}},{key:"getHTML",value:function(e,t,n){var r=this,i=this.elements.map((function(i,a){return i.props.prefixType&&!1===t?"":i.getHTML(e,a>0,a===r.elements.length-1,n)})).join("");return this.elements[0]&&"header"===this.elements[0].props.prefixType&&(i='<b style="font-size: 1.5em">'.concat(i,"</b>")),i}},{key:"getPlaintext",value:function(e,t,n){return this.elements.map((function(r){return r.props.prefixType&&!1===t?"":r.getPlaintext(e,n)})).join("")}},{key:"getMarkdown",value:function(e,t){return this.elements.map((function(n){return n.props.prefixType&&!1===t?"":n.getMarkdown(e)})).join("")}},{key:"displayRangeHasFormat",value:function(e,t,n,r){for(var i=0,a=0,o=0;a<r&&o<this.elements.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=this.elements[o],c=s.getStyledText(t.item,{showMarkdown:t.showMarkdown()});if(a<r&&n<a+c.length)if(!s.props[e])return!1;a+=c.length}return!0}},{key:"_elementInfoAtOffset",value:function(e,t,n){for(var r=0,i=0,a=0;i<=t&&a<this.elements.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=this.elements[a];if(!o.props.prefixType||"raw"===n){var s="raw"===n?o.getRawText(!0):o.getStyledText(e.item,{showMarkdown:e.showMarkdown()});if(i<=t&&(t<i+s.length||t===i+s.length&&a===this.elements.length-1))return{offset:i,text:s,length:s.length,el:o,index:a};i+=s.length}}try{u.Z.PAssert(474,0===t,"Did not find element at offset ".concat(t))}catch(c){u.Z.reportError(c)}return{}}},{key:"elementInfoAtOffset",value:function(e,t){return this._elementInfoAtOffset(e,t,"styled")}},{key:"elementAtOffset",value:function(e,t){var n;return null===(n=this._elementInfoAtOffset(e,t,"styled"))||void 0===n?void 0:n.el}},{key:"removeElement",value:function(e){return this.elements.remove(e),this}},{key:"removeElementAtOffset",value:function(e,t){var n=this.elementAtOffset(e,t);return this.elements.remove(n),this}},{key:"isElementAtOffsetEditable",value:function(e,t){var n=this.elementInfoAtOffset(e,t).el;return n&&n.isEditable()}},{key:"adjustOffsetAroundUneditables",value:function(e,t,n){var r=this.elementInfoAtOffset(e,t),i=r.el,a=r.offset,o=r.length;if(i&&!i.isEditable()){if(!n)return t-a<a+o-t?a:a+o;if(t!==a&&t!==a+o)return n>0?a+o:a}return t}},{key:"spliceText",value:function(e,t,n,r){var i,a=this.split(r,t);n>0?i=this.split(r,t+n)[1]:i=a[1];var o=i?i.getRawText(r.showMarkdown()):"";return(a[0]?a[0].getRawText(r.showMarkdown()):"")+e+o}},{key:"split",value:function(t,n){for(var r=0,a=0,o=0;a<=n&&o<this.elements.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=this.elements[o],c=s.getStyledText(t.item,{showMarkdown:t.showMarkdown()});if(a<=n&&n<a+c.length){var l=n-a,u=s.split(t,l),d=i()(u,2),h=d[0],p=d[1];return[new e(this.elements.slice(0,o).concat(h||[])),new e((p?[p]:[]).concat(this.elements.slice(o+1)))]}a+=c.length}return[this]}},{key:"combineWith",value:function(t,n){var r=t.elements;return n&&(r=r.filter(n)),new e(this.elements.concat(r)).getRawText()}},{key:"findElement",value:function(e,t){for(var n=0,r=0,i=0;i<this.elements.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this.elements[i];if(!a.props.prefixType){var o=a.getStyledText(e.item,{showMarkdown:e.showMarkdown()});if(t(a))return{offset:r,text:o,length:o.length,el:a};r+=o.length}}}},{key:"numFormattingCharsBeforeOffset",value:function(e,t){for(var n=0,r=0,i=0,a=0;r<=t&&a<this.elements.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=this.elements[a],s=o.getStyledText(e.item);o.props.formatting&&(i+=o.getText().length),r+=s.length}return i}},{key:"withoutPrefix",value:function(){return this.elements[0].props.prefixType?new e(this.elements.slice(1)):this}},{key:"clone",value:function(){return new e(this.elements.map((function(e){return e.clone()})))}}]),e}()},9320:(e,t,n)=>{"use strict";n.d(t,{Z:()=>oe});var r=n(9713),i=n.n(r),a=n(8926),o=n.n(a),s=n(4575),c=n.n(s),l=n(3913),u=n.n(l),d=n(3124),h=n.n(d),p=n(7757),f=n.n(p),g=n(8572),m=n(8855),v=n(8651),y=n(2935),k=n(8532),_=n(7100),Z=n(4472),w=n(4654),b=n(8133),P=n(1015),S=n(5252),D=n(2205),I=n.n(D),E=n(8585),x=n.n(E),C=n(9754),A=n.n(C),L=n(4764),M=n(8778),T=n(9145),R=n(5216),O=n(7237),F=n(3205),N=n(5215);function B(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=A()(e);if(t){var i=A()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return x()(this,n)}}var U=n(5193),j=n(4327),H=n(9607),V=n(7274),W=n(9148),z=n(8001);const q=function(){function e(t,n,r){c()(this,e),this.pane=t,this.isVisible=new V.Z(n),this.dragHoverItem=void 0}return u()(e,[{key:"destroy",value:function(){this.pane=void 0}},{key:"setVisibility",value:function(e){e&&Z.Z.reset(),e!==this.isVisible.get()&&(this.isVisible.set(e),j.Z.fireEvent("panesChanged",[]),w.default.PaneManager.updatePaneStateForPane(this.pane))}},{key:"toggle",value:function(){this.isVisible.get()?this.setVisibility(!1):this.setVisibility(!0),w.default.onIntroAction("Overview")}},{key:"updateDragHoverItem",value:function(e){var t=this.dragHoverItem;this.dragHoverItem=e,v.Z.batchRenderUpdates((function(){t&&t.itemChanged.notify(),e&&t!==e&&e.itemChanged.notify()}))}},{key:"isItemDragHovered",value:function(e){return e===this.dragHoverItem}},{key:"getMinItemSize",value:function(){return w.default.DisplaySettings.itemLineHeight()+2*w.default.DisplaySettings.itemPadding()}}]),e}();var G,K=n(3656),Y=n(6470),X=n(9603),Q=n(9689),J=m.Z.MatchState;const $=(G=function(){function e(t,n,r){var i=0;c()(this,e),this.callback=r,this.pane=t,this.searchArr=[],this.matches={},this.previousSearch="",this._stickyMatches={},this._stickyMatchesAwaitingClear=[],this.itemStoreFilter=void 0,this.UI=void 0,this.isFocused=new V.Z,this._destroyed=!1;var a={priority:{name:"priority",matchFn:this._matchFnPriority},starred:{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred items",matchFnBoolean:this._matchFnStarred},project:{name:"project",initialValue:1,icon:"icon-project",tooltip:"projects",matchFnBoolean:this._matchFnProject},task:{name:"task",initialValue:1,icon:"prefixTask",tooltip:"tasks",matchFnBoolean:this._matchFnTask},complete:{name:"complete",text:"Completed Items",initialValue:-1,defaultValue:-1,icon:"icon-check",tooltip:"completed items",matchFn:this._matchFnComplete},showOnlyMatches:{name:"showOnlyMatches",initialValue:1,icon:"icon-reorder",tooltip:"Flat mode: Show only matching items",canBeNegated:!1,isOption:!0,hideInView:!0},showOnlyAgendaDates:{name:"showOnlyAgendaDates",initialValue:1,icon:"icon-at",tooltip:"Show only dates on the Agenda",canBeNegated:!1,isOption:!0,hideInView:!0},showOnlyMatchingTags:{name:"showOnlyMatchingTags",initialValue:1,icon:"icon-short_text",tooltip:"Show only matching tag blocks",canBeNegated:!1,isOption:!0},showChildProjects:{name:"showChildProjects",initialValue:1,icon:"icon-project_half",tooltip:"Show all projects from anywhere in the hierarchy",canBeNegated:!1,isOption:!0}};if(n){!1===n.showHierarchy&&(n.showOnlyMatches=1);var o=n.completeOption;!isNaN(o)&&isNaN(n.complete)&&(n.complete=o<0?1:o-1),0===n.showOnlyTopLevelProjects&&(n.showChildProjects=1)}for(var s=[],l=0;l<t.searchFilters.length;l++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var u=t.searchFilters[l];v.Z.isString(u)?s.push(a[u]):s.push(u)}if(this.setupFilters(s,n),this.value=n&&n.text||"",this.onChanged=new Y.Z(r),this._updateSearchArr(),this.value){var d=R.Z.parseTextNew(void 0,this.value,K.Z.getContacts(),!0);d&&this.onParsed(d)}j.Z.listen("beforeDateChanged",this._updateSearchArr)}return u()(e,[{key:"destroy",value:function(){this._destroyed=!0,this.onChanged.unlisten(this.callback),j.Z.unlisten("beforeDateChanged",this._updateSearchArr),this.pane=void 0,this.UI=void 0}},{key:"setFilterTooltip",value:function(e,t){this.getFilter(e).tooltip=t}},{key:"getFilterTooltip",value:function(e){var t=e.value.get();return t?e.isOption?"<b>Click</b> to clear this option":(t>0?"Showing only":"Hiding")+" "+e.tooltip+".\n<b>Click</b> to clear this "+(e.isOption?"option":"filter."):e.isOption?e.tooltip:"<b>Click</b> to "+(e.initialValue>0?"show only ":"hide ")+e.tooltip+(t!==-e.initialValue?".\n<b>"+_.Z.priModKey+" + click</b> to "+(e.initialValue<0?"show only ":"hide ")+e.tooltip+".":"")}},{key:"setupFilters",value:function(e,t){for(var n=0,r=[],i=0;i<e.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=e[i],o=a.name,s=t?t[o]:void 0,c=a;c.value=new V.Z(isNaN(s)?a.defaultValue||0:s),c.enabled=new V.Z(void 0===a.enabled||a.enabled);try{v.Z.PAssert(1346,!this.hasOwnProperty("filter_"+o),"Should not double define filter properties")}catch(l){v.Z.reportError(l)}this["filter_"+o]=c,r.push(c)}this.filters=r}},{key:"setFilterEnabled",value:function(e,t){var n=this.filters.indexOfWithProperty("name",e);n>=0&&this.filters[n].enabled.set(t)}},{key:"getValue",value:function(){return this.value}},{key:"isFiltered",value:function(){for(var e=0,t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(this.filters[t].value.get())return!0}return!1}},{key:"isFilteredOn",value:function(e){return 0!==this.getFilterValue(e)}},{key:"getRemoteValue",value:function(){for(var e=0,t=this.value,n=0;n<this.filters.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this.filters[n];if(r.remoteStringFn&&r.enabled.get()){var i=r.remoteStringFn(r.value.get());i&&(t+=" "+i)}}return t.trim()}},{key:"getState",value:function(){for(var e=0,t={text:this.getValue(),showHierarchy:this.showHierarchy()},n=0;n<this.filters.length;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this.filters[n];t[r.name]=r.value.get()}return t}},{key:"focus",value:function(){this.UI.focus()}},{key:"blur",value:function(){this.UI.blur()}},{key:"onParsed",value:function(e){this.tags=e.tags,this.contacts=e.contacts}},{key:"setValue",value:function(e,t){this.updatingValue=this.value!==e,this.updatingValue&&this.pane.clearPerPaneStateSearch(),this.updateHistory(t),this.value=e,this._updateSearchArr(),this.pane.scrollToStartOnSearch&&this.pane.scrollToIndex(0,"start"),this.totalNumItems>5e3?v.Z.timeoutOnce("searchDebounce",this.update,150,!0):this.update(!0),e&&w.default.onIntroAction("Search"),this.updatingValue=!1}},{key:"addToValue",value:function(e){var t=this,n=this.getSelectionOffset(),r=this.value;r.length>0&&"-"!==r[r.length-1]&&"!"!==r[r.length-1]&&(e=" "+e),r+=e,this.setValue(r),Z.Z.isKeyboardOpen&&requestAnimationFrame((function(){t.setSelectionOffset(n+e.length)}))}},{key:"toggleText",value:function(e,t){var n=this.value.trim(),r="\\B(-*)("+v.Z.escapeRegExp(e.toLowerCase())+")\\b",i=n.toLowerCase().match(r);i?n=(n.substr(0,i.index)+n.substr(i.index+i[0].length)).replace(/  +/g," "):n+=" "+(t?"-":"")+e,n=n.trim(),this.setValue(n)}},{key:"getSelectionOffset",value:function(){return this.UI.getSelectionOffset()}},{key:"setSelectionOffset",value:function(e){this.UI.setSelectionOffset(e)}},{key:"getSearchBox",value:function(){return this.UI.refSearchBox}},{key:"isSearched",value:function(){var e=0;if(this.value.length>0)return!0;for(var t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this.filters[t];if(n.enabled.get()&&n.value.get())return!0}}},{key:"reset",value:function(){this.setValue("")}},{key:"resetFilters",value:function(){for(var e=0,t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this.filters[t];n.isOption||n.value.set(n.defaultValue)}this.update(!0,!0)}},{key:"numUnmatchedItems",value:function(){var e=this,t=0,n={item:this.pane.getItem(),pane:this.pane,each:function(n){var r=n.id,i=e.matches[r];i!==J.No&&i!==J.Negated||t++}};return v.Z.searchVMLIs(n),t}},{key:"isMatchStateMatch",value:function(e){return void 0===e||e===J.Yes||e===J.ChildYes||e===J.Unknown}},{key:"isMatchedHeader",value:function(e){return this.isMatched(e,{isHeaderSearch:!0})}},{key:"isMatchedSimple",value:function(e){return this.isMatchStateMatch(this.matches[e])}},{key:"isMatched",value:function(e,t){if(e.isRoot)return!0;if(this.pane.supportLocalSearch){var n=this.matches[e.id];return(null!==t&&void 0!==t&&t.forceCheck||(null===t||void 0===t||!t.noCheck)&&void 0===n&&e.hasText()&&!this.pane.isSettingTextFromInput&&(null!==t&&void 0!==t&&t.isHeaderSearch||this.pane!==v.Z.focusedPane))&&(n=this.checkItem(e)),null!==t&&void 0!==t&&t.isYes?n===J.Yes:this.isMatchStateMatch(n)}return!0}},{key:"handleItemChanged",value:function(e){if(w.default.PaneManager.isPaneActive(this.pane.id)){var t,n=this.isMatched(e,{noCheck:!0});if(e.parent()?(this.checkItem(e),t=this.isMatched(e)):t=!1,!t&&n&&(this.isMatchStuck(e)||this.stickMatchAfterSearch(e,!0)),t!=n)return!0}}},{key:"handleItemTextChanged",value:function(e){if(this.getValue()||this.isFiltered())return this.handleItemChanged(e)}},{key:"_updateSearchArr",value:function(){var e=Q.Z.getSearchArr(this.value),t=e.searchArr,n=e.searchWords;this.searchArr=t,this.searchWords=n}},{key:"toggleFilterDefault",value:function(e){var t=this["filter_"+e],n=t.value.get();n=n?0:t.initialValue,this.setFilter(e,n)}},{key:"toggleFilter",value:function(e,t){var n=t?-1:1,r=this["filter_"+e].value.get();r=r===n?0:n,this.setFilter(e,r)}},{key:"getFilter",value:function(e){return this["filter_"+e]}},{key:"getFilterObs",value:function(e){var t=this["filter_"+e];return t?t.value:void 0}},{key:"getFilterValue",value:function(e){var t=this["filter_"+e];return t?t.value.get():void 0}},{key:"setFilter",value:function(e,t,n){this.updateHistory(),"showOnlyMatches"===e&&this.clearListCache(),this["filter_"+e].value.set(t,n),this.pane.isViewDates()||this.pane.resetScroll(),this.update(!0,!0),w.default.onIntroAction("Search")}},{key:"update",value:function(e,t,n){var r=this;this.isRunningSearch=!0,w.default.PaneUpdateBatcher.beginUpdateItems(),(e||t)&&this.clearStickyMatches(),this.pane.supportLocalSearch&&(this.prevMatches=this.matches,this.matches={},this.isAnimatingSearch=n&&!e&&v.Z.focusedPane===this.pane,this.checkChildren(),this.prevMatches={}),this.isUpdatingSearch=!0,this.pane.isLoaded&&e&&this.onChanged.notify(t),w.default.PaneUpdateBatcher.commitUpdateItems(),setTimeout((function(){r.isUpdatingSearch=!1}),0),this.isRunningSearch=!1}},{key:"clearStickyMatches",value:function(){this._stickyMatchesAwaitingClear=[],this._stickyMatches={},clearTimeout(this._timeoutHideNonMatches)}},{key:"_isMatchStateOk",value:function(e){return e===J.Yes||e===J.Unknown||e===J.ChildYes}},{key:"_matchFilter",value:function(e,t){if(e)return t?e>0?J.Unknown:J.Negated:e>0?J.No:J.Unknown}},{key:"_matchFilters",value:function(e){for(var t=0,n=J.Unknown,r=0;r<this.filters.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.filters[r];if((i.matchFn||i.matchFnBoolean)&&i.enabled.get()){var a=i.value.get();if(0!==a){var o=i.matchFnBoolean?this._matchFilter(a,i.matchFnBoolean(e)):i.matchFn(a,e);o===J.Unknown||o!==J.Negated&&!this._isMatchStateOk(n)||(n=o)}}}return n===J.Yes&&(n=J.Unknown),n}},{key:"_matchFnComplete",value:function(e,t){return"Completed"===this.pane.getSortModeBlocks()&&(e=1),this._matchFilter(e,t.isComplete())}},{key:"_matchFnStarred",value:function(e){return e.isStarred()}},{key:"_matchFnProject",value:function(e){return e.isPrefixHeader()}},{key:"_matchFnTask",value:function(e){return e.isPrefixTask()}},{key:"_matchFnPriority",value:function(e,t){var n=t.getPriority();return e>0?n>=e?J.Yes:J.No:J.Unknown}},{key:"_matchFnEmail",value:function(e,t,n){var r=t.getAttachments(),i=r&&r[0],a=i&&i.getPlugin()===w.default.pluginManager.getPluginGmail();return this._matchFilter(e,a)}},{key:"isDateInRange",value:function(e){for(var t=0,n=!0,r=0;r<this.searchArr.length;r++){var i=0;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;for(var a=this.searchArr[r],o=void 0,s=0;s<a.length;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var c=a[s],l=c.dateInfo,u=c.isNegated;if(l){var d=l.prefix,h=l.date,p=l.date2;"overdue"===h&&(d="before",h=X.Z.getToday()),"any"===h?o=!0:"none"===h?o=!1:"before"===d?o=e<h:"date"===d?o=X.Z.isSameDay(e,h):"after"===d?o=e>=h:"between"===d&&(o=e>=h&&e<=p),u&&(o=!o),o||(n=!1)}}if(o)return!0}return n}},{key:"checkItem",value:function(e,t){var n,r,i=this,a=t?t.root:this.pane.getRootItem(),o=t?t.showHierarchy:this.showHierarchy(),s=this.matches,c=e.isNote(),l=e.parent();if(e.isDestroyed())return n=J.No;try{v.Z.PAssert(1347,l||e.isRootItem(),"Item parent does not exist while being searched",e===a)}catch(y){v.Z.reportError(y)}var u,d=e.getMirroredItem();if(d)n=null!==(u=this.matches[d.id])&&void 0!==u?u:this.checkItem(d,t);else if(this._stickyMatches[e.id])n=this._stickyMatches[e.id].matchState;else if(e.isRootItem())n=J.Yes;else if(l)if(s[l.id]===J.Negated)n=J.Negated;else{var h=e.getSearchText(this.pane),p=(n=this._matchFilters(e))===J.Negated;if(this.isMatchStateMatch(n)&&this.searchArr.length){var f=this._checkMatchTextImpl((function(t){return Q.Z.checkItemText(e,h,t,i.pane)}),o,e,a);if(p=f.hasNegated,(n=f.matchState)===J.Yes&&this.updatingValue&&this.getValue()){var g=0;for(r=l;r;){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;this.pane.isCollapsedByID(r.id,r,!1)&&this.pane.setPerPaneState(r.id,m.Z.PerPaneStateField.CollapsedSearch,!1),r=r.parent()}}}if(n===J.Unknown&&(n=J.Yes),!p&&this.pane.shouldSearchMatchParents&&l!==a&&o&&(s[l.id]===J.Yes||this._stickyMatches[l.id]))return this._setMatchState(e.id,e.isNote(),J.Yes),s[e.id];n===J.No&&c&&(n=s[l.id])}else n=J.No;return this.isMatchStateMatch(n)&&this.onlyMatchDates&&!this.pane.isOkOnAgenda(e)&&(n=J.No),n===J.Yes&&(o&&this._propagateMatchStateToParents(l,{}),c&&this._setMatchState(l.id,l.isNote(),J.Yes)),this._setMatchState(e.id,e.isNote(),n),s[e.id]}},{key:"_propagateMatchStateToParents",value:function(e,t){for(var n=0,r=this,i=e;i&&!i.isRootItem()&&this.matches[i.id]!==J.Negated&&this.matches[i.id]!==J.Yes&&!t[i.id];){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t[i.id]=!0,this._setMatchState(i.id,i.isNote(),J.ChildYes),i.itemsLinkedTo.forEach((function(e){r._setMatchState(e.id,e.isNote(),J.ChildYes),r._propagateMatchStateToParents(e.parent(),t)})),i.hasNote()&&this._setMatchState(i.getNote().id,!0,J.Yes),i=i.parent()}}},{key:"_checkMatchTextImpl",value:function(e,t,n,r){var i;var a=[],o=0;if(this.searchArr.length){for(var s=0,c=0;c<this.searchArr.length;c++){var l=0;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;for(var u=this.searchArr[c],d=0;d<u.length;d++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var h=u[d];if(h.isNegated){var p=h;try{v.Z.PAssert(1348,p,"Each value in the search array should be valid at this point")}catch(P){v.Z.reportError(P)}if(e(h)){a[c]=J.Negated,o++;break}}}}if(o===this.searchArr.length&&(i=J.Negated),this.isMatchStateMatch(i)){for(var f=0,g=0;g<this.searchArr.length;g++){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;if(a[g]!==J.Negated)for(var m=0,y=this.searchArr[g],k=0;k<y.length;k++){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;var _=y[k],Z=_.text;try{v.Z.PAssert(1349,Z,"Each value in the search array should be valid at this point")}catch(P){v.Z.reportError(P)}if(!_.isNegated)if(e(_))a[g]=J.Yes;else if(t)for(var w=0,b=n;b;){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;if(!(b=b.parent())||b===r){a[g]=J.No;break}if(Q.Z.checkItemText(b,b.getSearchText(),_,this.pane))break}else a[g]=J.No;if(a[g]===J.No)break}}i=Q.Z.orMatchStates(a)}}return{hasNegated:o>0,matchState:i}}},{key:"checkItemSimple",value:function(e,t){var n=this,r=this._matchFilters(e);if(this.isMatchStateMatch(r)){var i=t.filter((function(e){return!!e})).map((function(e){return n._checkMatchTextImpl((function(t){return null===e||void 0===e?void 0:e.includes(t.text)})).matchState}));r=Q.Z.orMatchStates(i)}this._setMatchState(e.id,!1,r)}},{key:"checkChildrenParams",value:function(e,t){var n=this.checkItem(e,t)!==J.Negated;return this.totalNumItems++,e.isNote()||this.totalNumItemsWithoutNotes++,n}},{key:"checkChildren",value:function(){var e=this;if(this.pane.usesVMLIs){this.totalNumItems=0,this.totalNumItemsWithoutNotes=0,this.numMatches=0,this.numUnmatches=0;var t={item:void 0,includeNotes:!0,followMirrors:!0,comparator:this.checkChildrenParams,comparatorOptions:{root:this.pane.getRootItem(),showHierarchy:this.showHierarchy()}};this.itemStoreFilter&&(t.itemStoreFilter=this.itemStoreFilter),this.pane.getItemStore()!==w.default.itemStoreManager.getDefaultItemStore()?t.itemStore=this.pane.getItemStore():t.item=this.pane.getItem(),v.Z.searchVMLIs(t),this.isAnimatingSearch&&Object.keys(this.matches).forEach((function(t){var n=e.prevMatches[t];if(void 0!==n&&e.isMatchStateMatch(n)&&!e.isMatchStateMatch(e.matches[t])){var r=U.Z.getItem(t);r&&!e.isMatchStuck(r)&&e.stickMatchAfterSearch(r,n)}}))}else this.pane.checkChildren()}},{key:"_getMatchedItem",value:function(e){return this._stickyMatches[e.id]||e}},{key:"getItemDate",value:function(e){var t=this._stickyMatches[e.id];return t&&t.date}},{key:"getItemDuration",value:function(e){var t=this._stickyMatches[e.id];return t&&t.duration}},{key:"getItemTagsLower",value:function(e){var t=this._stickyMatches[e.id];return t&&t.tagsLower}},{key:"getItemContacts",value:function(e){var t=this._stickyMatches[e.id];return t&&t.contacts}},{key:"getItemSearchText",value:function(e){var t=this._stickyMatches[e.id];return t&&t.searchText}},{key:"getItemPrefix",value:function(e){var t=this._stickyMatches[e.id];return t&&t.prefix}},{key:"getItemPriority",value:function(e){var t=this._stickyMatches[e.id];return t&&t.priority}},{key:"getItemStarred",value:function(e){var t=this._stickyMatches[e.id];return t&&t.isStarred}},{key:"stickMatch",value:function(e,t){if(!this._stickyMatches[e.id]){var n=e.getStickySearchInfo();n.matchState=this.matches[e.id],t&&(n.isHiding=!0),v.Z.isInCompleteAction()&&(n.wasCompleted=!0),this._setMatchState(e.id,e.isNote(),J.ChildYes),this._stickyMatches[e.id]=n,e.itemChanged.notify()}}},{key:"isMatchStuck",value:function(e){return!!this._stickyMatches[e.id]}},{key:"unstickMatch",value:function(e){var t=this._stickyMatches[e.id];if(t){var n=e.getStickySearchInfo();return delete this._stickyMatches[e.id],!v.Z.deepEqual(t,n)}return!1}},{key:"unstickAllMatches",value:function(){this._stickyMatches={}}},{key:"isMatchStuckHiding",value:function(e){var t=this._stickyMatches[e.id];return t&&t.isHiding}},{key:"stickMatchAfterSearch",value:function(e,t){this.stickMatch(e,!0),t&&(this._timeoutHideNonMatches&&clearTimeout(this._timeoutHideNonMatches),this._stickyMatchesAwaitingClear.push(e),this._timeoutHideNonMatches=setTimeout(this.hideNonMatches,1500))}},{key:"hideNonMatches",value:function(){var e=this;if(!this._destroyed){var t=this.pane,n=this._stickyMatchesAwaitingClear,r=n.length,i=0;if(r>0){for(var a=0,o=0;o<r;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=n[o],c=this._stickyMatches[s.id];c&&c.wasCompleted&&i++,this.unstickMatch(s)}var l=r+(r>1?" items":" item"),u={hold:!1};this.pane===v.Z.focusedPane&&(i!==r?(u.text=l+" hidden because "+(r>1?"they do":"it does")+" not match search",u.actionText="UNHIDE",u.action=function(){if(t&&t.setIgnoreRestoreScroll){var i=0,a=Z.Z.save();t.setIgnoreRestoreScroll();for(var o=0;o<r;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=n[o];e.stickMatch(s),e._stickyMatchesAwaitingClear.push(s)}e.pane.updateItemsImmediate(!0,void 0,void 0,!0),Z.Z.restore(a)}}):(u.text=l+" completed",u.actionText="UNDO",u.action=function(){var i=0,a=Z.Z.save();t.setIgnoreRestoreScroll();for(var o=0;o<r;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;n[o].setComplete(!1,m.Z.ChangeType.Local)}e.pane.updateItemsImmediate(!0,void 0,void 0,!0),Z.Z.restore(a)}),w.default.toasts.pushMessage(u));var d=Z.Z.save();this._stickyMatchesAwaitingClear=[],t.setIgnoreRestoreScroll(),t.updateItemsImmediate(!0,void 0,void 0,!0),d&&d.pane===this.pane&&Z.Z.restore(d)}}}},{key:"showHierarchy",value:function(){return this.pane.type!==m.Z.PaneMode.Task||1!==this.getFilterValue("showOnlyMatches")}},{key:"setShowHierarchy",value:function(e){this.setFilter("showOnlyMatches",e?0:1)}},{key:"showOnlyAgendaDates",value:function(){return this.pane.type===m.Z.PaneMode.Task&&this.getFilterValue("showOnlyAgendaDates")}},{key:"showOnlyMatchingTags",value:function(){return this.pane.type===m.Z.PaneMode.Task&&this.getFilterValue("showOnlyMatchingTags")}},{key:"showChildProjects",value:function(){return this.pane.type===m.Z.PaneMode.Task&&this.getFilterValue("showChildProjects")}},{key:"clearListCache",value:function(){this.pane.listManager.clearCache()}},{key:"getTags",value:function(){return this.tags}},{key:"getContacts",value:function(){return this.contacts}},{key:"getSearchWords",value:function(){return this.searchWords}},{key:"shouldHighlightSearch",value:function(){return this.isFocused.get()&&this.getValue()}},{key:"isSearchingDate",value:function(){return this.searchArr.some((function(e){return e.some((function(e){return!!e.dateInfo}))}))}},{key:"onRemoteUpdate",value:function(e,t){var n=!1;this.filters.forEach((function(t){e[t.name]!==t.value.get()&&(n=!0,t.value.set(e[t.name]))})),e.text!==this.getValue()&&(this.setValue(e.text,t),n=!1),n&&this.update(!0,!0)}},{key:"updateHistory",value:function(e){var t=this;e?v.Z.clearTimeoutOnce("searchDebounceHistory"):(this._previousStateForHistory||(this._previousStateForHistory=this.getState()),v.Z.timeoutOnce("searchDebounceHistory",(function(){var e;null===(e=t.pane)||void 0===e||e.pushHistory({search:t._previousStateForHistory}),t._previousStateForHistory=void 0}),1e3))}},{key:"updateAutocomplete",value:function(){this.UI.updateAutocomplete()}},{key:"_setMatchState",value:function(e,t,n){var r=this.matches[e],i=void 0!==r&&this.isMatchStateMatch(r),a=this.isMatchStateMatch(n);this.matches[e]=n,i===a||t||(this.numMatches+=a?1:i?-1:0,this.numUnmatches+=a?-1:i?1:0)}}]),e}(),h()(G.prototype,"isMatchedHeader",[g.ZP],Object.getOwnPropertyDescriptor(G.prototype,"isMatchedHeader"),G.prototype),h()(G.prototype,"isMatchedSimple",[g.ZP],Object.getOwnPropertyDescriptor(G.prototype,"isMatchedSimple"),G.prototype),h()(G.prototype,"isMatched",[g.ZP],Object.getOwnPropertyDescriptor(G.prototype,"isMatched"),G.prototype),h()(G.prototype,"handleItemTextChanged",[g.ZP],Object.getOwnPropertyDescriptor(G.prototype,"handleItemTextChanged"),G.prototype),h()(G.prototype,"_updateSearchArr",[g.ZP],Object.getOwnPropertyDescriptor(G.prototype,"_updateSearchArr"),G.prototype),h()(G.prototype,"update",[g.ZP],Object.getOwnPropertyDescriptor(G.prototype,"update"),G.prototype),h()(G.prototype,"_matchFnComplete",[g.ZP],Object.getOwnPropertyDescriptor(G.prototype,"_matchFnComplete"),G.prototype),h()(G.prototype,"_matchFnStarred",[g.ZP],Object.getOwnPropertyDescriptor(G.prototype,"_matchFnStarred"),G.prototype),h()(G.prototype,"_matchFnProject",[g.ZP],Object.getOwnPropertyDescriptor(G.prototype,"_matchFnProject"),G.prototype),h()(G.prototype,"_matchFnTask",[g.ZP],Object.getOwnPropertyDescriptor(G.prototype,"_matchFnTask"),G.prototype),h()(G.prototype,"_matchFnPriority",[g.ZP],Object.getOwnPropertyDescriptor(G.prototype,"_matchFnPriority"),G.prototype),h()(G.prototype,"_matchFnEmail",[g.ZP],Object.getOwnPropertyDescriptor(G.prototype,"_matchFnEmail"),G.prototype),h()(G.prototype,"checkChildrenParams",[g.ZP],Object.getOwnPropertyDescriptor(G.prototype,"checkChildrenParams"),G.prototype),h()(G.prototype,"hideNonMatches",[g.ZP],Object.getOwnPropertyDescriptor(G.prototype,"hideNonMatches"),G.prototype),G);var ee,te=n(8047),ne=n(7048),re=n(9998),ie=0,ae=(ee=function(){function e(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};c()(this,e),this.__ISPANE=!0,S.Z.binder(this,"getItems","getHeaders","updateItems","getWidth","getHeight","onShowArchivedChanged","zoomInOnSwipe","collapseOnSwipe","deleteOnSwipe","completeOnSwipe","onClickRefreshData","onClickRefreshDataForce","getSwipeMenuItems","getMinItemSize","toggleCollapseAll","onTapClosePane"),this.title=r.title,this._createProps(r,{contextMenuMode:"Normal",paneEmptyMessage:"Start typing to get started",paneEmptySearchMessage:"No search results",titleContextMenuHeader:"Zoom to item",searchFilters:[],dropEffect:function(){return m.Z.DropEffect.Move},isWriteable:!0,isEditable:!1,isDraggable:!0,isDropTarget:!0,hasNonVMLIs:!1,canAddItem:!0,overrideCopyBehavior:!0,supportMenuIcon:!1,supportCollapsing:!0,supportCompleting:!0,supportCheckbox:!1,supportIndent:!0,supportOffline:!0,supportPerformArchive:!0,supportDataRefresh:!1,supportReportError:!1,supportCompose:!1,supportPagination:!1,supportVertLines:!0,supportStarClick:!1,supportSearchItemAutocomplete:!0,supportSearchListenTextChanges:!0,supportSearchFlat:!0,supportLocalSearch:!0,supportClone:!0,supportDates:!0,supportMultiselect:!0,supportDeferredItemLoad:!1,supportCellTransition:!0,supportViewMenu:!1,supportHistory:!1,supportSel:!0,shouldSearchMatchParents:!0,shouldUpdateOnTextChanged:!0,noOverviewStyle:!1,supportClickOverviewScroll:!0,overviewTracksScroll:!0,overviewHasPaneItems:!0,overviewPadLevels:0,minWidth:m.Z.StdPaneWidthMin,minWidthFlex:m.Z.StdPaneWidthMin,maxWidth:m.Z.PaneWidthMax,maxWidthFlex:m.Z.StdPaneWidthMax,maxWidthSingle:m.Z.StdPaneWidthMax,widthBiggerInSingle:!0,collapsedFieldName:m.Z.PerPaneStateField.Collapsed,supportsDocuments:!0,overviewCanTrackScroll:!1,usesVMLIs:!0,scrollToStartOnSearch:!0,_topBoxHeight:36}),this.blockNoKey="",this.history=new W.Z,this._cachedMaxWidths={},this.topBoxHeight=new V.Z(this._topBoxHeight),this.rect=new V.Z(t.rect),this.isExpanded=new V.Z(!1);try{v.Z.PAssert(1301,void 0!==t.id,"Must supply a valid pane id")}catch(s){v.Z.reportError(s)}if(this.id=t.id,this.uniquePaneID=ie++,this.isFakePane=t.isFakePane,this.plugin=t.plugin,t.document&&v.Z.isString(t.document)&&(t.document=U.Z.getDocumentById(t.document)),this.documentSortMode=new V.Z(t.documentSortMode||"Modified",this.saveState),!t.item&&this.usesVMLIs)if(this.supportDeferredItemLoad&&t.deferredItemID){var i;t.item=this.getDeferredItem(t.deferredItemID)||(null===(i=t.document)||void 0===i?void 0:i.getRootItem()),this.deferredItemState={itemID:t.deferredItemID,search:t.search,offset:0}}else{var a;if(this.supportsDocuments)t.item=null===(a=t.document)||void 0===a?void 0:a.getRootItem();else t.item=this.getDefaultDisplayItem();t.search=t.search||""}this.name=new V.Z(t.name),this.item=new V.Z(t.item),this.items=new W.Z,this.headersArr=[],this.headerPaneObjects=new W.Z,this.paneObjects={},this.paneObjectsByItem={},this.paddingTop=new V.Z,this.searchingPaneObjects=new re.Z({text:""}),this.isSearchingGlobal=new V.Z,this.document=new ne.Z([this.item],(function(){var e,t;return null===(e=n.item.get())||void 0===e||null===(t=e.getDocumentOwner)||void 0===t?void 0:t.call(e)})),this.isDefaultPane=t.isDefaultPane,this.initialScrollIndex=t.scrollIndex,this.itemsDirtyState=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.reloading=!1,this.onDestroyed=new Y.Z,this.showArchived=new V.Z(!1),this.onItemPreloadUpdated=new Y.Z,this._panePadding=0,this.paneTopText=new V.Z,this.toast=new V.Z,this.isInitialized=!1,this.isLoaded=!1,this._didInitialScroll=!1,this.isLoading=new V.Z(!1),this.isFocused=new V.Z(!1),this.widthManual=t.widthManual,this.widthManualExpanded=t.widthManualExpanded,this.isReady=new V.Z(!this.plugin||this.plugin.isReady()),this.hasCollapsedObs=new V.Z;var o={pane:this};this.listManager=new k.Z(o),this.isLoadingNewPage=new V.Z(!1),this.orientation=new V.Z("vertical"),this.showScrollbars=new V.Z(!0),this._perPaneState={},this._destroyed=!1,this._numItemComputes=0,this._numHeaderComputes=0,this._numItemSets=0,this.isAnimatingOffset=!1,this._ignoreRestoreScroll=!1,this._activeItemStores={},this.showArchived.listen(this.onShowArchivedChanged),U.Z.documentsArray.listen(this.onDocumentsChanged),this.search=new $(this,t.search,this.onSearchChanged.bind(this)),this.overview=new q(this,t.isOverviewVisible,t.isOverviewShowingContents),this.constructorExtra&&this.constructorExtra()}return u()(e,[{key:"_createProps",value:function(e,t){var n=this;Object.keys(t).forEach((function(r){n[r]=void 0!==e[r]?e[r]:t[r]}))}},{key:"init",value:function(){if(!this.__DIDINIT&&this.usesVMLIs){var e=this.getItem(!0);e&&this.setItem(e,!1,!1),this.plugin&&this.plugin.notifyPaneCreated(),this.history.push(this.getSaveInfo())}this.__DIDINIT=!0}},{key:"isDestroyed",value:function(){return this._destroyed}},{key:"getStats",value:function(){return{numItemComputes:this._numItemComputes,numHeaderComputes:this._numHeaderComputes,numItemSets:this._numItemSets}}},{key:"becomeReal",value:function(){}},{key:"unload",value:function(){this._isUnloaded=!0}},{key:"isUnloaded",value:function(){return this._isUnloaded}},{key:"destroy",value:function(){this._destroyed=!0,this.plugin&&this.plugin.notifyPaneDestroyed(),this.showArchived.unlisten(this.onShowArchivedChanged),U.Z.documentsArray.unlisten(this.onDocumentsChanged),this.search.destroy(),this.search=void 0,this.overview.destroy(),this.overview=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.hiddenInput=void 0,this.onUnload();try{v.Z.PAssert(1302,v.Z.focusedPane!==this,"Globally focused pane should never be the one destroyed")}catch(e){v.Z.reportError(e)}try{v.Z.PAssert(1303,Z.Z.getPane()!==this,"Selection focused pane should never be the one destroyed")}catch(e){v.Z.reportError(e)}try{v.Z.PAssert(1304,!w.default.PaneManager.isPaneActive(this.id),"Pane manager has reference to pane in map to destroyed pane")}catch(e){v.Z.reportError(e)}this.onDestroyed.notify()}},{key:"notifyPluginLoaded",value:function(){try{v.Z.PAssert(1305,!1,"Plugin load notification not supported by pane type: ",this.type)}catch(e){v.Z.reportError(e)}}},{key:"getContextMenuMode",value:function(){return this.contextMenuMode}},{key:"isItemDraggable",value:function(){return this.isDraggable}},{key:"isOkOnAgenda",value:function(e){return!1}},{key:"getItemStore",value:function(){var e;return null===(e=this.getRootItem())||void 0===e?void 0:e.getItemStore()}},{key:"usesItemStore",value:function(e,t){return!(this.supportsDocuments&&this.getRootItem()&&e===this.getItemStore()&&t&&t.getDocumentOwner()!==this.getDocument())&&(e===this.getItemStore()||!!this._activeItemStores[e.id])}},{key:"useItemStore",value:function(e){try{v.Z.PAssert(1306,!this._activeItemStores[e.id],"Should never use the same store twice")}catch(t){v.Z.reportError(t)}this._activeItemStores[e.id]=e}},{key:"stopUsingItemStore",value:function(e){try{v.Z.PAssert(1307,this._activeItemStores[e.id],"Must be using item store to stop using it")}catch(t){v.Z.reportError(t)}delete this._activeItemStores[e.id]}},{key:"getOverview",value:function(){return this.overview}},{key:"isOverviewVisible",value:function(){var e;return null===(e=this.overview)||void 0===e?void 0:e.isVisible.get()}},{key:"numItems",value:function(){return this._numItems||this.getItems().length}},{key:"numHeaders",value:function(){return this.headersArr.length}},{key:"getItems",value:function(){return w.default.PaneUpdateBatcher.flushItemsUpdate(this),this.items.get()}},{key:"getHeaders",value:function(){return this.headerPaneObjects.get()}},{key:"itemAtIndex",value:function(e){var t;return null===(t=this.objectAtIndex(e))||void 0===t?void 0:t.getMirrorOrItem()}},{key:"objectAtIndex",value:function(e){var t=this.getItems()[e];if(t&&"footer"!==t.type)return t}},{key:"objectAtIndexWithoutFlushing",value:function(e){return this.items.get()[e]}},{key:"indexOfItem",value:function(e,t,n,r){var i,a;return null!==(i=null===(a=this.findItem(e,t,n,r))||void 0===a?void 0:a.index)&&void 0!==i?i:-1}},{key:"findItem",value:function(e,t,n,r){var i=0;for(var a,o=this.getItems(),s=this.isViewAutoBlocks(),c=r||0;c<o.length;c++){var l;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var u=o[c];if(u&&(!t||(null===(l=u.block)||void 0===l?void 0:l.id)===t.id))if(s){if(u.item===e)return u}else(u.item===e&&!u.mirroringItem||u.mirroringItem===e)&&(a||(a=[]),a.push(u))}if(a){if(n){for(var d,h,p=0,f=0;f<a.length;f++){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var g=Math.abs(a[f].index-n);(isNaN(h)||g<d)&&(h=f,d=g)}return a[h]}return a[0]}}},{key:"indexOfTop",value:function(){return this.listManager.indexOfTop()}},{key:"elementAtIndex",value:function(e){return this.listManager.getElementByIndex(e)}},{key:"addScrollListener",value:function(e){this.listManager.addScrollListener(e)}},{key:"removeScrollListener",value:function(e){this.listManager.removeScrollListener(e)}},{key:"scrollIndexIntoView",value:function(e,t){this.scrollToIndex(e,"auto",t)}},{key:"scrollItemIntoView",value:function(e,t){this.scrollToItem(e,"auto",t)}},{key:"scrollIndexToTop",value:function(e,t,n){this.scrollToIndex(e,"start",t,n)}},{key:"scrollItemToTop",value:function(e,t){this.scrollToItem(e,"start",t)}},{key:"scrollIndexToMiddle",value:function(e,t){this.scrollToIndex(e,"center",t)}},{key:"scrollItemToMiddle",value:function(e,t){this.scrollToItem(e,"center",t)}},{key:"scrollToItem",value:function(e,t,n){var r=this.indexOfItem(e);this.scrollToIndex(r,t,n)}},{key:"scrollToIndex",value:function(e,t,n,r){this.listManager.scrollToIndex(e,t,n,r)}},{key:"addScrollDelta",value:function(e,t){var n=this.listManager.getScrollOffset()+Math.floor(e);return n>0&&n<this.mobileHeadingScrollThreshold&&(n=this.mobileHeadingScrollThreshold),this.listManager.scrollToOffset(n,t)}},{key:"resetScroll",value:function(){this.scrollToIndex(0,"start")}},{key:"closestIndexOfObject",value:function(e){return e.index}},{key:"handleStatusClick",value:function(){}},{key:"_getLoadingMessage",value:function(){return"Loading..."}},{key:"getStatusMessage",value:function(e){var t;return e||(this.isLoading.get()?t=this._getLoadingMessage():0===this.numItems()?t=this.isSearched()&&this._allPaneItems.length>0?this.paneEmptySearchMessage:this.paneEmptyMessage:this.isReady.get()||(t=this._getNotReadyStatus())),t}},{key:"_getNotReadyStatus",value:function(){return"Pane data is only available while online."}},{key:"getSaveInfoForClone",value:function(){var e=this.getSaveInfo();for(var t in delete e.id,e)e.hasOwnProperty(t)&&v.Z.isObject(e[t])&&(e[t]=v.Z.clone(e[t]));return e}},{key:"getSaveInfo",value:function(){var e,t=this.document.get(),n=this.listManager.getScrollIndex();return n<0&&(n=this.initialScrollIndex),{id:this.id,name:this.name.get(),item:null===(e=this.item.get())||void 0===e?void 0:e.id,document:t?t.id:void 0,type:this.type,showarch:this.showArchived.get(),search:this.search.getState(),scrollIndex:n,itemState:this.getSaveInfoItemState(),isOverviewVisible:this.overview.isVisible.get(),isExpanded:this.isExpanded.get(),widthManual:this.widthManual,widthManualExpanded:this.widthManualExpanded,documentSortMode:this.documentSortMode.get()}}},{key:"getSaveInfoItemState",value:function(){var e=this,t=this._perPaneState,n={};return Object.keys(t).forEach((function(r){var i=r.split("~")[0],a=i&&"p"!==i,o=a&&U.Z.getItem(i);if(a&&!o)delete t[r];else{var s=t[r];for(var c in s)if(s.hasOwnProperty(c)&&c.startsWith(m.Z.PerPaneStateField.Collapsed)){var l=s[c];if(void 0!==l){var u=c.replace(m.Z.PerPaneStateField.Collapsed,"");if("Search"===u||!o||l!==e.getCollapsedDefault(o,"Overview"===u,u)||!l&&o.isDemandLoad()){var d=(s[c]?"":"un")+c;n[d]||(n[d]=[]),n[d].push(r)}}}}})),n}},{key:"saveState",value:function(e){w.default.PaneManager.updatePaneStateForPane(this,e)}},{key:"getPerPaneState",value:function(e,t){var n=this._perPaneState[e];if(n)return n[t]}},{key:"setPerPaneState",value:function(e,t,n){this._perPaneState[e]||(this._perPaneState[e]={}),void 0===n?delete this._perPaneState[e][t]:this._perPaneState[e][t]=n}},{key:"clearPerPaneStateSearch",value:function(){var e=this._perPaneState;for(var t in e)e.hasOwnProperty(t)&&delete e[t][m.Z.PerPaneStateField.CollapsedSearch]}},{key:"deletePerPaneState",value:function(e){delete this._perPaneState[e]}},{key:"isSearched",value:function(){try{v.Z.PAssert(1310,this.search,"Pane must be initialized: ",this._destroyed)}catch(e){v.Z.reportError(e)}return!!this.search&&this.search.isSearched()}},{key:"isSearchedText",value:function(){try{v.Z.PAssert(1311,this.search,"Pane must be initialized: ",this._destroyed)}catch(e){v.Z.reportError(e)}return!!this.search&&this.search.getValue()}},{key:"onSearchChanged",value:function(e){var t=Z.Z.isValid();if(t&&Z.Z.reset(),this.updateItems(),t&&this.numItems()>0){var n=this.indexOfFirstItem();n>=0&&Z.Z.selectIndex(n,0)}this.saveState()}},{key:"refreshSearchResults",value:function(){this.updateItems(!0)}},{key:"_applyItemStateArr",value:function(e,t,n){if(e)for(var r=0,i=0;i<e.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=e[i];this.setPerPaneState(a,t,n)}}},{key:"applyItemState",value:function(e){var t=this;e&&(this._perPaneState={},Object.keys(e).forEach((function(n){var r=n.startsWith("un"+m.Z.PerPaneStateField.Collapsed)?n.slice(2):n;if(r.startsWith(m.Z.PerPaneStateField.Collapsed)){var i=e[n];t._applyItemStateArr(i,r,!n.startsWith("un"))}})))}},{key:"requestDemandLoadData",value:function(e){try{v.Z.PAssert(1312,!1,"SubClass must override - by default demand load is not supported")}catch(t){v.Z.reportError(t)}}},{key:"requestDataPage",value:function(e){try{v.Z.PAssert(1313,!1,"SubClass must override - by default data pagination is not supported")}catch(t){v.Z.reportError(t)}}},{key:"getDefaultDisplayItem",value:function(e){return this.getRootItem()}},{key:"getRootItem",value:function(){var e;return null===(e=this.document.get())||void 0===e?void 0:e.getRootItem()}},{key:"setRootItem",value:function(e,t){try{v.Z.PAssert(1314,void 0===e.parent(),"Root should never have a parent")}catch(n){v.Z.reportError(n)}try{v.Z.PAssert(1315,this.getItem()!==e,"Should not be setting root to the same value")}catch(n){v.Z.reportError(n)}this.setItem(e,t)}},{key:"scrollFromMousePosition",value:function(e,t,n){n?this.getWidth():this.getHeight();var r=n?this.getWidth():this.getHeight(),i=r-60,a=n?e-this.paneContent.getBoundingClientRect().left:t-this.contentTop(),o=0;a<60?o=Math.round(v.Z.computeScrollSpeed(0,60,a,20,-1)):a>r||a>i&&(o=Math.round(v.Z.computeScrollSpeed(i,r,a,20,1))),0!==o?v.Z.repeatScrollPane(o,this):v.Z.cancelRepeatScroll("pane")}},{key:"getContentElement",value:function(){return this.paneContent}},{key:"getPaneIcon",value:function(){return"icon-align-left"}},{key:"itemHasChildren",value:function(){return this.getItem().numItems()>0}},{key:"getItem",value:function(e){return this.item.get()}},{key:"allowZoom",value:function(e){return!0}},{key:"performOverviewAction",value:function(e){}},{key:"setItem",value:function(e,t,n,r){this._numItemSets++,y.Z.disable();var i=this.getItem();this.item.set(e,!1),n||this.updateItemsImmediate(!0,!1,!0),te.Z.beginBatch(),i&&i.parent()&&i._updateStylePadding(i.parent().levelsDeep.get(),!0),!r&&i&&i.id!==e.id&&this.pushHistory({item:i.id}),t&&(e.itemChanged.notify(),i&&e!==i&&i.itemChanged.notify(),this.item.notify(e,i)),Z.Z.reset(),te.Z.endBatch()}},{key:"getItemSearchParams",value:function(){var e=this;return{item:this.getItem(),comparator:function(t){return e.search.isMatched(t)},noCollapsed:!0,includeNotes:!0,pane:this}}},{key:"getHeaderSearchParams",value:function(){return{item:this.getRootItem(),comparator:this.search.isMatchedHeader,noCollapsed:!0,collapseAfterDepth:1,headers:!0,overview:!0,pane:this}}},{key:"setItemsDirty",value:function(){this._setDirtyState(!1,!1)}},{key:"isItemsDirty",value:function(){return!!this.itemsDirtyState}},{key:"isItemsHeightDirty",value:function(){return this.itemsHeightDirty}},{key:"_setDirtyState",value:function(e,t){this.itemsDirtyState?(this.itemsDirtyState.updateSearch=e||this.itemsDirtyState.updateSearch,this.itemsDirtyState.forceNotify=t||this.itemsDirtyState.forceNotify):this.itemsDirtyState={updateSearch:e,forceNotify:t}}},{key:"updateItems",value:function(e,t){this._setDirtyState(e,t),w.default.PaneUpdateBatcher.updateAllItems()}},{key:"updateItemsImmediate",value:function(e,t,n,r){if(!this.isFakePane&&this.isFocused.get()){this.itemsDirtyState&&(e=e||this.itemsDirtyState.updateSearch,t=t||this.itemsDirtyState.forceNotify,this.itemsDirtyState=void 0),v.Z.shouldLog(m.Z.LogLevels.React)&&v.Z.log("update items"),this.search.isRunningSearch||this.search.update(void 0,void 0,!r);var i=this.getItem(),a=[];this._hasCollapsedDuringAdd=!1;var o=this.getItemSearchParams();0;var s={};o.each=function(e){s[e.id]||e.isNote()&&e.parent()===i||(s[e.id]=e,a.push(e))},v.Z.searchVMLIs(o),this._numItemComputes++,this.setItems(a,t),this.updateHeaders(t||n),this.updateCollapsedObs(this._hasCollapsedDuringAdd||this.hasCollapsedBlocks()),this.isInitialized||(this.isInitialized=!0),this.itemsHeightDirty=!1,j.Z.fireEvent("itemsUpdated",[this])}}},{key:"updateCollapsedObs",value:function(e){this.hasCollapsedObs.set(e)}},{key:"updateItemHeights",value:function(){this.itemsHeightDirty=!1,this.plugin||this.listManager.onListChanged()}},{key:"runItemSearch",value:function(e){v.Z.searchVMLIs(e)}},{key:"updateOutline",value:function(e,t){var n,r=0,i=this,a=[],o={};if(t){var s=0,c=0,l=[];for(n=0;n<e.length;n++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;e[n].isNote()||l.push({item:e[n],index:l.length})}for(l.sort(t),e=[],n=0;n<l.length;n++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var u=l[n].item;e.push(u)}}var d=function(){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var t=e[n];if(!t.isNote()){var s=t.getMirroredItem();if(s){var c=[s],l=i.getItemSearchParams();l.item=s,l.each=function(e){e.isNote()&&e.parent()===t||c.push(e)},v.Z.searchVMLIs(l),i._addPaneObjectForItem(s,t.parent(),a,o),c.forEach((function(e){i._addPaneObjectForItem(e,e.parent(),a,o)}))}else i._addPaneObjectForItem(t,t.parent(),a,o)}};for(n=0;n<e.length;n++)d();this.addFooterItems(a),this.items.set(a)}},{key:"_addPaneObjectForItem",value:function(e,t,n,r){var i=r[t.id],a=new z.Z({type:"blockItem",item:e,id:this.getPaneObjectID(e),pane:this,index:n.length,parentObject:i});return r[e.id]=a,this.addPaneObject(n,a),a}},{key:"addFooterItems",value:function(e){}},{key:"_setItems",value:function(e,t){this.updateOutline(e)}},{key:"setItems",value:function(e,t){this._allPaneItems=e,this.paneObjects={},this.paneObjectsByItem={},this._setItems(e,t),Z.Z.getPane()===this&&Z.Z.checkValid()}},{key:"updateHeaders",value:function(e){var t=[];if(this.updateHeadersOverride)t=this.updateHeadersOverride();else{var n=this.getHeaderSearchParams();n.each=function(e){t.push(e)},v.Z.searchVMLIs(n)}this._numHeaderComputes++,this.setHeaders(t,e)}},{key:"setHeaders",value:function(e,t){var n=this;this.headersArr=e;var r=e.map((function(e,t){return new z.Z({type:"blockItem",item:e,id:n.getPaneObjectID(e),pane:n,overview:!0,index:t})}));this.headerPaneObjects.set(r)}},{key:"clearItems",value:function(e){this.items.set([],e)}},{key:"onLoad",value:function(){this.isLoaded=!0,this.onLoadExtra&&this.onLoadExtra(),this.isFakePane&&(this.isFakePane=!1,this.becomeReal())}},{key:"onUnload",value:function(){this.onUnloadExtra&&this.onUnloadExtra()}},{key:"getSize",value:function(){return{width:this.getWidth(),height:this.getHeight()}}},{key:"getWidth",value:function(){var e,t=this._cachedWidth;if(t=null!==(e=t)&&void 0!==e?e:this.rect.get().width,this.getWidthExtra){var n=this.getWidthExtra();void 0!==n&&(t+=n)}return t}},{key:"getHeight",value:function(){return this.rect.get().height-this.headerHeight()}},{key:"getItemHeight",value:function(){}},{key:"getLeft",value:function(){return this.rect.get().left}},{key:"toggleOverviewVisibility",value:function(){this.overview.toggle()}},{key:"notifyDropFrom",value:function(e,t){}},{key:"dropEffectCopyBehavior",value:function(e,t){return e.clone(t,m.Z.ChangeType.Local)}},{key:"addItemToPane",value:function(e,t){var n=this.getItem();e.text||(e.text=""),this.setIgnoreRestoreScroll();var r=n.addItemAtIndex(e,t,this);return H.Z.setSelected([t],this),r}},{key:"archiveItem",value:function(e,t){return t.archiveSelf(m.Z.ChangeType.Local)}},{key:"archiveSelected",value:function(e){var t=this,n=0,r=this.indexOfPrevVMLI(Z.Z.getStartIndex(),!0);if(this.applyToSelection((function(e){t.archiveItem(!0,e),n++})),n>0){if(r<0&&this.numItems()>0&&(r=this.indexOfFirstItem()),r>=0){var i=this.itemAtIndex(r).getParsedText().length;Z.Z.selectIndex(r,i)}var a=n>1?" items.":" item.";w.default.toasts.pushMessage({text:"Archived "+n+a,action:m.Z.MessageAction.Undo,hold:!1,timeout:8e3})}}},{key:"deleteSelected",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.comparator,r=t.cb,i=t.noSelect,a=this.indexOfPrevVMLI(Z.Z.getStartIndex(),!0),o=0;P.Z.saveDeleteSelection();var s=[],c=[],l={};this.applyToSelection((function(t,r,i,a){if((!n||n(t))&&!t.isDeleted()){var u=t.parent();l[u.id]||(o+=t.numChildrenRecursive(!1)+1,l[t.id]=!0);var d=e.elementAtIndex(a.index),h=t.checkDeleteMirror(!0,d);h?c.push(h):s.push(t)}}),{followMirror:!0});var u=function(t){if(T.Z.doBatch({undo:!0,pane:!0},(function(){s.forEach((function(e){return e.deleteSelf(m.Z.ChangeType.Local)})),c.forEach((function(e){return e.action(t)})),null===r||void 0===r||r()})),!i&&(a<0&&e.numItems()>0&&(a=e.indexOfFirstItem()),a>=0)){var n=e.itemAtIndex(a);if(n){var l=n.getParsedText().length;Z.Z.selectIndex(a,l)}else Z.Z.reset()}var u=o>1?" items.":" item.";w.default.toasts.pushMessage({text:"Deleted "+o+u,action:m.Z.MessageAction.Undo,timeout:m.Z.ToastTimeoutDefault})},d=Z.Z.save();c.length>0?c[0].confirm((function(e){e?u(e):Z.Z.restore(d)})):o>1?w.default.menus.confirm("Are you sure you want to delete ".concat(o," items?"),(function(e){e?u():Z.Z.restore(d)})):u()}},{key:"handleLeftSideTap",value:function(e,t){var n=e.item;if(this.supportCollapsing)if(_.Z.mac&&t.metaKey||!_.Z.mac&&t.ctrlKey)this.zoomIn(n);else if(n.isCollapsible()||e.isBlockHeader){var r=Z.Z.save(),i=!this.isPaneObjectCollapsed(e);t.shiftKey?this.collapsePaneObjectRecursive(e,i):this.setPaneObjectCollapsed(e,i),r&&this.restoreSelectionAfterCollapse(r,i)}}},{key:"handleRightSideTap",value:function(e){this.supportCompleting&&(v.Z.beginCompleteAction(),e.setComplete(!e.isComplete(),m.Z.ChangeType.Local),v.Z.endCompleteAction())}},{key:"onClickTitle",value:function(e){var t=this.getItem();return this.zoomOut(e),v.Z.sendEvent("Menu","Title"),t!==this.getItem()}},{key:"isZoomed",value:function(){return this.getItem()!==this.getRootItem()}},{key:"onDoubleClickTitle",value:function(){this.toggleCollapseAll()}},{key:"addItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.index,e.prefix,e.text,e.toRoot}},{key:"onClose",value:function(){}},{key:"onTapAddItem",value:function(){this.addItem()}},{key:"onTapOverviewButton",value:function(){this.toggleOverviewVisibility(),this.isOverviewVisible()?v.Z.sendEvent("Menu","OpenOverview"):v.Z.sendEvent("Menu","CloseOverview")}},{key:"onTapClosePane",value:function(){var e=w.default.PaneManager.removePane(this);if(e){try{v.Z.PAssert(1317,e===this.id,"Pane IDs must match")}catch(t){v.Z.reportError(t)}v.Z.sendEvent("Menu","ClosePane"),w.default.tooltip.hideTip(),this.onClose()}}},{key:"onClickArchiveCompleted",value:function(e){this.archiveCompleted(),v.Z.preventAndStop(e),v.Z.sendEvent("Menu","ArchiveCompleted")}},{key:"onClickRefreshData",value:function(e,t){try{v.Z.PAssert(1318,this.supportDataRefresh,"How did this pane try to perform a data refresh if it is not supported",this.type)}catch(n){v.Z.reportError(n)}this.refreshPaneData(t),v.Z.sendEvent("Menu","PaneDataRefresh"),v.Z.preventAndStop(e)}},{key:"onClickRefreshDataForce",value:function(e){this.onClickRefreshData(e,!0)}},{key:"onClickReportError",value:function(e){try{v.Z.PAssert(1319,this.supportReportError,"Pane does not support error reporting")}catch(t){v.Z.reportError(t)}this.reportPaneError(),v.Z.sendEvent("Menu","PaneReportError"),v.Z.preventAndStop(e)}},{key:"refreshPaneData",value:function(){var e=o()(f().mark((function e(t){var n;return f().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(U.Z.isConnected()){e.next=5;break}return n=w.default.toasts.pushMessage({text:"Your connection appears to be offline. Data will refresh when you go online."}),e.next=4,U.Z.onConnectedPromise();case 4:w.default.toasts.clearMessage(n);case 5:this._refreshPaneData(t);case 6:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_refreshPaneData",value:function(e){}},{key:"reportPaneError",value:function(){}},{key:"getItemsToArchive",value:function(){var e=[];return v.Z.searchVMLIs({item:this.getItem(),pane:this,each:function(t){t.isComplete()&&!t.isNote()&&e.push(t)}}),e}},{key:"archiveCompleted",value:function(){var e,t,n,r=0;if(Z.Z.isValid()){var i=0;for(t=Z.Z.getEndIndex();t<this.items.length();){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if((n=this.itemAtIndex(t))&&!this.itemAtIndex(t).hasCompletedAncestor()){e=this.objectAtIndex(t);break}t++}}var a=this.getItemsToArchive();for(w.default.PaneUpdateBatcher.beginUpdateItems(),t=a.length-1;t>=0;t--){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;n=a[t],v.Z.shouldLog(m.Z.LogLevels.Data)&&v.Z.log("Archive Item: ",n.getParsedText()),n.archiveSelf(m.Z.ChangeType.Local)}if(w.default.PaneUpdateBatcher.commitUpdateItems(),a.length>0){var o=a.length>1?" items.":" item.";w.default.toasts.pushMessage({text:"Archived "+(a.length+o),action:m.Z.MessageAction.Undo,hold:!1,timeout:8e3})}else w.default.toasts.pushMessage({text:"No completed items to archive"});if(e){var s=e.index;if(s>=0){n=this.itemAtIndex(s);try{v.Z.PAssert(1320,n,"Could not restore selection to item")}catch(l){v.Z.reportError(l)}if(n){var c=n.getParsedTextWithoutPrefix().length;Z.Z.selectIndex(s,c)}}}else Z.Z.reset()}},{key:"bottomListMessage",value:function(){}},{key:"isSearchingRemote",value:function(){return!1}},{key:"getTitleList",value:function(){return this.usesVMLIs?this.getItem().parents().concat(this.getItem()):[]}},{key:"itemTitle",value:function(){return this.getItem().parent()?this.getItem().getParsedText():this.titleOfFirstItem()}},{key:"titleOfFirstItem",value:function(){var e;return(null===(e=this.getDocument())||void 0===e?void 0:e.text.get())||""}},{key:"onShowArchivedChanged",value:function(){this.showArchived.get()&&j.Z.fireEvent("showArchived",[]),this.updateItems()}},{key:"onDocumentsChanged",value:function(){this.supportsDocuments&&this.updateHeaders(!1)}},{key:"indexOfFirstItem",value:function(){return this.indexOfNextVMLI(-1)}},{key:"indexOfLastItem",value:function(){return this.indexOfPrevVMLI(this.numItems(),!1)}},{key:"getFirstItem",value:function(){var e=this.indexOfFirstItem();if(e>=0){var t=this.getItems()[e];return t?t.item:void 0}}},{key:"getFirstObject",value:function(){return this.objectAtIndex(this.indexOfFirstItem())}},{key:"getLastItem",value:function(){return this.itemAtIndex(this.indexOfLastItem())}},{key:"getLastObject",value:function(){return this.objectAtIndex(this.indexOfLastItem())}},{key:"setFocused",value:function(e){var t=this.isFocused.get();this.isFocused.set(e),t||this.updateItemsImmediate(!0,!1)}},{key:"findPaneObject",value:function(e){return w.default.PaneUpdateBatcher.flushItemsUpdate(this),this.paneObjects[e]}},{key:"headerHeight",value:function(){return 68}},{key:"handleUndo",value:function(){var e;null!==(e=this.search)&&void 0!==e&&e.isFocused.get()||P.Z.undo()}},{key:"handleRedo",value:function(){var e;null!==(e=this.search)&&void 0!==e&&e.isFocused.get()||P.Z.redo()}},{key:"contentTop",value:function(){return m.Z.Mobile.TopBarHeight}},{key:"restoreSelection",value:function(e){Z.Z.restore(e)}},{key:"restoreSelectionAfterCollapse",value:function(e,t){if(e){var n=Z.Z.getStartSelectionOfMap(e.selectedMap),r=Z.Z.getEndSelectionOfMap(e.selectedMap);if(n&&r){var i,a=n.start,o=n.paneObject,s=r.end,c=r.paneObject;if(o&&c)Z.Z.selectObjects(o,a,c,s);else if(o)Z.Z.selectObject(o,a),i=!0;else if(c)Z.Z.selectObject(c,s),o=c,i=!0;else if(t)for(var l=0,u=o.parentObject;u;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=this.findPaneObject(u.id);if(d){Z.Z.selectObject(d,-1),o=Z.Z.getStartObject(),i=!0;break}u=u.parentObject}else Z.Z.reset();o&&i&&v.Z.focusedPane.scrollIndexToMiddle(o.index)}}}},{key:"doCollapseAction",value:function(e,t){try{v.Z.PAssert(1321,this.supportCollapsing,"Should not be collapsing")}catch(r){v.Z.reportError(r)}var n=Z.Z.save();this.setIgnoreRestoreScroll(),w.default.PaneUpdateBatcher.beginUpdateItems(),t(),this.saveState(),this.updateItems(),w.default.PaneUpdateBatcher.commitUpdateItems(),this.restoreSelectionAfterCollapse(n,e)}},{key:"_setPaneObjectCollapsedRecursive",value:function(e,t){var n=0,r=e.item,i=e.children,a=i.length;(this.canCollapse()||this.search.isMatched(r))&&this.setPaneObjectCollapsed(e,t,!1);for(var o=0;o<a;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=i[o];(s.isCollapsed()||s.children.length>0)&&this._setPaneObjectCollapsedRecursive(s,t)}}},{key:"collapseAllHeadersRecursive",value:function(e){var t=this;this.doCollapseAction(e,(function(){t.headerPaneObjects.forEach((function(n){var r;n.item.getDocumentOwner()===t.getDocument()&&!n.item.isRoot&&(n.isCollapsed()||n.children.length>0)&&(null!==(r=n.parentObject)&&void 0!==r&&r.item.isRoot&&t.collapsePaneObjectRecursive(n,e))}))}))}},{key:"collapseAllRecursive",value:function(e){var t=this;this.doCollapseAction(e,(function(){t.items.forEach((function(n){(n.isCollapsed()||n.children.length>0)&&(n.parentObject||t._setPaneObjectCollapsedRecursive(n,e))}))}))}},{key:"collapsePaneObjectRecursive",value:function(e,t){var n=this;this.doCollapseAction(t,(function(){void 0!==t&&n._setPaneObjectCollapsedRecursive(e,t)}))}},{key:"toggleCollapseAll",value:function(){if(this.supportCollapsing){var e=!this.hasCollapsed();this.collapseAllRecursive(e)}}},{key:"toggleCollapseSelected",value:function(e){var t,n=this;this.applyToSelection((function(e,n,r,i){return t=!i.isCollapsed(),!1})),this.doCollapseAction(t,(function(){n.applyToSelection((function(r,i,a,o){e?n._setPaneObjectCollapsedRecursive(o,t):n.setPaneObjectCollapsed(o,t)}))}))}},{key:"hasCollapsed",value:function(){return this.hasCollapsedObs.get()}},{key:"onOverviewToggled",value:function(e){}},{key:"getPaddingForPaneObject",value:function(e){var t,n=e.overview;t=!n&&this.isViewFlatList()?w.default.DisplaySettings.itemIndentStart():w.default.DisplaySettings.getPaddingForLevel(e.levelsDeepNew(),n);var r=this.getWidth();return void 0===this.extraPaddingForPaneObject||n||(t+=this.extraPaddingForPaneObject(e)),t=Math.min(t,r-m.Z.SPThresholdRight-8),w.default.settings.alignIndentToPrefix.get()&&!e.overview&&(t-=m.Z.PrefixWidthPlusOffset),t}},{key:"maxWidthOfPaneObject",value:function(e){var t=e.item,n=e.pane;var r=1e4*(t.hasPrefix()?1:0)+1e5*(t.isNote()?1:0)+e.levelsDeepNew();if(void 0===this._cachedMaxWidths[r]){var i,a=this.getPaddingForPaneObject(e);i=n.listManager?this.getWidth()-a-m.Z.ItemPaddingRightVirtuoso:this.getWidth()-a-m.Z.SPThresholdRight-(t.hasPrefix()?this.shouldRenderPrefix(e)?m.Z.PrefixWidth:5:0),this._cachedMaxWidths[r]=Math.floor(Math.max(m.Z.MinItemWidth,i))}return this._cachedMaxWidths[r]}},{key:"prevPaneObjectAtSameLevelOrHigher",value:function(e){var t=0;try{v.Z.PAssert(1322,e>=0,"Must supply a valid selection index: "+e)}catch(o){v.Z.reportError(o)}try{v.Z.PAssert(1323,e<this.numItems()+1,"Must supply a valid selection index: "+e)}catch(o){v.Z.reportError(o)}for(var n=this.objectAtIndex(e),r=e-1;r>=0;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.objectAtIndex(r),a=this.itemAtIndex(r);if(a&&n.item!==a&&!a.isNote()&&i.levelsDeepNew()<=n.levelsDeepNew())return i;r--}}},{key:"getSiblingsAfterPaneObject",value:function(e){for(var t=0,n=e.index,r=e.item,i=this.numItems(),a=[],o=n+1;o<i;o++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=this.objectAtIndex(o);if(s){var c=s.item;if(!c||r===c||c.parent()!==r.parent())break;a.push(s)}}return a}},{key:"getChildrenOfPaneObject",value:function(e){for(var t=0,n=e.item,r=e.index,i=this.numItems(),a=[],o=r+1;o<i;o++){var s;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var c=this.objectAtIndex(o);if(null===c||void 0===c||null===(s=c.item)||void 0===s||!s.isDescendantOf(n))break;a.push(c)}return a}},{key:"indexOfPrevVMLI",value:function(e,t){var n=0;try{v.Z.PAssert(1324,e>=0,"Must supply a valid selection index: "+e)}catch(o){v.Z.reportError(o)}try{v.Z.PAssert(1325,e<this.numItems()+1,"Must supply a valid selection index: "+e)}catch(o){v.Z.reportError(o)}for(var r=t?this.itemAtIndex(e):void 0,i=e-1;i>=0;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this.itemAtIndex(i);if(a&&r!==a)return i;i--}return-1}},{key:"indexOfNextVMLI",value:function(e,t){var n=0;try{v.Z.PAssert(1326,e>=-1,"Must supply a valid selection index: "+e)}catch(o){v.Z.reportError(o)}try{v.Z.PAssert(1327,e<this.numItems(),"Must supply a valid selection index: "+e)}catch(o){v.Z.reportError(o)}for(var r=t?this.itemAtIndex(e):void 0,i=e+1;i<this.numItems();){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this.itemAtIndex(i);if(a&&r!==a)return i;i++}return-1}},{key:"indexOfPrevHeader",value:function(e){var t=0;try{v.Z.PAssert(1328,e>=-1,"Must supply a valid selection index: "+e)}catch(i){v.Z.reportError(i)}try{v.Z.PAssert(1329,e<this.numItems(),"Must supply a valid selection index: "+e)}catch(i){v.Z.reportError(i)}for(var n=e-1;n>=0;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.itemAtIndex(n);if(null!==r&&void 0!==r&&r.isPrefixHeader())return n;n--}return-1}},{key:"indexOfNextHeader",value:function(e){var t=0;try{v.Z.PAssert(1330,e>=-1,"Must supply a valid selection index: "+e)}catch(i){v.Z.reportError(i)}try{v.Z.PAssert(1331,e<this.numItems(),"Must supply a valid selection index: "+e)}catch(i){v.Z.reportError(i)}for(var n=e+1;n<this.numItems();){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.itemAtIndex(n);if(null!==r&&void 0!==r&&r.isPrefixHeader())return n;n++}return this.numItems()-1}},{key:"findNextItem",value:function(e){var t=this.findPaneObject(e.id);t||(t=this.objectAtIndex(e.index-1));if(t){for(var n,r=0,i=t,a=i.index,o=(i.item,this.numItems()),s=a+1;s<o;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var c=this.objectAtIndex(s);if(c)if(c.item){n=c;break}}return n||(n=t),n}}},{key:"_getPrevNextItem",value:function(e,t,n){var r=n?this.indexOfNextVMLI:this.indexOfPrevVMLI,i=r.call(this,e);if(t)for(var a=0,o=this.itemAtIndex(e);i>=0;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=this.itemAtIndex(i);if(o.parent()===s.parent())return s;if(o.parent()===s||s.parent()===o.parent().parent()){i=-1;break}i=r.call(this,i)}else if(i>=0)return this.itemAtIndex(i)}},{key:"getPreviousItem",value:function(e,t){return this._getPrevNextItem(e,t,!1)}},{key:"getNextItem",value:function(e,t){return this._getPrevNextItem(e,t,!0)}},{key:"getFirstSelectedItem",value:function(){var e;return this.applyToSelection((function(t){return e=t,!1})),e}},{key:"getFirstSelectedIndex",value:function(){return Z.Z.getStartIndex()}},{key:"applyToSelection",value:function(e,t){Z.Z.forEach(e,t)}},{key:"applyFnToSelection",value:function(e,t){var n=Z.Z.save(),r=t&&t.toggle,i=!t||void 0===t.value||t.value,a=t&&void 0!==t.value2?t.value2:void 0;if(this.applyToSelection((function(t){r&&t[r]()!==i&&(r=void 0),r||t[e](i,a)})),r){var o=!(!t||void 0===t.emptyValue)&&t.emptyValue;this.applyToSelection((function(t){t[e](o,a)}))}n&&!t.noRestoreSel&&this.restoreSelection(n)}},{key:"applyPriorityToSelection",value:function(e,t){t?this.applyFnToSelection("setPriority",{toggle:"getPriority",value:e,value2:m.Z.ChangeType.Local,emptyValue:m.Z.VMLIFlag.None}):this.applyFnToSelection("setPriority",{value:e,value2:m.Z.ChangeType.Local})}},{key:"autocompleteTag",value:function(){this._autocompletePopup({mode:"tag",text:"Add tag",buttonText:"Add"},(function(e,t){var n=t.value.trim(),r=e.getParsedText()+" "+m.Z.TagPrefix+n;e.setText(r,m.Z.ChangeType.Local)}))}},{key:"autocompleteMove",value:function(e,t){var n=this;(e=e||{}).mode="move",e.text=e.text||"Select item to move to",e.documentSelector=!this.supportsDocuments,e.buttonText="MOVE";var r=Z.Z.save(),i=Z.Z.getStartIndex();this._autocompletePopup(e,(function(e,t,i,a){var o;if(t.subItemText?(o=n.createVMLI({text:t.subItemText},{parent:t.item,changeType:m.Z.ChangeType.AllLocal}),t.item.insertItem(o,0)):t.item===e||t.item.isDescendantOf(e)||(o=t.item),o&&!i.includes(e.parent())){var s,c;if(_.Z.mac?a.ctrlKey:a.ctrlKey&&a.altKey)s="link";else if(_.Z.mac?a.altKey:a.ctrlKey){var l=e.clone(o,m.Z.ChangeType.Local);o.insertItem(l,a.shiftKey?0:void 0),c=!0}else(_.Z.mac?a.metaKey:a.altKey)&&(s="mirror");if(!c)if(s){var u=("link"===s?"[[":"((")+e.id+("link"===s?"]]":"))"),d=U.Z.createVMLI({text:u},{documentOwner:o.getDocumentOwner(),parent:o,changeType:m.Z.ChangeType.Local});o.insertItem(d,a.shiftKey?0:void 0)}else n.moveItem(e,o,a.shiftKey?0:void 0),r=void 0}}),(function(){t&&t(),r?Z.Z.restore(r):Z.Z.selectIndex(i,-1)}))}},{key:"autocompleteSchedule",value:function(e){var t=e.item,n=e.element;e.onClose;w.default.menus.openDate({element:n||Z.Z.getStartElement(),pane:this,onSelect:function(e){var n=w.default.pluginManager.getPlugin(m.Z.PluginID.Gmail);v.Z.isDateValid(e)?n.scheduleEmail(t,e):w.default.toasts.pushMessage({text:"Unable to read date. Please try a different option.",action:m.Z.MessageAction.Okay})}})}},{key:"autocompleteLabel",value:function(e,t){var n,r=this,i=w.default.pluginManager.getPlugin(m.Z.PluginID.Gmail),a=function(e){var t=e.getAttachmentByPlugin(i.id),r=t.getPlugin().getDisplayTags(t);n=n?v.Z.arrayIntersection(n,r):r};(e=e||{}).item?a(e.item):this.applyToSelection(a),e.tokens=(n||[]).map((function(e){return{text:e}})),e.mode="gmailLabel",e.text="Select a label",e.buttonText="LABEL",e.allowCustom=!0,e.allowEmpty=!0,e.onTokenRemoved=function(n){var a=n.text;i.beginAction();var o=function(e){var t=e.getAttachmentByPlugin(i.id);if(t)if(i.attachmentHasLabel(t,a))i.performAction(m.Z.PluginAction.Gmail.RemoveLabel,!1,t,a);else try{v.Z.PAssert(1332,!1,"Tried to remove a tag from an attachment without a tag")}catch(n){v.Z.reportError(n)}else w.default.toasts.pushMessage(m.Z.MessageID.ReselectEmail)};e.item?o(e.item):r.applyToSelection(o),i.endAction(),t&&t(n)},this._autocompletePopup(e,(function(e,t){var n=t.value.trim();try{v.Z.PAssert(1333,e.hasPluginAttachment(i.id),"Must have valid plugin attachment")}catch(o){v.Z.reportError(o)}var r=e.getAttachmentByPlugin(i.id);if(r){if(n){var a=i.createLabelString(n);a?i.attachmentHasLabel(r,a)||i.performAction(m.Z.PluginAction.Gmail.AddLabel,!1,r,a):w.default.toasts.pushMessage({text:"Cannot create a label with a reserved named.",action:m.Z.MessageAction.Okay})}}else w.default.toasts.pushMessage(m.Z.MessageID.ReselectEmail)}))}},{key:"_autocompletePopup",value:function(e,t,n){var r=this;if(!e.elementDisplay){var i=Z.Z.getSelectedObjects().find((function(e){return!!r.elementAtIndex(e.index)}));i&&(e.elementDisplay=this.elementAtIndex(i.index))}var a=e.item,o=e;o.pane=this,o.item||(o.item=this.getRootItem()),o.onSelected=function(e,i){a?t(a,e,[a],i):r.applyToSelection((function(n,r,a,o,s){t(n,e,s,i)})),n&&n(e)},M.Z.showPopup(o)}},{key:"moveItem",value:function(e,t,n){if(w.default.PaneUpdateBatcher.beginUpdateItems(),t.belongsToSameItemStore(e))e.moveTo({parent:t,index:n},m.Z.ChangeType.Local);else{var r=this.dropEffectCopyBehavior(e,t);r.setParent(t),t.insertItem(r)}w.default.PaneUpdateBatcher.commitUpdateItems()}},{key:"setPropDefault",value:function(e,t){void 0===this[e]&&(this[e]=t)}},{key:"setExpanded",value:function(e,t){var n=this,r=this.isExpanded.get()!==e;v.Z.batchRenderUpdates((function(){n.isExpanded.set(e),r&&!1!==t&&(j.Z.fireEvent("panesChanged",[]),n.saveState(),w.default.PaneManager.ensurePaneInView(n))}))}},{key:"modifyTextOnDropBasedOnSearch",value:function(e,t,n,r,i,a){var o=0;if(!n||!n.search)return e;var s,c,l=n.search,u=this.search,d=t[a](),h=l[a](),p=u[a](),f=[],g=[];for(s=0;p&&s<p.length;s++){var m=0;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;c=p[s];for(var v=r,y=!d||d.indexOf(c)<0;y&&v;){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;var k=v[a]();k&&k.indexOf(c)>=0&&(y=!1),v=v.parent()}y&&f.push(i+c)}if(f.length){var _=0;for(s=0;d&&h&&s<h.length;s++){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;c=h[s],d.indexOf(c)>=0&&p.indexOf(c)<0&&g.push(i+c)}var Z=f.join(" ");if(g.length>0){var w=0;for(s=0;s<g.length;s++){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;c=g[s],e=0===s?e.replace(c,Z):e.replace(c,"")}}else e=e+" "+Z;e=e.replace(/  +/g," ")}return e}},{key:"canAcceptDragOver",value:function(e,t,n,r){return this.isDropTarget}},{key:"handleDragOver",value:function(e,t,n,r,i){var a,o,s=v.Z.getElementParent(t),c=(s||v.Z.findParent(t,"blockHeader"))&&v.Z.getPaneObjectForElement(t),l=null===(a=c)||void 0===a?void 0:a.getMirrorOrItem();if(v.Z.hasClass(t,"overviewBottomPad"))o={overview:!0,atEnd:!0,targetItem:l=this.headersArr[this.headersArr.length-1],targetElement:t,targetPane:this,targetPaneObject:c=this.headerPaneObjects.get()[this.headerPaneObjects.length()-1],position:m.Z.DragDropPosition.Below},w.default.DragDrop.dragInfo=o,this.overview.updateDragHoverItem(l);else if(s&&v.Z.hasClass(s,"overviewItem")){var u,d=s.getBoundingClientRect(),h=d.height,p=this.type!==m.Z.PaneMode.Task,f=null===i||void 0===i?void 0:i.isRoot;f?l.isRoot&&(u=m.Z.DragDropPosition.Above):u=p&&f?m.Z.DragDropPosition.On:!(r<=d.top+.3*h)||l&&l.isRoot?r>d.top+.7*h?m.Z.DragDropPosition.Below:m.Z.DragDropPosition.On:m.Z.DragDropPosition.Above,void 0!==u?(o={overview:!0,targetItem:l,targetElement:s,targetPane:this,targetPaneObject:c,position:u},w.default.DragDrop.dragInfo=o,this.overview.updateDragHoverItem(l)):this.overview.updateDragHoverItem(null)}else this.overview.updateDragHoverItem(null),o=this._handleDragOverPane(e,t,s,c,n,r,i);return o}},{key:"_handleDragOverPane",value:function(e,t,n,r,i,a,o){}},{key:"handleDragDrop",value:function(e,t,n,r){var i,a=t.ctrlKey||t.altKey||t.metaKey;return null!==n&&void 0!==n&&n.targetItem&&(a||null!==e&&void 0!==e&&e.every((function(e){return e!==n.targetItem})))&&(i=this._handleDragDrop(e,t.dataTransfer,n,t,r)),this.revertDrag(),i}},{key:"_handleDragDrop",value:function(e,t,n,r,a){var o=this,s=t.pane,c=n.overview,l=n.dropOnPane,u=n.atEnd,d=n.position,h=n.targetPaneObject,p=n.targetItem,f=!0,g=!1,k=i()({},p.id,this.indexOfItem(p)),Z=p.parent();if(e.forEach((function(e){for(var t=0,n=e.getMirroredItem();Z&&f;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;Z!==e&&Z!==n||(f=!1,w.default.toasts.pushMessage({text:"Cannot drop an item into its own children",action:m.Z.MessageAction.Okay})),Z=Z.parent()}k[e.id]=o.indexOfItem(e)})),f){var b,P,S=-1,D=e.every((function(e){return e.isRoot}));if((_.Z.mac?r.ctrlKey:r.ctrlKey&&r.altKey)?P="link":(_.Z.mac?r.altKey:r.ctrlKey)?t.dropEffect=m.Z.DropEffect.Copy:(_.Z.mac?r.metaKey:r.altKey)&&(P="mirror"),!D){if(l)b=p,S=u?p.numItems():0;else if(d===m.Z.DragDropPosition.Above)b=p.parent(),S=p.getIndex();else if(d===m.Z.DragDropPosition.On)p=p.getMirroredItemOrSelf(),b=p,S=r.shiftKey?0:p.numItems();else{p=p.getMirroredItemOrSelf();var I=!1;if(!c){var E=h?h.index:this.indexOfItem(p),x=this.getNextItem(E);x&&x.parent()===p&&!x.isNote()&&(b=p,S=0,I=!0)}I||(b=p.parent(),S=p.getIndex()+1)}try{v.Z.PAssert(1334,b,"Trying to move without a target")}catch(C){v.Z.reportError(C)}try{v.Z.PAssert(1335,!isNaN(S),"Trying to move without a target index")}catch(C){v.Z.reportError(C)}}g=!0,y.Z.disable(),T.Z.beginBatch({pane:!0,undo:!0}),e.forEach((function(e){if(e.isRoot){if(p.isRoot){var n=p.getDocumentOwner(),r=U.Z.documentsArray.indexOf(n)+(d>0?1:0);U.Z.moveDocument(e.getDocumentOwner(),r)}}else if("mirror"===P&&(e=e.getMirroredItem()||e),t.dropEffect===m.Z.DropEffect.Move){var i=e.parent();if(i)if(i.belongsToSameItemStore(b))if(P&&e.getDocumentOwner()){var c=("link"===P?"[[":"((")+e.id+("link"===P?"]]":"))"),l=U.Z.createVMLI({text:c},{documentOwner:b.getDocumentOwner(),parent:b,changeType:m.Z.ChangeType.Local});b.insertItem(l,S)}else{var u=e.parent()===b&&k[p.id]>k[e.id];e.moveTo({parent:b,index:S},m.Z.ChangeType.Local),o.search.stickMatch(e);var h=e.getRawText();h=o.modifyTextOnDropBasedOnSearch(h,e,s,b,m.Z.TagPrefix,"getTags"),(h=o.modifyTextOnDropBasedOnSearch(h,e,s,b,m.Z.ContactPrefix,"getContacts"))!==e.getRawText()&&e.setText(h,m.Z.ChangeType.Local),u&&S--}else{var f=e.getIndex();e=e.clone(b,m.Z.ChangeType.Local),o.search.stickMatch(e),b.insertItem(e,S),i.removeChildAtIndex(f,m.Z.ChangeType.Local)}else e=e.clone(b,m.Z.ChangeType.Local),o.search.stickMatch(e),b.insertItem(e,S)}else a||(e=t.pane?t.pane.dropEffectCopyBehavior(e,b):e.clone(b,m.Z.ChangeType.Local)),e?(e.setParent(b),o.search.stickMatch(e),b.insertItem(e,S)):g=!1;g&&(t.pane&&t.pane.notifyDropFrom(e,o),S++)})),g&&w.default.onIntroAction("Drag"),T.Z.commitBatch()}return g}},{key:"revertDrag",value:function(){this.overview&&this.overview.updateDragHoverItem(null)}},{key:"isItemHeader",value:function(e,t){return t?e.hasHeaderChildren():e.hasVisibleChildren(this)}},{key:"openNoteContextMenuByPaneObject",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.startFullscreen,i=n.noteElement,a=e.index,o=e.item;o.isNote()?t=o:(o.hasNote()||o.createNote(),t=o.getNote(),this.preventUpdateForObject(e));var s=this.elementAtIndex(a);if(s){var c=Z.Z.save();this.openNoteContextMenu(t,i,(function(){return Z.Z.restore(c)}),r)}}},{key:"openNoteContextMenu",value:function(e,t,n,r){b.o0.openMenu({type:"Note",item:e.parent(),note:e,pane:this,startFullscreen:r||Z.Z.isKeyboardOpen,onClosed:n})}},{key:"closeNoteContextMenu",value:function(){w.default.menus.isContextMenuOpen()&&w.default.menus.closeContextMenu()}},{key:"canResetMultiselect",value:function(){return!0}},{key:"replaceTextOnDropOnBlock",value:function(e,t,n,r){var i=t.isNoKey?"":t.name,a=null===n||void 0===n?void 0:n.name,o=new RegExp(i+"\\b"),s=e.getRawText();if(""===i||!s.match(o)){if(a){var c=new RegExp(a+"\\b");s=s.replace(c,i)}else s+=" "+i;e.setText(s,m.Z.ChangeType.Local)}}},{key:"applyDropOnBlock",value:function(e,t,n,r){var i=this;t.forEach((function(t){return i._applyDropOnBlockItem(e,t,n,r)}))}},{key:"_applyDropOnBlockItem",value:function(e,t,n,r){var i,a=e;if(Z.Z.setFocusedPane(n),a.isStarred||a.isImportant)a.isStarred?t.setStarred(!0,m.Z.ChangeType.Local):a.isImportant&&(i=m.Z.VMLIFlag.P1),i&&t.setPriority(i,m.Z.ChangeType.Local);else if(e.isTag)this.replaceTextOnDropOnBlock(t,e,r&&r.isTag?r:void 0,"#");else if(e.isContact)this.replaceTextOnDropOnBlock(t,e,r&&r.isContact?r:void 0,"+");else if(e.isPriority)t.setPriority(e.priority,m.Z.ChangeType.Local);else{var o=w.default.pluginManager.getPluginGCalendar(),s=!0;if(t.hasAttachmentType(m.Z.PluginType.Calendar)){var c=t.getAttachmentByType(m.Z.PluginType.Calendar);c&&c.getField("recurringEventId")&&t.getCalendarParsedText()===c.getField("summary")?(w.default.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"}),s=!1):o.isEnabled()?o.hasWritePermissionForAttach(c)||(w.default.toasts.pushMessage({text:"This event is on a read-only calendar",actionText:"OKAY"}),s=!1):(w.default.toasts.pushMessage({text:"Cannot modify this event if the calendar plugin is disabled. Please enable the Google Calendar plugin.",action:m.Z.MessageAction.OpenSettings}),s=!1)}if(s)if(t.setDate(e.date,e.duration||m.Z.DefaultEventDuration,m.Z.ChangeType.Local),v.Z.isDateValid(a.date)&&o&&n!==this&&!t.hasAttachmentType(m.Z.PluginType.Calendar))if(o.getDefaultExportCalendarID()){var l=w.default.pluginManager,u=m.Z.PluginSettingsID.GCalendar.SyncDraggedEvents,d=function(){l.getSetting(m.Z.PluginID.GCalendar,u)&&o.createEventForItem(t)};w.default.settings.shouldShowHelp("syncNewEvents")?w.default.menus.confirm("Add events to Google Calendar when dropping onto the Calendar pane?",(function(e){w.default.settings.closeHelp("syncNewEvents"),l.setSetting(m.Z.PluginID.GCalendar,u,e),d()})):d()}}if(n.isEditable){var h=n.indexOfItem(t,e);h>=0&&Z.Z.selectIndex(h,t.getParsedText().length)}}},{key:"setIgnoreRestoreScroll",value:function(e,t){var n=this;this._ignoreRestoreScroll=!0,this._ignoreRestoreScrollTimeout&&clearTimeout(this._ignoreRestoreScrollTimeout),this._ignoreRestoreScrollTimeout=setTimeout((function(){n._ignoreRestoreScroll=!1,t&&t()}),e||100)}},{key:"zoomInOnSwipe",value:function(e){var t=this,n=this.item.get();this.zoomIn(e),w.default.toasts.pushMessage({text:"<b>Zoomed in to: </b>"+e.getParsedText(),action:function(){t.zoomIn(n)},hold:!1,actionText:"UNDO"})}},{key:"collapseOnSwipe",value:function(e){this.supportCollapsing&&e.isCollapsible()&&e.toggleCollapsed(this)}},{key:"deleteOnSwipe",value:function(e){var t;(e.deleteSelf(m.Z.ChangeType.Local),e.hasAttachmentType(m.Z.PluginType.Email))?t=e.getAttachmentByType(m.Z.PluginType.Email).getField("subject"):t=e.getParsedTextWithoutPrefix();w.default.toasts.pushMessage({text:"<b>Deleted:</b>"+t,action:function(){P.Z.undo()},hold:!1,actionText:"UNDO"})}},{key:"completeOnSwipe",value:function(e){this.supportCompleting&&(v.Z.beginCompleteAction(),e.setComplete(!e.isComplete(),m.Z.ChangeType.Local),v.Z.endCompleteAction())}},{key:"getSwipeMenuItems",value:function(e){var t=e.item;return{left:[{icon:"check",text:t.isComplete()?"Uncomplete":"Complete",backgroundColor:"#0c0",onActivated:this.completeOnSwipe.bind(this,t)}],right:[{icon:e.isCollapsed()?"angle-right":"angle-down",backgroundColor:"#777",onActivated:this.collapseOnSwipe.bind(this,t)},{icon:"zoom-in",backgroundColor:"#09d",onActivated:this.zoomInOnSwipe.bind(this,t)},{icon:"delete",backgroundColor:"#a30",onActivated:this.deleteOnSwipe.bind(this,t)}]}}},{key:"_openSelectedInMode",value:function(e){var t=Z.Z.getStartItem();t&&this.openEmailByItem(t,e)}},{key:"replySelected",value:function(){this._openSelectedInMode(m.Z.EmailResponseMode.Reply)}},{key:"replyAllSelected",value:function(){this._openSelectedInMode(m.Z.EmailResponseMode.ReplyAll)}},{key:"forwardSelected",value:function(){this._openSelectedInMode(m.Z.EmailResponseMode.Forward)}},{key:"openEmailByItem",value:function(e,t){if(e){var n=e.getAttachmentByPlugin(m.Z.PluginID.Gmail);(n&&n!==w.default.EmailPreview.getThreadAttach()||!w.default.EmailPreview.isOpenOnPane(this)||t)&&n.getPlugin().openEmailByItem(e,this,t)}}},{key:"markItemRead",value:function(e,t){var n=w.default.pluginManager.getPluginGmail(),r=t.getAttachmentByPlugin(n.id),i=e?m.Z.PluginAction.Gmail.MarkRead:m.Z.PluginAction.Gmail.MarkUnread;try{v.Z.PAssert(1337,r,"Must be able to get a valid attachment")}catch(a){v.Z.reportError(a)}(e&&n.isItemUnread(t)||!e&&!n.isItemUnread(t))&&n.performAction(i,!1,r)}},{key:"markReadSelected",value:function(e){var t=w.default.pluginManager.getPluginGmail();t.beginAction(),this.applyToSelection(this.markItemRead.bind(this,e)),t.endAction()}},{key:"toggleStarSelected",value:function(){var e,t=w.default.pluginManager.getPluginGmail();t.beginAction(),this.applyToSelection((function(n){var r=n.getAttachmentByPlugin(t.id);try{v.Z.PAssert(1338,r,"Must be able to get a valid attachment")}catch(a){v.Z.reportError(a)}var i=t.isItemStarred(n);void 0===e&&(e=i?m.Z.PluginAction.Gmail.Unstar:m.Z.PluginAction.Gmail.Star),(i&&e===m.Z.PluginAction.Gmail.Unstar||!i&&e===m.Z.PluginAction.Gmail.Star)&&t.performAction(e,!1,r)})),t.endAction()}},{key:"selectIndex",value:function(e,t){Z.Z.selectIndex(e,t||0)}},{key:"onAdded",value:function(){this.isEditable&&this.isWriteable&&setTimeout(this.selectFirstItem.bind(this),0)}},{key:"selectFirstItem",value:function(){this.isWriteable&&0===this.numItems()&&this.canAddItem&&this.addItem();var e=this.indexOfFirstItem();e>=0&&Z.Z.selectIndex(e,0)}},{key:"isOverviewVisibleInPane",value:function(e){var t=this.item.get();return e===t||e.isDescendantOf(t)}},{key:"getContentWidth",value:function(){return this.getWidth()}},{key:"getContentHeight",value:function(){return this.getHeight()}},{key:"getMinItemSize",value:function(){return Math.ceil(w.default.DisplaySettings.itemLineHeight()+2*w.default.DisplaySettings.itemPadding()+(w.default.DisplaySettings.noteLineHeight()+w.default.DisplaySettings.itemPadding()))/2}},{key:"onZoom",value:function(){}},{key:"widthOfDrag",value:function(e){}},{key:"getSubItems",value:function(e,t){var n=[],r={item:e,comparator:this.search.isMatched,pane:this,each:function(e){t&&e.isComplete()||n.push(e)}};return this.runItemSearch(r),n}},{key:"isItemInPane",value:function(e){var t;return(null===(t=this.paneObjectsByItem[e.id])||void 0===t?void 0:t.length)>0}},{key:"isItemTopLevel",value:function(e){return e.item.levelsDeep.get()-this.item.get().levelsDeep.get()===1}},{key:"getCollapsedDefault",value:function(e,t,n){return!1}},{key:"isViewProject",value:function(){return!1}},{key:"isViewDates",value:function(){return!1}},{key:"isViewAgenda",value:function(){return!1}},{key:"isViewCalendar",value:function(){return!1}},{key:"isViewOutline",value:function(){return!1}},{key:"isViewText",value:function(){return!0}},{key:"isViewFlatList",value:function(){return!1}},{key:"shouldShowAddBox",value:function(){return!1}},{key:"isViewAutoBlocks",value:function(){return!1}},{key:"isViewTag",value:function(){return!1}},{key:"canScrollToItem",value:function(){return!1}},{key:"getSortModeBlocks",value:function(){}},{key:"getSortModeItems",value:function(){}},{key:"isCalFilterActive",value:function(){return!1}},{key:"isViewItems",value:function(){return!1}},{key:"isViewArchived",value:function(){return!1}},{key:"isViewDeleted",value:function(){return!1}},{key:"viewModeIcon",value:function(){return""}},{key:"viewModeColor",value:function(){return""}},{key:"createVMLI",value:function(e,t){t.documentOwner=this.getDocument();var n=U.Z.createVMLI(e,t);return this.search.stickMatch(n),n}},{key:"createTempVMLI",value:function(e,t){t.documentOwner=this.getDocument();var n=U.Z.createVMLI(e,t);return this.search.stickMatch(n),n}},{key:"selectNearestItem",value:function(e){w.default.PaneUpdateBatcher.flushItemsUpdate(this);var t=this.findNextItem(e);t&&Z.Z.selectObject(t,0)}},{key:"supportsSortBlocks",value:function(){return!1}},{key:"supportsSortBlocksMode",value:function(e,t){return!1}},{key:"supportsSortItems",value:function(){return!1}},{key:"getViewMode",value:function(){return""}},{key:"scrollToTop",value:function(e){this.initialScrollIndex=0,this.listManager.scrollToIndex(0,"start",e)}},{key:"setName",value:function(e){this.name.set(e),w.default.PaneManager.savePaneState()}},{key:"setWidthManual",value:function(e,t){isNaN(e)?this.widthManual=this.widthManualExpanded=e:t?(e=v.Z.clamp(e,m.Z.EmailPreviewSizeMin,m.Z.EmailPreviewSizeMax),this.widthManualExpanded=e):(e=v.Z.clamp(e,this.minWidth,this.maxWidth),this.widthManual=e),this.saveState(),w.default.PaneManager.updatePaneRects(!isNaN(e))}},{key:"getCollapsedField",value:function(e){return e?m.Z.PerPaneStateField.CollapsedOverview:this.collapsedFieldName}},{key:"isCollapsedByID",value:function(e,t,n){var r;if(!n&&!this.canCollapse()||null!==t&&void 0!==t&&t.isNote())return!1;var i=this.isSearchedText()?null!==(r=this.getPerPaneState(e,m.Z.PerPaneStateField.CollapsedSearch))&&void 0!==r?r:t?this.getPerPaneState(t.id,m.Z.PerPaneStateField.CollapsedSearch):void 0:void 0;if(void 0===i){var a,o=this.getCollapsedField(n);i=null!==(a=this.getPerPaneState(e,o))&&void 0!==a?a:t?this.getPerPaneState(t.id,o):void 0,t&&void 0===i&&(i=t.isDemandLoad()?0===t.numItems()||!this.isSearched()&&!n:this.getCollapsedDefault(t,n))}return!!i}},{key:"isPaneObjectCollapsed",value:function(e){var t=e.id,n=e.item,r=e.overview;return this.isCollapsedByID(t,n,r)}},{key:"setPaneObjectCollapsed",value:function(e,t,n){var r=e.id,i=e.item,a=e.overview;if(t&&i&&(null===i||void 0===i||!i.isCollapsible()))return!1;var o=this.isPaneObjectCollapsed(e);if(void 0!==t){this.isSearchedText()&&(i&&i.id!==r&&!this.paneObjectsByItem[i.id]&&this.setPerPaneState(i.id,m.Z.PerPaneStateField.CollapsedSearch,void 0),this.setPerPaneState(r,m.Z.PerPaneStateField.CollapsedSearch,void 0));var s=this.getCollapsedField(a);i&&i.id!==r&&!this.paneObjectsByItem[i.id]&&this.setPerPaneState(i.id,s,void 0),this.setPerPaneState(r,s,t),!1!==n&&w.default.PaneManager.updatePaneStateForPane(this),a?this.updateHeaders():(w.default.onIntroAction("Collapse"),null!==i&&void 0!==i&&i.isDemandLoad()&&i.notifyDemandLoadUpdate(!t,v.Z.focusedPane),t!==o&&this.updateItems())}null===i||void 0===i||i.itemChanged.notify()}},{key:"shouldRenderPrefix",value:function(e){return!0}},{key:"needsUpdateForDate",value:function(){return!1}},{key:"needsUpdateForTags",value:function(e){return!1}},{key:"needsUpdateForPriority",value:function(){return!1}},{key:"needsUpdateForModified",value:function(){return!1}},{key:"needsUpdateForLinkedTo",value:function(e){return!1}},{key:"needsSearchUpdateForPriority",value:function(){return this.search.getFilterValue("filter")}},{key:"handleItemChanged",value:function(e,t,n){var r=this.listManager;if(n=n||!1,t.Complete&&(n=!0),(t.Items||t.Indent)&&(w.default.DisplaySettings.boldHeaders()&&r.clearItemInfoForItem(e),n=!0),t.Text&&(r.handleItemTextChanged(e)&&(this.itemsHeightDirty=!0),this.supportSearchListenTextChanges)){var i=this.search.handleItemTextChanged(e);n=n||i}if(t.Header&&this.isViewProject()&&(n=!0),t.Search||t.Date&&this.search.isSearchingDate()){var a=this.search.handleItemChanged(e);n=n||a}if(t.Priority){var o=this.search.handleItemChanged(e);o||(o=this.needsUpdateForPriority()),n=n||o}if(t.Modified&&(n=n||this.needsUpdateForModified()),(t.Date||t.RepeatDateCompleted)&&(n=n||this.needsUpdateForDate()),t.Tags&&(n=n||this.needsUpdateForTags(t.Tags)),t.LinkedTo&&(n=n||this.needsUpdateForLinkedTo(t.item)),this.onItemPreloadUpdated.notify(e),n)return(t.RepeatDateCompleted||t.Complete||!this.preventUpdateItemsForObject||this.preventUpdateItemsForObject.item!==e)&&this.setItemsDirty(),!0}},{key:"addPaneObject",value:function(e,t,n){if(this.paneObjects[t.id]){var r,i,a,o,s,c,l,u,d;v.Z.reportError(new Error("Duplicate pane object"),{id:t.id,paneID:this.id,parentID1:null===(r=t.item)||void 0===r||null===(i=r.parent())||void 0===i?void 0:i.id,parentID2:null===(a=this.paneObjects[t.id].item)||void 0===a||null===(o=a.parent())||void 0===o?void 0:o.id,docID1:null===(s=t.item)||void 0===s||null===(c=s.getDocumentOwner())||void 0===c?void 0:c.id,docID2:null===(l=this.paneObjects[t.id].item)||void 0===l||null===(u=l.getDocumentOwner())||void 0===u?void 0:u.id,viewMode:null===(d=this.viewState)||void 0===d?void 0:d.get()})}else{var h=t.item;n||e.push(t),t.parentObject&&t.parentObject.children.push(t),h&&(this.paneObjects[t.id]=t,this._hasCollapsedDuringAdd||(this._hasCollapsedDuringAdd=this.isPaneObjectCollapsed(t)),this.paneObjectsByItem[h.id]?this.paneObjectsByItem[h.id].push(t):this.paneObjectsByItem[h.id]=[t])}}},{key:"getPaneObjectsForItem",value:function(e){return this.paneObjectsByItem[e.id]}},{key:"_zoom",value:function(e,t,n,r){try{v.Z.PAssert(1339,e,"Must supply a valid item to zoom to")}catch(a){v.Z.reportError(a)}if(e){t||(this.scrollToTop("auto"),this.initialScrollIndex=0);var i=this.item.get();if(i&&i.id===e.id)return;Z.Z.reset(),this.setItem(e,!0,n,r),v.Z.focusedItem=e,t||this.saveState()}}},{key:"zoomIn",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{v.Z.PAssert(1340,e,"Must supply a valid item to zoom to")}catch(c){v.Z.reportError(c)}if(e){var r=n.forLoad,i=n.showToast,a=(n.noSel,n.noUpdateItems),o=n.fromUndo,s=this.item.get();this._zoom(e,r,a,o),e.isDemandLoad()&&e.notifyDemandLoadUpdate(!0,this),r||v.Z.sendEvent("Menu","ZoomIn"),this.isLoaded&&this.onZoom(),r||w.default.onIntroAction("Zoom"),i&&w.default.toasts.pushMessage({text:"Zoomed into "+e.getParsedTextWithoutPrefix(),actionText:"UNDO",hold:!1,action:function(){t.zoomIn(s)}})}}},{key:"zoomOut",value:function(e,t){try{v.Z.PAssert(1341,e,"Must supply a valid item to zoom to")}catch(n){v.Z.reportError(n)}Z.Z.save()||Z.Z.getPreviousSelection();this._zoom(e,!1),v.Z.sendEvent("Menu","ZoomOut")}},{key:"openDocumentAndScrollToItem",value:function(e){var t=e.getDocumentOwner();t&&t!==this.getDocument()&&this.zoomIn(t.getRootItem()),this.scrollItemToMiddle(e,"auto")}},{key:"getDocument",value:function(){return this.document.get()}},{key:"setDocument",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.forLoad,r=t.noUpdateItems,i=t.zoomItem,a=e!==this.document.get();a&&(this.setIgnoreRestoreScroll(1e3),this.zoomIn(null!==i&&void 0!==i?i:null===e||void 0===e?void 0:e.getRootItem(),{forLoad:n,noUpdateItems:r}))}},{key:"openItemEditor",value:function(e){e.pane=this,w.default.menus.openItemEditor(e)}},{key:"preventUpdateForObject",value:function(e){this.preventUpdateItemsForObject=e,this.search.stickMatch(e.item)}},{key:"clearPreventUpdate",value:function(e){}},{key:"getVisibleChildren",value:function(e){for(var t=0,n=e.item,r=this.getItems(),i=[],a=e.index;a<r.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=r[a],s=o.item;s&&s.isDescendantOf(n)&&i.push(o)}return i}},{key:"isItemBold",value:function(e){return e.isHeader()&&w.default.DisplaySettings.boldHeaders()}},{key:"onRemoteUpdate",value:function(e){if(this.usesVMLIs&&e.item!==this.getItem().id){var t=U.Z.getItem(e.item);t&&this.zoomIn(t)}void 0!==e.documentSortMode&&this.documentSortMode.set(e.documentSortMode),this.name.set(e.name),this.widthManual=e.widthManual,this.widthManualExpanded=e.widthManualExpanded,_.Z.supportsMultiplePanes.get()&&this.overview.setVisibility(e.isOverviewVisible),void 0!==e.search&&this.search.onRemoteUpdate(e.search)}},{key:"goBack",value:function(){var e=this.history.get(),t=e[e.length-1];if(t){if(t.item&&t.item!==this.getItem().id){var n=U.Z.getItem(t.item);n&&this.zoomIn(n,{fromUndo:!0})}var r;if(void 0!==t.search)this.search.onRemoteUpdate(t.search,!0),null===(r=this.onViewStateChanged)||void 0===r||r.call(this);this.history.splice(e.length-1,1)}}},{key:"_setRect",value:function(e){this._cachedWidth=e.width,this._cachedMaxWidths={},this.rect.set(e)}},{key:"canCollapse",value:function(){return this.supportCollapsing}},{key:"getDeferredItem",value:function(e){}},{key:"pushHistory",value:function(e){var t=this.history.get();t.length>10&&t.splice(0,1),t.push(e),this.history.set(t)}},{key:"itemLevelsDeep",value:function(e,t){return e.levelsDeep.get()-(t?t.levelsDeep.get():this.item.get().levelsDeep.get()+1)}},{key:"itemPrefixHeaderLevel",value:function(e){var t=this.itemLevelsDeep(e)+1;return e.isPrefixHeader()?Math.min(e.prefix.length+t-1,4):0}},{key:"canZoomToItem",value:function(e){return e.canZoom()}},{key:"createVMLIsToDrop",value:function(e,t){return e.items.map((function(e){return e.item}))}},{key:"onDoubleClick",value:function(e,t){}},{key:"searchPaneObjects",value:function(e){var t=this,n=e.toLowerCase().split(" ");return this.items.get().filter((function(e){return n.every((function(n){var r;return null===(r=e.item)||void 0===r?void 0:r.getSearchText(t).includes(n)}))}))}},{key:"isPopupOpen",value:function(){return this.isSearchingGlobal.get()}},{key:"getMobileIcon",value:function(){}},{key:"getActionSheetItems",value:function(){}},{key:"getPaneObjectID",value:function(e,t,n){return e.id+(null!==t&&void 0!==t&&t.id?"~"+t.id:"")+(n?"~"+n.join("~"):"")}},{key:"getPaneObjectIDNonItem",value:function(e){return"p~"+e}},{key:"hasCollapsedBlocks",value:function(){return!1}}],[{key:"getPluginID",value:function(){}}]),e}(),h()(ee.prototype,"saveState",[g.ZP],Object.getOwnPropertyDescriptor(ee.prototype,"saveState"),ee.prototype),h()(ee.prototype,"onTapOverviewButton",[g.ZP],Object.getOwnPropertyDescriptor(ee.prototype,"onTapOverviewButton"),ee.prototype),h()(ee.prototype,"onClickReportError",[g.ZP],Object.getOwnPropertyDescriptor(ee.prototype,"onClickReportError"),ee.prototype),h()(ee.prototype,"archiveCompleted",[g.ZP],Object.getOwnPropertyDescriptor(ee.prototype,"archiveCompleted"),ee.prototype),h()(ee.prototype,"onDocumentsChanged",[g.ZP],Object.getOwnPropertyDescriptor(ee.prototype,"onDocumentsChanged"),ee.prototype),ee);S.Z.extendClass(ae,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:oe,t=function(e){I()(n,e);var t=B(n);function n(){return c()(this,n),t.apply(this,arguments)}return u()(n,[{key:"constructorExtra",value:function(){S.Z.binder(this,"compositionStart","compositionEnd","onInput","onInputSetText")}},{key:"compositionStart",value:function(){_.Z.isAndroid||(Z.Z.isComposing=!0,this.compositionOffset=Z.Z.getStartOffset())}},{key:"compositionEnd",value:function(e){_.Z.isAndroid||(Z.Z.isComposing=!1,this.onInput(e),this.compositionOffset=void 0)}},{key:"onBeforeInput",value:function(e){var t=L.Z.getSelectionRangeNative(),n=L.Z.getSelectOffsetsInElement(e.target,t);N.Z.setOffsetsBeforeInput(n)}},{key:"onInput",value:function(e){var t=this;if(Z.Z.isValid()){for(var n,r,i,a=0,o=Z.Z.save(),s=Z.Z.getStartObject(),c=e.target.children,l=L.Z.getSelectionRangeNative(),u=Z.Z.getStartItem(),d=u.isPrefixCodeBlock(),h=0;h<c.length;h++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var p=c[h],f=+p.getAttribute("data-index");if(f===s.index||"BR"===p.nodeName&&i+1===s.index)if(n){var g=L.Z.getSelectOffsetsInElement(p,l),y=d?1:0;r={start:r.total+y,end:r.total+y,total:r.total+g.total+y},n.append("\n"),n.append(p)}else n=p,r=L.Z.getSelectOffsetsInElement(n,l);i=f}if(n){var k=v.Z.convertElementToText(n).replace(m.Z.TextSpaceRegexp,""),_=s.getDisplayLengthWithoutPrefix(),b=!1;if(!d){var P=k.split(m.Z.Chars.CarriageReturn);P.length>1&&(k=P.join(""),b=!0)}var S=function(){T.Z.beginBatch({item:u,pane:!0,undo:!0});var n=N.Z.onInput(s,k);t.onInputSetText(s,u,n,r.end,_,e),b&&O.Z.handleEnter(),T.Z.commitBatch()};u.isMirrorOrMirrored()&&k.length===u.getPrefixLength()?w.default.menus.confirm("This item is mirrored. Are you sure you want to delete all its text?",(function(e){e?S():o&&Z.Z.restore(o)})):S()}}}},{key:"onInputSetText",value:function(e,t,n,r,i,a){n=n.replace(m.Z.TextSpaceRegexp,"");var o=R.Z.checkMultiplePrefixes(n);o!==n&&("==="!==o&&(r-=n.length-o.length),n=o);var s=n.length===t.getRawText().length-1;this.isSettingTextFromInput=!0;var c=t.getPrefixLength();t.setText(n,m.Z.ChangeType.Local);var l=t.getPrefixLength()-c;l>0&&(r=Math.max(0,r-l));var u=e.getDisplayLengthWithoutPrefix();r>=0&&u!==i&&(r=t.elsNew.adjustOffsetAroundUneditables(e,r,u>i?-1:1)),"insertCompositionText"===a.inputType?F.Z.savedRange=void 0:Z.Z.selectObject(e,r,r,{fromInput:!0}),this.isSettingTextFromInput=!1,s&&!M.Z.isShowing()||O.Z.updateAutocomplete()}},{key:"keydown",value:function(e){if(e.handled)return!0;if(e.normCode===m.Z.KeyCode.Escape&&this.searchingPaneObjects.get().isSearching)return this.searchingPaneObjects.setProperty("isSearching",!1),!0;if(w.default.tooltip.hideTip(),this.isWriteable&&0===this.numItems()&&this.canAddItem&&!v.Z.hasClass(this.paneContent,"loading")&&m.Z.KeyCodesModifiers.indexOf(e.normCode)<0&&m.Z.KeyCodesArrows.indexOf(e.normCode)<0&&this.addItem(),Z.Z.isValid())if(e.normCode===m.Z.KeyCode.ContextMenu&&_.Z.windows)w.default.menus.openItemContextMenu(Z.Z.getStartObject());else{0!==this.numItems()||v.Z.hasClass(this.paneContent,"loading")||this.addItem();try{O.Z.keydown(e)||v.Z.preventAndStop(e)}catch(t){v.Z.reportError(t,e)}}}},{key:"keypress",value:function(e){if(Z.Z.isValid())try{O.Z.keypress(e)||(v.Z.preventDefault(e),v.Z.stopPropagation(e))}catch(t){v.Z.reportError(t,e)}}},{key:"keyup",value:function(e){if(v.Z.notifyActivity(),Z.Z.isValid())try{O.Z.keyup(e)||(v.Z.preventDefault(e),v.Z.stopPropagation(e))}catch(t){v.Z.reportError(t,e)}}},{key:"setRect",value:function(e){v.Z.deepEqual(e,this.rect.get())||(y.Z.disable(!0),this._setRect(e))}}]),n}(e);return t}(ae),!0);const oe=ae},1558:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var r,i=n(4575),a=n.n(i),o=n(3913),s=n.n(o),c=n(8651),l=n(3124),u=n.n(l),d=n(8572),h=n(8855);const p=(r=function(){function e(t,n){a()(this,e),this._batchConstructor=t,this._batchParams=n,this._batchedRequests={},this._successCB=c.Z.emptyFn,this._failureCB=c.Z.emptyFn,this._context=void 0,this._hasRun=!1,this._batchID=c.Z.generateTempId()}return s()(e,[{key:"add",value:function(e,t,n){try{c.Z.PAssert(1283,e,"Must provide a valid request to add to batch")}catch(i){c.Z.reportError(i)}try{c.Z.PAssert(1284,t,"Must supply a valid group ID when adding to a batch")}catch(i){c.Z.reportError(i)}try{c.Z.PAssert(1285,!this._hasRun,"Should never add new requests to a batch that has already run")}catch(i){c.Z.reportError(i)}var r=this._ensureGroup(t);return this._addRequestToGroup(t,n,e),r}},{key:"then",value:function(e,t,n){this._successCB=e||c.Z.newEmptyFn(),this._failureCB=t||c.Z.newEmptyFn(),this._context=n,this._run()}},{key:"execute",value:function(e){this._successCB=e,this._failureCB=e,this._run()}},{key:"getBatchID",value:function(){return this._batchID}},{key:"_ensureGroup",value:function(e){var t=!1;return this._batchedRequests[e]||(this._batchedRequests[e]={size:0,batch:this._createBatchInternal()},t=!0),t}},{key:"_addRequestToGroup",value:function(e,t,n){var r=this._getGroupBatch(e),i=this._getGroupSize(e);try{c.Z.PAssert(1286,i<=h.Z.MaxBatchSize,"Too many requests for a single batch")}catch(a){c.Z.reportError(a)}t?r.add(n,{id:t}):r.add(n)}},{key:"_getGroupBatch",value:function(e){try{c.Z.PAssert(1287,this._batchedRequests[e],"Must ensure before querying")}catch(t){c.Z.reportError(t)}return this._batchedRequests[e].batch}},{key:"_getGroupSize",value:function(e){try{c.Z.PAssert(1288,this._batchedRequests[e],"Must ensure before querying")}catch(t){c.Z.reportError(t)}return this._batchedRequests[e].size}},{key:"_run",value:function(){try{c.Z.PAssert(1289,!this._hasRun,"Should never run a batch twice")}catch(t){c.Z.reportError(t)}for(var e in this._hasRun=!0,this._batchedRequests){this._getGroupBatch(e).then(this._handleSuccess,this._handleFailure)}}},{key:"_createBatchInternal",value:function(){return new this._batchConstructor(this._batchParams)}},{key:"_handleSuccess",value:function(e){try{c.Z.PAssert(1290,this._hasRun,"Must run batch before success")}catch(t){c.Z.reportError(t)}this._successCB.call(this._context,e)}},{key:"_handleFailure",value:function(e){try{c.Z.PAssert(1291,this._hasRun,"Must run batch before failure")}catch(t){c.Z.reportError(t)}this._failureCB.call(this._context,e)}}]),e}(),u()(r.prototype,"_handleSuccess",[d.ZP],Object.getOwnPropertyDescriptor(r.prototype,"_handleSuccess"),r.prototype),u()(r.prototype,"_handleFailure",[d.ZP],Object.getOwnPropertyDescriptor(r.prototype,"_handleFailure"),r.prototype),r);var f=n(8926),g=n.n(f),m=n(7757),v=n.n(m),y=n(1186);const k=function(){function e(t){var n=t.path,r=t.type,i=t.data,o=t.headers,s=t.accountID,c=t.scopes;a()(this,e),this.numRetries=0,this.path=n,this.type=r,this.data=i,this.headers=o,this.accountID=s,this.scopes=c}return s()(e,[{key:"setInBatch",value:function(e){this.idInBatch=e}},{key:"getAuthorizationHeader",value:function(){var e=g()(v().mark((function e(){var t=this;return v().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(this.accessToken){e.next=4;break}return e.next=3,new Promise((function(e){return y.Z.getAccountAuthToken(t.accountID,t.scopes,(function(t){return e(null===t||void 0===t?void 0:t.access_token)}))}));case 3:this.accessToken=e.sent;case 4:return e.abrupt("return",this.accessToken?"Bearer "+this.accessToken:void 0);case 5:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"then",value:function(){var e=g()(v().mark((function e(t,n){var r=this;return v().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.idInBatch){e.next=5;break}this.onFullfilled=t,this.onRejected=n,e.next=13;break;case 5:if(this.headers||(this.headers={}),this.headers["Content-Type"]||(this.headers["Content-Type"]="application/json"),this.headers.Authorization){e.next=11;break}return e.next=10,this.getAuthorizationHeader();case 10:this.headers.Authorization=e.sent;case 11:this.data&&c.Z.isObject(this.data)&&(this.data=JSON.stringify(this.data)),c.Z.XHR({url:"https://www.googleapis.com".concat(this.path),type:this.type,data:this.data,headers:this.headers}).then(function(){var e=g()(v().mark((function e(i){var a,o,s,c,l;return v().wrap((function(e){for(var u=0,d=0;;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(!i.text){e.next=5;break}return e.next=3,i.text();case 3:a=e.sent;try{(a&&"{"===a[0]||"["===a[0])&&(o=JSON.parse(a))}catch(h){}case 5:i.error?n(i.error):null!==(s=o)&&void 0!==s&&null!==(c=s.error)&&void 0!==c&&null!==(l=c.message)&&void 0!==l&&l.startsWith("Request had invalid authentication credentials.")&&r.numRetries<5?r.retry(t,n):t({body:a,status:i.status,result:o,headers:r.headers});case 6:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}(),n);case 13:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"retry",value:function(e,t){var n=this;this.numRetries++,this.headers.Authorization=void 0,this.accessToken=void 0,setTimeout((function(){n.then(e,t)}),5e3)}},{key:"resolve",value:function(e){this.onFullfilled(e)}},{key:"reject",value:function(e){this.onRejected(e)}}]),e}();var _,Z="MOOBOUNDARY";const w=(_=function(){function e(t){var n=t.accountID,r=t.scopes;a()(this,e),this.requests={},this.accountID=n,this.scopes=r}return s()(e,[{key:"add",value:function(e,t){var n=t.id;this.requests[n]=e,e.setInBatch(n)}},{key:"then",value:function(){var e=g()(v().mark((function e(t,n){var r,i,a,o,s=this;return v().wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:return this.onFulfilled=t,this.onRejected=n,r=this.requests[Object.keys(this.requests)[0]],this.requests,i="",e.next=7,r.getAuthorizationHeader();case 7:a=e.sent,Object.keys(this.requests).forEach((function(e){var t=s.requests[e],n="--".concat(Z,"\n");n+="Content-Type: application/http\n",n+="Content-ID: <".concat(t.idInBatch,">\n");var r=t.type+" "+t.path+"\n";"GET"!==t.type&&(t.headers&&(t.headers["Content-Type"]||(t.headers["Content-Type"]="application/json"),r+=Object.keys(t.headers).map((function(e){if("Authorization"!==e)return"".concat(e,": ").concat(t.headers[e],"\n")})).filter((function(e){return!!e})).join("")+"\n"),t.data&&(r+=JSON.stringify(t.data))),i+=n+="\n"+r+"\n",o||(o=t.path.split("/").slice(1,3).join("/"))})),i+="--".concat(Z,"--");try{c.Z.PAssert(1265,o&&"v"===o[o.length-2],"batch root does not have a version")}catch(u){c.Z.reportError(u)}new k({path:"/batch/".concat(o),type:"POST",data:i,headers:{Authorization:a,"Content-Type":'multipart/mixed; boundary="MOOBOUNDARY"'},accountID:this.accountID,scopes:this.scopes}).then(this._handleSuccess,this._handleFail);case 13:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_handlePart",value:function(e){var t,n;try{var r=e.substring(e.indexOf("{"),e.lastIndexOf("}")+1);t=e.match(/Content-ID: <response-([^>]+)>/)[1],n=e.match(/204 No Content/)?{status:204}:JSON.parse(r),e.includes('WWW-Authenticate: Bearer realm="https://accounts.google.com/", error=invalid_token')&&(n.isInvalidToken=!0),this.requests[t].resolve({result:n})}catch(i){t&&this.requests[t].reject({errors:[{message:e}]})}}},{key:"_handleSuccess",value:function(){var e=g()(v().mark((function e(t){var n,r,i;return v().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:n=t.body.trim(),r=n.substr(0,n.indexOf("\r\n")),(i=n.split(r)).shift(),i.pop(),i.forEach(this._handlePart),this.onFulfilled();case 5:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_handleFail",value:function(e){this.onRejected(e)}}]),e}(),u()(_.prototype,"_handlePart",[d.ZP],Object.getOwnPropertyDescriptor(_.prototype,"_handlePart"),_.prototype),u()(_.prototype,"_handleSuccess",[d.ZP],Object.getOwnPropertyDescriptor(_.prototype,"_handleSuccess"),_.prototype),u()(_.prototype,"_handleFail",[d.ZP],Object.getOwnPropertyDescriptor(_.prototype,"_handleFail"),_.prototype),_);const b=new(function(){function e(){a()(this,e),this._data={gapi:{client:{drive:{files:{get:{path:"/drive/v2/files/{fileId}",method:"GET",packedFn:["gapi","client","drive","files","get"]},export:{path:"/drive/v2/files/{fileId}/export",method:"GET",packedFn:["gapi","client","drive","files","export"]},list:{path:"/drive/v2/files",method:"GET",packedFn:["gapi","client","drive","files","list"]},trash:{path:"/drive/v2/files/{fileId}/trash",method:"POST",packedFn:["gapi","client","drive","files","trash"]},untrash:{path:"/drive/v2/files/{fileId}/untrash",method:"POST",packedFn:["gapi","client","drive","files","untrash"]},insert:{path:"/drive/v2/files",method:"POST",packedFn:["gapi","client","drive","files","insert"]},patch:{path:"/drive/v2/files/{fileId}",method:"PATCH",packedFn:["gapi","client","drive","files","patch"]}},permissions:{list:{path:"/drive/v2/files/{fileId}/permissions",method:"GET",packedFn:["gapi","client","drive","permissions","list"]},insert:{path:"/drive/v2/files/{fileId}/permissions",method:"POST",packedFn:["gapi","client","drive","permissions","insert"]},delete:{path:"/drive/v2/files/{fileId}/permissions/{permissionId}",method:"DELETE",packedFn:["gapi","client","drive","permissions","delete"]}},properties:{insert:{path:"/drive/v2/files/{fileId}/properties",method:"POST",packedFn:["gapi","client","drive","properties","insert"]},update:{path:"/drive/v2/files/{fileId}/properties/{propertyKey}",method:"PUT",packedFn:["gapi","client","drive","properties","update"]}},parents:{insert:{path:"/drive/v2/files/{fileId}/parents",method:"POST",packedFn:["gapi","client","drive","parents","insert"]},delete:{path:"/drive/v2/files/{fileId}/parents/{parentId}",method:"DELETE",packedFn:["gapi","client","drive","parents","delete"]}},changes:{list:{path:"/drive/v2/changes",method:"GET",packedFn:["gapi","client","drive","changes","list"]}},children:{list:{path:"/drive/v2/files/{folderId}/children",method:"GET",packedFn:["gapi","client","drive","children","list"]},delete:{path:"/drive/v2/files/{folderId}/children/{childId}",method:"DELETE",packedFn:["gapi","client","drive","children","delete"]}},realtime:{get:{path:"/drive/v2/files/{fileId}/realtime",method:"GET",packedFn:["gapi","client","drive","realtime","get"]}}},gmail:{users:{threads:{list:{path:"/gmail/v1/users/{userId}/threads",method:"GET",packedFn:["gapi","client","gmail","users","threads","list"]},get:{path:"/gmail/v1/users/{userId}/threads/{id}",method:"GET",packedFn:["gapi","client","gmail","users","threads","get"]},modify:{path:"/gmail/v1/users/{userId}/threads/{id}/modify",method:"POST",packedFn:["gapi","client","gmail","users","threads","modify"]},trash:{path:"/gmail/v1/users/{userId}/threads/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","threads","trash"]},untrash:{path:"/gmail/v1/users/{userId}/threads/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","threads","untrash"]}},labels:{list:{path:"/gmail/v1/users/{userId}/labels",method:"GET",packedFn:["gapi","client","gmail","users","labels","list"]},create:{path:"/gmail/v1/users/{userId}/labels",method:"POST",packedFn:["gapi","client","gmail","users","labels","create"]}},history:{list:{path:"/gmail/v1/users/{userId}/history",method:"GET",packedFn:["gapi","client","gmail","users","history","list"]}},messages:{get:{path:"/gmail/v1/users/{userId}/messages/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","get"]},send:{path:"/gmail/v1/users/{userId}/messages/send",method:"POST",packedFn:["gapi","client","gmail","users","messages","send"]},trash:{path:"/gmail/v1/users/{userId}/messages/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","messages","trash"]},untrash:{path:"/gmail/v1/users/{userId}/messages/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","messages","untrash"]},attachments:{get:{path:"/gmail/v1/users/{userId}/messages/{messageId}/attachments/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","attachments","get"]}}},drafts:{create:{path:"/gmail/v1/users/{userId}/drafts",method:"POST",packedFn:["gapi","client","gmail","users","drafts","create"]},update:{path:"/gmail/v1/users/{userId}/drafts/{id}",method:"PUT",packedFn:["gapi","client","gmail","users","drafts","update"]},send:{path:"/gmail/v1/users/{userId}/drafts/send",method:"POST",packedFn:["gapi","client","gmail","users","drafts","send"]},delete:{path:"/gmail/v1/users/{userId}/drafts/delete",method:"DELETE",packedFn:["gapi","client","gmail","users","drafts","delete"]},list:{path:"/gmail/v1/users/{userId}/drafts",method:"GET",packedFn:["gapi","client","gmail","users","drafts","list"]}},settings:{sendAs:{list:{path:"/gmail/v1/users/{userId}/settings/sendAs",method:"GET",packedFn:["gapi","client","gmail","users","settings","sendAs","list"]}}}}},calendar:{settings:{list:{path:"/calendar/v3/users/{userId}/settings",method:"GET",packedFn:["gapi","client","calendar","settings","list"]}},events:{get:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"GET",packedFn:["gapi","client","calendar","events","get"]},list:{path:"/calendar/v3/calendars/{calendarId}/events",method:"GET",packedFn:["gapi","client","calendar","events","list"]},patch:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"PATCH",packedFn:["gapi","client","calendar","events","patch"]},insert:{path:"/calendar/v3/calendars/{calendarId}/events",method:"POST",packedFn:["gapi","client","calendar","events","insert"]},move:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}/move",method:"POST",packedFn:["gapi","client","calendar","events","move"]},delete:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"DELETE",packedFn:["gapi","client","calendar","events","delete"]}},calendars:{insert:{path:"/calendar/v3/calendars",method:"POST",packedFn:["gapi","client","calendar","calendars","insert"]}},calendarList:{list:{path:"/calendar/v3/users/{userId}/calendarList",method:"GET",packedFn:["gapi","client","calendar","calendarList","list"]}}}}}}}return s()(e,[{key:"fns",value:function(e){return this._data.gapi.client[e]}},{key:"_constructPath",value:function(e,t){var n=c.Z.clone(t);return Object.keys(t).forEach((function(r){var i=new RegExp("\\{"+r+"\\}"),a=e.replace(i,encodeURIComponent(t[r]));a!==e&&delete n[r],e=a})),delete n.resource,delete n.timeoutMS,delete n.forceNoDupe,{path:e,fields:n}}},{key:"_constructHeaders",value:function(e,t,n){try{c.Z.PAssert(1037,t||n,"Must have either accountID or token")}catch(i){c.Z.reportError(i)}var r={};return n&&(r.Authorization="Bearer "+n),e&&Object.keys(e).forEach((function(t){r[t]=e[t]})),r}},{key:"canConstruct",value:function(e){var t=!1;return c.Z.isFunction(e)||(t=!!c.Z.unpackFn(e,this._data)),t}},{key:"createRequest",value:function(e,t,n,r,i){var a,o=c.Z.unpackFn(t,this._data);try{c.Z.PAssert(1038,o,"Function should always be unpackable")}catch(d){c.Z.reportError(d)}if(o){var s=this._constructPath(o.path,n),l=this._constructHeaders(o.headers,e,r),u={path:s.path,type:o.method||"GET",params:s.fields,data:n.resource,headers:l,accountID:e,scopes:i};a=this._sendRequest(u)}return a}},{key:"getAPIForRequest",value:function(e){try{c.Z.PAssert(1039,c.Z.isDemoMode(),"Must only reverse the path in demo mode")}catch(t){c.Z.reportError(t)}return c.Z.unpackFn(e.__packedFn)}},{key:"_sendRequest",value:function(e){var t=e.path,n=e.type,r=e.data,i=e.headers,a=e.params,o=e.accountID,s=e.scopes,c=Object.keys(a).filter((function(e){return void 0!==a[e]})).map((function(e){return"".concat(e,"=").concat(escape(a[e]))}));return c.length>0&&(t+="?"+c.join("&")),new k({accountID:o,scopes:s,path:t,type:n,data:r,headers:i})}},{key:"createBatch",value:function(e){return new p(w,e)}}]),e}())},6374:(e,t,n)=>{"use strict";n.d(t,{Z:()=>_});var r=n(9105),i=n(4575),a=n.n(i),o=n(3913),s=n.n(o),c=n(2205),l=n.n(c),u=n(8585),d=n.n(u),h=n(9754),p=n.n(h);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=p()(e);if(t){var i=p()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return d()(this,n)}}var g=function(e){l()(n,e);var t=f(n);function n(){var e;a()(this,n),(e=t.call(this,"moodonew")).version(1).stores({documents:"id",items:"id",settings:"id",boards:"id",localStorage:"id",contacts:"id"});var r={};["plugins","gmail","drive","gcal"].forEach((function(e){return r[e]="id"})),e.version(2).stores(r),e.tableNames=["documents","items","settings","boards","localStorage","contacts","plugins","Drive","GCalendar","Gmail"];var i={GmailMessages:"id",gmail:null,drive:null,gcal:null};return e.tableNames.forEach((function(e){return i[e]="id"})),i.Gmail="id,date",e.version(3).stores(i),i.pluginsNew="id",e.tableNames.push("pluginsNew"),e.version(4).stores(i),e}return s()(n,[{key:"beginBatch",value:function(){}},{key:"commitBatch",value:function(){}},{key:"getAsArray",value:function(e){return this[e].toArray()}}]),n}(n(8134).Z),m=function(e,t,n){var r=function(e,t,n){for(var r=0,i=0,a=e.length-1;i<=a;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=i+a>>1,s=n(e[o],t);if(s<0)i=o+1;else{if(!(s>0))return o;a=o-1}}return i}(e,t,n);return e.splice.apply(e,[r,0,t]),r},v=function(e,t){var n=0,i={},a={},o=function(e){i[e.id]||(i[e.id]=e,e.isRoot&&(a[e.docId]=e))};e.length>0&&(e.forEach(o),t&&Object.keys(t).forEach((function(e){o(t[e])})));for(var s=0;s<e.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var c=e[s],l=c.parent,u=i[l],d=!1;if(c.isArchived||c.isDeleted){var h=c.isDeleted,p=(h?"deleted":"archived")+"Items";if(!u||u.isRoot||(h?!u.isDeleted:!u.isArchived)){var f=a[c.docId];f&&(f[p]||(f[p]=[]),f[p].push(c)),d=!0}}d||(!u&&c.isRoot,c.note&&(c.noteItem=i[c.note]),u&&(32===(32&c.flags)?u.note=c.id:void 0!==c.text&&(u.items||(u.items=[]),void 0===c.index&&(c.index=""+u.items.length),m(u.items,c,r.Z.compareItemIndex))))}return i},y=function(e){for(var t=0,n=[],i=0;i<e.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n[i]=r.Z.itemIn(e[i])}return v(n)},k=function(){return new g};const _={load:function(e,t){e||(e=k());var n=e.tableNames,i={},a={},o=n.length;n.forEach((function(e){return i[e]=void 0}));var s=function(e,n){if(n||(n=[]),i[e]=n,"documents"===e){for(var s=0,c=n,l={},u={},d=0;d<c.length;d++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var h=r.Z.documentIn(c[d]);l[c[d].id]=h,h.pendingSync&&(u[h.id]=!0)}i.documentsPending=u,i.documents=l}else if("items"===e){var p=function(e){var t={},n=y(e);return Object.keys(n).forEach((function(e){var r=n[e];if(r.pendingSync)t[r.id]=r.pendingSync;else{var i=+r.dateModified,o=r.docId;(!a[o]||i>a[o])&&(a[o]=i)}})),{items:n,itemsPending:t}}(n),f=p.items,g=p.itemsPending;i.items=f,i.itemsPending=g}else if("settings"===e||"boards"===e){var m=function(e){var t={},n={};return e.forEach((function(e){t[e.id]=e,e.pendingSync&&(n[e.id]=e.pendingSync)})),{values:t,pending:n}}(n),v=m.values,k=m.pending;i[e]=v,i[e+"Pending"]=k,"boards"===e&&Object.keys(v).forEach((function(e){v[e]=r.Z.boardIn(v[e])}))}else if("plugins"===e){var _={};n.forEach((function(e){_[e.plugin]||(_[e.plugin]={}),_[e.plugin][e.id]=e})),i[e]=_}else if("localStorage"===e){var Z={};n.forEach((function(e){void 0!==e.value?Z[e.id]=e.value:Object.keys(e).forEach((function(t){return Z[t]=e[t]}))})),i[e]=Z}else if("contacts"===e)i[e]=n.map((function(e){return r.Z.contactIn(e)}));else if("GCalendar"===e||"Gmail"===e||"GmailMessages"===e||"pluginsNew"===e){var w={};n.forEach((function(e){return w[e.id]=e})),i[e]=w}0===--o&&(i.docsModified=a,t(i))},c=!1;for(var l in e.beginBatch(),i)e.getAsArray(l).then(s.bind(e[l],l)).catch((function(e){c||(c=!0,console.log(e),t({error:{name:e.name,message:e.message}}))}));e.commitBatch()},transformItems:y,createItemHierarchy:v,createDB:k}},7237:(e,t,n)=>{"use strict";n.d(t,{Z:()=>_});var r=n(319),i=n.n(r),a=n(4575),o=n.n(a),s=n(3913),c=n.n(s),l=n(8855),u=n(8651),d=n(2935),h=n(7100),p=n(4472),f=n(4654),g=n(1015),m=n(8778),v=n(9145),y=[l.Z.KeyCode.Tab,l.Z.KeyCode.Backspace,l.Z.KeyCode.Delete],k=[l.Z.KeyCode.ArrowUp,l.Z.KeyCode.ArrowDown,l.Z.KeyCode.ArrowLeft,l.Z.KeyCode.ArrowRight,l.Z.KeyCode.Home,l.Z.KeyCode.End,l.Z.KeyCode.A,l.Z.KeyCode.E,l.Z.KeyCode.F,l.Z.KeyCode.B,l.Z.KeyCode.PageUp,l.Z.KeyCode.PageDown];const _=new(function(){function e(){o()(this,e)}return c()(e,[{key:"getNavigationAction",value:function(e){var t=h.Z.mac,n=e.ctrlKey&&!e.altKey&&!e.metaKey,r=e.altKey&&!e.ctrlKey&&!e.metaKey,i=e.metaKey&&!e.ctrlKey&&!e.altKey,a=!e.ctrlKey&&!e.altKey&&!e.metaKey,o=e.normCode,s=l.Z.KeyCode;if(o===s.ArrowLeft){if(n&&!h.Z.mac||r&&h.Z.mac)return"LeftWord";if(i&&t)return"StartLine";if(a)return"Left"}if(o===s.ArrowRight){if(n&&!h.Z.mac||r&&h.Z.mac)return"RightWord";if(i&&t)return"EndLine";if(a)return"Right"}if(o===s.ArrowUp){if(t&&i)return"Top";if(t&&n)return"PageUp";if(t&&r)return"StartLine";if(!t&&n)return"PrevHeader";if(a)return"Up"}if(o===s.ArrowDown){if(t&&i)return"Bottom";if(t&&n)return"PageDown";if(t&&r)return"EndLine";if(!t&&n)return"NextHeader";if(a)return"Down"}if(o===s.A&&n&&t)return"StartLine";if(o===s.E&&n&&t)return"EndLine";if(o===s.B&&n&&t)return"Left";if(o===s.F&&n&&t)return"Right";if(o===s.Home&&!t){if(n)return"Top";if(a)return"StartLine"}if(o===s.End&&!t){if(n)return"Bottom";if(a)return"EndLine"}return o===s.PageUp&&a?"PageUp":o===s.PageDown&&a?"PageDown":o===s.A&&i&&t||o===s.A&&n&&!t?"All":"None"}},{key:"updateAutocomplete",value:function(){if(!u.Z.isDemoRunning&&p.Z.isValid()){var e=p.Z.getStartIndex(),t=p.Z.getStartObject(),n=p.Z.getStartOffset();p.Z.isValid()&&t===p.Z.getEndObject()&&n===p.Z.getEndOffset()?m.Z.updateFromPane({owner:t,index:e,start:n,element:p.Z.getStartElement()}):m.Z.hide()}}},{key:"keyup",value:function(e){if(e.normCode===l.Z.KeyCode.Space&&g.Z.clearGroupTextChanges(),u.Z.preventAndStop(e),this.isTyping=!1,e.handled)return!0}},{key:"handleSelectAll",value:function(e){var t=e.indexOfFirstItem(),n=e.indexOfLastItem();return p.Z.selectIndices(t,0,n,-1),!1}},{key:"handleSelectAllItem",value:function(){if(u.Z.focusedPane&&u.Z.focusedPane.isWriteable)return p.Z.selectIndex(p.Z.getStartIndex(),0,-1),!1}},{key:"_move",value:function(e){try{u.Z.PAssert(227,e===l.Z.Direction.Up||e===l.Z.Direction.Down,"Must move in a direction")}catch(f){u.Z.reportError(f)}var t,n,r=u.Z.focusedPane,i=p.Z.getStartIndex(),a=p.Z.getEndIndex(),o=p.Z.getStartObject().getMirrorOrItem(),s=p.Z.getEndObject().getMirrorOrItem(),c=!1;if((o.parent()===s.parent()&&(c=!0),!c)&&!r.getNextItem(p.Z.getEndIndex(),!0))for(var d=0;s;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;if(o.parent()===s.parent()){c=!0;break}s=s.parent()}if(c&&(e===l.Z.Direction.Up?(t=r.getPreviousItem(i,!0),n=s.getIndex()+1):(t=r.getNextItem(a,!0),n=o.getIndex()),t)){r.setIgnoreRestoreScroll();var h=p.Z.save();p.Z.reset(),t.moveTo({parent:t.parent(),index:n},l.Z.ChangeType.Local),p.Z.restore(h),e===l.Z.Direction.Up?p.Z.scrollStartIntoView():p.Z.scrollEndIntoView()}}},{key:"moveUp",value:function(){!u.Z.focusedPane.isViewAgenda()&&p.Z.isValid()&&this._move(l.Z.Direction.Up)}},{key:"moveDown",value:function(){!u.Z.focusedPane.isViewAgenda()&&p.Z.isValid()&&this._move(l.Z.Direction.Down)}},{key:"handleArrows",value:function(e){var t=u.Z.focusedPane;if(!p.Z.isValid())return!0;var n=this.getNavigationAction(e);this.lastNavigationAction=n;var r,a,o,s=p.Z.getStartIndex(),c=p.Z.getEndIndex(),l=p.Z.getStartOffset(),d=p.Z.getEndOffset(),h=p.Z.getStartTotal(),f=p.Z.getEndTotal(),g=t.indexOfLastItem(),m=s===c&&(0!==l||d!==f),v={fromArrows:!0},y=p.Z.lastSingleSelection;if(e.shiftKey)if("Top"===n)a=[0,0,y?null===(o=p.Z.getEndSelectionOfMap(y.selectedMap))||void 0===o?void 0:o.paneObject.index:c,-1,v];else if("Bottom"===n){var k;a=[y?null===(k=p.Z.getStartSelectionOfMap(y.selectedMap))||void 0===k?void 0:k.paneObject.index:s,0,g,-1,v]}else(m||"Up"!==n&&"Left"!==n&&"LeftWord"!==n)&&"PageUp"!==n&&"PrevHeader"!==n?(m||"Down"!==n&&"Right"!==n&&"RightWord"!==n)&&"PageDown"!==n&&"NextHeader"!==n?m||("Left"===n||"LeftWord"===n||"StartLine"===n?a=[s,0,s,h]:"Right"!==n&&"RightWord"!==n&&"EndLine"!==n||(a=[c,0,c,f])):s===c?s+1<=g&&(a=[s,0,s+1,-1]):r=p.Z.selectUpDown("down","NextHeader"===n,"PageDown"===n):r=p.Z.selectUpDown("up","PrevHeader"===n,"PageUp"===n);else if("All"===n){var _=p.Z.getStartItem();a=s!==c||null===_||void 0===_||!_.isPrefixCodeBlock()||0===l&&d===f?[0,0,g,-1]:[s,0,s,-1]}else if("Top"===n)a=[0,0,0,0];else if("Bottom"===n)a=[g,-1,g,-1];else if(s!==c){if("Left"===n||"LeftWord"===n||"StartLine"===n)a=[s,0,s,0];else if("Right"===n||"RightWord"===n||"EndLine"===n)a=[c,-1,c,-1];else if("Up"===n||"PageUp"===n||"PrevHeader"===n){var Z="PrevHeader"===n&&this.getPrevHeader(t,s)||"PageUp"===n&&this.getPageUp(t,s)||"Up"===n&&this.getPrevVMLI(t,s);a=[Z,0,Z,0]}else if("Down"===n||"PageDown"===n||"NextHeader"===n){var w="NextHeader"===n&&this.getNextHeader(t,c)||"PageDown"===n&&this.getPageDown(t,c)||"Down"===n&&this.getNextVMLI(t,c);a=[w,-1,w,-1]}}else if("PageUp"===n){var b=this.getPageUp(t,c);a=[b,0,b,0]}else if("PageDown"===n){var P=this.getPageDown(t,c);a=[P,-1,P,-1]}else if("PrevHeader"===n){var S=this.getPrevHeader(t,c);a=[S,0,S,0]}else if("NextHeader"===n){var D=this.getNextHeader(t,c);a=[D,-1,D,-1]}if(r)t.listManager.scrollToIndex(r,"auto","auto");else{if(!(a&&a[0]>=0&&a[2]>=0))return!0;t.listManager.scrollToIndex(a[0],"auto","auto"),p.Z.selectIndices.apply(p.Z,i()(a)),e.shiftKey||p.Z.setDownIndex()}}},{key:"keydown",value:function(e){this.isTyping=!0;var t=!0;return this.lastNavigationAction=void 0,e.normCode===l.Z.KeyCode.Escape?p.Z.onPressEnter():y.indexOf(e.normCode)>=0||h.Z.mac&&e.ctrlKey&&e.normCode===l.Z.KeyCode.D?t=this.keypress(e,!0):k.indexOf(e.normCode)>=0?t=this.handleArrows(e):h.Z.mac&&e.metaKey||!h.Z.mac&&e.ctrlKey&&!e.altKey?e.normCode!==l.Z.KeyCode.Y&&e.normCode!==l.Z.KeyCode.Z||(t=this.keypress(e,!0)):h.Z.mac&&e.ctrlKey&&e.normCode===l.Z.KeyCode.H&&u.Z.preventDefault(e),t&&this.keyWantsScrollIntoView(e,!0)&&p.Z.scrollStartIntoView(),t}},{key:"checkKeypressSpecialCases",value:function(e,t){var n;return e.ctrlKey&&e.altKey&&t?n=!0:e.metaKey&&e.normCode===l.Z.KeyCode.Tilde&&(n=!1),n}},{key:"keypress",value:function(e,t,n){var r=[l.Z.KeyCode.Enter,l.Z.KeyCode.D];u.Z.stopPropagation(e);var i=!0,a=u.Z.focusedPane,o=e.normCode>=32||r.indexOf(e.normCode)>=0;if(!(0===e.which)&&(t||o)){if(h.Z.mac&&e.metaKey||!h.Z.mac&&e.ctrlKey)switch(String.fromCharCode(e.normCode)){case"c":case"C":return e.handled=!0,!0;case"v":case"V":return e.handled=!0,!0;case"x":case"X":return e.handled=!0,!0;case"Y":case"y":case"Z":case"z":try{u.Z.PAssert(228,!1,"Should not be handled undo/redo hotkeys here")}catch(d){u.Z.reportError(d)}return e.handled=!0,!0;case"r":case"R":case"a":case"A":case"t":case"T":return e.handled=!0,!0}var s=p.Z.getStartItem();g.Z.saveDeleteSelection(),g.Z.beginAction();var c=[l.Z.KeyCode.Tab,l.Z.KeyCode.Enter,l.Z.KeyCode.Backspace,l.Z.KeyCode.Delete,l.Z.KeyCode.D];p.Z.getStartIndex()!==p.Z.getEndIndex()&&e.normCode!==l.Z.KeyCode.Tab&&((e.metaKey||e.ctrlKey||e.altKey)&&!c.includes(e.normCode)||(a.isViewOutline()||a.isViewProject()?a.isEditable?f.default.menus.isContextMenuOpen()||f.default.menus.isModalOpen()||(i=i&&this.handleMultiselect(e)):i=!1:(f.default.toasts.pushMessage({text:"Editing multiple items from this view is not currently supported. Please edit them individually.",actionText:"OKAY"}),i=!1))),i&&c.indexOf(e.normCode)>=0&&(v.Z.beginBatch({pane:!0}),e.normCode===l.Z.KeyCode.Backspace?i=!!(s&&s.allowTextEditing()&&a.isEditable)&&(i&&this.handleBackspace(e)):(e.normCode===l.Z.KeyCode.Delete||h.Z.mac&&e.ctrlKey&&e.normCode===l.Z.KeyCode.D)&&(i=!!(s&&s.allowTextEditing()&&a.isEditable)&&(i&&this.handleDelete())),v.Z.commitBatch()),g.Z.endAction()}return this.keyWantsScrollIntoView(e,t)&&p.Z.scrollStartIntoView(),i}},{key:"handleMultiselect",value:function(e,t){var n=u.Z.focusedPane,r=n.indexOfNextVMLI(p.Z.getStartIndex()-1),i=n.indexOfPrevVMLI(p.Z.getEndIndex()+1),a=p.Z.getStartOffset(),o=p.Z.getStartOffsetWithPrefix(),s=p.Z.getEndOffset(),c=p.Z.getEndOffsetWithPrefix();p.Z.selectIndices(r,a,i,s);var d=!0,h=p.Z.getStartObject(),f=p.Z.getStartItem(),g=p.Z.getEndObject(),m=p.Z.getEndItem(),v=function(){if(n.hasNonVMLIs){var e=n.closestIndexOfObject(h);try{u.Z.PAssert(229,e>=0,"Could not find item to select")}catch(t){u.Z.reportError(t)}e>=0&&p.Z.selectIndex(e,a)}else p.Z.selectIndex(r,a)};if(r!==i||!(p.Z.getStartOffset()>0||p.Z.getEndOffset()<p.Z.getEndTotal())){e.normCode!==l.Z.KeyCode.Backspace&&e.normCode!==l.Z.KeyCode.Delete&&e.normCode!==l.Z.KeyCode.Enter||(d=!1);var y=f.getIndex();return n.deleteSelected({noSelect:!0,cb:function(){var r=u.Z.isCharacterPrintable(e.normCode)?String.fromCharCode(e.normCode):"",i=f.parent(),o=r||"",s=n.createVMLI({text:o},{parent:i,changeType:l.Z.ChangeType.AllLocal,isEditable:!0});i.insertItem(s,y),a+=o.length,v(),t&&t()}}),d}var k=f.elsNew.split(h,o),_=m.elsNew.split(g,c),Z=k[0].getRawText(h.showMarkdown())+(_[1]?_[1].getRawText(g.showMarkdown()):"");f.setText(Z,l.Z.ChangeType.Local),v(),t&&t()}},{key:"handleTab",value:function(e,t){var n,r,i,a,o=p.Z.getPane(),s=p.Z.getStartIndex(),c=p.Z.getStartObject(),d=p.Z.getEndObject(),h=p.Z.getStartOffset(),g=p.Z.getEndOffset(),m=!t,y=p.Z.getStartItem(!0),k=p.Z.getEndItem(!0),_=m?0:1;if(o.isViewFlatList())f.default.toasts.pushMessage(l.Z.MessageID.FlatSearchTab);else{if(c.levelsDeepNew()<_)return!1;if(m&&o.isViewAutoBlocks()&&c.levelsDeepNew()===_){var Z=o.prevPaneObjectAtSameLevelOrHigher(s);if(!Z||Z.block!==c.block||Z.item.parent()!==y.parent())return!1}y&&y.isNote()&&(y=y.parent()),k&&k.isNote()&&(k=k.parent()),p.Z.scrollStartIntoView();var w=p.Z.getSelectedObjects(),b={},P=[];w.forEach((function(e){var t=e.getMirrorOrItem();if(t){var n,r=(null===(n=e.parentObject)||void 0===n?void 0:n.getMirrorOrItem())||t.parent();b[r.id]||P.push(e),b[t.id]=t}}));var S=[],D=m&&o.prevPaneObjectAtSameLevelOrHigher(c.index),I=(null===(n=c.parentObject)||void 0===n?void 0:n.getMirrorOrItem())||y.parent(),E=m?D:null===(r=c.parentObject)||void 0===r?void 0:r.parentObject,x=m?null===D||void 0===D?void 0:D.item:(null===E||void 0===E?void 0:E.item)||(null===(i=c.parentObject)||void 0===i||null===(a=i.getMirrorOrItem())||void 0===a?void 0:a.parent())||y.parent().parent();if(x){var C,A;v.Z.beginBatch({pane:!0,undo:!0});var L=x.getChildIndex(I);P.forEach((function(t,n){var r=t.getMirrorOrItem();try{u.Z.PAssert(230,r,"Must always be tabbing/untabbing valid items")}catch(h){u.Z.reportError(h)}var i=n===P.length-1,a=r.getIndex();if(m){if(a>0&&!t.isBlockHeader&&x&&(S.push({item:r,parent:x,index:void 0}),null!==E&&void 0!==E&&E.isCollapsed()&&E.setCollapsed(!1),f.default.onIntroAction("Indent"),!e&&i&&!o.isPaneObjectCollapsed(t))){var s=r.getItems(),l=x.numItems()+1;s.forEach((function(e){b[e.id]||S.push({item:e,parent:x,index:l++})}))}}else if(r.parent()!==u.Z.focusedItem&&!(o.isViewProject()&&c.block.id!==o.blockNoKey&&r.parent().parent()===u.Z.focusedItem)){if(!e)o.getSiblingsAfterPaneObject(t).forEach((function(e,t){b[e.id]||S.splice(t,0,{item:e.item,parent:r,index:void 0})}));var d=L+1;S.splice(0,0,{item:r,parent:x,index:d})}})),S.forEach((function(e){var t=e.item,n=e.parent,r=e.index;t.moveTo({parent:n,index:r},l.Z.ChangeType.Local)})),I.itemChanged.notify(),x.itemChanged.notify(),o.setIgnoreRestoreScroll(),v.Z.commitBatch(!1,!1);var M=null===(C=o.findPaneObject(c.id))||void 0===C?void 0:C.index,T=c===d?M:null===(A=o.findPaneObject(d.id))||void 0===A?void 0:A.index;M>=0&&T>=0?p.Z.selectIndices(M,h,T,g):requestAnimationFrame((function(){return p.Z.updateCaret()})),requestAnimationFrame((function(){p.Z.updateCaret()}))}}}},{key:"handleEnter",value:function(e){var t=u.Z.focusedPane,n=p.Z.getStartItem(),r=p.Z.getStartObject(),i=p.Z.getStartIndex(),a=p.Z.getStartOffset(),o=p.Z.getStartOffsetWithPrefix(),s=p.Z.getStartTotal(),c=p.Z.getEndOffset(),h=p.Z.getEndTotal();if(!n){try{u.Z.PAssert(231,!1,"Invalid item in handleEnter")}catch(H){u.Z.reportError(H)}return!1}var g=n.parent();if(!g){try{u.Z.PAssert(232,!1,"Invalid parent in handleEnter")}catch(H){u.Z.reportError(H)}return!1}var m,y,k=n.getParsedText(),_=n.getMooDate(),Z=g.getItems().indexOf(n),w=!1,b=g,P=0;if(t.clearPreventUpdate(),t.setIgnoreRestoreScroll(),n.isNote()){if(e)return u.Z.preventDefault(e),!1}else if(t.isViewProject()&&t.isItemTopLevel(r)&&n.hasChildren()&&0===n.getChild(0).getParsedTextWithoutPrefix().length)y=i+1;else if(n.hasPrefix()&&k===n.getPrefix())n.setText("",l.Z.ChangeType.Local),y=i;else if(n.getPrefix()&&0===a&&c===h)n.setText(n.getPrefix(),l.Z.ChangeType.Local),y=i;else{if(n.isPrefixCodeBlock())return!0;var S,D,I=!0,E=!1,x={text:""},C=r.block;t.setIgnoreRestoreScroll(),v.Z.beginBatch({pane:!0}),t.isViewTag()&&k.indexOf(r.block.text)>=0&&(S=r.block.text,D=k[n.getPrefixLength()]===l.Z.TagPrefix?0:-1);var A=c;if(d.Z.animateNext(),!t.isViewAgenda()||0!==r.levelsDeepNew()||n.hasVisibleChildren(t)&&!r.isCollapsed())if(0===A&&""!==k){I=!0;var L=r.mirroringItem;L?(n=L,Z=(b=L.parent()).getItems().indexOf(n)-1):Z--}else if(a>=s)if(w=!r.isCollapsed()&&(r.isBlockHeader||n.getVisibleChildren(t).length>0))b=n;else{var M=r.mirroringItem;M&&(n=M,Z=(b=M.parent()).getItems().indexOf(n))}else if(0===a&&c===h)n.setText(n.getPrefix(),l.Z.ChangeType.Local);else{var T=n.elsNew.split(r,o),R=r.showMarkdown(),O=T[0].getRawText(R),F=T[1].getRawText(R);S&&O.indexOf(S)<0&&(0===D?O=S+" "+O:O+=" "+S),x.text=F,_&&F.includes(l.Z.CharDate)&&(x.date=_),n.setText(O,l.Z.ChangeType.Local),E=!0,(w=!r.isCollapsed()&&(n.numItems()>0||n.isHeader()))&&(b=n)}else C.isStarred?x.isStarred=!0:C.isImportant?x.priority=n.getPriority():C.isDate&&C.date&&n.getMooDate()?(x.date=n.getMooDate().toData(),x.text=" "+l.Z.CharDate):x.text=" "+C.id,n.shouldSave()||(Z=-1);!w&&S&&x.text.indexOf(S)<0&&(0===D?x.text=S+" "+x.text:x.text+=" "+S);var N=f.default.settings.defaultItemPrefix.get();if(w||!n.shouldCopyPrefix()&&!E?(!w||w&&N&&(n.isPrefixHeader()||n.shouldCopyPrefix()&&n.prefix===N))&&(x.text=(N&&N+" ")+x.text):x.text=n.getPrefix()+x.text,m=t.createVMLI(x,{parent:b,changeType:l.Z.ChangeType.AllLocal,isEditable:!0}),E&&m.copyProperties(n),m.parseText("",l.Z.ChangeType.Local|l.Z.ChangeType.All),w)n.insertItem(m,0);else{try{u.Z.PAssert(233,!m.isNote(),"Should never be inserting a note here")}catch(H){u.Z.reportError(H)}b.insertItem(m,Z+1)}v.Z.commitBatch();var B=I?m:n;try{u.Z.PAssert(234,B,"Expected another item to exist")}catch(H){u.Z.reportError(H)}var U=t.closestIndexOfObject(r);y=t.indexOfItem(B,C,void 0,U),P=0}if(y>=0){var j=t.objectAtIndex(y);p.Z.selectObject(j,P,P)}return e&&u.Z.preventDefault(e),!1}},{key:"handleBackspace",value:function(e){var t=p.Z.getStartItem(),n=p.Z.getStartIndex(),r=p.Z.getStartOffset(),i=p.Z.getEndOffset(),a=p.Z.getStartObject(),o=u.Z.focusedPane,s=r===i;if(!t){try{u.Z.PAssert(235,!1,"Invalid item in handleBackspace")}catch(L){u.Z.reportError(L)}return!1}var c=t.parent();try{u.Z.PAssert(236,c,"Must always have a valid parent for an item")}catch(L){u.Z.reportError(L)}h.Z.ie&&u.Z.preventAndStop(e);var m=t.getParsedText(),v=t.hasAttachmentType(l.Z.PluginType.Calendar);if(0===r&&0===i||""===m){if(a.isBlockHeader&&t.hasChildren());else if(t.isNote()&&""!==m);else if(v);else if(s&&t.hasPrefix())a.isBlockHeader&&t.hasChildren()||(t.setText(m.substr(t.getPrefixLength()),l.Z.ChangeType.Local),p.Z.selectIndex(n,0),this.updateAutocomplete());else if(p.Z.getStartIndex()>0){var y=u.Z.focusedPane.indexOfPrevVMLI(p.Z.getStartIndex(),!0),k=y>=0&&u.Z.focusedPane.objectAtIndex(y);if(k&&k.item.allowTextEditing()){var _=!0;if((o.isViewAgenda()||o.isViewFlatList())&&0!==m.length&&(_=!1),k.item.isMirrorOrMirrored()&&(_=!1,f.default.toasts.pushMessage("Cannot backspace after a linked or mirrored item")),_){o.setIgnoreRestoreScroll(),d.Z.animateNext(),f.default.PaneUpdateBatcher.beginUpdateItems(),g.Z.saveDeleteSelection();var Z=k.item,w=Z.isFullscreen(),b=k.getDisplayLengthWithoutPrefix(),P=w?0:y,S=o.objectAtIndex(P),D=w?0:b;if(p.Z.selectObject(S,D),m.length>0&&""!==m){0===b&&Z.copyProperties(t),Z.setText(Z.elsNew.combineWith(t.elsNew),l.Z.ChangeType.Local);var I=t.getMooDate();I&&!Z.getMooDate()&&Z.setMooDate(I,l.Z.ChangeType.Local,!0),t.hasNote()&&(Z.hasNote()||Z.moveNote(t,l.Z.ChangeType.Local))}c.deleteChild(t,Z,0,l.Z.ChangeType.Local),f.default.PaneUpdateBatcher.commitUpdateItems(),p.Z.selectObject(S,D)}}}}else{if(!(r>0)||e.metaKey||t.elsNew.isElementAtOffsetEditable(a,r-1))return!0;var E=a.showMarkdown(),x=t.elsNew.elementAtOffset(a,r-1);if(x){var C=r-x.getStyledText(t,{showMarkdown:E}).length,A=t.elsNew.removeElement(x).getRawText(E);t.setText(A,l.Z.ChangeType.Local),p.Z.selectIndex(n,C)}}return!1}},{key:"handleDelete",value:function(){var e=p.Z.getStartItem(),t=u.Z.focusedPane;if(!e)return!1;var n=e.parent(),r=p.Z.getStartObject(),i=e.getParsedText(),a=p.Z.getStartIndex(),o=p.Z.getStartOffset(),s=p.Z.getEndOffset(),c=p.Z.getEndTotal(),d=!0;if(""===i)if(t.isViewOutline()){if(e.isNote())n.setNote(void 0,l.Z.ChangeType.Local),p.Z.selectItem(n,-1);else if(a<t.numItems()-1){var h=a,m=t.objectAtIndex(a+1);t.setIgnoreRestoreScroll(),g.Z.saveDeleteSelection(),t.numItems()>1&&(e.hasChildren()?n.replaceChild(e,e.getFirstChild(),l.Z.ChangeType.Local):n.deleteChild(e,n,h,l.Z.ChangeType.Local)),p.Z.selectObject(m,0)}}else d=!1;else if(o===p.Z.getStartTotal()&&s===c)if(t.isViewOutline())if(e.isNote())d=!1;else{var v=t.indexOfNextVMLI(a,!0),y=v>=0&&t.itemAtIndex(v);if(y&&d){y.isMirrorOrMirrored()&&(d=!1,f.default.toasts.pushMessage("Cannot delete after a linked or mirrored item")),t.setIgnoreRestoreScroll();var k=y.hasNote()&&y.getNote();e.setText(e.elsNew.combineWith(y.elsNew,(function(e){return!e.props.prefixType})),l.Z.ChangeType.Local);var _=y.getMooDate();if(_&&!e.getMooDate()&&e.setMooDate(_,l.Z.ChangeType.Local,!0),k){var Z=e.hasNote()&&e.getNote();if(Z){var w=Z.getRawText()+"\n\n--- merged note ---\n\n"+k.getRawText();Z.setText(w,l.Z.ChangeType.Local)}else k.setParent(e),e.setNote(k,l.Z.ChangeType.Local)}g.Z.saveDeleteSelection(),y.parent().deleteChild(y,e,0,l.Z.ChangeType.Local),p.Z.selectIndex(p.Z.getEndIndex(),s)}}else d=!1;else{if(!(o<c-1&&s<c-1)||e.elsNew.isElementAtOffsetEditable(r,o))return!0;var b=e.elsNew.elementAtOffset(r,o);if(b){var P=e.elsNew.removeElement(b).getRawText(r.showMarkdown());e.setText(P,l.Z.ChangeType.Local),p.Z.selectIndex(a,o)}}return!1}},{key:"keyWantsScrollIntoView",value:function(e,t){switch(e.normCode){case l.Z.KeyCode.LeftMeta:case l.Z.KeyCode.ContextMenu:case l.Z.KeyCode.Alt:case l.Z.KeyCode.Shift:case l.Z.KeyCode.Ctrl:case l.Z.KeyCode.ArrowLeft:case l.Z.KeyCode.ArrowRight:case l.Z.KeyCode.ArrowUp:case l.Z.KeyCode.ArrowDown:return!1}return!(h.Z.mac&&e.metaKey&&(t&&e.normCode===l.Z.KeyCode.Tilde||!t&&"`"===String.fromCharCode(e.normCode)))&&((!(h.Z.mac&&e.metaKey||!h.Z.mac&&e.ctrlKey)||e.normCode!==l.Z.KeyCode.Z&&e.normCode!==l.Z.KeyCode.Y)&&!(e.normCode>=l.Z.KeyCode.F1&&e.normCode<=l.Z.KeyCode.F12))}},{key:"getPageUp",value:function(e,t){for(var n=0,r=0;r<5&&t>0;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=e.indexOfPrevVMLI(t);i>=0&&(t=i)}return t}},{key:"getPageDown",value:function(e,t){for(var n=0,r=e.items.length(),i=0;i<5&&t<r;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=e.indexOfNextVMLI(t);a>=0&&(t=a)}return t}},{key:"getPrevVMLI",value:function(e,t){var n=e.indexOfPrevVMLI(t);return n>=0?n:t}},{key:"getPrevHeader",value:function(e,t){var n=e.indexOfPrevHeader(t);return n>=0?n:t}},{key:"getNextVMLI",value:function(e,t){var n=e.indexOfNextVMLI(t);return n>=0?n:t}},{key:"getNextHeader",value:function(e,t){var n=e.indexOfNextHeader(t);return n>=0?n:t}}]),e}())},8697:()=>{!function(){var e=Date,t=Date.CultureStrings?Date.CultureStrings.lang:null,n={},r={getFromKey:function(e,t){var n;return n=Date.CultureStrings&&Date.CultureStrings[t]&&Date.CultureStrings[t][e]?Date.CultureStrings[t][e]:r.buildFromDefault(e),"/"===e.charAt(0)&&(n=r.buildFromRegex(e,t)),n},getFromObjectValues:function(e,t){var n,i={};for(n in e)e.hasOwnProperty(n)&&(i[n]=r.getFromKey(e[n],t));return i},getFromObjectKeys:function(e,t){var n,i={};for(n in e)e.hasOwnProperty(n)&&(i[r.getFromKey(n,t)]=e[n]);return i},getFromArray:function(e,t){for(var n=[],i=0;i<e.length;i++)i in e&&(n[i]=r.getFromKey(e[i],t));return n},buildFromDefault:function(e){var t,n,r,i;switch(e){case"name":t="en-US";break;case"englishName":case"nativeName":t="English (United States)";break;case"twoDigitYearMax":t=2049;break;case"firstDayOfWeek":t=0;break;default:t=e,(n=(r=e.split("_")).length)>1&&"/"!==e.charAt(0)&&("initial"!==(i=r[n-1].toLowerCase())&&"abbr"!==i||(t=r[0]))}return t},buildFromRegex:function(e,t){return Date.CultureStrings&&Date.CultureStrings[t]&&Date.CultureStrings[t][e]?new RegExp(Date.CultureStrings[t][e],"i"):new RegExp(e.replace(new RegExp("/","g"),""),"i")}},i=function(e,i){var a=i||t;return n[e]=e,"object"===typeof e?e instanceof Array?r.getFromArray(e,a):r.getFromObjectKeys(e,a):r.getFromKey(e,a)},a={buildFromMethodHash:function(e){var t;for(t in e)e.hasOwnProperty(t)&&(e[t]=a[e[t]]());return e},timeZoneDST:function(){return i({CHADT:"+1345",NZDT:"+1300",AEDT:"+1100",ACDT:"+1030",AZST:"+0500",IRDT:"+0430",EEST:"+0300",CEST:"+0200",BST:"+0100",PMDT:"-0200",ADT:"-0300",NDT:"-0230",EDT:"-0400",CDT:"-0500",MDT:"-0600",PDT:"-0700",AKDT:"-0800",HADT:"-0900"})},timeZoneStandard:function(){return i({LINT:"+1400",TOT:"+1300",CHAST:"+1245",NZST:"+1200",NFT:"+1130",SBT:"+1100",AEST:"+1000",ACST:"+0930",JST:"+0900",CWST:"+0845",CT:"+0800",ICT:"+0700",MMT:"+0630",BST:"+0600",NPT:"+0545",IST:"+0530",PKT:"+0500",AFT:"+0430",MSK:"+0400",IRST:"+0330",FET:"+0300",EET:"+0200",CET:"+0100",GMT:"+0000",UTC:"+0000",CVT:"-0100",GST:"-0200",BRT:"-0300",NST:"-0330",AST:"-0400",EST:"-0500",CST:"-0600",MST:"-0700",PST:"-0800",AKST:"-0900",MIT:"-0930",HST:"-1000",SST:"-1100",BIT:"-1200"})},timeZones:function(e){var t;for(t in e.timezones=[],e.abbreviatedTimeZoneStandard)e.abbreviatedTimeZoneStandard.hasOwnProperty(t)&&e.timezones.push({name:t,offset:e.abbreviatedTimeZoneStandard[t]});for(t in e.abbreviatedTimeZoneDST)e.abbreviatedTimeZoneDST.hasOwnProperty(t)&&e.timezones.push({name:t,offset:e.abbreviatedTimeZoneDST[t],dst:!0});return e.timezones},days:function(){return i(["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"])},dayAbbr:function(){return i(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"])},dayShortNames:function(){return i(["Su","Mo","Tu","We","Th","Fr","Sa"])},dayFirstLetters:function(){return i(["S_Sun_Initial","M_Mon_Initial","T_Tues_Initial","W_Wed_Initial","T_Thu_Initial","F_Fri_Initial","S_Sat_Initial"])},months:function(){return i(["January","February","March","April","May","June","July","August","September","October","November","December"])},monthAbbr:function(){return i(["Jan_Abbr","Feb_Abbr","Mar_Abbr","Apr_Abbr","May_Abbr","Jun_Abbr","Jul_Abbr","Aug_Abbr","Sep_Abbr","Oct_Abbr","Nov_Abbr","Dec_Abbr"])},formatPatterns:function(){return r.getFromObjectValues({shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss",monthDay:"MMMM dd",monthDayShortTime:"MM/dd",monthDayYear:"MM/dd/yy",yearMonth:"MMMM, yyyy"},Date.i18n.currentLanguage())},regex:function(){return r.getFromObjectValues({thisMorning:"/(this )(morn(ing)?)\\b/",thisEvening:"/(this )(even(ing)?)\\b/",jan:"/jan(uary)?/",feb:"/feb(ruary)?/",mar:"/mar(ch)?/",apr:"/apr(il)?/",may:"/may/",jun:"/jun(e)?/",jul:"/jul(y)?/",aug:"/aug(ust)?/",sep:"/sep(t(ember)?)?/",oct:"/oct(ober)?/",nov:"/nov(ember)?/",dec:"/dec(ember)?/",sun:"/^sun(day)?/",mon:"/^mon(day)?/",tue:"/^tue(s(day)?)?/",wed:"/^wed(nesday)?/",thu:"/^thu(rsday)?/",fri:"/^fri(day)?/",sat:"/^sat(urday)?/",future:"/^next/",past:"/^last|past|prev(ious)?/",yesterday:"/^yesterday/",today:"/^today/",tomorrow:"/^tom(orrow)?/",soon:"/^soon/",later:"/^later/",someday:"/^someday/",now:"/^now/",shortMeridian:"/^(a|p)/",longMeridian:"/^(a\\.?m?\\.?|p\\.?m?\\.?)/",timezone:"/^((e(s|d)t|c(e?s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\\s*(\\+|\\-)\\s*\\d\\d\\d\\d?)|gmt|utc)/",ordinalSuffix:"/^\\s*(st|nd|rd|th)/",timeContext:"/^\\s*(\\:|a(?!u|p)|p)/"},Date.i18n.currentLanguage())}},o=function(){var e=r.getFromObjectValues({name:"name",englishName:"englishName",nativeName:"nativeName",amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:"firstDayOfWeek",twoDigitYearMax:"twoDigitYearMax",dateElementOrder:"mdy"},Date.i18n.currentLanguage());return function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])}(e,a.buildFromMethodHash({dayNames:"days",abbreviatedDayNames:"dayAbbr",shortestDayNames:"dayShortNames",firstLetterDayNames:"dayFirstLetters",monthNames:"months",abbreviatedMonthNames:"monthAbbr",formatPatterns:"formatPatterns",regexPatterns:"regex",abbreviatedTimeZoneDST:"timeZoneDST",abbreviatedTimeZoneStandard:"timeZoneStandard"})),a.timeZones(e),e};e.i18n={__:function(e,t){return i(e,t)},currentLanguage:function(){return t||"en-US"},setLanguage:function(n,r,i){if(r||"en-US"===n||Date.CultureStrings&&Date.CultureStrings[n])t=n,Date.CultureStrings=Date.CultureStrings||{},Date.CultureStrings.lang=n,Date.CultureInfo=new o;else if(!Date.CultureStrings||!Date.CultureStrings[n])return!1;e.Parsing.Normalizer.buildReplaceData(),e.Grammar&&e.Grammar.buildGrammarFormats(),i&&i()},getLoggedKeys:function(){return n},updateCultureInfo:function(){Date.CultureInfo=new o}},e.i18n.updateCultureInfo()}(),function(){var e=Date,t=e.prototype,n=function(e,t){return t||(t=2),("000"+e).slice(-1*t)};"undefined"!==typeof window&&"undefined"!==typeof window.console&&"undefined"!==typeof window.console.log?e.console=console:e.console={log:function(){},error:function(){}},e.Config=e.Config||{},e.initOverloads=function(){e.now?e._now||(e._now=e.now):e._now=function(){return(new Date).getTime()},e.now=function(t){return t?e.present():e._now()},t.toISOString||(t.toISOString=function(){return this.getUTCFullYear()+"-"+n(this.getUTCMonth()+1)+"-"+n(this.getUTCDate())+"T"+n(this.getUTCHours())+":"+n(this.getUTCMinutes())+":"+n(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}),void 0===t._toString&&(t._toString=t.toString)},e.initOverloads(),e.today=function(){return(new Date).clearTime()},e.present=function(){return new Date},e.compare=function(e,t){if(isNaN(e)||isNaN(t))throw new Error(e+" - "+t);if(e instanceof Date&&t instanceof Date)return e<t?-1:e>t?1:0;throw new TypeError(e+" - "+t)},e.equals=function(e,t){return 0===e.compareTo(t)},e.getDayName=function(e){return Date.CultureInfo.dayNames[e]},e.getDayNumberFromName=function(e){for(var t=Date.CultureInfo.dayNames,n=Date.CultureInfo.abbreviatedDayNames,r=Date.CultureInfo.shortestDayNames,i=e.toLowerCase(),a=0;a<t.length;a++)if(t[a].toLowerCase()===i||n[a].toLowerCase()===i||r[a].toLowerCase()===i)return a;return-1},e.getMonthNumberFromName=function(e){for(var t=Date.CultureInfo.monthNames,n=Date.CultureInfo.abbreviatedMonthNames,r=e.toLowerCase(),i=0;i<t.length;i++)if(t[i].toLowerCase()===r||n[i].toLowerCase()===r)return i;return-1},e.getMonthName=function(e){return Date.CultureInfo.monthNames[e]},e.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0},e.getDaysInMonth=function(t,n){return!n&&e.validateMonth(t)&&(n=t,t=Date.today().getFullYear()),[31,e.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][n]},t.getDaysInMonth=function(){return e.getDaysInMonth(this.getFullYear(),this.getMonth())},e.getTimezoneAbbreviation=function(e,t){var n,r=t?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard;for(n in r)if(r.hasOwnProperty(n)&&r[n]===e)return n;return null},e.getTimezoneOffset=function(e,t){var n,r=[],i=Date.CultureInfo.timezones;for(e||(e=(new Date).getTimezone()),n=0;n<i.length;n++)i[n].name===e.toUpperCase()&&r.push(n);if(!i[r[0]])return null;if(1===r.length||!t)return i[r[0]].offset;for(n=0;n<r.length;n++)if(i[r[n]].dst)return i[r[n]].offset},e.getQuarter=function(e){e=e||new Date;return[1,2,3,4][Math.floor(e.getMonth()/3)]},e.getDaysLeftInQuarter=function(e){e=e||new Date;var t=new Date(e);return t.setMonth(t.getMonth()+3-t.getMonth()%3,0),Math.floor((t-e)/864e5)},t.ensureTimeOfDay=function(){0===this.getMilliseconds()&&this.setTime(this.getTime()+1)};var r=function(e,t,n,r){if(r=r||"Object","undefined"===typeof e)return!1;if("number"!==typeof e)throw new TypeError(e+" is not a Number.");return!(e<t||e>n)};e.validateMillisecond=function(e){return r(e,0,999,"millisecond")},e.validateSecond=function(e){return r(e,0,59,"second")},e.validateMinute=function(e){return r(e,0,59,"minute")},e.validateHour=function(e){return r(e,0,23,"hour")},e.validateDay=function(t,n,i){return void 0!==n&&null!==n&&void 0!==i&&null!==i&&r(t,1,e.getDaysInMonth(n,i),"day")},e.validateWeek=function(e){return r(e,0,53,"week")},e.validateMonth=function(e){return r(e,0,11,"month")},e.validateYear=function(e){return r(e,-271822,275760,"year")},e.validateTimezone=function(e){return 1==={ACDT:1,ACST:1,ACT:1,ADT:1,AEDT:1,AEST:1,AFT:1,AKDT:1,AKST:1,AMST:1,AMT:1,ART:1,AST:1,AWDT:1,AWST:1,AZOST:1,AZT:1,BDT:1,BIOT:1,BIT:1,BOT:1,BRT:1,BST:1,BTT:1,CAT:1,CCT:1,CDT:1,CEDT:1,CEST:1,CET:1,CHADT:1,CHAST:1,CHOT:1,ChST:1,CHUT:1,CIST:1,CIT:1,CKT:1,CLST:1,CLT:1,COST:1,COT:1,CST:1,CT:1,CVT:1,CWST:1,CXT:1,DAVT:1,DDUT:1,DFT:1,EASST:1,EAST:1,EAT:1,ECT:1,EDT:1,EEDT:1,EEST:1,EET:1,EGST:1,EGT:1,EIT:1,EST:1,FET:1,FJT:1,FKST:1,FKT:1,FNT:1,GALT:1,GAMT:1,GET:1,GFT:1,GILT:1,GIT:1,GMT:1,GST:1,GYT:1,HADT:1,HAEC:1,HAST:1,HKT:1,HMT:1,HOVT:1,HST:1,ICT:1,IDT:1,IOT:1,IRDT:1,IRKT:1,IRST:1,IST:1,JST:1,KGT:1,KOST:1,KRAT:1,KST:1,LHST:1,LINT:1,MAGT:1,MART:1,MAWT:1,MDT:1,MET:1,MEST:1,MHT:1,MIST:1,MIT:1,MMT:1,MSK:1,MST:1,MUT:1,MVT:1,MYT:1,NCT:1,NDT:1,NFT:1,NPT:1,NST:1,NT:1,NUT:1,NZDT:1,NZST:1,OMST:1,ORAT:1,PDT:1,PET:1,PETT:1,PGT:1,PHOT:1,PHT:1,PKT:1,PMDT:1,PMST:1,PONT:1,PST:1,PYST:1,PYT:1,RET:1,ROTT:1,SAKT:1,SAMT:1,SAST:1,SBT:1,SCT:1,SGT:1,SLST:1,SRT:1,SST:1,SYOT:1,TAHT:1,THA:1,TFT:1,TJT:1,TKT:1,TLT:1,TMT:1,TOT:1,TVT:1,UCT:1,ULAT:1,UTC:1,UYST:1,UYT:1,UZT:1,VET:1,VLAT:1,VOLT:1,VOST:1,VUT:1,WAKT:1,WAST:1,WAT:1,WEDT:1,WEST:1,WET:1,WST:1,YAKT:1,YEKT:1,Z:1}[e]},e.validateTimezoneOffset=function(e){return e>-841&&e<721},e.validateSetExplicitTime=function(e){return!0}}(),function(){var e=Date,t=e.prototype,n=function(e,t){return t||(t=2),("000"+e).slice(-1*t)},r=function(t){var n,r,i={},a=this;for(n in r=function(n,r,i){if("day"===n){var o=void 0!==t.month?t.month:a.getMonth(),s=void 0!==t.year?t.year:a.getFullYear();return e[r](i,s,o)}return e[r](i)},t)if(hasOwnProperty.call(t,n)){var o="validate"+n.charAt(0).toUpperCase()+n.slice(1);e[o]&&null!==t[n]&&r(n,o,t[n])&&(i[n]=t[n])}return i};t.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},t.setTimeToNow=function(){var e=new Date;return this.setHours(e.getHours()),this.setMinutes(e.getMinutes()),this.setSeconds(e.getSeconds()),this.setMilliseconds(e.getMilliseconds()),this},t.clone=function(){return new Date(this.getTime())},t.compareTo=function(e){return Date.compare(this,e)},t.equals=function(e){if(!e)return!1;var t=this.clone(),n=e.clone();return t.setMilliseconds(0),n.setMilliseconds(0),Date.equals(t,n)},t.between=function(e,t){return this.getTime()>=e.getTime()&&this.getTime()<=t.getTime()},t.isAfter=function(e){return 1===this.compareTo(e||new Date)},t.isBefore=function(e){return-1===this.compareTo(e||new Date)},t.isToday=t.isSameDay=function(e){return this.clone().clearTime().equals((e||new Date).clone().clearTime())},t.addMilliseconds=function(e){return e?(this.setTime(this.getTime()+1*e),this):this},t.addSeconds=function(e){return e?this.addMilliseconds(1e3*e):this},t.addMinutes=function(e){return e?this.addMilliseconds(6e4*e):this},t.addHours=function(e){return e?this.addMilliseconds(36e5*e):this},t.addDays=function(e){return e?(this.setDate(this.getDate()+1*e),this):this},t.addWeekdays=function(e){if(!e)return this;var t=this.getDay(),n=Math.ceil(Math.abs(e)/7);if(0!==t&&6!==t||e>0&&(this.next().monday(),this.addDays(-1),t=this.getDay()),e<0){for(;e<0;)this.addDays(-1),0!==(t=this.getDay())&&6!==t&&e++;return this}return(e>5||6-t<=e)&&(e+=2*n),this.addDays(e)},t.addWeeks=function(e){return e?this.addDays(7*e):this},t.addMonths=function(t){if(!t)return this;var n=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+1*t),this.setDate(Math.min(n,e.getDaysInMonth(this.getFullYear(),this.getMonth()))),this},t.addQuarters=function(e){return e?this.addMonths(3*e):this},t.addYears=function(e){return e?this.addMonths(12*e):this},t.add=function(e){if("number"===typeof e)return this._orient=e,this;var t=e;return t.day&&t.day-this.getDate()!==0&&this.setDate(t.day),t.milliseconds&&this.addMilliseconds(t.milliseconds),t.seconds&&this.addSeconds(t.seconds),t.minutes&&this.addMinutes(t.minutes),t.hours&&this.addHours(t.hours),t.weeks&&this.addWeeks(t.weeks),t.months&&this.addMonths(t.months),t.years&&this.addYears(t.years),t.days&&this.addDays(t.days),t.setExplicitTime&&this.ensureTimeOfDay(),this},t.getWeek=function(e){var t,n=new Date(this.valueOf());e?(n.addMinutes(n.getTimezoneOffset()),t=n.clone()):t=this;var r=(t.getDay()+6)%7;n.setDate(n.getDate()-r+3);var i=n.valueOf();return n.setMonth(0,1),4!==n.getDay()&&n.setMonth(0,1+(4-n.getDay()+7)%7),1+Math.ceil((i-n)/6048e5)},t.getISOWeek=function(){return n(this.getWeek(!0))},t.setWeek=function(e){return e-this.getWeek()===0?1!==this.getDay()?this.moveToDayOfWeek(1,this.getDay()>1?-1:1):this:this.moveToDayOfWeek(1,this.getDay()>1?-1:1).addWeeks(e-this.getWeek())},t.setQuarter=function(e){var t=Math.abs(3*(e-1)+1);return this.setMonth(t,1)},t.getQuarter=function(){return Date.getQuarter(this)},t.getDaysLeftInQuarter=function(){return Date.getDaysLeftInQuarter(this)},t.moveToNthOccurrence=function(e,t){if("Weekday"===e){if(t>0)this.moveToFirstDayOfMonth(),this.is().weekday()&&(t-=1);else{if(!(t<0))return this;this.moveToLastDayOfMonth(),this.is().weekday()&&(t+=1)}return this.addWeekdays(t)}var n=0;if(t>0)n=t-1;else if(-1===t)return this.moveToLastDayOfMonth(),this.getDay()!==e&&this.moveToDayOfWeek(e,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(e,1).addWeeks(n)};var i=function(e,t,n){return function(r,i){var a=(r-this[e]()+n*(i||1))%n;return this[t](a)}};t.moveToDayOfWeek=i("getDay","addDays",7),t.moveToMonth=i("getMonth","addMonths",12),t.getOrdinate=function(){var e=this.getDate();return a(e)},t.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1},t.getTimezone=function(){return e.getTimezoneAbbreviation(this.getUTCOffset(),this.isDaylightSavingTime())},t.setTimezoneOffset=function(e){var t=this.getTimezoneOffset(),n=-6*Number(e)/10;return n||0===n?this.addMinutes(t-n):this},t.setTimezone=function(t){return this.setTimezoneOffset(e.getTimezoneOffset(t))},t.hasDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset()},t.isDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==this.getTimezoneOffset()},t.getUTCOffset=function(e){var t,n=-10*(e||this.getTimezoneOffset())/6;return n<0?(t=(n-1e4).toString()).charAt(0)+t.substr(2):"+"+(t=(n+1e4).toString()).substr(1)},t.getElapsed=function(e){return(e||new Date)-this},t.set=function(e){var t;for(t in e=r.call(this,e))if(hasOwnProperty.call(e,t)){var n,i,a=t.charAt(0).toUpperCase()+t.slice(1);"week"!==t&&"month"!==t&&"timezone"!==t&&"timezoneOffset"!==t&&(a+="s"),n="add"+a,i="get"+a,"month"===t?n+="s":"year"===t&&(i="getFullYear"),"day"!==t&&"timezone"!==t&&"timezoneOffset"!==t&&"week"!==t&&"hour"!==t&&"setExplicitTime"!==t?this[n](e[t]-this[i]()):"timezone"===t||"timezoneOffset"===t||"week"===t||"hour"===t?this["set"+a](e[t]):"setExplicitTime"===t&&this.ensureTimeOfDay()}return e.day&&this.addDays(e.day-this.getDate()),this},t.moveToFirstDayOfMonth=function(){return this.set({day:1})},t.moveToLastDayOfMonth=function(){return this.set({day:e.getDaysInMonth(this.getFullYear(),this.getMonth())})};var a=function(e){switch(1*e){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},o=function(e){var t=Date.CultureInfo.formatPatterns;switch(e){case"d":return this.toString(t.shortDate);case"D":return this.toString(t.longDate);case"F":return this.toString(t.fullDateTime);case"m":return this.toString(t.monthDay);case"r":case"R":return this.clone().addMinutes(this.getTimezoneOffset()).toString(t.rfc1123)+" GMT";case"s":return this.toString(t.sortableDateTime);case"t":return this.toString(t.shortTime);case"T":return this.toString(t.longTime);case"u":return this.clone().addMinutes(this.getTimezoneOffset()).toString(t.universalSortableDateTime);case"y":return this.toString(t.yearMonth);default:return!1}};t.toString=function(t,r){if(!r&&t&&1===t.length){var i=o.call(this,t);if(i)return i}var s,c=(s=this,function(t){if("\\"===t.charAt(0))return t.replace("\\","");switch(t){case"hh":return n(s.getHours()<13?0===s.getHours()?12:s.getHours():s.getHours()-12);case"h":return s.getHours()<13?0===s.getHours()?12:s.getHours():s.getHours()-12;case"HH":return n(s.getHours());case"H":return s.getHours();case"mm":return n(s.getMinutes());case"m":return s.getMinutes();case"ss":return n(s.getSeconds());case"s":return s.getSeconds();case"yyyy":return n(s.getFullYear(),4);case"yy":return n(s.getFullYear());case"y":return s.getFullYear();case"E":case"dddd":return Date.CultureInfo.dayNames[s.getDay()];case"ddd":return Date.CultureInfo.abbreviatedDayNames[s.getDay()];case"dd":return n(s.getDate());case"d":return s.getDate();case"MMMM":return Date.CultureInfo.monthNames[s.getMonth()];case"MMM":return Date.CultureInfo.abbreviatedMonthNames[s.getMonth()];case"MM":return n(s.getMonth()+1);case"M":return s.getMonth()+1;case"t":return s.getHours()<12?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case"tt":return s.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case"S":return a(s.getDate());case"W":return s.getWeek();case"WW":return s.getISOWeek();case"Q":return"Q"+s.getQuarter();case"q":return String(s.getQuarter());case"z":return s.getTimezone();case"Z":case"X":return Date.getTimezoneOffset(s.getTimezone());case"ZZ":return-60*s.getTimezoneOffset();case"u":return s.getDay();case"L":return e.isLeapYear(s.getFullYear())?1:0;case"B":return"@"+(s.getUTCSeconds()+60*s.getUTCMinutes()+3600*(s.getUTCHours()+1))/86.4;default:return t}});return t?t.replace(/((\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S|q|Q|WW?W?W?)(?![^\[]*\]))/g,c).replace(/\[|\]/g,""):this._toString()}}(),function(){var e=Date,t=e.prototype,n=Number.prototype;t._orient=1,t._nth=null,t._is=!1,t._same=!1,t._isSecond=!1,n._dateElement="days",t.next=function(){return this._move=!0,this._orient=1,this},e.next=function(){return e.today().next()},t.last=t.prev=t.previous=function(){return this._move=!0,this._orient=-1,this},e.last=e.prev=e.previous=function(){return e.today().last()},t.is=function(){return this._is=!0,this},t.same=function(){return this._same=!0,this._isSecond=!1,this},t.today=function(){return this.same().day()},t.weekday=function(){return this._nth?l("Weekday").call(this):this._move?this.addWeekdays(this._orient):!!this._is&&(this._is=!1,!this.is().sat()&&!this.is().sun())},t.weekend=function(){return!!this._is&&(this._is=!1,this.is().sat()||this.is().sun())},t.at=function(t){return"string"===typeof t?e.parse(this.toString("d")+" "+t):this.set(t)},n.fromNow=n.after=function(e){var t={};return t[this._dateElement]=this,(e?e.clone():new Date).add(t)},n.ago=n.before=function(e){var t={};return t["s"!==this._dateElement[this._dateElement.length-1]?this._dateElement+"s":this._dateElement]=-1*this,(e?e.clone():new Date).add(t)};var r,i="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),a="january february march april may june july august september october november december".split(/\s/),o=[],s=[],c="final first second third fourth fifth".split(/\s/);t.toObject=function(){for(var e={},t=0;t<o.length;t++)this["get"+s[t]]&&(e[o[t].toLowerCase()]=this["get"+s[t]]());return e},e.fromObject=function(e){return e.week=null,Date.today().set(e)};var l=function(t){return function(){if(this._is)return this._is=!1,this.getDay()===t;if(this._move&&(this._move=null),null!==this._nth){this._isSecond&&this.addSeconds(-1*this._orient),this._isSecond=!1;var n=this._nth;this._nth=null;var r=this.clone().moveToLastDayOfMonth();if(this.moveToNthOccurrence(t,n),this>r)throw new RangeError(e.getDayName(t)+" does not occur "+n+" times in the month of "+e.getMonthName(r.getMonth())+" "+r.getFullYear()+".");return this}return this.moveToDayOfWeek(t,this._orient)}},u=function(n,r,i){for(var a=0;a<n.length;a++)e[n[a].toUpperCase()]=e[n[a].toUpperCase().substring(0,3)]=a,e[n[a]]=e[n[a].substring(0,3)]=r(a),t[n[a]]=t[n[a].substring(0,3)]=i(a)};u(i,(function(t){return function(){var n=e.today(),r=t-n.getDay();return(0===t&&1===Date.CultureInfo.firstDayOfWeek&&0!==n.getDay()||r<0)&&(r+=7),n.addDays(r)}}),l),u(a,(function(t){return function(){return e.today().set({month:t,day:1})}}),(function(e){return function(){return this._is?(this._is=!1,this.getMonth()===e):this.moveToMonth(e,this._orient)}}));for(var d=function(e){return function(){if(this._isSecond)return this._isSecond=!1,this;if(this._same){this._same=this._is=!1;var t=this.toObject(),n=(arguments[0]||new Date).toObject(),r="",i=e.toLowerCase();i="s"===i[i.length-1]?i.substring(0,i.length-1):i;for(var a=o.length-1;a>-1;a--){if(t[r=o[a].toLowerCase()]!==n[r])return!1;if(i===r)break}return!0}return"s"!==e.substring(e.length-1)&&(e+="s"),this._move&&(this._move=null),this["add"+e](this._orient)}},h=function(e){return function(){return this._dateElement=e,this}},p=0;p<o.length;p++)"weekday"!==(r=o[p].toLowerCase())&&(t[r]=t[r+"s"]=d(o[p]),n[r]=n[r+"s"]=h(r+"s"));t._ss=d("Second");for(var f=function(e){return function(t){return this._same?this._ss(arguments[0]):t||0===t?this.moveToNthOccurrence(t,e):(this._nth=e,2!==e||void 0!==t&&null!==t?this:(this._isSecond=!0,this.addSeconds(this._orient)))}},g=0;g<c.length;g++)t[c[g]]=f(0===g?-1:g)}(),function(){"use strict";Date.Parsing={Exception:function(e){this.message="Parse error at '"+e.substring(0,10)+" ...'"}};var e=Date.Parsing,t={standard:[0,31,59,90,120,151,181,212,243,273,304,334],leap:[0,31,60,91,121,152,182,213,244,274,305,335]};e.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0};var n={multiReplace:function(e,t){var n;for(n in t){var r;if(Object.prototype.hasOwnProperty.call(t,n))"function"===typeof t[n]||(r=t[n]instanceof RegExp?t[n]:new RegExp(t[n],"g")),e=e.replace(r,n)}return e},getDayOfYearFromWeek:function(e){var t,n;return e.weekDay=e.weekDay||0===e.weekDay?e.weekDay:1,n=(0===(t=new Date(e.year,0,4)).getDay()?7:t.getDay())+3,e.dayOfYear=7*e.week+(0===e.weekDay?7:e.weekDay)-n,e},getDayOfYear:function(e,t){e.dayOfYear||(e=n.getDayOfYearFromWeek(e));for(var r=0;r<=t.length;r++){if(e.dayOfYear<t[r]||r===t.length){e.day=e.day?e.day:e.dayOfYear-t[r-1];break}e.month=r}return e},adjustForTimeZone:function(e,t){var n;return"Z"===e.zone.toUpperCase()||0===e.zone_hours&&0===e.zone_minutes?n=-t.getTimezoneOffset():(n=60*e.zone_hours+(e.zone_minutes||0),"+"===e.zone_sign&&(n*=-1),n-=t.getTimezoneOffset()),t.setMinutes(t.getMinutes()+n),t},setDefaults:function(e){return e.year=e.year||Date.today().getFullYear(),e.hours=e.hours||0,e.minutes=e.minutes||0,e.seconds=e.seconds||0,e.milliseconds=e.milliseconds||0,(e.month||!e.week&&!e.dayOfYear)&&(e.month=e.month||0,e.day=e.day||1),e},dataNum:function(e,t,n,r){var i=1*e;return t?r?e?1*t(e):e:e?t(i):e:n?e&&"undefined"!==typeof e?i:e:e?i:e},timeDataProcess:function(e){var t={};for(var r in e.data)e.data.hasOwnProperty(r)&&(t[r]=e.ignore[r]?e.data[r]:n.dataNum(e.data[r],e.mods[r],e.explict[r],e.postProcess[r]));return e.data.secmins&&(e.data.secmins=60*e.data.secmins.replace(",","."),t.minutes?t.seconds||(t.seconds=e.data.secmins):t.minutes=e.data.secmins,delete e.secmins),t},buildTimeObjectFromData:function(e){return n.timeDataProcess({data:{year:e[1],month:e[5],day:e[7],week:e[8],dayOfYear:e[10],hours:e[15],zone_hours:e[23],zone_minutes:e[24],zone:e[21],zone_sign:e[22],weekDay:e[9],minutes:e[16],seconds:e[19],milliseconds:e[20],secmins:e[18]},mods:{month:function(e){return e-1},weekDay:function(e){return 7===(e=Math.abs(e))?0:e},minutes:function(e){return e.replace(":","")},seconds:function(e){return Math.floor(1*e.replace(":","").replace(",","."))},milliseconds:function(e){return 1e3*e.replace(",",".")}},postProcess:{minutes:!0,seconds:!0,milliseconds:!0},explict:{zone_hours:!0,zone_minutes:!0},ignore:{zone:!0,zone_sign:!0,secmins:!0}})},addToHash:function(e,t,n){n=n;for(var r=(t=t).length,i=0;i<r;i++)e[t[i]]=n[i];return e},combineRegex:function(e,t){return new RegExp("(("+e.source+")\\s("+t.source+"))")},getDateNthString:function(e,t,n){return e?Date.today().addDays(n).toString("d"):t?Date.today().last()[n]().toString("d"):void 0},buildRegexData:function(e){for(var t=[],n=e.length,r=0;r<n;r++)Array.isArray(e[r])?t.push(this.combineRegex(e[r][0],e[r][1])):t.push(e[r]);return t}};e.processTimeObject=function(r){var i,a;return n.setDefaults(r),a=e.isLeapYear(r.year)?t.leap:t.standard,r.month||!r.week&&!r.dayOfYear?r.dayOfYear=a[r.month]+r.day:n.getDayOfYear(r,a),i=new Date(r.year,r.month,r.day,r.hours,r.minutes,r.seconds,r.milliseconds),r.zone&&n.adjustForTimeZone(r,i),i},e.Numeric={isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},regex:/\b([0-1]?[0-9])([0-3]?[0-9])([0-2]?[0-9]?[0-9][0-9])\b/i,parse:function(t){var n,r,i={},a=Date.CultureInfo.dateElementOrder.split("");if(!this.isNumeric(t)||"+"===t[0]&&"-"===t[0])return null;if(t.length<5&&t.indexOf(".")<0&&t.indexOf("/")<0)return i.year=t,e.processTimeObject(i);if(!(n=t.match(this.regex))||!n.length)return null;for(r=0;r<a.length;r++)switch(a[r]){case"d":i.day=n[r+1];break;case"m":i.month=n[r+1]-1;break;case"y":i.year=n[r+1]}return e.processTimeObject(i)}},e.Normalizer={regexData:function(){var e=Date.CultureInfo.regexPatterns;return n.buildRegexData([e.tomorrow,e.yesterday,[e.past,e.mon],[e.past,e.tue],[e.past,e.wed],[e.past,e.thu],[e.past,e.fri],[e.past,e.sat],[e.past,e.sun]])},basicReplaceHash:function(){var e=Date.CultureInfo.regexPatterns;return{January:e.jan,February:e.feb,March:e.mar,April:e.apr,May:e.may,June:e.jun,July:e.jul,August:e.aug,September:e.sep,October:e.oct,November:e.nov,December:e.dec,"":/\bat\b/gi," ":/\s{2,}/,"9am":e.thisMorning,"7pm":e.thisEvening}},keys:function(){return[n.getDateNthString(!0,!1,1),n.getDateNthString(!0,!1,-1),n.getDateNthString(!1,!0,"monday"),n.getDateNthString(!1,!0,"tuesday"),n.getDateNthString(!1,!0,"wednesday"),n.getDateNthString(!1,!0,"thursday"),n.getDateNthString(!1,!0,"friday"),n.getDateNthString(!1,!0,"saturday"),n.getDateNthString(!1,!0,"sunday")]},buildRegexFunctions:function(){var e=Date.CultureInfo.regexPatterns,t=Date.i18n.__,n=new RegExp("(\\b\\d\\d?("+t("AM")+"|"+t("PM")+")? )("+e.tomorrow.source.slice(1)+")","i"),r=new RegExp(e.today.source+"(?!\\s*([+-]))\\b");this.replaceFuncs=[[r,function(e){return e.length>1?Date.today().toString("d"):e}],[n,function(e,t){return Date.today().addDays(1).toString("d")+" "+t}]]},buildReplaceData:function(){this.buildRegexFunctions(),this.replaceHash=n.addToHash(this.basicReplaceHash(),this.keys(),this.regexData())},stringReplaceFuncs:function(e){for(var t=0;t<this.replaceFuncs.length;t++)e=e.replace(this.replaceFuncs[t][0],this.replaceFuncs[t][1]);return e},parse:function(t){t=this.stringReplaceFuncs(t),t=n.multiReplace(t,this.replaceHash);try{var r=t.split(/([\s\-\.\,\/\x27]+)/);3===r.length&&e.Numeric.isNumeric(r[0])&&e.Numeric.isNumeric(r[2])&&r[2].length>=4&&"d"===Date.CultureInfo.dateElementOrder[0]&&(t="1/"+r[0]+"/"+r[2])}catch(i){}return t}},e.Normalizer.buildReplaceData()}(),function(){for(var e=Date.Parsing,t=e.Operators={rtoken:function(t){return function(n){var r=n.match(t);if(r)return[r[0],n.substring(r[0].length)];throw new e.Exception(n)}},token:function(){return function(e){return t.rtoken(new RegExp("^\\s*"+e+"\\s*"))(e)}},stoken:function(e){return t.rtoken(new RegExp("^"+e))},until:function(e){return function(t){for(var n=[],r=null;t.length;){try{r=e.call(this,t)}catch(i){n.push(r[0]),t=r[1];continue}break}return[n,t]}},many:function(e){return function(t){for(var n=[],r=null;t.length;){try{r=e.call(this,t)}catch(i){return[n,t]}n.push(r[0]),t=r[1]}return[n,t]}},optional:function(e){return function(t){var n=null;try{n=e.call(this,t)}catch(r){return[null,t]}return[n[0],n[1]]}},not:function(t){return function(n){try{t.call(this,n)}catch(r){return[null,n]}throw new e.Exception(n)}},ignore:function(e){return e?function(t){return[null,e.call(this,t)[1]]}:null},product:function(){for(var e=arguments[0],n=Array.prototype.slice.call(arguments,1),r=[],i=0;i<e.length;i++)r.push(t.each(e[i],n));return r},cache:function(t){var n={},r=0,i=[],a=Date.Config.CACHE_MAX||500,o=null;return function(s){!function(){if(r===a)for(var e=0;e<10;e++){var t=i.shift();t&&(delete n[t],r--)}}();try{o=n[s]=n[s]||t.call(this,s)}catch(c){o=n[s]=c}if(r++,i.push(s),o instanceof e.Exception)throw o;return o}},any:function(){var t=arguments;return function(n){for(var r=null,i=0;i<t.length;i++)if(null!=t[i]){try{r=t[i].call(this,n)}catch(a){r=null}if(r)return r}throw new e.Exception(n)}},each:function(){var t=arguments;return function(n){for(var r=[],i=null,a=0;a<t.length;a++)if(null!=t[a]){try{i=t[a].call(this,n)}catch(o){throw new e.Exception(n)}r.push(i[0]),n=i[1]}return[r,n]}},all:function(){var e=arguments,t=t;return t.each(t.optional(e))},sequence:function(n,r,i){return r=r||t.rtoken(/^\s*/),i=i||null,1===n.length?n[0]:function(t){for(var a=null,o=null,s=[],c=0;c<n.length;c++){try{a=n[c].call(this,t)}catch(l){break}s.push(a[0]);try{o=r.call(this,a[1])}catch(u){o=null;break}t=o[1]}if(!a)throw new e.Exception(t);if(o)throw new e.Exception(o[1]);if(i)try{a=i.call(this,a[1])}catch(d){throw new e.Exception(a[1])}return[s,a?a[1]:t]}},between:function(e,n,i){i=i||e;var a=t.each(t.ignore(e),n,t.ignore(i));return function(e){var t=a.call(this,e);return[[t[0][0],r[0][2]],t[1]]}},list:function(e,n,r){return n=n||t.rtoken(/^\s*/),r=r||null,e instanceof Array?t.each(t.product(e.slice(0,-1),t.ignore(n)),e.slice(-1),t.ignore(r)):t.each(t.many(t.each(e,t.ignore(n))),px,t.ignore(r))},set:function(n,r,i){return r=r||t.rtoken(/^\s*/),i=i||null,function(a){for(var o=null,s=null,c=null,l=null,u=[[],a],d=!1,h=0;h<n.length;h++){c=null,s=null,o=null,d=1===n.length;try{o=n[h].call(this,a)}catch(g){continue}if(l=[[o[0]],o[1]],o[1].length>0&&!d)try{c=r.call(this,o[1])}catch(m){d=!0}else d=!0;if(d||0!==c[1].length||(d=!0),!d){for(var p=[],f=0;f<n.length;f++)h!==f&&p.push(n[f]);(s=t.set(p,r).call(this,c[1]))[0].length>0&&(l[0]=l[0].concat(s[0]),l[1]=s[1])}if(l[1].length<u[1].length&&(u=l),0===u[1].length)break}if(0===u[0].length)return u;if(i){try{c=i.call(this,u[1])}catch(v){throw new e.Exception(u[1])}u[1]=c[1]}return u}},forward:function(e,t){return function(n){return e[t].call(this,n)}},replace:function(e,t){return function(n){var r=e.call(this,n);return[t,r[1]]}},process:function(e,t){return function(n){var r=e.call(this,n);return[t.call(this,r[0]),r[1]]}},min:function(t,n){return function(r){var i=n.call(this,r);if(i[0].length<t)throw new e.Exception(r);return i}}},n=function(e){return function(){var t,n,r=null,i=[];return arguments.length>1?r=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(r=arguments[0]),r?(t=r.shift()).length>0?(r.unshift(t[n]),i.push(e.apply(null,r)),r.shift(),i):void 0:e.apply(null,arguments)}},i="optional not ignore cache".split(/\s/),a=0;a<i.length;a++)t[i[a]]=n(t[i[a]]);for(var o=function(e){return function(){return arguments[0]instanceof Array?e.apply(null,arguments[0]):e.apply(null,arguments)}},s="each any all".split(/\s/),c=0;c<s.length;c++)t[s[c]]=o(t[s[c]])}(),function(){var e=Date,t=function(e){for(var n=[],r=0;r<e.length;r++)e[r]instanceof Array?n=n.concat(t(e[r])):e[r]&&n.push(e[r]);return n},n=function(){if(this.meridian&&(this.hour||0===this.hour)){if("a"===this.meridian&&this.hour>11&&Date.Config.strict24hr)throw"Invalid hour and meridian combination";if("p"===this.meridian&&this.hour<12&&Date.Config.strict24hr)throw"Invalid hour and meridian combination";"p"===this.meridian&&this.hour<12?this.hour=this.hour+12:"a"===this.meridian&&12===this.hour&&(this.hour=0)}else this.meridian||!this.hour&&0!==this.hour||this.hour<8&&(this.hour=this.hour+12)},r=function(){var e=new Date;!this.hour&&!this.minute||this.month||this.year||this.day||(this.day=e.getDate()),this.year||(this.year=e.getFullYear(),this.month<e.getMonth()&&this.year++),this.month||0===this.month||(this.month=e.getMonth()),this.day||(this.day=1),this.hour||(this.hour=0),this.minute||(this.minute=0),this.second||(this.second=0),this.millisecond||(this.millisecond=0)},i={getToday:function(){return this.now||-1!=="hour minute second".indexOf(this.unit)?new Date:e.today()},setDaysFromWeekday:function(t,n){var r;return n=n||1,this.unit="day",r=e.getDayNumberFromName(this.weekday)-t.getDay(),this.days=r?r+7*n:7*n,this},setMonthsFromMonth:function(e,t){var n;return t=t||1,this.unit="month",n=this.month-e.getMonth(),this.months=n?(n+12*t)%12:12*t,this.month=null,this},setDMYFromWeekday:function(){var e=Date[this.weekday]();return this.day=e.getDate(),this.month||(this.month=e.getMonth()),this.year=e.getFullYear(),this},setUnitValue:function(e){!this.value&&this.operator&&null!==this.operator&&this[this.unit+"s"]&&null!==this[this.unit+"s"]?this[this.unit+"s"]=this[this.unit+"s"]+("add"===this.operator?1:-1)+(this.value||0)*e:null!=this[this.unit+"s"]&&null==this.operator||(this.value||(this.value=1),this[this.unit+"s"]=this.value*e)},generateDateFromWeeks:function(){var e=void 0!==this.weekday?this.weekday:"today",t=Date[e]().addWeeks(this.weeks);return this.now&&t.setTimeToNow(),t}};e.Translator={hour:function(e){return function(){this.hour=Number(e),this.setExplicitTime=!0}},minute:function(e){return function(){this.minute=Number(e),this.setExplicitTime=!0}},second:function(e){return function(){this.second=Number(e),this.setExplicitTime=!0}},secondAndMillisecond:function(e){return function(){var t=e.match(/^([0-5][0-9])\.([0-9]{1,3})/);this.second=Number(t[1]),this.millisecond=Number(t[2]),this.setExplicitTime=!0}},meridian:function(e){return function(){this.meridian=e.slice(0,1).toLowerCase(),this.setExplicitTime=!0}},timezone:function(e){return function(){var t=e.replace(/[^\d\+\-]/g,"");t.length?this.timezoneOffset=Number(t):this.timezone=e.toLowerCase()}},day:function(e){var t=e[0];return function(){if(this.day=Number(t.match(/\d+/)[0]),this.day<1)throw"invalid day"}},month:function(e){return function(){if(this.month=3===e.length?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(e)/4:Number(e)-1,this.month<0)throw"invalid month"}},year:function(e){return function(){var t=Number(e);this.year=e.length>2?t:t+(t+2e3<Date.CultureInfo.twoDigitYearMax?2e3:1900)}},rday:function(e){return function(){switch(e){case"yesterday":this.days=-1;break;case"someday":this.days=14;break;case"later":this.days=5;break;case"soon":this.days=2;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(t){var i;t=t instanceof Array?t:[t];for(var a=0;a<t.length;a++)t[a]&&t[a].call(this);if(r.call(this),n.call(this),this.day>e.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");return i=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond),this.setExplicitTime&&i.ensureTimeOfDay(),this.year<100&&i.setFullYear(this.year),this.timezone?i.set({timezone:this.timezone}):this.timezoneOffset&&i.set({timezoneOffset:this.timezoneOffset}),i},finish:function(r){var a,o,s,c;if(0===(r=r instanceof Array?t(r):[r]).length)return null;for(var l=0;l<r.length;l++)"function"===typeof r[l]&&r[l].call(this);if(this.now&&!this.unit&&!this.operator)return new Date;if(a=i.getToday.call(this),givenYear=!!this.year,o=!!(this.days&&null!==this.days||this.orient||this.operator),s="past"===this.orient||"subtract"===this.operator?-1:1,this.month&&"week"===this.unit&&(this.value=this.month+1,delete this.month,delete this.day),!this.month&&0!==this.month||-1==="year day hour minute second".indexOf(this.unit)||(this.value||(this.value=this.month+1),this.month=null,o=!0),o||!this.weekday||this.day||this.days||i.setDMYFromWeekday.call(this),o&&this.weekday&&"month"!==this.unit&&"week"!==this.unit&&i.setDaysFromWeekday.call(this,a,s),!this.weekday||"week"===this.unit||this.day||this.days||(c=Date[this.weekday](),this.day=c.getDate(),c.getMonth()!==a.getMonth()&&(this.month=c.getMonth())),this.month&&"day"===this.unit&&this.operator&&(this.value||(this.value=this.month+1),this.month=null),null==this.value||null==this.month||null==this.year||this.day||(this.day=1*this.value),this.month&&!this.day&&this.value&&(a.set({day:1*this.value}),o||(this.day=1*this.value)),this.month||!this.value||"month"!==this.unit||this.now||(this.month=this.value,o=!0),o&&(this.month||0===this.month)&&"year"!==this.unit&&i.setMonthsFromMonth.call(this,a,s),this.unit||(this.unit="day"),i.setUnitValue.call(this,s),n.call(this),!this.month&&0!==this.month||this.day||(this.day=1),!this.orient&&!this.operator&&"week"===this.unit&&this.value&&!this.day&&!this.month)return Date.today().setWeek(this.value);if("week"===this.unit&&this.weeks&&!this.day&&!this.month)return i.generateDateFromWeeks.call(this);if(o&&this.timezone&&this.day&&this.days&&(this.day=this.days),!givenYear&&this.month<a.getMonth()&&(this.year=a.getFullYear()+1),o&&(this.hour||this.minute||this.second)&&(this.hours=this.hour,this.minutes=this.minute,this.seconds=this.second),o?a.add(this):a.set(this),this.timezone){this.timezone=this.timezone.toUpperCase();var u=e.getTimezoneOffset(this.timezone);a.hasDaylightSavingTime()&&e.getTimezoneAbbreviation(u,a.isDaylightSavingTime())!==this.timezone&&(a.isDaylightSavingTime()?a.addHours(-1):a.addHours(1)),a.setTimezoneOffset(u)}return a}}}(),function(){var e=Date;e.Grammar={};var t,n=e.Parsing.Operators,r=e.Grammar,i=e.Translator;t=function(){return n.each(n.any.apply(null,arguments),n.not(r.ctoken2("timeContext")))},r.datePartDelimiter=n.rtoken(/^([\s\-\.\,\/\x27]+)/),r.timePartDelimiter=n.stoken(":"),r.whiteSpace=n.rtoken(/^\s*/),r.generalDelimiter=n.rtoken(/^(([\s\,]|at|@|on)+)/);var a={};r.ctoken=function(e){var t=a[e];if(!t){for(var r=Date.CultureInfo.regexPatterns,i=e.split(/\s+/),o=[],s=0;s<i.length;s++)o.push(n.replace(n.rtoken(r[i[s]]),i[s]));t=a[e]=n.any.apply(null,o)}return t},r.ctoken2=function(e){return n.rtoken(Date.CultureInfo.regexPatterns[e])};var o=function(e,t,i,a){r[e]=a?n.cache(n.process(n.each(n.rtoken(t),n.optional(r.ctoken2(a))),i)):n.cache(n.process(n.rtoken(t),i))},s=function(e,t){return n.cache(n.process(r.ctoken2(e),t))},c={},l=function(e){return c[e]=c[e]||r.format(e)[0],c[e]};r.allformats=function(e){var t=[];if(e instanceof Array)for(var n=0;n<e.length;n++)t.push(l(e[n]));else t.push(l(e));return t},r.formats=function(e){if(e instanceof Array){for(var t=[],r=0;r<e.length;r++)t.push(l(e[r]));return n.any.apply(null,t)}return l(e)};var u=function(){var e,t=["h","hh","H","HH","m","mm","s","ss","ss.s","z","zz"],a=[/^(0[0-9]|1[0-2]|[1-9])/,/^(0[0-9]|1[0-2])/,/^([0-1][0-9]|2[0-3]|[0-9])/,/^([0-1][0-9]|2[0-3])/,/^([0-5][0-9]|[0-9])/,/^[0-5][0-9]/,/^([0-5][0-9]|[0-9])/,/^[0-5][0-9]/,/^[0-5][0-9]\.[0-9]{1,3}/,/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/,/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/],c=[i.hour,i.hour,i.hour,i.hour,i.minute,i.minute,i.second,i.second,i.secondAndMillisecond,i.timezone,i.timezone];for(e=0;e<t.length;e++)o(t[e],a[e],c[e]);r.hms=n.cache(n.sequence([r.H,r.m,r.s],r.timePartDelimiter)),r.t=s("shortMeridian",i.meridian),r.tt=s("longMeridian",i.meridian),r.zzz=s("timezone",i.timezone),r.timeSuffix=n.each(n.ignore(r.whiteSpace),n.set([r.tt,r.zzz])),r.time=n.each(n.optional(n.ignore(n.stoken("T"))),r.hms,r.timeSuffix)},d=function(){o("d",/^([0-2]\d|3[0-1]|\d)/,i.day,"ordinalSuffix"),o("dd",/^([0-2]\d|3[0-1])/,i.day,"ordinalSuffix"),r.rday=n.cache(n.process(r.ctoken("yesterday tomorrow soon later someday today now"),i.rday)),r.ddd=r.dddd=n.cache(n.process(r.ctoken("sun mon tue wed thu fri sat"),(function(e){return function(){this.weekday=e}}))),o("M",/^(1[0-2]|0\d|\d)/,i.month),o("MM",/^(1[0-2]|0\d)/,i.month),r.MMM=r.MMMM=n.cache(n.process(r.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),i.month)),o("y",/^(\d+)/,i.year),o("yy",/^(\d\d)/,i.year),o("yyy",/^(\d\d?\d?\d?)/,i.year),o("yyyy",/^(\d\d\d\d)/,i.year),r.day=t(r.d,r.dd),r.month=t(r.M,r.MMM),r.year=t(r.yyyy,r.yy);var e=function(){return n.set(arguments,r.datePartDelimiter)};r.mdy=e(r.ddd,r.month,r.day,r.year),r.ymd=e(r.ddd,r.year,r.month,r.day),r.dmy=e(r.ddd,r.day,r.month,r.year),r.date=function(e){return(r[Date.CultureInfo.dateElementOrder]||r.mdy).call(this,e)}},h=function(){r.orientation=n.process(r.ctoken("past future"),(function(e){return function(){this.orient=e}})),r.operator=n.process(r.ctoken("add subtract"),(function(e){return function(){this.operator=e}}))};r.buildGrammarFormats=function(){a={},u(),d(),h(),r.value=n.process(n.rtoken(/^([-+]?\d+)?(st|nd|rd|th)?/),(function(e){return function(){this.value=e.replace(/\D/g,"")}})),r.expression=n.set([r.rday,r.time,r.value,r.orientation,r.ddd,r.MMM]),r.format=n.process(n.many(n.any(n.process(n.rtoken(/^(dd?d?d?(?!e)|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),(function(t){if(r[t])return r[t];throw e.Parsing.Exception(t)})),n.process(n.rtoken(/^[^dMyhHmstz]+/),(function(e){return n.ignore(n.stoken(e))})))),(function(e){return n.process(n.each.apply(null,e),i.finishExact)})),r._start=n.process(n.set([r.date,r.expression,r.time],r.generalDelimiter,r.whiteSpace),i.finish)},r.buildGrammarFormats(),r._formats=r.formats(["M-d H","ddd H"]),r.start=function(e){try{var t=r._formats.call({},e);if(0===t[1].length)return t}catch(n){}return r._start.call({},e)}}(),function(){var e=Date,t=function(e){var t=e.match(/\b(\d+)(?:st|nd|rd|th)\b/);return e=t&&2===t.length?e.replace(t[0],t[1]):e},n=function(t){var n=null;try{n=e.Grammar.start.call({},t.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(r){return null}return 0===n[1].length?n[0]:null};e._parse||(e._parse=e.parse),e.parse=function(r){var i;return r?r instanceof Date?r.clone():(r.length>=4&&"0"!==r.charAt(0)&&"+"!==r.charAt(0)&&"-"!==r.charAt(0)&&(i=e.Parsing.Numeric.parse(r)),i instanceof Date&&!isNaN(i.getTime())?i:(r=e.Parsing.Normalizer.parse(t(r)),i=n(r))):null},Date.getParseFunction=function(e){var t=Date.Grammar.allformats(e);return function(e){for(var n=null,r=0;r<t.length;r++){try{n=t[r].call({},e)}catch(i){continue}if(0===n[1].length)return n[0]}return null}},e.parseExact=function(t,n){return e.getParseFunction(n)(t)}}(),function(){var e=Date,n=e.prototype,r=function(e,t){return t||(t=2),("000"+e).slice(-1*t)},i={substitutes:function(e){switch(e){case"d":case"%d":return"dd";case"D":case"%a":return"ddd";case"j":case"l":case"%A":return"dddd";case"S":return"S";case"F":case"%B":return"MMMM";case"m":case"%m":return"MM";case"M":case"%b":case"%h":return"MMM";case"n":return"M";case"Y":case"%Y":return"yyyy";case"y":case"%y":return"yy";case"g":case"%I":return"h";case"G":return"H";case"h":return"hh";case"H":case"%H":return"HH";case"i":case"%M":return"mm";case"s":case"%S":return"ss";case"%r":return"hh:mm tt";case"%R":return"H:mm";case"%T":return"H:mm:ss";case"%X":return"t";case"%x":case"%e":return"d";case"%D":return"MM/dd/yy";case"%n":return"\\n";case"%t":return"\\t";case"e":case"T":case"%z":case"%Z":return"z";case"Z":return"ZZ";case"N":case"w":case"%w":return"u";case"W":case"%V":return"W"}},interpreted:function(n,i){var a;switch(n){case"%u":return i.getDay()+1;case"z":return i.getOrdinalNumber();case"%j":return r(i.getOrdinalNumber(),3);case"%U":var o=i.clone().set({month:0,day:1}).addDays(-1).moveToDayOfWeek(0),s=i.clone().addDays(1).moveToDayOfWeek(0,-1);return s<o?"00":r((s.getOrdinalNumber()-o.getOrdinalNumber())/7+1);case"%W":return r(i.getWeek());case"t":return e.getDaysInMonth(i.getFullYear(),i.getMonth());case"o":case"%G":return i.setWeek(i.getISOWeek()).toString("yyyy");case"%g":return i._format("%G").slice(-2);case"a":case"%p":return t("tt").toLowerCase();case"A":return t("tt").toUpperCase();case"u":return r(i.getMilliseconds(),3);case"I":return i.isDaylightSavingTime()?1:0;case"O":return i.getUTCOffset();case"P":return(a=i.getUTCOffset()).substring(0,a.length-2)+":"+a.substring(a.length-2);case"B":var c=new Date;return Math.floor((3600*c.getHours()+60*c.getMinutes()+c.getSeconds()+60*(c.getTimezoneOffset()+60))/86.4);case"c":return i.toISOString().replace(/\"/g,"");case"U":return e.strtotime("now");case"%c":return t("d")+" "+t("t");case"%C":return Math.floor(i.getFullYear()/100+1)}},shouldOverrideDefaults:function(e){switch(e){case"%e":return!0;default:return!1}},parse:function(e,t){var n,r=t||new Date;return(n=i.substitutes(e))?n:(n=i.interpreted(e,r))||e}};e.normalizeFormat=function(e,t){return e.replace(/(%|\\)?.|%%/g,(function(e){return i.parse(e,t)}))},e.strftime=function(e,t){return Date.parse(t)._format(e)},e.strtotime=function(t){var n=e.parse(t);return Math.round(e.UTC(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),n.getUTCMilliseconds())/1e3)};n._format=function(t){var n,r=(n=this,function(t){var r,a;return"\\"===t.charAt(0)||"%%"===t.substring(0,2)?t.replace("\\","").replace("%%","%"):(a=i.shouldOverrideDefaults(t),(r=e.normalizeFormat(t,n))?n.toString(r,a):void 0)});return t?t.replace(/(%|\\)?.|%%/g,r):this._toString()},n.format||(n.format=n._format)}(),function(){"use strict";var e=function(e){return function(){return this[e]}},t=function(e){return function(t){return this[e]=t,this}},n=function(e,t,r,i,a){if(1===arguments.length&&"number"===typeof e){var o=e<0?-1:1,s=Math.abs(e);this.setDays(Math.floor(s/864e5)*o),s%=864e5,this.setHours(Math.floor(s/36e5)*o),s%=36e5,this.setMinutes(Math.floor(s/6e4)*o),s%=6e4,this.setSeconds(Math.floor(s/1e3)*o),s%=1e3,this.setMilliseconds(s*o)}else this.set(e,t,r,i,a);return this.getTotalMilliseconds=function(){return 864e5*this.getDays()+36e5*this.getHours()+6e4*this.getMinutes()+1e3*this.getSeconds()},this.compareTo=function(e){var t,n=new Date(1970,1,1,this.getHours(),this.getMinutes(),this.getSeconds());return n<(t=null===e?new Date(1970,1,1,0,0,0):new Date(1970,1,1,e.getHours(),e.getMinutes(),e.getSeconds()))?-1:n>t?1:0},this.equals=function(e){return 0===this.compareTo(e)},this.add=function(e){return null===e?this:this.addSeconds(e.getTotalMilliseconds()/1e3)},this.subtract=function(e){return null===e?this:this.addSeconds(-e.getTotalMilliseconds()/1e3)},this.addDays=function(e){return new n(this.getTotalMilliseconds()+864e5*e)},this.addHours=function(e){return new n(this.getTotalMilliseconds()+36e5*e)},this.addMinutes=function(e){return new n(this.getTotalMilliseconds()+6e4*e)},this.addSeconds=function(e){return new n(this.getTotalMilliseconds()+1e3*e)},this.addMilliseconds=function(e){return new n(this.getTotalMilliseconds()+e)},this.get12HourHour=function(){return this.getHours()>12?this.getHours()-12:0===this.getHours()?12:this.getHours()},this.getDesignator=function(){return this.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator},this.toString=function(e){this._toString=function(){return null!==this.getDays()&&this.getDays()>0?this.getDays()+"."+this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds()):this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds())},this.p=function(e){return e.toString().length<2?"0"+e:e};var t=this;return e?e.replace(/dd?|HH?|hh?|mm?|ss?|tt?/g,(function(e){switch(e){case"d":return t.getDays();case"dd":return t.p(t.getDays());case"H":return t.getHours();case"HH":return t.p(t.getHours());case"h":return t.get12HourHour();case"hh":return t.p(t.get12HourHour());case"m":return t.getMinutes();case"mm":return t.p(t.getMinutes());case"s":return t.getSeconds();case"ss":return t.p(t.getSeconds());case"t":return(t.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator).substring(0,1);case"tt":return t.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator}})):this._toString()},this};!function(n,r){for(var i=0;i<r.length;i++){var a=r[i],o=a.slice(0,1).toUpperCase()+a.slice(1);n.prototype[a]=0,n.prototype["get"+o]=e(a),n.prototype["set"+o]=t(a)}}(n,["years","months","days","hours","minutes","seconds","milliseconds"].slice(2)),n.prototype.set=function(e,t,n,r,i){this.setDays(e||this.getDays()),this.setHours(t||this.getHours()),this.setMinutes(n||this.getMinutes()),this.setSeconds(r||this.getSeconds()),this.setMilliseconds(i||this.getMilliseconds())},Date.prototype.getTimeOfDay=function(){return this.getMilliseconds()+1e3*this.getSeconds()+6e4*this.getMinutes()+36e5*this.getHours()},Date.prototype.hasTimeOfDay=function(){return 0!==this.getHours()||0!==this.getMinutes()||0!==this.getSeconds()||0!==this.getMilliseconds()},Date.prototype.isRepeatDate=function(){return!1},Date.TimeSpan=n,"undefined"!==typeof window&&(window.TimeSpan=n)}(),function(){"use strict";var e=function(e){return function(){return this[e]}},t=function(e){return function(t){return this[e]=t,this}},n=function(e,t,n,r){function i(){t.addMonths(-e),r.months++,12===r.months&&(r.years++,r.months=0)}if(1===e)for(;t>n;)i();else for(;t<n;)i();r.months--,r.months*=e,r.years*=e},r=function(e,t,n){var r=!1===(t.isDaylightSavingTime()===n.isDaylightSavingTime());r&&1===e?t.addHours(-1):r&&t.addHours(1)},i=function(e,t,i,a,o,s,c){if(7===arguments.length)this.set(e,t,i,a,o,s,c);else if(2===arguments.length&&arguments[0]instanceof Date&&arguments[1]instanceof Date){var l=arguments[0].clone(),u=arguments[1].clone(),d=l>u?1:-1;this.dates={start:arguments[0].clone(),end:arguments[1].clone()},n(d,l,u,this),r(d,l,u);var h=u-l;if(0!==h){var p=new TimeSpan(h);this.set(this.years,this.months,p.getDays(),p.getHours(),p.getMinutes(),p.getSeconds(),p.getMilliseconds())}}return this};!function(n,r){for(var i=0;i<r.length;i++){var a=r[i],o=a.slice(0,1).toUpperCase()+a.slice(1);n.prototype[a]=0,n.prototype["get"+o]=e(a),n.prototype["set"+o]=t(a)}}(i,["years","months","days","hours","minutes","seconds","milliseconds"]),i.prototype.set=function(e,t,n,r,i,a,o){this.setYears(e||this.getYears()),this.setMonths(t||this.getMonths()),this.setDays(n||this.getDays()),this.setHours(r||this.getHours()),this.setMinutes(i||this.getMinutes()),this.setSeconds(a||this.getSeconds()),this.setMilliseconds(o||this.getMilliseconds())},Date.TimePeriod=i,"undefined"!==typeof window&&(window.TimePeriod=i)}()},3761:(e,t,n)=>{"use strict";n.d(t,{Z:()=>P});var r=n(9713),i=n.n(r),a=n(8926),o=n.n(a),s=n(4575),c=n.n(s),l=n(3913),u=n.n(l),d=n(7757),h=n.n(d),p=n(8855),f=n(8651),g=n(4654),m=n(5193),v=n(6374),y=n(9105),k=n(1392),_=n(3868),Z={"#text":!0,SPAN:!0},w={DIV:!0,LI:!0,IMG:!0,UL:!0,OL:!0,P:!0},b={UL:!0,OL:!0};const P=new(function(){function e(){c()(this,e)}return u()(e,[{key:"_setSectionValue",value:function(e,t,n){e.hasOwnProperty(t)||(e[t]=n)}},{key:"_parseSection",value:function(e,t){for(var n=0,r={},i=t;i<e.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=e[i];if(a){var o=a.indexOf(":"),s=[a.substr(0,o),a.substr(o+1)],c=s[0].split(";");switch(c[0]){case"BEGIN":var l=this._parseSection(e,i+1);i+=l.size,r[s[1]]=l.section;break;case"END":return{section:r,size:i-t+1};default:if(c.length>1){for(var u=0,d={value:s[1]},h=1;h<c.length;++h){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var p=c[h].split("=");try{f.Z.PAssert(278,!d.hasOwnProperty(p[0]),"Should never overwrite line values")}catch(g){f.Z.reportError(g)}d[p[0]]=p[1]}this._setSectionValue(r,c[0],d)}else this._setSectionValue(r,c[0],s[1]);break;case void 0:case null:try{f.Z.PAssert(279,!1,"Invalid ICS format: "+a)}catch(g){f.Z.reportError(g)}}}}return r}},{key:"parseICS",value:function(e){for(var t=0,n=e.split("\n"),r=[],i=0;i<n.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=n[i];a.startsWith(" ")?r[r.length-1]+=a.trim():r.push(a.trim())}return this._parseSection(r,0)}},{key:"parseHead",value:function(e){for(var t=0,n={},r=0;r<e.childElementCount;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e.children[r],a=i.nodeName;if(i.firstChild){var o=i.firstChild.textContent;n[a]=o}}return n}},{key:"parseOPML",value:function(e){var t=f.Z.loadXML(e);return this._parseOPMLData(t)}},{key:"_parseDate",value:function(e){if(e){var t=Date.parse(e);if(t&&f.Z.isDateValid(t))return+t}}},{key:"_parseOPMLData",value:function(e){var t=this,n={items:[]};return function e(r,i,a){var o,s=!0;switch(r.nodeName){case"#document":case"body":case"opml":break;case"head":s=!1;var c=t.parseHead(r);n.text=null===c||void 0===c?void 0:c.title;break;case"outline":var l,u=r.attributes,d=u.text,h=d?d.value:"",g=u.complete||u._complete,m=!(!g||"true"!==g.value),v=u.note||u._note||u.Notes,y=t.convertHTMLFormatting(h),k=t._parseDate(r.getAttribute("created")),_=t._parseDate(r.getAttribute("changed")),Z=t._parseDate(r.getAttribute("due")),w=r.getAttribute("_status");"checked"!==w&&"unchecked"!==w||(y.startsWith("[ ")||(y="[ "+y),"checked"===w&&(m=!0)),Z&&(y+=" "+p.Z.CharDate),o={id:null===(l=u.id)||void 0===l?void 0:l.value,text:y,isComplete:m,items:[],index:""+a,dateCreated:k,dateModified:_,date:Z};try{t.parseClassName(Array.from(r.attributes).map((function(e){return e.localName})),o)}catch(D){}if(v){var b=f.Z.unescape(v.value);o.items=[{text:b,isNote:!0}]}i.items.push(o);break;default:f.Z.log("Unknown OPML Node: ",r)}if(s)for(var P=0,S=0;S<r.childElementCount;++S){if(P++>5e3&&__infLoop&&__infLoop(P))throw new RangeError;e(r.children[S],o||n,S)}return o}(e,n,0),n}},{key:"parseJSON",value:function(){var e=o()(h().mark((function e(t,n){var r,i,a,o;return h().wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:if(void 0===t.moodoVer||void 0===t.moodoRoot&&void 0===t.items){e.next=26;break}if(e.prev=1,!t.doc){e.next=19;break}if(i={},!t.sentinel){e.next=15;break}if(!(o=g.default.crypto.getKeyBySentinel(t.sentinel))){e.next=12;break}return e.next=9,Promise.all(t.items.map((function(e){return y.Z.decryptItemIn(e,g.default.crypto,o)})));case 9:a=e.sent,e.next=13;break;case 12:return e.abrupt("return",null);case 13:e.next=16;break;case 15:a=t.items.map(y.Z.itemIn);case 16:n&&(a.forEach((function(e){var t=i[e.id];t||(t=m.Z.generateID(),i[e.id]=t),e.id=t})),a.forEach((function(e){if(e.text=e.text.replace(p.Z.Regexp.Interlink,(function(e,t){var n=i[t];return n?"[[".concat(n,"]]"):e})),e.parent){e.parent=i[e.parent];try{f.Z.PAssert(280,e.parent,"Imported item has no parent")}catch(t){f.Z.reportError(t)}}}))),v.Z.createItemHierarchy(a),r={rootData:a[0],root:a[0],text:t.doc.text,items:a};case 19:return n&&r&&(r.root.id=m.Z.generateID()),e.abrupt("return",r);case 23:e.prev=23,e.t0=e.catch(1),f.Z.reportError(e.t0);case 26:return e.abrupt("return",!1);case 27:case"end":return e.stop()}}}),e,null,[[1,23]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_findLineParent",value:function(e,t,n){for(var r,i=0,a=Math.min(e.length-1,t-1);a>=0;--a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=e[a];if(o&&o.indentLevel===n-1){r=o;break}}return r}},{key:"convertCodeBlocks",value:function(e){var t=[];e.items.forEach((function(e,n){var r;if(null!==(r=e.text)&&void 0!==r&&r.startsWith("```")){var i=t[0];!i||i.end?t.splice(0,0,{start:n}):i.end=n}})),t.forEach((function(t){var n=t.start,r=t.end;if(void 0!==n&&r){var i=e.items[n].text.replace("```","").trim(),a=e.items.slice(n+1,r).map((function(e){return e.text})).join("\n");e.items[n].text=p.Z.Prefix.CodeBlock+(i||"")+" "+a,e.items.splice(n+1,r-n)}}))}},{key:"parseClassName",value:function(e,t){if(e)return e.indexOf("high")>=0?t.priority=p.Z.VMLIFlag.P1:e.indexOf("medium")>=0?t.priority=p.Z.VMLIFlag.P2:e.indexOf("low")>=0&&(t.priority=p.Z.VMLIFlag.P3),e.indexOf("complete")>=0&&(t.isComplete=!0),e.indexOf("starred")>=0&&(t.isStarred=!0),e.indexOf("note")>=0&&(t.isNote=!0),t}},{key:"parseForTab",value:function(e){return(null===e||void 0===e?void 0:e.indexOf("Apple-tab-span"))>=0}},{key:"traverseDOMNew",value:function(e){var t,n,r=this.parseDOM(e),i=this.parsedDOMToItemData(r).itemData;return i.text||1!==(null===(t=i.items)||void 0===t?void 0:t.length)||i.items[0].text||1!==(null===(n=i.items[0].items)||void 0===n?void 0:n.length)||(i=i.items[0]),i.text?{items:[i]}:i}},{key:"parseDOM",value:function(e){var t,n,r=this;if("META"!==e.nodeName){if("#text"===e.nodeName)return{nodeNames:[e.nodeName],text:e.textContent};if("LI"===e.nodeName&&e.classList.contains("note"))return{nodeNames:["#text"],text:e.innerHTML,className:"note"};if("BR"===e.nodeName||0===e.childNodes.length&&null!==(t=e.classList)&&void 0!==t&&t.contains("c-mrkdwn__br"))return{nodeNames:["BR"],linebreak:!0};if(null!==(n=e.childNodes)&&void 0!==n&&n.length){for(var i=0,a=[],o=function(t){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=r.parseDOM(e.childNodes[t]);n&&(null===n||void 0===n||!n.items||n.text||r.isNodeList(n)?a.push(n):(n.items.forEach((function(e){return r.combineNodeAttrs(e,n)})),a.pushArray(n.items)))},s=0;s<e.childNodes.length;s++)o(s);if(a.length>0){var c;if(1!==(null===a||void 0===a?void 0:a.length)||b[e.nodeName]){c={nodeNames:[e.nodeName]};var l={},u=[],d=!0;a.forEach((function(e,t){if(!f.Z.isWhiteSpace(e.text)||!r.isOnlyText(e)||!d&&!r.isNodeBlock(l)){if(d||e.linebreak)!e.items||e.text||e.linebreak||e.inlineElements||e.img||!r.isNodeBlock(e)||!r.isNodeBlock(c)?(l=e,u.push(e)):(u.pushArray(e.items),l=e.items[e.items.length-1]);else if(r.isNodeBlock(e)||!d&&(r.isNodeBlock(a[t-1])||l.linebreak))!e.items||l.items||e.text||e.img?(l=e,u.push(e)):f.Z.isWhiteSpace(l.text)&&!l.inlineElements?(u.pushArray(e.items),l=e.items[e.items.length-1]):(l.items=e.items,r.combineNodeAttrs(l,e));else if(l.items)l.items.push(e);else{if(!l.inlineElements||l.className||!f.Z.deepEqual(l.nodeNames,["SPAN"])){var n=f.Z.clone(l);Object.keys(l).forEach((function(e){return delete l[e]})),l.nodeNames=["SPAN"],l.inlineElements=[n]}l.inlineElements.push(e)}d=!1}})),c.items=u}else c=a[0],this.combineNodeAttrs(c,{nodeNames:[e.nodeName],style:e.style});var h=e.getAttribute("id");h&&(c.id=h);var p=e.getAttribute("data-date");return p&&(c.date=p),"A"===e.nodeName&&(c.href=e.getAttribute("href")),e.className&&(c.className=this.combineClassNames(c,e)),c}}else if("IMG"===e.nodeName){var g=e;return{nodeNames:["IMG"],img:g.src||g.srcset&&g.srcset[0]}}return"LI"===e.nodeName||"DIV"===e.nodeName||"P"===e.nodeName?{nodeNames:[e.nodeName],text:e.textContent}:void 0}}},{key:"combineClassNames",value:function(e,t){return[e.className,t.className].filter((function(e){return e})).join(" ")}},{key:"parseNodeNamesToVMLIElementProps",value:function(e){var t={};return e.forEach((function(e){"B"===e?t.bold=!0:"I"===e?t.italic=!0:"U"===e&&(t.underline=!0)})),f.Z.isEmpty(t)?void 0:t}},{key:"parsedDOMToItemData",value:function(e,t){var n=this,r=[],a={};e.date&&(a.date=e.date),e.id&&(a.id=e.id),t&&r.push(new k.Z("1. "));var o=this.parseForTab(e.className)?1:0;if(o||(this.parseClassName(e.className,a),this.parseNodeToElements(r,e)),e.inlineElements){var s=[];e.inlineElements.forEach((function(e){n.parseForTab(e.className)?o++:n.parseInlineElement(s,e)})),r.pushArray(s)}var c=new _.Z(r).getRawText();if((c||""===c&&!e.items)&&(a.text=c),e.items){a.items=[];var l=i()({},o,a);e.items.forEach((function(t,r){var i=n.parsedDOMToItemData(t,e.nodeNames.includes("OL")),s=i.itemData,c=i.indent;if(s.items||s.text&&!f.Z.isWhiteSpace(s.text)||n.isNodeBlock(t)&&!t.linebreak||t.linebreak&&n.isNodePBR(t)){var u=c>o?n.getItemAtIndent(l,c-1,o):s.isNote?l[o]:a;u.items?s.isNote?u.items.splice(0,0,s):u.items.push(s):u.items=[s],l[c]=s}})),this.convertCodeBlocks(a)}return{itemData:a,indent:o}}},{key:"parseNodeToElements",value:function(e,t,n){var r,i;return t.img?(i=t.text||t.img,r={link:{isImage:!0,showImage:!0,href:t.img,text:i}}):t.href?(i=t.text||!t.inlineElements&&t.href||"",t.inlineElements&&(i+=this.inlineElementsToText(t),t.inlineElements=void 0),r={link:{href:t.href,text:i}}):(i=t.text,r=this.parseNodeNamesToVMLIElementProps(t.nodeNames),n&&(r=Object.assign(r||{},n))),i&&e.push(new k.Z(i,r)),r}},{key:"inlineElementsToText",value:function(e){var t=this;return e.inlineElements.map((function(e){return e.text||t.inlineElementsToText(e)})).join("")}},{key:"parseInlineElement",value:function(e,t,n){var r=this,i=this.parseNodeToElements(e,t,n);t.inlineElements&&t.inlineElements.forEach((function(t){return r.parseInlineElement(e,t,i||n)}))}},{key:"getItemAtIndent",value:function(e,t,n){for(var r=0;t>=0;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var i=e[t];if(i)return i;t--}return e[n]}},{key:"isOnlyText",value:function(e){var t;return null===(t=e.nodeNames)||void 0===t?void 0:t.every((function(e){return"#text"===e}))}},{key:"isNodeText",value:function(e){var t;return null===(t=e.nodeNames)||void 0===t?void 0:t.some((function(e){return Z[e]}))}},{key:"isNodeBlock",value:function(e){var t;return null===(t=e.nodeNames)||void 0===t?void 0:t.some((function(e){return w[e]}))}},{key:"isNodePBR",value:function(e){var t=e.nodeNames;return t&&["P","BR"].every((function(e){return t.some((function(t){return t===e}))}))}},{key:"isNodeList",value:function(e){var t;return null===(t=e.nodeNames)||void 0===t?void 0:t.some((function(e){return b[e]}))}},{key:"combineNodeAttrs",value:function(e,t){var n,r,i;(e.nodeNames=f.Z.arrayUnion(e.nodeNames,t.nodeNames).filter((function(e){return"#text"!==e})),e.className=this.combineClassNames(e,t),e.nodeNames.includes("A"))&&(e.href=null!==(r=e.href)&&void 0!==r?r:t.href);(e.id||t.id)&&(e.id=null!==(i=e.id)&&void 0!==i?i:t.id);return e.nodeNames.includes("B")&&"normal"===(null===(n=t.style)||void 0===n?void 0:n["font-weight"])&&e.nodeNames.remove("B"),e}},{key:"convertHTMLFormatting",value:function(e){var t,n;e=e.replace(/<b>|<\/b>/g,"**").replace(/<i>|<\/i>/g,"*").replace(/<u>|<\/u>/g,"__");var r=document.createElement("div");r.innerHTML=e;var i=this.traverseDOMNew(r),a=null===i||void 0===i||null===(t=i.items)||void 0===t||null===(n=t[0])||void 0===n?void 0:n.text;return a||e}},{key:"convertPlaintextToHTML",value:function(e){function t(e,t){var n=[],r=null;return{text:e,children:n,lvl:function(){return void 0==t?-1:t},parent:function(){return r},setParent:function(e){r=e},appendChildren:function(e){return n.push(e),e.setParent(this),this}}}var n=t("root");function r(e){return"<li>".concat(e.text).concat(e.children.length?"<ul>".concat(e.children.map((function(e){return r(e)})).join(""),"</ul>"):"","</li>")}return e.toString().split(/\r*\n/).reduce((function e(n,r){if(f.Z.isString(r)){var i=r.match(/^((?: {2}|\t)*)(.*)/),a=i[2];r=t(a,(i[1]?i[1].split(/ {2}|\t/):[a]).length)}return r.lvl()>n.lvl()?n.appendChildren(r):r.lvl()<n.lvl()?e(n.parent(),r):n.parent().appendChildren(r),r}),n),n.children.map((function(e){return r(e)})).join("")}}]),e}())},7183:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n(8926),i=n.n(r),a=n(4575),o=n.n(a),s=n(3913),c=n.n(s),l=n(7757),u=n.n(l),d=n(8651),h=1e5;const p=new(function(){function e(){o()(this,e)}return c()(e,[{key:"ensurePolyfill",value:function(){var e=i()(u().mark((function e(t,r){var i,a,o;return u().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:if(window.TextEncoder&&window.TextDecoder){e.next=8;break}return window.TextEncoder=window.TextDecoder=null,e.next=5,n.e(425).then(n.t.bind(n,8731,23));case 5:o=e.sent,window.TextEncoder=o.TextEncoder,window.TextDecoder=o.TextDecoder;case 8:i=window.TextEncoder,a=window.TextDecoder,e.next=13;break;case 12:0;case 13:this.textEncoder=new i,this.textDecoder=new a,r();case 16:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"ab2str",value:function(e){var t="";try{var n=new Uint8Array(e);if(n.length>h){var r,i,a,o=0;for(r=0,i=n.length;r<i;r+=h){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;a=n.slice(r,r+h),t+=String.fromCharCode.apply(null,a)}}else t=String.fromCharCode.apply(null,n)}catch(s){d.Z.reportError(s)}return t}},{key:"str2ab",value:function(e){for(var t=0,n=new ArrayBuffer(e.length),r=new Uint8Array(n),i=0,a=e.length;i<a;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r[i]=e.charCodeAt(i)}return r}},{key:"unicode2ab",value:function(e){return this.textEncoder.encode(e)}},{key:"ab2unicode",value:function(e){return this.textDecoder.decode(e)}}]),e}())},170:(e,t,n)=>{"use strict";n.d(t,{b:()=>a});n(3038);var r=n(8651),i=function(e,t){return"string"===typeof e&&(e=e.split(",")),e[e.length-1]=""+(+e[e.length-1]+t),e.join(",")},a=function(e,t){"number"===typeof e&&(e=""+e),"number"===typeof t&&(t=""+t);var n="0";if("string"===typeof e&&"string"===typeof t)n=function(e,t){var n=e.split(","),r=t.split(","),a=n.length,o=r.length;return a<o?+n[a-1]+1<+r[a-1]?i(n,1):i(r,-1):a>o||+n[a-1]+1<+r[o-1]?i(n,1):(n.push("0"),n.join(","))}(e,t);else if("string"===typeof e){var a=+e.split(",")[0];try{r.Z.PAssert(217,!isNaN(a),"Index is not valid string",e)}catch(s){r.Z.reportError(s)}n=""+Math.floor(a+1)}else if("string"===typeof t){var o=+t.split(",")[0];try{r.Z.PAssert(218,!isNaN(o),"Index is not valid string",t)}catch(s){r.Z.reportError(s)}n=""+Math.ceil(o-1)}return n}},4867:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Z});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(6525),c=n.n(s),l=n(2205),u=n.n(l),d=n(8585),h=n.n(d),p=n(9754),f=n.n(p),g=n(8855),m=n(4654),v=n(8651),y=n(4472),k=n(7100);function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}const Z=new(function(e){u()(n,e);var t=_(n);function n(){return i()(this,n),t.apply(this,arguments)}return o()(n,[{key:"getAppInfo",value:function(e){c()(f()(n.prototype),"getAppInfo",this).call(this,e);var t=window;e.user={name:m.default.settings.displayName.get(),email:m.default.settings.activeUser.get()},e.gapiTimeout=t.gapiTimeout,e.sessionID=t.__SESSION_ID,e.appCacheUpdated=v.Z.wasAppCacheUpdated,e.realtimeLoadStatus=this.computeRealtimeLoadStatus(),this.getRunningState(e),this.getAppStats(e),this.getPremiumInfo(e);try{e.cacheState=m.default.cacheManager.getInfo()}catch(r){e.cacheState="ERROR"}}},{key:"getRunningState",value:function(e){var t,n=window;try{m.default.PaneManager.hasLoadedPaneState()&&(t=m.default.PaneManager.getPaneState()).forEach((function(e){return delete e.itemState}))}catch(r){v.Z.log("Failed to get paneState")}e.isDebug=!1,e.isDemo=v.Z.isDemoMode(),e.localWrites=v.Z.shouldWriteLocal(),e.authUserLoggedIn=v.Z.authUserLoggedIn,e.isReconnected=v.Z.isReconnected,e.url=v.Z.sanitizeURL(window.location.href),e.paneState=t?v.Z.sanitizePaneState(t):"Missing Pane State",e.checkpoints=n.__checkpoints,e.gapiLoadError=n.gapiLoadError,e.gapiTimeout=n.gapiTimeout,e.gapiClientLoadError=n.gapiClientLoadError,e.gapiClientTimeout=n.gapiClientTimeout,e.DOMReadyState=document.readyState,e.htmlVersion=document&&document.body?document.body.getAttribute("ver"):"UNKNOWN",e.windowWidth=window.innerWidth,e.windowHeight=window.innerHeight,e.eventStream=v.Z.getEventStream(),e.criticalErrorReported=v.Z.criticalErrorReported(),v.Z.getLoadedScripts(e);try{e.nativesel=v.Z.parseExtra(window.getSelection())}catch(r){e.nativesel="Error: "+r.message}try{e.customsel=y.Z.dumpState()}catch(r){e.customsel="Error: "+r.message}try{e.errorPlatformInfo=JSON.stringify(v.Z.errorPlatformInfo)}catch(r){e.errorPlatformInfo="Error: "+r.message}try{e.validScreens=JSON.stringify(n.Screens)}catch(r){e.validScreens="Error: "+r.message}e.lastActivity=v.Z.lastActivity}},{key:"getPremiumInfo",value:function(e){if(m.default.billingManager){var t={premiumStatus:m.default.billingManager.getPremiumStatus(),billingIdentifier:m.default.billingManager.getBillingIdentifier(),lastSignupError:m.default.billingManager._lastSignupError};e.premiumInfo=t}else e.premiumInfo="Billing Manager Not Loaded"}},{key:"computeRealtimeLoadStatus",value:function(){return{gapi:!!window.gapi,auth:!(!window.gapi||!window.gapi.auth),client:!(!window.gapi||!window.gapi.client),drive:!(!window.gapi||!window.gapi.drive),realtime:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime),load:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime&&v.Z.isFunction(window.gapi.drive.realtime.load))}}},{key:"getAppStats",value:function(e){var t=window;if(e.numPanes=t.__TOTAL_PANES,e.numItems=v.Z.totalItems,e.numArchivedItems=v.Z.totalArchivedItems,e.numArchiveParents=v.Z.totalArchivedParents,e.parseTextCalls=t.__PARSE_STATS,e.notificationUpdatesFull=v.Z.__FULL_NOTIFICATION_UPDATES,e.notificationUpdatesSingle=v.Z.__SINGLE_NOTIFICATION_UPDATES,e.XHRStats=v.Z.getXHRStats(),m.default.pluginManager){try{e.pluginStats=m.default.pluginManager.getStats()}catch(n){e.pluginStats="Error: "+n.message}try{e.pluginState=m.default.pluginManager.getState()}catch(n){e.pluginState="Error: "+n.message}}if(m.default.recurringTaskManager)try{e.taskStats=m.default.recurringTaskManager.getStats()}catch(n){e.taskStats="Error: "+n.message}g.Z.DETAILED_STATS}}]),n}(function(){function e(){i()(this,e)}return o()(e,[{key:"getAppInfo",value:function(e){var t=v.Z.getToolbox(),n=Date.now();e.user={name:t.settings.displayName.get(),email:t.settings.activeUser.get()},e.sessionStart=v.Z.SESSION_BEGIN,e.reportTime=n,e.runningTime=n-v.Z.SESSION_BEGIN,k.Z.getPlatformInfo(e),e.jsVersion=g.Z.jsVersion}}]),e}()))},1186:(e,t,n)=>{"use strict";n.d(t,{Z:()=>j});var r,i,a=n(3038),o=n.n(a),s=n(8926),c=n.n(s),l=n(4575),u=n.n(l),d=n(3913),h=n.n(d),p=n(6525),f=n.n(p),g=n(2205),m=n.n(g),v=n(8585),y=n.n(v),k=n(9754),_=n.n(k),Z=n(3124),w=n.n(Z),b=n(7757),P=n.n(b),S=n(8572),D=n(8855),I=n(8651),E=n(7100),x=n(4654),C=n(9713),A=n.n(C),L=n(7411),M=n(7274),T=n(9998),R=n(6470),O=n(461),F=n(5193),N=(r=function(){function e(){u()(this,e),this.isLoaded=new M.Z(!1),this.isGapiLoaded=new M.Z(!1),this._handlersOnLoaded=[],this.authTokens={},this.erroredAuthTokens=new T.Z,this.onAccountsUpdated=new R.Z,this.onAuthTokensUpdated=new R.Z,this._serverTokens=new M.Z,this._refreshPromises={}}return h()(e,[{key:"init",value:function(){var e=this;I.Z.isDemoMode()?this._init():x.default.settings.onLoadedRemote((function(){L.Z.onAuthed((function(){F.Z.onlineStatus.onValue("Online",(function(){e._init()}))}))}))}},{key:"_onLoaded",value:function(){var e,t=this,n=null===(e=L.Z.getGoogleProvider())||void 0===e?void 0:e.email;n?this.defaultAccount=n:(x.default.settings.syncAccounts.listen((function(e){t.defaultAccount=Object.keys(e)[0]})),this.defaultAccount=Object.keys(x.default.settings.syncAccounts.get())[0]),this.isLoaded.get()||(x.default.settings.syncAccountRefreshParts.listen((function(){t._serverTokens.onHasValue((function(){setTimeout(t.updateAllServerTokens,2e3)}))})),this.isLoaded.set(!0),this._runOnSyncHandlers())}},{key:"updateAllServerTokens",value:function(){var e=c()(P().mark((function e(){var t,n=this;return P().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return t=this._serverTokens.get(),e.next=3,Promise.all(Object.keys(t).map((function(e){return x.default.settings.syncAccounts.getProperty(e)?n.refreshAuthServerToken(e,t[e]):E.Z.app&&t[e]?n.refreshAuthToken(e,t[e].scopes):void 0})));case 3:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWithTokens",value:function(){var e=c()(P().mark((function e(t){var n,r,i=this;return P().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:n=!!this._serverTokens.get(),x.default.settings.syncAccounts.get()||(r={},Object.keys(t).forEach((function(e){var n,i=t[e];r[e]=(n={},A()(n,D.Z.PluginID.Gmail,i.scopes.includes(D.Z.GScope.GmailModify)),A()(n,D.Z.PluginID.GCalendar,i.scopes.includes(D.Z.GScope.Calendar)||i.scopes.includes(D.Z.GScope.CalendarRO)),n)})),x.default.settings.syncAccounts.set(r)),this._serverTokens.set(t),x.default.settings.onLoadedRemote((function(){n?setTimeout(i.updateAllServerTokens,2e3):i.updateAllServerTokens()}));case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAuthServerToken",value:function(){var e=c()(P().mark((function e(t,n){var r,i,a,o;return P().wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:0,!1;try{I.Z.PAssert(441,t,"Trying to get account auth token for undefined")}catch(c){I.Z.reportError(c)}if(!t){e.next=35;break}if(this._refreshPromises[t]){e.next=12;break}r=x.default.settings.syncAccountRefreshParts.getProperty(t);try{I.Z.PAssert(442,r,"Missing refresh part for account: "+t,(function(){return Object.keys(x.default.settings.syncAccountRefreshParts.get())}))}catch(c){I.Z.reportError(c)}if(r){e.next=10;break}return this.erroredAuthTokens.setProperty(t,!0),e.abrupt("return",void 0);case 10:this._refreshPromises[t]=O.Z.getAccessToken(t,r),!0;case 12:return e.prev=12,e.next=15,this._refreshPromises[t];case 15:if(i=e.sent,delete this._refreshPromises[t],!i.value){e.next=27;break}return a=i.value,(o=this.convertScopeToScopes(a)).email=o.email||t,this.authTokens[t]=o,e.abrupt("return",a);case 27:if(console.log(i.error),i.error&&i.error.includes("invalid_grant"))this.redoAuth(t,n.scopes);else if("Failed to fetch"!==i.error){try{I.Z.PAssert(443,!1,"Error refreshing token",i.error)}catch(c){I.Z.reportError(c)}0}this.erroredAuthTokens.setProperty(t,!0);case 30:e.next=35;break;case 32:e.prev=32,e.t0=e.catch(12),delete this._refreshPromises[t];case 35:case"end":return e.stop()}}}),e,this,[[12,32]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"authAccount",value:function(e,t,n){var r=this,i=function(){var i=c()(P().mark((function i(a){return P().wrap((function(i){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(i.prev=i.next){case 0:a?n(a):r.doAuthForAccount(e,t,n);case 1:case"end":return i.stop()}}}),i)})));return function(e){return i.apply(this,arguments)}}();this.authTokens[e]?this.getAccountAuthToken(e,t,i,!0):i()}},{key:"authAccountPrimary",value:function(){var e=c()(P().mark((function e(t,n){var r;return P().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:(r=this.getDefaultAccountID())?this.doAuthForAccount(r,t,n):n(void 0);case 2:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeAccount",value:function(e){delete this.authTokens[e],this.onAccountsUpdated.notify()}},{key:"redoAuth",value:function(){var e=c()(P().mark((function e(t,n){var r=this;return P().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.erroredAuthTokens.getProperty(t)){e.next=2;break}return e.abrupt("return");case 2:this.erroredAuthTokens.setProperty(t,!0),n.remove(D.Z.GScope.GmailCompose),n.remove(D.Z.GScope.GmailModify),n.remove(D.Z.GScope.DriveFull),n.remove(D.Z.GScope.DriveMetadataRO),n.remove(D.Z.GScope.DriveInstall),n.remove(D.Z.GScope.DriveAppData),n=n.filter((function(e){return!!e})),I.Z.log("redoAuth",n);try{I.Z.PAssert(444,!1,"redoAuth")}catch(a){I.Z.reportError(a)}return e.abrupt("return",new Promise((function(e){x.default.toasts.pushMessage({id:"redoAuth_"+t,text:"Error authorizing for: ".concat(t,". Please reauthorize this account to keep syncing its data with Google. If you have been seeing a lot of reauthorization messages, this should fix it for good."),actionText:"REAUTHORIZE",action:function(){r.doAuthForAccount(t,n,(function(){e(),x.default.toasts.clearMessageByID("redoAuth_"+t)}))}})})));case 13:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAccountAuthToken",value:function(e,t,n,r){var i=this;try{I.Z.PAssert(445,e,"Trying to get account auth token for undefined")}catch(a){I.Z.reportError(a)}e?this.onLoaded(c()(P().mark((function a(){var o;return P().wrap((function(a){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(a.prev=a.next){case 0:if((o=i.authTokens[e])&&!(o.expires_at<Date.now()+1e4)){a.next=8;break}return a.next=5,i.refreshAuthToken(e,t);case 5:o=a.sent,a.next=22;break;case 8:if(i._verifyScopes(t,o)){a.next=17;break}if(o=void 0,!r){a.next=15;break}return n(void 0),a.abrupt("return");case 15:a.next=22;break;case 17:if(o.expires_at&&!(o.expires_at-Date.now()<D.Z.MinimumTokenExpireTimeMS)){a.next=22;break}return I.Z.logQuiet("Token needs refresh",o.expires_at,o.expires_at-Date.now()),a.next=21,i.refreshAuthToken(e,t);case 21:o=a.sent;case 22:n(o);case 23:case"end":return a.stop()}}}),a)})))):n(void 0)}},{key:"isAuthorizedForScopes",value:function(e,t){var n=this.authTokens&&this.authTokens[e];return!!n&&this._verifyScopes(t,n)}},{key:"notifyUnauthorizedRequest",value:function(e){}},{key:"_verifyScopes",value:function(e,t){var n=0;if(!t||!t.scopes)return!1;for(var r=t.scopes,i=0;i<e.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=e[i];if(!r.includes(a)&&(a!==D.Z.GScope.Drive&&a!==D.Z.GScope.DriveMetadataRO||!r.includes(D.Z.GScope.DriveFull)))return!1}return!0}},{key:"onLoaded",value:function(e){this.isLoaded.get()?e():this._handlersOnLoaded.push(e)}},{key:"_runOnSyncHandlers",value:function(){this._handlersOnLoaded.forEach((function(e){return e()})),this._handlersOnLoaded=[]}},{key:"getDefaultAuthToken",value:function(e,t){var n=this.getDefaultAccountID();n?this.getAccountAuthToken(n,e,(function(e){e&&t(e)})):t(void 0)}},{key:"hasError",value:function(){return this.erroredAuthTokens.hasValue()}},{key:"getError",value:function(e){return""}},{key:"accountHasError",value:function(e){return!!this.erroredAuthTokens.getProperty(e)}},{key:"getGoogleUserInfo",value:function(e){this.getDefaultAuthToken(["profile"],(function(t){t?fetch("https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token=".concat(t.access_token)).then((function(t){200===t.status&&t.json().then((function(t){return e(t)}))})):e(void 0)}))}},{key:"isEmailAuthed",value:function(e){var t=e.toLowerCase();return Object.keys(this.authTokens).some((function(e){return e.toLowerCase()===t}))}},{key:"_saveAuthToken",value:function(e,t){this.authTokens[e]=t,this.erroredAuthTokens.deleteProperty(e),this.onAuthTokensUpdated.notify()}},{key:"getDefaultAccountID",value:function(){return this.defaultAccount}},{key:"convertScopeToScopes",value:function(e){var t,n=null===(t=e.scope)||void 0===t?void 0:t.split(" ");return e.scopes=null===n||void 0===n?void 0:n.map((function(e){return D.Z.GScopeArray[e]})),e}},{key:"convertScopesToScope",value:function(e){return e.map((function(e){return D.Z.GScopeArray.indexOf(e)})).join(" ")}},{key:"fixAuth",value:function(e){var t=x.default.settings.syncAccounts.get(),n=null===t||void 0===t?void 0:t[e];if(n){var r=Object.keys(n).filter((function(e){return e!==D.Z.PluginID.Gmail})),i=r&&x.default.pluginManager.getAllPluginScopes(r,!1);return this.doAuthForAccount(e,i)}x.default.menus.openSettings("Calendar")}}]),e}(),w()(r.prototype,"updateAllServerTokens",[S.ZP],Object.getOwnPropertyDescriptor(r.prototype,"updateAllServerTokens"),r.prototype),w()(r.prototype,"refreshAuthServerToken",[S.ZP],Object.getOwnPropertyDescriptor(r.prototype,"refreshAuthServerToken"),r.prototype),r),B=n(8133);function U(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_()(e);if(t){var i=_()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return y()(this,n)}}const j=new(i=function(e){m()(n,e);var t=U(n);function n(){var e;return u()(this,n),(e=t.call(this)).retryAttempt=0,e}return h()(n,[{key:"_init",value:function(){var e=c()(P().mark((function e(){var t,n=this;return P().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(x.default.settings.syncAccounts.listen(this.refreshAllSyncAccounts),!E.Z.app){e.next=8;break}if(!(t=x.default.settings.refreshTokensRN.get())){e.next=6;break}return e.next=6,Promise.all(Object.entries(t).map((function(e){var t=o()(e,2),r=t[0],i=t[1];n.refreshAuthToken(r,i.scopes)})));case 6:e.next=11;break;case 8:return e.next=11,this.refreshAllSyncAccounts();case 11:this._onLoaded();case 12:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshAuthToken",value:function(){var e=c()(P().mark((function e(t,n){var r,i,a,o,s,l=this;return P().wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(!(i=null===(r=this._serverTokens.get())||void 0===r?void 0:r[t])){e.next=6;break}return e.next=4,this.refreshAuthServerToken(t,i);case 4:e.next=20;break;case 6:if(!E.Z.app){e.next=11;break}return e.next=9,I.Z.runSingletonPromise("refreshAuthToken"+t,c()(P().mark((function e(){var r,i,a,o;return P().wrap((function(e){for(var s=0,c=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(!(i=null===(r=x.default.settings.refreshTokensRN.get())||void 0===r?void 0:r[t])){e.next=7;break}return a=i.refreshToken,e.next=5,B.LA.refreshAuthGoogleAccount({refreshToken:a,email:t,scopes:n});case 5:o=e.sent,l._saveAuthToken(t,o);case 7:case"end":return e.stop()}}}),e)}))));case 9:e.next=20;break;case 11:return e.next=13,this.refreshAllSyncAccounts();case 13:if(this.authTokens[t]){e.next=20;break}if(!(a=x.default.settings.syncAccounts.get())[t]){e.next=20;break}return o=Object.keys(a[t]),s=o&&x.default.pluginManager.getAllPluginScopes(o,!1),e.next=20,this.redoAuth(t,s||n);case 20:return e.abrupt("return",this.authTokens[t]);case 21:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"doAuthForAccountServer",value:function(){var e=c()(P().mark((function e(t,n,r){var i,a,o,s,l=this;return P().wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(!E.Z.app){e.next=13;break}return e.next=3,B.LA.authGoogleAccount({email:t,scopes:n});case 3:i=e.sent,a=i.authToken,o=i.refreshToken,(s=I.Z.clone(x.default.settings.refreshTokensRN.get())||{})[t]={refreshToken:o,scopes:n},x.default.settings.refreshTokensRN.set(s),this._saveAuthToken(t,a),r&&r(a),e.next=14;break;case 13:this.gapi2Authorize({client_id:D.Z.ClientID,scope:n.join(" "),response_type:"id_token code",access_type:"offline",prompt:"consent",login_hint:t},function(){var e=c()(P().mark((function e(i){var a,o,s;return P().wrap((function(e){for(var c=0,u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(!i.error&&I.Z.isString(i.code)){e.next=5;break}t&&"popup_closed_by_user"!==i.error&&l.redoAuth(t,n),r&&r(void 0),e.next=25;break;case 5:if(a=I.Z.decodeIDToken(i.id_token)){e.next=12;break}x.default.toasts.pushMessage("Error authenticating. Please try again or contact support@moo.do mentioning this error.");try{I.Z.PAssert(159,!1,"Error authenticating. Got no valid email.",i)}catch(d){I.Z.reportError(d)}r&&r(void 0),e.next=25;break;case 12:if(!a||!t||a.toLowerCase()===t.toLowerCase()){e.next=17;break}x.default.toasts.pushMessage("Reauthorized with the wrong account. Expected ".concat(t," but got ").concat(a,".")),r&&r(void 0),e.next=25;break;case 17:return e.next=19,O.Z.onAuthCode({code:i.code,email:a});case 19:o=e.sent,x.default.settings.syncAccountRefreshParts.setProperty(a,o.value.refresh_part),s=l.convertScopeToScopes(o.value),r&&r(s);case 25:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}());case 14:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"doAuthForAccount",value:function(e,t,n){this.doAuthForAccountServer(e,t,n)}},{key:"gapi2Authorize",value:function(){var e=c()(P().mark((function e(t,n){return P().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.ensureGapiClient();case 2:return e.abrupt("return",new Promise((function(e){window.gapi.auth2.authorize(t,(function(t){null===n||void 0===n||n(t),e(t)}))})));case 3:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"authAccountAnonymous",value:function(){var e=c()(P().mark((function e(t){return P().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return t=t||[D.Z.GScope.Profile,D.Z.GScope.UserInfoEmail,D.Z.GScope.Email,D.Z.GScope.UserInfoProfile],e.abrupt("return",this.gapi2Authorize({client_id:D.Z.ClientID,scope:t.join(" "),response_type:"id_token"}));case 2:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"authAccountPermission",value:function(){var e=c()(P().mark((function e(t){return P().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.gapi2Authorize({client_id:D.Z.ClientID,scope:t.join(" "),response_type:"permission"}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"authAccountTemp",value:function(){var e=c()(P().mark((function e(t){var n;return P().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return n=[D.Z.GScope.Profile,D.Z.GScope.UserInfoEmail,D.Z.GScope.Email,D.Z.GScope.UserInfoProfile],e.abrupt("return",this.gapi2Authorize({client_id:D.Z.ClientID,scope:n.join(" "),response_type:"id_token",login_hint:t}));case 2:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"promisifyAuthorize",value:function(){var e=c()(P().mark((function e(t){var n=this;return P().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",I.Z.promisify((function(e){n.gapi2Authorize({client_id:D.Z.ClientID,scope:"profile",response_type:"id_token permission",prompt:"none",authuser:""+t,include_granted_scopes:!0},(function(t){if(t.id_token&&t.access_token){var r=I.Z.decodeIDToken(t.id_token),i={email:r,access_token:t.access_token,scopes:t.scope.split(" "),expires_at:t.expires_at};n._saveAuthToken(r,i),e(i)}else I.Z.logQuiet("authorize: "+JSON.stringify(t)),e(void 0)}))})));case 1:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAllSyncAccounts",value:function(){var e=c()(P().mark((function e(){var t,n,r,i=this;return P().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return I.Z.logQuiet("refreshing all sync accounts"),e.next=3,this.ensureGapiClient();case 3:if(t=x.default.settings.syncAccounts.get(),n={},!((r=Object.keys(t).filter((function(e){return!I.Z.isEmpty(t[e])&&!i._serverTokens.get()[e]})).map((function(e){return e.toLowerCase()}))).length>0)){e.next=10;break}return r.forEach((function(e){n[e]=!1})),e.next=10,I.Z.runSingletonPromise("refreshAllSyncAccounts",c()(P().mark((function e(){var t,a,o,s=0;return P().wrap((function(e){for(var l=0,u=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<20)){e.next=15;break}if(!(s++>5e3&&__infLoop&&__infLoop(s))){e.next=4;break}throw new RangeError;case 4:return e.next=6,i.promisifyAuthorize(t);case 6:if((a=e.sent)&&(o=a.email.toLowerCase(),!1===n[o]&&(n[o]=!0,x.default.toasts.clearMessageByID("redoAuth_"+o))),!r.every((function(e){return!0===n[e]}))){e.next=12;break}return i.retryAttempt=0,I.Z.logQuiet("all refreshed"),e.abrupt("break",15);case 12:t++,e.next=1;break;case 15:if(!r.some((function(e){return!n[e]}))){e.next=19;break}return I.Z.logQuiet("Accounts failed, trying the legacy way"),e.next=19,Promise.all(r.map(function(){var e=c()(P().mark((function e(t){var r,a,o;return P().wrap((function(e){for(var s=0,c=0,l=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:if(n[t]){e.next=6;break}return I.Z.logQuiet("Trying the legacy way: ",t),r=x.default.settings.syncAccounts.get(),a=Object.keys(r[t]),o=a&&x.default.pluginManager.getAllPluginScopes(a,!1),e.abrupt("return",i.gapiAuthorizeImmediateLegacy(t,o));case 6:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 19:r.some((function(e){return!n[e]}))&&(I.Z.logQuiet("Accounts still failed, need redoAuth"),i.retryAttempt++,i.retryAttempt>5?Promise.all(r.map(function(){var e=c()(P().mark((function e(t){var r,a,o;return P().wrap((function(e){for(var s=0,c=0,l=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(n[t]){e.next=5;break}return r=x.default.settings.syncAccounts.get(),a=Object.keys(r[t]),o=a&&x.default.pluginManager.getAllPluginScopes(a,!1),e.abrupt("return",i.redoAuth(t,o));case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}())):setTimeout((function(){i.refreshAllSyncAccounts()}),5e3));case 20:case"end":return e.stop()}}}),e)}))));case 10:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"gapiAuthorizeImmediateLegacy",value:function(){var e=c()(P().mark((function e(t,n){var r=this;return P().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.ensureGapiClient();case 2:return e.next=4,F.Z.onConnectedPromise();case 4:return e.abrupt("return",new Promise((function(e){var i=!1,a=function(){r._doAuthorization(t,n,"none",(function(t){i||(i=!0,e(t))}))};a(),setTimeout((function(){i||a()}),2e3)})));case 5:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"_doAuthorization",value:function(e,t,n,r){var i=this;try{this.gapi2Authorize({client_id:D.Z.ClientID,scope:t.join(" "),response_type:"id_token permission",prompt:n,login_hint:e,authuser:e?-1:void 0,include_granted_scopes:!0},(function(a){var o;if(!I.Z.isString(a.access_token)||a.error)I.Z.logQuiet("immediate failed",e,a),"access_denied"===a.error_subtype&&"consent"===n&&i.redoAuth(e,t);else{var s=I.Z.decodeIDToken(a.id_token)||e;o={access_token:a.access_token,email:s,scopes:a.scope.split(" "),expires_at:a.expires_at},I.Z.logQuiet("token",e,o),i._saveAuthToken(e,o)}r(o)}))}catch(a){"Cookies are not enabled in current environment."===a.error&&x.default.menus.openModal(D.Z.Modals.ErrorCookies)}}},{key:"gapiAuthorizePrompt",value:function(e,t,n){this._doAuthorization(e,t,"consent",n)}},{key:"ensureGapiBase",value:function(){var e=c()(P().mark((function e(){return P().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:if(window.gapi||this.isGapiLoaded.get()){e.next=3;break}return e.next=3,I.Z.runSingletonPromise("gapiScript",(function(){return new Promise((function(e){var t=!1,n=0;!function r(){if(!t||navigator.onLine){var i=document.getElementById("gapiScript");i&&i.remove(),I.Z.addScript("https://apis.google.com/js/api.js","gapiScript",(function(){e()}),(function(){t=!0,++n<3&&setTimeout(r,2e3)}))}else setTimeout(r,2e3)}()}))}));case 3:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ensureGapiClient",value:function(){var e=c()(P().mark((function e(){return P().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.ensureGapiLib("client");case 2:this.isGapiLoaded.get()||this.isGapiLoaded.set(!0);case 3:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ensureGapiLib",value:function(){var e=c()(P().mark((function e(t){return P().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.ensureGapiBase();case 2:if(!window.gapi||window.gapi[t]){e.next=5;break}return e.next=5,I.Z.runSingletonPromise("ensureGapiLib"+t,(function(){return new Promise((function(e){window.gapi.load(t,{callback:function(){e()},onerror:function(){return!1},timeout:2e4,ontimeout:function(){return!1}})}))}));case 5:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"authAccount",value:function(e,t,r,i){var a=this._serverTokens.get()[e];!i&&a?f()(_()(n.prototype),"authAccount",this).call(this,e,t,r):this.doAuthForAccount(e,t,r)}}]),n}(N),w()(i.prototype,"refreshAuthToken",[S.ZP],Object.getOwnPropertyDescriptor(i.prototype,"refreshAuthToken"),i.prototype),w()(i.prototype,"refreshAllSyncAccounts",[S.ZP],Object.getOwnPropertyDescriptor(i.prototype,"refreshAllSyncAccounts"),i.prototype),i)},7411:(e,t,n)=>{"use strict";n.d(t,{Z:()=>M});var r,i=n(3038),a=n.n(i),o=n(8926),s=n.n(o),c=n(4575),l=n.n(c),u=n(3913),d=n.n(u),h=n(2205),p=n.n(h),f=n(8585),g=n.n(f),m=n(9754),v=n.n(m),y=n(3124),k=n.n(y),_=n(7757),Z=n.n(_),w=n(1186),b=n(8572),P=n(8855),S=n(9514),D=n(8651),I=n(7100),E=n(4654),x=n(8133),C=n(7274);var A;function L(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}const M=new(A=function(e){p()(n,e);var t=L(n);function n(){return l()(this,n),t.call(this)}return d()(n,[{key:"init",value:function(){var e=this;console.log("init auth"),this.initializeFirebase(),window.firebase=S.Z,S.Z.auth().onAuthStateChanged((function(t){if(console.log("firebase user",t),t&&E.default.settings.activeUser.get())e.onSignInWithUser(t);else{var n=!!E.default.settings.activeUser.get();E.default.settings.userId.set(void 0),E.default.settings.activeUser.set(void 0),E.default.settings.displayName.set(void 0),n&&setTimeout((function(){D.Z.reload()}),100)}})),this._isOnline=navigator.onLine,window.addEventListener("online",(function(){e._isOnline=navigator.onLine}))}},{key:"initializeFirebase",value:function(){var e={clientId:P.Z.ClientID,apiKey:P.Z.APIKey,authDomain:P.Z.APIBaseURL,databaseURL:"https://".concat(P.Z.FirebaseProjectID,".firebaseio.com"),projectId:P.Z.FirebaseProjectID,storageBucket:"".concat(P.Z.FirebaseProjectID,".appspot.com"),messagingSenderId:P.Z.FirebaseAppID,scopes:P.Z.ScopesDefault};S.Z.initializeApp(e)}},{key:"onSignInResult",value:function(e,t){var n=e.user;E.default.billingManager.updateUserProfile(t);try{D.Z.PAssert(219,n,"Somehow signed in without a valid user")}catch(r){D.Z.reportError(r)}n&&this.onSignInWithUser(n)}},{key:"onSignInFailure",value:function(e){var t,n=e.code,r=e.message;if("auth/popup-closed-by-user"===n)t="Error signing in. Please try again.";else if("auth/network-request-failed"===n)t="Connection error. Please try again.";else if("auth/web-storage-unsupported"===n){try{D.Z.PAssert(220,!1,"Still getting web-storage-unsupported error")}catch(i){D.Z.reportError(i)}t="There may be a configuration problem in your browser. Please contact support@moo.do and we can help you."}else if("auth/user-not-found"===n)t="An account with this email was not found.";else if("auth/invalid-email"===n)t="Invalid email address.";else if("auth/email-already-in-use"===n)t="This email address is already in use. You may have previously signed in with Google for this account.";else if("auth/wrong-password"===n)t="The password is incorrect, or you may have previously signed in with Google. Please try again.";else if(n&&"authentication_failed"!==n&&"authentication_error"!==n){try{D.Z.PAssert(221,!1,"Error on signin",n,r)}catch(i){D.Z.reportError(i)}t="Unexpected sign in error: ".concat(n,". Please try again.")}t&&E.default.setup.popupClosedError.set({message:t})}},{key:"_getUid",value:function(){return S.Z.auth().getUid()}},{key:"getUserSync",value:function(){return this.user.get()}},{key:"signOut",value:function(){var e=s()(Z().mark((function e(){return Z().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return D.Z.log("signOut called"),E.default.settings.activeUser.set(void 0),e.abrupt("return",S.Z.auth().signOut());case 3:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"isOnline",value:function(){return navigator.onLine}},{key:"reauthenticateGoogle",value:function(){var e=s()(Z().mark((function e(){var t,n,r,i,a,o,s,c,l;return Z().wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:return n=null===(t=this.getGoogleProvider())||void 0===t?void 0:t.email,e.next=4,x.LA.authGoogleAccount({email:n,scopes:["profile","email"]});case 4:i=e.sent,(a=i.authToken)&&(r=a.idToken||a.id_token),e.next=21;break;case 9:return e.next=11,w.Z.authAccountTemp(n);case 11:if(e.t1=o=e.sent,e.t0=null===e.t1,e.t0){e.next=15;break}e.t0=void 0===o;case 15:if(!e.t0){e.next=19;break}e.t2=void 0,e.next=20;break;case 19:e.t2=o.id_token;case 20:r=e.t2;case 21:if(!r){e.next=26;break}return s=S.Z.auth().currentUser,c=S.Z.auth.GoogleAuthProvider.credential(r),l=s.reauthenticateWithCredential(c),e.abrupt("return",l);case 26:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"reauthenticateApple",value:function(){var e=s()(Z().mark((function e(){var t,n,r,i,a,o;return Z().wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:return n=null===(t=this.getAppleProvider())||void 0===t?void 0:t.email,r=S.Z.auth().currentUser,e.next=5,this.createAppleCredential();case 5:if(i=e.sent,a=i.credential,o=i.profile.email,n!==o||!a){e.next=10;break}return e.abrupt("return",r.reauthenticateWithCredential(a));case 10:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"reauthenticateEmail",value:function(){var e=s()(Z().mark((function e(){return Z().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){E.default.menus.promptComplex({title:"Reauthenticate",text:"Please sign into your current email address first.",fields:[{placeholder:"Email",type:"email"},{placeholder:"Password",type:"password"}],validate:function(){var e=s()(Z().mark((function e(t){var n,r;return Z().wrap((function(e){for(var i=0,o=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return n=a()(t,2),r=n[0],n[1],e.abrupt("return",!D.Z.isEmail(r)&&"Invalid email address");case 2:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}(),callback:function(){var t=s()(Z().mark((function t(n){var r,i,o;return Z().wrap((function(t){for(var c=0,l=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(t.prev=t.next){case 0:if(!n){t.next=4;break}return r=a()(n,2),i=r[0],o=r[1],t.next=4,E.default.tryWithErrorMessageHandling(s()(Z().mark((function t(){var n,r;return Z().wrap((function(t){for(var a=0,s=0,c=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(t.prev=t.next){case 0:return n=S.Z.auth.EmailAuthProvider.credential(i,o),t.next=3,S.Z.auth().currentUser.reauthenticateWithCredential(n);case 3:r=t.sent,e(r);case 5:case"end":return t.stop()}}}),t)}))));case 4:case"end":return t.stop()}}}),t)})));return function(e){return t.apply(this,arguments)}}()})})));case 1:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"linkWithEmail",value:function(e,t){var n=S.Z.auth.EmailAuthProvider.credential(e,t);return S.Z.auth().currentUser.linkWithCredential(n)}},{key:"linkWithGoogle",value:function(){var e=s()(Z().mark((function e(){var t,n,r,i,a,o,s,c,l;return Z().wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(!I.Z.app){e.next=15;break}return e.next=3,x.LA.signInWithGoogle();case 3:if(e.t1=n=e.sent,e.t0=null===e.t1,e.t0){e.next=7;break}e.t0=void 0===n;case 7:if(!e.t0){e.next=11;break}e.t2=void 0,e.next=12;break;case 11:e.t2=n.idToken;case 12:t=e.t2,e.next=27;break;case 15:return e.next=17,w.Z.authAccountAnonymous();case 17:if(e.t4=r=e.sent,e.t3=null===e.t4,e.t3){e.next=21;break}e.t3=void 0===r;case 21:if(!e.t3){e.next=25;break}e.t5=void 0,e.next=26;break;case 25:e.t5=r.id_token;case 26:t=e.t5;case 27:if(e.prev=27,!t){e.next=38;break}return a=S.Z.auth.GoogleAuthProvider.credential(t),e.next=32,S.Z.auth().currentUser.linkWithCredential(a);case 32:return o=e.sent,(s=null===(i=this.getGoogleProvider())||void 0===i?void 0:i.email)&&(E.default.settings.syncAccounts.setProperty(s,{}),c=this.createProfileFromGoogle(o),E.default.billingManager.updateUserProfile(c)),e.abrupt("return",o);case 38:E.default.menus.alert({text:"Signin error. Please try again."});case 39:e.next=45;break;case 41:if(e.prev=41,e.t6=e.catch(27),"auth/credential-already-in-use"===e.t6.code)l="This Google account is already in use.";else try{D.Z.PAssert(222,e.t6)}catch(d){D.Z.reportError(d)}l&&E.default.menus.alert({text:l});case 45:case"end":return e.stop()}}}),e,this,[[27,41]])})));return function(){return e.apply(this,arguments)}}()},{key:"linkWithApple",value:function(){var e=s()(Z().mark((function e(){var t,n,r,i,a;return Z().wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.createAppleCredential();case 2:if(t=e.sent,n=t.credential,r=t.profile,!n){e.next=10;break}return i=S.Z.auth().currentUser,(a=i.linkWithCredential(n))&&E.default.billingManager.updateUserProfile(r),e.abrupt("return",a);case 10:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unlink",value:function(){var e=s()(Z().mark((function e(t){return Z().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",S.Z.auth().currentUser.unlink(t));case 1:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"unlinkEmail",value:function(){var e=s()(Z().mark((function e(){return Z().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.unlink("password"));case 1:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unlinkGoogle",value:function(){var e=s()(Z().mark((function e(){return Z().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.unlink("google.com"));case 1:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unlinkApple",value:function(){var e=s()(Z().mark((function e(){return Z().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.unlink("apple.com"));case 1:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"changeEmail",value:function(){var e=s()(Z().mark((function e(t){return Z().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",S.Z.auth().currentUser.updateEmail(t));case 1:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"changePassword",value:function(){var e=s()(Z().mark((function e(t){return Z().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",S.Z.auth().currentUser.updatePassword(t));case 1:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"signInWithGoogle",value:function(){var e=s()(Z().mark((function e(){var t,n,r,i,a,o,s;return Z().wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(!I.Z.app){e.next=23;break}return e.next=3,x.LA.signInWithGoogle();case 3:if(!(n=e.sent).error){e.next=8;break}this.onSignInFailure(n.error),e.next=21;break;case 8:if(r=n.idToken,i=n.accessToken,!(a=S.Z.auth.GoogleAuthProvider.credential(r,i))){e.next=21;break}return e.prev=11,e.next=14,S.Z.auth().signInWithCredential(a);case 14:t=e.sent,e.next=21;break;case 17:e.prev=17,e.t0=e.catch(11),this.onSignInFailure(e.t0);try{D.Z.PAssert(223,"auth/network-request-failed"===e.t0.code,"Other error code: "+e.t0.code,e.t0)}catch(l){D.Z.reportError(l)}case 21:e.next=36;break;case 23:return(o=new S.Z.auth.GoogleAuthProvider).addScope("email"),o.addScope("profile"),o.setCustomParameters({prompt:"consent"}),e.prev=27,e.next=30,S.Z.auth().signInWithPopup(o);case 30:t=e.sent,e.next=36;break;case 33:e.prev=33,e.t1=e.catch(27),this.onSignInFailure(e.t1);case 36:return t?(E.default.PaneManager.setupInitialTimeout(),s=this.createProfileFromGoogle(t),this.onSignInResult(t,s)):this.onSignInFailure({code:""}),e.abrupt("return",t);case 38:case"end":return e.stop()}}}),e,this,[[11,17],[27,33]])})));return function(){return e.apply(this,arguments)}}()},{key:"createProfileFromGoogle",value:function(e){var t,n=e.user,r=(null===(t=e.additionalUserInfo)||void 0===t?void 0:t.profile)||{},i=r.family_name,a=r.given_name,o=r.name,s=r.picture,c=n.email,l=n.displayName,u=n.photoURL;if(!i&&!a){var d,h,p=null!==(d=null===(h=n.displayName)||void 0===h?void 0:h.split(" "))&&void 0!==d?d:"";2===p.length?(a=p[0],i=p[1]):a=p[0]}return o||(o=l),{email:c,lname:i,fname:a,displayName:o,picture:s||u}}},{key:"createAppleCredential",value:function(){var e=s()(Z().mark((function e(){var t,n,r,i,a,o,s,c;return Z().wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,x.LA.signInWithApple();case 2:if(!(t=e.sent).error){e.next=7;break}return e.abrupt("return",{error:t.error});case 7:return n=t.identityToken,r=t.nonce,i=t.fname,a=t.lname,o=t.email,s=t.displayName,c=new S.Z.auth.OAuthProvider("apple.com"),e.abrupt("return",{credential:c.credential({idToken:n,rawNonce:r}),profile:{email:o,fname:i,lname:a,displayName:s}});case 10:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"signInWithApple",value:function(){var e=s()(Z().mark((function e(){var t,n,r,i,a;return Z().wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=3,this.createAppleCredential();case 3:if(t=e.sent,n=t.error,r=t.credential,i=t.profile,!n){e.next=11;break}this.onSignInFailure(n),e.next=24;break;case 11:if(!r){e.next=24;break}return e.prev=12,e.next=15,S.Z.auth().signInWithCredential(r);case 15:if(!(a=e.sent)){e.next=19;break}return a?(E.default.PaneManager.setupInitialTimeout(),this.onSignInResult(a,i)):this.onSignInFailure({code:""}),e.abrupt("return",a);case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(12);try{D.Z.PAssert(224,"auth/network-request-failed"===e.t0.code,"Other error code: "+e.t0.code,e.t0)}catch(s){D.Z.reportError(s)}case 24:case"end":return e.stop()}}}),e,this,[[12,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"signInWithEmail",value:function(){var e=s()(Z().mark((function e(t,n){var r;return Z().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,S.Z.auth().signInWithEmailAndPassword(t,n);case 3:return(r=e.sent)?(E.default.PaneManager.setupInitialTimeout(),this.onSignInResult(r,{email:t})):this.onSignInFailure({code:""}),e.abrupt("return",r);case 8:e.prev=8,e.t0=e.catch(0),this.onSignInFailure(e.t0);case 11:case"end":return e.stop()}}}),e,this,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createUserWithEmailAndPassword",value:function(){var e=s()(Z().mark((function e(t,n){var r;return Z().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,S.Z.auth().createUserWithEmailAndPassword(t,n);case 3:return(r=e.sent)?(E.default.PaneManager.setupInitialTimeout(),this.onSignInResult(r,{email:t})):this.onSignInFailure({code:""}),e.abrupt("return",r);case 8:e.prev=8,e.t0=e.catch(0),this.onSignInFailure(e.t0);case 11:case"end":return e.stop()}}}),e,this,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"sendResetEmail",value:function(){var e=s()(Z().mark((function e(t){return Z().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,S.Z.auth().sendPasswordResetEmail(t);case 3:return e.abrupt("return",!0);case 6:e.prev=6,e.t0=e.catch(0),console.log(e.t0),this.onSignInFailure(e.t0);case 10:case"end":return e.stop()}}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()}]),n}((r=function(){function e(){l()(this,e),this.user=new C.Z,this.onAuthedCallbacks=[]}return d()(e,[{key:"onSignInWithUser",value:function(e){var t=this;this.user.set(e),E.default.settings.onLoaded((function(){E.default.settings.userId.set(e.uid),E.default.settings.activeUser.set(e.email),e.displayName&&E.default.settings.displayName.set(e.displayName);try{D.Z.PAssert(461,e.uid===t._getUid())}catch(n){D.Z.reportError(n)}t.runAuthedCallbacks()}))}},{key:"runAuthedCallbacks",value:function(){this.onAuthedCallbacks.length>0&&(this.onAuthedCallbacks.forEach((function(e){return e()})),this.onAuthedCallbacks=[])}},{key:"getUserSync",value:function(){return this.user.get()}},{key:"getUser",value:function(){var e=s()(Z().mark((function e(){var t=this;return Z().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.user.get()){e.next=4;break}return e.abrupt("return",Promise.resolve(this.user.get()));case 4:return e.abrupt("return",new Promise((function(e){t.onAuthedCallbacks.push((function(){e(t.user.get())}))})));case 5:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onAuthed",value:function(e){this.user.get()?e():this.onAuthedCallbacks.push(e)}},{key:"onActiveUser",value:function(e){E.default.settings.activeUser.onHasValue(e)}},{key:"getAccountName",value:function(){return E.default.settings.displayName.get()||""}},{key:"getAccountEmail",value:function(){return E.default.settings.activeUser.get()}},{key:"getUid",value:function(){return E.default.settings.userId.get()}},{key:"getEncryptionUid",value:function(){return E.default.settings.userId.get()}},{key:"getCurrentUser",value:function(){return D.Z.isDemoMode()?null:S.Z.auth().currentUser}},{key:"getEmailProvider",value:function(){var e=this.getCurrentUser();return null===e||void 0===e?void 0:e.providerData.find((function(e){return"password"===e.providerId}))}},{key:"getGoogleProvider",value:function(){var e=this.getCurrentUser();return null===e||void 0===e?void 0:e.providerData.find((function(e){return"google.com"===e.providerId}))}},{key:"getAppleProvider",value:function(){var e=this.getCurrentUser();return null===e||void 0===e?void 0:e.providerData.find((function(e){return"apple.com"===e.providerId}))}}]),e}(),k()(r.prototype,"getUser",[b.ZP],Object.getOwnPropertyDescriptor(r.prototype,"getUser"),r.prototype),r)),k()(A.prototype,"linkWithEmail",[b.ZP],Object.getOwnPropertyDescriptor(A.prototype,"linkWithEmail"),A.prototype),k()(A.prototype,"linkWithGoogle",[b.ZP],Object.getOwnPropertyDescriptor(A.prototype,"linkWithGoogle"),A.prototype),k()(A.prototype,"linkWithApple",[b.ZP],Object.getOwnPropertyDescriptor(A.prototype,"linkWithApple"),A.prototype),k()(A.prototype,"unlink",[b.ZP],Object.getOwnPropertyDescriptor(A.prototype,"unlink"),A.prototype),k()(A.prototype,"unlinkEmail",[b.ZP],Object.getOwnPropertyDescriptor(A.prototype,"unlinkEmail"),A.prototype),k()(A.prototype,"unlinkGoogle",[b.ZP],Object.getOwnPropertyDescriptor(A.prototype,"unlinkGoogle"),A.prototype),k()(A.prototype,"unlinkApple",[b.ZP],Object.getOwnPropertyDescriptor(A.prototype,"unlinkApple"),A.prototype),A)},8276:(e,t,n)=>{"use strict";n.d(t,{Z:()=>w});var r=n(7154),i=n.n(r),a=n(6479),o=n.n(a),s=n(4575),c=n.n(s),l=n(3913),u=n.n(l),d=n(2205),h=n.n(d),p=n(8585),f=n.n(p),g=n(9754),m=n.n(g),v=n(8651),y=n(9955),k=n(404),_=["onClick","globalEvents"];function Z(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}const w=function(e){h()(n,e);var t=Z(n);function n(){return c()(this,n),t.apply(this,arguments)}return u()(n,[{key:"getElement",value:function(){return this.refs.element}},{key:"onMouseDown",value:function(e){this.lastX=e.clientX,this.lastY=e.clientY,this.moveX=0,this.moveY=0,this.isDown=!0,this.startSrc=e.target,this.props.onMouseDown&&this.props.onMouseDown(e),this.props.globalEvents&&v.Z.onMouseMoveUp(this.onMouseMove,this.onMouseUp)}},{key:"onMouseMove",value:function(e){if(this.isDown){this.moveX+=Math.abs(e.clientX-this.lastX),this.moveY+=Math.abs(e.clientY-this.lastY),this.lastX=e.clientX,this.lastY=e.clientY;var t={startSrc:this.startSrc,target:e.target,clientX:e.clientX,clientY:e.clientY,eventX:e.clientX,eventY:e.clientY,preventDefault:v.Z.emptyFn,stopPropagation:v.Z.emptyFn,stopImmediatePropagation:v.Z.emptyFn};this.props.onMouseMove&&this.props.onMouseMove(t)}}},{key:"onClick",value:function(e){this.moveX<v.Z.ClickThreshold&&this.moveY<v.Z.ClickThreshold&&this.props.onClick&&this.props.onClick(e)}},{key:"onMouseUp",value:function(e){this.isDown=!1,this.props.onMouseUp&&this.props.onMouseUp(e)}},{key:"onTapStart",value:function(e){this.onMouseDown(e),e.stopPropagation()}},{key:"onTapClick",value:function(e){this.props.onClick&&(this.props.onClick(e),e.stopPropagation())}},{key:"onTapMove",value:function(e){this.props.onMouseMove&&this.props.onMouseMove(e),e.stopPropagation()}},{key:"onTapEnd",value:function(e){this.onMouseUp(e),e.stopPropagation()}},{key:"render",value:function(){var e=this.props,t=(e.onClick,e.globalEvents),n=o()(e,_);return y.createElement("div",i()({},n,{onMouseDown:this.onMouseDown,onMouseMove:t?void 0:this.onMouseMove,onClick:this.onClick,onMouseUp:t?void 0:this.onMouseUp,ref:"element"}),this.props.children)}}]),n}(k.a)},8373:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(2205),c=n.n(s),l=n(8585),u=n.n(l),d=n(9754),h=n.n(d),p=n(8651),f=n(8855),g=n(4654),m=n(9955),v=n(8478),y=n(404),k=n(1399),_=n(5097);function Z(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u()(this,n)}}var w=function(e){p.Z.preventAndStop(e)};const b=function(e){c()(n,e);var t=Z(n);function n(){return i()(this,n),t.apply(this,arguments)}return o()(n,[{key:"init",value:function(){this.createObservables({isLoading:!1})}},{key:"getElement",value:function(){return v.findDOMNode(this)}},{key:"onClick",value:function(e){this.isLoading.get()||!1===this.props.enabled||(this.props.onClick||this.props.onMouseDown)(e,this.onButtonClickCallback)&&this.isLoading.set(!0)}},{key:"onMouseDown",value:function(e){if(!1!==this.props.enabled&&e.button===f.Z.ButtonCode.Left&&this.props.onHold){var t={target:e.target,preventDefault:e.preventDefault};this._holdTimeout=setTimeout(this.onHold,150,t)}}},{key:"onMouseUp",value:function(e){this._clearHoldTimeout(),this.props.onMouseUp&&this.props.onMouseUp(e)}},{key:"onHold",value:function(e){this._clearHoldTimeout(),this.props.onHold(e)}},{key:"_clearHoldTimeout",value:function(){this._holdTimeout&&(clearTimeout(this._holdTimeout),this._holdTimeout=0)}},{key:"onKeyDown",value:function(e){e.keyCode===f.Z.KeyCode.Enter&&this.onClick(e)}},{key:"focus",value:function(){this.getElement().focus()}},{key:"onButtonClickCallback",value:function(){this.isLoading.set(!1)}},{key:"removeRipple",value:function(){this.ripples.removeAt(0)}},{key:"render",value:function(){var e,t,n,r=this.state,i=this.props,a=!1===i.enabled,o=0===(null===(e=i.color)||void 0===e?void 0:e.indexOf("#"));i.color&&!o?n=i.color:i.primary?n=i.raised?"c-button-raised-primary":"c-button-primary":i.heavy?i.raised||(n="c-button-heavy"):n=i.cancel?i.raised?"c-button-raised-cancel":"c-button-cancel":i.raised?"c-button-raised":"c-button";var s={display:i.display,lineHeight:i.height?"auto"===i.height?null:i.height+"px":"36px",height:i.height,width:i.width,minWidth:i.width,textAlign:null!==(t=i.textAlign)&&void 0!==t?t:"center",margin:i.margin,paddingLeft:i.paddingLeft,paddingTop:i.paddingTop,paddingRight:i.paddingRight,paddingBottom:i.paddingBottom,fontWeight:i.fontWeight,fontSize:i.fontSize,color:i.color};void 0===i.margin&&(s.marginLeft=i.marginLeft,s.marginTop=i.marginTop,s.marginRight=i.marginRight,s.marginBottom=i.marginBottom),s=p.Z.extend(s,this.props.style),i.raised&&!i.children&&i.icon&&!1!==i.round&&(s.borderRadius="50%");var c,l={fontSize:i.fontSize};if(i.icon){var u={height:i.height,fontSize:i.iconSize,color:i.color},d=p.Z.classNames("fancyButtonIcon",i.icon,{"c-button":!!i.color});i.children?0!==i.padding&&(l.paddingLeft="6px",l.paddingRight=0,s.paddingLeft="16px",s.paddingRight="16px"):(s.width=i.width||36,s.height=i.height||36,s.maxWidth=i.width||36,s.maxHeight=i.height||36,s.textAlign="center"),c=m.createElement("i",{className:d,style:u})}isNaN(i.padding)||(l.padding="0 "+i.padding+"px"),i.paddingText&&(l.paddingLeft=i.paddingText);var h=i.children&&m.Children.count(i.children)>0,f=p.Z.classNames("fancyButtonText align-middle"),v=h&&m.createElement("div",{className:f,style:l},i.children),y=p.Z.classNames("fancyButton",n,{raised:i.raised},{loading:r.isLoading},{primary:i.primary},{cancel:i.cancel},{hasText:h},{hasIcon:!!i.icon||!!i.iconComponent},{disabled:a},{selected:i.selected},i.className),Z=r.isLoading&&m.createElement(_.Z,{center:!0,color:i.primary||g.default.DisplaySettings.isDark()?"#fff":"#666",size:6}),b=i.tooltipHotkey,P=b?p.Z.isString(b)?b:g.default.hotkeys.printHotkeyByName(b.name,b.group):void 0;return m.createElement(k.Z,{className:y,style:s,enabled:i.enabled,onPointerDown:i.preventDefaultOnMobileDown?w:void 0,onMouseEnter:i.onMouseEnter,onMouseLeave:i.onMouseLeave,onMouseDown:i.onMouseDown&&this.onClick||i.onHold&&this.onMouseDown||void 0,onMouseUp:i.onHold||i.onMouseUp?this.onMouseUp:void 0,onClick:i.onClick?this.onClick:void 0,onDoubleClick:i.onDoubleClick,onRightClick:i.onRightClick,onKeyDown:this.onKeyDown,id:i.id,center:i.center||(!!i.icon||!!i.iconComponent)&&!h,ripple:i.ripple,tabIndex:i.tabIndex,"data-tooltip":!a&&i.tooltip?i.tooltip:null,"data-tooltiphotkey":a?null:P},c,i.iconComponent&&m.createElement(i.iconComponent,{size:i.iconSize,style:{height:s.lineHeight}}),v,Z)}}]),n}(y.a)},9647:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(3038),i=n.n(r),a=n(4654),o=n(8651),s=n(9955),c=n(3234),l=n(5428),u=n(5097);const d=(0,c.Z)((function(e){var t=e.mode,n=e.id,r=e.className,c=e.classNameIcon,d=e.color,h=(e.noHover,e.width),p=e.height,f=e.icon,g=e.iconSize,m=e.iconPadding,v=e.iconWidth,y=e.size,k=e.text,_=e.disabled,Z=e.tooltip,w=e.tooltipHotkey,b=e.selected,P=e.align,S=e.style,D=e.styleText,I=e.padding,E=e.primary,x=e.cancel,C=e.iconSrc,A=(e.newStyle,e.showLoader),L=(e.hoverBG,e.noShrink),M=e.onClick,T=e.onMouseDown;P=P||"center";var R=A?(0,s.useState)(!1):[!1],O=i()(R,2),F=O[0],N=O[1],B=o.Z.classNames("relative flex items-center cursor-pointer rounded text-center box-border truncate select-none",{mobutton:!0},{"font-bold text-12 inline-flex c-shadow-lighter":!1},{"justify-center":"center"===P},{"justify-end":"right"===P},{"c-bg-gray-300 c-bg-gray-300-hover":"contained"===t&&!E},{"c-button-hover":!1},{"border c-border-heavy":"outlined"===t},{"c-button-selected":b},(void 0===h||I)&&(I||"px-2"),{"py-2":void 0===p},{"c-button-raised-primary c-white":E&&"contained"===t},{"c-button-raised-cancel c-white":x&&"contained"===t},{"flex-shrink-0":L},_&&"disabled",d,r),U=Object.assign({fontSize:y,width:h,height:p,lineHeight:p+"px"},S),j=w?o.Z.isString(w)?w:a.default.hotkeys.printHotkeyByName(w.name,w.group):void 0,H=o.Z.classNames("flex-shrink-0 pointer-events-none box-content",c,(f||C)&&k&&(m||"mr-2"),{invisible:F}),V=o.Z.classNames("truncate",{invisible:F});return s.createElement("div",{id:n,className:B,style:U,onClick:_?void 0:function(e){if(!F){var t=null===M||void 0===M?void 0:M(e);A&&t&&"function"===typeof t.then&&(N(!0),t.then((function(){N(!1)})))}},onMouseDown:_?void 0:T,"data-tooltip":_?void 0:Z,"data-tooltiphotkey":j},f&&(o.Z.isString(f)&&f.startsWith("icon-")?s.createElement("i",{className:o.Z.classNames(f,H),style:{fontSize:g,width:v}}):s.createElement(l.J,{name:f,size:g,className:H,style:{width:v,verticalAlign:"middle"}})),C&&s.createElement("img",{src:C,width:g,height:g,className:H}),k&&s.createElement("div",{className:V,style:D},k),F&&s.createElement(u.Z,{center:!0,size:6,color:E?"#fff":void 0}))}))},9758:(e,t,n)=>{"use strict";n.d(t,{Z:()=>F});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(2205),c=n.n(s),l=n(8585),u=n.n(l),d=n(9754),h=n.n(d),p=n(8651),f=n(8855),g=n(4654),m=n(7100),v=n(9955),y=n(404),k=n(4764),_=n(8373),Z=n(3038),w=n.n(Z),b=n(4472),P=n(2694);function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u()(this,n)}}var D=["#4D4D4D","#999999","#CCCCCC","#FFFFFF","#F44E3B","#FE9200","#FCDC00","#A4DD00","#68CCCA","#73D8FF","#AEA1FF","#FDA1FF","#333333","#808080","#BBBBBB","#EEEEEE","#D33115","#E27300","#FCC400","#22AA66","#16A5A5","#0099DD","#7B64FF","#FA28FF","#000000","#666666","#AAAAAA","#DDDDDD","#AA3300","#C45100","#FB9E00","#194D33","#0C797D","#0062B1","#653294","#AB149E"],I={hex3:/^(#)([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^(#)([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};const E=function(e){c()(n,e);var t=S(n);function n(){return i()(this,n),t.apply(this,arguments)}return o()(n,[{key:"init",value:function(){this.createObservables({color:this.props.color,value:this.props.color,isValid:!0}),b.Z.reset()}},{key:"parseColor",value:function(e){var t;return(t=I.hex3.exec(e))?"#"+t[2]+t[2]+t[3]+t[3]+t[4]+t[4]:(t=I.hex6.exec(e))?e:void 0}},{key:"onClickColor",value:function(e){this.color.set(e),this.value.set(e),this.props.onChange(e)}},{key:"onChangeInputColor",value:function(e){var t=e.target.value.toUpperCase();0!==t.indexOf("#")&&(t="#"+t);var n=this.parseColor(t);n&&(this.color.set(n),this.props.onChange(n)),t.length<8&&this.value.set(t),this.isValid.set(!!this.parseColor(this.value.get()))}},{key:"onChangeInputComponent",value:function(){var e=this.refs,t=+e.r.value,n=+e.g.value,r=+e.b.value;if(t>=0&&t<=255&&n>=0&&n<=255&&r>=0&&r<=255){var i="#"+p.Z.rgbToHex(t,n,r).toUpperCase();this.value.set(i),this.color.set(i),this.props.onChange(i)}}},{key:"render",value:function(){for(var e=0,t=this.state,n=this.state.color,r=p.Z.hexToRgb(n),i=[],a=0;a<D.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=D[a],s=p.Z.classNames("fancyColor",{selected:o===n},{isWhite:"#FFFFFF"===o.toUpperCase()}),c={background:o};i.push(v.createElement("div",{key:o,className:s,style:c,onClick:this.onClickColor.bind(this,o)}))}var l=p.Z.classNames("fancyColorInputColor",{invalid:!t.isValid});return v.createElement(P.Z,{id:"fancyColorPicker",element:this.props.element,positionOffset:{left:-120,top:4},focusTrap:!0},v.createElement("div",{className:"fancyColors"},i),v.createElement("div",{className:"fancyColorText"},v.createElement("div",{key:n,className:"fancyColor",style:{background:n}}),v.createElement("input",{type:"text",className:l,value:t.value,onChange:this.onChangeInputColor}),v.createElement("span",null,"R"),v.createElement("input",{type:"text",ref:"r",className:"fancyColorInputComponent",value:r.r,onChange:this.onChangeInputComponent}),v.createElement("span",null,"G"),v.createElement("input",{type:"text",ref:"g",className:"fancyColorInputComponent",value:r.g,onChange:this.onChangeInputComponent}),v.createElement("span",null,"B"),v.createElement("input",{type:"text",ref:"b",className:"fancyColorInputComponent",value:r.b,onChange:this.onChangeInputComponent})))}}]),n}(y.a);var x=n(3234),C=n(3170);const A=(0,x.Z)((function(e){var t,n,r=e.color,i=e.colorObservable,a=e.className,o=e.onChange,s=e.onClosed,c=e.style;if(i){var l=(0,C.Z)(i),u=w()(l,1);t=u[0],n=i.set.bind(i)}else{var d=(0,v.useState)(r),h=w()(d,2);t=h[0],n=h[1],(0,v.useEffect)((function(){n(r)}),[r,n])}var f=function(e){n(e),o&&o(e)};return v.createElement("div",{className:p.Z.classNames("fancyColor",a,!(null!==a&&void 0!==a&&a.includes("align-text"))&&"align-middle",{isWhite:"#FFFFFF"===t.toUpperCase()}),style:p.Z.extend({background:t,border:"1px solid #666"},c),onClick:function(e){g.default.menus.openContextMenu({fn:function(e){return v.createElement(E,{key:"fancyColorPicker",color:t,onChange:f,element:e.element})},element:e.target,onClosed:s})}})}));var L=n(8133);function M(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u()(this,n)}}var T=f.Z.KeyboardToolbarButtonHeight,R=/(^|\s|&nbsp;|<div>|<span>|<p>)((?:(?:((https?|ftps?):\/\/)|www)[^"<\s]+)(?![^<>]*>|[^"]*?<\/a))/gi,O=[f.Z.KeyCode.ArrowLeft,f.Z.KeyCode.ArrowRight,f.Z.KeyCode.ArrowUp,f.Z.KeyCode.ArrowDown,f.Z.KeyCode.Enter,f.Z.KeyCode.Escape,f.Z.KeyCode.PageUp,f.Z.KeyCode.PageDown];const F=function(e){c()(n,e);var t=M(n);function n(){return i()(this,n),t.apply(this,arguments)}return o()(n,[{key:"init",value:function(){this.refDiv=v.createRef(),this.createObservables({isFocused:this.props.focused||!1})}},{key:"onMount",value:function(){var e=this,t=this.props;if(t.value){var n=this.replaceHTMLLinks(t.value.replace(/\r?\n/g,"<br>"));this.setValue(n)}t.focused&&requestAnimationFrame((function(){e.refDiv.current&&e.refDiv.current.focus()}))}},{key:"onUnmount",value:function(){this.isFocused.get()&&this.onBlur()}},{key:"focus",value:function(){var e=this;p.Z.isDemoRunning||(this.refDiv.current.focus(),requestAnimationFrame((function(){e.refDiv.current.focus()})))}},{key:"blur",value:function(){this.refDiv.current.blur()}},{key:"setValue",value:function(e){this.refDiv.current.innerHTML=e}},{key:"getValue",value:function(){return this.refDiv.current.textContent.length>0?this.refDiv.current.innerHTML:""}},{key:"getTextValue",value:function(){return this.refDiv.current.textContent}},{key:"getElement",value:function(){return this.refDiv.current}},{key:"insertCharAtIndex",value:function(e,t){var n=this.refDiv.current,r=n.innerHTML;r=r.substr(0,t)+e+r.substr(t,r.length),n.innerHTML=r,k.Z.selectElement(n,t+1),this.props.onChange&&this.props.onChange()}},{key:"onFocus",value:function(e){this.isFocused.set(!0),this.props.onFocus&&this.props.onFocus(e)}},{key:"onBlur",value:function(e){this.isFocused.set(!1),this.props.onBlur&&this.props.onBlur(e)}},{key:"hasFocus",value:function(){return this.isFocused.get()}},{key:"onEscapeKey",value:function(){this.props.onEscape&&this.props.onEscape()}},{key:"onDrop",value:function(e){this.props.onDrop&&this.props.onDrop(e.dataTransfer)}},{key:"onDragEnter",value:function(){this.props.onDrop&&p.Z.addClass(this.refDiv.current,"dragTarget")}},{key:"onDragLeave",value:function(){this.props.onDrop&&p.Z.removeClass(this.refDiv.current,"dragTarget")}},{key:"onKeyDown",value:function(e){if(m.Z.mac&&e.metaKey||!m.Z.mac&&e.ctrlKey)e.keyCode===f.Z.KeyCode.U?this.onClickToolbarButton("underline"):e.keyCode===f.Z.KeyCode.K?this.insertLink({target:this.refs.link.getElement()}):e.keyCode===f.Z.KeyCode.H?(this.makeHeading(),p.Z.preventDefault(e)):e.keyCode===f.Z.KeyCode.V&&(this.__pasteWithShift=e.shiftKey);else if(!O.includes(e.keyCode)){var t=k.Z.getSelectionRangeNative();if(t){var n=t.startContainer,r=n.parentElement;"A"===r.nodeName&&r.textContent===r.getAttribute("href")&&t.startOffset===t.endOffset&&t.startOffset===r.textContent.length&&(r.replaceWith(n),k.Z.selectAfterNode(n))}}this.props.onKeyDown&&this.props.onKeyDown(e)}},{key:"insertNode",value:function(e){this.focus(),k.Z.deleteRangeContents(),k.Z.insertNode(e),k.Z.selectAfterNode(e)}},{key:"insertLink",value:function(e){var t=k.Z.getSelectedText(),n=e.target;this.savedSel=k.Z.getSelectionRange(),g.default.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:n,onClosed:this.onInsertLinkClosed,onInsertLink:this.onInsertLink,text:t})}},{key:"onInsertLinkClosed",value:function(){this.savedSel&&(this.focus(),k.Z.setSelectionRange(this.savedSel))}},{key:"onInsertLink",value:function(e){var t=document.createElement("a");t.href=e.href,t.textContent=e.text,this.insertNode(t)}},{key:"makeHeading",value:function(e){for(var t,n,r=0,i=window.getSelection(),a=i.rangeCount;a--;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=i.getRangeAt(a),s=o.startContainer,c=o.startContainer.parentElement,l=k.Z.getSelectOffsetsInElement(this.refDiv.current,o);if("H2"===c.nodeName)n=void 0,c.parentElement.replaceChild(s,c),k.Z.selectElement(s,0,s.textContent.length);else if(l){if(!e&&l.start===l.end)return k.Z.selectElement(s,0,s.textContent.length),this.makeHeading(!0);(n=document.createElement("h2")).appendChild(o.extractContents()),o.insertNode(n),t=n.textContent.length}}n&&t&&k.Z.selectElement(n,0,t)}},{key:"onClickToolbarButton",value:function(e,t){p.Z.isString(e)?"heading"===e?this.makeHeading():document.execCommand(e):e(t),p.Z.preventAndStop(t)}},{key:"onClick",value:function(e){if("A"===e.target.nodeName){var t,n,r=(null===(t=(n=e.target).getAttribute)||void 0===t?void 0:t.call(n,"href"))||e.target.href;g.default.openUrl(r)}else this.props.onClick&&this.props.onClick(e)}},{key:"onPaste",value:function(e){if(this.__pasteWithShift){var t=document.queryCommandSupported("insertText"),n=document.queryCommandSupported("paste");if(t||n){e.preventDefault();var r="";e.clipboardData||e.originalEvent.clipboardData?r=(e.originalEvent||e).clipboardData.getData("text/plain"):window.clipboardData&&(r=window.clipboardData.getData("Text")),r=r.trim();var i=t?"insertText":"paste";document.execCommand(i,!1,r)}}}},{key:"replaceHTMLLinks",value:function(e){return e.replace(R,(function(e,t,n){return t+'<a href="'+n+'">'+n+"</a>"}))}},{key:"onSetColor",value:function(e){document.execCommand("forecolor",!1,e)}},{key:"onChange",value:function(e){var t=e.target.innerHTML,n=this.replaceHTMLLinks(t);if(t!==n){var r=k.Z.getSelectionRangeNative(),i={start:0,end:0};r&&(i=k.Z.getSelectOffsetsInElement(e.target,r)),e.target.innerHTML=n,k.Z.selectElement(e.target,i.start,i.end)}this.props.onChange&&this.props.onChange(e)}},{key:"renderToolbarButton",value:function(e,t,n,r,i,a){var o=m.Z.priModKey;return i&&(i="Escape"===i?i:o+" + "+i),v.createElement(_.Z,{className:"button_"+r,icon:e,width:T,height:T,iconSize:t,onClick:this.onClickToolbarButton.bind(this,n),tooltip:r,tooltipHotkey:i,ref:a,preventDefaultOnMobileDown:!0})}},{key:"render",value:function(){var e,t=this.props,n=p.Z.classNames("fancyContenteditableWrapper flexbox flexvert",t.className),r=(p.Z.classNames("fancyContenteditable f1 c-background",{richText:t.richText}),{height:this.props.height,marginBottom:f.Z.KeyboardToolbarButtonHeight}),i=!!t.spellCheck||null;return t.richText&&(e=v.createElement("div",{className:"flex select-none fancyContenteditableToolbar c-bg-faded c-border-light"},this.renderToolbarButton("icon-format_bold",19,"bold","Bold","B"),this.renderToolbarButton("icon-format_italic",19,"italic","Italic","I"),this.renderToolbarButton("icon-format_underlined",18,"underline","Underline","U"),this.renderToolbarButton("icon-header",14,"heading","Heading","H","H1"),v.createElement("div",{className:"divider c-bg-autocomplete-highlight"}),this.renderToolbarButton("icon-numlist",14,"insertOrderedList","Numbered list","L"),this.renderToolbarButton("icon-bullet",26,"insertUnorderedList","Bulleted list","Option + L"),v.createElement("div",{className:"divider c-bg-autocomplete-highlight"}),v.createElement(A,{color:"#000000",onChange:this.onSetColor,style:{marginTop:11,verticalAlign:"top"}}),this.renderToolbarButton("icon-link",18,this.insertLink,"Link","K","link"),v.createElement("div",{className:"f1"}),t.onMaximize&&this.renderToolbarButton(t.isMaximized?"icon-filter_none":"icon-check_box_outline_blank",14,(function(){return t.onMaximize(!t.isMaximized)}),t.isMaximized?"Restore":"Maximize"),t.onClickClose&&this.renderToolbarButton("icon-close",18,t.onClickClose,"Close","Escape")),e=v.createElement(L.o0.KeyboardToolbarPortal,null,e)),v.createElement("div",{className:n,style:r},e,v.createElement("div",{contentEditable:!1!==t.editable,className:p.Z.classNames("fancyContenteditable f1 c-background t-text",{richText:t.richText}),style:this.props.style,ref:this.refDiv,spellCheck:i,onInput:this.onChange,onClick:this.onClick,onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onKeyUp:t.onKeyUp,onKeyPress:t.onKeyPress,onDrop:this.onDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onPaste:this.onPaste,tabIndex:t.tabIndex}))}}]),n}(y.a)},2694:(e,t,n)=>{"use strict";n.d(t,{Z:()=>C});var r=n(6479),i=n.n(r),a=n(9713),o=n.n(a),s=n(4575),c=n.n(s),l=n(3913),u=n.n(l),d=n(2205),h=n.n(d),p=n(8585),f=n.n(p),g=n(9754),m=n.n(g),v=n(8855),y=n(3470),k=n(8651),_=n(7100),Z=n(9955),w=n(4654),b=n(3479),P=n(6134),S=n(404),D=n(3968),I=["children"];function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function x(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}const C=function(e){h()(n,e);var t=x(n);function n(){return c()(this,n),t.apply(this,arguments)}return u()(n,[{key:"init",value:function(){var e=this.props;this.refMenu=(0,Z.createRef)(),e.supportArrows&&(this.selectedIndex=w.default.hotkeys.registerArrowsMode("FancyContextMenu",!0,this.getNumItems,this.onArrowsModeSelect,this.onArrowsModeKey),e.fromHotkey&&this.selectedIndex.set(0,!1),e.onSelectedIndexChanged&&this.selectedIndex.listen(e.onSelectedIndexChanged))}},{key:"close",value:function(){try{k.Z.PAssert(468,this.props.name,"Cannot call close on a menu without a name")}catch(e){k.Z.reportError(e)}w.default.menus.closeContextMenu(this.props.name)}},{key:"getHotkeys",value:function(){var e=this.props,t=[w.default.hotkeys.createEscape(this.onEscapeKey)];return e.hotkeys&&(t=t.concat(e.hotkeys)),t}},{key:"getRefAtIndex",value:function(e){return this.refs["el_"+e]}},{key:"onMount",value:function(){var e=this;if(_.Z.windowSize.listen(this.onResize),this.props.noBackdrop&&document.addEventListener("mousedown",this.onMouseDownNoBackdrop,!0),this.updateState(),P.Z){this.resizeObserver=new P.Z((function(t){e.updateState()}));try{this.resizeObserver.observe(this.refMenu.current)}catch(t){}}}},{key:"onUnmount",value:function(){_.Z.windowSize.unlisten(this.onResize),this.props.supportArrows&&w.default.hotkeys.exitArrowsMode("FancyContextMenu"),this.props.noBackdrop&&document.removeEventListener("mousedown",this.onMouseDownNoBackdrop,!0),this.resizeObserver&&this.resizeObserver.unobserve(this.refMenu.current)}},{key:"onResize",value:function(){var e=this;setTimeout((function(){return e._isMounted&&e.updateState()}),200)}},{key:"getState",value:function(){var e=this.updatePosition();return e.left<=8&&0===e.top&&this._lastPos&&(e=this._lastPos),this._lastPos=e,function(e){for(var t=0,n=1;n<arguments.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=null!=arguments[n]?arguments[n]:{};n%2?E(Object(r),!0).forEach((function(t){o()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({windowSize:_.Z.windowSize,selectedIndex:this.selectedIndex},e)}},{key:"getElement",value:function(){return this.refMenu.current}},{key:"onMouseDownNoBackdrop",value:function(e){k.Z.findParent(e.target,"fancyContextMenu")||w.default.menus.closeContextMenu()}},{key:"getNumItems",value:function(){return this.numItems}},{key:"onArrowsModeSelect",value:function(e){if(e>=0)if(this.props.onEnterKey)this.props.onEnterKey();else{var t=this.refs["el_"+e];t&&t.onClick&&t.onClick()}}},{key:"onArrowsModeKey",value:function(e,t){var n=this.props;n.onKeyPress&&n.onKeyPress(e,t)&&n.supportArrows&&w.default.hotkeys.exitArrowsMode("FancyContextMenu")}},{key:"onEscapeKey",value:function(){this.props.onEscape&&this.props.onEscape(),w.default.menus.closeTopContextMenu()}},{key:"onChildMouseEnter",value:function(e,t){this.selectedIndex.set(e)}},{key:"updatePosition",value:function(){var e=this.props,t=_.Z.windowSize.get(),n=t.width,r=t.height;try{k.Z.PAssert(469,e.element,"Context menu needs an element to open on",e.id)}catch(P){k.Z.reportError(P)}if(e.element){var i,a,o,s,c=e.element.getBoundingClientRect(),l=e.pos,u=this.refMenu.current,d=null!==(i=null===l||void 0===l?void 0:l.left)&&void 0!==i?i:c.left,h=null!==(a=null===l||void 0===l?void 0:l.top)&&void 0!==a?a:c.bottom;e.onSide&&(h=c.top-4,(d=c.right)>_.Z.windowWidth()-200&&(d=void 0,o=c.left));var p=e.positionOffset;p&&(!isNaN(d)&&p.left&&(d+=p.left),!isNaN(o)&&p.right&&(o+=p.right),!isNaN(h)&&p.top&&(h+=p.top),!isNaN(s)&&p.bottom&&(s+=p.bottom));var f={left:d,top:h,right:o,bottom:s};if(u){var g=d+u.clientWidth,m=h+u.clientHeight,v=n-8,y=r-8,Z=c.top-8,w=r-c.bottom-8,b=Math.max(Z,w);m>y&&(e.overflowHeight&&(f.maxHeight=e.maxHeight?Math.min(b,e.maxHeight):b),"swap"===e.overflowHeight&&Z>w?(f.bottom=r-c.top,f.top=void 0):f.top+=y-m),g>v&&(f.left+=v-g),(d<8||d+f.left<8)&&g<n&&(f.left+=8-d)}return f}return{left:0,right:0,top:0,bottom:0}}},{key:"remapChildren",value:function(e,t){var n=this;return Z.Children.map(e,(function(e){if(e&&"hr"!==e.type){if("leftcol"===e.key){var r=e.props,a=r.children,o=i()(r,I);return Z.createElement("div",o,n.remapChildren(a,t))}if("scroller"===e.key){return Z.createElement(b.Z,{style:{maxHeight:400}},n.remapChildren(e.props.children,t))}if(!e.props||e.props.onClick||e.props.customLayout){var s=e.props.onMouseEnter?function(r){n.onChildMouseEnter(t.index,r),e.props.onMouseEnter(r)}:n.onChildMouseEnter.bind(n,t.index);return Z.cloneElement(e,{onMouseEnter:s,ref:"el_"+t.index,selected:n.state.selectedIndex===t.index++||e.props.selected})}return e}return e}))}},{key:"render",value:function(){var e,t=this.state,n=this.props,r=k.Z.classNames("fancyContextMenu popup t-popup will-change-transform c-foreground",n.className,{fancyContextMenuMaximized:n.isMaximized},{"c-border-light":n.border},{f1:n.isMaximized},{loading:n.loading},{openFromBottom:n.openFromBottom});n.isMaximized||(e={left:t.left,top:t.top,right:t.right,bottom:isNaN(n.bottom)?t.bottom:n.bottom,width:n.width,height:n.height,minWidth:n.minWidth,maxHeight:t.maxHeight||n.maxHeight,maxWidth:n.maxWidth,border:n.border?"1px solid":void 0,padding:n.padding||void 0},e=k.Z.extend(e,this.props.style));var i=this.props.children;if(n.supportArrows){var a={index:0};i=this.remapChildren(this.props.children,a),this.numItems=a.index}var o=Z.createElement(y.E.div,{className:r,id:n.id,style:e,ref:this.refMenu,initial:{scaleX:.95,scaleY:.8},animate:{scaleX:1,scaleY:1},layout:void 0!==n.isMaximized||void 0,transition:v.Z.TransitionSpringFastest,tabIndex:-1},i);return n.focusTrap?Z.createElement(D.Z,null,o):o}}]),n}(S.a)},5657:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(2205),c=n.n(s),l=n(8585),u=n.n(l),d=n(9754),h=n.n(d),p=n(8651),f=n(9955);function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u()(this,n)}}const m=function(e){c()(n,e);var t=g(n);function n(){return i()(this,n),t.apply(this,arguments)}return o()(n,[{key:"render",value:function(){var e=this.props,t=p.Z.classNames("fancyContextMenuItem fancyContextMenuHeader flexbox c-foreground-very-faded",e.className,{"border-b c-border-light":!1!==e.border},{topHeader:e.topHeader}),n=p.Z.classNames("fancyContextMenuHotkey c-foreground-faded",{centered:e.hotkeyCentered}),r=Object.assign({padding:isNaN(e.padding)?void 0:e.padding},e.style);return f.createElement("div",{className:t,style:r},f.createElement("span",{className:"f1"},e.children),e.hotkey&&f.createElement("span",{className:n},e.hotkey))}}]),n}(n(404).a)},8262:(e,t,n)=>{"use strict";n.d(t,{Z:()=>w});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(2205),c=n.n(s),l=n(8585),u=n.n(l),d=n(9754),h=n.n(d),p=n(8855),f=n(8651),g=n(7100),m=n(9955),v=n(4654),y=n(8373),k=n(1399),_=n(5428);function Z(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u()(this,n)}}const w=function(e){c()(n,e);var t=Z(n);function n(){return i()(this,n),t.apply(this,arguments)}return o()(n,[{key:"init",value:function(){this.movement=0,this.createObservables({isHovered:!1})}},{key:"getElement",value:function(){var e=this.refs.element;return e.getElement?e.getElement():e}},{key:"closeMenu",value:function(){!1!==this.props.canClose&&v.default.menus.closeContextMenu()}},{key:"onClick",value:function(e){var t=this,n=this.props;n.hasButtons||this.didClickJustFire||!n.onClick||(!1!==n.clickCloses&&this.closeMenu(),n.onClick(e),this.didClickJustFire=!0,setTimeout((function(){t.didClickJustFire=!1}),300))}},{key:"onClickIcon",value:function(e){var t=this.props;t.onClickIcon?(this.closeMenu(),t.onClickIcon(e)):this.onClick(e)}},{key:"onMouseDown",value:function(e){var t=this.props;this.didMouseDown=!0,(t.onClickIcon||f.Z.hasClass(e.target,"fancyContextMenuIcon"))&&e.preventDefault()}},{key:"onMouseMove",value:function(e){this.movement+=Math.abs(e.movementX)+Math.abs(e.movementY),this.props.onMouseMove&&this.props.onMouseMove(e)}},{key:"onMouseUp",value:function(e){var t=this.props;(this.movement>4||this.didMouseDown)&&(!isNaN(e.button)&&e.button!==p.Z.ButtonCode.Left||g.Z.mac&&e.ctrlKey||t.onClickIcon&&f.Z.hasClass(e.target,"fancyContextMenuIcon")||this.onClick(e))}},{key:"onMouseEnter",value:function(e){this.isHovered.set(!0),this.props.onMouseEnter&&this.props.onMouseEnter(e)}},{key:"onMouseLeave",value:function(){this.isHovered.set(!1)}},{key:"openSubmenu",value:function(){v.default.menus.openContextMenu({fn:this.props.renderSubmenu,element:this.getElement(),onSide:!0})}},{key:"closeSubmenu",value:function(){v.default.menus.closeContextMenu(this.props.renderSubmenu)}},{key:"render",value:function(){var e,t,n=this.props,r=this.state,i=n.onClick||n.hoverEffects||n.renderSubmenu,a=f.Z.classNames("fancyContextMenuItem",{flexbox:!n.customLayout},{"c-foreground":!n.faded},{"c-foreground-very-faded":n.faded},{"c-popup-item":i&&!1!==n.hoverEffects},{"selected c-bg-dark":n.active||n.selected||!1!==n.hoverEffects&&r.isHovered},{disabled:n.disabled},{hasIcon:!!n.icon||!!n.iconNew},{hasContent:!!n.children},{bold:n.bold},{hasHotkey:n.hotkey},{"flex-center":n.center},{hasButtons:n.hasButtons},this.props.className);if(n.icon){var o=f.Z.isString(n.icon);if(n.onClickIcon||!o)e=m.createElement(y.Z,{className:"fancyContextMenuIcon",icon:o&&n.icon,iconComponent:!o&&n.icon,tooltip:n.iconTooltip,width:36,height:n.height||28,onClick:this.onClickIcon});else{var s=n.iconColor,c=null===s||void 0===s?void 0:s.startsWith("#"),l=f.Z.classNames("fancyContextMenuIcon",{"c-foreground-faded":!s},!c&&s,n.icon),u={fontSize:n.iconSize,height:n.height,lineHeight:n.height&&n.height+"px",color:c&&s};e=m.createElement("span",{className:l,style:u,onClick:this.onClickIcon,"data-tooltip":n.iconTooltip})}}else if(n.iconNew){var d=n.iconColor,h=null===d||void 0===d?void 0:d.startsWith("#"),p=f.Z.classNames("fancyContextMenuIcon",{"c-foreground-faded":!d},!h&&d,n.icon),g={fontSize:n.iconSize,height:n.height,lineHeight:n.height&&n.height+"px",color:h&&d};e=m.createElement("span",{className:p,style:g},m.createElement(_.J,{name:n.iconNew,size:n.iconSize,style:{verticalAlign:"text-top"}}))}var Z=n.hotkey;if(Z){var w=f.Z.classNames("fancyContextMenuHotkey c-foreground-faded",{centered:n.hotkeyCentered}),b=f.Z.isString(Z)?Z:v.default.hotkeys.printHotkeyByName(Z.name,Z.group);t=m.createElement("span",{className:w},b)}var P=Object.assign({height:n.height,lineHeight:n.height&&n.height+"px",cursor:i?"pointer":""},n.style),S={id:n.id,className:a,"data-tooltip":n.tooltip,onMouseMove:n.onMouseMove,style:P,ref:"element"};return i&&(S.onMouseDown=n.renderSubmenu?this.openSubmenu:n.onClick?this.onMouseDown:void 0,S.onMouseUp=n.onClick&&!n.noMouseUp?this.onMouseUp:void 0,S.onMouseMove=n.onMouseMove||n.onClick&&!n.noMouseUp?this.onMouseMove:void 0,S.onClick=n.onClick&&n.noMouseUp?this.onMouseUp:void 0,S.onMouseEnter=!1!==n.hoverEffects?this.onMouseEnter:void 0,S.onMouseLeave=!1!==n.hoverEffects?this.onMouseLeave:void 0),m.createElement(n.onClick?k.Z:"div",S,e,t?m.createElement("span",{className:"f1"},n.children):n.children,t)}}]),n}(n(404).a)},3968:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(4483),i=n.n(r),a=n(9955),o={fallbackFocus:document.body,clickOutsideDeactivates:!0};function s(e){var t=e.children;return a.createElement(i(),{focusTrapOptions:o},t)}},1319:(e,t,n)=>{"use strict";n.d(t,{Z:()=>P});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(2205),c=n.n(s),l=n(8585),u=n.n(l),d=n(9754),h=n.n(d),p=n(3470),f=n(8855),g=n(8651),m=n(7100),v=n(9955),y=n(4654),k=n(4764),_=n(8778),Z=n(3656),w=n(5216);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u()(this,n)}}const P=function(e){c()(n,e);var t=b(n);function n(e){var r;return i()(this,n),(r=t.call(this,e)).__isInput=!0,r}return o()(n,[{key:"init",value:function(){var e=this.props,t={isFocused:e.focused,isComposing:!1,value:e.value||"",tokens:e.tokens||[],validationError:void 0,item:e.item?{item:e.item,text:e.item.getStyledTextAsOneLine()}:void 0};this.isInput=!!e.type,this.isInput||(this.html=this.parseHTML(t.value||f.Z.TextSpace)),e.buttonText&&(t.isLoading=!1),this.createObservables(t)}},{key:"onMount",value:function(){this.updateHTML(this.state.value,!1),this.props.focused&&(this.focus(),this.props.selectAll?this.selectAll():this.selectEnd())}},{key:"onUnmount",value:function(){this.isFocused.get()&&this.onBlur()}},{key:"componentWillReceiveProps",value:function(e){this.state.item!==e.item&&e.item&&this.item.set(e.item?{item:e.item,text:e.item.getStyledTextAsOneLine()}:void 0),this.props.value===e.value||e.value===this.state.value||e.noUpdateValueWhileFocused&&this.state.isFocused||(this.setValue(e.value,this.isFocused.get()),this.forceUpdate()),this.props.tokens!==e.tokens&&e.tokens!==this.state.tokens&&this.tokens.set(e.tokens)}},{key:"componentDidUpdate",value:function(e){var t=this._isDirty;if(this._isDirty=void 0,t&&this._dirtyCallbacks){for(var n=0,r=0;r<this._dirtyCallbacks.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this._dirtyCallbacks[r]()}this._dirtyCallbacks=void 0}this.props.autocompleteItem!==e.autocompleteItem&&this.updateAutocomplete()}},{key:"clearValue",value:function(){this.setValue("")}},{key:"clearTokens",value:function(){this.tokens.clear()}},{key:"isButtonEnabled",value:function(){return void 0!==this.props.buttonEnabled?this.props.buttonEnabled:this.state.value||this.state.tokens.length>0}},{key:"getValue",value:function(){return this.value.get()}},{key:"getTokens",value:function(){var e=this.getValue().trim(),t=this.tokens.get();return e?t.concat([{text:e,email:e,type:"contact"}]):t}},{key:"getItem",value:function(){return this.state.item}},{key:"parseHTML",value:function(e){var t;if(this.props.parse){var n=w.Z.parseTextNew(void 0,e,Z.Z.getContacts(),!0);this.parsedEls=n.elsNew;var r=e.match(/(^#|[\(\s]#)([^\s\),#]+)/g);r&&(r=r.map((function(e){return e.trim().slice(1)}))),this.tags=n.tags=r,this.contacts=n.contacts,this.props.onParsed&&this.props.onParsed(n),t=y.default.ElementRenderer.renderNew(n.elsNew.elements,void 0,void 0,{convertSpaces:!0,noFormat:!0,showMarkdown:!0})}else t=e&&g.Z.escape(e).replace(/ /g,"&nbsp;");return t}},{key:"addDirtyCallback",value:function(e){this._dirtyCallbacks||(this._dirtyCallbacks=[]),this._dirtyCallbacks.push(e)}},{key:"focus",value:function(){this._isDirty?this.addDirtyCallback(this.focus):this.refs.input.focus()}},{key:"blur",value:function(){this.refs.input.blur()}},{key:"select",value:function(){k.Z.selectElement(this.refs.input)}},{key:"selectEnd",value:function(e){if(!e&&this._isDirty)this.addDirtyCallback(this.selectEnd);else{var t=this.refs.input.textContent;t.length>0&&t!==f.Z.TextSpace&&k.Z.selectElement(this.refs.input,t.length)}}},{key:"selectAll",value:function(e){if(!e&&this._isDirty)this.addDirtyCallback(this.selectAll);else{var t=this.refs.input.textContent;t.length>0&&t!==f.Z.TextSpace&&k.Z.selectElement(this.refs.input,0,t.length)}}},{key:"handleCut",value:function(e){var t=this.getSelectionOffsets();if(t.start===t.end){var n=m.Z.ie?"Text":"text/plain",r=e&&e.clipboardData?e.clipboardData:window.clipboardData,i=this.getValue();r.setData(n,i),this.clearValue(),this.onInput(),g.Z.preventDefault(e),g.Z.stopPropagation(e)}}},{key:"_getHotkeys",value:function(e){var t=[y.default.hotkeys.create(f.Z.KeyCode.L,!0,f.Z.Primary.No,f.Z.Shift.Either,this.selectAll)];return m.Z.app&&t.push(y.default.hotkeys.create(f.Z.KeyCode.L,!0,f.Z.Primary.Yes,f.Z.Shift.Either,this.selectAll)),e&&t.push(y.default.hotkeys.create(f.Z.KeyCode.Escape,!0,f.Z.Primary.Either,f.Z.Shift.Either,this.handleEscapeKey)),t}},{key:"onFocus",value:function(e){this.props.autocompleteMode&&_.Z.clearDisabled(),this.props.autocompleteOnClick&&this.updateAutocomplete(),this.isFocused.set(!0),this.___hotkeys=y.default.hotkeys.pushStack(this._getHotkeys(!!this.props.onEscape||this.props.blurOnEscape)),this.refs.input.addEventListener("cut",this.handleCut,!0),this.props.onFocus&&this.props.onFocus(e)}},{key:"onBlur",value:function(e){this.isButtonMouseDown?this.refs.input.focus():(this.isFocused.set(!1),this.___hotkeys&&(y.default.hotkeys.popStack(this.___hotkeys),this.___hotkeys=void 0),this.refs.input.removeEventListener("cut",this.handleCut,!0),this.props.onBlur&&this.props.onBlur(e))}},{key:"getSelectionOffset",value:function(){return this.getSelectionOffsets().end}},{key:"getSelectionOffsets",value:function(){var e=k.Z.getSelectionRangeNative(),t={start:0,end:0};return e&&(t=k.Z.getSelectOffsetsInElement(this.refs.input,e)),t}},{key:"_setSelectionOffset",value:function(e){var t,n;if(e>0){var r=k.Z.getOffsetChildElement(this.refs.input,e);r&&(t=r.element,n=r.offset)}else t=this.refs.input,n=0;if(t){var i=k.Z.createFakeRange(t,n,t,n);try{g.Z.PAssert(238,i,"Range should be valid when setting selection offset")}catch(a){g.Z.reportError(a)}i&&k.Z.setSelectionRange(i)}}},{key:"setSelectionOffset",value:function(e){this._setSelectionOffset(e)}},{key:"updateAutocomplete",value:function(e){var t=this.props,n=this.refs.input,r=t.autocompleteMode;if(e=t.autocompleteItem||e||this.item.get(),r){var i=k.Z.getSelectionInElement(n);(t.autocompleteOnClick||i&&i.start===i.end)&&_.Z.update({mode:r,canAutocompleteItems:t.canAutocompleteItems,text:this.value.get(),offset:i?i.start:0,owner:this,item:e,pane:this.props.pane,parsedEls:this.parsedEls,positionOffset:t.positionOffset,elementDisplay:t.autocompleteElementDisplay||this.refs.wrapper,elementInput:n,supportSearchItemAutocomplete:t.supportSearchItemAutocomplete,noShow:t.noShowAutocomplete,showNoMatches:t.autocompleteOnClick,canAutocompleteLinkedItems:!1})}}},{key:"setValue",value:function(e,t,n){this._isDirty=!0;try{g.Z.PAssert(239,void 0!==e,"Should not set FancyInput value to undefined")}catch(r){g.Z.reportError(r)}e=e||"",this.updateHTML(e,t,n),this.value.set(e)}},{key:"updateHTML",value:function(e,t,n){var r=n;t&&void 0===r&&(r=this.getSelectionOffset());var i=this.parseHTML(e||f.Z.TextSpace);i!==this.refs.input.innerHTML&&(this.refs.input.innerHTML=i),t&&(r>e.length&&(r=e.length),this.setSelectionOffset(r))}},{key:"addToken",value:function(e){this.tokens.push(e);var t=this.refs.inner;t.scrollWidth>t.clientWidth&&(t.scrollLeft=t.scrollWidth-t.clientWidth)}},{key:"updateTokens",value:function(e){for(var t=0,n=g.Z.parseTokensFromText(this.value.get()),r="",i=0;i<n.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=n[i];"contact"===a.type?this.addToken(a):r+=a.text}this.setValue(r,!0)}},{key:"onChange",value:function(){var e,t,n=this.refs.input.value;(this.value.set(n),"password"!==this.props.type)&&(null===(e=(t=this.props).onChange)||void 0===e||e.call(t,n,this.item.get()))}},{key:"onInput",value:function(){if(!this.isComposing.get()){var e=this.refs.input.textContent.replace(/\u00a0/g," ").replace(new RegExp(f.Z.TextSpace,"g"),"").replace(/\n/g,""),t=this.props.validator;this.setValue(e,!0),this.updateAutocomplete(),!t||t(e)?(this.validationError.set(!1),this.props.onChange&&this.props.onChange(e,this.item.get())):this.validationError.set(!0)}}},{key:"handleEscapeKey",value:function(){this.props.onEscape?this.props.onEscape():this.isInput||this.select(),this.__hotkeyEscape&&(y.default.hotkeys.popStack(this.handleEscapeKey),this.__hotkeyEscape=void 0),this.props.blurOnEscape&&this.refs.input.blur()}},{key:"onMouseDown",value:function(e){e.stopPropagation(),this.props.onMouseDown&&this.props.onMouseDown(e)}},{key:"onKeyDown",value:function(e){var t=this.props;this.isInput||(t.autocompleteMode&&_.Z.isShowing()||t.buttonText&&(e.keyCode!==f.Z.KeyCode.Enter||t.onEnter||this.onButtonClick(e)),e.keyCode===f.Z.KeyCode.Backspace&&(!this.state.value&&this.state.tokens.length>0&&this.removeToken(this.tokens.length()-1),0===this.refs.input.textContent.length&&(this.refs.input.textContent=f.Z.TextSpace)),e.keyCode===f.Z.KeyCode.Tab&&_.Z.isShowing()&&_.Z.hide()),e.keyCode===f.Z.KeyCode.Enter&&(t.onEnter&&t.onEnter(e),e.preventDefault()),t.onKeyDown&&t.onKeyDown(e)}},{key:"onKeyUp",value:function(e){var t=this.props;!this.isInput&&t.autocompleteMode&&(e.keyCode!==f.Z.KeyCode.ArrowLeft&&e.keyCode!==f.Z.KeyCode.ArrowRight||this.updateAutocomplete()),"email"===t.autocompleteMode&&(e.keyCode===f.Z.KeyCode.Comma?this.updateTokens(!1):e.keyCode===f.Z.KeyCode.Enter&&this.updateTokens(!0)),t.onKeyUp&&t.onKeyUp(e)}},{key:"onCompositionStart",value:function(){this.isComposing.set(!0)}},{key:"onCompositionEnd",value:function(e){this.isComposing.set(!1),this.onInput()}},{key:"onAutocompleteSelected",value:function(e){var t=this.props;e.item&&t.isSearch?t.onAutocompleteSelected(e):(e.item&&this.item.set({item:e.item,text:e.item.getStyledTextAsOneLine()}),void 0!==e.value&&(this.setValue(e.value,!0,e.offset),t.onChange&&t.onChange(e.value,this.item.get())),e.token&&(this.addToken(e.token),this.setValue("",!0)),t.onAutocompleteSelected&&t.onAutocompleteSelected(e))}},{key:"onButtonMouseDown",value:function(){this.isButtonMouseDown=!0}},{key:"onButtonMouseUp",value:function(){this.isButtonMouseDown=!1}},{key:"onButtonClick",value:function(e){var t=this.state;if(this.isButtonEnabled()){if(this.props.onButtonClick)this.props.onButtonClick(t.value,this.onButtonClickCallback,e)&&this.isLoading.set(!0);_.Z.isShowing()&&_.Z.hide()}}},{key:"onButtonClickCallback",value:function(){this.value.set(""),this.isLoading.set(!1)}},{key:"removeToken",value:function(e){var t=this.props,n=this.tokens.get()[e];this.tokens.removeAt(e),t.onChange&&t.onChange(this.getValue(),this.item.get()),t.onTokenRemoved&&t.onTokenRemoved(n)}},{key:"removeItem",value:function(){this.item.set(void 0),this.props.onChange&&this.props.onChange(this.getValue(),this.item.get())}},{key:"render",value:function(){var e,t,n=this.state,r=this.props,i=r.margin||{},a=r.padding||{};isNaN(a.left)&&(a.left=8),isNaN(a.right)&&(a.right=8);var o,s=!1!==r.border,c=s?2:0,l=g.Z.classNames("fancyInput",{disabled:r.disabled},{focused:n.isFocused},{hasFloatingText:!!r.floatingText},{hasButton:!!r.buttonText},{hasBorder:s},this.props.className),u=r.height||40,d=(u-40)/2,h=g.Z.extend({width:r.width,maxWidth:r.maxWidth,height:u,display:r.display,fontSize:r.fontSize},r.style);if(r.floatingText)a.bottom=5+Math.min(d,2),a.top=u-16-a.bottom;else{var y=(u-c-16)/2;a.top=y,a.bottom=y}if(r.floatingText){var k={marginBottom:5+d,marginLeft:a.left,marginRight:a.right};n.isFocused||n.value?n.isFocused?k.color=g.Z.colorBlue:k.color="#ccc":k.color="#aaa";var _=g.Z.classNames("placeholder c-foreground-super-faded z-1","noSelect",{floating:n.isFocused||n.value||n.tokens.length>0});e=v.createElement("div",{className:_,style:k},r.floatingText)}else if(r.placeholder&&!this.isInput&&!n.value&&!n.isComposing&&0===n.tokens.length&&!n.item){var Z={paddingTop:a.top,marginLeft:a.left,marginRight:a.right};e=v.createElement("div",{className:"placeholder c-foreground-very-faded noSelect",style:Z},r.placeholder)}if(!1!==r.underline){var w={};n.isFocused&&!n.item?w[m.Z.transform.react]="":w[m.Z.transform.react]="scale(0,1)",t=v.createElement(p.E.div,{className:"focusUnderline",initial:{scaleX:0,scaleY:1},animate:{scaleX:n.isFocused&&!n.item?1:0},transition:f.Z.TransitionSpring7})}if(r.buttonText){var b=g.Z.classNames("fancyInputButton c-button-raised-primary",{loading:n.isLoading},{disabled:!this.isButtonEnabled()}),P={width:r.buttonWidth,lineHeight:u+"px"};o=v.createElement("span",{className:b,style:P,onMouseDown:this.onButtonMouseDown,onClick:this.onButtonClick,onMouseUp:this.onButtonMouseUp},r.buttonText)}var S,D={paddingLeft:a.left,paddingRight:a.right,marginLeft:i.left,marginRight:i.right},I={ref:"input",className:"fancyInputInput",style:Object.assign({paddingTop:a.top,paddingBottom:a.bottom},r.inputStyle),onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onMouseDown:this.onMouseDown,autoComplete:"false",tabIndex:r.tabIndex,disabled:n.isLoading};this.isInput?(I.type=r.type,I.placeholder=r.placeholder,I.onChange=this.onChange,I.autoComplete=r.autoComplete,I.value=n.value,S=v.createElement("input",I)):(I.onInput=this.onInput,I.contentEditable=r.readonly||n.item?null:"true",I.onCompositionStart=this.onCompositionStart,I.onCompositionEnd=this.onCompositionEnd,S=v.createElement("div",I));var E=[];if(n.tokens)for(var x=0,C=0;C<n.tokens.length;C++){if(x++>5e3&&__infLoop&&__infLoop(x))throw new RangeError;var A=n.tokens[C],L={marginTop:a.top-4,paddingLeft:r.padding&&!isNaN(r.padding.left)?r.padding.left:8};E.push(v.createElement("div",{key:"token"+C,className:"token c-button-raised c-border",style:L},v.createElement("span",{dangerouslySetInnerHTML:{__html:A.text}}),v.createElement("i",{className:"icon-close c-button",onClick:this.removeToken.bind(this,C)})))}if(n.item){var M={lineHeight:u+"px",marginTop:0,paddingLeft:r.padding&&!isNaN(r.padding.left)?r.padding.left:8};E.push(v.createElement("div",{key:"tokenItem",className:"token flexbox",style:M},v.createElement("span",{className:"f1",dangerouslySetInnerHTML:{__html:n.item.text}}),v.createElement("i",{className:"icon-close c-button",onClick:this.removeItem})))}var T=g.Z.classNames("fancyInputWrap c-foreground font-normal",n.validationError?"c-border-red":"c-border-heavy",r.backgroundTheme,{"c-background":!r.backgroundTheme&&!r.noBackground},{hasTokens:E.length>0},{hasItem:n.item});return v.createElement("div",{className:l,id:this.props.id,style:h,onClick:this.props.onClick},v.createElement("div",{className:"fancyInputContent"},v.createElement("div",{className:T,ref:"wrapper"},e,v.createElement("div",{className:"fancyInputInner",style:D,ref:"inner"},E,v.createElement("div",{className:"fancyInputInner2"},S)),t),o))}}]),n}(n(404).a)},5097:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(8651),i=n(9955),a=n(3234),o=n(3470),s={start:{transition:{staggerChildren:.2}},end:{transition:{staggerChildren:.2}}},c={start:{y:"50%"},end:{y:"150%"}},l={duration:.5,yoyo:1/0,ease:"easeInOut"};const u=(0,a.Z)((function(e){var t=e.color,n=e.size,r={width:4*(n=n||8),height:3*n,display:"flex",justifyContent:"space-around"},a={display:"block",width:n,height:n,backgroundColor:t||"#777",borderRadius:"50%"};return i.createElement(o.E.div,{style:r,variants:s,initial:"start",animate:"end"},i.createElement(o.E.span,{style:a,variants:c,transition:l}),i.createElement(o.E.span,{style:a,variants:c,transition:l}),i.createElement(o.E.span,{style:a,variants:c,transition:l}))})),d=(0,a.Z)((function(e){var t=e.className,n=e.style,a=e.size,o=e.left,s=e.top,c=e.center,l=e.inline,d=e.color,h=e.children;n=Object.assign({},n),(s||o)&&(n.position="absolute",n.left=o||"50%",n.top=s||"50%");var p=r.Z.classNames("fancyLoader c-foreground-light flex flex-col items-center justify-center",t,{"absolute inset-0":c},{"relative inline":l}),f=r.Z.classNames("fancyLoaderText",{"pt-4":!l}),g={color:d};return i.createElement("div",{className:p,style:n},i.createElement(u,{color:d,size:a}),h&&i.createElement("div",{className:f,style:g},h))}))},1399:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var r=n(7154),i=n.n(r),a=n(6479),o=n.n(a),s=n(4575),c=n.n(s),l=n(3913),u=n.n(l),d=n(2205),h=n.n(d),p=n(8585),f=n.n(p),g=n(9754),m=n.n(g),v=n(8651),y=n(9955),k=n(8478),_=n(404),Z=["center","onClick","enabled","ripple","onRightClick","rippleColor","className","children"];function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}const b=function(e){h()(n,e);var t=w(n);function n(){return c()(this,n),t.apply(this,arguments)}return u()(n,[{key:"init",value:function(){this.createObservables({ripples:[]}),this.rippleNum=0}},{key:"getElement",value:function(){return k.findDOMNode(this)}},{key:"onMouseDown",value:function(e){var t=this.props;if(!1!==t.enabled){if(this.props.onMouseDown&&this.props.onMouseDown(e),this.props.children&&!e.defaultPrevented&&!1!==t.ripple){var n,r,i=this.refs.element,a=i.offsetWidth,o=i.offsetHeight,s=Math.min(a,o);if(this.props.center)n="50%",r="50%";else{var c=v.Z.offset(i);n=e.clientX-c.left,r=e.clientY-c.top}var l={id:this.rippleNum++,left:n,top:r,width:s,height:s};this.ripples.push(l),setTimeout(this.removeRipple,1e3)}e.stopPropagation()}}},{key:"onRightClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.onRightClick(e)}},{key:"removeRipple",value:function(){this.ripples.removeAt(0)}},{key:"render",value:function(){for(var e=0,t=this.state,n=this.props,r=n.center,a=n.onClick,s=(n.enabled,n.ripple,n.onRightClick),c=n.rippleColor,l=n.className,u=n.children,d=o()(n,Z),h=[],p=0;p<t.ripples.length;p++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var f=t.ripples[p],g={left:f.left,top:f.top,width:f.width,height:f.height,marginLeft:-f.width/2,marginTop:-f.height/2},m=v.Z.classNames("fancyRipple",c||"defaultColor");h.push(y.createElement("div",{key:"ripple_"+f.id,className:m,style:g}))}var k=v.Z.classNames(l,"fancyRippler",{rippleCenter:r});return y.createElement("div",i()({},d,{className:k,onMouseDown:this.onMouseDown,onClick:a,onContextMenu:s?this.onRightClick:void 0,ref:"element"}),u,h.length>0&&y.createElement("div",{className:"fancyRipples"},h))}}]),n}(_.a)},3479:(e,t,n)=>{"use strict";n.d(t,{Z:()=>P});var r=n(7154),i=n.n(r),a=n(6479),o=n.n(a),s=n(4575),c=n.n(s),l=n(3913),u=n.n(l),d=n(2205),h=n.n(d),p=n(8585),f=n.n(p),g=n(9754),m=n.n(g),v=n(8651),y=n(8855),k=n(7100),_=n(9955),Z=n(404),w=["getScrollSize","getClientHeight","getScrollTop","noOwnScroll","showScrollbars","trackHasScrolled","scrollable","orientation","tinyMode","onScroll"];function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}const P=function(e){h()(n,e);var t=b(n);function n(){return c()(this,n),t.apply(this,arguments)}return u()(n,[{key:"init",value:function(){var e=this.props;this.thumbExtraHeight=0;try{v.Z.PAssert(916,!(e.noOwnScroll&&e.onScroll),"FancyScroller can not have onScroll prop if it does not own its own scroll")}catch(n){v.Z.reportError(n)}var t={isVisible:!1,isDragging:!1,thumbTop:0,thumbHeight:0};this.props.trackHasScrolled&&(t.hasScrolled=!1),this.createObservables(t)}},{key:"onMount",value:function(){this.refs.thumb&&v.Z.setupClick(this.refs.thumb,this,{onStart:this.onTapThumbStart,onMove:this.onTapThumbMove,onEnd:this.onTapThumbEnd})}},{key:"onUnmount",value:function(){this.timeoutShow&&(clearTimeout(this.timeoutShow),this.timeoutShow=void 0),this.timeoutHide&&(clearTimeout(this.timeoutHide),this.timeoutHide=void 0)}},{key:"getScrollSize",value:function(){var e=this.props.orientation!==y.Z.Orientation.Horizontal?"Height":"Width";return this.props.getScrollSize?this.props.getScrollSize():this.refs.scroller["scroll"+e]}},{key:"getClientHeight",value:function(){var e=this.props.orientation!==y.Z.Orientation.Horizontal?"Height":"Width";return this.props.getClientHeight?this.props.getClientHeight():this.refs.scroller["client"+e]}},{key:"getScrollTop",value:function(){var e=this.props.orientation!==y.Z.Orientation.Horizontal?"Top":"Left";return this.props.getScrollTop?this.props.getScrollTop():this.refs.scroller["scroll"+e]}},{key:"calculateThumb",value:function(){this.props;var e,t=this.getScrollSize(),n=this.getClientHeight(),r=this.getScrollTop(),i=this.props.thumbHeight;(i||(t===n?i=n:(i=n/t*n,this.thumbExtraHeight=i<30?30-i:0,i=Math.floor(Math.max(i,30)))),t===n)?e=0:e=r/(t-n)*(n-i);e=Math.floor(e);var a=i!==this.thumbHeight.get()||e!==this.thumbTop.get();this.thumbHeight.set(i,!1),this.thumbTop.set(e,a)}},{key:"onScroll",value:function(e){this.handleScroll(),this.props.onScroll&&this.props.onScroll(e)}},{key:"handleScroll",value:function(){this.isMouseDown||(this.calculateThumb(),this.isVisible.set(!0),this.hideTimeout()),this.props.trackHasScrolled&&this.hasScrolled.set(this.getScrollTop()>0)}},{key:"onMouseMove",value:function(e){this.timeoutHide&&(clearTimeout(this.timeoutHide),this.timeoutHide=void 0)}},{key:"onMouseEnter",value:function(e){var t=this.refs.scroller;t.scrollHeight>t.clientHeight&&(this.timeoutShow&&clearTimeout(this.timeoutShow),this.timeoutShow=setTimeout(this.showScrollbar,100))}},{key:"onMouseLeave",value:function(e){this.timeoutShow&&(clearTimeout(this.timeoutShow),this.timeoutShow=void 0),this.isMouseDown||this.hideTimeout()}},{key:"onTapThumbStart",value:function(e){e.button===y.Z.ButtonCode.Left&&(this.isMouseDown=!0,this.lastY=this.props.orientation===y.Z.Orientation.Horizontal?e.clientX:e.clientY,v.Z.disableMouseMove=!0,this.isDragging.set(!0)),e.stopPropagation()}},{key:"onTapThumbMove",value:function(e){if(this.isMouseDown){var t=this.refs.scroller,n=this.props.orientation===y.Z.Orientation.Horizontal,r=n?e.clientX:e.clientY,i=n?"Left":"Top",a=n?"Width":"Height",o=r-this.lastY;this.lastY=r;var s=v.Z.clamp(this.thumbTop.get()+o,0,t["client"+a]-this.thumbHeight.get());this.thumbTop.set(s);var c=s/(t["client"+a]-this.thumbExtraHeight)*t["scroll"+a];t["scroll"+i]=c,v.Z.preventDefault(e)}}},{key:"onTapThumbEnd",value:function(e){this.isMouseDown&&e.button===y.Z.ButtonCode.Left&&(this.isMouseDown=!1,v.Z.disableMouseMove=!1,this.isDragging.set(!1),this.hideTimeout())}},{key:"hideTimeout",value:function(){this.timeoutHide&&clearTimeout(this.timeoutHide),this.timeoutHide=setTimeout(this.hideScrollbar,500)}},{key:"hideScrollbar",value:function(){this.isVisible.set(!1),this.timeoutHide=void 0}},{key:"showScrollbar",value:function(){this.calculateThumb(),this.isVisible.set(!0),this.timeoutShow=void 0}},{key:"getElement",value:function(){return this.refs.element}},{key:"getScrollElement",value:function(){return this.refs.scroller}},{key:"scrollTo",value:function(e,t,n){v.Z.scrollTo(e,t,n,this.refs.scroller)}},{key:"scrollToBottom",value:function(){var e=this.getClientHeight();this.scrollTo(0,e)}},{key:"render",value:function(){var e=this.state,t=this.props,n=(t.getScrollSize,t.getClientHeight,t.getScrollTop,t.noOwnScroll),r=t.showScrollbars,a=(t.trackHasScrolled,t.scrollable),s=(t.orientation,t.tinyMode),c=(t.onScroll,o()(t,w)),l=t.orientation===y.Z.Orientation.Horizontal,u=!1!==a&&!v.Z.noScrollbars,d=v.Z.classNames("fancyScroller flexbox",t.className,{"flexvert horizontal":l},{vertical:!l},{trackHasScrolled:t.trackHasScrolled},{scrolled:e.hasScrolled},{tinyMode:s}),h=v.Z.classNames("fancyScrollbar",{"visible c-border":e.isVisible},{dragging:e.isDragging}),p=v.Z.classNames("fancyScrollbarThumb c-bg-scrollthumb",{dragging:e.isDragging}),f={};l?(f.width=e.thumbHeight,f[k.Z.transform.react]="translate3d("+e.thumbTop+"px,0,0)"):(f.height=e.thumbHeight,f[k.Z.transform.react]="translate3d(0,"+e.thumbTop+"px,0)");var g=v.Z.classNames("fancyScrollContent",{hideScrollbar:void 0!==t.showScrollbars},{scrollable:u}),m={};return m[t.orientation===y.Z.Orientation.Horizontal?"overflowX":"overflowY"]="auto",_.createElement("div",i()({},c,{className:d,ref:"element"}),_.createElement("div",{className:g,style:m,ref:"scroller",onScroll:n?void 0:this.onScroll,"data-moo-id":this.getUniqueID()},t.children),!k.Z.isFirefox&&u&&r&&_.createElement("div",{className:h,ref:"scrollbar",onMouseMove:this.onMouseMove,onMouseEnter:this.props.tinyMode?void 0:this.onMouseEnter,onMouseLeave:this.props.tinyMode?void 0:this.onMouseLeave},_.createElement("div",{className:p,style:f,ref:"thumb"})))}}]),n}(Z.a)},5441:(e,t,n)=>{"use strict";n.d(t,{Z:()=>j});var r,i=n(9713),a=n.n(i),o=n(8926),s=n.n(o),c=n(4575),l=n.n(c),u=n(3913),d=n.n(u),h=n(2205),p=n.n(h),f=n(8585),g=n.n(f),m=n(9754),v=n.n(m),y=n(3124),k=n.n(y),_=n(7757),Z=n.n(_),w=n(7411),b=n(8572),P=n(8855),S=n(6744),D=n(9514),I=n(8651),E=n(4654),x=n(5252),C=n(3017),A=n(3656),L=n(5193),M=n(7733),T=n(9603),R=n(6374),O=n(9105),F=n(1095),N=n(9352),B=n(7274);function U(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}const j=new(r=function(e){p()(n,e);var t=U(n);function n(){var e;return l()(this,n),(e=t.call(this,!0)).dataCache={settings:{},items:{},documents:{},boards:{},contacts:[],localStorage:{},user:{}},e._demoId=1,e.demoError=new B.Z,e}return d()(n,[{key:"init",value:function(e,t){var n={displayName:"Demo User",activeUser:"demoemail@moo.do",userId:"demouid"},r={};Object.keys(n).forEach((function(e){return r[E.default.settings.getSettingAbbrev(e)]={v:n[e]}})),E.default.settings.load(r,!1,!1);this.loadDemoContacts(["Jay","Grant","Ramada","Canyon Ranch","Jim Joseph","Miller Harris","Bob Johnson","Bill Wilson","Emily Edwards","Jane Johnson","Mike Thomas","Joe Lewis","Steve","Melissa","Mikey","Bart","Dad","Mom","James Rhodes","Neptures","Pepper","President Ellis","Contacts","Jane"]);var i=function(t){e(t)},a=x.Z.getURLParam("template");if(a)this.loadCloudTemplate(a,i);else{var o,s,c=null!==(o=null!==(s=x.Z.getURLParam("data"))&&void 0!==s?s:x.Z.getURLParam("demo"))&&void 0!==o?o:"demo-basic";this.loadDemoTemplate(c,i)}}},{key:"onInitTemplate",value:function(){L.Z.isLoaded.onValue(!0,(function(){E.default.PaneManager.loadInitialState(),C.Z.ensureSelected()}))}},{key:"loadCloudTemplate",value:function(){var e=s()(Z().mark((function e(t,n){var r,i,a;return Z().wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return w.Z.initializeFirebase(),e.next=3,D.Z.database().ref("templates/".concat(t)).once("value");case 3:if(r=e.sent.val())try{i=JSON.parse(r.v),a=Object.assign(r.p,i),this.loadDemoData(a,n)}catch(s){0,this.demoError.set("Error loading template: "+JSON.stringify(s))}else this.demoError.set("Error loading template. A template with this id does not exist.");case 5:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"loadDemoTemplate",value:function(e,t){var n=this,r="".concat(window.location.protocol,"//").concat(window.location.host);I.Z.XHR({type:"GET",url:"".concat(r,"/data/").concat(e.toLowerCase(),".json")}).then(function(){var e=s()(Z().mark((function e(r){var i;return Z().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(200!==r.status){e.next=5;break}return e.next=3,r.json();case 3:i=e.sent,n.loadDemoData(i,t);case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"loadDemoData",value:function(e,t){var n=this;if(e){var r=e.documents,i=e.boards,o=e.dateBasis,s=+T.Z.getToday()-o,c=r.map((function(e){var t=e.doc,r=e.items.map((function(e){var t=O.Z.itemIn(e);if(t.date){var r=F.Z.fromData(t.date);r&&!r.isRepeatDate()&&(r.getDate().addMilliseconds(s),t.date=r.toData())}return t.dateCompleted&&(t.dateCompleted+=s),t.dateCreated&&(t.dateCreated+=s),t.dateModified&&(t.dateModified+=s),n.dataCache.items[t.id]=t,t}));R.Z.createItemHierarchy(r,S.Z.getItemsMap());var i=n.getItemData(t.root),o={id:t.id,text:t.text,acl:a()({},w.Z.getUid(),{e:w.Z.getAccountEmail(),t:w.Z.getAccountName(),r:P.Z.DocumentAccessRoles.Admin}),backing:n,rootData:i},c=N.Z.fromData(o,n);return c.createVMLIs(),c})),l=I.Z.isDemoMode()&&x.Z.getURLParam("panes");if(l&&c[0]){var u={id:L.Z.generateID(),name:"My Board",index:"0",panes:this.loadDemoPanesFromHash(l,c[0].id)};this.dataCache.boards=a()({},u.id,u)}else this.dataCache.boards=i;t(c),this.onInitTemplate()}}},{key:"loadDemoPanesFromHash",value:function(e,t){for(var n=0,r=e.split(","),i=[],a=0;a<r.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=r[a].split(":");if("help"===o[0])E.default.intro.showHelp();else{var s=o[0],c={id:L.Z.generateID(),document:t};if("1"===s||"Outline"===s?(s=P.Z.PaneMode.Task,c.viewState={viewMode:"Outline"}):"2"!==s&&"Calendar"!==s||(s=P.Z.PaneMode.Task,c.viewState={viewMode:"Calendar_Week"}),c.type=s,o.length>1){if(o[1]){for(var l=0,u={text:o[1]},d=o[1].split(" "),h=0;h<d.length;h++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var p=!1,f="-"===d[h][0],g=d[h].replace("-","");if(g.indexOf("//")>=0)p=!0,u.complete=f?-1:1;else if(g.indexOf("*")>=0)p=!0,u.starred=f?-1:1;else if(g.indexOf("!")>=0){p=!0;var m=void 0;3===g.length?m=P.Z.VMLIFlag.P1:2===g.length?m=P.Z.VMLIFlag.P2:1===g.length&&(m=P.Z.VMLIFlag.P3),u.priority=m}p&&(u.text=u.text.replace(d[h],""))}c.search=u}o[2]&&(c.item=o[2])}i.push(c)}}return i}},{key:"loadDemoContacts",value:function(e){var t=0,n=e.map((function(e){return{id:"contact_"+t++,name:e,isDemo:!0,emails:[{address:"test-"+e.split(" ")[0].toLowerCase()+"@moo.do",primary:!0}],phoneNumbers:[{number:"(555) 123-4567",type:"mobile"}]}}));A.Z.loadContacts(n)}},{key:"getItemData",value:function(e){return this.dataCache.items[e]}},{key:"saveItem",value:function(e,t,n,r,i){var a=this.dataCache.items[t.id];if(a)Object.assign(a,n);else{var o=t.getFullSaveData(),s=t.getItems().map((function(e){return e.getFullSaveData()}));a=Object.assign(o,{items:s})}return this.dataCache.items[t.id]=a,Promise.resolve()}},{key:"deleteItem",value:function(e,t,n){var r=t.parent();this.saveItem(e,r,void 0,P.Z.ChangeType.Local,P.Z.SaveFlag.Prop),delete this.dataCache.items[t.id]}},{key:"addItem",value:function(e,t){this.saveItem(e,t.parent(),void 0,P.Z.ChangeType.Local,P.Z.SaveFlag.Prop),this.saveItem(e,t,void 0,P.Z.ChangeType.Local,P.Z.SaveFlag.Prop)}},{key:"moveItem",value:function(e,t){var n=e.getDocumentOwner();this.saveItem(n,e,void 0,P.Z.ChangeType.Local,P.Z.SaveFlag.Prop)}},{key:"setNote",value:function(e,t,n,r,i){this.saveItem(e,t,void 0,P.Z.ChangeType.Local,P.Z.SaveFlag.Prop),n?this.saveItem(e,n,void 0,P.Z.ChangeType.Local,P.Z.SaveFlag.Prop):r&&delete this.dataCache.items[r.id]}},{key:"addDocument",value:function(e){var t=e.getRootItem();return this.documents[e.id]=e,this.saveItem(e,t,void 0,P.Z.ChangeType.Local,P.Z.SaveFlag.Prop)}},{key:"saveDocument",value:function(e){}},{key:"moveItemDocument",value:function(e,t){}},{key:"deleteDocument",value:function(e){}},{key:"undeleteDocument",value:function(e){}},{key:"unlistenDocument",value:function(e){}},{key:"getSetting",value:function(e){return""}},{key:"setSetting",value:function(e,t){}},{key:"saveBoard",value:function(e){}},{key:"deleteBoard",value:function(e){}},{key:"getBoards",value:function(){return this.dataCache.boards}},{key:"clearAllData",value:function(){var e=s()(Z().mark((function e(){return Z().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"generateId",value:function(){return"id_"+this._demoId++}}]),n}(M.n),k()(r.prototype,"onInitTemplate",[b.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onInitTemplate"),r.prototype),k()(r.prototype,"generateId",[b.ZP],Object.getOwnPropertyDescriptor(r.prototype,"generateId"),r.prototype),r)},6744:(e,t,n)=>{"use strict";n.d(t,{Z:()=>N});var r,i=n(8926),a=n.n(i),o=n(9713),s=n.n(o),c=n(4575),l=n.n(c),u=n(3913),d=n.n(u),h=n(6525),p=n.n(h),f=n(2205),g=n.n(f),m=n(8585),v=n.n(m),y=n(9754),k=n.n(y),_=n(7757),Z=n.n(_),w=n(8651),b=n(3124),P=n.n(b),S=n(4654),D=n(7411),I=n(8572),E=n(8855),x=n(7100),C=n(9105),A=n(9352),L=n(3656);const M=(r=function(){function e(){l()(this,e),this.documentsPreloaded=[],this.dataCache={settings:{},items:{},documents:{},boards:{},contacts:[],localStorage:{},user:{},pluginsNew:{},docsModified:{}}}return d()(e,[{key:"init",value:function(e,t){this._backing=e,this.cbOnLoad=t,this.onDataReady()}},{key:"transformFieldsDocument",value:function(e){var t=w.Z.clone(e);return w.Z.isVMLI(t.parent)&&(t.parent=t.parent.id),delete t.items,delete t.archivedItems,delete t.deletedItems,t=C.Z.documentOut(t,{forLocal:!0})}},{key:"transformFieldsItem",value:function(e){var t=w.Z.clone(e);return w.Z.isVMLI(t.parent)&&(t.parent=t.parent.id),delete t.items,delete t.noteItem,delete t.archivedItems,delete t.deletedItems,C.Z.itemOut(t)}},{key:"getItemData",value:function(e,t){return this.dataCache.items[e]}},{key:"getDocumentData",value:function(e){return this.dataCache.documents[e]}},{key:"getSetting",value:function(e){return this.dataCache.settings[e]}},{key:"getBoards",value:function(){return this.dataCache.boards}},{key:"getBoard",value:function(e){return this.dataCache.boards[e]}},{key:"getContacts",value:function(){return this.dataCache.contacts}},{key:"getDocModified",value:function(e){return this.dataCache.docsModified[e]||0}},{key:"saveDocument",value:function(e,t){var n=e.getSaveInfo();t&&(n=Object.assign(n,t)),w.Z.deepEqual(this.dataCache.documents[e.id],n,!0,["rootData"])||(this.dataCache.documents[e.id]=n,this._saveDocumentDataToDB(C.Z.documentOut(n,{forLocal:!0})))}},{key:"setSetting",value:function(e,t){this.dataCache.settings[e]=t}},{key:"saveSettings",value:function(e){Object.assign(this.dataCache.settings,e)}},{key:"saveBoard",value:function(e){this.dataCache.boards[e.id]=Object.assign(this.dataCache.boards[e.id]||{},e)}},{key:"saveContacts",value:function(e,t){this.dataCache.contacts=e}},{key:"clearContacts",value:function(){this.dataCache.contacts=[]}},{key:"cacheItem",value:function(e){this.dataCache.items[e.id]=e}},{key:"saveItem",value:function(e,t,n){t||delete e.dateModified;var r=this.dataCache.items[e.id];if(r)e.docId=e.docId||r.docId,e.docId||n&&(e.docId=n.getDocumentOwner().id),Object.assign(r,e);else if(n){var i=n.getFullSaveData(),a=n.getItems().map((function(e){return e.getFullSaveData()}));r=Object.assign(i,{items:a})}else 0;try{w.Z.PAssert(69,r.id,"Saved item must have id")}catch(c){w.Z.reportError(c)}try{w.Z.PAssert(70,r.isDeleted||r.isRoot||r.parent,"Saved item must have parent or be root")}catch(c){w.Z.reportError(c)}try{w.Z.PAssert(71,r.docId,"Saved item must have docId")}catch(c){w.Z.reportError(c)}if((!r.docId||!r.isRoot&&!r.parent)&&n){var o=n.getItems().map((function(e){return e.getFullSaveData()}));r=Object.assign(n.getFullSaveData(),{items:o},e);try{w.Z.PAssert(72,r.isRoot||r.parent,"Saved item had root or parent overridden")}catch(c){w.Z.reportError(c)}try{w.Z.PAssert(73,r.docId,"Saved item had docId overridden")}catch(c){w.Z.reportError(c)}}this.dataCache.items[r.id]=r;var s=this.transformFieldsItem(r);this._saveItemDataToDB(s)}},{key:"deleteItem",value:function(e){var t=this.dataCache.items[e.id];if(t){this.dataCache.items[t.id].isDeleted=!0,t.isDeleted=!0;var n=this.transformFieldsItem(t);this._saveItemDataToDB(n)}else{0,e.isDeleted=!0;var r=this.transformFieldsItem(e);this._saveItemDataToDB(r)}}},{key:"deleteBoard",value:function(e){delete this.dataCache.boards[e]}},{key:"deleteDocument",value:function(e){var t=this;e.getAllItems().forEach((function(e){delete t.dataCache.items[e.id]})),delete this.dataCache.documents[e.id]}},{key:"deleteSettings",value:function(e){var t=this;Object.keys(e).forEach((function(e){delete t.dataCache.settings[e]}))}},{key:"clearAllData",value:function(){var e=a()(Z().mark((function e(){return Z().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"ensureMirror",value:function(){var e=a()(Z().mark((function e(t,n){var r,i,a,o,s,c,l,u,d,h,p,f=0,g=arguments;return Z().wrap((function(e){for(var m=0;;){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;switch(e.prev=e.next){case 0:r=g.length>2&&void 0!==g[2]&&g[2],i=[],a=[],o=!this.TEST_DOC_ID,s=t.length>0&&!!t[0].id,c=0;case 7:if(!(c<t.length)){e.next=17;break}if(!(f++>5e3&&__infLoop&&__infLoop(f))){e.next=10;break}throw new RangeError;case 10:if(l=s?t[c]:t[c].value,u=s?"load":t[c].type,d=this.dataCache.items[l.id],"Removed"===u)a.push(l.id);else if(!d||!this.areObjectsEqual(l,d)){r&&!o&&console.log("THIS IS BAD, document mismatch"),d&&d.docId!==l.docId&&(h=d.isDeleted&&l.isDeleted,l=d.dateModified>l.dateModified&&!d.isDeleted?Object.assign(l,d):Object.assign(d,l),h||delete l.isDeleted,d=void 0),p=Object.assign(d||{},l),n&&delete p.pendingSync;try{w.Z.PAssert(74,p.id,"Saved item must have id")}catch(v){w.Z.reportError(v)}try{w.Z.PAssert(75,p.isDeleted||p.isRoot||p.parent,"Saved item must have parent or be root")}catch(v){w.Z.reportError(v)}try{w.Z.PAssert(76,p.docId,"Saved item must have docId")}catch(v){w.Z.reportError(v)}void 0!==p.text&&p.date&&!p.text.includes(E.Z.CharDate)&&delete p.date,this.dataCache.items[l.id]=p,i.push(p)}case 14:c++,e.next=7;break;case 17:return e.abrupt("return",this.bulkSave(i,a));case 18:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"areObjectsEqual",value:function(e,t){return delete(t=Object.assign({},t)).items,delete t.archivedItems,delete t.deletedItems,delete(e=Object.assign({},e)).items,delete e.archivedItems,delete e.deletedItems,e.parent===t.parent&&(delete e.parent,delete t.parent,w.Z.deepEqual(e,t))}},{key:"onDataReady",value:function(){this.dataCache.settings&&S.default.settings.load(this.dataCache.settings,!1,!1),this.dataCache.contacts&&L.Z.loadContacts(),this.fireLocalLoaded()}},{key:"fireLocalLoaded",value:function(){var e=this;D.Z.onActiveUser((function(){try{w.Z.PAssert(77,e.dataCache.documents,"Must be documents in cache at this point")}catch(a){w.Z.reportError(a)}if(e.dataCache.documents){var t=w.Z.objectValues(e.dataCache.documents),n=w.Z.filterWithNonMatches(t,e.checkDocHasRoot);n.fail.length>0&&(console.log("Failed docs",n.fail),n.fail.forEach((function(t){delete e.dataCache.documents[t.id]})));var r=n.match.map((function(t){var n=e.dataCache.items[t.root];t.rootData=n;var r=A.Z.fromData(t,e._backing);return r.createVMLIs(),r}));if(e.cbOnLoad){var i={documentsPending:e.dataCache.documentsPending,itemsPending:e.dataCache.itemsPending,settingsPending:e.dataCache.settingsPending,boardsPending:e.dataCache.boardsPending,isPreload:e.isPreload};e.cbOnLoad(r,i)}e.isPreload?e.documentsPreloaded=r:e.cbOnLoad=void 0}}))}},{key:"checkDocHasRoot",value:function(e){return!!this.dataCache.items[e.root]}},{key:"getLegacyLocalStorage",value:function(e){return this.dataCache.localStorage[e]}},{key:"setLegacyLocalStorage",value:function(e,t){this.dataCache.localStorage[e]=t}},{key:"deleteLegacyLocalStorage",value:function(e){delete this.dataCache.localStorage[e]}},{key:"getValue",value:function(e){return this.dataCache.localStorage[e]}},{key:"setValue",value:function(e,t){this.dataCache.localStorage[e]=t}},{key:"deleteValue",value:function(e){delete this.dataCache.localStorage[e]}},{key:"onPreload",value:function(e,t){if(e&&e.error){try{w.Z.PAssert(78,"OpenFailedError"===e.error.name,"Unknown error in Dexie",e.error)}catch(n){w.Z.reportError(n)}x.Z.blockedReason&&x.Z.blockedReason.set("Moo.do cannot run because it is unable to access data storage in your browser. This could be because you are in Private mode, you have disabled history, or your hard drive is full. Please try Moo.do in a normal browsing session or download the app.")}else{try{["Gmail","GmailMessages","plugins"].forEach((function(t){e[t]&&"string"===typeof e[t]&&(e[t]=JSON.parse(e[t]))}))}catch(r){}this.dataCache=e}t()}},{key:"saveEncryptionKey",value:function(e,t){}},{key:"bulkSave",value:function(){var e=a()(Z().mark((function e(t,n){var r,i=this;return Z().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return n&&n.length>0&&n.forEach((function(e){delete i.dataCache.items[e]})),t.forEach((function(e){i.dataCache.items[e.id]=e})),r=t.map(this.transformFieldsItem),e.abrupt("return",this._bulkSaveItems(r,n));case 5:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getItemsMap",value:function(){return this.dataCache.items}},{key:"getAllPluginsNew",value:function(){return this.dataCache.pluginsNew}},{key:"savePluginNew",value:function(e){this.dataCache.pluginsNew[e.id]=e}},{key:"getPluginNew",value:function(e){return this.dataCache.pluginsNew[e]}},{key:"deletePluginNew",value:function(e){delete this.dataCache.pluginsNew[e]}},{key:"savePluginUsage",value:function(e,t){this.dataCache.plugins[e]||(this.dataCache.plugins[e]={}),this.dataCache.plugins[e][t.id]=t}},{key:"getPluginTableUsage",value:function(e){return this.dataCache.plugins[e]}},{key:"getPluginUsage",value:function(e,t){if(this.dataCache.plugins[e])return this.dataCache.plugins[e][t]}},{key:"deletePluginUsage",value:function(e,t){this.dataCache.plugins[e]&&delete this.dataCache.plugins[e][t]}},{key:"getTableData",value:function(e){return this.dataCache[e]}},{key:"getTableValue",value:function(e,t){var n=this.getTableData(e);if(n){var r=n[t];if(void 0!==r)return r}}},{key:"setTableValue",value:function(e,t,n){var r=this.getTableData(e);r&&(r[t]=n),this.tablePut(e,n)}},{key:"ensureTableLoaded",value:function(){var e=a()(Z().mark((function e(t,n){return Z().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return n(),e.abrupt("return",!0);case 2:case"end":return e.stop()}}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"beginBatch",value:function(){}},{key:"commitBatch",value:function(){}}]),e}(),P()(r.prototype,"checkDocHasRoot",[I.ZP],Object.getOwnPropertyDescriptor(r.prototype,"checkDocHasRoot"),r.prototype),r);var T=n(6374);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=0,n=1;n<arguments.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=null!=arguments[n]?arguments[n]:{};n%2?R(Object(r),!0).forEach((function(t){s()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):R(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function F(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=k()(e);if(t){var i=k()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return v()(this,n)}}const N=new(function(e){g()(n,e);var t=F(n);function n(){var e;return l()(this,n),(e=t.call(this)).TEST_DOC_ID="",e.canWrite=!w.Z.isDemoMode(),e.clearOldDatabases(),e}return d()(n,[{key:"clearOldDatabases",value:function(){window.indexedDB&&(this.deleteDatabase("Drive"),this.deleteDatabase("GCalendar"),this.deleteDatabase("Gmail"),this.deleteDatabase("Gmail_RawCache"),this.deleteDatabase("QuickAdd"))}},{key:"deleteDatabase",value:function(e){this.canWrite&&window.indexedDB.deleteDatabase(e)}},{key:"preload",value:function(e){var t=this;if(this.canWrite){this.db=T.Z.createDB();var n=window.__preload;n?n.data?this.onPreload(n.data,e):n.worker.onmessage=function(n){t.onPreload(n.data,e)}:T.Z.load(this.db,(function(n){t.onPreload(n,e)}))}}},{key:"_saveItemDataToDB",value:function(e){this.canWrite&&this.db.items.put(e)}},{key:"_deleteItemData",value:function(e){this.canWrite&&this.db.items.delete(e)}},{key:"_saveDocumentDataToDB",value:function(e){this.canWrite&&this.db.documents.put(e)}},{key:"setSetting",value:function(e,t){p()(k()(n.prototype),"setSetting",this).call(this,e,t),this.canWrite&&(null!=t&&void 0!==t?this.db.settings.put(O({id:e},t)):this.db.settings.delete(e))}},{key:"deleteSettings",value:function(e){var t=this;p()(k()(n.prototype),"deleteSettings",this).call(this,e),this.canWrite&&Object.keys(e).forEach((function(e){return t.db.settings.delete(e)}))}},{key:"saveSettings",value:function(e){p()(k()(n.prototype),"saveSettings",this).call(this,e);var t=Object.keys(e).map((function(t){return O({id:t},e[t])}));this.canWrite&&this.db.settings.bulkPut(t)}},{key:"saveBoard",value:function(e){if(p()(k()(n.prototype),"saveBoard",this).call(this,e),this.canWrite){var t=C.Z.boardOut(e);this.db.boards.put(t)}}},{key:"deleteBoard",value:function(e){p()(k()(n.prototype),"deleteBoard",this).call(this,e),this.canWrite&&this.db.boards.delete(e)}},{key:"deleteDocument",value:function(e){var t=this;p()(k()(n.prototype),"deleteDocument",this).call(this,e),this.canWrite&&(e.getAllItems().forEach((function(e){t.db.items.delete(e.id)})),this.db.documents.delete(e.id))}},{key:"saveContacts",value:function(e,t){if(p()(k()(n.prototype),"saveContacts",this).call(this,e,t),this.canWrite){var r=t.map((function(e){return C.Z.contactOut(e)}));this.db.contacts.bulkPut(r)}}},{key:"clearContacts",value:function(){p()(k()(n.prototype),"clearContacts",this).call(this),this.canWrite&&this.db.contacts.clear()}},{key:"_bulkSaveItems",value:function(){var e=a()(Z().mark((function e(t,n){var r;return Z().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(r=[],n&&n.length>0&&r.push(this.db.items.bulkDelete(n)),t.length>0&&this.canWrite&&r.push(this.db.items.bulkPut(t)),!(r.length>0)){e.next=5;break}return e.abrupt("return",Promise.all(r));case 5:return e.abrupt("return",Promise.resolve());case 6:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getLegacyLocalStorage",value:function(e){var t=p()(k()(n.prototype),"getLegacyLocalStorage",this).call(this,e);return t||(t=localStorage.getItem(e))&&p()(k()(n.prototype),"setLegacyLocalStorage",this).call(this,e,t),t}},{key:"setLegacyLocalStorage",value:function(e,t){p()(k()(n.prototype),"setLegacyLocalStorage",this).call(this,e,t),w.Z.isString(t)||(t=JSON.stringify(t)),localStorage.setItem(e,t)}},{key:"deleteLegacyLocalStorage",value:function(e){p()(k()(n.prototype),"deleteLegacyLocalStorage",this).call(this,e),localStorage.removeItem(e)}},{key:"setValue",value:function(e,t){if(this.canWrite){var r=this.getValue(e);r===t||w.Z.deepEqual(r,t)||(p()(k()(n.prototype),"setValue",this).call(this,e,t),this.db.localStorage.put({id:e,value:t}))}}},{key:"clearAllData",value:function(){var e=a()(Z().mark((function e(){return Z().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.canWrite){e.next=3;break}return this.canWrite=!1,e.abrupt("return",Promise.all(this.db.tables.map((function(e){return e.clear()}))));case 3:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deletePluginUsage",value:function(e,t){p()(k()(n.prototype),"deletePluginUsage",this).call(this,e,t),this.canWrite&&this.db.plugins.delete(t)}},{key:"savePluginUsage",value:function(e,t){p()(k()(n.prototype),"savePluginUsage",this).call(this,e,t),this.canWrite&&this.db.plugins.put(t)}},{key:"savePluginNew",value:function(e){p()(k()(n.prototype),"savePluginNew",this).call(this,e),this.canWrite&&this.db.pluginsNew.put(e)}},{key:"deletePluginNew",value:function(e){p()(k()(n.prototype),"deletePluginNew",this).call(this,e),this.canWrite&&this.db.pluginsNew.delete(e)}},{key:"tablePut",value:function(e,t){if(this.canWrite)return this.db[e].put(t)}},{key:"tableClear",value:function(e){if(this.canWrite)return this.db[e].clear()}},{key:"tableFilter",value:function(e,t){if(this.canWrite)return this.db[e].filter(t).toArray()}},{key:"tableGet",value:function(e,t){if(this.canWrite)return this.db[e].get(t)}},{key:"tableDelete",value:function(e,t){if(this.canWrite)return this.db[e].delete(t)}}]),n}(M))},5375:(e,t,n)=>{"use strict";n.d(t,{Z:()=>A});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(1506),c=n.n(s),l=n(6525),u=n.n(l),d=n(2205),h=n.n(d),p=n(8585),f=n.n(p),g=n(9754),m=n.n(g),v=n(8855),y=n(8651),k=n(7100),_=n(4472),Z=n(4305),w=n(4654),b=n(5252),P=n(4327),S=n(7274),D=n(9148);const I=function(){function e(){i()(this,e),this.activePane=void 0,this.startPane=void 0,this.previousEventTarget=void 0,this.previousDropTarget=void 0,this.previousHighlightElement=void 0,this.previousAbove=void 0,this.dataTransfer=void 0,this.startInfo=void 0,this.startDragItem=void 0,this.externalData=void 0,this.isDragging=!1,this.isDraggingDelayed=!1,this.dragItem=void 0,this.draggingObjects=new D.Z,this.position=void 0,this.transform=new S.Z({left:0,top:0}),this.isExternalDrag=new S.Z(!1),this.linePosition=new S.Z,this.isDraggingPane=new S.Z(!1),this.draggingToOutline=new S.Z,this.dragTargetHovered=new S.Z,b.Z.binder(this,"handleEscapeKey")}return o()(e,[{key:"stop",value:function(){var e=0,t=this;this.__hotkeyEscape&&(w.default.hotkeys.popStack(this.__hotkeyEscape),this.__hotkeyEscape=void 0);for(var n=this.draggingObjects.get(),r=function(e){return e.draggedInPane.set(void 0)},i=0;i<n.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n[i].item.forEachChildRecursive(r,!0,!0)}this.draggingObjects.clear(),this.isExternalDrag.set(!1),this.isDragging=!1,requestAnimationFrame((function(){return t.isDraggingDelayed=!1})),this.dragItem=void 0,this.position=void 0,this.externalData=void 0}},{key:"finish",value:function(){this.blockTarget=void 0,P.Z.fireEvent("endDrag",[])}},{key:"start",value:function(e,t,n,r,i,a,o,s){var c=0;this.isDragging&&(this.stop(),this.finish()),this.__hotkeyEscape=w.default.hotkeys.pushStackEscape(this.handleEscapeKey),this.isDragging=!0,this.isDraggingDelayed=!0,this.activePane=i,this.dragInfo=null,this.startPane=i,this.startInfo=a,this.dataTransfer=o,this.dragItem=e,this.startDragitem=e,this.fromOverview=s,this.externalData=void 0,this.position={left:n,top:r},this.transform.set({left:0,top:0}),this.draggingObjects.set(t),_.Z.reset();for(var l=function(e){return e.draggedInPane.set(y.Z.focusedPane)},u=0;u<t.length;++u){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;t[u].item.forEachChildRecursive(l,!0,!0)}}},{key:"startExternal",value:function(e){this.isDragging=!0,this.isDraggingDelayed=!0,this.activePane=e,this.startPane=e,this.draggingObjects.clear(),this.isExternalDrag.set(!0)}},{key:"setExternalData",value:function(e){this.externalData=e}},{key:"setTransform",value:function(e,t){this.transform.set({left:e,top:t})}},{key:"handleDragOver",value:function(e){var t=e.item,n=e.dataTransfer,r=e.clientX,i=e.clientY,a=y.Z.elementFromPoint(r,i),o=y.Z.getPaneForElement(a);if(this.activePane&&o!==this.activePane&&this.revertDrag(),y.Z.vmMain.checkDragForScroll({clientX:r}),o){this.isDragging||this.startExternal(o),this.activePane=o;var s=!!y.Z.findParent(a,"paneOverviewScroller");o.canAcceptDragOver(n.pane,a,s,t)?this.dragInfo=o.handleDragOver(n.pane,a,r,i,t):this.revertDrag()}return this.linePosition.set(this.dragInfo&&this.dragInfo.linePosition),this.dragInfo&&this.dragInfo.targetElement||y.Z.cancelRepeatScroll("pane"),!1}},{key:"revertDrag",value:function(){this.dragInfo=null,this.activePane.revertDrag(),y.Z.cancelRepeatScroll("pane")}},{key:"handleDropItems",value:function(e,t,n){var r,i=this.activePane;return this.isDropping=!0,y.Z.cancelRepeatScrolls(),this.dragInfo&&i&&(w.default.PaneUpdateBatcher.beginUpdateItems(),this.startInfo&&0===this.startInfo.items[0].index&&this.startPane.setIgnoreRestoreScroll(),i.handleDragDrop(e,t,this.dragInfo,n),w.default.PaneUpdateBatcher.commitUpdateItems(),r=e),this.isDropping=!1,r}},{key:"handleDrop",value:function(e){var t=this,n=e.target,r=e.dataTransfer,i=e.fromDropBucket,a=e.ctrlKey,o=e.altKey,s=e.shiftKey,c=e.metaKey,l=e.clipboardData,u=this.activePane;if(u&&(y.Z.elementInPane(n)||i)){var d=r.itemsDragging;if(this.isDragging=!1,requestAnimationFrame((function(){return t.isDraggingDelayed=!1})),d)return this.handleDropItems(d,{dataTransfer:r,ctrlKey:a,altKey:o,shiftKey:s,metaKey:c}),!0;w.default.pluginManager.handleDropEvent({target:n,clipboardData:l,dataTransfer:r},(function(e,n){var i=u.createVMLI({text:e},{changeType:v.Z.ChangeType.AllLocal,noParentOkay:!0});return!!(i=t.handleDropItems([i],{ctrlKey:a,altKey:o,shiftKey:s,metaKey:c,dataTransfer:r},n))}))}this.stop(),y.Z.cancelRepeatScrolls()}},{key:"handleDragLeave",value:function(e){e.clientX||e.clientY||(this.isDragging=!1,this.isDraggingDelayed=!1)}},{key:"setBlockTarget",value:function(e){this.blockTarget=e}},{key:"stopDraggingToOutline",value:function(){this.draggingToOutline.get();this.dragTargetHovered.set(void 0),this.draggingToOutline.set(void 0)}},{key:"handleEscapeKey",value:function(){this.escapedDragging=!0,this.dragItem.dragEnd(),this.revertDrag()}}]),e}();var E=n(8047),x=n(8133);function C(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}const A=function(e){h()(n,e);var t=C(n);function n(){var e;return i()(this,n),(e=t.call(this)).dragging=new S.Z,e.draggingPosition=new S.Z,e.dropSucceeded=new S.Z,window.addEventListener("dragover",e.handleDragOver.bind(c()(e))),window.addEventListener("dragleave",e.handleDragLeave.bind(c()(e))),window.addEventListener("drop",e.handleDropExternal.bind(c()(e))),e}return o()(n,[{key:"handleDropExternal",value:function(e){if(y.Z.preventAndStop(e),!u()(m()(n.prototype),"handleDrop",this).call(this,e)){var t,r,i=this.activePane,a=null===(t=e.dataTransfer)||void 0===t?void 0:t.getData("text/html"),o=null===(r=e.dataTransfer)||void 0===r?void 0:r.getData(k.Z.ie?"Text":"text/plain");if(a||o){_.Z.setFocusedPane(i);var s=i.createVMLI({text:""},{changeType:v.Z.ChangeType.AllLocal,noParentOkay:!0});return this.handleDropItems([s],e,!0),requestAnimationFrame((function(){_.Z.selectItem(s,0);Z.Z.insert({getData:function(e){return"text/html"===e&&a||"text/plain"===e&&o||void 0}},e,"drop")})),!0}if(this.externalData){var c=this.externalData;this.externalData=void 0;var l=c.split(":"),d=(l.removeAt(0),"["+l.removeAt(0)+"]("+l.join(":")+")"),h=i.createVMLI({text:d},{changeType:v.Z.ChangeType.AllLocal,noParentOkay:!0});return h=this.handleDropItems([h],e,!0),!0}}}},{key:"checkDragMoveNew",value:function(e,t){var n;return E.Z.beginBatch(),!this.dragging.get()&&y.Z.distance(t.distanceX,t.distanceY)>1&&(this.dragging.set(e),n=!0),this.dragging.get()&&(this.draggingPosition.set({x:t.clientX,y:t.clientY}),this.handleDragOverNew(t)),E.Z.endBatch(),n}},{key:"checkDragEndNew",value:function(e,t){var n,r=this,i=y.Z.elementFromPoint(e.clientX,e.clientY),a=y.Z.findParent(i,"fab"),o=y.Z.findParent(i,"fancySheet");!a&&!o&&this.dragInfo&&this.dragging.get()&&e.clientY<k.Z.windowSize.get().height-v.Z.Mobile.BottomBarHeight&&(n=this.handleDragDropNew(e)),this.dropSucceeded.set(n);var s=function(){E.Z.beginBatch(),r.dragInfo=void 0,r.dragging.set(void 0),r.draggingPosition.set(void 0),r.linePosition.set(void 0),n&&t&&t(),y.Z.cancelRepeatScroll("pane"),E.Z.endBatch()};n?requestAnimationFrame(s):s()}},{key:"checkDragStartNew",value:function(e,t,n){var r=this;x.Cs.onTouchMoveEnd({ev:e,onMove:function(e){r.checkDragMoveNew(t,e)},onUp:function(e,t){r.checkDragEndNew(e,n),_.Z.disableMouseDown(300)}})}},{key:"cancelDragScoll",value:function(){y.Z.cancelRepeatScroll("pane"),this.linePosition.set(void 0)}},{key:"handleDragOverNew",value:function(e){var t=e.clientX,n=e.clientY;y.Z.vmMain.checkDragForScroll({clientX:t});var r=y.Z.elementFromPoint(t,n),i=y.Z.getPaneForElement(r),a=this.dragging.get().pane;if(i)if(y.Z.findParent(r,"fab")||y.Z.findParent(r,"fancySheet"))this.cancelDragScoll();else{var o=!!y.Z.findParent(r,"paneOverviewScroller");i.canAcceptDragOver(a,r,o)?this.dragInfo=i.handleDragOver(a,r,t,n):this.dragInfo=void 0,this.linePosition.set(this.dragInfo&&this.dragInfo.linePosition)}else this.cancelDragScoll()}},{key:"handleDragDropNew",value:function(e){var t=this.dragging.get().pane,n=this.dragInfo.targetPane,r=t.createVMLIsToDrop(this.dragging.get(),this.dragInfo);if(r){var i={ctrlKey:e.ctrlKey,altKey:e.altKey,dataTransfer:{pane:t,dropEffect:t.dropEffect(r[0])}};return n.handleDragDrop(r,i,this.dragInfo,"PaneGmail"!==t.type)}return n.revertDrag(),!1}}]),n}(I)},9401:(e,t,n)=>{"use strict";n.d(t,{Z:()=>P});var r=n(8926),i=n.n(r),a=n(4575),o=n.n(a),s=n(3913),c=n.n(s),l=n(2205),u=n.n(l),d=n(8585),h=n.n(d),p=n(9754),f=n.n(p),g=n(7757),m=n.n(g),v=n(8651),y=/^<(.*)>$/,k=/^[^:]+(?=:)/,_=0,Z={Default:{bannedTags:["style","script","source","track","iframe","frame","frameset","button","input","audio","video","math","svg","link","comment","base","object","embed"],allowedAttributes:["abbr","accept","acceptcharset","accesskey","align","alt","async","autocomplete","axis","background","border","bordercolor","bgcolor","cellpadding","cellspacing","char","charoff","charset","checked","cid","class","classid","classname","color","colspan","cols","content","contextmenu","controls","coords","data","datetime","defer","dir","disabled","download","draggable","enctype","form","formaction","formenctype","formmethod","formnovalidate","formtarget","frame","frameborder","headers","height","hidden","high","href","hreflang","htmlfor","httpequiv","icon","itemscope","itemtype","itemid","itemprop","itemref","label","lang","list","loop","low","manifest","marginheight","marginwidth","max","maxlength","media","mediagroup","method","min","multiple","muted","name","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","radiogroup","readonly","rel","required","role","rowspan","rows","rules","sandbox","scope","scoped","scrolling","seamless","selected","shape","size","sizes","sortable","sorted","span","spellcheck","src","srcdoc","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","valign","value","width","wmode"],allowedTagAttributes:{A:["href","name"],IMG:["src","alt"],FONT:["face"],HTML:["xmlns"],BODY:["text","link","alink","vlink"],META:["http-equiv"],VAR:["id"]}}};const w=function(){function e(t,n){o()(this,e),this._reportError=t,this._assert=n}return c()(e,[{key:"update",value:function(e){var t,n=e.decoded,r=e.resources,i=e.options,a=e.mimeType;return this._assert(r,"Must supply a valid resource lib"),this._assert(i,"Must supply a valid options obj"),"text/plain"===a?t=this._parsePlain(n):"text/html"===a?t=this._parseHTML(n,r,i):this._reportError(new Error("Unknown email mimeType"),"Unknown email mimeType: "+a),t?t.parsed=this._escapeHTMLEntities(t.parsed):t={parsed:void 0,missingResourceData:!0},t}},{key:"getAttachmentLinks",value:function(e){var t=e.decoded,n=e.options,r=[],i=this._createDoc(t);if(i){var a=this._findLinkElements(i),o=this._findQuoteElements(i);try{r=this._findSpecialLinks(a,o,n).attachments}catch(s){this._reportError(s)}}return r}},{key:"generatePlaintext",value:function(e){var t=e.decoded;return this._createDoc(t).body.textContent}},{key:"replaceSignature",value:function(e){var t,n=e.decoded,r=e.newSignature,i=this._createDoc(n),a=this._findActiveSignature(i);if(a){var o=!!a.innerHTML;if(a.innerHTML=r||"",r)o||(a.parentNode.insertBefore(i.createElement("br"),a),a.parentNode.insertBefore(i.createElement("br"),a),a.parentNode.insertBefore(i.createTextNode("--"),a),a.parentNode.insertBefore(i.createElement("br"),a));else{var s=a.previousSibling;if(s&&"BR"===s.nodeName){var c=s.previousSibling;if(c&&3===c.nodeType&&"--"===c.textContent){var l=c.previousSibling;if(l){var u=l.previousSibling;"BR"===l.nodeName&&(l.parentElement.removeChild(l),u&&"BR"===u.nodeName&&u.parentElement.removeChild(u))}s.parentElement.removeChild(s),c.parentElement.removeChild(c)}}}t=i.body.outerHTML}else t=n;return t}},{key:"combineParts",value:function(e){var t=e.partList;this._assert(this._isArray(t)&&t.length>0,"Must always supply a valid part list with contents");var n=this._createDoc("<head></head><body></body>");if(this._assert(n,"Must always be able to create a valid document for first part in list"),n)for(var r=0,i=0;i<t.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=this._ensurePartDoc(t[i]);if(a)try{this._mergeDocs(a,n)}catch(o){this._reportError(o)}}return n?n.body.outerHTML:" "}},{key:"removeElementsByAttribute",value:function(e){var t=e.decoded,n=e.attr,r=e.value;this._assert(this.isString(t),"Must pass in a valid decoded HTML email string"),this._assert(this.isString(n),"Must provide a valid item ID");var i=!1;try{var a=this._createDoc(t);a&&(i=this._removeElementsByAttribute(a,n,r))}catch(o){this._reportError(o)}return i?a.body.outerHTML:t}},{key:"sanitizeContent",value:function(e){var t,n=e.decoded;if(n){var r=this._createDoc(n);try{var i=r.body;this._traverseNode(i,(function(e){e.nodeType===Node.TEXT_NODE?e.textContent=new Array(e.textContent.length+1).join("#"):"A"===e.nodeName&&e.removeAttribute("href")})),t=i.outerHTML}catch(a){this._reportError(a),t="<<SANITIZED>>"}}else t="<<NO HTML CONTENT>>";return t}},{key:"getComposeBody",value:function(e){var t=e.decoded,n=e.resources,r=!1;try{var i=this._createDoc(t);if(i){r=this._removeElementsByAttribute(i,"moodoAttach","true");var a=this._updateResourceImages(i,n);r=r||a.didUpdate}}catch(o){this._reportError(o)}return r?i.body.outerHTML:t}},{key:"parseResourceID",value:function(e){var t;y.lastIndex=0;var n=y.exec(e);return n&&n[1]&&(t=n[1]),t}},{key:"_escapeHTMLEntities",value:function(e){return e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,(function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"})).replace(/[\x01-\t\x0B\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,(function(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"}))}},{key:"_ensurePartDoc",value:function(e){var t;switch(e.mimeType){case"text/plain":t=this._createDoc(this._parsePlain(e.decoded).parsed);break;case"text/html":t=this._createDoc(e.decoded);break;default:this._assert(!1,"Unknown display part mimeType: "+e.mimeType)}return t}},{key:"_hasClass",value:function(e,t){return e.classList.contains(t)}},{key:"_mergeDocs",value:function(e,t){var n=e.body,r=t.body;if(n){var i=t.importNode(n,!0),a=t.createElement("div");try{for(var o=0,s=0;s<i.attributes.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var c=i.attributes[s];a.setAttribute(c.name,c.value)}}catch(u){this._reportError(u)}try{for(var l=0;i.childNodes&&i.childNodes.length>0;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;a.appendChild(i.firstChild)}}catch(u){this._reportError(u)}try{r.appendChild(a)}catch(u){this._reportError(u)}}}},{key:"_removeElementById",value:function(e,t){var n=!1,r=e.getElementById(t);return r&&(r.parentNode.removeChild(r),n=!0),n}},{key:"_removeElementsByAttribute",value:function(e,t,n){var r,i=0,a=!1;r=void 0!==n&&null!==n?e.querySelectorAll("["+t+'="'+n+'"]'):e.querySelectorAll("["+t+"]");for(var o=0;o<r.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=r[o];s.parentNode.removeChild(s),a=!0}return a}},{key:"_createFragment",value:function(){return{lines:[],isQuote:!1}}},{key:"_createPlainFragments",value:function(e){var t=0,n=[],r=e.split("\n"),i=this._createFragment();n.push(i);for(var a=0;a<r.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=r[a].trim(),s=new RegExp(/^>+/).test(o);i.lines.length>0&&s!==i.isQuote&&""!==o&&(i=this._createFragment(),n.push(i)),i.lines.push(o),i.isQuote=i.isQuote||s}return n}},{key:"_getFragmentText",value:function(e){var t,n,r=0,i="";if(e.isQuote){var a=this._generatePlaceholderID();t='<div id="'+a+'" place="true"></div><p quote="collapsed" group="'+a+'">',n="</p>"}else t="",n="";for(var o=0;o<e.lines.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i+=e.lines[o]+"\n"}return t+i+n}},{key:"_joinPlainFragments",value:function(e){for(var t=0,n="",r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[r];n+=this._getFragmentText(i)}return n}},{key:"_parsePlain",value:function(e){var t,n=this._escapeHTMLEntities(e),r=this._createPlainFragments(n);try{t=this._joinPlainFragments(r);t=t.replace(/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gm,'<a mlink="true" href="$1">$1</a>')}catch(i){this._reportError(i),t="There was an error loading this message."}return{parsed:'<html><head></head><body style="white-space: pre-wrap;">'+t+"</body><html>"}}},{key:"_parseHTML",value:function(e,t,n){var r={parsed:void 0},i=this._createDoc(e),a=this._findQuoteElements(i);if(a=this._cleanupDocQuotes(i,a),this._isFullQuote(i,a)||this._collapseAndMarkQuotes(i,a,!!n.collapseQuotes),n.createLinksFromText)try{this._createLinksFromText(i)}catch(d){this._reportError(d)}var o=this._findLinkElements(i);this._markLinks(o);try{r.specialLinks=this._findSpecialLinks(o,a,n)}catch(d){this._reportError(d)}try{r.parsedMetadata=this._parseMetadata(i)}catch(d){this._reportError(d)}try{var s=this._updateResourceImages(i,t);r.missingResourceData=s.missingData}catch(d){this._reportError(d)}if(this._trimTrailingWhitespace(i),this._trimQuoteWhitespace(a),r.parsed=i.body.outerHTML,i.head.childElementCount>0)for(var c=0,l=i.head.getElementsByTagName("style"),u=0;u<l.length;u++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;l[u]&&(r.parsed="<style>".concat(l[u].innerText,"</style>")+r.parsed)}return r}},{key:"_traverseNode",value:function(e,t){if(!1!==t(e)&&e.childNodes)for(var n=0,r=e.childNodes.length-1;r>=0;r--){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this._traverseNode(e.childNodes[r],t)}}},{key:"_sanitizeInputDoc",value:function(e,t){var n=this,r=Z[t],i=e.body;i&&this._traverseNode(i,(function(e){if(e.nodeType===Node.COMMENT_NODE)n._assert(!e.childNodes||0===e.childNodes.length,"A comment node should never have children"),e.parentNode.removeChild(e);else if(e.nodeType===Node.TEXT_NODE);else if(r.bannedTags.indexOf(e.tagName.toLowerCase())>=0)e.parentNode.removeChild(e);else if(e.attributes.length>0){for(var t=0,i=r.allowedTagAttributes[e.tagName],a=e.attributes.length-1;a>=0;a--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=e.attributes[a].name;if(r.allowedAttributes.indexOf(o)<0&&(!i||i.indexOf(o)<0))e.removeAttribute(o);else{var s=e.getAttribute(o);s&&s.startsWith("javascript:")&&(console.log("Remove Inline JS: ",e.tagName,o),e.removeAttribute(o))}}var c=e.getAttribute("height");c&&c.indexOf("%")>=0&&e.removeAttribute("height")}}))}},{key:"_createDoc",value:function(e){var t,n=new DOMParser;try{if(t=n.parseFromString(e,"text/html")){var r=this._parseJSONLD(t);this._sanitizeInputDoc(t,"Default"),r&&r.length>0&&this._reportMetadata(t,r)}}catch(i){this._reportError(i);try{t=n.parseFromString("Error parsing email message","text/html")}catch(a){this._reportError(a)}}return t}},{key:"_updateResourceImages",value:function(e,t){for(var n=0,r={missingData:!1,didUpdate:!1},i=this._findImageElements(e),a=0;a<i.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=i[a],s=o.src;if(s.startsWith("cid:")){var c=s.substr(4);if(c){o.setAttribute("cid",c);var l=t[c];if(l&&l.data){var u="data:"+l.mimeType+";base64,"+l.data;o.src=u,r.didUpdate=!0}else o.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",r.didUpdate=!0,l||(r.missingData=!0)}else o.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",r.didUpdate=!0}}return r}},{key:"_findImageElements",value:function(e){return e.querySelectorAll("img")}},{key:"_findLinkElements",value:function(e){return Array.prototype.slice.call(e.querySelectorAll("a"))}},{key:"_sanitizeLink",value:function(e){if(e&&e.hasAttribute("href")){e.setAttribute("mlink","true");var t=e.getAttribute("href");if(t.startsWith("file:"))e.setAttribute("href","");else k.exec(t)||e.setAttribute("href","https://"+t)}}},{key:"_createLinksFromText",value:function(e){var t=e.body;this._traverseNode(t,(function(t){var n=!0;if(t.nodeType===Node.TEXT_NODE){var r=t.textContent;if(r.indexOf("http")>=0||r.indexOf("www.")>=0){var i=/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gm,a=t.textContent.replace(i,'<a href="$1">$1</a>'),o=e.createElement("div");o.innerHTML=a;var s=o.childNodes?o.childNodes.length:0;if(s>1||1===s&&"A"===o.childNodes[0].nodeName){for(var c=0;o.firstChild;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;t.parentNode.insertBefore(o.firstChild,t)}t.parentNode.removeChild(t)}}}else"A"===t.tagName&&(n=!1);return n}))}},{key:"_markLinks",value:function(e){for(var t=0,n=0;n<e.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._sanitizeLink(e[n])}}},{key:"_isAttachmentURL",value:function(e){return!!/^https:\/\/drive.google.com\/file\/d\/.*\/view/g.exec(e)}},{key:"_findSpecialLinks",value:function(e,t,n){for(var r=0,i={unsubscribe:[],twitter:[],attachments:[]},a=0;a<e.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=e[a];o.href&&this._isAttachmentURL(o.href)&&(n.ignoreQuotedAttachments&&this._isInsideQuote(o,t)||i.attachments.push({href:o.href,cid:o.id,name:o.innerText,type:"application/octet-stream"}))}return i}},{key:"_parseMetadata",value:function(e){var t=this._parseMicrodata(e);return t&&t.length>0&&this._reportMetadata(e,t),t}},{key:"_reportMetadata",value:function(e,t){}},{key:"_parseJSONLD",value:function(e){for(var t=0,n=[],r=e.getElementsByTagName("script"),i=0;i<r.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=r[i];if("application/ld+json"===a.getAttribute("type")){var o=a.textContent.trim();if(o)try{var s=JSON.parse(o);n.push(s)}catch(c){this._reportError(new Error("Invalid JSONLD Schema String"),o)}}}return n}},{key:"_parseMicrodata",value:function(e){var t=this,n=e.querySelectorAll("[itemscope]");return Array.prototype.map.call(n,(function(e){if(!e.hasAttribute("itemprop"))return t._parseMicrodataScope(e)})).filter((function(e){return!!e}))}},{key:"_parseMicrodataScope",value:function(e){var t={type:e.getAttribute("itemtype"),properties:{}};return this._recurseMicrodataScope(t,e),t}},{key:"_recurseMicrodataScope",value:function(e,t){for(var n=0,r=t.children,i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i];if(a.hasAttribute("itemprop")){var o,s=a.getAttribute("itemprop");if(a.hasAttribute("itemscope"))o=this._parseMicrodataScope(a);else switch(a.tagName.toLowerCase()){case"a":case"area":case"link":o=a.getAttribute("href");break;case"meta":o=a.getAttribute("content");break;case"img":o=a.getAttribute("src");break;case"data":case"meter":o=a.getAttribute("value");break;case"time":o=a.getAttribute("datetime");break;default:o=a.hasAttribute("content")?a.getAttribute("content"):a.textContent}s&&o&&(e.properties[s]=o)}else this._recurseMicrodataScope(e,a)}}},{key:"_cleanupDocQuotes",value:function(e,t){var n=this;return t.filter((function(e){var t=!1;"BLOCKQUOTE"===e.nodeName&&"cite"===e.getAttribute("type")&&(n.parseResourceID(e.innerText)&&e&&e.parentNode&&(e.parentNode.removeChild(e),t=!0));return!t}))}},{key:"_generatePlaceholderID",value:function(){return"~T"+Date.now()+ ++_}},{key:"_createQuotePlaceholder",value:function(e){var t=e.createElement("div");return t.id=this._generatePlaceholderID(),t.setAttribute("place","true"),t}},{key:"_findFirstSiblingQuote",value:function(e,t){for(var n=0,r=e;r.previousElementSibling&&t.indexOf(r.previousElementSibling)>=0;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r=r.previousElementSibling}return r}},{key:"_markAdjacentQuotes",value:function(e,t,n,r){for(var i=0;e&&n.indexOf(e)>=0;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e.setAttribute("quote",r),e.setAttribute("group",t),e=e.nextElementSibling}}},{key:"_collapseAndMarkQuotes",value:function(e,t,n){for(var r=0,i=0;i<t.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=t[i];if(!a.getAttribute("quote")){var o=this._findFirstSiblingQuote(a,t),s=this._createQuotePlaceholder(e),c=0===i&&n?"collapsed":"uncollapsed";this._markAdjacentQuotes(o,s.id,t,c),o.parentNode.insertBefore(s,a)}}}},{key:"_removeQuote",value:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}},{key:"_isFullQuote",value:function(e,t){for(var n=0,r=!0,i=e.body,a=0;i.children&&a<i.children.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=i.children[a];if(o&&""!==o.textContent.trim()&&t.indexOf(o)<0&&t.indexOf(o.firstElementChild)<0){r=!1;break}}return r}},{key:"_findQuoteElements",value:function(e){var t=this._findGmailQuotes(e),n=this._findOffice365Quotes(e),r=this._findBlockquoteQuotes(e),i=[];return this.pushOnlyUniques(i,t),this.pushOnlyUniques(i,n),this.pushOnlyUniques(i,r),i=this._cleanupGmail(i),i=this._removeEmptyQuotes(i)}},{key:"_cleanupGmail",value:function(e){var t=this;return e.filter((function(n){var r=!1;if("BLOCKQUOTE"===n.nodeName&&t._hasClass(n,"gmail_quote"))for(var i=0,a=0;a<e.length;++a){var o=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var s=n.parentElement;s;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(t._hasClass(s,"gmail_quote")){"DIV"===s.nodeName&&(r=!0);break}s=s.parentElement}}return!r}))}},{key:"_removeEmptyQuotes",value:function(e){return e}},{key:"_findGmailQuotes",value:function(e){return Array.prototype.slice.call(e.querySelectorAll(".gmail_quote"))}},{key:"_findOffice365Quotes",value:function(e){var t=Array.prototype.slice.call(e.querySelectorAll("#divRplyFwdMsg, #OLK_SRC_BODY_SECTION")),n=e.getElementById('3D"divRplyFwdMsg"');return n&&t.push(n),t=t.map((function(e){return e.previousElementSibling&&"HR"===e.previousElementSibling.nodeName?e.parentElement:e}))}},{key:"_findBlockquoteQuotes",value:function(e){return Array.prototype.slice.call(e.querySelectorAll("blockquote"))}},{key:"_findGmailSignatures",value:function(e){return Array.prototype.slice.call(e.querySelectorAll(".gmail_signature"))}},{key:"_findActiveSignature",value:function(e){for(var t,n=0,r=this._findGmailSignatures(e),i=this._findQuoteElements(e),a=r.length-1;a>=0&&!t;a--){var o=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var s=r[a],c=!0,l=0;l<i.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(this._isAncestor(s,i[l])){c=!1;break}}c&&(t=s)}return t}},{key:"_isAncestor",value:function(e,t){for(var n=0;e&&e!==t;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e=e.parentElement}return!!e}},{key:"_trimTrailingWhitespace",value:function(e){for(var t=0,n=e.body.childNodes,r=[],i=n.length-1;i>=0;i--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=n[i],o=n[i-1];if(!a||"BR"!==a.nodeName||!o||"BR"!==o.nodeName)break;r.push(a)}this._removeElements(r)}},{key:"_trimQuoteWhitespace",value:function(e){for(var t=0,n=[],r=0;r<e.length;++r){var i=0;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;for(var a=e[r].previousElementSibling;a;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;"BR"===a.nodeName&&a.previousElementSibling&&"BR"===a.previousElementSibling.nodeName&&n.push(a),a=a.previousElementSibling}}this._removeElements(n)}},{key:"_removeElements",value:function(e){for(var t=0,n=0;n<e.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[n];try{r.parentNode&&r.parentNode.removeChild(r)}catch(i){}}}},{key:"_isInsideQuote",value:function(e,t){for(var n=0;e.parentNode;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(t.indexOf(e.parentNode)>=0)return!0;e=e.parentNode}return!1}},{key:"_isArray",value:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{key:"isString",value:function(e){return"string"===typeof e}},{key:"pushOnlyUniques",value:function(e,t,n){var r=0;if(!t)return e;for(var i=0,a=t.length;i<a;++i){var o=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var s=!0,c=0,l=e.length;c<l;++c){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(n&&n(t[i],e[c])||!n&&t[i]===e[c]){s=!1;break}}s&&e.push(t[i])}return e}}]),e}();function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}const P=new(function(e){u()(n,e);var t=b(n);function n(){var e;return o()(this,n),(e=t.call(this)).helper=new w(v.Z.reportError,v.Z.Assert),e}return c()(n,[{key:"update",value:function(){var e=i()(m().mark((function e(t,n,r,i){return m().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.update({decoded:t,resources:n,options:r,mimeType:i}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"getAttachmentLinks",value:function(){var e=i()(m().mark((function e(t,n){return m().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.getAttachmentLinks({decoded:t,options:n}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"generatePlaintext",value:function(){var e=i()(m().mark((function e(t){return m().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.generatePlaintext({decoded:t}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"replaceSignature",value:function(){var e=i()(m().mark((function e(t,n){return m().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.replaceSignature({decoded:t,newSignature:n}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"combineParts",value:function(){var e=i()(m().mark((function e(t){return m().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.combineParts({partList:t}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"removeElementsByAttribute",value:function(){var e=i()(m().mark((function e(t,n,r){return m().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.removeElementsByAttribute({decoded:t,attr:n,value:r}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"sanitizeContent",value:function(){var e=i()(m().mark((function e(t){return m().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.sanitizeContent({decoded:t}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getComposeBody",value:function(){var e=i()(m().mark((function e(t,n){return m().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.getComposeBody({decoded:t,resources:n}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(function(){function e(){o()(this,e)}return c()(e,[{key:"sanitizePlaintext",value:function(e){return e?/^\s*$/.test(e)?"":"<<NonHTML-Sanitized: "+e.length+">>":"<<NO CONTENT>>"}}]),e}()))},3205:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(8855),c=n(8651),l=n(7100),u=n(4654),d=n(8133),h=n(4764);const p=new(function(){function e(){i()(this,e)}return o()(e,[{key:"resetSavedSelection",value:function(){this.savedCaretPosition=void 0,this.savedSelectionMinMax=void 0}},{key:"getCaretPosition",value:function(){if(!this.savedCaretPosition){var e=this.savedRange,t=e||h.Z.getSelectionRangeNative();if(t){var n=t.getBoundingClientRect(),r=c.Z.findParent(t.endContainer,"hiddenInputItem")||c.Z.findParent(t.endContainer,"itemInPaneText");if(r){var i,a,o=r.getBoundingClientRect(),l=n.right,u=c.Z.findParent(t.startContainer,"inlineBordered");u&&(0===t.startOffset?l=u.getBoundingClientRect().left:t.startOffset===t.startContainer.length&&(l+=6));var d=+(null===(i=r.style.paddingTop)||void 0===i?void 0:i.replace("px",""))||0;d&&(d-=s.Z.ItemTextVPad);var p=l-o.left-(+(null===(a=r.style.paddingLeft)||void 0===a?void 0:a.replace("px",""))||0),f=n.top-o.top-d;0===n.left?this.savedCaretPosition={left:0,top:0,height:0}:this.savedCaretPosition={left:p,top:f,height:n.height,fromSavedRange:!!e}}}}return this.savedCaretPosition}},{key:"getSelectionMinMax",value:function(e,t){if(!this.savedSelectionMinMax){var n=h.Z.getSelectionRangeNative();if(n){var r,i=c.Z.findParent(n.endContainer,"hiddenInputItem")||c.Z.findParent(n.endContainer,"itemInPaneText"),a=i.getBoundingClientRect(),o=a.left+(+(null===(r=i.style.paddingLeft)||void 0===r?void 0:r.replace("px",""))||0),s=Array.from(n.getClientRects()).filter((function(e){return e.width>0})),l=s[0],u=s[s.length-1],d=Array.from(new Set(s.map((function(e){return e.top})))),p=[];d.forEach((function(e){p.some((function(t){return e!==t&&Math.abs(e-t)<5}))||p.push(e)}));var f=p.length;this.savedSelectionMinMax={numLines:f,min:{x:l.left-o+e,y:l.top-a.top+t},max:{x:u.right-o+e,y:u.top-a.top+t}}}}return this.savedSelectionMinMax}},{key:"updateFromPaneObject",value:function(e,t,n,r){var i=this,a=e.pane,o=a.listManager.getElementByID(e.id),p=[],f={},g=a.hiddenInput;if(this.resetSavedSelection(),c.Z.clearTimeoutOnce("updateFromPaneObject"+a.id),g){var m,v;if(o){var y=c.Z.findParent(o,"paneContent");m=(v=o.getBoundingClientRect()).top-y.getBoundingClientRect().top+y.scrollTop}else if(!r||r<3)return void c.Z.timeoutOnce("updateFromPaneObject"+a.id,(function(){return i.updateFromPaneObject(e,t,n,(r||0)+1)}),60);var k=p.length;p.push(e);var _=f[e.id]=a.getPaddingForPaneObject(e),Z=e.getDisplayLengthWithoutPrefix();t>Z&&(t=Z),n>Z&&(n=Z);try{var w=p.map((function(t,n){var r=t.item,i=t.pane,a=u.default.DisplaySettings.fontSizeForItem(t),o=i.listManager.getElementByIndex(t.index),c=null===o||void 0===o?void 0:o.closest(".itemNew"),l=c?c.className.replace(/t-header|t-h\d?/g,"").trim():"";var d=u.default.DisplaySettings.lineHeightForItem(t),h=r.isPrefixCodeBlock(),p=f[t.id]-_-(h?0:s.Z.TextPaddingLeft)+(u.default.settings.alignIndentToPrefix.get()&&r.hasPrefix()?s.Z.PrefixWidthPlusOffset:0),g=t.getDisplayLengthWithoutPrefix()>0?u.default.ElementRenderer.renderNew(r.elsNew.elements,r,i,{noPrefix:!0,forHiddenInput:!0,showMarkdown:t.showMarkdown(!0),fontSize:a}):r.hasPrefix()?s.Z.TextSpace:"",m=c&&+window.getComputedStyle(c).paddingTop.replace("px",""),v=["position: relative","margin-left: ".concat(p,"px"),"padding-top: ".concat(m||u.default.DisplaySettings.paddingForItemTop(t),"px"),"padding-bottom: ".concat(2,"px"),"padding-left: ".concat(h?0:s.Z.TextPaddingLeft,"px"),"margin-right: ".concat(u.default.DisplaySettings.paddingForItemRight(t),"px"),"z-index: 0",!g&&"height: ".concat(d,"px")].filter((function(e){return!!e})).join(";"),y=t.item.isStarred()?"":"c-background";return'<div data-index="'.concat(t.index,'" class="hiddenInputItem ').concat(s.Z.ItemClass," ").concat(l," ").concat(y," ").concat(r.styleProps(e,!0)," ").concat(r.stylePropsWrapper()," ").concat("",'" style="').concat(v,'">').concat(g,"</div>")})).join("");g.style.display="",g.style.paddingLeft=_+"px",void 0!==m&&(g.style.top=m+"px"),g.innerHTML!==w&&(g.innerHTML=w);var b=l.Z.windowHeight()-d.o0.getMaxKeyboardHeight()-120;v&&v.bottom>b&&a.addScrollDelta(v.bottom-b,l.Z.supportSmoothScrollWithKeyboard()?"smooth":"auto");var P=g.children[k];g.focus();var S=h.Z.selectElement(P,t,n);this.setSavedRange(S)}catch(D){c.Z.reportError(D)}}}},{key:"setSavedRange",value:function(e){this.savedRange=e}},{key:"blur",value:function(e){var t=e.hiddenInput;t.blur(),t.innerHTML="",t.style.display="none"}}]),e}())},386:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d,m:()=>h});var r,i=n(3038),a=n.n(i),o=n(4654),s=n(3170),c=n(7048),l={theme:"light",paneShadow:function(e){return"0 0 3px rgba(0,0,0,".concat(e?0:.4,")")}},u={theme:"dark",paneShadow:function(e){return"0 0 4px rgba(0,0,0,".concat(e?0:.4,")")}};function d(){var e=(0,s.Z)(o.default.DisplaySettings.systemColorTheme,o.default.DisplaySettings.getThemeObs()),t=a()(e,2);t[0],t[1];return"dark"===o.default.DisplaySettings.getColorTheme()?u:l}var h=function(){return r||(r=new c.Z([o.default.DisplaySettings.systemColorTheme,o.default.DisplaySettings.getThemeObs()],(function(){return"dark"===o.default.DisplaySettings.getColorTheme()?u:l}))),r}},4926:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(9955),i=n(6134),a=n(6604);function o(e){return e?{width:e.offsetWidth,height:e.offsetHeight}:{width:0,height:0}}function s(e){var t=(0,r.useRef)({width:0,height:0}),n=(0,a.Z)(),s=(0,r.useCallback)((function(){if(e.current){var r=t.current,i=o(e.current);!i||i.width===r.width&&i.height===r.height||(t.current=i,n())}}),[e,n]);return(0,r.useLayoutEffect)((function(){var t=e.current;if(t){s();var n=new i.Z(s);return n.observe(t),function(){n.disconnect(),n=null}}}),[e.current]),t.current}},4918:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(3038),i=n.n(r),a=n(9955);function o(){var e=(0,a.useState)(!1),t=i()(e,2),n=t[0],r=t[1],o=(0,a.useRef)(null);return(0,a.useEffect)((function(){var e=function(e){return r(!0)},t=function(e){for(var t=0,n=e.toElement,i=!1;n&&!i;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n===o.current&&(i=!0),n=n.parentElement}i||r(!1)},n=o.current;if(n)return n.addEventListener("mouseover",e),n.addEventListener("mouseout",t),function(){n.removeEventListener("mouseover",e),n.removeEventListener("mouseout",t)}}),[o.current]),[o,n]}},5428:(e,t,n)=>{"use strict";n.d(t,{J:()=>u});var r=n(8651),i=n(9955),a=n(427),o=n(4549),s=n(1471),c=n(6877),l={FaApple:a.oPZ,FaChrome:a.zKd,FaCircle:a.gbA,FaExclamation:a.GPV,FaFile:a.pPO,FaHashtag:a.qc7,FaHighlighter:a.Cqg,FaLinux:a._Aq,FaMinus:a.iFH,FaQuestion:a.g_g,FaRegStickyNote:a.KPP,FiChevronRight:o.Tfp,FaWindows:a.zTP,FiSidebar:o.iYc,IoIosArrowBack:s.u1R,IoIosArrowDown:s.OId,IoIosArrowForward:s.hjJ,IoIosArrowUp:s.Vmf,IoIosCalendar:s.B6n,IoIosCheckboxOutline:s.IS2,IoIosLink:s.$PT,IoIosRepeat:s.CeV,IoLogoGoogle:s.DL1,IoMdArrowDropleft:s.bHS,IoMdArrowDropright:s.am,IoMdBrowsers:s.GLX,IoMdCalendar:s.i95,IoMdCodeWorking:s.ovA,IoMdList:s.xTj,IoMdTrash:s.hME,MdAccessTime:c.dKE,MdAdd:c.x06,MdArchive:c.y2,MdArrowBack:c.KYK,MdArrowForward:c.hdK,MdAttachFile:c._b$,MdCheck:c.HhX,MdCheckBoxOutlineBlank:c.hrt,MdClose:c.FU5,MdCloudDone:c.iGF,MdCloudOff:c.IOQ,MdCloudQueue:c.Xt8,MdContentPaste:c.Vqr,MdCropPortrait:c.$q2,MdEdit:c.zmo,MdEmail:c.ixJ,MdFormatListBulleted:c.f_H,MdFormatBold:c.fO_,MdFormatItalic:c.W0y,MdFormatUnderlined:c.$kk,MdStrikethroughS:c.X39,MdCode:c.xoN,MdInbox:c.Pye,MdLink:c.$l_,MdKeyboardBackspace:c.dWm,MdLoop:c._YL,MdMenu:c.xXU,MdMoreHoriz:c.xr$,MdMoreVert:c.rgS,MdMoveToInbox:c.il_,MdOpenInNew:c.jhj,MdPerson:c.Vyx,MdRefresh:c.la_,MdReorder:c.CG1,MdSettings:c.b9P,MdStar:c.MVI,MdToday:c.zUI,MdUndo:c.TsG,MdUnfoldMore:c.bPX,MdViewAgenda:c.LW9,MdWarning:c.YTL},u=function(e){var t=e.name,n=e.size,a=e.color,o=e.className,s=e.style,c=t;return r.Z.isString(t)&&((c=l[t])||(c="i",o=(o||"")+" "+t)),(0,i.createElement)(c,{size:n,className:o,color:a,style:s})}},2935:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var r,i=n(4575),a=n.n(i),o=n(3913),s=n.n(o),c=n(3124),l=n.n(c),u=n(8572),d=n(6470);const h=new(r=function(){function e(){a()(this,e),this.onDisableChanged=new d.Z,this.state={except:{}}}return s()(e,[{key:"animateNext",value:function(e){this.state.disable||(this.state.enable=!0,this.state.except[e]=!0,this.prepTimeout())}},{key:"shouldAnimate",value:function(e){return this.state&&this.state.disable?null:this.state&&(!e||!this.state.except[e])}},{key:"disable",value:function(e){this.state.disable||(this.state.disable=!0,this.state.enable=!1,this.prepTimeout(),e&&this.onDisableChanged.notify())}},{key:"prepTimeout",value:function(){clearTimeout(this.timeout),this.timeout=setTimeout(this._onTimeout,1e3)}},{key:"_onTimeout",value:function(){var e=this.state.disable;this.state.disable=void 0,this.state.enable=!1,this.state.except={},this.timeout=void 0,e&&this.onDisableChanged.notify()}}]),e}(),l()(r.prototype,"_onTimeout",[u.ZP],Object.getOwnPropertyDescriptor(r.prototype,"_onTimeout"),r.prototype),r)},8532:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v,w:()=>m});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(2205),c=n.n(s),l=n(8585),u=n.n(l),d=n(9754),h=n.n(d),p=n(8651),f=n(9955);function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u()(this,n)}}function m(e,t,n){var r=e.pane;(0,f.useEffect)((function(){var i=e.index,a=e.id,o=t.current;n&&(o=p.Z.findChild(o,n));try{p.Z.PAssert(1258,o,"Mounting element that does not eixt")}catch(s){p.Z.reportError(s)}return o&&r.listManager.setElement(i,a,o),function(){return r.listManager.clearThisElement(i,a)}}),[e.index])}var v=function(e){c()(n,e);var t=g(n);function n(e){var r;return i()(this,n),(r=t.call(this,e)).elementsByID={},r.elementsByIndex={},r.scrollListeners=[],r}return o()(n,[{key:"getElementByID",value:function(e){return this.elementsByID[e]}},{key:"getElementByIndex",value:function(e){var t;return null===(t=this.elementsByIndex[e])||void 0===t?void 0:t.element}},{key:"setElement",value:function(e,t,n){this.elementsByID[t]=n,this.elementsByIndex[e]={paneObjectId:t,element:n}}},{key:"clearThisElement",value:function(e,t){var n;this.elementsByID[t]=void 0,(null===(n=this.elementsByIndex[e])||void 0===n?void 0:n.paneObjectId)===t&&(this.elementsByIndex[e]=void 0)}},{key:"setVirtualList",value:function(e){this._virtualList=e}},{key:"setScrollRange",value:function(e){var t=this;this.lastIndexScrolledTo=void 0,this.scrollRange=e,this.pane.saveState(!0),this.scrollListeners.forEach((function(n){return n(t.pane,e)}))}},{key:"getScrollOffset",value:function(){var e;return(null===(e=this._virtualList)||void 0===e?void 0:e.getScrollOffset())||0}},{key:"getScrollIndex",value:function(){var e,t,n;return null!==(e=null!==(t=this.lastIndexScrolledTo)&&void 0!==t?t:null===(n=this.scrollRange)||void 0===n?void 0:n.startIndex)&&void 0!==e?e:-1}},{key:"getScrollEndIndex",value:function(){var e,t;return null!==(e=null===(t=this.scrollRange)||void 0===t?void 0:t.endIndex)&&void 0!==e?e:-1}},{key:"scrollToOffset",value:function(e,t){var n;null===(n=this._virtualList)||void 0===n||n.scrollTo(e,t)}},{key:"scrollToIndex",value:function(e,t,n,r){var i;if("start"===t&&(this.lastIndexScrolledTo=e),e!==(null===(i=this.scrollRange)||void 0===i?void 0:i.startIndex)&&t&&this._virtualList)return this._virtualList.scrollToIndex({index:e,align:t,behavior:n,offset:r}),!0}},{key:"addScrollListener",value:function(e){this.scrollListeners.push(e)}},{key:"removeScrollListener",value:function(e){this.scrollListeners.remove(e)}},{key:"indexOfTop",value:function(){var e;return(null===(e=this.scrollRange)||void 0===e?void 0:e.startIndex)||0}},{key:"offsetOfIndex",value:function(e){return this._virtualList.offsetByIndex(e)}}]),n}(function(){function e(t){var n=t.pane;i()(this,e),this.pane=n}return o()(e,[{key:"onListChanged",value:function(){}},{key:"isIndexInView",value:function(e){return!1}},{key:"clearItemInfoForItem",value:function(e){}},{key:"handleItemTextChanged",value:function(e){return!1}},{key:"clearCache",value:function(){}},{key:"saveScrollOfTop",value:function(){}}]),e}())},4764:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(8651),c=n(7100);const l=function(){function e(t){i()(this,e),this._range=t,this._range||(this._range=n(4764).Z.getSelectionRangeNative())}return o()(e,[{key:"isValid",value:function(){return!!this._range}},{key:"getNativeRange",value:function(){return this._range}},{key:"getStartContainer",value:function(){return this._range.startContainer}},{key:"getEndContainer",value:function(){return this._range.endContainer}},{key:"getStartElement",value:function(){return s.Z.getElementParent(this.getStartContainer())}},{key:"getEndElement",value:function(){return s.Z.getElementParent(this.getEndContainer())}},{key:"getSelectOffsetsInElement",value:function(e){return n(4764).Z.getSelectOffsetsInElement(e,this._range)}},{key:"getStartOffset",value:function(){return this._range.startOffset}},{key:"getEndOffset",value:function(){return this._range.endOffset}},{key:"getBoundingClientRect",value:function(){return this._range.getBoundingClientRect()}}]),e}();var u=n(8855);const d=new(function(){function e(){i()(this,e)}return o()(e,[{key:"createFakeRange",value:function(e,t,n,r){try{var i=this.createSelectionRange();return i.setStart(e,t),i.setEnd(n,r),new l(i)}catch(a){s.Z.reportError(a)}}},{key:"createSelectionRange",value:function(){return document.createRange()}},{key:"setSelection",value:function(e,t,n,r){if("TEXTAREA"===e.nodeName){try{s.Z.PAssert(243,e===n,"Cannot multiselect textareas")}catch(a){s.Z.reportError(a)}e.focus(),e.selectionStart=t,e.selectionEnd=r}else{var i=this.createSelectionRange();this.setSelectionValues(i,e,t,n,r),this.setSelectionRange(i)}}},{key:"setSelectionRange",value:function(e){var t=window.getSelection();s.Z.shouldLog(u.Z.LogLevels.Selection)&&s.Z.log("Set Selection to Range",e),t.removeAllRanges(),e instanceof l&&(e=e.getNativeRange()),t.addRange(e)}},{key:"insertNode",value:function(e){var t=this.getSelectionRangeNative();t&&t.insertNode(e)}},{key:"selectAfterNode",value:function(e){var t=document.createRange();return t.setStartAfter(e),this.setSelectionRange(t),this.getSelectionRangeNative()}},{key:"setSelectionRangeToWhatItAlreadyIs",value:function(){var e=this.getSelectionRangeNative();s.Z.shouldLog(u.Z.LogLevels.Selection)&&s.Z.log("Set Selection to Same",e),e&&this.setSelectionRange(e)}},{key:"hasValidSelection",value:function(){return this.getSelectionRange(!0).isValid()}},{key:"getSelectionRange",value:function(e){var t;return e&&(t=this.getSelectionRangeNative()),new l(t)}},{key:"getSelectionRangeNative",value:function(){var e,t=window.getSelection();return t.rangeCount>0&&(e=t.getRangeAt(0)),e}},{key:"getSelectionNode",value:function(){var e=window.getSelection().anchorNode;if(e)return e.nodeType===Node.TEXT_NODE?e.parentNode:e}},{key:"getSelectedText",value:function(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!==document.selection.type?document.selection.createRange().text:void 0}},{key:"clearSelection",value:function(){var e=window.getSelection();s.Z.shouldLog(u.Z.LogLevels.Selection)&&s.Z.log("Clear Selection"),e.removeAllRanges()}},{key:"getCursorSelectionRange",value:function(e){var t,n=e.target,r=s.Z.ensureDOMNode(e.target);if(r){var i=s.Z.getElementParent(n),a=0,o=s.Z.getPaneObjectForElement(n);try{s.Z.PAssert(244,i,"getCursorSelectionRange must only be called when hovered item is item",r)}catch(h){s.Z.reportError(h)}o&&(r=s.Z.findChild(i,"itemInPaneText")||r,a=0);var c=r.getBoundingClientRect(),u=s.Z.clamp(e.clientY,c.top+9,c.bottom-9),d=s.Z.clamp(e.clientX,c.left+a,c.right-1);t=this._getCursorSelectionRange(d,u)}return t?new l(t):void 0}},{key:"_safari_caretRangeFromPoint",value:function(e,t,n){var r=0;var i=function(n){var r=n.getClientRects()[0];return r&&t>=r.top&&t<=r.bottom?Math.abs(e-(r.left+r.width/2)):1e5},a=function e(t,n,r){var i=0,a=[];for(t=t.firstChild;t;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;3==t.nodeType&&a.push(t),1==t.nodeType&&(a=a.concat(e(t,n,r))),t=t.nextSibling}return a}(document.elementFromPoint(e,t),e,t);if(!a.length)return null;var o=a[0],s=document.createRange();s.setStart(o,0),s.setEnd(o,1);for(var c={range:void 0,distance:1e5},l=0;l<a.length;l++){var u=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var d=(o=a[l]).nodeValue,h=0;h<=d.length;h++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;(s=document.createRange()).setStart(o,h),s.setEnd(o,h);var p=i(s);p<c.distance&&(c={range:s,distance:p})}}return c.range}},{key:"_getCursorSelectionRange",value:function(e,t){var n;if(c.Z.safari)n=this._safari_caretRangeFromPoint(e,t);else if(document.caretRangeFromPoint)n=document.caretRangeFromPoint(e,t);else if(document.caretPositionFromPoint){var r=document.caretPositionFromPoint(e,t);r&&((n=document.createRange()).setStart(r.offsetNode,r.offset),n.setEnd(r.offsetNode,r.offset))}else if(document.body.createTextRange){var i=this.getSelectionRangeNative(),a=document.body.createTextRange();try{a.moveToPoint(e,t),a.select(),n=this.getSelectionRangeNative(),this.setSelectionRange(i)}catch(o){}}else try{s.Z.PAssert(245,!1,"Unable to get selection range at cursor")}catch(l){s.Z.reportError(l)}return n}},{key:"_getPreviousComponentNode",value:function(e){var t=e.previousSibling;return t&&!this._isComponentNode(t)&&1===t.childNodes.length&&this._isComponentNode(t.childNodes[0])&&(t=t.childNodes[0]),t}},{key:"_ensureSelectionInElement",value:function(e,t){try{s.Z.PAssert(246,e,"Must have a valid element")}catch(i){s.Z.reportError(i)}try{s.Z.PAssert(247,t,"Must have a valid range")}catch(i){s.Z.reportError(i)}if(s.Z.isAncestor(t.startContainer,e)||t.setStart(e,0),s.Z.isAncestor(t.endContainer,e)||t.setEnd(e,0),s.Z.findParent(t.startContainer,"itemIgnoreText",2)){var n=this._getPreviousComponentNode(t.startContainer);n&&t.setStart(n,n.textContent.length)}if(s.Z.findParent(t.endContainer,"itemIgnoreText",2)){var r=this._getPreviousComponentNode(t.endContainer);r&&t.setEnd(r,r.textContent.length)}}},{key:"getSelectOffsetsInElement",value:function(e,t){var n={start:0,end:0,total:0};if("TEXTAREA"===e.nodeName){n.start=e.selectionStart,n.end=e.selectionEnd,n.total=e.value.length;var r=e.value.indexOf("\n");r>=0&&n.start>r&&(n.start--,n.end--,n.total--)}else if(e){try{s.Z.PAssert(248,t,"Must provide a valid range")}catch(m){s.Z.reportError(m)}if(t){this._ensureSelectionInElement(e,t);var i=this._getComponentNodeInfo(t.startContainer,t.startOffset),a=i.node,o=i.offset,c=this._getComponentNodeInfo(t.endContainer,t.endOffset),l=c.node,d=c.offset;!a||a.textContent!==u.Z.TextSpace&&0!==a.textContent.length||(o=0),!l||l.textContent!==u.Z.TextSpace&&0!==l.textContent.length||(d=0);var h=0,p=this._getComponentNodesIn(e);if(p.length>0)for(var f=0,g=0;g<p.length;++g){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;p[g]===a&&(n.start=h+o),p[g]===l&&(n.end=h+d),h+=this._getComponentNodeLength(p[g]),void 0===l&&(g===d-1?n.end=h:0===g&&0===d&&(n.end=0)),void 0===a&&(g===o-1?n.start=h:0===g&&0===o&&(n.start=0))}else n.start=0,n.end=0;n.total=h,isNaN(n.end)&&(n.end=h),n.start>n.total&&(n.start=n.total),n.end>n.total&&(n.end=n.total)}}try{s.Z.PAssert(249,!isNaN(n.start)&&!isNaN(n.end),"Must have valid start and end",n)}catch(m){s.Z.reportError(m)}return n}},{key:"getSelectOffsetsForMouseEvent",value:function(e){var t=s.Z.getElementParent(e.target),n=this.getCursorSelectionRange(e);return n&&n.getSelectOffsetsInElement(t)}},{key:"getOffsetChildElement",value:function(e,t){try{s.Z.PAssert(250,e,"Must supply a valid element")}catch(c){s.Z.reportError(c)}if("TEXTAREA"===e.nodeName)return{element:e,offset:t};if(this._isComponentNode(e)){try{s.Z.PAssert(252,this._isComponentSelectable(e),"Component must be selectable")}catch(c){s.Z.reportError(c)}return{element:e,offset:t}}for(var n=0,r=0,i=this._getComponentNodesIn(e),a=0;a<i.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=this._getComponentNodeLength(i[a]);if(r+o>=t)return{element:i[a],offset:t-r};r+=o}try{s.Z.PAssert(251,0===t,"Unable to find offset child element")}catch(c){s.Z.reportError(c)}return{element:e,offset:t}}},{key:"getChildNodeOffset",value:function(e,t){var n=0;try{s.Z.PAssert(253,e,"Must supply a valid child element")}catch(c){s.Z.reportError(c)}for(var r=0,i=this._getComponentNodesIn(s.Z.getElementParent(e),t),a=this._getComponentNodesIn(e,t),o=0;o<i.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(i[o]===a[0])break;r+=this._getComponentNodeLength(i[o])}return r}},{key:"_getComponentNodeLength",value:function(e){try{s.Z.PAssert(254,this._isComponentNode(e),"Supplied node must be a valid component")}catch(t){s.Z.reportError(t)}return s.Z.hasClass(e,"mdImageWrapper")||1===e.length&&e.textContent===u.Z.TextSpace?0:"svg"===e.nodeName?1:e.textContent.replace(u.Z.TextSpace,"").length}},{key:"_getComponentNodesIn",value:function(e,t){if(this._isComponentNode(e,t))return[e];var n=[];return this._getComponentNodes(n,e,t),n}},{key:"_isComponentNode",value:function(e,t){var n=!1;return!e||s.Z.findParent(e,"itemIgnoreText",2)||t&&s.Z.findParent(e,"prefixNew",2)||(e.nodeType===Node.TEXT_NODE||s.Z.hasClass(e,"mdImageWrapper"))&&(n=!0),n}},{key:"_isComponentSelectable",value:function(e){try{s.Z.PAssert(255,!e||this._isComponentNode(e),"Must either be an invalid node (not-selectable) or a component")}catch(n){s.Z.reportError(n)}var t=!1;return e&&e.nodeType===Node.TEXT_NODE&&(t=!0),t}},{key:"_getComponentNodes",value:function(e,t,n){if(t)if(this._isComponentNode(t,n))e.push(t);else if(!s.Z.hasClass(t,"itemTime")&&t.childNodes)for(var r=0,i=0;i<t.childNodes.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=t.childNodes[i];this._getComponentNodes(e,a,n)}}},{key:"_getComponentNodeInfo",value:function(e,t,n){if(this._isComponentNode(e))return{node:e,offset:t};var r,i=e.firstChild;if(i){var a=0;do{if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i.nodeType===Node.TEXT_NODE&&1===t&&(t=i.textContent.length),r=this._getComponentNodeInfo(i,t,!0),i=i.nextSibling}while(!r&&i)}return r||!n&&{node:e,offset:t}}},{key:"setSelectionValues",value:function(e,t,n,r,i){try{s.Z.PAssert(256,e,"Range must be supplied")}catch(a){s.Z.reportError(a)}try{s.Z.PAssert(257,this._isComponentNode(t),"Must be selecting a valid component")}catch(a){s.Z.reportError(a)}try{s.Z.PAssert(258,this._isComponentNode(r),"Must be selecting a valid component")}catch(a){s.Z.reportError(a)}try{s.Z.PAssert(259,t!==r||n<=i,"Select elements must be different, or selection must start before it ends")}catch(a){s.Z.reportError(a)}if(t.nodeType===Node.TEXT_NODE)e.setStart(t,n);else{try{s.Z.PAssert(260,s.Z.hasClass(t,"plugin"),"Only other valid component is plugin")}catch(a){s.Z.reportError(a)}try{s.Z.PAssert(261,0===n||1===n,"Must eiter be selecting before or after the plugin")}catch(a){s.Z.reportError(a)}0===n?this._selectBeforeComponent(e,t,"setStart"):1===n&&this._selectAfterComponent(e,t,"setStart")}if(r.nodeType===Node.TEXT_NODE)e.setEnd(r,i);else{try{s.Z.PAssert(262,s.Z.hasClass(r,"plugin"),"Only other valid component is plugin")}catch(a){s.Z.reportError(a)}try{s.Z.PAssert(263,0===i||1===i,"Must eiter be selecting before or after the plugin")}catch(a){s.Z.reportError(a)}0===i?this._selectBeforeComponent(e,r,"setEnd"):1===i&&this._selectAfterComponent(e,r,"setEnd")}s.Z.shouldLog(u.Z.LogLevels.Selection)&&s.Z.log("Set Selection: ["+n+","+i+"] - [",t+","+r+"]")}},{key:"_selectBeforeComponent",value:function(e,t,n){var r=this._getPrevComponent(t);if(this._isComponentSelectable(r))e[n](r,this._getComponentNodeLength(r));else{var i=document.createTextNode("");t.parentNode.insertBefore(i,t),e[n](i,0)}}},{key:"_selectAfterComponent",value:function(e,t,n){var r=this._getNextComponent(t);if(this._isComponentSelectable(r))e[n](r,0);else{var i=document.createTextNode("");t.parentNode.insertBefore(i,void 0),e[n](i,0)}}},{key:"_getPrevComponent",value:function(e){try{s.Z.PAssert(264,e,"Must supply a valid node")}catch(n){s.Z.reportError(n)}try{s.Z.PAssert(265,this._isComponentNode(e),"Supplied node must be a valid component itself")}catch(n){s.Z.reportError(n)}var t=e.previousSibling;try{s.Z.PAssert(266,!t||this._isComponentNode(t),"Siblings must always be valid components")}catch(n){s.Z.reportError(n)}return t}},{key:"_getNextComponent",value:function(e){try{s.Z.PAssert(267,e,"Must supply a valid node")}catch(n){s.Z.reportError(n)}try{s.Z.PAssert(268,this._isComponentNode(e),"Supplied node must be a valid component itself")}catch(n){s.Z.reportError(n)}var t=e.nextSibling;try{s.Z.PAssert(269,!t||this._isComponentNode(t),"Siblings must always be valid components")}catch(n){s.Z.reportError(n)}return t}},{key:"createRange",value:function(e,t,n){var r;if(isNaN(n)&&(n=t),isNaN(t))(r=this.createSelectionRange()).selectNodeContents(e);else{var i,a=this.getOffsetChildElement(e,t),o=t!==n?this.getOffsetChildElement(e,n):a;if(a)r=null===(i=this.createFakeRange(a.element,a.offset,o.element,o.offset))||void 0===i?void 0:i.getNativeRange()}return r}},{key:"selectElement",value:function(e,t,n){var r=this.createRange(e,t,n);return r&&this.setSelectionRange(r),r}},{key:"getSelectionInElement",value:function(e){var t=this.getSelectionRangeNative();if(t&&s.Z.isAncestor(t.startContainer,e)&&s.Z.isAncestor(t.endContainer,e))return this.getSelectOffsetsInElement(e,t)}},{key:"deleteRangeContents",value:function(){var e=this.getSelectionRangeNative();e&&e.deleteContents()}}]),e}())},5215:(e,t,n)=>{"use strict";n.d(t,{Z:()=>P});var r,i=n(319),a=n.n(i),o=n(3038),s=n.n(o),c=n(4575),l=n.n(c),u=n(3913),d=n.n(u),h=n(3124),p=n.n(h),f=n(8572),g=n(8855),m=n(9295),v=n(8651),y=n(7100),k=n(4472),_=n(4654),Z=n(4327),w=n(1392),b=n(3868);const P=new(r=function(){function e(){l()(this,e),Z.Z.listen("selectionChanged",this.onSelectionChange),document.addEventListener("keydown",this.onKeyDown)}return d()(e,[{key:"onKeyDown",value:function(e){var t=k.Z.pane.get();if(k.Z.isValid()||null===t||void 0===t||!t.isEditable||-1!==t.indexOfFirstItem()||t.search.isFocused.get()||(t.addItem({text:""}),k.Z.selectIndex(0,0)),k.Z.isValid()){var n;if(!_.default.settings.showMarkdown.get()&&(y.Z.mac&&e.metaKey&&!e.ctrlKey&&!e.altKey||!y.Z.mac&&e.ctrlKey&&!e.altKey))if(e.normCode===g.Z.KeyCode.B?n="bold":e.normCode===g.Z.KeyCode.I?n="italic":e.normCode===g.Z.KeyCode.U?n="underline":e.normCode===g.Z.KeyCode.X&&e.shiftKey&&(n="strike"),n){var r=k.Z.getStartObject(),i=k.Z.getEndObject(),a=k.Z.getStartOffset(),o=k.Z.getEndOffset();if(this.formatHint||(this.formatHint={}),this.formatHint[n]=!0,r===i&&a===o&&a>0&&r.item.getParsedTextWithoutPrefix().length>0){var s=r.item.elsNew.elementAtOffset(r,a-1);s&&s.props[n]&&(this.formatHint[n]=!1)}}e.normCode===g.Z.KeyCode.Enter?(_.default.onIntroAction("AddItem"),_.default.onIntroAction("Import")):e.normCode===g.Z.KeyCode.Slash&&k.Z.isValid()&&0===k.Z.getStartOffset()&&0===k.Z.getStartTotal()&&k.Z.getStartIndex()===k.Z.getEndIndex()&&_.default.onIntroAction("SlashHelp")}}},{key:"onSelectionChange",value:function(){this.formatHint=void 0}},{key:"getSelection",value:function(e,t,n,r,i){for(var a,o,s,c,l,u,d,h,p,f,g=0,m=e.item,v=(i||m.elsNew).elements,y=null===(a=e.showMarkdown)||void 0===a?void 0:a.call(e),k=0,_=0;_<v.length;_++){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;var Z=v[_],w=Z.getStyledText(m,{showMarkdown:y}).length,b=_===v.length-1;if(w&&!Z.props.prefixType){var P=r||Z.isEditable();if(f=Z,c=k,d=_,P&&!h&&(b||t>=k&&t<k+w)&&(h=Z,o=k,l=_),P&&!p&&h&&(b||n>=k&&n<=k+w)){p=Z,s=k,u=_;break}k+=w}}return h?p||(p=f,s=c,u=d):(h=p=f,o=s=c,l=u=d),{startElement:h,startOffset:o,startIndex:l,endElement:p,endOffset:s,endIndex:u}}},{key:"setOffsetsBeforeInput",value:function(e){this.offsetsBeforeInput=e}},{key:"onInput",value:function(e,t){var n=this,r=e.showMarkdown(),i=e.item,o=i.elsNew.clone(),c=e.getDisplayTextWithoutPrefix(),l=(0,m.Kx)(c,t),u="",d=0;if(l.length>1){var h=0;if(!l[0].added&&!l[0].removed&&(l[1].added||l[1].removed)&&l[0].value===l[1].value){var p=l[0];l[0]=l[1],l[1]=p}for(var f=0;f<l.length;f++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var g=l[f];if(g.removed||g.added){var y=l[f-1],k=l[f+1];if(y&&k&&!y.removed&&!y.added&&v.Z.arrayAllValuesEqual(g.value,y.value[y.value.length-1])){var _=y.value.split(" "),Z=_[_.length-1];Z&&v.Z.arrayAllValuesEqual(g.value,Z[0])&&(k.value=_[_.length-1]+k.value,k.count=k.value.length,y.value=_.slice(0,-1).join(" ")+" ",y.count=y.value.length)}}}}var b=[];return l.forEach((function(t,c){var l=t.value,h=t.added,p=t.removed,f=t.count,g=f;if(p){var m=n.getSelection(e,d,d+f,!0,o),y=m.startElement,k=m.startOffset,_=m.startIndex,Z=m.endElement,P=m.endIndex,S=y.getStyledText(i,{showMarkdown:r}),D=d-k+f,I=D-S.length;if(y.isEditable()){var E=S.substr(0,d-k),x=S.substr(D);y.setText(E+x,r)}else y.setText("",r);if(I>0&&y!==Z){for(var C=0,A=_+1;A<P;A++){if(C++>5e3&&__infLoop&&__infLoop(C))throw new RangeError;o.elements[A].setText("",r)}var L=Z.getStyledText(i,{showMarkdown:r}).substr(I);Z.setText(L,r)}}else if(h){var M=n.getSelection(e,d,d,!0,o),T=M.startElement,R=M.startOffset,O=M.startIndex;r||null!==T&&void 0!==T&&T.props.tag||i.isPrefixCodeBlock()||(l=v.Z.escapeItemText(l));var F=d-R;if(null!==T&&void 0!==T&&T.isEditable()&&R+d>0)if(v.Z.isEmpty(n.formatHint))T.props.escaped&&(F*=2),T.spliceText(F,0,l);else{var N,B=T.split(e,d-R),U=s()(B,2),j=U[0],H=U[1],V=[j,new w.Z(l,n.formatHint),H].filter((function(e){return!!e}));(N=o.elements).splice.apply(N,[O,1].concat(a()(V)))}else 0===d?(u=l,g=0):(b.splice(0,0,{index:O+(F>0?1:0),text:l}),g=0)}p||(d+=g)})),b&&b.forEach((function(e){var t=e.index,n=e.text;o.elements.splice(t,0,new w.Z(n))})),i.getPrefix()+this.applyFormatHint(u,r)+o.withoutPrefix().getRawText(r)}},{key:"applyFormatHint",value:function(e,t){return this.formatHint?new b.Z([new w.Z(e,this.formatHint)]).getRawText(t):e}}]),e}(),p()(r.prototype,"onKeyDown",[f.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onKeyDown"),r.prototype),p()(r.prototype,"onSelectionChange",[f.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onSelectionChange"),r.prototype),r)},1998:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(9955),i=n(8651),a=n(8855),o=n(4654);const s={renderPlain:function(e){return e.hasField("title")?e.getField("title"):"Loading..."},renderPaneJSX:function(e){var t=e.item,n=e.pane,o=t.getAttachmentByPlugin(a.Z.PluginID.Drive);if(!o)return r.createElement("div",null);var s,c=o.getPlugin();o.isLoaded()?(s=o.getField("title"),o.hasField("isDeleted")&&o.getField("isDeleted")&&(s+="  (Deleted)")):(o.hasField("title")&&(s=o.getField("title")+"  (Loading...)"),o.isLocalOnlyAttachment()&&(s="Failed upload"),s="Loading...");var l=t.elsNew.findElement(e,(function(e){return!!e.props.plugin})),u=i.Z.classNames("paneDriveItem",null===l||void 0===l?void 0:l.el.props.plugin.displayElement.attrs.cls.join(" "),c.getCssClass(o,n));return r.createElement("div",{className:u},s)},renderStyled:function(e,t,n,r){if(e.isLoaded()){var i=e.getField("title");return r&&r.highlightSearch&&(i=o.default.ElementRenderer.replaceTextWithSearch(i,t)),e.hasField("isDeleted")&&e.getField("isDeleted")?i+"  (Deleted)":i}return e.hasField("title")?e.getField("title")+"  (Loading...)":e.isLocalOnlyAttachment()?"Failed upload":"Loading..."}}},3926:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(8651),i=n(9955),a=n(4654),o=n(8855),s=n(9603),c={renderPlain:function(e){if(e.isLoaded()){var t=e.getField("subject");return t&&""!==t||(t="(no subject)"),t}var n=e.getInlineData();return(null===n||void 0===n?void 0:n.subject)||(null===n||void 0===n?void 0:n.text)||"Loading..."},renderPaneJSX:function(e){var t,n=e.item,l=e.pane,u=n.getAttachmentByPlugin(o.Z.PluginID.Gmail),d=c.renderPlain(u),h=u.getPlugin(),p=h.getDisplayTags(u,l),f=h.getDisplayParticipants(u),g=u.getField("count"),m=u.hasField("snippet")&&u.getField("snippet"),v=r.Z.classNames("paneGmailItemContent flex flex-col justify-center border-b c-border-light"),y=u.getField("date");return t=s.Z.isToday(y)?a.default.International.getFormat(o.Z.DFormat.ShortTime):y.getYear()!==(new Date).getYear()?a.default.International.getFormat(o.Z.DFormat.MonthDayYearShort):a.default.International.getFormat(o.Z.DFormat.MonthDay),i.createElement("div",{className:v},i.createElement("div",{className:"flex flex-row justify-between line1"},i.createElement("div",{className:"from"},f),i.createElement("div",{className:"emailDate c-foreground-faded"},y.toString(t))),i.createElement("div",{className:"flex flex-row justify-between line2"},i.createElement("div",{className:"subject c-foreground"},d),i.createElement("div",{className:"flex items-center"},u.getField("hasAttachments")&&i.createElement("div",{className:"attach icon-attach_file"}),g>1&&i.createElement("div",{className:"count"},g))),i.createElement("div",{className:"flex flex-row justify-between line3"},m&&i.createElement("div",{className:"snippet c-foreground-faded"},u.getField("snippet")),(null===p||void 0===p?void 0:p.length)>0&&i.createElement("div",{className:"tags"},p.map((function(e){return i.createElement("span",{key:e,className:"emailLabel t-tag"},e)})))))},renderStyled:function(e,t,n,r){var i="";if(e&&e.isLoaded()){var l=e.getField("count"),u=e.getPlugin(),d=c.renderPlain(e);r&&r.highlightSearch&&(d=a.default.ElementRenderer.replaceTextWithSearch(d,t)),d='<span class="subject c-foreground">'+d+"</span>";var h=u.getDisplayTags(e,t);i+='<span class="line1"><span class="from">'+u.getDisplayParticipants(e)+"</span>";var p,f=e.getField("date");if(p=s.Z.isToday(f)?a.default.International.getFormat(o.Z.DFormat.ShortTime):f.getYear()!==(new Date).getYear()?a.default.International.getFormat(o.Z.DFormat.MonthDayYearShort):a.default.International.getFormat(o.Z.DFormat.MonthDay),i+='<span class="emailDate c-foreground-faded">'+f.toString(p)+"</span></span>",i+='<span class="line2">'+d,(e.getField("hasAttachments")||l>1)&&(i+='<span class="line2Right">',e.getField("hasAttachments")&&(i+='<span class="attach icon-attach_file"></span>'),l>1&&(i+='<span class="count">'+l+"</span>"),i+="</span>"),i+="</span>",e.hasField("snippet")||h.length){if(i+='<span class="line3">',e.hasField("snippet")&&(i+='<span class="snippet c-foreground-faded">'+e.getField("snippet")+"</span>"),h.length){var g=0;i+='<span class="tags">';for(var m=0;m<h.length;++m){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;i+='<span class="emailLabel t-tag">'+h[m]+"</span>"}i+="</span>"}i+="</span>"}}else{var v;i=(null===(v=e.getInlineData())||void 0===v?void 0:v.subject)||"Loading..."}return i}};const l=c},4372:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var r=n(7154),i=n.n(r),a=n(6479),o=n.n(a),s=n(8651),c=n(9955),l=n(4654),u=(n(9607),n(3234)),d=["pane","className","onMouseDown","dragOptions","multiselectIndex","onClick","onDoubleClick"];const h=(0,u.c)((0,c.forwardRef)((function(e,t){var n,r,a=e.pane,u=e.className,h=e.onMouseDown,p=e.dragOptions,f=e.multiselectIndex,g=e.onClick,m=e.onDoubleClick,v=o()(e,d);void 0!==f&&(n=function(e){a.onDoubleClick(f,e),g&&g(e)},r=function(e){a.onDoubleClick(f,e),m&&m(e)});var y={onTouchStart:function(e){var t=e.clientX||e.touches[0].clientX,n=e.clientY||e.touches[0].clientY,r=s.Z.findParent(e.target,"draggable"),i=c.createElement("div",Object.assign({className:u,key:0},v)),a=s.Z.offset(r),o=Object.assign(p,{items:[{id:p.id,element:i,item:p.item}],positionOffset:{x:t-a.left,y:n-a.top},mousePositionStart:{x:t,y:n}});l.default.DragDrop.checkDragStartNew(e,o,p.onDrop),h&&h(e)}};return c.createElement("div",i()({},v,{className:s.Z.classNames(u,"draggable")},y,{onClick:n||g,onDoubleClick:r||m,ref:t}))})))},7691:(e,t,n)=>{"use strict";n.d(t,{Z:()=>S});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(2205),c=n.n(s),l=n(8585),u=n.n(l),d=n(9754),h=n.n(d),p=n(8855),f=n(8651),g=n(9955),m=n(4472),v=n(4654),y=n(8276),k=n(4764),_=n(8778),Z=n(3656),w=n(404),b=n(5215);function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u()(this,n)}}const S=function(e){c()(n,e);var t=P(n);function n(){return i()(this,n),t.apply(this,arguments)}return o()(n,[{key:"init",value:function(){var e=this.props,t=e.item;e.renderLikePane&&(this.styleProps=t.styleProps(e.paneObject||{pane:e.pane},!1,!0)),this.refElement=(0,g.createRef)(),this.refEditable=(0,g.createRef)()}},{key:"onMount",value:function(){var e=this.props,t=e.item,n=e.pane,r=e.renderLikePane,i=e.padded,a=e.selectIndex,o=e.noFocusOnMount,s=e.editable;this.listenTo(t.itemChanged);try{f.Z.PAssert(1342,n||!r&&!i,"Should not use these props if no pane")}catch(c){f.Z.reportError(c)}if(s&&(document.addEventListener("selectionchange",this.onSelectionChange),!o)){this._needsSelect=isNaN(a)?t.getParsedTextWithoutPrefix().length:a;try{k.Z.selectElement(this.getEditable(),this._needsSelect)}catch(l){f.Z.reportError(l,{needsSelect:this._needsSelect,selectIndex:a,length:t.getParsedText().length})}}}},{key:"onUnmount",value:function(){document.removeEventListener("selectionchange",this.onSelectionChange)}},{key:"getEditable",value:function(){return this.refEditable.current}},{key:"getElement",value:function(){return this.refElement.current.getElement()}},{key:"getState",value:function(){var e=this.props,t=e.pane,n=e.item,r={flags:n.flags,renderLikePane:e.renderLikePane,styleProps:this.styleProps,hasPriority:e.showPriority&&!n.isComplete()&&n.getPriority()>0,isComplete:n.isComplete(),hasPrefix:n.hasPrefix(),date:n.getMooDate(),lines:[n.getStyledTextAsOneLine()]};return e.allowDrag&&(r.draggedInPane=n.draggedInPane,r.isBeingDragged=n.draggedInPane.get()===t),r}},{key:"getSelectionOffsets",value:function(){var e=k.Z.getSelectionRangeNative();if(e)return k.Z.getSelectOffsetsInElement(this.refEditable.current,e)}},{key:"onSelectionChange",value:function(){document.activeElement===this.refEditable.current&&(this.selection=this.getSelectionOffsets())}},{key:"focus",value:function(){var e=this.props.item.getParsedText().length;k.Z.selectElement(this.getEditable(),e)}},{key:"onFocus",value:function(){m.Z.reset()}},{key:"onKeyDown",value:function(e){var t=this.props,n=t.item;e.keyCode===p.Z.KeyCode.Backspace&&this.state.hasPrefix&&""===n.getParsedTextWithoutPrefix()&&n.setText("",!1!==t.shouldSave?p.Z.ChangeType.Local:p.Z.ChangeType.Auto),t.onKeyDown&&t.onKeyDown(e)}},{key:"onKeyPress",value:function(e){var t=this.props;if(t.onKeyPress&&(t.onKeyPress(e),!e.defaultPrevented)){var n=this.props.item,r=k.Z.getSelectionRangeNative(),i=k.Z.getSelectOffsetsInElement(e.target,r);if(this._needsSelect=void 0,i.start!==i.end){var a=n.getParsedText(),o=a.substr(0,i.start)+a.substr(i.end);n.setText(o,!1!==t.shouldSave?p.Z.ChangeType.Local:p.Z.ChangeType.Auto),this._needsSelect=i.start}}}},{key:"componentDidUpdate",value:function(){if(!isNaN(this._needsSelect)){var e,t=this.getEditable(),n=null===(e=window.getSelection())||void 0===e?void 0:e.focusNode;n&&f.Z.isAncestor(n,this.getEditable())&&k.Z.selectElement(t,Math.min(t.textContent.length,this._needsSelect)),this._needsSelect=void 0}}},{key:"stopResizing",value:function(){this.isResizing=!1}},{key:"onInput",value:function(e){var t=e.target;t.innerHTML.indexOf("<br")>=0&&(t.innerHTML=t.innerHTML.replace("<br/>","").replace("<br>",""));var n=this.props.item,r=f.Z.convertElementToText(t).replace(new RegExp(p.Z.TextSpace,"g"),""),i=k.Z.getSelectionRangeNative();if(i){var a=k.Z.getSelectOffsetsInElement(t,i),o=n.getPrefixLength();this._needsSelect=a.start;var s=b.Z.onInput({item:n,showMarkdown:function(){return!1},getDisplayTextWithoutPrefix:function(){return n.getDisplayText({showMarkdown:!1,noPrefix:!0})}},r);n.setText(s,p.Z.ChangeType.Local);var c=n.getPrefixLength()-o;this._needsSelect-=c,this.updateAutocomplete(),e.preventDefault()}}},{key:"updateAutocomplete",value:function(){var e=this.getEditable(),t=this.props.autocompleteMode;if(t){var n=k.Z.getSelectionInElement(e);if(n&&n.start===n.end){this.selectionBeforeDate=f.Z.clone(n);var r=this.props.item,i=r.getPrefixLength();n.start-=i,n.end-=i,n.total-=i,_.Z.update({mode:t,text:f.Z.convertElementToText(e).replace(new RegExp(p.Z.TextSpace,"g"),""),offset:n.start,paneObject:this.props.paneObject,item:r,owner:this,pane:this.props.pane,positionOffset:this.props.positionOffset,elementDisplay:e,elementInput:e,onDatePickerClosed:this.onDatePickerClosed,supportSearchItemAutocomplete:this.props.supportSearchItemAutocomplete})}}}},{key:"onDatePickerClosed",value:function(){var e=this.getEditable();if(this.props.item.getRawText().includes(p.Z.CharDate)){var t=this.props.item.getParsedText();t.length>0&&t!==p.Z.TextSpace&&requestAnimationFrame((function(){e.focus(),k.Z.selectElement(e,e.textContent.length)}))}else if(this.selectionBeforeDate){var n=this.selectionBeforeDate,r=n.start,i=n.end;k.Z.selectElement(e,r,i)}}},{key:"onAutocompleteSelected",value:function(e){var t=this;void 0!==e.value&&(this.props.item.setText(e.value,p.Z.ChangeType.Local),requestAnimationFrame((function(){k.Z.selectElement(t.getEditable(),e.offset)})))}},{key:"onClick",value:function(e){if(!this.isResizing){var t=this.props,n=t.item,r=t.pane,i=t.editOnClick,a=t.editable,o=t.inItemDetails;if(v.default.menus.isContextMenuOpen("ReactContextMenuContactDetails")&&v.default.menus.closeContextMenu("ReactContextMenuContactDetails"),i)e.preventDefault(),e.stopPropagation(),v.default.menus.isContextMenuOpen()&&v.default.menus.closeContextMenu(),v.default.menus.openContextMenu({componentName:"ReactItemDetailsPopup",element:e.target,item:n,pane:r});else{var s=!0;if((a||o)&&r){var c=n.elsNew.elements.find((function(e){return e.props.plugin}));c&&(s=!v.default.pluginManager.handleTapClick(c,{item:n,pane:r},e)),s&&f.Z.findParent(e.target,"inlineDate",2)&&v.default.menus.openDate({element:e.target,item:n,pane:r})}if(s&&!o&&f.Z.hasClass(e.target,"contact")){var l=e.target.textContent,u=Z.Z.findMatchExact(l[0]===p.Z.ContactPrefix?l.substr(1):l);u&&v.default.menus.openContextMenu({componentName:"ReactContextMenuContactDetails",element:e.target,contact:u})}}}}},{key:"onMouseDownResize",value:function(e,t){t.button===p.Z.ButtonCode.Left&&(this.isResizing=this.props.onItemResizeStart(this.props.item,this,e)),f.Z.preventDefault(t)}},{key:"onMouseDown",value:function(e){if(e.button===p.Z.ButtonCode.Left){var t=this.props,n=t.item;this.isResizing=!1,t.allowDrag&&n.checkDragOnStart(e)}}},{key:"onMouseMove",value:function(e){!this.isResizing&&this.props.allowDrag&&this.props.item.checkDragOnMove(e,!1)}},{key:"onMouseUp",value:function(e){!this.isResizing&&this.props.allowDrag&&this.props.item.checkDragOnEnd(e)}},{key:"onClickDate",value:function(){v.default.menus.openDate({element:this.getEditable(),item:this.props.item,pane:this.props.pane})}},{key:"onRightClick",value:function(e){var t=this.props;t.pane&&!1!==t.allowDrag&&(v.default.menus.openContextMenu({componentName:"ReactContextMenuItem",key:"contextMenuItem"+this.props.item.id,element:e.target,item:this.props.item,pane:this.props.pane,pos:{left:e.clientX,top:e.clientY},paneObject:this.props.paneObject}),e.preventDefault(),e.stopPropagation())}},{key:"getRenderedHTML",value:function(){var e=this.props.item;return v.default.ElementRenderer.renderNew(e.elsNew.elements,e,void 0,{noPrefix:!0})}},{key:"render",value:function(){var e=this.props,t=e.item,n=this.state,r=e.editable&&v.default.pluginManager.allowTextEditing(t),i=f.Z.classNames("reactItemWrapper flex items-center",e.className,n.hasPriority&&"hasPriority",e.coloredInCalendar&&"colored"),a=f.Z.classNames("item itemNotInPane f1",n.styleProps,{hasPrefix:n.hasPrefix},{"itemBeingDragged c-bg-light":n.isBeingDragged},{autoSelect:r},{complete:n.isComplete},{"c-bg-dark":n.isComplete&&e.coloredInCalendar}),o={};n.renderLikePane&&e.padding&&(o.paddingLeft=e.padding);var s,c=this.getRenderedHTML();if(e.style&&(o=f.Z.extend(e.style,o)),e.coloredInCalendar&&!n.isBeingDragged){if(!n.isComplete){var l,u=t.getCalendarColor();null!==(l=u)&&void 0!==l&&l.startsWith("#")&&(u="rgba(".concat(f.Z.hexToRgbStr(u),",0.75)")),o.backgroundColor=u}var d=t.getCalendarDisplayProps();if(d)for(var h in d.style)if(d.hasOwnProperty(h)){try{f.Z.PAssert(1343,!o[h],"Calendar display prop overwriting default styling")}catch(w){f.Z.reportError(w)}o[h]=d.style[h]}}if(this.state.date&&e.inItemDetails&&!this.props.item.getRawText().includes(p.Z.CharDate)){var m=this.state.date,k=m.isRepeatDate(),_=m.toText(!0),Z=f.Z.classNames("itemTime c-date pointer");s=g.createElement("div",{className:Z,onClick:this.onClickDate},m.getGCalId()&&g.createElement("i",{className:"icon-calendar"}),k&&g.createElement("i",{className:"icon-spinner"}),_)}return g.createElement(y.Z,{"data-moo-id":this.getUniqueID(),className:i,ref:this.refElement},e.showPrefix&&t.hasPrefix()&&v.default.ElementRenderer.renderPrefix(t,!1,0,0,0,!1,void 0),g.createElement("span",{className:a,style:o,contentEditable:r,onClick:e.editOnClick||r||e.inItemDetails?this.onClick:void 0,onKeyDown:r?this.onKeyDown:void 0,onKeyPress:r?this.onKeyPress:void 0,onInput:r?this.onInput:void 0,onMouseDown:r?void 0:this.onMouseDown,onMouseMove:r?void 0:this.onMouseMove,onMouseUp:r?void 0:this.onMouseUp,onContextMenu:this.onRightClick,onFocus:this.onFocus,tabIndex:e.tabIndex,dangerouslySetInnerHTML:{__html:c},ref:this.refEditable}),n.hasPriority&&g.createElement("div",{className:f.Z.classNames(t.getPriorityProps())}),s,e.resizable&&g.createElement(g.Fragment,null,g.createElement("div",{className:"absolute inset-x-0 top-0 h-2 pointer-events-auto cursor-row-resize",onMouseDown:this.onMouseDownResize.bind(this,!1)}),g.createElement("div",{className:"absolute inset-x-0 bottom-0 h-2 pointer-events-auto cursor-row-resize",onMouseDown:this.onMouseDownResize.bind(this,!0)})))}}]),n}(w.a)},3278:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(8855),i=n(8651),a=n(9955),o=n(4654),s=n(3234),c=/"/g;const l=(0,s.Z)((function(e){var t=e.item,n=e.displayLikePane,s=e.className,l=e.style,u=e.numberOfLines,d=e.highlightSearchText,h=e.displayParents,p=e.selected,f=o.default.ElementRenderer.renderToJSX(t,void 0,{highlightSearch:null===d||void 0===d?void 0:d.replace(c,"")}),g=i.Z.classNames("itemNotInPane itemNew whitespace-pre-wrap-break-words relative",{"overflow-hidden ellipsis":1===u},n&&t.styleProps({pane:n}),s),m=p?2:1,v=i.Z.classNames("text-11 pb-1 line-clamp",{"whitespace-pre overflow-hidden ellipsis c-foreground-light":!p},{"whitespace-pre-wrap-break-words line-clamp c-foreground-faded":p}),y={lineClamp:m,WebkitLineClamp:m},k=h&&t.parents(),_=i.Z.classNames({"line-clamp":u>1}),Z={lineClamp:u,WebkitLineClamp:u};return a.createElement("div",{className:g,style:l},!t.isComplete()&&t.getPriority()?a.createElement("div",{className:i.Z.classNames(t.getPriorityProps())}):void 0,h&&a.createElement("div",{className:v,style:y},k.length>0&&k.map((function(e){return i.Z.truncate(e.generateTitleText(),p?50:20)})).join(" > ")),a.createElement("div",{className:"flex items-center"},t.hasPrefix()&&o.default.ElementRenderer.renderPrefix(t,!1,14,r.Z.PrefixWidth,0,!1,""),a.createElement("div",{className:_,style:Z},f)))}))},6769:(e,t,n)=>{"use strict";n.d(t,{Z:()=>O});var r=n(8926),i=n.n(r),a=n(3038),o=n.n(a),s=n(7757),c=n.n(s),l=n(8855),u=n(8651),d=n(7100),h=n(9955),p=n(6877),f=n(4472),g=n(4654),m=n(8373),v=n(5193),y=n(7978),k=n(6604),_=n(404),Z=n(3234),w=n(3170),b=n(2694),P=n(8262),S=n(9713),D=n.n(S),I=n(8573);const E=(0,Z.Z)((function(e){var t,n,r=e.className,i=e.paneObject,a=e.component,s=e.onClick,c=e.isSelected,l=e.iconComponent,d=e.paddingLeft,p=(0,h.useState)(!1),f=o()(p,2),v=f[0],y=f[1],k=(0,h.useRef)(),_=i.item,Z=i.pane,b=(0,w.Z)(Z.item,null===_||void 0===_?void 0:_.itemChanged),P=o()(b,1)[0];void 0===d&&(d=_?Z.getPaddingForPaneObject(i):28);var S=_&&Z.isPaneObjectCollapsed(i),E=_&&Z.isItemHeader(_,!0),x=_&&Z.getOverview().isItemDragHovered(_);c=null!==(t=c)&&void 0!==t?t:_&&_===P;var C,A=x?null===(n=g.default.DragDrop.dragInfo)||void 0===n?void 0:n.position:void 0,L={paddingLeft:d+(_&&!E?28:0),fontSize:15},M=u.Z.classNames("overviewItem paneItemElement relative whitespace-nowrap cursor-pointer flex transition-colors duration-300 borderBox truncate t-overviewItem",r,I.Z.outer,{"selected ":v||c&&!x&&0!==A},D()({},I.Z.outerRadius,!x||0===A),{"c-background-item-selected":0===A},{"borderBox c-border-blue":x},D()({},I.Z.border+" "+I.Z.borderTop,-1===A),D()({},I.Z.border+" "+I.Z.borderBottom,1===A)),T=u.Z.classNames(I.Z.collapser);return C="hr"===i.type?h.createElement("div",{className:"c-border-heavy w-full my-1 "+I.Z.hr}):"button"===i.type?h.createElement("div",{className:"flexbox f1 truncate items-center "+I.Z.div,onMouseDown:u.Z.preventAndStop,onClick:s},l&&h.createElement(l,{className:I.Z.iconComponent}),h.createElement("span",{className:"truncate align-middle"},i.text)):h.createElement(a,{paneObject:i,onMouseDown:function(e){k.current=!1,_&&_.checkDragOnStart(e,!0)},onMouseLeave:function(){k.current=!0},setMenuOpen:y,didMouseLeave:k}),h.createElement("div",{style:L,className:M},E&&h.createElement(m.Z,{className:T,icon:S?"icon-angle-right":"icon-angle-down",tooltip:S?"Uncollapse":"Collapse",iconSize:14,width:28,height:28,onClick:function(){Z.setPaneObjectCollapsed(i,!Z.isPaneObjectCollapsed(i))}}),C)})),x=(0,Z.Z)((function(e){var t=e.paneObject,n=e.isSelected,r=e.onMouseDown,i=e.onMouseLeave,a=(e.setMenuOpen,e.didMouseLeave),o=t.item,s=t.pane;(0,w.Z)(o.itemChanged);var c=o.getUnstyledText(),l=u.Z.classNames("ib f1 font-medium truncate pr-2",I.Z.div,{"c-foreground-light":!n});return h.createElement("div",{className:l,dangerouslySetInnerHTML:{__html:c},onClick:function(){a.current||s.zoomIn(o)},onMouseDown:r,onMouseLeave:i,onContextMenu:function(e){u.Z.preventAndStop(e)}})})),C=(0,Z.Z)((function(e){var t=e.paneObject,n=e.isSelected,r=e.onMouseDown,i=e.onMouseLeave,a=(e.setMenuOpen,e.didMouseLeave),o=t.item,s=t.pane;(0,w.Z)(o.itemChanged);var c=o.getStyledTextAsOneLine(!1,!1,!0),l=u.Z.classNames("ib f1 font-medium truncate",I.Z.div,{"c-foreground-light":!n}),d=g.default.pluginManager.getPluginGmail().getIconInfoForLabel(o),f=d.icon,m=d.color,v=d.size,y=u.Z.classNames(I.Z.icon,"icon-"+f,{"c-foreground-light":!m}),k={color:m,fontSize:v};return"star"!==f&&"drafts"!==f||(k.textShadow="0 0 1px black"),h.createElement(h.Fragment,null,h.createElement("div",{className:I.Z.iconWrap+" text-center"},f&&h.createElement("i",{className:y,style:k}),!f&&h.createElement(p.yV_,{className:y,style:k})),h.createElement("div",{className:l,dangerouslySetInnerHTML:{__html:c},onClick:function(){a.current||s.zoomIn(o)},onMouseDown:r,onMouseLeave:i,onContextMenu:function(e){u.Z.preventAndStop(e)}}))}));n(9647),n(5428);const A=(0,Z.Z)((function(e){var t=e.paneObject,n=e.isSelected,r=e.onMouseDown,i=e.onMouseLeave,a=e.setMenuOpen,s=e.didMouseLeave,c=t.item,d=t.pane,p=c.getDocumentOwner(),f=c===p.getRootItem(),m=(0,w.Z)(f&&p.isSyncing,c.flags,f&&p.text,c.itemChanged),y=(o()(m,1)[0],f&&p.isLocalOnly(),c.getStyledTextAsOneLine(!1,!1,!0)),k=function(){s.current||(c.getDocumentOwner()!==d.getDocument()?(g.default.onIntroAction("ChangeDoc"),d.setDocument(c.getDocumentOwner(),{zoomItem:c})):d.zoomIn(c))},_=u.Z.classNames("ib f1 truncate",I.Z.div,{"font-bold":f},{"font-normal":!n&&!f});return h.createElement(h.Fragment,null,h.createElement("div",{className:_,dangerouslySetInnerHTML:{__html:y},onClick:k,onMouseDown:r,onMouseLeave:i,onContextMenu:f?function(e){!function(e){a(!0),g.default.menus.openContextMenu({fn:function(e){var t=e.element,n=c.getDocumentOwner(),r=n.isAdmin(),i=n.isLocalOnly(),a=n.isDeleted.get();return h.createElement(b.Z,{key:"contextMenuDocument",id:"contextMenuDocument",element:t},h.createElement(P.Z,{onClick:function(){d.collapseAllHeadersRecursive(!0)}},"Collapse all items"),h.createElement(P.Z,{onClick:function(){d.collapseAllHeadersRecursive(!1)}},"Expand all items"),h.createElement("hr",null),r&&h.createElement(h.Fragment,null,h.createElement(P.Z,{onClick:function(){g.default.menus.prompt({title:"Rename document",value:n.text.get(),cb:function(e){e&&(v.Z.renameDocument(n,e),c.itemChanged.notify())}})}},"Rename"),!i&&h.createElement(P.Z,{onClick:function(){g.default.menus.openModal(l.Z.Modals.ShareDoc,{doc:n})}},"Share"),!i&&h.createElement(P.Z,{onClick:function(){g.default.menus.openModal(l.Z.Modals.Backups,{doc:n})}},"Version History"),h.createElement("hr",null),a?h.createElement(P.Z,{onClick:function(){n.undelete()}},"Undelete"):h.createElement(P.Z,{onClick:function(){v.Z.getDocumentsArray().length>1?g.default.menus.confirm("Are you sure you want to delete ".concat(n.text.get(),"?"),(function(e){e&&n.delete()})):g.default.menus.alert({text:"Deleting the last document is not supported.",actionText:"OKAY"})}},"Delete")),!r&&h.createElement("div",{style:{padding:"12px 16px"}},"Please request Admin privelege on this document to modify it."))},element:e.target,onClosed:function(){a(!1)}})}(e),u.Z.preventAndStop(e)}:void 0}),!1,!1)}));var L=n(6950),M=function(e){return function(t){g.default.menus.openContextMenu({element:t.target,fn:function(t){var n=t.element;return h.createElement(b.Z,{key:"contextMenuDocument",id:"contextMenuDocument",element:n},e.map((function(e){return h.createElement(P.Z,{key:e.text,onClick:e.cb},e.text)})))}})}},T=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.noPadTop,r=t.isCollapsed,i=t.setCollapsed,a=t.options;return h.createElement("div",{className:u.Z.classNames("flexbox text-xs font-bold c-foreground-very-faded",{"pt-2":!n,"pl-4":!i}),style:{lineHeight:"28px"}},i&&h.createElement(m.Z,{icon:r?"icon-angle-right":"icon-angle-down",tooltip:r?"Uncollapse":"Collapse",iconSize:14,width:28,height:28,onClick:function(){return null===i||void 0===i?void 0:i(!r)}}),h.createElement("div",{className:"cursor-pointer f1",onClick:function(){return null===i||void 0===i?void 0:i(!r)}},e),a&&h.createElement(m.Z,{icon:"icon-more_horiz",width:28,height:28,iconSize:16,onClick:M(a),tooltip:"More options"}))},R=(0,Z.Z)((function(e){var t,n=e.pane,r=e.itemComponent,a=(0,h.useState)(!0),s=o()(a,2),u=s[0],d=s[1],f=(0,w.Z)(v.Z.documentsDeletedArray),m=o()(f,1)[0],_=(0,k.Z)(),Z=function(e){return function(){g.default.menus.confirm("Would you like to undelete ".concat(e.text.get(),"?"),(function(t){t&&(e.undelete(),n.setDocument(e,{zoomItem:e.getRootItem()}),_())}))}},b=function(e){return function(){g.default.menus.confirm("Would you like to undelete ".concat(e.info.text,"?"),function(){var t=i()(c().mark((function t(r){var i,a;return c().wrap((function(t){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(t.prev=t.next){case 0:if(!r){t.next=7;break}return i=g.default.toasts.pushMessage({text:"Downloading and restoring ".concat(e.info.text,"..."),hold:!0,noClose:!0}),t.next=4,y.Z.loadSingleDocument(e.info,!0);case 4:(a=t.sent)&&(a.undelete(),n.setDocument(a,{zoomItem:a.getRootItem()}),_()),g.default.toasts.clearMessage(i);case 7:case"end":return t.stop()}}}),t)})));return function(e){return t.apply(this,arguments)}}())}};if(n.type===l.Z.PaneMode.Task){var P=v.Z.getDeletedDocuments(),S=P.length+m.length;t=S>0&&h.createElement(h.Fragment,null,T("TRASH (".concat(S,")"),{noPadTop:!0,isCollapsed:u,setCollapsed:d}),!u&&P.map((function(e){return h.createElement(E,{key:e.id,className:"font-medium",paneObject:{pane:n,type:"button",text:e.text.get()},component:r,iconComponent:p.ZkW,onClick:Z(e)})})),!u&&m.map((function(e){return h.createElement(E,{key:e.info.id,className:"font-medium",paneObject:{pane:n,type:"button",text:e.info.text},component:r,iconComponent:p.ZkW,onClick:b(e)})})),h.createElement("div",{style:{height:36}}))}return h.createElement(h.Fragment,null,h.createElement("div",{className:"overviewBottomPad",style:{height:t?28:50}}),t)}));const O=(0,Z.Z)((function(e){var t,n=e.pane,r=e.className,a=(0,_.W)(),s=(0,h.useRef)(),k=(0,w.Z)(n.document,n.headerPaneObjects,v.Z.documentsEncryptedArray,n.item,n.viewState,g.default.settings.syncAccounts,v.Z.documentsArray),Z=o()(k,3),b=(Z[0],Z[1]),P=Z[2],S=n.type,D=(d.Z.isNativeApp(),S===l.Z.PaneMode.Task&&A||S===l.Z.PaneMode.Gmail&&C||S===l.Z.PaneMode.Drive&&x);if(S===l.Z.PaneMode.Gmail){var I=(0,w.Z)(n._overviewAccount),M=o()(I,1);t=M[0]}(0,h.useEffect)((function(){var e=n.item.get(),t=b.find((function(t){return t.item===e}));t&&s.current.scrollToIndex({index:t.index,align:"start",behavior:"auto",offset:30})}),[]);var O,F=function(e){return function(){n.zoomIn(n.getDefaultDisplayItem(e))}},N=function(e,t,n,r){return h.createElement("div",null,h.createElement(m.Z,{textAlign:"left",className:u.Z.classNames(e,"t-overviewItem"),style:{borderRadius:6},raised:!0,icon:n,height:30,padding:0,paddingText:6,paddingLeft:8,paddingRight:12,iconSize:14,fontWeight:500,onClick:r},t))},B=n.type;if(B===l.Z.PaneMode.Task)O=h.createElement(h.Fragment,null,!1,P.length>0&&h.createElement(h.Fragment,null,T("ENCRYPTED DOCUMENTS"),P.map((function(e){return h.createElement(E,{key:e.id,className:"font-medium",paneObject:{pane:n,type:"button",text:e.text},component:D,iconComponent:p.Tmq,onClick:(t=e,function(){var e;g.default.menus.promptComplex({title:"Enter password",text:"Please enter the password for this document: ".concat(t.text),fields:[{type:"password"}],validate:function(){var n=i()(c().mark((function n(r){var i,a,s;return c().wrap((function(n){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(n.prev=n.next){case 0:if(i=o()(r,1),!(a=i[0])){n.next=19;break}return n.prev=2,n.next=5,g.default.crypto.addKey({name:t.id,password:a,sentinelSalt:t.id});case 5:if(s=n.sent,t.encryptionSentinel!==s.sentinel){n.next=10;break}e=s.key,n.next=12;break;case 10:return g.default.crypto.removeKey(t.id),n.abrupt("return","The password was invalid. Please try again.");case 12:n.next=17;break;case 14:n.prev=14,n.t0=n.catch(2),console.log(n.t0);case 17:n.next=20;break;case 19:return n.abrupt("return","You must enter a password");case 20:case"end":return n.stop()}}}),n,null,[[2,14]])})));return function(e){return n.apply(this,arguments)}}(),callback:function(){e&&(g.default.settings.addEncryptionKey(t.id,e),y.Z.loadSingleDocument(t).then((function(e){e&&n.setDocument(e)})))}})})});var t}))),T("DOCUMENTS",!1));else if(B===l.Z.PaneMode.Drive)O=T("ACCOUNTS");else if(B===l.Z.PaneMode.Gmail){var U=g.default.pluginManager.getPluginGmail().getSyncAccounts();O=h.createElement(h.Fragment,null,U.length>1&&h.createElement(h.Fragment,null,T("ACCOUNTS"),U.map((function(e){return h.createElement(E,{key:e,paneObject:{pane:n,type:"button",text:e},isSelected:e===t,component:D,onClick:F(e)})}))),T("LABELS"))}else if(B===l.Z.PaneMode.Inbox){var j=(0,w.Z)(g.default.settings.emailViewAccounts,n.zoomedItem),H=o()(j,2),V=H[0],W=H[1],z=V.filter((function(e){return"g"===e.s})),q=W.accountID,G=W.label,K=n.pluginNew,Y=function(e){var t=e.accountID,r=e.service,i=e.indent,a=e.label,o=e.text;return h.createElement(E,{key:r+t,paneObject:{pane:n,type:"button",text:o||t},isSelected:t===q&&(!a||o&&a===G),paddingLeft:8+16*(i||0),onClick:function(){n.setAccountIDAndLabel(t,r,a||"inbox"),n.overview.setVisibility(!1)}})};O=h.createElement(h.Fragment,null,T("ACCOUNTS"),g.default.supportEmailViews()&&h.createElement(Y,{accountID:"All Accounts",service:"g"}),h.createElement(Y,{accountID:"Saved",service:"g"}),g.default.supportEmailViews()?h.createElement(h.Fragment,null,z.map((function(e){return h.createElement(h.Fragment,{key:e.e},h.createElement(Y,{accountID:e.e,service:e.s,label:"inbox"}),K.getLabels(e).map((function(t){return h.createElement(Y,{key:t,accountID:e.e,service:e.s,label:t,text:K.getLabelName(t),indent:1})})))})),g.default.supportEmailViews()&&0===z.length&&N("ml-2 mt-10","Add Sync Accounts","",(function(){return g.default.menus.openSettings("Email")}))):h.createElement(h.Fragment,null,h.createElement("div",{className:"mx-3 mt-10 leading-snug text-12 c-foreground-faded"},"The web version of Moo.do can only view emails you've saved with the Chrome Extension or Gmail Add-On, but the ",d.Z.getPlatformName()," app can sync emails directly from your Gmail inbox."),h.createElement("div",{className:"center"},N("mt-4","Download the App","",(function(){return u.Z.openUrl(d.Z.getAppDownloadURL())})))))}var X=u.Z.classNames(r,"paneOverviewScroller scroller f1"),Q=(0,h.useCallback)((function(e){return h.createElement(E,{paneObject:e,component:D})}),[D]),J=(0,h.useMemo)((function(){return h.createElement(R,{pane:n,itemComponent:D})}),[D,n]),$=u.Z.classNames("paneOverviewOutside h-full f1 flexbox flexvert fontPane select-none t-text");return h.createElement("div",{className:$,"data-moo-id":a,"data-pane-id":n.id,onMouseDownCapture:function(){f.Z.setFocusedPane(n)}},O,h.createElement(L.Z,{className:X,items:b,footer:J,renderItem:Q,defaultItemSize:28,overscan:l.Z.ListOverscan,shouldMemoize:!0,ref:s}))}))},1150:(e,t,n)=>{"use strict";n.d(t,{Z:()=>y});var r=n(3038),i=n.n(r),a=n(319),o=n.n(a),s=n(8855),c=n(8651),l=n(9955),u=n(4654),d=n(5193),h=n(3234),p=n(3170),f=n(2694),g=n(5657),m=n(8262),v=n(7691);const y=(0,h.Z)((function(e){var t,n=e.pane,r=n.getTitleList();p.Z.apply(void 0,[n.item,n.viewState,n.document,null===(t=n.document.get())||void 0===t?void 0:t.text].concat(o()(r.map((function(e){return e.itemChanged})))));var a,h=r.slice(0,r.length-1),y=r[r.length-1],k=(0,l.useRef)(),_=n.type===s.Z.PaneMode.Task&&!n.isViewCalendar(),Z=function(e){return function(){n.onClickTitle(e)}},w=h.length>0,b=function(e){return function(t){if(!e.parent()&&n.supportsDocuments){var r=n.getDocument(),i=d.Z.getDocumentsArray();u.default.menus.openContextMenu({element:t.target,fn:function(e){var t=e.element;return l.createElement(f.Z,{key:"contextMenuTitle",id:"contextMenuTitle",element:t,maxHeight:400},l.createElement(g.Z,{topHeader:!0},"Select document"),i.map((function(e){return l.createElement(m.Z,{key:e.id,active:e===r,onClick:function(){return n.setDocument(e)}},e.text.get())})))}}),u.default.onIntroAction("ChangeDoc")}else{var a=n.getItem(),o=e.parent()?e.parent().items.get():e.items.get();u.default.menus.openContextMenu({element:t.target,fn:function(e){var t=e.element;return l.createElement(f.Z,{key:"contextMenuTitle",id:"contextMenuTitle",element:t,maxHeight:400},l.createElement(g.Z,{topHeader:!0},n.titleContextMenuHeader),o.map((function(e){return l.createElement(m.Z,{key:e.id,active:e===a,onClick:function(){return n.onClickTitle(e)}},e.generateTitleText(n))})))}})}}};if(_)a=function(e){var t={fontSize:12,marginBottom:-1,paddingRight:36};return l.createElement("div",{className:c.Z.classNames("pt-6 pl-8"),ref:k},l.createElement("div",{className:"truncate f1"},n.usesVMLIs&&w&&l.createElement("div",{className:"pr-1 leading-snug whitespace-pre-wrap c-foreground-faded",style:t},h.map((function(e,t){return l.createElement(l.Fragment,{key:t},t>0&&l.createElement("span",{className:"px-2"},">"),l.createElement("span",{className:"cursor-pointer c-button",onClick:Z(e)},e.generateTitleText(n)))}))),n.usesVMLIs?l.createElement("div",{className:"pt-1 pr-8 font-bold cursor-pointer whitespace-pre-wrap-break-words t-paneHeading",onMouseDown:y.isRoot?b(y):void 0},y.isRoot?y.generateTitleText(n):l.createElement(v.Z,{key:y.id,item:y,pane:n,className:"cursor-text",editable:!0,renderLikePane:!0,noFocusOnMount:!0})):void 0))};else if(n.usesVMLIs){var P=c.Z.classNames("flex font-semibold whitespace-pre-wrap-break-words h-full"),S={paddingLeft:13,fontSize:13},D={paddingTop:9};a=function(){return l.createElement("div",{className:P,style:S},l.createElement("div",{className:"truncate cursor-pointer f1",style:D},h.map((function(e,t){return l.createElement(l.Fragment,{key:t},t>0&&l.createElement("span",{className:"px-2"},">"),l.createElement("span",{className:"cursor-pointer c-button",onClick:b(e)},e.generateTitleText(n)))})),h.length>0&&l.createElement("span",{className:"px-1 c-foreground-faded"}," - "),l.createElement("span",{onMouseDown:b(y)},y.generateTitleText(n))))}}else{var I=(0,p.Z)(n.titles),E=i()(I,1)[0],x={},C={paddingTop:9,paddingLeft:13};a=function(){return l.createElement("div",{className:"flex justify-end h-full",style:x},l.createElement("div",{className:"flex-1 font-bold text-13",style:C},l.createElement("span",{className:"cursor-pointer c-foreground-medium flexbox",onClick:function(){}},null===E||void 0===E?void 0:E.map((function(e,t){return l.createElement("div",{key:t,className:"truncate-pre",style:{maxWidth:E.length>0?190:void 0}},(t>0?" - ":"")+e)})))))}}return l.createElement("div",{className:c.Z.classNames("relative z-3","invisible")},a())}))},6950:(e,t,n)=>{"use strict";n.d(t,{Z:()=>D});var r=n(8855),i=n(3470),a=n(8651),o=n(7100),s=n(9955),c=n(5802),l=n(2971),u=n(3234),d=n(8478),h=n(6134),p=n(6604),f=function(e){e.current.scrollingTo=void 0},g=function(e,t,n){var r=0,i=e.current,a=i.header,o=i.items,s=i.defaultItemSize,c=t.current.sizes,l=0;a&&n++;for(var u=0;u<n;u++){var d;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var h=o[u];l+=null!==(d=c[null===h||void 0===h?void 0:h.id])&&void 0!==d?d:s}return l},m=function(e,t,n){var r=t.current,i=r.scrollingTo,o=r.sizes,s=r.containerSize,c=e.current,l=c.orientation,u=c.uniqueID,d=c.refScroller;if(void 0!==i){var h,p=i.align,m=i.index,v=i.behavior,y=i.offset,k=n.current,_=k.min,Z=k.max,w=0===m?0:g(e,t,m),b=e.current,P=b.items,S=b.header,D=b.defaultItemSize,I=P[m+(S?1:0)],E=null!==(h=o[null===I||void 0===I?void 0:I.id])&&void 0!==h?h:D;"auto"===p&&(p=function(e,t,n){return(e<=t?"start":e>=n&&"end")||void 0}(m,_,Z)),p&&("end"===p?w-=s.height-E-100:"center"===p&&(w=Math.max(w-(s.height/2-E),0,0)),w>=0&&(y&&(w-=y),w=Math.max(w,0),a.Z.scrollElementTo(d.current,{top:"vertical"===l?w:void 0,left:"horizontal"===l?w:void 0,behavior:v}))),a.Z.timeoutOnce("clearScrollingTo"+u,(function(){return f(t)}),300)}},v=function(e,t,n,r){t.current.scrollingTo=r,m(e,t,n)},y=function(e,t,n,r){var i=e.current,o=i.overscan,s=i.orientation,c=i.containerSize,l=i.items,u=i.defaultItemSize,d=i.refScroller,h=i.uniqueID,p=i.fixedSize,f=t.current,g=f.hasPendingItemChange,m=f.containerSize,v=f.sizes,y=f.prevScroll,k=d.current;if(k){var _=c||("vertical"===s?m.height:m.width),Z=n.current.totalSize,w=Z-_;if(void 0===r&&(r=a.Z.clamp(Math.max("vertical"===s?k.scrollTop:k.scrollLeft,0),0,w)),g||r!==y){var b,P,S,D,I=0;f.prevScroll=r;for(var E=0,x=0,C=Math.min(r+_,Z),A=r+_+o,L=r-o,M=l.length,T=p&&u,R=0;R<M;R++){var O;if(I++>5e3&&__infLoop&&__infLoop(I))throw new RangeError;var F=l[R],N=T||(null!==(O=v[F.id])&&void 0!==O?O:u);void 0===b&&E+N>=r&&(b=R),void 0===P&&E+N>=L&&(P=R,x=E),void 0===S&&E>C&&(S=R-1),void 0===D&&E>A&&(D=R-1),E+=N}if(void 0===S&&(S=M-1),void 0===D&&(D=M-1),!g&&b<n.current.min){for(var B=0,U={},j=Math.max(n.current.min-1,b),H=b;H<=j;H++){if(B++>5e3&&__infLoop&&__infLoop(B))throw new RangeError;U[l[H].id]=!0}f.scrolledUp=U}else f.scrolledUp=void 0;var V=n.current;if(g||!V||b<V.min||S>V.max)return a.Z.timeoutOnce("clearHasPendingItemChange"+h,(function(){t.current.hasPendingItemChange=!1}),500),{min:b,max:S,minOverscan:P,maxOverscan:D,marginTop:x,totalSize:E,scrollOffset:r}}}},k=function(e,t,n,r){var i=e.current,o=i.refScroller,s=i.refInside,c=i.uniqueID,l=i.initialScrollIndex,u=i.fixedSize,p=!0;if(t.current.containerSize=o.current.getBoundingClientRect(),!u){var g=new h.Z((function(r){if(r[0].target===s.current||r[0].target===o.current){var i=function(){for(var r=0,i=s.current.children,l=e.current,u=l.orientation,d=l.defaultItemSize,h=t.current,p=h.sizes,g=h.scrolledUp,v=h.scrollingTo,y=i.length,k=!1,_=0,Z=0;Z<y;Z++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var w,b=i[Z],P=b.getAttribute("data-id"),S=b.getBoundingClientRect(),D="vertical"===u?S.height:S.width;if(D!==p[P])g&&g[P]&&(_+=D-(null!==(w=p[P])&&void 0!==w?w:d)),k=!0,p[P]=D}return _>0&&(o.current.scrollTop+=_),k&&v&&(a.Z.timeoutOnce("clearScrollingTo"+c,(function(){return f(t)}),300),a.Z.timeoutOnce("adjustScrolling"+c,(function(){return m(e,t,n)}),60)),k}(),l=o.current.getBoundingClientRect(),u=l.width,d=l.height,h=t.current,g=h.containerSize,v=h.lastScrollTime;u!==g.width||d!==g.height?(h.hasPendingItemChange=!0,a.Z.animationFrameOnce("useItemsInView"+c,k),h.containerSize={width:u,height:d}):(p||i&&(!v||Date.now()-v>300))&&(p=!1,a.Z.animationFrameOnce("useItemsInView"+c,k))}}));g.observe(s.current),g.observe(o.current)}var k=function(i){var a=t.current;a.hasPendingItemChange||(a.lastScrollTime=Date.now());var o=y(e,t,n,i);o&&(n.current=o,(0,d.unstable_batchedUpdates)(r))};o.current.addEventListener("scroll",(function(){o.current&&(("vertical"===e.current.orientation?o.current.scrollTop:o.current.scrollLeft)!==t.current.prevScroll&&a.Z.animationFrameOnce("useItemsInView"+c,k))}),!0),t.current.hasPendingItemChange=!0,k(0),void 0!==l&&requestAnimationFrame((function(){v(e,t,n,{align:"start",behavior:"auto",index:l})}))};function _(e){var t=e.uniqueID,n=e.refScroller,r=e.refInside,i=e.items,a=e.allItems,o=e.defaultItemSize,u=e.initialScrollIndex,d=e.orientation,h=e.header,f=e.overscan,m=e.containerSize,_=e.fixedSize,Z=(0,l.Z)({items:i,overscan:f}),w=(0,s.useRef)({hasPendingItemChange:!1,sizes:{}}),b=(0,s.useRef)({}),P=(0,c.Z)({uniqueID:t,items:a,containerSize:m,defaultItemSize:o,orientation:d,overscan:f,refScroller:n,refInside:r,header:h,fixedSize:_,initialScrollIndex:u}),S=(0,p.Z)();!Z||Z.items===i&&Z.overscan===f||(w.current.hasPendingItemChange=!0,b.current=y(P,w,b)),(0,s.useEffect)((function(){return k(P,w,b,S)}),[]);var D=(0,s.useMemo)((function(){return{offsetById:function(e){return function(e,t,n){for(var r=0,i=e.current.items,a=t.current.sizes,o=i.length,s=0,c=0;c<o;c++){var l;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=i[c];if(u.id===n)return s;s+=null!==(l=a[u.id])&&void 0!==l?l:e.current.defaultItemSize}return-1}(P,w,e)},offsetByIndex:function(e){return g(P,w,e)},scrollToIndex:function(e){return v(P,w,b,e)}}}),[]);return Object.assign(D,{didItemsChange:w.current.hasPendingItemChange},b.current)}var Z="____ReactVirtualList____header",w="____ReactVirtualList____footer",b=0,P=(0,u.Z)((function(e){var t=e.item,n=e.rendered,a=e.shouldAnimate,o=t.id,c=!0===a||a(t);return s.createElement(i.E.div,{"data-id":o,className:"relative will-change-transform",layout:"position",transition:c?r.Z.TransitionSpringFastest:r.Z.TransitionImmediate},n)})),S=function(e,t,n,r){var i=e.current,a=i.header,o=i.footer,c=i.shouldMemoize,l=i.renderItem,u=i.children,d=i.items,h=i.shouldAnimate;var p=r-(a?1:0),f=c&&t.current[n.id];if(!f){var g=n.id===Z&&a||n.id===w&&o||(null===l||void 0===l?void 0:l(n,p,d))||u[p];f=h?s.createElement(P,{key:n.id,item:n,rendered:g,shouldAnimate:h}):s.createElement("div",{key:n.id,"data-id":n.id,className:"relative"},g),c&&(t.current[n.id]=f)}return f};const D=(0,u.c)((0,s.forwardRef)((function(e,t){var n=e.className,r=e.classNameInside,i=e.style,u=e.items,d=e.header,h=e.footer,p=e.floating,f=e.containerSize,g=e.renderItem,m=e.onRangeChanged,v=e.defaultItemSize,y=e.initialScrollIndex,k=e.shouldAnimate,P=e.onEndReached,D=e.orientation,I=e.overscan,E=e.shouldMemoize,x=e.pinIDs,C=e.fixedSize,A=e.children;var L=(0,s.useRef)(),M=(0,s.useRef)(),T=(0,s.useMemo)((function(){return b++}),[]),R=(0,l.Z)(k);!u&&A&&(u=s.Children.map(A,(function(e,t){return{id:t}})));var O=(0,c.Z)({header:d,footer:h,shouldMemoize:E,renderItem:g,items:u,children:A,shouldAnimate:k}),F=(0,s.useRef)({});D||(D="vertical");var N=(0,s.useMemo)((function(){var e=u;return d&&(e=[{id:Z}].concat(u)),h&&(e=e.concat({id:w})),e}),[u,d,h]),B=_({uniqueID:T,refScroller:L,refInside:M,items:u,allItems:N,defaultItemSize:v,initialScrollIndex:y,orientation:D,containerSize:f,header:!!d,overscan:I||0,fixedSize:C}),U=B.min,j=B.max,H=B.minOverscan,V=B.maxOverscan,W=B.marginTop,z=B.totalSize,q=B.scrollToIndex,G=B.didItemsChange,K=B.offsetById,Y=B.offsetByIndex;E&&(G||R!==k)&&(F.current={});var X=(0,l.Z)({min:U,max:j}),Q=(0,c.Z)({min:U,max:j,allItems:N});if(!X||X.min!==U||X.max!==j){var J=Math.max(0,U-(d?1:0)),$=Math.max(j-(d?1:0));m&&a.Z.animationFrameOnce("onRangeChanged"+T,(function(){return m({startIndex:J,endIndex:$})})),E&&a.Z.timeoutOnce("cullRendered"+T,(function(){return function(e,t){for(var n=0,r=e.current,i=r.min,a=r.max,o=r.allItems,s={},c=i;c<=a;c++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=o[c];l&&(s[l.id]=!0)}Object.keys(t.current).forEach((function(e){s[e]||delete t.current[e]}))}(Q,F)}),2e3)}P&&X&&X.max!==j&&j===N.length-1&&a.Z.animationFrameOnce("onEndReached"+T,(function(){return P(j)})),(0,s.useImperativeHandle)(t,(function(){return{scrollTo:function(e,t){return a.Z.scrollElementTo(L.current,{top:e,behavior:t})},scrollToIndex:q,offsetById:K,offsetByIndex:Y,getScrollOffset:function(){var e;return(null===(e=L.current)||void 0===e?void 0:e.scrollTop)||0}}}),[]);var ee,te,ne=[];if(void 0!==H&&void 0!==V){for(var re=0,ie=null===x||void 0===x?void 0:x.slice(),ae=H;ae<=V;ae++){if(re++>5e3&&__infLoop&&__infLoop(re))throw new RangeError;var oe=N[ae];oe&&(ne.push(S(O,F,oe,ae)),ie&&ie.includes(oe.id)&&ie.remove(oe.id))}(null===ie||void 0===ie?void 0:ie.length)>0&&ie.forEach((function(e,t){var n=N.find((function(t){return t.id===e}));n&&ne.push(S(O,F,n,V+1+t))})),ee={transform:"translate(0px, ".concat(W,"px)")},te={width:"horizontal"===D?z:1,height:"vertical"===D?z:1,zIndex:-1,top:0}}var se=a.Z.classNames("overflow-y-auto h-full relative",{"overflow-y-mobile":o.Z.isMobile},n);return s.createElement("div",{className:se,style:i,ref:L},s.createElement("div",{className:a.Z.classNames("pointer-events-auto",r),style:ee,ref:M},ne),s.createElement("div",{className:"absolute",style:te}),p)})))},6134:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(6254);const i=window.ResizeObserver||r.do},4472:(e,t,n)=>{"use strict";n.d(t,{Z:()=>V});var r=n(319),i=n.n(r),a=n(9713),o=n.n(a),s=n(4575),c=n.n(s),l=n(3913),u=n.n(l),d=n(1506),h=n.n(d),p=n(6525),f=n.n(p),g=n(2205),m=n.n(g),v=n(8585),y=n.n(v),k=n(9754),_=n.n(k),Z=n(3124),w=n.n(Z),b=n(8572),P=n(8855),S=n(8651),D=n(7100),I=n(4654),E=n(1015),x=n(4327),C=[" ","-","/","[","]","(",")","*","_","@",".",":"];const A=new(function(){function e(){c()(this,e)}return u()(e,[{key:"getPreviousWord",value:function(e,t){var n=0,r=e.getDisplayTextWithoutPrefix();t<0&&(t=r.length);for(var i=t-1;i>=0;i--){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i];if(S.Z.shouldLog(P.Z.LogLevels.Edit)&&console.log(i,a),C.indexOf(a)>=0&&this.isElementEditable(e,i))return i}return-1}},{key:"getNextWord",value:function(e,t){for(var n=0,r=e.getDisplayTextWithoutPrefix(),i=t+1;i<r.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i];if(C.indexOf(a)>=0&&this.isElementEditable(e,i))return i}return r.length}},{key:"isElementEditable",value:function(e,t){return e.item.elsNew.isElementAtOffsetEditable(e,t)}}]),e}());const L=new(function(){function e(){c()(this,e),this.listeners={}}return u()(e,[{key:"onEvent",value:function(e,t,n){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push({persistent:n,cb:t})}},{key:"offEvent",value:function(e,t){if(this.listeners[e]){var n=this.listeners[e].indexOfWithProperty("cb",t);n>=0&&this.listeners[e].removeAt(n)}}},{key:"hasEvent",value:function(e,t){return this.listeners[e].indexOfWithProperty("cb",t)>=0}},{key:"fireEvent",value:function(e){var t=this.listeners[e];if(t){for(var n=0,r=0,i=0,a=arguments.length,o=new Array(a>1?a-1:0),s=1;s<a;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;o[s-1]=arguments[s]}for(var c=t.length-1;c>=0;c--){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=t[c];l.cb.apply(l,o),l.persistent||t.splice(c,1)}}}}]),e}());var M=n(9607),T=n(7274),R=n(8001);const O=function(){function e(){c()(this,e),this.pane=new T.Z}return u()(e,[{key:"setSelectedPaneObject",value:function(e){}},{key:"scrollStartIntoView",value:function(){}},{key:"scrollEndIntoView",value:function(){}},{key:"updateCaret",value:function(){}},{key:"checkValid",value:function(){}},{key:"getPane",value:function(){try{S.Z.PAssert(446,this.pane.get()===S.Z.focusedPane,"Should these always match?")}catch(e){S.Z.reportError(e)}return this.pane.get()}},{key:"setFocusedPane",value:function(e){S.Z.focusedPane=e,this.pane.set(e)}},{key:"applyFormatToSelection",value:function(e,t){var n=this,r=!1,i=0,a=!1,o=this.getStartOffset(),s=this.getEndOffset();if(S.Z.focusedPane.applyToSelection((function(t,o,s,c){var l=0===o?n.getStartOffset():0,u=o===s-1?n.getEndOffset():t.getParsedText().length;if(0===o){var d=t.elsNew.elementInfoAtOffset(c,l).el;d&&(a=!!d.props[e])}var h=t.applyFormatToSelection(e,c,l,u,0===o?"toggle":r?"yes":"no");if(r=h,0===o&&c.showMarkdown()){var p=("bold"===e||"underline"===e||"strike"===e||"highlight"===e?2:("italic"===e||"code"===e)&&1)||0;0,i=h&&!a&&p||!h&&a&&-p||0}})),i){var c=function(){n.selectIndices(n.getStartIndex(),o+i,n.getEndIndex(),s+i)};t?requestAnimationFrame(c):c()}else this.updateCaret()}},{key:"applyPrefixToSelection",value:function(e,t){var n;if(this.isValid()&&(n=this.getStartItem().getPrefixLength()),t)e=t.prefix===e?null:e,t.setPrefix(e);else{var r=!0;S.Z.focusedPane.applyToSelection((function(t){if(t.prefix!==e)return r=!1,!1})),r&&(e=null),S.Z.focusedPane.applyFnToSelection("setPrefix",{value:e,noRestoreSel:!0})}isNaN(n)||this.updateCaret()}},{key:"selectIndex",value:function(e,t,n,r){return void 0===n&&(n=t),this.selectIndices(e,t,e,n,r)}}]),e}();var F,N=n(3205),B=n(4764);function U(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=_()(e);if(t){var i=_()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return y()(this,n)}}var j=[["ignoreSel",!0],"mdImageResizer","emptyItemAddButton",["itemNotInPane",!0],"itemCheckbox","itemPrefix","itemPrefixNew",["searchWrap",!0],"collapserNew","itemMenuIcon",["formattingToolbar",!0],"itemTime","paneFooter","fab",["inlineDate",!0],["itemLink",!0],["plugin",!0],["dropBucket",!0]],H=["contact","tag","inlineDate"];j.pushArray(H);const V=new(F=function(e){m()(r,e);var t=U(r);function r(){var e;c()(this,r),(e=t.call(this))._isValid=!1,e._isDirty=!1,e._isWatchingChange=!0,e._isMouseDown=!1,e._isTouchDown=!1,e.modifiersDown={},e.isWindowFocused=new T.Z(!0),e._previousSelectedObject=void 0,e._previousIsValid=void 0,e._previousSelectedMap={},e._selectedMap={},e.selectedMapObs=new T.Z(e._selectedMap),e.mouseHandlers=[],e.mousePos={x:-1,y:-1},e.mouseDownPos={x:-1,y:-1},e._downOffset={start:0,end:0},e._lastClickTime=0,e._numClicks=0,e._isMouseDownDisabled=!1,e._savedPaneSels={};var n={};return n.onStart=e.handleMouseDown,n.onEnd=e.handleMouseUp,n.onRightStart=e.handleRightMouseDown,n.onMove=e.handleMouseMove,document.addEventListener("mousemove",e.handleMouseMoveDocument,!0),window.addEventListener("blur",e.onWindowBlur),window.addEventListener("focus",e.onWindowFocus),document.addEventListener("touchstart",(function(){e._isTouchDown=!0}),!0),document.addEventListener("touchend",(function(t){0===t.touches.length&&(e._isTouchDown=!1,L.fireEvent("SelOnTouchUp"))}),!0),document.addEventListener("keydown",(function(t){e.setModifiersDown(t.ctrlKey,t.metaKey,t.altKey,t.shiftKey)})),document.addEventListener("keyup",(function(){e.setModifiersDown()})),S.Z.setupClick(document,h()(e),n),x.Z.listen("paneAdded",e.onPaneAdded.bind(h()(e))),x.Z.listen("paneRemoved",e.onPaneRemoved.bind(h()(e))),e}return u()(r,[{key:"reset",value:function(e,t){if(this._isValid){S.Z.shouldLog(P.Z.LogLevels.Selection)&&S.Z.log("Sel::reset");var n=!t&&this.save();n&&(this._previousSelection=n),this._selectedMap={},this._dblClickOffsets=void 0,this.isMultiselecting=!1,this._isValid=!1,this.isKeyboardOpen=!1,this.noUnstickMatches=e,this._isArrowSelectInverted=!1;var r=this.getPane();!r||r.isUnloaded()||r.isDestroyed()||(this._isDirty=!0,this._updateSelection(),this.updateHiddenInput())}}},{key:"getPreviousSelection",value:function(){return this._previousSelection}},{key:"dumpState",value:function(){var e={isValid:this._isValid,isDirty:this._isDirty,isWatchingChange:this._isWatchingChange,isMouseDown:this._isMouseDown,isWindowFocused:this.isWindowFocused.get(),numClicks:this._numClicks,start:{index:this.getStartIndex(),offset:this.getStartOffset()},end:{index:this.getEndIndex(),offset:this.getEndOffset()}};try{var t=!!this.pane.get();e.paneInfo=t?{hasPane:t,id:this.pane.get().id,numItems:this.pane.get().items.get().length,displayTop:this.pane.get().indexOfTop()}:"No Pane Set"}catch(n){e.paneInfo="Invalid Pane"}try{void 0!==this.getStartIndex()&&(e.start.item=this.pane.get().items.get()[this.getStartIndex()].id)}catch(n){e.start.item="Invalid Item"}try{void 0!==this.getEndIndex()&&(e.end.item=this.pane.get().items.get()[this.getEndIndex()].id)}catch(n){e.end.item="Invalid Item"}return e}},{key:"setValid",value:function(e){if(e){try{S.Z.PAssert(160,!isNaN(this.getStartIndex())&&this.getStartIndex()>=0,"Must have a valid start index when sel is valid: ",this.getStartIndex())}catch(r){S.Z.reportError(r)}try{S.Z.PAssert(161,!isNaN(this.getEndIndex())&&this.getEndIndex()>=0,"Must have a valid end index when sel is valid: ",this.getEndIndex())}catch(r){S.Z.reportError(r)}try{if(this.getStartObject()instanceof R.Z){var t=this.pane.get().items.get()[this.getStartIndex()];try{S.Z.PAssert(162,t&&(S.Z.isVMLI(t)||S.Z.isVMLI(t.item)),"Valid selection must always be into a VMLI for start item")}catch(r){S.Z.reportError(r)}var n=this.pane.get().items.get()[this.getEndIndex()];try{S.Z.PAssert(163,n&&(S.Z.isVMLI(n)||S.Z.isVMLI(n.item)),"Valid selection must always be into a VMLI for end item")}catch(r){S.Z.reportError(r)}}}catch(i){S.Z.reportError(i)}}else this.reset();this._isValid=e}},{key:"isArrowSelectInverted",value:function(){return this._isArrowSelectInverted}},{key:"setArrowSelectInverted",value:function(e){this._isArrowSelectInverted=e}},{key:"getStartItem",value:function(e){var t=this.getStartObject();return t?e?t.getMirrorOrItem():t.item:void 0}},{key:"getStartObject",value:function(){var e;return null===(e=this.getStartSelectionOfMap(this._selectedMap))||void 0===e?void 0:e.paneObject}},{key:"getStartOffset",value:function(e){var t=this.getStartSelectionOfMap(this._selectedMap),n=t?t.full?0:t.start:-1;return!e&&t&&(this.getStartIndex()!==this.getEndIndex()&&this.isValid()?n=0:-1===n&&t&&(n=this.getStartTotal())),n}},{key:"getStartOffsetWithPrefix",value:function(){var e=this.getStartOffset();return e>=0?e+this.getStartObject().item.getPrefixLength():e}},{key:"getStartIndex",value:function(){var e;return null===(e=this.getStartSelectionOfMap(this._selectedMap))||void 0===e?void 0:e.paneObject.index}},{key:"getStartSelectionOfMap",value:function(e){var t,n=S.Z.minObject(Object.values(e),(function(e){return e.paneObject.index}));if(n&&(n=this.updatePaneObjectFromSelectedMap(n,e)),null!==(t=n)&&void 0!==t&&t.paneObject)return n.full&&(n=Object.assign({start:0,end:n.total},n)),n}},{key:"getStartTotal",value:function(){var e=this.getStartSelectionOfMap(this._selectedMap);return e?e.total:0}},{key:"getEndItem",value:function(e){var t=this.getEndObject();return t?e?t.getMirrorOrItem():t.item:void 0}},{key:"getEndObject",value:function(){var e;return null===(e=this.getEndSelectionOfMap(this._selectedMap))||void 0===e?void 0:e.paneObject}},{key:"getEndOffset",value:function(e){var t=this.getEndSelectionOfMap(this._selectedMap),n=t?t.full?this.getEndTotal():t.end:-1;return!e&&t&&(this.getStartIndex()!==this.getEndIndex()&&this.isValid()&&this.getEndObject()||-1===n)&&(n=this.getEndTotal()),n}},{key:"getEndOffsetWithPrefix",value:function(){var e=this.getEndOffset();return e>=0?e+this.getEndObject().item.getPrefixLength():e}},{key:"getEndIndex",value:function(){var e;return null===(e=this.getEndSelectionOfMap(this._selectedMap))||void 0===e?void 0:e.paneObject.index}},{key:"getEndSelectionOfMap",value:function(e){var t,n=S.Z.maxObject(Object.values(e),(function(e){return e.paneObject.index}));if(n&&(n=this.updatePaneObjectFromSelectedMap(n,e)),null!==(t=n)&&void 0!==t&&t.paneObject)return n.full&&(n=Object.assign({start:0,end:n.total},n)),n}},{key:"getEndTotal",value:function(){var e=this.getEndSelectionOfMap(this._selectedMap);return e?e.total:0}},{key:"getEndTotalWithPrefix",value:function(){var e,t=this.getEndSelectionOfMap(this._selectedMap),n=(null===t||void 0===t||null===(e=t.paneObject.item)||void 0===e?void 0:e.getPrefix().length)||0;return t?t.total+n:0}},{key:"isMouseDown",value:function(){return this._isMouseDown}},{key:"isTouchDown",value:function(){return this._isTouchDown}},{key:"setSelectionObjects",value:function(e,t,n,r,i){var a,s,c,l,u,d,h,p,f,g;(this.isMultiselecting=!1,S.Z.shouldLog(P.Z.LogLevels.Selection))&&console.log("setSelectionObjects1",!!e,!!n,null===(c=e)||void 0===c?void 0:c.index,null===(l=n)||void 0===l?void 0:l.index,t,r,null===(u=e)||void 0===u?void 0:u.id,null===(d=e)||void 0===d?void 0:d.item.getRawText(),this._downOffset);(e=e?this.adjustSelectionForNonVMLIs(e,!1):this.getStartObject(),n=n?this.adjustSelectionForNonVMLIs(n,!0):this.getEndObject(),t=null!==(a=t)&&void 0!==a?a:e?this.getStartOffset(!0):void 0,r=null!==(s=r)&&void 0!==s?s:n?this.getEndOffset(!0):void 0,e&&t<0&&(t=e.getDisplayLengthWithoutPrefix()),n&&r<0&&(r=n.getDisplayLengthWithoutPrefix()),S.Z.shouldLog(P.Z.LogLevels.Selection))&&console.log("setSelectionObjects2",null===(h=e)||void 0===h?void 0:h.index,null===(p=n)||void 0===p?void 0:p.index,t,r,null===(f=e)||void 0===f?void 0:f.id,null===(g=e)||void 0===g?void 0:g.item.getRawText());var m={};if(e&&n){var v,y,k=e.index,_=n.index,Z=e.getDisplayLengthWithoutPrefix();if((null===(v=e)||void 0===v?void 0:v.id)!==(null===(y=n)||void 0===y?void 0:y.id)||0===t&&r>0&&r===Z){for(var w=0,b=k;b<=_;b++){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;var D=this.objectAtIndex(b);D.item&&(m[D.id]={paneObject:D,full:!0,total:D.getDisplayLengthWithoutPrefix()})}S.Z.shouldLog(P.Z.LogLevels.Selection)&&S.Z.log("Sel::setSelectionObjects2",m,this._selectedMap)}else m=o()({},e.id,{paneObject:e,start:t,end:r,total:Z}),S.Z.shouldLog(P.Z.LogLevels.Selection)&&S.Z.log("Sel::setSelectionObjects1",this._selectedMap);this.setArrowSelectInverted(k<this._downIndex&&k===this._downIndex&&t<this._downOffset.start)}else S.Z.shouldLog(P.Z.LogLevels.Selection)&&S.Z.log("setSelectionObjects {}"),this.setArrowSelectInverted(!1);return n&&void 0!==i&&(n=this.adjustSelectionBelow(m,n,i,!0)),this._setSelectedMap(m),this._isDirty=!0,n}},{key:"setSelectionIndices",value:function(e,t,n,r){var i=void 0!==e?this.getPane().objectAtIndex(e):void 0,a=void 0!==n?this.getPane().objectAtIndex(n):void 0;this.setSelectionObjects(i,t,a,r)}},{key:"isValid",value:function(){return this._isValid&&!I.default.menus.isContextMenuOpen("ReactContextMenuDate")}},{key:"checkValid",value:function(){var e=this.getPane(),t=!1;if(e&&this.getStartIndex()>=0&&this.getStartIndex()<e.numItems()&&this.getEndIndex()>=0&&this.getEndIndex()<e.numItems())if(this.getStartItem()&&this.getEndItem()){var n=this.getStartObject();if(n instanceof R.Z){var r=n.getDisplayText({isSelected:!0,noPrefix:!0}),i=this.getEndObject().getDisplayText({isSelected:!0,noPrefix:!0}),a=this.getStartOffset(),o=this.getEndOffset();a>=0&&o>=0&&(void 0===r||a<=r.length)&&(void 0===i||o<=i.length)&&(t=!0)}else t=!0}else t=!1;return!t&&this.isValid()&&this.reset(void 0,!0),t}},{key:"onPaneAdded",value:function(e){e.addScrollListener(this.onScroll)}},{key:"onPaneRemoved",value:function(e){e.removeScrollListener(this.onScroll),this.getPane()===e&&this.setFocusedPane(void 0)}},{key:"onScroll",value:function(e){var t=this;this._isMouseDown&&e===this.getPane()&&e.isWriteable&&!I.default.DragDrop.isDragging&&S.Z.animationFrameOnce("SelOnScroll",(function(){var e=t.getMousePos(),n=document.elementFromPoint(e.x,e.y),r={clientX:e.x,clientY:e.y,target:n,shiftKey:t.modifiersDown.shiftKey};t._updateFromMouse(r),t._updateSelection()}))}},{key:"handleRightMouseDown",value:function(e){var t=!S.Z.hasClass(e.target,"mdImage"),n=S.Z.findParent(e.target,"item")&&S.Z.getElementParent(e.target);if(n&&!S.Z.findParent(n,"autocompleteItem",2)&&!S.Z.hasClass(n,"itemNotInPane")){var r=S.Z.getPaneObjectForElement(n);r&&this.isSelected(r)&&(t=!1)}t&&this.handleMouseDown(e,!0)}},{key:"checkDoubleClick",value:function(){this._isValid&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()!==this.getEndOffset()&&(this._dblClickOffsets={index:this.getStartIndex(),start:this.getStartOffset(),end:this.getEndOffset()}),this._dblClickTimeout=void 0}},{key:"handleMouseDown",value:function(e,t){var n=S.Z.getPaneForElement(e.target);if(this.isWindowFocused.set(!0),t||(this._isMouseDown=!0),this.selectedBeforeThisMouseEvent=this.save(),n&&!this._isMouseDownDisabled){this.setFocusedPane(n);var r=e.target;if(S.Z.findParent(r,"itemInPaneNote")){if(!I.default.DragDrop.isDraggingDelayed){var i=S.Z.getPaneObjectForElement(e.target);i&&(n.openNoteContextMenuByPaneObject(i),S.Z.preventAndStop(e))}}else if(S.Z.hasClass(r,"paneDocumentContent")&&this.onClickPaneBottom(n,e),!S.Z.findParent(r,"itemInPane")||S.Z.findParent(r,"itemInPaneText")){if(n.supportSel&&!j.some((function(e){return S.Z.isArray(e)?S.Z.findParent(r,e[0]):S.Z.hasClass(r,e)}))&&(this.isKeyboardOpen||!S.Z.findParent(r,"pressable",2))&&!this.isInMobileMultiselect()){this.setArrowSelectInverted(!1);var a=this.mouseDownPos.x,o=this.mouseDownPos.y,s=S.Z.getElementParent(r),c=!1;if(this.mouseDownPos.x=e.pageX,this.mouseDownPos.y=e.pageY,S.Z.findParent(r,"paneContent"))if(n&&n.isWriteable&&n.isEditable&&s){if(t)this._numClicks=1,this._lastClickTime=0,this._dblClickOffsets=void 0;else{var l=Date.now();l-this._lastClickTime<P.Z.DoubleClickTime&&Math.abs(e.pageX-this.mouseDownPos.x)<2&&Math.abs(e.pageY-this.mouseDownPos.y)<2&&Math.abs(e.pageX-a)<2&&Math.abs(e.pageY-o)<2?this._numClicks++:(this._numClicks=1,this._dblClickOffsets=void 0),this._lastClickTime=l}var u=B.Z.getCursorSelectionRange(e);if(u){S.Z.shouldLog(P.Z.LogLevels.Selection)&&S.Z.log("Sel::handleMouseDown - Default");var d=S.Z.getPaneObjectForElement(e.target);if(!d||d.overview||t&&this.isSelected(d))return;if(e.shiftKey&&this._downObject||(this._downIndex=d.index,this._downObject=d),D.Z.isPriModKey(e))!this.hasFullSelection()&&H.some((function(t){return S.Z.hasClass(e.target,t)}))||(this.multiselect(d),c=!0,this._downOffset={start:0,end:this._downObject.getDisplayLengthWithoutPrefix()});else{var h=n.listManager?S.Z.findChild(s,"itemInPaneText"):s;if(e.shiftKey&&!(D.Z.mac&&e.metaKey||!D.Z.mac&&e.ctrlKey))this._updateFromMouse(e);else if(1===this._numClicks||this._numClicks>3){try{S.Z.PAssert(164,this._downIndex>=0,"Must have a valid index in react item")}catch(Z){S.Z.reportError(Z)}if(this._downIndex<0)try{S.Z.PAssert(165,this._downIndex>=0,"Dead cell error",S.Z.getElementPath(u.getStartElement()),S.Z.getElementPath(e.target))}catch(Z){S.Z.reportError(Z)}var p=this._downObject.item;try{S.Z.PAssert(166,this._downObject,"Must have a valid item in react item")}catch(Z){S.Z.reportError(Z)}var f=u.getSelectOffsetsInElement(h);I.default.settings.showMarkdown.get()&&!this._selectedMap[d.id]&&(this._downObject.forceIsSelected=!0,f.start+=p.elsNew.numFormattingCharsBeforeOffset(this._downObject,f.start),f.end+=p.elsNew.numFormattingCharsBeforeOffset(this._downObject,f.end)),f.start=p.elsNew.adjustOffsetAroundUneditables(this._downObject,f.start,1),f.end=p.elsNew.adjustOffsetAroundUneditables(this._downObject,f.end,1),0===p.getParsedTextWithoutPrefix().length?this._downOffset={start:f.total,end:f.total}:this._downOffset={start:f.start,end:f.start},this.preferEndLine=Math.abs(e.clientX-S.Z.offset(h).right)<30&&{index:this._downIndex,offset:this._downOffset.start},this.setSelectionObjects(this._downObject,this._downOffset.start,this._downObject,this._downOffset.end)}else if(2===this._numClicks){var g=A.getPreviousWord(this._downObject,this._downOffset.start)+1,m=A.getNextWord(this._downObject,this._downOffset.end);this.setSelectionObjects(this._downObject,g,this._downObject,m),this._downOffset={start:g,end:m}}else if(3===this._numClicks){var v=this._downObject.getDisplayLengthWithoutPrefix();this.setSelectionObjects(this._downObject,0,this._downObject,v),this._downOffset={start:0,end:v}}c=!0}}this._dblClickTimeout=setTimeout(this.checkDoubleClick.bind(this),0)}else S.Z.shouldLog(P.Z.LogLevels.Selection)&&S.Z.log("Sel::handleMouseDown - Skip");else S.Z.shouldLog(P.Z.LogLevels.Selection)&&S.Z.log("Sel::handleMouseDown - Skip header");this.setValid(c&&this.checkValid()),this.isValid()&&this._updateSelection(),this._downObject&&delete this._downObject.forceIsSelected,S.Z.preventAndStop(e)}}else{var y,k,_=S.Z.getPaneObjectForElement(e.target);null===_||void 0===_||null===(y=_.item)||void 0===y||null===(k=y.checkDragOnStart)||void 0===k||k.call(y,e)}}}},{key:"setDownIndex",value:function(){this._downIndex=this.getStartIndex(),this._downObject=this.getStartObject(),this._downOffset={start:this.getStartOffset(),end:this.getEndOffset()}}},{key:"getMousePos",value:function(){return this.mousePos}},{key:"handleMouseMoveDocument",value:function(e){this.mousePos.x=e.pageX,this.mousePos.y=e.pageY}},{key:"handleMouseMove",value:function(e){var t=this;if(this.mouseHandlers.forEach((function(t){return t.move(e)})),this._dblClickTimeout&&(clearTimeout(this._dblClickTimeout),this._dblClickTimeout=void 0),e.target!==document.documentElement&&e.target.parentElement&&!S.Z.isDraggingImage){var r=S.Z.getPaneForElement(e.target);if(this._isValid&&this._isMouseDown&&r===this.getPane()&&r.supportSel&&r.isWriteable&&!n(5375).Z.isDragging)return this.isSelecting=!0,r.scrollFromMousePosition(e.pageX,e.pageY,!1),this._updateFromMouse(e),this._updateSelection(),S.Z.preventDefault(e),S.Z.timeoutOnce("selUpdating",(function(){return t.isSelecting=!1}),100),!1}}},{key:"handleMouseUp",value:function(e){this.mouseHandlers.forEach((function(t){return t.up(e)}));var t=S.Z.isAttachedToDoc(e.target)&&S.Z.getPaneForElement(e.target);t&&S.Z.getElementParent(e.target);this._isMouseDown=!1,t&&t.supportSel&&!j.some((function(t){return S.Z.isArray(t)?S.Z.findParent(e.target,t[0]):S.Z.hasClass(e.target,t)}))&&(S.Z.shouldLog(P.Z.LogLevels.Selection)&&S.Z.log("Sel::handleMouseDown - handleMouseUp"),S.Z.cancelRepeatScrolls())}},{key:"focusPaneAndRestoreSelection",value:function(e){this.setFocusedPane(e),this.restoreSavedSelection(e),this.updateCaret()}},{key:"setFocusedPane",value:function(e){if(!e||!S.Z.focusedPane||S.Z.focusedPane.id!==e.id){var t=S.Z.focusedPane;t&&!t.isUnloaded()&&(t.setFocused(!1),t.isEditable&&this.isValid()&&(this._savedPaneSels[t.id]=this.save())),I.default.PaneUpdateBatcher.beginUpdateItems(),this.reset(),M.Z.reset(t),S.Z.focusedPane=e,S.Z.focusedItem=e?e.getItem():void 0,f()(_()(r.prototype),"setFocusedPane",this).call(this,e),e&&e.setFocused(!0),I.default.PaneUpdateBatcher.commitUpdateItems()}}},{key:"restoreSavedSelection",value:function(e){if(e){var t=this._savedPaneSels[e.id];t?(t.pane=e,e.isLoaded?this.restore(t):setTimeout(this.restore,0,t),this._savedPaneSels[e.id]=void 0):this.reset()}}},{key:"_updateWith",value:function(e,t){var n="start"===e?t.getStartElement():t.getEndElement();try{S.Z.PAssert(167,n,"Trying to select in invalid container")}catch(c){S.Z.reportError(c)}if(n){var r=S.Z.getElementParent(n),i=S.Z.findChild(r,"itemInPaneText"),a=S.Z.getPaneObjectForElement(r),o=t.getSelectOffsetsInElement(i),s="start"===e?o.start:o.end;try{S.Z.PAssert(168,a.item,"Should not be updating ReactCells without VMLIs")}catch(c){S.Z.reportError(c)}if(S.Z.shouldLog(P.Z.LogLevels.Selection)&&S.Z.log("Sel::_updateWith["+e+"] - ",s,a.index),this._dblClickOffsets&&a.index===this._dblClickOffsets.index)if("start"===e)s=Math.min(s,this._dblClickOffsets.start);else if("end"===e)s=Math.max(s,this._dblClickOffsets.end);else try{S.Z.PAssert(169,!1,"Invalid toUpdate value")}catch(c){S.Z.reportError(c)}this._downOffset.start!==this._downOffset.end&&(s="start"===e?A.getPreviousWord(a,s)+1:A.getNextWord(a,s-1));try{S.Z.PAssert(170,!isNaN(s),"Selection offsets should not be undefined")}catch(c){S.Z.reportError(c)}return{paneObject:a,offsetsValue:s}}}},{key:"_updateFromMouse",value:function(e){var t=e.target;if(t&&!I.default.DragDrop.isDragging&&!this.isMultiselecting){var n=S.Z.focusedPane;if(!S.Z.getElementParent(t)&&e.clientY<n.contentTop()){if(S.Z.shouldLog(P.Z.LogLevels.Selection)&&S.Z.log("Sel::_updateFromMouse - outOfPane"),t=S.Z.elementFromPoint(e.clientX,n.contentTop()+1),S.Z.getElementParent(t)){var r=S.Z.getPaneObjectForElement(t).item;try{S.Z.PAssert(171,r,"If it is an LI it should be an item",t)}catch(D){S.Z.reportError(D)}this.setSelectionIndices(0,0,void 0,void 0)}}else{var i,a,o,s=S.Z.getElementParent(t);if(s){if(t=s.getElementsByClassName("itemInPaneText")[0],(o=B.Z.getCursorSelectionRange(e))&&o.getStartElement()&&t){var c=S.Z.getPaneObjectForElement(t);try{S.Z.PAssert(172,c,"Must be able to find a valid reactCell for the start element")}catch(D){S.Z.reportError(D)}if(c){if((i=c.index)<0)try{S.Z.PAssert(174,i>=0,"Dead cell error",S.Z.getElementPath(o.getStartElement()),S.Z.getElementPath(t))}catch(D){S.Z.reportError(D)}var l="itemInPane";if(S.Z.findParent(o.getStartContainer(),l)&&S.Z.findParent(o.getEndContainer(),l))a=o.getSelectOffsetsInElement(t).start;else i<=this._downIndex?this.setSelectionIndices(i,0,void 0,void 0):this.setSelectionIndices(void 0,void 0,i,0)}}}else if(n.hasNonVMLIs){var u=S.Z.getPaneObjectForElement(t);if(u){var d=u.index;if(d>=0)if(!n.itemAtIndex(d))if(d<this._downIndex){var h=n.indexOfNextVMLI(d);h>=0&&this.setSelectionIndices(h,0,void 0,void 0)}else{var p=n.indexOfPrevVMLI(d);if(p>=0){var f=n.objectAtIndex(p);this.setSelectionIndices(void 0,void 0,p,f.getDisplayLengthWithoutPrefix())}}}}else if(S.Z.hasClass(t,"paneContent")){S.Z.shouldLog(P.Z.LogLevels.Selection)&&S.Z.log("Sel::_updateFromMouse - paneContent");var g=n.getLastObject();this.setSelectionIndices(void 0,void 0,n.numItems()-1,g?-1:0)}if(!isNaN(i)&&!isNaN(a)&&o){var m;if(i<this._downIndex||i===this._downIndex&&a<this._downOffset.start){m="end";var v=this._updateWith("start",o),y=v.paneObject,k=v.offsetsValue;this.setSelectionObjects(y,k,void 0,void 0)}else if(i>this._downIndex||i===this._downIndex&&a>=this._downOffset.start){m="start";var _=this._updateWith("end",o),Z=_.paneObject,w=_.offsetsValue;this.setSelectionObjects(void 0,void 0,Z,w),a===this._downOffset.start&&(this._isDirty=!0)}if(void 0!==m){if(!e.shiftKey){S.Z.shouldLog(P.Z.LogLevels.Selection)&&S.Z.log("Sel::_updateFromMouse - RunAfterUpdates");var b=this._dblClickOffsets?this._dblClickOffsets[m]:"start"===m?this._downOffset.start:this._downOffset.end;"start"===m?this.setSelectionObjects(this._downObject,b,void 0,void 0):this.setSelectionObjects(void 0,void 0,this._downObject,b)}this.setValid(!0)}}}}}},{key:"setSelectionFromNativeRange",value:function(e){var t=this._updateWith("start",e),n=t.paneObject,r=t.offsetsValue,i=this._updateWith("end",e),a=i.paneObject,o=i.offsetsValue;this.setSelectionObjects(n,r,a,o),this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex()))}},{key:"_updateSelection",value:function(e){if(this._isDirty&&!this.isMultiselecting){var t=this.getPane(),n=this.getStartIndex(),r=this.getEndIndex(),i=this.getStartObject(),a=this.getEndObject(),o=i;if(this.originalStartIndex=n,this.originalEndIndex=r,this.setValid(!isNaN(n)&&!isNaN(r)),n===r&&void 0!==n)try{S.Z.PAssert(175,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(y){S.Z.reportError(y)}else{for(var s=0,c=0,l=Number.MAX_SAFE_INTEGER,u=n;u<=r;++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var d=t.itemAtIndex(u);d&&(l=Math.min(l,d.levelsDeep.get()))}for(var h=n;h>=0;h--){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var p=t.objectAtIndex(h);if(p.item&&(o=p,p.item.levelsDeep.get()<=l))break}var f=this.setSelectionObjects(o,void 0,a,void 0,l);void 0!==o&&(i=o),void 0!==f&&(a=f)}this.updateCaret(),this.updateSelectedMap(),this._isDirty=!1;var g=this.isValid();if(i===a||!g){if(i!==this._previousSelectedObject||g!==this._previousIsValid){var m,v=g?i.item:void 0;x.Z.fireEvent("selectedIndexChanged",[null===(m=i)||void 0===m?void 0:m.index,t,v])}this._previousSelectedObject=i,this._previousIsValid=g}i===a&&this.getStartOffset()===this.getEndOffset()&&(this.lastSingleSelection=this.save())}}},{key:"updateCaret",value:function(){if(this.isValid()){var e=this.getPane();if(!e||!e.isWriteable)return;e.hiddenInput&&this.updateHiddenInput()}}},{key:"updateCaretAndCaretItem",value:function(){this.isValid()&&1===Object.keys(this._selectedMap).length&&(this.updateCaret(),this.notifyItemChanged(this.getStartItem()))}},{key:"updateHiddenInput",value:function(){var e=this.getPane();if(e&&e.isEditable&&e.hiddenInput&&!N.Z.isInSelectionChange)if(this.isValid()&&this.getStartItem()===this.getEndItem()){this.setArrowSelectInverted(!1);var t=this.getStartObject(),n=this.getStartOffset(),r=this.getEndOffset();n===r&&this.setDownIndex(),!this.isKeyboardOpen&&this.isSelectedFully(t)||!D.Z.isAndroid&&this.isComposing||(this.isKeyboardOpen||e.scrollIndexIntoView(t.index,D.Z.supportSmoothScrollWithKeyboard()?"smooth":"auto"),S.Z.timeoutIf(!this.isKeyboardOpen&&D.Z.app&&D.Z.isiOS,0,(function(){N.Z.updateFromPaneObject(t,n,r)})))}else N.Z.blur(e)}},{key:"wasSelectedBeforeThisMouseEvent",value:function(e){var t=this.selectedBeforeThisMouseEvent;if(t&&void 0!==t.selectedMap[e.id])return!0}},{key:"isSelected",value:function(e){return!!this._selectedMap[e.id]}},{key:"isSelectedFully",value:function(e){var t,n,r=e.id;if(e.pane!==this.getPane())return!1;var i=this._selectedMap[r];return!!i&&(i.full||0===i.start&&i.end>0&&i.end===(null===(t=(n=e).getDisplayLengthWithoutPrefix)||void 0===t?void 0:t.call(n)))}},{key:"getSelection",value:function(e){return this._selectedMap[e.id]}},{key:"selectObjects",value:function(e,t,n,r,i){try{S.Z.PAssert(176,e&&n,"Must be selecting a start object and an end object")}catch(d){S.Z.reportError(d)}var a=!1,o=e.pane;if(o&&o.isWriteable){var s,c,l=e.item,u=n.item;if(l&&u&&(!this.isValid()||e.id!==(null===(s=this.getStartObject())||void 0===s?void 0:s.id)||n.id!==(null===(c=this.getEndObject())||void 0===c?void 0:c.id)||t!==this.getStartOffset()||r!==this.getEndOffset()||this.isSelectedFully(e))){S.Z.shouldLog(P.Z.LogLevels.Selection)&&S.Z.log("Sel::selectObjects -",t,r),t=Math.min(t,e.getDisplayLengthWithoutPrefix()),r=Math.min(r,n.getDisplayLengthWithoutPrefix()),this.setSelectionObjects(e,t,n,r);try{S.Z.PAssert(177,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(d){S.Z.reportError(d)}!isNaN(this.getStartOffset())&&this.getStartOffset()>=0&&!isNaN(this.getEndOffset())&&this.getEndOffset()<=this.getEndTotal()&&this._updateSelection(i),a=!0}else 0}else i&&i.fromInput||this.updateHiddenInput();return a}},{key:"selectObject",value:function(e,t,n,r){return void 0===n&&(n=t),this.selectObjects(e,t,e,n,r)}},{key:"selectIndices",value:function(e,t,n,r,i){try{S.Z.PAssert(178,e>=0,"Must supply a valid start index")}catch(p){S.Z.reportError(p)}try{S.Z.PAssert(179,n>=0,"Must supply a valid end index")}catch(p){S.Z.reportError(p)}try{S.Z.PAssert(180,n>e||n===e&&(r>=t||-1===r),"Must not pass reversed selection")}catch(p){S.Z.reportError(p)}if(!(e<0||n<0)){var a,o,s,c,l=this.getPane(),u=!1;if(l&&l.isWriteable){var d=l.objectAtIndex(e),h=l.objectAtIndex(n);s=d?this.adjustSelectionForNonVMLIs(d,!1):void 0,c=h?this.adjustSelectionForNonVMLIs(h,!0):void 0,s&&(e=s.index,a=l.itemAtIndex(e)),c&&(n=c.index,o=l.itemAtIndex(n));try{S.Z.PAssert(181,a,"Trying to select invalid start index")}catch(p){S.Z.reportError(p)}try{S.Z.PAssert(182,o,"Trying to select invalid end index")}catch(p){S.Z.reportError(p)}}if(!a||!o||this.isValid()&&e===this.getStartIndex()&&t===this.getStartOffset()&&n===this.getEndIndex()&&r===this.getEndOffset()&&a===this.getStartItem()&&o===this.getEndItem())i&&i.fromInput||this.updateHiddenInput();else{S.Z.shouldLog(P.Z.LogLevels.Selection)&&S.Z.log("Sel::selectIndices -",t,r),t=Math.min(t,s.getDisplayLengthWithoutPrefix()),r=Math.min(r,c.getDisplayLengthWithoutPrefix()),this.setSelectionIndices(e,t,n,r);try{S.Z.PAssert(183,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(p){S.Z.reportError(p)}!isNaN(this.getStartOffset())&&this.getStartOffset()>=0&&!isNaN(this.getEndOffset())&&this.getEndOffset()<=this.getEndTotal()&&this._updateSelection(i),u=!0}return u}}},{key:"selectItem",value:function(e,t,n){try{S.Z.PAssert(184,S.Z.isNumber(t),"Must pass a valid start offset")}catch(r){S.Z.reportError(r)}try{S.Z.PAssert(185,S.Z.isNumber(n)||void 0===n,"Must pass a valid end offset")}catch(r){S.Z.reportError(r)}return void 0===n&&(n=t),this.selectItems(e,t,e,n)}},{key:"selectItems",value:function(e,t,n,r){try{S.Z.PAssert(186,S.Z.isVMLI(e),"Should only be passing VMLIs to start this fn")}catch(s){S.Z.reportError(s)}try{S.Z.PAssert(187,S.Z.isVMLI(n),"Should only be passing VMLIs to end this fn")}catch(s){S.Z.reportError(s)}var i=this.getPane();if(i){var a=i.indexOfItem(e);try{S.Z.PAssert(188,a>=0,"Must be able to find the start item in the pane")}catch(s){S.Z.reportError(s)}var o=i.indexOfItem(n);try{S.Z.PAssert(189,o>=0,"Must be able to find the end item in the pane")}catch(s){S.Z.reportError(s)}return this.selectIndices(a,t,o,r)}}},{key:"save",value:function(){if(this._isValid){var e=this.getPane();if(!e.isDestroyed()&&!e.isUnloaded()){try{S.Z.PAssert(190,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(n){S.Z.reportError(n)}try{S.Z.PAssert(191,!isNaN(this.getEndIndex()),"End index must be valid")}catch(n){S.Z.reportError(n)}var t={pane:e,selectedMap:S.Z.clone(this._selectedMap)};return this._savedSelection=t,t}}}},{key:"getSavedSelection",value:function(){return this._savedSelection}},{key:"restore",value:function(e){var t=this,n=!1,r=null===e||void 0===e?void 0:e.pane;if(e&&!r.isDestroyed()){try{S.Z.PAssert(192,r,"Must have a valid pane to restore selection to")}catch(o){S.Z.reportError(o)}var i=S.Z.focusedPane;S.Z.focusedPane=r,S.Z.focusedItem=r.getItem(),i&&!i.isUnloaded()&&i!==r&&i.setFocused(!1),r.setFocused(!0),this.pane.set(r)}if(e&&!S.Z.isEmpty(e.selectedMap)){var a={};Object.values(e.selectedMap).forEach((function(n){if(n=t.updatePaneObjectFromSelectedMap(n,e.selectedMap)){var i=n.paneObject;i||(i=r.findItem(i.item)),i&&(a[i.id]=Object.assign({},n,{paneObject:i,total:i.getDisplayLengthWithoutPrefix()}))}})),S.Z.shouldLog(P.Z.LogLevels.Selection)&&S.Z.log("Sel::restore",a,this._selectedMap),this._setSelectedMap(a),this.isValid()&&this._updateSelection(),S.Z.isEmpty(this._selectedMap)?this.reset():(this._isDirty=!0,this._updateSelection(),n=!0)}else this.reset();return this._savedSelection=void 0,n}},{key:"scrollStartIntoView",value:function(e){if(this._isValid){try{S.Z.PAssert(193,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(t){S.Z.reportError(t)}try{S.Z.PAssert(194,!isNaN(this.getEndIndex()),"End index must be valid")}catch(t){S.Z.reportError(t)}S.Z.focusedPane.scrollIndexIntoView(this.getStartIndex(),e?"auto":"smooth")}}},{key:"scrollEndIntoView",value:function(){if(this._isValid){try{S.Z.PAssert(195,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(e){S.Z.reportError(e)}try{S.Z.PAssert(196,!isNaN(this.getEndIndex()),"End index must be valid")}catch(e){S.Z.reportError(e)}S.Z.focusedPane.scrollIndexIntoView(this.getEndIndex(),"smooth")}}},{key:"onWindowBlur",value:function(){this.isWindowFocused.set(!1)}},{key:"onWindowFocus",value:function(){this.isWindowFocused.set(!0)}},{key:"isMultiselected",value:function(){return this.getStartIndex()!==this.getEndIndex()}},{key:"isInMobileMultiselect",value:function(){return!this.isKeyboardOpen&&this.hasFullSelection()}},{key:"isSingleSelect",value:function(){var e=Object.values(this._selectedMap);return(null===e||void 0===e?void 0:e.length)>0&&1===e.length&&!e[0].full}},{key:"hasFullSelection",value:function(){var e=Object.values(this._selectedMap);return(null===e||void 0===e?void 0:e.length)>0&&(e.length>1||e[0].full)}},{key:"getSelectedObjects",value:function(){var e=this;if(!this._isValid)return[];var t=[];return Object.values(this._selectedMap).forEach((function(n){if(n=e.updatePaneObjectFromSelectedMap(n,e._selectedMap)){var r=n.paneObject,i=r.item;i&&!i.isNote()&&t.push(r)}})),t}},{key:"numSelected",value:function(e){return e===this.pane.get()?Object.values(this._selectedMap).length:0}},{key:"getSelectedItems",value:function(e,t){var n=this;if(!this._isValid)return[];var r=[],i=this.getPane(),a=this.getStartIndex(),o=this.getStartOffset(),s=this.getEndOffset(),c=this.getEndTotal();return Object.values(this._selectedMap).forEach((function(l){var u=(l=n.updatePaneObjectFromSelectedMap(l,n._selectedMap)).paneObject,d=u.item,h=u.index;if(d&&(e||!d.isNote())){var p=(h>a||0===o&&s===c)&&i.isPaneObjectCollapsed(u);r.push(d),t&&p?d.forEachChildRecursive((function(e){return r.push(e)}),e):e&&d.hasNote()&&r.push(d.getNote())}})),r}},{key:"getStartElement",value:function(){var e=this.getStartIndex();if(this._isValid&&!isNaN(e))return this.getPane().elementAtIndex(e)}},{key:"getEndElement",value:function(){var e=this.getEndIndex();if(this._isValid&&!isNaN(e))return this.getPane().elementAtIndex(e)}},{key:"fireKeyEvent",value:function(e,t,n){this.fireKeyEventInternal(e,"keydown",t),this.fireKeyEventInternal(e,"keypress",n||t),this.fireKeyEventInternal(e,"keyup",t)}},{key:"fireKeyEventInternal",value:function(e,t,n){try{S.Z.PAssert(197,void 0!==n,"Must pass in valid key data to type")}catch(i){S.Z.reportError(i)}if(e||(e=this.getStartElement()),document.createEvent&&e){var r=document.createEvent("Event");r.normCode=n.normCode,r.shiftKey=!!n.shiftKey,r.altKey=!!n.altKey,r.ctrlKey=!!n.ctrlKey,r.metaKey=!!n.metaKey,r.synthetic=!0,r.initEvent(t,!0,!0),e.dispatchEvent(r)}else if(e)try{S.Z.PAssert(198,!1,"Unable to fire key event")}catch(i){S.Z.reportError(i)}else try{S.Z.PAssert(199,!1,"No element available to fire key event on")}catch(i){S.Z.reportError(i)}}},{key:"fireClickEvent",value:function(e,t){this.fireClickEventInternal(e,"mousedown",t),this.fireClickEventInternal(e,"mouseup",t),this.fireClickEventInternal(e,"mouseclick",t)}},{key:"fireClickEventInternal",value:function(e,t,n,r){try{S.Z.PAssert(200,void 0!==n,"Must pass in a valid button to click with")}catch(o){S.Z.reportError(o)}if(e||(e=B.Z.getSelectionNode()),document.createEvent&&e){var i=document.createEvent("Event");if(i.button=n,i.synthetic=!0,r)for(var a in r)r.hasOwnProperty(a)&&(i[a]=r[a]);i.initEvent(t,!0,!0),e.dispatchEvent(i)}else if(e)try{S.Z.PAssert(201,!1,"Unable to fire click event")}catch(o){S.Z.reportError(o)}else try{S.Z.PAssert(202,!1,"No element available to fire click event on")}catch(o){S.Z.reportError(o)}}},{key:"fireMouseUp",value:function(e,t){this.fireClickEventInternal(e,"mouseclick",t)}},{key:"confirmDangerousSelection",value:function(e){var t=this,n=this.isMultiselectDangerous();if(n){var r=this.save();I.default.menus.confirm(n,(function(n){t.restore(r),n&&e()}))}else e()}},{key:"isMultiselectDangerous",value:function(){var e=this.pane.get(),t=this.getSelectedItems(!1,!0).length;return t>(e.isViewOutline()||e.isViewProject()?3:1)&&"Are you sure you want to delete ".concat(t," items?")}},{key:"onPressEnter",value:function(){this.isValid()&&this.selectIndex(this.getStartIndex(),this.getStartOffset())}},{key:"setModifiersDown",value:function(e,t,n,r){this.modifiersDown={ctrlKey:e,metaKey:t,altKey:n,shiftKey:r}}},{key:"addMouseHandler",value:function(e){var t=this,n=e.move,r=e.up,i={move:n,up:function(e){r(e),t.mouseHandlers.remove(i)}};this.mouseHandlers.push(i)}},{key:"selectUpDown",value:function(e,t,n){var r,a,o,s=0,c=this.pane.get(),l=this.isArrowSelectInverted()||"up"===e&&this.getStartIndex()===this.getEndIndex(),u=l?this.originalStartIndex:this._downIndex,d=l?this._downIndex:this.originalEndIndex,h=l?u:d,p={fromArrows:!0},f=0,g=c.itemAtIndex(h);o=Number.MAX_SAFE_INTEGER;for(var m=u;m<=d;++m){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var v=c.itemAtIndex(m);v&&("up"===e&&l||v!==g)&&(o=Math.min(o,v.levelsDeep.get()))}o===Number.MAX_SAFE_INTEGER&&(o=g.levelsDeep.get());var y=function(e){var i=c.itemAtIndex(e);if(i.levelsDeep.get()<=o&&(!t||i.isPrefixHeader())&&(r=e,f++,!n||f>5))return!0};if("down"===e){for(var k=0,_=c.numItems(),Z=h+1;Z<_;Z++){if(k++>5e3&&__infLoop&&__infLoop(k))throw new RangeError;if(y(Z))break}if(r){var w=c.indexOfLastItem();a=l?[Math.min(r,d),0,Math.max(r,d),-1,p]:[Math.min(u,r),0,Math.min(Math.max(r,u),w),-1,p]}}else if("up"===e){for(var b=0,P=h-1;P>=0;P--){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;if(y(P))break}void 0!==r&&(a=l?[Math.max(0,Math.min(r,d)),0,Math.max(r,d),-1,p]:[Math.min(u,r),0,Math.max(u,r),-1,p])}return a&&(this.selectIndices.apply(this,i()(a)),this.setArrowSelectInverted(r<this._downIndex)),l?this.getStartIndex():this.getEndIndex()}},{key:"adjustSelectionBelow",value:function(e,t,n,r){for(var i=0,a=this.getPane(),o=a.numItems(),s=t,c=t.index+1;c<o;c++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var l=a.objectAtIndex(c),u=null===l||void 0===l?void 0:l.item;if(u){if(u.levelsDeep.get()<=n||l.block!==t.block)break;r?(e[l.id]={paneObject:l,full:!0,total:l.getDisplayLengthWithoutPrefix()},s=l):delete e[l.id]}}return s}},{key:"multiselect",value:function(e){var t,n=e,r=n.item,i=n.id,a=null===(t=r.levelsDeep)||void 0===t?void 0:t.get(),o=!this.isSelectedFully(n);this.isMultiselecting=!0;var s,c,l=Object.assign({},this._selectedMap),u=void 0!==a;if(o)Object.values(l).forEach((function(e){e.full||delete l[e.paneObject.id]})),l[i]={full:!0,paneObject:n,total:null===(s=(c=n).getDisplayLengthWithoutPrefix)||void 0===s?void 0:s.call(c)},u&&this.adjustSelectionBelow(l,n,a,!0);else if(delete l[i],u){this.adjustSelectionBelow(l,n,a,!1);var d=n.parentObject;d&&this.isSelected(d)&&(delete l[d.id],this.adjustSelectionBelow(l,d,a-1,!1))}this._setSelectedMap(l),this.setValid(this.checkValid()),this.updateCaret(),this.updateSelectedMap()}},{key:"updateSelectedMap",value:function(){var e=this;S.Z.shouldLog(P.Z.LogLevels.Selection)&&S.Z.log(this._selectedMap);var t=this.save(),n=this.getPane();if(n){var r={};Object.values(this._previousSelectedMap).concat(Object.values(this._selectedMap)).forEach((function(t){var n=t.paneObject;r[n.id]||(r[n.id]=!0),e.notifyItemChanged(n.item)}))}this._previousSelectedMap=S.Z.clone(this._selectedMap),x.Z.fireEvent("selectionChanged",[t,n]),this.selectedMapObs.set(this._selectedMap)}},{key:"objectAtIndex",value:function(e){var t;return null===(t=this.getPane())||void 0===t?void 0:t.objectAtIndex(e)}},{key:"updatePaneObjectFromSelectedMap",value:function(e,t){var n=e.paneObject.pane.findPaneObject(e.paneObject.id);return n?(e.paneObject=n,e.total=n.getDisplayLengthWithoutPrefix()):(delete t[e.paneObject.id],e=void 0),e}},{key:"_setSelectedMap",value:function(e){this._selectedMap=e}},{key:"forEach",value:function(e,t){var n=0;E.Z.beginAction();var r=this.getSelectedObjects(),i=r.map((function(e){return e.item}));I.default.PaneUpdateBatcher.beginUpdateItems();for(var a=0;a<r.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(!1===e(null!==t&&void 0!==t&&t.followMirror?r[a].getMirrorOrItem():r[a].item,a,r.length,r[a],i))break}I.default.PaneUpdateBatcher.commitUpdateItems(),E.Z.endAction()}},{key:"notifyItemChanged",value:function(e){var t;this.isSingleSelect()||null===(t=e.itemChanged)||void 0===t||t.notify()}},{key:"insertTextAtSelection",value:function(e){var t=this.getStartObject(),n=this.getStartObject(),r=this.getStartOffsetWithPrefix(),i=this.getStartOffset(),a=this.getEndOffsetWithPrefix();if(t===n){var o=t.item,s=o.elsNew,c=t.getDisplayText({isSelected:!0,noPrefix:!0}),l=c[i-1];" "!==l&&i>0&&(e=" "+e),console.log(l,c);var u=s.spliceText(e,r,a-r,t);o.setText(u,P.Z.ChangeType.Local),this.selectObject(t,i+e.length)}}},{key:"onTouchUp",value:function(e,t){L.onEvent("SelOnTouchUp",e,t)}},{key:"disableMouseDown",value:function(e){var t=this;this._isMouseDownDisabled=!0,S.Z.timeoutOnce("disableMouseDown",(function(){return t._isMouseDownDisabled=!1}),e)}},{key:"onClickPaneBottom",value:function(e,t){var n=e.indexOfLastItem();n>=0?(t.shiftKey&&this.isValid()?this.selectIndices(this.getStartIndex(),this.getStartOffset(),n,-1):this.selectIndex(n,-1),S.Z.preventAndStop(t)):e.addItem({text:""})}},{key:"adjustSelectionForNonVMLIs",value:function(e,t){return e.item?e:t?e.getPrevious():e.getNext()}}]),r}(O),w()(F.prototype,"onScroll",[b.ZP],Object.getOwnPropertyDescriptor(F.prototype,"onScroll"),F.prototype),w()(F.prototype,"handleRightMouseDown",[b.ZP],Object.getOwnPropertyDescriptor(F.prototype,"handleRightMouseDown"),F.prototype),w()(F.prototype,"handleMouseDown",[b.ZP],Object.getOwnPropertyDescriptor(F.prototype,"handleMouseDown"),F.prototype),w()(F.prototype,"handleMouseMoveDocument",[b.ZP],Object.getOwnPropertyDescriptor(F.prototype,"handleMouseMoveDocument"),F.prototype),w()(F.prototype,"handleMouseMove",[b.ZP],Object.getOwnPropertyDescriptor(F.prototype,"handleMouseMove"),F.prototype),w()(F.prototype,"handleMouseUp",[b.ZP],Object.getOwnPropertyDescriptor(F.prototype,"handleMouseUp"),F.prototype),w()(F.prototype,"restore",[b.ZP],Object.getOwnPropertyDescriptor(F.prototype,"restore"),F.prototype),w()(F.prototype,"onWindowBlur",[b.ZP],Object.getOwnPropertyDescriptor(F.prototype,"onWindowBlur"),F.prototype),w()(F.prototype,"onWindowFocus",[b.ZP],Object.getOwnPropertyDescriptor(F.prototype,"onWindowFocus"),F.prototype),F)},8133:(e,t,n)=>{"use strict";n.d(t,{o0:()=>r.Z,LA:()=>i.Z,Cs:()=>a.Z});var r=n(4074),i=n(5853),a=n(7404)},4654:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>_o});var r,i=n(8926),a=n.n(i),o=n(4575),s=n.n(o),c=n(3913),l=n.n(c),u=n(6525),d=n.n(u),h=n(2205),p=n.n(h),f=n(8585),g=n.n(f),m=n(9754),v=n.n(m),y=n(7757),k=n.n(y),_=n(8651),Z=n(4867),w=n(8855),b=n(3124),P=n.n(b),S=n(8572),D=n(7100),I=n(8133),E=n(92),x=n(7274),C=n(7048),A=n(1831);function L(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}var M={Desktop:{noteLineHeight:18,notePadding:0,noteFontSize:12,grayscale:!1,boldHeaders:!1,fontSize:14,showVerticalLines:!0,verticalLinesOpacity:6,font:"",fontWeight:"normal",Colors:{light:{prefixColor:"#222222",verticalLinesColor:32,tagColor:"#0099DD",dateColor:"#AA3300",contactColor:"#22AA66",linkColor:"#3333BB",calendarLinesColor:"#E6E6E6"},dark:{prefixColor:"#F6F6F6",verticalLinesColor:255,tagColor:"#0099DD",dateColor:"#C9302C",contactColor:"#00AF4A",linkColor:"#539bd8",calendarLinesColor:"#444444"}}}};const T=(r=function(e){p()(n,e);var t=L(n);function n(){var e;return s()(this,n),(e=t.call(this)).styles={},e.stylesheet={},e._paddingsForLevel={},e.isOpen=new x.Z,e.systemColorTheme=new x.Z,e._fontSize=new x.Z,e._fontSizeHeader=new x.Z,e._fontSizeHeaderTopLevel=new x.Z,e._noteFontSize=new x.Z,e._itemPadding=new x.Z,e._notePadding=new x.Z,e._itemLineHeight=new x.Z,e._noteLineHeight=new x.Z,e._itemIndentSize=new x.Z,e._font=new x.Z(void 0,e._onFontChange),e._fontWeight=new x.Z,e._boldHeaders=new x.Z,e._fontSizeCodeBlock=new C.Z([e._fontSize],(function(e){return e-2})),e.isPrinting=new x.Z(!1),e.Themes={SpacingCompact:{itemLineHeight:18,itemPadding:3,itemIndentSize:20,fontSizeHeader:16,fontSizeHeaderTopLevel:16},SpacingComfortable:{itemLineHeight:18,itemPadding:5,itemIndentSize:30,fontSizeHeader:16,fontSizeHeaderTopLevel:18},PrefixesFaded:{projectOpacity:30,numListOpacity:30,collapserOpacity:20,bulletOpacity:30,checkboxOpacity:25,checkboxBackgroundOpacity:0},PrefixesStrong:{projectOpacity:80,numListOpacity:80,collapserOpacity:80,bulletOpacity:80,checkboxOpacity:80,checkboxBackgroundOpacity:20}},D.Z.app&&_o.settings.ui.themeMobile.listen((function(){I.LA.setColorTheme(e.getColorTheme())})),e.timeoutSettingChanged=void 0,e.hookMediaQuery("(prefers-color-scheme: dark)",(function(t,n){n?e.systemColorTheme.set(t?"dark":"light"):e.setSystemDarkMode(t),D.Z.app&&I.LA.setColorTheme(e.getColorTheme())})),e.hookPrinting(),e}return l()(n,[{key:"init",value:function(){A.Z.init(),this.updateSettingValues(),_o.settings.ui.listen(this.onSettingChanged),_o.settings.showMarkdown.listen(this.onSettingChanged),this.updateStyles()}},{key:"hookMediaQuery",value:function(e,t){var n,r,i=null===(n=(r=window).matchMedia)||void 0===n?void 0:n.call(r,e);if(i){t(i.matches,!0);var a=function(e){t(e.matches,!1)};i.addEventListener?i.addEventListener("change",a):i.addListener&&i.addListener((function(e){"change"===e.type&&a(e)}))}}},{key:"hookPrinting",value:function(){var e=this,t=function(t,n){e.isPrinting.get()!==t&&e.isPrinting.set(t),n&&e._updateColorTheme(t?"light":e.getColorTheme())};window.addEventListener("beforeprint",(function(){return t(!0,!1)})),this.hookMediaQuery("print",(function(e){return t(e,!0)}))}},{key:"getSettingValue",value:function(e){var t=_o.settings.ui[e].get();return t===M.Desktop.Colors.light[e]?M.Desktop.Colors[this._colorTheme][e]:t}},{key:"getThemeValue",value:function(e){var t=this.Themes.SpacingComfortable[e];return void 0===t&&(t=this.Themes.PrefixesFaded[e]),void 0===t&&(t=M.Desktop[e]),void 0===t&&(t=M.Desktop.Colors[this._colorTheme][e]),t}},{key:"setFromThemeValue",value:function(e,t){_o.settings.ui[t].set(this.getThemeValue(t))}},{key:"updateSettingValues",value:function(){try{this._colorTheme=this.getColorTheme(),_.Z.isString(this._colorTheme)||(this._colorTheme="light"),this._prefixColor=M.Desktop.Colors[this._colorTheme].prefixColor,this._verticalLinesColor=M.Desktop.Colors[this._colorTheme].verticalLinesColor,this._boldHeaders.set(this.getSettingValue("boldHeaders")),this._showVerticalLines=this.getSettingValue("showVerticalLines"),this._fontSize.set(15),this._fontSizeHeader.set(16),this._fontSizeHeaderTopLevel.set(18),this._noteFontSize.set(12),this._itemPadding.set(7),this._notePadding.set(2),this._itemLineHeight.set(18),this._noteLineHeight.set(18),this._itemIndentSize.set(w.Z.PrefixWidth),this._fontWeight.set("normal"),this._bulletOpacity=this.getSettingValue("bulletOpacity",!0),this._projectOpacity=this.getSettingValue("projectOpacity",!0),this._numListOpacity=this.getSettingValue("numListOpacity",!0),this._collapserOpacity=this.getSettingValue("collapserOpacity",!0),this._checkboxOpacity=this.getSettingValue("checkboxOpacity",!0),this._checkboxBackgroundOpacity=this.getSettingValue("checkboxBackgroundOpacity",!0),this._verticalLinesOpacity=this.getSettingValue("verticalLinesOpacity",!0),this._tagColor=this.getSettingValue("tagColor",!0),this._dateColor=this.getSettingValue("dateColor",!0),this._contactColor=this.getSettingValue("contactColor",!0),this._linkColor=this.getSettingValue("linkColor",!0),this._grayscale=this.getSettingValue("grayscale"),this._cursorBlink=this.getSettingValue("linkColor",!0);var e=this.getSettingValue("font",!0),t=D.Z.windows&&e.w||D.Z.mac&&e.m||e.l;this._font.set(t)}catch(n){}}},{key:"_onFontChange",value:function(e){var t=(D.Z.windows?"w":D.Z.mac&&"m")||"l";_o.settings.ui.font.setProperty(t,e)}},{key:"onSettingChanged",value:function(){this.timeoutSettingChanged||this.isChangingTheme||(this.timeoutSettingChanged=setTimeout(this._updateSettings,0))}},{key:"_updateSettings",value:function(){var e=this._fontSize.get(),t=this._fontSizeHeader.get(),n=this._fontSizeHeaderTopLevel.get(),r=this._noteFontSize;this.timeoutSettingChanged=void 0,this.updateSettingValues();var i=this._fontSize.get()!==e||this._fontSizeHeader.get()!==t||this._fontSizeHeaderTopLevel.get()!==n||this._noteFontSize!==r;this._paddingsForLevel={},this.fireEvent("settingsChanged",[i]),_o.PaneManager&&_o.PaneManager.clearPaneCaches(),this.updateStyles()}},{key:"fontSize",value:function(){return this._fontSize.get()}},{key:"fontSizeHeader",value:function(){return this._fontSizeHeader.get()}},{key:"fontSizeHeaderTopLevel",value:function(){return this._fontSizeHeaderTopLevel.get()}},{key:"fontSizeHeaderProjectView",value:function(){return 17}},{key:"noteFontSize",value:function(){return this._noteFontSize.get()}},{key:"itemPadding",value:function(){return w.Z.ItemTextVPad}},{key:"notePadding",value:function(){return this._notePadding.get()}},{key:"itemLineHeight",value:function(){return this._itemLineHeight.get()}},{key:"noteLineHeight",value:function(){return this._noteLineHeight.get()}},{key:"itemIndentSize",value:function(){return this._itemIndentSize.get()}},{key:"itemIndentStart",value:function(){return 36}},{key:"paddingForBlockHeader",value:function(){return 0}},{key:"paddingForItemBottom",value:function(){return this.itemPadding()}},{key:"paddingForItemTop",value:function(e){return this.itemPadding()}},{key:"paddingForItemRight",value:function(e){var t,n;return((null===(t=(n=e.pane).shouldShowTime)||void 0===t?void 0:t.call(n,e))?w.Z.ItemPaddingRightVirtuosoAgenda:w.Z.ItemPaddingRightVirtuoso)+w.Z.TextPaddingLeft}},{key:"fontSizeForItem",value:function(e){return this.fontSizeObsForItem(e).get()}},{key:"fontSizeObsForItem",value:function(e){var t=e.item,n=e.pane;if(t){if(t.isPrefixCodeBlock())return this._fontSizeCodeBlock;if(t.isPrefixHeader()){if(n.isItemTopLevel(e))return this._fontSizeHeaderTopLevel;if(n.isViewOutline())return this._fontSizeHeader}}return this._fontSize}},{key:"lineHeightForItem",value:function(e){var t=e.item,n=this.itemLineHeight()-this.fontSize();return null!==t&&void 0!==t&&t.isNote()?this.noteLineHeight():this.fontSizeForItem(e)+n}},{key:"boldHeaders",value:function(){return this._boldHeaders.get()}},{key:"createSheet",value:function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.rel="stylesheet",e.appendChild(t),this.sheet=t.sheet}},{key:"getThemeObs",value:function(){return _o.settings.ui.themeMobile}},{key:"changeColorTheme",value:function(e){this.getThemeObs().set(e),this._updateColorTheme(e)}},{key:"_updateColorTheme",value:function(e){e!==this._colorTheme&&(this._colorTheme=e,this.updateSettingValues(),this.updateStyles(),this.fireEvent("themeChanged",[]))}},{key:"changeTheme",value:function(e,t){this.isChangingTheme=!0;var n=this.Themes[t];for(var r in n)n.hasOwnProperty(r)&&_o.settings.ui[r].set(n[r]);e.set(t),this.isChangingTheme=!1,this._updateSettings()}},{key:"updateStyles",value:function(){var e=0;if(this.sheet){var t=this.sheet.ownerNode;t.parentNode.removeChild(t)}try{_.Z.PAssert(405,"light"===this._colorTheme||"dark"===this._colorTheme,"Color theme is not light or dark",this._colorTheme)}catch(h){_.Z.reportError(h)}"light"!==this._colorTheme&&"dark"!==this._colorTheme&&(this._colorTheme="light"),this.createSheet();var n=[];if(this.boldHeaders()&&n.push(".item:not(.overviewItem).pHeader { font-weight: bold; }"),this._showVerticalLines){var r=this.itemIndentSize(),i=this.isDark()?255:0,a="rgba("+i+","+i+","+i+",",o=a+"1)",s=a+"0)";n.push(".vertLines { background: repeating-linear-gradient(to right, "+s+" 0, "+o+" 1px, "+s+" 2px, "+s+" "+r+"px) }")}n.push(".c-date.syncedToCalendar { border-color: ".concat(this._dateColor," !important;}")),n.push(".calendarDayTimes { background-image: linear-gradient(to bottom, "+M.Desktop.Colors[this._colorTheme].calendarLinesColor+" 1px, transparent 1px) !important; }");var c=this._font.get();c&&(c="San Francisco"===c?"-apple-system, BlinkMacSystemFont":'"'.concat(c,'"'),n.push(".fontPane { font-family: ".concat(c," }")));var l=this._fontWeight.get();if(l){var u=("light"===l?300:"normal"===l&&400)||"medium"===l&&500||"semibold"===l&&600||"bold"===l&&700;n.push(".fontPane { font-weight: ".concat(u," }"))}_o.settings.ui.underlineP.get()?_.Z.addClass(document.body,"underlineTags"):_.Z.removeClass(document.body,"underlineTags"),this._grayscale?_.Z.addClass(document.body,"grayscale"):_.Z.removeClass(document.body,"grayscale"),_o.settings.showMarkdown.get()?_.Z.addClass(document.body,"showMarkdown"):_.Z.removeClass(document.body,"showMarkdown"),_.Z.removeClass(document.body,"theme-light"),_.Z.removeClass(document.body,"theme-dark"),_.Z.addClass(document.body,"theme-"+this._colorTheme);for(var d=0;d<n.length;d++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.sheet.insertRule(n[d],0)}}},{key:"tagColor",value:function(){return this._tagColor}},{key:"dateColor",value:function(){return this._dateColor}},{key:"contactColor",value:function(){return this._contactColor}},{key:"noteColor",value:function(){return""}},{key:"isDark",value:function(){return"dark"===this._colorTheme}},{key:"lineItemHeight",value:function(e,t){var n;return(void 0===t||null!==(n=e.item)&&void 0!==n&&n.isNote())&&(t=1),this.paddingForItemTop(e)+this.paddingForItemBottom()+this.lineHeightForItem(e)*t}},{key:"getPaddingForLevel",value:function(e,t){var n=1e4*(t?1:0)+(e=Math.max(e+(t?1:0),0)),r=this._paddingsForLevel[n];return void 0===r&&(r=t?w.Z.OverviewPaddingStart+e*w.Z.OverviewPaddingIncrement:this.itemIndentStart()+e*this.itemIndentSize(),this._paddingsForLevel[n]=r),r}},{key:"getColorTheme",value:function(){return this.isPrinting.get()?"light":("auto"===(e=_o.settings.ui.themeMobile.get())&&(e=this.systemColorTheme.get()),e||"light");var e}},{key:"setSystemDarkMode",value:function(e){var t=e?"dark":"light";this.systemColorTheme.set(t),this._updateColorTheme(t)}},{key:"getForegroundColor",value:function(){return"dark"===this.getColorTheme()?"#fff":"#000"}}]),n}(E.Z),P()(r.prototype,"_onFontChange",[S.ZP],Object.getOwnPropertyDescriptor(r.prototype,"_onFontChange"),r.prototype),P()(r.prototype,"onSettingChanged",[S.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onSettingChanged"),r.prototype),P()(r.prototype,"_updateSettings",[S.ZP],Object.getOwnPropertyDescriptor(r.prototype,"_updateSettings"),r.prototype),P()(r.prototype,"updateStyles",[S.ZP],Object.getOwnPropertyDescriptor(r.prototype,"updateStyles"),r.prototype),r);var R=n(5375),O=n(7154),F=n.n(O),N=n(9955),B=n(4472),U=n(3656),j=n(5193),H=n(5428),V=n(3038),W=n.n(V),z=n(8276),q=n(5097),G=n(3234),K=n(4918);const Y=(0,G.Z)((function(e){var t,n,r,i,a,o=e.paneObject,s=e.el,c=o.item,l=s.props,u=s.getText(),d=!!l.plugin;if(l.plugin){var h=_o.pluginManager.getPluginDrive(),p=h.getAttachment(l.plugin.id);t=h.getAttachWidth(p),n=h.getAttachUrl(p),r=h.getAttachDataUrl(p),a=(i=p.isLocalOnlyAttachment())&&{background:"rgba(0,0,0,0.5)"}}else t=l.link.imageSize,n=l.link.href;var f=(0,N.useState)(t),g=W()(f,2),m=g[0],v=g[1],y=(0,N.useState)(!1),k=W()(y,2),Z=k[0],b=k[1],P=(0,K.Z)(),S=W()(P,2),D=S[0],I=S[1],E=(0,N.useRef)(),x=(0,N.useRef)(),C=_.Z.classNames("max-w-full align-top",{mdImage:!d},{driveImage:d}),A={maxWidth:m},L=u.match(w.Z.Regexp.DataImage)?void 0:u;return N.createElement("div",{className:"relative",style:A,ref:D},N.createElement("img",{className:C,src:r||n,"data-original-text":L,onLoad:function(e){var t=e.target.naturalWidth;x.current=t,m||v(t)}}),i&&N.createElement(q.Z,{style:a,color:"#eee",center:!0},"Uploading..."),(I||Z)&&N.createElement(z.Z,{className:"mdImageResizer flexbox flexvert",onMouseDown:function(e){b(!0),_.Z.preventAndStop(e),_.Z.isDraggingImage=!0},onMouseMove:function(e){var t=Math.round(e.clientX-D.current.getBoundingClientRect().left);t<=x.current&&v(t),_.Z.preventAndStop(e)},onMouseUp:function(){if(b(!1),_.Z.isDraggingImage=!1,d){var e=_o.pluginManager.getPluginDrive(),t=e.getAttachment(l.plugin.id);e.setAttachWidth(c,t,m)}else{var n=c.elsNew.findElement(o,(function(e){return e.props.link&&e.props.link.showImage}));n&&(n.el.props.link.imageSize=m,c.setTextFromEls(w.Z.ChangeType.Local))}},globalEvents:!0,ref:E}))}));var X;const Q=(X=function(){function e(){s()(this,e)}return l()(e,[{key:"onClickHandler",value:function(e,t,n){if(!B.Z.hasFullSelection()||!D.Z.isPriModKey(n)){var r=t.item,i=t.pane,a=e.props,o=B.Z.wasSelectedBeforeThisMouseEvent(t),s=D.Z.mac&&n.metaKey||!D.Z.mac&&n.ctrlKey;if(a.itemLink){var c=j.Z.getItem(a.itemLink);if(s)n.shiftKey?_o.PaneManager.clonePane(i,{item:c.id}):_o.menus.openModalPaneHighlightingItem({highlightItem:c});else if(c){var l,u;if(i.getItem()===c)i.zoomIn(r.parent(),{showToast:!0}),r.highlight(),null===(l=(u=i).scrollToMiddle)||void 0===l||l.call(u,r);else i.zoomIn(c,{showToast:!0})}}else if(a.link){var d=a.link.href;o||s||!_.Z.isUrlImage(d)?o&&!s||(_o.menus.openLink(d,n),_.Z.preventAndStop(n)):(_o.menus.openLightbox(d),_.Z.preventAndStop(n))}else if(a.contact||a.tag){var h=e.getText(),p=a.tag&&!o||s,f=n.altKey;if((p||f)&&B.Z.reset(),f){_o.PaneUpdateBatcher.beginUpdateItems();var g=r.getParsedText();g=g.replace(new RegExp(h,"g"),"").replace(/  +/g," "),r.setText(g,w.Z.ChangeType.Local),_o.PaneUpdateBatcher.commitUpdateItems()}else if(p)i.search.toggleText(h,n.shiftKey);else if(a.contact&&!o){var m=U.Z.findMatchExact(h[0]===w.Z.ContactPrefix?h.substr(1):h);m&&(_o.menus.openContact(m,n),_.Z.preventAndStop(n))}}else if(a.email){if(s){var v=_o.pluginManager.getPluginGmail();if(v.isActive()){B.Z.reset();var y={to:[{text:"",email:e.getText()}]};_o.menus.openComposeEmail(v,{initData:y})}}}else a.date?n.altKey?(B.Z.reset(),r.setMooDate(void 0,w.Z.ChangeType.Local,!0)):_o.menus.openDate({element:n.target,item:r,pane:i,paneObject:t}):a.plugin&&_o.pluginManager.handleTapClick(e,t,n)}}},{key:"renderToJSX",value:function(e,t,n){var r,i=0,a=[],o=n.noPrefix,s=n.highlightSearch,c=e.elsNew.elements,l=t&&B.Z.isSelected(t);if(s)if(_.Z.isString(s))r=s.split(" ").filter((function(e){return!!e}));else if(t){var u=t.pane.searchingPaneObjects.get();r=u.isSearching?u.text.split(" ").filter((function(e){return!!e})):t.pane.search.getSearchWords()}for(var d=0;d<c.length;d++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var h=c[d];if(!o||!h.props.prefixType){var p,f=h.getStyledText(e,n),g=c[d+1],m=g&&!!(g.props.plugin||null!==(p=g.props.link)&&void 0!==p&&p.appLink);if(f){var v=this.renderElToJSX(h,c,d,e,t,f,l,r,m?" padA":"",n);a.push(v)}}}return a}},{key:"renderElToJSX",value:function(e,t,r,i,a,o,s,c,l,u){var d,h=e.props,p=t[r-1],f=t[r+1],g=h.plugin||h.date;if(a&&e.isImage())return N.createElement(Y,{key:r,paneObject:a,el:e});if(g){var m,v=_.Z.classNames("mobutton","Date"!==g.p&&"padA",g.displayElement.attrs.cls.join(" "));if(e.props.date&&i.isRepeatDate()&&o.includes("\u27f3")){var y=o.split("\u27f3");o=y[0],m=N.createElement(N.Fragment,null,N.createElement(H.J,{name:"MdLoop"}),y[1])}return N.createElement("span",{key:r,className:v,plugin:g.p,"plugin-id":g.id,onClick:a&&this.onClickHandler.bind(this,e,a)},o,m)}if(null!==(d=h.link)&&void 0!==d&&d.appLink){var k,Z=e.getClassNames(!0)+" padA";return N.createElement("span",{key:r,"data-href":null!==(k=h.link)&&void 0!==k&&k.appLink?h.link.href:void 0,"data-text":o,className:Z,onClick:a&&this.onClickHandler.bind(this,e,a)},h.itemLink&&N.createElement(H.J,{name:"MdLink",style:{marginRight:4}}),o)}if(h.itemLink){var b=e.getClassNames(!0),P=h.itemLink?o.slice(0,-2).slice(2):o;return N.createElement("span",{key:r,"data-text":o,className:b,onClick:a&&this.onClickHandler.bind(this,e,a)},N.createElement("span",{className:"t-itemLinkBracket itemlinkbefore"},"[["),N.createElement("span",{className:"t-itemLink"},P),N.createElement("span",{className:"t-itemLinkBracket itemlinkafter"},"]]"))}var S=i.isPrefixCodeBlock();S&&!a&&(o=o.slice(0,Math.min(o.length,100)).replace(/\n/g," "));var D=!u.highlightSearch||S&&a?o:this.replaceTextWithSearchJSX(o,c,r),I={};h.link&&(I["data-href"]=h.link.href,I["data-text"]=h.link.text),h.code&&a&&(I.style={fontSize:_o.DisplaySettings.fontSizeForItem(a)-w.Z.SizeReductionInlineCode});var E=!u.noFormat&&e.getClassNames(!1,s,p,f);if(E=(E||"")+l)return N.createElement("span",F()({key:r,className:E.trim()},I,{onClick:this.onClickHandler.bind(this,e,a)}),D);if(S&&a){var x=_.Z.lazyLoad("ReactCodeBlock",(function(){return n.e(45).then(n.bind(n,1217))}));return N.createElement(N.Suspense,{key:r,fallback:N.createElement("div",null,N.createElement("pre",null,D))},N.createElement(x,{paneObject:a},o))}return D}},{key:"replaceTextWithSearchJSX",value:function(e,t,n){for(var r=0,i=e.toLowerCase(),a=[],o=e.length+1,s=0;s<t.length;s++){var c=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var l=t[s],u=void 0,d=void 0;(u=i.indexOf(l,d))>=0;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(u>=0)for(var h=0,p=u;p<u+l.length;p++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;(isNaN(o)||p<o)&&(o=p),a[p]=!0}d=u+1}}if(o<=e.length){for(var f=0,g=-1,m=!0,v=e.length-1;v>=o-1;v--){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;if(g>=0&&(v<0||!a[v])){var y=e.substring(v+1,g+1),k=e.substr(g+1),_=e.substr(0,v+1);m&&(m=!1),e=_+'<span class="c-search-highlight">'+y+"</span>"+k,g=-1}a[v]&&g<0&&(g=v)}return N.createElement("span",{key:n,dangerouslySetInnerHTML:{__html:e}})}return e}},{key:"renderElNew",value:function(e,t,n,r,i,a,o){var s,c=e[n],l=c.props,u=l.plugin||l.date;if(u&&a&&!a.plugin&&u.displayElement.attrs.cls.includes("plugin_drive_image_inline")){var d=_o.pluginManager.getPluginDrive(),h=d.getAttachment(u.id);if(d.getAttachUrl(h))return c.getStyledText(t,o)}else if(c.isImage()&&!l.plugin)return r||l.link.href;if(u)return this.renderPlugin(r,e,c,n);if(n>0&&"code"===e[0].props.prefixType)return"\n"===r[r.length-1]&&(r+=w.Z.TextSpace),r;if(null!==(s=l.link)&&void 0!==s&&s.appLink){var p=c.getClassNames(!0)+" padA",f=l.itemLink?' data-itemid="'.concat(l.itemLink,'"'):' data-href="'.concat(l.link.href,'"');return'<span class="'.concat(p,'"').concat(f,">").concat(l.itemLink?'<span class="ib" style="width: 18px"></span>':"").concat(r,"</span>")}if(l.itemLink){var g=c.getClassNames(!0),m=l.itemLink?' data-itemid="'.concat(l.itemLink,'"'):' data-href="'.concat(l.link.href,'"'),v=l.itemLink?r.slice(0,-2).slice(2):r;return'<span class="'.concat(g,'"').concat(m,'><span class="t-itemLinkBracket itemlinkbefore">[[</span>').concat(v,'<span class="t-itemLinkBracket itemlinkafter">]]</span></span>')}var y=o.highlightSearch,k=o.convertSpaces;o.fontSize;r=y?this.replaceTextWithSearch(r,a):_.Z.escape(r),k&&(r=r&&r.replace(/ /g,"&nbsp;"));var Z="";l.link&&(Z=' data-href="'.concat(l.link.href,'"'));var b=!o.noFormat&&c.getClassNames();return(b=(b||"")+i)?'<span class="'+b.trim()+'"'+Z+">"+r+"</span>":r}},{key:"renderNew",value:function(e,t,n,r){for(var i=0,a=[],o=r.noPrefix,s=(r.forHiddenInput,0);s<e.length;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var c=e[s];if(!o||!c.props.prefixType){var l=c.getStyledText(t,r);if(l){var u,d=e[s+1],h=d&&!!(d.props.plugin||null!==(u=d.props.link)&&void 0!==u&&u.appLink),p=this.renderElNew(e,t,s,l,h?" padA":"",n,r);a.push(p)}}}return a.join("")}},{key:"renderPlugin",value:function(e,t,n,r){var i=n.props.plugin||n.props.date,a=i.displayElement.attrs.cls.join(" ")+" padA";return'<span class="'.concat(a,'" plugin="').concat(i.p,'" plugin-id="').concat(i.id,'">').concat(e,"</span>")}},{key:"replaceTextWithSearch",value:function(e,t){for(var n=0,r=t.searchingPaneObjects.get(),i=r.isSearching?r.text.split(" ").filter((function(e){return!!e})):t.search.getSearchWords(),a=e.toLowerCase(),o=[],s=e.length+1,c=0;c<i.length;c++){var l=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var u=i[c],d=void 0,h=void 0;(d=a.indexOf(u,h))>=0;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(d>=0)for(var p=0,f=d;f<d+u.length;f++){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;(isNaN(s)||f<s)&&(s=f),o[f]=!0}h=d+1}}if(s<=e.length)for(var g=0,m=-1,v=!0,y=e.length-1;y>=s-1;y--){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;if(m>=0&&(y<0||!o[y])){var k=e.substring(y+1,m+1),Z=e.substr(m+1),w=e.substr(0,y+1);y===s&&(w=_.Z.escape(w)),v&&(Z=_.Z.escape(Z),v=!1),e=w+'<span class="c-search-highlight">'+_.Z.escape(k)+"</span>"+Z,m=-1}o[y]&&m<0&&(m=y)}else e=_.Z.escape(e);return e}},{key:"renderPrefix",value:function(e,t,n,r,i,a,o,s){var c=e.isComplete(),l=e.isPrefixTask(),u=e.isPrefixBullet(),d=e.isPrefixHeader(),h=e.isPrefixNumList(),p=(u?7:l&&14)||d&&20,f={width:w.Z.PrefixWidth,fontSize:p},g=_.Z.classNames("prefixNew flex justify-center",{prefixInPane:t},{alignIndentToPrefix:a},{prefixTaskNew:l},{prefixTaskComplete:l&&c},{prefixBulletNew:u},{"prefixHeaderNew t-prefixHeader":d},{"prefixNumListNew t-numlist":h},o),m=_.Z.classNames({"flex items-center justify-center":l},{"t-bullet":u},{"t-checkbox":l}),v=h&&e.elsNew.elements[0].getStyledText(e)||d&&"\u2756"||N.createElement("div",{className:m,style:{width:p,height:p}});return N.createElement("div",{className:g,style:f,onClick:s},v)}}]),e}(),P()(X.prototype,"renderElNew",[S.ZP],Object.getOwnPropertyDescriptor(X.prototype,"renderElNew"),X.prototype),X);var J,$=n(6479),ee=n.n($),te=n(9713),ne=n.n(te),re=n(7411),ie=n(1186),ae=n(9148),oe=n(6186),se=n(2269);const ce=(J=function(){function e(){s()(this,e),this.modalStack=new ae.Z,this.contextMenuStack=new ae.Z,this.emailComposeStack=new ae.Z}return l()(e,[{key:"openAddPaneMenu",value:function(e){e.componentName="ReactContextMenuPaneView",e.isAddPane=!0,this.openContextMenu(e)}},{key:"openContextMenu",value:function(e){e.element&&_.Z.isString(e.element)&&(e.element=_.Z.element(e.element)),e.element&&_.Z.findParent(e.element,"desktopSidebar")&&(e.pos={left:_o.DesktopUI.getSidebarWidth()+4},e.onSide="right",_.Z.findParent(e.element,"desktopMenuBottom")&&(e.openFromBottom=!0)),this.contextMenuStack.push(e)}},{key:"indexOfContextMenu",value:function(e){var t=this.contextMenuStack.get(),n=t.indexOfWithProperty("fn",e);return n<0&&(n=t.indexOfWithProperty("componentName",e)),n}},{key:"closeContextMenu",value:function(e,t,n){if(e){var r=this.indexOfContextMenu(e);try{_.Z.PAssert(406,r>=0,"Tried to close a context menu that was not open")}catch(s){_.Z.reportError(s)}if(r>=0){var i=this.contextMenuStack.get()[r];this.contextMenuStack.removeAt(r),i.onClosed&&i.onClosed(t,n)}}else{var a,o=this.contextMenuStack.pop();if(o)null===(a=o.onClosed)||void 0===a||a.call(o,!1,n)}0===this.contextMenuStack.length()&&B.Z.updateCaret()}},{key:"getTopContextMenu",value:function(){var e=this.contextMenuStack.get();if(e&&e.length){var t=e[e.length-1];return t.componentName||t.fn}}},{key:"closeTopContextMenu",value:function(){var e=this.getTopContextMenu();e&&this.closeContextMenu(e)}},{key:"isAutocompleteOpen",value:function(){return this.indexOfContextMenu("ReactAutocomplete")>=0||this.indexOfContextMenu("ReactContextMenuDate")>=0}},{key:"isOnlyAutocompleteOpen",value:function(){return this.isAutocompleteOpen()&&1===this.contextMenuStack.get().length}},{key:"isContextMenuOpen",value:function(e){return e?this.indexOfContextMenu(e)>=0:this.contextMenuStack.get().length>0}},{key:"isModalOpen",value:function(e){var t=this.modalStack.get();if(!e)return t.length>0;for(var n=0,r=0;r<t.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(t[r].id===e)return!0}}},{key:"openModal",value:function(e,t){var n=this;try{_.Z.PAssert(407,void 0===t||_.Z.isObject(t),"Must always pass in a valid object for params")}catch(r){_.Z.reportError(r)}if(!this.isModalOpen(e))return new Promise((function(i){t=t||{};try{_.Z.PAssert(408,void 0===t.id,"Should not already have an ID defined with modal params")}catch(r){_.Z.reportError(r)}var a=t.callback;t.id=e,t.callback=function(e){null===a||void 0===a||a(e),i()},B.Z.reset(),n.modalStack.push(t)}))}},{key:"closeModal",value:function(e,t){var n=this.modalStack.get().indexOfWithProperty("id",e);if(n>=0){var r=this.modalStack.get()[n],i=!0;r.onClosing&&(i=r.onClosing()),i&&(this.modalStack.removeAt(n),r.callback&&r.callback(t))}}},{key:"confirm",value:function(e,t,n){return new Promise((function(n){I.o0.openMenu({type:"Confirm",text:e,callback:function(e){n(e),t&&t(e)}})}))}},{key:"confirmComplex",value:function(e,t){var n=this;return new Promise((function(r){n.openModal(w.Z.Modals.ConfirmComplex,{text:e,buttons:t,callback:function(e){r(e)}})}))}},{key:"prompt",value:function(e){var t=e.title,n=e.text,r=e.cb,i=e.value;try{_.Z.PAssert(409,r,"Prompt modals should have callbacks",t)}catch(a){_.Z.reportError(a)}I.o0.openMenu({type:"Prompt",title:t,text:n,fields:[{value:i}],callback:function(e){return r(e?e[0]:void 0)}})}},{key:"promptComplex",value:function(e){I.o0.openMenu(Object.assign(e,{type:"Prompt"}))}},{key:"alert",value:function(e){I.o0.alert(e.text)}},{key:"options",value:function(e,t,n){try{_.Z.PAssert(411,_.Z.isArray(t),"Must have valid options array")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(412,n,"Options modal must have a callback")}catch(r){_.Z.reportError(r)}this.openModal(w.Z.Modals.Options,{text:e,options:t,callback:n})}},{key:"openSettings",value:function(e){_o.onIntroAction("SettingsMenu"),this.openModal(w.Z.Modals.Settings,{section:e,onClosing:this.onClosingSettings})}},{key:"onClosingSettings",value:function(){var e=!se.Z.isSaveEnabled.get();return e||this.confirm("You have unsaved changes. Are you sure you want to cancel your changes?",function(e){e&&(se.Z.isSaveEnabled.set(!1),this.closeModal(w.Z.Modals.Settings))}.bind(this)),e}},{key:"openDisplaySettings",value:function(){B.Z.reset(),_o.DisplaySettings.isOpen.set(!0),_o.onIntroAction("DisplaySettings")}},{key:"getUserName",value:function(){return _.Z.isDemoMode()?"Demo":re.Z.getAccountName()}},{key:"_indexOfCompose",value:function(e){for(var t=0,n=this.emailComposeStack.get(),r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(n[r].draftMsg.id===e)return r}return-1}},{key:"isComposeOpenForEmail",value:function(e){return e?this._indexOfCompose(e)>=0:this.emailComposeStack.length()>0}},{key:"openComposeEmail",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.threadID,i=n.messageID,a=n.initData,o=n.accountID;try{_.Z.PAssert(413,e,"Must have a valid email plugin")}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(414,!r||_.Z.isString(r),"Must have a string threadID")}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(415,!i||_.Z.isString(i),"Must have a string messageID")}catch(s){_.Z.reportError(s)}B.Z.reset(),this.isComposeOpenForEmail()||ie.Z.onLoaded((function(){var n=e.getDraftByID(o||e.getDefaultAccount(),r,i,a);try{_.Z.PAssert(416,n,"Must always create a valid draft")}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(417,t.emailComposeStack.indexOf(n)<0,"Must not double-open drafts, should re-use")}catch(s){_.Z.reportError(s)}t.emailComposeStack.get().indexOfWithProperty("attach",n.attach)<0&&t.emailComposeStack.push(n)}))}},{key:"closeComposeEmail",value:function(e,t){var n=this._indexOfCompose(t.id);try{_.Z.PAssert(418,n>=0,"Must have found a valid composing email to remove")}catch(r){_.Z.reportError(r)}this.emailComposeStack.removeAt(n)}},{key:"openItemEditor",value:function(e){try{_.Z.PAssert(419,!e.item===!!e.addOnSave,"Must be adding item if no item prop")}catch(r){_.Z.reportError(r)}if(!e.item){e.parent||(e.parent=e.pane&&e.pane.type===w.Z.PaneMode.Task?e.pane.getRootItem():j.Z.getDefaultDocument().getRootItem());var t=j.Z.createTempVMLI({text:e.text||_o.settings.getDefaultItemText(),date:e.mooDate},{changeType:w.Z.ChangeType.AllLocal});e.item=t;var n=e.endSave;e.endSave=function(e){setTimeout((function(){j.Z.destroyTempVMLI(t.id)}),0),n&&n(e)}}e.componentName="ReactItemDetailsPopup",this.openContextMenu(e)}},{key:"openLightbox",value:function(e,t,n){this.openModal(w.Z.Modals.Lightbox,{src:e,buttonText:t,buttonAction:n})}},{key:"confirmEncrypt",value:function(e,t){this.openModal(w.Z.Modals.ConfirmEncrypt,{password:e,onYes:function(){return t(!0)},onCancel:function(){return t(!1)}})}},{key:"openModalPaneHighlightingItem",value:function(e){var t=e.zoomItem,n=e.highlightItem,r=oe.Z.createPane(w.Z.PaneMode.Task,{id:"TEMP_Pane"+Date.now(),document:(t||n).getDocumentOwner(),item:t,rect:{left:0,right:0,width:1e3,height:1e3},viewState:{viewMode:"Outline"}});return r.init(),this.openModal(w.Z.Modals.ModalPane,{pane:r,scrollToItem:n}),B.Z.setFocusedPane(r),r}},{key:"getModalPanes",value:function(){return this.modalStack.get().filter((function(e){return e.id===w.Z.Modals.ModalPane})).map((function(e){return e.pane}))}},{key:"openDate",value:function(e){e.item;var t=e.paneObject;t&&t.pane.preventUpdateForObject(e.paneObject),I.o0.openMenu({type:"Date",item:e.item,paneObject:e.paneObject,focused:B.Z.isKeyboardOpen})}},{key:"openOptions",value:function(){this.openContextMenu({componentName:"ReactContextMenuOptions",element:_.Z.element("optionsButton")})}},{key:"openItemContextMenu",value:function(e,t,n){var r=e.pane,i=e.item,a=e.index,o=(null===n||void 0===n?void 0:n.element)||r.listManager.getElementByIndex(a);this.openContextMenu(Object.assign({componentName:"ReactContextMenuItem",key:"menu"+i.id+(t||""),item:i,pane:r,paneObject:e,element:o},n))}},{key:"openContextMenuList",value:function(e,t,n,r,i,a){var o=_.Z.isString(n[0]),s=n;return o&&(s=n.map((function(e){return _.Z.isString(e)?{id:e,value:e}:e}))),_.Z.promisify((function(t){I.o0.openActionSheet({title:e,maxHeight:.8,selected:i,showCheckboxes:r,items:s.map((function(e){return{text:e.value,onPress:function(){return t(e.id)}}}))})}))}},{key:"openContact",value:function(e,t){I.o0.openMenu({type:"Contact",contact:e})}},{key:"openLink",value:function(e,t){I.o0.openMenu({type:"OpenUrl",element:t.target,href:e})}}]),e}(),P()(J.prototype,"onClosingSettings",[S.ZP],Object.getOwnPropertyDescriptor(J.prototype,"onClosingSettings"),J.prototype),J);var le,ue=n(4327);const de=(le=function(){function e(){s()(this,e),this.enableTempPanePosition=!1,this.totalWidth=new x.Z(0),this._panesById={},this._panes=new ae.Z,this.displayPanes=new ae.Z,this.isLoading=new x.Z(!0),this._isInitialStateLoaded=!1,this.animatePaneSwap=!1,this._iteratingPanes=!1,this._savedPaneState=void 0}return l()(e,[{key:"init",value:function(){}},{key:"load",value:function(){_o.settings.activeUser.get()&&this.setupInitialTimeout(),this.isLoaded||(this._panes.listen(this.updateDisplayPanes),D.Z.windowSize.listen(this.onResize),ue.Z.listen("panesChanged",this.updateDisplayPanes),this.onResize(),this.isLoaded=!0)}},{key:"getStats",value:function(e){var t={};return void 0===e?this.runForEachPane((function(e){t[e.id]=e.getStats()})):t=this.getPaneById(e).getStats(),t}},{key:"setupInitialTimeout",value:function(){0===this._panes.length()&&(clearTimeout(this._initialTimeout),this._initialTimeout=setTimeout(this._timeoutLoadFailed.bind(this),3e4))}},{key:"notifyPanes",value:function(){this._panes.notify()}},{key:"onResize",value:function(){this.updatePaneRects()}},{key:"getNextPaneID",value:function(){return++_.Z.totalPanes+"P"+Date.now()}},{key:"getAllPerPaneState",value:function(e,t){for(var n=0,r=[],i=this.paneCount(),a=0;a<i;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=this.getPaneAtIndex(a);r.push(o.getPerPaneState(e,t))}return r}},{key:"setAllPerPaneState",value:function(e,t,n){for(var r=0,i=this.paneCount(),a=0;a<i;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this.getPaneAtIndex(a).setPerPaneState(e,t,n)}}},{key:"deletePerPaneState",value:function(e,t){var n=this.getPaneById(e);n&&n.deletePerPaneState(t)}},{key:"updatePaneStateForPane",value:function(e,t){try{_.Z.PAssert(892,e,"Must pass in a valid pane to update")}catch(n){_.Z.reportError(n)}this._isLoading||this.savePaneState(t)}},{key:"recreatePaneState",value:function(){var e=[];return this.runForEachPane((function(t){e.push(t.getSaveInfo())})),e}},{key:"isPaneActive",value:function(e){return!!this._panesById[e]}},{key:"createPaneAtIndex",value:function(e,t,n,r){try{_.Z.PAssert(893,e,"Must supply a valid pane type")}catch(a){_.Z.reportError(a)}try{_.Z.PAssert(894,!this._iteratingPanes,"Should not change pane array while iterating")}catch(a){_.Z.reportError(a)}isNaN(t)&&(t=this.paneCount()),(n=n||{}).id=n.id||this.getNextPaneID(),n.document=n.document||j.Z.getDefaultDocument(),_.Z.isString(n.item)&&(n.item=j.Z.getItem(n.item));var i=oe.Z.createPane(e,n);return i?this.addPaneAtIndex(i,t,!1,r):_.Z.reportError(new Error("Invalid pane created: "+e+" | "+t)),i}},{key:"addPaneAtIndex",value:function(e,t,n,r){try{_.Z.PAssert(895,e,"Must supply a valid pane")}catch(o){_.Z.reportError(o)}this._panesById[e.id]&&(e.id=this.getNextPaneID());try{_.Z.PAssert(896,!this._panesById[e.id],"Should never add the same pane twice")}catch(o){_.Z.reportError(o)}if(this._panesById[e.id]=e,this.enableTempPanePosition&&this._panes.length()>0&&t===this._panes.length()){var i=this._panes.get()[this._panes.length()-1];this.tempPositionForNewPane={pane:i,left:i.rect.get().left}}if(isNaN(t)?this._panes.push(e,r):this._panes.splice(t,0,e,r),this._initPane(e),this.tempPositionForNewPane&&(this.tempPositionForNewPane=null,setTimeout(this.onResize.bind(this),0)),this.ensurePaneInView(e),!n){var a=this.getPaneState();isNaN(t)?a.push(e.getSaveInfo()):a.splice(t,0,e.getSaveInfo()),this.savePaneState()}}},{key:"_initPane",value:function(e){e.init(),e.isExpanded.listen(this.onResize),this._panesById[e.id]=e}},{key:"unloadPane",value:function(e){e.unload(),e.isExpanded.unlisten(this.onResize),ue.Z.fireEvent("paneRemoved",[e]);try{_.Z.PAssert(897,this._panesById[e.id],"Should never unload a pane that does not exist")}catch(t){_.Z.reportError(t)}this._panesById[e.id]=void 0,e.destroy()}},{key:"removePaneAtIndex",value:function(e,t){try{_.Z.PAssert(898,!isNaN(e),"Must supply a valid index to remove from")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(899,!this._iteratingPanes,"Should not change pane array while iterating")}catch(i){_.Z.reportError(i)}var n=this._panes.splice(e,1,void 0,t)[0];try{_.Z.PAssert(900,n,"Must have removed a valid pane")}catch(i){_.Z.reportError(i)}this.unloadPane(n),this.getPaneState().splice(e,1),this.savePaneState();var r=n.id;return this.ensurePaneInView(),r}},{key:"loadPaneFromState",value:function(e){if(e.id&&this.isPaneActive(e.id))return this._panesById[e.id];var t=e.item||e.focus,n=t&&j.Z.getItem(t),r=e.document,i=j.Z.getDocumentById(r);n&&n.isDeleted()&&(n=void 0);var a,o=e.type||"PaneTask",s=_.Z.clone(e);return s.item=n,s.document=i,s.deferredItemID=n?void 0:t,s.offset=e.offset,s.id&&this.isPaneActive(s.id)||(a=oe.Z.createPane(o,s))&&(e.id=a.id,e.showarch&&a.showArchived.set(!0),a.applyItemState(e.itemState)),a}},{key:"removeFocusedPane",value:function(){return this.removePane(_.Z.focusedPane)}},{key:"removePane",value:function(e){var t=this.getPaneIndex(e);return this.removePaneAtIndex(t)}},{key:"clearPanes",value:function(e){try{_.Z.PAssert(901,_.Z.isDemoMode(),"Should only be clearing panes in demo mode")}catch(t){_.Z.reportError(t)}B.Z.setFocusedPane(void 0),this.runForEachPane((function(e){e.destroy()})),this._panesById={},this._panes.set([],e)}},{key:"clearPaneCaches",value:function(){this.runForEachPane((function(e){e.listManager.clearCache()}))}},{key:"getPaneAtIndex",value:function(e){return this._panes.get()[e]}},{key:"getPaneIndex",value:function(e){return this._panes.get().indexOf(e)}},{key:"getFocusedPaneIndex",value:function(){return this.getPaneIndex(_.Z.focusedPane)}},{key:"hasPaneById",value:function(e){return!!this._panesById[e]}},{key:"getPaneById",value:function(e){try{_.Z.PAssert(904,this._panesById[e],"Should never request a pane that is not currently loaded")}catch(t){_.Z.reportError(t)}return this._panesById[e]}},{key:"getPaneByName",value:function(e){try{_.Z.PAssert(905,this._panesByName[e],"Should never request a pane that is not currently loaded")}catch(t){_.Z.reportError(t)}return this._panesByName[e]}},{key:"getPanesByType",value:function(e){for(var t=0,n=[],r=this.paneCount(),i=0;i<r;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=this.getPaneAtIndex(i);e&&a.type!==e||n.push(a)}return n}},{key:"paneCount",value:function(){return this._panes.get().length}},{key:"runForEachPane",value:function(e,t){var n=0;this._iteratingPanes=!0;for(var r=this._panes.get().concat(_o.menus.getModalPanes()),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i];try{_.Z.PAssert(906,!a.isDestroyed(),"Should never have a destroyed pane in pane list")}catch(o){_.Z.reportError(o)}if(!t||a.type===t)try{e(a)}catch(s){_.Z.reportError(s)}}this._iteratingPanes=!1}},{key:"distance",value:function(e,t){return Math.abs(e-t)}},{key:"findIndex",value:function(e,t){var n=this._panes.get(),r=n.map((function(e){return e.rect.get()})),i=n.indexOf(e),a=i,o=r[a],s=o.left,c=s+o.width;if(t>0){var l=r[i+1];if(void 0===l)return i;t>this.distance(c,l.left+l.width/2)+5&&(a=i+1)}else if(t<0){var u=r[i-1];if(void 0===u)return i;var d=u.left+u.width;t<-(this.distance(s,d-u.width/2)+5)&&(a=i-1)}return _.Z.clamp(a,0,r.length)}},{key:"dragPaneTo",value:function(e,t){var n,r=this._panes.get(),i=this.findIndex(e,t);if(i>=0){var a=r.indexOf(e);a!==i&&(r.splice(i,0,r.splice(a,1)[0]),this._panes.set(r),this.savePaneState(),n=!0)}return n}},{key:"movePaneTo",value:function(e,t){var n=this._panes.get(),r=n.indexOf(e);n.splice(t,0,n.splice(r,1)[0]),this._panes.set(n),this.savePaneState()}},{key:"paneSortFn",value:function(e,t){return e.uniquePaneID-t.uniquePaneID}},{key:"clearLoadTimeout",value:function(){clearTimeout(this._initialTimeout),this._initialTimeout=void 0,_o.toasts.clearMessage(w.Z.MessageID.PaneLoadTimeout)}},{key:"updateDisplayPanes",value:function(){var e=0;this._initialTimeout&&this.clearLoadTimeout();for(var t=this._panes.get().slice(0).sort(this.paneSortFn),n=[],r=0;r<t.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=t[r];i.isOverviewVisible()&&n.push({type:"overview",pane:i}),n.push({type:"pane",pane:i}),i.isExpanded.get()&&n.push({type:"emailPreview",pane:i})}this.updatePaneRects(),this.displayPanes.set(n),this.isLoading.set(!1)}},{key:"hasScrollbar",value:function(){return this.totalWidth.get()>D.Z.windowWidth()}},{key:"onBoardChanged",value:function(){this.loadPanesFromState()}},{key:"_addPaneByButton",value:function(e,t,n,r){var i=this.createPaneAtIndex(e,void 0,{viewState:{viewMode:t},item:n});return B.Z.setFocusedPane(i),i.onAdded(),i}},{key:"addPaneByButton",value:function(e,t,n){var r=oe.Z.canCreatePane(e);if(!0===r)return this._addPaneByButton(e,t,n);_o.toasts.pushMessage("Cannot create pane because ".concat(r))}},{key:"emailPreviewSize",value:function(e){var t=this._panes.length()>1?w.Z.EmailPreviewSizeMaxFlex:w.Z.EmailPreviewSizeMax,n=e.widthManual||w.Z.ExpandedPaneWidth;return e.getOverview().isVisible.get()&&(n+=w.Z.OverviewWidth),Math.max(Math.min(t,D.Z.windowWidth()-n),w.Z.EmailPreviewSizeMin)}},{key:"onLoadRemote",value:function(){}}]),e}(),P()(le.prototype,"onResize",[S.ZP],Object.getOwnPropertyDescriptor(le.prototype,"onResize"),le.prototype),P()(le.prototype,"updateDisplayPanes",[S.ZP],Object.getOwnPropertyDescriptor(le.prototype,"updateDisplayPanes"),le.prototype),P()(le.prototype,"onBoardChanged",[S.ZP],Object.getOwnPropertyDescriptor(le.prototype,"onBoardChanged"),le.prototype),le);var he,pe=n(3017);function fe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}const ge=(he=function(e){p()(n,e);var t=fe(n);function n(){return s()(this,n),t.call(this)}return l()(n,[{key:"load",value:function(){this.isLoaded||(pe.Z.init(),d()(v()(n.prototype),"load",this).call(this),_o.DesktopUI.sidebarChanged.listen(this.onResize))}},{key:"onPluginGmailToggled",value:function(){this.savePaneState(),this.loadPanesFromState()}},{key:"loadPanesFromState",value:function(){var e=this;this.load();var t=this.getPaneState();if(t){var n=0,r=0,i=!1;this._isLoading=!0,_o.PaneUpdateBatcher.beginUpdateItems();for(var a={},o=function(r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=e.getPaneAtIndex(r),o=t.find((function(e){return e.id===i.id}));o?(i.onRemoteUpdate(o),a[i.id]=i):e.unloadPane(i)},s=0;s<this.paneCount();++s)o(s);this._panes.set([],!1);for(var c=[],l=0;l<t.length;++l){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=t[l];if(D.Z.supportsMultiplePanes.get()||(u.isOverviewVisible=!1),a[u.id])c[l]=a[u.id];else{var d=this.loadPaneFromState(u);if(d){if(c[l]=d,this._initPane(d),d.usesVMLIs){var h=d.getItem(!0);if(!h&&d.type===w.Z.PaneMode.Task)h=j.Z.getDefaultDocument().getRootItem();d.zoomIn(h,{forLoad:!0})}}else i=!0}}c=_.Z.arrayUniques(c.filter((function(e){return!!e})),"id"),this._panes.set(c),this._isLoading=!1,i&&this.savePaneState(),_o.PaneUpdateBatcher.commitUpdateItems()}}},{key:"loadPaneFromState",value:function(e){if(e.id&&this.isPaneActive(e.id))return this._panesById[e.id];var t=e.item||e.focus,n=e.type||"PaneTask";"PaneDrive"===n&&t.startsWith("A~")?t="Drive~"+t:"PaneGmail"===n&&t.startsWith("A~")&&(t="Gmail~"+t);var r=t&&j.Z.getItem(t);r&&r.isDeleted()&&(r=void 0),r||(n===w.Z.PaneMode.Task?r=j.Z.getDefaultDocument().getRootItem():n===w.Z.PaneMode.Inbox&&(r=t));var i,a=_.Z.clone(e);return a.item=r,a.deferredItemID=r?void 0:t,a.scrollIndex=e.scrollIndex,this._panesById[e.id]&&(e.id=this.getNextPaneID()),a.id&&this.isPaneActive(a.id)||(i=oe.Z.createPane(n,a))&&(e.id=i.id,e.showarch&&i.showArchived.set(!0),i.applyItemState(e.itemState)),i}},{key:"savePaneState",value:function(e){try{_.Z.PAssert(420,!this._isLoading,"Bad stuff! Saving pane state during load")}catch(n){_.Z.reportError(n)}if(_.Z.isDemoMode()||this._isInitialStateLoaded&&_o.settings.activeUser.get()){var t=this.recreatePaneState();pe.Z.savePaneState(t,e)}}},{key:"getPaneState",value:function(){return pe.Z.getPaneState()}},{key:"hasLoadedPaneState",value:function(){return pe.Z.hasLoadedPaneState()}},{key:"loadInitialState",value:function(){this._isInitialStateLoaded||(this.loadPanesFromState(),pe.Z.selected.listen(this.onBoardChanged),this._isInitialStateLoaded=!0)}},{key:"addBoard",value:function(){var e=pe.Z.add();return this.selectBoard(e),_o.onIntroAction("AddBoard"),e}},{key:"selectBoard",value:function(e){pe.Z.selectBoard(e)}},{key:"removePanesByType",value:function(e){var t=0,n=[];this.runForEachPane((function(e){n.push(e)}),e);for(var r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.removePane(n[r])}}},{key:"getAvailableArea",value:function(){return _o.DesktopUI.getSidebarWidth()-2}},{key:"updatePaneRects",value:function(e){this.isResizingPane=e;var t=this._panes.get(),n=D.Z.windowHeight()-_o.DesktopUI.topBarHeight(),r=D.Z.windowWidth()-_o.DesktopUI.getSidebarWidth();if(D.Z.supportsMultiplePanes.get()){var i,a,o=_o.DesktopUI.getSidebarWidth();if(r+=2,_.Z.isDemoInIframe()&&(r-=5),t.length>0){var s,c,l=0,u=0,d=0,h=[],p=[],f=0;for(i=0;i<t.length;i++){var g;if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var m=t[i];m.widthManual?(p[i]=m.widthManual,f+=m.widthManual):m.isExpanded.get()?(p[i]=w.Z.ExpandedPaneWidth,f+=w.Z.ExpandedPaneWidth):h.push({index:i,pane:m}),m.isExpanded.get()&&(f+=m.widthManualExpanded||this.emailPreviewSize(m)),null!==(g=m.getOverview())&&void 0!==g&&g.isVisible.get()&&(f+=w.Z.OverviewWidth)}for(var v=r-f;h.length>0;){var y=0;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var k=Math.floor(v/h.length),Z=-1,b=k;for(i=0;i<h.length;i++){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;var P=h[i].pane;P.maxWidthFlex<b&&(Z=i,b=P.maxWidthFlex)}if(Z>=0){var S=h[Z].pane;s=Math.min(1===t.length?S.widthBiggerInSingle?S.maxWidthSingle:S.maxWidthFlex:h[Z].pane.maxWidthFlex,v),p[h[Z].index]=s,f+=s,v-=s,h.splice(Z,1)}else{var I=0,E=-1,x=k;for(i=0;i<h.length;i++){if(I++>5e3&&__infLoop&&__infLoop(I))throw new RangeError;var C=h[i].pane;C.minWidthFlex>x&&(E=i,x=C.minWidthFlex)}if(!(E>=0)){var A=0;for(i=0;i<h.length;i++){if(A++>5e3&&__infLoop&&__infLoop(A))throw new RangeError;p[h[i].index]=k,f+=k}break}s=h[E].pane.minWidthFlex,p[h[E].index]=s,f+=s,v-=s,h.splice(E,1)}}var L=Math.max((r-f)/2,0),M=!1;for((a=Math.floor(L)+o)!==Math.round(L)&&(M=f+1===r),_.Z.isDemoInIframe()&&(a+=2),i=0;i<t.length;i++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var T=t[i];s=p[i]+(M&&i===t.length-1?1:0),c=T.isExpanded.get()?T.widthManualExpanded||this.emailPreviewSize(T):0,T.isOverviewVisible()&&(a+=w.Z.OverviewWidth),this.tempPositionForNewPane&&T.rect.get()?(T.rect.get().width=s,T.rect.notify()):T.setRect({left:a,top:0,width:s-(0===i?2:1),height:n,right:a+s,bottom:n,isFirst:0===i,numPanes:t.length,widthExpanded:c}),i>0&&T.isOverviewVisible()&&s++,a+=s,T.isExpanded.get()&&(a+=c)}}if(this.tempPositionForNewPane){var R=t[t.length-1].rect.get(),O=this.tempPositionForNewPane;R.left=O.left+O.pane.rect.get().width}this.totalWidth.set(a),e||ue.Z.fireEvent("paneSizeChanged",[]),B.Z.updateCaretAndCaretItem(),setTimeout((function(){B.Z.updateCaretAndCaretItem()}),500)}else t.forEach((function(e){return e.rect.set({left:0,right:0,width:r,top:0,bottom:n,height:n})}))}},{key:"ensurePaneInView",value:function(e){if(_.Z.vmMain.panesContainer){if(!e){var t=this._panes.get();e=t[t.length-1]}if(e){var n=e.rect.get();if(n){var r=n.width+(e.isExpanded.get()?n.widthExpanded:0),i=D.Z.windowWidth()-(_o.DesktopUI.getSidebarWidth()-2),a=_.Z.vmMain.getScrollOffset(),o=n.left-a,s=n.left+r-a;(o<0||s>i)&&_.Z.vmMain.setScrollOffset(n.left+r-i)}}}}},{key:"scrollToAndHighlightItem",value:function(e,t){e.highlight(),this.runForEachPane((function(n){n!==t&&n.type===w.Z.PaneMode.Task&&n.isViewOutline()&&n.scrollToMiddle(e)}))}},{key:"_timeoutLoadFailed",value:function(){0===this._panes.length()&&0===_o.menus.modalStack.length()&&(_.Z.reportError(new Error("Pane Load Timeout")),_o.toasts.pushMessage(w.Z.MessageID.PaneLoadTimeout))}},{key:"onRemoteUpdate",value:function(e){var t=this;e.forEach((function(e){if(t.hasPaneById(e.id)){var n=t.getPaneById(e.id);n&&(n.applyItemState(e.itemState),n.updateItemsImmediate())}}))}},{key:"clonePaneAsOutline",value:function(e,t){this.clonePane(e,Object.assign({viewState:{viewMode:"Outline"},search:{showHierarchy:!0,showOnlyMatches:0}},t))}},{key:"clonePane",value:function(e,t){var n=this.getPaneIndex(e),r=e.getSaveInfoForClone();return t&&(t.search&&(Object.assign(r.search,t.search),delete t.search),Object.assign(r,t)),this.createPaneAtIndex(r.type,n+1,r)}},{key:"checkAddingPane",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=_o.billingManager.premiumLevel.get();if("Pro"===n)return!0;var r=pe.Z.numPanesTotal(!0),i="Basic"===n?20:6,a=r+t<=i;if(a)return!0;_o.menus.openContextMenu({componentName:"ReactContextMenuUpsell",element:e,premiumMessage:"Using more than a total of ".concat(i," Panes is a Premium feature."),enableMessage:"unlimited Panes"})}}]),n}(de),P()(he.prototype,"savePaneState",[S.ZP],Object.getOwnPropertyDescriptor(he.prototype,"savePaneState"),he.prototype),he);var me,ve=n(5252),ye=n(461),ke=n(9998),_e=D.Z.demo,Ze=864e5;const we=(me=function(){function e(){var t=this;s()(this,e),this.onLoaded=new x.Z(!1),this._premiumStatus=new x.Z(w.Z.PremiumStatus.Unknown),this.premiumPlan=new x.Z("Unknown"),this.premiumLevel=new C.Z([this.premiumPlan],(function(e){return(t._premiumCode||"Lifetime"===e||"Pro"===e?"Pro":"Basic"===e&&"Basic")||"Free"})),this.userProperties=new ke.Z,this.appleIAPPurchase=new x.Z,_e&&(this._premiumStatus.set(w.Z.PremiumStatus.Active),this.premiumPlan.set("Pro")),this.isPremiumObservable=new C.Z([this._premiumStatus],(function(){return t.hasPremium()})),this.hasPremiumFeaturesObservable=new C.Z([this._premiumStatus],(function(){return t._computeHasPremiumFeatures()})),this.hasProFeaturesObservable=new C.Z([this._premiumStatus,this.premiumLevel],(function(){return t._computeHasPremiumFeatures()&&"Pro"===t.premiumLevel.get()})),this._lastSignupError=-1,this._earlyAdopter=!1,this._planID=void 0,this._inviteCode=void 0,this._referredBy=void 0,this._joinDate=void 0,this._premiumStartDate=void 0,this._premiumEndDate=void 0,this._premiumCode=void 0,this._premiumCodeExpired=!1,this._nextBillingDate=void 0,this._trialStart=void 0,this._trialDuration=void 0,this._trialExtended=void 0,this._billingIdentifier=void 0,this._hasValidBillingData=new x.Z(!1),this.daysLeftInTrial=new x.Z(-1),this.inviteCodeError=new x.Z,this.inviteEmailError=new x.Z,this.inviteEmailSuccess=new x.Z,this.init()}return l()(e,[{key:"init",value:function(){var e=this;this._premiumStatus.listen((function(t,n){e.hasPremiumFeatures()?(_o.pluginManager.notifyDependencyLoad(w.Z.PluginDependency.EarlyAccess),_o.pluginManager.notifyDependencyLoad(w.Z.PluginDependency.PremiumSub)):e.hasEarlyAccess()&&_o.pluginManager.notifyDependencyLoad(w.Z.PluginDependency.EarlyAccess),t!==n&&n&&_o.DisplaySettings.onSettingChanged()})),_e?this.onLoaded.set(!0):_o.settings.onLoaded((function(){var t=_o.settings.userProperties.get();if(e.userProperties.set(t),t){e.updateBillingData(),_.Z.shouldLog(w.Z.LogLevels.Account)&&_.Z.log("Premium Status (Local): ",t.premiumStatus);var n=ve.Z.getURLParam("premium");void 0!==n&&ve.Z.removeURLParam("premium",!0),n&&setTimeout((function(){_o.menus.openSettings("Moo.do Account")}),100)}e.onLoaded.set(!0)})),D.Z.app&&I.LA.onIAPUpdated(function(){var t=a()(k().mark((function t(n){return k().wrap((function(t){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(t.prev=t.next){case 0:if(!n){t.next=8;break}if(!n.transactionReceipt){t.next=6;break}return t.next=5,ye.Z.updateIAP(n);case 5:e.appleIAPPurchase.set(n);case 6:t.next=9;break;case 8:e.appleIAPPurchase.set(null);case 9:case"end":return t.stop()}}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"setLastSignupError",value:function(e){this._lastSignupError=e}},{key:"_reportRemoteStatusFailure",value:function(){_.Z.sendEvent("Billing","RemoteStatusFailure")}},{key:"getBillingIdentifier",value:function(){var e;this._billingIdentifier;return this._billingIdentifier}},{key:"onBillingIdentifierAvailable",value:function(e){}},{key:"onConnected",value:function(e){}},{key:"hasPremium",value:function(){return this._premiumStatus.get()===w.Z.PremiumStatus.Active||this._premiumStatus.get()===w.Z.PremiumStatus.PastDue}},{key:"isTrialState",value:function(){return this._premiumStatus.get()===w.Z.PremiumStatus.Trial||this._premiumStatus.get()===w.Z.PremiumStatus.TrialOver}},{key:"isCanceledState",value:function(){return this._premiumStatus.get()===w.Z.PremiumStatus.CanceledUser||this._premiumStatus.get()===w.Z.PremiumStatus.CanceledPastDue}},{key:"canceledUserHasPremiumAccess",value:function(){var e=this.getPremiumEndDate();return this.isCanceledState()&&e&&e.getTime()>Date.now()}},{key:"hasSubscription",value:function(){return!!this._subscriptionID||!!this._appleIAP}},{key:"updateBillingData",value:function(){var e,t=this.userProperties.get(),n=t.premiumStatus,r=t.planID;this._earlyAdopter=t.earlyAdopter,this._planID=r,this._joinDate=t.joinDate?new Date(t.joinDate):new Date,this._premiumStartDate=t.premiumSignupDate?new Date(t.premiumSignupDate):new Date,this._premiumEndDate=t.premiumEndDate?new Date(t.premiumEndDate):void 0,this._premiumCode=t.premiumCode,this._nextBillingDate=t.nextBillingDate?new Date(t.nextBillingDate):void 0,this._trialStart=t.trialStart?new Date(t.trialStart):new Date,this._trialDuration=t.trialDuration||w.Z.TrialDuration,this._trialExtended=t.trialExtended||!1,this._subscriptionID=t.subscriptionID,this._appleIAP={plan:t.appleIAPPlan,transactionID:t.appleIAPTransactionId},e=n===w.Z.PremiumStatus.CanceledPastDue||n===w.Z.PremiumStatus.CanceledUser?-1:Math.round(this._trialDuration-(Date.now()-this._trialStart.getTime())/Ze);try{_.Z.PAssert(281,e<=320,"Sanity check on trial length",e)}catch(a){_.Z.reportError(a)}if(this.daysLeftInTrial.set(e),!_e){var i=r&&(("l"===r?"Lifetime":(r===w.Z.PremiumPlans.Basic.month||r===w.Z.PremiumPlans.Basic.year)&&"Basic")||(r===w.Z.PremiumPlans.Pro.month||r===w.Z.PremiumPlans.Pro.year||r===w.Z.PremiumPlans.Legacy.month||r===w.Z.PremiumPlans.Legacy.year)&&"Pro")||n===w.Z.PremiumStatus.Active&&"Lifetime"||"Free";this.premiumPlan.set(i)}n===w.Z.PremiumStatus.Trial&&e<0?(n=w.Z.PremiumStatus.TrialOver,ye.Z.updatePremiumStatus(),this.notifyTrialOver()):n===w.Z.PremiumStatus.Trial&&e<5&&this.notifyTrialEndSoon(),!_e&&n&&this.setPremiumStatus(n),this._hasValidBillingData.set(!0)}},{key:"setPremiumStatus",value:function(e){if(!_e){try{_.Z.PAssert(282,_.Z.isNumber(e),"Status must be a valid number",e)}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(283,e>0&&e<8,"Should be a valid status identifier",e)}catch(t){_.Z.reportError(t)}e!==this._premiumStatus.get()&&(this._premiumStatus.set(e),_.Z.setDimension(w.Z.Analytics.Dimensions.PremiumStatus,e))}}},{key:"hasValidBillingData",value:function(){return this._hasValidBillingData.get()}},{key:"getPremiumStatus",value:function(){return this._premiumStatus.get()}},{key:"getInviteCode",value:function(){return this._inviteCode}},{key:"getJoinDate",value:function(){return this._joinDate||new Date}},{key:"getPremiumStartDate",value:function(){return this._premiumStartDate||new Date}},{key:"getPremiumEndDate",value:function(){return this._premiumEndDate}},{key:"hasTrialExtended",value:function(){return this._trialExtended||!1}},{key:"isEligibleForTrialExtension",value:function(){return!1}},{key:"getNextBillingDate",value:function(){return this._nextBillingDate}},{key:"hasEarlyAccess",value:function(){return this.hasPremiumFeatures()||this.canceledUserHasPremiumAccess()}},{key:"cancelSubscription",value:function(e,t){_.Z.sendEvent("Billing","SubCancelTapped");var n=function(){t&&_.Z.isFunction(t)&&t()};return _o.menus.confirm("Are you sure you want to cancel your subscription?",(function(e){e?(_.Z.sendEvent("Billing","SubCancelYES"),ye.Z.cancelPremium().then((function(e){var t=e.value?"Your premium subscription has been canceled. Please contact support@moo.do if you need assistance.":"There was a server error, please try again in a few minutes or contact support@moo.do.";_o.menus.alert({text:t}),n()}))):(n(),_.Z.sendEvent("Billing","SubCancelNO"))})),!0}},{key:"getCustomPurchaseURL",value:function(){}},{key:"_openPaymentWindow",value:function(e){_o.menus.openModal(w.Z.Modals.Billing,{isUpdate:e,planID:this._planID})}},{key:"onTapUpdatePaymentMethod",value:function(){this._openPaymentWindow(!0)}},{key:"onTapViewInvoices",value:function(e,t){return ye.Z.listTransactions().then((function(e){if(e&&e.value)try{_o.menus.openModal(w.Z.Modals.Invoices,e.value)}catch(n){_.Z.reportError(n)}else _o.menus.alert({text:"There was an error retreiving your invoice data. Please contact support@moo.do."});t()})),!0}},{key:"onTapDeleteAccount",value:function(e,t){return a()(k().mark((function e(){return k().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,_o.menus.confirm('Are you sure you want to delete your account? This will delete all of your data. You may want to export your documents first.<br/><br/><div class="c-error font-bold">This cannot be undone.</div>',void 0,{isHTML:!0});case 2:e.sent?_o.menus.openModal(w.Z.Modals.DeleteAccount,{callback:function(e){e?ye.Z.deleteAccount().then((function(e){e.value?j.Z.clearLocalData():_o.menus.alert({text:"There was a server error. Please try again in a few minutes or contact support@moo.do."}),t()})):t()}}):t();case 4:case"end":return e.stop()}}}),e)})))(),!0}},{key:"getInviteUrl",value:function(){return"https://www.moo.do/"}},{key:"getSelectText",value:function(){return"Select and press "+D.Z.cmdChar+" + C to copy to clipboard"}},{key:"wasInvited",value:function(){return!!this._referredBy}},{key:"sendInviteEmail",value:function(e,t){}},{key:"joinDateText",value:function(){return this.getJoinDate().toString(_o.International.getFormat(w.Z.DFormat.LongStrDate))}},{key:"premiumStartDateText",value:function(){return this.getPremiumStartDate().toString(_o.International.getFormat(w.Z.DFormat.LongStrDate))}},{key:"premiumEndDateText",value:function(){var e=this.getPremiumEndDate();return e?e.toString(_o.International.getFormat(w.Z.DFormat.LongStrDate)):"Never"}},{key:"nextBillingDateText",value:function(){var e=this.getNextBillingDate();return e?e.toString(_o.International.getFormat(w.Z.DFormat.LongStrDate)):"Never"}},{key:"shareTwitter",value:function(){var e="https://twitter.com/share?url="+escape(this.getInviteUrl())+"&text=I love this new organization app!";this.showPopup(e,550,420),_.Z.sendEvent("Billing","ShareTwitter")}},{key:"shareFacebook",value:function(){var e="https://www.facebook.com/sharer/sharer.php?u="+escape(this.getInviteUrl());this.showPopup(e,600,303),_.Z.sendEvent("Billing","ShareFacebook")}},{key:"shareGoogle",value:function(){var e="https://plus.google.com/share?url="+this.getInviteUrl();this.showPopup(e,500,650),_.Z.sendEvent("Billing","ShareGoogle")}},{key:"showPopup",value:function(e,t,n){var r=t,i=n,a=window.screen.height,o=window.screen.width,s="scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+r+",height="+i+",left="+Math.round(o/2-r/2)+",top="+Math.round(a/2-i/2);window.open(e,null,s)}},{key:"onTapCodeSignup",value:function(){_o.menus.alert({text:"Redeeming code is not ready yet in the new backend. Please contact support.",callback:function(){_o.menus.openModal(w.Z.Modals.ReportBug)}})}},{key:"notifyTrialOver",value:function(){var e=this;_o.settings.onLoaded((function(){if(!_o.settings.notifiedTrialOver.get()){if(!_o.toasts)return void setTimeout(e.notifyTrialOver.bind(e),0);_o.toasts.pushMessage(w.Z.MessageID.TrialOver),_o.settings.notifiedTrialOver.set(!0)}}))}},{key:"notifyTrialEndSoon",value:function(){if(!_o.settings.notifiedTrialEndSoon.get()){if(!_o.toasts)return void setTimeout(this.notifyTrialEndSoon.bind(this),0);_o.toasts.pushMessage(w.Z.MessageID.TrialEndSoon),_o.settings.notifiedTrialEndSoon.set(!0)}}},{key:"isTrialOverRecently",value:function(){var e=this._trialStart?Math.round((Date.now()-this._trialStart.getTime())/Ze-this._trialDuration):0;return this._premiumStatus.get()===w.Z.PremiumStatus.TrialOver&&e<7}},{key:"isTrialOver",value:function(){return this._premiumStatus.get()===w.Z.PremiumStatus.TrialOver||(this._premiumStatus.get()===w.Z.PremiumStatus.CanceledUser||this._premiumStatus.get()===w.Z.PremiumStatus.CanceledPastDue)&&!this.canceledUserHasPremiumAccess()}},{key:"isPlanLegacy",value:function(){var e,t=this._planID,n=null===(e=this._appleIAP)||void 0===e?void 0:e.plan;return t===w.Z.PremiumPlans.Legacy.month||t===w.Z.PremiumPlans.Legacy.year||"monthly"===n||"yearly"===n}},{key:"_computeHasPremiumFeatures",value:function(){return this.hasPremium()||this._premiumStatus.get()===w.Z.PremiumStatus.Trial||this.canceledUserHasPremiumAccess()}},{key:"hasPremiumFeatures",value:function(){return this.hasPremiumFeaturesObservable.get()}},{key:"hasProFeatures",value:function(){return this.hasProFeaturesObservable.get()}},{key:"loadUserProperties",value:function(e){var t=_o.settings.userProperties.get();t=Object.assign({},t,e),_o.settings.userProperties.set(t),this.userProperties.set(t),this.updateBillingData()}},{key:"setJoinDate",value:function(e){this.userProperties.setProperty("joinDate",e),ye.Z.setUserProperties({joinDate:e})}},{key:"updateUserProfile",value:function(e){var t=this,n=_.Z.removeNullUndefined(e);this.userProperties.onHasValue((function(e){var r=Object.keys(n).filter((function(t){return n[t]&&!e[t]}));if(r.length>0){t.userProperties.set(Object.assign({},e,n));var i={};r.forEach((function(e){return i[e]=n[e]})),ye.Z.setUserProperties(i)}}))}}]),e}(),P()(me.prototype,"cancelSubscription",[S.ZP],Object.getOwnPropertyDescriptor(me.prototype,"cancelSubscription"),me.prototype),P()(me.prototype,"onTapUpdatePaymentMethod",[S.ZP],Object.getOwnPropertyDescriptor(me.prototype,"onTapUpdatePaymentMethod"),me.prototype),P()(me.prototype,"onTapViewInvoices",[S.ZP],Object.getOwnPropertyDescriptor(me.prototype,"onTapViewInvoices"),me.prototype),P()(me.prototype,"onTapDeleteAccount",[S.ZP],Object.getOwnPropertyDescriptor(me.prototype,"onTapDeleteAccount"),me.prototype),P()(me.prototype,"onTapCodeSignup",[S.ZP],Object.getOwnPropertyDescriptor(me.prototype,"onTapCodeSignup"),me.prototype),me);var be=n(6744);const Pe=function(){function e(t,n){s()(this,e),this._id=t,this._isOpen=!1,this._isReady=!1,this._isAllLoaded=!1,this._storageError=!1,this._loggingEnabled=!1,this._preloadConsumed=!1,this._usesDiskSpace||(this._usesDiskSpace=!1),this._onReadyFns=[],this._onMetadataReadyFns=[],this._cache={},this._useInMemoryStore=!n||!n.noInMemoryCache,this._useMetadataInMemoryStore=!n||!n.noMetadataInMemoryCache,this._metadataKeys=n&&n.metadataKeys?n.metadataKeys:[]}return l()(e,[{key:"getStats",value:function(){var e=this;return this.getFilterEntriesSync((function(){return!0})).map((function(t){return{id:e._id,count:t.length,size:JSON.stringify(t).length}}))}},{key:"getState",value:function(){return{isAllLoaded:this._isAllLoaded,storageError:this._storageError}}},{key:"enableLogging",value:function(){this._loggingEnabled=!0}},{key:"disableLogging",value:function(){this._loggingEnabled=!1}},{key:"isLoggingEnabled",value:function(){return this._loggingEnabled}},{key:"usesDiskSpace",value:function(){return this._usesDiskSpace}},{key:"_cacheInMemory",value:function(){return this._useInMemoryStore}},{key:"_cacheMetadataInMemory",value:function(){return this._useMetadataInMemoryStore}},{key:"_hasLoadedAll",value:function(){return this._isAllLoaded}},{key:"getStorageType",value:function(){try{_.Z.PAssert(918,!1,"SubClass must override")}catch(e){_.Z.reportError(e)}}},{key:"_setRawInMemoryCache",value:function(e){try{_.Z.PAssert(919,this._cacheInMemory(),"Must be running an in-memory cache")}catch(t){_.Z.reportError(t)}this._cache=e}},{key:"_getRawInMemoryCache",value:function(){return this._cacheInMemory()?this._cache:void 0}},{key:"count",value:function(e){e(this._cacheInMemory()?Object.keys(this._cache).length:void 0)}},{key:"size",value:function(e){e(this._cacheInMemory()?2*JSON.stringify(this._cache).length:void 0)}},{key:"loadAll",value:function(e){this._isAllLoaded=!0}},{key:"getEntrySync",value:function(e){return this._cacheInMemory()?this._cache[e]:void 0}},{key:"getBoundEntries",value:function(e,t,n,r){try{_.Z.PAssert(920,!r,"In memory query is sync")}catch(o){_.Z.reportError(o)}var i;if(this._cacheInMemory())for(var a in i=[],this._cache)this._cache[a][e]>=t&&this._cache[a][e]<=n&&i.push(this._cache[a]);return i}},{key:"getFilterEntriesSync",value:function(e){var t,n=this;return this._cacheInMemory()&&(t=[],Object.keys(this._cache).forEach((function(r){e&&!e(n._cache[r])||t.push(n._cache[r])}))),t}},{key:"removeEntrySync",value:function(e){delete this._cache[e]}},{key:"hasEntrySync",value:function(e){return!!this._cacheInMemory()&&this._cache.hasOwnProperty(e)}},{key:"saveEntrySync",value:function(e){try{_.Z.PAssert(921,e,"Must be saving data")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(922,e&&e.id,"Saved data must have id")}catch(t){_.Z.reportError(t)}this.isLoggingEnabled()&&_.Z.log("Cache Entry: ",e),this._cacheInMemory()&&e&&(this._cache[e.id]=e)}},{key:"clearCacheSync",value:function(){this._cache={}}},{key:"clearBackingStore",value:function(){try{_.Z.PAssert(923,!1,"SubClass must override")}catch(e){_.Z.reportError(e)}}},{key:"dumpData",value:function(e){console.log("-- Cache: ",this._id,"--"),console.log(this._cache)}},{key:"onCacheError",value:function(e){_.Z.reportError(e)}}]),e}();function Se(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}const De=function(e){p()(n,e);var t=Se(n);function n(e,r){var i;return s()(this,n),(i=t.call(this,e,r)).keyFieldsRN=r.keyFieldsRN,i}return l()(n,[{key:"getPreloadData",value:function(){return be.Z.getTableData(this._id)}},{key:"getMetadata",value:function(e){return be.Z.getValue(this._id+"_"+e)}},{key:"setMetadata",value:function(e,t){be.Z.setValue(this._id+"_"+e,t)}},{key:"removeMetadata",value:function(e){be.Z.deleteValue(this._id+"_"+e)}},{key:"clearMetadata",value:function(){var e=this;this._metadataKeys&&this._metadataKeys.forEach((function(t){return e.removeMetadata(t)}))}},{key:"hasEntry",value:function(){var e=a()(k().mark((function e(t){var n;return k().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.getEntry(t);case 2:return n=e.sent,e.abrupt("return",void 0!==n);case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getEntry",value:function(){var e=a()(k().mark((function e(t,n){var r;return k().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(this._useInMemoryStore&&(r=this.getEntrySync(t)),void 0===r&&(r=be.Z.getTableValue(this._id,t)),void 0!==r){e.next=6;break}return e.next=5,be.Z.tableGet(this._id,t);case 5:r=e.sent;case 6:return r&&n&&(r=_.Z.clone(r)),e.abrupt("return",r);case 8:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeEntry",value:function(){var e=a()(k().mark((function e(t){var r;return k().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return this._useInMemoryStore?d()(v()(n.prototype),"removeEntrySync",this).call(this,t):(r=be.Z.getTableData(this._id))&&delete r[t],e.abrupt("return",be.Z.tableDelete(this._id,t));case 2:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"saveEntry",value:function(){var e=a()(k().mark((function e(t,r){var i;return k().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:0,i=be.Z.getTableValue(this._id,t.id),(!i||(r?r(i,t):i!==t&&!_.Z.deepEqual(i,t,!0)))&&(this._useInMemoryStore&&d()(v()(n.prototype),"saveEntrySync",this).call(this,t),be.Z.setTableValue(this._id,t.id,t));case 4:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"clearCache",value:function(){var e=a()(k().mark((function e(){return k().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return this._useInMemoryStore&&d()(v()(n.prototype),"clearCacheSync",this).call(this),e.abrupt("return",be.Z.tableClear(this._id));case 2:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFilterEntries",value:function(){var e=a()(k().mark((function e(t){return k().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",be.Z.tableFilter(this._id,t));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"ensureTableLoaded",value:function(){var e=a()(k().mark((function e(t){return k().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",be.Z.ensureTableLoaded(this._id,t));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Pe);var Ie;function Ee(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}const xe=(Ie=function(e){p()(n,e);var t=Ee(n);function n(e,r){var i;if(s()(this,n),r){try{_.Z.PAssert(493,!r.noInMemoryCache,"Invalid in-memory cache option")}catch(o){_.Z.reportError(o)}try{_.Z.PAssert(494,!r.noMetadataInMemoryCache,"Invalid metadata in-memory cache option")}catch(o){_.Z.reportError(o)}r.noInMemoryCache=!1,r.noMetadataInMemoryCache=!1}if(i=t.call(this,e,r),r?(i.saveTime=isNaN(r.saveTime)?5e3:r.saveTime,r.writeOnUnload&&ue.Z.listen("onUnload",i.writeCache),r.clearBackingOnLoad&&(i.clearBackingOnLoad=!0,ue.Z.listen("enterForeground",i.clearBackingStore))):i.saveTime=5e3,i.storageKey="MDC_"+i._id,i._cache=be.Z.getValue(i.storageKey)||{},_.Z.isString(i._cache))try{var a=JSON.parse(i._cache);i._cache=a}catch(c){}return i._saveTimeout=void 0,i}return l()(n,[{key:"_onWrite",value:function(e){e||0===this.saveTime?(this._saveTimeout&&(clearTimeout(this._saveTimeout),this._saveTimeout=void 0),this.writeCache()):this.saveTime>=0&&(this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(this.writeCache,this.saveTime))}},{key:"writeCache",value:function(){if(_o.settings.activeUser.get()){var e=this._getRawInMemoryCache();try{be.Z.setValue(this.storageKey,e)}catch(t){_.Z.reportError(t)}}}},{key:"getStorageType",value:function(){return w.Z.StorageType.LocalStorage}},{key:"removeEntrySync",value:function(e){delete this._cache[e],this._onWrite()}},{key:"getEntrySync",value:function(e){return this._cache[e]}},{key:"saveEntrySync",value:function(e){var t=e.id,n=e.value;void 0===n||null===n?delete this._cache[t]:this._cache[t]=n,this._onWrite()}},{key:"clearCacheSync",value:function(){d()(v()(n.prototype),"clearCacheSync",this).call(this),this._onWrite(!0)}},{key:"clearBackingStore",value:function(){be.Z.deleteValue(this.storageKey)}}]),n}(Pe),P()(Ie.prototype,"writeCache",[S.ZP],Object.getOwnPropertyDescriptor(Ie.prototype,"writeCache"),Ie.prototype),P()(Ie.prototype,"clearBackingStore",[S.ZP],Object.getOwnPropertyDescriptor(Ie.prototype,"clearBackingStore"),Ie.prototype),Ie);const Ce=function(){function e(){s()(this,e),this._reportedQuotaError=!1,this._migrationRequired=!1,this._registeredCaches={},this._storageReady=[]}return l()(e,[{key:"init",value:function(){this._storageReady[w.Z.StorageType.InMemory]=!0,this._storageReady[w.Z.StorageType.LocalStorage]=!0}},{key:"getInfo",value:function(){return{reportedQuotaError:this._reportedQuotaError,migrationRequired:this._migrationRequired,numCaches:Object.keys(this._registeredCaches).length}}},{key:"registerLocalCache",value:function(e,t,n){try{_.Z.PAssert(313,e,"Must provide a valid cache ID")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(314,void 0===this._registeredCaches[e],"Must not have a previously registered cache with the same id")}catch(i){_.Z.reportError(i)}var r;switch(t){case w.Z.StorageType.InMemory:0;break;case w.Z.StorageType.LocalStorage:r=new xe(e,n);break;case w.Z.StorageType.IndexedDB:r=new De(e,n)}try{_.Z.PAssert(315,r,"Must have valid cache after creation")}catch(i){_.Z.reportError(i)}return this._registeredCaches[e]=r,r}},{key:"_notifyIDBReady",value:function(e){}},{key:"notifyMigrationRequired",value:function(){this._migrationRequired=!0}},{key:"needsMigration",value:function(){return this._migrationRequired||1!==_o.settings.localDataVersion.get()}},{key:"hasReportedQuotaError",value:function(){return this._reportedQuotaError}},{key:"reportQuotaExceeded",value:function(){this._reportedQuotaError||(this._reportedQuotaError=!0,_.Z.reportError(new Error("Quota exceeded!")))}}]),e}();var Ae=n(9514);const Le=function(){function e(){s()(this,e)}return l()(e,[{key:"init",value:function(){this.isEnabled=!_.Z.isDemoMode(),this.isEnabled&&(this.storage=Ae.Z.storage())}},{key:"getCloudBackupFilename",value:function(e,t){return"users/".concat(re.Z.getUid(),"/documents/").concat(e,"/").concat(t,".json")}},{key:"listDocBackups",value:function(){var e=a()(k().mark((function e(t){var n,r;return k().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.storage.ref("users/".concat(re.Z.getUid(),"/documents/").concat(t)).listAll();case 2:return n=e.sent,r=n.items.map((function(e){return+e.name.replace(".json","")})).sort((function(e,t){return t-e})),e.abrupt("return",r);case 5:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"uploadString",value:function(){var e=a()(k().mark((function e(t,n){var r=this;return k().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.isEnabled){e.next=2;break}return e.abrupt("return",new Promise((function(e,i){var a=r.storage.ref(t).putString(n);a.on("state_changed",(function(e){}),(function(e){i(e)}),(function(){a.snapshot.ref.getDownloadURL().then((function(t){return e(t)}))}))})));case 2:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getString",value:function(){var e=a()(k().mark((function e(t){var n,r;return k().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.isEnabled){e.next=15;break}return e.next=3,this.storage.ref(t).getDownloadURL();case 3:if(!(n=e.sent)){e.next=15;break}return e.prev=5,e.next=8,fetch(n);case 8:return r=e.sent,e.abrupt("return",r.text());case 12:e.prev=12,e.t0=e.catch(5),_.Z.reportError(e.t0);case 15:case"end":return e.stop()}}}),e,this,[[5,12]])})));return function(t){return e.apply(this,arguments)}}()}]),e}();var Me;const Te=(Me=function(){function e(t,n,r,i,a,o,c,l,u){s()(this,e),this._id=t,this._remoteID=a,this._type=n;try{_.Z.PAssert(484,_.Z.isDateValid(r),"Must specify a valid schedule date for deferred task")}catch(d){_.Z.reportError(d)}this._scheduleDate=r,this._timeout=void 0,this._data=o,this._cbRun=c,this._cbCancel=l,this._cbPersistRemote=u,this._hasRun=!1,this._isCanceled=i,this._destroyed=!1}return l()(e,[{key:"schedule",value:function(){var e=this;try{_.Z.PAssert(485,!this._timeout,"Should not schedule the same task multiple times")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(486,!this._hasRun,"Should not schedule a task once it has already run once")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(487,!this._isCanceled,"Should not schedule canceled tasks")}catch(n){_.Z.reportError(n)}var t=Math.max(0,this._scheduleDate.getTime()-Date.now());this._timeout=setTimeout(this.runTask,t),!this._remoteID&&t>0&&ie.Z.onLoaded((function(){try{e._cbPersistRemote(e,e._onPersistedRemote)}catch(t){_.Z.reportError(t)}}))}},{key:"_onCanceled",value:function(e){e&&(this._destroyed=!0,_o.deferredTaskManager._notifyTaskComplete(this._id))}},{key:"_onPersistedRemote",value:function(e,t){e&&(this._remoteID=t,_o.deferredTaskManager._updateTask(this._id))}},{key:"reschedule",value:function(e){try{_.Z.PAssert(488,!this._hasRun,"Should never reschedule a task that has already run")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(489,!this._isCanceled,"Should not reschedule canceled tasks")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(490,this._timeout,"Must always have already schedule a task that is being rescheduled")}catch(t){_.Z.reportError(t)}clearTimeout(this._timeout),this._timeout=void 0,this._scheduleDate=e,this.schedule()}},{key:"cancel",value:function(){var e=this;try{_.Z.PAssert(491,this._timeout||this._remoteID,"Must always have already scheduled (locally or remotely) a task that is being canceled")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(492,!this._hasRun,"Should not cancel tasks that have already been run")}catch(t){_.Z.reportError(t)}this._isCanceled=!0,clearTimeout(this._timeout),this._timeout=void 0,this._remoteID&&ie.Z.onLoaded((function(){try{e._cbCancel(e,e._onCanceled)}catch(t){_.Z.reportError(t)}})),_o.deferredTaskManager._updateTask(this._id)}},{key:"runTask",value:function(){this._timeout=void 0,this._hasRun=!0;try{this._cbRun(this)}catch(e){_.Z.reportError(e)}_o.deferredTaskManager._notifyTaskComplete(this._id)}},{key:"getData",value:function(){return this._data}},{key:"getType",value:function(){return this._type}},{key:"getScheduleDate",value:function(){return this._scheduleDate}},{key:"getSaveData",value:function(){return{id:this._id,remoteID:this._remoteID,type:this._type,scheduleDate:this._scheduleDate,data:this._data,isCanceled:this._isCanceled}}},{key:"isPersistedRemote",value:function(){return!!this._remoteID}}]),e}(),P()(Me.prototype,"_onCanceled",[S.ZP],Object.getOwnPropertyDescriptor(Me.prototype,"_onCanceled"),Me.prototype),P()(Me.prototype,"_onPersistedRemote",[S.ZP],Object.getOwnPropertyDescriptor(Me.prototype,"_onPersistedRemote"),Me.prototype),P()(Me.prototype,"runTask",[S.ZP],Object.getOwnPropertyDescriptor(Me.prototype,"runTask"),Me.prototype),Me);const Re=function(){function e(){s()(this,e),this._registeredTypes={},this._deferredTasks={},this._stats={}}return l()(e,[{key:"init",value:function(){var e=0;this._taskCache=_o.cacheManager.registerLocalCache("DeferredTasks",w.Z.StorageType.LocalStorage);for(var t=this._taskCache.getFilterEntriesSync(),n=0;n<t.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t[n];this.scheduleTask(r.id,r.type,new Date(r.scheduleDate),r.isCanceled,r.remoteID,r.data,!0)}}},{key:"getLastSyncDate",value:function(){var e=_o.settings.lastTaskSync.get();try{_.Z.PAssert(301,!e||_.Z.isString(e),"Must have a valid string sync date")}catch(t){_.Z.reportError(t)}return e}},{key:"getStats",value:function(){return{}}},{key:"registerTaskType",value:function(e,t,n,r){try{_.Z.PAssert(302,!this._registeredTypes[e],"Must not double register task type")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(303,_.Z.isFunction(t),"Must register a valid run callback")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(304,_.Z.isFunction(n),"Must register a valid cancel callback")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(305,_.Z.isFunction(r),"Must register a valid persist callback")}catch(i){_.Z.reportError(i)}this._registeredTypes[e]={cbRun:t,cbCancel:n,cbPersistRemote:r}}},{key:"_notifyTaskComplete",value:function(e){this._removeTask(e)}},{key:"scheduleTask",value:function(e,t,n,r,i,a,o){try{_.Z.PAssert(306,e,"Must supply a valid task ID")}catch(u){_.Z.reportError(u)}try{_.Z.PAssert(307,t,"Must supply a valid task type")}catch(u){_.Z.reportError(u)}try{_.Z.PAssert(308,_.Z.isDateValid(n),"Must always have a valid scheduled date available")}catch(u){_.Z.reportError(u)}try{_.Z.PAssert(309,this._registeredTypes[t],"Must request a valid registered task type")}catch(u){_.Z.reportError(u)}if(this._deferredTasks[e]){var s=this._deferredTasks[e];try{_.Z.PAssert(310,s.getType()===t,"Task types must match")}catch(u){_.Z.reportError(u)}try{_.Z.PAssert(311,s.getScheduleDate().equals(n),"Task schedule dates must match")}catch(u){_.Z.reportError(u)}}else{var c=this._registeredTypes[t];if(c){var l=new Te(e,t,n,r,i,a,c.cbRun,c.cbCancel,c.cbPersistRemote);if(this._deferredTasks[e]){_.Z.log("Overriding existing task");try{_.Z.PAssert(312,this._deferredTasks[e].type===t,"Should only update deferred tasks of the same type")}catch(u){_.Z.reportError(u)}}this._addTask(e,l,o),r?l.cancel():l.schedule()}}}},{key:"cancelTask",value:function(e,t){this._deferredTasks[e].cancel()}},{key:"_updateTask",value:function(e){var t=this._deferredTasks[e];this._taskCache.saveEntrySync(t.getSaveData())}},{key:"_addTask",value:function(e,t,n){this._deferredTasks[e]=t,n||this._updateTask(e)}},{key:"_removeTask",value:function(e){this._deferredTasks[e]=void 0,this._taskCache.removeEntrySync(e)}}]),e}();const Oe=function(){function e(){s()(this,e),this.items=new ae.Z}return l()(e,[{key:"addItemEntry",value:function(e,t){var n;this.hasItemEntry(e)||this.items.push({item:e,pane:t}),null===(n=e.onAddToDropBucket)||void 0===n||n.call(e)}},{key:"removeItemEntry",value:function(e){var t=this.items.findIndex((function(t){return t.item.id===e}));if(t>=0)return this.items.splice(t,1)[0]}},{key:"hasItemEntry",value:function(e){return!!this.getItemEntry(e)}},{key:"getItemEntry",value:function(e){var t=this.items.findIndex((function(t){return t.item.id===e.id}));return this.items.get()[t]}},{key:"getItems",value:function(){return this.items}},{key:"hasItems",value:function(){return this.items.get().length>0}}]),e}();var Fe,Ne=n(9401),Be=n(3761),Ue=n(7994),je=(Fe=function(){function e(){s()(this,e),this.openOnPane=void 0,this.messageIDs=new ae.Z,this.messagesLoaded=new x.Z(!1),this.isLoading=new x.Z(!1),this.errorMessage=new x.Z(""),this.threadAttachObs=new x.Z,this.threadAttach=void 0,this.threadAttachLoading=void 0,this.threadItem=void 0,this.numLoaded=0,this._cachedCSS=void 0,ve.Z.binder(this,"onAttachmentUpdate","reset","_onWindowResizeTimeout")}return l()(e,[{key:"init",value:function(){var e=this;_o.DisplaySettings.listen("themeChanged",this.onDisplaySettingsChanged.bind(this)),window.addEventListener("message",(function(t){if(_.Z.getLocationOrigin()===t.origin&&t.data&&t.data.startsWith&&t.data.startsWith("-")){var n=t.data.indexOf("-",1),r=t.data.indexOf("-",n+1);r<0&&(r=void 0);var i=t.data.substring(1,n),a=t.data.substring(n+1,r),o=r?t.data.substring(r+1):void 0;_.Z.batchRenderUpdates((function(){e.handleFrameMessage(a,i,o,t)}))}})),ue.Z.listen("selectedIndexChanged",this.onSelectedIndexChanged.bind(this)),D.Z.windowSize.listen(this._onWindowResize)}},{key:"reset",value:function(e,t){if(this.threadAttach){for(var n=0,r=this.threadAttach.getField("messages"),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r[i].initializedForDisplay&&this._destroyMessageDisplay(r[i])}this.threadAttach.unsubscribe(this)}this.numLoaded=0,this.threadAttach=void 0,this.threadItem=void 0,this.emailElement=void 0,this.errorMessage.set("",!1),this.isLoading.set(t,!1),this.messagesLoaded.set(!1,!1),this.messageIDs.get().length>0&&this.messageIDs.set([],e)}},{key:"_onWindowResizeTimeout",value:function(){if(this.threadAttach)for(var e=0,t=this.threadAttach.getField("messages"),n=0;n<t.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.updateMessageHeight(t[n].id,!0)}}},{key:"_onWindowResize",value:function(){_.Z.timeoutOnce("email resize",this._onWindowResizeTimeout,0)}},{key:"getPlugin",value:function(){return this.threadAttach?this.threadAttach.getPlugin():_o.pluginManager.getPluginGmail()}},{key:"_sendReply",value:function(e,t,n){try{_.Z.PAssert(316,e,"Must supply a valid target")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(317,t,"Must supply a valid action")}catch(i){_.Z.reportError(i)}try{var r="-"+t+(void 0!==n?"-"+n:"");e.postMessage(r,"*")}catch(a){_.Z.reportError(a)}}},{key:"handleFrameMessage",value:function(e,t,n,r){var i=this;switch(t){case"resize":try{var o=JSON.parse(n);this.updateMessageHeight(e,!0===o.canBeShorter,o.scale)}catch(f){_.Z.reportError(f)}break;case"click":ue.Z.fireEvent("tapMain",[]);break;case"keypress":try{var s=JSON.parse(n);D.Z.normalizeKeys(s),B.Z.fireKeyEvent(document.documentElement,s)}catch(f){_.Z.reportError(f)}break;case"href":if(n.startsWith("mailto:")){var c=this.parseMailtoURL(n.replace(/^mailto:/gi,"")),l={to:[{email:c.to}],subject:c.subject&&unescape(c.subject),body:c.body&&unescape(c.body).replace(/\r?\n/g,"<br>")};_o.menus.openComposeEmail(this.getPlugin(),{initData:l})}else _o.openUrl(n);break;case"epLoaded":this.onMessageLoaded(e);break;case"reloadMessage":this.threadAttach&&this._requestMessageReload(e,this.threadAttach,e);break;case"reqResource":try{try{_.Z.PAssert(318,r,"Must provide a valid request event")}catch(g){_.Z.reportError(g)}if(this.threadAttach)for(var u=0,d=JSON.parse(n),h=function(t){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var n=d[t],o=!1;n.startsWith("attach:")&&(n=n.replace(/^attach:/gi,""),o=!0),i.getPlugin().loadResource(i.threadAttach.id,e,n,function(){var e=a()(k().mark((function e(t,n){var a,s,c,l;return k().wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(!t){e.next=10;break}if(!o){e.next=8;break}return e.next=4,i._createMessageHTML(i.getPlugin()._decodeEmail(t.data,void 0,{}),{},"text/html");case 4:c=e.sent,s=c.parsed,e.next=9;break;case 8:s=t.data;case 9:a={cid:n,data:s,mimeType:t.mimeType};case 10:try{r&&r.source&&a&&(l=o?"contentLoad":"resLoad",i._sendReply(r.source,l,a?JSON.stringify(a):void 0))}catch(d){_.Z.reportError(d)}case 11:case"end":return e.stop()}}}),e)})));return function(t,n){return e.apply(this,arguments)}}())},p=0;p<d.length;++p)h(p)}catch(f){_.Z.reportError(f)}break;default:_.Z.log("Unknown message from child frame: ",e,t,n,r)}}},{key:"isOpen",value:function(){return this.openOnPane&&this.openOnPane.isExpanded.get()}},{key:"isOpenOnPane",value:function(e){return this.openOnPane===e&&this.openOnPane.isExpanded.get()}},{key:"isOpenOnThread",value:function(e){return this.isOpen()&&this.threadAttach===e}},{key:"close",value:function(){this.isOpen()&&(this.wantsPaneTransition=!0,this.setOpenPane(null),this.reset(),this.wantsPaneTransition=!1,ue.Z.fireEvent("EmailPreview","onClosed",[]))}},{key:"setOpenPane",value:function(e,t){this.openOnPane&&this.openOnPane!==e&&this.openOnPane.setExpanded(!1,t),this.openOnPane=e,e&&e.setExpanded(!0,t)}},{key:"_openPane",value:function(e,t){var n=this;try{_.Z.PAssert(319,t,"Must supply a valid cb to openPane")}catch(r){_.Z.reportError(r)}e!==this.openOnPane?(this.wantsPaneTransition=!0,setTimeout((function(){n.wantsPaneTransition=!1,t()}),w.Z.EmailOpenTime+100)):t(),this.setOpenPane(e)}},{key:"getPane",value:function(){try{_.Z.PAssert(320,this.openOnPane,"Should not be trying to get pane if email preview is not open")}catch(e){_.Z.reportError(e)}return this.openOnPane}},{key:"startOpenOnLoad",value:function(e){this.setOpenPane(e,!1)}},{key:"open",value:function(e,t,n,r){t.getPlugin();var i=!1;if(D.Z.app&&I.LA.featureVersion>=1){var a=null===t||void 0===t?void 0:t.getField("accountID"),o=null===t||void 0===t?void 0:t.getField("service"),s=null===t||void 0===t?void 0:t.id,c=Ue.Z.getPluginNew("Email").getAccount(a,o);_o.settings.emailViewAccounts.find((function(e){return e.e===a&&e.s===o}))&&(i=!0,I.LA.openEmail(a,s,o,null===c||void 0===c?void 0:c.b))}if(!i){var l=_o.pluginManager.getPluginGmail().getURLForAttachment(t);_o.openUrl(l)}}},{key:"_getReplyToFromMessage",value:function(e){return this._selfSentMessage(e)?e.to:e.replyTo?[e.replyTo]:[e.from]}},{key:"_getSenderFromMessage",value:function(e){var t=this.threadAttachLoading||this.threadAttach;return this._findSelf(t.getField("accountID"),e)}},{key:"_selfSentMessage",value:function(e){return this.getPlugin().isMyAccountID(e.from.email)}},{key:"_removeSelf",value:function(e){if(e){for(var t=0,n=e.slice(0),r=this.getPlugin(),i=0;i<n.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r.isMyAccountID(n[i].email)&&(n.splice(i,1),i--)}return n}}},{key:"_findSelf",value:function(e,t){var n,r=this.getPlugin(),i=r.getSendingAccounts(e);if(i.indexOf(t.from.email)>=0)n=t.from.email;else{if(t.to)for(var a=0,o=0;o<t.to.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(i.indexOf(t.to[o].email)>=0){n=t.to[o].email;break}}if(!n&&t.cc)for(var s=0,c=0;c<t.cc.length;++c){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(i.indexOf(t.cc[c].email)>=0){n=t.cc[c].email;break}}if(!n&&t.bcc)for(var l=0,u=0;u<t.bcc.length;++u){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(i.indexOf(t.bcc[u].email)>=0){n=t.bcc[u].email;break}}}return n||(n=r.getDefaultSendingAccount(e)),{text:r.getDisplayName(n),email:n}}},{key:"_updateDraftFromMessage",value:function(e,t,n){var r,i,a,o,s=this.getPlugin(),c=e.subject,l=this._getSenderFromMessage(e);try{_.Z.PAssert(321,n!==w.Z.EmailResponseMode.Compose,"Should never pass Compose mode to _updateDraftFromMessage")}catch(d){_.Z.reportError(d)}n===w.Z.EmailResponseMode.Reply?r=this._getReplyToFromMessage(e):n===w.Z.EmailResponseMode.ReplyAll?(r=this._removeSelf(this._getReplyToFromMessage(e).concat(e.to)),i=this._removeSelf(e.cc)):n===w.Z.EmailResponseMode.Forward&&(o=Object.assign({},e.resources)),n&&(a=s.createMessageBody(e,t.from.email,n)),r=_.Z.arrayUniques(r||[],"email"),i=_.Z.arrayUniques(i||[],"email"),n===w.Z.EmailResponseMode.Reply||n===w.Z.EmailResponseMode.ReplyAll?(0!==c.toLowerCase().indexOf("re")&&(c="Re: "+c),o=t.resources):n===w.Z.EmailResponseMode.Forward&&0!==c.toLowerCase().indexOf("fwd")&&(c="Fwd: "+c);var u={id:t.id,to:r,from:l,cc:i,bcc:void 0,subject:c,decoded:a,resources:o||{}};this.getPlugin().updateDraft(this.threadAttach,t.id,t.draftID,u,!0,!1,(function(e){try{_.Z.PAssert(322,e,"Should always be able to update a draft")}catch(d){_.Z.reportError(d)}}))}},{key:"requestAttachment",value:function(e,t,n,r){this.getPlugin().loadResource(e,t,n,r)}},{key:"getAttachmentURL",value:function(e,t,n){return this.getPlugin().getAttachmentURL(e,t,n)}},{key:"getPreviewURL",value:function(e){return this.getPlugin().getPreviewURL(e)}},{key:"reportMessage",value:function(e,t,n,r,i){this.getPlugin().reportMessage(e,t,n,r,i)}},{key:"dumpMessage",value:function(e,t,n){try{_.Z.PAssert(323,!1,"Should not be dumping message in non-__DEV__ modes")}catch(r){_.Z.reportError(r)}this.getPlugin().dumpMessage(e,t,n)}},{key:"parseMailtoURL",value:function(e){var t={to:void 0,subject:void 0,body:void 0},n=e.split("?");if(t.to=n[0],n[1])for(var r=0,i=n[1].split("&"),a=0;a<i.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=i[a].split("=");switch(o[0].toUpperCase()){case"SUBJECT":t.subject=o[1];break;case"BODY":t.body=o[1]}}return t}},{key:"parseListUnsubscribe",value:function(e){for(var t=0,n={emailData:void 0,url:void 0},r=e.split(","),i=0;i<r.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=/^<?(http|https|mailto):([^<>]*)>?/gi.exec(r[i]);if(a)switch(a[1]){case"http":case"https":n.url=a[1]+":"+a[2];break;case"mailto":n.emailData=this.parseMailtoURL(a[2]);break;default:try{_.Z.PAssert(324,!1,"Unknown List Unsubscribe Format: "+e)}catch(o){_.Z.reportError(o)}}}return n}},{key:"setMessageResponseMode",value:function(e,t){var n=this.getMessages(),r=n[n.indexOfWithProperty("id",e)];try{_.Z.PAssert(325,r,"Must be able to find a valid reply message to update response mode for")}catch(o){_.Z.reportError(o)}if(r){var i,a=this.getPlugin();if(t!==w.Z.EmailResponseMode.None){try{_.Z.PAssert(326,r.initializedForDisplay,"Must be initialized for display to set response mode")}catch(o){_.Z.reportError(o)}i=a.getDraftForMessage(this.threadAttach.getField("accountID"),this.threadAttach.id,e,this._getSenderFromMessage(r)),this._updateDraftFromMessage(r,i,t)}r.responseMode&&r.responseMode.set(t)}}},{key:"setLastMessageResponseMode",value:function(e){if(e){var t=this.getMessages(),n=t[t.length-1];try{_.Z.PAssert(327,n,"Setting message response mode when there are no messages")}catch(r){_.Z.reportError(r)}n&&this.setMessageResponseMode(n.id,e)}}},{key:"_createErrorHTML",value:function(){var e=a()(k().mark((function e(){return k().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Ne.Z.update('<html><body>There was an error loading your mail message.<br><br><a href="moodoAction:reloadMessage">Retry</a></body></html>',{},{},"text/html"));case 1:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_createMessageHTML",value:function(){var e=a()(k().mark((function e(t,n,r,i){var a,o;return k().wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:if(a={collapseQuotes:!0,replaceLinks:!0,createLinksFromText:!0},i)for(o in i)i.hasOwnProperty(o)&&(a[o]=i[o]);return e.abrupt("return",Ne.Z.update(t,n,a,r));case 3:case"end":return e.stop()}}}),e)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_generateCSS",value:function(){if(!this._cachedCSS){var e={html:{"transform-origin":"0 0"},body:{"overflow-x":"auto","overflow-y":"hidden","font-family":"'Helvetica Neue', Helvetica, Arial, Sans-serif","font-size":"14px","text-rendering":"optimizeLegibility","-moz-font-smoothing":"antialiased","-webkit-font-smoothing":"antialiased","font-smoothing":"antialiased",margin:0},"#moodoAttach":{display:"none"},'[moodoAttach="true"]':{display:"none"},'[quote="collapsed"]':{display:"none"},'[place="true"]':{cursor:"pointer",display:"inline-block",height:"12px",width:"26px","text-align":"center","margin-top":"8px","margin-bottom":"8px",color:"#aaa",border:"1px solid #ddd","background-color":"#f6f6f6","border-radius":"3px"},'[place="true"]:before':{content:'"..."',"line-height":"5px","font-size":"16px","vertical-align":"text-top"}};_o.DisplaySettings.isDark()&&(e.body["-webkit-filter"]="invert(100%) hue-rotate(180deg)",e.img={"-webkit-filter":"invert(100%) hue-rotate(180deg)"});var t="";Object.keys(e).forEach((function(n){t+=n+"{",Object.keys(e[n]).forEach((function(r){var i=e[n][r];t+=r+":"+i+";"})),t+="}"})),this._cachedCSS="<style>"+t+"</style>"}return this._cachedCSS}},{key:"_createFrameBlob",value:function(e,t,n){var r={isApp:D.Z.app},i=this._generateCSS(),a="<script>("+He+')("'+n+'",'+JSON.stringify(r)+");<\/script>",o="<!DOCTYPE html>";return t='<meta http-equiv="Content-Type" content="'+t+'">',D.Z.supportBlobURLIFrame?new Blob([o,"<html>","<head>",t,i,a,"</head>",e,"</html>"],{type:"text/html"}):[o,"<html>","<head>",t,i,a,"</head>",e,"</html>"].join("")}},{key:"onMessageLoaded",value:function(e){this.updateMessageHeight(e),this.messagesLoaded.set(!0)}},{key:"getPreviewIFrame",value:function(e){return document.getElementById("emailPreview_"+e)}},{key:"updateMessageHeight",value:function(e,t,n){var r=this.getPreviewIFrame(e);if(r){var i=this.getMessages(),a=i[i.indexOfWithProperty("id",e)];t&&(r.style.height="0px");try{var o=r.contentDocument.documentElement;if(o){var s=n||a.defaultScale.get(),c=Math.ceil(o.scrollWidth*s),l=Math.ceil(o.scrollHeight*s);t&&l===a.height.get()&&(r.style.height=l+"px"),a.width.set(c),a.height.set(l),n&&a.defaultScale.get()!==n&&a.defaultScale.set(n)}}catch(u){_.Z.reportError(u)}}}},{key:"_generateAltParts",value:function(e,t){var n=this.getPlugin().getMessageAttachments(t);if(n)for(var r=0,i=0;i<n.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=n[i];"application/ics"===a.mimeType&&this.getPlugin().loadResource(e.id,t.id,a.cid,(function(e){if(e){var t=Be.Z.parseICS(_.Z.b64_to_utf8(e.data));_.Z.log("Parsed ICS Data: ",t)}}))}}},{key:"_computeResponseMode",value:function(e){var t=w.Z.EmailResponseMode.None;return e&&e.labelIds.indexOf("DRAFT")>=0&&(t=e.subject.startsWith("Fwd:")?w.Z.EmailResponseMode.Forward:e.subject.startsWith("Re:")?1===e.to.length?w.Z.EmailResponseMode.Reply:w.Z.EmailResponseMode.ReplyAll:w.Z.EmailResponseMode.Compose),t}},{key:"_createMessageDisplay",value:function(){var e=a()(k().mark((function e(t,n,r,i){var a,o;return k().wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:try{_.Z.PAssert(328,!n.initializedForDisplay,"Should only initialize message for display once")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(329,n.to,"Must have a valid to object")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(330,n.from,"Mus have a valid from object")}catch(c){_.Z.reportError(c)}if(a=!0,!n.decoded){e.next=12;break}return n.isErrorMessage=!1,e.next=8,this._createMessageHTML(n.decoded,n.resources,n.mimeType,i);case 8:(o=e.sent).missingResourceData&&(a=!1),e.next=17;break;case 12:return _.Z.reportError(new Error("Missing message decoded data"),"Missing message decoded data: "+_.Z.isString(n.decoded)),n.isErrorMessage=!0,e.next=16,this._createErrorHTML();case 16:o=e.sent;case 17:0;try{_.Z.PAssert(331,o.parsed,"Must have valid parsed data")}catch(c){_.Z.reportError(c)}return n.blob=this._createFrameBlob(o.parsed,n.contentType,n.id),_.Z.isString(n.blob)||(n.blobURL&&(D.Z.URL.revokeObjectURL(n.blobURL),n.blobURL=void 0),n.blobURL=D.Z.URL.createObjectURL(n.blob)),n.specialLinks=o.specialLinks,n.width||(n.width=new x.Z(0)),n.height||(n.height=new x.Z(0)),n.defaultScale||(n.defaultScale=new x.Z(1)),n.responseMode||(n.responseMode=new x.Z(this._computeResponseMode(r))),n.initializedForDisplay=!0,a||this.getPlugin().reportMessage(t.getField("accountID"),t.id,n.id,"Error creating display",!1),e.abrupt("return",n);case 29:case"end":return e.stop()}}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"_destroyMessageDisplay",value:function(e){try{_.Z.PAssert(332,e.initializedForDisplay,"Message must first be initialized before being destroyed")}catch(t){_.Z.reportError(t)}e.initializedForDisplay=!1,e.isErrorMessage=!1,e.width=void 0,e.height=void 0,e.defaultScale=void 0,e.responseMode&&(e.responseMode=void 0),e.specialLinks=void 0,e.blob=void 0,e.blobURL&&(D.Z.URL.revokeObjectURL(e.blobURL),e.blobURL=void 0)}},{key:"ensureDisplayMessages",value:function(){var e=a()(k().mark((function e(t){var n,r=this;return k().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(t!==this.threadAttach){e.next=11;break}return e.prev=1,n=this.getMessages(),e.next=5,Promise.all(n.map((function(e,i){if(!t.getPlugin().isMessageDraft(e)&&!e.initializedForDisplay){try{r._generateAltParts(t,e)}catch(a){_.Z.reportError(a)}return r._createMessageDisplay(t,e,n[i+1],0===i?{collapseQuotes:!1}:void 0)}})));case 5:n.equals(this.messageIDs.get())||this.messageIDs.set(n.map((function(e){return e.id}))),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),_.Z.reportError(e.t0);case 11:case"end":return e.stop()}}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getMessages",value:function(){return this.threadAttach&&this.threadAttach.getField("messages")||[]}},{key:"_requestMessageReload",value:function(){var e=a()(k().mark((function e(t,n,r){var i=this;return k().wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:n.getPlugin().forceReloadMessage(n,r,function(){var e=a()(k().mark((function e(a){var o,s,c,l,u;return k().wrap((function(e){for(var d=0,h=0;;){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(e.prev=e.next){case 0:try{_.Z.PAssert(333,a,"Must be able to re-load message data")}catch(p){_.Z.reportError(p)}if(n!==i.threadAttach){e.next=12;break}if(o=n.getField("messages"),s=o.indexOfWithProperty("id",r),!(c=o[s])){e.next=12;break}if(!(l=i.getPreviewIFrame(t))){e.next=12;break}return c.initializedForDisplay=!1,e.next=11,i.ensureDisplayMessages(n);case 11:D.Z.supportBlobURLIFrame?l.src=c.blobURL:((u=l.contentWindow.document).documentElement.innerHTML="",u.open(),u.write(c.blob),u.close());case 12:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onAttachmentUpdate",value:function(e,t,n){var r=this;(!t||t.indexOf("messages")>=0)&&setTimeout((function(){e.getPlugin().loadThread(e,(function(t,n){try{_.Z.PAssert(334,t,"Must be able to re-load thread data")}catch(i){_.Z.reportError(i)}n&&e===r.threadAttach&&r.ensureDisplayMessages(e)}))}),0)}},{key:"getThreadAttach",value:function(){return this.threadAttach}},{key:"_setThread",value:function(){var e=a()(k().mark((function e(t,n){var r;return k().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:try{_.Z.PAssert(335,t.hasField("messages"),"Must supply valid messages to the email preview")}catch(a){_.Z.reportError(a)}try{_.Z.PAssert(336,t.getPlugin().shouldUseNewEmailPlugin(t)||this.errorMessage.get()||t.getField("dataLoaded"),"Must have loaded remote data or have an error")}catch(a){_.Z.reportError(a)}if(this.threadAttach&&this.threadAttach.id===t.id){e.next=12;break}return this.reset(),this.threadAttach=t,this.threadItem=n,t.subscribe(this),e.next=9,this.ensureDisplayMessages(t);case 9:(r=t.getPlugin()).attachmentHasLabelByID(t,"UNREAD")&&r.performAction(w.Z.PluginAction.Gmail.MarkRead,!0,t),ue.Z.fireEvent("EmailPreview","openThreadChanged",[]);case 12:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onSelectedIndexChanged",value:function(e,t,n){this.isOpen()&&t===this.openOnPane&&(n&&n.hasAttachmentType(w.Z.PluginType.Email)?n.getAttachmentByType(w.Z.PluginType.Email).getPlugin()===this.getPlugin()&&this.getPlugin().openEmailByItem(n,t):"PaneGmail"===t.type&&this.reset())}},{key:"onDisplaySettingsChanged",value:function(){this._cachedCSS=void 0,this.threadAttach&&this.ensureDisplayMessages(this.threadAttach)}}]),e}(),P()(Fe.prototype,"_onWindowResize",[S.ZP],Object.getOwnPropertyDescriptor(Fe.prototype,"_onWindowResize"),Fe.prototype),Fe);var He=function(e,t){!function(){function n(e){console.log("ERROR: ",e)}var r,i=window.InjectedJS={postMessage:function(t,r){try{var i;if(void 0!==r)if("string"===typeof r)i=r;else try{i=JSON.stringify(r)}catch(a){n(a),i=""}else i="";window.parent.postMessage("-"+t+"-"+e+"-"+i,"*")}catch(a){n(a)}}};r=function(e){var n=1;t.isAndroid&&(n=function(e){var t=document.documentElement.clientWidth/e;return Math.max(t,.25)}(document.documentElement.scrollWidth))<1&&(document.documentElement.style.transform="scale("+n+")"),i.postMessage("resize",{canBeShorter:e,scale:n})};var a=!1;function o(){document.removeEventListener("DOMContentLoaded",o,!1),a?r():(a=!0,function(){var e=0,t=0,n=0;document.documentElement.addEventListener("click",(function(e){i.postMessage("click")})),document.addEventListener("keydown",(function(e){var t={type:e.type,keyCode:e.keyCode,charCode:e.charCode,which:e.which,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey};i.postMessage("keypress",t)}),!0);for(var a=function(e){e.stopImmediatePropagation(),e.preventDefault();var t=this.getAttribute("href");return t.startsWith("attach:")?i.postMessage("reqResource",[t]):t.startsWith("moodoAction:")?i.postMessage(t.replace(/^moodoAction:/gi,"")):i.postMessage("href",t),!1},o=document.querySelectorAll("[mlink]"),s=0;s<o.length;++s){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;o[s].addEventListener("click",a)}for(var c=document.querySelectorAll("[place]"),l=0;l<c.length;++l){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;c[l].addEventListener("click",(function(e){for(var t=0,n=this.id,i=this.nextElementSibling,a=!1;i&&i.getAttribute("group")===n;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o="collapsed"===i.getAttribute("quote")?"uncollapsed":"collapsed";"collapsed"===o&&(a=!0),i.setAttribute("quote",o),i=i.nextElementSibling}return setTimeout((function(){r(a)}),0),e.stopImmediatePropagation(),e.preventDefault(),!1}))}for(var u=[],d=document.querySelectorAll("img"),h=0;h<d.length;++h){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var p=d[h].getAttribute("cid");p&&u.push(p),d[h].addEventListener("load",(function(){r()}))}u.length>0&&i.postMessage("reqResource",u)}(),i.postMessage("epLoaded"))}window.addEventListener("message",(function(e){if(e.data&&e.data.startsWith&&e.data.startsWith("-")){var t=e.data.indexOf("-",1),i=e.data.substring(1,t),a=e.data.substring(t+1);switch(i){case"resLoad":try{if(a)for(var o=0,s=JSON.parse(a),c=document.querySelectorAll('[cid="'+s.cid+'"]'),l="data:"+s.mimeType+";base64,"+s.data,u=0;u<c.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;c[u].src=l}}catch(h){n(h)}break;case"contentLoad":try{if(a){var d=JSON.parse(a);document.open(),document.write(d.data),document.close(),setTimeout(r,0)}}catch(h){n(h)}break;default:n(new Error("Unknown PreviewFrame message: "+i))}}})),"complete"===document.readyState||"interactive"===document.readyState?setTimeout(o):(document.addEventListener("DOMContentLoaded",o,!1),window.addEventListener("load",o,!1))}()}.toString();const Ve=je;var We=n(9603),ze=function(){function e(){s()(this,e),this._localized=[],this._loadedDateFormat=void 0}return l()(e,[{key:"init",value:function(){var e=this,t=_o.settings.dateFormat.get()||w.Z.DateFormat.MDY;this._loadLocalized(t),_o.settings.dateFormat.listen((function(t){e._loadLocalized(t||w.Z.DateFormat.MDY),j.Z.parseAll(w.Z.ChangeType.Auto),_o.PaneUpdateBatcher.updateAllItems(!1,!0)}))}},{key:"parseDate",value:function(e,t){return Date.parse(this.normalizeDateString(e,t))}},{key:"parseDateDefaultFormat",value:function(e){return Date.parse(this.normalizeDateString(e,this.getCurrentDateFormat()))}},{key:"getFormat",value:function(e){try{_.Z.PAssert(337,this._localized[e],"Invalid format request")}catch(t){_.Z.reportError(t)}return this._localized[e]}},{key:"getCurrentDateFormat",value:function(){return this._loadedDateFormat||w.Z.DateFormat.MDY}},{key:"_loadLocalized",value:function(e){if(this._loadedDateFormat=e,this._localized[w.Z.DFormat.LongDayTime]="dddd h:mm tt",this._localized[w.Z.DFormat.ShortTime]="h:mm tt",this._localized[w.Z.DFormat.MonthDay]="MMM d",this._localized[w.Z.DFormat.LongStrDate]="MMMM dd, yyyy",this._localized[w.Z.DFormat.DayMonthDateYear]="ddd, MMM dd, yyyy",this._localized[w.Z.DFormat.MonthDayLong]="MMMM d",this._localized[w.Z.DFormat.MonthDayYearLong]="MMMM d, yyyy",e===w.Z.DateFormat.MDY)this._localized[w.Z.DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[w.Z.DFormat.ShortDate]="MM/dd",this._localized[w.Z.DFormat.MonthDayYear]="MM/dd/yy",this._localized[w.Z.DFormat.MonthDayYearShort]="M/d/yy",this._localized[w.Z.DFormat.DayYearTime]="MM/dd/yy h:mm tt",this._localized[w.Z.DFormat.DayDate]="ddd M/d",this._localized[w.Z.DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[w.Z.DFormat.MonthDayShort]="M/d";else if(e===w.Z.DateFormat.DMY)this._localized[w.Z.DFormat.ShortDayTime]="dd/MM h:mm tt",this._localized[w.Z.DFormat.ShortDate]="dd/MM",this._localized[w.Z.DFormat.MonthDayYear]="dd/MM/yy",this._localized[w.Z.DFormat.MonthDayYearShort]="d/M/yy",this._localized[w.Z.DFormat.DayYearTime]="dd/MM/yy h:mm tt",this._localized[w.Z.DFormat.DayDate]="ddd d/M",this._localized[w.Z.DFormat.NoPadShortDayTime]="dd/M h:mm tt",this._localized[w.Z.DFormat.MonthDayShort]="d/M";else if(e===w.Z.DateFormat.DMYDot)this._localized[w.Z.DFormat.ShortDayTime]="dd.MM h:mm tt",this._localized[w.Z.DFormat.ShortDate]="dd.MM",this._localized[w.Z.DFormat.MonthDayYear]="dd.MM.yy",this._localized[w.Z.DFormat.MonthDayYearShort]="d.M.yy",this._localized[w.Z.DFormat.DayYearTime]="dd.MM.yy h:mm tt",this._localized[w.Z.DFormat.DayDate]="ddd d.M",this._localized[w.Z.DFormat.NoPadShortDayTime]="dd.M h:mm tt",this._localized[w.Z.DFormat.MonthDayShort]="d.M";else if(e===w.Z.DateFormat.YMD)this._localized[w.Z.DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[w.Z.DFormat.ShortDate]="MM/dd",this._localized[w.Z.DFormat.MonthDayYear]="yy/MM/dd",this._localized[w.Z.DFormat.MonthDayYearShort]="yy/M/d",this._localized[w.Z.DFormat.DayYearTime]="yy/MM/dd h:mm tt",this._localized[w.Z.DFormat.DayDate]="ddd M/d",this._localized[w.Z.DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[w.Z.DFormat.MonthDayShort]="M/d";else if(e===w.Z.DateFormat.YMDDot)this._localized[w.Z.DFormat.ShortDayTime]="MM.dd h:mm tt",this._localized[w.Z.DFormat.ShortDate]="MM.dd",this._localized[w.Z.DFormat.MonthDayYear]="yy.MM.dd",this._localized[w.Z.DFormat.MonthDayYearShort]="yy.M.d",this._localized[w.Z.DFormat.DayYearTime]="yy.MM.dd h:mm tt",this._localized[w.Z.DFormat.DayDate]="ddd M.d",this._localized[w.Z.DFormat.NoPadShortDayTime]="M.dd h:mm tt",this._localized[w.Z.DFormat.MonthDayShort]="M.d";else try{_.Z.PAssert(338,!1,"Unsupport date format requested: "+e)}catch(t){_.Z.reportError(t)}}},{key:"formatDate",value:function(e,t,n){try{_.Z.PAssert(339,_.Z.isDateValid(e),"Must provide a valid date to format")}catch(a){_.Z.reportError(a)}try{_.Z.PAssert(340,t,"Must provide a valid format for the date")}catch(a){_.Z.reportError(a)}var r;if(_.Z.isDateValid(e)){var i=e.toString(this.getFormat(t));r=n&&n!==this._loadedDateFormat?this.convertDateFormat(i,this._loadedDateFormat,n):i}return r}},{key:"_isParsedDateValid",value:function(e,t,n){var r=!0,i=_.Z.parseInt(e),a=_.Z.parseInt(t),o=_.Z.parseInt(n);return(void 0!==e&&i<13||a<=0||a>12||o<=0||o>31)&&(r=!1),r}},{key:"_detectDelim",value:function(e){var t="/";return e.indexOf("-")>=0?t="-":e.indexOf(".")>=0&&(t="."),t}},{key:"convertDateFormat",value:function(e,t,n){try{_.Z.PAssert(341,t,"Must provide a date format to convert from")}catch(h){_.Z.reportError(h)}try{_.Z.PAssert(342,n,"Must provide a date format to convert to")}catch(h){_.Z.reportError(h)}var r=e;if(t!==n){var i,a,o=0;for(Ge.lastIndex=0,qe.lastIndex=0,i=t===w.Z.DateFormat.YMD||t===w.Z.DateFormat.YMDDot?Ge:qe;null!==(a=i.exec(r));){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var s,c,l,u,d=this._detectDelim(r);if(t===w.Z.DateFormat.DMYDot?t=w.Z.DateFormat.DMY:t===w.Z.DateFormat.YMDDot&&(t=w.Z.DateFormat.YMD),n===w.Z.DateFormat.MDY)switch(t){case w.Z.DateFormat.DMY:a[4]?(c=a[4],s=(l=a[3])+d+(u=a[2])+d+c):a[2]&&a[3]&&(s=(l=a[3])+d+(u=a[2]));break;case w.Z.DateFormat.YMD:a[2]?(c=a[2],s=(l=a[3])+d+(u=a[4])+d+c):a[3]&&a[4]&&(s=(l=a[3])+d+(u=a[4]));break;default:try{_.Z.PAssert(343,!1,"Invalid date format requested from MDY: ",t)}catch(h){_.Z.reportError(h)}}else if(n===w.Z.DateFormat.DMY)switch(t){case w.Z.DateFormat.MDY:a[4]?(c=a[4],l=a[2],s=(u=a[3])+d+l+d+c):a[2]&&a[3]&&(l=a[2],s=(u=a[3])+d+l);break;case w.Z.DateFormat.YMD:a[2]?(c=a[2],l=a[3],s=(u=a[4])+d+l+d+c):a[3]&&a[4]&&(l=a[3],s=(u=a[4])+d+l);break;default:try{_.Z.PAssert(344,!1,"Invalid date format requested from DMY: ",t)}catch(h){_.Z.reportError(h)}}else if(n===w.Z.DateFormat.YMD)switch(t){case w.Z.DateFormat.MDY:a[4]?s=(c=a[4])+d+(l=a[2])+d+(u=a[3]):a[2]&&a[3]&&(s=(l=a[2])+d+(u=a[3]));break;case w.Z.DateFormat.DMY:a[4]?s=(c=a[4])+d+(l=a[3])+d+(u=a[2]):a[2]&&a[3]&&(s=(l=a[3])+d+(u=a[2]));break;default:try{_.Z.PAssert(345,!1,"Invalid date format requested from YMD: ",t)}catch(h){_.Z.reportError(h)}}else try{_.Z.PAssert(346,!1,"Invalid date format requested: ",n)}catch(h){_.Z.reportError(h)}s&&this._isParsedDateValid(c,l,u)&&(r=r.substr(0,a.index)+a[1]+s+r.substr(a.index+a[0].length))}}return r}},{key:"normalizeDateString",value:function(e,t){var n=e;return this.convertDateFormat(n,t,w.Z.DateFormat.MDY)}},{key:"getAppendDateText",value:function(e,t,n){var r,i=We.Z.getToday();r=e<i||e.getFullYear()!==i.getFullYear()?this.getFormat(w.Z.DFormat.MonthDayYearShort):this.getFormat(w.Z.DFormat.MonthDayShort);var a=e.toString(r);if(t instanceof Date)r=0===t.getMinutes()?" htt":" h:mmtt",a+=t.toString(r);else if(_.Z.isNumber(t)){var o=Math.floor(t),s=o%12;0===s&&(s=12),a+=" "+s+":"+_.Z.pad2(60*(t-o))+(o>11?"pm":"am")}return isNaN(n)||(a+=" "+_.Z.round(n,2)+"hr"),a}}]),e}(),qe=/([\s]|^)(\d{1,2})[-/.](\d{1,2})(?:[-/.](\d{2,4}))?/g,Ge=/([\s]|^)(?:(\d{2,4})[-/.])?(\d{1,2})(?:[-/.](\d{1,2}))/g;const Ke=ze;var Ye=n(319),Xe=n.n(Ye);function Qe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}var Je=n(6150),$e=n(1095),et=n(6470),tt=n(9105);function nt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}var rt=n(1015),it=n(5216),at=n(1392);function ot(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}var st=n(2935),ct=new Date(9e12),lt=w.Z.VMLIFlag,ut=function(){function e(t,n){s()(this,e),ve.Z.binder(this,"onInsertLink","itemsHasMutated"),"dragScroll"in this&&ve.Z.binder(this,"dragScroll"),this.__ISVMLI=!0,this.isInitialized=!1;try{_.Z.PAssert(924,n,"Each VMLI must be given a set of additional info")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(925,_.Z.isValidChangeType(n.changeType),"Must specify a valid change type when creating a VMLI")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(926,n.store,"Must supply a valid itemStore for each VMLI")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(927,!n.parent||n.parent._store===n.store,"All VMLIs in a tree must share the same owner")}catch(i){_.Z.reportError(i)}this.__TEMP_InitCalled=!1,this.__TEMP_InitParseCalled=!1,this.__TEMP_ParseCalled=!1,this.__TEMP_SkippedInitParsed=!1;try{_.Z.PAssert(928,void 0===t.v,"We should never be passing in 'v'")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(929,void 0===t.extern,"We should never be passing in 'extern'")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(930,n.store,"Must specify a valid item store this item belongs to")}catch(i){_.Z.reportError(i)}this._store=n.store,this._parent=n.parent,this._documentOwner=n.documentOwner,this._rawText=t.text||"",this._searchText=void 0,this._parsedText=void 0,this._notePreviewText=void 0,this.elsNew=void 0,this.id=void 0,this.index=t.index,this.regexpFlags=t.regexpFlags,this._isArchived=t.isArchived||!1,this.items=new ae.Z([],this.itemsHasMutated),this._note=new x.Z,this.itemChanged=new et.Z,this.itemsLinked=new ae.Z,this.itemsLinkedTo=new ae.Z,this._demandLoadChildren=t.demandLoadChildren||!1,this._loadedOnDemandData=!this._demandLoadChildren,this._paginationToken=void 0,this._canDestroy=n.canDestroy||!1,this._destroyed=!1,this._date=void 0,this._attachments=void 0,this.draggedInPane=new x.Z;var r=t.flags;t.isNote&&(r|=w.Z.VMLIFlag.Note),t.isComplete&&(r|=w.Z.VMLIFlag.Complete),t.isStarred&&(r|=w.Z.VMLIFlag.Starred),t.priority&&(r|=t.priority),this._cachedFlagProps={},this.flags=new x.Z(r),this._updateCachedFlagProps(r),this.prefix=void 0,this._favorites=void 0,this.dateCreated=t.dateCreated?new Date(t.dateCreated):new Date,this.dateCompleted=t.dateCompleted?new Date(t.dateCompleted):void 0,this.dateModified=t.dateModified?new Date(t.dateModified):this.dateCreated,this._activeTags=void 0,this.isRoot=t.isRoot||n.isRoot,this._isDeleted=t.isDeleted||!1,this.highlightTimeout=void 0,this._version=w.Z.UninitializedVersion,this._versionText=w.Z.UninitializedVersion,this._versionRemote=void 0,this._versionRemoteText=void 0,this.lastFindPass=0,this.isEditable=new x.Z(n.isEditable||!1),this.levelsDeep=new x.Z(this._parent?this.isNote()?this._parent.levelsDeep.get():this._parent.levelsDeep.get()+1:0),this.isHighlighted=new x.Z,_.Z.totalItems++,t.isArchived&&_.Z.totalArchivedItems++,this._needsParse=!1,this.isLoaded=void 0,this.init(t,n),this.isInitialized=!0}return l()(e,[{key:"getReactKey",value:function(){return this._store.id+this.id}},{key:"notifyDemandLoadUpdate",value:function(e,t){e&&!this._loadedOnDemandData&&(t.requestDemandLoadData(this),this.notifyLoadedData())}},{key:"notifyLoadedData",value:function(){this._loadedOnDemandData=!0}},{key:"notifyLoadDataFailed",value:function(e){this._loadedOnDemandData=!1}},{key:"isDemandLoad",value:function(){return this._demandLoadChildren}},{key:"isDemandNotYetLoaded",value:function(){return this._demandLoadChildren&&!this._loadedOnDemandData}},{key:"showInOverview",value:function(){return this.numItems()>0||this._demandLoadChildren}},{key:"paginationTokenInUse",value:function(){try{_.Z.PAssert(931,this._paginationToken,"Should always have a valid pagination token when beginning to load a data page")}catch(e){_.Z.reportError(e)}return this._paginationToken.isInUse()}},{key:"hasPaginationToken",value:function(){return!!this._paginationToken}},{key:"needsPaginationToken",value:function(){return!this.hasPaginationToken()&&!this._paginationToken}},{key:"setPaginationToken",value:function(e){try{_.Z.PAssert(932,e,"Should never be setting an undefined token - use clear instead")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(933,!this._paginationToken,"Should never be overriding a pagination token - clear then set")}catch(t){_.Z.reportError(t)}this._paginationToken=e}},{key:"clearPaginationToken",value:function(){this._paginationToken&&this._paginationToken.isInUse()&&this._paginationToken.notifyEndUse(),this._paginationToken=void 0}},{key:"beginDataPageLoad",value:function(){try{_.Z.PAssert(935,this._paginationToken,"Should always have a valid pagination token when beginning to load a data page")}catch(e){_.Z.reportError(e)}try{_.Z.PAssert(936,!this._paginationToken.isInUse(),"Token should not already be in use when beginning a page load")}catch(e){_.Z.reportError(e)}return this._paginationToken.notifyBeginUse(),this._paginationToken}},{key:"endDataPageLoad",value:function(e){try{_.Z.PAssert(938,this._paginationToken,"Should always have a valid pagination token when done loading a data page")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(939,this._paginationToken.isInUse(),"Token should always be in use when running a request")}catch(t){_.Z.reportError(t)}e&&this._paginationToken.notifyEndUse(),this._paginationToken=void 0}},{key:"canHaveNote",value:function(){var e=this.belongsToItemStore(_o.itemStoreManager.getDefaultItemStore()),t=this.belongsToItemStore(_o.itemStoreManager.getTempItemStore());return e||t}},{key:"createNote",value:function(){try{_.Z.PAssert(940,!this.isNote(),"Should never create a note on a note item")}catch(t){_.Z.reportError(t)}var e;return this.hasNote()?e=this.getNote():(e=this._store.createItemRaw({id:void 0,text:"",isNote:!0},{parent:this,documentOwner:this._documentOwner,changeType:w.Z.ChangeType.AllLocal}),this.setNote(e,w.Z.ChangeType.Local)),e}},{key:"hasNote",value:function(){return void 0!==this._note.get()}},{key:"getNote",value:function(){try{_.Z.PAssert(941,this.hasNote(),"Must have a note to get one")}catch(e){_.Z.reportError(e)}return this._note.get()}},{key:"getNoteIfExists",value:function(){return this._note.get()}},{key:"setNote",value:function(t,n){try{_.Z.PAssert(942,_.Z.isValidChangeType(n),"Must supply a valid changeType")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(943,!t||this.belongsToSameItemStore(t),"Note must belong to the same item store")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(944,!this.isNote(),"Should never set a note on a note")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(945,!this._note.get()||!t,"Should never set a note multiple times on a single item")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(946,!t||t.isNote(),"Should only set items that are notes as notes")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(947,!t||!t.isDeleted(),"Should note set a deleted note")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(948,!t||t instanceof e,"Note must be a valid VMLI")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(949,!t||t.parent()===this,"Should always have a valid parent set before setting note on item")}catch(i){_.Z.reportError(i)}var r=this._note.get();st.Z.animateNext(),this._note.set(t),this.shouldSave()&&j.Z.setNote(this,t,r,n)}},{key:"isNote",value:function(e){return this._cachedFlagProps.isNote}},{key:"shouldSave",value:function(){return this._shouldSave}},{key:"canDestroy",value:function(){return this._canDestroy}},{key:"getPadding",value:function(e,t,n){try{_.Z.PAssert(953,e,"Invalid pane")}catch(r){_.Z.reportError(r)}return this.isNote()?this.parent().getPadding(e,t,n):_o.DisplaySettings.getPaddingForLevel(n,t)}},{key:"_updateStylePadding",value:function(e,t){try{_.Z.PAssert(954,this._parent,"Must have a valid parent to update padding, root should never change")}catch(s){_.Z.reportError(s)}var n=e+(this.isNote()?0:1),r=this.levelsDeep.get()!==n;if(r||t){var i=0;r&&this.levelsDeep.set(n);for(var a=this.getItems(),o=0;o<a.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a[o]._updateStylePadding(n,t)}}}},{key:"setFlags",value:function(e){this._updateCachedFlagProps(e),this.flags.set(e)}},{key:"_updateCachedFlagProps",value:function(e){this._cachedFlagProps={isComplete:!!(e&lt.Complete),isStarred:!!(e&lt.Starred),isNote:!!(e&lt.Note),isDisplayComplete:!!(e&lt.DisplayComplete)}}},{key:"getPriorityProps",value:function(){var e=this.getPriority();if(e)return"t-priority "+(this.isComplete()?"t-priorityComplete":w.Z.PriorityClass[e])}},{key:"styleProps",value:function(e,t,n){var r=(e||{}).pane,i=this.flags.get(),a="";if(this.isHeader()&&!r.isViewFlatList()&&(a+="pHeader "),!this.isPrefixHeader()||null!==e&&void 0!==e&&e.isBlockHeader||(a+="t-header t-h".concat(r.itemPrefixHeaderLevel(this)," ")),r.isItemBold(this)&&(a+="font-bold "),this.prefix&&(a+="hasPrefix ",this.isPrefixCodeBlock()&&(a+="codeBlock ")),!n){var o=!1;if((i&w.Z.VMLIFlag.Complete||!(i&w.Z.VMLIFlag.Note)&&i&w.Z.VMLIFlag.DisplayComplete)&&(o=!0),o?(a+="pComplete ",r.search.isMatchStuckHiding(this)||(a+="pDisplayComplete grayscale c-foreground-super-faded c-before-super-faded ")):a+="pNormal ",i&w.Z.VMLIFlag.Starred&&!(i&w.Z.VMLIFlag.Complete||i&w.Z.VMLIFlag.DisplayComplete)&&(a+="pStar t-star "),i&w.Z.VMLIFlag.Note){a+="pNote c-foreground-faded ";var s=this.parent().flags.get();(s&w.Z.VMLIFlag.Complete||s&w.Z.VMLIFlag.DisplayComplete)&&(a+="pComplete c-foreground-super-faded c-before-super-faded "),s&w.Z.VMLIFlag.Starred&&!(s&w.Z.VMLIFlag.Complete||s&w.Z.VMLIFlag.DisplayComplete)&&(a+="pStar t-star ")}}var c=this.getAttachments();if(c)for(var l=0,u=0;u<c.length;++u){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=c[u];if(d.isLoaded()){var h=d.getPlugin().getCssClass(d,r);h&&(a+=h)}}return a}},{key:"stylePropsWrapper",value:function(){return _.Z.classNames(this.isPrefixCodeBlock()&&"t-codeBlock")}},{key:"onAttachmentIDChange",value:function(e,t){if(e.getPlugin().id===w.Z.PluginID.GCalendar){var n=this.getMooDate();n&&(n.setGCalId(e.id),this.onMooDateUpdated(w.Z.ChangeType.Local,!0))}this.setTextToWhatItAlreadyIs(w.Z.ChangeType.Local)}},{key:"onAttachmentUpdate",value:function(e,t,n){var r=e.getPlugin();if(r===_o.pluginManager.getPluginGCalendar()){var i=this.getMooDate();if(i&&!i.getGCalCalendar()&&e.hasField("calendarID")){var a=e.getField("calendarID");if(i.setGCalCalendar(a),this.shouldSave()){var o={date:this._date?this._date.toData():null};j.Z.saveItem(this,o,w.Z.ChangeType.Local,w.Z.SaveFlag.Text)}}}else r===_o.pluginManager.getPluginGmail()&&t&&(t.includes("accountID")||t.includes("subject"))&&this.onAttachInlineUpdate();t&&e.fieldsHaveParseEffect(t)&&(this.parseText(this.getRawText(),n),Je.Z.beginBatch(this),Je.Z.itemTextChanged(this))}},{key:"setAttachments",value:function(e,t,n){var r=!1;if(!this._attachments&&e&&(this._attachments=[]),this._attachments){for(var i=0,a=0,o=this._attachments,s=0;s<o.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e.indexOf(o[s])<0&&(o[s].unsubscribe(this),o[s].notifyItemTextChanged(this,!0),this.shouldSave()&&o[s].markUnused(t),r=!0)}for(var c=0;c<e.length;++c){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=e[c];if(o.indexOf(l)<0){if(l.shouldBeDeleted()){var u=l.getEmbedString(),d=this.getRawText().replace(u,"File failed to upload");return void this.setText(d,w.Z.ChangeType.Local)}l.subscribe(this),this.shouldSave()&&l.markInUse(t),r=!0}}r&&(this._attachments=e)}r&&!1!==n&&this.itemChanged.notify()}},{key:"getAttachment",value:function(e){try{_.Z.PAssert(955,this._attachments,"Must have valid attachments in order to query")}catch(t){_.Z.reportError(t)}if(this._attachments)return this._attachments[e]}},{key:"hasAttachment",value:function(e){if(this._attachments)for(var t=0,n=0;n<this._attachments.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._attachments[n].id===e)return!0}return!1}},{key:"hasPluginAttachment",value:function(e){try{_.Z.PAssert(956,e,"Must provide a valid plugin type to query")}catch(r){_.Z.reportError(r)}if(this._attachments)for(var t=0,n=0;n<this._attachments.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._attachments[n].getPlugin().id===e)return!0}return!1}},{key:"getAttachmentByType",value:function(e){try{_.Z.PAssert(957,e,"Must provide a valid plugin type to query")}catch(i){_.Z.reportError(i)}if(this._attachments)for(var t=0,n=0;n<this._attachments.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._attachments[n];if(r.isType(e))return r}}},{key:"getAttachmentByPlugin",value:function(e){try{_.Z.PAssert(958,e,"Must provide a valid plugin type to query")}catch(i){_.Z.reportError(i)}if(this._attachments)for(var t=0,n=0;n<this._attachments.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._attachments[n];if(r.isPlugin(e))return r}}},{key:"getAttachments",value:function(){if(this._attachments&&this._attachments.length>0)return this._attachments}},{key:"hasAttachments",value:function(){return this._attachments&&this._attachments.length>0}},{key:"getNumAttachments",value:function(){return this._attachments?this._attachments.length:0}},{key:"hasAttachmentType",value:function(e){return _o.pluginManager.hasAttachmentType(this,e)}},{key:"copyProperties",value:function(e){this.setStarred(e.isStarred(),w.Z.ChangeType.Auto),this.setComplete(e.isComplete(),w.Z.ChangeType.Auto),this.setPriority(e.getPriority(),w.Z.ChangeType.Auto)}},{key:"moveNote",value:function(e,t){try{_.Z.PAssert(959,e.hasNote(),"Must have a note to move")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(960,!this.hasNote(),"Must not already have a note")}catch(r){_.Z.reportError(r)}var n=e.getNote();e.setNote(void 0,t),n&&(n.setParent(this),this.setNote(n,t))}},{key:"parent",value:function(){return this._parent}},{key:"setParent",value:function(e){var t=this._parent;if(this._parent=e,e&&e!==t){var n,r;if(t&&!t.isNote())null===(n=t.getDocumentOwner())||void 0===n||n.incrementNumItems(-1);if(!e.isNote()&&!this.isDeleted())null===(r=e.getDocumentOwner())||void 0===r||r.incrementNumItems(1);this._updateStylePadding(this._parent.levelsDeep.get(),!1)}return this._parent}},{key:"requireStoredEls",value:function(){var e=this.getItemStore();return!!e&&e.requireStoredEls()}},{key:"getItemStore",value:function(){try{_.Z.PAssert(961,this._store,"Should never be getting the item store from a destroyed VMLI")}catch(e){_.Z.reportError(e)}return this._store}},{key:"belongsToSameItemStore",value:function(e){return this.getItemStore()===e.getItemStore()}},{key:"belongsToItemStore",value:function(e){return this.getItemStore()===e}},{key:"notifyItemPropertyChanged",value:function(e,t){if(this.hasAttachments())for(var n=0,r=this.getAttachments(),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r[i].notifyItemPropertyChanged(this,e,t)}}},{key:"unArchive",value:function(e){this._documentOwner.unArchiveItem(this,e)}},{key:"archiveSelf",value:function(e){try{_.Z.PAssert(962,this._documentOwner,"Trying to archive item without a document")}catch(t){_.Z.reportError(t)}this._documentOwner&&this._documentOwner.archiveItem(this,e)}},{key:"isArchived",value:function(){return this._isArchived}},{key:"setArchived",value:function(e,t){this._isArchived=e}},{key:"isHidden",value:function(e){try{_.Z.PAssert(963,e,"Must specify the pane for the item being checked")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(964,!e||e.search,"Pane search obj must exist: ",e.isDestroyed())}catch(t){_.Z.reportError(t)}return!(!e||!e.search)&&!e.search.isMatched(this)}},{key:"getRawText",value:function(){return this._rawText}},{key:"getParsedText",value:function(){try{_.Z.PAssert(965,!1===this._needsParse,"Text should be parsed before calling get")}catch(e){_.Z.reportError(e)}return void 0!==this._parsedText?this._parsedText:this._rawText}},{key:"getSearchText",value:function(e){if(e){var t=e.search.getItemSearchText(this);if(t)return t}return void 0===this._searchText&&(this._searchText=this.generateSearchText()),this._searchText}},{key:"setRawText",value:function(e){void 0!==e&&null!==e||(e="");try{_.Z.PAssert(966,e.indexOf(w.Z.AttachChar)<0,"Should never have an AttachChar present in raw text")}catch(t){_.Z.reportError(t)}this._rawText=e,this._searchText=void 0,this._parsedText=void 0,this._notePreviewText=void 0,this._needsParse=!0}},{key:"setParsedText",value:function(e){this._parsedText=e,this._needsParse=!1}},{key:"setElsNew",value:function(e){this.elsNew=e,this.isLoaded&&(this._searchText=this.generateSearchText())}},{key:"generateSearchText",value:function(){try{_.Z.PAssert(968,this.elsNew,"Item has no els")}catch(e){_.Z.reportError(e)}return this.elsNew?this.elsNew.getDisplayText(this,{showMarkdown:!1,noPrefix:!0,noDates:!0,noDataImages:!0,linkedItemDepth:0}).toLowerCase():""}},{key:"getPriority",value:function(e){if(e){var t=e.search.getItemPriority(this);if(void 0!==t)return t}return this.flags.get()&w.Z.PMask}},{key:"setPriority",value:function(e,t){try{_.Z.PAssert(969,_.Z.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(970,null===e||w.Z.PriorityClass[e],"Priority must be defined in globals")}catch(i){_.Z.reportError(i)}if(e!==this.getPriority()){var n=this.flags.get()&~w.Z.PMask|e;if(this.setFlags(n),this.shouldSave()){var r={flags:n};j.Z.saveItem(this,r,t,w.Z.SaveFlag.Text)}this.notifyItemPropertyChanged(t,"priority"),Je.Z.itemPriorityChanged(this),_o.onIntroAction("Priority")}}},{key:"isScheduled",value:function(){return!!this._date}},{key:"getDuration",value:function(e,t){if(e){var n=e.search.getItemDuration(this);if(n)return n}if(this._date)return this._date.duration||w.Z.DefaultEventDuration}},{key:"setDuration",value:function(e){this._date?this._date.setDuration(e):this._date=new $e.Z(void 0,{duration:e})}},{key:"getEndDate",value:function(e){if(this._date)return this._date.getEnd()}},{key:"isMultidayEvent",value:function(){var e=!1;if(this.getDate()&&this.getDuration()>0){var t=this.getEndDate();We.Z.isSameDay(this.getDate(),t)||(e=!0)}return e}},{key:"getStickySearchInfo",value:function(){return{prefix:this.getPrefix(),date:this.getDate(),duration:this.getDuration(),tagsLower:this.getTagsLower(),contacts:this.getContacts(),searchText:this.getSearchText(),priority:this.getPriority(),isComplete:this.isComplete(),isStarred:this.isStarred()}}},{key:"_onGCalUpdated",value:function(){var e,t=null===(e=this._date)||void 0===e?void 0:e.getGCalId();t&&_o.pluginManager.getPluginGCalendar().setCachedItem(t,this)}},{key:"onMooDateUpdated",value:function(e,t){var n=this;if(_o.timeline.updateNotifications(this),this._onGCalUpdated(),t||_.Z.isFlagSet(e,w.Z.ChangeType.ItemLoad)||Je.Z.itemDateChanged(this),this.itemChanged.notify(),this.shouldSave()||this._attachments){var r={date:this._date?this._date.toData():null};this.shouldSave()&&j.Z.saveItem(this,r,e,w.Z.SaveFlag.Text),!t&&this._attachments&&_.Z.isLocalChange(e)&&this._attachments.forEach((function(e){e.getPlugin().id===w.Z.PluginID.GCalendar&&e.notifyItemDateChanged(n)}))}}},{key:"setMooDate",value:function(e,t,n){if(e!==this._date){this._date&&e?this._date.copyFrom(e,n):this._date=e;var r=this.getRawText();this.onMooDateUpdated(t),!e&&r.includes(w.Z.CharDate)&&(r=_.Z.trimRight(r.replace(new RegExp(w.Z.CharDate,"g"),"").replace(/' {2}'/g," ")),this.setText(r,t))}}},{key:"setDate",value:function(e,t,n){if(this._date)e!==this._date.getDate()&&(this._date.setDate(e),this._date.setDuration(t),this.onMooDateUpdated(n));else if(this.setMooDate(new $e.Z(e),n,[]),this.getRawText().indexOf(w.Z.CharDate)<0){this.getParsedText();this.setText(this.getParsedText()+" "+w.Z.CharDate,w.Z.ChangeType.Local)}}},{key:"getMooDate",value:function(){return this._date}},{key:"getNextDate",value:function(e){return this._date?this._date.getNext(e):void 0}},{key:"getDate",value:function(e){if(e){var t=e.search.getItemDate(this);if(t)return t}return this._date?this._date.getDate():void 0}},{key:"allDayDate",value:function(){return!!this._date&&!this._date.getTime()}},{key:"_setFlagHelper",value:function(e,t){var n=t?this.flags.get()|e:this.flags.get()&~e;this.setFlags(n)}},{key:"isDeleted",value:function(){return this._isDeleted}},{key:"setDeleted",value:function(e,t){try{_.Z.PAssert(971,_.Z.isValidChangeType(t),"Must supply a valid changetype to delete an item: "+t)}catch(o){_.Z.reportError(o)}var n;if((this._isDeleted=e,e)&&(e!==this._isDeleted&&this.shouldSave()&&j.Z.deleteItem(this.parent(),this,t),null===(n=this.getDocumentOwner())||void 0===n||n.incrementNumItems(-1),this._attachments)){for(var r=0,i=this._attachments,a=0;a<i.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e?(i[a].unsubscribe(this),this.shouldSave()&&i[a].markUnused(t)):(i[a].subscribe(this),this.shouldSave()&&i[a].markInUse(t))}e&&(this._attachments=[])}}},{key:"isImportant",value:function(e){return this.getPriority(e)}},{key:"forceComplete",value:function(e,t){return this.setComplete(e,t,!0)}},{key:"isDisplayComplete",value:function(){return this._cachedFlagProps.isDisplayComplete}},{key:"computeDisplayComplete",value:function(){var e=this.parent(),t=e&&!this.isComplete()&&(e.isComplete()||e.isDisplayComplete());this._setFlagHelper(w.Z.VMLIFlag.DisplayComplete,t)}},{key:"propagateDisplayComplete",value:function(){var e=0;this.computeDisplayComplete();for(var t=0;t<this.numItems();t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this.itemAtIndex(t);n.isComplete()||n.propagateDisplayComplete()}}},{key:"isComplete",value:function(){return this._cachedFlagProps.isComplete}},{key:"setComplete",value:function(e,t,n){var r=e,i={};try{_.Z.PAssert(972,_.Z.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(o){_.Z.reportError(o)}if(e){var a=!1;this.isRepeatDate()&&this._date.complete()&&(a=!0,this.onMooDateUpdated(t),Je.Z.itemRepeatDateCompleted(this),r=!1,_o.toasts.pushMessage({text:"Completed. Next occurrence: "+We.Z.toHumanText(this._date.getNext()),action:w.Z.MessageAction.Undo,hold:!1})),a||this.dateCompleted||(this.dateCompleted=new Date,i.dateCompleted=this.getDateCompletedTime()),_.Z.isLocalChange(t)&&_.Z.aggregateEvent("ItemCompleted")}else this.dateCompleted=void 0,i.dateCompleted=null,!0;this._setFlagHelper(w.Z.VMLIFlag.Complete,r),_.Z.isRemoteChange(t)||(i.flags=this.flags.get(),this.shouldSave()&&j.Z.saveItem(this,i,t,w.Z.SaveFlag.Text),_o.onIntroAction("Complete")),this.notifyItemPropertyChanged(t,"isComplete"),this.propagateDisplayComplete(),_o.timeline.updateNotifications(this),Je.Z.itemCompleteChanged(this),Je.Z.itemSearchChanged(this)}},{key:"setStarred",value:function(e,t){if(void 0!==e){try{_.Z.PAssert(973,_.Z.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(a){_.Z.reportError(a)}if(e!==this._cachedFlagProps.isStarred){var n=this.flags.get(),r=e?n|w.Z.VMLIFlag.Starred:n&~w.Z.VMLIFlag.Starred;this.setFlags(r);var i={flags:r};this.shouldSave()&&j.Z.saveItem(this,i,t,w.Z.SaveFlag.Text),this.notifyItemPropertyChanged(t,"isStarred"),Je.Z.itemPriorityChanged(this)}}}},{key:"isStarred",value:function(e){if(e){var t=e.search.getItemStarred(this);if(void 0!==t)return t}return this._cachedFlagProps.isStarred}},{key:"isHeader",value:function(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)}},{key:"getVisibleChildren",value:function(e){if(!this.isNote()){for(var t=0,n=this.getItems(),r=[],i=0;i<n.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n[i].isHidden(e)||r.push(n[i])}return r}}},{key:"hasVisibleChildren",value:function(e){if(this.isNote())return!1;for(var t=0,n=this.getItems(),r=0;r<n.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!n[r].isHidden(e))return!0}return!1}},{key:"hasHeaderChildren",value:function(){if(this.isNote())return!1;for(var e=0,t=this.getItems(),n=0;n<t.length;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(t[n].isHeader())return!0}return!1}},{key:"isCollapsible",value:function(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)}},{key:"isDraggable",value:function(){return!this.isNote()}},{key:"setTags",value:function(e,t){var n=this._activeTags&&!e&&this._activeTags||!this._activeTags&&e&&e||_.Z.arrayDiff(this._activeTags,e);this._activeTags=e,this._activeTagsLower=e?e.map((function(e){return e.toLowerCase()})):void 0,n&&n.length>0&&!_.Z.isFlagSet(t,w.Z.ChangeType.ItemLoad)&&Je.Z.itemTagsChanged(this,n)}},{key:"getTags",value:function(){return this._activeTags}},{key:"getTagsLower",value:function(e){if(e){var t=e.search.getItemTagsLower(this);if(t)return t}return this._activeTagsLower}},{key:"setContacts",value:function(e,t){var n=this._activeContacts&&!e&&this._activeContacts||!this._activeContacts&&e&&e||_.Z.arrayDiff(this._activeContacts,e);if(this._activeContacts=e,n&&n.length>0&&!_.Z.isFlagSet(t,w.Z.ChangeType.ItemLoad))return Je.Z.itemContactsChanged(this,n),!0}},{key:"getContacts",value:function(e){if(e){var t=e.search.getItemContacts(this);if(t)return t}return this._activeContacts}},{key:"hasCompletedAncestor",value:function(){for(var e=0,t=this.parent();t;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(t.isComplete())return!0;t=t.parent()}}},{key:"hasTime",value:function(){return this._date&&!!this._date.getTime()}},{key:"getTimeOfDay",value:function(){return this._date?this._date.getTime():this.dateCompleted?this.dateCompleted.getTimeOfDay():0}},{key:"_formatDateTime",value:function(e){return e.toString(_o.International.getFormat(w.Z.DFormat.ShortTime))}},{key:"getDisplayDateWithDuration",value:function(e,t){var n=this,r=this.getDate(t);if(r){var i=this.getEndDate(t);+We.Z.clearTime(r)===+r||+We.Z.clearTime(i)===+r&&(r=i)}else if(this.isRepeatDate()){var a=this.getMooDate();a&&(r=a.getNext(e))}if(!_.Z.isDemoMode())try{_.Z.PAssert(974,r,"No display date with duration",(function(){return n.getMooDate()&&n.getMooDate().toData()}))}catch(o){_.Z.reportError(o)}return r}},{key:"getTime",value:function(){var e="",t=this.getNextDate();if(this.dateCompleted&&this.isComplete())e=this._formatDateTime(this.dateCompleted);else if(t){var n;if(t.hasTimeOfDay())this.getDuration()>0&&(n=this.getDisplayDateWithDuration()),n?n.equals(t)?e=[this._formatDateTime(t),this._formatDateTime(this.getEndDate())]:n.equals(this.getEndDate())&&(e="Ends "+this._formatDateTime(this.getEndDate())):e=this._formatDateTime(t)}return e}},{key:"createDateString",value:function(e){return e.isBefore(We.Z.getTodayPlusDays(7))?e.toString(_o.International.getFormat(w.Z.DFormat.LongDayTime)):e.toString(_o.International.getFormat(w.Z.DFormat.ShortDayTime))}},{key:"fullTime",value:function(){var e=this.getDate();if(!e)return"";this.createDateString(e)}},{key:"init",value:function(e,t){this._shouldSave=!(t&&t.noSave);try{_.Z.PAssert(975,!this._shouldSave||!this._demandLoadChildren,"Should never be saving results of demand loaded items")}catch(a){_.Z.reportError(a)}if(this.id=e.id||j.Z.generateID(),e.date&&"undefined"!==e.date){var n=e.date instanceof $e.Z?e.date.clone():$e.Z.fromData(e.date);n?(this._date=n,this._date.getGCalId()&&this._onGCalUpdated()):_.Z.reportError(new Error("Initial invalid date: "+e.date))}e.dateCompleted&&(this.dateCompleted=new Date(e.dateCompleted)),this.computeDisplayComplete(),(e.items&&e.items.length>0||e.note)&&this.initItems(e.items,e.note,t),this.__TEMP_InitCalled=!0;try{_.Z.PAssert(976,t,"Missing required properties in extraInfo")}catch(a){_.Z.reportError(a)}var r,i=t?t.changeType:w.Z.ChangeType.Auto;try{_.Z.PAssert(977,_.Z.isValidChangeType(i),"Must supply a valid changetype to VMLIs")}catch(a){_.Z.reportError(a)}(this.__TEMP_InitParseCalled=!0,this.shouldSave()&&!_.Z.isAutoChange(t.changeType))?(_.Z.isLocalChange(t.changeType)?w.Z.SaveFlag.All:w.Z.SaveFlag.None,this.getItemStore().trackGlobally()&&j.Z.setItem(this)):this.getItemStore().trackGlobally()&&j.Z.setItem(this);(this.parseText(this.getRawText(),t.changeType|w.Z.ChangeType.ItemLoad),_.Z.isLocalChange(t.changeType)&&_.Z.aggregateEvent("ItemCreated"),this.isRoot||this.isNote())||(null===(r=this.getDocumentOwner())||void 0===r||r.incrementNumItems(1))}},{key:"onLoad",value:function(e){this.isLoaded||(this.isDemandLoad()&&!e.isSearched()&&this.notifyDemandLoadUpdate(!0,e),this.isLoaded=!0)}},{key:"destroy",value:function(e){try{_.Z.PAssert(978,this._canDestroy||e,"VMLI must be explicitly marked as destroyable")}catch(a){_.Z.reportError(a)}try{_.Z.PAssert(979,e||!this.shouldSave()||_.Z.isDemoMode(),"Should never destroy a saveable VMLI")}catch(a){_.Z.reportError(a)}var t=this.getItemStore();if(this._destroyed=!0,this._attachments){for(var n=0,r=this._attachments,i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r[i].unsubscribe(this)}this._attachments=void 0}t.trackGlobally()&&j.Z.clearItem(this.id),this.items.unlisten(this.itemsHasMutated),Je.Z.itemSearchChanged(this),this._store=void 0}},{key:"isDestroyed",value:function(){return this._destroyed}},{key:"isFullscreen",value:function(){return _.Z.focusedItem===this}},{key:"findItem",value:function(e){var t=this.getIndexOf(e.id);if(t>=0)return{index:t,arr:this.items,isArchived:!1}}},{key:"setItems",value:function(e){for(var t=0,n=this.items.get(),r=n.length>0,i=!1,a=0;a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=e[a],s=n.indexOfWithProperty("id",o.id);if(s>=0){var c=n[s];o.items&&c.setItems(o.items)}else n.push(this._store.createItemRaw(o,{documentOwner:this._documentOwner,parent:this,changeType:w.Z.ChangeType.Auto})),i=!0}i&&(r&&n.sort(tt.Z.compareItemIndex),this.items.set(n),this.itemsHasMutated())}},{key:"initItems",value:function(t,n,r){var i=!1;if(r=Object.assign({},r,{parent:this,documentOwner:this._documentOwner,isRoot:!1}),t&&t.length>0){var a=0;try{_.Z.PAssert(980,!this.hasChildren(),"Update items should only be called from initialize when there are no items already loaded")}catch(g){_.Z.reportError(g)}for(var o=0;o<t.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=t[o],c=void 0;if(s instanceof e?c=s:_.Z.isString(s)&&(c=j.Z.getItem(s)),c){var l=j.Z.getItem(c.parent().id);if(l&&l.id!==this.id){var u=l.items.indexOf(c.id);try{_.Z.PAssert(983,-1===u,"Expect that the old parent has been notified")}catch(g){_.Z.reportError(g)}var d=c.getIndex();d>-1&&c.parent().removeChildAtIndex(d,r.changeType)}c.setParent(this)}else if(_.Z.isString(s)){var h=j.Z.getItemDataLocal(this._documentOwner,s);try{_.Z.PAssert(981,h,"Referenced item doesn't exist",s)}catch(g){_.Z.reportError(g)}h&&(c=this._store.createItemRaw(h,r),this.checkMismatchedDocument(c,h))}else{try{_.Z.PAssert(982,s,"Item must exist otherwise we arent creating anything")}catch(g){_.Z.reportError(g)}s&&(c=this._store.createItemRaw(s,r),this.checkMismatchedDocument(c,s))}try{_.Z.PAssert(984,c,"There must be a model at this point")}catch(g){_.Z.reportError(g)}if(c){if(c.isNote()){n=c.id;continue}i=!0,this.items.push(c)}}}if(n){try{_.Z.PAssert(985,!this._note.get(),"Must not already have a valid note set")}catch(g){_.Z.reportError(g)}try{_.Z.PAssert(986,_.Z.isString(n)||_.Z.isObject(n),"Note must be a valid ID")}catch(g){_.Z.reportError(g)}var p;if(_.Z.isString(n)){if(!(p=r.isTemp?void 0:j.Z.getItem(n))){var f=j.Z.getItemDataLocal(this._documentOwner,n);try{_.Z.PAssert(987,f,"Referenced note doesn't exist",n)}catch(g){_.Z.reportError(g)}f&&(f.isDeleted?p=null:(f=Object.assign({isNote:!0},f),p=this._store.createItemRaw(f,r),this.checkMismatchedDocument(p,f)))}}else _.Z.isObject(n)&&(p=this._store.createItemRaw(n,r));try{_.Z.PAssert(988,void 0!==p,"Must have a valid note VM at this point")}catch(g){_.Z.reportError(g)}p&&(this._note.set(p),i=!0)}i&&this.itemsHasMutated()}},{key:"addItemAtIndex",value:function(e,t,n){try{_.Z.PAssert(989,n,"Must pass pane when adding item at index")}catch(i){_.Z.reportError(i)}var r=n.createVMLI(e,{documentOwner:this._documentOwner,parent:this,changeType:w.Z.ChangeType.AllLocal,isEditable:!0});return this.insertItem(r,t),r}},{key:"insertItem",value:function(e,t,n){try{_.Z.PAssert(990,!this.isNote(),"Notes cannot use this function")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(991,e,"Must specify a valid item to be inserted")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(992,this!==e,"Should not insert an item into itself")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(993,this.belongsToSameItemStore(e),"Items must belong to the same item store")}catch(r){_.Z.reportError(r)}this!==e&&(isNaN(t)||t<0?this.items.push(e):this.items.splice(t,0,e),this.shouldSave()&&j.Z.addItem(this,e,t,n))}},{key:"insertSorted",value:function(e,t,n){try{_.Z.PAssert(994,!this.isNote(),"Notes cannot use this function")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(995,e,"Must specify a valid item to be inserted")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(996,t,"Must supply a valid comparator")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(997,this.belongsToSameItemStore(e),"Items must belong to the same item store")}catch(i){_.Z.reportError(i)}var r=this.items.insertSorted(e,t,n);this.shouldSave()&&j.Z.addItem(this,e,r)}},{key:"moveTo",value:function(t,n){var r=t.parent,i=t.index,a=t.shouldBeArchived;try{_.Z.PAssert(998,r instanceof e,"New parent must be a valid VMLI")}catch(p){_.Z.reportError(p)}void 0===i&&(i=-1),void 0===a&&(a=!1);var o=this.parent(),s=o.findItem(this),c=this.index;if(s)if(r.getDocumentOwner().getBacking()!==o.getDocumentOwner().getBacking())_o.toasts.pushMessage({text:"Moving items between local and synced documents is not yet supported. Please copy and paste these items for now."});else{var l=i;if(o===r){if(s.index===l)return;s.index<l&&l--}st.Z.animateNext(this.id),_o.PaneUpdateBatcher.beginUpdateItems(),s.arr.splice(s.index,1);var u=r.items;l<0?u.push(this,!1):u.splice(l,0,this,!1);var d=r.getDocumentOwner(),h=this.getDocumentOwner();d!==h&&this.forEachChildRecursive((function(e){return e.setDocumentOwner(d)}),!0,!0),this.setParent(r),u.notify(),this.hasNote()&&this.getNote().itemChanged.notify(),_o.PaneUpdateBatcher.commitUpdateItems(),Je.Z.itemSearchChanged(this),Je.Z.itemIndentChanged(this);try{_.Z.PAssert(999,this.shouldSave(),"Item must be marked as saveable")}catch(p){_.Z.reportError(p)}try{_.Z.PAssert(1e3,o.shouldSave(),"Old parent must be marked as saveable")}catch(p){_.Z.reportError(p)}try{_.Z.PAssert(1001,this.parent().shouldSave(),"New parent must be marked as saveable")}catch(p){_.Z.reportError(p)}this.shouldSave()&&(j.Z.moveItem(this,o,c,n),d!==h&&this.forEachChildRecursive((function(e){return j.Z.moveItemDocument(e,h.id,n)}),!0)),o!==r&&(o.propagateDisplayComplete(),r.propagateDisplayComplete()),this.isInitialized&&this.isPrefixNumList()&&ue.Z.fireEvent("numListChanged",[])}else _o.toasts.pushMessage({text:"Error moving item"})}},{key:"getItemsArrayForSave",value:function(){var e=0;try{_.Z.PAssert(1002,!this.isNote(),"Notes cannot use this function")}catch(i){_.Z.reportError(i)}for(var t=[],n=this.getItems(),r=0;r<n.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t.push(n[r].id)}return t}},{key:"getDateTime",value:function(){if(this.getDate())return this.getDate().getTime()}},{key:"getDateCompletedTime",value:function(){if(this.dateCompleted)return this.dateCompleted.getTime()}},{key:"isForceCompleted",value:function(){return!(!this.dateCompleted||!this.dateCompleted.equals(ct))}},{key:"getMetaTextSaveData",value:function(){this.getDate();return{date:this._date?this._date.toData():void 0,dateCompleted:this.getDateCompletedTime()}}},{key:"_generateNotificationEntry",value:function(e,t){var n=new Date(e);try{_.Z.PAssert(1003,_.Z.isDateValid(n),"Must provide a valid alert date: "+e)}catch(r){_.Z.reportError(r)}return n=e.hasTimeOfDay()?n.addMinutes(-_o.settings.notificationDelay.get()):We.Z.clearTime(n.addDays(-1)).addHours(17),{id:this.id,text:this.generateTitleText(void 0,!0),date:e,alertDate:n,endDate:t}}},{key:"getNotificationEntry",value:function(){try{_.Z.PAssert(1004,this.getNextDate(),"Must have a valid date")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(1005,!this.allDayDate(),"All day dates should not be scheduled")}catch(t){_.Z.reportError(t)}if(!this.allDayDate())try{var e=this.getNextDate();if(e&&e>new Date)return this._generateNotificationEntry(e,this.getEndDate())}catch(n){return void _.Z.reportError(n)}}},{key:"getDebugData",value:function(){return{id:this.id,parent:this._parent?this._parent.id:void 0,items:this.isNote()?void 0:this.getItemsArrayForSave(),text:this.getRawText(),note:this.hasNote()?this.getNote().id:void 0,isNote:this.isNote(),isDeleted:this.isDeleted()}}},{key:"getFullSaveData",value:function(e,t){var n=this;try{_.Z.PAssert(1006,e||this.shouldSave(),"Item must be marked as saveable")}catch(o){_.Z.reportError(o)}var r=this.flags.get();try{_.Z.PAssert(1007,this._documentOwner,"Item has no document")}catch(o){_.Z.reportError(o)}var i={id:this.id,index:this.index,text:this.getRawText(),date:this._date?this._date.toData():void 0,dateCreated:this.dateCreated.getTime(),dateModified:this.dateModified.getTime(),dateCompleted:this.getDateCompletedTime(),flags:r||void 0,isRoot:this.isRoot,docId:this._documentOwner?this._documentOwner.id:void 0,note:this.hasNote()?this.getNote().id:void 0,isArchived:this.isArchived()||void 0,isDeleted:void 0,parent:this.parent()?this.parent().id:void 0,regexpFlags:this.regexpFlags};if(Object.keys(i).forEach((function(e){void 0===i[e]&&delete i[e]})),this.isNote()&&(i.text=i.text.replace(/\n/g,"<br>")),t){var a=this.elsNew.elements.reduce((function(e,t){var r=t.props.itemLink;return r&&e.push({id:r,text:t.getStyledText(n)}),e}),[]);a&&a.length>0&&(i.itemLinks=a)}return i}},{key:"highlight",value:function(){var e=this;this.highlightTimeout?(this.isHighlighted.set(!1),clearTimeout(this.highlightTimeout),this.highlightTimeout=void 0,setTimeout((function(){e.isHighlighted.set(!0)}),0)):this.isHighlighted.set(!0),this.highlightTimeout=setTimeout((function(){e.isHighlighted.set(!1)}),2e3)}},{key:"removeChild",value:function(e,t){try{_.Z.PAssert(1008,!this.isNote(),"Notes cannot use this function")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(1009,!e.isNote(),"Do not use remove child to remove notes from items")}catch(n){_.Z.reportError(n)}return this.items.remove(e)}},{key:"removeChildAtIndex",value:function(e,t){try{_.Z.PAssert(1010,!this.isNote(),"Notes cannot use this function")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(1011,!this.itemAtIndex(e).isArchived())}catch(n){_.Z.reportError(n)}this.items.removeAt(e)}},{key:"_moveChildrenHelper",value:function(e,t){var n=e.newParent,r=e.index,i=e.isArchived;try{_.Z.PAssert(1012,void 0!==n&&void 0!==i,"_moveChildrenHelper is missing parameters")}catch(u){_.Z.reportError(u)}var a=this.getItems();if(a.length>0){var o=0,s=n.getItems();!i&&(isNaN(r)||r<0)&&(r=s.length);for(var c=0;a.length>0;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l=a[0];try{_.Z.PAssert(1013,l!==n,"Should never be reparenting to a child")}catch(u){_.Z.reportError(u)}l.moveTo({parent:n,index:r+c,shouldBeArchived:i},t),c++}}}},{key:"moveChildren",value:function(e,t,n){try{_.Z.PAssert(1014,!this.isNote(),"Notes cannot use this function")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(1015,this.id!==e.id,"Do not use moveChildren to move a child to the same parent")}catch(r){_.Z.reportError(r)}e.parent()===this&&this.removeChild(e,n),_o.PaneUpdateBatcher.beginUpdateItems(),this._moveChildrenHelper({newParent:e,index:t,isArchived:!1},n),this._moveChildrenHelper({newParent:e,index:t,isArchived:!0},n),_o.PaneUpdateBatcher.commitUpdateItems()}},{key:"deleteSelf",value:function(e){!this.isDeleted()&&this.parent()&&this.parent().deleteChild(this,void 0,void 0,e)}},{key:"deleteChild",value:function(e,t,n,r,i){try{_.Z.PAssert(1016,e,"Must provide a valid child to delete")}catch(l){_.Z.reportError(l)}try{_.Z.PAssert(1017,!this.isNote(),"Notes cannot use this function")}catch(l){_.Z.reportError(l)}if(_o.PaneUpdateBatcher.beginUpdateItems(),e.isNote())this.setNote(void 0,r);else if(e.hasChildren())if(t)e.moveChildren(t,n,r);else for(var a=0,o=e.getItems(),s=o.length-1;s>=0;s--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e.deleteChild(o[s],void 0,void 0,r,!0)}e.hasNote()&&e.getNote().setDeleted(!0,r);if(e.setAttachments([],r),!e.isDeleted())if(e.isNote()||i||this.removeChild(e,r),this._documentOwner)this._documentOwner.deleteItem(e,r,i);else{var c=this.getItemStore();c&&c.destroyItem(e.id)}e.notifyItemPropertyChanged(r,"isDeleted"),e.setItemsLinked(void 0,!1),Je.Z.itemItemsChanged(this),_o.timeline.updateNotifications(e),_o.PaneUpdateBatcher.commitUpdateItems()}},{key:"unDelete",value:function(e){if(this._documentOwner.unDeleteItem(this,e),this.hasNote()){var t=this.getNote();t.isDeleted()&&this._documentOwner.unDeleteItem(t,e)}}},{key:"replaceChild",value:function(e,t,n){try{_.Z.PAssert(1018,!this.isNote(),"Notes cannot use this function")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(1019,!e.isNote(),"Old child should not be a note")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(1020,!t.isNote(),"New child should not be a note")}catch(i){_.Z.reportError(i)}var r=e.getIndex();this.items.removeAt(r),j.Z.deleteItem(this,e,n),t.moveTo({parent:this,index:r},n),e.moveChildren(t,t.numChildren(),n),t.parent().id!==this.id&&t.parent().items.remove(t)}},{key:"forEachChildRecursive",value:function(e,t,n){n&&e(this),t&&this.hasNote()&&e(this.getNote()),this.items.forEach((function(n){return n.forEachChildRecursive(e,t,!0)}))}},{key:"getChildren",value:function(){if(!this.isNote())return this.hasNote()?[this.getNote()].concat(this.getItems()):this.getItems()}},{key:"getChild",value:function(e){try{_.Z.PAssert(1021,!this.isNote(),"Notes cannot use this function")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(1022,e>=0,"Child index is out of range: ",e)}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(1023,e<this.numItems(),"Child index out of range: ",e,this.numItems())}catch(t){_.Z.reportError(t)}return this.itemAtIndex(e)}},{key:"getFirstChild",value:function(){try{_.Z.PAssert(1024,!this.isNote(),"Notes cannot use this function")}catch(e){_.Z.reportError(e)}return this.hasChildren()?this.itemAtIndex(0):void 0}},{key:"isFirstChild",value:function(){try{_.Z.PAssert(1025,!this.isNote(),"Notes cannot use this function")}catch(e){_.Z.reportError(e)}return!!this.parent()&&this.parent().getFirstChild()===this}},{key:"getLastChild",value:function(){try{_.Z.PAssert(1026,!this.isNote(),"Notes cannot use this function")}catch(e){_.Z.reportError(e)}return this.hasChildren()?this.itemAtIndex(this.numItems()-1):void 0}},{key:"isLastChild",value:function(){try{_.Z.PAssert(1027,!this.isNote(),"Notes cannot use this function")}catch(e){_.Z.reportError(e)}return!!this.parent()&&this.parent().getLastChild()===this}},{key:"isDescendantOf",value:function(e){for(var t=0,n=this.parent();n&&n!==e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n=n.parent()}return void 0!==n}},{key:"hasChild",value:function(e){return this.getIndexOf(e.id)>=0}},{key:"getChildIndex",value:function(e){try{_.Z.PAssert(1028,!this.isNote(),"Notes cannot use this function")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(1029,!e.isNote(),"Should not get the index of an item note")}catch(t){_.Z.reportError(t)}return this.getIndexOf(e.id)}},{key:"getIndexOf",value:function(e){try{_.Z.PAssert(1030,!this.isNote(),"Notes cannot use this function")}catch(a){_.Z.reportError(a)}try{_.Z.PAssert(1031,_.Z.isString(e),(function(){return"ID must be a valid string: "+_.Z.getObjectInfo(e)}))}catch(a){_.Z.reportError(a)}var t=-1,n=this.getItems();if(n)for(var r=0,i=0;i<n.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(n[i].id===e){t=i;break}}return t}},{key:"getIndex",value:function(){try{_.Z.PAssert(1032,!this.isNote(),"Should never be getting a child index of a note")}catch(e){_.Z.reportError(e)}return this.parent().getChildIndex(this)}},{key:"indexInItemFromStringIndex",value:function(e){var t={index:e},n=this.items.get(),r=n.findIndex((function(e){return tt.Z.compareItemIndex(e,t)>0}));return r>=0?r:n.length}},{key:"hasChildren",value:function(){return!this.isNote()&&this.numItems()>0}},{key:"numChildren",value:function(){try{_.Z.PAssert(1033,!this.isNote(),"Notes cannot use this function")}catch(e){_.Z.reportError(e)}return this.numItems()}},{key:"canZoom",value:function(){return!this.isNote()&&(this.numChildren()>0||this.getParsedText().length>0)}},{key:"parents",value:function(e){for(var t=0,n=[],r=this.parent();r&&r!==e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n.splice(0,0,r),r=r.parent()}return n}},{key:"getSiblings",value:function(e){try{_.Z.PAssert(1034,!this.isNote(),"Notes cannot use this function")}catch(o){_.Z.reportError(o)}e=e||0;var t=[];if(this.parent())for(var n=0,r=this.parent().getItems(),i=e,a=r.length;i<a;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r[i]!==this&&t.push(r[i])}return t}},{key:"nextSibling",value:function(){var e=this.getIndex();return this.parent().getItems()[e+1]}},{key:"isRootItem",value:function(){var e=this.getItemStore();return!!e&&e.isRoot(this)}},{key:"clone",value:function(e,t){var n=0;try{_.Z.PAssert(1035,!_.Z.isAutoChange(t),"Cloning should always be a user action")}catch(s){_.Z.reportError(s)}for(var r=e.getItemStore().createItemRaw({id:void 0,text:this.getRawText(),isComplete:this.isComplete(),date:this._date?this._date.clone():void 0,priority:this.getPriority(),isStarred:this.isStarred(),isNote:this.isNote()},{parent:e,documentOwner:e.getDocumentOwner()||this._documentOwner,changeType:t}),i=0;i<this.numItems();++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this.itemAtIndex(i).clone(r,t);r.insertItem(a)}if(this.hasNote()){var o=this.getNote().clone(r,t);r.setNote(o,t)}return r}},{key:"getItems",value:function(){return this.items.get()}},{key:"itemAtIndex",value:function(e){return this.items.get()[e]}},{key:"numItems",value:function(){return this.items.length()}},{key:"itemsHasMutated",value:function(){try{_.Z.PAssert(1036,!this._destroyed,"Item should not fire mutation events once destroyed: ",this.id)}catch(e){_.Z.reportError(e)}!this._destroyed&&this.isInitialized&&Je.Z.itemItemsChanged(this)}},{key:"numChildrenRecursive",value:function(e){var t=0,n={item:this,each:function(n){!e&&n.isNote()||t++}};return _.Z.searchVMLIs(n),t}},{key:"isOnDate",value:function(e){return!!this._date&&this._date.isOnDate(e)}},{key:"getCalendarColor",value:function(){var e,t=_o.pluginManager.getPluginGCalendar();if(this.isComplete())e="#ddd";else if(this.hasAttachmentType(w.Z.PluginType.Calendar)&&t.isEnabled()&&t.isAvailable()){var n=this.getAttachmentByType(w.Z.PluginType.Calendar);e=t.getCalendarBackgroundColor(n.getField("calendarID"))}else e="rgba(0, 153, 221, 0.85)";return e}},{key:"getCalendarDisplayProps",value:function(){var e,t=_o.pluginManager.getPluginGCalendar();if(this.hasAttachmentType(w.Z.PluginType.Calendar)&&t.isEnabled()&&t.isAvailable()){var n=this.getAttachmentByType(w.Z.PluginType.Calendar);e=t.getCalendarDisplayProps(n.getField("calendarID"))}return e}},{key:"allowTextEditing",value:function(){return!0}},{key:"getPreviousItem",value:function(){var e=this.parent(),t=e.getChildIndex(this);if(t>0)return e.getChild(t-1)}},{key:"isRepeatDate",value:function(){var e;return null===(e=this._date)||void 0===e?void 0:e.isRepeatDate()}},{key:"isCalendarSynced",value:function(){var e;return null===(e=this._date)||void 0===e?void 0:e.getGCalId()}},{key:"getDocumentOwner",value:function(){return this._documentOwner}},{key:"setDocumentOwner",value:function(e){this._documentOwner=e}},{key:"onAttachInlineUpdate",value:function(){this.setTextToWhatItAlreadyIs(w.Z.ChangeType.Local)}},{key:"setDateModified",value:function(e){this.dateModified=e,Je.Z.itemModifiedChanged(this)}},{key:"getDisplayText",value:function(e){var t;return(null===(t=this.elsNew)||void 0===t?void 0:t.getDisplayText(this,e))||""}},{key:"getHTML",value:function(e,t){return this.elsNew.getHTML(this,e,t)}},{key:"getPlaintext",value:function(e,t){return this.elsNew.getPlaintext(this,e,t)}},{key:"hasItemLinks",value:function(){return this.itemsLinked.length()>0}},{key:"isLinkedOrLinking",value:function(){return this.itemsLinkedTo.length()>0||this.itemsLinked.length()>0}},{key:"numItemsLinking",value:function(){return Math.max(this.itemsLinkedTo.length(),Math.max.apply(Math,Xe()(this.itemsLinked.map((function(e){return e.itemsLinkedTo.length()})))))+1}},{key:"getItemsLinked",value:function(){return _.Z.arrayUniques2((this._mirroredItem?[this._mirroredItem]:[]).concat(this.itemsLinked.get().flatMap((function(e){return[e].concat(e.itemsLinkedTo.get())}))).concat(this).concat(this.itemsLinkedTo.get()))}},{key:"addLinkedTo",value:function(e){this.itemsLinkedTo.pushIfUnique(e),Je.Z.itemLinkedToChanged(this)}},{key:"removeLinkedTo",value:function(e){this.itemsLinkedTo.remove(e),Je.Z.itemLinkedToChanged(this)}},{key:"setItemsLinked",value:function(e,t){var n=this,r=this.itemsLinked.get();r.forEach((function(t){e&&e.includes(t.id)||t.removeLinkedTo(n)})),e?j.Z.isLoadedLocal.onValue(!0,a()(k().mark((function i(){var a,o,s,c;return k().wrap((function(i){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(i.prev=i.next){case 0:if(a=!1,o=function(e){var t=r.find((function(t){return t.id===e}));return t||(t=j.Z.getItem(e))||(a=!0),t&&!t.isDeleted()&&t.addLinkedTo(n),t},s=e.map(o),!a){i.next=9;break}return i.next=6,_.Z.timeoutPromise(0);case 6:return i.next=8,Promise.all(e.map(o));case 8:s=i.sent;case 9:c=s.filter((function(e){return!!e})),n.itemsLinked.set(c),n._mirroredItem=t?c[0]:void 0;case 12:case"end":return i.stop()}}}),i)})))):(this.itemsLinked.clear(),this._mirroredItem=void 0)}},{key:"getMirroredItem",value:function(){return this._mirroredItem}},{key:"getMirroredItemOrSelf",value:function(){return this._mirroredItem||this}},{key:"isMirrorOrMirrored",value:function(){return!!this.getMirroredItem()||this.isMirrored()}},{key:"isMirrored",value:function(){var e=this;return this.itemsLinkedTo.some((function(t){return t.getMirroredItem()===e}))}},{key:"getMirroringItems",value:function(){var e=this;return this.itemsLinkedTo.filter((function(t){return t.getMirroredItem()===e}))}},{key:"checkDeleteMirror",value:function(e,t){var n=this,r=this.getMirroredItem();if(r||this.itemsLinkedTo.length()>0){var i=r||this,a=i.itemsLinkedTo.get().slice(),o=this.isMirrorOrMirrored()?"mirror":"link";return{confirm:function(t){_o.menus.confirmComplex(e?"Some of the selected items are ".concat(o,"ed to other items. Do you want to delete these items, or all ").concat(o,"ed items?"):"This item is ".concat(o," with another item. Do you want to delete just this item or all ").concat(o," items?"),[{text:"THIS ITEM",primary:!0,hotkey:{text:"T",keyCode:w.Z.KeyCode.T},action:function(){t("this")}},{text:"ALL ITEMS",hotkey:{text:"A",keyCode:w.Z.KeyCode.A},action:function(){t("all")}},{text:"CANCEL",cancel:!0,hotkey:{text:"ESC",keyCode:w.Z.KeyCode.Escape},action:function(){return t(!1)}}])},action:function(e){var r=function(e){e.deleteSelf(w.Z.ChangeType.Local)};if("all"===e)a.forEach((function(e){return r(e)})),r(i);else if("this"===e){var o=function(e){n.moveTo({parent:e.parent(),index:e.getIndex()},w.Z.ChangeType.Local),r(e)};if(n.isMirrored()){var s,c={};if(a.forEach((function(e){var t=e.getDocumentOwner();c[t.id]={doc:t,item:e}})),c[n.getDocumentOwner().id]||1===Object.keys(c).length)o((null===(s=c[n.getDocumentOwner().id])||void 0===s?void 0:s.item)||Object.values(c)[0].item);else _o.menus.openContextMenu({componentName:"ReactContextMenuItemList",element:t,items:a,title:"Please select a new origin item for this mirror:",onSelect:function(e){o(e)}})}else r(n)}}}}}},{key:"onAddToDropBucket",value:function(){}},{key:"getLevelsDeepWithNoteExtra",value:function(){return this.levelsDeep.get()+(this.isNote()?1:0)}},{key:"checkMismatchedDocument",value:function(e,t){if(!this._store._isDestructible){var n=e.getDocumentOwner();n&&t.docId&&t.docId!==n.id&&(console.log("mismatched document",t.text,t.docId,n.text.get()),j.Z.isLoadedRemote.onValue(!0,(function(){j.Z.moveItemDocument(e,t.docId,w.Z.ChangeType.Local)})))}}}]),e}();ve.Z.extendClass(ut,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dt,t=function(e){p()(n,e);var t=ot(n);function n(){return s()(this,n),t.apply(this,arguments)}return l()(n,[{key:"_runAndGetSaveData",value:function(e,t){var n=this.shouldSave()&&this.getMetaTextSaveData();this.regexpFlags=void 0;var r,i=this.getRawText();if(this.setRawText(this.generateSaveText(e)),this.parseText(i,t),this.shouldSave()){var a=this.getMetaTextSaveData();for(var o in r={},a)n[o]!==a[o]&&(r[o]=a[o])}return r}},{key:"setText",value:function(e,t){var n=this.isPrefixCodeBlock()||e.startsWith(w.Z.Prefix.CodeBlock);try{_.Z.PAssert(1266,_.Z.isLocalChange(t)||!e||e.indexOf(w.Z.AttachChar)<0,"Should never be setting text with an attach char in it")}catch(o){_.Z.reportError(o)}try{_.Z.PAssert(1267,this.isNote()||n||!e||e.indexOf("\n")<0,"Non-notes should never have newlines")}catch(o){_.Z.reportError(o)}try{_.Z.PAssert(1268,!e||_.Z.isRemoteChange(t)||e.indexOf(w.Z.TextSpace)<0,"Should never insert text space into item when editing locally")}catch(o){_.Z.reportError(o)}t|=w.Z.ChangeType.Text;var r=e.match(w.Z.Regexp.InterlinkMirror);r&&(e=r[0]);var i=this.isPrefixHeader();!this.isNote()&&!n&&e&&e.indexOf("\n")>=0&&(e=e.replace(/\n/g," ")),Je.Z.beginBatch(this);var a=this._runAndGetSaveData(e,t);this.shouldSave()&&(a.text=this.generateSaveText(e),a.regexpFlags=this.regexpFlags,_.Z.isLocalChange(t)&&j.Z.saveItem(this,a,t,w.Z.SaveFlag.Text)),Je.Z.itemTextChanged(this),this.isPrefixHeader()!==i&&Je.Z.itemHeaderChanged(this),Je.Z.commitBatch(this)}},{key:"setTextFromEls",value:function(e){var t=this.elsNew.getRawText();this.setText(t,e)}},{key:"shouldShowParents",value:function(e,t){return t.type===w.Z.PaneMode.Task&&e.item&&!t.isViewFlatList()&&(t.isViewTag()||t.isViewAgenda()||t.isViewContact()||t.isViewPriority())&&!e.item.isNote()&&0===e.levelsDeepNew()&&e.item.getItemStore()===_o.itemStoreManager.getDefaultItemStore()&&e.item.parent()!==t.getItem()}},{key:"generateSaveText",value:function(e){return void 0!==e&&null!==e?this._generateUsableText(e,"getEmbedString"):null}},{key:"generateTitleText",value:function(e,t){var n=this.parent();return e&&!n?e.titleOfFirstItem():!n&&this.getDocumentOwner()?this.getDocumentOwner().text.get():(this.elsNew?this.elsNew.getDisplayText(this,{showMarkdown:!1,noPrefix:!0,noDates:t}):this.getParsedTextWithoutPrefix()).trim()}},{key:"_generateUsableText",value:function(e,t,n,r){var i=this;try{_.Z.PAssert(1269,this.hasAttachments()||e.indexOf(w.Z.AttachChar)<0,"Should either have attachments or no embedded attachment chars")}catch(c){_.Z.reportError(c)}var a=e;if(this.hasAttachments()&&e.indexOf(w.Z.AttachChar)>=0){var o=n||0,s=this.getNumAttachments();a=e.replace(new RegExp(w.Z.AttachChar,"g"),(function(){if(o<s){var e=i.getAttachment(o);return o++,!e.isLoaded()&&!e.hasInlineData()||r&&e.getPlugin().id===w.Z.PluginID.Date?"":e[t]()}try{_.Z.PAssert(1270,!1,"Unable to find valid attachment for AttachChar")}catch(c){_.Z.reportError(c)}return""}));try{_.Z.PAssert(1271,a.indexOf(w.Z.AttachChar)<0,"Should convert all attachments to their string form")}catch(c){_.Z.reportError(c)}}return a}},{key:"parseText",value:function(e,t,n){if(!this._isParsing){try{_.Z.PAssert(1272,!this.isDestroyed(),"Must not parse a destroyed VMLI")}catch(u){_.Z.reportError(u)}try{_.Z.PAssert(1273,_.Z.isValidChangeType(t),"Must specify a valid changetype")}catch(u){_.Z.reportError(u)}var r;this._isParsing=!0;try{var i,a;this.__TEMP_ParseCalled=!0,a=this.isNote()?(i=it.Z.parseNoteNew(this)).elsNew:(i=it.Z.runParseTextNew(this,n)).elsNew,this.isInitialized&&!rt.Z.isUndoing&&rt.Z.beginAction();var o=this.isPrefixNumList();r=this.styleText(i,e,t,a);var s=_o.settings.showMarkdown.get(),c=this.getDisplayText({showMarkdown:s,noPrefix:!0,noDates:!0});if(this.numChars=c.length,this.numWords=c.split(" ").filter((function(e){return!!e})).length,this.isInitialized){var l;if(this.itemChanged.notify(),this.isNote())null===(l=this.parent())||void 0===l||l.itemChanged.notify();this.isInitialized&&this.isPrefixNumList()!==o&&ue.Z.fireEvent("numListChanged",[]),rt.Z.isUndoing||rt.Z.endAction()}}catch(d){_.Z.reportError(d)}return this._isParsing=!1,r}}},{key:"styleText",value:function(e,t,n,r){try{_.Z.PAssert(1274,_.Z.isValidChangeType(n),"Must specify a valid changetype")}catch(b){_.Z.reportError(b)}var i=!1,a=[];if(e){this.prefix=e.prefix;var o=(!t.includes(w.Z.CharDate)||this.getRawText().includes(w.Z.CharDate))&&this.getMooDate();if(o&&""!==e.parsedText){var s=o.getGCalId();if(s){var c=o.getGCalCalendar();e.attachments||(e.attachments=[]);var l=e.attachments.indexOfWithProperty("p",w.Z.PluginID.GCalendar);l>=0&&e.attachments.splice(l,1),e.attachments.push({p:w.Z.PluginID.GCalendar,id:s,calendarID:c,hasInlineData:!0})}}if(e.attachments||this.hasAttachments()){for(var u=0,d=[],h=0;e.attachments&&h<e.attachments.length;++h){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var p=e.attachments[h];p.p===w.Z.PluginID.Date&&(p.id=this.id);var f=_o.pluginManager.getAttachment(p,p.hasInlineData);f&&(d.push(f),_.Z.isLocalChange(n)&&!f.getOldID()&&a.push(f))}i=!0,this.setAttachments(d,n,!1)}(e.itemLinks||this.itemsLinked.length()>0)&&this.setItemsLinked(e.itemLinks,e.isMirror),this.setParsedText(e.parsedText);try{_.Z.PAssert(1275,e.elsNew||_.Z.isFlagSet(n,w.Z.ChangeType.ItemLoad),"Must always return an els list")}catch(b){_.Z.reportError(b)}r&&this.setElsNew(r),(e.tags||this._activeTags)&&this.setTags(e.tags,n),(e.contacts||this._activeContacts)&&this.setContacts(e.contacts,n)&&(i=!0),this.regexpFlags=e.regexpFlags;var g=this.getRawText();!(t&&this.getMooDate()&&t.includes(w.Z.CharDate))||g&&g.includes(w.Z.CharDate)||this.setMooDate(void 0,n,!0)}if(this.isInitialized){if(a.length>0)for(var m=0,v=0;v<a.length;v++){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;a[v].notifyItemTextChanged(this,!1)}if(_.Z.isLocalChange(n)&&this.isNote()&&this.parent().hasAttachments())for(var y=0,k=this.parent().getAttachments(),Z=0;Z<k.length;++Z){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;k[Z].notifyItemNoteChanged(this)}i&&this.itemChanged.notify()}return!1}},{key:"getCalendarRawText",value:function(){return this.getRawText().replace(/^ +/g,"").replace(/ +$/g,"")}},{key:"getCalendarParsedText",value:function(){return this.getDisplayText({showMarkdown:!1,noPrefix:!0,noDates:!0}).trim()}},{key:"getUnstyledText",value:function(){var e=this;return this.elsNew.elements.map((function(t){return t.getStyledText(e)})).join("")}},{key:"getStyledTextAsOneLine",value:function(e,t,n){var r,i=this.getDocumentOwner();if(this.isRoot&&i)return i.text.get();t&&(r='<span class="numChildren c-foreground-super-faded">'+this.numItems()+"</span>");var a=this.elsNew.elements;return n&&(a=a.filter(this.overviewElsFilter)),_o.ElementRenderer.renderNew(a,this,void 0,{convertSpaces:!1,noPrefix:e,suffix:r,noFormat:n})}},{key:"overviewElsFilter",value:function(e){return!e.props.date&&!e.props.prefixType}},{key:"hasText",value:function(){var e=this.getParsedText();return(e=e.replace(/ /g,"")).length>0}},{key:"hasTextWithoutPrefix",value:function(){var e=this.getParsedTextWithoutPrefix();return(e=e.replace(/ /g,"")).length>0}},{key:"setPrefix",value:function(e){var t=this.getRawText(),n=this.getPrefix();n&&(t=t.substr(n.length)),this.prefix=e,t=(e?e+" ":"")+t,this.setText(t,w.Z.ChangeType.Local)}},{key:"getPrefix",value:function(){return this.prefix?this.prefix+" ":""}},{key:"getPrefixLength",value:function(){return this.prefix?this.prefix.length+1:0}},{key:"isPrefixHeader",value:function(e){var t;return e&&(t=e.search.getItemPrefix(this)),void 0===t&&(t=this.prefix),t&&(t[0]===w.Z.Prefix.Header||t[0]===w.Z.Prefix.Header2)}},{key:"isPrefixTask",value:function(){return this.prefix&&_.Z.isPrefixTask(this.prefix)}},{key:"isPrefixBullet",value:function(){return this.prefix&&this.prefix===w.Z.Prefix.Bullet||this.prefix===w.Z.Prefix.Bullet2}},{key:"isPrefixNumList",value:function(){return!!(this.prefix&&+this.prefix[0]>=0&&+this.prefix[0]<10)}},{key:"isPrefixHR",value:function(){return this.elsNew.elements.some((function(e){return e.props.hr}))}},{key:"isPrefixCodeBlock",value:function(){var e;return null===(e=this.prefix)||void 0===e?void 0:e.startsWith(w.Z.Prefix.CodeBlock)}},{key:"hasPrefix",value:function(){return!!this.prefix}},{key:"numListNumber",value:function(){if(this.isPrefixNumList()){for(var e=0,t=1,n=this.parent(),r=this.getIndex()-1;r>=0;--r,++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=n.getChild(r);if(!i||!i.isPrefixNumList())break}return t}}},{key:"shouldCopyPrefix",value:function(){return this.isPrefixTask()||this.isPrefixBullet()||this.isPrefixNumList()}},{key:"getParsedTextWithoutPrefix",value:function(){var e=this.getPrefix(),t=this.getParsedText();return e?t.substr(e.length):t}},{key:"applyFormatToSelection",value:function(e,t,n,r,i){n+=this.getPrefixLength(),r+=this.getPrefixLength(),"toggle"===i&&(i=this.elsNew.displayRangeHasFormat(e,t,n,r)?"no":"yes");var a,o="yes"===i||null;if(_o.settings.showMarkdown.get()&&r-n===0){var s=w.Z.Markdown[e];this.elsNew.insertEl(new at.Z(s+s),t,n),a=n+s.length}else this.elsNew.insert(n,r-n,ne()({},e,o),t);var c=this.elsNew.getRawText();return this.setText(c,w.Z.ChangeType.Local),void 0!==a&&B.Z.selectObject(t,a-this.getPrefixLength()),"yes"===i}},{key:"insertLinkAtSelection",value:function(){var e=B.Z.getStartIndex();if(B.Z.isValid()&&e===B.Z.getEndIndex()){var t,n,r=B.Z.getStartOffset(),i=B.Z.getStartOffsetWithPrefix(),a=B.Z.getEndOffsetWithPrefix(),o=B.Z.getEndTotal(),s=B.Z.getStartObject(),c=s.getDisplayText();if(i!==a)t=c.substr(i,a-i);else if(c.length>0&&r>=0&&r<=o){var l=s.item.elsNew.elementAtOffset(s,r),u=l&&l.props.link;u&&(n=u.href,t=u.text)}_o.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:B.Z.getEndElement(),onInsertLink:this.onInsertLink,text:t,href:n})}}},{key:"onInsertLink",value:function(e,t){var n=e.text,r=e.href,i=e.isUpdate;if(B.Z.isValid()&&B.Z.getStartIndex()===B.Z.getEndIndex()){t&&!n&&(n=r);var a=B.Z.getStartOffset(),o=B.Z.getStartOffsetWithPrefix(),s=B.Z.getEndOffsetWithPrefix(),c=B.Z.getStartObject(),l=c.getDisplayText().substr(o,s-o),u=s+n.length-l.length,d=r&&_.Z.isUrlImage(r);if(i){var h=c.item.elsNew.elementAtOffset(c,a);if(h&&h.props.link)if(r){h.props.link.text=n,h.props.link.href=r;var p=c.item.elsNew.findElement(c,(function(e){return e===h}));p&&(u=p.offset+p.length)}else delete h.props.link,h.setText(n,c.showMarkdown())}else s!==o?this.elsNew.insert(o,s-o,{link:{text:n,href:r}},c):this.elsNew.insertEl(new at.Z(n,{link:{href:r,text:n,showImage:t,isImage:d}}),c,o);this.setTextFromEls(w.Z.ChangeType.Local),B.Z.selectObject(c,u-c.item.getPrefixLength())}}},{key:"getTextLength",value:function(){return this.getParsedText().length}},{key:"getNotePreviewMultiline",value:function(){var e=this.getParsedText();if(e){e=e.substr(0,Math.min(e.length,4e3));var t=0,n=e.split(/<\/?(?:div|p|br|li)[^>]*>\s*/im).map((function(e){if(!(t>280)){var n=document.createElement("div");n.innerHTML=e;var r=n.textContent||n.innerText;return t+r.length>280&&(r=r.slice(0,280-t)+"..."),t+=r.length,r}})).filter((function(e){return!!e}));return n.length>4&&((n=n.slice(0,4))[3]+="..."),n}}},{key:"getNotePreviewText",value:function(){var e=A.Z.noteLineClamp.get(),t=this._notePreviewText;if((null===t||void 0===t?void 0:t.numLines)===e)return t;var n=this.getParsedText(),r=[],i=!1;if(n){var a=n.substr(0,Math.min(n.length,5e3));a.length<n.length&&(i=!0);var o=a.match(/[^\r\n]+/);if(o)for(var s=0,c=(a=o[0]).split(/<\/?(?:div|p|br|li)[^>]*>\s*/im),l=0;l<c.length;l++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(r.length>e){i=!0;break}var u=c[l];if(u){var d=document.createElement("div");d.innerHTML=u;var h=d.textContent||d.innerText;if(h){var p=h.substr(0,Math.min(h.length,200));p.length<h.length&&(i=!0),r.push(p)}}}}return this._notePreviewText={lines:r,numLines:e,hasMore:i},{lines:r,hasMore:i}}},{key:"setTextToWhatItAlreadyIs",value:function(e){var t=this.getParsedText();this.setText(t,e)}},{key:"getPrefixForExport",value:function(){var e=this.prefix;return this.isPrefixNumList()?e=this.numListNumber()+".":this.isPrefixTask()&&(e=this.isComplete()?"[x]":"[ ]"),e?e+" ":""}}]),n}(e);return t}(ut),!0),ve.Z.extendClass(ut,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dt,t=function(e){p()(n,e);var t=Qe(n);function n(){return s()(this,n),t.apply(this,arguments)}return l()(n,[{key:"dragStart",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=e.pane||_.Z.focusedPane;try{_.Z.PAssert(1297,r.isItemDraggable(),"Pane must be draggable in order to start a drag")}catch(g){_.Z.reportError(g)}try{_.Z.PAssert(1298,_o.DragDrop.startDragItem,"Should always have a valid item to start dragging from")}catch(g){_.Z.reportError(g)}var i=_.Z.getElementParent(e.startSrc||e.target);try{_.Z.PAssert(1299,i,"Must have a valid target node")}catch(g){_.Z.reportError(g)}if(i){_o.DragDrop.startDragItem=void 0,_o.DragDrop.dragItem=this;var a,o,s,c=_.Z.getPaneObjectForElement(i);if(r.isViewCalendar()||n||_.Z.findParent(i,"itemNotInPane"))a=[{item:this,pane:r}],o=[this];else{s=c.block;var l=B.Z.getSelectedObjects();0!==l.length&&l.find((function(e){return e.id===c.id}))?(a=[],o=[],l.forEach((function(e){a.includes(e)||(o.push(e.getMirrorOrItem()),a=a.concat(e).concat(r.getChildrenOfPaneObject(e)))}))):(a=[c].concat(r.getChildrenOfPaneObject(c)),o=[c.getMirrorOrItem()])}var u=_.Z.offset(i),d=u.left,h=u.top;_o.PaneManager.runForEachPane((function(e){e.addScrollListener(t.dragScroll)}));var p={x:e.clientX,y:e.clientY,items:a},f={dropEffect:r.dropEffect(this),itemsDragging:o,element:i,block:s,pane:r};_o.DragDrop.start(this,a,d,h,r,p,f,n),_.Z.disableMouseMove=!0}}},{key:"dragMove",value:function(e){try{_.Z.PAssert(1300,_o.DragDrop.startInfo,"Must have started a drag to be valid")}catch(i){_.Z.reportError(i)}if(_o.DragDrop.startInfo){"touchmove"===e.type&&(e.returnValue=!1,e.returnFalse=!0,_.Z.preventAndStop(e));var t=e.clientX-_o.DragDrop.startInfo.x,n=e.clientY-_o.DragDrop.startInfo.y,r=_.Z.elementFromPoint(e.clientX,e.clientY);_o.DragDrop.setTransform(t,n),r&&_o.DragDrop.handleDragOver({item:this,dataTransfer:_o.DragDrop.dataTransfer,clientX:e.clientX,clientY:e.clientY})}}},{key:"dragScroll",value:function(){var e=this;!_o.DragDrop.isDragging||isNaN(B.Z.mousePos.x)||isNaN(B.Z.mousePos.y)||_.Z.animationFrameOnce("DragOnScroll",(function(){var t={clientX:B.Z.mousePos.x,clientY:B.Z.mousePos.y,preventDefault:_.Z.emptyFn,stopPropagation:_.Z.emptyFn,diffY:0};e.dragMove(t)}))}},{key:"dragEnd",value:function(e){var t=this;_.Z.disableMouseMove=!1,_o.DragDrop.stop(),e&&(_.Z.findParent(e.target,"paneContent")||_.Z.findParent(e.target,"paneOverviewScroller"))&&_o.DragDrop.handleDrop({target:e.target,dataTransfer:_o.DragDrop.dataTransfer,fromDropBucket:e.fromDropBucket,ctrlKey:e.ctrlKey,altKey:e.altKey,metaKey:e.metaKey,shiftKey:e.shiftKey}),_o.DragDrop.finish(),_o.PaneManager.runForEachPane((function(e){e.removeScrollListener(t.dragScroll)})),_.Z.disableMouseMove=!1}},{key:"checkDragOnStart",value:function(e,t){var n=this;_o.DragDrop.escapedDragging=!1,_o.DragDrop.startDragItem=this,B.Z.addMouseHandler({move:function(e){n.checkDragOnMove(e,t)},up:function(e){n.checkDragOnEnd(e)}})}},{key:"checkDragOnMove",value:function(e,t){if(_o.DragDrop.startDragItem&&!_o.DragDrop.escapedDragging&&(!D.Z.touch||_.Z.distance(e.distanceX,e.distanceY)>_.Z.ClickThreshold)){var n=e.pane||_.Z.focusedPane;_o.DragDrop.startDragItem===this&&this.isDraggable()&&n.isItemDraggable(this)&&this.dragStart(e,t)}_o.DragDrop.isDragging&&(this.dragMove(e),_.Z.preventAndStop(e))}},{key:"checkDragOnEnd",value:function(e){_o.DragDrop.startDragItem=void 0,_o.DragDrop.isDragging&&this.dragEnd(e)}}]),n}(e);return t}(ut),!0),ve.Z.extendClass(ut,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:dt,t=function(e){p()(n,e);var t=nt(n);function n(){return s()(this,n),t.apply(this,arguments)}return l()(n,[{key:"onChangeRemote",value:function(e,t){var n,r=this,i=!1,a=this.getRawText();return Object.keys(e).map((function(a){var o=e[a];switch(a){case"text":r.onChangeRemoteText(o,t);break;case"parent":i||r.parent()&&r.parent().id===o&&(r.parent().hasChild(r)||r.isNote())||(r.onChangeRemoteParentOrIndex(e),i=!0);break;case"index":i||r.index===o||(r.onChangeRemoteParentOrIndex(e),i=!0);break;case"priority":r.setPriority(o||0,t);break;case"isComplete":r.setComplete(o||!1,t);break;case"isStarred":r.setStarred(o||!1,t);break;case"dateCompleted":r.dateCompleted=o?new Date(o):null,n=!0;break;case"date":r.setMooDate($e.Z.fromData(o),t,!0),n=!0;break;case"note":o?r.addRemoteNote(o,t):r.hasNote()&&r.removeRemoteNote(t);break;case"dateModified":r.setDateModified(new Date(o));break;case"flags":var s=_.Z.isFlagSet(o,w.Z.VMLIFlag.Complete);r.isComplete()!==s?r.setComplete(s,t):r.setFlags(o),Je.Z.itemSearchChanged(r);break;case"isArchived":o!==r.isArchived()&&(o?r.archiveSelf(t):(r.unArchive(t),n=!0));break;case"isDeleted":o===r.isDeleted()||e.docId&&e.docId!==r.getDocumentOwner().id||(o?r.deleteSelf(t):(r.unDelete(t),n=!0));break;case"id":case"items":case"dateCreated":case"pendingSync":case"regexpFlags":case"docId":break;default:0}})),n&&(this.parseText(a,t),setTimeout((function(){r.parseText(a,t)}),0)),n}},{key:"onChangeRemoteText",value:function(e,t){this.setText(e,t)}},{key:"onChangeRemoteParentOrIndex",value:function(e){var t=this.parent(),n=e.parent?j.Z.getItem(e.parent):t;try{_.Z.PAssert(1276,n,"Must have a new parent")}catch(s){_.Z.reportError(s)}if(n){if(_o.PaneUpdateBatcher.beginUpdateItems(),32===(32&e.flags)||this.isNote())this.setParent(n),n.hasNote()&&n.getNote()===this||this.isDeleted()||n.setNote(this,w.Z.ChangeType.Remote);else{if(void 0===e.index){var r=j.Z.getItemDataLocal(this.getDocumentOwner(),e.id);r&&(e.index=r.index)}try{_.Z.PAssert(1277,void 0!==e.index,"Index is undefined")}catch(s){_.Z.reportError(s)}if(void 0!==e.index&&(this.index=e.index),!0!==e.isDeleted&&!this.isDeleted()&&!0!==e.isArchived&&!this.isArchived())if(t===n&&n.hasChild(this))n.items.sort(tt.Z.compareItemIndex);else{var i=n.getDocumentOwner();i!==this.getDocumentOwner()&&this.forEachChildRecursive((function(e){return e.setDocumentOwner(i)}),!0,!0),this.setParent(n);var a=void 0!==e.index?e.index:this.index,o=n.indexInItemFromStringIndex(a);n.items.splice(o,0,this),t&&t!==n&&t.items.remove(this)}}Je.Z.itemSearchChanged(this),_o.PaneUpdateBatcher.commitUpdateItems()}}},{key:"addRemoteNote",value:function(e,t){}},{key:"removeRemoteNote",value:function(e){}}]),n}(e);return t}(ut),!0);const dt=ut;var ht;const pt=(ht=function(){function e(t,n,r,i,a,o,c,l){s()(this,e),this.id=t,this.numItems=0,this._readonly=!!n,this._isDestructible=!!r,this._enabledFilters=c,this._trackGlobally=!!i,this._requireStoredEls=!!a,this._owner=l,this._root=void 0,this._linkedData={},this._data={},this._destroyed=!1}return l()(e,[{key:"areFiltersEnabled",value:function(e){return _.Z.isAtLeastOneFlagSet(this._enabledFilters,e)}},{key:"getEnabledFilters",value:function(){return this._enabledFilters}},{key:"destroy",value:function(){try{_.Z.PAssert(507,this._isDestructible,"Item store must be destructible to destroy")}catch(e){_.Z.reportError(e)}this._destroyed=!0,this.clearStore(),this._root.destroy(),this._root=void 0,this._owner=void 0}},{key:"checkDestroyed",value:function(){try{_.Z.PAssert(508,!this._destroyed,"Should not be using a destroyed item store")}catch(e){_.Z.reportError(e)}}},{key:"trackGlobally",value:function(){return this._trackGlobally}},{key:"requireStoredEls",value:function(){return this._requireStoredEls}},{key:"clearStore",value:function(){if(this._isDestructible){for(var e in _o.PaneUpdateBatcher.beginUpdateItems(),this._data)this._root&&e===this._root.id||this._data[e].destroy();_o.PaneUpdateBatcher.commitUpdateItems()}this._data={},this._linkedData={},this._root&&(this._root.items.set([]),this._data[this._root.id]=this._root)}},{key:"createRoot",value:function(e,t){return this.checkDestroyed(),this._root=this.createItem(e,t,void 0,{isRoot:!0},w.Z.ChangeType.None),this._root}},{key:"createItem",value:function(e,t,n,r,i,a){try{_.Z.PAssert(509,n||r&&r.isRoot,"Must always specify a valid parentID when creating a new item")}catch(u){_.Z.reportError(u)}this.checkDestroyed();try{_.Z.PAssert(510,!this._data[e],"Should never double-create for the same item, should use update instead")}catch(u){_.Z.reportError(u)}var o;if(void 0===i&&(i=w.Z.ChangeType.None),n){o=this._data[n];try{_.Z.PAssert(511,o,"Parent must be valid if defined")}catch(u){_.Z.reportError(u)}}var s={id:e,text:t};if(r)for(var c in r)r.hasOwnProperty(c)&&(s[c]=r[c]);var l=new dt(s,{store:this,parent:o,changeType:i,canDestroy:this._isDestructible,noSave:this._readonly,documentOwner:a});return this.numItems++,this._data[l.id]=l,l}},{key:"createItemRaw",value:function(e,t){try{_.Z.PAssert(512,t.parent||t&&(t.isRoot||t.noSave||t.noParentOkay),"Must always specify a valid parentID when creating a new item")}catch(r){_.Z.reportError(r)}this.checkDestroyed();try{_.Z.PAssert(513,!!t.canDestroy===this._isDestructible,"When creating raw items, canDestroy must match")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(514,!!t.noSave===this._readonly,"When creating raw items, noSave must match")}catch(r){_.Z.reportError(r)}t.store=this;var n=new dt(e,t);return this._data[n.id]=n,this.numItems++,n}},{key:"destroyItem",value:function(e){try{_.Z.PAssert(516,this._isDestructible,"ItemStore must be destructible to destroy items")}catch(n){_.Z.reportError(n)}var t=this._data[e];try{_.Z.PAssert(517,t,"Must always destroy a valid item")}catch(n){_.Z.reportError(n)}if(t){try{_.Z.PAssert(518,!t.isDestroyed(),"Should never destroy an item twice")}catch(n){_.Z.reportError(n)}t.parent()&&(!t.isNote()&&t.parent().getChildIndex(t)>=0&&t.parent().removeChild(t,w.Z.ChangeType.Local),t.setParent(void 0)),t.destroy()}delete this._linkedData[e],delete this._data[e]}},{key:"removeItemFromStore",value:function(e){this._data[e].destroy(!0),delete this._data[e]}},{key:"modifyItemID",value:function(e,t){try{_.Z.PAssert(519,e.belongsToItemStore(this),"Item must belong to this item store")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(520,e.id!==t,"Must actually be modifying the item ID")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(521,this._data[e.id],"Must have a valid item stored under the current ID: "+e.id+" - "+t+" - "+e.isDestroyed())}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(522,!this._data[t],"Must not be overwriting an existing item"+e.id+" - "+t+" - "+e.isDestroyed())}catch(n){_.Z.reportError(n)}delete this._data[e.id],this._data[t]=e}},{key:"manualModifyItemID",value:function(e,t){try{_.Z.PAssert(523,!this._data[t],"Must not be overwriting an existing item"+e+" - "+t)}catch(r){_.Z.reportError(r)}var n=this._data[e];try{_.Z.PAssert(524,n,"Must have valid item to change its ID")}catch(r){_.Z.reportError(r)}n&&(delete this._data[e],this._data[t]=n)}},{key:"addItemToRoot",value:function(e){this._root.items.push(e)}},{key:"removeItemFromRoot",value:function(e){this._root.items.remove(e)}},{key:"getItem",value:function(e){return this.checkDestroyed(),this._data[e]}},{key:"hasItem",value:function(e){return this.checkDestroyed(),!!this._data[e]}},{key:"getRoot",value:function(){return this.checkDestroyed(),this._root}},{key:"isRoot",value:function(e){return this.checkDestroyed(),this._root===e}},{key:"getCount",value:function(){return this.checkDestroyed(),Object.keys(this._data).length}},{key:"forEach",value:function(e){this.checkDestroyed(),Object.values(this._data).forEach(e)}},{key:"forEachLinkedItem",value:function(e){this.checkDestroyed(),Object.entries(this._linkedData).forEach((function(t){var n=W()(t,2),r=n[0],i=n[1];return e(i,r)}))}},{key:"_markPaneDirty",value:function(e){e.usesItemStore(this)&&e!==_.Z.focusedPane&&e.setItemsDirty()}},{key:"updateItems",value:function(e){var t=this;e&&!e.belongsToItemStore(this)||(_o.PaneManager.runForEachPane((function(n){n.usesItemStore(t,e)&&(n.preventUpdateItemsForObject&&n.preventUpdateItemsForObject.item===e||n.setItemsDirty())})),_o.PaneUpdateBatcher.updateAllItems())}},{key:"onItemChanged",value:function(e,t){var n,r=this;e&&!e.belongsToItemStore(this)||(_o.PaneManager.runForEachPane((function(i){var a;if(t.Date&&null!==e&&void 0!==e&&null!==(a=e.getMooDate())&&void 0!==a&&a.getGCalId()||i.usesItemStore(r,e)||i.isItemInPane(e)){var o=i.handleItemChanged(e,t),s=e.itemsLinkedTo.get();s&&s.forEach((function(e){e&&(e.itemChanged.notify(),i.handleItemChanged(e,t))})),n=n||o}})),_o.PaneUpdateBatcher.updateAllItemHeights()),n&&_o.PaneUpdateBatcher.updateAllItems()}},{key:"getLinkedItem",value:function(e){return this._linkedData[e]}},{key:"setLinkedItem",value:function(e,t){this._linkedData[e]=t}}]),e}(),P()(ht.prototype,"_markPaneDirty",[S.ZP],Object.getOwnPropertyDescriptor(ht.prototype,"_markPaneDirty"),ht.prototype),P()(ht.prototype,"updateItems",[S.ZP],Object.getOwnPropertyDescriptor(ht.prototype,"updateItems"),ht.prototype),ht);function ft(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}var gt="DefaultStore";const mt=function(e){p()(n,e);var t=ft(n);function n(){var e;return s()(this,n),(e=t.call(this))._itemStores={},e._iteratingStores=!1,e.Events={StoreAdded:"StoreAdded",StoreRemoved:"StoreRemoved"},e}return l()(n,[{key:"init",value:function(){var e=w.Z.ItemStoreFilter.Dates|w.Z.ItemStoreFilter.Priority;this.registerItemStore(gt,void 0,{isReadonly:!1,isDestructible:!1,listenToItemStateChanged:!0,enabledFilters:e}).createRoot("Item store root","Item store root"),this._tempItemStore=this.registerItemStore("TempStore",void 0,{isReadonly:!0,isDestructible:!0,trackGlobally:!1,noRegister:!0})}},{key:"registerItemStore",value:function(e,t,n){try{_.Z.PAssert(347,!this._itemStores[e],"Should only register a single item store per plugin: ",e)}catch(u){_.Z.reportError(u)}try{_.Z.PAssert(348,!this._iteratingStores,"Should never add a store while iterating")}catch(u){_.Z.reportError(u)}var r=!0,i=!0,a=!0,o=!0,s=!1,c=w.Z.ItemStoreFilter.None;it.Z.runParseTextNew;n&&(void 0!==n.isReadonly&&(r=n.isReadonly),void 0!==n.isDestructible&&(i=n.isDestructible),void 0!==n.enabledFilters&&(c=n.enabledFilters),void 0!==n.parserFn&&n.parserFn,void 0!==n.trackGlobally&&(a=n.trackGlobally),void 0!==n.requireStoredEls&&(o=n.requireStoredEls),void 0!==n.listenToItemStateChanged&&(s=n.listenToItemStateChanged));var l=new pt(e,r,i,a,o,s,c,t);return n&&n.noRegister||(this._itemStores[e]=l,this.fireEvent(this.Events.StoreAdded,l.getEnabledFilters(),[l])),l}},{key:"unregisterItemStore",value:function(e){try{_.Z.PAssert(349,this._itemStores[e],"Must register an item store before destroying it")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(350,!this._iteratingStores,"Should never remove a store while iterating")}catch(n){_.Z.reportError(n)}var t=this._itemStores[e];delete this._itemStores[e],t.destroy(),this.fireEvent(this.Events.StoreRemoved,t.getEnabledFilters(),[t])}},{key:"getItemStore",value:function(e){try{_.Z.PAssert(351,this._itemStores[e],"Must register an item store before using it")}catch(t){_.Z.reportError(t)}return this._itemStores[e]}},{key:"getDefaultItemStore",value:function(){return this._itemStores.DefaultStore}},{key:"getTempItemStore",value:function(){return this._tempItemStore}},{key:"runForEachStore",value:function(e,t){t=t||w.Z.ItemStoreFilter.None,this._iteratingStores=!0,Object.values(this._itemStores).forEach((function(n){if(t===w.Z.ItemStoreFilter.None||n.areFiltersEnabled(t))try{e(n)}catch(r){_.Z.reportError(r)}})),this._iteratingStores=!1}}]),n}(E.Z);var vt,yt=n(8047);const kt=(vt=function(){function e(){s()(this,e),this._numTimesItemsUpdated=0,this._itemsUpdateTimeout=void 0,this._queuedPaneUpdates={},this.itemFlushStacks=[],this.EnableItemFlushStacks=!0,this._isUpdating=!1,this._numFlushesInCommit=0,this._isWaitingUpdateItems=0,this._itemsDirty=!1,this._itemHeightsDirty=!1,this._forceNotify=!1,this._updateSearch=!1,this._itemsUpdateWatchdog=void 0,this._lastUpdateItemsStack=void 0}return l()(e,[{key:"checkItemsUpdated",value:function(){0}},{key:"notifyItemsUpdated",value:function(e,t){this._numTimesItemsUpdated++,this.EnableItemFlushStacks&&this.itemFlushStacks.push({stack:_.Z.getCurrentStack("Update Items Stack"),panes:e,forceNotify:t}),this._itemsUpdateTimeout||(this._itemsUpdateTimeout=setTimeout(this.checkItemsUpdated,0))}},{key:"_updateAllItems",value:function(){var e=this._forceNotify;this._forceNotify=!1;var t=this._updateSearch;(this._updateSearch=!1,this._itemsDirty||e)&&(this._itemsDirty=!1,this._isUpdating=!0,yt.Z.beginBatch(),_o.PaneManager.runForEachPane((function(n){(e||n.isItemsDirty())&&n.updateItemsImmediate(t,e)})),yt.Z.endBatch(),this._isUpdating=!1)}},{key:"queuePaneUpdate",value:function(e,t,n){var r=this._queuedPaneUpdates[e.id];r||(r=this._queuedPaneUpdates[e.id]={}),r.forceNotify=r.forceNotify||n,r.updateSearch=r.updateSearch||t}},{key:"flushQueuedUpdates",value:function(e){var t=this._queuedPaneUpdates[e.id];t&&(e.updateItemsImmediate(t.updateSearch,t.forceNotify),delete this._queuedPaneUpdates[e.id])}},{key:"updateWatchdog",value:function(){_.Z.log("Last Update Items Stack: "+this._lastUpdateItemsStack);try{_.Z.PAssert(353,!1,"Update Watchdog Triggered - This should never happen.",this._isWaitingUpdateItems)}catch(e){_.Z.reportError(e)}this._isWaitingUpdateItems=1,this.commitUpdateItems()}},{key:"isUpdatingItems",value:function(){return this._isWaitingUpdateItems>0&&this._itemsDirty}},{key:"beginUpdateItems",value:function(){this._isWaitingUpdateItems++,yt.Z.beginBatch(),1===this._isWaitingUpdateItems&&(this._lastUpdateItemsStack=_.Z.getCurrentStack("Update Items Stack"),this._itemsUpdateWatchdog=setTimeout(this.updateWatchdog,0))}},{key:"commitUpdateItems",value:function(e,t){try{_.Z.PAssert(356,this._isWaitingUpdateItems>0,"Missing a call to beginUpdateItems: ",this._isWaitingUpdateItems)}catch(n){_.Z.reportError(n)}this._isWaitingUpdateItems--,this._isWaitingUpdateItems<=0&&(clearTimeout(this._itemsUpdateWatchdog),this._itemsUpdateWatchdog=void 0,this._lastUpdateItemsStack=void 0,this._isWaitingUpdateItems=0,this._numFlushesInCommit=0,!this._itemsDirty&&this._itemHeightsDirty&&this._updateAllItemHeights(),this._itemHeightsDirty=!1),this._itemsDirty&&this.updateAllItems(e,t),yt.Z.endBatch()}},{key:"flushItemsUpdate",value:function(e){return!!this.isUpdatingItems()&&(e?e.isItemsDirty()&&(this._itemsDirty||this._forceNotify)&&(this._numFlushesInCommit++,e.updateItemsImmediate(this._updateSearch,this._forceNotify)):(this._numFlushesInCommit++,this._updateAllItems()),!0)}},{key:"updateAllItems",value:function(e,t){try{_.Z.PAssert(357,void 0===e||_.Z.isBoolean(e),"Must supply a bool param for updateSearch")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(358,void 0===t||_.Z.isBoolean(t),"Must supply a bool param for forceNotify")}catch(n){_.Z.reportError(n)}this._itemsDirty=!0,t&&(this._forceNotify=t),e&&(this._updateSearch=e),0===this._isWaitingUpdateItems&&this._updateAllItems()}},{key:"_updateAllItemHeights",value:function(){_o.PaneManager.runForEachPane((function(e){e.itemsHeightDirty&&e.updateItemHeights()}))}},{key:"updateAllItemHeights",value:function(){0===this._isWaitingUpdateItems?this._updateAllItemHeights():this._itemHeightsDirty=!0}}]),e}(),P()(vt.prototype,"checkItemsUpdated",[S.ZP],Object.getOwnPropertyDescriptor(vt.prototype,"checkItemsUpdated"),vt.prototype),P()(vt.prototype,"updateWatchdog",[S.ZP],Object.getOwnPropertyDescriptor(vt.prototype,"updateWatchdog"),vt.prototype),vt);var _t,Zt=n(9515),wt="Suspend",bt="Resume",Pt="AsyncSkip",St="SyncSkip",Dt="Run",It="AsyncBegin",Et="AsyncComplete",xt="AsyncAbort",Ct="AsyncTimeout";const At=(_t=function(){function e(t,n){s()(this,e);try{_.Z.PAssert(495,n,"Must provide a valid set of task options: "+t)}catch(r){_.Z.reportError(r)}this._id=t,this._iterationID=void 0,this._isAsync=n.async,this._isAsyncRunning=!1;try{_.Z.PAssert(497,n.task&&_.Z.isFunction(n.task),"Must provide a valid task function")}catch(r){_.Z.reportError(r)}this._task=n.task,this._delay=n.delay;try{_.Z.PAssert(498,void 0===n.asyncTimeout||n.async,"Should never specify an async timeout for a non-async task")}catch(r){_.Z.reportError(r)}this._asyncTimeout=n.asyncTimeout||0,this._pauseWhileIdle=n.pauseWhileIdle||!1,this._minDelayOnResume=n.minDelayOnResume||!1;try{_.Z.PAssert(499,this._pauseWhileIdle||!this._minDelayOnResume,"Must use pauseWhileIdle to support minDelayOnResume")}catch(r){_.Z.reportError(r)}this._suspended=!1,this._remainingTime=0,this._lastUpdate=n.runOnCreate?0:Date.now(),this._asyncStartTime=-1,this._numUpdatesRun=0,this._numUpdatesSkipped=0,this._numUpdatesAsyncSkipped=0,this._numAsyncAborts=0,this._numAsyncTimeouts=0,this._minDelay=n.minDelay||0,this._lastSetDelay=this._delay,this._runningTimeout=void 0,this._asyncAbortTimeout=void 0,this._updateIsRunning=!1,this._isCancelled=!1,this._updateTimes=new Zt.Z(10),this._actions=new Zt.Z(20),this.init()}return l()(e,[{key:"init",value:function(){this._lastUpdate>0?(clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,this._delay)):this._runUpdate()}},{key:"getStats",value:function(){return{numUpdatesRun:this._numUpdatesRun,numUpdatesSkipped:this._numUpdatesSkipped,numUpdatesAsyncSkipped:this._numUpdatesAsyncSkipped,numAsyncAborts:this._numAsyncAborts,numAsyncTimeouts:this._numAsyncTimeouts,updateIsRunning:this._updateIsRunning,isAsync:this._isAsync,isAsyncRunning:this._isAsyncRunning,cancelled:this._isCancelled,suspended:this._suspended,lastUpdate:this._lastUpdate,asyncRunTime:this._asyncRunTime(),timeSinceLastUpdate:this._timeSinceLastUpdate(),updateTimes:this._updateTimes.ordered(),actions:this._actions.ordered()}}},{key:"cancel",value:function(){this._isCancelled=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0}},{key:"abortAsync",value:function(){this._numAsyncAborts++,this.performAction(xt),this._notifyAsyncAborted()}},{key:"performAction",value:function(e){try{_.Z.PAssert(500,e,"Invalid action reported")}catch(t){_.Z.reportError(t)}this._actions.push({action:e,time:Date.now()})}},{key:"notifyOfSuspend",value:function(){this._pauseWhileIdle&&(this.performAction(wt),this._suspended=!0,this._remainingTime=Math.max(0,this._lastSetDelay-this._timeSinceLastUpdate()),clearTimeout(this._runningTimeout),this._runningTimeout=void 0)}},{key:"notifyOfResume",value:function(){if(this._pauseWhileIdle){this.performAction(bt);var e,t=!this._suspended;if(this._suspended=!1,this._minDelayOnResume)e=Math.max(0,this._minDelay-this._timeSinceLastUpdate());else{try{_.Z.PAssert(501,t||this._remainingTime>=0,"Must have a valid remaining time set for task")}catch(n){_.Z.reportError(n)}e=this._remainingTime,this._remainingTime=-1}e=Math.max(500,e),clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,e)}}},{key:"isAsync",value:function(){return this._isAsync}},{key:"isAsyncRunning",value:function(){return this.isAsync()&&this._isAsyncRunning}},{key:"_notifyUpdateAsyncSkipped",value:function(){this._numUpdatesAsyncSkipped++,this.performAction(Pt)}},{key:"_notifyUpdateSkipped",value:function(){this._numUpdatesSkipped++,this.performAction(St)}},{key:"_notifyUpdateRun",value:function(){this._lastUpdate=Date.now(),this._updateTimes.push(this._lastUpdate),this._numUpdatesRun++,this.performAction(Dt)}},{key:"_timeSinceLastUpdate",value:function(){return Date.now()-this._lastUpdate}},{key:"_asyncRunTime",value:function(){var e=0;return this._asyncStartTime>0&&(e=Date.now()-this._asyncStartTime),e}},{key:"_notifyAsyncBegin",value:function(){return this.performAction(It),this._isAsyncRunning=!0,this._iterationID=_.Z.generateTempId(),this._asyncStartTime=Date.now(),this._asyncTimeout&&(this._asyncAbortTimeout=setTimeout(this._handleAsyncAbortTimeout,this._asyncTimeout)),this._iterationID}},{key:"_notifyAsyncComplete",value:function(){this.performAction(Et),this._isAsyncRunning=!1,this._asyncStartTime=-1,this._iterationID=void 0,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)}},{key:"_notifyAsyncAborted",value:function(){this._isAsyncRunning=!1,this._asyncStartTime=-1,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)}},{key:"_handleAsyncAbortTimeout",value:function(){this._numAsyncTimeouts++,this.performAction(Ct),this._notifyAsyncAborted()}},{key:"_runUpdate",value:function(e){var t=arguments,n=this;try{_.Z.PAssert(502,!this._isCancelled,"Should never run a cancelled task")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(504,!this._updateIsRunning,"Should not run another update while already running one: "+this._id)}catch(i){_.Z.reportError(i)}if(!this._updateIsRunning){if(this._updateIsRunning=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0,this._notifyUpdateRun(),this.isAsync())if(this.isAsyncRunning())this._asyncTimeout&&this._asyncTimeout<this._asyncRunTime()?(this.abortAsync(),setTimeout(this._runUpdate.bind(this,e),0)):this._notifyUpdateAsyncSkipped();else{var r=this._notifyAsyncBegin();try{this._task((function(){try{_.Z.PAssert(506,r===n._iterationID,"Callback is only valid while task is considered running")}catch(i){_.Z.reportError(i)}n._notifyAsyncComplete(),e&&e.apply(n,t)}))}catch(a){_.Z.reportError(a),this._notifyAsyncComplete()}}else try{this._task()}catch(a){_.Z.reportError(a)}this._runningTimeout=setTimeout(this._runUpdate,this._delay),this._lastSetDelay=this._delay,this._remainingTime=this._delay,this._updateIsRunning=!1}}},{key:"requestUpdate",value:function(){if(this._timeSinceLastUpdate()>this._minDelay)this._runUpdate();else{this._notifyUpdateSkipped();var e=this._minDelay-this._timeSinceLastUpdate();clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,e),this._lastSetDelay=this._minDelay}}},{key:"forceUpdate",value:function(e){this._runUpdate(e)}},{key:"breakOnNextUpdate",value:function(){0}}]),e}(),P()(_t.prototype,"_notifyAsyncComplete",[S.ZP],Object.getOwnPropertyDescriptor(_t.prototype,"_notifyAsyncComplete"),_t.prototype),P()(_t.prototype,"_handleAsyncAbortTimeout",[S.ZP],Object.getOwnPropertyDescriptor(_t.prototype,"_handleAsyncAbortTimeout"),_t.prototype),P()(_t.prototype,"_runUpdate",[S.ZP],Object.getOwnPropertyDescriptor(_t.prototype,"_runUpdate"),_t.prototype),_t);const Lt=function(){function e(){s()(this,e),this._tasks={}}return l()(e,[{key:"init",value:function(){window.addEventListener("focus",this._handleFocus.bind(this)),window.addEventListener("blur",this._handleBlur.bind(this))}},{key:"getStats",value:function(){var e=this,t={};return Object.keys(this._tasks).forEach((function(n){return t[n]=e._tasks[n].getStats()})),t}},{key:"createRecurringTask",value:function(e,t){try{_.Z.PAssert(363,!this._tasks[e],"Must not register multiple tasks with the same ID")}catch(r){_.Z.reportError(r)}var n=new At(e,t);return this._tasks[e]=n,n}},{key:"getRecurringTask",value:function(e){try{_.Z.PAssert(364,this._tasks[e],"Must only retreive a valid recurring task")}catch(t){_.Z.reportError(t)}return this._tasks[e]}},{key:"hasRecurringTask",value:function(e){return!!this._tasks[e]}},{key:"cancelRecurringTask",value:function(e){try{_.Z.PAssert(365,this._tasks[e],"Must only cancel a valid recurring task")}catch(t){_.Z.reportError(t)}this._tasks[e].cancel(),delete this._tasks[e]}},{key:"_handleFocus",value:function(){for(var e in this._tasks)this._tasks[e].notifyOfResume()}},{key:"_handleBlur",value:function(){for(var e in this._tasks)this._tasks[e].notifyOfSuspend()}}]),e}();var Mt=n(7183);const Tt=new(function(){function e(){s()(this,e)}return l()(e,[{key:"deriveKey",value:function(e,t){var n=Mt.Z.textEncoder.encode(e),r=Mt.Z.str2ab(t);return crypto.subtle.importKey("raw",n,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]).then((function(e){return crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:2e5,hash:"SHA-512"},e,{name:"AES-CTR",length:256},!1,["encrypt","decrypt"])})).then((function(e){return e}))}},{key:"importKey",value:function(e){return crypto.subtle.importKey("raw",e,"AES-CTR",!0,["encrypt","decrypt"])}},{key:"exportKey",value:function(e){return crypto.subtle.exportKey("raw",e)}},{key:"encrypt",value:function(e,t,n){var r={name:"AES-CTR",counter:n,length:128};return crypto.subtle.encrypt(r,t,e)}},{key:"decrypt",value:function(e,t,n){var r={name:"AES-CTR",counter:n,length:128};return crypto.subtle.decrypt(r,t,e)}}]),e}());const Rt=new(function(){function e(){s()(this,e)}return l()(e,[{key:"key",value:function(e,t){return Tt.deriveKey(e,t)}},{key:"saltToCounter",value:function(e){var t=Mt.Z.str2ab(e);if(t.length>16)t=t.slice(0,16);else if(t.length<16){for(var n=0,r=new Uint8Array(16),i=0;i<t.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r[i]=t[i]}t=r}return t}},{key:"encrypt",value:function(e,t,n){var r=this.saltToCounter(n),i=Mt.Z.unicode2ab(e);return Tt.encrypt(i,t,r).then((function(e){return Mt.Z.ab2str(e)}))}},{key:"decrypt",value:function(e,t,n){var r=this.saltToCounter(n),i=Mt.Z.str2ab(e);return Tt.decrypt(i,t,r).then((function(e){return Mt.Z.ab2unicode(e)}))}}]),e}());var Ot,Ft="afolaw8klslbsahgbeoiya4pifoqlncduzvxgze60lvk17sevauroatsxm8qqia",Nt=new Uint8Array([76,30,217,70,117,53,119,240,33,22,147,24,106,228,253,86,175,251,159,47,232,124,89,230,19,65,243,211,58,83,88,158]).buffer;function Bt(e){this.message=e,"captureStackTrace"in Error?Error.captureStackTrace(this,Bt):this.stack=(new Error).stack}function Ut(e){this.message=e,"captureStackTrace"in Error?Error.captureStackTrace(this,Ut):this.stack=(new Error).stack}Bt.prototype=Object.create(Error.prototype),Bt.prototype.name="InvalidArgumentError",Bt.prototype.constructor=Bt,Ut.prototype=Object.create(Bt.prototype),Ut.prototype.name="InvalidPasswordError",Ut.prototype.constructor=Ut;const jt=(Ot=function(){function e(){var t=this;s()(this,e),this.sentinel=w.Z.EncryptionSentinel,this.keys={},this.onLoadCbs=[],this.onUpdated=new et.Z,this.importKeys({}).then((function(){t.isLoaded=!0,t.onLoadCbs.forEach((function(e){return e()}))}))}return l()(e,[{key:"onLoad",value:function(e){this.isLoaded?e():this.onLoadCbs.push(e)}},{key:"canDecryptSentinel",value:function(e){return!!this.getKeyBySentinel(e)}},{key:"getKeyBySentinel",value:function(e){for(var t in this.keys)if(this.keys[t].sentinel===e)return this.keys[t].key}},{key:"encryptSentinel",value:function(e,t){return Rt.encrypt(this.sentinel,e,t)}},{key:"createKeyInfo",value:function(e){var t=this,n=e.name,r=e.password,i=e.sentinelSalt;return Rt.key(r,Ft).then((function(e){return t.encryptSentinel(e,i).then((function(t){return{name:n,key:e,sentinel:t}}))}))}},{key:"importKeys",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.keys.Global||(t[w.Z.EncryptionKeys.Global]=Nt),t[w.Z.EncryptionKeys.UserPassword]&&!re.Z.getEncryptionUid()?new Promise((function(n){_o.settings.userId.onHasValue((function(r){e.importKeys(t).then((function(e){return n(e)}))}))})):Promise.all(Object.keys(t).map((function(n){var r=t[n],i=(n===w.Z.EncryptionKeys.Global?Ft:n===w.Z.EncryptionKeys.UserPassword&&re.Z.getEncryptionUid())||n;return r instanceof CryptoKey?e.encryptSentinel(r,i).then((function(t){e.keys[n]={name:n,key:r,sentinel:t}})):(_.Z.isString(r)&&(r=Mt.Z.str2ab(r)),Tt.importKey(r).then((function(t){return e.encryptSentinel(t,i).then((function(r){e.keys[n]={name:n,key:t,sentinel:r}}))})))}))).then((function(){return e.keys})).catch((function(t){return console.log(t),e.onUpdated.notify(),e.keys}))}},{key:"getGlobalKeyInfo",value:function(){return this.keys[w.Z.EncryptionKeys.Global]}},{key:"getGlobalKey",value:function(){return this.keys[w.Z.EncryptionKeys.Global].key}},{key:"getKey",value:function(e){var t;return null===(t=this.keys[e])||void 0===t?void 0:t.key}},{key:"getKeyInfo",value:function(e){return this.keys[e]}},{key:"setKey",value:function(e){var t=this,n=e.name,r=e.password,i=e.sentinelSalt;return this.createKeyInfo({name:n,password:r,sentinelSalt:i}).then((function(e){return t.keys[n]=e,t.onUpdated.notify(),e}))}},{key:"addKey",value:function(e){var t=e.name,n=e.password,r=e.sentinelSalt;return"string"!==typeof t?Promise.reject(new Bt("Name must be a string. Saw: ".concat(t))):t in this.keys?Promise.reject(new Bt("".concat(t," exists. Use 'updateKey' to change existing keys."))):this.setKey({name:t,password:n,sentinelSalt:r})}},{key:"updateKey",value:function(e){var t=e.name,n=e.password,r=e.sentinelSalt;return"string"!==typeof t?Promise.reject(new Bt("Name must be a string. Saw: ".concat(t))):t in this.keys?this.setKey({name:t,password:n,sentinelSalt:r}):Promise.reject(new Bt("".concat(t," does not exist. Use 'addKey' to add new key.")))}},{key:"removeKey",value:function(e){delete this.keys[e]}},{key:"createKey",value:function(e){var t=e.name,n=e.password,r=e.sentinelSalt;return"string"!==typeof t?Promise.reject(new Bt("Name must be a string. Saw: ".concat(t))):this.createKeyInfo({name:t,password:n,sentinelSalt:r})}},{key:"exists",value:function(e){return!!(e in this.keys)}},{key:"encryptText",value:function(e,t,n){var r="string"===typeof e?this.keys[e]?this.keys[e].key:void 0:e;try{_.Z.PAssert(404,r,"No valid encryption key")}catch(i){_.Z.reportError(i)}return"string"!==typeof t?Promise.reject(new Bt("Text must be a string. Saw: ".concat(t))):Rt.encrypt(t,r,n)}},{key:"decryptText",value:function(e,t,n){var r="string"===typeof e?this.keys[e]?this.keys[e].key:void 0:e;return"string"!==typeof t?Promise.reject(new Bt("Text must be a string. Saw: ".concat(t))):Rt.decrypt(t,r,n)}},{key:"exportKey",value:function(e){return Tt.exportKey(e)}}]),e}(),P()(Ot.prototype,"addKey",[S.ZP],Object.getOwnPropertyDescriptor(Ot.prototype,"addKey"),Ot.prototype),P()(Ot.prototype,"updateKey",[S.ZP],Object.getOwnPropertyDescriptor(Ot.prototype,"updateKey"),Ot.prototype),Ot);var Ht;function Vt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}var Wt=["platforms","appHotkeys","hotkeys","syncAccounts","documentIndices","font","syncAccountRefreshParts","driveFolders","needsBackup","backupsDrive","helpState","userProperties","colorThemes","layouts"],zt=["emailViewAccounts"],qt=["syncAccountRefreshParts"];const Gt=(Ht=function(e){p()(n,e);var t=Vt(n);function n(){var e;return s()(this,n),(e=t.call(this)).oldSettings={c:!0,u:!0,aA:!0,t:!0,z:!0,aX:!0,bf:!0},e.onLoadCbs=[],e.onLoadRemoteCbs=[],e.init(),e}return l()(n,[{key:"init",value:function(){var e=this;this._allSettings=[],this._allGroups=[],this._groupAbbrevs={},this._groupAbbrevsIn={},this.registerGroup(this,""),this.registerGroup("ui","u");var t=[["agendaSort","a",this.createDefaultAgendaSort()],["backupFrequency","d",0],["calendarCustomDays","e",3],["closedImport","f"],["closedHelps","g"],["closedVideo","h"],["dateFormat","i",w.Z.DateFormat.MDY],["dayWeekStart","j",0],["defaultItemPrefix","k",""],["helpPaneState","l"],["helpState","m"],["inTooltipIntro","n"],["backupsDrive","o"],["needsBackup","p"],["notificationDelay","q",30],["openEvernoteApp","r",!0],["panesMobile","s"],["showFormattingToolbar","v",1],["showMarkdown","w"],["showImagesInline","x",!0],["shownTutorial","y"],["trialOverHidden","A"],["userEncryptionSentinel","aE"],["encryptBackup","aH"],["driveFolders","aI"],["fixedMissingCalendars","aJ"],["platforms","aK"],["encryptLocalFiles","aM"],["syncAccounts","aN",{}],["panesRN","aO"],["testBetaFeatures","aQ"],["appSystemDarkMode","aS",!0],["appHotkeys","aT"],["showDebugInfo","aU"],["hotkeys","aV"],["documentIndices","aW"],["alignIndentToPrefix","bc"],["syncAccountRefreshParts","be",{}],["emailViewAccounts","bi",[]],["archiveEmailsOnOrganize","bj"],["showStatusBar","bk",!0]],n=[["activeUser","b"],["cacheSizeRatio","B",1],["disableNotifications","C"],["displayName","D"],["lastContactSync","I"],["lastServerVersion","J"],["lastTaskSync","K"],["lastQuickAddSync","L"],["localDataVersion","M",7],["localIntegrity","N"],["localPaneState","O"],["localRecoverVersion","P"],["notifiedTrialOver","R"],["notifiedTrialEndSoon","S"],["selectedBoard","V"],["showSidebar","W",!0],["sidebarWidth","X",w.Z.DesktopMenuWidthDefault],["userId","ab"],["encryptionKeys","aD"],["lastSync","aF"],["userProperties","aG"],["backupLocal","aL",!0],["refreshTokensRN","aR"],["disableAnimations","bd"],["panesInViewMobile","bg"]],r=[["boldHeaders","ac",!1],["bulletOpacity","ad",30],["checkboxOpacity","ae",30],["checkboxBackgroundOpacity","af",0],["contactColor","ag","#22AA66"],["dateColor","ah","#AA3300"],["displayPrefixes","ai",w.Z.DisplayTheme.PrefixesFaded],["displaySpacing","aj",w.Z.DisplayTheme.SpacingComfortable],["fontSize","ak",15],["fontSizeHeader","al",16],["fontSizeHeaderTopLevel","am",18],["grayscale","an",!1],["itemIndentSize","ao",30],["itemLineHeight","ap",18],["itemPadding","aq",5],["linkColor","ar","#3333BB"],["noteFontSize","as",12],["noteLineHeight","at",18],["notePadding","au",0],["projectOpacity","av",30],["showVerticalLines","aw",!0],["tagColor","ax","#0099DD"],["themeDesktop","ay","auto"],["underlineP","az",!1],["verticalLinesOpacity","aC",6],["cursorBlink","aP",!0],["font","aY",{}],["fontWeight","aZ","normal"],["numListOpacity","ba",30],["collapserOpacity","bb",30],["themeMobile","bh","auto"],["colorThemes","bl",{}],["layouts","bm",{}],["selectedColorTheme","bn"],["selectedLayout","bo"]];this.registerSettings(t,this,!0),this.registerSettings(n,this,!1),this.registerSettings(r,this.ui,!0),_.Z.isDemoMode()&&this.activeUser.set("demo"),this.syncAccounts.listen((function(t){if(t){var n=!1;if(void 0!==t.undefined){try{_.Z.PAssert(359,!1,"Sync account is somehow undefined")}catch(r){_.Z.reportError(r)}e.syncAccounts.deleteProperty("undefined"),n=!0}else Object.keys(t).forEach((function(e){var r=e.toLowerCase();e!==e.toLowerCase()&&(t[r]=t[e],delete t[e],n=!0)}));n&&setTimeout((function(){e._save("syncAccounts",void 0,e.syncAccounts.get())}),0)}})),this.encryptionKeys.listen(this._onEncryptionKeysChange)}},{key:"load",value:function(){var e=a()(k().mark((function e(t,n,r){var i,o,s=this;return k().wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(i=[],!n&&!r){e.next=4;break}return e.next=4,Promise.all(Object.keys(t).filter((function(e){return qt.includes(s.getSettingInfoFromAbbrev(e).key)})).map(function(){var e=a()(k().mark((function e(n){var r,i;return k().wrap((function(e){for(var a=0,o=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return r=s.getSettingInfoFromAbbrev(n),i=r.key,e.next=3,s.decryptValue(i,t[n].v,_o.crypto.getKeyInfo(s.getBestUserEncryption()));case 3:t[n].v=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:this.isLoading=!0,Object.keys(t).map((function(e){var n=s.getSettingInfoFromAbbrev(e),r=n.group,a=n.key,o=t[e].v;if(r&&r[a])if("isEnabled"===a)i.push({group:r,key:a,value:o});else{var c=r[a].get();if(void 0===o||null===o)void 0!==o&&null!==o||(o=r._settingsDefault[a]),r[a].set(o);else if(!_.Z.isObject(c)||!_.Z.isObject(o)||!_.Z.deepEqual(c,o)){if(_.Z.isString(o)&&(Wt.includes(a)||zt.includes(a)||o.startsWith('{"')&&o.endsWith("}")))try{o=JSON.parse(o)}catch(l){console.error(l)}r[a].set(o)}}})),i.forEach((function(e){var t=e.group,n=e.key,r=e.value;t[n].set(r)})),o=function(){return JSON.stringify({uid:s.userId.get(),name:s.displayName.get(),email:s.activeUser.get()})};try{_.Z.PAssert(360,!this.userId.get()||this.userId.get().length>4,"Bad UID",o)}catch(l){_.Z.reportError(l)}n&&(this._allSettings.forEach((function(e){if(!t[e.path]){var n=e.group._settingsDefault[e.key];e.setting.get()!==n&&e.setting.set(n)}})),!this.userEncryptionSentinel.get()&&_o.crypto.getKeyInfo(w.Z.EncryptionKeys.UserPassword)&&this.removeEncryptionKey(w.Z.EncryptionKeys.UserPassword),setTimeout((function(){"string"===typeof s.platforms.get()&&s.platforms.set({},!1),s.platforms.setProperty(D.Z.getUserPlatformConfig(),{d:Date.now(),v:w.Z.jsVersion})}),0)),"Sunday"===this.dayWeekStart.get()&&this.dayWeekStart.set(0),"Monday"===this.dayWeekStart.get()&&this.dayWeekStart.set(1),n||_o.DisplaySettings.init(),this.isLoading=!1,this._isLoaded=!0,this.onLoadCbs.forEach((function(e){return e()})),this.onLoadCbs=[],n&&(this.onLoadRemoteCbs.forEach((function(e){return e()})),this.onLoadRemoteCbs=[],this._isLoadedRemote=!0);case 18:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"registerGroup",value:function(e,t,n){var r,i=this,a=[];_.Z.isString(e)&&(_.Z.shouldLog(w.Z.LogLevels.Settings)&&_.Z.log("SETTINGS: Registered Group - ",e),r=e,this[e]={oldSettings:n},e=this[e]),e.listen=function(e){a.push(e)},e.unlisten=function(e){a.remove(e)},e.onChange=function(e,t,n){if(i._isLoaded&&(_.Z.isObject(t)?!_.Z.deepEqual(t,n):t!==n)){var o=0;i._save(e,r,t);for(var s=0;s<a.length;s++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;a[s](t,n)}}},e._settingsDefault||(e._settingsRemote={},e._settingsDefault={},e._settingsAbbrevs={},e._settingsAbbrevsIn={}),this._allGroups.push({id:t,group:e}),r&&(this._groupAbbrevs[r]=t,this._groupAbbrevsIn[t]=r)}},{key:"registerSettings",value:function(e,t,n){for(var r=0,i=0;i<e.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=e[i],o=a[0],s=a[1],c=a[2];this.registerSetting(o,s,t,n,c)}}},{key:"registerSetting",value:function(e,t,n,r,i){if(_.Z.isString(n)&&(n=this[n]),r&&(n._settingsRemote[e]=!0),void 0!==i&&(n._settingsDefault[e]=i),n._settingsAbbrevs[e]=t,n._settingsAbbrevsIn[t]=e,Wt.includes(e)?n[e]=new ke.Z(i,n.onChange.bind(this,e)):zt.includes(e)?n[e]=new ae.Z(i,n.onChange.bind(this,e)):n[e]=new x.Z(i,n.onChange.bind(this,e),!0),r){var a=this._allGroups.indexOfWithProperty("group",n);if(a>=0){var o=this._allGroups[a].id;this._allSettings.push({path:(o?o+"\\":"")+t,group:n,key:e,abbrev:t,setting:n[e]})}else 0}}},{key:"getDefaultItemText",value:function(e){return(e=e||this.defaultItemPrefix.get())?e+" ":""}},{key:"getSettingAbbrev",value:function(e,t){return(t?this[t]:this)._settingsAbbrevs[e]}},{key:"getSettingInfoFromAbbrev",value:function(e){var t,n,r=e.split("\\");if(r.length>1?(n=this[n=this._groupAbbrevsIn[r[0]]],t=r[1]):(n=this,t=r[0]),(!n.oldSettings||!n.oldSettings[t])&&(t=n._settingsAbbrevsIn[t],!e.includes("\\")||!e.endsWith("w"))){0;try{_.Z.PAssert(361,n&&n[t],"Missing group for setting",e)}catch(i){_.Z.reportError(i)}}return{group:n,key:t}}},{key:"getValueFromAbbrev",value:function(e){var t=this.getSettingInfoFromAbbrev(e),n=t.group,r=t.key;if(n&&n[r])return n[r].get()}},{key:"_save",value:function(){var e=a()(k().mark((function e(t,n,r){var i,a,o,s,c,l;return k().wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(i=n?this[n]:this,a=!this.isLoading&&i._settingsRemote[t],o=i._settingsAbbrevs[t],s=n?this._groupAbbrevs[n]+"\\":"",c=s+o,r&&"{"===r[0])try{_.Z.PAssert(362,!1,"Saving setting to string with brackets")}catch(d){_.Z.reportError(d)}if(!qt.includes(t)){e.next=16;break}return e.next=13,this.getEncryptedValue(t,r,_o.crypto.getKeyInfo(this.getBestUserEncryption()));case 13:e.t0=e.sent,e.next=17;break;case 16:e.t0=r;case 17:l=e.t0,j.Z.setSetting(c,r,a,l);case 19:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getEncryptionKey",value:function(e){var t=this._encryptionKeyInfo;return t&&t[e]?t[e].key:void 0}},{key:"removeEncryptionKey",value:function(e){var t=Object.assign({},this.encryptionKeys.get());_o.crypto.removeKey(e),delete t[e],this.encryptionKeys.set(t)}},{key:"addEncryptionKey",value:function(){var e=a()(k().mark((function e(t,n){var r;return k().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:(r=Object.assign({},this.encryptionKeys.get()))[t]=n,e.next=6;break;case 6:return e.abrupt("return",this.setEncryptionKeys(r));case 7:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setEncryptionKeys",value:function(){var e=a()(k().mark((function e(t){return k().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return this._isSettingEncryptionKeys=!0,this.encryptionKeys.set(t),this._isSettingEncryptionKeys=!1,e.abrupt("return",this._onEncryptionKeysChange(t));case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"shouldShowHelp",value:function(e){var t=this.closedHelps.get();return!t||!t[e]}},{key:"closeHelp",value:function(e){var t=_.Z.clone(this.closedHelps.get())||{};t[e]=!0,this.closedHelps.set(t)}},{key:"uncloseHelp",value:function(e){var t=_.Z.clone(this.closedHelps.get())||{};delete t[e],this.closedHelps.set(t)}},{key:"isBackupEnabled",value:function(){return this.backupFrequency.get()>0}},{key:"hasUserPassword",value:function(){var e=this.encryptionKeys.get();return e&&!!e[w.Z.EncryptionKeys.UserPassword]}},{key:"getBestUserEncryption",value:function(){var e=this.encryptionKeys.get();return e&&e[w.Z.EncryptionKeys.UserPassword]?w.Z.EncryptionKeys.UserPassword:w.Z.EncryptionKeys.Global}},{key:"createDefaultAgendaSort",value:function(){return{overdue:-2,"#now":-1,starred:1,important:2,"#next":3,"#soon":101,"#later":301,"#someday":1401}}},{key:"getUserIdentifier",value:function(){return _.Z.isDemoMode()?"demouser":this.activeUser.get()}},{key:"onLoaded",value:function(e){this._isLoaded?e():this.onLoadCbs.push(e)}},{key:"onLoadedRemote",value:function(e){this._isLoadedRemote?e():this.onLoadRemoteCbs.push(e)}},{key:"_onEncryptionKeysChange",value:function(){var e=a()(k().mark((function e(t){var n,r;return k().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(this._isSettingEncryptionKeys){e.next=8;break}return this._encryptionKeyInfo={},n={},Object.keys(t).forEach((function(e){n[e]=t[e]})),e.next=6,_o.crypto.importKeys(n);case 6:r=e.sent,this._encryptionKeyInfo=r;case 8:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getEncryptedSettings",value:function(){var e=this;return qt.map((function(t){var n=e.getSettingAbbrev(t),r=e.getValueFromAbbrev(n);if(r)return[t,n,r]})).filter((function(e){return!!e}))}},{key:"getRemoteSaveValue",value:function(){var e=a()(k().mark((function e(t,n,r){var i;return k().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(i=(n[t]||this[t]||this.ui[t]).get(),!qt.includes(t)){e.next=3;break}return e.abrupt("return",this.getEncryptedValue(t,i,r));case 3:return e.abrupt("return",i);case 4:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getEncryptedValue",value:function(){var e=a()(k().mark((function e(t,n,r){var i;return k().wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!_.Z.isObject(n)){e.next=7;break}return i=_.Z.clone(n),e.next=4,Promise.all(Object.keys(n).map(function(){var e=a()(k().mark((function e(t){return k().wrap((function(e){for(var a=0,o=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,_o.crypto.encryptText(r.key,n[t],t);case 2:i[t]=e.sent;case 3:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return e.abrupt("return",i);case 7:return e.abrupt("return",_o.crypto.encryptText(r.key,n,t));case 8:case"end":return e.stop()}}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"decryptValue",value:function(){var e=a()(k().mark((function e(t,n,r){return k().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!_.Z.isObject(n)){e.next=6;break}return e.next=3,Promise.all(Object.keys(n).map(function(){var e=a()(k().mark((function e(t){return k().wrap((function(e){for(var i=0,a=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,_o.crypto.decryptText(r.key,n[t],t);case 2:n[t]=e.sent;case 3:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return e.abrupt("return",n);case 6:return e.abrupt("return",_o.crypto.decryptText(r.key,n,t));case 7:case"end":return e.stop()}}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"addEmailViewAccount",value:function(e,t,n,r){this.emailViewAccounts.find((function(n){return n.e===e&&n.s===t}))||this.emailViewAccounts.push(_.Z.removeNullUndefined({e:e,s:t,n:n,b:r}))}}]),n}(E.Z),P()(Ht.prototype,"_onEncryptionKeysChange",[S.ZP],Object.getOwnPropertyDescriptor(Ht.prototype,"_onEncryptionKeysChange"),Ht.prototype),Ht);var Kt,Yt=0;const Xt=(Kt=function(){function e(t,n){s()(this,e);try{_.Z.PAssert(525,t,"Must provide valid message info")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(526,n,"Must provide a valid message owner")}catch(r){_.Z.reportError(r)}if(this.info=t,this.id=t.id||"Message_"+Yt++,this.owner=n,this.timeout=t.timeout||w.Z.ToastTimeoutDefault,this.text=new x.Z(t.text),this.action=t.action||w.Z.MessageAction.Default,this.action2=t.action2,this.isBig=t.big,this.noClose=t.noClose,this.data=t.data,this.hold=!t.timeout&&!1!==t.hold&&(t.hold||this.action!==w.Z.MessageAction.Default),this.hold&&(this.timeout=Number.MAX_SAFE_INTEGER),this.noIgnore=t.noIgnore,this.onCloseFn=t.onClose,this.clearTimeout=void 0,this._isVisible=!1,this.actionText=t.actionText,!this.actionText)switch(this.action){case w.Z.MessageAction.Default:this.actionText="";break;case w.Z.MessageAction.Reload:case w.Z.MessageAction.ResetClient:this.actionText="RELOAD";break;case w.Z.MessageAction.Okay:this.actionText="OKAY";break;case w.Z.MessageAction.Blog:this.actionText="BLOG";break;case w.Z.MessageAction.Undo:this.actionText="UNDO";break;case w.Z.MessageAction.LoginScreen:this.actionText="LOGIN";break;case w.Z.MessageAction.Contact:this.actionText="CONTACT";break;case w.Z.MessageAction.OpenSettings:case w.Z.MessageAction.OpenAccountSettings:case w.Z.MessageAction.OpenUpgrade:case w.Z.MessageAction.OpenGeneralSettings:case w.Z.MessageAction.OpenCalendarSettings:case w.Z.MessageAction.OpenFilesSettings:this.actionText="SETTINGS";break;case w.Z.MessageAction.OpenGoogleDrive:this.actionText="GOOGLE DRIVE";break;case w.Z.MessageAction.OpenDisplaySettings:this.actionText="DISPLAY SETTINGS";break;case w.Z.MessageAction.StartDemo:this.actionText="START DEMO";break;default:0}}return l()(e,[{key:"show",value:function(){this._isVisible||(this._isVisible=!0,this.hold||(this.clearTimeout=setTimeout(this.hide,this.timeout)),this.owner.onMessageShow(this))}},{key:"hide",value:function(){this._isVisible&&(this._isVisible=!1,clearTimeout(this.clearTimeout),this.clearTimeout=void 0,this.onCloseFn&&this.onCloseFn(this),this.owner.onMessageHide(this))}},{key:"isVisible",value:function(){return this._isVisible}},{key:"doAction",value:function(e){if(this.isVisible()){if(_.Z.isFunction(this.action))this.action();else switch(this.action){case w.Z.MessageAction.None:case w.Z.MessageAction.Okay:case w.Z.MessageAction.Default:break;case w.Z.MessageAction.Reload:_.Z.reload();break;case w.Z.MessageAction.LoginScreen:ve.Z.removeURLParam("demo"),ve.Z.removeURLParam("demo",!0);break;case w.Z.MessageAction.Demo:ve.Z.insertURLParam("demo","true");break;case w.Z.MessageAction.ResetClient:break;case w.Z.MessageAction.OpenURL:var t=this.data?this.data.url:void 0;try{_.Z.PAssert(527,t,"Should always have a valid URL to navigate")}catch(n){_.Z.reportError(n)}t&&_o.openUrl(t);break;case w.Z.MessageAction.Blog:_o.openUrl("https://www.moo.do/blog/updates");break;case w.Z.MessageAction.Undo:rt.Z.undo();break;case w.Z.MessageAction.Contact:_o.menus.openModal(w.Z.Modals.ReportBug);break;case w.Z.MessageAction.OpenSettings:_o.menus.openSettings("Email");break;case w.Z.MessageAction.OpenGeneralSettings:_o.menus.openSettings("General");break;case w.Z.MessageAction.OpenAccountSettings:_o.menus.openSettings("Moo.do Account");break;case w.Z.MessageAction.OpenUpgrade:_o.menus.openSettings("Upgrade");break;case w.Z.MessageAction.OpenCalendarSettings:_o.menus.openSettings("Calendar");break;case w.Z.MessageAction.OpenFilesSettings:_o.menus.openSettings("Files");break;case w.Z.MessageAction.OpenGoogleDrive:_o.openUrl("https://drive.google.com");break;case w.Z.MessageAction.OpenDisplaySettings:_o.DisplaySettings.isOpen.set(!0);break;case w.Z.MessageAction.StartDemo:window.postMessage("resume","*");break;default:try{_.Z.PAssert(528,!1,"Invalid message action, add a new case here or pass in a function",this.action)}catch(n){_.Z.reportError(n)}}e&&_.Z.stopPropagation(e),this.info.holdOnAction||this.hide()}}},{key:"onTapIgnore",value:function(e){this.isVisible()&&!this.noIgnore&&this.hide()}},{key:"setText",value:function(e){this.text.set(e)}}]),e}(),P()(Kt.prototype,"hide",[S.ZP],Object.getOwnPropertyDescriptor(Kt.prototype,"hide"),Kt.prototype),P()(Kt.prototype,"doAction",[S.ZP],Object.getOwnPropertyDescriptor(Kt.prototype,"doAction"),Kt.prototype),P()(Kt.prototype,"onTapIgnore",[S.ZP],Object.getOwnPropertyDescriptor(Kt.prototype,"onTapIgnore"),Kt.prototype),Kt);const Qt=function(){function e(){s()(this,e),this.queue=new ae.Z,this.queueUpdateMessages=new ae.Z,this.defaultMessages=[],this.defaultMessages[w.Z.MessageID.Undefined]=void 0}return l()(e,[{key:"getMessageById",value:function(e){void 0===this.defaultMessages[e]&&this.initMessageById(e);try{_.Z.PAssert(366,void 0!==this.defaultMessages[e],"After init message should always be defined")}catch(t){_.Z.reportError(t)}return this.defaultMessages[e]}},{key:"testMessageById",value:function(e){return!!this.defaultMessages[e]}},{key:"initMessageById",value:function(e){var t;switch(e){case w.Z.MessageID.ConnectionError:t={text:"Connection error detected. Please reload to try again.",action:w.Z.MessageAction.Reload};break;case w.Z.MessageID.OfflineUndo:t={text:"Offline undo/redo has been disabled temporarily.",hold:!0};break;case w.Z.MessageID.FatalError:t={text:"There was a fatal error in the application. "+D.Z.actionVerbCaps()+" to restart.",action:w.Z.MessageAction.Reload};break;case w.Z.MessageID.MailbirdClick:t={text:"Sorry, emails can currently only be opened from inside Mailbird.",action:w.Z.MessageAction.Okay};break;case w.Z.MessageID.ExitDemo:t={text:"Changes are not saved in demo",action:w.Z.MessageAction.LoginScreen,hold:!0,noIgnore:!0};break;case w.Z.MessageID.ShareFailure:t={text:"There was an error sharing the file you attached.",action:w.Z.MessageAction.OpenSettings,timeout:8e3};break;case w.Z.MessageID.ThisIsDemo:t={text:"Click anywhere to try this live demo of <b>Moo.do</b>",onClose:function(){window.parent.postMessage("userInteracted","*")},hold:!0,big:!0};break;case w.Z.MessageID.InviteFailure:t={text:"Failed to use referral code. Please try again in your account settings.",action:w.Z.MessageAction.OpenAccountSettings};break;case w.Z.MessageID.InviteSuccess:t={text:"You have successfully used your referral code. Enjoy your additional free trial of premium Moo.do!",action:w.Z.MessageAction.Okay};break;case w.Z.MessageID.PremiumRequired:t={text:"You must be a premium subscriber to use plugins.",action:w.Z.MessageAction.OpenUpgrade,actionText:"LEARN MORE"};break;case w.Z.MessageID.TrialOver:t={text:"Your trial of Premium has come to an end. Please sign up to continue using Premium features.",action:w.Z.MessageAction.OpenUpgrade,actionText:"SETTINGS"};break;case w.Z.MessageID.TrialEndSoon:t={text:"Your trial of Premium is ending soon. Please sign up to continue using Premium features after your trial ends.",action:w.Z.MessageAction.OpenUpgrade,actionText:"SETTINGS"};break;case w.Z.MessageID.WarnLargeFile:t={text:"Warning: You are uploading a large file. If the upload is not successful, try uploading directly to Google Drive.",action:w.Z.MessageAction.OpenGoogleDrive};break;case w.Z.MessageID.InviteInvalid:t={text:"Invalid referral code. Please try again in your account settings.",action:w.Z.MessageAction.OpenAccountSettings,actionText:"OKAY"};break;case w.Z.MessageID.NoSharingWarning:t={text:"You have shared your document with someone else, however the files attached have not been shared due to your permissions settings.",action:w.Z.MessageAction.OpenSettings,actionText:"SETTINGS"};break;case w.Z.MessageID.LostPermission:0,_.Z.log("Moo.do has lost permissions for a plugin or option you enabled. Please update your plugin settings."),console.trace(),t={text:"Moo.do has lost permissions for a plugin or option you enabled. Please update your plugin settings.",action:w.Z.MessageAction.OpenSettings,actionText:"SETTINGS"};break;case w.Z.MessageID.CalendarSync:t={text:"There was an error syncing your calendars.",action:w.Z.MessageAction.OpenCalendarSettings,actionText:"SETTINGS"};break;case w.Z.MessageID.EmailSendFail:t={text:"Your email was not sent, there was an error contacting the remote server."};break;case w.Z.MessageID.EmailUpdateFail:t={text:"Unable to save draft to Gmail. Your draft is still saved locally."};break;case w.Z.MessageID.EmailLabelFail:t={text:"Unable to sync you changes to Gmail. Your changes are still saved locally."};break;case w.Z.MessageID.EmailSyncFail:t={text:"There was an error syncing your Gmail data.",action:function(){_o.pluginManager.getPluginGmail().runThreadSync()},actionText:"RETRY"};break;case w.Z.MessageID.DemoPluginClick:t={text:"Outside of demo mode this would show you more information about the plugin.",timeout:3e3};break;case w.Z.MessageID.PromptScriptStart:t={text:"Start demo",hold:!0,big:!0,action:w.Z.MessageAction.StartDemo};break;case w.Z.MessageID.SnoozeOffline:t={text:"You must be online to Snooze. Please try again when Moo.do has connected.",action:w.Z.MessageAction.Okay};break;case w.Z.MessageID.NeedDrivePermission:t={text:"Attaching files already in Drive requires 'Shared Drive' to be enabled in settings.",action:w.Z.MessageAction.OpenSettings};break;case w.Z.MessageID.SetupGmailViews:t={text:"Sending email requires setting up Gmail accounts in settings.",action:w.Z.MessageAction.OpenSettings};break;case w.Z.MessageID.LostLinked:t={text:"Moo.do has lost access to one of your linked accounts.",action:w.Z.MessageAction.OpenSettings};break;case w.Z.MessageID.GmailDisabled:t={text:"Gmail may not be enabled on your Google account. Please contact your domain admin or reload app.",action:w.Z.MessageAction.Okay};break;case w.Z.MessageID.LocalWritesDisabled:t={text:"There was an error writing to the local cache. Please restart Moo.do.",action:w.Z.MessageAction.Reload};break;case w.Z.MessageID.FlatSearchMultiSelect:t={text:"Editing multiple items in flat search results is not supported because it would have unpredictable results."};break;case w.Z.MessageID.FlatSearchTab:t={text:"Indenting is not supported in List view because it would have unpredictable results."};break;case w.Z.MessageID.ReadOnlyCalendar:t={text:"You do not have write permission for the calendar you are trying to modify."};break;case w.Z.MessageID.CalendarSaveFail:t={text:"Some changes you made were not able to be saved properly. Please free up disk space and try again."};break;case w.Z.MessageID.QuotaError:t={text:"You have run out of disk space. Moo.do will be unable to operate offline.",timeout:3e3};break;case w.Z.MessageID.ReselectEmail:t={text:"Please re-select the email item and try again."};break;case w.Z.MessageID.ReactError:t={text:"The application has encountered an error. The developers have been notified, but sending a bug report describing what happened would be very helpful!",actionText:"REPORT",action:function(){_o.menus.openModal(w.Z.Modals.ReportBug)}};break;case w.Z.MessageID.PaneLoadTimeout:t={text:"Your documents are taking an unusually long time to load. Please wait a bit longer or try loading again.",actionText:"RELOAD",action:_.Z.reload};break;case w.Z.MessageID.GmailViewsNeedSignin:_.Z.log("Moo.do is not signed into your Gmail account. Please open settings and click FIX in the Gmail accounts to continue syncing your emails."),t={text:"Moo.do is not signed into your Gmail account. Please open settings and click FIX in the Gmail accounts to continue syncing your emails.",action:w.Z.MessageAction.OpenSettings,actionText:"SETTINGS"};break;default:try{_.Z.PAssert(367,!1,"Invalid MessageID: ",e)}catch(n){_.Z.reportError(n)}}t&&(this.defaultMessages[e]=new Xt(t,this))}},{key:"pushMessage",value:function(e){try{_.Z.PAssert(368,e,"Must supply a valid message to display")}catch(n){_.Z.reportError(n)}var t;if(e instanceof Xt)t=e;else if(_.Z.isObject(e))this.hasMsgWithText(e.text)||(t=new Xt(e,this));else if(_.Z.isString(e))this.hasMsgWithText(e)||(t=new Xt({text:e},this));else if(!(t=this.getMessageById(e))){try{_.Z.PAssert(369,!1,"Invalid data passed to message creation")}catch(n){_.Z.reportError(n)}_.Z.log("Message not created properly",e)}return t&&t.show(),t}},{key:"clearMessageByID",value:function(e){this.queue.get().some((function(t){if(t.id===e)return t.hide(),!0}))}},{key:"clearMessage",value:function(e){var t;return e instanceof Xt?t=e:this.testMessageById(e)&&(t=this.getMessageById(e)),t&&t.hide(),t}},{key:"isMessageVisible",value:function(e){var t=!1;e instanceof Xt?t=e.isVisible():this.testMessageById(e)&&(t=this.getMessageById(e).isVisible());return t}},{key:"onMessageShow",value:function(e){try{_.Z.PAssert(370,e,"Must pass in a valid message to add to the queue")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(371,e&&e.doAction,"Message added to queue must have valid API exposed - doAction")}catch(t){_.Z.reportError(t)}e instanceof Xt?this.queue.push(e):_.Z.reportError(new Error("Toast message must be an instance of Toast"),e)}},{key:"onMessageHide",value:function(e){try{_.Z.PAssert(372,e,"Must pass in a valid message to be removed from the queue")}catch(n){_.Z.reportError(n)}var t=this.queue.indexOf(e);if(t<0)try{_.Z.PAssert(373,!1,"Trying to remove an invalid message from the queue")}catch(n){_.Z.reportError(n)}else this.queue.splice(t,1)}},{key:"hasMsgWithText",value:function(e){return!!this.queue.get().find((function(t){return t.text.get()===e}))}},{key:"pushUpdateMessage",value:function(e){var t=this,n=e;return n.onClose=function(){t.queueUpdateMessages.remove(n)},this.queueUpdateMessages.push(n),n}}]),e}();var Jt,$t=n(1558);const en=(Jt=function(){function e(t){s()(this,e),this._taskCB=t,this._isRunning=!1,this._disabled=!1,this._workAvailable=!1,this._runCount=0,ue.Z.listen("lowImpactBegin",this.handleLowImpactBegin)}return l()(e,[{key:"getStats",value:function(){return{runCount:this._runCount,isRunning:this._isRunning,isDisabled:this._disabled}}},{key:"disable",value:function(){this._disabled=!0}},{key:"enable",value:function(){this._disabled=!1}},{key:"handleLowImpactBegin",value:function(){this._startTaskRun()}},{key:"requestRun",value:function(){this._forceRun=!0,this._startTaskRun()}},{key:"notifyWorkAvailable",value:function(){this._workAvailable=!0,_.Z.isLowImpact()&&!this._isRunning&&this._startTaskRun()}},{key:"_startTaskRun",value:function(){if(!this._isRunning&&!this._disabled&&this._workAvailable){try{_.Z.PAssert(1292,this._forceRun||_.Z.isLowImpact(),"Must always run a task during a low impact timeframe")}catch(e){_.Z.reportError(e)}this._workAvailable=!1,this._isRunning=!0,this._runCount++,this._taskCB(this._onTaskEndRun)}}},{key:"_onTaskEndRun",value:function(e){try{_.Z.PAssert(1293,this._isRunning,"Must be currently running task to finish")}catch(t){_.Z.reportError(t)}this._isRunning=!1,this._forceRun=!1,(e||this._workAvailable)&&(this._workAvailable=!0,_.Z.isLowImpact()&&this._startTaskRun())}}]),e}(),P()(Jt.prototype,"handleLowImpactBegin",[S.ZP],Object.getOwnPropertyDescriptor(Jt.prototype,"handleLowImpactBegin"),Jt.prototype),P()(Jt.prototype,"_onTaskEndRun",[S.ZP],Object.getOwnPropertyDescriptor(Jt.prototype,"_onTaskEndRun"),Jt.prototype),Jt);const tn=function(){function e(t,n,r,i,a,o){s()(this,e);try{_.Z.PAssert(1278,_.Z.isFunction(a),"Must supply a valid entry CB")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(1279,_.Z.isFunction(o),"Must supply a valid done CB")}catch(c){_.Z.reportError(c)}this._nextPageToken=t,this._inUse=!1,this._q=n,this._info=r,this._maxResults=i,this._entryCB=a,this._doneCB=o}return l()(e,[{key:"updateToken",value:function(e){try{_.Z.PAssert(1280,this._nextPageToken!==e,"Should never update token to be same value")}catch(t){_.Z.reportError(t)}this._nextPageToken=e}},{key:"getNextPageToken",value:function(){return this._nextPageToken}},{key:"getInfo",value:function(){return this._info}},{key:"getQuery",value:function(){return this._q}},{key:"getEntryCB",value:function(){return this._entryCB}},{key:"getDoneCB",value:function(){return this._doneCB}},{key:"getMaxResults",value:function(){return this._maxResults}},{key:"hasMorePages",value:function(){return!!this._nextPageToken}},{key:"notifyBeginUse",value:function(){try{_.Z.PAssert(1281,!this._inUse,"Should not currently be in use")}catch(e){_.Z.reportError(e)}this._inUse=!0}},{key:"notifyEndUse",value:function(){try{_.Z.PAssert(1282,this._inUse,"Should always be using token when done")}catch(e){_.Z.reportError(e)}this._inUse=!1}},{key:"isInUse",value:function(){return this._inUse}}]),e}();var nn=1,rn=2,an=3,on=4,sn=5,cn=6;const ln=function(){function e(t,n,r){s()(this,e),this.id=n,this._oldLocalID=void 0,this._plugin=t,this._loadState=nn,this._subscribers=[],this._countInUse=0,this._iteratingSubscribers=!1,this._numRemoteRequests=0,this._inlineData=r,this.load()}return l()(e,[{key:"load",value:function(e){this._loadState=rn,this._plugin.requestData(this,e)}},{key:"notifyDataRequested",value:function(){try{_.Z.PAssert(1217,!this.isLoaded(),"Should not request additional data once loaded")}catch(e){_.Z.reportError(e)}this._numRemoteRequests++,this._loadState=an}},{key:"notifyDataLoaded",value:function(e,t,n,r){try{_.Z.PAssert(1218,t||this._loadState!==sn||_.Z.isFlagSet(e,w.Z.PluginLoad.Full),"Should not load preview data after full data has been loaded")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(1219,!t||this._loadState===on||_.Z.isFlagSet(e,w.Z.PluginLoad.Full),"Incoming update much match previous type")}catch(i){_.Z.reportError(i)}this._loadState=_.Z.isFlagSet(e,w.Z.PluginLoad.Full)?sn:on,this.onUpdate(!0,n,r)}},{key:"notifyDataMutated",value:function(e,t){try{_.Z.PAssert(1220,e&&_.Z.isArray(e),"Must specify valid update fields when mutating attachment state manually")}catch(n){_.Z.reportError(n)}this.onUpdate(!0,e,t)}},{key:"notifyDataRequestFailed",value:function(){try{_.Z.PAssert(1221,this._loadState===cn||this._loadState===an||this._loadState===on,"Must be requesting remote data or a preview cache was able to service after the request was sent")}catch(e){_.Z.reportError(e)}if(this._loadState===cn);else if(this._loadState===an)this._loadState=cn;else if(this._loadState===on)try{_.Z.PAssert(1222,!1,"Failed remote reuqest but serviced by preview cache, should not have made the request?")}catch(e){_.Z.reportError(e)}else try{_.Z.PAssert(1223,!1,"Invalid loadstate when remote request failed: ",this._loadState)}catch(e){_.Z.reportError(e)}}},{key:"isLoaded",value:function(){return this._loadState===on||this._loadState===sn}},{key:"needsRemoteData",value:function(){return this._loadState!==sn}},{key:"getOldID",value:function(){return this._oldLocalID}},{key:"changeID",value:function(e){try{_.Z.PAssert(1224,this.id!==e,"Change the ID of an attachment to the same value")}catch(i){_.Z.reportError(i)}if(this.id!==e){var t=0,n=this.id;this.id=e,this._oldLocalID=n;try{_.Z.PAssert(1225,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(i){_.Z.reportError(i)}this._iteratingSubscribers=!0;for(var r=0;r<this._subscribers.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{this._subscribers[r].onAttachmentIDChange(this,n)}catch(a){_.Z.reportError(a)}}this._iteratingSubscribers=!1,this._oldLocalID=void 0}}},{key:"delayChangeID",value:function(){var e=0;try{_.Z.PAssert(1226,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(i){_.Z.reportError(i)}this._iteratingSubscribers=!0;for(var t=0;t<this._subscribers.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._subscribers[t];try{var r=n.onAttachmentIDChange.bind(n,this,this.id);setTimeout(r,0)}catch(a){_.Z.reportError(a)}}this._iteratingSubscribers=!1}},{key:"isFieldDefined",value:function(e){return this._plugin.isFieldDefined(e)}},{key:"hasField",value:function(e){return this._plugin.hasAttachField(this,e)}},{key:"getField",value:function(e){return this._plugin.getAttachField(this,e)}},{key:"updateField",value:function(e,t,n,r){return this._plugin.updateAttachField(this,e,t,n,r)}},{key:"updateInlineField",value:function(e,t){this._inlineData&&(this._inlineData[e]=t,this.onUpdate(!0,[e],w.Z.ChangeType.Local))}},{key:"fieldsHaveParseEffect",value:function(e){return this._plugin.fieldsHaveParseEffect(e)}},{key:"isFieldDefault",value:function(e){return this._plugin.isAttachFieldDefault(this,e)}},{key:"fieldNeedsWrite",value:function(e,t){return this._plugin.fieldNeedsWrite(this,e,t)}},{key:"getPlugin",value:function(){return this._plugin}},{key:"getData",value:function(){return this._plugin.getCacheData(this.id)}},{key:"getEmbedString",value:function(){return this._plugin.getAttachmentEmbedString(this)}},{key:"getTitleString",value:function(){return this._plugin.getAttachmentTitleString(this)}},{key:"unload",value:function(){this._loadState=nn,this._plugin.releaseAttachment(this)}},{key:"match",value:function(e){return!!this.isLoaded()&&this._plugin.matchAttachment(this,e)}},{key:"markInUse",value:function(e){0===this._countInUse&&this._plugin.notifyAttachmentInUse(this,e),this._countInUse++}},{key:"markUnused",value:function(e){this._countInUse--,0===this._countInUse&&this._plugin.notifyAttachmentUnused(this,e);try{_.Z.PAssert(1227,this._countInUse>=0,"Should never have negative users of the attachment")}catch(t){_.Z.reportError(t)}}},{key:"isInUse",value:function(){return this._countInUse>0}},{key:"subscribe",value:function(e){try{_.Z.PAssert(1228,this._subscribers.indexOf(e)<0,"Must not double subscribe")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(1229,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(1230,e.onAttachmentUpdate,"Must specify a valid subscriber callback")}catch(t){_.Z.reportError(t)}this._subscribers.push(e)}},{key:"unsubscribe",value:function(e){try{_.Z.PAssert(1232,this._subscribers.indexOf(e)>=0,"Subscriber should be active")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(1233,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(t){_.Z.reportError(t)}this._subscribers.remove(e)}},{key:"forEachItem",value:function(e,t){var n=0;try{_.Z.PAssert(1235,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(i){_.Z.reportError(i)}this._iteratingSubscribers=!0;for(var r=0;r<this._subscribers.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(_.Z.isVMLI(this._subscribers[r])&&(!e||this._subscribers[r].belongsToItemStore(e)))try{t(this._subscribers[r])}catch(a){_.Z.reportError(a)}}this._iteratingSubscribers=!1}},{key:"onUpdate",value:function(e,t,n){var r=0;try{_.Z.PAssert(1236,!t||_.Z.isArray(t),"Must supply a valid value for updateFields:",t)}catch(s){_.Z.reportError(s)}if(n=n||w.Z.ChangeType.Remote,e&&this.isInUse())try{this._plugin.notifyAttachmentUpdated(this)}catch(c){_.Z.reportError(c)}if(e||(n|=w.Z.ChangeType.PluginLoad),t)for(var i=0,a=0;a<t.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;try{_.Z.PAssert(1237,this._plugin.isFieldDefined(t[a]),"Invalid field supplied to be updated: ",t[a])}catch(s){_.Z.reportError(s)}}try{_.Z.PAssert(1238,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(s){_.Z.reportError(s)}this._iteratingSubscribers=!0;for(var o=0;o<this._subscribers.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;try{this._subscribers[o].onAttachmentUpdate(this,t,n)}catch(c){_.Z.reportError(c)}}this._iteratingSubscribers=!1}},{key:"notifyItemNoteChanged",value:function(e){this._plugin.notifyItemNoteChanged(this,e)}},{key:"notifyItemTextChanged",value:function(e,t){this._plugin.notifyItemTextChanged(this,e,t)}},{key:"notifyItemDateChanged",value:function(e){this._plugin.notifyItemDateChanged(this,e)}},{key:"notifyItemPropertyChanged",value:function(e,t,n){this._plugin.notifyItemPropertyChanged(this,e,t,n)}},{key:"isLocalOnlyAttachment",value:function(){return _.Z.isTempId(this.id)}},{key:"isType",value:function(e){return this._plugin.getType()===e}},{key:"isPlugin",value:function(e){return this._plugin.id===e}},{key:"shouldBeDeleted",value:function(){return this.isFieldDefined("isDeleted")&&this.hasField("isDeleted")&&this.getField("isDeleted")&&this.isLocalOnlyAttachment()}},{key:"hasFatalError",value:function(){return this._loadState===cn&&this._numRemoteRequests>3}},{key:"hasInlineData",value:function(){return!!this._inlineData}},{key:"getInlineData",value:function(){return this._inlineData}},{key:"setInlineData",value:function(e){this._inlineData=e,this._loadState=sn}},{key:"clearInlineData",value:function(){this._inlineData=void 0}}]),e}();var un,dn=[1,5,20,40,80,170],hn=[w.Z.HTTPStatusCode.Network,w.Z.HTTPStatusCode.Timeout,w.Z.HTTPStatusCode.TooMany,w.Z.HTTPStatusCode.ServerError,w.Z.HTTPStatusCode.BadGateway,w.Z.HTTPStatusCode.Unavailable,w.Z.HTTPStatusCode.GatewayTimeout,null],pn=[w.Z.HTTPStatusCode.Forbidden,w.Z.HTTPStatusCode.TooMany],fn={};fn[w.Z.PluginDependency.DemoMode]={online:!1},fn[w.Z.PluginDependency.PremiumSub]={online:!1},fn[w.Z.PluginDependency.EarlyAccess]={online:!1};var gn=w.Z.DETAILED_STATS,mn=(un=function(){function e(t,n,r,i,a){var o=this;s()(this,e);try{_.Z.PAssert(1044,t,"Must supply a valid id")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(1045,r,"Must supply a valid name")}catch(c){_.Z.reportError(c)}this.id=t,this.name=r,this.isBuiltin=i,this.DefaultRequestTimeout=_.Z.seconds(15),this.LongWaitThreshold=_.Z.seconds(7),this._paneType="Pane"+t,this._acProviderId="AC"+t,this._settingsGroup="plugin"+this.id,this.pluginMargin=12,this.pluginPadding=24,this.isActiveObs=new x.Z(!1),this._isReady=!1,this._hasDeactivated=!1,this._propertyDescriptors={},this._propertySets={},this._attachKeys=[],this._attachCache={},this._dataCache={},this._defaultItemStore=void 0,this._activeItemStore={},this._defaultZoomItems={},this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._isRateLimited=!1,this._lastRateLimitTime=void 0,this._numLongWaitRequests=0,this._numSendRequests=0,this._numHandledRequests=0,this._totalRequestSendTime=0,this._totalRequestHandleTime=0,this._requiresOfflineAuth=!1,this._activeAttachments=[],this._numActivePanes=0,this._requestCounter=0,this._unloadedDependencies=this.getDependencies(),this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._loadedInitialData=!1,this._hasLoadedCaches=!1,this._registeredCaches={},this._registeredModals={},this._createdModals={},this._recurringTasks=[],this._lowImpactTasks={},this._batchedResponses={},this._requestsInProgress={},this.Settings={},ve.Z.binder(this,"_retryRemoteRequest","_reqSortFn"),_o.settings.registerGroup(this._settingsGroup,n,a),this.registerSetting("IsEnabled","isEnabled","e",!0,i),this.getDataPane()&&oe.Z.registerPaneType(this,this._paneType,this.name,this.getDataPane(),this.getPaneIcon(),this.getPanePriority()),gn&&(this.__Stats={requestData:0,remoteRequests:0,canceledRequests:0,dupedRequests:0,combinedRequests:0,remoteBatches:0,remoteRetries:0,canceledBatches:0,actualRemoteCallsSent:0,cacheWrites:0,cacheUpdates:0,findByField:0,createdAttachments:0},this.__TrackedStats={},this.__ReqStats=[]),_o.settings.syncAccounts.listen(this._onSyncAccountsChanged),this.onSettingChanged(this.Settings.IsEnabled,(function(e,t){e&&_o.pluginManager.activatePlugin(o)}))}return l()(e,[{key:"getType",value:function(){return w.Z.PluginType.Unknown}},{key:"sendEvent",value:function(e,t){return _.Z.sendEvent(this.id,e,t)}},{key:"getSettingObs",value:function(e){return _o.settings[this._settingsGroup][e]}},{key:"getSetting",value:function(e){return _o.settings[this._settingsGroup][e].get()}},{key:"setSetting",value:function(e,t,n){return _o.settings[this._settingsGroup][e].set(t,n)}},{key:"registerSetting",value:function(e,t,n,r,i){this.Settings[e]=t,_o.settings.registerSetting(t,n,this._settingsGroup,r,i)}},{key:"onSettingChanged",value:function(e,t){_o.settings[this._settingsGroup][e].listen(t)}},{key:"getCacheStats",value:function(e){var t={},n=Object.keys(this._registeredCaches).length,r=0,i=function(i){t[i.id]=i,n===++r&&e(t)};if(n>0)for(var a in this._registeredCaches){if(this._registeredCaches.hasOwnProperty(a))this._registeredCaches[a].getStats(i)}else e()}},{key:"getCacheState",value:function(){var e={};for(var t in this._registeredCaches)if(this._registeredCaches.hasOwnProperty(t)){var n=this._registeredCaches[t];e[t]=n.getState()}return e}},{key:"registerLocalCache",value:function(e,t,n){var r=_o.cacheManager.registerLocalCache(e,t,n);return this._registeredCaches[e]=r,r}},{key:"registerDeferredTaskType",value:function(e,t,n,r){try{_.Z.PAssert(1046,e,"Must specify a valid deferred task type")}catch(i){_.Z.reportError(i)}_o.deferredTaskManager.registerTaskType(e,t,n,r)}},{key:"scheduleDeferredTask",value:function(e,t,n,r){try{_.Z.PAssert(1047,e,"Must supply a valid local ID for deferred task")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(1048,t,"Must specify a valid deferred task type")}catch(i){_.Z.reportError(i)}_o.deferredTaskManager.scheduleTask(e,t,n,!1,void 0,r)}},{key:"cancelDeferredTask",value:function(e,t){_o.deferredTaskManager.cancelTask(e,t)}},{key:"createRecurringTask",value:function(e,t){var n,r=this.id+"_"+e;return this.hasRecurringTask(e)?n=_o.recurringTaskManager.getRecurringTask(r):(this._recurringTasks.push(e),n=_o.recurringTaskManager.createRecurringTask(r,t)),n}},{key:"getRecurringTask",value:function(e){return _o.recurringTaskManager.getRecurringTask(this.id+"_"+e)}},{key:"hasRecurringTask",value:function(e){return _o.recurringTaskManager.hasRecurringTask(this.id+"_"+e)}},{key:"cancelRecurringTask",value:function(e){var t=this.id+"_"+e;return this._recurringTasks.remove(e),_o.recurringTaskManager.cancelRecurringTask(t)}},{key:"cancelRecurringTasks",value:function(){for(var e=0;this._recurringTasks.length>0;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.cancelRecurringTask(this._recurringTasks[0])}}},{key:"getRecurringStats",value:function(){for(var e=0,t={},n=0;n<this._recurringTasks.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this._recurringTasks[n],i=this.getRecurringTask(r);t[r]=i.getStats()}return t}},{key:"registerLowImpactTask",value:function(e,t){try{_.Z.PAssert(1049,!this._lowImpactTasks[e],"Must specify different IDs for each task: ",e)}catch(r){_.Z.reportError(r)}var n=new en(t);return this._lowImpactTasks[e]=n,n}},{key:"getLowImpactStats",value:function(){var e={};for(var t in this._lowImpactTasks)if(this._lowImpactTasks.hasOwnProperty(t)){var n=this._lowImpactTasks[t];e[t]=n.getStats()}return e}},{key:"getTrackedStat",value:function(e){if(gn)return this.__TrackedStats[e]}},{key:"addTrackedStat",value:function(e){if(gn){try{_.Z.PAssert(1050,!this.__TrackedStats.hasOwnProperty(e),"Should not double define a tracked stat for a plugin")}catch(t){_.Z.reportError(t)}this.__TrackedStats[e]=0}}},{key:"reportTrackedStat",value:function(e){if(gn){try{_.Z.PAssert(1051,this.__TrackedStats.hasOwnProperty(e),"Must first register a tracked stat before reporting instantces of it")}catch(t){_.Z.reportError(t)}this.__TrackedStats[e]++}}},{key:"getStats",value:function(){return{fnCalls:gn?this.__Stats:void 0,tracked:gn?this.__TrackedStats:void 0,remoteReqs:gn?this.__ReqStats:void 0,numItems:this._defaultItemStore?this._defaultItemStore.getCount():-1,activeAttachments:this._activeAttachments.length,numAttach:this._attachKeys.length,numSendRequests:this._numSendRequests,numHandledRequests:this._numHandledRequests,numLongWaitRequests:this._numLongWaitRequests,avgRequestSendTime:this._numSendRequests>0?this._totalRequestSendTime/this._numSendRequests:0,avgRequestHandleTime:this._numHandledRequests>0?this._totalRequestHandleTime/this._numHandledRequests:0,lowImpact:this.getLowImpactStats(),recurring:this.getRecurringStats()}}},{key:"getState",value:function(){return{isActive:this.isActiveObs.get(),isReady:this._isReady,isRateLimited:this._isRateLimited,hasDeactivated:this._hasDeactivated,numOutstandingReqs:this._numOutstandingReqs,numPendingReqs:this._pendingRequests.length,numActivePanes:this._numActivePanes,unloadedDeps:this._unloadedDependencies,isFirstLoad:this._isFirstLoad,hasRunOfflineLoad:this._hasRunOfflineLoad,loadedInitialData:this._loadedInitialData,hasLoadedCaches:this._hasLoadedCaches,cacheState:this.getCacheState()}}},{key:"isPluginPane",value:function(e){return e.type===this._paneType}},{key:"getPaneType",value:function(){return this._paneType}},{key:"activate",value:function(e){var t=this.isActiveObs.get();if(t||(this.isActiveObs.set(!0),this.useItemStore()&&(this._defaultItemStore=_o.itemStoreManager.registerItemStore(this.id,this,this.itemStoreOptions()),this._defaultItemStore.createRoot(this.isActive()?this.useItemStore():this.id+"Root","")),this._hasLoadedCaches||(this.supportUsageCache()&&_.Z.shouldWriteLocal()&&this.loadUsageCache(),this._hasLoadedCaches=!0),this.ensurePaneTypeIsActive()),this._unloadedDependencies)for(var n in e)e.hasOwnProperty(n)&&this.onDependencyLoaded(n,e[n]);return this._unloadedDependencies&&0!==this._unloadedDependencies.length||this.onAllDependenciesLoaded(),this._activate&&this._activate(),t||_o.pluginManager.fireEvent("pluginActiveChanged",this.id,"activated",[this,!0]),!t}},{key:"deactivate",value:function(){try{_.Z.PAssert(1052,this.isActiveObs.get(),"Must be active in order to deactivate pane")}catch(e){_.Z.reportError(e)}return this.isActiveObs.set(!1),_o.pluginManager.fireEvent("pluginActiveChanged",this.id,"deactivated",[this,!1]),this.getDataPane()&&oe.Z.deactivatePaneType(this._paneType),this.useItemStore()&&(_o.itemStoreManager.unregisterItemStore(this.id),this._defaultItemStore=void 0),this.cancelRecurringTasks(),this._loadedInitialData=!1,this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._hasDeactivated=!0,this._deactivate&&this._deactivate(),!0}},{key:"ensurePaneTypeIsActive",value:function(){this.getDataPane()&&!oe.Z.isPaneTypeActive(this._paneType)&&(this.getSetting(this.Settings.IsEnabled)||_.Z.isDemoMode())&&oe.Z.activatePaneType(this._paneType)}},{key:"isActive",value:function(){return this.isActiveObs.get()}},{key:"isReady",value:function(){return this._isReady}},{key:"isEnabled",value:function(){return _.Z.isDemoMode()&&this.id!==w.Z.PluginID.Gmail||this.isAvailable()&&this.getSetting(this.Settings.IsEnabled)}},{key:"isAvailable",value:function(){return!0}},{key:"isOn",value:function(){return this.isActive()&&!this.isPluginBlocked()}},{key:"hasSettingsError",value:function(){return!1}},{key:"isSyncAccountEnabled",value:function(e){if(!e)return!1;var t=_o.settings.syncAccounts.get();if(t){var n=t[e];return n&&n[this.id]}}},{key:"isCurrentlyAuthorized",value:function(e){var t=this.googleScopes();return!t||ie.Z.isAuthorizedForScopes(e,t)}},{key:"shouldUseNewEmailPlugin",value:function(e){var t=e.getInlineData();return!(!t||"Email"!==t.p&&!t.accountID)||!!Ue.Z.getPluginData(e.id)}},{key:"onAuthorized",value:function(e){this._pendingRequests.length>0&&_o.pluginManager.notifyHasPendingRemoteRequest()}},{key:"verifyAuthorization",value:function(e){return!0}},{key:"notifyUnauthorized",value:function(e,t){}},{key:"isOnline",value:function(){return _o.pluginManager.isOnline()}},{key:"goOnline",value:function(){}},{key:"onDocumentShared",value:function(e){}},{key:"onShutdown",value:function(){}},{key:"onDependencyLoaded",value:function(e,t){if(this._unloadedDependencies){var n=this._unloadedDependencies.indexOf(e);if(n>=0&&(_.Z.shouldLog(w.Z.LogLevels.Plugin)&&_.Z.log("Plugin Dependency Loaded: ",this.id,e),this._unloadedDependencies.removeAt(n),e===w.Z.PluginDependency.PremiumSub&&this.ensurePaneTypeIsActive()),0===this._unloadedDependencies.length)this._unloadedDependencies=void 0,this.onAllDependenciesLoaded();else if(this.supportOfflineLoad()&&!this._hasRunOfflineLoad){for(var r=0,i=!1,a=0;a<this._unloadedDependencies.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=this._unloadedDependencies[a];fn[o].online||(i=!0)}!i&&this.isActiveObs.get()&&this.offlineLoad()}}}},{key:"onAllDependenciesLoaded",value:function(){this.isActiveObs.get()&&(_.Z.shouldLog(w.Z.LogLevels.Plugin)&&_.Z.log("Plugin All Dependencies Loaded: ",this.id),this._isReady=!0,this._updateAttachmentStates(),this.offlineLoad(),this.load())}},{key:"areDependenciesLoaded",value:function(){return void 0===this._unloadedDependencies}},{key:"hasDependencyBeenLoaded",value:function(e){var t=!1;return this.hasDependency(e)&&(this.getUnloadedDependencies()?this.getUnloadedDependencies().indexOf(e)<0&&(t=!0):t=!0),t}},{key:"getUnloadedDependencies",value:function(){return this._unloadedDependencies}},{key:"areRemoteAPIsLoaded",value:function(){return!0}},{key:"forceLoad",value:function(){this._loadedInitialData=!1,this.activate({}),this._unloadedDependencies&&(this._unloadedDependencies=void 0,this.onAllDependenciesLoaded())}},{key:"hasDependency",value:function(e){var t=this.getDependencies();return!!t&&t.indexOf(e)>=0}},{key:"migrateOldOfflineCache",value:function(){if(this.supportUsageCache()&&_.Z.shouldWriteLocal()){var e="ocache_"+this.id,t=be.Z.getLegacyLocalStorage(e);if(t)try{var n=JSON.parse(t);if(n){var r=0;try{_.Z.PAssert(1053,n,"Must provide a valid dataset to load")}catch(l){_.Z.reportError(l)}n.props;var i=n.data;try{_.Z.PAssert(1054,i,"Load object must contain valid data")}catch(l){_.Z.reportError(l)}for(var a=Object.keys(i),o=0;o<a.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=a[o],c=this.createEntryFromLocal(s,i[s]);c.id=s,be.Z.savePluginUsage(this.id,c)}be.Z.deleteLegacyLocalStorage(e)}}catch(u){_.Z.reportError(u)}else _.Z.shouldLog(w.Z.LogLevels.Plugin)&&_.Z.log("No offline cache present: ",this.id)}}},{key:"loadUsageCache",value:function(){var e=this;if(this.supportUsageCache()&&_.Z.shouldWriteLocal()){this.migrateOldOfflineCache();var t=be.Z.getPluginTableUsage(this.id);t&&Object.keys(t).forEach((function(n){var r=e.createEntryFromLocal(n,t[n]);e._dataCache[n]=r,e.loadFromUsageCache&&e.loadFromUsageCache(r)}))}}},{key:"loadFromUsageCache",value:function(e){}},{key:"supportOfflineLoad",value:function(){return!1}},{key:"supportUsageCache",value:function(){return!1}},{key:"createEntryFromLocal",value:function(e,t){try{_.Z.PAssert(1055,!1,"SubClass must override createEntryFromLocal",this.id)}catch(n){_.Z.reportError(n)}}},{key:"clearData",value:function(){for(var e=0,t=0;t<this._attachKeys.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._attachCache[this._attachKeys[t]].unload()}this._attachKeys=[],this._attachCache={},this._dataCache={},this.useItemStore()&&(this.getDefaultItemStore().clearStore(),this._activeItemStore={}),this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._activeAttachments=[]}},{key:"onCacheLimitExceeded",value:function(){for(var e in this._registeredCaches)if(this._registeredCaches.hasOwnProperty(e)){var t=this._registeredCaches[e];t.usesDiskSpace()&&t.clearCache()}}},{key:"changeID",value:function(e,t,n){try{_.Z.PAssert(1056,t!==n,"Should never be switching to the same ID")}catch(o){_.Z.reportError(o)}if(this._attachCache[n])e.delayChangeID(),delete this._attachCache[t],this._attachKeys.remove(t),delete this._dataCache[t];else{var r=this._attachCache[t];try{_.Z.PAssert(1057,e===r,"Attach entries must match")}catch(o){_.Z.reportError(o)}r&&(delete this._attachCache[t],this._attachCache[n]=r,this._attachKeys.remove(t),this._attachKeys.push(n));var i=this._dataCache[t];delete this._dataCache[t],i&&(i.id===t&&(i.id=n),this._dataCache[n]=i);var a=e.isLocalOnlyAttachment();e.isInUse()&&a&&this.deleteAttachmentFromUsageCache(e),e.changeID(n),e.isInUse()&&a&&this.saveAttachmentToUsageCache(e)}}},{key:"_isFullData",value:function(e){for(var t=0,n=this.getPropertySet(w.Z.PluginLoad.Full),r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!this.getPropertyDescriptor(n[r]).isOpt&&!e.hasOwnProperty(n[r]))return!1}return!0}},{key:"cacheData",value:function(e,t,n,r,i){try{_.Z.PAssert(1058,e,"Must supply a valid key for data")}catch(s){_.Z.reportError(s)}if(gn&&this.__Stats.cacheWrites++,this._dataCache[e]=t,this._attachCache[e]){var a=this._attachCache[e],o=this._getPluginLoadType(t);try{_.Z.PAssert(1060,o,"Must contain valid full data")}catch(s){_.Z.reportError(s)}a.notifyDataLoaded(o,n,r,i)}}},{key:"getCacheData",value:function(e){var t=Ue.Z.getPluginDataTranslated(e);return!t||this._dataCache[e]&&this.isSyncAccountEnabled(this._dataCache[e].accountID)?this._dataCache[e]:t}},{key:"_attachMetadataFields",value:function(){}},{key:"fieldsHaveParseEffect",value:function(e){var t=!1;if(e){var n=this._attachMetadataFields();if(n)for(var r=0,i=0;i<e.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(n.indexOf(e[i])<0){t=!0;break}}else t=!0}else t=!0;return t}},{key:"isFieldDefined",value:function(e){return!!this.getPropertyDescriptor(e)}},{key:"hasAttachField",value:function(e,t){var n=!1,r=this.getCacheData(e.id);if(r&&r.hasOwnProperty(t))n=!0;else{var i=this.getPropertyDescriptor(t);try{_.Z.PAssert(1062,i,"Must have a valid field descriptor",t)}catch(o){_.Z.reportError(o)}if(i&&i.isOpt)n=!0;else{var a=e.getInlineData();a&&a.hasOwnProperty(t)&&void 0!==a[t]&&(n=!0)}}return n}},{key:"getAttachField",value:function(e,t){var n,r=this.getCacheData(e.id);if(r&&r.hasOwnProperty(t))n=r[t];else{var i=this.getPropertyDescriptor(t);try{_.Z.PAssert(1063,i,"Must have a valid field descriptor",t)}catch(o){_.Z.reportError(o)}var a=e.getInlineData();n=a&&a.hasOwnProperty(t)?a[t]:i?i.defaultValue:void 0}return n}},{key:"updateAttachField",value:function(e,t,n,r,i){var a=!1;try{_.Z.PAssert(1065,this.isFieldDefined(t),"Must be updating a valid attachment field")}catch(c){_.Z.reportError(c)}var o=this.getCacheData(e.id);try{_.Z.PAssert(1066,o,"Invalid field request: ",this.id,t)}catch(c){_.Z.reportError(c)}o&&((i||this.dataFieldNeedsWrite(o,t,n))&&(o[t]=n,this.cacheData(e.id,o,!0,[t])),a=!0);var s=e.getInlineData();if(s&&s.hasOwnProperty(t)&&!r)try{_.Z.PAssert(1069,s[t]===n,"Should never change inline field value")}catch(c){_.Z.reportError(c)}return a}},{key:"isAttachFieldDefault",value:function(e,t){var n=!1,r=this.getCacheData(e.id);try{_.Z.PAssert(1070,r,"Invalid field request: ",this.id,t)}catch(a){_.Z.reportError(a)}if(r){var i=this.getPropertyDescriptor(t);try{_.Z.PAssert(1071,i,"Must have a valid field descriptor",t)}catch(a){_.Z.reportError(a)}r.hasOwnProperty(t)?i&&i.isOpt&&i.defaultValue===r[t]&&(n=!0):i&&i.isOpt&&(n=!0)}return n}},{key:"fieldNeedsWrite",value:function(e,t,n){var r=this.getCacheData(e.id);try{_.Z.PAssert(1072,r,"Invalid field request: ",this.id,t)}catch(i){_.Z.reportError(i)}return this.dataFieldNeedsWrite(r,t,n)}},{key:"dataFieldNeedsWrite",value:function(e,t,n){var r=!1;if(e){var i=this.getPropertyDescriptor(t);try{_.Z.PAssert(1073,i,"Must have a valid field descriptor",t)}catch(o){_.Z.reportError(o)}var a=this.compactCacheField(e,t);e.hasOwnProperty(t)?void 0===n&&a===i.defaultValue||(i&&i.comparator?i.comparator(a,n)||(r=!0):(a!==n||_.Z.isObject(a)||_.Z.isObject(n)||_.Z.isArray(a)||_.Z.isArray(n))&&(r=!0)):void 0!==n&&(i&&i.isOpt&&i.defaultValue===n||(r=!0))}return r}},{key:"hasCacheData",value:function(e){return!!this._dataCache[e]}},{key:"findCachedItemsByField",value:function(e,t,n){var r=this;gn&&this.__Stats.findByField++;var i=[];return Object.keys(this._dataCache).some((function(a){var o=r._dataCache[a];if(o&&o[e]===t&&(i.push(o),i.length>=n))return!0})),i}},{key:"findCachedItemsByFn",value:function(e,t){var n=this;try{_.Z.PAssert(1074,e,"Must supply a valid match function")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(1075,_.Z.isFunction(e),"Match function must be a valid function")}catch(i){_.Z.reportError(i)}gn&&this.__Stats.findByFn++;var r=[];return Object.keys(this._dataCache).some((function(i){var a=n._dataCache[i];if(e(a)&&(r.push(a),r.length>=t))return!0})),r}},{key:"notifyAttachmentInUse",value:function(e,t){try{_.Z.PAssert(1076,this._activeAttachments.indexOf(e)<0,"Attachment should not already be active")}catch(n){_.Z.reportError(n)}this._activeAttachments.push(e),_.Z.isLocalChange(t)&&this.supportUsageCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.saveAttachmentToUsageCache(e,!0)}},{key:"notifyAttachmentUpdated",value:function(e){this.supportUsageCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.saveAttachmentToUsageCache(e)}},{key:"notifyAttachmentUnused",value:function(e,t){try{_.Z.PAssert(1077,this._activeAttachments.indexOf(e)>=0,"Attachment should be marked active")}catch(n){_.Z.reportError(n)}this._activeAttachments.remove(e),_.Z.isLocalChange(t)&&this.supportUsageCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.deleteAttachmentFromUsageCache(e)}},{key:"onAuthorizedSetting",value:function(e,t){}},{key:"notifyItemNoteChanged",value:function(e,t){}},{key:"notifyItemDateChanged",value:function(e,t){}},{key:"notifyItemTextChanged",value:function(e,t,n){}},{key:"notifyItemPropertyChanged",value:function(e,t,n,r){}},{key:"getAttachment",value:function(e,t){try{_.Z.PAssert(1078,e,"Must provide a valid key")}catch(n){_.Z.reportError(n)}return e&&(this._attachCache[e]?t&&!this._attachCache[e].hasInlineData()&&this._attachCache[e].setInlineData(t):(this._attachCache[e]=this._requestAttachment(e,t),this._attachKeys.push(e))),this._attachCache[e]}},{key:"hasAttachment",value:function(e){return!!this._attachCache[e]}},{key:"forEachActiveAttachment",value:function(e){for(var t=0,n=0;n<this._activeAttachments.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e(this._activeAttachments[n])}}},{key:"forEachAttachment",value:function(e){for(var t=0,n=0;n<this._attachKeys.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e(this._attachCache[this._attachKeys[n]])}}},{key:"numActiveAttachments",value:function(){return this._activeAttachments.length}},{key:"getAttachmentEmbedString",value:function(e){for(var t,n=0,r=(null===(t=e.getInlineData())||void 0===t?void 0:t.p)||this.id,i=w.Z.EmbedAttachChar+"p:"+r+",id:"+e.id,a=this.getPropertySet(w.Z.PluginLoad.Inline),o=0;o<a.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=a[o],c=this.getPropertyDescriptor(s),l=encodeURIComponent(e.getField(s));try{_.Z.PAssert(1079,c.isOpt||l&&l.indexOf(":")<0&&l.indexOf(" ")<0,"Property value is invalid: "+s+", "+l)}catch(u){_.Z.reportError(u)}void 0!==l&&"undefined"!==l&&(i+=","+s+":"+l)}return i+=w.Z.EmbedAttachChar}},{key:"getAttachmentTitleString",value:function(e){return this.getUnstyledText(e)}},{key:"_getTextForItem",value:function(e,t){try{_.Z.PAssert(1080,e,"Must pass in a valid item to get text for")}catch(n){_.Z.reportError(n)}return _.Z.isString(e),w.Z.EmbedAttachChar+"p:"+this.id+",id:"+e+(t?",accountID:"+t:"")+w.Z.EmbedAttachChar}},{key:"_requestAttachment",value:function(e,t){try{_.Z.PAssert(1081,e,"Must provide a valid key")}catch(n){_.Z.reportError(n)}return gn&&this.__Stats.createdAttachments++,new ln(this,e,t)}},{key:"releaseAttachment",value:function(e){}},{key:"saveAttachmentToUsageCache",value:function(e,t){this.supportUsageCache()&&_.Z.shouldWriteLocal()&&!this.shouldUseNewEmailPlugin(e)&&(t&&be.Z.getPluginUsage(this.id,e.id)||be.Z.savePluginUsage(this.id,this.serializeEntry(e.id)))}},{key:"deleteAttachmentFromUsageCache",value:function(e){this.supportUsageCache()&&_.Z.shouldWriteLocal()&&be.Z.deletePluginUsage(this.id,e.id)}},{key:"dataHasChanged",value:function(e,t){for(var n=0,r=!e,i=this.getPropertySet(w.Z.PluginLoad.Full),a=0;!r&&a<i.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=i[a];this.dataFieldNeedsWrite(e,o,t[o])&&(r=!0)}return r}},{key:"getChangedFields",value:function(e,t){for(var n=0,r=[],i=this.getPropertySet(w.Z.PluginLoad.Full),a=0;a<i.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=i[a];this.dataFieldNeedsWrite(e,o,t[o])&&r.push(o)}return r}},{key:"matchAttachment",value:function(e,t){try{_.Z.PAssert(1082,!1,"SubClass must override matchAttachment",this.id)}catch(n){_.Z.reportError(n)}}},{key:"getStyledText",value:function(e,t,n,r){try{_.Z.PAssert(1083,!1,"SubClass must override getStyledText",this.id)}catch(i){_.Z.reportError(i)}return""}},{key:"getUnstyledText",value:function(e,t){try{_.Z.PAssert(1084,!1,"SubClass must override getUnstyledText",this.id)}catch(n){_.Z.reportError(n)}return""}},{key:"getRichText",value:function(e){try{_.Z.PAssert(1085,!1,"SubClass must override getRichText",this.id)}catch(t){_.Z.reportError(t)}return""}},{key:"getBlockedText",value:function(e){return"Blocked"}},{key:"getDisplayText",value:function(e,t){return this.getUnstyledText(e,t)}},{key:"createDisplayElement",value:function(e){var t=this.getAttachmentClass(e);try{_.Z.PAssert(1086,_.Z.isArray(t),"Must have a valid class list")}catch(a){_.Z.reportError(a)}try{_.Z.PAssert(1087,t.indexOf("plugin")<0,"Should not already have plugin as a class")}catch(a){_.Z.reportError(a)}t.push("plugin pressable"),"Date"!==this.id&&t.push("inlineBordered inlineBorderedBG"),this.isPluginBlocked()&&t.push("blocked");var n=this.getDisplayText(e),r={attrs:{cls:t,plugin:this.id,"plugin-id":e.id},text:n},i=this.getAttachmentTooltip(e);return i&&(r.attrs["data-tooltip"]=i),r}},{key:"getAttachmentClass",value:function(e){return[]}},{key:"getAttachmentTooltip",value:function(e){}},{key:"isPluginBlocked",value:function(){return!1}},{key:"_displayMissingProperties",value:function(e,t,n){var r=0,i=!1,a=this.getPropertySet(n);_.Z.log("Displaying Missing Properties: ",e);for(var o=0;o<a.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this.getPropertyDescriptor(a[o]).isOpt||t.hasOwnProperty(a[o])||(_.Z.log(" Missing Property: ",a[o]),i=!0)}try{_.Z.PAssert(1088,i,"Must be missing props to run this")}catch(s){_.Z.reportError(s)}}},{key:"_getPluginLoadType",value:function(e){try{_.Z.PAssert(1089,e,"Must be querying loaded data for load state with valid data")}catch(n){_.Z.reportError(n)}var t=w.Z.PluginLoad.None;return this._isFullData(e)&&(t|=w.Z.PluginLoad.Full),t}},{key:"requestData",value:function(e,t){var n=this;gn&&this.__Stats.requestData++,t=t||w.Z.PluginLoad.Full;var r,i=this.getCacheData(e.id);i?(r=this._getPluginLoadType(i),_.Z.isFlagSet(r,t)?e.notifyDataLoaded(r,!1,void 0,w.Z.ChangeType.Remote):(_.Z.forEachFlagSet(t,(function(t){n._displayMissingProperties(e.id,i,t)})),!e.isLocalOnlyAttachment()&&this.allowRemoteRequests()&&this._getRemoteAttachmentData(e,t))):e.isLocalOnlyAttachment()||(r=w.Z.PluginLoad.None,this.allowRemoteRequests()&&!_.Z.isFlagSet(r,t)&&this._getRemoteAttachmentData(e,t))}},{key:"_getRemoteAttachmentData",value:function(e,t){this.getRemoteAttachmentData(e,t)}},{key:"getRemoteAttachmentData",value:function(e,t){try{_.Z.PAssert(1090,!1,"SubClass must override getRemoteAttachmentData",this.id)}catch(n){_.Z.reportError(n)}}},{key:"_appendDupeRequest",value:function(e,t){try{_.Z.PAssert(1091,e,"Must provide a valid queued request")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(1092,t,"Must provide a valid duped request")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(1093,!e.duped,"Must never use an already duped request as a dupe for another request")}catch(n){_.Z.reportError(n)}t.attach&&(e.attach||(e.attach=[]),e.attach.pushOnlyUniques(t.attach)),e.successCB.pushOnlyUniques(t.successCB),e.failureCB.pushOnlyUniques(t.failureCB)}},{key:"_areRequestFnsEqual",value:function(e,t){var n=!1;return e===t?n=!0:_.Z.isArray(e)&&_.Z.isArray(t)&&(n=e.equals(t)),n}},{key:"_areRequestsEqual",value:function(e,t){try{_.Z.PAssert(1094,e,"Must have a valid request A")}catch(a){_.Z.reportError(a)}try{_.Z.PAssert(1095,t,"Must have a valid request B")}catch(a){_.Z.reportError(a)}var n=!0;if(e.accountID!==t.accountID)n=!1;else if(e.forceNoDupe||t.forceNoDupe)n=!1;else if(e.id!==t.id&&this._areRequestFnsEqual(e.requestFn,t.requestFn))if(e.data===t.data)n=!0;else{for(var r in e.data){if(!e.data.hasOwnProperty(r)||!t.data.hasOwnProperty(r)){n=!1;break}if(e.data[r]!==t.data[r]){n=!1;break}}if(n)for(var i in t.data){if(!e.data.hasOwnProperty(i)||!t.data.hasOwnProperty(i)){n=!1;break}if(e.data[i]!==t.data[i]){n=!1;break}}}else n=!1;return n}},{key:"_getDupeRequest",value:function(e){for(var t,n=0,r=0,i=0;!t&&i<this._outstandingRequests.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;!this._outstandingRequests[i].duped&&this._areRequestsEqual(this._outstandingRequests[i],e)&&(t=this._outstandingRequests[i])}for(var a=0;!t&&a<this._pendingRequests.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;!this._pendingRequests[a].duped&&this._areRequestsEqual(this._pendingRequests[a],e)&&(t=this._pendingRequests[a])}return t}},{key:"_combineRequest",value:function(e,t){try{_.Z.PAssert(1096,e,"Must provide a valid queued request")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(1097,t,"Must provide a valid combine request")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(1098,!e.combined,"Must never use an already combined request as a target for another request")}catch(n){_.Z.reportError(n)}e.data=_.Z.merge(e.data,t.data),e.successCB.pushOnlyUniques(t.successCB),e.failureCB.pushOnlyUniques(t.failureCB)}},{key:"_areRequestsCombinable",value:function(e,t){try{_.Z.PAssert(1099,e,"Must have a valid request A")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(1100,t,"Must have a valid request B")}catch(r){_.Z.reportError(r)}var n=!1;return e.id!==t.id&&e.combinable&&t.combinable&&e.accountID===t.accountID&&this._areRequestFnsEqual(e.requestFn,t.requestFn)&&e.type===t.type&&(e.attach||t.attach?e.attach&&t.attach&&e.attach.equals(t.attach)&&(n=!0):n=!0),n}},{key:"_getCombineRequest",value:function(e){var t;if(e.combinable)for(var n=0,r=0;!t&&r<this._pendingRequests.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;!this._pendingRequests[r].combined&&this._areRequestsCombinable(this._pendingRequests[r],e)&&(t=this._pendingRequests[r])}return t}},{key:"_handleBatchRequestResponse",value:function(e){this._numOutstandingReqs--;try{_.Z.PAssert(1101,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(t){_.Z.reportError(t)}}},{key:"_handleRequestResponse",value:function(e,t){if(!t){this._numOutstandingReqs--;try{_.Z.PAssert(1102,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(n){_.Z.reportError(n)}}}},{key:"_queueRemoteRequestMulti",value:function(){var e=a()(k().mark((function e(t,n,r,i,a,o,s,c){var l,u=this;return k().wrap((function(e){for(var d=0;;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(e.prev=e.next){case 0:try{_.Z.PAssert(1103,t,"Missing accountID parameter")}catch(h){_.Z.reportError(h)}try{_.Z.PAssert(1104,!_.Z.isArray(t),"Missing accountID paramter")}catch(h){_.Z.reportError(h)}try{_.Z.PAssert(1105,!_.Z.isFunction(t),"Missing accountID parameter")}catch(h){_.Z.reportError(h)}try{_.Z.PAssert(1106,!c||void 0===c.accountID,"AccountID is specified as a separate param")}catch(h){_.Z.reportError(h)}return(l=c?_.Z.clone(c):{}).accountID=t,e.next=8,_.Z.promisify((function(e){ie.Z.getAccountAuthToken(t,u.googleScopes(),e)}));case 8:return e.abrupt("return",this._queueRemoteRequest(n,r,i,a,o,s,l));case 9:case"end":return e.stop()}}}),e,this)})));return function(t,n,r,i,a,o,s,c){return e.apply(this,arguments)}}()},{key:"_queueRemoteRequest",value:function(){var e=a()(k().mark((function e(t,n,r,i,a,o,s){var c,l;return k().wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(c=t.join("")+JSON.stringify(n)+JSON.stringify(s||{}),this._requestsInProgress[c]){e.next=25;break}try{_.Z.PAssert(1107,r,"Must supply a callback for request success")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(1108,_.Z.isFunction(r),"Success callback must be a valid function")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(1109,i,"Must supply a callback for request failure")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(1110,_.Z.isFunction(i),"Failure callback must be a valid function")}catch(d){_.Z.reportError(d)}s=s||{};try{_.Z.PAssert(1111,t&&_.Z.isArray(t),"RequestFn must be a valid packed function")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(1112,n,"Must provide valid data for the request")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(1114,o,"Request type must be specified")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(1115,s.accountID||s.token,"Must have an accountID")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(1116,!s.combinable,"Combinable is not currently a valid option. Do not use.")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(1117,!a||!a.isLocalOnlyAttachment(),"Must either specify a valid remote attachment or none at all",a?a.id:"UNDEFINED")}catch(d){_.Z.reportError(d)}if(!s.accountID||this.hasSyncAccount(s.accountID)){e.next=16;break}return e.abrupt("return");case 16:s.token&&!s.accountID&&(s.accountID="from_token"),gn&&(this.__ReqStats[o]=this.__ReqStats[o]?this.__ReqStats[o]+1:1),l={id:++this._requestCounter,plugin:this,attach:a?[a]:void 0,request:void 0,requestFn:t,data:n,successCB:[r],failureCB:[i],type:o,queueTime:Date.now(),sendTimes:[],handleTimes:[],handled:!1,failed:!1,duped:!1,canceled:!1,timedOut:!1,wasBatched:!1,batchID:void 0,batchRequestID:void 0,noBatch:s.noBatch,requestsBehind:this._pendingRequests.length,token:s.token,accountID:s.accountID,scopes:this.googleScopes(),combinable:s.combinable,forceNoDupe:s.forceNoDupe,priority:s.priority?s.priority:w.Z.RequestPriority.Default},_.Z.shouldLog(w.Z.LogLevels.Plugin)&&_.Z.log("Request Queued: ",this.name,o,l.id,l),this._insertPendingRequest(l),_o.pluginManager.notifyHasPendingRemoteRequest();case 25:case"end":return e.stop()}}}),e,this)})));return function(t,n,r,i,a,o,s){return e.apply(this,arguments)}}()},{key:"_insertPendingRequest",value:function(e){e.priority++;var t=this._pendingRequests.insertSorted(e,this._reqSortFn);return e.priority--,t}},{key:"_reqSortFn",value:function(e,t){return e.priority===t.priority?0:e.priority<t.priority?-1:1}},{key:"_queuePagedRemoteRequestMulti",value:function(e,t,n,r,i,a,o,s){try{_.Z.PAssert(1118,e,"Missing accountID parameter")}catch(l){_.Z.reportError(l)}try{_.Z.PAssert(1119,!_.Z.isArray(e),"Missing accountID paramter")}catch(l){_.Z.reportError(l)}try{_.Z.PAssert(1120,!_.Z.isFunction(e),"Missing accountID parameter")}catch(l){_.Z.reportError(l)}try{_.Z.PAssert(1121,!s||void 0===s.accountID,"AccountID is specified as a separate param")}catch(l){_.Z.reportError(l)}var c=s?_.Z.clone(s):{};return c.accountID=e,this._queuePagedRemoteRequest(t,n,r,i,a,o,c)}},{key:"_queuePagedRemoteRequest",value:function(e,t,n,r,i,a,o){var s=this;try{_.Z.PAssert(1122,o,"Must supply a valid options param")}catch(f){_.Z.reportError(f)}try{_.Z.PAssert(1123,!o.getAllPages||!o.maxPages,"Should only define either maxPages or getAllPages: ",o.getAllPages,o.maxPages)}catch(f){_.Z.reportError(f)}o.maxPages=o.maxPages||1,o.getAllPages=o.getAllPages||!1,o.maxPageResults=o.maxPageResults||o.maxResults||(o.maxResults?o.maxResults:100),o.maxResults=o.maxResults||1/0,o.resultsField=o.resultsField||"items";var c=0,l=[],u=_.Z.clone(t);u.maxResults=o.maxPageResults,u.pageSize=o.maxPageResults;var d=function(e){e[o.resultsField]?l.pushArray(e[o.resultsField]):e.items?l.pushArray(e.items):e.history&&l.pushArray(e.history),e.nextPageToken&&(o.getAllPages||o.maxPages>c)&&l.length<o.maxResults?p(e.nextPageToken):e.nextPageToken||e.nextSyncToken||e.historyId?n(l,t,e):n(l)},h=function(e){var t,n;null!==e&&void 0!==e&&null!==(t=e.error)&&void 0!==t&&null!==(n=t.message)&&void 0!==n&&n.startsWith("Request had invalid authentication credentials.")||r(e,l)},p=function(t){t&&(u.pageToken=t),c++,s._queueRemoteRequest(e,u,d,h,void 0,a,o)};p()}},{key:"_retryRemoteRequest",value:function(e,t){var n=this;_.Z.shouldLog(w.Z.LogLevels.Plugin)&&_.Z.log("Request Re-Queued: ",this.name,e.type,e.id,e),gn&&this.__Stats.remoteRetries++,e.request=void 0,e.wasBatched=void 0,e.batchID=void 0,e.batchRequestID=void 0,setTimeout((function(){e.currentRetries=e.currentRetries?e.currentRetries+1:1,n._insertPendingRequest(e),_o.pluginManager.notifyHasPendingRemoteRequest()}),this._getRetryDelay(e,t))}},{key:"getNumOutstandingReqs",value:function(){return this._numOutstandingReqs}},{key:"_pumpRequestQueue",value:function(e,t,n,r){var i=0,a=0,o=this;try{_.Z.PAssert(1124,this.areRemoteAPIsLoaded(),"Must have loaded remote APIs before pumping the request queue")}catch(A){_.Z.reportError(A)}var s=0,c=0,l=0,u=0,d=0,h=0,p=0;try{_.Z.PAssert(1125,this._numOutstandingReqs>=0,"Should never have fewer than zero outstanding requests")}catch(A){_.Z.reportError(A)}var f=t;try{_.Z.PAssert(1126,f>0,"Should never have more than max outstanding requests for a given plugin")}catch(A){_.Z.reportError(A)}for(var g={},m=this._pendingRequests.filter((function(e){return!e.noBatch})),v=f>1&&m.length>1,y=[],k=0;f>0&&k<this._pendingRequests.length&&p<w.Z.MaxBatchSize;++k){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var Z=this._pendingRequests[k],b=void 0;if(v&&!Z.noBatch&&((b=g[Z.accountID])||(b=g[Z.accountID]=this.createBatch({accountID:Z.accountID,scopes:Z.scopes}))),Z.priority<e)h++;else{_.Z.shouldLog(w.Z.LogLevels.Plugin)&&_.Z.log("Request Pumped: ",this.name,Z.type,Z.id,Z);try{_.Z.PAssert(1127,!_.Z.isFunction(Z),"Should never use a deferred request")}catch(A){_.Z.reportError(A)}try{_.Z.PAssert(1128,!1===Z.handled,"Should never service a request that has already been handled")}catch(A){_.Z.reportError(A)}var P=this._getDupeRequest(Z);if(P)gn&&this.__Stats.dupedRequests++,Z.duped=!0,y.push(Z),l++,this._appendDupeRequest(P,Z);else{var S=this._getCombineRequest(Z);if(S)gn&&this.__Stats.combinedRequests++,Z.combined=!0,y.push(Z),u++,this._combineRequest(S,Z);else{var D=!1;if(Z.attach)for(var I=0,E=0;E<Z.attach.length;++E){if(I++>5e3&&__infLoop&&__infLoop(I))throw new RangeError;Z.attach[E].needsRemoteData()&&(Z.attach[E].notifyDataRequested(),D=!0)}else D=!0;if(D)if(Z.token||this.isCurrentlyAuthorized(Z.accountID)){var x=this._runRemoteRequest(b,Z,n);if(gn&&this.__Stats.remoteRequests++,x.isNewRequest||0===p){try{_.Z.PAssert(1129,t>s,"Should not be making more requests for plugin than allowed")}catch(A){_.Z.reportError(A)}s++,f--,this._numOutstandingReqs++,gn&&this.__Stats.actualRemoteCallsSent++}x.wasBatched&&p++,y.push(Z)}else ie.Z.notifyUnauthorizedRequest(Z.accountID),d++;else gn&&this.__Stats.canceledRequests++,Z.canceled=!0,c++,y.push(Z)}}}}this._pendingRequests=this._pendingRequests.removeArray(y);for(var C=0;C<y.length;++C){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;y[C].canceled||y[C].duped||this._addRequest(this._outstandingRequests,y[C])}return Object.keys(g).forEach((function(e){var t=g[e];try{_.Z.PAssert(1130,!t||p+c+l+u+d+h>1,"Batches should always have multiple items in them")}catch(A){_.Z.reportError(A)}t&&(p>0?(gn&&o.__Stats.remoteBatches++,o.commitBatch(t,r)):gn&&o.__Stats.canceledBatches++)})),s}},{key:"_clearRequestQueue",value:function(){_.Z.log("Clear Request Queue: ",this.id),this._pendingRequests=[],this._outstandingRequests=[],this._numOutstandingReqs=0}},{key:"_addRequest",value:function(e,t){try{_.Z.PAssert(1131,e.indexOf(t)<0,"Should never re-add a request to a queue without removing it first")}catch(n){_.Z.reportError(n)}return e.push(t)}},{key:"_removeRequest",value:function(e,t){return e.remove(t)}},{key:"isRateLimited",value:function(){return this._isRateLimited}},{key:"_notifyRateLimitedOver",value:function(){this._isRateLimited=!1}},{key:"_notifyRateLimited",value:function(e){this._isRateLimited=!0,this._lastRateLimitTime=new Date}},{key:"isRateLimitError",value:function(e){var t=!1;return e&&pn.indexOf(e.status)>=0&&(e.status===w.Z.HTTPStatusCode.Forbidden?(_.Z.hasGoogleError(e,w.Z.GoogleErrorDomain.UsageLimits,w.Z.GoogleError.UserRateLimitExceeded)||_.Z.hasGoogleError(e,w.Z.GoogleErrorDomain.UsageLimits,w.Z.GoogleError.RateLimitExceeded)||_.Z.hasGoogleError(e,w.Z.GoogleErrorDomain.UsageLimits,w.Z.GoogleError.QuotaExceeded))&&(t=!0):t=!0),t}},{key:"_getRetryDelay",value:function(e,t){var n=e.currentRetries;return t&&(n=Math.max(2,e.currentRetries)),_.Z.seconds(dn[n])}},{key:"_notifyRequestSuccess",value:function(e,t){var n={cbList:e.successCB,result:t};e.wasBatched?(this._batchedResponses[e.batchID]||(this._batchedResponses[e.batchID]=[]),this._batchedResponses[e.batchID].push(n)):this._handleResponse(n)}},{key:"_notifyRequestFailure",value:function(e,t){var n={cbList:e.failureCB,result:t};e.wasBatched?(this._batchedResponses[e.batchID]||(this._batchedResponses[e.batchID]=[]),this._batchedResponses[e.batchID].push(n)):this._handleResponse(n)}},{key:"_handleResponse",value:function(e){for(var t=0,n=0;n<e.cbList.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{var r=e.result;e.cbList[n](r)}catch(i){_.Z.reportError(i)}}}},{key:"_notifyBatchCompleted",value:function(e){var t=this._batchedResponses[e.getBatchID()];if(delete this._batchedResponses[e.getBatchID()],t){var n=0;_o.PaneUpdateBatcher.beginUpdateItems(),be.Z.beginBatch();for(var r=0;r<t.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this._handleResponse(t[r])}be.Z.commitBatch(),_o.PaneUpdateBatcher.commitUpdateItems()}}},{key:"computeBatchGroupID",value:function(e){return e.accountID}},{key:"computeRequestID",value:function(e){return e.id+"-"+Date.now()}},{key:"_setSendTime",value:function(e){var t=Date.now();if(0===e.sendTimes.length){var n=t-e.queueTime;this._numSendRequests++,this._totalRequestSendTime+=n,n>this.LongWaitThreshold&&this._numLongWaitRequests++}e.sendTimes.push(t)}},{key:"_setHandleTime",value:function(e){var t=Date.now();if(0===e.handleTimes.length){var n=t-e.queueTime;this._numHandledRequests++,this._totalRequestHandleTime+=n}e.handleTimes.push(t)}},{key:"_runRemoteRequest",value:function(e,t,n){var r,i=this,a={wasBatched:!1,isNewRequest:!1};if($t.Z.canConstruct(t.requestFn))r=t.request=$t.Z.createRequest(t.accountID,t.requestFn,t.data,t.token,this.googleScopes());else{0;var o=_.Z.unpackFn(t.requestFn);try{_.Z.PAssert(1132,_.Z.isFunction(o),"Must specify a valid packed function: ",t.requestFn)}catch(u){_.Z.reportError(u)}o&&(r=t.request=o(t.data))}if(r){try{_.Z.PAssert(1133,r.then,"Remote request must be thenable")}catch(u){_.Z.reportError(u)}if(e){var s=this.computeBatchGroupID(t),c=this.computeRequestID(t);a.isNewRequest=e.add(r,s,c);try{_.Z.PAssert(1134,_.Z.isBoolean(a.isNewRequest),"Add must return whether it will create a new remote request for this request")}catch(u){_.Z.reportError(u)}a.wasBatched=!0,t.wasBatched=!0,t.batchID=e.getBatchID(),t.batchRequestID=c}else t.wasBatched=!1,t.batchID=void 0,t.batchRequestID=void 0;_.Z.shouldLog(w.Z.LogLevels.Plugin)&&_.Z.log("Request Run: ",this.name,t.type,t.id,t);try{_.Z.PAssert(1135,t.token||this.isCurrentlyAuthorized(t.accountID),"Must be currently authorized to make this request")}catch(u){_.Z.reportError(u)}this._setSendTime(t);var l=function(e){try{_.Z.PAssert(1136,!1===t.handled,"Must not handle the same request multiple times")}catch(u){_.Z.reportError(u)}_.Z.shouldLog(w.Z.LogLevels.Plugin)&&_.Z.log("Request Failed: ",i.name,t.type,t.id,t,e),i._setHandleTime(t);var r=i.isRateLimitError(e);if(r&&i._notifyRateLimited(e),(r||hn.indexOf(e.status)>=0)&&t.autoRetry&&t.currentRetries<t.numRetries)n(t.attach,t.plugin,t.wasBatched),i._removeRequest(i._outstandingRequests,t),i._retryRemoteRequest(t,r);else{if(t.handled=!0,t.failed=!0,t.attach)for(var a=0,o=0;o<t.attach.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t.attach[o].notifyDataRequestFailed()}i._notifyRequestFailure(t,e.result),n(t.attach,t.plugin,t.wasBatched),i._removeRequest(i._outstandingRequests,t)}};t.request.then((function(e){var r=e.result;if(r&&!r.error||204===e.status){try{_.Z.PAssert(1137,!1===t.handled,"Must not handle the same request multiple times")}catch(u){_.Z.reportError(u)}_.Z.shouldLog(w.Z.LogLevels.Plugin)&&_.Z.log("Request Success: ",i.name,t.type,t.id,t,e),i._setHandleTime(t),t.handled=!0,i._notifyRateLimitedOver(),i._notifyRequestSuccess(t,r),n(t.attach,t.plugin,t.wasBatched),i._removeRequest(i._outstandingRequests,t)}else l(e)}),l)}return a}},{key:"createPaginationToken",value:function(e,t,n,r,i,a){return new tn(e,t,n,r,i,a)}},{key:"updatePaginationToken",value:function(e,t){try{_.Z.PAssert(1138,e,"Must specify a valid token to update")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(1139,t,"Must update the pagination token with a valid next page token")}catch(n){_.Z.reportError(n)}return e.updateToken(t),e}},{key:"createBatch",value:function(e){return $t.Z.createBatch(e)}},{key:"commitBatch",value:function(e,t){var n=this;try{_.Z.PAssert(1140,e,"Batch to commit must be specified")}catch(r){_.Z.reportError(r)}e.then((function(){n._notifyBatchCompleted(e),t(n,!0)}),(function(){n._notifyBatchCompleted(e),t(n,!1)}))}},{key:"addModifiedOffline",value:function(e,t){try{_.Z.PAssert(1141,e,"Must have a valid cache entry to update")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(1142,_.Z.isBoolean(t)||_.Z.isArray(t),"Incoming fields must be valid")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(1143,!1!==t,"Use removeModifiedOffline to clear data instead")}catch(r){_.Z.reportError(r)}if(e){var n=e.modifiedOffline||!1;try{_.Z.PAssert(1144,_.Z.isBoolean(n)||_.Z.isArray(n),"Previous fields must be valid")}catch(r){_.Z.reportError(r)}!1===n?e.modifiedOffline=t:!0===n||(!0===t?e.modifiedOffline=!0:e.modifiedOffline?e.modifiedOffline.pushOnlyUniques(t):e.modifiedOffline=t)}}},{key:"removeModifiedOffline",value:function(e,t){try{_.Z.PAssert(1145,e,"Must have a valid cache entry to update")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(1146,_.Z.isBoolean(t)||_.Z.isArray(t),"Incoming fields must be valid")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(1147,!0!==t,"Use addModifiedOffline to add data instead")}catch(r){_.Z.reportError(r)}if(e){var n=e.modifiedOffline||!1;try{_.Z.PAssert(1148,_.Z.isBoolean(n)||_.Z.isArray(n),"Previous fields must be valid")}catch(r){_.Z.reportError(r)}!1===n||(!0===n?!1===t&&(e.modifiedOffline=!1):!1===t?e.modifiedOffline=!1:(e.modifiedOffline=e.modifiedOffline.removeArray(t),0===e.modifiedOffline.length&&(e.modifiedOffline=!1)))}}},{key:"compactCacheField",value:function(e,t){return e[t]}},{key:"_serializeObj",value:function(e,t){var n=0;try{_.Z.PAssert(1149,e,"Must specify a valid entry to serialize")}catch(l){_.Z.reportError(l)}try{_.Z.PAssert(1150,t,"Must provide a valid property list")}catch(l){_.Z.reportError(l)}for(var r={},i=0;i<t.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=t[i],o=this.getPropertyDescriptor(a);if(!o.isOpt||o.defaultValue!==e[a]){var s=this.compactCacheField(e,a);void 0!==s&&(r[a]=s)}}var c=this.getBlobData(e);return c&&(r._blob=c),r}},{key:"serializeEntry",value:function(e){var t=this.getPropertySet(w.Z.PluginLoad.Full),n=this.getCacheData(e);if(n){var r=this._serializeObj(n,t);return r.id=e,r.plugin=this.id,r}}},{key:"serializeExternalData",value:function(e){try{_.Z.PAssert(1151,e,"Must supply valid data to serialize")}catch(r){_.Z.reportError(r)}var t=this.getPropertySet(w.Z.PluginLoad.Full),n=this._serializeObj(e,t);return n.id=e.id,e.parents&&(n.parents=e.parents),n}},{key:"declareProperty",value:function(e,t,n,r,i){var a=this;try{_.Z.PAssert(1152,!this._propertyDescriptors[e],"Should not declare the same property twice")}catch(o){_.Z.reportError(o)}t=t||w.Z.PluginLoad.Full,n=n||!1,_.Z.forEachFlagSet(t,(function(t){a._propertySets[t]||(a._propertySets[t]=[]),a._propertySets[t].push(e)})),this._propertyDescriptors[e]={isOpt:n,defaultValue:r,comparator:i}}},{key:"getPropertySet",value:function(e){return this._propertySets[e]||[]}},{key:"getPropertyDescriptor",value:function(e){return this._propertyDescriptors[e]}},{key:"getBlobData",value:function(e){}},{key:"_updateAttachmentStates",value:function(){try{var e=0;_o.PaneUpdateBatcher.beginUpdateItems();for(var t=0;t<this._attachKeys.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._attachCache[this._attachKeys[t]];n.isInUse()&&n.onUpdate(!1,void 0,w.Z.ChangeType.Auto)}_o.PaneUpdateBatcher.commitUpdateItems()}catch(r){_.Z.reportError(r)}}},{key:"offlineLoad",value:function(){if(!this._hasRunOfflineLoad&&this.supportOfflineLoad())try{this._offlineLoad&&(this._hasRunOfflineLoad=this._offlineLoad())}catch(e){_.Z.reportError(e)}}},{key:"load",value:function(){if(this._isFirstLoad){this._isFirstLoad=!1;try{this._load&&this._load()}catch(e){_.Z.reportError(e)}}this._loadedInitialData||!_.Z.isDemoMode()&&!this.hasActiveDataPanes()||this.isPluginBlocked()||this.loadInitialData()}},{key:"loadInitialData",value:function(){try{_.Z.PAssert(1154,!this._loadedInitialData,"Do not make multiple requests for initial data load")}catch(e){_.Z.reportError(e)}try{_.Z.PAssert(1155,!this.isPluginBlocked(),"Should not load data for blocked plugins")}catch(e){_.Z.reportError(e)}this._loadedInitialData=!0}},{key:"getDataPane",value:function(){}},{key:"getPaneIcon",value:function(){return"icon-question"}},{key:"getPanePriority",value:function(){return 0}},{key:"getDefaultDisplayItem",value:function(e){}},{key:"useItemStore",value:function(){}},{key:"itemStoreOptions",value:function(){}},{key:"getDefaultItemStore",value:function(){try{_.Z.PAssert(1156,this.useItemStore(),"Must request an item store")}catch(e){_.Z.reportError(e)}return this._defaultItemStore}},{key:"getActiveItemStore",value:function(e){try{_.Z.PAssert(1157,e,"Must specify a valid paneID to get the item store for")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(1158,this.useItemStore(),"Must request item store usage")}catch(n){_.Z.reportError(n)}var t=this._activeItemStore[e];return t||this._defaultItemStore}},{key:"getBucketItemStore",value:function(e){return this._searchBuckets[e]}},{key:"allowRemoteRequests",value:function(){return!1}},{key:"handleDropEvent",value:function(e,t){return!1}},{key:"handleTapClick",value:function(e,t,n,r){return!1}},{key:"notifyPaneCreated",value:function(){this._numActivePanes++,!this.isActive()||this._loadedInitialData||this.isPluginBlocked()||this.areDependenciesLoaded()&&this.loadInitialData()}},{key:"notifyPaneDestroyed",value:function(){this._numActivePanes--;try{_.Z.PAssert(1161,this._numActivePanes>=0,"Should never have negative active panes")}catch(e){_.Z.reportError(e)}}},{key:"notifyPanesReadyForLoad",value:function(){_o.PaneManager.runForEachPane((function(e){e.notifyPluginLoaded()}),this.getPaneType())}},{key:"hasActiveDataPanes",value:function(){return this._numActivePanes>0}},{key:"allowTextEditing",value:function(e,t){return!0}},{key:"_createSearchBucket",value:function(e,t){var n;n=_.Z.generateTempId();var r=_o.itemStoreManager.registerItemStore(n,this,{trackGlobally:!1});return r.createRoot(t||_.Z.generateTempId(),"Search Results"),this._searchBuckets[n]=r,n}},{key:"_destroySearchBucket",value:function(e){this._searchBuckets[e].clearStore()}},{key:"swapInSearchBucket",value:function(e,t){try{_.Z.PAssert(1162,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(a){_.Z.reportError(a)}if(_.Z.shouldLog(w.Z.LogLevels.Plugin)&&_.Z.log("Swap IN search bucket: ",e),_o.PaneManager.isPaneActive(t)){var n=_o.PaneManager.getPaneById(t),r=this._searchBuckets[e];if(!this._activeSearchBucket[t]||this._activeSearchBucket[t].id!==e){var i=r.getRoot();this._activeSearchBucket[t]||(this._defaultZoomItems[t]=n.getItem()),this._activeItemStore[t]=r,this._activeSearchBucket[t]=r,n.setRootItem(i,!0),n.useItemStore(r)}}}},{key:"swapOutSearchBucket",value:function(e,t){try{_.Z.PAssert(1163,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(o){_.Z.reportError(o)}var n=this._activeSearchBucket[e].id;_.Z.shouldLog(w.Z.LogLevels.Plugin)&&_.Z.log("Swap OUT search bucket: ",n);var r=_o.PaneManager.getPaneById(e),i=this._searchBuckets[n];try{_.Z.PAssert(1164,i,"Must have a valid bucket we are swapping from")}catch(o){_.Z.reportError(o)}var a=r.getRootItem();try{_.Z.PAssert(1165,a===i.getRoot(),"Current root for pane should match bucket root")}catch(o){_.Z.reportError(o)}t=t||this._defaultZoomItems[e];try{_.Z.PAssert(1166,t,"Must always be able to get a valid default zoom item")}catch(o){_.Z.reportError(o)}this._activeItemStore[e]=void 0,this._activeSearchBucket[e]=void 0,this._defaultZoomItems[e]=void 0,r.setItem(t,!0),r.stopUsingItemStore(i),this._destroySearchBucket(n)}},{key:"runSearch",value:function(e,t,n,r,i){try{_.Z.PAssert(1167,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(o){_.Z.reportError(o)}var a;return r&&(a=this._createSearchBucket(e,n)),this.runRemoteSearch(e,t,a,i)}},{key:"getSearchRoot",value:function(e){var t=this._searchBuckets[e];try{_.Z.PAssert(1168,t,"Should always reference a valid search bucket")}catch(n){_.Z.reportError(n)}return t.getRoot()}},{key:"isRemoteSearchBucketActive",value:function(e){return!!this._activeSearchBucket[e]}},{key:"clearSearch",value:function(e,t){this._activeSearchBucket[e]&&this.swapOutSearchBucket(e,t)}},{key:"refreshCurrentView",value:function(e){try{_.Z.PAssert(1169,!1,"SubClass must override refreshCurrentView",this.id)}catch(t){_.Z.reportError(t)}}},{key:"dumpRequestQueue",value:function(e){var t=0,n=0;console.log("---- Outstanding Requests ["+this._numOutstandingReqs+"] ----");for(var r=0;r<this._outstandingRequests.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._outstandingRequests[r];console.log("  ",i.requestFn,":",i.id," - ",i.data)}console.log("---- Pending Requests ["+this._pendingRequests.length+"] ----");for(var a=0;a<this._pendingRequests.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=this._pendingRequests[a];console.log("  ",o.requestFn,":",o.id," - ",o.data)}if(e){var s=0;try{_.Z.PAssert(1170,!1,"Must be in __DEV__ mode to display info on handled requests")}catch(u){_.Z.reportError(u)}console.log("---- Handled Requests ["+this._handledRequests.length+"] ----");for(var c=0;c<this._handledRequests.length;++c){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=this._handledRequests[c];l.failed?console.log(" !",l.requestFn,":",l.id," - ",l.data):console.log("  ",l.requestFn,":",l.id," - ",l.data)}}}},{key:"dumpQueueStats",value:function(){console.log("  Rate Limited: "+this._isRateLimited),console.log("  Long Wait Requests: "+this._numLongWaitRequests),console.log("  Num Requests: ",this._numSendRequests,this._numHandledRequests),console.log("  Num Pending Requests: ",this._pendingRequests.length),console.log("  Avg. Send Time: ",this._totalRequestSendTime/this._numSendRequests),console.log("  Avg. Handle Time: ",this._totalRequestHandleTime/this._numHandledRequests)}},{key:"getCssClass",value:function(e,t){return""}},{key:"getSyncAccounts",value:function(){var e=this,t=[],n=_o.settings.syncAccounts.get();return n&&(t=Object.keys(n).filter((function(t){return!!n[t][e.id]}))),t}},{key:"numSyncAccounts",value:function(){return this.getSyncAccounts().length}},{key:"hasSyncAccount",value:function(e,t){var n=!1,r=_o.settings.syncAccounts.get();if(r){var i=r[e];n=i&&i[this.id]}return n||t||e!==ie.Z.getDefaultAccountID()||(n=!0),n}},{key:"_onSyncAccountsChanged",value:function(e,t){var n=this;if(!_o.settings.isLoading&&!this.isBuiltin){var r=Object.keys(e).some((function(t){return e[t][n.id]}));r!==this.isEnabled()&&(r?(console.log("Enabling",this.id),se.Z.enablePlugin(this.id)):(console.log("Disabling",this.id),se.Z.disablePlugin(this.id)));var i=[],a=[];Object.keys(e).forEach((function(r){var a,o;null===(a=e[r])||void 0===a||!a[n.id]||null!==(o=t[r])&&void 0!==o&&o[n.id]||i.push(r)})),t&&Object.keys(t).forEach((function(r){var i,o;null===(i=t[r])||void 0===i||!i[n.id]||null!==(o=e[r])&&void 0!==o&&o[n.id]||a.push(r)})),this.onSyncAccountsChanged(i,a)}}},{key:"idStartsWithPrefix",value:function(e,t){return e.startsWith(this.getIDPrefix(t))}},{key:"getIDPrefix",value:function(e){return this.id+"~"+e}},{key:"getItemIDForAccountID",value:function(e,t){return this.getIDPrefix(t)+"~"+e}},{key:"_getVMLIForAccount",value:function(e,t){var n;t=t||this.getDefaultItemStore();var r=this.getItemIDForAccountID(e,"A");return null===(n=t)||void 0===n?void 0:n.getItem(r)}},{key:"_ensureVMLIsForAccount",value:function(e,t){try{_.Z.PAssert(1172,e,"Must specify a valid account ID")}catch(a){_.Z.reportError(a)}t=t||this.getDefaultItemStore();var n=this.getItemIDForAccountID(e,"A"),r=t.getItem(n);if(!r){var i=t.getRoot();r=t.createItem(n,e,i.id),i.insertSorted(r,this.sortFn)}return r}},{key:"getAccountIDFromItem",value:function(e){var t,n=e.id,r=this.id.length+3;if(this.idStartsWithPrefix(n,"R"))n=n.substr(r);else if(this.idStartsWithPrefix(n,"A"))t=n.substr(r),this.idStartsWithPrefix(t,"S")&&(t=t.substr(r));else if(this.idStartsWithPrefix(n,"L"))t=n.substring(r,n.indexOf("~",r));else if(this.idStartsWithPrefix(n,"T"))t=n.substring(r,n.indexOf("~",r));else{var i=e.getAttachmentByPlugin(this.id);t=null===i||void 0===i?void 0:i.getField("accountID")}try{_.Z.PAssert(1173,!t||t.indexOf("~")<0,"Should not contain delim in label ID")}catch(a){_.Z.reportError(a)}return t}},{key:"getAccountIDForPane",value:function(e){var t;return(null===(t=e.plugin)||void 0===t?void 0:t.getAccountIDFromItem(e.item.get()))||ie.Z.getDefaultAccountID()}},{key:"sortFn",value:function(e,t){return e.getParsedText().localeCompare(t.getParsedText())}},{key:"onPaneActivated",value:function(e){}},{key:"getWordStyles",value:function(){return{}}},{key:"_activate",value:function(){}},{key:"_deactivate",value:function(){}},{key:"_offlineLoad",value:function(){}},{key:"_load",value:function(){}},{key:"runRemoteSearch",value:function(e,t,n,r){}},{key:"googleScopes",value:function(e){return[]}},{key:"getDependencies",value:function(){return[]}},{key:"getTextIconPadding",value:function(){return 0}},{key:"getURLForAttachment",value:function(e){return""}},{key:"onSyncAccountsChanged",value:function(e,t){}}]),e}(),P()(un.prototype,"_onSyncAccountsChanged",[S.ZP],Object.getOwnPropertyDescriptor(un.prototype,"_onSyncAccountsChanged"),un.prototype),un);ve.Z.defineBase(mn);const vn=mn;function yn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}const kn=function(e){p()(n,e);var t=yn(n);function n(){var e;return s()(this,n),(e=t.call(this,w.Z.PluginID.Date,"t","Date",!0)).pluginMargin=0,e.pluginPadding=8,e.declareProperty("itemID",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full|w.Z.PluginLoad.Inline,!1),e}return l()(n,[{key:"getDisplayText",value:function(e,t){return this.getUnstyledText(e,t)}},{key:"getStyledText",value:function(e,t,n){return this.getUnstyledText(e,n)}},{key:"getUnstyledText",value:function(e,t){if(t=t||j.Z.getItem(e.id)){var n=t.getMooDate();if(n)return n.toText(!0)}return""}},{key:"getWordStyles",value:function(){return{fontSize:11}}},{key:"getAttachmentEmbedString",value:function(){return w.Z.CharDate}},{key:"_getTextForItem",value:function(e){try{_.Z.PAssert(530,e,"Must pass in a valid item to get text for")}catch(t){_.Z.reportError(t)}return w.Z.CharDate}},{key:"getAttachmentClass",value:function(e){var t=["inlineDate","t-date","pressable"],n=j.Z.getItem(e.id);return null!==n&&void 0!==n&&n.isCalendarSynced()&&(t=t.concat("t-dateSynced")),t}},{key:"requestData",value:function(e){e.notifyDataLoaded(w.Z.PluginLoad.Full,!1,void 0,w.Z.ChangeType.Remote)}}]),n}(vn);var _n=n(1998);function Zn(e){this._cb=e,this._pageToken=void 0,this._validToken=!1}ve.Z.defineBase(Zn),ve.Z.extend(Zn.prototype,{hasPaginationToken:function(){return this._validToken},needsPaginationToken:function(){return!this.hasPaginationToken()&&!this._pageToken},setPaginationToken:function(e){this._pageToken=e,this._validToken=!0,this._cb&&this._cb(this)},beginDataPageLoad:function(){return this._pageToken.notifyBeginUse(),this._pageToken},endDataPageLoad:function(e){e?this._pageToken.notifyEndUse():this._validToken=!1}});const wn=Zn;function bn(e,t,n){this._super.constructor.call(this),this._searchQuery=e,this._invalid=!1,this._hasError=!1,this._remoteRequestCB=n,this._activePageRequest=void 0,this._lastPageRequest=void 0,this._cachedResults=[],this._localPageOffset=0,this._automaticPageRequests=0,this._pageSize=t,ve.Z.forceBind("onEntry",this)}var Pn={invalidate:function(){this._invalid=!0},isValid:function(){return!this._invalid},hasError:function(){return this._hasError},getNextPage:function(e,t){try{_.Z.PAssert(1040,_.Z.isFunction(e)&&_.Z.isFunction(t)||this._lastPageRequest,"Must provide valid callbacks")}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(1041,!this._invalid,"Should never request another page from an invalidated search")}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(1042,this.hasMoreResults(),"Should never request another page if there are no possible results")}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(1043,!this._activePageRequest,"Should only run a single request at a time")}catch(s){_.Z.reportError(s)}if(e||t||!this._lastPageRequest||(e=this._lastPageRequest.entryCB,t=this._lastPageRequest.doneCB),this._activePageRequest)t(!1);else if(this._cachedResults.length>this._localPageOffset+this._pageSize){for(var n=0,r=0;r<this._pageSize;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=this._cachedResults[this._localPageOffset+r];try{e(i)}catch(c){_.Z.reportError(c)}}this._localPageOffset+=this._pageSize,t(!0)}else if(this.hasPaginationToken()&&this._automaticPageRequests<5)this._activePageRequest={entryCB:e,doneCB:t},this._automaticPageRequests++,this._remoteRequestCB(this);else if(this._localPageOffset<this._cachedResults.length){for(var a=0,o=this._localPageOffset;o<this._cachedResults.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=this._cachedResults[o];try{e(i)}catch(c){_.Z.reportError(c)}this._localPageOffset++}t(!0)}},onEntry:function(e){this._invalid||this._cachedResults.push(e)},onDone:function(e){this._invalid||this._activePageRequest&&(this._lastPageRequest=this._activePageRequest,this._activePageRequest=void 0,e?this.getNextPage(this._lastPageRequest.entryCB,this._lastPageRequest.doneCB):(this._invalid=!0,this._hasError=!0,this._lastPageRequest.doneCB(e)))},hasResults:function(){return this._cachedResults.length>0},hasMoreResults:function(){return this._cachedResults.length>this._localPageOffset||this.hasPaginationToken()}};ve.Z.inherit(wn,bn),ve.Z.extend(bn.prototype,Pn);const Sn=bn;var Dn,In=n(8270),En=n(9541),xn=n(7948),Cn=n(9320);function An(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}const Ln=(Dn=function(e){p()(n,e);var t=An(n);function n(e){var r;s()(this,n);var i={title:"Files",contextMenuMode:"Drive",paneEmptyMessage:"Loading Google Drive...",paneEmptySearchMessage:"",titleContextMenuHeader:"Open folder",dropEffect:function(){return w.Z.DropEffect.Copy},isWriteable:!1,isDropTarget:!1,overrideCopyBehavior:!1,canAddItem:!1,supportCollapsing:!0,supportCompleting:!1,supportCheckbox:!1,supportOffline:!1,supportPerformArchive:!1,supportDataRefresh:"Drive",supportPagination:!0,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportClickOverviewScroll:!1,supportClone:!1,supportDates:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,searchFilters:[],supportsDocuments:!1};return e.plugin=_o.pluginManager.getPlugin(w.Z.PluginID.Drive),(r=t.call(this,e,i)).type=r.plugin._paneType,r.paneClass="paneOutline panePlugin paneDrive noComplete",r._isSearchingRemote=new x.Z(!1),r._currentSearch=void 0,r.initDrive(),r}return l()(n,[{key:"initDrive",value:function(){this.search.onChanged.listen(this.notifySearchChanged),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0,this.item.get()===this.plugin.getDefaultItemStore().getRoot()&&this.setItem(this.getDefaultDisplayItem())}},{key:"destroy",value:function(){this.search.onChanged.unlisten(this.notifySearchChanged),clearTimeout(this._searchTimeout),this._searchTimeout=void 0,d()(v()(n.prototype),"destroy",this).call(this)}},{key:"_getNotReadyStatus",value:function(){var e="Unknown Error: Unable to load pane data.",t=this.plugin.getUnloadedDependencies();return t&&t.indexOf(w.Z.PluginDependency.PremiumSub)>=0&&(e="Only available to premium subscribers."),e}},{key:"getItemStore",value:function(){return this.plugin.getActiveItemStore(this.id)}},{key:"getRootItem",value:function(){var e=this.getItemStore();return e?e.getRoot():void 0}},{key:"getDefaultDisplayItem",value:function(e){return this.plugin.getDefaultDisplayItem(e)}},{key:"bottomListMessage",value:function(){var e;return!this.isSearched()&&this.getItem().hasPaginationToken()&&(e="LOAD MORE"),{text:e,clickable:!0}}},{key:"searchACName",value:function(){}},{key:"getPaneIcon",value:function(){return this.plugin.getPaneIcon()}},{key:"requestDemandLoadData",value:function(e){this.plugin.requestDemandLoadData(this.id,e)}},{key:"requestDataPage",value:function(e){this.plugin.requestDataPage(e)}},{key:"onClose",value:function(){d()(v()(n.prototype),"onClose",this).call(this)}},{key:"_runRemoteSearch",value:function(){var e=this;if(_o.PaneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var t=this.search.getValue();this._lastSearchValue=t,this._lastSearchTime=Date.now(),this.isLoading.set(!0),this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0),this._currentSearch=this.plugin.runSearch(t,this.id,void 0,!1,(function(t){switch(e.isLoading.set(!1),t){case w.Z.SearchResultStatus.Done:e.paneTopText.set("");break;case w.Z.SearchResultStatus.TooMany:e.paneTopText.set("Too many search results! Be more specific.");break;case w.Z.SearchResultStatus.None:e.paneTopText.set("There were no search results");break;case w.Z.SearchResultStatus.Error:e.paneTopText.set("There was an error running your search, try again.");break;default:try{_.Z.PAssert(1174,!1,"Invalid search state: ",t)}catch(n){_.Z.reportError(n)}}}))}}},{key:"notifySearchChanged",value:function(e){}},{key:"_refreshPaneData",value:function(){this.plugin.refreshCurrentView()}},{key:"notifyDropFrom",value:function(e,t){this.plugin.notifyDropFrom(e,t,this)}},{key:"applyDropOnBlock",value:function(e,t){if(e.isDate){var n,r=e.dateTime||e.date;n=_.Z.isString(r)?_o.International.parseDate(r,w.Z.DateFormat.MDY):r;try{_.Z.PAssert(1175,_.Z.isDateValid(n),"Must provide a valid date when scheduling an email",e.dateTime,e.date)}catch(i){_.Z.reportError(i)}_.Z.isDateValid(n)&&this.plugin.scheduleFile(t,n)}}},{key:"dropEffectCopyBehavior",value:function(e,t){return d()(v()(n.prototype),"dropEffectCopyBehavior",this).call(this,e,t)}},{key:"isSearchingRemote",value:function(){return this._isSearchingRemote.get()}},{key:"_onRemoteDataLoaded",value:function(){}},{key:"isItemHeader",value:function(e,t){return!1}},{key:"titleOfFirstItem",value:function(){return"My Drive Files"}},{key:"getPaddingForPaneObject",value:function(e){return d()(v()(n.prototype),"getPaddingForPaneObject",this).call(this,e)-(e.overview?10:16)}},{key:"getMobileIcon",value:function(){return"FaFile"}},{key:"getHeaderSearchParams",value:function(){var e=this;return{item:this.plugin.getDefaultItemStore().getRoot(),noCollapsed:!1,comparator:function(t){return e.plugin.idStartsWithPrefix(t.id,"A")}}}}]),n}(Cn.Z),P()(Dn.prototype,"notifySearchChanged",[S.ZP],Object.getOwnPropertyDescriptor(Dn.prototype,"notifySearchChanged"),Dn.prototype),Dn);var Mn;function Tn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}var Rn="application/octet-stream",On="application/vnd.google-apps.folder",Fn="application/vnd.google-apps.spreadsheet",Nn="application/vnd.google-apps.presentation",Bn="application/vnd.google-apps.document",Un="application/vnd.google-apps.drive-sdk.597847337936",jn="image/png",Hn="image/jpg",Vn="image/jpeg",Wn="image/gif",zn="S~SharedWithMe",qn="https://drive.google.com/open?id=",Gn=1e8;const Kn=(Mn=function(e){p()(n,e);var t=Tn(n);function n(){var e;return s()(this,n),(e=t.call(this,w.Z.PluginID.Drive,"d","Files",!1)).displaySharedWithMe=!_.Z.isDemoMode(),e._requiresOfflineAuth=!0,e.doesRender=!0,e.isLoadingFiles=new x.Z(!1),e._unmarkedBackupsNeedFixing=[],e.registerSetting("LastChangeId","lastChangeId","i"),e.registerSetting("DriveRootId","driveRootId","d"),e._localCache=e.registerLocalCache(e.id,w.Z.StorageType.IndexedDB,{metadataKeys:["isSyncd"],keyFieldsRN:[]}),e.declareProperty("accountID",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full|w.Z.PluginLoad.Inline,_.Z.isDemoMode(),_.Z.isDemoMode()?"me":void 0),e.declareProperty("showInline",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full|w.Z.PluginLoad.Inline,!0),e.declareProperty("imageWidth",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full|w.Z.PluginLoad.Inline,!0),e.declareProperty("titleLower",w.Z.PluginLoad.Runtime,!1,""),e.declareProperty("dataUrl",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Runtime,!0),e.declareProperty("pinToTop",w.Z.PluginLoad.Runtime,!0,!1),e.declareProperty("title"),e.declareProperty("mimeType"),e.declareProperty("fileSize",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!0),e.declareProperty("alternateLink",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!0),e.declareProperty("webContentLink",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!0),e.declareProperty("isDeleted",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!0,!1),e.declareProperty("modifiedDate",w.Z.PluginLoad.Autocomplete,!0),e.declareProperty("parents",w.Z.PluginLoad.Autocomplete,!0),e}return l()(n,[{key:"getType",value:function(){return w.Z.PluginType.Storage}},{key:"getDataPane",value:function(){try{_.Z.PAssert(531,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(e){_.Z.reportError(e)}return Ln}},{key:"getPaneIcon",value:function(){return"icon-drive-file"}},{key:"getPanePriority",value:function(){return 96}},{key:"useItemStore",value:function(){return"Google Drive"}},{key:"itemStoreOptions",value:function(){return{requireStoredEls:!1,parserFn:it.Z.runParseSinglePlugin}}},{key:"getSettingForAccount",value:function(e,t){var n=this.getSetting(t);return null===n||void 0===n?void 0:n[e]}},{key:"setSettingForAccount",value:function(e,t,n,r){var i=this.getSetting(t);i&&_.Z.isObject(i)||(i={}),i=Object.assign({},i,ne()({},e,n)),this.setSetting(t,i,r)}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"_ensureSpecialFolders",value:function(){}},{key:"_load",value:function(){var e=this;this._ensureSpecialFolders(),this.getSyncAccounts().forEach((function(t){return e._ensureVMLIsForAccount(t)})),_.Z.isDemoMode()||this.createRecurringTask("ChangeListUpdates",{delay:_.Z.minutes(15),minDelay:_.Z.minutes(2),runOnCreate:!0,pauseWhileIdle:!0,task:this.performChangeListUpdate})}},{key:"getDefaultDisplayItem",value:function(e){return e||(e=this.getSyncAccounts()[0]),this._ensureVMLIsForAccount(e)}},{key:"_notifyFailedRequest",value:function(e){e&&e.error&&_.Z.log("Failed Drive request",e.error.code)}},{key:"refreshCurrentView",value:function(){this.hasRecurringTask("ChangeListUpdates")&&this.getRecurringTask("ChangeListUpdates").forceUpdate()}},{key:"loadInitialData",value:function(){d()(v()(n.prototype),"loadInitialData",this).call(this),this.updateItems()}},{key:"supportOfflineLoad",value:function(){return!0}},{key:"_offlineLoad",value:function(){var e=this;return this.isEnabled()&&j.Z.isLoadedLocal.onValue(!0,(function(){var t=e._localCache.getPreloadData();t&&(_o.PaneUpdateBatcher.beginUpdateItems(),t.forEach((function(t){t.accountID&&!e.isFolder(t)&&(e.cacheData(t.id,t),e.createItem(t.accountID,void 0,t))})),_o.PaneUpdateBatcher.commitUpdateItems())})),!0}},{key:"loadFromUsageCache",value:function(e){this.createItem(e.accountID,void 0,e)}},{key:"updateItems",value:function(){var e,t=this,n=this.getQuery();this._requestRemoteFiles(xn.f.SubFolder,n,999,function(){var n=a()(k().mark((function n(r,i){var a,o;return k().wrap((function(n){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(n.prev=n.next){case 0:return e||(e=t._localCache.clearCache()),n.next=3,e;case 3:if(t._addRemoteEntry(r,i),t.createItem(r,void 0,i),t.getSettingForAccount(r,t.Settings.DriveRootId)||!i.parents){n.next=15;break}a=0,o=0;case 8:if(!(o<i.parents.length)){n.next=15;break}if(!(a++>5e3&&__infLoop&&__infLoop(a))){n.next=11;break}throw new RangeError;case 11:i.parents[o].isRoot&&t.setSettingForAccount(r,t.Settings.DriveRootId,i.parents[o].id);case 12:++o,n.next=8;break;case 15:case"end":return n.stop()}}}),n)})));return function(e,t){return n.apply(this,arguments)}}())}},{key:"performChangeListUpdate",value:function(){var e=this;this.getSyncAccounts().forEach((function(t){var n,r=e.getSettingForAccount(t,e.Settings.LastChangeId);e._requestChangeList(t,r,(function(t,i){try{_.Z.PAssert(532,!r||parseInt(i.id)>parseInt(r),"Must have correctly ordered change entry")}catch(a){_.Z.reportError(a)}n=i.id;try{!i.fileId||i.file&&i.file.mimeType===Un||e._handleChange(t,i)}catch(o){_.Z.reportError(o)}}),(function(r){r&&-1!==n&&e.setSettingForAccount(t,e.Settings.LastChangeId,n)}))}))}},{key:"_deleteFile",value:function(e){e.forEachItem(this.getDefaultItemStore(),(function(e){e.parent().removeChild(e,w.Z.ChangeType.Remote),e.setParent(void 0)})),e.updateField("isDeleted",!0)}},{key:"_handleChange",value:function(e,t){var n=this;try{_.Z.PAssert(533,t&&(t.deleted||t.file),"Must have a valid formed change entry to handle")}catch(r){_.Z.reportError(r)}(t.deleted||t.file.mimeType===On)&&(t.deleted?this._localCache.hasEntry(t.fileId).then((function(e){e&&n._localCache.removeEntry(t.fileId)})):this._localCache.saveEntry(this.serializeExternalData(t.file))),this._addRemoteEntry(e,t.file)}},{key:"_isValidFileID",value:function(e){return e.indexOf("~")<0}},{key:"_createItemID",value:function(e,t){var n=0;try{_.Z.PAssert(534,e,"Must provide a fileID")}catch(a){_.Z.reportError(a)}try{_.Z.PAssert(535,this._isValidFileID(e),"Invalid fileID - "+e)}catch(a){_.Z.reportError(a)}try{_.Z.PAssert(536,t,"Must provide a valid itemStore")}catch(a){_.Z.reportError(a)}for(var r=e,i=0;t.hasItem(r)&&i<50;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r=e+"~"+ ++i}try{_.Z.PAssert(537,i<50,"SANITY: Should not have items with 50+ parents")}catch(a){_.Z.reportError(a)}return r}},{key:"_hasSameItem",value:function(e,t,n){for(var r=0,i=!1,a=e,o=0;n.hasItem(a)&&o<50;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=n.getItem(a);if(s&&s.parent()&&s.parent().id===t){i=!0;break}a=e+"~"+ ++o}return i}},{key:"_isSpecialFolder",value:function(e){return e.startsWith("S~")}},{key:"requestDemandLoadData",value:function(e,t){var n=this;try{_.Z.PAssert(538,1===t.getNumAttachments(),"Should only have a single attachment for Drive Pane VMLIs")}catch(c){_.Z.reportError(c)}var r,i=_o.PaneManager.getPaneById(e),a=t.getAttachmentByPlugin(this.id);if(this._isSpecialFolder(t.id))switch(t.id){case zn:r="trashed=false and sharedWithMe and mimeType != '"+Un+"'";break;default:try{_.Z.PAssert(539,!1,"Invalid special folder ID")}catch(c){_.Z.reportError(c)}}r||(r="trashed=false and '"+a.id+"' in parents and mimeType != '"+Un+"'");var o=this.getActiveItemStore(e),s=this.getAccountIDFromItem(t);this._requestRemoteFilesForAccount(s,xn.f.SubFolder,t,r,999,(function(e,r){n.hasCacheData(r.id)||n._addRemoteEntry(e,r),n._hasSameItem(r.id,t.id,o)||n.createItem(e,t,r)}),(function(e,n){n||t.hasPaginationToken()||t.notifyLoadDataFailed(i)})),this.sendEvent("RequestDemandLoadData")}},{key:"requestDataPage",value:function(e){this._requestRemoteFiles(xn.f.DataPage,e)}},{key:"_hasAttachmentChild",value:function(e,t){for(var n=0,r=!1,i=0;i<e.numItems();++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e.itemAtIndex(i).hasAttachment(t)){r=!0;break}}return r}},{key:"_attachAncestorChain",value:function(e,t,n){var r=this;try{_.Z.PAssert(544,n,"Must provide a valid cache entry to create items for")}catch(s){_.Z.reportError(s)}if(n.parents&&n.parents.length>0)for(var i=0,a=0;a<n.parents.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=n.parents[a];try{_.Z.PAssert(545,o&&o.id,"Must supply a valid parent ID to query")}catch(s){_.Z.reportError(s)}o.isRoot?this.createItem(e,void 0,n):this._localCache.getEntry(o.id).then((function(i){r._attachAncestorChain(e,t,i),r.getAttachment(i.id).forEachItem(t,(function(t){r._hasAttachmentChild(t,n.id)||r.createItem(e,t,n)}))}))}}},{key:"getNextSearchPage",value:function(){this._lastCompletedSearch&&this._lastCompletedSearch.isValid()&&this._lastCompletedSearch.getNextPage()}},{key:"runRemoteSearch",value:function(e,t,n,r){var i=this;try{_.Z.PAssert(546,e,"Must provide a valid search")}catch(p){_.Z.reportError(p)}try{_.Z.PAssert(547,t,"Must provide a valid pane")}catch(p){_.Z.reportError(p)}try{_.Z.PAssert(548,_.Z.isFunction(r),"Must provide a valid search callback")}catch(p){_.Z.reportError(p)}var a=!1,o=0,s=new Sn(e,10,this.requestDataPage.bind(this)),c=function(e){a=!0,function(){if(0===o&&a){_.Z.log("Done Searching! "+o);var e=w.Z.SearchResultStatus.Done;s.isValid()&&(_o.PaneManager.getPaneById(t).search.update(!0),s.isValid()&&s.hasMoreResults()?(_.Z.log("Too many search results"),e=w.Z.SearchResultStatus.TooMany):s.hasError()?e=w.Z.SearchResultStatus.Error:0===o&&(e=w.Z.SearchResultStatus.None),i._lastCompletedSearch=s),r(e)}}()},l=!1,u="trashed=false and (fullText contains '"+e+"')' and mimeType != '"+On,d=_o.PaneManager.getPaneById(t),h=this.getAccountIDForPane(d);return this._requestRemoteFilesForAccount(h,xn.f.Search,s,u,100,s.onEntry,(function(e,t){s.onDone(t),l||(l=!0,s.isValid()&&(s.hasResults()?s.getNextPage((function(t){return function(e,t){o++,i.hasCacheData(t.id)||i._addRemoteEntry(e,t)}(e,t)}),c):c()))})),this.sendEvent("RemoteSearch"),s}},{key:"_requestRemoteFiles",value:function(e,t,n,r,i){var a=this;this.getSyncAccounts().forEach((function(o){return a._requestRemoteFilesForAccount(o,e,a._ensureVMLIsForAccount(o,a.getDefaultItemStore()),t,n,r,i)}))}},{key:"_requestRemoteFilesForAccount",value:function(e,t,n,r,i,a,o){var s=this;this.isLoadingFiles.set(!0);var c,l=function(e,t,n){o&&o(e,t,n),s.isLoadingFiles.set(!1)};n&&n.hasPaginationToken()&&!n.paginationTokenInUse()?(r=(c=n.beginDataPageLoad()).getQuery(),i=c.getMaxResults(),a=c.getEntryCB(),l=c.getDoneCB()):n&&n.needsPaginationToken()&&(c=this.createPaginationToken(void 0,r,{},i,a,l),n.setPaginationToken(c),n.beginDataPageLoad()),i=i||999;try{_.Z.PAssert(549,a&&_.Z.isFunction(a),"Must define a valid entry callback")}catch(f){_.Z.reportError(f)}try{_.Z.PAssert(550,l&&_.Z.isFunction(l),"Must define a valid done callback")}catch(f){_.Z.reportError(f)}var u,d,h=$t.Z.fns("drive").files.list.packedFn,p={fields:"items,nextPageToken",maxResults:i,q:r,pageToken:c&&c.hasMorePages()?c.getNextPageToken():void 0};ie.Z.onLoaded((function(){e&&(c||!n?(u=function(t){if(n.endDataPageLoad(!1),t){var r=0;_o.PaneUpdateBatcher.beginUpdateItems();for(var i=0;i<t.length;++i){var o;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var c=t[i];"application/json"===c.mimeType&&null!==(o=c.properties)&&void 0!==o&&o.find((function(e){return"docId"===e.key}))?s.fixUnmarkedBackup(e,c):a(e,c)}_o.PaneUpdateBatcher.commitUpdateItems()}l(e,!0)},d=function(){console.log(e,"failure"),c&&n.endDataPageLoad(!!c),l(e,!1)}):(u=function(){l(e,!0)},d=function(){l(e,!1)}),s._queuePagedRemoteRequestMulti(e,h,p,u,d,void 0,t,{getAllPages:!0,maxPageResults:i}))}))}},{key:"getRemoteAttachmentData",value:function(e){var t=this,n=$t.Z.fns("drive").files.get.packedFn,r={fileId:e.id},i=e.getField("accountID");ie.Z.onLoaded((function(){var a=function(n){try{_.Z.PAssert(551,!n||n.id===e.id,"If valid result, attachment should match remote file ID")}catch(r){_.Z.reportError(r)}n&&!n.error&&(t._addRemoteEntry(i,n),(n.deleted||n.mimeType===On)&&(n.deleted?t._localCache.hasEntry(n.id).then((function(e){e&&t._localCache.removeEntry(n.id)})):t._localCache.saveEntry(t.serializeExternalData(n))),e.forEachItem(void 0,(function(e){e.itemChanged.notify()})))};if(i){t._queueRemoteRequestMulti(i,n,r,a,(function(n){if(_.Z.isHTTPStatusCode(n,w.Z.HTTPStatusCode.NotFound)){var r={id:e.id,mimeType:Rn,title:"Unknown",titleLower:"unknown",fileSize:0};t._addRemoteEntry(i,r),t._deleteFile(e)}else e.notifyDataRequestFailed(),t._notifyFailedRequest(n)}),e,xn.f.SingleFile)}else t.getSyncAccounts().forEach((function(o){t._queueRemoteRequestMulti(o,n,r,(function(t){i=o,t.accountID=i,a(t),e.notifyDataMutated(["accountID"],w.Z.ChangeType.Local)}),(function(){}),e,xn.f.SingleFile)}))}))}},{key:"_requestChangeList",value:function(e,t,n,r){var i,a,o,s,c=this;ie.Z.onLoaded((function(){if(e){if(t&&t>=0){try{_.Z.PAssert(552,n,"Must supply a valid entry CB")}catch(l){_.Z.reportError(l)}try{_.Z.PAssert(553,r,"Must provide a valid done CB")}catch(l){_.Z.reportError(l)}i=$t.Z.fns("drive").changes.list.packedFn,a={includeDeleted:!0,includeSubscribed:!0,maxResults:500,startChangeId:+t+1,fields:"items,nextPageToken"},o=function(i){var a=0,o=t;_o.PaneUpdateBatcher.beginUpdateItems();for(var s=0;s<i.items.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var u=i.items[s];try{_.Z.PAssert(554,u,"Must have a valid change entry")}catch(l){_.Z.reportError(l)}try{_.Z.PAssert(555,parseInt(u.id)<Gn,"Must have a valid entry ID")}catch(l){_.Z.reportError(l)}try{_.Z.PAssert(556,parseInt(u.id)>parseInt(o),"Must be ordered monotonic increasing")}catch(l){_.Z.reportError(l)}o=u.id,n(e,u)}_o.PaneUpdateBatcher.commitUpdateItems(),i.nextPageToken&&o!==t?c._requestChangeList(e,o,n,r):r(!0)},s=function(e){r(!1)}}else i=$t.Z.fns("drive").changes.list.packedFn,a={includeDeleted:!0,includeSubscribed:!0,maxResults:1,startChangeId:Gn},o=function(t){var i=t.largestChangeId;n(e,{id:i}),r(!0)},s=function(e){r(!1)};c._queueRemoteRequestMulti(e,i,a,o,s,void 0,xn.f.ChangeList)}}))}},{key:"_createRemoteEntry",value:function(e,t){var n={accountID:e,id:t.id,mimeType:t.mimeType,title:t.title,titleLower:t.title.toLowerCase(),alternateLink:t.alternateLink,webContentLink:t.webContentLink||t.alternateLink,dataUrl:t.dataUrl,fileSize:+t.fileSize,parents:t.parents,modifiedDate:t.modifiedDate?new Date(t.modifiedDate):void 0};return this.isFolder(n)&&(n.items=[]),this._localCache.saveEntry(this.serializeExternalData(n)),n}},{key:"_addRemoteEntry",value:function(e,t){var n=this._createRemoteEntry(e,t);this.cacheData(n.id,n)}},{key:"createEntryFromLocal",value:function(e,t){if(this.isFolder(t)&&(t.items=[]),t.titleLower=t.title.toLowerCase(),t.modifiedDate=t.modifiedDate?new Date(t.modifiedDate):void 0,t.isDeleted=t.isDeleted||_.Z.isTempId(e),t.parents)for(var n=0,r=0;r<t.parents.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this._updateParentsEntry(t.parents[r])}return t}},{key:"_updateParentsEntry",value:function(e){this._localCache.getEntry(e.id).then((function(t){t&&(e.title=t.title)}))}},{key:"isFolder",value:function(e){return e.mimeType===On}},{key:"_getCompStringForItem",value:function(e){return e.hasPluginAttachment(this.id)?e.getAttachmentByPlugin(this.id).getTitleString():e.getParsedText()}},{key:"_isItemPinnedToTop",value:function(e){return!!e.hasPluginAttachment(this.id)&&e.getAttachmentByPlugin(this.id).getField("pinToTop")}},{key:"sortFn",value:function(e,t){return this._isItemPinnedToTop(e)?-1:this._isItemPinnedToTop(t)?1:this._getCompStringForItem(e).localeCompare(this._getCompStringForItem(t))}},{key:"getAttachmentClass",value:function(e){var t=["plugin_drive"];return e.hasField("mimeType")?t.push(this.getMimetypeClass(e)):t.push("plugin_drive_unk"),e.hasField("isDeleted")&&e.getField("isDeleted")&&t.push("fileDeleted"),t}},{key:"getMimetypeClass",value:function(e){var t=e.getField("mimeType");if(this.isMimetypeImage(t))return e.getField("showInline")?"plugin_drive_image_inline":"plugin_drive_image";switch(t){case On:return"plugin_drive_folder";case Fn:return"plugin_drive_sheet";case Nn:return"plugin_drive_slide";case Bn:return"plugin_drive_doc";default:return"plugin_drive_unk"}}},{key:"isMimetypeImage",value:function(e){switch(e){case jn:case Wn:case Hn:case Vn:return!0}}},{key:"isImage",value:function(e){var t=this.getMimetypeClass(e);return e.hasField("mimeType")&&("plugin_drive_image"===t||"plugin_drive_image_inline"===t)}},{key:"googleScopes",value:function(e){return e?[w.Z.GScope.DriveFull]:[w.Z.GScope.Drive]}},{key:"getDependencies",value:function(){return[]}},{key:"verifyAuthorization",value:function(e){return ie.Z.isAuthorizedForScopes(e,this.googleScopes())}},{key:"handleDropEvent",value:function(e,t){var n,r,i=e.dataTransfer,a=e.target,o=e.clipboardData,s=null===i||void 0===i?void 0:i.getData("text/uri-list"),c=_.Z.getPaneForElement(a);if(s&&s.startsWith(qn)){var l=s.replace(qn,""),u=l.indexOf("&"),d=l.substr(0,u);return _.Z.shouldLog(w.Z.LogLevels.Plugin)&&_.Z.log("Dropped File: ",d),t(this.getAttachment(d).getEmbedString()),!0}if((null===i||void 0===i||null===(n=i.files)||void 0===n?void 0:n.length)>0){for(var h=0,p=0;p<i.files.length;++p){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var f=i.files[p];this.handleDropFile(f,c,{target:a},t)}return _o.onIntroAction("DragFromComp"),!0}if((null===o||void 0===o||null===(r=o.items)||void 0===r?void 0:r.length)>0){for(var g=0,m=0;m<o.items.length;++m){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;var v=o.items[m],y=null===v||void 0===v?void 0:v.getAsFile();if(y){var k,Z=(null===(k=y.name.match(/\.\S*$/))||void 0===k?void 0:k[0])||"";y.customName=("image.png"===y.name?"Image ":"Moo.do Upload ")+Date.now()+Z,this.handleDropFile(y,c,{target:a},t)}}return _o.onIntroAction("DragFromComp"),!0}return!1}},{key:"highlightItem",value:function(e){e.highlight()}},{key:"handleDropFile",value:function(){var e=a()(k().mark((function e(t,n,r,i){var a,o,s,c,l,u,d=this;return k().wrap((function(e){for(var h=0;;){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;switch(e.prev=e.next){case 0:if(a=_.Z.generateTempId(),o=this.getSyncAccounts(),s="Insert link to file",c=(n.plugin||1===o.length)&&this.getAccountIDForPane(n),l=D.Z.isNativeApp()&&t.path,c&&!l){e.next=10;break}return u=l?[s,{header:"Upload to Google Drive"}].concat(o):o,e.next=9,_o.menus.openContextMenuList(l?void 0:"Select a Google Drive account to upload to",r.target,u);case 9:c=e.sent;case 10:c===s?i("[".concat(t.name,"](file://").concat(t.path.replace(/\\/g,"/").replace(/ /g,"%20"),")")):c&&ie.Z.onLoaded((function(){for(var e=0,o=0,s=t.customName||t.name,l=d.findCachedItemsByField("title",s),u=d.getDefaultItemStore(),h=n.type===w.Z.PaneMode.Task&&d.isMimetypeImage(t.type)&&_o.settings.showImagesInline.get()?{showInline:!0}:void 0,p=!1,f=0;f<l.length;++f){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var g=l[f];if(g.fileSize===t.size&&!g.isDeleted&&g.accountID===c){var m=d.getAttachment(g.id,h);if(n&&n.isWriteable&&n.plugin!==d)i(d.getAttachmentEmbedString(m),!1);else if(n&&n.plugin===d){var v=d.getDefaultItemStore();m.forEachItem(v,d.highlightItem)}p=!0;break}}if(!p){d.cacheData(a,{accountID:c,title:s,titleLower:s.toLowerCase(),mimeType:t.type});var y,k,Z=d.getAttachment(a,h),b=n&&n.isWriteable&&n.plugin!==d,P=!1,S=null===r||void 0===r?void 0:r.target;if(n&&n.isWriteable&&n.plugin!==d?P=!0:S&&(y=_.Z.hasClass(S,"paneContent")?n.getItem():_.Z.getItemForElement(S))&&!y.isHeader()&&(y=y.parent()),y){if(!y.isRootItem()){var D=y.getAttachmentByPlugin(d.id);try{_.Z.PAssert(557,D,"Drive items must have valid attachments")}catch(E){_.Z.reportError(E)}k=D.id}}else y=u.getRoot(),k=d.getSettingForAccount(c,d.Settings.DriveRootId);var I=n.getDocument();d._upload(c,t,Z,b,I,k,(function(){try{_.Z.PAssert(558,!u.hasItem(Z.id),"When uploading a new file, should never have duplicated items")}catch(E){_.Z.reportError(E)}var e=u.createItem(Z.id,d.getAttachmentEmbedString(Z),y.id);y.insertSorted(e,d.sortFn),P&&i(d.getAttachmentEmbedString(Z),!0),null!==I&&void 0!==I&&I.isShared()&&_o.toasts.pushMessage({text:"Note: Sharing files with collaborators is temporarily disabled while we rebuild it for the new backend",timeout:8e3})}))}}));case 11:case"end":return e.stop()}}}),e,this)})));return function(t,n,r,i){return e.apply(this,arguments)}}()},{key:"notifyDropFrom",value:function(){var e=a()(k().mark((function e(t,n,r){var i,a,o,s;return k().wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:try{_.Z.PAssert(559,t,"Must have a valid item that was dropped")}catch(l){_.Z.reportError(l)}try{_.Z.PAssert(560,n,"Must have a valid pane the item was dropped on")}catch(l){_.Z.reportError(l)}if(_.Z.isDemoMode()){e.next=12;break}if(i=t.getAttachmentByPlugin(this.id),!(a=n.getDocument())||r.plugin===this){e.next=11;break}return o=this.getAccountIDForPane(n),e.next=9,En.Z.getDocumentFolder(o,a.id);case 9:s=e.sent,En.Z.copyFileToFolder(o,i.id,s,(function(e,t){}));case 11:this.sendEvent("AttachmentDropped");case 12:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getAttachUrl",value:function(e){var t=this.getCacheData(e.id);if(t)return t.webContentLink&&t.webContentLink.replace("export=download","")||t.dataUrl}},{key:"getAttachDataUrl",value:function(e){var t=this.getCacheData(e.id);return t&&t.dataUrl}},{key:"handleTapClick",value:function(e,t,n,r){var i=this.getAttachment(n);if(D.Z.mac&&r.metaKey||!D.Z.mac&&r.ctrlKey||this.isPluginPane)return this.openAttach(i,e,t,!1,r)}},{key:"getURLForAttachment",value:function(e){var t,n=this.getCacheData(e.id);return null!==(t=null===n||void 0===n?void 0:n.alternateLink)&&void 0!==t?t:this._createDriveURL(e.id,null===n||void 0===n?void 0:n.mimeType)}},{key:"openAttach",value:function(e,t,n,r,i){var a=this.getCacheData(e.id);if(a&&this.isPluginPane(n)&&this.isFolder(a))n.zoomIn(t),this.sendEvent("Tap_FolderZoom");else{var o=this.getURLForAttachment(e);o&&(r&&!(D.Z.mac&&i.metaKey||!D.Z.mac&&i.ctrlKey)&&this.isImage(e)?(o="https://drive.google.com/uc?export=view&id="+a.id,_o.menus.openLightbox(o)):o&&(_.Z.isDemoMode()?_o.toasts.pushMessage(w.Z.MessageID.DemoPluginClick):(_o.openUrl(o,i),this.sendEvent("Tap_OpenFileDesktop"))))}return!0}},{key:"createFolderURL",value:function(e){return"https://drive.google.com/drive/folders/"+e}},{key:"_createDriveURL",value:function(e,t){var n="https://docs.google.com/";switch(t){case On:return n+"folderview?id="+e+"&usp=drivesdk";case Fn:return n+"spreadsheets/d/"+e+"/edit?usp=drivesdk";case Bn:return n+"document/d/"+e+"/edit?usp=drivesdk";case Nn:return n+"presentation/d/"+e+"/edit?usp=drivesdk";default:return n+"file/d/"+e+"/edit?usp=drivesdk"}}},{key:"compactCacheField",value:function(e,t){var n;switch(t){case"alternateLink":e[t]!==this._createDriveURL(e.id,e.mimeType)&&(n=e[t]);break;default:n=e[t]}return n}},{key:"supportUsageCache",value:function(){return!0}},{key:"matchAttachment",value:function(e,t){return e.getField("titleLower").indexOf(t)>=0}},{key:"getBlockedText",value:function(e){return"Go Premium to view Drive files"}},{key:"onDocumentShared",value:function(e){e&&this._ensureAttachmentsAreShared()}},{key:"_ensureAttachmentsAreShared",value:function(){}},{key:"notifyAttachmentUnused",value:function(e,t){d()(v()(n.prototype),"notifyAttachmentUnused",this).call(this,e,t),_.Z.isDemoMode()}},{key:"_upload",value:function(e,t,n,r,i,o,s){var c=this;t.size>20971520?(_o.toasts.pushMessage(w.Z.MessageID.WarnLargeFile),this.sendEvent("Upload_Large")):this.sendEvent("Upload");var l=this.isMimetypeImage(t.type)&&_o.settings.showImagesInline.get();if(l){var u=new FileReader;u.onload=function(e){var t=c.getCacheData(n.id);t.dataUrl=e.target.result,c.cacheData(n.id,t),s(e)},u.readAsDataURL(t)}var d=new FileReader;d.readAsBinaryString(t),d.onload=function(r){ie.Z.onLoaded((function(){ie.Z.getAccountAuthToken(e,c.googleScopes(),function(){var r=a()(k().mark((function r(a){var o,s;return k().wrap((function(r){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(r.prev=r.next){case 0:if(o=function(r){new In.Z(t,e,{id:r},void 0,(function(){}),(function(t){c.changeID(n,n.id,t.id),_o.remoteAPI().drivePermissionsPublic(e,t.id,(function(){var r=c.getAttachDataUrl(n);r&&(t.dataUrl=r),c._addRemoteEntry(e,t)}),(function(e){_.Z.reportError(new Error("Error adding permission"))}))}),(function(){0})).upload()},!i){r.next=7;break}return r.next=4,c.getDocumentFolder(e,i);case 4:r.t0=r.sent,r.next=10;break;case 7:return r.next=9,En.Z.getRootFolder(e);case 9:r.t0=r.sent;case 10:s=r.t0,a?o(s):_o.toasts.pushMessage({text:"Uploading file failed because of missing authorization. Please check the Drive plugin is enabled.",action:w.Z.MessageAction.OpenSettings});case 12:case"end":return r.stop()}}}),r)})));return function(e){return r.apply(this,arguments)}}())}))},l||s()}},{key:"getDocumentFolder",value:function(e,t){return En.Z.getDocumentFolder(e,t.id)}},{key:"scheduleFile",value:function(e,t){var n=e.getAttachmentByPlugin(this.id);try{_.Z.PAssert(561,n,"Must be able to get a valid attachment from item")}catch(c){_.Z.reportError(c)}var r=w.Z.MSPerHour,i=_o.pluginManager.getPluginGCalendar();if(i){var a=i.getDefaultExportCalendarID();if(a){var o=n.getField("title"),s=this._createDriveURL(n.id,n.getField("mimeType"));i.createEventForEmail(a,o,s,t,r,(function(e,t,n,r){e||t?t||_o.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar.",action:w.Z.MessageAction.Okay}):_o.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:function(){_o.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:w.Z.MessageAction.Okay})}})}))}else _o.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:w.Z.MessageAction.OpenCalendarSettings})}else _o.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule files.",action:w.Z.MessageAction.OpenSettings})}},{key:"findMatchExact",value:function(e){}},{key:"findMatchLike",value:function(e,t){var n=e.toLowerCase(),r=this.findCachedItemsByFn((function(e){return e.titleLower.indexOf(n)>=0}),t);return r.sort((function(e,t){return e.modifiedDate&&t.modifiedDate?Date.compare(e.modifiedDate,t.modifiedDate):e.modifiedDate?-1:t.modifiedDate?1:e.titleLower.localeCompare(t.titleLower)})),r}},{key:"getAttachWidth",value:function(e){return e.hasField("imageWidth")&&e.getField("imageWidth")?+e.getField("imageWidth"):void 0}},{key:"setAttachWidth",value:function(e,t,n){t.updateField("imageWidth",n,!0),e.onAttachInlineUpdate()}},{key:"setShowInline",value:function(e,t,n){t.updateField("showInline",n,!0),e.onAttachInlineUpdate()}},{key:"getStyledText",value:function(e,t,n,r){return _n.Z.renderStyled(e,t,n,r)}},{key:"getUnstyledText",value:function(e){return _n.Z.renderPlain(e)}},{key:"getTextIconPadding",value:function(){return 24}},{key:"hasCacheData",value:function(e){var t;return!(null===(t=this._dataCache[e])||void 0===t||!t.accountID)}},{key:"createItem",value:function(e,t,n){var r=this.getDefaultItemStore();if(t||(t=this._ensureVMLIsForAccount(e,r)),!this._hasAttachmentChild(t,n.id)){var i=r.createItem(this._createItemID(n.id,r),this._getTextForItem(n.id,e),t.id,{demandLoadChildren:n.mimeType===On});t.insertSorted(i,this.sortFn)}}},{key:"pickFilesFromDrive",value:function(){var e=a()(k().mark((function e(t,n){var r,i=this;return k().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,ie.Z.ensureGapiLib("picker");case 2:if((r=(t.plugin||1===this.getSyncAccounts().length)&&this.getAccountIDForPane(t))||!n){e.next=7;break}return e.next=6,_o.menus.openContextMenuList("Select a Google Drive account",n,this.getSyncAccounts());case 6:r=e.sent;case 7:return e.abrupt("return",new Promise((function(e){ie.Z.getAccountAuthToken(r,[w.Z.GScope.Drive],(function(t){var n=window.google;if(n&&n.picker&&n.picker.PickerBuilder){(new n.picker.PickerBuilder).addView(n.picker.ViewId.DOCS).setAppId(w.Z.FirebaseAppID).enableFeature(n.picker.Feature.MULTISELECT_ENABLED).setOAuthToken(null===t||void 0===t?void 0:t.access_token).setCallback((function(t){"picked"===t.action&&t.docs&&_.Z.isArray(t.docs)&&(e(t.docs.map((function(e,t){return i._getTextForItem(e.id,r)}))),i.updateItems())})).setSize(1051,650).hideTitleBar().build().setVisible(!0)}}))})));case 8:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onSyncAccountsChanged",value:function(e,t){var r=this;d()(v()(n.prototype),"onSyncAccountsChanged",this).call(this,e,t),e.length>0&&(this._loadedInitialData=!1,this.loadInitialData()),t.forEach((function(e){var t=r._getVMLIForAccount(e);t&&t.deleteSelf(w.Z.ChangeType.Remote)}))}},{key:"getQuery",value:function(){return"trashed=false and mimeType!='".concat(Un,"' and mimeType!='").concat(On,"' and not properties has { key='").concat(w.Z.DriveBackupKey,"' and value='true' and visibility='PRIVATE' }")}},{key:"fixUnmarkedBackup",value:function(e,t){this._unmarkedBackupsNeedFixing.push({accountID:e,id:t.id}),_.Z.timeoutOnce("Drive_fixBackups",this._fixUnmarkedBackupBatch,1e4)}},{key:"_fixUnmarkedBackupBatch",value:function(){var e=this,t=Math.min(this._unmarkedBackupsNeedFixing.length,50);if(t>0){var n=this._unmarkedBackupsNeedFixing.slice(0,t);this._unmarkedBackupsNeedFixing=this._unmarkedBackupsNeedFixing.slice(t),n.forEach((function(t){var n=t.id,r=t.accountID;_o.remoteAPI().drivePropertiesInsert(r,n,w.Z.DriveBackupKey,!0,(function(){_.Z.timeoutOnce("Drive_fixBackups",e._fixUnmarkedBackupBatch,1e4)}),(function(){}))}))}}}]),n}(vn),P()(Mn.prototype,"performChangeListUpdate",[S.ZP],Object.getOwnPropertyDescriptor(Mn.prototype,"performChangeListUpdate"),Mn.prototype),P()(Mn.prototype,"sortFn",[S.ZP],Object.getOwnPropertyDescriptor(Mn.prototype,"sortFn"),Mn.prototype),P()(Mn.prototype,"_fixUnmarkedBackupBatch",[S.ZP],Object.getOwnPropertyDescriptor(Mn.prototype,"_fixUnmarkedBackupBatch"),Mn.prototype),Mn);var Yn,Xn=n(8),Qn=n.n(Xn);function Jn(e){var t=function(e,t){if("object"!==Qn()(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==Qn()(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Qn()(t)?t:String(t)}function $n(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}var er=["description","end","start","status","summary","extendedProperties"],tr="syncTokens",nr="calendarList",rr="MDCProp_",ir="isComplete",ar="priority",or="isStarred",sr="isArchived",cr=["modifiedOffline"],lr=2,ur=3,dr=4,hr=6,pr=7,fr=8,gr=9,mr=10,vr=11,yr=12,kr=13,_r=14,Zr=w.Z.DefaultEventDuration;const wr=(Yn=function(e){p()(n,e);var t=$n(n);function n(){var e;return s()(this,n),(e=t.call(this,w.Z.PluginID.GCalendar,"c","Calendar",!1)).pluginMargin=4,e.pluginPadding=14,e._requiresOfflineAuth=!0,e._numEntriesSyncd=0,e._calendarList={},e.declareProperty("accountID",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full|w.Z.PluginLoad.Inline,_.Z.isDemoMode()),e.registerSetting("ImportCalendars","importCalendars","i",!0),e.registerSetting("ExportCalendar","exportCalendar","x",!0),e.registerSetting("WeeksPast","weeksPast","p",!0,1),e.registerSetting("WeeksFuture","weeksFuture","f",!0,4),e.registerSetting("DisplayOverdueInAgenda","displayOverdueInAgenda","o",!0,!1),e.registerSetting("SyncNewEvents","syncNewEvents","n",!0,!0),e.registerSetting("SyncDraggedEvents","syncDraggedEvents","d",!0,!0),e.registerSetting("SyncPopup","syncPopup","y",!0,!0),e.registerSetting("CreateLocalEvents","createLocalEvents","l",!0,!0),e._updateSyncTimes(),e.onCalendarsSynced=new et.Z,e._eventCache=e.registerLocalCache(e.id,w.Z.StorageType.IndexedDB,{metadataKeys:[tr,nr],keyFieldsRN:["startTime","calendarID","modifiedOffline"]}),e._cacheCleanup=e.registerLowImpactTask("CacheCleanup",e._purgeOldData),e.declareProperty("isInvalid",w.Z.PluginLoad.Runtime,!0,!1),_.Z.isDemoMode()?e.declareProperty("calendarID",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full|w.Z.PluginLoad.Inline,!0,"me"):e.declareProperty("calendarID",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full|w.Z.PluginLoad.Inline),e.declareProperty("summary",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full),e.declareProperty("status",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!0,"confirmed"),e.declareProperty("startTime",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full),e.declareProperty("endTime",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full),e.declareProperty("allDayEvent",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!0,!1),e.declareProperty("recurringEventId",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!0),e.declareProperty("eid",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!0),e.declareProperty("isComplete",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!0,!1),e.declareProperty("isArchived",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!0,!1),e.declareProperty("isStarred",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!0,!1),e.declareProperty("priority",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!0,w.Z.VMLIFlag.None),e.declareProperty("locked",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!0,!1),e.declareProperty("modifiedOffline",w.Z.PluginLoad.Full,!0,!1),e.declareProperty("source",w.Z.PluginLoad.Full,!0),e.declareProperty("location",w.Z.PluginLoad.Full,!0),e.declareProperty("description",w.Z.PluginLoad.Full,!0),e.declareProperty("attendees",w.Z.PluginLoad.Full,!0),e.declareProperty("organizer",w.Z.PluginLoad.Full,!0),e._pendingCreates={},e._syncingOfflineChanges=!1,e._hasInitializedTasks=!1,e._purgeOldDataTimeout=void 0,e._eventUpdateTimeout=void 0,e._eventUpdateQueue={},e._propConverter={},e._propConverter[ir]=_.Z.parseDate,e._propConverter[sr]=_.Z.parseBoolean,e._propConverter[or]=_.Z.parseBoolean,e._propConverter[ar]=e.parsePriority,e}return l()(n,[{key:"getType",value:function(){return w.Z.PluginType.Calendar}},{key:"_attachMetadataFields",value:function(){return cr}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"useItemStore",value:function(){return"Google Calendar"}},{key:"itemStoreOptions",value:function(){return{listenToItemStateChanged:!0,enabledFilters:w.Z.ItemStoreFilter.Dates}}},{key:"supportOfflineLoad",value:function(){return!0}},{key:"supportUsageCache",value:function(){return!0}},{key:"googleScopes",value:function(){return[w.Z.GScope.Calendar]}},{key:"getDependencies",value:function(){return[]}},{key:"hasSettingsError",value:function(){return!1}},{key:"verifyAuthorization",value:function(e){var t=this.googleScopes();return ie.Z.isAuthorizedForScopes(e,t)}},{key:"getBlockedText",value:function(){return""}},{key:"computeBatchGroupID",value:function(e){var t="me";return e.data&&e.data.calendarId&&(t=e.data.calendarId),t}},{key:"_serializeDate",value:function(e){return e instanceof Date?e.toISOString():_.Z.isNumber(e)?new Date(e).toISOString():e}},{key:"compactCacheField",value:function(e,t){var n;switch(t){case"startTime":case"endTime":n=this._serializeDate(e[t]);break;default:n=e[t]}return n}},{key:"_updateSyncTimes",value:function(){var e=-(this.getSetting(this.Settings.WeeksPast)||1),t=this.getSetting(this.Settings.WeeksFuture)||4;try{_.Z.PAssert(562,_.Z.isNumber(e)&&e<=0,"Invalid value for weeksPast: ",e)}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(563,_.Z.isNumber(t)&&t>=0,"Invalid valid for weeksFuture: ",t)}catch(n){_.Z.reportError(n)}this._syncTokenDuration=_.Z.weeks(10),this._minSyncStartTime=this._minDisplayStartTime=We.Z.getTodayPlusDays(7*e),this._maxSyncStartTime=this._maxDisplayStartTime=We.Z.getTodayPlusDays(7*t);try{_.Z.PAssert(564,this._minDisplayStartTime.isBefore(this._maxDisplayStartTime),"Must have a valid start display date")}catch(n){_.Z.reportError(n)}}},{key:"_shouldDisplayTime",value:function(e,t){return t>=this._minDisplayStartTime&&t<=this._maxDisplayStartTime||e>=this._minDisplayStartTime&&e<=this._maxDisplayStartTime}},{key:"_filterDates",value:function(e,t,n){return function(r){var i=new Date(r[e]);return i>=t&&i<=n}}},{key:"_purgeOldData",value:function(e){var t=this,n=this._minDisplayStartTime.clone().addDays(-1);this._eventCache.getFilterEntries((function(e){return new Date(e.endTime||e.startTime)<=n})).then((function(n){if(n){var r=0;_.Z.log("Removing "+n.length+" old calendar entries.");for(var i=0;i<n.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;t._eventCache.removeEntry(n[i].id)}}e&&e(!1)}))}},{key:"_offlineLoad",value:function(){var e=this;if(this.isEnabled()){var t=this._eventCache.getMetadata(nr);_.Z.isEmpty(this._calendarList)&&(this._calendarList=t||{});var n=this._filterDates("startTime",this._minDisplayStartTime,this._maxDisplayStartTime);return j.Z.isLoadedLocal.onValue(!0,(function(){var t,r=e._eventCache.getPreloadData();if(r){try{_.Z.PAssert(566,_.Z.isObject(r),"Calendar preload is not object")}catch(i){_.Z.reportError(i)}t=r,_.Z.batchRenderUpdates((function(){_o.PaneUpdateBatcher.beginUpdateItems();var r=e.getDefaultItemStore();Object.keys(t).forEach((function(a){var o=t[a];if(n(o)){var s=e.createEntryFromLocal(o.id,o);e.cacheData(s.id,s,void 0,void 0,w.Z.ChangeType.Auto);try{_.Z.PAssert(565,!r.hasItem(s.id),"Load should never try to create a VMLI that has already been created")}catch(i){_.Z.reportError(i)}if(e._eventNeedsItem(s)){if(s.source){var c=_o.pluginManager.parseEmailURL(s.source.url);if(c.plugin&&!c.plugin.hasCacheData(c.threadID)){var l=c.plugin.createEntryFromLocal(c.threadID,{accountID:c.accountID,subject:s.source.title});c.plugin.cacheData(c.threadID,l)}}e._createItem(r,s)}}})),_o.PaneUpdateBatcher.commitUpdateItems(),e._cacheCleanup.notifyWorkAvailable()}))}})),!0}}},{key:"_activate",value:function(){}},{key:"_deactivate",value:function(){_o.PaneUpdateBatcher.beginUpdateItems(),this._hasInitializedTasks=!1,_o.PaneUpdateBatcher.updateAllItems(!0,!0),_o.PaneUpdateBatcher.commitUpdateItems()}},{key:"_load",value:function(){!_.Z.isDemoMode()&&this.isEnabled()&&(this.createRecurringTask("CalendarListSync",{delay:_.Z.hours(2),minDelay:_.Z.hours(1),runOnCreate:!0,pauseWhileIdle:!0,async:!0,asyncTimeout:_.Z.minutes(2),task:this.runCalendarListSync}),this.createRecurringTask("CalendarEventSync",{delay:_.Z.minutes(15),minDelay:_.Z.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:_.Z.minutes(2),task:this.runCalendarSync}),this._hasInitializedTasks=!0)}},{key:"goOnline",value:function(){this._hasInitializedTasks&&this.getRecurringTask("CalendarEventSync").forceUpdate()}},{key:"handleTapClick",value:function(e,t,n,r){var i=this.getCacheData(n);if(i){var a=this.getAttachment(n).getField("calendarID"),o=this._getCalendarInfo(a);if(o)try{_.Z.PAssert(567,o.accountID,"Should have an accountID on the calendar")}catch(c){_.Z.reportError(c)}if(i.eid&&o.accountID){var s="https://www.google.com/calendar/event?eid="+i.eid+"&authuser="+o.accountID;_.Z.isDemoMode()?_o.toasts.pushMessage(w.Z.MessageID.DemoPluginClick):(_o.openUrl(s,r),this.sendEvent("Tap_OpenGCalendarDesktop"))}return!0}return!1}},{key:"_durationToString",value:function(e){var t=Math.round(e/6e4),n=0,r=0;t>0&&(t-=60*(n=Math.floor(t/60)),n>0&&(n-=24*(r=Math.floor(n/24))));var i="";return r>0&&(i+=r+"d "),n>0&&(i+=n+"h "),t>0&&(i+=t+"m "),i.trim()}},{key:"_createItemDateText",value:function(e){return e.allDayEvent?e.startTime.toString(_o.International.getFormat(w.Z.DFormat.MonthDayYear)):e.startTime.toString(_o.International.getFormat(w.Z.DFormat.DayYearTime))}},{key:"_createItemDurationText",value:function(e){var t,n=e.endTime-e.startTime;if(e.allDayEvent)if(n>_.Z.days(1)){var r=e.endTime.clone();r.addMilliseconds(-1),t="until "+r.toString(_o.International.getFormat(w.Z.DFormat.MonthDayYear))}else t="";else t=this._durationToString(n);return t}},{key:"_createItemSummaryText",value:function(e){var t;if(e.source&&e.source.url){var n=_o.pluginManager.parseEmailURL(e.source.url);n.plugin&&(t=n.plugin._getTextForItem({id:n.threadID}))}return t||(t=e.summary?e.summary.replace(/\u2000/g,""):""),t+" "+w.Z.CharDate}},{key:"_createItemText",value:function(e){try{_.Z.PAssert(568,e,"Must specify a valid attachment")}catch(t){_.Z.reportError(t)}return this._createItemSummaryText(e)}},{key:"_eventNeedsItem",value:function(e){return"cancelled"!==e.status&&!e.isArchived}},{key:"mooDateFromCacheEntry",value:function(e){var t=!e.allDayEvent&&e.endTime-e.startTime||void 0;return new $e.Z(new Date(e.startTime.getTime()),{gcalId:e.id,duration:t,gcalCalendar:e.calendarID})}},{key:"_createItem",value:function(e,t){if(e.getLinkedItem(t.id));else{var n,r=e.getRoot();try{_.Z.PAssert(569,this._eventNeedsItem(t),"Item must always be required to cause create")}catch(s){_.Z.reportError(s)}_.Z.isDateValid(t.isComplete)&&(n=t.isComplete);var i={date:this.mooDateFromCacheEntry(t).toData(),priority:t.priority,isComplete:!!t.isComplete,isArchived:t.isArchived,dateCompleted:n,isStarred:t.isStarred},a=e.createItem(t.id,this._createItemText(t),r.id,i,w.Z.ChangeType.Auto);if(t.description){var o=e.createItem(t.id+"_note",t.description,a.id,{isNote:!0},w.Z.ChangeType.Auto);a.setNote(o,w.Z.ChangeType.Auto)}r.insertItem(a)}}},{key:"getRemoteAttachmentData",value:function(e){var t=this;if(e.hasField("calendarID")){var n=e.getField("calendarID"),r=this._getCalendarInfo(n);if(r)try{_.Z.PAssert(571,r.accountID,"Should have an accountID on the calendar")}catch(o){_.Z.reportError(o)}var i=$t.Z.fns("calendar").events.get.packedFn,a={eventId:e.id,calendarId:n};r&&this._queueRemoteRequestMulti(r.accountID,i,a,(function(i){try{_.Z.PAssert(572,!i||i.id===e.id,"If valid result, attachment should match remote event ID")}catch(o){_.Z.reportError(o)}if(i){var a=t._addRemoteEntry(r.accountID,n,i);t._eventCache.saveEntry(t.serializeExternalData(a))}}),(function(){e.notifyDataRequestFailed()}),e,hr)}else _o.settings.fixedMissingCalendars.get()?e.isLoaded()&&e.updateField("status","cancelled"):(this.needsFixMissingData||(this.needsFixMissingData=[]),this.needsFixMissingData.push(e),_.Z.timeoutOnce("fixcalendar",this.fixMissingCalendars,5e3,(function(){return t.needsFixMissingData=void 0}),this.needsFixMissingData))}},{key:"_createRemoteEntry",value:function(e,t,n){var r,i,a,o=!1;try{_.Z.PAssert(573,n.start,"Must always have valid start date",Object.keys(n))}catch(u){_.Z.reportError(u)}if(n.start)if(n.start.dateTime){try{_.Z.PAssert(574,n.end.dateTime,"End date format should always match start")}catch(u){_.Z.reportError(u)}r=new Date(n.start.dateTime),i=new Date(n.end.dateTime)}else if(n.start.date){try{_.Z.PAssert(575,n.end.date,"End date format should always match start")}catch(u){_.Z.reportError(u)}var s=n.start.date.split("-"),c=n.end.date.split("-");r=new Date(s[0],s[1]-1,s[2]),i=new Date(c[0],c[1]-1,c[2]),o=!0}n.htmlLink&&(a=n.htmlLink.split("?eid=")[1]);var l={id:n.id,accountID:e,calendarID:t,status:n.status,summary:n.summary,startTime:r,endTime:i,allDayEvent:o,recurringEventId:n.recurringEventId,eid:a,isComplete:this._getRemoteProperty(n,ir),isArchived:this._getRemoteProperty(n,sr),isStarred:this._getRemoteProperty(n,or),priority:this._getRemoteProperty(n,ar),locked:n.locked||!1,attendees:n.attendees,location:n.location,description:n.description,organizer:n.organizer?n.organizer.displayName||n.organizer.email||n.organizer.id:"Unknown"};return n.source&&(l.source={title:n.source.title,url:n.source.url}),l}},{key:"_addRemoteEntry",value:function(e,t,n){var r=this._createRemoteEntry(e,t,n);return this.cacheData(r.id,r),r}},{key:"createEntryFromLocal",value:function(e,t){return t.startTime=t.startTime?new Date(t.startTime):void 0,t.endTime=t.endTime?new Date(t.endTime):void 0,t.isComplete=this._propConverter[ir](t.isComplete),t.isArchived=this._propConverter[sr](t.isArchived),t.isStarred=this._propConverter[or](t.isStarred),t.priority=this._propConverter[ar](t.priority),t}},{key:"_notifyFailedRequest",value:function(e,t){e&&e.error&&!e.isInvalidToken&&"Invalid Credentials"!==e.error.message&&(e.error.code===w.Z.HTTPStatusCode.Unauthorized?(_.Z.log("LostPermission",t,e),_o.toasts.pushMessage(w.Z.MessageID.LostPermission)):e.error.code>=400&&e.error.code<500&&_.Z.log("Failed GCalendar request",e.error.code,e))}},{key:"_getRemoteProperty",value:function(e,t){try{_.Z.PAssert(576,e,"Must provide valid event info")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(577,t,"Must provide valid remote prop")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(578,this._propConverter[t],"Missing prop converter: ",t)}catch(r){_.Z.reportError(r)}var n;return e.extendedProperties&&e.extendedProperties.private&&(n=e.extendedProperties.private[rr+t]),this._propConverter[t]&&(n=this._propConverter[t](n)),n}},{key:"_updateAttachFromData",value:function(e,t){var n=[];for(var r in t)t.hasOwnProperty(r)&&e.isFieldDefined(r)&&(e.updateField(r,t[r]),n.push(r));return n}},{key:"_runRemoteUpdate",value:function(e,t,n,r,i,a){var o,s,c,l,u=arguments,d=this;try{_.Z.PAssert(579,!e.getField("locked"),"Should never try to modify an event that is locked")}catch(f){_.Z.reportError(f)}try{_.Z.PAssert(580,_.Z.isBoolean(t)||_.Z.isArray(t),"Must specify a boolean or list of fields for modified value")}catch(f){_.Z.reportError(f)}try{_.Z.PAssert(581,_.Z.isFunction(r),"Must provide a valid localDoneCB")}catch(f){_.Z.reportError(f)}try{_.Z.PAssert(582,_.Z.isFunction(i),"Must provide a valid remoteDoneCB")}catch(f){_.Z.reportError(f)}try{_.Z.PAssert(583,_.Z.isFunction(a),"Must provide a valid allDoneCB")}catch(f){_.Z.reportError(f)}var h=function(e,t,n){try{_.Z.PAssert(584,_.Z.isFunction(e),"Must supply a valid CB function")}catch(f){_.Z.reportError(f)}try{_.Z.PAssert(585,void 0!==t,"Must always pass success back from CB")}catch(f){_.Z.reportError(f)}if(e.apply(d,Array.prototype.slice.call(u,1)),e===r){try{_.Z.PAssert(586,void 0===o,"Local CB called twice")}catch(f){_.Z.reportError(f)}o=t,c=n}else if(e===i){try{_.Z.PAssert(587,void 0===s,"Remote CB called twice")}catch(f){_.Z.reportError(f)}s=t,l=n}void 0!==o&&void 0!==s&&a(o,s,c,l)},p=this.getCacheData(e.id);try{_.Z.PAssert(588,p,"Performing update on event that does not have local data")}catch(f){_.Z.reportError(f)}p?(this.addModifiedOffline(p,t),this._eventCache.saveEntry(this.serializeExternalData(p)),n((function(n,a){if(n){var o=d.getCacheData(e.id),s=!0!==t&&t;d.removeModifiedOffline(o,s),d._eventCache.saveEntry(d.serializeExternalData(o)),h(i,!0)}else h(r,!1),h(i,!1,a)}))):(h(r,!1),h(i,!1))}},{key:"_updateEvent",value:function(e,t,n,r,i,a){var o=this,s=this._updateAttachFromData(e,t);this._runRemoteUpdate(e,s,(function(r){o._updateRemoteEvent(e.getField("calendarID"),e.id,t,n,r)}),r,i,a)}},{key:"_updateRemoteEvent",value:function(e,t,n,r,i){var a=this;try{_.Z.PAssert(589,this.hasWritePermissionForCalendar(e),"Should not be calling _updateRemoteEvent for a read-only calendar")}catch(u){_.Z.reportError(u)}var o=this._createEventUpdateInfo(n),s=this._getCalendarInfo(e);try{_.Z.PAssert(590,s,"Missing calendar "+e)}catch(u){_.Z.reportError(u)}if(s){try{_.Z.PAssert(591,s.accountID,"Should have an accountID on the calendar")}catch(u){_.Z.reportError(u)}var c=$t.Z.fns("calendar").events.patch.packedFn,l={calendarId:e,eventId:t,resource:o};this._queueRemoteRequestMulti(s.accountID,c,l,(function(){i(!0)}),(function(n){if(n&&n.error&&n.error.code===w.Z.HTTPStatusCode.NotFound)a._eventCache.removeEntry(t),i(!0);else{var r=Object.keys(o);if(_.Z.log("Failed Update: ",e,t,r),_.Z.isHTTPStatusCode(n,w.Z.HTTPStatusCode.Forbidden)&&!a.isRateLimitError(n)){var s=a.getCacheData(t);s&&(s.locked=!0),a.cacheData(t,s,!0,["locked"])}i(!1,n),a._notifyFailedRequest(n,e)}}),void 0,fr||r)}}},{key:"_updateRemoteProperty",value:function(e,t,n,r,i,a){var o=this;e.updateField(t,n);var s={},c=void 0===n?null:n;s[rr+t]=c;var l={extendedProperties:{private:s}};this._runRemoteUpdate(e,[t],(function(t){o._updateRemoteEvent(e.getField("calendarID"),e.id,l,ur,t)}),r,i,a)}},{key:"_getStartEndFromDateInfo",value:function(e,t){var n,r,i,a=!1;if(e instanceof Date)e.hasTimeOfDay()||(a=!0),n=e,r=e.clone().addMilliseconds(t);else if(e instanceof $e.Z)n=e.getStart(),r=e.getEnd(),i=e.toICal();else try{_.Z.PAssert(592,!1,"Should always have a valid date")}catch(o){_.Z.reportError(o)}return{startTime:n,endTime:r,allDayEvent:a,recurrence:i}}},{key:"deleteCalendarEventForItem",value:function(e,t,n,r,i){var a=this;this.sendEvent("DeleteEvent");this._runRemoteUpdate(t,["status"],(function(n){e.getMooDate().removeGCal(),e.getDocumentOwner()?(e.onMooDateUpdated(w.Z.ChangeType.Local,!0),e.onAttachInlineUpdate()):e.deleteSelf(w.Z.ChangeType.Local),t.isLocalOnlyAttachment()?(t.updateField("status","cancelled"),n(!0)):a.deleteCalendarEvent(t,n)}),n,r,i)}},{key:"deleteCalendarEvent",value:function(e,t){var n=this;try{_.Z.PAssert(593,!e.isLocalOnlyAttachment(),"Should never make a remote request to delete a local-only event")}catch(l){_.Z.reportError(l)}var r=e.getField("calendarID"),i=this._getCalendarInfo(r);try{_.Z.PAssert(594,r&&i,"Tried to delete calendar event with no calendar")}catch(l){_.Z.reportError(l)}if(i){try{_.Z.PAssert(595,i.accountID,"Should have an accountID on the calendar")}catch(l){_.Z.reportError(l)}var a=e.id,o=$t.Z.fns("calendar").events.delete.packedFn,s={calendarId:r,eventId:a},c=function(){var r=n.getDefaultItemStore();e.updateField("status","cancelled"),e.forEachItem(r,(function(e){e.parent()&&(e.parent().removeChild(e,w.Z.ChangeType.Local),e.setParent(void 0))})),e.getData()?n._eventCache.saveEntry(n.serializeExternalData(e.getData())):n._eventCache.removeEntry(a),t(!0)};this._queueRemoteRequestMulti(i.accountID,o,s,(function(){c()}),(function(r){r&&r.error&&r.error.code===w.Z.HTTPStatusCode.Gone||r&&r.error&&r.error.code===w.Z.HTTPStatusCode.NotFound?c():(t(!1,r),n._notifyFailedRequest(r,e.getField("calendarID")))}),void 0,mr)}else t(!0)}},{key:"forceRemoteEventSync",value:function(e){if(!_.Z.isDemoMode()&&this._hasInitializedTasks){if(e&&this._eventCache.setMetadata(tr,{}),this.hasRecurringTask("CalendarEventSync"))this.getRecurringTask("CalendarEventSync").forceUpdate();if(this.hasRecurringTask("CalendarListSync"))this.getRecurringTask("CalendarListSync").forceUpdate()}}},{key:"getDefaultExportCalendarID",value:function(){return _.Z.isDemoMode()?"DemoCal":this.getSetting(this.Settings.ExportCalendar)}},{key:"isExportCalendarID",value:function(e){return this.getSetting(this.Settings.ExportCalendar)===e}},{key:"hasWritePermissionForAttach",value:function(e){var t=!1,n=e.getField("calendarID"),r=this._getCalendarInfo(n);return r&&("writer"!==r.accessRole&&"owner"!==r.accessRole||(t=!0)),t}},{key:"hasWritePermissionForCalendar",value:function(e){var t=!1,n=this._getCalendarInfo(e);return n&&("writer"!==n.accessRole&&"owner"!==n.accessRole||(t=!0)),t}},{key:"getCalendarBackgroundColor",value:function(e){var t="rgba(0, 120, 255, 0.75)",n=this._getCalendarInfo(e);return n&&n.backgroundColor&&(t=n.backgroundColor),t}},{key:"getCalendarForegroundColor",value:function(e){var t="#000000",n=this._getCalendarInfo(e);return n&&n.foregroundColor&&(t=n.foregroundColor),t}},{key:"getCalendarDisplayProps",value:function(e){var t,n=this._getCalendarInfo(e);return n&&"reader"===n.accessRole&&(t={style:{backgroundImage:"url(/img/stripe.png)",backgroundRepeat:"repeat"}}),t}},{key:"shouldDisplayOverdueInAgenda",value:function(){return this.getSetting(this.Settings.DisplayOverdueInAgenda)}},{key:"createEventForEmail",value:function(e,t,n,r,i,a){var o=this;try{_.Z.PAssert(596,_.Z.isString(e),"Must provide a valid calendarID for email")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(597,_.Z.isString(t),"Must provide a valid subject")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(598,_.Z.isString(n),"Must provide a valid email url")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(599,_.Z.isDateValid(r),"Must provide a valid schedule date")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(600,_.Z.isNumber(i),"Must provide a valid event duration")}catch(c){_.Z.reportError(c)}this.sendEvent("AddEmailEvent");var s={duration:i,summary:t,date:r,source:{title:t,url:n}};this.createNewCalendarEvent(e,s,(function(e){if(e){var t=o.getDefaultItemStore();t.hasItem(e.id)||(_o.PaneUpdateBatcher.beginUpdateItems(),o._createItem(t,e),_o.PaneUpdateBatcher.commitUpdateItems())}}),_.Z.newEmptyFn(),a)}},{key:"createEventForItem",value:function(e,t){!e.hasPluginAttachment(this.id)&&e.getNextDate()&&((t=t||this.getDefaultExportCalendarID())?e.getDate()?(this.sendEvent("AddSingleEvent"),this.newCalendarEventForItem(t,e,(function(e,t,n,r){e||t?t||r&&r.error&&-1===r.error.code?_o.onIntroAction("AddCalendar"):_o.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:w.Z.MessageAction.Okay}):n&&!1===n.isValid?_o.toasts.pushMessage({text:"The event you are trying to create is not valid.",action:w.Z.MessageAction.Okay}):_o.toasts.pushMessage({text:'There was an error creating your calendar event. There may be a problem with your authorization. Please try toggling your "Save To" calendar off and back on, or try toggling the Google Calendar plugin off and on. Contact support@moo.do if you have questions',action:w.Z.MessageAction.OpenCalendarSettings})}))):(this.sendEvent("AddRepeatEvent"),_o.toasts.pushMessage({text:"Moo.do does not currently support adding repeated dates to Google Calendar.",action:w.Z.MessageAction.Okay})):_o.toasts.pushMessage({text:"Please select a valid Google Calendar to save your events to.",action:w.Z.MessageAction.OpenCalendarSettings}))}},{key:"newCalendarEventForItem",value:function(e,t,n){var r=this;try{_.Z.PAssert(601,t,"Must provide a valid item")}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(602,t.getNextDate(),"Item must have a valid date")}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(603,!t.hasPluginAttachment(w.Z.PluginID.GCalendar),"Must not already have a valid calendar attachment associated with the item")}catch(s){_.Z.reportError(s)}var i=t.getDuration();i||(i=t.allDayDate()?_.Z.days(1):Zr);var a={duration:i,summary:t.getCalendarParsedText()};if(t.getDate()&&(a.date=t.getDate()),t.hasNote()&&(a.description=t.getNote().getParsedText()),t.hasAttachmentType(w.Z.PluginType.Email)){var o=t.getAttachmentByType(w.Z.PluginType.Email);a.source={title:o.getField("subject"),url:o.getPlugin().getURLForAttachment(o)}}this.createNewCalendarEvent(e,a,(function(e){if(e)if(t.isDestroyed()){var n=r.getDefaultItemStore();n.hasItem(e.id)||(_o.PaneUpdateBatcher.beginUpdateItems(),r._createItem(n,e),_o.PaneUpdateBatcher.commitUpdateItems())}else t.getMooDate().setGCalIdAndCalendar(e.id,e.calendarID),t.onMooDateUpdated(w.Z.ChangeType.Local,!0),t.setTextToWhatItAlreadyIs(w.Z.ChangeType.Local)}),_.Z.newEmptyFn(),n)}},{key:"createNewCalendarEvent",value:function(e,t,n,r,i){var a=this;try{_.Z.PAssert(605,t,"Must have valid event info passed in")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(606,t.date,"Must have valid date for event")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(607,void 0!==t.duration,"Must have a valid event duration")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(608,t.summary,"Must have a valid event summary")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(609,_.Z.isFunction(n),"Must supply a valid local done CB")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(610,_.Z.isFunction(r),"Must supply a valid remote done CB")}catch(d){_.Z.reportError(d)}var o=_.Z.generateTempId(),s=this._getStartEndFromDateInfo(t.date,t.duration),c=this._getCalendarInfo(e);if(c){try{_.Z.PAssert(611,c.accountID,"Should have an accountID on the calendar")}catch(d){_.Z.reportError(d)}var l={id:o,accountID:c.accountID,calendarID:e,status:"confirmed",summary:t.summary,source:t.source,description:t.description,startTime:s.startTime,endTime:s.endTime,allDayEvent:s.allDayEvent,recurrence:s.recurrence,organizer:c.accountID,modifiedOffline:!0};this.cacheData(o,l),this._eventCache.saveEntry(l),n(l,!0);var u=this.getAttachment(l.id);_.Z.isDemoMode()?(r(!0),i(!0,!0)):this._runRemoteUpdate(u,!0,(function(t){a._createRemoteEventFromCacheData(c.accountID,e,l,_.Z.newEmptyFn(),t,i)}),_.Z.newEmptyFn(),r,(function(){a.getDefaultItemStore().updateItems()}))}}},{key:"_createRemoteEventFromCacheData",value:function(e,t,n,r,i,a){var o,s,c,l,u=arguments,d=this;try{_.Z.PAssert(612,!this._pendingCreates[n.id],"Should never try and double create a calendar event")}catch(p){_.Z.reportError(p)}this._pendingCreates[n.id]=!0;var h=function(e,t,n){try{_.Z.PAssert(613,_.Z.isFunction(e),"Must supply a valid CB function")}catch(p){_.Z.reportError(p)}try{_.Z.PAssert(614,void 0!==t,"Must always pass success back from CB")}catch(p){_.Z.reportError(p)}if(e.apply(d,Array.prototype.slice.call(u,1)),e===r){try{_.Z.PAssert(615,void 0===o,"Local CB called twice")}catch(p){_.Z.reportError(p)}o=t,c=n}else if(e===i){try{_.Z.PAssert(616,void 0===s,"Remote CB called twice")}catch(p){_.Z.reportError(p)}s=t,l=n}void 0!==o&&void 0!==s&&a(o,s,c,l)};this._createNewRemoteEvent(t,n,(function(a,o){delete d._pendingCreates[n.id],_o.PaneUpdateBatcher.beginUpdateItems();var s=d.getAttachment(n.id);if(a){var c=n.id;d.changeID(s,s.id,a.id);var l=d.getDefaultItemStore();l.hasItem(c)&&l.destroyItem(c),d._eventCache.removeEntry(c);var u=d._addRemoteEntry(e,t,a);d._createItem(l,u),d._eventCache.saveEntry(d.serializeExternalData(u)),h(r,!0),s.updateField("isInvalid",!1),h(i,!0)}else s.updateField("isInvalid",!0),h(r,!1),h(i,!1,o);_o.PaneUpdateBatcher.commitUpdateItems()}))}},{key:"_createNewRemoteEvent",value:function(e,t,n){var r=this;try{_.Z.PAssert(617,t,"Must specify valid event info")}catch(l){_.Z.reportError(l)}try{_.Z.PAssert(618,t.startTime instanceof Date,"Must have a valid start time")}catch(l){_.Z.reportError(l)}try{_.Z.PAssert(619,t.endTime instanceof Date,"Must have a valid end time")}catch(l){_.Z.reportError(l)}try{_.Z.PAssert(620,t.summary,"Must have a valid event title")}catch(l){_.Z.reportError(l)}var i,a,o=this._getCalendarInfo(e);try{_.Z.PAssert(621,o.accountID,"Should have an accountID on the calendar")}catch(l){_.Z.reportError(l)}t.allDayEvent?(i={date:t.startTime.toString("yyyy-MM-dd")},a={date:t.endTime.toString("yyyy-MM-dd")}):(i={dateTime:t.startTime.toISOString()},a={dateTime:t.endTime.toISOString()});var s=$t.Z.fns("calendar").events.insert.packedFn,c={calendarId:e,resource:{start:i,end:a,recurrence:t.recurrence,summary:t.summary,description:t.description,status:t.status,source:t.source}};this._queueRemoteRequestMulti(o.accountID,s,c,(function(e){n(e)}),(function(t){n(void 0,t),r._notifyFailedRequest(t,e)}),void 0,pr)}},{key:"getImportCalendarList",value:function(){var e=this,t=this.getSetting(this.Settings.ImportCalendars);return t?t.filter((function(t){return e.hasSyncAccount(t.accountID,!0)})):[]}},{key:"getReadableCalendarList",value:function(e){return this._getCalendarList("reader",e)}},{key:"getWritableCalendarList",value:function(e){return this._getCalendarList("writer",e)}},{key:"getWritableCalendarListSync",value:function(e){var t=this.getImportCalendarList();return t?t.filter((function(t){return(!e||t.accountID===e||!t.accountID&&e===ie.Z.getDefaultAccountID())&&("writer"===t.accessRole||"owner"===t.accessRole)})):[]}},{key:"getFullCalendarList",value:function(e){var t=this,n=this.getImportCalendarList();this.getReadableCalendarList((function(r){if(n&&r){var i=n.map((function(e){var t=_.Z.clone(e);return t.accessRole="none",t})).filter((function(e){if(t.hasSyncAccount(e.accountID)){for(var n=0,i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r[i].id===e.id)return!1}return!0}}));r.pushArray(i)}e(r)}))}},{key:"createCalendar",value:function(e,t,n){var r=this,i=$t.Z.fns("calendar").calendars.insert.packedFn,a={resource:{summary:t}};this._queueRemoteRequestMulti(e,i,a,(function(e){n(e)}),(function(e){n(),r._notifyFailedRequest(e,void 0)}),void 0,vr,{}),this.sendEvent("CreateCalendar")}},{key:"_getCalendarList",value:function(e,t){var n=this.getSyncAccounts(),r=n.length,i=[],a=function(e){if(r--,e&&(i=_.Z.arrayUniques(i.concat(e))),0===r){var n={};i=i.filter((function(e,t){var r=i.find((function(n,r){return t!==r&&n.id===e.id}));return r&&n[e.backgroundColor]&&(e.backgroundColor=r.backgroundColor),n[e.backgroundColor]=!0,!r||"owner"===e.accessRole||"owner"!==r.accessRole})),t(i)}};if(0===n.length)t([]);else for(var o=0,s=0;s<n.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;this._getCalendarListForAccount(n[s],e,a)}}},{key:"_getCalendarListForAccount",value:function(e,t,n){var r=this,i=$t.Z.fns("calendar").calendarList.list.packedFn,a={minAccessRole:t,userId:"me"};this._queuePagedRemoteRequestMulti(e,i,a,(function(t){t=t.map((function(t){return t.accountID=e,t})),n(t)}),(function(e){r._notifyFailedRequest(e,void 0),n([])}),void 0,dr,{getAllPages:!0,timeoutMS:0})}},{key:"handleEventUpdate",value:function(e,t,n){this._numEntriesSyncd++;var r=this.getDefaultItemStore();if("cancelled"===n.status){if(this.hasAttachment(n.id)){var i=this.getAttachment(n.id);i.getField("calendarID")===t&&(this._eventCache.removeEntry(n.id),this.hasCacheData(n.id)&&(i.updateField("status","cancelled"),i.forEachItem(r,(function(e){e.parent()&&(e.parent().removeChild(e,w.Z.ChangeType.Remote),e.setParent(void 0))}))))}}else{var a=this.getCacheData(n.id),o=this._createRemoteEntry(e,t,n);a&&a.modifiedOffline&&this._mergeEventData(a,o),this.cacheData(o.id,o),this._eventCache.saveEntry(this.serializeExternalData(o),this.compareCachedData);var s=this.getAttachment(n.id);this._beginIgnorePropertyChanges();try{this.updateVMLIsFromUpdate(s,a,o)}catch(c){_.Z.reportError(c)}this._endIgnorePropertyChanges(),r.hasItem(o.id)||this._shouldDisplayTime(o.startTime,o.endTime)&&this._eventNeedsItem(o)&&this._createItem(r,o)}}},{key:"compareCachedData",value:function(e,t){return this._propertySets[w.Z.PluginLoad.Full].some((function(n){var r=e[n];return"endTime"===n&&(r=_.Z.isString(r)?new Date(r):r),(r||t[n])&&!_.Z.deepEqual(r,t[n])}))}},{key:"_mergeEventData",value:function(e,t){var n=0;try{_.Z.PAssert(624,e.modifiedOffline,"Should only merge events that were locally modified")}catch(o){_.Z.reportError(o)}var r=e.modifiedOffline;try{_.Z.PAssert(625,_.Z.isArray(r),"Should not be receiving an update for an event that was created locally")}catch(o){_.Z.reportError(o)}for(var i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i];0,t[a]=e[a]}t.modifiedOffline=e.modifiedOffline}},{key:"updateVMLIsFromUpdate",value:function(e,t,n){var r=this;try{_.Z.PAssert(626,e,"Must provide a valid attachment")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(627,n,"Must provide valid new data")}catch(i){_.Z.reportError(i)}t?e.forEachItem(void 0,(function(e){e.getParsedText();if(e.belongsToItemStore(_o.itemStoreManager.getTempItemStore()),t.summary!==n.summary&&!e.hasAttachmentType(w.Z.PluginType.Email)){var i=n.summary?n.summary.replace(/\u2000/g,""):"",a=e.getPrefix()+i+" "+w.Z.CharDate;e.setText(a,w.Z.ChangeType.Remote)}var o=r.mooDateFromCacheEntry(n);if(e.setMooDate(o,w.Z.ChangeType.Remote,["gcalCalendar","gcalId","duration"]),t.description!==n.description&&e.belongsToItemStore(r.getDefaultItemStore()))if(e.hasNote())n.description?e.getNote().setText(n.description,w.Z.ChangeType.Remote):e.setNote(void 0,w.Z.ChangeType.Remote);else if(n.description){var s,c=n.id+"_note";r.getDefaultItemStore().hasItem(c)?(s=r.getDefaultItemStore().getItem(c)).setText(n.description,w.Z.ChangeType.Remote):s=r.getDefaultItemStore().createItem(c,n.description,e.id,{isNote:!0},w.Z.ChangeType.Remote),e.setNote(s,w.Z.ChangeType.Remote)}r.areDatesEqual(t.isComplete,n.isComplete)||e.setComplete(!!n.isComplete,w.Z.ChangeType.Remote),t.isArchived!==n.isArchived&&e.setArchived(n.isArchived),t.isStarred!==n.isStarred&&e.setStarred(n.isStarred,w.Z.ChangeType.Remote),t.priority!==n.priority&&e.setPriority(n.priority,w.Z.ChangeType.Remote)})):e.forEachItem(void 0,(function(e){e.setTextToWhatItAlreadyIs(w.Z.ChangeType.Remote)}))}},{key:"setSyncToken",value:function(e,t){try{_.Z.PAssert(628,_.Z.isString(e),"Must provide a valid calendar ID to clear sync token for")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(629,_.Z.isString(t),"Must provide a valid calendar ID to clear sync token for")}catch(i){_.Z.reportError(i)}var n=this._eventCache.getMetadata(tr)||{},r=Date.now()+this._syncTokenDuration;n=Object.assign({},n,ne()({},e,{token:t,date:Date.now(),expires:r})),this._eventCache.setMetadata(tr,n)}},{key:"clearSyncToken",value:function(e){try{_.Z.PAssert(630,_.Z.isString(e),"Must provide a valid calendar ID to clear sync token for")}catch(r){_.Z.reportError(r)}var t=this._eventCache.getMetadata(tr);if(t){t[e];var n=ee()(t,[e].map(Jn));this._eventCache.setMetadata(tr,n)}}},{key:"clearCalendarEventCache",value:function(e,t){var n=this;try{_.Z.PAssert(631,_.Z.isString(e),"Must provide a valid calendar ID to clear event cache for")}catch(r){_.Z.reportError(r)}this._eventCache.getFilterEntries((function(t){return t.calendarID===e})).then((function(e){if(e){for(var r=0,i=0;i<e.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;n._eventCache.removeEntry(e[i].id)}t&&t(!0)}else t&&t(!1)}))}},{key:"_calendarSyncComplete",value:function(e,t){if(t.length>0){if(se.Z.notifySyncError(t),this.isOnline())for(var n=0,r=0;r<t.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=t[r];i.result!==w.Z.SyncResult.FailureNetwork&&i.result!==w.Z.SyncResult.Success&&_o.toasts.pushMessage(w.Z.MessageID.CalendarSync)}}else se.Z.notifySyncError(void 0),_o.toasts.clearMessage(w.Z.MessageID.CalendarSync);var a=this.getSetting(this.Settings.ExportCalendar);if(a){for(var o=0,s=!1,c=0;c<t.length;++c){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(t[c].id===a){s=!0;break}}s||this._syncOfflineChanges(this._notifyOfflineSyncFailures)}e.length>0&&this.onCalendarsSynced.notify()}},{key:"_shouldExpireToken",value:function(e){var t=!0;return e&&(e.expires?t=e.expires<Date.now():e.date&&(t=e.date+this._syncTokenDuration<Date.now())),t}},{key:"_getCalendarInfo",value:function(e){return this._calendarList[e]}},{key:"allowTextEditing",value:function(e,t){var n=t.getField("calendarID");return this.hasWritePermissionForCalendar(n)||t.isLocalOnlyAttachment()}},{key:"_createCalendarFromRemote",value:function(e){var t={id:e.id,accountID:e.accountID,summary:e.summary,accessRole:e.accessRole};return _.Z.isValidColor(e.backgroundColor)&&(t.backgroundColor=e.backgroundColor),_.Z.isValidColor(e.foregroundColor)&&(t.foregroundColor=e.foregroundColor),t}},{key:"runCalendarListSync",value:function(e){var t=this;this.getReadableCalendarList((function(n){if(n){var r=0;t._calendarList={};for(var i=0;i<n.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=n[i];t._calendarList[a.id]=t._createCalendarFromRemote(a)}_o.toasts.clearMessage(w.Z.MessageID.CalendarSync);var o=t.getDefaultExportCalendarID();0,o&&!t._calendarList[o]&&(t.setSetting(t.Settings.ExportCalendar,void 0),_o.toasts.pushMessage({text:"Your Default Save calendar is no longer accessible. Please select another or update your sync accounts.",action:w.Z.MessageAction.OpenCalendarSettings})),t._eventCache.setMetadata(nr,t._calendarList)}else t.isOnline()&&_o.toasts.pushMessage(w.Z.MessageID.CalendarSync);e&&e()}))}},{key:"_notifyTokenExpired",value:function(e){this._purgeOldDataTimeout&&clearTimeout(this._purgeOldDataTimeout),this._purgeOldDataTimeout=setTimeout(this._purgeOldData,0)}},{key:"_notifyCalendarUnsyncd",value:function(e){_.Z.log("Detected calendar "+e+" is no longer syncd"),this._clearCachedData(e,(function(t){t||_.Z.log("Failure unsyncing calendar "+e)})),this._clearCalendarItems(e)}},{key:"_clearCalendarItems",value:function(e){var t=this.getDefaultItemStore();_o.PaneUpdateBatcher.beginUpdateItems(),t.forEach((function(n){n.hasAttachments()&&(n.getAttachment(0).getField("calendarID")===e&&t.destroyItem(n.id))})),_o.PaneUpdateBatcher.commitUpdateItems()}},{key:"_getSyncResultFromResult",value:function(e,t){var n=w.Z.SyncResult.Success;if(t&&t.error&&t.error.code){var r=t.error.code;if(r===w.Z.HTTPStatusCode.Unauthorized){var i=this._getCalendarInfo(e);n=i&&"owner"===i.accessRole?w.Z.SyncResult.FailureOAuth:i&&"writer"===i.accessRole?w.Z.SyncResult.FailureNoWrite:w.Z.SyncResult.FailureNoRead}else n=r===w.Z.HTTPStatusCode.NotFound?w.Z.SyncResult.FailureNoRead:r===w.Z.HTTPStatusCode.Network?w.Z.SyncResult.FailureNetwork:r===w.Z.HTTPStatusCode.Forbidden?w.Z.SyncResult.FailureNoRead:w.Z.SyncResult.FailureUnknown}return n}},{key:"runCalendarSync",value:function(e,t){var n=this,r=0,i=0,a=[],o=[],s=function(t,s,c){try{_.Z.PAssert(632,i<r,"Should never have more calendars syncd than we tried to sync")}catch(l){_.Z.reportError(l)}t?a.push({id:s,result:w.Z.SyncResult.Success}):o.push({id:s,result:n._getSyncResultFromResult(s,c)}),++i===r&&(n._calendarSyncComplete(a,o),e&&e())},c=this._eventCache.getMetadata(tr);this._updateSyncTimes();var l=this.getImportCalendarList();if(l&&l.length>0){var u=0;r=l.length;for(var d=0;d<l.length;++d){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var h=l[d];_.Z.isObject(h)||(h={id:l[d]});var p=c?c[h.id]:void 0,f=void 0;this._shouldExpireToken(p)?(this._notifyTokenExpired(h.id),f=void 0):f=p.token,this.performCalendarSync(h,f,s,t)}for(var g in c)if(c.hasOwnProperty(g)){for(var m=0,v=!1,y=0;y<l.length;++y){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;var k=l[y];if(_.Z.isObject(k)||(k={id:l[y]}),k.id===g){v=!0;break}}v||this._notifyCalendarUnsyncd(g)}}else this._clearAllData(),this._calendarSyncComplete([],[]),e&&e()}},{key:"performCalendarSync",value:function(e,t,n,r){var i=this,a=e.id,o=e.accountID;try{_.Z.PAssert(633,_.Z.isString(a),"Must provide a valid calendar ID for each sync op")}catch(u){_.Z.reportError(u)}if(!o){var s=this._getCalendarInfo(e.id);s&&(o=s.accountID),o||(o=ie.Z.getDefaultAccountID())}var c=$t.Z.fns("calendar").events.list.packedFn,l={calendarId:a,singleEvents:!0};r||(t?l.syncToken=t:(l.timeMin=this._minSyncStartTime.toISOString(),l.timeMax=this._maxSyncStartTime.toISOString()));this._queuePagedRemoteRequestMulti(o,c,l,(function(e,t,r){var s,c=0;r&&(s=r.nextSyncToken,i.setSyncToken(a,s)),_o.PaneUpdateBatcher.beginUpdateItems();for(var l=0;l<e.length;++l){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;i.handleEventUpdate(o,a,e[l])}_o.PaneUpdateBatcher.commitUpdateItems(),n(!0,a)}),(function(t){t&&t.error&&t.error.code===w.Z.HTTPStatusCode.Gone?i._clearCachedData(a,(function(o){o?i.performCalendarSync(e,void 0,n,r):n(!1,a,t)})):(n(!1,a,t),i._notifyFailedRequest(t,a))}),void 0,lr,{getAllPages:!0,timeoutMS:0})}},{key:"_createEventUpdateInfo",value:function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&er.indexOf(n)>=0&&(t[n]=e[n]);return t}},{key:"_notifyOfflineSyncFailures",value:function(e,t,n){t>0&&(se.Z.notifySyncError(n),_.Z.log("Failed to sync offlineChanges: ",t))}},{key:"_syncOfflineChanges",value:function(e){var t=this;if(!this._syncingOfflineChanges){this._syncingOfflineChanges=!0;var n=0,r=0,i=0,a=[],o=function(o,s){s===w.Z.SyncResult.Success?r++:(i++,a.push({id:o,result:s})),n===r+i&&(t._syncingOfflineChanges=!1,e(r,i,a))};this._eventCache.getFilterEntries((function(e){return!!e.modifiedOffline})).then((function(e){n=e.length,e.forEach((function(e){var n=t.createEntryFromLocal(e.id,e);if(!n.isInvalid){var r=n.calendarID,i=n.accountID;_.Z.isTempId(n.id)&&!t._pendingCreates[n.id]?t._createRemoteEventFromCacheData(i,n.calendarID,n,_.Z.newEmptyFn(),(function(e,n){o(r,t._getSyncResultFromResult(r,n))}),_.Z.newEmptyFn()):t.hasWritePermissionForCalendar(r)?t._updateRemoteEvent(r,n.id,n,gr,(function(e,i){e?(delete n.modifiedOffline,t._eventCache.saveEntry(n).then((function(){return o(r,w.Z.SyncResult.Success)})).catch((function(){return o(r,w.Z.SyncResult.FailureUnknown)}))):o(r,t._getSyncResultFromResult(r,i))})):(delete n.modifiedOffline,t._eventCache.saveEntry(n),o(n.calendarID,w.Z.SyncResult.Success))}}))}))}}},{key:"_getEventDuration",value:function(e){try{_.Z.PAssert(634,!e.getField("allDayEvent"),"All day events do not have valid durations")}catch(r){_.Z.reportError(r)}var t=e.getField("startTime"),n=e.getField("endTime");try{_.Z.PAssert(635,t&&n,"Must always have valid start and end times")}catch(r){_.Z.reportError(r)}return n-t}},{key:"_computeItemDates",value:function(e,t,n){var r,i;t.getDate()&&(i=(r=t.getDate().clone()).clone().addMilliseconds(t.getDuration())),r&&i&&(t.allDayDate()?(e.start={date:r.toString("yyyy-MM-dd"),dateTime:null},e.end={date:i.toString("yyyy-MM-dd"),dateTime:null}):(e.start={dateTime:r.toISOString(),date:null},e.end={dateTime:i.toISOString(),date:null})),e.startTime=r,e.endTime=i}},{key:"_queueEventUpdate",value:function(e,t){if(this._updateAttachFromData(e,t),this._eventUpdateTimeout&&clearTimeout(this._eventUpdateTimeout),this._eventUpdateTimeout=setTimeout(this._flushEventUpdateQueue,2e3),!e.isLocalOnlyAttachment()){var n=this._eventUpdateQueue[e.id];if(n)for(var r in t)t.hasOwnProperty(r)&&(n.info[r]=t[r]);else this._eventUpdateQueue[e.id]={attach:e,info:t}}}},{key:"onShutdown",value:function(){}},{key:"_flushEventUpdateQueue",value:function(){this._eventUpdateTimeout=void 0;var e=function(e,t){e||t?_o.toasts.clearMessage(w.Z.MessageID.CalendarSaveFail):_o.toasts.pushMessage(w.Z.MessageID.CalendarSaveFail)};for(var t in this._eventUpdateQueue)if(this._eventUpdateQueue.hasOwnProperty(t)){var n=this._eventUpdateQueue[t];this._updateEvent(n.attach,n.info,yr,_.Z.newEmptyFn(),_.Z.newEmptyFn(),e)}this._eventUpdateQueue={}}},{key:"_handleAttachDeleted",value:function(e,t){var n=this,r=e.getField("status");this.deleteCalendarEvent(e,(function(i){if(i){n.isMovingEvent||_o.toasts.pushMessage({text:"Event removed from your calendar.",actionText:"UNDO",action:function i(){n._updateEvent(e,{status:r},kr,_.Z.newEmptyFn(),(function(e){e||_o.toasts.pushMessage({text:"There was an error re-adding the event to your calendar",actionText:"RETRY",action:i,timeout:1e4})}),_.Z.newEmptyFn());var a=n._createItemText(e.getData());t.setText(a,w.Z.ChangeType.Local),t.parent()||t.setParent(n.getDefaultItemStore().getRoot()),t.getIndex()<0&&t.parent().insertItem(t)},timeout:1e4})}else _o.toasts.pushMessage({text:"There was an error removing the event from your calendar.",actionText:"RETRY",action:n._handleAttachDeleted.bind(n,e,t),timeout:1e4})}))}},{key:"notifyItemNoteChanged",value:function(e,t){this._queueEventUpdate(e,{description:t.getRawText()})}},{key:"notifyItemDateChanged",value:function(e,t){var n={};this._computeItemDates(n,t,e),this._queueEventUpdate(e,n)}},{key:"notifyItemTextChanged",value:function(e,t,n){if(n)this._handleAttachDeleted(e,t);else if(e.getField("recurringEventId")&&t.getCalendarParsedText()===e.getField("summary"))_o.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"});else if(!_.Z.isDemoMode())if(t.getDate()){var r,i=t.getCalendarParsedText(),a=e.getField("summary"),o=e.getField("source");if(t.hasAttachmentType(w.Z.PluginType.Email)){var s=t.getAttachmentByType(w.Z.PluginType.Email);r={title:s.getField("subject"),url:s.getPlugin().getURLForAttachment(s)}}var c={summary:i,start:void 0,end:void 0,source:void 0},l=!1;i!==a&&(l=!0),o&&!r||!o&&r?l=!0:o&&r&&(o.title===r.title&&o.url===r.url||(l=!0));var u=t.getDate(),d=e.getField("startTime");this.areDatesEqual(d,u)||(l=!0);var h=t.getEndDate(),p=e.getField("endTime");this.areDatesEqual(p,h)||(l=!0),l&&(this._computeItemDates(c,t,e),c.source=r,this._queueEventUpdate(e,c)),e.updateField("isInvalid",!1)}else e.updateField("isInvalid",!0)}},{key:"_beginIgnorePropertyChanges",value:function(){this._ignoringPropertyChanges=!0}},{key:"_endIgnorePropertyChanges",value:function(){this._ignoringPropertyChanges=!1}},{key:"_isIgnoringPropertyChanges",value:function(){return this._ignoringPropertyChanges}},{key:"notifyItemPropertyChanged",value:function(e,t,n){if(!e.getField("locked")&&this.hasWritePermissionForCalendar(e.getField("calendarID"))&&(!_.Z.isRemoteChange(n)||!this._isIgnoringPropertyChanges())){var r=e.getField("isComplete"),i=e.getField("isArchived"),a=e.getField("isStarred"),o=e.getField("priority"),s=t.dateCompleted,c=t.isArchived(),l=t.isStarred(),u=t.getPriority(),d=_.Z.newEmptyFn(),h=_.Z.newEmptyFn(),p=function(e,t,n,r){e||t?_o.toasts.clearMessage(w.Z.MessageID.CalendarSaveFail):_o.toasts.pushMessage(w.Z.MessageID.CalendarSaveFail)};this.areDatesEqual(r,s)||(_.Z.isLocalChange(n)?this._updateRemoteProperty(e,"isComplete",s,d,h,p):e.updateField("isComplete",s)),i!==c&&(_.Z.isLocalChange(n)?this._updateRemoteProperty(e,"isArchived",c,d,h,p):e.updateField("isArchived",c)),a!==l&&(_.Z.isLocalChange(n)?this._updateRemoteProperty(e,"isStarred",l,d,h,p):e.updateField("isStarred",l)),o!==u&&(_.Z.isLocalChange(n)?this._updateRemoteProperty(e,"priority",u,d,h,p):e.updateField("priority",u))}}},{key:"_clearCachedData",value:function(e,t){this.clearSyncToken(e),this.clearCalendarEventCache(e,t)}},{key:"_clearAllData",value:function(e){var t;this._eventCache.clearMetadata(),this._eventCache.clearCache().then((function(){e&&e(!0)})),null===(t=this.getDefaultItemStore())||void 0===t||t.clearStore()}},{key:"getAttachmentClass",value:function(e){var t=["plugin_gcalendar","c-date"];return e.isLoaded()&&(e.getField("isInvalid")&&t.push("invalid"),"cancelled"===e.getField("status")&&t.push("eventDeleted")),t}},{key:"getAttachmentTooltip",value:function(e){var t;return this.isPluginBlocked()?t="Go premium to view calendar events":e.isLoaded()?(e.isLocalOnlyAttachment()?t="Syncing event...":e.getField("isInvalid")&&(t="Item has an invalid date"),"cancelled"===e.getField("status")&&(t="Item was deleted from Google Calendar")):t="Plugin is loading data",t}},{key:"areDatesEqual",value:function(e,t){var n=!1;return e&&t?_.Z.isDateValid(e)&&_.Z.isDateValid(t)&&(n=e.equals(t)):n=!e&&!t,n}},{key:"parsePriority",value:function(e){var t=_.Z.parseInt(e);return isNaN(t)&&(t=w.Z.VMLIFlag.None),t}},{key:"fieldsHaveParseEffect",value:function(e){return(!e||1!==e.length||"isComplete"!==e[0])&&d()(v()(n.prototype),"fieldsHaveParseEffect",this).call(this,e)}},{key:"changeCalendarForEvent",value:function(e,t){var n=this,r=e.getField("calendarID"),i=this._getCalendarInfo(r),a=i.id;try{_.Z.PAssert(638,i.accountID,"Should have an accountID on the calendar")}catch(l){_.Z.reportError(l)}var o=$t.Z.fns("calendar").events.move.packedFn,s={eventId:e.id,calendarId:r,destination:t};e.updateField("calendarID",t,!0);var c=function(){e.forEachItem(_o.itemStoreManager.getDefaultItemStore(),(function(e){var n=e.getMooDate();n&&(n.setGCalCalendar(t),e.onMooDateUpdated(w.Z.ChangeType.Local,!0),e.setTextToWhatItAlreadyIs(w.Z.ChangeType.Local))}))};this._queueRemoteRequestMulti(i.accountID,o,s,c,(function(t){e.updateField("calendarID",a,!0),t&&t.error&&t.error.code===w.Z.HTTPStatusCode.Gone?c():(t&&t.error&&(t.error.code,w.Z.HTTPStatusCode.NotFound),n._notifyFailedRequest(t,e.getField("calendarID")))}),void 0,_r)}},{key:"getCalendarForAttach",value:function(e){if(e.hasField("calendarID"))return this._getCalendarInfo(e.getField("calendarID"))}},{key:"fixMissingCalendars",value:function(){this.runCalendarSync(),_o.settings.fixedMissingCalendars.set(!0)}},{key:"getWriteableCalendarsForItem",value:function(e){var t,n;if(this.isAvailable()&&this.isEnabled()){if(e.hasPluginAttachment(w.Z.PluginID.GCalendar)){var r=e.getAttachmentByPlugin(w.Z.PluginID.GCalendar),i=this.getCalendarForAttach(r);i&&(t=i.id)}n=this.getWritableCalendarListSync()}return{selected:t,calendars:n}}},{key:"setCalendarForItem",value:function(e,t){var n=this,r=e.getAttachmentByPlugin(w.Z.PluginID.GCalendar);if(t)if(e.hasPluginAttachment(w.Z.PluginID.GCalendar)){var i=r.getField("calendarID"),a=this._getCalendarInfo(i);this._getCalendarInfo(t).accountID===a.accountID?this.changeCalendarForEvent(r,t):(this.isMovingEvent=!0,this.deleteCalendarEvent(r,(function(r){r?n.newCalendarEventForItem(t,e,(function(){n.isMovingEvent=!1})):n.isMovingEvent=!1})))}else this.createEventForItem(e,t);else e.hasPluginAttachment(w.Z.PluginID.GCalendar)&&this.deleteCalendarEventForItem(e,r,_.Z.newEmptyFn(),_.Z.newEmptyFn(),(function(){console.log("Done")}))}},{key:"onSyncAccountsChanged",value:function(e,t){var r=this;d()(v()(n.prototype),"onSyncAccountsChanged",this).call(this,e,t),t.forEach((function(e){r._clearCachedData(e)})),this.isActive()&&e.length>0&&this.runCalendarSync()}},{key:"getUnstyledText",value:function(e){return""}},{key:"getCachedItem",value:function(e){var t;return null===(t=this.getDefaultItemStore())||void 0===t?void 0:t.getLinkedItem(e)}},{key:"setCachedItem",value:function(e,t){var n;null===(n=this.getDefaultItemStore())||void 0===n||n.setLinkedItem(e,t)}}]),n}(vn),P()(Yn.prototype,"_purgeOldData",[S.ZP],Object.getOwnPropertyDescriptor(Yn.prototype,"_purgeOldData"),Yn.prototype),P()(Yn.prototype,"createEventForItem",[S.ZP],Object.getOwnPropertyDescriptor(Yn.prototype,"createEventForItem"),Yn.prototype),P()(Yn.prototype,"compareCachedData",[S.ZP],Object.getOwnPropertyDescriptor(Yn.prototype,"compareCachedData"),Yn.prototype),P()(Yn.prototype,"runCalendarListSync",[S.ZP],Object.getOwnPropertyDescriptor(Yn.prototype,"runCalendarListSync"),Yn.prototype),P()(Yn.prototype,"runCalendarSync",[S.ZP],Object.getOwnPropertyDescriptor(Yn.prototype,"runCalendarSync"),Yn.prototype),P()(Yn.prototype,"_flushEventUpdateQueue",[S.ZP],Object.getOwnPropertyDescriptor(Yn.prototype,"_flushEventUpdateQueue"),Yn.prototype),P()(Yn.prototype,"parsePriority",[S.ZP],Object.getOwnPropertyDescriptor(Yn.prototype,"parsePriority"),Yn.prototype),P()(Yn.prototype,"fixMissingCalendars",[S.ZP],Object.getOwnPropertyDescriptor(Yn.prototype,"fixMissingCalendars"),Yn.prototype),Yn);var br=n(1506),Pr=n.n(br),Sr=n(3926);const Dr=function(){function e(t,n,r){s()(this,e);try{_.Z.PAssert(1176,_.Z.isFunction(t),"Must provide a valid entry callback")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(1177,_.Z.isFunction(n),"Must provide a valid done callback")}catch(i){_.Z.reportError(i)}this._entryCB=t,this._doneCB=n,this._delay=r||5e3,this._flushTimeout=void 0,this._entries=[],ve.Z.binder(this,"_onEntry","_onDone","_flushEntries","_flushEntriesWatchdog")}return l()(e,[{key:"getEntryCB",value:function(){return this._onEntry}},{key:"getDoneCB",value:function(){return this._onDone}},{key:"_onEntry",value:function(e){e&&this._entries.push(e),this._flushTimeout||(this._flushTimeout=setTimeout(this._flushEntriesWatchdog,this._delay))}},{key:"_onDone",value:function(e,t){_o.PaneUpdateBatcher.beginUpdateItems(),this._flushEntries();try{0,this._doneCB(e,t)}catch(n){_.Z.reportError(n)}_o.PaneUpdateBatcher.commitUpdateItems()}},{key:"_flushEntriesWatchdog",value:function(){0}},{key:"_flushEntries",value:function(){var e=0;this._flushTimeout&&(clearTimeout(this._flushTimeout),this._flushTimeout=void 0),_o.PaneUpdateBatcher.beginUpdateItems(),be.Z.beginBatch();for(var t=0;t<this._entries.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;try{this._entryCB(this._entries[t])}catch(n){_.Z.reportError(n)}}this._entries=[],be.Z.commitBatch(),_o.PaneUpdateBatcher.commitUpdateItems()}}]),e}();function Ir(){this._favMap={}}Ir.prototype={_ensureGroup:function(e){var t=[];return this._favMap[e]||(this._favMap[e]=t),t},notifyAdd:function(e,t){var n=this._ensureGroup(t);try{_.Z.PAssert(1207,n.indexOf(e)<0,"Should not double add item to group")}catch(r){_.Z.reportError(r)}n.push(e)},notifyRemove:function(e,t){var n=this._ensureGroup(t);try{_.Z.PAssert(1208,n.indexOf(e)>=0,"Must have been added to group before removing")}catch(r){_.Z.reportError(r)}n.remove(e)},getItems:function(e){return this._favMap[e]},hasItems:function(e){var t=this.getItems(e);return t&&t.length>0}};const Er=new Ir;var xr="Moo.do",Cr={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},Ar={INBOX:100,UNREAD:99,STARRED:98,IMPORTANT:97,SENT:96,DRAFT:95,"==MOODO_ARCHIVED==":94,"==MOODO_ALLMAIL==":93,TRASH:92,CATEGORY_PERSONAL:80,CATEGORY_SOCIAL:79,CATEGORY_PROMOTIONS:78,CATEGORY_UPDATES:77,CATEGORY_FORUMS:76},Lr={"==MOODO_ARCHIVED==":"Archived","==MOODO_ALLMAIL==":"All Mail"},Mr={CATEGORY_PERSONAL:!0,CATEGORY_SOCIAL:!0,CATEGORY_PROMOTIONS:!0,CATEGORY_UPDATES:!0,CATEGORY_FORUMS:!0},Tr={DRAFT:!0,CHAT:!0,SENT:!0,SPAM:!0,"==MOODO_ALLMAIL==":!0};const Rr=function(){function e(t,n,r,i,a,o){s()(this,e);try{_.Z.PAssert(1178,t,"Must specify a valid account ID")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(1179,n,"Must specify a valid label ID")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(1181,!i||_.Z.isDateValid(i),"Must provide a valid oldestSync date")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(1182,o,"Must supply a valid label store this label belongs to")}catch(c){_.Z.reportError(c)}this._labelStore=o,this._accountID=t,this._labelID=n,this._fullName=r,this._minName=void 0,this._matchName=null===r||void 0===r?void 0:r.toUpperCase(),this._oldestSync=i,this._numUnread=0,this._ancestors=[],this._isDeleted=!(!a||!a.isDeleted),this._labelListVisibility=a&&a.labelListVisibility?a.labelListVisibility:w.Z.LabelListVisibility.Show,this._messageListVisibility=a&&a.messageListVisibility?a.messageListVisibility:w.Z.MessageListVisibility.Show,this._origLabelID=void 0}return l()(e,[{key:"_getDisplayPriority",value:function(){return Ar[this.getLabelID()]||-1}},{key:"displayCompare",value:function(e){var t=this.isSystemOrSpecialLabel(),n=e.isSystemOrSpecialLabel();return t&&n?this._getDisplayPriority()<e._getDisplayPriority()?1:-1:t?-1:n?1:this.getName().localeCompare(e.getName())}},{key:"isDropTarget",value:function(){return!Tr[this.getLabelID()]}},{key:"_getStoreLabel",value:function(e){var t,n=this,r=e.toUpperCase();return Object.keys(this._labelStore).some((function(e){var i=n._labelStore[e].getRawName();if(i&&i.toUpperCase()===r)return t=n._labelStore[e],!0})),t}},{key:"_computeAncestors",value:function(){try{_.Z.PAssert(1183,this._fullName||this.isSystemLabel()||this.isSpecialLabel(),"Must specify a valid fullName to run _computeAncestors")}catch(a){_.Z.reportError(a)}if(this._ancestors=[],!this.isSystemLabel()&&!this.isSpecialLabel()&&this._fullName&&this._fullName.indexOf("/")>0){for(var e=0,t=this._fullName.split("/"),n="",r=0;r<t.length-1;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n+=t[r];var i=this._getStoreLabel(n);i&&i!==this&&this._ancestors.push(i),n+="/"}this._computeMinName()}try{_.Z.PAssert(1184,this._ancestors.indexOf(this)<0,"Self should never be in the ancestors list")}catch(a){_.Z.reportError(a)}}},{key:"_computeMinName",value:function(){for(var e=0,t=this.getRawName(),n=0;n<this._ancestors.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this._ancestors[n].getMinName()+"/",i=t.indexOf(r);t=t.substr(i+r.length)}this._minName=t}},{key:"getAccountID",value:function(){return this._accountID}},{key:"getLabelID",value:function(){return this._labelID}},{key:"getRawName",value:function(){return this._fullName}},{key:"getMinName",value:function(){var e;return null!==(e=this._minName)&&void 0!==e?e:this._fullName}},{key:"getMatchName",value:function(){return this._matchName}},{key:"isMatched",value:function(e){try{_.Z.PAssert(1185,_.Z.isString(e),"Must pass in a valid string for label name")}catch(r){_.Z.reportError(r)}var t=!1,n=this.getMatchName();return e&&n&&n.indexOf(e.toUpperCase())>=0&&(t=!0),t}},{key:"isNamed",value:function(e){try{_.Z.PAssert(1186,_.Z.isString(e),"Must pass in a valid string for label name")}catch(r){_.Z.reportError(r)}var t=!1,n=this.getMatchName();return e&&n&&n===e.toUpperCase()&&(t=!0),t}},{key:"getName",value:function(e){var t;if(Cr[this.getLabelID()])t=Cr[this.getLabelID()];else if(Lr[this.getLabelID()])t=Lr[this.getLabelID()];else if(e&&this._minName)t=this.getMinName();else if(this._fullName)t=this._fullName;else{try{_.Z.PAssert(1187,!this.isLocalOnly(),"Should not have a local-only label without a name")}catch(n){_.Z.reportError(n)}t=this.getLabelID()}return t||""}},{key:"hasName",value:function(){return Cr[this.getLabelID()]||Lr[this.getLabelID()]||!!this._fullName}},{key:"clearOldestSync",value:function(){this._oldestSync=void 0}},{key:"getOldestSync",value:function(){return this._oldestSync}},{key:"setOldestSync",value:function(e){try{_.Z.PAssert(1188,_.Z.isDateValid(e),"Must provide a valid oldestSync date")}catch(t){_.Z.reportError(t)}this._oldestSync=e}},{key:"getMessageListVisibility",value:function(){return this._messageListVisibility}},{key:"getLabelListVisibility",value:function(){return this._labelListVisibility}},{key:"isLocalOnly",value:function(){return _.Z.isTempId(this.getLabelID())}},{key:"updateLabelID",value:function(e){try{_.Z.PAssert(1190,this.isLocalOnly(),"Should only ever modify local labels")}catch(t){_.Z.reportError(t)}this._origLabelID=this.getLabelID(),this._labelID=e}},{key:"updateLabelName",value:function(e){this._fullName=e,this._matchName=e.toUpperCase(),this._computeAncestors()}},{key:"getSaveData",value:function(){var e={id:this.getLabelID(),name:this._fullName,messageListvisibility:this.getMessageListVisibility(),labelListVisibility:this.getLabelListVisibility(),isDeleted:this._isDeleted};return this.getOldestSync()&&(e.oldestSync=this.getOldestSync()),e}},{key:"getDisplayText",value:function(e){var t;return this.getName()&&(t=this.getName().startsWith("Moo.do/")?this.getName().substr(xr.length+1):this.getName(e)),t}},{key:"getOutlineText",value:function(){var e=this.getDisplayText();return null===e||void 0===e?void 0:e.replace(/ /g,"_")}},{key:"matchesText",value:function(e){return this.getDisplayText().toLowerCase().indexOf(e)>=0}},{key:"hasAncestors",value:function(){return!!this._fullName&&this.getAncestors().length>0}},{key:"getAncestors",value:function(){return this._computeAncestors(),this._ancestors}},{key:"getParent",value:function(){var e=this.getAncestors();return e[e.length-1]}},{key:"isSystemLabel",value:function(){return!!Cr[this.getLabelID()]}},{key:"isSpecialLabel",value:function(){return!!Lr[this.getLabelID()]}},{key:"isSystemOrSpecialLabel",value:function(){return this.isSystemLabel()||this.isSpecialLabel()}},{key:"isCategoryLabel",value:function(){return!!Mr[this.getLabelID()]}},{key:"isArchived",value:function(){return"Archived"===this.getName()}},{key:"isStarred",value:function(){return"Starred"===this.getName()}},{key:"isInbox",value:function(){return"Inbox"===this.getName()}},{key:"isDraft",value:function(){return"Draft"===this.getName()}},{key:"isTrash",value:function(){return"Trash"===this.getName()}},{key:"isCustom",value:function(){return!this.isSystemLabel()&&!this.isSpecialLabel()}},{key:"getUnreadCount",value:function(){return this._numUnread}},{key:"shouldDisplayInLabelList",value:function(){var e=!1;return this._isDeleted||(this.getLabelListVisibility()===w.Z.LabelListVisibility.Show||this.getLabelListVisibility()===w.Z.LabelListVisibility.ShowIfUnread&&this.getUnreadCount()>0)&&(e=!0),e}},{key:"shouldDisplayInMessageList",value:function(){return this._messageListVisibility===w.Z.MessageListVisibility.Show}},{key:"delete",value:function(){try{_.Z.PAssert(1191,!this.isSystemOrSpecialLabel(),"Should never delete a special or system label")}catch(e){_.Z.reportError(e)}this._isDeleted=!0}}]),e}();var Or,Fr=n(9607),Nr=n(8778),Br=n(8001);function Ur(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}const jr=(Or=function(e){p()(n,e);var t=Ur(n);function n(e){var r;s()(this,n);var i={title:"Legacy Email",contextMenuMode:"Gmail",paneEmptyMessage:"No emails here",paneEmptySearchMessageDefault:"Press enter to search",paneEmptySearchMessage:"Press enter to search",titleContextMenuHeader:"Open label",dropEffect:function(){return w.Z.DropEffect.Copy},isWriteable:!1,overrideCopyBehavior:!1,canAddItem:!1,supportCollapsing:!1,supportCompleting:!0,supportCheckbox:!0,supportOffline:!1,supportPerformArchive:!1,supportDataRefresh:"Emails",supportReportError:!0,supportCompose:!0,supportPagination:!0,supportVertLines:!1,supportSearchItemAutocomplete:!1,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportLocalSearch:!1,supportClone:!1,supportDeferredItemLoad:!0,supportCellTransition:!1,shouldSearchMatchParents:!1,noOverviewStyle:!0,supportStarClick:!0,supportClickOverviewScroll:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,overviewHasPaneItems:!1,overviewPadLevels:-1,maxWidthFlex:w.Z.ExpandedPaneWidth,maxWidth:w.Z.ExpandedPaneWidth+200,maxWidthSingle:w.Z.ExpandedPaneWidth,widthBiggerInSingle:!1,supportsDocuments:!1,_topBoxHeight:0,searchFilters:[{name:"unread",initialValue:1,icon:"icon-drafts",tooltip:"unread emails",remoteStringFn:function(e){var t;switch(e){case-1:t="-in:trash -is:unread";break;case 1:t="-in:trash is:unread";break;default:t=""}return t},matchFn:function(e,t){var n=r.plugin.isItemUnread(t);if(e)return n&&e>0||!n&&e<0?w.Z.MatchState.Yes:w.Z.MatchState.No}},{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred emails",remoteStringFn:function(e){var t;switch(e){case-1:t="-is:starred";break;case 1:t="is:starred";break;default:t=""}return t},matchFn:function(e,t){var n=r.plugin.isItemStarred(t);if(e)return n&&e>0||!n&&e<0?w.Z.MatchState.Yes:w.Z.MatchState.No}},{name:"priority",remoteStringFn:function(e){var t;switch(e){case w.Z.VMLIFlag.P1:t="label:Moo.do/Priority High";break;case w.Z.VMLIFlag.P2:t="label:Moo.do/Priority Medium";break;case w.Z.VMLIFlag.P3:t="label:Moo.do/Priority Low";break;default:t=""}return t},matchFn:function(e,t){return r.plugin.getItemPriority(t)>=e?w.Z.MatchState.Yes:w.Z.MatchState.No}},{name:"category",remoteStringFn:function(e){return e?"category:"+e:""},matchFn:function(e,t){return e?r.plugin.itemHasLabel(t,e)?w.Z.MatchState.Yes:w.Z.MatchState.No:w.Z.MatchState.Yes}}]};return e.plugin=_o.pluginManager.getPlugin(n.getPluginID()),(r=t.call(this,e,i)).type=r.plugin._paneType,r.paneClass="panePlugin paneGmail",r.isInitializing=!0,r._lines=[{text:"\u2000",start:0,length:1,width:0}],r.dragMarginTop=25,r.blocks=[],r.blocksByKey={},r._focusedTrash=!1,r.shouldCheckHeight=!0,r.maxScrollOffset=0,r.selectedIndex=new x.Z(-1,r.onSelectedIndexChanged.bind(Pr()(r))),r._isSearchingRemote=new x.Z(!1),r._overviewAccount=new x.Z,r._currentSearch=void 0,r._ignoreRestoreScroll=!0,r._failedPageRequest=new x.Z(!1),r.viewState=new ke.Z(e.viewState&&e.viewState.viewMode?e.viewState:{viewMode:w.Z.GmailViewMode.Date}),r.item.get()||r.item.set(r.plugin.tempRootVMLI),r.item.listen((function(e){return r._onItemChange(e,!1)})),r.viewState.listen(r._onViewStateChange.bind(Pr()(r))),ve.Z.binder(Pr()(r),"_runRemoteSearch","searchCompare","onTopTextChanged","headerSearchCompare","onMultiselectReset","changeView","onEmailComposeClosed","onEmailPreviewClosed"),r.initGmail(),r._firstSelectedItemID=void 0,e.isExpanded&&(_o.EmailPreview.startOpenOnLoad(Pr()(r)),r._firstSelectedItemID=e.selectedItem),r.isInitializing=void 0,r}return l()(n,[{key:"initGmail",value:function(){Fr.Z.listen("reset",this.onMultiselectReset),this.search.isSearched()&&this.onSearchChanged(!0),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0,this.paneTopText.listen(this.onTopTextChanged),ue.Z.listen("EmailCompose","onClosed",this.onEmailComposeClosed),ue.Z.listen("EmailPreview","onClosed",this.onEmailPreviewClosed)}},{key:"destroy",value:function(){clearTimeout(this._searchTimeout),this._searchTimeout=void 0,this.paneTopText.unlisten(this.onTopTextChanged),ue.Z.unlisten("EmailCompose","onClosed",this.onEmailComposeClosed),ue.Z.unlisten("EmailPreview","onClosed",this.onEmailPreviewClosed),Fr.Z.unlisten("reset",this.onMultiselectReset),d()(v()(n.prototype),"destroy",this).call(this)}},{key:"onLoad",value:function(){d()(v()(n.prototype),"onLoad",this).call(this),this._onItemChange(this.getItem(),!0)}},{key:"notifyPluginLoaded",value:function(){var e=this.deferredItemState;if(e){var t=this.getItemStore().getItem(e.itemID);t&&(this.setItem(t,!0),this.updateHeaders(!0))}}},{key:"getItemStore",value:function(){return this.plugin.getActiveItemStore(this.id)}},{key:"getRootItem",value:function(){var e=this.getItemStore();return e?e.getRoot():void 0}},{key:"getDefaultDisplayItem",value:function(e){return this.plugin.getDefaultDisplayItem(e)}},{key:"searchCompare",value:function(e){var t=!1,n=e.getAttachmentByPlugin(this.plugin.id);if(n){var r=n.getField("accountID");this.plugin.hasSyncAccount(r)&&(this.plugin.isOnline()?(!this.isSearched()||!this.isLoading.get()&&this.paneTopText.get()||this.isRemoteSearchActive())&&this.plugin.isDisplayItem(e,this._focusedTrash)&&(t=!0):this.search.isMatched(e)&&this.plugin.isDisplayItem(e,this._focusedTrash)&&(t=!0))}return t}},{key:"runItemSearch",value:function(e){try{_.Z.PAssert(1242,e,"Must supply a valid param set for local item search")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(1243,e.item,"Gmail pane always expects a valid item when running local item search")}catch(t){_.Z.reportError(t)}return e.item.belongsToItemStore(this.plugin.getDefaultItemStore())?this.plugin.runLocalItemSearch(e):d()(v()(n.prototype),"runItemSearch",this).call(this,e)}},{key:"getItemSearchParams",value:function(){var e=this.plugin.getLabelForVMLI(this.getItem());return this._focusedTrash=e&&e.isTrash(),{item:this.getItem(),comparator:this.searchCompare,pane:this}}},{key:"setOverviewAccount",value:function(e){this._overviewAccount.set(e),this.updateHeaders(!0)}},{key:"headerSearchCompare",value:function(e){if(this.plugin.isLabelItem(e)){var t=this.plugin.getLabelForVMLI(e);return!t||t.shouldDisplayInLabelList()}return!!this.plugin.isAccountItem(e)}},{key:"getHeaderSearchParams",value:function(){return{item:this.plugin.getDefaultItemStore().getRoot(),comparator:this.headerSearchCompare,noCollapsed:!0,collapseAfterDepth:this.plugin.numSyncAccounts()>1?1:NaN,overview:!0,pane:this}}},{key:"saveSelection",value:function(){return Fr.Z.getSelectedItems(this)}},{key:"restoreSelection",value:function(e){if(e.length>0){for(var t=0,n=[],r=0;r<e.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.indexOfItem(e[r]);i>=0&&n.push(i)}if(n.length>1)this.selectedIndex.set(n[0],!1),Fr.Z.setSelected(n,this);else if(1===n.length)this.selectIndex(n[0]);else{var a=this.selectedIndex.get();a>=this.numItems()&&(a=this.numItems()-1),this.selectIndex(a,!0)}}}},{key:"_setItems",value:function(e,t){for(var n,r=0,i=this.saveSelection(),a=[],o={},s=this.getViewMode()===w.Z.GmailViewMode.Date?this.plugin.threadSortFn:this.plugin.threadSortPriorityFn,c=0;c<e.length;++c){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=e[c],u=this.plugin._getThreadIDFromItem(l);u&&!o[u]&&(a.insertSorted(l,s),this._firstSelectedItemID&&l.id===this._firstSelectedItemID&&(n=l),o[u]=!0)}if(this.updateOutline(a),this.restoreSelection(i),n&&e.length>0){var d=this.indexOfItem(n);d>=0&&(this.selectIndex(d),this.scrollToIndex(d,"start")),this._firstSelectedItemID=void 0}}},{key:"setHeaders",value:function(e,t){var n=0,r=this;if(!this._overviewAccount.get()||"me"===this._overviewAccount.get()){var i=this.plugin.getDescriptorForItem(this.getItem());this._overviewAccount.set(i.accountID)}this._allHeaders=e;for(var a=[],o={},s={},c=0;c<this._allHeaders.length;++c){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=this._allHeaders[c],u=this.plugin.getAccountIDFromItem(l);if(o[u]||(o[u]=[]),this.plugin.isAccountItem(l))s[u]=l;else{var d=o[u];this.plugin.isDisplayHeader(l)&&d.insertSorted(l,this.plugin.labelVMLISortFn)}}var h=this._overviewAccount.get(),p=o[this._overviewAccount.get()];if(p){var f=s[h];try{_.Z.PAssert(1244,f,"Must have valid account item")}catch(Z){_.Z.reportError(Z)}if(f)for(var g=0,m=0;m<p.length;++m){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;if(m>0){var v=this.plugin.getLabelForVMLI(p[m-1]),y=this.plugin.getLabelForVMLI(p[m]);(v.isSystemOrSpecialLabel()&&!y.isSystemOrSpecialLabel()||!v.isCategoryLabel()&&y.isCategoryLabel())&&a.push(new Br.Z({type:"hr",id:this.getPaneObjectIDNonItem("hr"+h+m),pane:this,index:m,overview:!0}))}a.push(p[m])}}this.headersArr=a;var k=a.map((function(e,t){return _.Z.isVMLI(e)?new Br.Z({type:"blockItem",item:e,id:r.getPaneObjectID(e),pane:r,index:t,overview:!0}):new Br.Z(Object.assign({pane:r,overview:!0},e))}));this.headerPaneObjects.set(k)}},{key:"heightOverviewHR",value:function(){return 4}},{key:"getTitleList",value:function(){var e=this.getItem();if(e===this.plugin.tempRootVMLI)return[e];var t=this.plugin.getDescriptorForItem(e),n=this.plugin.getVMLIForAccount(t.accountID);return n===e?[e]:[n,e]}},{key:"onClickTitle",value:function(e){return this.plugin.isAccountItem(e)?e=this.plugin.getDefaultDisplayItem(this.plugin.getAccountIDFromItem(e)):e===this.getRootItem()?e=this.plugin.getDefaultDisplayItem(this.plugin.getAccountIDFromItem(this.getItem())):this.plugin.isLabelItem(e)||(e=this.plugin.getDefaultDisplayItem(this.plugin.getDefaultAccount())),d()(v()(n.prototype),"onClickTitle",this).call(this,e)}},{key:"onTopTextChanged",value:function(){this.topBoxHeight.set(this.paneTopText.get()?36:0)}},{key:"searchACName",value:function(){}},{key:"getPaneIcon",value:function(){return this.plugin.getPaneIcon()}},{key:"requestDataPage",value:function(e){this.isLoadingNewPage.set(!0),this.plugin.requestDataPage(e,this.onDataPagedIn.bind(this))}},{key:"dropEffectCopyBehavior",value:function(e,t){if(!this.plugin.isLabelItem(t)||!e.belongsToItemStore(this.getItemStore())){try{_.Z.PAssert(1245,!e.belongsToSameItemStore(t),"Dropping onto a Gmail pane is not supported")}catch(i){_.Z.reportError(i)}return this.plugin.createOutlinePaneItem(e,t)}var n=this.plugin.getLabelForVMLI(t),r=e.getAttachmentByPlugin(this.plugin.id);r&&null!==n&&void 0!==n&&n.isDropTarget()&&this.plugin.addLabelToAttachment(r,n.getName())}},{key:"_refreshPaneData",value:function(){this.plugin.refreshCurrentView()}},{key:"reportPaneError",value:function(){_o.menus.openModal(w.Z.Modals.ReportBug)}},{key:"_onItemChange",value:function(e,t){var n=this;Fr.Z.reset(this);var r=this.plugin.getAccountIDFromItem(this.getRootItem());this.setOverviewAccount(r),this._clearCurrentSearch();var i=this.plugin.getLabelForVMLI(e);this._focusedTrash=i&&i.isTrash(),e.hasPaginationToken()||this.plugin.handleItemChange(e,(function(){n.isLoading.set(!1)})),this.numItems()>0&&this.selectIndex(0)}},{key:"_onViewStateChange",value:function(){Fr.Z.reset(this),this.plugin.handleViewModeChange(this.getItem(),this.getViewMode()),this.updateItemsImmediate(!0,void 0,void 0,!0),_o.PaneManager.updatePaneStateForPane(this),this.scrollToIndex(0,"start")}},{key:"getItemLabel",value:function(e){var t=e?this.getActualPaneItem():this.getItem();return this.plugin.getLabelForVMLI(t)}},{key:"onDataPagedIn",value:function(e){e?this._failedPageRequest.set(!1):this._failedPageRequest.set(!0),this.isLoadingNewPage.set(!1)}},{key:"onScrollEnd",value:function(){this.isLoadingNewPage.get()||this.isSearched()||this.requestDataPage(this.getItem())}},{key:"handleStatusClick",value:function(){}},{key:"_getLoadingMessage",value:function(){var e=this.plugin.getAccountIDFromItem(this.getItem());return ie.Z.isAuthorizedForScopes(e,[w.Z.GScope.GmailModify])?"Loading...":"Authorizing..."}},{key:"bottomListMessage",value:function(){var e;return this.getItem().hasPaginationToken()&&(e=this._failedPageRequest.get()?"RETRY LOAD":this.isLoadingNewPage.get()||this.getItem().paginationTokenInUse()?"Loading...":"Click to load more emails"),{text:e,clickable:!0}}},{key:"_onRemoteDataLoaded",value:function(){}},{key:"onClickItem",value:function(e,t,n,r){if(r.shiftKey){var i=Fr.Z.getFirstSelectedIndex(this),a=Fr.Z.getLastSelectedIndex(this);e<i?i=e:e>a&&(a=e),Fr.Z.selectInOrder(i,a,this),!1}else if(_.Z.hasClass(r.target,"emailLabel")){var o=r.target.textContent,s=t.getAttachmentByPlugin(this.plugin.id).getField("accountID"),c=this.plugin._getLabelByName(s,o);try{_.Z.PAssert(1246,c,"Must be able to get a valid label if clicking a valid label: ",o)}catch(u){_.Z.reportError(u)}if(c){var l=this.plugin.getVMLIForLabel(s,c);this.zoomIn(l),!1}}else _.Z.hasClass(r.target,"itemCheckbox")||this.selectIndex(e)}},{key:"handleRightSideTap",value:function(e){if(e&&e.hasPluginAttachment(this.plugin.id)){this.archiveEmailFromCurrentLabel(e);var t=this.selectedIndex.get();t>=this.numItems()&&(t=this.numItems()-1),this.selectIndex(t,!0),_.Z.vmMain.redoLastMouseMove()}}},{key:"onMultiselectReset",value:function(e){this===e&&this.selectedIndex.set(-1)}},{key:"selectIndex",value:function(e,t,n){var r=this.selectedIndex.get();this.selectedIndex.set(e,t),e>=0?Fr.Z.setSelected([e],this):Fr.Z.reset(this),(t||r!==e)&&this.selectedIndex.notify(),n||_o.PaneManager.updatePaneStateForPane(this)}},{key:"selectItem",value:function(e,t){if(e){var n=this.indexOfItem(e);n>=0&&this.selectIndex(n,t)}else this.selectIndex(-1,t)}},{key:"onSelectedIndexChanged",value:function(e){if(_o.EmailPreview.isOpenOnPane(this))if(e>=0){var t=this.itemAtIndex(e);this.openEmailByItem(t)}else e<0&&_o.EmailPreview.reset()}},{key:"_runRemoteSearch",value:function(){var e=this;if(_o.PaneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var t=this.search.getRemoteValue(),n=this.plugin.getDescriptorForItem(this.item.get());if(n.labelID){var r=this.plugin._getLabelByID(n.accountID,n.labelID);r.isSpecialLabel()||r.isInbox()||!r.hasName()||(t+=" label:"+r.getName())}this._lastSearchValue=t,this._lastSearchTime=Date.now(),this.paneEmptySearchMessage="",this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._clearCurrentSearch();var i="R~"+this.getActualPaneItem().id+"~"+_.Z.generateTempId();_.Z.log("Gmail Remote Search ItemID: ",i),this._currentSearch=this.plugin.runSearch(t,this.id,i,!0,(function(t){if(!e._destroyed&&e._isSearchingRemote.get())switch(e.paneEmptySearchMessage=t===w.Z.SearchResultStatus.Done?e.paneEmptySearchMessageDefault:"",e.isLoading.set(!1),t){case w.Z.SearchResultStatus.Done:e.paneTopText.set(""),e.scrollToIndex(0,"start");break;case w.Z.SearchResultStatus.TooMany:e.paneTopText.set("Too many search results! Be more specific.");break;case w.Z.SearchResultStatus.None:e.paneTopText.set("There were no search results");break;case w.Z.SearchResultStatus.Error:e.paneTopText.set("There was an error running your search, try again.");break;default:try{_.Z.PAssert(1247,!1,"Invalid search state: ",t)}catch(n){_.Z.reportError(n)}}}))}}},{key:"_clearCurrentSearch",value:function(){this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0)}},{key:"onSearchChanged",value:function(e){var t=this.search.getRemoteValue();if(t!==this._lastSearchValue||Date.now()-this._lastSearchTime>5e3)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,t){var n=e?0:2500;this._searchTimeout=setTimeout(this._runRemoteSearch,n)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this._clearCurrentSearch(),this.isLoading.set(!1),this.paneTopText.set("")}},{key:"isSearchingRemote",value:function(){return this._isSearchingRemote.get()}},{key:"isRemoteSearchActive",value:function(){return this.plugin.isRemoteSearchBucketActive(this.id)}},{key:"onEmailComposeClosed",value:function(){var e=this.plugin,t=e.getDefaultAccount(),n=e._getLabelByID(t,Yr.DRAFT),r=e.getVMLIForLabel(t,n);this.item.get()===r&&this.selectIndex(-1)}},{key:"onEmailPreviewClosed",value:function(){0}},{key:"applyToSelection",value:function(e){var t=this.saveSelection();Fr.Z.forEach(this,e),this.restoreSelection(t)}},{key:"_autocompletePopup",value:function(e,t,n){var r=this;if(!e.elementDisplay){var i=Fr.Z.getFirstSelectedIndex(this),a=this.elementAtIndex(i);e.elementDisplay=a}var o=[];Fr.Z.forEach(this,(function(e){o.push(e)})),e.items=o,e.onSelected=function(i){r.plugin.beginAction(),e.item?t(e.item,i):Fr.Z.forEach(r,(function(e){t(e,i)})),n&&n(),r.plugin.endAction()},Nr.Z.showPopup(e)}},{key:"getPaddingForPaneObject",value:function(e){return e.overview?d()(v()(n.prototype),"getPaddingForPaneObject",this).call(this,e)-20:0}},{key:"getWidth",value:function(){return this.rect.get().width}},{key:"getFirstSelectedItem",value:function(){return Fr.Z.getFirstSelectedItem(this)}},{key:"getFirstSelectedIndex",value:function(){return Fr.Z.getFirstSelectedIndex(this)}},{key:"autocompleteSchedule",value:function(e){var t=this,r=e.onClose,i=this.selectedIndex.get();e.element=e.element||this.elementAtIndex(i),e.onClose=function(){i>=t.numItems()&&(i=t.numItems()-1),t.selectIndex(i,!0),r&&r()},d()(v()(n.prototype),"autocompleteSchedule",this).call(this,e)}},{key:"autocompleteMove",value:function(e,t){var r=this;e=e||{};var i=this.selectedIndex.get();e.positionOffset={left:40},d()(v()(n.prototype),"autocompleteMove",this).call(this,e,(function(){i>=r.numItems()&&(i=r.numItems()-1),r.selectIndex(i,!0),t&&t()}))}},{key:"autocompleteCreateTask",value:function(){var e=this,t=this.selectedIndex.get();if(!isNaN(t)){var n=this.elementAtIndex(t),r=Fr.Z.getSelectedItems(this);_o.menus.openItemEditor({element:n,pane:this,selectIndex:0,addOnSave:!0,selectDocument:!0,side:"bottom",children:r,positionOffset:{left:10},options:[{text:"Archive email",value:_o.pluginManager.getSetting(w.Z.PluginID.Gmail,w.Z.PluginSettingsID.Gmail.ArchiveOnOrganize)||!1,cb:function(){for(var t=0,n=0;n<r.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=r[n].getAttachmentByPlugin(e.plugin.id);e.plugin.performAction(w.Z.PluginAction.Gmail.Archive,!1,i)}}}],beginSave:function(){var t=0;_o.PaneUpdateBatcher.beginUpdateItems(),e.plugin.beginAction();for(var n=0;n<r.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=r[n].getAttachmentByPlugin(e.plugin.id);e.plugin.attachmentHasLabel(i,"Moo.do/Handled")||e.plugin.performAction(w.Z.PluginAction.Gmail.AddLabel,!1,i,"Moo.do/Handled")}},endSave:function(){e.plugin.endAction(),_o.PaneUpdateBatcher.commitUpdateItems()}})}}},{key:"toggleStarSelected",value:function(){d()(v()(n.prototype),"toggleStarSelected",this).call(this),this.updateItems()}},{key:"toggleStar",value:function(e){var t=e.getAttachmentByPlugin(this.plugin.id);try{_.Z.PAssert(1249,t,"Must be able to get a valid attachment")}catch(r){_.Z.reportError(r)}var n=t.getPlugin();n.isItemStarred(e)?n.performAction(w.Z.PluginAction.Gmail.Unstar,!1,t):n.performAction(w.Z.PluginAction.Gmail.Star,!1,t),this.updateItems()}},{key:"_openSelectedInMode",value:function(e){var t=Fr.Z.getFirstSelectedIndex(this);this.selectIndex(t);var n=this.itemAtIndex(t);this.openEmailByItem(n,e)}},{key:"replySelected",value:function(){this._openSelectedInMode(w.Z.EmailResponseMode.Reply)}},{key:"replyAllSelected",value:function(){this._openSelectedInMode(w.Z.EmailResponseMode.ReplyAll)}},{key:"forwardSelected",value:function(){this._openSelectedInMode(w.Z.EmailResponseMode.Forward)}},{key:"archiveSelected",value:function(e){this.plugin.beginAction(),this.applyToSelection(this.archiveEmailFromCurrentLabel),this.plugin.endAction()}},{key:"archiveItem",value:function(e,t){var n=t.getAttachmentByPlugin(this.plugin.id);try{_.Z.PAssert(1250,n,"Must be able to get a valid attachment")}catch(r){_.Z.reportError(r)}!e&&this.plugin.isItemArchived(t)?this.plugin.performAction(w.Z.PluginAction.Gmail.Unarchive,!1,n):e&&!this.plugin.isItemArchived(t)&&this.plugin.performAction(w.Z.PluginAction.Gmail.Archive,!1,n)}},{key:"deleteSelected",value:function(){this.plugin.beginAction(),this.applyToSelection(this.deleteEmailFromCurrentLabel),this.plugin.endAction()}},{key:"applyPriorityToSelection",value:function(e,t){var n=this,r=e,i=!0;this.plugin.beginAction(),this.applyToSelection((function(a){var o=a.getAttachmentByPlugin(n.plugin.id);try{_.Z.PAssert(1251,o,"Must be able to get a valid attachment")}catch(s){_.Z.reportError(s)}t&&i&&(n.plugin.getAttachmentPriority(o)===e&&(r=w.Z.VMLIFlag.None),i=!1),n.plugin.performAction(w.Z.PluginAction.Gmail.SetPriority,!1,o,r),n.updateItems()})),this.plugin.endAction()}},{key:"handleUndo",value:function(){this.plugin.handleUndo()}},{key:"handleRedo",value:function(){this.plugin.handleRedo()}},{key:"keyMoveDown",value:function(e){var t;-1===this.selectedIndex.get()?this.selectIndex(0):e&&e.shiftKey?(Fr.Z.isInverted(this)&&1===Fr.Z.numSelectedInPane(this)&&Fr.Z.setInverted(!1,this),Fr.Z.isInverted(this)?(t=Fr.Z.getFirstSelectedIndex(this),Fr.Z.removeSelected(t,this)):(t=this.indexOfNextVMLI(Fr.Z.getLastSelectedIndex(this)))>=0&&t<this.numItems()&&(Fr.Z.addSelected(t,this),this.scrollIndexIntoView(t))):(t=this.indexOfNextVMLI(Fr.Z.getLastSelectedIndex(this)))>=0&&t<this.numItems()&&(this.selectIndex(t),this.scrollIndexIntoView(t))}},{key:"keyMoveUp",value:function(e){var t;-1===this.selectedIndex.get()?this.selectIndex(0):e&&e.shiftKey?(Fr.Z.isInverted(this)||1!==Fr.Z.numSelectedInPane(this)||Fr.Z.setInverted(!0,this),Fr.Z.isInverted(this)?(t=this.indexOfPrevVMLI(Fr.Z.getFirstSelectedIndex(this)))>=0&&(Fr.Z.addSelected(t,this),this.scrollIndexIntoView(t,"smooth")):(t=Fr.Z.getLastSelectedIndex(this),Fr.Z.removeSelected(t,this))):(t=this.indexOfPrevVMLI(Fr.Z.getFirstSelectedIndex(this)))>=0&&(this.selectIndex(t),this.scrollIndexIntoView(t,"smooth"))}},{key:"onHotkey",value:function(e,t){if(this.selectedIndex.get()>=0&&!_o.menus.isContextMenuOpen()){var n=this.objectAtIndex(this.selectedIndex.get()),r=n.item,i=!0;if(r){if("Up"===e)this.keyMoveUp(t);else if("Down"===e)this.keyMoveDown(t);else if("Open"===e)_o.EmailPreview.isOpenOnPane(this)||this.openEmailByItem(r);else if("Archive"===e){t.shiftKey&&_o.EmailPreview.isOpenOnPane(this)&&_o.EmailPreview.close();var a=!this.getItemLabel(!0).isArchived();this.archiveSelected(a)}else if("Delete"===e)this.deleteSelected();else if("Schedule"===e)this.autocompleteSchedule({item:r});else if("Move"===e)this.autocompleteMove();else if("Task"===e)this.autocompleteCreateTask();else if("Label"===e)this.autocompleteLabel({item:r});else if("MarkRead"===e)this.markReadSelected(!0);else if("MarkUnread"===e)this.markReadSelected(!1);else if("Star"===e)this.toggleStarSelected();else if("Reply"===e)this.replySelected();else if("ReplyAll"===e)this.replyAllSelected();else if("Forward"===e)this.forwardSelected();else if("Priority1"===e)this.applyPriorityToSelection(w.Z.VMLIFlag.P1,!0);else if("Priority2"===e)this.applyPriorityToSelection(w.Z.VMLIFlag.P2,!0);else if("Priority3"===e)this.applyPriorityToSelection(w.Z.VMLIFlag.P3,!0);else if("RemoveFromLabel"===e)this.search.isSearched()||(this.plugin.beginAction(),this.applyToSelection(this.removeItemFromCurrentLabel),this.plugin.endAction());else if("Undo"===e)this.handleUndo();else if("Print"===e){if(1===Fr.Z.numSelectedInPane(this)){var o=Fr.Z.getFirstSelectedItem(this),s=this.plugin.createPrintURLForThread(o.getAttachmentByPlugin(this.plugin.id));_.Z.printPage(s)}}else if("OpenInGmail"===e){if(1===Fr.Z.numSelectedInPane(this)){var c=Fr.Z.getFirstSelectedItem(this),l=this.plugin.getURLForAttachment(c.getAttachmentByPlugin(this.plugin.id));_o.openUrl(l)}}else"Menu"===e?_o.menus.openItemContextMenu(n):i=!1;i&&_.Z.preventDefault(t)}}}},{key:"archiveEmailFromCurrentLabel",value:function(e){var t=this.getItemLabel(!0),n=!t.isArchived();this.archiveItem(n,e),t.isInbox()||t.isArchived()||this.plugin.removeItemFromLabel(t,e)}},{key:"deleteEmailFromCurrentLabel",value:function(e){var t=this.getItemLabel(!0);this.plugin.deleteItem(e,t)}},{key:"removeItemFromCurrentLabel",value:function(e){var t=this.getItemLabel(!0);this.plugin.removeItemFromLabel(t,e)}},{key:"canAcceptDragOver",value:function(e,t,n,r){if(this.type===(null===e||void 0===e?void 0:e.type)&&r&&(n||e&&this!==e)){var i,a=e.getItemLabel();if(n){var o=_.Z.getElementParent(t);i=o&&_.Z.getItemForElement(o)}else i=this.getItem();if(i&&this.plugin.isLabelItem(i)&&this.plugin.areItemsFromSameAccount(r,i)){var s=this.plugin.getLabelForVMLI(i);if(s!==a&&s.isDropTarget())return!0}}else if(this.type!==e.type){if(r.getAttachmentByPlugin(this.plugin.id))return!0}return!1}},{key:"_handleDragOverPane",value:function(e,t,n,r,i,a,o){return{targetPane:this,targetElement:t,targetPaneObject:r,targetItem:this.getItem()}}},{key:"_handleDragDrop",value:function(e,t,n,r,i){var a=this,o=n.targetItem,s=n.overview,c=(r.ctrlKey,r.altKey,s?o:this.getActualPaneItem()),l=this.plugin.getLabelForVMLI(c);return e.forEach((function(e){var t=e.getAttachmentByPlugin(a.plugin.id);if(t&&(t.getField("accountID")===l.getAccountID()&&null!==l&&void 0!==l&&l.isDropTarget())){var n=l.getName();a.plugin.attachmentHasLabel(t,n)||a.plugin.addLabelToAttachment(t,n)}})),!0}},{key:"_handleDragDropItem",value:function(e,t,n,r,i){r.ctrlKey,r.altKey;var a=!1;if(n){var o=t.pane,s=o.getItemLabel(),c=n.targetItem,l=this.plugin.getLabelForVMLI(c);if(e.hasPluginAttachment(this.plugin.id)&&this.plugin.areItemsFromSameAccount(e,c)){var u=e.getAttachmentByPlugin(this.plugin.id);try{_.Z.PAssert(1252,u,"Must be able to get a valid attachment")}catch(d){_.Z.reportError(d)}this.plugin.beginAction(),this.plugin.performAction(w.Z.PluginAction.Gmail.RemoveLabel,!1,u,s.getName()),this.plugin.attachmentHasLabel(u,l.getName())||this.plugin.performAction(w.Z.PluginAction.Gmail.AddLabel,!1,u,l.getName()),o.notifyDropFrom(e,this),this.plugin.endAction(),a=!0}}return a}},{key:"notifyDropFrom",value:function(e,t){if(this.selectIndex(-1),t.type===w.Z.PaneMode.Task){var n=e.getAttachmentByPlugin(this.plugin.id);try{_.Z.PAssert(1253,n,"Must be able to get a valid attachment")}catch(i){_.Z.reportError(i)}this.plugin.attachmentHasLabel(n,"Moo.do/Handled")||(this.plugin.beginAction(),this.plugin.getSetting(this.plugin.Settings.ArchiveOnOrganize)&&this.plugin.performAction(w.Z.PluginAction.Gmail.RemoveLabel,!1,n,"Inbox"),this.plugin.performAction(w.Z.PluginAction.Gmail.AddLabel,!1,n,"Moo.do/Handled"),this.plugin.endAction());var r=this.plugin.getAttachmentPriority(n);r!==w.Z.VMLIFlag.None&&e.setPriority(r,w.Z.ChangeType.Local),this.plugin.attachmentHasLabelByID(n,"STARRED")&&e.setStarred(!0,w.Z.ChangeType.Local)}}},{key:"maxWidthOfPaneObject",value:function(){return this.getWidth()-56}},{key:"allowZoom",value:function(e){var t=!1;return this.plugin.isLabelItem(e)&&(t=!0),t}},{key:"performOverviewAction",value:function(e){if(this.plugin.isAccountItem(e)){e.setCollapsed(!e.isCollapsed(this,!0),this,!0);var t=e=this.plugin.getDefaultDisplayItem(this.plugin.getAccountIDFromItem(e));this.zoomIn(t),_.Z.sendEvent("Menu","OverviewZoom_Gmail")}}},{key:"setItem",value:function(e,t){return this.selectIndex(-1,void 0,!0),d()(v()(n.prototype),"setItem",this).call(this,e,t)}},{key:"isItemHeader",value:function(e,t){if(!t)return e.isHeader();for(var n=0,r=this.plugin,i=e.getItems(),a=0;a<i.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r.isLabelItem(i[a])||r.isAccountItem(i[a]))return!0}}},{key:"getActualPaneItem",value:function(){return this.plugin._defaultZoomItems[this.id]||this.item.get()}},{key:"canResetMultiselect",value:function(){return!_o.EmailPreview.isOpenOnPane(this)||0===this.numItems()}},{key:"setExpanded",value:function(e,t){d()(v()(n.prototype),"setExpanded",this).call(this,e,t),e||this===_.Z.focusedPane||Fr.Z.reset(this)}},{key:"_applyDropOnBlockItem",value:function(e,t,n,r){var i=e,a=t.getAttachmentByPlugin(this.plugin.id);try{_.Z.PAssert(1254,a,"Must be able to get a valid attachment")}catch(l){_.Z.reportError(l)}if(i.isDate){var o,s=i.dateTime||i.date;o=_.Z.isString(s)?_o.International.parseDate(s,w.Z.DateFormat.MDY):s;try{_.Z.PAssert(1255,_.Z.isDateValid(o),"Must provide a valid date when scheduling an email",i.dateTime,i.date)}catch(l){_.Z.reportError(l)}_.Z.isDateValid(o)&&this.plugin.scheduleEmail(t,o)}else{var c;i.isStarred?this.plugin.performAction(w.Z.PluginAction.Gmail.Star,!1,a):i.isImportant&&(c=w.Z.VMLIFlag.P1),c&&this.plugin.performAction(w.Z.PluginAction.Gmail.SetPriority,!1,a,c)}}},{key:"getSaveInfo",value:function(){var e=d()(v()(n.prototype),"getSaveInfo",this).call(this);e.viewState=this.viewState.get();var t=Fr.Z.getFirstSelectedItem(this);return e.selectedItem=t?t.id:void 0,e}},{key:"setIgnoreRestoreScroll",value:function(){}},{key:"getSwipeMenuItems",value:function(e){var t=this,n=e.item;return{left:[{icon:"check",text:"Archive",backgroundColor:"#0c0",onActivated:function(){t.archiveEmailFromCurrentLabel(n)}}],right:[{icon:"format-align-left",backgroundColor:"#09d",onActivated:function(){_o.menus.openItemAutocomplete((function(e){t.plugin.moveEmailToItem(n,e.extraInfo)}))}},{icon:"delete",backgroundColor:"#a30",onActivated:function(){t.deleteEmailFromCurrentLabel(n)}}]}}},{key:"titleOfFirstItem",value:function(){return this.getItem().getParsedText()}},{key:"onTapAddItem",value:function(){_o.menus.openComposeEmail(_o.pluginManager.getPluginGmail())}},{key:"isOverviewVisibleInPane",value:function(){return!0}},{key:"getMinItemSize",value:function(){return w.Z.EmailItemHeight}},{key:"widthOfDrag",value:function(e){return this.getWidth()}},{key:"viewModeIcon",value:function(){return"Date"===this.getViewMode()?"icon-access_time":"icon-exclamation"}},{key:"viewModeColor",value:function(){return w.Z.Colors.Red}},{key:"changeView",value:function(e){this.viewMode.set(e),this.updateItems(!1,!0)}},{key:"getViewMode",value:function(){return this.viewState.get().viewMode}},{key:"setViewMode",value:function(e){var t=this.viewState.get();t.viewMode!==e&&this.viewState.set(Object.assign({},t,{viewMode:e}),!this.isFakePane)}},{key:"becomeReal",value:function(){this.getItem()&&this.setItem(this.getItem(),!0)}},{key:"setDocument",value:function(){}},{key:"getItemHeight",value:function(){return w.Z.EmailItemHeight}},{key:"getStatusMessage",value:function(e){return this.paneTopText.get()?"":d()(v()(n.prototype),"getStatusMessage",this).call(this,e)}},{key:"getDeferredItem",value:function(e){for(var t=0,n=e.split("~"),r=0;r<n.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if("L"===n[r]){var i=n[r+1],a=n[r+2];if(i&&a){var o=this.plugin._getLabelByID(i,a);return o&&this.plugin.getVMLIForLabel(i,o)}}}}},{key:"itemLevelsDeep",value:function(e){return e.levelsDeep.get()-1}},{key:"getMobileIcon",value:function(){return"MdEmail"}}],[{key:"getPluginID",value:function(){return w.Z.PluginID.Gmail}}]),n}(Cn.Z),P()(Or.prototype,"archiveEmailFromCurrentLabel",[S.ZP],Object.getOwnPropertyDescriptor(Or.prototype,"archiveEmailFromCurrentLabel"),Or.prototype),P()(Or.prototype,"deleteEmailFromCurrentLabel",[S.ZP],Object.getOwnPropertyDescriptor(Or.prototype,"deleteEmailFromCurrentLabel"),Or.prototype),P()(Or.prototype,"removeItemFromCurrentLabel",[S.ZP],Object.getOwnPropertyDescriptor(Or.prototype,"removeItemFromCurrentLabel"),Or.prototype),Or);var Hr=0;const Vr=function(){function e(t){s()(this,e),this._plugin=t,this._headers=[],this._mimeTree=void 0}return l()(e,[{key:"reset",value:function(){this._headers=[],this._mimeTree=void 0}},{key:"getMessageText",value:function(e){return e.decoded}},{key:"updateFromDraft",value:function(){var e=a()(k().mark((function e(t,n,r,i,a,o){var s,c,l,u,d,h,p,f,g,m,v,y,Z,w,b,P,S,D,I,E,x,C=this;return k().wrap((function(e){for(var k=0;;){if(k++>5e3&&__infLoop&&__infLoop(k))throw new RangeError;switch(e.prev=e.next){case 0:if(this.reset(),this.addHeader("From",this._plugin._formatAddressText(r,i,!0)),this.addHeader("To",this._plugin._createAddressTextFromTokens(n.to,!0)),n.cc&&this.addHeader("Cc",this._plugin._createAddressTextFromTokens(n.cc,!0)),n.bcc&&this.addHeader("Bcc",this._plugin._createAddressTextFromTokens(n.bcc,!0)),this.addHeader("X-Mailer","Moo.do (https://moo.do)"),this.addHeader("Subject",_.Z.encodeMIMEHeader(n.subject||"(no subject)")),n.inReplyTo){this.addHeader("In-Reply-To",n.inReplyTo.trim()),c=t.messages.indexOfWithProperty("messageID",n.inReplyTo);try{_.Z.PAssert(1209,c>=0,"Must always be able to find the message being replied to")}catch(A){_.Z.reportError(A)}s=t.messages[c]}return n.references?l=n.references:s&&(l=(_.Z.isTempId(s.messageID)?"":s.messageID)+(s.references?" "+s.references:"")),l&&this.addHeader("References",l.trim()),e.next=12,Ne.Z.generatePlaintext(this.getMessageText(n));case 12:if(u=e.sent,(h=this._getAttachedResources(n)).length>0&&(d=this.createMimePart("multipart/mixed"),this.addMimePart(d)),!u){e.next=43;break}if(p=this.createMimePart("multipart/alternative"),this.addMimePart(p,d),f=this.createMimePart("text/plain",u,"7bit"),this.addMimePart(f,p),!((g=this._getInlineResources(n)).length>0)){e.next=39;break}m=0,v=this.createMimePart("multipart/related"),this.addMimePart(v,p),y=this.createMimePart("text/html",this.getMessageText(n),"7bit"),this.addMimePart(y,v),Z=0;case 28:if(!(Z<g.length)){e.next=37;break}if(!(m++>5e3&&__infLoop&&__infLoop(m))){e.next=31;break}throw new RangeError;case 31:w=g[Z],(b=this.createResourcePart(w))&&this.addMimePart(b,v);case 34:++Z,e.next=28;break;case 37:e.next=41;break;case 39:P=this.createMimePart("text/html",this.getMessageText(n),"7bit"),this.addMimePart(P,p);case 41:e.next=45;break;case 43:S=this.createMimePart(n.contentType||"text/html",this.getMessageText(n),"7bit"),this.addMimePart(S,d);case 45:if(!d||!a){e.next=59;break}D=0,I=0,E=function(){if(++I===h.length){for(var e=0,t=0,n=0;n<h.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=h[n];if(r.id&&_.Z.isTempId(!r.id)){var i=C.createResourcePart(r);i&&C.addMimePart(i,d)}}o()}},x=0;case 50:if(!(x<h.length)){e.next=57;break}if(!(D++>5e3&&__infLoop&&__infLoop(D))){e.next=53;break}throw new RangeError;case 53:this._plugin.loadResource(t.id,n.id,h[x].cid,E);case 54:++x,e.next=50;break;case 57:e.next=60;break;case 59:setTimeout(o,0);case 60:case"end":return e.stop()}}}),e,this)})));return function(t,n,r,i,a,o){return e.apply(this,arguments)}}()},{key:"_getInlineResources",value:function(e){var t=[];return _.Z.forEachValue(e.resources,(function(e){"inline"===e.disposition&&t.push(e)})),t}},{key:"_getAttachedResources",value:function(e){var t=[];return _.Z.forEachValue(e.resources,(function(e){"attachment"===e.disposition&&e.id&&t.push(e)})),t}},{key:"addHeader",value:function(e,t){try{_.Z.PAssert(1210,t.indexOf("\n")<0,"Header should not have a newline: "+e)}catch(r){_.Z.reportError(r)}var n=t.trim().replace(/[\r\n]/g,"");this._headers.push(e+": "+n)}},{key:"_generateBoundary",value:function(){return"=========3141592653589moodo"+Date.now()+ ++Hr}},{key:"createMimePart",value:function(e,t,n,r){try{_.Z.PAssert(1211,e,"Must supply a valid content type")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(1212,void 0===t||n,"Must supply a valid content encoding")}catch(i){_.Z.reportError(i)}return{boundary:this._generateBoundary(),contentType:e,content:t,contentEncoding:n,contentDisposition:r,children:[]}}},{key:"createResourcePart",value:function(e){try{_.Z.PAssert(1213,e&&e.data,"Must have valid data loaded for resource to embed it in message")}catch(i){_.Z.reportError(i)}var t;if(e&&e.data){var n=e.mimeType+'; name="'+e.cid+'"',r=e.disposition+'; filename="'+e.cid+'"';(t=this.createMimePart(n,e.data,e.contentEncoding,r)).contentID=e.cid}return t}},{key:"addMimePart",value:function(e,t){try{_.Z.PAssert(1214,e,"Must supply a valid mime part")}catch(n){_.Z.reportError(n)}if(t)t.children.push(e);else{try{_.Z.PAssert(1215,!this._mimeTree,"Must not yet have a valid mime tree root")}catch(n){_.Z.reportError(n)}this._mimeTree=e}}},{key:"_mimePartToBlob",value:function(e){var t="\r\n",n=[];function r(e,t){if(t){try{_.Z.PAssert(1216,t.indexOf("\n")<0,"Header should not have a newline: "+e)}catch(i){_.Z.reportError(i)}var r=t.trim().replace(/[\r\n]/g,"");n.push(e+": "+r)}}var i=e.contentType;(e.content||(i+='; boundary="'+e.boundary+'"'),r("MIME-Version","1.0"),r("Content-Type",i),r("Content-Transfer-Encoding",e.contentEncoding),r("Content-Disposition",e.contentDisposition),e.contentID)&&r("Content-ID","<"+e.contentID+">");if(t=n.join("\r\n").trim(),t+="\r\n",e.content)t+="\r\n"+e.content+"\r\n";else if(e.children&&e.children.length>0){for(var a=0,o=0;o<e.children.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t+="\r\n--"+e.boundary+"\r\n",t+=this._mimePartToBlob(e.children[o])}t+="--"+e.boundary+"--\r\n"}else t+="\r\n(no text)\r\n";return t}},{key:"generateBlob",value:function(){var e=this._headers.join("\r\n").trim();return e+="\r\n"+this._mimePartToBlob(this._mimeTree)}}]),e}();function Wr(e){this._maxSize=e,this._groups=[],this._groupID=0,this._cursor=-1,this._performingActions=!1,this._actionsPreventUndo=!1,this._aggregateActions=0,this._currentAction=[],this._registeredOwners={},this._registeredActions={}}Wr.prototype={registerOwner:function(e,t){try{_.Z.PAssert(1192,e,"Must supply a valid owner object")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(1193,!this._registeredOwners[t],"Must not double define an owner")}catch(n){_.Z.reportError(n)}this._registeredOwners[t]=e,this._registeredActions[t]={}},registerAction:function(e,t,n){try{_.Z.PAssert(1194,e,"Must provide a valid owner")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(1195,t,"Must provide a valid action ID")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(1196,this._registeredOwners[e],"Must have already registered a valid owner")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(1197,!this._registeredActions[e][t],"Must not double define an action for an owner")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(1198,n,"Must pass in a valid undo/redo descriptor")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(1199,_.Z.isFunction(n.undo),"Must provide a valid undo fn")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(1200,_.Z.isFunction(n.redo),"Must provide a valid redo fn")}catch(r){_.Z.reportError(r)}this._registeredActions[e][t]=n},_getOwner:function(e){try{_.Z.PAssert(1201,this._registeredOwners[e.ownerID],"Must have previously registered owner")}catch(t){_.Z.reportError(t)}return this._registeredOwners[e.ownerID]},_getActionData:function(e){try{_.Z.PAssert(1202,this._registeredOwners[e.ownerID],"Must have previously registered owner")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(1203,this._registeredActions[e.ownerID][e.actionID],"Must have previously registered action for owner")}catch(t){_.Z.reportError(t)}return this._registeredActions[e.ownerID][e.actionID]},_useNextGroupID:function(){return++this._groupID},_getCurrentGroup:function(){return this._groups[this._cursor]},_createGroup:function(e){return{id:this._useNextGroupID(),events:e||[]}},_pushNewGroup:function(e){var t=this._createGroup(e);this._groups.length>this._cursor+1&&(this._groups=this._groups.slice(0,this._cursor+1)),this._groups.push(t),this._cursor<this._maxSize-1&&this._cursor++,this._groups.length>this._maxSize&&this._trimAction()},_trimAction:function(){this._groups.shift()},isUndoableAction:function(){return!this._actionsPreventUndo},beginAction:function(e){if(0===this._aggregateActions){try{_.Z.PAssert(1204,0===this._currentAction.length,"Current actions should be flushed")}catch(t){_.Z.reportError(t)}this._actionsPreventUndo=!!e}this._aggregateActions++},runAction:function(e,t,n){var r={ownerID:e,actionID:t},i=this._getOwner(r);return this._getActionData(r).redo.apply(i,n)},performAction:function(e,t,n){try{_.Z.PAssert(1205,this._aggregateActions>0,"Must be in a begin/end action block")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(1206,n,"Must provide valid data for the action")}catch(r){_.Z.reportError(r)}this._currentAction.push({ownerID:e,actionID:t,data:n})},performActions:function(e){if(e&&e.length>0){var t=0;this.beginAction();for(var n=0;n<e.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[n];this.performAction(r.ownerID,r.actionID,r.data)}this.endAction()}},endAction:function(){1===this._aggregateActions&&(this._currentAction.length>0&&(this._pushNewGroup(this._currentAction),this._currentAction=[]),this._actionsPreventUndo=!1),this._aggregateActions=Math.max(0,this._aggregateActions-1)},undoAction:function(){if(this._cursor>=0)for(var e=0,t=this._groups[this._cursor--],n=t.events.length-1;n>=0;n--){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t.events[n],i=this._getOwner(r);this._getActionData(r).undo.apply(i,r.data.undoParams)}},redoAction:function(){if(this._cursor>=-1&&this._cursor<this._groups.length-1)for(var e=0,t=this._groups[++this._cursor],n=0;n<t.events.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t.events[n],i=this._getOwner(r);this._getActionData(r).redo.apply(i,r.data.redoParams)}}};const zr=Wr;var qr;function Gr(e){var t=function(e,t){if("object"!==Qn()(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==Qn()(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Qn()(t)?t:String(t)}function Kr(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}var Yr,Xr="EnsureLabelVMLI",Qr="CreateLabelVMLI",Jr="MergeThread",$r="SyncdMessage",ei="ErrorSyncdMessage",ti="UnsyncdMessage",ni="OldUnsyncdMessage",ri="MessagesSyncd",ii="MessageDataCached",ai="snoozemail",oi="sendmail",si=1,ci=2,li=3,ui=4,di=5,hi=6,pi=7,fi=8,gi=9,mi=10,vi=11,yi=12,ki=13,_i=14,Zi=15,wi=16,bi=17,Pi=18,Si=19,Di=20,Ii="historyIDs",Ei="labels",xi="sendAs",Ci="Moo.do";!function(e){e.INBOX="INBOX",e.SPAM="SPAM",e.TRASH="TRASH",e.UNREAD="UNREAD",e.STARRED="STARRED",e.IMPORTANT="IMPORTANT",e.SENT="SENT",e.DRAFT="DRAFT",e.CHAT="CHAT",e.CATEGORY_PERSONAL="CATEGORY_PERSONAL",e.CATEGORY_SOCIAL="CATEGORY_SOCIAL",e.CATEGORY_PROMOTIONS="CATEGORY_PROMOTIONS",e.CATEGORY_UPDATES="CATEGORY_UPDATES",e.CATEGORY_FORUMS="CATEGORY_FORUMS"}(Yr||(Yr={}));var Ai,Li={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},Mi="==MOODO_ARCHIVED==",Ti="==MOODO_ALLMAIL==",Ri={PRI1:"Moo.do/Priority High",PRI2:"Moo.do/Priority Medium",PRI3:"Moo.do/Priority Low"},Oi="Moo.do/Handled",Fi=["id","labelIds","messageID","draftID","decoded","mimeType","contentType","from","replyTo","to","cc","bcc","snippet","subject","date","internalDate","references","inReplyTo","listUnsubscribe","resources","cached","cachedError","modifiedOffline"],Ni="multipart/signed",Bi="multipart/related",Ui="message/partial",ji="multipart/mixed",Hi="multipart/report",Vi="multipart/parallel",Wi="multipart/alternative",zi="multipart/digest",qi="multipart/encrypted",Gi="multipart/voice-message",Ki="text/calendar",Yi="text/plain",Xi="text/html",Qi="text/watch-html",Ji="text/x-watch-html";!function(e){e.Unknown="unknown",e.Inline="inline",e.FormData="form-data",e.Attachment="attachment"}(Ai||(Ai={}));var $i="text/html;charset=utf-8",ea=["application","audio","example","image","message","model","video","text"],ta=[Wi,ji,Yi,Xi,Hi],na=[Yi,Xi],ra=[Ki,Gi,qi,ji],ia=["modifiedOffline","pendingSend","isDeleted","dataLoaded"],aa=/(?:[\"]?([^\"]*)[\"]?\s)?<(.*)>/g,oa=/\'(.*)\'/g;const sa=(qr=function(e){p()(n,e);var t=Kr(n);function n(){var e;return s()(this,n),(e=t.call(this,w.Z.PluginID.Gmail,"g","Email",!1,{s:!0}))._lastSyncTime=void 0,e._requiresOfflineAuth=!0,e.doesRender=!0,ve.Z.binder(Pr()(e),"threadSortFn","threadSortPriorityFn","labelSortFn","labelVMLISortFn","sortFn","_fromComparator","_toComparator","_dateComparator","_messagesComparator","_shallowObjComparator","isGmailItem","_flushPendingDraftUpdates","driveMessageContentSync","_cleanupLocalCaches","_handleDeferredSnoozeTask","_cancelDeferredSnoozeTask","_persistRemoteSnoozeTask","_handleDeferredSendMailTask","_cancelDeferredSendMailTask","_persistRemoteSendMailTask"),e._emailCache={},e._labelsByID={},e._labelsByName={},e._priorityLabels={},e._creatingDrafts={},e._pendingDraftUpdates={},e._pendingThreadLoads={},e._loadThreadMutex=0,e._activeDraftUpdates=0,e._accountSettings={},e._pendingSends={},e._draftCache={},e._unsyncdMessages={},e._pendingSyncdMessages={},e._numUnsyncdMessages=0,e._numSyncdMessages=0,e._outstandingContentSync=!1,e.isLoadingThreads=new x.Z(!1),e._undoStack=new zr(10),e._generateUndoRedo(),e._syncingOfflineChanges=!1,e._draftFlushTimer=void 0,e.registerSetting("SyncTime","syncTime","t",!0,w.Z.MaxGmailSyncTime.Free),e.registerSetting("ArchiveOnSchedule","archiveOnSchedule","a",!0,!1),e.registerSetting("ArchiveOnOrganize","archiveOnOrganize","o",!0,!1),e.registerSetting("InsertSignatureAboveReplies","insertSignatureAboveReplies","i",!0,!1),e.addTrackedStat(Xr),e.addTrackedStat(Qr),e.addTrackedStat(Jr),e.addTrackedStat($r),e.addTrackedStat(ei),e.addTrackedStat(ti),e.addTrackedStat(ni),e.addTrackedStat(ri),e.addTrackedStat(ii),e._threadCache=e.registerLocalCache(e.id,w.Z.StorageType.IndexedDB,{noInMemoryCache:!0,metadataKeys:[Ii,Ei,xi],keyFieldsRN:["date","accountID","modifiedOffline"]}),e._rawCache=e.registerLocalCache(e.id+"Messages",w.Z.StorageType.IndexedDB,{noInMemoryCache:!0,keyFieldsRN:["internalDate"]}),e.registerDeferredTaskType(ai,e._handleDeferredSnoozeTask,e._cancelDeferredSnoozeTask,e._persistRemoteSnoozeTask),e.registerDeferredTaskType(oi,e._handleDeferredSendMailTask,e._cancelDeferredSendMailTask,e._persistRemoteSendMailTask),e._contentSyncTask=e.registerLowImpactTask("ContentSync",e.driveMessageContentSync),e._cacheCleanup=e.registerLowImpactTask("CacheCleanup",e._cleanupLocalCaches),e._lastCacheCleanup=0,e.declareProperty("accountID",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full|w.Z.PluginLoad.Inline,!1),e.declareProperty("from",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!1,void 0,e._fromComparator),e.declareProperty("to",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!1,void 0,e._toComparator),e.declareProperty("text",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Inline),e.declareProperty("subject",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full|w.Z.PluginLoad.Inline),e.declareProperty("service",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Inline,!1,"g"),e.declareProperty("date",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!0,new Date(0),e._dateComparator),e.declareProperty("lastModifiedDate",w.Z.PluginLoad.Full,!0,void 0,e._dateComparator),e.declareProperty("modifiedOffline",w.Z.PluginLoad.Full,!0,!1),e.declareProperty("pendingSend",w.Z.PluginLoad.Full,!0,!1),e.declareProperty("messages",w.Z.PluginLoad.Full,!0,[],e._messagesComparator),e.declareProperty("snippet",w.Z.PluginLoad.Full),e.declareProperty("participants",w.Z.PluginLoad.Runtime,!0,[]),e.declareProperty("subjectLower",w.Z.PluginLoad.Runtime),e.declareProperty("count",w.Z.PluginLoad.Runtime),e.declareProperty("dataLoaded",w.Z.PluginLoad.Runtime,!0,!1),e.declareProperty("isDeleted",w.Z.PluginLoad.Runtime,!0,!1),e.declareProperty("labelIds",w.Z.PluginLoad.Runtime,!0,[]),e.declareProperty("hasAttachments",w.Z.PluginLoad.Full,!0,!1),e.tempRootVMLI=j.Z.createTempVMLI({id:"loading",text:"Loading emails"},{changeType:w.Z.ChangeType.Auto}),e}return l()(n,[{key:"getType",value:function(){return w.Z.PluginType.Email}},{key:"_attachMetadataFields",value:function(){return ia}},{key:"getDataPane",value:function(){try{_.Z.PAssert(652,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(e){_.Z.reportError(e)}return jr}},{key:"getPaneIcon",value:function(){return"icon-mail_outline"}},{key:"getPanePriority",value:function(){return 97}},{key:"useItemStore",value:function(){return"Gmail"}},{key:"itemStoreOptions",value:function(){return{requireStoredEls:!1,enabledFilters:w.Z.ItemStoreFilter.Priority,parserFn:it.Z.runParseSinglePlugin}}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"ensureAccountEmail",value:function(e){return"me"===e?this.getDefaultAccount():e}},{key:"getDefaultAccount",value:function(e){var t,n=ie.Z.getDefaultAccountID();if(n){try{_.Z.PAssert(653,"me"!==n,'Should never return "me" as a valid user')}catch(r){_.Z.reportError(r)}this.hasSyncAccount(n)&&(t=n)}else if(!e){try{_.Z.PAssert(654,!1,'Unable to get default account name, returning "me"')}catch(r){_.Z.reportError(r)}t="me"}return t||(t=Object.keys(ie.Z.authTokens)[0]),t||(t=n),t}},{key:"isSameAccount",value:function(e,t){return"me"===e&&(e=this.getDefaultAccount()),"me"===t&&(t=this.getDefaultAccount()),e===t}},{key:"areItemsFromSameAccount",value:function(e,t){var n=this.getAccountIDFromItem(e),r=this.getAccountIDFromItem(t);return this.isSameAccount(n,r)}},{key:"_handleAccountChanges",value:function(){var e=this,t=0,n=[];_o.PaneManager.runForEachPane((function(t){var r=e.getAccountIDFromItem(t.getItem());try{_.Z.PAssert(655,r,"Missing Account ID: ",t.id,t.getItem().id)}catch(i){_.Z.reportError(i)}e.hasSyncAccount(r)||n.push(t)}),this.getPaneType());for(var r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;_o.PaneManager.removePane(n[r])}0===n.length&&_o.PaneManager.notifyPanes()}},{key:"onSyncAccountsChanged",value:function(e,t){var r=this;d()(v()(n.prototype),"onSyncAccountsChanged",this).call(this,e,t),_o.PaneUpdateBatcher.beginUpdateItems(),t.forEach((function(e){if(r._clearCachedData(e),r.getDefaultItemStore()){var t=r.getVMLIForAccount(e);t&&(t.deleteSelf(w.Z.ChangeType.Local),t.isDestroyed()||t.getItemStore().destroyItem(t.id))}r._handleAccountChanges()})),e.forEach((function(e){r.isActive()&&(r._ensureLabel(e,Yr.INBOX,"Inbox",void 0,void 0,w.Z.ChangeType.Local),r._ensureLabel(e,Yr.UNREAD,"Unread",void 0,void 0,w.Z.ChangeType.Local),r._ensureLabel(e,Mi,"Archived",void 0,void 0,w.Z.ChangeType.Local),r._ensureLabel(e,Ti,"All Mail",void 0,void 0,w.Z.ChangeType.Local),r._forceLabelSync((function(){r._forceThreadSync()}))),r._handleAccountChanges()})),_o.PaneUpdateBatcher.commitUpdateItems()}},{key:"_iterateSendAs",value:function(e){for(var t=0,n=this.getSyncAccounts(),r=!1,i=0;!r&&i<n.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=this.getAccountSetting(n[i],"sendAs");if(a)for(var o=0,s=0;s<a.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var c=a[s];if(e(n[i],c)){r=!0;break}}else e(n[i])}}},{key:"getSignature",value:function(e){var t;return this._iterateSendAs((function(n,r){if(r&&r.sendAsEmail===e)return t=r.signature,!0})),t}},{key:"getReplyToAddress",value:function(e){var t;return this._iterateSendAs((function(n,r){if(r&&r.sendAsEmail===e&&r.replyToAddress)return t=r.replyToAddress,!0})),t}},{key:"_computeDisplayName",value:function(e,t){var n;return!t.displayName&&t.isPrimary||(n=t.displayName),n}},{key:"getDisplayName",value:function(e){var t,n=this;return this._iterateSendAs((function(r,i){if(i&&i.sendAsEmail===e)return t=n._computeDisplayName(r,i),!0})),t}},{key:"getDefaultSendingAccount",value:function(e){var t;return this._iterateSendAs((function(n,r){if(n===e&&r&&r.isDefault)return t=r.sendAsEmail,!0})),t||(t=e),t}},{key:"getDefaultFromInfo",value:function(e){var t=this.getDefaultSendingAccount(e);try{_.Z.PAssert(656,t,"Must have found a valid account to send from")}catch(n){_.Z.reportError(n)}return{text:this.getDisplayName(t),email:t}}},{key:"getSendingAccounts",value:function(e){var t=[];return this._iterateSendAs((function(n,r){e&&e!==n||(r?"pending"!==r.verificationStatus&&t.push(r.sendAsEmail):t.push(n))})),t}},{key:"getSyncAccount",value:function(e){var t;return this._iterateSendAs((function(n,r){if(r){if(r.sendAsEmail===e)return t=n,!0}else if(e===n)return t=n,!0})),t}},{key:"getSendingAccountInfo",value:function(e){var t,n=this;return this._iterateSendAs((function(r,i){if(i){if(i.sendAsEmail===e)return t={text:n._computeDisplayName(r,i),email:e},!0}else if(e===r)return!0})),t}},{key:"_getSettingsSendAs",value:function(e){var t=this,n=this.getSyncAccounts(),r=n.length,i=0,a={},o=function(t,n,o){t&&(a[n]=o.sendAs),++i===r&&e(a)};n.forEach((function(e){t._requestSettings(e,o)}))}},{key:"_requestSettings",value:function(e,t){var n=this,r=$t.Z.fns("gmail").users.settings.sendAs.list.packedFn,i={userId:e};this._queueRemoteRequestMulti(e,r,i,(function(n){t(!0,e,n)}),(function(r){t(!1,e,r),n._notifyFailedRequest(e,r)}),void 0,Di)}},{key:"_emailComparator",value:function(e,t){var n=_.Z.isString(e)?this.parseEmailAddress(e):e,r=_.Z.isString(t)?this.parseEmailAddress(t):t;return n.text===r.text&&n.email===r.email}},{key:"_fromComparator",value:function(e,t){var n=!1;return e||t?e&&t&&(n=this._emailComparator(e,t)):n=!0,n}},{key:"_toComparator",value:function(e,t){var n=!1;return e||t?e&&t&&(n=this._emailComparator(e,t)):n=!0,n}},{key:"_dateComparator",value:function(e,t){var n=!1;if(e||t){if(e&&t){_.Z.isString(e)&&(e=this.parseDateHeader(e)),_.Z.isString(t)&&(t=this.parseDateHeader(t));try{_.Z.PAssert(657,_.Z.isDateValid(e),"Must be an old valid date to compare")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(658,_.Z.isDateValid(t),"Must be a new valid date to compare")}catch(r){_.Z.reportError(r)}_.Z.isDateValid(e)&&_.Z.isDateValid(t)&&(n=e.equals(t))}}else n=!0;return n}},{key:"_messagesComparator",value:function(e,t){var n=!0;if(e&&t)if(e.length===t.length)for(var r=0,i=0;n&&i<t.length;++i){var a=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var o=e[i],s=t[i],c=0;c<Fi.length;++c){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=Fi[c],u=!0;switch(l){case"from":u=this._fromComparator(o[l],s[l]);break;case"to":u=this._toComparator(o[l],s[l]);break;case"resources":case"listUnsubscribe":u=this._shallowObjComparator(o[l],s[l]);break;case"labelIds":u=s[l].equals(o[l]);break;case"date":case"internalDate":u=this._dateComparator(o[l],s[l]);break;default:u=o[l]===s[l]}u||(n=!1)}}else n=!1;else n=!1;return n}},{key:"_shallowObjComparator",value:function(e,t){var n=!1;if(e||t){if(e&&t)if(e===t)n=!0;else for(var r in n=!0,e)if(!t.hasOwnProperty(r)){n=!1;break}}else n=!0;return n}},{key:"onPaneActivated",value:function(e){this._offlineLoad(),e&&e()}},{key:"_offlineLoad",value:function(){var e=this,t=0;if(this._isOfflineLoaded)return!0;if(!_.Z.isDemoMode()){var n=this._threadCache.getMetadata(xi);n&&Object.keys(n).forEach((function(t){return e.setAccountSetting(t,"sendAs",n[t])}))}var r=this._threadCache.getMetadata(Ei),i=this.getSyncAccounts();!_.Z.isDemoMode()&&r||(r={}),r.me&&!r[this.getDefaultAccount()]&&(r[this.getDefaultAccount()]=r.me),_o.PaneUpdateBatcher.beginUpdateItems();for(var a=0;a<i.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=i[a];this._ensureLabel(o,Yr.INBOX,"Inbox",void 0,void 0,w.Z.ChangeType.Local),this._ensureLabel(o,Yr.UNREAD,"Unread",void 0,void 0,w.Z.ChangeType.Local),this._ensureLabel(o,Mi,"Archived",void 0,void 0,w.Z.ChangeType.Local),this._ensureLabel(o,Ti,"All Mail",void 0,void 0,w.Z.ChangeType.Local);var s=r[o];if(s){for(var c in s)if(s.hasOwnProperty(c)){var l=s[c];if(!Yr[l.id]){var u=l.name||"LocalLabel"+Date.now();_.Z.isString(l.oldestSync)&&(l.oldestSync=new Date(l.oldestSync)),this._ensureLabel(o,c,u,l.oldestSync,l,w.Z.ChangeType.Local)}}for(var d in Yr)if(Yr.hasOwnProperty(d)){var h=Li[d];this._ensureLabel(o,d,h,void 0,void 0,w.Z.ChangeType.Local)}}this._ensureLabelVMLIsForAccount(o)}var p=+this._getMetadataSyncTime(),f=+this._getUnreadSyncTime(),g=this._threadCache.getPreloadData();if(g){_.Z.isArray(g)&&(g=_.Z.arrayToObjectById(g));try{_.Z.PAssert(659,_.Z.isObject(g),"Thread preload is not object")}catch(v){_.Z.reportError(v)}this._isLoadingLocal=!0;var m=[];Object.keys(g).forEach((function(t){var n=g[t];try{_.Z.PAssert(660,n,"Must always contain a valid entry when retreiving data from preload")}catch(v){_.Z.reportError(v)}if(n&&(e.ensureThreadDates(n),function(t){var n=e.getEntryDateAsNumber(t.date);return i.indexOf(t.accountID)>=0&&n>f}(n))){var r=e.createEntryFromLocal(n.id,n);(e.isPriorityData(r)||+n.date>p)&&(e.cacheData(r.id,r)&&m.push(r),e._updateSpecialLabels(r))}})),this._isLoadingLocal=!1,this._isOfflineLoaded=!0,_.Z.scheduleIdleTask((function(){var t=0;be.Z.beginBatch();for(var n=0;n<m.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e._checkUnsyncdMessageContent(m[n])}be.Z.commitBatch()}))}return _o.PaneUpdateBatcher.commitUpdateItems(),this.notifyPanesReadyForLoad(),!0}},{key:"isPriorityData",value:function(e){var t=!1;return(e.labelIds.indexOf(Yr.UNREAD)>=0||e.labelIds.indexOf(Ri.PRI1)>=0||e.labelIds.indexOf(Ri.PRI2)>=0||e.labelIds.indexOf(Ri.PRI3)>=0)&&(t=!0),t}},{key:"_load",value:function(){_.Z.isDemoMode()||this.createRecurringTask("GmailThreadSync",{delay:_.Z.minutes(15),minDelay:_.Z.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:_.Z.minutes(2),task:this.runThreadSync}),this.runSettingsSync(),this.createRecurringTask("GmailLabelSync",{delay:_.Z.minutes(30),minDelay:_.Z.minutes(15),runOnCreate:!0,pauseWhileIdle:!0,async:!0,task:this.runLabelSync})}},{key:"_notifyFailedRequest",value:function(e,t){try{_.Z.PAssert(661,_.Z.isString(e),"Must supply a valid accountID string")}catch(c){_.Z.reportError(c)}if(t&&t.error)if(t.error.code===w.Z.HTTPStatusCode.Unauthorized)_o.pluginManager.verifyAuthorization(e);else if(t.error.code===w.Z.HTTPStatusCode.BadRequest)for(var n=0,r=t.error.errors,i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r[i].reason===w.Z.GoogleError.FailedPrecondition&&(_o.toasts.pushMessage(w.Z.MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}else if(t.error.code===w.Z.HTTPStatusCode.Forbidden)for(var a=0,o=t.error.errors,s=0;s<o.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;o[s].reason===w.Z.GoogleError.InsufficientPermissions&&(_o.toasts.pushMessage(w.Z.MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}else t.error.code>=400&&t.error.code<500&&this._reportErrorCode(t.error.code)&&_.Z.reportError(new Error("Failed Gmail request: "+t.error.code),t)}},{key:"_reportErrorCode",value:function(e){var t=!1;return e!==w.Z.HTTPStatusCode.NotFound&&(t=!0),t}},{key:"_notifySendFailed",value:function(){_o.toasts.pushMessage(w.Z.MessageID.EmailSendFail)}},{key:"_createResourceCID",value:function(e,t){var n=0;t||(t="UnnamedFile");for(var r=t,i=1;e[r];){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=t.split(".");r=a[0]+"_"+i,a[1]&&(r+="."+a[1]),i++}return r}},{key:"_createResource",value:function(e,t){try{_.Z.PAssert(662,e,"Must have valid resources lib to add to")}catch(n){_.Z.reportError(n)}return{cid:this._createResourceCID(e,t.name),id:_.Z.generateTempId(),attID:void 0,realAttrID:void 0,data:void 0,size:void 0,thumbnail:void 0,uploader:void 0,link:void 0,error:!1,disposition:Ai.Attachment,parentType:ji,mimeType:t.type,contentEncoding:void 0}}},{key:"_getLinkedResourceString",value:function(e){return'<a cid="'+e.cid+'" style="background-color:#f3f3f3;border:1px solid #dddddd;padding:8px;width:396px;font-weight:bold;min-height:18px;display:block;border-radius:3px;margin-bottom:8px;" href="'+e.link+'"><img style="vertical-align:top;border:none;margin-right:8px;" src="https://ssl.gstatic.com/docs/doclist/images/icon_10_generic_list.png">'+e.cid+"</a>"}},{key:"_removeAttachContent",value:function(){var e=a()(k().mark((function e(t,n,r){var i,a;return k().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return i=!1,e.next=3,Ne.Z.removeElementsByAttribute(n.decoded,"cid",r.cid);case 3:return a=e.sent,i=a!==n.decoded,n.decoded=a,e.abrupt("return",i);case 7:case"end":return e.stop()}}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"notifyAttachLinkedFile",value:function(e,t,n,r){var i={name:n.getField("title"),type:n.getField("mimeType")},a=this._createResource(t.resources,i);a.size=n.getField("fileSize"),a.link=n.getField("alternateLink"),this._shareAttachment(e,n.id,a,r),t.resources[a.cid]=a,e.notifyDataMutated(["hasAttachments"],w.Z.ChangeType.Local)}},{key:"notifyAttachFiles",value:function(e,t,n,r){for(var i=0,a=this,o=e.getField("accountID"),s=0;s<n.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var c=n[s],l=this._createResource(t.resources,c);l.size=c.size,l.uploader=new In.Z(c,o,{named:w.Z.DriveFolder.Attach},void 0,(function(){e.notifyDataMutated(["hasAttachments"],w.Z.ChangeType.Local)}),function(t,n){t.error=!1,t.link=n.alternateLink,t.thumbnail=n.thumbnailLink,a._shareAttachment(e,n.id,t,r)}.bind(this,l),function(t){t.error=!0,_o.toasts.pushMessage({text:"There was an error uploading your attachment.",actionText:"RETRY",action:function(){t.uploader.resume()}}),e.notifyDataMutated(["hasAttachments"],w.Z.ChangeType.Local),r&&r(!1)}.bind(this,l)),l.uploader.upload(),t.resources[l.cid]=l}e.notifyDataMutated(["messages"],w.Z.ChangeType.Local)}},{key:"_shareAttachment",value:function(e,t,n,r){var i=this;try{_.Z.PAssert(663,t,"Must supply a valid fileID to share")}catch(o){_.Z.reportError(o)}try{_.Z.PAssert(664,n,"Must supply a valid resource object to share")}catch(o){_.Z.reportError(o)}var a=e.getField("accountID");_o.remoteAPI().drivePermissionsPublic(a,t,(function(){n.error=!1,e.notifyDataMutated(["messages"],w.Z.ChangeType.Local),r&&r(!0)}),(function(a){n.error=!0,_.Z.isHTTPStatusCode(a,w.Z.HTTPStatusCode.Forbidden)?_o.toasts.pushMessage({text:"Sharing files/attachments in Google Drive is disabled on your domain. Please contact your domain administrator.",actionText:"OKAY",hold:!0}):_o.toasts.pushMessage({text:"There was an error sharing your attachment.",actionText:"RETRY",action:function(){i._shareAttachment(e,t,n,r)}}),e.notifyDataMutated(["hasAttachments"],w.Z.ChangeType.Local),r&&r(!1)}))}},{key:"removeAttachFiles",value:function(){var e=a()(k().mark((function e(t,n,r){var i;return k().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:try{_.Z.PAssert(665,r,"Must always specify a valid resource to remove from the message")}catch(o){_.Z.reportError(o)}return i=!1,r.uploader&&!r.uploader.isDone()&&(r.uploader.cancel(),i=!0),n.resources[r.cid]&&delete n.resources[r.cid],e.next=6,this._removeAttachContent(t,n,r);case 6:if(e.t0=e.sent,e.t0){e.next=9;break}e.t0=i;case 9:return i=e.t0,t.notifyDataMutated(["messages"],w.Z.ChangeType.Local),e.abrupt("return",i);case 12:case"end":return e.stop()}}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"notifyItemPropertyChanged",value:function(e,t,n,r){var i=e.getField("accountID");if(this.hasSyncAccount(i)){var a=this.attachmentIsArchived(e);if(t.belongsToItemStore(this.getDefaultItemStore()))t.dateCompleted&&!a&&this.archiveAttachment(e);if("priority"===r)this.getAttachmentPriority(e)!==t.getPriority()&&this.setAttachmentPriority(e,t.getPriority());else"isArchived"===r&&(a&&!t.isArchived()?this.unarchiveAttachment(e):!a&&t.isArchived()&&(this.archiveAttachment(e),_o.EmailPreview.isOpenOnThread(e)&&_o.EmailPreview.reset()))}}},{key:"createLabelString",value:function(e){if(!Li[e.toUpperCase()])return e}},{key:"isDisplayTag",value:function(e,t){var n=!1;if(e&&e.shouldDisplayInMessageList()){var r=e.isCustom()||e.getLabelID()===Yr.DRAFT,i=t&&!t.isInbox()&&e.isInbox();if(r||i)switch(n=!0,e.getName()){case Ri.PRI1:case Ri.PRI2:case Ri.PRI3:case Oi:case Li.STARRED:n=!1}}return n}},{key:"isDisplayHeader",value:function(e){var t=!1;this.isLabelItem(e)&&(this._getLabelIDFromItem(e)!==Yr.UNREAD&&(t=!0));return t}},{key:"isMessageDraft",value:function(e){return e&&e.labelIds&&e.labelIds.indexOf(Yr.DRAFT)>=0}},{key:"getDisplayTags",value:function(e,t,n){var r,i=0,a=e.getField("labelIds"),o=e.getField("accountID"),s=[];t&&(r=t.getItemLabel(!0));for(var c=0;c<a.length;++c){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var l=this._getLabelByID(o,a[c]);if(l&&this.isDisplayTag(l,r)){var u=n?l.getOutlineText():l.getDisplayText();u&&s.push(u)}}return s}},{key:"_getParticipantDisplayName",value:function(e,t){var n;if(this.isMyAccountID(e.email))n="me";else if(e.text)if(1===t)n=e.text;else{var r=e.text.split(" ");n=r&&r.length>0?r[0]:e.email}else n=e.email;return n}},{key:"getDisplayParticipants",value:function(e){for(var t=0,n=e.getField("participants"),r=[],i=0;i<n.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r.push(this._getParticipantDisplayName(n[i],n.length))}return r.join(", ")}},{key:"getDefaultDisplayItem",value:function(e){e=e||this.getDefaultAccount(!0);try{_.Z.PAssert(666,e,"Should not be getting default display item without accountID")}catch(n){_.Z.reportError(n)}if(e){var t=this._getLabelByID(e,Yr.INBOX);return t&&this.getVMLIForLabel(e,t)}return this.tempRootVMLI}},{key:"getEmailRootItem",value:function(){return Er.getItems(w.Z.FavoriteGroup.EmailRoot)[0]}},{key:"hasEmailRootItem",value:function(){return Er.hasItems(w.Z.FavoriteGroup.EmailRoot)}},{key:"createEmailRootItem",value:function(){try{_.Z.PAssert(667,!this.hasEmailRootItem(),"Should not create email root if it already exists")}catch(n){_.Z.reportError(n)}var e=_o.itemStoreManager.getDefaultItemStore().getRoot(),t=j.Z.createVMLI({text:"Email"},{parent:e,changeType:w.Z.ChangeType.AllLocal,documentOwner:void 0});return e.insertItem(t,0),_o.toasts.pushMessage({text:'A new "Email" item was created at the top of your document for snoozed emails.',action:w.Z.MessageAction.Okay,hold:!0}),t}},{key:"ensureEmailItem",value:function(e){var t=0;this.hasEmailRootItem()||this.createEmailRootItem();for(var n,r=this.getEmailRootItem(),i=r.getItems(),a=0;a<i.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(i[a].getRawText()===e){n=i[a];break}}return n||(n=j.Z.createVMLI({text:e},{parent:r,changeType:w.Z.ChangeType.AllLocal,documentOwner:void 0}),r.insertItem(n,0)),n}},{key:"getWaitingItem",value:function(e){e(this.ensureEmailItem("Waiting"))}},{key:"allowTextEditing",value:function(e){var t=!0,n=this.getDefaultItemStore();return e.belongsToItemStore(n)&&(t=!1),t}},{key:"getDraftForMessage",value:function(e,t,n,r){try{_.Z.PAssert(668,t,"Must have a valid thread ID")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(669,n,"Must have a valid message ID")}catch(c){_.Z.reportError(c)}var i,a=this.getAttachment(t).getField("messages"),o=a.indexOfWithProperty("id",n);try{_.Z.PAssert(670,o>=0,"Must be able to find the requested message")}catch(c){_.Z.reportError(c)}var s=a[o+1];s&&s.labelIds.indexOf(Yr.DRAFT)>=0?i=s:(this.createDraft(e,t,n,{from:r}),i=a[o+1]);try{_.Z.PAssert(671,i.labelIds.indexOf(Yr.DRAFT)>=0,"Must return a valid draft")}catch(c){_.Z.reportError(c)}return i}},{key:"getDraftByID",value:function(e,t,n,r){var i,a;if(t){var o=(i=this.getAttachment(t)).getField("messages");a=n?this._getMessageFromAttachment(i,n):o[0];try{_.Z.PAssert(672,a.labelIds.indexOf(Yr.DRAFT)>=0,"Must be a valid draft")}catch(c){_.Z.reportError(c)}}else{var s=this.createDraft(e,void 0,void 0,r);a=(i=this.getAttachment(s.threadID)).getField("messages")[0]}return{attach:i,draftMsg:a}}},{key:"_notifyDraftMessage",value:function(e,t,n){var r=this;try{_.Z.PAssert(673,e,"Must supply a valid accountID")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(674,t&&!_.Z.isTempId(t),"Must supply a valid threadID: ",t)}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(675,n&&!_.Z.isTempId(n),"Must supply a valid messageID: ",n)}catch(i){_.Z.reportError(i)}setTimeout((function(){r.hasCacheData(t)&&r._getRemoteDraftID(e,t,n,(function(e,n){n&&(_.Z.log("DraftID: ",e),r.cacheData(t,r.getCacheData(t),!0,["messages"]))}))}),0)}},{key:"_getInlineResources",value:function(e){var t={};return _.Z.forEachValue(e.resources,(function(e){e.disposition===Ai.Inline&&(t[e.cid]=Object.assign({},e))})),t}},{key:"createDraft",value:function(e,t,n,r){r=r||{};try{_.Z.PAssert(676,!r.body||!r.decoded,"Must not supply both a decoded field and a body")}catch(p){_.Z.reportError(p)}this.sendEvent("CreateDraft");var i=_.Z.generateTempId(),a=r.from||this.getDefaultFromInfo(e),o=r.body||r.decoded||"";""===o&&(o=this.createSignature(a.email));var s,c,l={id:i,modifiedOffline:!0,labelIds:[Yr.DRAFT],messageID:void 0,raw:"",decoded:o,mimeType:Xi,contentType:$i,from:a,replyTo:this.getReplyToAddress(a.email),to:r.to||[],cc:r.cc||[],bcc:r.bcc||[],snippet:"",subject:r.subject||"",date:new Date,references:void 0,inReplyTo:void 0,resources:{}};if(t){s=this.getCacheData(t);try{_.Z.PAssert(677,n,"When supplying a thread ID, must also supply a valid message ID")}catch(p){_.Z.reportError(p)}var u=s.messages.indexOfWithProperty("id",n);try{_.Z.PAssert(678,u>=0,"If requesting a reply to a message, it must exist in the thread")}catch(p){_.Z.reportError(p)}var d=s.messages[u];if(d&&(l.references=(_.Z.isTempId(d.messageID)?"":d.messageID)+(d.references?" "+d.references:""),_.Z.isTempId(d.messageID)||(l.inReplyTo=d.messageID),l.resources=this._getInlineResources(d)),s.messages.splice(u+1,0,l),this.hasAttachment(t)){var h=this.getAttachment(t);this._updateAttachmentFromMessages(h,w.Z.ChangeType.Local),h.notifyDataMutated(["messages"],w.Z.ChangeType.Local)}this.addModifiedOffline(s,["messages"]),c=s}else s={id:i,accountID:e,modifiedOffline:!0,messages:[l],labelIds:[Yr.DRAFT],subject:r.subject||"",from:e},c=this.createEntryFromLocal(i,s),this.cacheData(c.id,c);return this.cacheThreadData(c.id,this.serializeExternalData(c)),{threadID:c.id,draftID:i,messageID:n}}},{key:"_updateDraftID",value:function(e,t,n){try{_.Z.PAssert(679,n,"Must provide a valid set of draft info")}catch(o){_.Z.reportError(o)}try{_.Z.PAssert(680,n.id&&n.message,"Draft info must contain valid data")}catch(o){_.Z.reportError(o)}var r=e.isLocalOnlyAttachment();if(r){var i=this.getCacheData(e.id);this._handleThreadLabelUpdates(i,void 0,i.labelIds),this.changeID(e,e.id,n.message.threadId),this._threadCache.removeEntry(t)}var a=this._findDraft(e,t,n.id);if(a){a.id=n.message.id;try{_.Z.PAssert(681,a.draftID===n.id,"Should have valid draft ID associated with the message")}catch(o){_.Z.reportError(o)}this._draftCache[a.id]=n.id,r&&this.cacheData(e.id,e.getData()),this._pendingDraftUpdates[t]&&(this._pendingDraftUpdates[a.id]=this._pendingDraftUpdates[t],delete this._pendingDraftUpdates[t]),this._pendingSends[t]&&(this._pendingSends[a.id]=this._pendingSends[t],delete this._pendingSends[t]),e.notifyDataMutated(["messages"],w.Z.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(e.getData()))}}},{key:"_updateDraftFromSend",value:function(e,t,n){try{_.Z.PAssert(682,n,"Must provide a valid set of draft info")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(683,n.id&&n.threadId,"Draft info must contain valid data")}catch(i){_.Z.reportError(i)}if(e.isLocalOnlyAttachment()){this._handleThreadLabelUpdates(e.getData(),void 0,e.getData().labelIds),this.changeID(e,e.id,n.threadId);try{_.Z.PAssert(684,!_.Z.isTempId(e.id),"After an ID change, should never be a temp ID")}catch(i){_.Z.reportError(i)}this._threadCache.removeEntry(t)}var r=this._getMessageFromAttachment(e,t);r.id=n.id,r.labelIds=n.labelIds||[],this._updateAttachmentFromMessages(e,w.Z.ChangeType.Remote),this._draftCache[r.id]=n.id,this._pendingDraftUpdates[t]&&(this._pendingDraftUpdates[r.id]=this._pendingDraftUpdates[t],delete this._pendingDraftUpdates[t]),this._pendingSends[t]&&(this._pendingSends[r.id]=this._pendingSends[t],delete this._pendingSends[t]),e.notifyDataMutated(["messages"],w.Z.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(e.getData()))}},{key:"_createRemoteDraft",value:function(e,t,n){var r=this;if(this._creatingDrafts[t])n(!1,{msg:"Already creating remote draft for given message"});else{this._creatingDrafts[t]=!0;var i=this._getMessageFromAttachment(e,t);if(i)this._createRFC822Message(e.getData(),i,!1,(function(a){var o={raw:a};e.isLocalOnlyAttachment()||(o.threadId=e.id);var s=$t.Z.fns("gmail").users.drafts.create.packedFn,c={userId:e.getField("accountID"),resource:{message:o}};r._queueRemoteRequestMulti(e.getField("accountID"),s,c,(function(a){r._attachmentHasMessage(e,t)&&(delete r._creatingDrafts[t],i.draftID=a.id,r.removeModifiedOffline(e.getData(),!1),r.removeModifiedOffline(i,!1),r._pendingDraftUpdates[t]&&r._notifyPendingDraftUpdate(),r._updateDraftID(e,t,a),r._updateIsSavingDrafts()),n(!0)}),(function(i){delete r._creatingDrafts[t],r._updateIsSavingDrafts(),n(!1,i),r._notifyFailedRequest(e.getField("accountID"),i)}),void 0,ki,{noBatch:!0})}));else{try{var a={length:e.getField("messages").length};_.Z.reportError(new Error("Unable to find valid draft for creation"),a)}catch(o){_.Z.reportError(o)}n(!1,{msg:"Unable to find requested message in thread"})}}}},{key:"_updateIsSavingDrafts",value:function(){_.Z.isSavingDrafts=this._activeDraftUpdates>0||!_.Z.isEmpty(this._pendingDraftUpdates)||!_.Z.isEmpty(this._creatingDrafts)}},{key:"_notifyPendingDraftUpdate",value:function(e,t,n,r){e&&t&&(this._pendingDraftUpdates[t]={attach:e,draftID:n,lastUpdate:Date.now()},r&&this._runDraftUpdate(t)),this._draftFlushTimer&&clearTimeout(this._draftFlushTimer),this._draftFlushTimer=setTimeout(this._flushPendingDraftUpdates,12e3),this._updateIsSavingDrafts()}},{key:"_flushPendingDraftUpdates",value:function(){if(this.isOnline()){for(var e in this._pendingDraftUpdates)this._pendingDraftUpdates.hasOwnProperty(e)&&this._runDraftUpdate(e);this._draftFlushTimer=void 0}}},{key:"_runDraftUpdate",value:function(e){var t=this;if(!this._creatingDrafts[e]){var n=this._pendingDraftUpdates[e];try{_.Z.PAssert(685,n,"Must be able to find valid draft info for pending draft update")}catch(r){_.Z.reportError(r)}this._updateRemoteDraft(n.attach,e,n.draftID,!1,(function(e,n){e||_.Z.isHTTPStatusCode(n,w.Z.HTTPStatusCode.NotFound)?_o.toasts.clearMessage(w.Z.MessageID.EmailUpdateFail):_o.toasts.pushMessage(w.Z.MessageID.EmailUpdateFail),t._updateIsSavingDrafts()})),delete this._pendingDraftUpdates[e],this.sendEvent("UpdateDraft")}}},{key:"_clearPendingDraftUpdate",value:function(e,t){var n=this._pendingDraftUpdates[t];if(n){try{_.Z.PAssert(686,n.attach===e,"Must have the correct attachment for the draft update")}catch(r){_.Z.reportError(r)}delete this._pendingDraftUpdates[t]}}},{key:"hasPendingSends",value:function(){return Object.keys(this._pendingSends).length>0}},{key:"notifyPendingSend",value:function(e,t){try{_.Z.PAssert(687,!this._pendingSends[t],"Must not have an already pending send for a message")}catch(n){_.Z.reportError(n)}this._pendingSends[t]=e,_.Z.isSendingEmail=!0}},{key:"notifySent",value:function(e,t){try{_.Z.PAssert(688,this._pendingSends[t],"Must have a pending send to be sent")}catch(n){_.Z.reportError(n)}delete this._pendingSends[t],this.hasPendingSends()||(_.Z.isSendingEmail=!1)}},{key:"notifySendError",value:function(e,t){try{_.Z.PAssert(689,this._pendingSends[t],"Must have a pending send to have an error")}catch(n){_.Z.reportError(n)}delete this._pendingSends[t],this.hasPendingSends()||(_.Z.isSendingEmail=!1)}},{key:"onShutdown",value:function(){clearTimeout(this._draftFlushTimer),this._draftFlushTimer=void 0,this._flushPendingDraftUpdates(),this._updateIsSavingDrafts()}},{key:"_getLinkedResources",value:function(e){var t=[];return _.Z.forEachValue(e,(function(e){"attachment"===e.disposition&&e.link&&t.push(e)})),t}},{key:"_createDraftBody",value:function(e,t){var n;if(t){var r=this._getLinkedResources(t);if(r.length>0){for(var i=0,a="<br/><br/>",o=0;o<r.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a+=this._getLinkedResourceString(r[o])}n=e+'<var id="moodoAttach" moodoAttach="true">'+a+"</var>"}else n=e}else n=e;return n}},{key:"updateDraft",value:function(e,t,n,r,i,a,o){try{_.Z.PAssert(690,_.Z.isBoolean(i),"Must supply a valid bool for updateRemoteDraft")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(691,_.Z.isBoolean(a),"Must supply a valid bool for forceFlush")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(692,_.Z.isFunction(o),"Must supply a valid bool for cb")}catch(c){_.Z.reportError(c)}var s=this._findDraft(e,t,n);if(s)return s.to=r.to,s.from=r.from||s.from,s.cc=r.cc,s.bcc=r.bcc,s.subject=r.subject,s.decoded=this._createDraftBody(r.decoded,s.resources),s.snippet=r.snippet?_.Z.escape(r.snippet.substring(0,60)):"",s.modifiedOffline=!0,r.hasOwnProperty("resources")&&(s.resources=r.resources),this._updateAttachmentFromMessages(e,w.Z.ChangeType.Local),e.notifyDataMutated(["messages"],w.Z.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(this.getCacheData(e.id))),!this._creatingDrafts[s.id]&&i?_.Z.isTempId(s.id)?this._createRemoteDraft(e,s.id,(function(e,t){e||_o.toasts.pushMessage(w.Z.MessageID.EmailUpdateFail),o(e,t)})):(this._notifyPendingDraftUpdate(e,s.id,s.draftID,a),o(!0)):(i&&this._notifyPendingDraftUpdate(e,s.id,s.draftID,a),o(!0)),this._updateIsSavingDrafts(),{threadID:e.id,draftID:s.draftID,messageID:s.id};try{_.Z.PAssert(693,!1,"Unable to update draft as expected from compose window")}catch(c){_.Z.reportError(c)}o(!1)}},{key:"_updateRemoteDraft",value:function(e,t,n,r,i){var a=this;try{_.Z.PAssert(694,t&&n,"Must specify both a valid messageID and draftID"+t+"."+n)}catch(s){_.Z.reportError(s)}var o=this._findDraft(e,t,n);try{_.Z.PAssert(695,o&&o.labelIds.indexOf(Yr.DRAFT)>=0,"Must be updating a valid draft"+!!o)}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(696,!this._creatingDrafts[o.id],"Should not send a remote update while the original draft is being created")}catch(s){_.Z.reportError(s)}this._activeDraftUpdates++,this._getRemoteDraftID(e.getField("accountID"),e.id,o.id,(function(t){if(t)a._createRFC822Message(e.getData(),o,r,(function(n){var r=$t.Z.fns("gmail").users.drafts.update.packedFn,s={userId:e.getField("accountID"),id:t,resource:{message:{raw:n,threadId:e.id}}};a._queueRemoteRequestMulti(e.getField("accountID"),r,s,(function(t){a._updateDraftID(e,o.id,t),a._activeDraftUpdates--,i(t)}),(function(t){i(void 0,t),a._activeDraftUpdates--,a._notifyFailedRequest(e.getField("accountID"),t)}),void 0,_i)}));else{try{_.Z.PAssert(697,!1,"Must always be able to get a valid draft ID when updating")}catch(s){_.Z.reportError(s)}i(!1)}}))}},{key:"sendDraft",value:function(e,t,n,r,i){var a=this;try{_.Z.PAssert(698,!e.getField("pendingSend"),"Should not try to re-send a message after it has already been sent")}catch(h){_.Z.reportError(h)}var o=!0,s=this._findDraft(e,t,n),c=function(t,n){t?(e.updateField("pendingSend",!1),a.removeModifiedOffline(e.getData(),!1),a.removeModifiedOffline(s,!1),a.notifySent(e,s.id)):(_.Z.isHTTPStatusCode(n,w.Z.HTTPStatusCode.Network)||e.updateField("pendingSend",!1),a.notifySendError(e,s.id)),i(t,n)},l=this._verifyEmailRecipients(e,s.id,s.draftID);if(l||(l=this._verifyEmailAttachments(e,s.id,s.draftID)),l){o=!1;var u=_o.toasts.pushMessage({text:l.message,action:w.Z.MessageAction.Okay});l.handleMessageFn&&l.handleMessageFn(u),this.notifyPendingSend(e,s.id),c(!1)}else if(!r){e.updateField("pendingSend",!0),this.notifyPendingSend(e,s.id);var d=!1;this.onEmailReadyToSend(s,(function(){try{_.Z.PAssert(699,!d,"Should not send an email twice")}catch(h){_.Z.reportError(h)}d||(d=!0,e.isLocalOnlyAttachment()||_.Z.isTempId(s.id)?a._sendEmail(e,s.id,s.draftID,c):a._sendRemoteDraft(e,s.id,c))}))}return o}},{key:"onEmailReadyToSend",value:function(e,t){var n=this,r=!0;_.Z.forEachValue(e.resources,(function(i){if(i.uploader&&!i.uploader.isDone())if(r=!1,i.uploader.hasError())try{_.Z.PAssert(700,!1,"Attachment has error when sending.")}catch(a){_.Z.reportError(a)}else i.uploader.notifyOnComplete(n.onEmailReadyToSend.bind(n,e,t))})),r&&setTimeout(t,0)}},{key:"_sendRemoteDraft",value:function(e,t,n){var r=this;this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(e,t),this._getRemoteDraftID(e.getField("accountID"),e.id,t,(function(i){if(i)r._updateRemoteDraft(e,t,i,!0,(function(t){if(t&&t.message){var a=$t.Z.fns("gmail").users.drafts.send.packedFn,o={userId:e.getField("accountID"),resource:{id:i}};r._queueRemoteRequestMulti(e.getField("accountID"),a,o,(function(i){r._updateLocalDraftFromSend(e,t.message.id,i,n)}),(function(t){r._notifySendFailed(),n(!1,t),r._notifyFailedRequest(e.getField("accountID"),t)}),void 0,wi)}else _o.toasts.pushMessage(w.Z.MessageID.EmailUpdateFail),n(!1)}));else{try{_.Z.PAssert(701,!1,"Must always be able to get a valid draft ID when sending")}catch(a){_.Z.reportError(a)}_o.toasts.pushMessage(w.Z.MessageID.EmailUpdateFail),n(!1)}}))}},{key:"_updateLocalDraftFromSend",value:function(e,t,n,r){try{_.Z.PAssert(702,n,"Must have a valid draft result")}catch(a){_.Z.reportError(a)}var i=this._getMessageFromAttachment(e,t);try{_.Z.PAssert(703,i,"Must always be able to find the sent message")}catch(a){_.Z.reportError(a)}i&&(this.removeModifiedOffline(e.getData(),!1),this.removeModifiedOffline(i,!1),this._updateDraftFromSend(e,t,n)),_.Z.isDemoMode()||this._requestRemoteMessageData(e,n.id,(function(e){try{_.Z.PAssert(704,e,"Should always be able to update message data after send")}catch(a){_.Z.reportError(a)}})),r(!0)}},{key:"runDiscardDraft",value:function(e){var t=this._getDraftFromAttachment(e);this.discardDraft(e,t.id,t.draftID,(function(e){try{_.Z.PAssert(705,e,"Must be able to discard message draft")}catch(t){_.Z.reportError(t)}}))}},{key:"discardDraft",value:function(e,t,n,r){var i=e.getData(),a=this._findDraft(e,t,n),o=i.messages.indexOf(a);_.Z.isTempId(t)?r(!0):this._deleteRemoteDraft(e,t,r);var s=i.messages[o];i.messages.splice(o,1),this._removeRemoteResources(s),this._updateAttachmentFromMessages(e,w.Z.ChangeType.Local),this._clearPendingDraftUpdate(e,t),e.notifyDataMutated(["messages"],w.Z.ChangeType.Local),this.cacheThreadData(i.id,this.serializeExternalData(i)),this.sendEvent("DiscardDraft")}},{key:"_removeRemoteResources",value:function(e){e&&_.Z.forEachValue(e.resources,(function(e){e.uploader&&!e.uploader.isDone()&&e.uploader.cancel()}))}},{key:"_deleteRemoteDraft",value:function(e,t,n){var r=this;try{_.Z.PAssert(706,!_.Z.isTempId(t),"Should not try to remotely delete a local message")}catch(i){_.Z.reportError(i)}this._getRemoteDraftID(e.getField("accountID"),e.id,t,(function(t){if(t){var a=$t.Z.fns("gmail").users.drafts.delete.packedFn,o={userId:e.getField("accountID"),id:t};r._queueRemoteRequestMulti(e.getField("accountID"),a,o,(function(){n(!0)}),(function(t){_.Z.isHTTPStatusCode(t,w.Z.HTTPStatusCode.NotFound)?n(!0):n(!1,t),r._notifyFailedRequest(e.getField("accountID"),t)}),void 0,Zi)}else{try{_.Z.PAssert(707,!1,"Must always be able to get a valid draft ID when deleting")}catch(i){_.Z.reportError(i)}_o.toasts.pushMessage(w.Z.MessageID.EmailUpdateFail),n(!1)}}))}},{key:"_getRemoteDraftIDRaw",value:function(e,t,n,r){var i=$t.Z.fns("gmail").users.drafts.list.packedFn,a={userId:e,q:"rfc822msgid:"+t};this._queuePagedRemoteRequestMulti(e,i,a,n,r,void 0,bi,{getAllPages:!0,resultsField:"drafts"})}},{key:"_getRemoteDraftID",value:function(e,t,n,r){var i=this;try{_.Z.PAssert(708,_.Z.isString(e),"Must provide a valid accountID")}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(709,_.Z.isString(t)&&!_.Z.isTempId(t),"Should not try to remotely get the draft ID of a local thread: ",t)}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(710,_.Z.isString(n)&&!_.Z.isTempId(n),"Should not try to remotely get the draft ID of a local draft: ",n)}catch(s){_.Z.reportError(s)}var a=this.getAttachment(t);try{_.Z.PAssert(711,a,"Must be able to find a valid attachment for the requested thread")}catch(s){_.Z.reportError(s)}if(!a)return setTimeout(r,0,void 0,!1);var o=this._getMessageFromAttachment(a,n);try{_.Z.PAssert(712,o,"Must be able to find a valid message for the requested draft")}catch(s){_.Z.reportError(s)}if(!o)return setTimeout(r,0,void 0,!1);if(o.draftID)setTimeout(r,0,o.draftID,!1);else{try{_.Z.PAssert(713,o.messageID&&!_.Z.isTempId(o.messageID),"Must have a valid messageID for the draft being queried")}catch(s){_.Z.reportError(s)}if(!o.messageID||_.Z.isTempId(o.messageID))return setTimeout(r,0,void 0,!1);this._getRemoteDraftIDRaw(e,o.messageID,(function(c){try{_.Z.PAssert(714,c&&c.length<=1,"Must find only a single draft ID for a given message: ",c.length,o.messageID)}catch(s){_.Z.reportError(s)}if(c){for(var l=0,u=0;u<c.length;++u){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=c[u];if(1===c.length||d.message.threadId===t){try{_.Z.PAssert(715,!o.draftID||o.draftID===d.id,"Draft ID must either match or not be known yet")}catch(s){_.Z.reportError(s)}o.draftID=d.id}}try{_.Z.PAssert(716,0===c.length||o.draftID,"Draft returned but IDs dont match: ",c[0]?c[0].message.threadId:"NO RESULT",t,c[0]?c[0].message.id:"NO RESULT",n)}catch(s){_.Z.reportError(s)}}return o.draftID?r(o.draftID,!0):o.contentType&&o.mimeType&&o.decoded?void i._createRemoteDraft(a,o.id,(function(n,a){return n?r(o.draftID,!0):(_.Z.isHTTPStatusCode(a,w.Z.HTTPStatusCode.NotFound)&&i._deleteCachedThread(e,t),r(void 0,!1))})):r(void 0,!1)}),(function(t){return i._notifyFailedRequest(e,t),r(void 0,!1)}))}}},{key:"_attachmentHasMessage",value:function(e,t){return e.getField("messages").indexOfWithProperty("id",t)>=0}},{key:"_getMessageFromAttachment",value:function(e,t){var n=e.getField("messages"),r=n.indexOfWithProperty("id",t);try{_.Z.PAssert(717,r>=0,"Must have a vald draft")}catch(i){_.Z.reportError(i)}return n[r]}},{key:"_getDraftFromAttachment",value:function(e,t){for(var n,r=0,i=e.getField("messages"),a=0;a<i.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i[a].labelIds.indexOf(Yr.DRAFT)>=0){t&&t!==i[a].draftID||(n=i[a]);break}}return n}},{key:"_findDraft",value:function(e,t,n){var r,i=e.getField("messages"),a=i.indexOfWithProperty("id",t);if(a>=0)r=i[a];else if(n){var o=i.indexOfWithProperty("draftID",n);o>=0&&(r=i[o])}try{_.Z.PAssert(718,r,"Must be able to find a valid draft for given messageID/draftID")}catch(s){_.Z.reportError(s)}return r}},{key:"isAttachmentDraftOnly",value:function(e){return!this.shouldUseNewEmailPlugin(e)&&this.attachmentHasLabel(e,Li.DRAFT)&&1===e.getField("messages").length}},{key:"archiveAttachment",value:function(e){try{_.Z.PAssert(719,!this.attachmentIsArchived(e),"Should not archive a thread that is already archived")}catch(t){_.Z.reportError(t)}return this.sendEvent("ArchiveMail"),this.removeLabelFromAttachment(e,Li.INBOX)}},{key:"unarchiveAttachment",value:function(e){try{_.Z.PAssert(720,this.attachmentIsArchived(e),"Thread must be unarchived to archive it")}catch(t){_.Z.reportError(t)}return this.sendEvent("UnarchiveMail"),this.addLabelToAttachment(e,Li.INBOX)}},{key:"trashAttachment",value:function(e){return this.sendEvent("TrashMail"),this.trashMail(e.getField("accountID"),e.id,void 0,(function(e){try{_.Z.PAssert(721,e,"Must have successfully trashed remote thread")}catch(t){_.Z.reportError(t)}}))}},{key:"untrashAttachment",value:function(e){return this.sendEvent("UntrashMail"),this.untrashMail(e.getField("accountID"),e.id,void 0,(function(e){try{_.Z.PAssert(722,e,"Must have successfully untrashed remote thread")}catch(t){_.Z.reportError(t)}}))}},{key:"markAttachmentRead",value:function(e){return this.sendEvent("MarkMailRead"),this.removeLabelFromAttachment(e,Li.UNREAD)}},{key:"markAttachmentUnread",value:function(e){return this.sendEvent("MarkMailUnread"),this.addLabelToAttachment(e,Li.UNREAD)}},{key:"snoozeAttachment",value:function(e,t){}},{key:"unsnoozeAttachment",value:function(e){this.sendEvent("UnsnoozeThread"),this.removeLabelFromAttachment(e,"Moo.do/Snoozed"),this.addLabelToAttachment(e,Li.INBOX),this.addLabelToAttachment(e,Li.UNREAD),this.cancelDeferredTask(e.id,ai)}},{key:"_handleDeferredSnoozeTask",value:function(e){}},{key:"scheduleSendMessage",value:function(e,t,n){}},{key:"cancelSendMessage",value:function(e,t){var n=this;this.sendEvent("UnscheduleMail"),this.removeLabelFromAttachment(e,"Moo.do/ScheduledSend"),this._getRemoteDraftID(e.getField("accountID"),e.id,t,(function(e){e&&n.cancelDeferredTask(e,oi)}))}},{key:"_handleDeferredSendMailTask",value:function(e){var t=e.getData();try{_.Z.PAssert(725,t.gidLinked,"Must have valid gidLinked")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(726,t.threadID,"Must have a valid threadID")}catch(n){_.Z.reportError(n)}_.Z.log("Handling deferred send mail: ",t)}},{key:"_ensureNoPriority",value:function(e){var t=w.Z.VMLIFlag.None;return this.attachmentHasLabel(e,Ri.PRI1)&&(this.removeLabelFromAttachment(e,Ri.PRI1),t=w.Z.VMLIFlag.P1),this.attachmentHasLabel(e,Ri.PRI2)&&(this.removeLabelFromAttachment(e,Ri.PRI2),t=w.Z.VMLIFlag.P2),this.attachmentHasLabel(e,Ri.PRI3)&&(this.removeLabelFromAttachment(e,Ri.PRI3),t=w.Z.VMLIFlag.P3),t}},{key:"getAttachmentPriority",value:function(e){return this._attachmentHasPriorityLabel(e,w.Z.VMLIFlag.P1)&&w.Z.VMLIFlag.P1||this._attachmentHasPriorityLabel(e,w.Z.VMLIFlag.P2)&&w.Z.VMLIFlag.P2||this._attachmentHasPriorityLabel(e,w.Z.VMLIFlag.P3)&&w.Z.VMLIFlag.P3||w.Z.VMLIFlag.None}},{key:"setAttachmentPriority",value:function(e,t){this.sendEvent("SetMailPriority");var n=this._ensureNoPriority(e);switch(t){case w.Z.VMLIFlag.None:break;case w.Z.VMLIFlag.P1:this.addLabelToAttachment(e,Ri.PRI1);break;case w.Z.VMLIFlag.P2:this.addLabelToAttachment(e,Ri.PRI2);break;case w.Z.VMLIFlag.P3:this.addLabelToAttachment(e,Ri.PRI3);break;default:try{_.Z.PAssert(727,!1,"Invalid priority for email attachment")}catch(r){_.Z.reportError(r)}}return n}},{key:"markAttachmentStarred",value:function(e){return this.sendEvent("StarMail"),this.addLabelToAttachment(e,Li.STARRED)}},{key:"markAttachmentUnstarred",value:function(e){return this.sendEvent("UnstarMail"),this.removeLabelFromAttachment(e,Li.STARRED)}},{key:"attachmentHasLabelByID",value:function(e,t){return this.hasLabelByID(e.getField("accountID"),e.id,void 0,t)}},{key:"attachmentHasLabel",value:function(e,t){return this.hasLabel(e.getField("accountID"),e.id,void 0,t)}},{key:"attachmentHasFullLabel",value:function(e,t){return this.hasFullLabel(e.getField("accountID"),e.id,t)}},{key:"attachmentIsArchived",value:function(e){return this._threadIsArchived(e.getData())}},{key:"addLabelToAttachment",value:function(e,t){return this.addLabel(e.getField("accountID"),e.id,void 0,t)}},{key:"removeLabelFromAttachment",value:function(e,t){return this.removeLabel(e.getField("accountID"),e.id,void 0,t)}},{key:"trashMail",value:function(e,t,n,r){var i=this.getAttachment(t);if(this.isAttachmentDraftOnly(i)){var a=i.getField("messages")[0];this.discardDraft(i,a.id,a.draftID,r)}else this.removeLabelsFromMessage(e,t,n,[Yr.INBOX],w.Z.ChangeType.Local),this.addLabelsToMessage(e,t,n,[Yr.TRASH],w.Z.ChangeType.Local),_.Z.isTempId(t)?r(!0):this._trashRemoteMail(e,t,n,r)}},{key:"untrashMail",value:function(e,t,n,r){this.removeLabelsFromMessage(e,t,n,[Yr.TRASH],w.Z.ChangeType.Local),_.Z.isTempId(t)?(this.addLabelsToMessage(e,t,n,[Yr.INBOX],w.Z.ChangeType.Local),r(!0)):(this.addLabel(e,t,n,Li.INBOX),this._untrashRemoteMail(e,t,n,r))}},{key:"moveItem",value:function(e,t,n){return n.insertItem(t,0),[t,n]}},{key:"unmoveItem",value:function(e,t,n){return n.removeChild(t,w.Z.ChangeType.Local),[t,n]}},{key:"hasLabelByID",value:function(e,t,n,r){try{_.Z.PAssert(728,!n,"We don't support individual queries on messages, only threads")}catch(i){_.Z.reportError(i)}return this.getAttachment(t).getField("labelIds").indexOf(r)>=0}},{key:"hasLabel",value:function(e,t,n,r){try{_.Z.PAssert(729,!n,"We don't support individual queries on messages, only threads")}catch(o){_.Z.reportError(o)}var i=!1;if(!n){var a=this._getLabelByName(e,r,!0);a&&(i=this.hasLabelByID(e,t,n,a.getLabelID()))}return i}},{key:"hasFullLabel",value:function(e,t,n){var r=!1,i=this.getCacheData(t),a=this._getLabelByName(e,n,!0);if(a&&i){var o=0,s=i.messages;r=!0;for(var c=0;c<s.length;++c){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(!s[c].labelIds||s[c].labelIds.indexOf(a.getLabelID())<0){r=!1;break}}}return r}},{key:"hasLabelLike",value:function(e,t,n){var r=!1,i=this.getAttachment(t);if(i){var a=i.getField("labelIds"),o=this._getAccountLib(e,this._labelsByID);if(o)for(var s=0,c=0;c<a.length;++c){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=o[a[c]];l&&l.isMatched(n)&&(r=!0)}}return r}},{key:"addLabel",value:function(e,t,n,r){var i=this;try{_.Z.PAssert(730,!n,"We currently do not support setting labels on single messages")}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(731,!this.hasLabel(e,t,n,r),"Should not add the same label to a thread/message twice")}catch(s){_.Z.reportError(s)}var a=this._getLabelByName(e,r,!0);if(a)a.isLocalOnly()?this._createRemoteLabel(e,r,!1,(function(n){if(n){try{_.Z.PAssert(733,n,"Should have successfully created the remote label")}catch(s){_.Z.reportError(s)}i._changeLabelID(e,a.getLabelID(),n.id),i._modifyRemoteThreadLabels(e,t,[n.id],void 0)}})):this._modifyRemoteThreadLabels(e,t,[a.getLabelID()],void 0);else{var o=_.Z.generateTempId();a=this._ensureLabel(e,o,r,void 0,void 0,w.Z.ChangeType.Local),this._ensureVMLIsForLabel(e,a),this._writeLabelsToCache(),this._createRemoteLabel(e,r,!1,(function(n){try{_.Z.PAssert(732,n,"Should have successfully created the remote label")}catch(s){_.Z.reportError(s)}n&&(i._changeLabelID(e,o,n.id),i._modifyRemoteThreadLabels(e,t,[n.id],void 0))}))}return this.addLabelsToMessage(e,t,n,[a.getLabelID()],w.Z.ChangeType.Local),r}},{key:"removeLabel",value:function(e,t,n,r){try{_.Z.PAssert(734,!n,"We currently do not support setting labels on single messages")}catch(a){_.Z.reportError(a)}var i=this._getLabelByName(e,r);try{_.Z.PAssert(735,i,"Must have valid label for gmail in order to remove")}catch(a){_.Z.reportError(a)}return i&&(i.isLocalOnly()||this._modifyRemoteThreadLabels(e,t,void 0,[i.getLabelID()]),this.removeLabelsFromMessage(e,t,n,[i.getLabelID()],w.Z.ChangeType.Local)),r}},{key:"_threadIsArchived",value:function(e){if(e){var t=e.labelIds.indexOf(Yr.INBOX)>=0,n=this.hasFullLabel(e.accountID,e.id,Li.TRASH),r=e.labelIds.indexOf(Yr.SPAM)>=0,i=this.hasFullLabel(e.accountID,e.id,Li.DRAFT);return!_.Z.isTempId(e.id)&&!t&&!n&&!r&&!i}return!1}},{key:"_trashRemoteMail",value:function(e,t,n,r){var i,a,o=this;try{_.Z.PAssert(736,!_.Z.isTempId(t),"Should not try to trash local only threads")}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(737,!n||!_.Z.isTempId(n),"Should not try to trash local only messages")}catch(s){_.Z.reportError(s)}n?(i=$t.Z.fns("gmail").users.messages.trash.packedFn,a={userId:e,id:n}):(i=$t.Z.fns("gmail").users.threads.trash.packedFn,a={userId:e,id:t});this._queueRemoteRequestMulti(e,i,a,(function(){r(!0)}),(function(t){r(!1,t),o._notifyFailedRequest(e,t)}),void 0,vi)}},{key:"_untrashRemoteMail",value:function(e,t,n,r){var i,a,o=this;try{_.Z.PAssert(738,!_.Z.isTempId(t),"Should not try to untrash local only threads")}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(739,!n||!_.Z.isTempId(n),"Should not try to untrash local only messages")}catch(s){_.Z.reportError(s)}n?(i=$t.Z.fns("gmail").users.messages.untrash.packedFn,a={userId:e,id:n}):(i=$t.Z.fns("gmail").users.threads.untrash.packedFn,a={userId:e,id:t});this._queueRemoteRequestMulti(e,i,a,(function(){r(!0)}),(function(t){r(!1,t),o._notifyFailedRequest(e,t)}),void 0,vi)}},{key:"_createRemoteLabel",value:function(e,t,n,r){var i=this,a=$t.Z.fns("gmail").users.labels.create.packedFn,o={userId:e,resource:{name:t,labelListVisibility:n?"labelHide":"labelShowIfUnread",messageListVisibility:n?"hide":"show"}};this._queueRemoteRequestMulti(e,a,o,(function(e){r&&r(e)}),(function(t){_.Z.isHTTPStatusCode(t,w.Z.HTTPStatusCode.Conflict)?r&&r(void 0,t):(r&&r(void 0,t),i._notifyFailedRequest(e,t))}),void 0,gi)}},{key:"_modifyRemoteThreadLabels",value:function(e,t,n,r,i){var a=this,o=$t.Z.fns("gmail").users.threads.modify.packedFn,s={userId:e,id:t,resource:{addLabelIds:n,removeLabelIds:r}};this._queueRemoteRequestMulti(e,o,s,(function(e){i&&i(e)}),(function(t){i&&i(void 0,t),a._notifyFailedRequest(e,t)}),void 0,mi)}},{key:"_ensureRemoteLabel",value:function(e,t,n,r,i){this._getLabelByName(e,t,!0)?i&&i(!0):(this._ensureLabel(e,_.Z.generateTempId(),t,void 0,void 0,n),this._createRemoteLabel(e,t,r,(function(e,t){try{_.Z.PAssert(740,e||_.Z.isHTTPStatusCode(t,w.Z.HTTPStatusCode.Conflict),"Should have successful root label creation")}catch(n){_.Z.reportError(n)}i&&i(!!e)})))}},{key:"_createInMemoryLabel",value:function(e,t,n,r,i,a){var o=new Rr(e,t,n,this._clampSyncTime(r),i,a);a[t]=o,this._ensureAccountLib(e,this._labelsByName)[n]=o}},{key:"_updateLabelName",value:function(e,t){var n=e.getAccountID(),r=this._getAccountLib(n,this._labelsByName);try{_.Z.PAssert(741,r,"Must have valid label name bucket")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(742,r[e.getRawName()],"Must have valid label in bucket")}catch(i){_.Z.reportError(i)}e.updateLabelName(t),delete r[e.getRawName()],r[t]=e}},{key:"_ensureLabel",value:function(e,t,n,r,i,a){try{_.Z.PAssert(743,t.length>3,"Label ID should be longer than a couple of chars")}catch(c){_.Z.reportError(c)}var o=this._ensureAccountLib(e,this._labelsByID);if(o[t])!_.Z.isRemoteChange(a)&&o[t].hasName()||o[t].isSystemLabel()||this._updateLabelName(o[t],n);else{var s=this._getLabelByName(e,n,!0);if(null!==s&&void 0!==s&&s.isLocalOnly()&&!_.Z.isTempId(t))this._changeLabelID(e,s.getLabelID(),t);else{try{_.Z.PAssert(745,n||!_.Z.isTempId(t),"All local labels must have a valid name")}catch(c){_.Z.reportError(c)}this._createInMemoryLabel(e,t,n,r,i,o)}}return o[t]}},{key:"_clampSyncTime",value:function(e){return e&&e.isBefore(this._getMetadataSyncTime())?this._getMetadataSyncTime():e}},{key:"_ensureLabelVMLIsForAccount",value:function(e){var t=this._getAccountLib(e,this._labelsByID);for(var n in t)t.hasOwnProperty(n)&&this._ensureVMLIsForLabel(e,t[n])}},{key:"_changeLabelID",value:function(e,t,n){var r=this._getLabelByID(e,t);_o.PaneUpdateBatcher.beginUpdateItems(),null===r||void 0===r||r.updateLabelID(n),this._getAccountLib(e,this._labelsByID)[n]=r,this._ensureVMLIsForLabel(e,r),_o.PaneUpdateBatcher.commitUpdateItems(),this.forEachAttachment((function(e){var r=e.getField("labelIds");if(r.remove(t)>=0){for(var i=0,a=e.getField("messages"),o=0;o<a.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a[o].labelIds.remove(t)>=0&&a[o].labelIds.push(n)}r.push(n),e.updateField("labelIds",r)}}));var i=this.getDefaultItemStore(),a=this.getItemIDForAccountID(e,"L")+"~"+t;i.hasItem(a)&&i.destroyItem(a)}},{key:"labelExists",value:function(e,t){var n=this._getAccountLib(e,this._labelsByID);return n&&n[t]}},{key:"_getLabelByID",value:function(e,t){try{_.Z.PAssert(746,e,"Must supply a valid accountID")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(747,t,"Must supply a valid labelID")}catch(i){_.Z.reportError(i)}var n=this._ensureAccountLib(e,this._labelsByID);if(!n[t]){var r=Li[t];r&&this._createInMemoryLabel(e,t,r,void 0,void 0,n)}return n[t]}},{key:"_getLabelByName",value:function(e,t,n){try{_.Z.PAssert(748,this.hasSyncAccount(e),"Must provide a valid accountID with a matching sync account: "+e)}catch(a){_.Z.reportError(a)}var r,i=this._getAccountLib(e,this._labelsByName);try{_.Z.PAssert(749,n||i,"Unable to find labelsByName for given account: "+e)}catch(a){_.Z.reportError(a)}return i&&(r=i[t]),r}},{key:"_getPriorityLabel",value:function(e,t){var n=this._ensureAccountLib(e,this._priorityLabels);if(!n[t]){var r;switch(t){case w.Z.VMLIFlag.P1:r=Ri.PRI1;break;case w.Z.VMLIFlag.P2:r=Ri.PRI2;break;case w.Z.VMLIFlag.P3:r=Ri.PRI3;break;default:try{_.Z.PAssert(750,!1,"Invalid priority for email attachment")}catch(i){_.Z.reportError(i)}}n[t]=this._getLabelByName(e,r)}return n[t]}},{key:"_getAccountLib",value:function(e,t){try{_.Z.PAssert(751,e,"Must provide valid accountID")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(752,t,"Must provide valid lib object")}catch(i){_.Z.reportError(i)}var n;if(e)if(t[e])n=t[e];else for(var r in t)r.toLowerCase()===e.toLowerCase()&&(n=t[r]);return n}},{key:"_ensureAccountLib",value:function(e,t){try{_.Z.PAssert(754,e,"Must provide valid accountID")}catch(i){_.Z.reportError(i)}try{_.Z.PAssert(755,t,"Must provide valid lib object")}catch(i){_.Z.reportError(i)}var n;if(e)if(t[e=e.toLowerCase()])n=t[e];else{for(var r in t)if(t.hasOwnProperty(r))try{_.Z.PAssert(756,!e||!r||r.toUpperCase()!==e.toUpperCase(),"Dupe accountID found with non-matching case: "+e,r)}catch(i){_.Z.reportError(i)}n=t[e]={}}return n}},{key:"_deleteAccountLib",value:function(e,t){try{_.Z.PAssert(757,e,"Must provide valid accountID")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(758,t,"Must provide valid lib object")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(759,t[e],"Trying to delete an account lib that doesnt exist: ",e)}catch(n){_.Z.reportError(n)}delete t[e]}},{key:"_attachmentHasPriorityLabel",value:function(e,t){var n=this._getPriorityLabel(e.getField("accountID"),t);return!!n&&e.getField("labelIds").indexOf(n.getLabelID())>=0}},{key:"getLabels",value:function(e,t,n){var r=[],i=t.toLowerCase(),a=0,o=this._labelsByID[e];for(var s in o)if(o.hasOwnProperty(s)){var c=o[s];if(c.matchesText(i)&&this.isDisplayTag(c)&&r.indexOf(c)<0&&(r.push(c),a++),n&&a>=n)break}return r}},{key:"_writeLabelsToCache",value:function(){var e={};for(var t in this._labelsByID)if(this._labelsByID.hasOwnProperty(t)){e[t]={};var n=this._labelsByID[t];for(var r in n)n.hasOwnProperty(r)&&(e[t][r]=n[r].getSaveData())}this._threadCache.setMetadata(Ei,e)}},{key:"_writeSendAsToCache",value:function(){var e={};this._iterateSendAs((function(t,n){e[t]||(e[t]=[]),e[t].push(n)})),this._threadCache.setMetadata(xi,e)}},{key:"runLabelSync",value:function(){var e=a()(k().mark((function e(t){var n=this;return k().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,_.Z.runSingletonPromise("runLabelSync",(function(){return new Promise((function(e){var t=n.getSyncAccounts(),r=t.length,i=0,a=0,o=function(t,o){if(n.hasSyncAccount(t)){_o.PaneUpdateBatcher.beginUpdateItems();var s={};if(o)for(var c=0,l=0,u=0;u<o.length;++u){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d,h=o[u];s[h.id]=!0,d="system"===h.type&&Li[h.id]?Li[h.id]:h.name,n._ensureLabel(t,h.id,d,void 0,h,w.Z.ChangeType.Remote)}n._ensureLabelVMLIsForAccount(t),n._ensureRemoteLabel(t,Ci,w.Z.ChangeType.Local,!0),n._ensureRemoteLabel(t,Ri.PRI1,w.Z.ChangeType.Local,!0),n._ensureRemoteLabel(t,Ri.PRI2,w.Z.ChangeType.Local,!0),n._ensureRemoteLabel(t,Ri.PRI3,w.Z.ChangeType.Local,!0),n._ensureRemoteLabel(t,Oi,w.Z.ChangeType.Local,!0),n._ensureRemoteLabel(t,"Moo.do/Scheduled",w.Z.ChangeType.Local,!0);var p=n._getAccountLib(t,n._labelsByID);if(p)for(var f in p)if(p.hasOwnProperty(f)){var g=p[f];if(g.isLocalOnly()){try{_.Z.PAssert(760,g.hasName(),"Label must have a valid name to be created on remote")}catch(m){_.Z.reportError(m)}n._createRemoteLabel(t,g.getName(),!1,function(e,n){n&&!n.error&&this._changeLabelID(t,e,n.id)}.bind(n,f))}else 0!==a||s[f]||g.isSystemOrSpecialLabel()||_.Z.isDemoMode()||g.delete()}_o.PaneUpdateBatcher.commitUpdateItems(),n._writeLabelsToCache(),a+i===r&&e()}else e()},s=function(e,t){a++,o(e),n._notifyFailedRequest(e,t)},c=function(e,t){t?(i++,o(e,t.labels)):s(e,t)},l=$t.Z.fns("gmail").users.labels.list.packedFn;t.forEach((function(e){var t={userId:e,timeoutMS:0};n._queueRemoteRequestMulti(e,l,t,c.bind(n,e),s.bind(n,e),void 0,fi)}))}))}));case 2:t&&t();case 3:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDescriptorForItem",value:function(e){try{_.Z.PAssert(762,e,"Must have a valid item to get a description for")}catch(a){_.Z.reportError(a)}var t=this.getAccountIDFromItem(e),n=this._getLabelIDFromItem(e),r={accountID:t,labelID:n,threadID:this._getThreadIDFromItem(e)};if(t&&n){var i=this._getLabelByID(t,n);r.labelName=null===i||void 0===i?void 0:i.getName()}return r}},{key:"handleItemChange",value:function(e,t){var n=this,r=this.getDescriptorForItem(e);if(r.labelID){try{_.Z.PAssert(763,r.accountID,"Must specify a valid accountID")}catch(i){_.Z.reportError(i)}setTimeout((function(){n._getThreadsForLabel(r.accountID,n._getLabelByID(r.accountID,r.labelID),e,!1,(function(e){try{_.Z.PAssert(764,e,"Expected success when querying for remote threads")}catch(i){_.Z.reportError(i)}t&&t()}))}),0)}}},{key:"handleViewModeChange",value:function(e,t){if(t===w.Z.GmailViewMode.Priority){var n=this.getAccountIDFromItem(e);try{_.Z.PAssert(765,n,"Missing Account ID: ",e.id)}catch(o){_.Z.reportError(o)}var r=this._getLabelByName(n,Ri.PRI1);r&&this._getThreadsForLabel(n,r,void 0,!1,(function(e){try{_.Z.PAssert(766,e,"Expected success when querying for remote PRI0 threads")}catch(o){_.Z.reportError(o)}}));var i=this._getLabelByName(n,Ri.PRI2);i&&this._getThreadsForLabel(n,i,void 0,!1,(function(e){try{_.Z.PAssert(767,e,"Expected success when querying for remote PRI1 threads")}catch(o){_.Z.reportError(o)}}));var a=this._getLabelByName(n,Ri.PRI3);a&&this._getThreadsForLabel(n,a,void 0,!1,(function(e){try{_.Z.PAssert(768,e,"Expected success when querying for remote PRI2 threads")}catch(o){_.Z.reportError(o)}}))}}},{key:"_getThreadsForLabel",value:function(e,t,n,r,i){var a=this;try{_.Z.PAssert(769,t,"Must provide a valid label to get thrads for")}catch(u){_.Z.reportError(u)}var o="-in:chats -in:spam label:"+t.getName(),s=t.getOldestSync();_.Z.isDateValid(s)&&(o+=" before:"+Math.floor(s.getTime()/1e3));var c=new Date,l=new Dr((function(t){if(t){var n=a._addRemoteEntry(e,t);n.internalDate.isBefore(c)&&(c=n.internalDate),a.cacheThreadData(n.id,a.serializeExternalData(n))}}),(function(e){t.setOldestSync(c),a._writeLabelsToCache(),i(e)}));this._requestRemoteThreads(e,yi,n,o,r?999:25,void 0,l.getEntryCB(),l.getDoneCB())}},{key:"createOutlinePaneItem",value:function(e,t){for(var n=0,r=t.getItemStore(),i=e.getRawText(),a=e.getAttachmentByPlugin(this.id),o=this.getDisplayTags(a,void 0,!0),s=0;s<o.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;i+=" #"+o[s]}return r.createItem(_.Z.generateTempId(),i,t.id,void 0,w.Z.ChangeType.Local,t.getDocumentOwner())}},{key:"refreshCurrentView",value:function(e){this._forceThreadSync(e)}},{key:"goOnline",value:function(){this._forceThreadSync(this._notifyPendingDraftUpdate)}},{key:"loadInitialData",value:function(){d()(v()(n.prototype),"loadInitialData",this).call(this),_.Z.isDemoMode()&&this._forceThreadSync()}},{key:"_forceThreadSync",value:function(e){this.hasRecurringTask("GmailThreadSync")&&this.getRecurringTask("GmailThreadSync").forceUpdate(e)}},{key:"_forceLabelSync",value:function(e){this.hasRecurringTask("GmailLabelSync")&&this.getRecurringTask("GmailLabelSync").forceUpdate(e)}},{key:"_syncOfflineChanges",value:function(){try{_.Z.PAssert(770,!1,"Currently we do not perform a sync offline step for Gmail changes")}catch(e){_.Z.reportError(e)}this._syncingOfflineChanges||(this._syncingOfflineChanges=!0)}},{key:"_cleanupLocalCaches",value:function(e){var t=this;try{_.Z.PAssert(771,_.Z.isFunction(e),"Must have a valid callback when cleaning local caches")}catch(s){_.Z.reportError(s)}var n=0,r=0,i=+this._getFullSyncTime(),a=this._getUnreadSyncTime(),o=this._getMetadataSyncTime();this._threadCache.getFilterEntries((function(e){if(e&&e.date)return t.getEntryDateAsNumber(e.date)<i})).then((function(i){if(i)for(var s=0,c=0;c<i.length;++c){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var l=i[c],u=!0;if(t.ensureThreadDates(l),!l.date.isBefore(a))for(var d=0,h=0;u&&h<l.messages.length;++h){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var p=l.messages[h];if(t.isPriorityData(p)){u=!1;break}}if(u){var f=0;l.date.isBefore(o)&&(t._threadCache.removeEntry(l.id),n++);for(var g=0;g<l.messages.length;++g){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;var m=l.messages[g];t._rawCache.removeEntry(m.id),r++}}}_.Z.log("Gmail Cache Pruned: ",n,r),e(!1)}))}},{key:"_cleanupRawCache",value:function(e){var t=this;try{_.Z.PAssert(772,_.Z.isFunction(e),"Must have a valid callback when cleaning local caches")}catch(i){_.Z.reportError(i)}var n=0,r=+this._getUnreadSyncTime();this._rawCache.getFilterEntries((function(e){return!e.internalDate||t.getEntryDateAsNumber(e.internalDate)<r})).then((function(r){if(r)for(var i=0,a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[a];t._rawCache.removeEntry(o.id),n++}_.Z.log("Raw Cache Pruned: ",n),e()}))}},{key:"getAccountSetting",value:function(e,t){var n,r=this._getAccountLib(e,this._accountSettings);return r&&(n=r[t]),n}},{key:"setAccountSetting",value:function(e,t,n){var r,i=this._ensureAccountLib(e,this._accountSettings);return r=i[t],i[t]=n,r}},{key:"runSettingsSync",value:function(){var e=this;this._getSettingsSendAs((function(t){for(var n in t)t.hasOwnProperty(n)&&e.setAccountSetting(n,"sendAs",t[n]);e._writeSendAsToCache()}))}},{key:"_getSyncDays",value:function(){var e=this.getSetting(this.Settings.SyncTime);_o.billingManager.isTrialOver()&&(e=w.Z.MaxGmailSyncTime.Free);var t=_o.pluginManager.getCacheSizeRatio();return t<1&&t>0&&(e=Math.round(e*t)),e}},{key:"_getMetadataSyncDays",value:function(){var e=Math.max(this.getSetting(this.Settings.SyncTime),15),t=_o.pluginManager.getCacheSizeRatio();return t<.5&&(e=Math.max(Math.round(e*t),7)),e}},{key:"_getUnreadSyncTime",value:function(){var e=this._getSyncDays();return(new Date).addDays(-1.5*e)}},{key:"_getFullSyncTime",value:function(){var e=this._getSyncDays();return(new Date).addDays(-e)}},{key:"_getMetadataSyncTime",value:function(){var e=this._getMetadataSyncDays();return(new Date).addDays(-e)}},{key:"_getFullSyncTimeStr",value:function(){return this._getSyncDays()+"d"}},{key:"_getMetadataSyncTimeStr",value:function(){return this._getMetadataSyncDays()+"d"}},{key:"runThreadSync",value:function(){var e=a()(k().mark((function e(t){var n,r=this;return k().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,_.Z.runSingletonPromise("runThreadSync",(function(){return new Promise((function(e){var t,n=0,i=0,a=[],o=[],s=function(s,c,l){s?(n++,a.push(c)):(i++,!_.Z.isHTTPStatusCode(l,w.Z.HTTPStatusCode.Network)&&r.isOnline()&&o.push(c)),i+n===t&&(o.length>0?_o.toasts.pushMessage(w.Z.MessageID.EmailSyncFail):_o.toasts.clearMessage(w.Z.MessageID.EmailSyncFail),a.length>0&&r._contentSyncTask.requestRun(),e(0===o.length))},c=!1,l=r._getSyncDays();void 0!==r._lastSyncTime&&r._lastSyncTime<l&&(c=!0,_.Z.log("Forcing full gmail sync")),r._lastSyncTime=l;var u=r._threadCache.getMetadata(Ii),d=r.getSyncAccounts();t=d.length,d.forEach((function(e){var t;if(!c){var n=u?u[e]:void 0;t=n?n.historyID:void 0}r.performThreadSync(e,t,s)}))}))}));case 2:n=e.sent,t&&t(n);case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"syncAllAccountsFull",value:function(e){this._lastSyncTime=0,this.runThreadSync(e)}},{key:"performThreadSync",value:function(e,t,n){t?(Date.now()-this._lastCacheCleanup>_.Z.hours(12)&&(this._lastCacheCleanup=Date.now(),this._cacheCleanup.notifyWorkAvailable()),this._performThreadSyncPartial(e,t,n)):this._performThreadSyncFull(e,n)}},{key:"_performThreadSyncFull",value:function(e,t){var n,r=this,i="-in:chats -in:spam newer_than:"+this._getMetadataSyncTimeStr(),a=this.getDefaultItemStore(),o=this._ensureVMLIsForAccount(e,a);o.clearPaginationToken();var s=new Dr((function(t){if(t&&(!n&&t.historyId&&(n=t.historyId,r.setHistoryID(e,n)),r._shouldCacheThread(t))){var i=r._addRemoteEntry(e,t);r.cacheThreadData(i.id,r.serializeExternalData(i))}}),(function(n){t(n,e)}));this._requestRemoteThreads(e,si,o,i,999,0,s.getEntryCB(),s.getDoneCB()),this.runLabelSync((function(){var t=r._getLabelByName(e,Oi,!0);t&&r._getThreadsForLabel(e,t,void 0,!0,(function(e){try{_.Z.PAssert(773,e,"Expect to be able to get all handled messages")}catch(t){_.Z.reportError(t)}})),r._getThreadsForLabel(e,r._getLabelByID(e,Yr.UNREAD),void 0,!1,(function(e){try{_.Z.PAssert(774,e,"Expect to be able to get all unread messages")}catch(t){_.Z.reportError(t)}}))}))}},{key:"_compactHistoryEntries",value:function(e){for(var t=0,n={messages:{},messagesAdded:{},messagesDeleted:{},labelsAdded:{},labelsRemoved:{}},r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[r],a=0;if(i.messagesAdded){for(var o=0,s=0;s<i.messagesAdded.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var c=i.messagesAdded[s].message,l=n.messagesAdded[c.threadId];l||(l=n.messagesAdded[c.threadId]=[]),l.indexOf(c.id)<0&&l.push(c.id)}a+=i.messagesAdded.length}if(i.messagesDeleted){for(var u=0,d=0;d<i.messagesDeleted.length;++d){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var h=i.messagesDeleted[d].message,p=n.messagesDeleted[h.threadId];p||(p=n.messagesDeleted[h.threadId]=[]),p.indexOf(h.id)<0&&p.push(h.id)}a+=i.messagesDeleted.length}if(i.labelsAdded){for(var f=0,g=0;g<i.labelsAdded.length;++g){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;var m=i.labelsAdded[g].message,v=n.labelsAdded[m.threadId];v||(v=n.labelsAdded[m.threadId]={}),v[m.id]||(v[m.id]=[]),v[m.id].pushOnlyUniques(i.labelsAdded[g].labelIds)}a+=i.labelsAdded.length}if(i.labelsRemoved){for(var y=0,k=0;k<i.labelsRemoved.length;++k){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;var Z=i.labelsRemoved[k].message,w=n.labelsRemoved[Z.threadId];w||(w=n.labelsRemoved[Z.threadId]={}),w[Z.id]||(w[Z.id]=[]),w[Z.id].pushOnlyUniques(i.labelsRemoved[k].labelIds)}a+=i.labelsRemoved.length}try{_.Z.PAssert(775,0===a||a===i.messages.length,"Must have handled all or none of the generic messages")}catch(R){_.Z.reportError(R)}if(0===a)for(var b=0,P=0;P<i.messages.length;++P){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;var S=i.messages[P],D=n.messages[S.threadId];D||(D=n.messages[S.threadId]=[]),D.indexOf(S.id)<0&&D.push(S.id)}}var I={messages:[],messagesAdded:[],messagesDeleted:[],labelsAdded:[],labelsRemoved:[]};for(var E in n.messages)n.messages.hasOwnProperty(E)&&I.messages.push({id:E,msgIDs:n.messages[E]});for(var x in n.messagesAdded)n.messagesAdded.hasOwnProperty(x)&&!n.messages[x]&&I.messagesAdded.push({id:x,msgIDs:n.messagesAdded[x]});for(var C in n.messagesDeleted)n.messagesDeleted.hasOwnProperty(C)&&!n.messages[C]&&I.messagesDeleted.push({id:C,msgIDs:n.messagesDeleted[C]});for(var A in n.labelsAdded)if(n.labelsAdded.hasOwnProperty(A)&&!n.labelsAdded[A])for(var L in n.labelsAdded[A])n.labelsAdded[A].hasOwnProperty(L)&&I.labelsAdded.push({id:A,msgID:L,labelIDs:n.labelsAdded[A][L]});for(var M in n.labelsRemoved)if(n.labelsRemoved.hasOwnProperty(M)&&!n.messages[M])for(var T in n.labelsRemoved[M])n.labelsRemoved[M].hasOwnProperty(T)&&I.labelsRemoved.push({id:M,msgID:T,labelIDs:n.labelsRemoved[M][T]});return I}},{key:"_performThreadSyncPartial",value:function(e,t,n){var r=this,i=$t.Z.fns("gmail").users.history.list.packedFn,a={userId:e,startHistoryId:t},o={getAllPages:!0,maxPageResults:999,resultsField:"history",timeoutMS:0},s=function(e,t){_.Z.log("History Sync Request Failed: ",e,t)};this._queuePagedRemoteRequestMulti(e,i,a,(function(t,i,a){var o;a&&(o=a.historyId,r.setHistoryID(e,o)),_o.PaneUpdateBatcher.beginUpdateItems();var c=r._compactHistoryEntries(t);r._handleCompactHistory(e,c,s),_o.PaneUpdateBatcher.commitUpdateItems(),n(!0,e)}),(function(t){t&&t.error&&t.error.code===w.Z.HTTPStatusCode.NotFound?r._clearCachedData(e,(function(i){i?r.performThreadSync(e,void 0,n):n(!1,e,t)})):(n(!1,e,t),r._notifyFailedRequest(e,t))}),void 0,ci,o)}},{key:"_handleCompactHistory",value:function(e,t,n){for(var r=0,i=0,a=0,o=0,s=0,c=0,l=0;l<t.messages.length;++l){var u=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var d=t.messages[l],h=0;h<d.msgIDs.length;++h){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;this._handleMessageUpdated(e,d.id,d.msgIDs[h],n),c++}}for(var p=0;p<t.messagesAdded.length;++p){var f=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var g=t.messagesAdded[p],m=0;m<g.msgIDs.length;++m){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;this._handleMessageAdded(e,g.id,g.msgIDs[m],n),c++}}for(var v=0;v<t.messagesDeleted.length;++v){var y=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var k=t.messagesDeleted[v],_=0;_<k.msgIDs.length;++_){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;this._handleMessageDeleted(e,k.id,k.msgIDs[_]),c++}}for(var Z=0;Z<t.labelsAdded.length;++Z){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var w=t.labelsAdded[Z];this._handleLabelsAdded(e,w.id,w.msgID,w.labelIDs),c++}for(var b=0;b<t.labelsRemoved.length;++b){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var P=t.labelsRemoved[b];this._handleLabelsRemoved(e,P.id,P.msgID,P.labelIDs),c++}return c}},{key:"_handleMessageAdded",value:function(e,t,n,r){this.refreshThreadCacheData(e,t,n,r)}},{key:"_handleMessageDeleted",value:function(e,t,n){this._deleteCachedMessage(e,t,n)}},{key:"_handleLabelsAdded",value:function(e,t,n,r){this.addLabelsToMessage(e,t,n,r,w.Z.ChangeType.Remote)}},{key:"_handleLabelsRemoved",value:function(e,t,n,r){this.removeLabelsFromMessage(e,t,n,r,w.Z.ChangeType.Remote)}},{key:"_handleMessageUpdated",value:function(e,t,n,r){this.refreshThreadCacheData(e,t,n,r)}},{key:"getLastSyncTime",value:function(e){var t,n=this._threadCache.getMetadata(Ii);if(n){var r=n[e];r&&r.date&&(t=new Date(r.date))}return t}},{key:"getAllLastSyncTimes",value:function(){for(var e=0,t=this._threadCache.getMetadata(Ii),n={},r=this.getSyncAccounts(),i=0;i<r.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=r[i],o=t?t[a]:void 0;o&&o.date?n[a]=new Date(o.date):n[a]=void 0}return n}},{key:"setHistoryID",value:function(e,t){try{_.Z.PAssert(777,_.Z.isString(e),"Must provide a valid account ID to set history ID")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(778,_.Z.isString(t),"Must provide a valid history ID to set")}catch(r){_.Z.reportError(r)}var n=Object.assign({},this._threadCache.getMetadata(Ii));n[e]={historyID:t,date:Date.now()},this._threadCache.setMetadata(Ii,n)}},{key:"clearHistoryID",value:function(e){try{_.Z.PAssert(779,_.Z.isString(e),"Must provide a valid account ID to clear history ID for")}catch(r){_.Z.reportError(r)}var t=this._threadCache.getMetadata(Ii);if(t){t[e];var n=ee()(t,[e].map(Gr));this._threadCache.setMetadata(Ii,n)}}},{key:"clearCachedLabel",value:function(e){try{_.Z.PAssert(780,_.Z.isString(e),"Must provide a valid account ID to clear history ID for")}catch(r){_.Z.reportError(r)}var t=this._threadCache.getMetadata(Ei);if(t){t[e];var n=ee()(t,[e].map(Gr));this._threadCache.setMetadata(Ei,n)}}},{key:"_clearCachedData",value:function(e,t){this.clearHistoryID(e),this.clearCachedLabel(e),this.clearAccountThreadCache(e,t)}},{key:"clearAccountThreadCache",value:function(e,t){var n=this;try{_.Z.PAssert(781,_.Z.isString(e),"Must provide a valid account ID to clear thread cache for")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(782,!t||_.Z.isFunction(t),"Must provide valid CB function when clearing thread cache")}catch(r){_.Z.reportError(r)}this._threadCache.getFilterEntries((function(t){return t.accountID===e})).then((function(r){if(r){var i=0;_.Z.log("Clearing account thread cache: "+e);for(var a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[a];if(n._threadCache.removeEntry(o.id),o.messages)for(var s=0,c=0;c<o.messages.length;++c){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;n._rawCache.removeEntry(o.messages[c].id)}}t&&t(!0)}else t&&t(!1)}))}},{key:"requestDataPage",value:function(e,t){_.Z.log("Data Page: ",e.hasPaginationToken()),e.hasPaginationToken()&&!e.paginationTokenInUse()&&e?this._requestRemoteThreads(void 0,hi,e,void 0,25,void 0,void 0,t):t(!0)}},{key:"_requestRemoteThreads",value:function(e,t,n,r,i,a,o,s){var c=this;this.isLoadingThreads.set(!0);var l,u=function(e){s(e),c.isLoadingThreads.set(!1)};if(n&&n.hasPaginationToken()&&!n.paginationTokenInUse()){l=n.beginDataPageLoad();try{_.Z.PAssert(785,!r,"Should not define a new q for paged token")}catch(m){_.Z.reportError(m)}try{_.Z.PAssert(786,!o,"Should not define a new entryCB for paged token")}catch(m){_.Z.reportError(m)}if(r=l.getQuery(),i=l.getMaxResults(),o=l.getEntryCB(),u){var d=u;u=function(){for(var e=0,t=0,n=arguments.length,r=new Array(n),i=0;i<n;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;r[i]=arguments[i]}l.getDoneCB().apply(null,r),d.apply(null,r)}}else u=l.getDoneCB();e=e||l.getInfo().accountID}else n&&n.needsPaginationToken()&&(l=this.createPaginationToken(void 0,r,{accountID:e},i,o,u),n.setPaginationToken(l),n.beginDataPageLoad());i=i||25;try{_.Z.PAssert(787,o&&_.Z.isFunction(o),"Must define a valid entry callback")}catch(m){_.Z.reportError(m)}try{_.Z.PAssert(788,u&&_.Z.isFunction(u),"Must define a valid done callback")}catch(m){_.Z.reportError(m)}var h,p,f=$t.Z.fns("gmail").users.threads.list.packedFn,g={userId:e,maxResults:i,timeoutMS:a,q:r,pageToken:l&&l.hasMorePages()?l.getNextPageToken():void 0};l||!n?(h=function(t){if(t.nextPageToken&&l&&c.updatePaginationToken(l,t.nextPageToken),n&&l&&n.endDataPageLoad(!!t.nextPageToken),t.threads)for(var r=0,i=t.threads.length,a=0,s=0,d=function(e){e?(o(e),a++):(o(void 0),s++),a+s===i&&u(!0)},h=0;h<t.threads.length;++h){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var p=t.threads[h];c._requestRemoteThreadMetadata(e,p.id,void 0,d)}else u(!0)},p=function(t){n&&l&&n.endDataPageLoad(l),u(!1),c._notifyFailedRequest(e,t)}):(h=function(){u(!0)},p=function(t){u(!1),c._notifyFailedRequest(e,t)}),this._queueRemoteRequestMulti(e,f,g,h,p,void 0,t)}},{key:"_requestRemoteMessageData",value:function(e,t,n){var r=this;try{_.Z.PAssert(789,!e.isLocalOnlyAttachment(),"Should never request remote data for a local only attachment")}catch(c){_.Z.reportError(c)}var i=$t.Z.fns("gmail").users.messages.get.packedFn,o={userId:e.getField("accountID"),id:t,format:"full"},s=function(){var i=a()(k().mark((function i(a){var o;return k().wrap((function(i){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(i.prev=i.next){case 0:return i.next=2,r._parseMailMessage(a);case 2:o=i.sent;try{_.Z.PAssert(790,o,"Must be able to parse message")}catch(c){_.Z.reportError(c)}r._updateMessageData(e,t,o),n(!0);case 6:case"end":return i.stop()}}}),i)})));return function(e){return i.apply(this,arguments)}}();this._queueRemoteRequestMulti(e.getField("accountID"),i,o,s,(function(t){n(!1,t),r._notifyFailedRequest(e.getField("accountID"),t)}),void 0,Si)}},{key:"_requestRemoteMessageDataRaw",value:function(e,t,n,r,i){var a=this,o=$t.Z.fns("gmail").users.messages.get.packedFn,s={userId:e,id:n,format:"full"};this._queueRemoteRequestMulti(e,o,s,(function(n){n&&a._handleContentSyncdMessage(e,t,n),i(n)}),(function(t){i(!1,t,"This thread belongs to an account ("+e+") you are not authorized to access."),a._notifyFailedRequest(e,t)}),void 0,Si,{priority:r?w.Z.RequestPriority.UserBlocking:w.Z.RequestPriority.Default})}},{key:"_requestRemoteThreadDataRaw",value:function(e,t,n){var r=this,i=$t.Z.fns("gmail").users.threads.get.packedFn,a={userId:e,id:t,format:"full"};this._queueRemoteRequestMulti(e,i,a,n,(function(t){n(void 0,t),r._notifyFailedRequest(e,t)}),void 0,li)}},{key:"_requestRemoteThreadMetadata",value:function(e,t,n,r){var i=this,a=$t.Z.fns("gmail").users.threads.get.packedFn,o={userId:e,id:t,format:"metadata"};this._queueRemoteRequestMulti(e,a,o,(function(e){r(e)}),(function(t){r(void 0,t),i._notifyFailedRequest(e,t)}),n,ui)}},{key:"_persistRemoteSnoozeTask",value:function(e,t){e.getData()}},{key:"_cancelDeferredSnoozeTask",value:function(e,t){e.getData()}},{key:"_persistRemoteSendMailTask",value:function(e,t){e.getData()}},{key:"_cancelDeferredSendMailTask",value:function(e,t){e.getData()}},{key:"_handleRemotePersist",value:function(e,t){if(t.status!==w.Z.HTTPStatusCode.Success)return e(!1);try{return e(!0,JSON.parse(t.response).data.messageID)}catch(n){return _.Z.reportError(n),e(!1)}}},{key:"_parseMailThread",value:function(){var e=a()(k().mark((function e(t,n){var r,i,o=this;return k().wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:return r=[],e.next=3,Promise.all(n.messages.map(function(){var e=a()(k().mark((function e(t){var n;return k().wrap((function(e){for(var i=0,a=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,o._parseMailMessage(t);case 2:n=e.sent;try{_.Z.PAssert(791,n,"Must be able to parse each message")}catch(s){_.Z.reportError(s)}n&&r.push(n);case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return i=t.getField("messages"),this._mergeMessagesData(i,r,["labelIds","draftID"]),t.updateField("messages",r),t.updateField("dataLoaded",!0),this._updateAttachmentFromMessages(t,w.Z.ChangeType.Remote),e.abrupt("return",r);case 9:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getAttachmentURL",value:function(e,t,n){return"https://mail.google.com/mail/b/"+e+"/?ui=2&view=att&disp=safe&zw"+("&th="+t)+("&attid="+n)}},{key:"getPreviewURL",value:function(e){return e.link}},{key:"reportMessage",value:function(e,t,n,r,i){var a=$t.Z.fns("gmail").users.messages.get.packedFn,o={userId:e,id:n,format:"full",forceNoDupe:!0};this._queueRemoteRequestMulti(e,a,o,this._sendReport.bind(this,i,r),(function(){try{_.Z.PAssert(792,!1,"Failed to report message")}catch(e){_.Z.reportError(e)}}),void 0,Si)}},{key:"dumpMessage",value:function(e,t,n){var r=this.getAttachment(t),i=this._getMessageFromAttachment(r,n);console.log("Message Dump: ",i)}},{key:"_sanitizeMessage",value:function(){var e=a()(k().mark((function e(t){var n,r,i,a,o,s=this;return k().wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(!t.parts){e.next=3;break}return e.next=3,Promise.all(t.parts.map((function(e){return s._sanitizeMessage(e)})));case 3:if(!t.body||!t.body.data){e.next=13;break}if(!(n=this._runDecodeEmail(t))||n.mimeType!==Xi){e.next=11;break}return e.next=8,Ne.Z.sanitizeContent(n.decoded);case 8:r=e.sent,e.next=12;break;case 11:t.body.data=this._encodeEmail(Ne.Z.sanitizePlaintext(n.decoded));case 12:t.body.data=this._encodeEmail(r);case 13:if(!t.headers){e.next=30;break}i=0,a=0;case 16:if(!(a<t.headers.length)){e.next=30;break}if(!(i++>5e3&&__infLoop&&__infLoop(i))){e.next=19;break}throw new RangeError;case 19:o=t.headers[a],e.t0=o.name.toUpperCase(),e.next="TO"===e.t0||"CC"===e.t0||"BCC"===e.t0||"FROM"===e.t0?23:"SUBJECT"===e.t0||"SNIPPET"===e.t0?25:27;break;case 23:return o.value=o.value.replace(/[A-Za-z0-9]/g,"#"),e.abrupt("break",27);case 25:return o.value=new Array(o.name.length+1).join("#"),e.abrupt("break",27);case 27:++a,e.next=16;break;case 30:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_sendReport",value:function(){var e=a()(k().mark((function e(t,n,r){var i;return k().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:try{_.Z.PAssert(793,_.Z.isBoolean(t),"Must provide a valid boolean for sendContent")}catch(o){_.Z.reportError(o)}try{_.Z.PAssert(794,_.Z.isString(n),"Must provide a valid description string")}catch(o){_.Z.reportError(o)}try{_.Z.PAssert(795,_.Z.isObject(r),"Must provide valid raw data")}catch(o){_.Z.reportError(o)}if(e.prev=3,_.Z.log("Sending Message Report",r),t){e.next=8;break}return e.next=8,this._sanitizeMessage(r.payload);case 8:i={description:n,payload:r.payload},_.Z.reportError(new Error("Report Message"),i),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),_.Z.reportError(e.t0);case 15:case"end":return e.stop()}}}),e,this,[[3,12]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"loadResource",value:function(e,t,n,r){if(this.hasCacheData(e)){var i=this.getAttachment(e),a=this._getMessageFromAttachment(i,t).resources[n];a?(a.data?r(a,n):this._requestRemoteAttachment(i.getField("accountID"),t,a.id,(function(e,t){e&&(a.data=e,a.size=t),r(a,n)})),this.sendEvent("FetchAttachment")):r(void 0,n)}else r(void 0,n)}},{key:"_requestRemoteAttachment",value:function(e,t,n,r){var i=this,a=$t.Z.fns("gmail").users.messages.attachments.get.packedFn,o={id:n,messageId:t,userId:e};this._queueRemoteRequestMulti(e,a,o,(function(e){r(e.data.replace(/-/g,"+").replace(/_/g,"/"),e.size)}),(function(t){r(void 0),i._notifyFailedRequest(e,t)}),void 0,Pi)}},{key:"_parseAttachment",value:function(e,t,n){try{_.Z.PAssert(796,e,"Must have valid multipart lib")}catch(g){_.Z.reportError(g)}try{_.Z.PAssert(797,n.body,"Must have a valid attachment body")}catch(g){_.Z.reportError(g)}try{_.Z.PAssert(798,n.body.attachmentId,"Must have a valid attachment ID")}catch(g){_.Z.reportError(g)}var r,i,a,o,s,c="0."+n.partId;if(n.headers)for(var l=0,u=0;u<n.headers.length;++u){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=n.headers[u];switch(d.name.toUpperCase()){case"CONTENT-ID":var h=/^<(.*)>$/.exec(d.value);i=r=h?h[1]:d.value;break;case"CONTENT-TRANSFER-ENCODING":s=d.value;break;case"CONTENT-DISPOSITION":var p=d.value.split(";");o=p[0]?p[0].toLowerCase():void 0;break;case"X-ATTACHMENT-ID":a=d.value}}r&&o!==Ai.Attachment||!n.filename?!r&&n.body.attachmentId&&(r=n.body.attachmentId):r=n.filename;try{_.Z.PAssert(799,r,"Must be able to find a valid resource ID")}catch(g){_.Z.reportError(g)}var f={cid:r,rawContentID:i,id:n.body.attachmentId,attID:c,realAttrID:a,data:void 0,size:n.body.size,uploader:void 0,disposition:o,parentType:t.mimeType,mimeType:n.mimeType,contentEncoding:s};e[f.cid]=f}},{key:"_decodeFlowed",value:function(e,t){return e.split(/\r?\n/).reduce((function(e,n,r){var i=e;return t&&(i=i.replace(/[ ]+$/,"")),/ $/.test(e)&&!/(^|\n)\-\- $/.test(e)||1===r?i+n:i+"\n"+n})).replace(/^ /gm,"")}},{key:"_decodeEmail",value:function(e,t,n){try{_.Z.PAssert(800,_.Z.isString(e),"Passing in an invalid string to decode")}catch(i){_.Z.reportError(i)}var r;if(e)try{r=_.Z.b64_to_utf8(e),"FLOWED"===n.format&&(r=this._decodeFlowed(r,n.delSp))}catch(a){_.Z.reportError(a)}return r}},{key:"_encodeEmail",value:function(e){var t;try{t=_.Z.utf8_to_b64(e)}catch(n){_.Z.reportError(n)}return t}},{key:"_runDecodeEmail",value:function(e){try{_.Z.PAssert(801,e&&e.body,"Must pass in a valid part")}catch(o){_.Z.reportError(o)}var t,n=this._getHeader(e,"Content-Transfer-Encoding"),r=!1;if(ra.indexOf(e.mimeType)>=0)return{decoded:t=this._generateMessageDisplayNode(e),mimeType:Xi,contentType:$i,name:"GeneratedContent",hasError:r};var i=this._getHeader(e,"Content-Type")||$i;try{_.Z.PAssert(802,i,"Must have a valid contentType")}catch(o){_.Z.reportError(o)}var a=this._sanitizeContentType(i);return e.body&&e.body.data?t=this._decodeEmail(e.body.data,n,a):e.body&&e.body.attachmentId?t='<a href="attach:'+e.body.attachmentId+'">Load Message</a>':(t="Unable to decode email content",r=!0),{decoded:t,mimeType:e.mimeType,contentType:a.type,name:a.name,hasError:r}}},{key:"_runDecodeMessage",value:function(e){var t=this._decodeMessagePart(e);return 0===t.length&&e?ta.indexOf(e.mimeType)>=0||ra.indexOf(e.mimeType)>=0?[this._runDecodeEmail(e)]:[]:t}},{key:"_decodeMessagePart",value:function(e){var t=[];if(e)if(e.mimeType===ji||e.mimeType===Hi||e.mimeType===Ui)for(var n=0,r=0;r<e.parts.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=this._decodeMessagePart(e.parts[r]);t.pushArray(i)}else if(e.mimeType===Bi||e.mimeType===Ni||e.mimeType===Ni||e.mimeType===Wi)for(var a=0,o=e.parts.length-1;o>=0;o--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this._isValidDisplayPart(e.parts[o])){var s=this._decodeMessagePart(e.parts[o]);if(s.length>0){t.pushArray(s);break}}}else this._isValidDisplayPart(e)&&t.push(this._runDecodeEmail(e));return t}},{key:"_combineMessageParts",value:function(){var e=a()(k().mark((function e(t){var n,r,i,a,o,s;return k().wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(n="",r=Yi,i=$i,a=!1,!(t&&t.length>0)){e.next=22;break}o=0,r=t[0].mimeType,i=t[0].contentType,t.length,s=0;case 10:if(!(s<t.length)){e.next=17;break}if(!(o++>5e3&&__infLoop&&__infLoop(o))){e.next=13;break}throw new RangeError;case 13:na.indexOf(t[s].mimeType)<0&&(a=!0);case 14:++s,e.next=10;break;case 17:return e.next=19,Ne.Z.combineParts(t);case 19:n=e.sent,e.next=23;break;case 22:n=" ";case 23:return r===Yi&&(r=Xi,i=Xi+";charset="+i.split(";charset=")[1]),e.abrupt("return",{decoded:n,mimeType:r,contentType:i,reportMessage:a});case 25:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isValidDisplayPart",value:function(e){var t=!1;return!this._isResourcePart(e)&&ta.indexOf(e.mimeType)>=0&&(t=!0),t}},{key:"_isResourcePart",value:function(e){var t=!1;return(e.filename||this._getHeader(e,"CONTENT-ID")&&(this._getHeader(e,"CONTENT-DISPOSITION")||ta.indexOf(e.mimeType)<0))&&(t=!0),t}},{key:"_parseMessagePart",value:function(e,t){var n=0,r=0,i={parent:t,raw:e,mimeType:e.mimeType,children:[],resources:[]};switch(e.mimeType){case Yi:case Xi:case zi:break;case Ni:case Ui:case qi:case Bi:case Vi:case Hi:case Gi:case ji:for(var a=0;a<e.parts.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=e.parts[a],s=this._parseMessagePart(o,i);this._isResourcePart(o)?i.resources.push(s):i.children.push(s)}break;case Wi:for(var c=0;c<e.parts.length;++c){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=this._parseMessagePart(e.parts[c],i);i.children.push(l)}break;default:var u=e.mimeType.split("/")[0];ea.indexOf(u)<0&&(_.Z.log("Unknown Part Mimetype: ",e),_.Z.reportError(new Error("Unknown attachment mimetype: "+e.mimeType)))}return i}},{key:"_getMessageDisplay",value:function(e,t){var n=0;switch(e.mimeType){case Yi:case Xi:case ji:case Hi:case Vi:t.push(e);break;case Bi:case Ni:case Wi:case Ui:for(var r=0;r<e.children.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this._getMessageDisplay(e.children[r],t)}break;case Qi:case Ji:break;case qi:case Ki:case Gi:t.push(e);break;default:try{_.Z.PAssert(803,!1,"Should never have an unknown multipart mimetype in the tree: ",e.mimeType)}catch(i){_.Z.reportError(i)}}}},{key:"_getResourcesForNode",value:function(e,t){for(var n=0,r=e.resources,i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i].raw;this._parseAttachment(t,e,a)}e.raw&&e.raw.body&&e.raw.body.attachmentId&&this._parseAttachment(t,e.parent,e.raw)}},{key:"_getResourcesForPart",value:function(e){var t=0,n={};if(e.mimeType===ji||e.mimeType===Hi)for(var r=0,i=0;i<e.children.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this._getResourcesForNode(e.children[i],n)}for(;e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._getResourcesForNode(e,n),e=e.parent}return n}},{key:"_displayAttachment",value:function(e,t){var n=!1;return e.cid===t&&(e.disposition===Ai.Attachment||e.disposition===Ai.Inline&&e.parentType===ji)&&(n=!0),n}},{key:"getMessageAttachments",value:function(e){var t=this,n=[];return e.resources&&_.Z.forEachValue(e.resources,(function(e){t._displayAttachment(e,e.cid)&&n.push(e)})),n}},{key:"getMessageDisplayAttachments",value:function(){var e=a()(k().mark((function e(t){var n,r,i,a,o,s,c=0;return k().wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:if(n=this.getMessageAttachments(t),!t.initializedForDisplay){e.next=5;break}r=t.specialLinks?t.specialLinks.attachments:[],e.next=9;break;case 5:return i={ignoreQuotedAttachments:!!(t.labelIds.indexOf(Yr.DRAFT)>=0)},e.next=8,Ne.Z.getAttachmentLinks(t.decoded,i);case 8:r=e.sent;case 9:a=0;case 10:if(!(a<r.length)){e.next=18;break}if(!(c++>5e3&&__infLoop&&__infLoop(c))){e.next=13;break}throw new RangeError;case 13:o=r[a],t.resources[o.name]||((s=this._createResource(t.resources,o)).link=o.href,n.push(s));case 15:++a,e.next=10;break;case 18:return e.abrupt("return",n);case 19:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_verifyDKIM",value:function(e){var t;if(e)for(var n=0,r=e.split(";"),i=/([a-z]+)[=](.*)/i,a=0;a<r.length;++a){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=r[a].trim();if(o){var s=i.exec(o);if(s)switch(t={},s[1]){case"d":t.domain=s[2];break;case"h":t.headers=s[2].split(":").map(Function.prototype.call,String.prototype.trim)}}}return t}},{key:"_sanitizeContentType",value:function(e){var t=$i;try{var n,r,i,a,o=0,s=e.replace(/[\"\']/g,"").split(";"),c=s[0].trim().toLowerCase();try{_.Z.PAssert(804,c===Yi||c===Xi,"Unknown ContentType MediaType: "+c)}catch(f){_.Z.reportError(f)}for(var l=1;l<s.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=s[l].trim();if(u){var d=u.indexOf("=");if(d>=1){var h=u.substr(0,d).trim(),p=u.substr(d+1).trim();if(h&&p)switch(h.toUpperCase()){case"CHARSET":n=p;break;case"FORMAT":r=p.toUpperCase();break;case"DELSP":i="YES"===p.toUpperCase();break;case"NAME":a=p;break;case"BOUNDARY":break;default:try{_.Z.PAssert(805,!1,"Unknown param in ContentType: "+u)}catch(f){_.Z.reportError(f)}}else try{_.Z.PAssert(806,!1,"Malformed contentType part: ",e)}catch(f){_.Z.reportError(f)}}else try{_.Z.PAssert(807,!1,"Invalid contentType part: ",e)}catch(f){_.Z.reportError(f)}}}n||(n="utf-8"),c&&n&&(t=c+";charset="+n)}catch(g){_.Z.reportError(g)}return{type:t,format:r,delSp:i,name:a}}},{key:"_getHeader",value:function(e,t){var n;if(e&&e.headers)for(var r=0,i=0;i<e.headers.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(e.headers[i].name.toUpperCase()===t.toUpperCase()){n=e.headers[i].value;break}}return n}},{key:"_generateMessageDisplayNode",value:function(e){try{_.Z.PAssert(809,ra.indexOf(e.mimeType)>=0,"Must be a valid mimeType to generate content from")}catch(r){_.Z.reportError(r)}var t;if(e.body&&e.body.attachmentId)t='<a href="attach:'+e.body.attachmentId+'">Load Message</a>';else{var n;switch(e.mimeType){case Ki:case Gi:case ji:n="&nbsp;";break;case qi:n="Unable to display encrypted message content.";break;default:n="Unable to display unknown content type: "+e.mimeType}t="<html><body>"+n+"</body></html>"}return t}},{key:"_parseMailMessage",value:function(){var e=a()(k().mark((function e(t){return k().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this._parseMailMessageInternal(t));case 4:e.prev=4,e.t0=e.catch(0),_.Z.reportError(e.t0);case 7:case"end":return e.stop()}}}),e,this,[[0,4]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_parseMailMessageInternal",value:function(){var e=a()(k().mark((function e(t){var n,r,i,a,o,s,c,l,u,d,h,p,f,g,m,v,y=0;return k().wrap((function(e){for(var k=0;;){if(k++>5e3&&__infLoop&&__infLoop(k))throw new RangeError;switch(e.prev=e.next){case 0:n=t.payload,r=!!n.body&&n.body.size>0;try{_.Z.PAssert(810,r!==n.mimeType.startsWith("multipart/")||n.mimeType===Ui,"Checking the body size should be the same as checking whether this is a multipart message")}catch(Z){_.Z.reportError(Z)}this._verifyDKIM(this._getHeader(t.payload,"DKIM-Signature")),i=t.payload.headers,a=0;case 6:if(!(a<i.length)){e.next=40;break}if(!(y++>5e3&&__infLoop&&__infLoop(y))){e.next=9;break}throw new RangeError;case 9:o=i[a],e.t0=o.name.toUpperCase(),e.next="FROM"===e.t0?13:"REPLY-TO"===e.t0?15:"TO"===e.t0?17:"CC"===e.t0?19:"BCC"===e.t0?21:"SUBJECT"===e.t0?23:"DATE"===e.t0?25:"MESSAGE-ID"===e.t0?28:"REFERENCES"===e.t0?30:"IN-REPLY-TO"===e.t0?32:"LIST-UNSUBSCRIBE"===e.t0?34:36;break;case 13:return t.from=this.parseEmailAddress(o.value),e.abrupt("break",37);case 15:return t.replyTo=this.parseEmailAddress(o.value),e.abrupt("break",37);case 17:return t.to=this.parseEmailAddresses(o.value),e.abrupt("break",37);case 19:return t.cc=this.parseEmailAddresses(o.value),e.abrupt("break",37);case 21:return t.bcc=this.parseEmailAddresses(o.value),e.abrupt("break",37);case 23:return t.subject=o.value,e.abrupt("break",37);case 25:t.date=this.parseDateHeader(o.value);try{_.Z.PAssert(811,_.Z.isDateValid(t.date),"Must have a valid message date3: ",t.date)}catch(Z){_.Z.reportError(Z)}return e.abrupt("break",37);case 28:return t.messageID=o.value,e.abrupt("break",37);case 30:return t.references=o.value,e.abrupt("break",37);case 32:return t.inReplyTo=o.value,e.abrupt("break",37);case 34:return t.listUnsubscribe=o.value,e.abrupt("break",37);case 36:return e.abrupt("break",37);case 37:++a,e.next=6;break;case 40:if(t.messageID||(t.messageID=_.Z.generateTempId()),!r){e.next=45;break}c=n,e.next=64;break;case 45:l=0,u=this._parseMessagePart(n),d=[],this._getMessageDisplay(u,d),p=d.length-1;case 50:if(h||!(p>=0)){e.next=57;break}if(!(l++>5e3&&__infLoop&&__infLoop(l))){e.next=53;break}throw new RangeError;case 53:if(ta.indexOf(d[p].mimeType)>=0)h=d[p];else if(ra.indexOf(d[p].mimeType)>=0)h=d[p];else{_.Z.log("Unknown bestNode mimepart: ",d[p]);try{_.Z.PAssert(812,!1,"Unknown mimePart display type: ",d[p].mimeType)}catch(Z){_.Z.reportError(Z)}}case 54:p--,e.next=50;break;case 57:if(!h){e.next=62;break}s=this._getResourcesForPart(h),c=h.raw,e.next=64;break;case 62:return e.next=64,this._sendReport(!1,"Missing bestNode",t);case 64:try{_.Z.PAssert(813,c,"Must have found a valid message part to display")}catch(Z){_.Z.reportError(Z)}f=this._runDecodeMessage(c);try{_.Z.PAssert(814,f.length>0,"Should have at least one decoded message part available")}catch(Z){_.Z.reportError(Z)}if(0!==f.length){e.next=77;break}return e.prev=68,g=JSON.parse(JSON.stringify(t)),e.next=72,this._sendReport(!0,"No valid decoded part",g);case 72:e.next=77;break;case 74:e.prev=74,e.t1=e.catch(68),_.Z.reportError(e.t1);case 77:return e.next=79,this._combineMessageParts(f);case 79:if(!(m=e.sent)){e.next=87;break}if(v={id:t.id,labelIds:t.labelIds,messageID:t.messageID,decoded:m.decoded,mimeType:m.mimeType,contentType:m.contentType,from:t.from,to:t.to||[],cc:t.cc,bcc:t.bcc,snippet:t.snippet,subject:t.subject||"",date:t.date,internalDate:t.internalDate?_.Z.isDateValid(t.internalDate)?t.internalDate:new Date(_.Z.parseInt(t.internalDate)):new Date,references:t.references,inReplyTo:t.inReplyTo,listUnsubscribe:t.listUnsubscribe,resources:s||{}},!m.reportMessage){e.next=85;break}return e.next=85,this._sendReport(!1,"Mismatch mimeType/contentType",t);case 85:return e.abrupt("return",v);case 87:case"end":return e.stop()}}}),e,this,[[68,74]])})));return function(t){return e.apply(this,arguments)}}()},{key:"parseEmailAddress",value:function(e){if(_.Z.isObject(e))return e;aa.lastIndex=0;var t=aa.exec(e),n={};if(t){var r=oa.exec(t[1]);n.text=r?r[1]:t[1],n.email=t[2]}else n.email=e;return n.email&&(n.email=n.email.replace(/[\r\n]/g,"")),n.text&&(n.text=n.text.replace(/[\r\n]/g,"")),n}},{key:"parseEmailAddresses",value:function(e){for(var t=0,n=[],r=_.Z.parseEmailAddresses(e),i=0;i<r.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=r[i];"contact"===a.type&&a.email&&n.push(a)}return n}},{key:"parseDateHeader",value:function(e){var t=We.Z.parseDate(e);return _.Z.isDateValid(t)||(t=_o.International.parseDate(e,w.Z.DateFormat.MDY)),t}},{key:"runRemoteSearch",value:function(e,t,n,r){var i=this;try{_.Z.PAssert(816,e,"Must provide a valid search")}catch(v){_.Z.reportError(v)}try{_.Z.PAssert(817,t,"Must provide a valid pane")}catch(v){_.Z.reportError(v)}try{_.Z.PAssert(818,n,"Must provide a valid bucket ID")}catch(v){_.Z.reportError(v)}try{_.Z.PAssert(819,_.Z.isFunction(r),"Must provide a valid search callback")}catch(v){_.Z.reportError(v)}var a="-in:chats -in:spam "+e,o=_o.PaneManager.getPaneById(t),s=this.getAccountIDFromItem(o.getItem())||this.getDefaultAccount(),c=!1,l=0,u=0,d=new Sn(e,25,this.requestDataPage.bind(this)),h=function(e){if(l===u&&c){_.Z.log("Done Searching: ",l);var a=e?w.Z.SearchResultStatus.Error:l>0?w.Z.SearchResultStatus.Done:w.Z.SearchResultStatus.None;d.isValid()&&i.swapInSearchBucket(n,t),r(a)}},p=function(e){if(l++,e){var t=i._addRemoteEntry(s,e),r=i.getBucketItemStore(n);i._ensureVMLIsForSearchResult(t,r),u++}else u++;h()},f=function(e){c=!0,h(!e)},g=!1,m=new Dr(d.onEntry,(function(e){d.onDone(e),g||(g=!0,d.isValid()&&d.hasResults()?d.getNextPage(p,f):f(e))}));return this._requestRemoteThreads(s,di,void 0,a,25,void 0,m.getEntryCB(),m.getDoneCB()),d}},{key:"_addSearchCacheEntryInternal",value:function(e,t,n){var r=!1,i=this._ensureAccountLib(e,this._emailCache);return i[t]||(i[t]={}),i[t][n]||(i[t][n]=!0,r=!0),r}},{key:"_removeSearchCacheEntryInternal",value:function(e,t,n){var r,i=this._getAccountLib(e,this._emailCache);return i&&i[t]&&(r=i[t][n],delete i[t][n]),r}},{key:"_getSearchCacheLabelEntryInternal",value:function(e,t){var n,r=this._getAccountLib(e,this._emailCache);return r&&r[t]&&(n=r[t]),n}},{key:"_addEmailToSearchCache",value:function(e,t){var n=!1;if(t&&_.Z.isArray(t.labelIds))for(var r=0,i=0;i<t.labelIds.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;n=this._addSearchCacheEntryInternal(t.accountID,t.labelIds[i],e)||n}return n}},{key:"_removeEmailFromSearchCache",value:function(e,t){var n=!1;if(t&&_.Z.isArray(t.labelIds))for(var r=0,i=0;i<t.labelIds.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=!!this._removeSearchCacheEntryInternal(t.accountID,t.labelIds[i],e);n=n||a,a&&this._removeThreadLabelVMLI(t.accountID,e,t.labelIds[i])}return n}},{key:"_addEmailLabelToSearchCache",value:function(e,t,n){return this._addSearchCacheEntryInternal(e,n,t)}},{key:"_removeEmailLabelFromSearchCache",value:function(e,t,n){var r=!!this._removeSearchCacheEntryInternal(e,n,t);return r&&this._removeThreadLabelVMLI(e,t,n),r}},{key:"runLocalItemSearch",value:function(e){var t=this.getDescriptorForItem(e.item),n=this._getSearchCacheLabelEntryInternal(t.accountID,t.labelID);if(n)for(var r in n)if(n.hasOwnProperty(r)){var i=this.getCacheData(r);try{_.Z.PAssert(820,i,"Must have valid data for search entry")}catch(o){_.Z.reportError(o)}if(i){var a=this._ensureThreadLabelVMLI(i,t.labelID);e.comparator&&!e.comparator(a)||e.each&&e.each(a)}}}},{key:"getRemoteAttachmentData",value:function(e){var t,n=this;var r=function(r,i){r?n._addRemoteEntry(t,r):(e.notifyDataRequestFailed(),n._notifyFailedRequest(t,i))};e.hasField("accountID")?(t=e.getField("accountID"),this.getSyncAccounts().includes(t)&&this._requestRemoteThreadMetadata(t,e.id,e,r)):this.getSyncAccounts().forEach((function(i){n._requestRemoteThreadMetadata(i,e.id,e,(function(n,a){n&&(t=i,n.accountID=t,r(n,a),e.notifyDataMutated(["accountID"],w.Z.ChangeType.Local))}))}))}},{key:"_updateThreadFromMessages",value:function(e){var t,n=0,r=this;try{_.Z.PAssert(822,!e.isDeleted||0===e.messages.length,"Should never run an update on a deleted thread with messages")}catch(m){_.Z.reportError(m)}var i=e.labelIds,a=ie.Z.getDefaultAccountID();"me"===e.accountID&&"me"!==a&&(e.accountID=a),e.labelIds=[],e.date=void 0,e.participants=[],e.count=e.messages.length,e.snippet=e.count>0?e.messages[e.messages.length-1].snippet:"",e.hasPriority=!1;for(var o=0;o<e.messages.length;++o){var s,c,l;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=e.messages[o];try{_.Z.PAssert(823,u.id,"Each message must have a valid ID")}catch(m){_.Z.reportError(m)}null===(s=e.labelIds)||void 0===s||s.pushOnlyUniques(u.labelIds);var d=(null===(c=u.labelIds)||void 0===c?void 0:c.indexOf(Yr.DRAFT))>=0,h=!1;if((null===(l=u.labelIds)||void 0===l?void 0:l.indexOf(Yr.SENT))>=0)for(var p=0,f=0;f<u.to.length;++f){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var g=u.to[f];if(this.isMyAccountID(g.email)){h=!0;break}}else h=!0;(!e.date||u.date&&e.date.isBefore(u.date)&&!d&&h)&&(e.date=u.date),(!e.internalDate||u.internalDate&&e.internalDate.isBefore(u.internalDate))&&(e.internalDate=u.internalDate),u.from&&e.participants.indexOfWithProperty("email",u.from.email)<0&&e.participants.push(u.from),u.resources&&_.Z.forEachValue(u.resources,(function(t){r._displayAttachment(t,t.cid)&&(e.hasAttachments=!0)}))}return e.date=e.date?new Date(e.date):new Date(0),_.Z.isDateValid(e.date)||(e.date=new Date(0)),e.internalDate=e.internalDate?new Date(e.internalDate):new Date,_.Z.isDateValid(e.internalDate)||(e.internalDate=new Date),e.lastModifiedDate=e.lastModifiedDate?new Date(e.lastModifiedDate):e.date,_.Z.isDateValid(e.lastModifiedDate)&&!e.lastModifiedDate.isBefore(e.date)||(e.lastModifiedDate=e.date),e.messages.length>0&&(e.subject=e.messages[0].subject,e.subjectLower=e.subject.toLowerCase(),e.from=e.messages[e.messages.length-1].from,e.to=e.messages[0].to),{labelsAdded:i?null===(t=e.labelIds)||void 0===t?void 0:t.removeArray(i):e.labelIds,labelsRemoved:i?i.removeArray(e.labelIds):void 0}}},{key:"_updateAttachmentFromMessages",value:function(e,t){var n=this._updateThreadFromMessages(e.getData());this._handleThreadLabelUpdates(e.getData(),n.labelsAdded,n.labelsRemoved),e.notifyDataMutated(["labelIds","date","lastModifiedDate","count","snippet","subject","subjectLower","hasAttachments","from","to"],t)}},{key:"_createRemoteEntry",value:function(e,t){var n={id:t.id,accountID:e,messages:[],labelIds:[]};try{_.Z.PAssert(824,t.messages,"_createRemoteEntry with no messages",Object.keys(t))}catch(u){_.Z.reportError(u)}if(t.messages)for(var r=0,i=0;i<t.messages.length;++i){var a=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=t.messages[i];try{_.Z.PAssert(825,o.id,"Message must have a valid id")}catch(u){_.Z.reportError(u)}try{_.Z.PAssert(826,!o.labelIds||o.labelIds.indexOf(Yr.CHAT)<0,"Should never receive a chat message")}catch(u){_.Z.reportError(u)}o.labelIds&&o.labelIds.indexOf(Yr.DRAFT)>=0&&this._notifyDraftMessage(e,t.id,o.id);for(var s={id:o.id,messageID:void 0,internalDate:o.internalDate?new Date(_.Z.parseInt(o.internalDate)):new Date,snippet:o.snippet,labelIds:o.labelIds||[],to:[],resources:{},subject:""},c=0;c<o.payload.headers.length;++c){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=o.payload.headers[c];switch(l.name.toUpperCase()){case"TO":s.to=this.parseEmailAddresses(l.value);break;case"FROM":s.from=this.parseEmailAddress(l.value);break;case"SUBJECT":s.subject=l.value;break;case"MESSAGE-ID":s.messageID=l.value;break;case"IN-REPLY-TO":s.inReplyTo=l.value;break;case"DATE":s.date=this.parseDateHeader(l.value);try{_.Z.PAssert(827,_.Z.isDateValid(s.date),"Must have a valid message date1: ",l.value)}catch(u){_.Z.reportError(u)}}}_.Z.isDateValid(s.date)||(s.date=s.internalDate),s.subject||(s.subject=""),s.messageID||(s.messageID=_.Z.generateTempId()),n.messages.push(s)}return this._updateThreadFromMessages(n),n}},{key:"_addRemoteEntry",value:function(e,t){var n=this._createRemoteEntry(e,t);if(this.hasCacheData(n.id)){var r=this.getCacheData(n.id);if(r){this._mergeThreadData(r,n);var i=this._updateThreadFromMessages(n);this._handleThreadLabelUpdates(n,i.labelsAdded,i.labelsRemoved)}var a=this.getChangedFields(r,n);if(this.cacheData(n.id,n,!!r,a),this.fieldsHaveParseEffect(a))if(this.hasAttachment(n.id))this.getAttachment(n.id).notifyDataMutated(a,w.Z.ChangeType.Remote)}else this.cacheData(n.id,n),this._updateSearchPanes(n,n.labelIds,[]);return n}},{key:"cacheData",value:function(e,t,r,i){this._verifyMessageState(t,!1);var a=this._addEmailToSearchCache(e,t);if(d()(v()(n.prototype),"cacheData",this).call(this,e,t,r,i),t.messages&&!this._isLoadingLocal&&this._checkUnsyncdMessageContent(t),a){var o=this.getDefaultItemStore();o&&o.updateItems()}return!!t.messages}},{key:"cacheThreadData",value:function(e,t){this._verifyMessageState(t,!0),"string"===typeof t.date&&(t.date=+new Date(t.date)),"string"===typeof t.internalDate&&(t.internalDate=+new Date(t.internalDate)),this._threadCache.saveEntry(t,this.compareCachedData)}},{key:"compareCachedData",value:function(e,t){return this._propertySets[w.Z.PluginLoad.Full].some((function(n){return!_.Z.deepEqual(e[n],t[n])}))}},{key:"_verifyMessageState",value:function(e,t){}},{key:"ensureThreadDates",value:function(e){(_.Z.isString(e.internalDate)||_.Z.isNumber(e.internalDate))&&(e.internalDate=new Date(e.internalDate)),(_.Z.isString(e.date)||_.Z.isNumber(e.date))&&(e.date=new Date(e.date))}},{key:"createEntryFromLocal",value:function(e,t){var n=0;t.subjectLower=t.subject.toLowerCase(),this.ensureThreadDates(t),t.messages=t.messages||[];for(var r=0;r<t.messages.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=t.messages[r];_.Z.isString(i.date)?i.date=this.parseDateHeader(i.date):i.date||(i.date=new Date),_.Z.isString(i.internalDate)?i.internalDate=new Date(i.internalDate):i.internalDate||(i.internalDate=new Date),_.Z.isString(i.to)&&(i.to=this.parseEmailAddresses(i.to)),_.Z.isString(i.cc)&&(i.cc=this.parseEmailAddresses(i.cc)),_.Z.isString(i.bcc)&&(i.bcc=this.parseEmailAddresses(i.bcc)),_.Z.isString(i.from)&&(i.from=this.parseEmailAddress(i.from)),i.to||(i.to=[]),i.resources?(i.resources=Object.assign({},i.resources),delete i.resources._lib):i.resources={};try{_.Z.PAssert(831,i.draftID||i.messageID||_.Z.isTempId(i.id),"Remotely saved messages must have a valid message ID")}catch(a){_.Z.reportError(a)}try{_.Z.PAssert(832,_.Z.isDateValid(i.date),"Must have a valid message date2: ",i.date)}catch(a){_.Z.reportError(a)}try{_.Z.PAssert(833,_.Z.isDateValid(i.internalDate),"Must have a valid internal message date: ",i.internalDate)}catch(a){_.Z.reportError(a)}!_.Z.isTempId(i.id)&&!i.draftID&&i.labelIds&&i.labelIds.indexOf(Yr.DRAFT)>=0&&this._notifyDraftMessage(t.accountID,e,i.id),i.decoded&&this.reportTrackedStat(ii)}return this._updateThreadFromMessages(t),t}},{key:"_updateMessageData",value:function(e,t,n){var r=e.getField("messages"),i=r.indexOfWithProperty("id",t);try{_.Z.PAssert(834,i>=0,"Must always be able to find the message being updated")}catch(a){_.Z.reportError(a)}i>=0&&(this._mergeMessageData(r[i],n,["labelIds"]),r[i]=n,e.updateField("messages",r),this._updateAttachmentFromMessages(e,w.Z.ChangeType.Remote))}},{key:"_mergeMessageData",value:function(e,t,n){try{_.Z.PAssert(835,_.Z.isObject(e),"Must pass in a valid old message")}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(836,_.Z.isObject(t),"Must pass in a valid new message")}catch(s){_.Z.reportError(s)}if(e.modifiedOffline){var r=e.modifiedOffline;if(_.Z.isArray(r))for(var i=0,a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t[r[a]]=e[r[a]]}else Object.keys(e).forEach((function(n){t[n]=e[n]})),Object.keys(t).forEach((function(n){t[n]=e[n]}));t.modifiedOffline=e.modifiedOffline}for(var o in n&&n.forEach((function(n){return t[n]=e[n]})),e)if(e.hasOwnProperty(o))switch(o){case"snippet":this._pendingDraftUpdates[e.id]&&(t[o]=e[o]);break;default:t.hasOwnProperty(o)||(t[o]=e[o])}}},{key:"_mergeMessagesData",value:function(e,t,n){var r=0;try{_.Z.PAssert(837,_.Z.isArray(e),"Must have a valid old messages array")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(838,_.Z.isArray(t),"Must have a valid new messages array")}catch(d){_.Z.reportError(d)}try{_.Z.PAssert(839,e!==t,"Should not pass in the same array for old and new")}catch(d){_.Z.reportError(d)}for(var i=0;i<e.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=e[i],o=t.indexOfWithProperty("id",a.id);if(o>=0){var s=t[o];try{_.Z.PAssert(840,s,"Must have a valid new message")}catch(d){_.Z.reportError(d)}this._mergeMessageData(a,s,n)}else if(a.labelIds.indexOf(Yr.DRAFT)>=0)if(_.Z.isTempId(a.id)){var c=t.indexOfWithProperty("messageID",a.inReplyTo);try{_.Z.PAssert(841,c>=0,"Must be able to find the message being replied to")}catch(d){_.Z.reportError(d)}c>=0&&t.splice(c+1,0,a)}else if(a.inReplyTo){var l=t.indexOfWithProperty("inReplyTo",a.inReplyTo);if(l>=0){var u=t[l];try{_.Z.PAssert(842,u,"Must have a valid new message")}catch(d){_.Z.reportError(d)}this._mergeMessageData(a,u,n)}}}}},{key:"_mergeThreadData",value:function(e,t){this.reportTrackedStat(Jr);try{_.Z.PAssert(844,!e.isDeleted,"Should never merge message data in a deleted thread")}catch(s){_.Z.reportError(s)}if(this._mergeMessagesData(e.messages,t.messages,["resources","draftID"]),e.modifiedOffline){var n=0,r=e.modifiedOffline;try{_.Z.PAssert(845,_.Z.isArray(r),"Should not be receiving an update for an event that was created locally")}catch(s){_.Z.reportError(s)}for(var i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r[i];switch(a){case"messages":break;default:t[a]=e[a]}}t.modifiedOffline=e.modifiedOffline}for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o]);t.labelIds=e.labelIds}},{key:"_shouldCacheThread",value:function(e){var t=!0;try{_.Z.PAssert(846,e&&e.messages,"Thread should have messages",e&&Object.keys(e))}catch(a){_.Z.reportError(a)}if(e.messages)for(var n=0,r=0;r<e.messages.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=e.messages[r];if(i.labelIds&&(i.labelIds.indexOf(Yr.SPAM)>=0||i.labelIds.indexOf(Yr.CHAT)>=0)){t=!1;break}}return t}},{key:"_shouldCacheMessageData",value:function(e){var t=!1,n=this._getFullSyncTime(),r=this._getUnreadSyncTime();if(e.date.isAfter(n))t=!0;else if(e.date.isAfter(r))for(var i=0,a=0;a<e.messages.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=e.messages[a];if(this.isPriorityData(o)){t=!0;break}}return t}},{key:"refreshThreadCacheData",value:function(e,t,n,r,i){var a=this;this._requestRemoteThreadMetadata(e,t,void 0,(function(n,o){if(n)if(a._shouldCacheThread(n)){var s=a._addRemoteEntry(e,n);a.cacheThreadData(t,a.serializeExternalData(s)),i&&i(!0)}else a._deleteCachedThread(e,t,i);else o&&o.error&&o.error.code===w.Z.HTTPStatusCode.NotFound?a._deleteCachedThread(e,t,i):(r(e,t),i&&i(!1))}))}},{key:"_deleteCachedThread",value:function(e,t,n){if(this.hasCacheData(t)){for(var r=0,i=this.getAttachment(t),a=i.getField("messages"),o=0;o<a.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;_o.menus.isComposeOpenForEmail(a[o].id)&&(this._clearPendingDraftUpdate(i,a[o].id),ue.Z.fireEvent("EmailCompose","onClosed",[]),_o.menus.closeComposeEmail(i,a[o])),this._rawCache.removeEntry(a[o].id)}i.updateField("isDeleted",!0),i.updateField("messages",[]),this._updateAttachmentFromMessages(i,w.Z.ChangeType.Remote)}this._threadCache.removeEntry(t),n&&n(!0)}},{key:"_deleteCachedMessage",value:function(e,t,n){var r=this;try{_.Z.PAssert(847,n,"Must specify a valid message ID to remove from thread")}catch(c){_.Z.reportError(c)}if(this.hasCacheData(t))for(var i=0,a=this.getAttachment(t),o=a.getField("messages"),s=0;s<o.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(o[s].id===n){o.removeAt(s),this._updateAttachmentFromMessages(a,w.Z.ChangeType.Remote),a.updateField("messages",o);break}}this._threadCache.getEntry(t,!0).then((function(e){if(e)for(var i=0,a=0;a<e.messages.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e.messages[a].id===n){e.messages.removeAt(a),r.cacheThreadData(t,e);break}}})),this._rawCache.removeEntry(n)}},{key:"setLastModifiedDate",value:function(e,t,n){var r=this;this.hasCacheData(t)&&this.getAttachment(t).updateField("lastModifiedDate",n);this._threadCache.getEntry(t,!0).then((function(e){e&&(e.lastModifiedDate=n,r.cacheThreadData(t,e))}))}},{key:"addLabelsToMessage",value:function(e,t,n,r,i){var a=this;if(this.hasCacheData(t)){for(var o=0,s=this.getAttachment(t),c=s.getField("messages"),l=0;l<c.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if((!n||c[l].id===n)&&(c[l].labelIds.pushOnlyUniques(r),n))break}this._updateAttachmentFromMessages(s,i),s.updateField("messages",c,void 0,!0);var u=s.getField("labelIds");u&&(u.pushOnlyUniques(r),s.updateField("labelIds",u,void 0,!0))}this._threadCache.getEntry(t,!0).then((function(e){if(e){var i=0,o=!1;e.labelIds&&e.labelIds.pushOnlyUniques(r);for(var s=0;s<e.messages.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(!n||e.messages[s].id===n){e.messages[s].labelIds.pushOnlyUniques(r),a.cacheThreadData(t,e),o=!0;break}}try{_.Z.PAssert(849,o,"Must have found message to add labels to")}catch(c){_.Z.reportError(c)}}}))}},{key:"removeLabelsFromMessage",value:function(e,t,n,r,i){var a=this;if(this.hasCacheData(t)){for(var o=0,s=this.getAttachment(t),c=s.getField("messages"),l=0;l<c.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(!n||c[l].id===n){for(var u=0,d=0;d<r.length;++d){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;c[l].labelIds.remove(r[d])}if(n)break}}this._updateAttachmentFromMessages(s,i),s.updateField("messages",c,void 0,!0);var h=s.getField("labelIds");if(h){for(var p=0,f=0;f<r.length;++f){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;h.remove(r[f])}s.updateField("labelIds",h,void 0,!0)}}this._threadCache.getEntry(t,!0).then((function(e){if(e){var i=0,o=!1;if(e.labelIds)for(var s=0,c=0;c<r.length;++c){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;e.labelIds.remove(r[c])}for(var l=0;l<e.messages.length;++l){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(!n||e.messages[l].id===n){for(var u=0,d=0;d<r.length;++d){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;e.messages[l].labelIds.remove(r[d])}a.cacheThreadData(t,e),o=!0;break}}try{_.Z.PAssert(850,o,"Must have found message to remove labels from")}catch(h){_.Z.reportError(h)}}}))}},{key:"changeMessageAccount",value:function(){var e=a()(k().mark((function e(t,n,r,i,a,o){var s,c,l;return k().wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:try{_.Z.PAssert(851,o,"Must supply a valid from contact")}catch(d){_.Z.reportError(d)}return c=i!==t.getField("accountID"),l=this._findDraft(t,n,r),c&&this.discardDraft(t,l.id,l.draftID,(function(e){try{_.Z.PAssert(852,e,"Must successfully delete remote draft")}catch(d){_.Z.reportError(d)}})),l.from=o,l.replyTo=this.getReplyToAddress(o.email),e.next=8,Ne.Z.replaceSignature(l.decoded,this.getSignature(a));case 8:return l.decoded=e.sent,s=c?this.createDraft(i,void 0,void 0,l):this.updateDraft(t,l.id,l.draftID,l,!0,!0,(function(e){try{_.Z.PAssert(853,e,"Must be able to successfully update the draft when swiching sending accounts")}catch(d){_.Z.reportError(d)}})),e.abrupt("return",s);case 11:case"end":return e.stop()}}}),e,this)})));return function(t,n,r,i,a,o){return e.apply(this,arguments)}}()},{key:"_ensureVMLIsForSearchResult",value:function(e,t){try{_.Z.PAssert(854,t,"Should never be ensuring a search VMLI in the default item store")}catch(o){_.Z.reportError(o)}var n=this.getItemIDForAccountID(e.accountID,"S"),r=this._ensureVMLIsForAccount(n,t),i=this._createThreadID(n,"",e.id);if(!t.hasItem(i)){var a=t.createItem(i,this._getTextForItem(e.id,e.accountID),r.id);r.insertSorted(a,this.sortFn)}}},{key:"_removeVMLIFromSearchResult",value:function(e,t){try{_.Z.PAssert(855,t,"Should never be ensuring a search VMLI in the default item store")}catch(i){_.Z.reportError(i)}var n=this.getItemIDForAccountID(e.accountID,"S"),r=this._createThreadID(n,"",e.id);t.hasItem(r)&&t.destroyItem(r)}},{key:"_createThreadID",value:function(e,t,n){return this.getIDPrefix("T")+e+"~"+t+"~"+n}},{key:"_getItemProps",value:function(e,t){var n;return t.isNamed(Ri.PRI1)?n={priority:w.Z.VMLIFlag.P1}:t.isNamed(Ri.PRI2)?n={priority:w.Z.VMLIFlag.P2}:t.isNamed(Ri.PRI3)&&(n={priority:w.Z.VMLIFlag.P3}),n}},{key:"_ensureThreadLabelVMLI",value:function(e,t,n){n=n||this.getDefaultItemStore();var r,i=this._getLabelByID(e.accountID,t),a=this._ensureVMLIsForLabel(e.accountID,i,n),o=this._createThreadID(e.accountID,t,e.id);if(this.reportTrackedStat(Xr),n.hasItem(o))r=n.getItem(o);else{this.reportTrackedStat(Qr);var s=this._getItemProps(e,i);r=n.createItem(o,this._getTextForItem(e.id,e.accountID),a.id,s),a.insertSorted(r,this.threadSortFn,!1)}return r}},{key:"_removeThreadLabelVMLI",value:function(e,t,n,r){r=r||this.getDefaultItemStore();var i=this._createThreadID(e,n,t);r.hasItem(i)&&r.destroyItem(i)}},{key:"_getRequiredSearchLabels",value:function(e){for(var t=0,n=[Yr.INBOX],r=e.split(" "),i=0;i<r.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=r[i].split(":");a&&2===a.length&&("label"!==a[0]&&"category"!==a[0]&&"is"!==a[0]||n.push(a[1].toUpperCase()))}return n}},{key:"_handleThreadLabelUpdates",value:function(e,t,n){_o.PaneUpdateBatcher.beginUpdateItems();var r=!1;if(t)for(var i=0,a=0;a<t.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r=this._addEmailLabelToSearchCache(e.accountID,e.id,t[a])||r}if(n)for(var o=0,s=0;s<n.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;r=this._removeEmailLabelFromSearchCache(e.accountID,e.id,n[s])||r}this._updateSpecialLabels(e),this._updateSearchPanes(e,t,n),r&&this.getDefaultItemStore().updateItems(),_o.PaneUpdateBatcher.commitUpdateItems()}},{key:"_updateSearchPanes",value:function(e,t,n){var r=this;_o.PaneUpdateBatcher.beginUpdateItems(),_o.PaneManager.runForEachPane((function(i){if(i.isSearchingRemote()){var a=r.getActiveItemStore(i.id),o=i.search.getRemoteValue(),s=r._getRequiredSearchLabels(o),c=!1,l=!1;s.forEach((function(e){n&&n.indexOf(e)>=0?c=!0:t&&t.indexOf(e)>=0&&(l=!0)})),c?a!==r.getDefaultItemStore()&&(_.Z.focusedPane===i&&0===t.length&&n&&1===n.length&&n[0]===Yr.UNREAD||r._removeVMLIFromSearchResult(e,a)):l&&a!==r.getDefaultItemStore()&&r._ensureVMLIsForSearchResult(e,a)}}),this.getPaneType()),_o.PaneUpdateBatcher.commitUpdateItems()}},{key:"_updateSpecialLabels",value:function(e){this._threadIsArchived(e)?this._addEmailLabelToSearchCache(e.accountID,e.id,Mi):this._removeEmailLabelFromSearchCache(e.accountID,e.id,Mi),this._addEmailLabelToSearchCache(e.accountID,e.id,Ti)}},{key:"_ensureVMLIsForLabel",value:function(e,t,n){try{_.Z.PAssert(856,t,"Must specify a valid label")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(857,t instanceof Rr,"Must pass in a valid label object")}catch(c){_.Z.reportError(c)}n=n||this.getDefaultItemStore();var r=this.getItemIDForAccountID(e,"L")+"~"+t.getLabelID(),i=n.getItem(r),a=t.getDisplayText(!0);if(i)i.getParsedText()!==a&&i.setText(a,w.Z.ChangeType.Auto);else{var o;if(t.hasAncestors()){var s=this._getLabelByName(e,t.getParent().getRawName(),!0);o=s?this._ensureVMLIsForLabel(e,s,n):this._ensureVMLIsForAccount(e,n)}else o=this._ensureVMLIsForAccount(e,n);i=n.createItem(r,a,o.id),o.insertSorted(i,this.sortFn)}return i}},{key:"getVMLIForAccount",value:function(e){if(e)return this._ensureVMLIsForAccount(e)}},{key:"getVMLIForLabel",value:function(e,t){return this._ensureVMLIsForLabel(e,t)}},{key:"getLabelForVMLI",value:function(e){var t,n=this.getDescriptorForItem(e);return n.accountID&&n.labelID&&(t=this._getLabelByID(n.accountID,n.labelID)),t}},{key:"_getLabelIDFromItem",value:function(e){var t,n=e.id;(this.idStartsWithPrefix(n,"L")||this.idStartsWithPrefix(n,"T"))&&(t=n.substr(n.indexOf("~",2)+1));try{_.Z.PAssert(858,!t||_.Z.isTempId(t)||t.indexOf("~")<0,"Should not contain delim in label ID")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(859,!t||t.length>3,"Label ID should be longer than a couple of chars")}catch(r){_.Z.reportError(r)}return t}},{key:"_getThreadIDFromItem",value:function(e){return this._getThreadID(e.id)}},{key:"_getThreadID",value:function(e){var t;this.idStartsWithPrefix(e,"T")?t=e.substr(e.lastIndexOf("~")+1):this.idStartsWithPrefix(e,"A")||this.idStartsWithPrefix(e,"L")||this.idStartsWithPrefix(e,"R")||(t=e);try{_.Z.PAssert(860,!t||_.Z.isTempId(t)||t.indexOf("~")<0,"Should not contain delim in thread ID")}catch(n){_.Z.reportError(n)}try{_.Z.PAssert(861,!t||t.length>3,"Thread ID should be longer than a couple of chars")}catch(n){_.Z.reportError(n)}return t}},{key:"isAccountItem",value:function(e){return e.id.startsWith(this.getIDPrefix("A"))}},{key:"isLabelItem",value:function(e){return e.id.startsWith(this.getIDPrefix("L"))}},{key:"isThreadItem",value:function(e){return e.id.startsWith(this.getIDPrefix("T"))}},{key:"getAttachmentClass",value:function(){return["plugin_gmail"]}},{key:"googleScopes",value:function(){return[w.Z.GScope.GmailModify,w.Z.GScope.GmailCompose]}},{key:"getDependencies",value:function(){return[]}},{key:"verifyAuthorization",value:function(e){return!this.getSetting(this.Settings.IsEnabled)||this.isCurrentlyAuthorized(e)}},{key:"handleUnauthorized",value:function(e){0}},{key:"_activate",value:function(){}},{key:"_deactivate",value:function(){}},{key:"handleTapClick",value:function(e,t,n,r){var i=r.target;try{_.Z.PAssert(862,t,"Gmail tapped but is not actually a pane",_.Z.getElementPath(i))}catch(a){_.Z.reportError(a)}if(t)return this.openEmailByItem(e,t)}},{key:"isMyAccountID",value:function(e){try{_.Z.PAssert(863,"me"!==e||_.Z.isDemoMode(),"Should not be checking me")}catch(n){_.Z.reportError(n)}var t=ie.Z.getDefaultAccountID();try{_.Z.PAssert(864,_.Z.isDemoMode()||"me"!==t,"Should not be checking against current account until loaded")}catch(n){_.Z.reportError(n)}return e===t}},{key:"getURLForAttachment",value:function(e){var t=e.getField("accountID");t&&"me"!==t||(t=ie.Z.getDefaultAccountID());var n=e.getField("service");if("o"===n){var r=Ue.Z.getPluginNew("Email"),i=r.getAccount(t,n);return r.getURLForOutlookAccount(i)}return t?"https://mail.google.com/mail/mu/mp/0/?authuser=".concat(t,"#cv/Inbox/").concat(e.id):"https://mail.google.com/mail/u/0/#all/"+e.id}},{key:"createPrintURLForThread",value:function(e){var t=e.getField("accountID");return"me"===t&&(t=ie.Z.getDefaultAccountID()),"https://mail.google.com/mail/b/"+t+"/?ui=2&view=pt&search=all&th="+e.id}},{key:"openEmailByItem",value:function(e,t,n){var r=e.getAttachmentByPlugin(w.Z.PluginID.Gmail);_o.EmailPreview.open(e,r,t,n)}},{key:"isEmailOpenByItem",value:function(e,t){var n=e.getAttachmentByPlugin(w.Z.PluginID.Gmail);return n&&_o.EmailPreview.isOpenOnPane(t)&&_o.EmailPreview.isOpenOnThread(n)}},{key:"_convertRawMessage",value:function(e,t,n,r){var i={id:t,payload:n},a=this._getMessageFromAttachment(e,t);try{_.Z.PAssert(865,a,"Must be able to get message metadata")}catch(o){_.Z.reportError(o)}i.labelIds=a.labelIds,i.messageID=a.messageID,i.snippet=a.snippet,i.internalDate=n.internalDate,r(i)}},{key:"getThreadData",value:function(e,t,n){var r=this;if(0!==e.getField("messages").length)return this._getThreadData(e,t,n);this._requestRemoteThreadMetadata(e.getField("accountID"),e.id,void 0,(function(i,a){var o=!0;i?r._addRemoteEntry(e.getField("accountID"),i):a&&a.error&&a.error.code===w.Z.HTTPStatusCode.NotFound&&(o=!1),o?r._getThreadData(e,t,n):t(!1,"The conversation that you requested no longer exists.")}))}},{key:"_getThreadData",value:function(e,t,n){for(var r=0,i=e.getField("messages"),a=i.length,o=0,s=!1,c=!1,l={},u=function(){if(!c&&o===a&&s){var e=0;c=!0;for(var n={messages:[]},r=0,u=0;u<i.length;++u){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var d=l[i[u].id];d?n.messages.push(d):++r}try{_.Z.PAssert(866,n.messages.length+r===i.length,"Messages should always be found for thread")}catch(h){_.Z.reportError(h)}0===i.length?t(void 0,"This message is not cached locally and we could not contact the remote server."):t(n)}},d=function(e){e&&(l[e.id]=e),++o,u()},h=0;h<i.length;++h){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var p=i[h];this.getMessageData(e,p.id,d)}s=!0,setTimeout(u,0)}},{key:"getMessageData",value:function(e,t,n){var r=this;this._rawCache.getEntry(t).then((function(i){i?r._convertRawMessage(e,t,i,n):(_.Z.log("Warning: Local message cache missing email display data: ",e.id,t),r._requestRemoteMessageDataRaw(e.getField("accountID"),e.id,t,!0,n))}))}},{key:"_handleThreadLoaded",value:function(e,t,n,r){var i=this._pendingThreadLoads[e];try{_.Z.PAssert(867,i,"Must always have a valid pending load when handling laod")}catch(s){_.Z.reportError(s)}if(delete this._pendingThreadLoads[e],i)for(var a=0,o=0;o<i.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;try{i[o](t,n,r)}catch(c){_.Z.reportError(c)}}}},{key:"loadThread",value:function(e,t){try{_.Z.PAssert(868,0===this._loadThreadMutex,"Should never have an outstanding lock on thread load")}catch(n){_.Z.reportError(n)}this._loadThreadMutex++;e.getField("accountID");this._loadThread(e,t,8e3),this._loadThreadMutex--}},{key:"_loadThread",value:function(e,t,n){var r=this,i=this.isAttachmentDraftOnly(e),o=this._pendingThreadLoads[e.id];if(o)_.Z.log("Duped pending thread load: ",e.id),o.push(t);else if(this._pendingThreadLoads[e.id]=[t],e.getField("dataLoaded")||e.isLocalOnlyAttachment()){for(var s=0,c=e.getField("messages"),l=!1,u=!1,d=0,h=0,p=c.length,f=0,g=function(){l&&d===h&&(p===f&&(u=!0),r._handleThreadLoaded(e.id,!0,u))},m=function(){var t=a()(k().mark((function t(n){var i;return k().wrap((function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:if(h++,!n){t.next=9;break}return""===n.decoded&&(n.decoded=void 0),t.next=5,r._parseMailMessage(n);case 5:i=t.sent;try{_.Z.PAssert(869,i,"Must be able to parse message")}catch(o){_.Z.reportError(o)}r._updateMessageData(e,i.id,i),u=!0;case 9:g();case 10:case"end":return t.stop()}}}),t)})));return function(e){return t.apply(this,arguments)}}(),v=0;v<c.length;++v){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var y=c[v];void 0===y.decoded?(y.decoded="",d++,this.getMessageData(e,y.id,m)):(y.decoded||y.labelIds.indexOf(Yr.DRAFT)>=0)&&f++}l=!0,g()}else if(i){var Z=e.getField("messages")[0];this.getMessageData(e,Z.id,function(){var t=a()(k().mark((function t(n){var i;return k().wrap((function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return t.next=3,r._parseMailMessage(n);case 3:i=t.sent;try{_.Z.PAssert(870,i,"Must be able to parse message")}catch(o){_.Z.reportError(o)}r._updateMessageData(e,i.id,i);case 6:u=!0,r._handleThreadLoaded(e.id,!0,u);case 8:case"end":return t.stop()}}}),t)})));return function(e){return t.apply(this,arguments)}}())}else this.getThreadData(e,function(){var t=a()(k().mark((function t(n,i){return k().wrap((function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:if(!n){t.next=3;break}return t.next=3,r._parseMailThread(e,n);case 3:u=!0,r._handleThreadLoaded(e.id,!!e.getField("dataLoaded"),u,i);case 5:case"end":return t.stop()}}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),n)}},{key:"forceReloadMessage",value:function(e,t,n){this._requestRemoteMessageData(e,t,n)}},{key:"_verifyEmailAttachments",value:function(e,t,n){var r,i,a=this,o=this._findDraft(e,t,n);return o?_.Z.forEachValue(o.resources,(function(e){e.uploader&&(e.uploader.hasError()?r="There was an error uploading one or more attachments. Please remove them or try uploading again.":e.uploader.isDone()||(r="One or more of your attachments is still uploading.",i=function(e){a.onEmailReadyToSend(o,(function(){_o.toasts.clearMessage(e)}))}))})):r="Could not find message to verify attachments.",r?{message:r,handleMessageFn:i}:void 0}},{key:"_verifyEmailRecipients",value:function(e,t,n){var r,i=this._findDraft(e,t,n);if(i)if(i.to&&0!==i.to.length)for(var a=0,o=0;o<i.to.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=i.to[o];s&&s.email?_.Z.isEmail(s.email)||(r="You have entered an invalid email"):r="You have entered a contact with an invalid email address"}else r="You must enter at least one person to send this email to";else r="Unable to find the message you are trying to send";return r?{message:r}:void 0}},{key:"_formatAddressText",value:function(e,t,n){return e?n?'"'+_.Z.encodeMIMEHeader(e)+'" <'+t+">":'"'+e+'" <'+t+">":t}},{key:"_createAddressTextFromTokens",value:function(e,t){var n="";if(e)for(var r=0,i=0;i<e.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=e[i];_.Z.isEmail(a.email)&&(0!==i&&(n+=", "),n+=this._formatAddressText(a.text,a.email,t))}try{_.Z.PAssert(871,!n.startsWith(","),"Should not start with a comma")}catch(o){_.Z.reportError(o)}try{_.Z.PAssert(872,!n.endsWith(","),"Should not end with a comma")}catch(o){_.Z.reportError(o)}try{_.Z.PAssert(873,n.indexOf(",,")<0,"Should not have two commas in a row")}catch(o){_.Z.reportError(o)}return n.trim()}},{key:"_createRFC822Message",value:function(e,t,n,r){var i=this;try{_.Z.PAssert(874,t,"Must specify a valid draft")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(875,t.contentType,"Must specify a valid content type for the draft")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(876,t.from,"Must be able to get the from information for a user.")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(877,!t.inReplyTo||t.inReplyTo.indexOf("undefined")<0,"Should not have an undefined message id in reply-to: "+t.inReplyTo)}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(878,!t.references||t.references.indexOf("undefined")<0,"Should not have an undefined message id in references: "+t.references)}catch(c){_.Z.reportError(c)}var a=t.from.text,o=t.from.email,s=new Vr(this);s.updateFromDraft(e,t,a,o,n,(function(){var e=s.generateBlob();r(i._encodeEmail(e))}))}},{key:"createSignature",value:function(e){var t=this.getSignature(e);return t?this.getSetting(this.Settings.InsertSignatureAboveReplies)?'<br/><br/><div class="gmail_signature">'+t+"</div><br/>":'<br/><br/>--<br/><div class="gmail_signature">'+t+"</div>":'<div class="gmail_signature"></div>'}},{key:"createReplyQuote",value:function(e){var t;e&&(t='<br>\n<div class="gmail_extra">\n<br>\n<div class="gmail_quote">'+("On "+e.date.toString("MMM dd, y")+" at "+e.date.toString("hh:mm tt")+", "+_.Z.escape(this._createAddressTextFromTokens([e.from]))+" wrote:")+'\n<br>\n<blockquote class="gmail_quote" style="margin:0 0 0 0.8ex;border-left:1px #ccc solid;padding-left:1ex">\n'+e.decoded+"\n</blockquote>\n</div>\n<br>\n</div>\n");return t}},{key:"createForwardQuote",value:function(e){var t,n=_.Z.isArray(e.to)?e.to:[e.to];return e&&(t='<br>\n<div class="gmail_quote">\n<br>\n---------- Forwarded message ----------<br>\nFrom: '+_.Z.escape(this._createAddressTextFromTokens([e.from]))+"<br>\nDate: "+e.date.toString("ddd, MMM dd, y")+" at "+e.date.toString("hh:mm tt")+"<br>\nSubject: "+e.subject+"<br>\nTo: "+_.Z.escape(this._createAddressTextFromTokens(n))+"\n<br>\n<br>\n"+e.decoded+"\n</div>\n<br>\n"),t}},{key:"createMessageBody",value:function(e,t,n){var r,i=this.createSignature(t);if(n===w.Z.EmailResponseMode.Reply||n===w.Z.EmailResponseMode.ReplyAll)r=this.createReplyQuote(e);else if(n===w.Z.EmailResponseMode.Forward)r=this.createForwardQuote(e);else try{_.Z.PAssert(879,!1,"Invalid email response mode: "+n)}catch(a){_.Z.reportError(a)}return this.getSetting(this.Settings.InsertSignatureAboveReplies)?i+r:r+i}},{key:"_sendEmail",value:function(e,t,n,r){var i=this;this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(e,t);var a=this._findDraft(e,t,n);this._createRFC822Message(e.getData(),a,!0,(function(t){var n={raw:t};e.isLocalOnlyAttachment()||(n.threadId=e.id);var o=$t.Z.fns("gmail").users.messages.send.packedFn,s={userId:e.getField("accountID"),resource:n};i._queueRemoteRequestMulti(e.getField("accountID"),o,s,(function(t){i._updateLocalDraftFromSend(e,a.id,t,r)}),(function(t){i._notifySendFailed(),r(!1,t),i._notifyFailedRequest(e.getField("accountID"),t)}),void 0,pi)}))}},{key:"_shouldSaveMessageContent",value:function(e,t){var n;return(null===(n=t.labelIds)||void 0===n?void 0:n.indexOf(Yr.DRAFT))>=0}},{key:"compactCacheField",value:function(e,t){var n,r=0;switch(t){case"messages":n=[];for(var i=e[t],a={},o=function(e){var t=_.Z.clone(e);delete t.data,delete t.size,delete t.uploader,a[e.id]=t},s=0;s<i.length;++s){var c=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var l=i[s],u={},d=0;d<Fi.length;++d){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var h=l[Fi[d]];void 0!==h&&null!==h&&(u[Fi[d]]=l[Fi[d]])}this._shouldSaveMessageContent(e,l)||(delete u.decoded,delete u.mimeType,delete u.contentType,delete u.listUnsubscribe),u.resources&&(_.Z.forEachValue(u.resources,o),u.resources=a),n.push(u)}break;default:n=e[t]}return n}},{key:"_generateUndoRedo",value:function(){this._undoStack.registerOwner(this,this.id),this._undoStack.registerAction(this.id,w.Z.PluginAction.Gmail.Archive,{undo:this.unarchiveAttachment,redo:this.archiveAttachment}),this._undoStack.registerAction(this.id,w.Z.PluginAction.Gmail.Unarchive,{undo:this.archiveAttachment,redo:this.unarchiveAttachment}),this._undoStack.registerAction(this.id,w.Z.PluginAction.Gmail.Trash,{undo:this.untrashAttachment,redo:this.trashAttachment}),this._undoStack.registerAction(this.id,w.Z.PluginAction.Gmail.Untrash,{undo:this.trashAttachment,redo:this.untrashAttachment}),this._undoStack.registerAction(this.id,w.Z.PluginAction.Gmail.AddLabel,{undo:this.removeLabelFromAttachment,redo:this.addLabelToAttachment}),this._undoStack.registerAction(this.id,w.Z.PluginAction.Gmail.RemoveLabel,{undo:this.addLabelToAttachment,redo:this.removeLabelFromAttachment}),this._undoStack.registerAction(this.id,w.Z.PluginAction.Gmail.MarkRead,{undo:this.markAttachmentUnread,redo:this.markAttachmentRead}),this._undoStack.registerAction(this.id,w.Z.PluginAction.Gmail.MarkUnread,{undo:this.markAttachmentRead,redo:this.markAttachmentUnread}),this._undoStack.registerAction(this.id,w.Z.PluginAction.Gmail.Star,{undo:this.markAttachmentUnstarred,redo:this.markAttachmentStarred}),this._undoStack.registerAction(this.id,w.Z.PluginAction.Gmail.Unstar,{undo:this.markAttachmentStarred,redo:this.markAttachmentUnstarred}),this._undoStack.registerAction(this.id,w.Z.PluginAction.Gmail.SetPriority,{undo:this.setAttachmentPriority,redo:this.setAttachmentPriority}),this._undoStack.registerAction(this.id,w.Z.PluginAction.Gmail.Move,{undo:this.unmoveItem,redo:this.moveItem}),this._undoStack.registerAction(this.id,w.Z.PluginAction.Gmail.Snooze,{undo:this.unsnoozeAttachment,redo:this.snoozeAttachment}),this._undoStack.registerAction(this.id,w.Z.PluginAction.Gmail.ScheduleSend,{undo:this.cancelSendMessage,redo:this.scheduleSendMessage}),this._undoStack.registerAction(this.id,w.Z.PluginAction.Gmail.DiscardDraft,{undo:_.Z.emptyFn,redo:this.runDiscardDraft})}},{key:"performAction",value:function(e,t,n,r,i){try{_.Z.PAssert(880,e,"Must supply a valid action")}catch(c){_.Z.reportError(c)}try{_.Z.PAssert(881,_.Z.isBoolean(t),"Invalid preventUndo param")}catch(c){_.Z.reportError(c)}var a;this.beginAction(t);var o=[n,r,i];try{a=this._undoStack.runAction(this.id,e,o)}catch(l){_.Z.reportError(l)}if(this._undoStack.isUndoableAction()){var s=[n];_.Z.isArray(a)?s.pushArray(a):s.push(a),this._undoStack.performAction(this.id,e,{undoParams:s,redoParams:o})}this.endAction()}},{key:"performActions",value:function(e,t){var n=0;this.beginAction(t);for(var r=0;r<e.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this.performAction(e[r].action,!1,e[r].attach,e[r].param)}this.endAction()}},{key:"beginAction",value:function(e){this._undoStack.beginAction(e)}},{key:"endAction",value:function(){this._undoStack.endAction()}},{key:"handleUndo",value:function(){this._undoStack.undoAction()}},{key:"handleRedo",value:function(){this._undoStack.redoAction()}},{key:"supportUsageCache",value:function(){return!0}},{key:"supportOfflineLoad",value:function(){return!0}},{key:"_matchParticipant",value:function(e,t){var n=!1;return e&&(e.text&&(n=e.text.toLowerCase().indexOf(t)>=0),!n&&e.email&&(n=e.email.toLowerCase().indexOf(t)>=0)),n}},{key:"_matchLabels",value:function(e,t){return this.hasLabelLike(e.accountID,e.id,t)}},{key:"_matchEntry",value:function(e,t){return e.subjectLower.indexOf(t)>=0||this._matchParticipant(e.from,t)||this._matchLabels(e,t)}},{key:"matchAttachment",value:function(e,t){return this._matchEntry(e.getData(),t)}},{key:"findMatchExact",value:function(){}},{key:"findMatchLike",value:function(e,t){var n=this,r=e.toLowerCase();return this.findCachedItemsByFn((function(e){return n._matchEntry(e,r)}),t)}},{key:"isGmailItem",value:function(e){return!!e.getAttachmentByPlugin(this.id)}},{key:"itemHasLabelByID",value:function(e,t){var n=e.getAttachmentByPlugin(this.id);return!!n&&this.attachmentHasLabelByID(n,t)}},{key:"itemHasLabel",value:function(e,t){var n=e.getAttachmentByPlugin(this.id);return!!n&&this.attachmentHasLabel(n,t)}},{key:"itemHasFullLabel",value:function(e,t){var n=e.getAttachmentByPlugin(this.id);return!!n&&this.attachmentHasFullLabel(n,t)}},{key:"itemHasDraft",value:function(e){return this.itemHasLabelByID(e,Yr.DRAFT)}},{key:"isItemUnread",value:function(e){return this.itemHasLabelByID(e,Yr.UNREAD)}},{key:"isItemImportant",value:function(e){return this.itemHasLabelByID(e,Yr.IMPORTANT)}},{key:"isItemStarred",value:function(e){return this.itemHasLabelByID(e,Yr.STARRED)}},{key:"isItemArchived",value:function(e){var t=e.getAttachmentByPlugin(this.id);return!!t&&this.attachmentIsArchived(t)}},{key:"isItemTrashed",value:function(e){return this.itemHasLabelByID(e,Yr.TRASH)}},{key:"isItemFullTrashed",value:function(e){return this.itemHasFullLabel(e,Li.TRASH)}},{key:"isItemSpam",value:function(e){return this.itemHasLabelByID(e,Yr.SPAM)}},{key:"isDisplayItem",value:function(e,t){var n=!1;return this.isItemSpam(e)||!this.isThreadItem(e)||this.isItemFullTrashed(e)&&!t||(n=!0),n}},{key:"getItemPriority",value:function(e){return e.hasPluginAttachment(this.id)?this.getAttachmentPriority(e.getAttachmentByPlugin(this.id)):0}},{key:"_getCompDateForItem",value:function(e){var t=0,n=e.getAttachmentByPlugin(this.id);if(n){var r=n.getField("lastModifiedDate");if(r)t=r.getTime();else{var i=n.getField("internalDate");i&&(t=i.getTime())}}return t}},{key:"_timeCompare",value:function(e,t){return e>t?1:e<t?-1:0}},{key:"threadSortFn",value:function(e,t){return this._timeCompare(this._getCompDateForItem(t),this._getCompDateForItem(e))}},{key:"threadSortPriorityFn",value:function(e,t){var n=e.getAttachmentByPlugin(this.id),r=t.getAttachmentByPlugin(this.id),i=this.getAttachmentPriority(n),a=this.getAttachmentPriority(r),o=this.attachmentHasLabelByID(n,Yr.STARRED),s=this.attachmentHasLabelByID(r,Yr.STARRED);return i>a?-1:i<a?1:o&&!s?-1:s&&!o?1:this._timeCompare(this._getCompDateForItem(t),this._getCompDateForItem(e))}},{key:"labelSortFn",value:function(e,t){return e.displayCompare(t)}},{key:"labelVMLISortFn",value:function(e,t){var n=this._getLabelByID(this.getAccountIDFromItem(e),this._getLabelIDFromItem(e)),r=this._getLabelByID(this.getAccountIDFromItem(t),this._getLabelIDFromItem(t));return this.labelSortFn(n,r)}},{key:"getCssClass",value:function(e,t){if(t&&t.type===this.getPaneType())return _.Z.classNames({starred:this.attachmentHasLabelByID(e,Yr.STARRED)},{unread:this.attachmentHasLabelByID(e,Yr.UNREAD)},{p1:this.attachmentHasLabel(e,Ri.PRI1)},{p2:this.attachmentHasLabel(e,Ri.PRI2)},{p3:this.attachmentHasLabel(e,Ri.PRI3)})}},{key:"getUnsyncdMessageCount",value:function(){return this._numUnsyncdMessages}},{key:"getSyncdMessageCount",value:function(){return this._numSyncdMessages}},{key:"_checkUnsyncdMessageContent",value:function(e){var t=this;e.messages.forEach((function(n){n.cached?(t.reportTrackedStat($r),t._numSyncdMessages++):n.cachedError?t.reportTrackedStat(ei):t._shouldCacheMessageData(e)?t._rawCache.getEntry(n.id).then((function(r){r||(t.reportTrackedStat(ti),t._notifyUnsyncdMessage(e.accountID,e.id,n.id))})):t.reportTrackedStat(ni)}))}},{key:"_notifyUnsyncdMessage",value:function(e,t,n){_.Z.isTempId(t)||_.Z.isTempId(n)||(this._handleSyncContentCacheOp(this._unsyncdMessages,e,t,n),this._numUnsyncdMessages++,this._contentSyncTask.notifyWorkAvailable())}},{key:"_notifyContentCached",value:function(e,t,n){this._numSyncdMessages++,this._handleSyncContentCacheOp(this._pendingSyncdMessages,e,t,n)}},{key:"_handleSyncContentCacheOp",value:function(e,t,n,r){var i=this._ensureAccountLib(t,e);i[n]?!0!==i[n]&&i[n].indexOf(r)<0&&i[n].push(r):i[n]=!r||[r]}},{key:"_removeUnsyncdMessage",value:function(e,t,n){this.reportTrackedStat(ri),this._numUnsyncdMessages--;var r=this._getAccountLib(e,this._unsyncdMessages);if(n){var i=r[t];i.remove(n),0===i.length&&delete r[t]}else delete r[t];_.Z.isEmpty(r)&&this._deleteAccountLib(e,this._unsyncdMessages)}},{key:"_setCachedFieldForMessage",value:function(e,t,n){var r=this;if(this.hasCacheData(t))for(var i=0,a=this.getAttachment(t).getField("messages"),o=0;o<a.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;(!0===n||n.indexOf(a[o].id)>=0)&&(a[o].cached=!0)}this._threadCache.getEntry(t,!0).then((function(e){if(e){for(var i=0,a=0;a<e.messages.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=e.messages[a];(!0===n||n.indexOf(o.id)>=0)&&(o.cached=!0)}r.cacheThreadData(t,e)}}))}},{key:"_updateCachedErrorFieldForMessage",value:function(e,t,n){var r=this;if(this.hasCacheData(t))for(var i=0,a=this.getAttachment(t).getField("messages"),o=0;o<a.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;(!0===n||n.indexOf(a[o].id)>=0)&&(a[o].cachedError?a[o].cachedError++:a[o].cachedError=1)}this._threadCache.getEntry(t,!0).then((function(e){if(e){for(var i=0,a=0;a<e.messages.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=e.messages[a];(!0===n||n.indexOf(o.id)>=0)&&(o.cached?o.cachedError++:o.cachedError=1)}r.cacheThreadData(t,e)}}))}},{key:"_processSyncdContent",value:function(){for(var e in this._pendingSyncdMessages)if(this._pendingSyncdMessages.hasOwnProperty(e)){var t=this._pendingSyncdMessages[e];for(var n in t)if(t.hasOwnProperty(n)){var r=t[n];if(_.Z.isArray(r)){for(var i=0,a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[a];this._removeUnsyncdMessage(e,n,o)}this._setCachedFieldForMessage(e,n,r)}else!0===r&&this._removeUnsyncdMessage(e,n)}}this._pendingSyncdMessages={}}},{key:"_processSyncErrors",value:function(e){for(var t in _.Z.log("Process Sync Errors: ",e),e)if(e.hasOwnProperty(e)){var n=e[t];for(var r in n)if(n.hasOwnProperty(r)){var i=0,a=n[r];try{_.Z.PAssert(882,_.Z.isArray(a),"Must have a valid message ID list")}catch(c){_.Z.reportError(c)}for(var o=0;o<a.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=a[o];this._removeUnsyncdMessage(t,r,s)}this._updateCachedErrorFieldForMessage(t,r,a)}}}},{key:"driveMessageContentSync",value:function(e){var t=this;if(_o.cacheManager.hasReportedQuotaError())return e(!1);this._outstandingContentSync=!0,this._runMessageContentSync(35,(function(n,r){if(!n)try{t._processSyncErrors(r)}catch(i){_.Z.reportError(i)}return t._processSyncdContent(),t._outstandingContentSync=!1,e(!_.Z.isEmpty(t._unsyncdMessages))}))}},{key:"_runMessageContentSync",value:function(e,t){var n=0,r=0,i=!1,a=0,o=0,s={},c=function(e,n,c){if(e?a++:(o++,s[n]=c),i&&a+o===r){var l=0===o;t(l,l?void 0:s)}},l=this.getSyncAccounts();for(var u in this._unsyncdMessages)if(l.indexOf(u)>=0&&(n+=this._syncMessageContentForAccount(u,this._unsyncdMessages[u],e-n,c),r++,n>=e))break;return i=!0,0===n&&setTimeout((function(){t(!0)}),0),n}},{key:"_syncMessageContentForAccount",value:function(e,t,n,r){var i=0,a=0,o=0,s=0,c={},l=function(t,n,i){if(t?o++:(s++,c[n]=i),o+s===a){var l=0===s;r(l,e,l?void 0:c)}};for(var u in t)if(t.hasOwnProperty(u)&&(i+=this._syncMessageContentForThread(e,u,t[u],n-i,l),a++,i>=n))break;return i}},{key:"_syncMessageContentForThread",value:function(e,t,n,r,i){var a=this,o=0;if(_.Z.isArray(n)){var s=!1,c=0,l=[],u=function(n,r){if(r?(c++,a._notifyContentCached(e,t,n)):l.push(n),s&&c+l.length===o){var u=0===l.length;i(u,t,u?void 0:l)}};n.forEach((function(n){o<r&&a._requestRemoteMessageDataRaw(e,t,n,!1,(function(e,t){u(n,!!e)})),o++})),s=!0}else this._requestRemoteThreadDataRaw(e,t,(function(n,r){n?a._handleContentSyncdThread(e,n,(function(n){a._notifyContentCached(e,t),i(n,t)})):i(!1,t,!0)})),o++;return o}},{key:"_handleContentSyncdMessage",value:function(e,t,n,r){n.error||(n.internalDate=new Date(+n.internalDate),n.payload.id=n.id,n.payload.internalDate=n.internalDate,this._rawCache.saveEntry(n.payload)),r&&r(!0)}},{key:"_handleContentSyncdThread",value:function(e,t,n){for(var r=0,i=0;i<t.messages.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=t.messages[i];this._handleContentSyncdMessage(e,t.id,a,n)}}},{key:"scheduleEmail",value:function(e,t){var n=this,r=e.getAttachmentByPlugin(this.id);try{_.Z.PAssert(883,r,"Must be able to get a valid attachment from item")}catch(l){_.Z.reportError(l)}var i=r.getField("subject"),a=this.getURLForAttachment(r),o=w.Z.MSPerHour,s=_o.pluginManager.getPluginGCalendar();if(s){var c=s.getDefaultExportCalendarID();c?s.createEventForEmail(c,i,a,t,o,(function(e,t){e||t?t?(n.addLabelToAttachment(r,"Moo.do/Scheduled"),n.getSetting(n.Settings.ArchiveOnSchedule)&&n.archiveAttachment(r)):t||_o.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:w.Z.MessageAction.Okay}):_o.toasts.pushMessage({text:"There was an error adding the email to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:function(){_o.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:w.Z.MessageAction.Okay})}})})):_o.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:w.Z.MessageAction.OpenCalendarSettings})}else _o.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule emails.",action:w.Z.MessageAction.OpenSettings})}},{key:"getIconInfoForLabel",value:function(e){var t,n,r=!1,i=16;switch(e.getParsedText()){case"Inbox":n="inbox2",t=w.Z.ColorBrand;break;case"Starred":n="star",t="#fd3";break;case"Important":n="exclamation",t="#d43";break;case"Sent Mail":n="send",t="#08c",i=13;break;case"Draft":n="drafts",t="#fafafa";break;case"Archived":n="task",i=13;break;case"Trash":n="delete",t="#ff738c";break;case"Primary":n="user";break;case"Social":n="group",i=13;break;case"Promotions":n="tag";break;case"Updates":n="flag";break;case"Forums":n="question_answer";break;case"Chat":n="chat";break;case"Spam":n="warning";break;default:r}return{icon:n,color:t,size:i}}},{key:"archiveItem",value:function(e,t){var n=t.getAttachmentByPlugin(this.id);try{_.Z.PAssert(884,n,"Must be able to get a valid attachment")}catch(r){_.Z.reportError(r)}!e&&this.isItemArchived(t)?this.performAction(w.Z.PluginAction.Gmail.Unarchive,!1,n):e&&!this.isItemArchived(t)&&this.performAction(w.Z.PluginAction.Gmail.Archive,!1,n)}},{key:"deleteItem",value:function(e,t){var n=e.getAttachmentByPlugin(this.id);try{_.Z.PAssert(885,n,"Must be able to get a valid attachment")}catch(r){_.Z.reportError(r)}t&&t.isDraft()&&this.itemHasDraft(e)?this.performAction(w.Z.PluginAction.Gmail.DiscardDraft,!0,n):t&&t.isTrash()&&this.isItemFullTrashed(e)?this.performAction(w.Z.PluginAction.Gmail.Untrash,!1,n):this.isItemFullTrashed(e)||this.performAction(w.Z.PluginAction.Gmail.Trash,!1,n)}},{key:"undeleteItem",value:function(e){var t=e.getAttachmentByPlugin(this.id);try{_.Z.PAssert(886,t,"Must be able to get a valid attachment")}catch(n){_.Z.reportError(n)}this.isItemFullTrashed(e)&&this.performAction(w.Z.PluginAction.Gmail.Untrash,!1,t)}},{key:"removeItemFromLabel",value:function(e,t){var n=t.getAttachmentByPlugin(this.id);try{_.Z.PAssert(887,n,"Must be able to get a valid attachment")}catch(r){_.Z.reportError(r)}e&&(e.isCustom()?this.performAction(w.Z.PluginAction.Gmail.RemoveLabel,!1,n,e.getName()):e.isInbox()?this.performAction(w.Z.PluginAction.Gmail.Archive,!1,n):e.isArchived()?this.performAction(w.Z.PluginAction.Gmail.Unarchive,!1,n):e.isStarred()&&this.performAction(w.Z.PluginAction.Gmail.Unstar,!1,n))}},{key:"moveEmailToItem",value:function(e,t,n){this.beginAction(),n||(e=e.clone(t,w.Z.ChangeType.Local));var r=e.getAttachmentByPlugin(this.id);try{_.Z.PAssert(888,r,"Must be able to get a valid attachment")}catch(i){_.Z.reportError(i)}this.performAction(w.Z.PluginAction.Gmail.Move,!1,r,e,t),this.getSetting(this.Settings.ArchiveOnOrganize)&&this.performAction(w.Z.PluginAction.Gmail.Archive,!1,r),this.attachmentHasLabel(r,"Moo.do/Handled")||this.performAction(w.Z.PluginAction.Gmail.AddLabel,!1,r,"Moo.do/Handled"),this.endAction()}},{key:"getLastMessage",value:function(e){var t=e.getField("messages")||[],n=t.length-1;return this.isMessageDraft(t[n])&&!this.getAttachField(e,"pendingSend")&&n--,t[n]}},{key:"sendEmail",value:function(){var e=a()(k().mark((function e(t,n){var r=this;return k().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){r.sendDraft(t,n.id,n.draftID,void 0,(function(n,r){_o.EmailPreview.ensureDisplayMessages(t),n||(_.Z.isHTTPStatusCode(r,w.Z.HTTPStatusCode.Network)?_o.toasts.pushMessage({text:"You are offline. Your message will be sent when Moo.do is open and you are online.",action:w.Z.MessageAction.Okay,hold:!0}):r&&_o.toasts.pushMessage({text:"There was an error sending your message. Please try again in a minute.",action:w.Z.MessageAction.Okay})),e(!!n)}))||e(!1)})));case 1:case"end":return e.stop()}}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getStyledText",value:function(e,t,n,r){return Sr.Z.renderStyled(e,t,n,r)}},{key:"getUnstyledText",value:function(e){return Sr.Z.renderPlain(e)}},{key:"getTextIconPadding",value:function(){return 24}},{key:"getEntryDateAsNumber",value:function(e){return"number"===typeof e&&e||"string"===typeof e&&+new Date(e)||+e}},{key:"isEnabled",value:function(){return!1}}]),n}(vn),P()(qr.prototype,"_notifyPendingDraftUpdate",[S.ZP],Object.getOwnPropertyDescriptor(qr.prototype,"_notifyPendingDraftUpdate"),qr.prototype),P()(qr.prototype,"runLabelSync",[S.ZP],Object.getOwnPropertyDescriptor(qr.prototype,"runLabelSync"),qr.prototype),P()(qr.prototype,"runThreadSync",[S.ZP],Object.getOwnPropertyDescriptor(qr.prototype,"runThreadSync"),qr.prototype),P()(qr.prototype,"compareCachedData",[S.ZP],Object.getOwnPropertyDescriptor(qr.prototype,"compareCachedData"),qr.prototype),P()(qr.prototype,"removeItemFromLabel",[S.ZP],Object.getOwnPropertyDescriptor(qr.prototype,"removeItemFromLabel"),qr.prototype),qr);var ca;function la(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}var ua="Gmail";function da(e){var t={subject:e.subject||"",from:e.from||"",id:e.mailMessageId?e.mailMessageId:"mailbird_"+e.id,latestMessageAt:e.latestMessageAt};return e.gmailID&&(t.provider="Gmail",t.threadID=e.gmailID),t}var ha=new(function(){function e(){s()(this,e)}return l()(e,[{key:"dragOver",value:function(e){var t=_.Z.elementFromPoint(e.x,e.y);if(t){var n=void 0!==this._prevX?e.x-this._prevX:0,r=void 0!==this._prevY?e.y-this._prevY:0;this._prevX=e.x,this._prevY=e.y;var i={clientX:e.x,clientY:e.y,diffX:n,diffY:r,target:t,dataTransfer:{}};_o.DragDrop.handleDragOver(i)}}},{key:"drop",value:function(e){var t=_.Z.elementFromPoint(e.x,e.y);var n={clientX:e.x,clientY:e.y,target:t,dataTransfer:{getData:function(t){if("mailbird/email"===t)return da(e)}}};setTimeout((function(){_o.DragDrop.handleDrop(n)}),0)}},{key:"dragLeave",value:function(){_o.DragDrop.handleDragLeave({target:document.getElementById("container")})}},{key:"reportError",value:function(e){_.Z.reportError(new Error(e))}}]),e}());const pa=(ca=function(e){p()(n,e);var t=la(n);function n(){var e;if(s()(this,n),(e=t.call(this,w.Z.PluginID.Mailbird,"b","Mailbird",!0)).declareProperty("subject",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full|w.Z.PluginLoad.Inline,!1,""),e.declareProperty("from",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full|w.Z.PluginLoad.Inline,!1,""),e.declareProperty("date",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full,!0,new Date),e.declareProperty("subjectLower",w.Z.PluginLoad.Runtime,!1,""),e.declareProperty("fromLower",w.Z.PluginLoad.Runtime,!1,""),e.declareProperty("unread",w.Z.PluginLoad.Runtime,!0,!1),e.declareProperty("snippet",w.Z.PluginLoad.Runtime,!0,""),e.declareProperty("count",w.Z.PluginLoad.Runtime,!0,1),e.declareProperty("latestMessageAt",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full|w.Z.PluginLoad.Inline,!1),e.declareProperty("provider",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full|w.Z.PluginLoad.Inline,!0),e.declareProperty("threadID",w.Z.PluginLoad.Preview|w.Z.PluginLoad.Full|w.Z.PluginLoad.Inline,!0),e.declareProperty("hasAttachments",w.Z.PluginLoad.Full,!0,!1),e.isMailbirdEmbed=D.Z.embed===w.Z.EmbedApps.Mailbird,e.isMailbirdEmbed){e.setSetting(e.Settings.IsEnabled,!0),e._needInlineDataUpdate=[],_o.nativeBridge.registerEmbedBridge(Pr()(e));var r=_o.nativeBridge.registerInboundAPI("mailbird");try{_.Z.PAssert(639,r,"Error creating native inbound API for mailbird")}catch(i){_.Z.reportError(i)}r&&(r.registerVariable("_prevX"),r.registerVariable("_prevY"),r.registerFunction("dragOver",ha.dragOver,!0),r.registerFunction("drop",ha.drop,!0),r.registerFunction("dragLeave",ha.dragLeave,!0),r.registerFunction("reportError",ha.reportError,!0)),e._mailbirdOutAPI=_o.nativeBridge.registerOutboundAPI("mailbird");try{_.Z.PAssert(640,e._mailbirdOutAPI,"Error creating native outbound API for mailbird")}catch(i){_.Z.reportError(i)}e._mailbirdOutAPI&&(e._mailbirdOutAPI.requireFunction("selectConversation"),e._mailbirdOutAPI.requireFunction("selectConversationEx",!0),e._mailbirdOutAPI.requireFunction("scheduleNotifications",!0),e._mailbirdOutAPI.requireFunction("getByIdEx",!0),e._canUpdateInlineData=e._mailbirdOutAPI.hasOptionalFunction("getByIdEx"))}return e}return l()(n,[{key:"getPaneIcon",value:function(){return"icon-envelope"}},{key:"useItemStore",value:function(){return"Mailbird"}},{key:"_addRemoteEntry",value:function(e){var t={id:e.id,provider:e.provider,threadID:e.threadID,subject:e.subject,subjectLower:e.subject.toLowerCase(),from:e.from,fromLower:e.from.toLowerCase(),latestMessageAt:e.latestMessageAt};return this.cacheData(t.id,t),t}},{key:"createEntryFromLocal",value:function(e,t){return t.subjectLower=t.subject.toLowerCase(),t.fromLower=t.from.toLowerCase(),t}},{key:"getAttachmentClass",value:function(e){return["plugin_mailbird"]}},{key:"isPluginBlocked",value:function(){return!1}},{key:"handleEmbedMessage",value:function(e,t){switch(e){case"scheduledItems":if(this._mailbirdOutAPI.hasOptionalFunction("scheduleNotifications"))try{var n=JSON.stringify(t);this._mailbirdOutAPI.call("scheduleNotifications",n)}catch(r){_.Z.reportError(r)}break;default:try{_.Z.PAssert(641,!1,"Unknown embed message: "+e)}catch(i){_.Z.reportError(i)}}}},{key:"handleDropEvent",value:function(e,t){try{_.Z.PAssert(642,t,"Must provide a valid callback to the drop event")}catch(a){_.Z.reportError(a)}if(e.dataTransfer){var n=e.dataTransfer.getData("mailbird/email");if(n){var r=this._addRemoteEntry(n),i=this.getAttachment(r.id,r);try{_.Z.PAssert(643,i.isLoaded(),"Mailbird attachments must always be loaded after creation")}catch(a){_.Z.reportError(a)}return t(this.getAttachmentEmbedString(i)),!0}}return!1}},{key:"handleTapClick",value:function(e,t,n,r){var i=this.getCacheData(n);if(!i){var a=this.getAttachment(n);a&&(i=a.getInlineData())}if(i){if(this.isMailbirdEmbed){var o;if(!i.id.startsWith("mailbird_")&&this._mailbirdOutAPI.hasOptionalFunction("selectConversationEx")){var s=null;if("Gmail"===i.provider){try{_.Z.PAssert(644,i.threadID,"Must provide a valid Gmail ID if it is defined as the provider")}catch(u){_.Z.reportError(u)}s=parseInt(i.threadID)}var c=i.id;o=this._mailbirdOutAPI.call("selectConversationEx",s,c,+i.latestMessageAt)}else{var l=i.id.replace("mailbird_","");o=this._mailbirdOutAPI.call("selectConversation",l)}try{_.Z.PAssert(645,void 0!==o,"Must always receive a value back from Mailbird")}catch(u){_.Z.reportError(u)}if(!0===o||!1===o)try{_.Z.PAssert(646,o,"Must have successfully selected the email conversation in Mailbird: ",i.id,i.provider)}catch(u){_.Z.reportError(u)}else{try{_.Z.PAssert(647,o&&o.then,"Must have a valid promise object returned")}catch(u){_.Z.reportError(u)}o.then((function(e){try{_.Z.PAssert(648,e,"Must have successfully selected the email conversation in Mailbird: ",i.id,i.provider)}catch(u){_.Z.reportError(u)}}),(function(e){try{_.Z.PAssert(649,!1,"Failed to successfully select the email conversation in Mailbird: ",i.id,i.provider)}catch(u){_.Z.reportError(u)}}))}}else switch(i.provider){case ua:_.Z.openUrl("https://mail.google.com/mail/u/0/#inbox/"+i.threadID);break;default:_o.toasts.pushMessage(w.Z.MessageID.MailbirdClick)}return!0}return!1}},{key:"getDisplayTags",value:function(e){return[]}},{key:"getDisplayParticipants",value:function(e){return""}},{key:"matchAttachment",value:function(e,t){return e.getField("fromLower").indexOf(t)>=0||e.getField("subjectLower").indexOf(t)>=0}},{key:"findMatchExact",value:function(e){}},{key:"findMatchLike",value:function(e,t){var n=e.toLowerCase();return this.findCachedItemsByFn((function(e){return e.subjectLower.indexOf(n)>=0||e.fromLower.indexOf(n)>=0}),t)}},{key:"requestData",value:function(e,t){e.hasField("subject")?(e.notifyDataLoaded(w.Z.PluginLoad.Full,!1,void 0,w.Z.ChangeType.Remote),e.hasInlineData()||!this.isMailbirdEmbed||this._needInlineDataUpdate.includes(e)||(this._needInlineDataUpdate.push(e),this._timeoutInlineDataUpdate||(this._timeoutInlineDataUpdate=setTimeout(this.processMissingInlineUpdates,1e3))),e.hasField("latestMessageAt")||this.requestMissingData(e)):this.requestMissingData(e)}},{key:"requestMissingData",value:function(e){var t=this;this._canUpdateInlineData&&setTimeout((function(){t._mailbirdOutAPI.call("getByIdEx",e.id).then((function(n){try{var r=JSON.parse(n);if(r){var i=da(r);t.cacheData(i.id,i),t.fixAttach(e)}}catch(a){_.Z.reportError(a)}}))}),1e3)}},{key:"processMissingInlineUpdates",value:function(){var e=this._needInlineDataUpdate;if(e.length>0)for(var t=0,n=0;n<e.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[n];r.isLoaded()&&this.fixAttach(r)}}},{key:"fixAttach",value:function(e){}},{key:"getStyledText",value:function(e,t,n,r){return Sr.Z.renderStyled(e,t,n,r)}},{key:"getUnstyledText",value:function(e){return Sr.Z.renderPlain(e)}}]),n}(vn),P()(ca.prototype,"processMissingInlineUpdates",[S.ZP],Object.getOwnPropertyDescriptor(ca.prototype,"processMissingInlineUpdates"),ca.prototype),ca);function fa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}var ga=1,ma=3,va=4,ya=5,ka=6,_a=7,Za=8,wa=9,ba=10,Pa=11,Sa=12,Da=13,Ia=6,Ea="createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)";const xa=function(e){p()(n,e);var t=fa(n);function n(){var e;return s()(this,n),(e=t.call(this,w.Z.PluginID.Moodo,"m","Moodo",!0)).setSetting(e.Settings.IsEnabled,!0,!1),e}return l()(n,[{key:"isPluginBlocked",value:function(){return!1}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"hasSyncAccount",value:function(e,t){return d()(v()(n.prototype),"hasSyncAccount",this).call(this,e,t)||_o.pluginManager.getPluginDrive().hasSyncAccount(e,t)}},{key:"getRemoteAttachmentData",value:function(e){this.cacheData(e.id,{})}},{key:"runRemoteSingleRequest",value:function(e,t,n,r,i,a,o){this._queueRemoteRequestMulti(e,t,n,r,i,void 0,a||ga,o)}},{key:"runRemotePagedRequest",value:function(e,t,n,r,i,a,o){a||(a={}),this._queuePagedRemoteRequestMulti(e,t,n,r,i,void 0,o,a)}},{key:"drivePermissionsInsert",value:function(e,t,n,r,i,a){try{_.Z.PAssert(650,_.Z.isEmail(n),"Should pass in a valid email address")}catch(c){_.Z.reportError(c)}var o=$t.Z.fns("drive").permissions.insert.packedFn,s={fileId:t,sendNotificationEmails:r,resource:{value:n,type:"user",role:"writer",withLink:!1}};this.runRemoteSingleRequest(e,o,s,i,a,void 0,ma)}},{key:"drivePermissionsDelete",value:function(e,t,n,r,i){var a=$t.Z.fns("drive").permissions.delete.packedFn,o={fileId:t,permissionId:n};this.runRemoteSingleRequest(e,a,o,r,i,void 0,va)}},{key:"drivePermissionsList",value:function(e,t,n,r){var i=$t.Z.fns("drive").permissions.list.packedFn,a={fileId:t,fields:"items(id,name,role,type,emailAddress)"};this.runRemoteSingleRequest(e,i,a,n,r,void 0,ya)}},{key:"drivePermissionsPublic",value:function(e,t,n,r){var i=$t.Z.fns("drive").permissions.insert.packedFn,a={fileId:t,sendNotificationEmails:!1,resource:{type:"anyone",role:"reader",withLink:!0}};this.runRemoteSingleRequest(e,i,a,n,r,void 0,ma)}},{key:"driveFilesGet",value:function(e,t,n,r,i){var a=$t.Z.fns("drive").files.get.packedFn,o={fileId:t,fields:Ea};i&&i.props&&Object.assign(o,i.props),this.runRemoteSingleRequest(e,a,o,n,r,void 0,ka)}},{key:"driveFilesExport",value:function(e,t,n,r,i){var a=$t.Z.fns("drive").files.export.packedFn,o={fileId:t,mimeType:"application/vnd.google-apps.drive-sdk.597847337936"};this.runRemoteSingleRequest(e,a,o,n,r,void 0,Ia)}},{key:"driveFilesList",value:function(e,t,n,r,i){var a=$t.Z.fns("drive").files.list.packedFn,o={q:t,fields:"items(createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)),nextPageToken"};i&&i.props&&Object.assign(o,i.props),this.runRemotePagedRequest(e,a,o,n,r,void 0,_a)}},{key:"driveFilesTrash",value:function(e,t,n,r){var i=$t.Z.fns("drive").files.trash.packedFn,a={fileId:t};this.runRemoteSingleRequest(e,i,a,n,r,void 0,_a)}},{key:"driveFilesUntrash",value:function(e,t,n,r){var i=$t.Z.fns("drive").files.untrash.packedFn,a={fileId:t};this.runRemoteSingleRequest(e,i,a,n,r,void 0,Za)}},{key:"drivePropertiesInsert",value:function(e,t,n,r,i,a){var o=$t.Z.fns("drive").properties.insert.packedFn,s={fileId:t,resource:{key:n,value:r,visibility:"PRIVATE"}};this._queueRemoteRequestMulti(e,o,s,i,a,void 0,wa)}},{key:"drivePropertiesUpdate",value:function(e,t,n,r,i,a){var o=$t.Z.fns("drive").properties.update.packedFn,s={fileId:t,propertyKey:n,resource:{key:n,value:r,visibility:"PRIVATE"}};this.runRemoteSingleRequest(e,o,s,i,a,void 0,ba)}},{key:"driveParentsInsert",value:function(e,t,n,r,i){var a=$t.Z.fns("drive").parents.insert.packedFn,o={fileId:t,resource:{id:n}};this.runRemoteSingleRequest(e,a,o,r,i,void 0,Pa)}},{key:"driveParentsDelete",value:function(e,t,n,r,i){var a=$t.Z.fns("drive").parents.delete.packedFn,o={fileId:t,parentId:n};this.runRemoteSingleRequest(e,a,o,r,i,void 0,Sa)}},{key:"driveChildrenList",value:function(e,t,n,r,i){var a=$t.Z.fns("drive").children.list.packedFn,o={folderId:t,fields:"items(id),nextPageToken"};this.runRemoteSingleRequest(e,a,o,n,r,void 0,Da)}}]),n}(vn);var Ca;function Aa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}var La=_.Z.seconds(30),Ma={Email:{a:"accountID",t:"text",s:"service"},Gmail:{a:"accountID",s:"subject"}};const Ta=(Ca=function(e){p()(n,e);var t=Aa(n);function n(){var e;return s()(this,n),(e=t.call(this))._plugins={},e._activePlugins=[],e._loadedDependencies={},e._iteratingPlugins=!1,e._hasAdjustedCacheSizeRatio=!1,e._queueTimeout=void 0,e._forcedLastPossible=!1,e._numOutstandingReqs=0,_.Z.isDemoMode()||ie.Z.onAuthTokensUpdated.listen(e.pokeRequestQueues),e}return l()(n,[{key:"init",value:function(){var e=this;this._setupRequestQueues(),_.Z.isDemoMode()&&this.notifyDependencyLoad(w.Z.PluginDependency.DemoMode);var t=function(){"Online"===j.Z.onlineStatus.get()&&ie.Z.isLoaded.get()&&e.goOnline()};_.Z.isDemoMode()||(j.Z.onlineStatus.listen(t),ie.Z.isLoaded.listen(t),D.Z.onForeground.listen(t)),ue.Z.listen("resetEverything",this._clearRequestQueues),this.registerPlugins()}},{key:"printStats",value:function(e){if(_.Z.log("---- Plugin Stats ----"),void 0!==e){var t=this._plugins[e];_.Z.log(t.name),_.Z.log(" Stats: ",t.getStats())}else for(var n=0,r=Object.keys(this._plugins),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this._plugins[r[i]],o=a.getStats();_.Z.log(a.name),_.Z.log(" Stats: ",o)}_.Z.log("----------------------")}},{key:"dumpQueueState",value:function(){var e=0,t=Object.keys(this._plugins);console.log("Queue State: ["+this._numOutstandingReqs+"]");for(var n=0;n<t.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this._plugins[t[n]];console.log(r.name),r.dumpRequestQueue(!1)}}},{key:"dumpQueueStats",value:function(){for(var e=0,t=Object.keys(this._plugins),n=0;n<t.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this._plugins[t[n]];console.log(r.name),r.dumpQueueStats()}}},{key:"getStats",value:function(e){var t={};if(void 0!==e)t[e]=this._plugins[e].getStats();else for(var n=0,r=Object.keys(this._plugins),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this._plugins[r[i]];t[a.id]=a.getStats()}return t}},{key:"getCacheStats",value:function(e,t){var n=this,r={};void 0!==e?this._plugins[e].getCacheStats(t):function(){for(var e=0,i=Object.keys(n._plugins),a=0,o=0;o<i.length;++o){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n._plugins[i[o]].getCacheStats(function(e,n){n&&(r[e]=n),i.length===++a&&t(r)}.bind(n,i[o]))}}()}},{key:"getState",value:function(e){var t={};if(void 0!==e)t[e]=this._plugins[e].getState();else for(var n=0,r=Object.keys(this._plugins),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this._plugins[r[i]];t[a.id]=a.getState()}return t}},{key:"registerPlugins",value:function(){try{this.registerPlugin(new xa)}catch(t){_.Z.reportError(t)}try{this.registerPlugin(new Kn)}catch(t){_.Z.reportError(t)}try{var e=new sa;this.registerPlugin(e),this._plugins[w.Z.PluginID.Email]=e}catch(t){_.Z.reportError(t)}try{this.registerPlugin(new wr)}catch(t){_.Z.reportError(t)}try{this.registerPlugin(new pa)}catch(t){_.Z.reportError(t)}this.registerPlugin(new kn)}},{key:"registerPlugin",value:function(e){try{_.Z.PAssert(374,!this._plugins[e.id],"Should never double-register a plguin")}catch(t){_.Z.reportError(t)}this._plugins[e.id]=e,this.isAuthorized(e.id)&&this.loadPlugin(e.id)}},{key:"getPlugin",value:function(e){return this._plugins[e]}},{key:"getPluginGmail",value:function(){return this._plugins[w.Z.PluginID.Gmail]}},{key:"getPluginDrive",value:function(){return this._plugins[w.Z.PluginID.Drive]}},{key:"getPluginGCalendar",value:function(){return this._plugins[w.Z.PluginID.GCalendar]}},{key:"loadPlugin",value:function(e){var t=this.getPlugin(e);try{_.Z.PAssert(375,t,"Must register a plugin before loading it")}catch(n){_.Z.reportError(n)}this.activatePlugin(t)}},{key:"unloadPlugin",value:function(e){}},{key:"authorizePlugin",value:function(e,t,n){n(!0)}},{key:"deauthorizePlugin",value:function(e,t){try{_.Z.PAssert(378,t&&_.Z.isFunction(t),"Must provide a valid callback fn")}catch(r){_.Z.reportError(r)}var n=this.getPlugin(e);try{_.Z.PAssert(379,n,"Must register a plugin before loading it")}catch(r){_.Z.reportError(r)}n.setSetting(n.Settings.IsEnabled,!1),_.Z.shouldLog(w.Z.LogLevels.Plugin)&&_.Z.log("Plugin Deauthorized: ",e),this.deactivatePlugin(n),t(!0)}},{key:"onPluginAuthorized",value:function(e,t){e.setSetting(e.Settings.IsEnabled,t),_.Z.shouldLog(w.Z.LogLevels.Plugin)&&_.Z.log("Plugin Authorized: ",e.id,t),t&&this.activatePlugin(e)}},{key:"activatePlugin",value:function(e){try{_.Z.PAssert(380,e,"Plugin must be valid to be activated")}catch(t){_.Z.reportError(t)}e.activate(this._loadedDependencies)&&this._activePlugins.indexOf(e.id)<0&&this._activePlugins.push(e.id),e.ensurePaneTypeIsActive(),_.Z.shouldLog(w.Z.LogLevels.Plugin)&&_.Z.log("Plugin Activated: ",e.id)}},{key:"deactivatePlugin",value:function(e){try{_.Z.PAssert(381,e,"Plugin must be valid to be deactivated")}catch(t){_.Z.reportError(t)}this._activePlugins.indexOf(e.id)>=0&&(e.deactivate()&&this._activePlugins.remove(e.id),_.Z.shouldLog(w.Z.LogLevels.Plugin)&&_.Z.log("Plugin Deactivated: ",e.id))}},{key:"isOnline",value:function(){return j.Z.isConnected()||_.Z.isDemoMode()}},{key:"goOnline",value:function(){var e=this;setTimeout((function(){var t=0;e._setupRequestQueues(!0);for(var n=0;n<e._activePlugins.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e._plugins[e._activePlugins[n]];try{r.goOnline()}catch(i){e._reportPluginError(i)}}}),0)}},{key:"onDocumentShared",value:function(e){for(var t=0,n=0;n<this._activePlugins.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._plugins[this._activePlugins[n]];try{r.onDocumentShared(e)}catch(i){this._reportPluginError(i)}}}},{key:"onShutdown",value:function(){for(var e=0,t=[],n=0;n<this._activePlugins.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this._plugins[this._activePlugins[n]];try{var i=r.onShutdown();i&&t.push(i)}catch(a){this._reportPluginError(a)}}return t.length>0?t:void 0}},{key:"onClearData",value:function(){for(var e=0,t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._plugins[this._activePlugins[t]];try{n.clearData()}catch(r){this._reportPluginError(r)}}}},{key:"getCacheSizeRatio",value:function(){var e=_o.settings.cacheSizeRatio.get()||1;try{_.Z.PAssert(382,e>=0&&e<=1,"Invalid ratio value: "+e)}catch(t){_.Z.reportError(t)}return e}},{key:"hasAdjustedCacheSizeRatio",value:function(){return this._hasAdjustedCacheSizeRatio}},{key:"_adjustCacheSizeRatio",value:function(){var e=this.getCacheSizeRatio();1===e&&_.Z.sendEvent("CacheRatioChange","FromDefault");e>.35?e-=.1:_.Z.sendEvent("CacheRatioChange","Minimum"),_.Z.sendEvent("CacheRatioChange","Change",e),_o.settings.cacheSizeRatio.set(e)}},{key:"onCacheLimitExceeded",value:function(){if(!this._hasAdjustedCacheSizeRatio){var e=0;this._hasAdjustedCacheSizeRatio=!0,this._adjustCacheSizeRatio();for(var t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._plugins[this._activePlugins[t]];try{n.onCacheLimitExceeded()}catch(r){this._reportPluginError(r)}}}}},{key:"getPluginsForType",value:function(e){var t;switch(e){case w.Z.PluginType.Calendar:t=[w.Z.PluginID.GCalendar];break;case w.Z.PluginType.Email:t=[w.Z.PluginID.Gmail];break;case w.Z.PluginType.Storage:t=[w.Z.PluginID.Drive];break;case w.Z.PluginType.Unknown:t=[w.Z.PluginID.Mailbird,w.Z.PluginID.Moodo]}return t}},{key:"hasAttachmentType",value:function(e,t){var n=!1;if(e.hasAttachments())for(var r=0,i=this.getPluginsForType(t),a=0;a<i.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(e.hasPluginAttachment(i[a])){n=!0;break}}return n}},{key:"allowTextEditing",value:function(e){var t=!0;if(e&&e.hasAttachments())for(var n=0,r=e.getAttachments(),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(!r[i].getPlugin().allowTextEditing(e,r[i])){t=!1;break}}return t}},{key:"validatePlugin",value:function(e){}},{key:"runForEachPlugin",value:function(e){var t=0;this._iteratingPlugins=!0;for(var n=0;n<this._activePlugins.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{e(this.getPlugin(this._activePlugins[n]))}catch(r){_.Z.reportError(r)}}this._iteratingPlugins=!1}},{key:"getAttachment",value:function(e,t){try{_.Z.PAssert(383,e.p,"Must specify the plugin string to be used: ",e)}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(384,e.id,"Must specify the ID of the data to use from the plugin: ",e)}catch(r){_.Z.reportError(r)}var n=this.getPlugin("Email"===e.p?"Gmail":e.p);try{_.Z.PAssert(385,n,"Must specify a valid plugin: ",e)}catch(r){_.Z.reportError(r)}if(n)return n.getAttachment(e.id,t?e:void 0)}},{key:"createDisplayElement",value:function(e,t){try{_.Z.PAssert(386,e.p,"Must specify the plugin string to be used")}catch(a){_.Z.reportError(a)}try{_.Z.PAssert(387,e.id,"Must specify the ID of the data to use from the plugin")}catch(a){_.Z.reportError(a)}var n,r=this.getPlugin(e.p);if(r){var i=this.getAttachment(e,t);if(i)try{n=r.createDisplayElement(i)}catch(o){this._reportPluginError(o),n=this.createUnknownPluginElement(e.p)}else n=this.createUnknownPluginElement(e.p)}else n=this.createUnknownPluginElement(e.p);return n}},{key:"createUnknownPluginElement",value:function(e){return{attrs:{cls:[],isUnknown:!0,plugin:w.Z.PluginID.Moodo,"plugin-id":"Invalid"}}}},{key:"parseAttachmentEmbedString",value:function(e,t){try{_.Z.PAssert(388,e,"Must provide a valid string to parse")}catch(o){_.Z.reportError(o)}var n,r=e.replace(/&quot;/g,'"').split(","),i={};if(r.forEach((function(e){var t,r=e.indexOf(":"),a=e.substr(0,r);a=n&&(null===(t=Ma[n])||void 0===t?void 0:t[a])||a;var o=e.substr(r+1,e.length-r-1);if("p"!==a&&"id"!==a)try{o=decodeURIComponent(o)}catch(s){}i[a]=o,"p"===a&&(n=o)})),t){var a=r.length>2;i.displayElement=this.createDisplayElement(i,a),i.hasInlineData=a}return i}},{key:"createSimpleAttachment",value:function(e){return e.isSimpleAttachment=!0,e}},{key:"handleDropEvent",value:function(e,t){for(var n=0,r=e.dataTransfer,i=e.clipboardData,a=e.target,o=!1,s=!1,c=0;c<this._activePlugins.length&&!o;++c){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=this._activePlugins[c],u=this.getPlugin(l);try{o=u.handleDropEvent({dataTransfer:r,clipboardData:i,target:a},t)}catch(y){this._reportPluginError(y),s=!0}}if(!o){var d,h=null===r||void 0===r?void 0:r.files;if((null===h||void 0===h?void 0:h.length)>0||(null===i||void 0===i||null===(d=i.items)||void 0===d?void 0:d.length)>0){var p=!1;if(D.Z.isNativeApp()&&(null===h||void 0===h?void 0:h.length)>0){for(var f=0,g=0;g<h.length;g++){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;var m=h[g];m.path&&(t("[".concat(m.name,"](file://").concat(m.path.replace(/\\/g,"/").replace(/ /g,"%20"),")")),p=!0)}_o.toasts.pushMessage({text:"Attached a link to the local file. If you want attached files to sync between devices please enable the Drive plugin in the settings.",action:w.Z.MessageAction.OpenSettings})}if(!p){var v=s?{text:"An error was detected handling drag drop and the developers have been notified",action:w.Z.MessageAction.OpenFilesSettings}:{text:"Attaching files uses Google DriveP. lease enable Drive in the settings.",action:w.Z.MessageAction.OpenFilesSettings};_o.toasts.pushMessage(v),o=!0}}}return o}},{key:"handleTapClick",value:function(e,t,n){var r=!1,i=e.props.plugin,a=i.p,o=i.id,s=this.getPlugin(a);try{_.Z.PAssert(389,s,"Must be able to get a valid plugin from a plugin element")}catch(d){_.Z.reportError(d)}if(s.isPluginBlocked())_o.toasts.pushMessage(w.Z.MessageID.PremiumRequired),r=!0;else{try{_.Z.PAssert(390,o,"Must have a valid item ID for a plugin element")}catch(d){_.Z.reportError(d)}try{var c,l=t.item,u=t.pane;r=null===(c=s.handleTapClick)||void 0===c?void 0:c.call(s,l,u,o,n)}catch(h){this._reportPluginError(h)}}return r}},{key:"isAuthorized",value:function(e){return!(!_.Z.isDemoMode()||e===w.Z.PluginID.Gmail)||!!this.getPlugin(e)&&!!this.getSetting(e,this.getPlugin(e).Settings.IsEnabled)}},{key:"getSetting",value:function(e,t){return this.getPlugin(e).getSetting(t)}},{key:"setSetting",value:function(e,t,n){return this.getPlugin(e).setSetting(t,n)}},{key:"onAuthorizedSetting",value:function(e,t,n){this.getPlugin(e).onAuthorizedSetting(t,n)}},{key:"notifyDependencyLoad",value:function(e,t){for(var n in this._loadedDependencies[e]=t||!0,this._plugins)if(this._plugins.hasOwnProperty(n))try{this.getPlugin(n).onDependencyLoaded(e,t)}catch(r){this._reportPluginError(r)}}},{key:"notifyDependencyUnload",value:function(e,t){}},{key:"_handleBatchRequestResponse",value:function(e,t){try{_.Z.PAssert(392,e,"Plugin must be passed to response to know who is handling it")}catch(n){_.Z.reportError(n)}this._numOutstandingReqs--;try{_.Z.PAssert(393,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(n){_.Z.reportError(n)}try{e._handleBatchRequestResponse(t)}catch(r){this._reportPluginError(r)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()}},{key:"_handleRequestResponse",value:function(e,t,n){try{_.Z.PAssert(394,t,"Plugin must be passed to response to know who is handling it")}catch(r){_.Z.reportError(r)}if(!n){this._numOutstandingReqs--;try{_.Z.PAssert(395,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(r){_.Z.reportError(r)}}try{t._handleRequestResponse(e,n)}catch(i){this._reportPluginError(i)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()}},{key:"notifyNoOutstandingReqs",value:function(){try{_.Z.PAssert(396,0===this._numOutstandingReqs,"Should only notify when there are no outstanding reqs left")}catch(e){_.Z.reportError(e)}0===this._numOutstandingReqs&&this._setupRequestQueues(!0)}},{key:"notifyHasPendingRemoteRequest",value:function(){this._numOutstandingReqs<6&&this._setupRequestQueues(!0)}},{key:"notifyAuthorizationAdded",value:function(e){this._numOutstandingReqs<6&&this._setupRequestQueues(!0),this.verifyAuthorization(e)}},{key:"verifyAuthorization",value:function(e,t){for(var n,r,i=0,a=0;a<this._activePlugins.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=this._activePlugins[a],s=this.getPlugin(o);if(s.isEnabled())!s.verifyAuthorization(e)&&(r=(r||[]).concat(s.googleScopes())),n=n||!s.verifyAuthorization(e)}}},{key:"pokeRequestQueues",value:function(){this._setupRequestQueues(!0)}},{key:"_setupRequestQueues",value:function(e){var t=e?1:La;this._forcedLastPossible||(clearTimeout(this._queueTimeout),this._queueTimeout=setTimeout(this._pumpRequestQueues,t)),this._forcedLastPossible=this._forcedLastPossible||!!e}},{key:"_pumpRequestQueues",value:function(){this._runPumpRequestQueues(w.Z.RequestPriority.UserBlocking),this._runPumpRequestQueues(w.Z.RequestPriority.Default),this._runPumpRequestQueues(w.Z.RequestPriority.Low)}},{key:"_runPumpRequestQueues",value:function(e){var t=0;if(this.isOnline()){var n=0,r=6-this._numOutstandingReqs;try{_.Z.PAssert(397,r>=0,"Should never have more than max outstanding requests at any given point in time")}catch(u){_.Z.reportError(u)}for(var i=0;r>0&&i<this._activePlugins.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=this._activePlugins[i],o=this.getPlugin(a),s=4-o.getNumOutstandingReqs();try{_.Z.PAssert(398,s>=0,"Must always have a postiive number of available plugin reqs")}catch(u){_.Z.reportError(u)}var c=Math.min(r,s);if(c>0&&o.isReady()){var l=0;try{l=o._pumpRequestQueue(e,c,this._handleRequestResponse,this._handleBatchRequestResponse);try{_.Z.PAssert(399,l>=0,"Number of requests sent can never be negative")}catch(u){_.Z.reportError(u)}}catch(d){this._reportPluginError(d)}try{_.Z.PAssert(400,r-l>=0,"Too Many requests sent")}catch(u){_.Z.reportError(u)}t+=l,r-=l,this._numOutstandingReqs+=l}}}else 0;return this._forcedLastPossible=!1,this._setupRequestQueues(),t}},{key:"_clearRequestQueues",value:function(){var e=0;this._numOutstandingReqs=0;for(var t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._activePlugins[t],r=this.getPlugin(n);try{r._clearRequestQueue()}catch(i){this._reportPluginError(i)}}}},{key:"_reportPluginError",value:function(e){_.Z.reportError(e)}},{key:"parseEmailURL",value:function(e){var t={accountID:void 0,threadID:void 0,plugin:void 0},n=/https:\/\/mail.google.com\/mail\/b\/(.*)#all\/(.*)/g.exec(e);return n&&(t.accountID=n[1],t.threadID=n[2],t.plugin=this.getPlugin(w.Z.PluginID.Gmail)),t}},{key:"isAvailable",value:function(e){return this.getPlugin(e).isAvailable()}},{key:"isActive",value:function(e){return this.getPlugin(e).isActive()}},{key:"isEnabled",value:function(e){return this.getPlugin(e).isEnabled()}},{key:"isGmailEnabled",value:function(){return this.isEnabled(w.Z.PluginID.Gmail)}},{key:"isDriveEnabled",value:function(){return this.isEnabled(w.Z.PluginID.Drive)}},{key:"getPluginScopes",value:function(e,t){return e===w.Z.PluginID.Contacts?[w.Z.GScope.Contacts]:this.getPlugin(e).googleScopes(e===w.Z.PluginID.Drive&&t)}},{key:"getAllPluginScopes",value:function(e,t){return w.Z.ScopesDefault.concat(_.Z.arrayFlat(e.map((function(e){return _o.pluginManager.getPluginScopes(e,t)}))))}}]),n}(E.Z),P()(Ca.prototype,"goOnline",[S.ZP],Object.getOwnPropertyDescriptor(Ca.prototype,"goOnline"),Ca.prototype),P()(Ca.prototype,"_handleBatchRequestResponse",[S.ZP],Object.getOwnPropertyDescriptor(Ca.prototype,"_handleBatchRequestResponse"),Ca.prototype),P()(Ca.prototype,"_handleRequestResponse",[S.ZP],Object.getOwnPropertyDescriptor(Ca.prototype,"_handleRequestResponse"),Ca.prototype),P()(Ca.prototype,"pokeRequestQueues",[S.ZP],Object.getOwnPropertyDescriptor(Ca.prototype,"pokeRequestQueues"),Ca.prototype),P()(Ca.prototype,"_pumpRequestQueues",[S.ZP],Object.getOwnPropertyDescriptor(Ca.prototype,"_pumpRequestQueues"),Ca.prototype),P()(Ca.prototype,"_clearRequestQueues",[S.ZP],Object.getOwnPropertyDescriptor(Ca.prototype,"_clearRequestQueues"),Ca.prototype),P()(Ca.prototype,"getPluginScopes",[S.ZP],Object.getOwnPropertyDescriptor(Ca.prototype,"getPluginScopes"),Ca.prototype),Ca);var Ra;const Oa=new(Ra=function(){function e(){s()(this,e),this.scheduledItems=[],this.notifiedItems={},this.timeouts={},this.timeoutNextNotification=void 0,this.frequency=15*w.Z.MSPerMinute}return l()(e,[{key:"scheduleItems",value:function(e){var t=this;this.scheduledItems=e,D.Z.hasNotificationPermission()?this.runNotifications():Notification.requestPermission((function(){t.runNotifications()}))}},{key:"runNotifications",value:function(){for(var e=0,t=0;t<this.scheduledItems.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this.scheduledItems[t];this.notifiedItems[n.id]&&this.notifiedItems[n.id]===n.date||this.runNotification(n)}_.Z.shouldLog(w.Z.LogLevels.Timeline)&&_.Z.log("Next Notifications in: ",this.frequency),clearTimeout(this.timeoutNextNotification),this.timeoutNextNotification=setTimeout(this.runNotifications,this.frequency)}},{key:"runNotification",value:function(e){var t=e.id,n=new Date,r=e.alertDate,i=Math.max(r.getTime()-n.getTime(),0);i<0?this.doNotification(e):i<=this.frequency?(clearTimeout(this.timeouts[t]),this.timeouts[t]=setTimeout(this.doNotification.bind(this,e),i)):this.notifiedItems[t]=e.date}},{key:"doNotification",value:function(e){var t=e.date,n=Math.ceil((t.getTime()-Date.now())/w.Z.MSPerMinute);new Notification(e.text,{body:n>0?"in "+n+" minutes":"now",icon:D.Z.isNativeApp()?void 0:"/img/favicon-96x96.png",requireInteraction:!0});this.notifiedItems[e.id]=e.date,_.Z.shouldLog(w.Z.LogLevels.Timeline)&&_.Z.log("Show HTML5 Notification: ",e)}}]),e}(),P()(Ra.prototype,"runNotifications",[S.ZP],Object.getOwnPropertyDescriptor(Ra.prototype,"runNotifications"),Ra.prototype),Ra);const Fa=new(function(){function e(){s()(this,e)}return l()(e,[{key:"setNotifications",value:function(e){if(D.Z.app){var t=e.map((function(e){return{id:e.id,text:e.text,alertDate:+e.alertDate,date:+e.date,endDate:+e.endDate,message:"".concat(_o.International.formatDate(e.date,w.Z.DFormat.ShortTime)," - ").concat(_o.International.formatDate(e.endDate,w.Z.DFormat.ShortTime))}}));I.LA.setNotifications(t)}else D.Z.usesHTML5Notifications()?(Oa.scheduleItems(e),_.Z.shouldLog(w.Z.LogLevels.Timeline)&&_.Z.log("HTML5 Scheduling Completed: ",e.length)):_o.nativeBridge.isEnabled()?_o.nativeBridge.sendToApp("scheduledItems",this.convertForSend(e)):_o.nativeBridge.hasEmbedBridge()&&_o.nativeBridge.sendToEmbed("scheduledItems",this.convertForSend(e))}},{key:"convertForSend",value:function(e){return e.map((function(e){return{id:e.id,text:e.text,date:e.date.toJSON(),alertDate:e.date.toJSON()}}))}}]),e}());var Na,Ba=5e3;const Ua=(Na=function(){function e(){s()(this,e),this.notificationItems={},this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0,this.oldSoftDates=["now","next","soon","later","someday"],this.agendaSort=_o.settings.agendaSort}return l()(e,[{key:"clearDailyCaches",value:function(){}},{key:"addNotification",value:function(e){try{_.Z.PAssert(401,e,"Must provide a valid item to schedule notifications for")}catch(t){_.Z.reportError(t)}this.notificationItems[e.id]=e,this.numNotificationItemsChanged++,clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,Ba),_.Z.shouldLog(w.Z.LogLevels.Timeline)&&_.Z.log("Add Notification: ",e)}},{key:"removeNotification",value:function(e){try{_.Z.PAssert(402,e,"Must provide a valid item to unschedule notifications for")}catch(t){_.Z.reportError(t)}this.notificationItems[e.id]&&(this.notificationItems[e.id]=void 0,this.numNotificationItemsChanged++,clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,Ba),_.Z.shouldLog(w.Z.LogLevels.Timeline)&&_.Z.log("Remove Notification: ",e))}},{key:"clearNotifications",value:function(){var e=this;Object.keys(this.notificationItems).forEach((function(t){e.notificationItems[t]=void 0,e.numNotificationItemsChanged++})),clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,Ba),_.Z.shouldLog(w.Z.LogLevels.Timeline)&&_.Z.log("Clear Notifications")}},{key:"shouldNotify",value:function(e,t){var n=e.getNextDate();return!e.isDestroyed()&&!e.isDeleted()&&!e.isComplete()&&!e.hasCompletedAncestor()&&!e.allDayDate()&&n&&n>t&&+n-Date.now()<864e5}},{key:"updateNotifications",value:function(e){var t=this;if(D.Z.supportsNotifications()&&se.Z.isNotificationsEnabled()&&!_.Z.isDemoMode()){var n=new Date;e?(_.Z.__SINGLE_NOTIFICATION_UPDATES++,this.shouldNotify(e,n)?this.addNotification(e):this.removeNotification(e)):(_.Z.__FULL_NOTIFICATION_UPDATES++,this.clearNotifications(),j.Z.runOnAllDocumentRoots((function(e){_.Z.searchVMLIs({item:e,each:function(e){t.shouldNotify(e,n)&&t.addNotification(e)}})})))}}},{key:"setupNotifications",value:function(){var e=this;try{_.Z.PAssert(403,D.Z.supportsNotifications(),"Platform must support notifications")}catch(n){_.Z.reportError(n)}var t=[];Object.keys(this.notificationItems).forEach((function(n){var r=e.notificationItems[n];if(r&&r.getNotificationEntry){var i=r.getNotificationEntry();i&&t.push(i)}else delete e.notificationItems[n]})),Fa.setNotifications(t),_.Z.shouldLog(w.Z.LogLevels.Timeline)&&_.Z.log("Notifications Scheduled: "+this.numNotificationItemsChanged),this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0,_.Z.shouldLog(w.Z.LogLevels.Timeline)&&_.Z.log("Scheduled Notifications: ",t)}},{key:"getDateForKey",value:function(e){return this.oldSoftDates.indexOf(e)>=0&&(e="#"+e),this.agendaSort.get()[e]}},{key:"saveAgendaSort",value:function(e){this.agendaSort.set(e),_o.settings.agendaSort.set(e),_o.PaneManager.runForEachPane((function(e){e.isViewAgenda()&&e.setItemsDirty()})),_o.PaneUpdateBatcher.updateAllItems()}}]),e}(),P()(Na.prototype,"updateNotifications",[S.ZP],Object.getOwnPropertyDescriptor(Na.prototype,"updateNotifications"),Na.prototype),P()(Na.prototype,"setupNotifications",[S.ZP],Object.getOwnPropertyDescriptor(Na.prototype,"setupNotifications"),Na.prototype),Na);const ja=function(){function e(){s()(this,e)}return l()(e,[{key:"init",value:function(){this.settings=new Gt,this.International=new Ke,this.billingManager=new we,this.pluginManager=new Ta,this.DisplaySettings=new T,this.itemStoreManager=new mt,this.PaneUpdateBatcher=new kt,this.PaneManager=new ge,this.DragDrop=new R.Z,this.timeline=new Ua,this.cacheManager=new Ce,this.recurringTaskManager=new Lt,this.deferredTaskManager=new Re,this.toasts=new Qt,this.ElementRenderer=new Q,this.crypto=new jt,this.cloudStorage=new Le,this.dropBucket=new Oe,this.menus=new ce,this.EmailPreview=new Ve,this.International.init(),this.itemStoreManager.init(),this.cacheManager.init(),this.pluginManager.init(),this.PaneManager.init(),this.recurringTaskManager.init(),this.deferredTaskManager.init(),this.cloudStorage.init(),this.EmailPreview.init(),U.Z.init(),Ue.Z.init()}},{key:"sendFeedback",value:function(e,t){var n={};Z.Z.getAppInfo(n),n.eventStream=void 0;var r={name:e,message:t,appInfo:n,email:this.settings.getUserIdentifier(),premiumStatus:this.billingManager.getPremiumStatus()};return ye.Z.sendFeedback(r)}},{key:"remoteAPI",value:function(){return this.pluginManager.getPlugin(w.Z.PluginID.Moodo)}},{key:"onIntroAction",value:function(e){}}]),e}();const Ha=function(){function e(){s()(this,e),this.sidebarTransitioning=!1,this.isDraggingSidebar=new x.Z(!1),this.lightboxPosition=new x.Z,this.lightboxSrc=new x.Z,this.lightboxElement=void 0,this.sidebarChanged=new et.Z,this.resizingPane=new x.Z,this.cursor=new x.Z}return l()(e,[{key:"init",value:function(){var e=this;this.showSidebar=D.Z.isMailbirdSidebar()||_.Z.isDemoInIframe()?new x.Z(!1):_o.settings.showSidebar,this._savedSidebarWidth=w.Z.DesktopMenuWidthDefault,this.sidebarWidth=_o.settings.sidebarWidth,_o.settings.onLoaded((function(){var t=_o.settings.sidebarWidth.get();e._savedSidebarWidth=t===w.Z.DesktopMenuWidthSmall?w.Z.DesktopMenuWidthDefault:t}))}},{key:"toggleSidebar",value:function(e){this.sidebarTransitioning=!0;var t=void 0!==e?e:!this.showSidebar.get();t&&(!0===e&&this._savedSidebarWidth===w.Z.DesktopMenuWidthSmall&&(this._savedSidebarWidth=w.Z.DesktopMenuWidthDefault),this.sidebarWidth.set(this._savedSidebarWidth)),this._setSidebarVisible(t),this.sidebarChanged.notify()}},{key:"minimize",value:function(){this.sidebarTransitioning=!0;var e=w.Z.DesktopMenuWidthSmall;this.sidebarWidth.set(e),this.sidebarChanged.notify()}},{key:"restore",value:function(){this.toggleSidebar(!0)}},{key:"getSidebarWidth",value:function(){return D.Z.isMailbirdSidebar()||!this.showSidebar.get()?0:this.sidebarWidth.get()}},{key:"setSidebarWidth",value:function(e){this.sidebarWidth.set(e),this.sidebarChanged.notify()}},{key:"setSidebarWidthMoving",value:function(e){this.showSidebar.set(!0),this.sidebarTransitioning=!1,this.isDraggingSidebar.set(!0),this.sidebarWidth.set(e)}},{key:"setSidebarWidthUp",value:function(){var e=this.sidebarWidth.get();e<20?e=0:e<w.Z.DesktopMenuWidthMinBig&&(e=w.Z.DesktopMenuWidthSmall),e!==this.sidebarWidth.get()&&(this.sidebarTransitioning=!0,this.sidebarWidth.set(e)),e>0&&(this._savedSidebarWidth=e),this._setSidebarVisible(e>0),this.isDraggingSidebar.set(!1),this.sidebarChanged.notify()}},{key:"_setSidebarVisible",value:function(e){_o.settings.showSidebar.set(e),this.showSidebar.set(e)}},{key:"shouldShowTopBar",value:function(){return!_.Z.isDemoInIframe()&&!this.showSidebar.get()}},{key:"shouldShowTopTitleBar",value:function(){return!_.Z.isDemoInIframe()&&D.Z.isNativeMac()&&this.showSidebar.get()&&this.sidebarWidth.get()<w.Z.DesktopMenuWidthMinBig}},{key:"topBarHeight",value:function(){return this.shouldShowTopBar()||this.shouldShowTopTitleBar()?D.Z.isNativeMac()?36:32:0}}]),e}();var Va;const Wa=(Va=function(){function e(){s()(this,e)}return l()(e,[{key:"setup",value:function(){var e=this;this.downloadToasts={},this.callbacks={},this.nextId=0,this.ipcBridge=window.___electronIPCBridge,this.windowID=ve.Z.getURLParam("windowID");try{_.Z.PAssert(152,this.ipcBridge,"IPC bridge was not created")}catch(t){_.Z.reportError(t)}this.ipcBridge&&(this.ipcBridge.onElectronMessage=this.handleMessage),setTimeout((function(){_o.settings.onLoaded((function(){_o.settings.appHotkeys.listen((function(){return e.sendHotkeys()})),e.sendHotkeys()}))}),100)}},{key:"handleMessage",value:function(e,t){try{if(_.Z.isString(t)&&"{"===t[0]&&"}"===t[t.length-1])try{t=JSON.parse(t)}catch(i){_.Z.reportError(i)}if(isNaN(+e)){try{_.Z.PAssert(153,this["onEvent_"+e],"Missing handler for native event")}catch(a){_.Z.reportError(a)}this["onEvent_"+e](t)}else{var n=this.callbacks[+e],r=!1;n&&(_.Z.isObject(t)&&("error"in t||"value"in t)&&(n(t.error,t.value),r=!0),!r&&n&&n(t))}}catch(i){_.Z.reportError(i)}}},{key:"sendMessage",value:function(e,t,n){if(this.ipcBridge){var r=this.nextId++,i=r+"~"+e;D.Z.appv>=7&&(_.Z.isString(t)&&(t={value:t}),void 0!==this.windowID&&(t=Object.assign({},t,{windowID:this.windowID}))),void 0!==t&&(i+="~"+(_.Z.isString(t)?t:JSON.stringify(t))),n&&(this.callbacks[r]=n),this.ipcBridge.send("moodo-message",i)}}},{key:"sendHotkeys",value:function(){var e=_o.settings.appHotkeys.get();if(e&&!_.Z.isEmpty(e)){var t=Object.keys(e).map((function(t){return _o.hotkeys.convertToElectron(e[t])}));this.sendMessage("setShortcuts",{shortcuts:t})}}},{key:"saveBackup",value:function(e,t,n){this.sendMessage("saveBackup",{filename:e,data:t},n)}},{key:"saveDoc",value:function(e,t,n){this.sendMessage("saveDoc",{filename:e,data:t},n)}},{key:"listDocss",value:function(e,t){this.sendMessage("listDocs",{folder:e},t)}},{key:"getDoc",value:function(e,t){this.sendMessage("getDoc",{filename:e},t)}},{key:"deleteDoc",value:function(e,t){this.sendMessage("deleteDoc",{filename:e},t)}},{key:"renameDoc",value:function(e,t,n){this.sendMessage("renameDoc",{filenameOld:e,filenameNew:t},n)}},{key:"openDirectoryDialog",value:function(e){this.sendMessage("openDirectoryDialog",{},e)}},{key:"getAllDocs",value:function(e){this.sendMessage("getAllDocs",void 0,(function(t,n){t?e(t):e(void 0,n)}))}},{key:"listenToDocChanges",value:function(e){this._fileListener=e}},{key:"getPrefs",value:function(e){this.sendMessage("getPrefs",void 0,e)}},{key:"setDocsFolder",value:function(e,t,n){this.sendMessage("setDocsFolder",{folder:e,moveFiles:t},n)}},{key:"selectBoard",value:function(e,t,n){this.sendMessage("selectBoard",{board:e,title:t},n)}},{key:"onEvent_fullscreen",value:function(e){D.Z.isNativeFullscreen.set(e)}},{key:"onEvent_features",value:function(e){try{e.version&&D.Z.recordAppSubVersion(e.version),!1===e.notifications&&D.Z.disallowNativeNotifications(),void 0!==e.darkMode&&this.onEvent_darkMode(e.darkMode),void 0!==e.fullscreen&&this.onEvent_fullscreen(e.fullscreen),e.defaultUserAgent&&(D.Z.defaultElectronUserAgent=e.defaultUserAgent)}catch(t){_.Z.reportError(t)}}},{key:"downloadFile",value:function(e,t){try{_.Z.PAssert(154,!this.downloadToasts[e],"Should not double create a download for the same file")}catch(n){_.Z.reportError(n)}this.downloadToasts[e]=_o.toasts.pushMessage({text:"Downloading "+t+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%",hold:!0,actionText:""}),this.sendMessage("downloadURL",{url:e,name:t})}},{key:"onEvent_downloadProgress",value:function(e){var t=this,n=e.url,r=e.name,i=e.progress,a=e.filename,o=this.downloadToasts[n];if(o)if(1===i)a?(console.log(a),o.action=function(){console.log("toast action"),t.sendMessage("openFile",{filename:a})},o.actionText="OPEN",o.setText("Downloaded: ".concat(r))):o.hide(),delete this.downloadToasts[n];else{var s=isNaN(i)?"...":Math.round(100*i)+"%";o.setText("Downloading "+r+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+s)}}},{key:"onEvent_reportError",value:function(e){_.Z.reportError(new Error("Native Error"),e)}},{key:"onEvent_onMenuClick",value:function(e){"NewMessage"===e||"NewEmail"===e?_o.hotkeys.hotkeyEmailCompose():"NewPane"===e?_o.hotkeys.hotkeyAddPane():"NewItem"===e?_o.hotkeys.hotkeyNewItem():"Preferences"===e?_o.menus.openSettings():"GoPremium"===e?_o.menus.openSettings("Upgrade"):"DisplaySettings"===e?_o.menus.openDisplaySettings():"ToggleSidebar"===e?_o.DesktopUI.toggleSidebar():_.Z.reportError(new Error("Unknown Native Menu Click: "+e))}},{key:"onEvent_darkMode",value:function(e){this._darkMode=e,_o.DisplaySettings.setSystemDarkMode(e)}},{key:"onEvent_fileChanged",value:function(e){try{this._fileListener(w.Z.CrudActions.Modified,e)}catch(t){_o.toasts.pushMessage("A local document has gotten corrupted. Please check the Moo.do documents saved on your computer."),_.Z.reportError(t)}}},{key:"onEvent_fileDeleted",value:function(e){try{this._fileListener(w.Z.CrudActions.Removed,e)}catch(t){_.Z.reportError(t)}}},{key:"onEvent_hotkeyPressed",value:function(e){_o.menus.isModalOpen()||setTimeout((function(){var t=_o.settings.appHotkeys.get(),n=t.newItem,r=t.newEmail;if(n&&_o.hotkeys.convertToElectron(n)===e)_o.menus.openItemEditor({addOnSave:!0,selectDocument:!0,element:"newItemButton"});else if(r&&_o.hotkeys.convertToElectron(r)===e)_o.menus.openComposeEmail(_o.pluginManager.getPluginGmail());else try{_.Z.PAssert(155,!1,"Missing action for hotkey")}catch(i){_.Z.reportError(i)}}),10)}},{key:"getDarkMode",value:function(){return this._darkMode}}]),e}(),P()(Va.prototype,"handleMessage",[S.ZP],Object.getOwnPropertyDescriptor(Va.prototype,"handleMessage"),Va.prototype),Va);function za(e){try{_.Z.PAssert(421,void 0===window.__MoodoBridge[e],"Registering an Inbound API that already exists on the window object",e)}catch(t){_.Z.reportError(t)}this._name=e,this._publicObj={},this._privateObj={},window.__MoodoBridge[e]=this._publicObj,this.init()}za.prototype={init:function(){},_createWrapper:function(e){return function(){try{return e.apply(this,arguments)}catch(t){_.Z.reportError(t)}}},registerFunction:function(e,t,n){try{_.Z.PAssert(422,e,"Name must be provided to register function")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(423,t,"A valid function must be provided to register")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(424,void 0===this._privateObj[e],"Re-registering an api function on private obj",e)}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(425,void 0===this._publicObj[e],"Re-registering an api function on public obj",e)}catch(r){_.Z.reportError(r)}this._privateObj[e]=t.bind(this._privateObj),n&&(this._publicObj[e]=this._createWrapper(this._privateObj[e]))},registerVariable:function(e,t,n){try{_.Z.PAssert(426,e,"Name must be provided to register variable")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(427,!n,"Public variables are not currently supported")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(428,void 0===this._privateObj[e],"Re-registering an api variable on private obj")}catch(r){_.Z.reportError(r)}try{_.Z.PAssert(429,void 0===this._publicObj[e],"Re-registering an api variable on public obj")}catch(r){_.Z.reportError(r)}this._privateObj[e]=t}},ve.Z.defineBase(za);const qa=za;function Ga(e){this._name=e,this._apiLoaded=!1,this._apiError=!1,this._listeners=void 0,this._requiredFns=[],this._missingFns=void 0,this.init()}Ga.prototype={init:function(){_.Z.isObject(window[this._name])?this.onAPILoaded():(ve.Z.forceBind("_checkAPI",this),setTimeout(this._checkAPI,1e3))},_checkAPI:function(){try{_.Z.PAssert(430,!this._apiLoaded,"Should not be checking for API load if already loaded")}catch(e){_.Z.reportError(e)}_.Z.isObject(window[this._name])&&this.onAPILoaded(),this._apiLoaded||setTimeout(this._checkAPI,1e3)},onAPILoaded:function(){var e=0;this._apiLoaded=!0;for(var t=0;t<this._requiredFns.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._requiredFns[t];_.Z.isFunction(window[this._name][n])||(this._apiError=!0,this._addMissingFn(n))}this.notifyListeners()},requestNotification:function(e){this._apiLoaded?setTimeout(e,0):this._listeners?this._listeners.push(e):this._listeners=[e]},notifyListeners:function(){try{_.Z.PAssert(431,this._apiLoaded,"API must be loaded to notify listeners")}catch(n){_.Z.reportError(n)}if(this._listeners)for(var e=0,t=0;t<this._listeners.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._listeners[t]()}this._listeners=void 0},requireFunction:function(e,t){try{_.Z.PAssert(432,this._requiredFns.indexOf(e)<0,"Should not double require a single function")}catch(n){_.Z.reportError(n)}this._requiredFns.push(e),this._apiLoaded&&(_.Z.isFunction(window[this._name][e])||t||(this._apiError=!0,this._addMissingFn(e)))},_addMissingFn:function(e){if(this._missingFns){try{_.Z.PAssert(433,this._missingFns.indexOf(e)<0,"Should not be missing the same function multiple times")}catch(t){_.Z.reportError(t)}this._missingFns.push(e)}else this._missingFns=[e]},hasOptionalFunction:function(e){try{_.Z.PAssert(434,this._requiredFns.indexOf(e)>=0,"Must be querying for a registered function")}catch(t){_.Z.reportError(t)}return!!window[this._name]&&!!window[this._name][e]},call:function(e){try{_.Z.PAssert(435,this._apiLoaded,"Trying to call an API function before it is loaded",e)}catch(n){_.Z.reportError(n)}if(this._apiLoaded){var t=Array.prototype.slice.call(arguments,1);try{return window[this._name][e].apply(window[this._name],t)}catch(r){_.Z.reportError(r)}}}},ve.Z.defineBase(Ga);const Ka=Ga;var Ya;const Xa=(Ya=function(){function e(){s()(this,e)}return l()(e,[{key:"init",value:function(){if(!D.Z.isMobile){try{_.Z.PAssert(106,this.setupFn,"Must have a valid setup function")}catch(e){_.Z.reportError(e)}try{_.Z.PAssert(107,this.sendFn,"Must have a valid send function")}catch(e){_.Z.reportError(e)}if(!this.setupFn||!this.sendFn)return;this.setupFn()}}},{key:"isEnabled",value:function(){return this._isEnabled}},{key:"registerEmbedBridge",value:function(e){try{_.Z.PAssert(108,e,"Must supply a valid embed bridge")}catch(t){_.Z.reportError(t)}try{_.Z.PAssert(109,D.Z.embed,"Must be embedded")}catch(t){_.Z.reportError(t)}this._embedBridge=e}},{key:"hasEmbedBridge",value:function(){return!!this._embedBridge}},{key:"sendToEmbed",value:function(e,t){try{_.Z.PAssert(110,this.hasEmbedBridge(),"Must have a valid embed bridge to send message: ",e)}catch(n){_.Z.reportError(n)}this._embedBridge.handleEmbedMessage(e,t)}},{key:"registerInboundAPI",value:function(e){try{_.Z.PAssert(111,!this._inboundAPIs[e],"Should not have already registered an outbound API with this name")}catch(n){_.Z.reportError(n)}if(this._canRegisterAPIs){var t=new qa(e);return this._inboundAPIs[e]=t,t}}},{key:"registerOutboundAPI",value:function(e){try{_.Z.PAssert(112,!this._outboundAPIs[e],"Should not have already registered an outbound API with this name")}catch(n){_.Z.reportError(n)}if(this._canRegisterAPIs){var t=new Ka(e);return this._outboundAPIs[e]=t,t}}},{key:"setupElectron",value:function(){_o.ElectronBridge.setup()}},{key:"sendToApp",value:function(e,t){}},{key:"sendToAppElectron",value:function(e,t){_o.ElectronBridge.sendMessage(e,t)}}]),e}(),P()(Ya.prototype,"setupElectron",[S.ZP],Object.getOwnPropertyDescriptor(Ya.prototype,"setupElectron"),Ya.prototype),P()(Ya.prototype,"sendToApp",[S.ZP],Object.getOwnPropertyDescriptor(Ya.prototype,"sendToApp"),Ya.prototype),P()(Ya.prototype,"sendToAppElectron",[S.ZP],Object.getOwnPropertyDescriptor(Ya.prototype,"sendToAppElectron"),Ya.prototype),Ya);var Qa=w.Z.TooltipDelay;const Ja=function(){function e(){s()(this,e),this.tooltip=new x.Z,this.tooltipsSticky=new ae.Z,this.displayElement=void 0,this.isSticky=!1,this.displayTimeout=void 0,D.Z.touch||(ue.Z.listen("mouseover",this.handleEleOver.bind(this)),ue.Z.listen("mouseout",this.handleEleOut.bind(this)),window.addEventListener("mouseout",this.windowOut.bind(this)),document.addEventListener("mousedown",this.hideTip.bind(this),!0))}return l()(e,[{key:"windowOut",value:function(e){(e.pageX>=D.Z.windowWidth()||e.pageY>=D.Z.windowHeight()||e.pageX<=0||e.pageY<=0)&&this.hideTip()}},{key:"register",value:function(e,t){this.update(e,t)}},{key:"update",value:function(e,t){e.setAttribute("tooltip",t)}},{key:"displayTipSticky",value:function(e){e.sticky=!0,this.displayTip(e)}},{key:"displayTip",value:function(e){try{_.Z.PAssert(156,e,"When display a tooltip, must pass in some info")}catch(i){_.Z.reportError(i)}clearTimeout(this.displayTimeout),this.displayTimeout=void 0;var t=this.displayElement=e.element;if(e&&t&&t.offsetWidth>0&&t.offsetHeight>0){var n=e.text;this.isSticky=e.sticky;try{_.Z.PAssert(157,n,"When display a tooltip, elements should always have valid data set")}catch(i){_.Z.reportError(i)}if(n){var r={text:n,hotkey:e.hotkey,element:t,blue:e.blue,sticky:e.sticky,maxWidth:e.maxWidth,onRight:e.onRight,arrowClass:e.arrowDirection||"hidden"};e.sticky?this.tooltipsSticky.push(r):this.tooltip.set(r)}}}},{key:"tipOut",value:function(e){var t=!0;e.target&&(t=_.Z.isAttachedToDoc(e.target)&&!_.Z.findParent(e.target,"tooltip")),t&&this.hideTip()}},{key:"getAttr",value:function(e){return e&&e.getAttribute&&(e.getAttribute("tooltip")||e.getAttribute("data-tooltip"))}},{key:"getAttrHotkey",value:function(e){return e&&e.getAttribute&&(e.getAttribute("tooltipHotkey")||e.getAttribute("data-tooltiphotkey"))}},{key:"getByClassName",value:function(e,t){var n,r=D.Z.priModKey,i=e.parentElement,a=e.textContent,o=D.Z.mac?"Option":"Alt";if(!_.Z.findParent(e,"fancyInputInner")&&!_.Z.findParentID(e,"ReactAutocomplete")&&!_o.menus.isModalOpen()){var s=_.Z.getPaneObjectForElement(e),c=s&&B.Z.isSelected(s);if(_.Z.hasClass(e,"linkImage"))n="<b>Click</b> to open image.<br><b>"+r+" + Click</b> to open in "+(D.Z.app?"browser":"new tab")+".";else if(_.Z.findParent(e,"itemLink"))n="<b>Click</b> to open linked item<br><b>".concat(r," + Click</b> to open linked item in popup pane<br><b>").concat(r," + Shift + Click</b> to open linked item in new pane");else if(i&&_.Z.hasClass(i,"appLink")){n="<b>"+r+" + Click</b> to open "+((_.Z.hasClass(i,"evernote")?"Evernote":_.Z.hasClass(i,"onenote")&&"OneNote")||_.Z.hasClass(i,"bear")&&"Bear"||"")}else if(_.Z.hasClass(e,"link")&&e.getAttribute("data-href")){var l=e.getAttribute("data-href"),u=c?"".concat(r," + "):"";n=(l!==a?l+"<br>":"")+"<b>".concat(u,"Click</b> to open")}else _.Z.hasClass(e,"tag")?n="<b>Click</b> to show only "+a+"<br><b>Shift + Click</b> to hide "+a+"<br><b>"+o+" + Click</b> to remove "+a:_.Z.hasClass(e,"contact")?n="<b>"+r+"+ Click</b> to show only "+a+"<br><b>"+r+" + Shift + Click</b> to hide "+a+"<br><b>"+o+" + Click</b> to remove "+a:_.Z.hasClass(e,"email")?n="<b>"+r+"+ Click</b> to email "+a:_.Z.hasClass(e,"prefixHeader")||_.Z.hasClass(e,"prefixBullet")?n="<b>Click</b> to zoom in":_.Z.hasClass(e,"prefixTask")?n="<b>Click</b> to toggle complete.<br><b>"+r+" + Click</b> to zoom in.":_.Z.hasClass(e,"prefixNumList")?n="<b>"+r+" + Click</b> to zoom in":_.Z.hasClass(e,"inlineDate")?n="<b>Click</b> to edit date<br><b>"+o+" + Click</b> to remove date":_.Z.hasClass(e,"plugin")&&(n=(t>0?"<b>"+r+" + Click</b>":"<b>Click icon</b>")+" to open")}return n}},{key:"getTooltipText",value:function(e,t){return this.getAttr(e)||this.getByClassName(e,t)}},{key:"handleEleOver",value:function(e){try{_.Z.PAssert(158,_.Z.isDOMNode(e.target),"Must have a valid DOM node: ",Qn()(e.target))}catch(o){_.Z.reportError(o)}if(e.target){for(var t,n,r=0,i=e.target,a=0;!t&&i&&a<3;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;t=this.getTooltipText(i,a),n=this.getAttrHotkey(i),t||n||(i=i.parentElement)}if(i&&(!t&&n&&(t=n,n=void 0),t&&this.displayElement!==i&&!_o.DragDrop.isDragging&&!B.Z.isMouseDown())){clearTimeout(this.displayTimeout),this.displayTimeout=setTimeout(this.displayTip.bind(this),Qa,{element:i,offset:{y:5},text:t,hotkey:n})}}}},{key:"handleEleOut",value:function(e){this.tipOut(e)}},{key:"isOpenSticky",value:function(){return this.tooltipsSticky.get().length>0}},{key:"hideSticky",value:function(e){for(var t=0,n=this.tooltipsSticky.get(),r=0;r<n.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(n[r].text===e){this.tooltipsSticky.removeAt(r);break}}}},{key:"hideTip",value:function(){this.displayElement=void 0,clearTimeout(this.displayTimeout),this.displayTimeout=void 0,this.tooltip.set(void 0)}}]),e}();const $a=function(){function e(){s()(this,e),this.popupClosedError=new x.Z,this.gapiFailedToLoad=new x.Z,this.loggedOutByAuthFailure=new x.Z,this.isLoggingOut=new x.Z,this.downloadIcon=this.getDownloadIcon(),this.showDownload=D.Z.canDownloadNativeApp(),this.loginRequested=!1,this.loginRequestTimer=void 0}return l()(e,[{key:"getDownloadIcon",value:function(){return D.Z.getPlatformIcon()}},{key:"logout",value:function(){var e=a()(k().mark((function e(){return k().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:if(!_o.settings.activeUser.get()){e.next=7;break}return _.Z.log("Logging out"),this.isLoggingOut.set(!0),e.next=5,j.Z.clearLocalData();case 5:return e.next=7,re.Z.signOut();case 7:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logoutClicked",value:function(){var e=this;_.Z.isDemoMode()?ve.Z.removeURLParam("demo"):j.Z.hasPendingRemoteUpdates()?_o.menus.confirm("You have unsaved changes which will be lost if you log out. Are you sure?",(function(t){t&&e.logout()})):this.logout()}},{key:"_reportLoginTapSkip",value:function(e){}},{key:"closeConnectionError",value:function(){_o.tooltip.hideSticky(this.textErrorConnecting)}}]),e}();var eo;const to=(eo=function(){function e(){var t=this;s()(this,e),this.useServiceWorker="serviceWorker"in navigator,this.isUpdating=new x.Z(!1),this.notifiedOfNew=!1,this.hasUpdate=new x.Z,setInterval(this.update,w.Z.MSPerHour),D.Z.app&&I.LA.onAppStateChange((function(e){var n=e.isForeground;t.isAppBackgrounded=!n,n||(t.hasUpdate.get()?t.skipWaiting():t.update())}))}return l()(e,[{key:"init",value:function(){var e=this;this.useServiceWorker&&(navigator.serviceWorker.addEventListener("message",(function(t){_o.settings.activeUser.get()&&("ServiceWorker_Installed"===t.data?e.onUpdateReady():"ServiceWorker_Activated"===t.data&&(console.log("got activated"),e.reload()))})),navigator.serviceWorker.addEventListener("controllerchange",(function(){e.reload()})))}},{key:"update",value:function(){var e=a()(k().mark((function e(t){var n;return k().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(this.hasUpdate.get()){e.next=12;break}if(e.prev=1,!this.useServiceWorker){e.next=8;break}if(!(n=window.__registeredServiceWorker)){e.next=8;break}return e.next=7,n.update();case 7:null===t||void 0===t||t(!!n.installing);case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(1);case 12:case"end":return e.stop()}}}),e,this,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onUpdateReady",value:function(){_.Z.log("Cache: New version available"),this.useServiceWorker&&_.Z.log("Service worker has update"),this.updateAction()}},{key:"onFirstUpdateReady",value:function(){_.Z.log("Cache: first update")}},{key:"onUpdateError",value:function(e){!D.Z.demo&&j.Z.isConnected()&&(_.Z.log("Update Error: ",e),"quota"===e.reason&&_o.toasts.pushMessage({text:"A new version of Moo.do is available but you do not have enough free disk space to update. You may want to clear up some disk space.",actionText:"OKAY"}))}},{key:"onUpdateDownloading",value:function(){_.Z.log("Cache: New version downloading")}},{key:"reload",value:function(){this.isRefreshing||(this.isRefreshing=!0,this.isUpdating.set(!0),_.Z.reload())}},{key:"skipWaiting",value:function(){if(!this.isRefreshing){var e,t,n=window.__registeredServiceWorker;null===n||void 0===n||null===(e=n.installing)||void 0===e||e.postMessage("skipWaiting"),null===n||void 0===n||null===(t=n.waiting)||void 0===t||t.postMessage("skipWaiting"),this.hasUpdate.get()&&this.isUpdating.set(!0)}}},{key:"updateAction",value:function(){this.hasUpdate.set(!0),D.Z.app&&this.isAppBackgrounded&&this.skipWaiting()}}]),e}(),P()(eo.prototype,"update",[S.ZP],Object.getOwnPropertyDescriptor(eo.prototype,"update"),eo.prototype),P()(eo.prototype,"onUpdateReady",[S.ZP],Object.getOwnPropertyDescriptor(eo.prototype,"onUpdateReady"),eo.prototype),eo);var no,ro=n(8373),io={display:"inline-block",height:"24px"},ao=function(e){return'<span class="introHotkey c-bg-light c-blue">'.concat(e,"</span>")};const oo=(no=function(){function e(){s()(this,e)}return l()(e,[{key:"init",value:function(){var e=this;this.itemsByAction={},this.itemsByID={},this.isHelpOpen=new x.Z(!1,this.saveHelpPaneState),this.isHotkeysOpen=new x.Z(!1,this.saveHelpPaneState),this.priKey=D.Z.priModKey,this.secKey=D.Z.secModKey,this.secKeyForce=D.Z.secModKeyForce,this.tooltipIntroSection=void 0;var t=_o.settings.helpPaneState.get();void 0===t&&(t={e:!1,o:!1}),this.initHelp(),_.Z.isDemoMode()||(this.loadState(),_o.settings.inTooltipIntro.get()&&this.tooltipIntroSection.isComplete.get()&&_o.settings.inTooltipIntro.set(!1)),_o.settings.helpPaneState.listen((function(t,n){void 0===t||_.Z.deepEqual(t,n)||(e.isHelpOpen.set(t.e),e.isHotkeysOpen.set(t.o))})),_o.settings.helpState.listen((function(t,n){t&&t!==n&&e.loadState()}))}},{key:"getItem",value:function(e){return this.itemsByAction[e]}},{key:"createItem",value:function(e,t){var n=t;return n.isComplete=new x.Z(!1),n.isDisabled=new x.Z(!1),n.show=function(){return n.isDisabled.set(!1)},this.itemsByAction[e]=n,this.itemsByID[n.id]=n,n}},{key:"saveHelpPaneState",value:function(){_o.settings.helpPaneState.set({o:this.isHotkeysOpen.get(),e:this.isHelpOpen.get()})}},{key:"showHelp",value:function(){this.isHelpOpen.set(!0)}},{key:"toggleHelp",value:function(){this.isHelpOpen.set(!this.isHelpOpen.get())}},{key:"showHotkeys",value:function(){this.isHotkeysOpen.set(!0)}},{key:"toggleHotkeys",value:function(){this.isHotkeysOpen.set(!this.isHotkeysOpen.get())}},{key:"_getHelpStateObj",value:function(){var e={},t=_o.settings.helpState.get();if(_.Z.isString(t)){if(t)try{(e=JSON.parse(t))&&!_.Z.isString(e)||(e={})}catch(n){_.Z.reportError(n)}}else e=t;return e||{}}},{key:"loadState",value:function(){var e=this._getHelpStateObj();if(e&&!_.Z.isEmpty(e)){var t=this.itemsByID;Object.keys(e).forEach((function(n){return e[n]&&t[n]&&t[n].isComplete.set(!0)}))}}},{key:"saveState",value:function(){if(_.Z.shouldWriteLocal())try{var e=_.Z.clone(this._getHelpStateObj()),t=!1,n=this.itemsByID;Object.keys(n).forEach((function(r){return n[r].isComplete.get()&&!e[r]&&(t=!0,e[r]=1)})),t&&_o.settings.helpState.set(e)}catch(r){_.Z.reportError(r)}}},{key:"getState",value:function(){var e=_.Z.clone(this._getHelpStateObj()),t=this.itemsByAction;return Object.keys(t).forEach((function(n){return t[n].isComplete.get()&&(e[t[n].id]=1)})),e}},{key:"initHelp",value:function(){var e=this;this.createItem("PluginSettings",{id:"pS",jsx:N.createElement("span",null,"Open the ",N.createElement(ro.Z,{raised:!0,primary:!0,className:"mx-1 align-bottom",padding:10,height:24,onClick:function(){return _o.menus.openSettings("Email")}},"Settings")," to setup sync with Google services.")}),this.createItem("Encryption",{id:"en",jsx:N.createElement("span",null,"Optionally ",N.createElement(ro.Z,{raised:!0,primary:!0,className:"mx-1 align-bottom",padding:10,height:24,onClick:function(){return _o.menus.openSettings("Security")}},"Enable Encryption")," to add an extra layer of security to your data.")}),this.createItem("Import",{id:"i",jsx:N.createElement("span",null,N.createElement(ro.Z,{raised:!0,primary:!0,className:"mx-1 align-bottom",padding:10,height:24,onClick:function(){return _o.menus.openModal(w.Z.Modals.ImportData)}},"Import your data")," from another app or just start typing to get started.")}),this.createItem("Demo",{id:"d",jsx:N.createElement("span",null,"Open the ",N.createElement(ro.Z,{raised:!0,primary:!0,className:"mx-1 align-bottom",padding:10,height:24,onClick:function(){_o.openUrl("https://www.moo.do/help"),e.onAction("Demo")}},"Help Page")," to explore all of Moo.do's features.")}),this.createItem("AddItem",{id:"a",text:"Moo.do works like a text editor. Type some text to get started and press ".concat(ao("Enter")," to add a new item.")}),this.createItem("SlashHelp",{id:"h",text:"Type ".concat(ao("/")," in an empty item to see available options.")}),this.createItem("Search",{id:"s",text:"Use search to focus on a subset of your items. Click the search box at the top of the pane to see search options."}),this.createItem("ViewMode",{id:"v",text:"Click the <b>Outline</b> button at the top of a pane to explore view modes."}),this.createItem("AddPane",{id:"aP",jsx:N.createElement("span",null,"Click the ",N.createElement(ro.Z,{icon:"icon-add-pane",className:"align-text-bottom",iconSize:15,width:28,height:16,onClick:function(){return _o.menus.openAddPaneMenu({element:"addPaneButton"})}})," button to add a new pane.")}),this.createItem("AddBoard",{id:"aB",jsx:N.createElement("span",null,"Click the ",N.createElement(ro.Z,{icon:"icon-add",className:"align-text-bottom",iconSize:15,width:28,height:16,onClick:function(){_o.PaneManager.addBoard()}})," button to add a new board.")}),this.createItem("Email",{id:"e",text:"Use the Email pane to read and reply to your emails. Double click an email to open it."}),this.createItem("NewDoc",{id:"nD",text:'Click the <i class="icon-menu g mx-1"></i> button in a pane to open the documents list and click <i class="icon-add mx-1"></i> to add a new document.'}),this.createItem("ShareDoc",{id:"sD",text:"Right click on a document and select Share to collaborate on a document."}),this.createItem("ChangeDoc",{id:"cD",text:"Select a document in the document list or click on the document name at the top of a pane to change documents."}),this.createItem("Indent",{id:"458052715",text:"Moo.do has infinite hierarchy. Press ".concat(ao("Tab")," to indent an item under its parent and ").concat(ao("Shift + Tab")," unindent it.")}),this.createItem("Drag",{id:"3825397189",text:"Click and drag the left edge of an item to move it around or to another pane."}),this.createItem("Collapse",{id:"441256378",text:'Click <i class="icon-angle-down font-bold"></i> next to an item or press '.concat(ao(_o.hotkeys.printHotkeyByName("Collapse"))," to collapse its subitems.")}),this.createItem("Date",{id:"321249113",text:"Add a date by typing ".concat(ao("!")," in the text of an item or pressing ").concat(ao(this.priKey+" + Shift + D")," to add it to your calendar.")}),this.createItem("AddCalendar",{id:"adc2",text:"Add an item with a date to Google Calendar by pressing ".concat(ao(this.secKeyForce+" C")," or selecting the calendar in the date popup.")}),this.createItem("RightClickItem",{id:"3288459206",text:"Right click an item to explore more options."}),this.createItem("Priority",{id:"215510164",text:"Set a priority with the right click menu or ".concat(ao(this.secKey+" 1|2|3"),"</span>.")}),this.createItem("Complete",{id:"2165585377",text:"Click the right edge of an item or ".concat(ao(this.secKey+" /"),"</span> to complete it.")}),this.createItem("Zoom",{id:"1829655333",text:"Zoom into an item to focus on only its children. Press ".concat(ao(this.priKey+" Enter")," or hold ").concat(ao(this.priKey)," and click its left edge.")}),this.createItem("Overview",{id:"801492595",text:'The overview shows only parents for easy scrolling and zooming. Click the <i class="icon-menu g mx-1"></i> button in a pane to open the documents list, and click <i class="icon-format_list_bulleted g mx-1"></i> to open the overview.'}),this.createItem("Tag",{id:"3689209442",text:'Mark similar items with a <span class="tag">#tag</span> to easily search for all items matching that tag.'}),this.createItem("DragFromComp",{id:"drDr",text:"Drag a file from your computer to upload it to Drive and add it to a list."}),this.createItem("SettingsMenu",{id:"oS",jsx:N.createElement("span",null,"Click ",N.createElement("span",{style:io},N.createElement(ro.Z,{icon:"icon-settings",className:"align-text-bottom",width:16,height:16,onClick:function(){return _o.menus.openOptions()}}))," and select Settings to customize Moo.do's various options.")}),this.createItem("DisplaySettings",{id:"oDS",jsx:N.createElement("span",null,"Click ",N.createElement("span",{style:io},N.createElement(ro.Z,{icon:"icon-settings",className:"align-text-bottom",width:16,height:16,onClick:function(){return _o.menus.openOptions()}}))," and select Display Settings to customize your view.")})}},{key:"onAction",value:function(e){if(!_o.menus.isModalOpen(w.Z.Modals.ImportData)||"Import"===e){var t=this.itemsByAction[e];t&&!t.isComplete.get()&&(t.isComplete.set(!0),this.saveState())}}}]),e}(),P()(no.prototype,"getItem",[S.ZP],Object.getOwnPropertyDescriptor(no.prototype,"getItem"),no.prototype),P()(no.prototype,"saveHelpPaneState",[S.ZP],Object.getOwnPropertyDescriptor(no.prototype,"saveHelpPaneState"),no.prototype),no);var so=n(9145),co=n(7237);const lo=function(){function e(){s()(this,e),this.stack=[]}return l()(e,[{key:"push",value:function(e){this.stack.push(e)}},{key:"pop",value:function(e){this.stack.remove(e)}},{key:"peek",value:function(){return this.stack[this.stack.length-1]}},{key:"contains",value:function(e){return this.stack.indexOf(e)>=0}},{key:"forEach",value:function(e){for(var t=0,n=this.stack.length-1;n>=0;n--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!1===e(this.stack[n],n))break}}}]),e}();var uo,ho={},po=0,fo=1,go=2,mo=3,vo={Pane:{Search:["Pr+F"],Filter:["Se+F"],Overview:["Se+O"],Complete:["Pr+Enter"],ZoomOut:["Se+Sh+Enter","Se+ArrowLeft"],ZoomIn:["Se+Enter","Se+ArrowRight"],EditNote:["Sh+Enter"],Collapse:["Pr+Period","mac:Se+Space"],CollapseRecursive:["Pr+Sh+Period","mac:Se+Sh+Space"],CollapseAll:["Pr+Se+Period","mac:Pr+Se+Sh+Space"],Unindent:["Sh+Tab"],Indent:["Tab"],UnindentWithoutChildren:["Pr+BracketLeft","Se+BracketLeft","Se+Sh+ArrowLeft"],IndentWithoutChildren:["Pr+BracketRight","Se+BracketRight","Se+Sh+ArrowRight"],MoveUp:["win:Se+Sh+ArrowUp","mac:Op+ArrowUp","win:Pr+Sh+ArrowUp"],MoveDown:["win:Se+Sh+ArrowDown","mac:Op+ArrowDown","win:Pr+Sh+ArrowDown"],Priority1:["Pr+D1"],Priority2:["Pr+D2"],Priority3:["Pr+D3"],PriorityNone:["Pr+D0","Pr+D4"],Star:["Pr+D8","win:Pr+Tilde"],NextPane:["mac:app:Se+Tilde","mac:app:Pr+Op+ArrowRight","win:Se+Tilde"],PreviousPane:["mac:app:Se+Sh+Tilde","mac:app:Pr+Op+ArrowLeft","win:Se+Sh+Tilde"],SelectItem:["Se+L"],ClosePane:["Sh+F4"],Bold:["Pr+B"],Italic:["Pr+I"],Underline:["Pr+U"],Strike:["Pr+Sh+X"],Highlight:["Pr+Sh+B"],InlineCode:["Pr+Sh+C"],CodeBlock:["win:Pr+Sh+Se+C","mac:Pr+Sh+Op+C"],InsertLink:["Pr+K"],MoveAutocomplete:["Se+M"],HighlightInAllPanes:["Se+G"],PrefixHeader:["Pr+Sh+H","Pr+Sh+P","Pr+Sh+D6","win:Pr+Sh+D3"],PrefixTask:["mac:app:Pr+Sh+BracketLeft","win:Pr+Sh+BracketLeft","Se+Sh+BracketLeft","Pr+Sh+D9","Pr+Sh+D0"],PrefixBullet:["Pr+Sh+D8"],PrefixNumList:["Pr+Sh+D1"],AddToCalendar:["Se+C"],DeleteItem:["Pr+Sh+Backspace","Pr+Sh+K"],Date:["Pr+Sh+D"]},Global:{GlobalSearch:["Pr+P","Pr+Sh+F","Se+J"],SelectPane1:["app:Se+D1"],SelectPane2:["app:Se+D2"],SelectPane3:["app:Se+D3"],SelectPane4:["app:Se+D4"],SelectPane5:["app:Se+D5"],SelectPane6:["app:Se+D6"],SelectPane7:["app:Se+D7"],SelectPane8:["app:Se+D8"],SelectPane9:["app:Se+D9"],SelectPane10:["app:Se+D0"],Undo:["Pr+Z"],Redo:["Pr+Y","Pr+Sh+Z"],AddPane:["app:Pr+T","Se+T"],NewItem:["app:Pr+N","Se+N"],EmailCompose:["Pr+E"],NextBoard:["mac:app:Se+Tab","win:app:Pr+Tab"],PreviousBoard:["mac:app:Se+Sh+Tab","win:app:Pr+Sh+Tab"],SelectBoard1:["Se+Sh+D1"],SelectBoard2:["Se+Sh+D2"],SelectBoard3:["Se+Sh+D3"],SelectBoard4:["Se+Sh+D4"],SelectBoard5:["Se+Sh+D5"],SelectBoard6:["Se+Sh+D6"],SelectBoard7:["Se+Sh+D7"],SelectBoard8:["Se+Sh+D8"],SelectBoard9:["Se+Sh+D9"],SelectBoard10:["Se+Sh+D0"],HelpHotkeys:["Pr+Slash","Se+Slash"],Help:["Pr+Sh+Slash","Se+Sh+Slash"],Settings:["mac:app:Pr+Comma"]},Email:{Down:["ArrowDown","Sh+ArrowDown","J","Sh+J"],Up:["ArrowUp","Sh+ArrowUp","K","Sh+K"],Open:["Enter"],Archive:["E","Slash","Pr+Enter"],MarkRead:["I"],MarkUnread:["U"],OpenInGmail:["G"],CopyToItem:["M"],CopyToNewItem:["T"],Star:["S","D8"],Delete:["Backspace","Delete"]},"Legacy Email":{Down:["ArrowDown","J"],Up:["ArrowUp","K"],Open:["Enter"],Archive:["E","Slash"],Delete:["Delete","Backspace","Sh+D3"],Schedule:["C"],Move:["M","V"],Task:["T"],Label:["L"],MarkRead:["I"],MarkUnread:["U"],Star:["S","D8"],Reply:["R"],ReplyAll:["Sh+R","A"],Forward:["F"],Priority1:["D1"],Priority2:["D2"],Priority3:["D3"],RemoveFromLabel:["Y"],Undo:["Z"],Print:["P"],OpenInGmail:["G"],Menu:["win:ContextMenu"]}};const yo=(uo=function(){function e(){var t,n=this;s()(this,e),this.currentArrowsMode=void 0,this.platformPrimaryKey=D.Z.mac?fo:po,this.platformSecondaryKey=D.Z.mac?po:go;var r=function(e,t,r){var i=0;if(r||!_o.menus.isContextMenuOpen()&&!_o.menus.isModalOpen()){for(var a,o={},s=o.ctrlKey,c=o.metaKey,l=o.altKey,u=o.shiftKey,d=0;d<t.length;d++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var h,p=t[d],f=!p.mods,g=void 0,m=void 0,v=void 0,y=void 0;if(f||(g=!!p.mods[po]===!!s,m=!!p.mods[fo]===!!c||p.keyCode===w.Z.KeyCode.ContextMenu,v=!!p.mods[go]===!!l,y=!!p.mods[mo]===!!u),f||g&&m&&v&&y)if(p.isGlobal||e.target===document.body&&!_o.menus.isContextMenuOpen()&&!_o.menus.isModalOpen()||_.Z.findParent(e.target,"paneContent")||_.Z.findParent(e.target,"paneHiddenInput"))if(!p.isOnPane||p.group===(null===(h=_.Z.focusedPane)||void 0===h?void 0:h.title)){a=p;break}}if(a){n.currentArrowsMode&&!a.isOnPane&&(n._exitingArrowsMode=n.currentArrowsMode,n._exitArrowsMode());var k=a.callback.call(n,e);return(a.stopPropagation||r)&&e.stopPropagation(),n._exitingArrowsMode=void 0,!1===k||(e.handled=!0,_.Z.preventDefault(e),!1)}}},i=function(e){if(_o.setup&&_o.settings.activeUser.get()){D.Z.normalizeKeys(e);var i,a=e.normCode;if(D.Z.mac&&e.altKey&&e.code){var o=w.Z.KeyCode[e.code.replace("Key","")];o&&(a=o)}if(t=a,n.currentArrowsMode&&n._updateArrowsMode(e),n.hotkeyStack.forEach((function(t){if(t&&t[a]&&(i=r(e,[t[a]],!0)),void 0!==i)return!1})),void 0===i){var s=ho[a];s&&(i=r(e,s))}return i}};this.hotkeyStack=new lo,this.currentArrowsMode=void 0,this.arrowsModeHotkeys={},ve.Z.binder(this,"onMouseDownArrowsMode"),document.addEventListener("keydown",i,!0),document.addEventListener("keyup",(function(e){if(_o.setup&&_o.settings.activeUser.get()){D.Z.normalizeKeys(e);var n=e.normCode;if(D.Z.windows&&t!==n)if(n===w.Z.KeyCode.D1||n===w.Z.KeyCode.D2||n===w.Z.KeyCode.D3||n===w.Z.KeyCode.D8)ho[n]&&(i(e),t=void 0)}}),!0),_o.settings.onLoaded((function(){n.updateConfig(),_o.settings.hotkeys.listen(n.updateConfig)})),this.loadDefaultConfig(),this.updateConfig()}return l()(e,[{key:"loadDefaultConfig",value:function(){this.defaultConfig=vo}},{key:"updateConfig",value:function(){var e=this,t=_o.billingManager.hasPremiumFeatures()&&_o.settings.hotkeys.get()||{};this.config={},ho={},Object.keys(this.defaultConfig).forEach((function(n){return e.config[n]=Object.assign({},e.defaultConfig[n],t[n])})),Object.keys(this.config.Email).forEach((function(t){return e.createAndAddHotkeyNew("Email",t,e.config.Email[t],!1,!0,"Email")})),Object.keys(this.config["Legacy Email"]).forEach((function(t){return e.createAndAddHotkeyNew("Legacy Email",t,e.config["Legacy Email"][t],!1,!0,"Legacy Email")})),Object.keys(this.config.Pane).forEach((function(t){return e.createAndAddHotkeyNew("Pane",t,e.config.Pane[t],!1)})),Object.keys(this.config.Global).forEach((function(t){return e.createAndAddHotkeyNew("Global",t,e.config.Global[t],!0)})),this.createAndAddHotkeyNew("None","Noop",["Pr+S"],!0)}},{key:"createAndAddHotkeyNew",value:function(e,t,n,r){var i=this,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=this.createHotkeyNew(e,t,n,r,a,o);s.forEach((function(e){return i.addHotkeyNew(e)}))}},{key:"createHotkeyNew",value:function(e,t,n,r){var i=0,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=[],s=a?this.callbackOnPane.bind(this,t):this["hotkey"+t];try{_.Z.PAssert(82,s&&_.Z.isFunction(s),"Missing hotkey handler",t)}catch(f){_.Z.reportError(f)}for(var c=0;c<n.length;c++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var l=n[c],u=l.split(":"),d=u[u.length-1].split("+"),h=w.Z.KeyCode[d[d.length-1]];try{_.Z.PAssert(83,h,"Key code must be defined",l)}catch(f){_.Z.reportError(f)}if(this.isValidPlatform(l)){var p={group:e,name:c>0?t+c:t,isGlobal:r,keyCode:h,primary:d.indexOf("Pr")>=0,secondary:d.indexOf("Se")>=0,shift:d.indexOf("Sh")>=0,option:d.indexOf("Op")>=0,isOnPane:a,callback:s,mods:{}};p.mods={},p.primary&&(p.mods[this.platformPrimaryKey]=!0),p.secondary&&(p.mods[this.platformSecondaryKey]=!0),p.option&&(p.mods[go]=!0),p.shift&&(p.mods[mo]=!0),o.push(p)}}return o}},{key:"isValidPlatform",value:function(e){var t=e.split(":");return 1===t.length||(t.indexOf("win")<0||!D.Z.mac)&&(t.indexOf("mac")<0||D.Z.mac)&&(t.indexOf("app")<0||D.Z.isNativeApp())}},{key:"pushStack",value:function(e){for(var t=0,n={},r=0;r<e.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[r];n[i.keyCode]=i}return this.hotkeyStack.push(n),n}},{key:"pushStackEscape",value:function(e){return this.pushStack([this.createEscape(e)])}},{key:"popStack",value:function(e){this.hotkeyStack.pop(e)}},{key:"getHotkey",value:function(e){var t,n=ho[e.normCode];if(n)for(var r=0,i=0;i<n.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=n[i],o=!a.mods,s=void 0,c=void 0,l=void 0,u=void 0;if(o||(s=!!a.mods[po]===!!e.ctrlKey,c=!!a.mods[fo]===!!e.metaKey,l=!!a.mods[go]===!!e.altKey,u=!!a.mods[mo]===!!e.shiftKey),o||s&&c&&l&&u){t=a.name;break}}return t}},{key:"create",value:function(e,t,n,r,i,a){try{_.Z.PAssert(84,_.Z.isNumber(e),"Invalid keyCode")}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(85,_.Z.isBoolean(t),"Invalid isGlobal")}catch(s){_.Z.reportError(s)}try{_.Z.PAssert(86,_.Z.isFunction(i),"Invalid callback")}catch(s){_.Z.reportError(s)}var o={group:"",name:"",keyCode:e,mods:{},callback:i,isGlobal:t};return n!==w.Z.Primary.Yes&&n!==w.Z.Primary.Both&&n!==w.Z.Primary.Only||(o.mods[this.platformPrimaryKey]=!0),n!==w.Z.Primary.No&&n!==w.Z.Primary.Never&&n!==w.Z.Primary.Both||(o.mods[this.platformSecondaryKey]=!0),a&&D.Z.mac&&(o.mods[go]=!0),r===w.Z.Shift.Yes&&(o.mods[mo]=!0),o}},{key:"addHotkeyNew",value:function(e){var t=e.keyCode;return ho[t]||(ho[t]=[]),ho[t].push(e),e}},{key:"createEscape",value:function(e){return this.create(w.Z.KeyCode.Escape,!0,w.Z.Primary.Either,w.Z.Shift.Either,e)}},{key:"_addHotkey",value:function(e,t,n,r,i,a,o){try{_.Z.PAssert(87,n,"Must supply a valid keycode")}catch(c){_.Z.reportError(c)}if(ho[n]=ho[n]||[],r===w.Z.Primary.Either)return this._addHotkey(e,t,n,w.Z.Primary.No,i,a,o),void this._addHotkey(e,t,n,w.Z.Primary.Yes,i,a,o);if(i===w.Z.Shift.Either)return this._addHotkey(e,t,n,r,w.Z.Shift.No,a,o),void this._addHotkey(e,t,n,r,w.Z.Shift.Yes,a,o);try{_.Z.PAssert(88,!D.Z.windows||r!==w.Z.Primary.Both,"Should never require AltGr combo on windows")}catch(c){_.Z.reportError(c)}var s=this.create(n,t,r,i,a);s.stopPropagation=o,s.name=e,ho[n].push(s)}},{key:"registerArrowsMode",value:function(e,t,n,r,i,a){var o=this["arrowsModeIndex"+e]=new x.Z(-1);return!0===t?this._enterArrowsMode(e,n,r,i):this._addHotkey(e,!0,t.keyCode,t.primary,t.shift,this._onKeyDownArrowsMode.bind(this,e,n,r,i,a)),o}},{key:"getArrowsModeObs",value:function(e){return this["arrowsModeIndex"+e]}},{key:"isInArrowsMode",value:function(e){return this.currentArrowsMode&&this.currentArrowsMode.name===e}},{key:"exitArrowsMode",value:function(e){this.isInArrowsMode(e)&&this._exitArrowsMode()}},{key:"_onKeyDownArrowsMode",value:function(e,t,n,r,i){this.currentArrowsMode?this._exitArrowsMode():this._exitingArrowsMode&&this._exitingArrowsMode.name===e||this._enterArrowsMode(e,t,n,r,i)}},{key:"_enterArrowsMode",value:function(e,t,n,r,i){this.currentArrowsMode={name:e,cbGetMax:t,cbSelect:n,cbKey:r,cbOnHotkey:i},i&&i(),document.addEventListener("mousedown",this.onMouseDownArrowsMode,!0),this["arrowsModeIndex"+e].set(-1)}},{key:"_exitArrowsMode",value:function(){this.currentArrowsMode&&(document.removeEventListener("mousedown",this.onMouseDownArrowsMode,!0),this.getArrowsModeObs(this.currentArrowsMode.name).set(-1),this.currentArrowsMode=void 0)}},{key:"onMouseDownArrowsMode",value:function(e){this._exitArrowsMode()}},{key:"_updateArrowsMode",value:function(e){var t=this.currentArrowsMode,n=this.getArrowsModeObs(t.name),r=D.Z.getKeyCode(e),i=n.get(),a=t.cbGetMax();if(r===w.Z.KeyCode.Enter)i>=0&&t.cbSelect(i),this._exitArrowsMode(),_.Z.preventAndStop(e);else if(r===w.Z.KeyCode.Escape)this._exitArrowsMode();else if(r===w.Z.KeyCode.ArrowUp)i>0&&n.set(i-1);else if(r===w.Z.KeyCode.ArrowDown)i<a-1&&n.set(i+1);else if(t.cbKey){var o=t.cbKey(r,e);o>=0&&(t.cbSelect(o),this._exitArrowsMode(),_.Z.preventAndStop(e))}}},{key:"checkToggleSearchFilter",value:function(e){var t=_.Z.focusedPane;return!(!t||!t.search.isFocused.get())&&(t.search.toggleFilterDefault(e),!0)}},{key:"checkToggleSearchPriority",value:function(e){var t=_.Z.focusedPane;return!(!t||!t.search.isFocused.get())&&(t.search.getFilterValue("priority")===e&&(e=0),t.search.setFilter("priority",e),!0)}},{key:"hotkeyNewItem",value:function(){_o.menus.closeContextMenu(),_o.menus.openItemEditor({addOnSave:!0,selectDocument:!0,element:"newItemButton"})}},{key:"hotkeyAddPane",value:function(){_o.menus.closeContextMenu(),_o.menus.openAddPaneMenu({element:"addPaneButton"})}},{key:"hotkeyFilter",value:function(){var e=_.Z.focusedPane||_o.PaneManager.getPaneAtIndex(0);if(e){var t=e.search;t.isFocused.get()||t.focus()}}},{key:"hotkeySearch",value:function(){var e=_.Z.focusedPane||_o.PaneManager.getPaneAtIndex(0);null===e||void 0===e||e.searchingPaneObjects.setProperty("isSearching",!0,!0)}},{key:"hotkeyHighlightInAllPanes",value:function(){_.Z.focusedPane.applyToSelection((function(e){return _o.PaneManager.scrollToAndHighlightItem(e,_.Z.focusedPane),!1}))}},{key:"hotkeyOverview",value:function(){_.Z.focusedPane&&_.Z.focusedPane.toggleOverviewVisibility()}},{key:"hotkeyComplete",value:function(){var e,t=B.Z.getPane(),n=B.Z.getSelectedItems(),r=B.Z.getStartObject(),i=t.findNextItem(r);if(B.Z.isValid()&&1===n.length&&!n[0].isComplete()&&(e=!0),_.Z.beginCompleteAction(),t.applyFnToSelection("setComplete",{toggle:"isComplete",value2:w.Z.ChangeType.Local,noRestoreSel:!0}),e&&i){var a=t.findPaneObject(i.id);0,B.Z.selectObject(a,0)}_.Z.endCompleteAction(),_.Z.sendEvent("Hotkey","Complete")}},{key:"_hotkeyPriorityHelper",value:function(e){_.Z.focusedPane&&!this.checkToggleSearchPriority(e)&&_.Z.focusedPane.applyPriorityToSelection(e,!0)}},{key:"hotkeyPriority1",value:function(){this._hotkeyPriorityHelper(w.Z.VMLIFlag.P1)}},{key:"hotkeyPriority2",value:function(){this._hotkeyPriorityHelper(w.Z.VMLIFlag.P2)}},{key:"hotkeyPriority3",value:function(){this._hotkeyPriorityHelper(w.Z.VMLIFlag.P3)}},{key:"hotkeyPriorityNone",value:function(){_.Z.focusedPane.applyPriorityToSelection(w.Z.VMLIFlag.None)}},{key:"hotkeyStar",value:function(){this.checkToggleSearchFilter("starred")||_.Z.focusedPane.applyFnToSelection("setStarred",{toggle:"isStarred",value2:w.Z.ChangeType.Local})}},{key:"selectPaneAtIndex",value:function(e){if(e>=0&&e<_o.PaneManager.paneCount()){var t=_o.PaneManager.getPaneAtIndex(e);if(t&&(B.Z.focusPaneAndRestoreSelection(t),!B.Z.isValid()&&t.isEditable)){var n=t.indexOfFirstItem();t.selectIndex(n),t.scrollIndexIntoView(n,"smooth")}}}},{key:"hotkeySelectPane1",value:function(){this.selectPaneAtIndex(0)}},{key:"hotkeySelectPane2",value:function(){this.selectPaneAtIndex(1)}},{key:"hotkeySelectPane3",value:function(){this.selectPaneAtIndex(2)}},{key:"hotkeySelectPane4",value:function(){this.selectPaneAtIndex(3)}},{key:"hotkeySelectPane5",value:function(){this.selectPaneAtIndex(4)}},{key:"hotkeySelectPane6",value:function(){this.selectPaneAtIndex(5)}},{key:"hotkeySelectPane7",value:function(){this.selectPaneAtIndex(6)}},{key:"hotkeySelectPane8",value:function(){this.selectPaneAtIndex(7)}},{key:"hotkeySelectPane9",value:function(){this.selectPaneAtIndex(8)}},{key:"hotkeySelectPane10",value:function(){this.selectPaneAtIndex(9)}},{key:"hotkeyPreviousPane",value:function(){var e=_o.PaneManager,t=e.getFocusedPaneIndex()-1;t<0&&(t=e.paneCount()-1),this.selectPaneAtIndex(t)}},{key:"hotkeyNextPane",value:function(){var e=_o.PaneManager,t=e.getFocusedPaneIndex()+1;t>=e.paneCount()&&(t=0),this.selectPaneAtIndex(t)}},{key:"hotkeyZoomIn",value:function(){_.Z.focusedPane&&_.Z.focusedPane.applyToSelection((function(e){return e.isNote()||_.Z.focusedPane.zoomIn(e),!1}))}},{key:"hotkeyZoomOut",value:function(){var e=_.Z.focusedItem;e&&e.parent()&&_.Z.focusedPane.zoomOut(e.parent())}},{key:"hotkeyCollapse",value:function(){B.Z.pane.get().toggleCollapseSelected()}},{key:"hotkeyCollapseAll",value:function(){_.Z.focusedItem&&_.Z.focusedPane&&_.Z.focusedPane.supportCollapsing&&_.Z.focusedPane.toggleCollapseAll()}},{key:"hotkeyCollapseRecursive",value:function(){B.Z.pane.get().toggleCollapseSelected(!0)}},{key:"hotkeyIndent",value:function(){so.Z.doBatch({pane:!0,undo:!0},(function(){B.Z.isValid()&&co.Z.handleTab(!0)}))}},{key:"hotkeyUnindent",value:function(){so.Z.doBatch({pane:!0,undo:!0},(function(){B.Z.isValid()&&co.Z.handleTab(!0,!0)}))}},{key:"hotkeyIndentWithoutChildren",value:function(){so.Z.doBatch({pane:!0,undo:!0},(function(){B.Z.isValid()&&co.Z.handleTab(!1)}))}},{key:"hotkeyUnindentWithoutChildren",value:function(){so.Z.doBatch({pane:!0,undo:!0},(function(){B.Z.isValid()&&co.Z.handleTab(!1,!0)}))}},{key:"hotkeyMoveUp",value:function(){co.Z.moveUp()}},{key:"hotkeyMoveDown",value:function(){co.Z.moveDown()}},{key:"hotkeySelectItem",value:function(){co.Z.handleSelectAllItem()}},{key:"hotkeyClosePane",value:function(e){void 0!==_o.PaneManager.removeFocusedPane()&&(_o.tooltip.hideTip(),e.stopImmediatePropagation())}},{key:"hotkeyBold",value:function(e){return B.Z.isValid()&&B.Z.applyFormatToSelection("bold"),_.Z.preventDefault(e),!1}},{key:"hotkeyItalic",value:function(e){return B.Z.isValid()&&B.Z.applyFormatToSelection("italic"),_.Z.preventDefault(e),!1}},{key:"hotkeyUnderline",value:function(e){return B.Z.isValid()&&B.Z.applyFormatToSelection("underline"),_.Z.preventDefault(e),!1}},{key:"hotkeyStrike",value:function(e){return B.Z.isValid()&&B.Z.applyFormatToSelection("strike"),_.Z.preventDefault(e),!1}},{key:"hotkeyHighlight",value:function(e){return B.Z.isValid()&&B.Z.applyFormatToSelection("highlight"),_.Z.preventDefault(e),!1}},{key:"hotkeyInlineCode",value:function(e){return B.Z.isValid()&&B.Z.applyFormatToSelection("code"),_.Z.preventDefault(e),!1}},{key:"hotkeyInsertLink",value:function(e){B.Z.isValid()&&B.Z.getStartItem().insertLinkAtSelection();return _.Z.preventDefault(e),!1}},{key:"hotkeyMoveAutocomplete",value:function(){_.Z.focusedPane&&B.Z.isValid()&&_.Z.focusedPane.autocompleteMove()}},{key:"hotkeyGlobalSearch",value:function(){var e=_.Z.focusedPane||_o.PaneManager.getPaneAtIndex(0);null===e||void 0===e||e.isSearchingGlobal.set(!0,!0)}},{key:"hotkeyUndo",value:function(){_.Z.focusedPane?_.Z.focusedPane.handleUndo():rt.Z.undo()}},{key:"hotkeyRedo",value:function(){_.Z.focusedPane?_.Z.focusedPane.handleRedo():rt.Z.redo()}},{key:"hotkeyPrefixHeader",value:function(){B.Z.applyPrefixToSelection(w.Z.Prefix.Header)}},{key:"hotkeyPrefixTask",value:function(){B.Z.applyPrefixToSelection(w.Z.Prefix.Task)}},{key:"hotkeyPrefixBullet",value:function(){B.Z.applyPrefixToSelection(w.Z.Prefix.Bullet)}},{key:"hotkeyPrefixNumList",value:function(){B.Z.applyPrefixToSelection(w.Z.Prefix.NumList)}},{key:"hotkeyCodeBlock",value:function(){B.Z.applyPrefixToSelection(w.Z.Prefix.CodeBlock)}},{key:"hotkeyEmailCompose",value:function(){var e=_o.supportEmailViews();if(e&&_o.settings.emailViewAccounts.length()>0)Ue.Z.getPluginNew("Email").composeEmail(!0);else{var t=_o.pluginManager.getPluginGmail();t.isEnabled()?_o.menus.openComposeEmail(t):!_.Z.isDemoMode()&&e&&_o.toasts.pushMessage(w.Z.MessageID.SetupGmailViews)}}},{key:"hotkeyPreviousBoard",value:function(){pe.Z.hotkeyPrevBoard()}},{key:"hotkeyNextBoard",value:function(){pe.Z.hotkeyNextBoard()}},{key:"hotkeySelectBoard1",value:function(){pe.Z.selectBoardAtIndex(0)}},{key:"hotkeySelectBoard2",value:function(){pe.Z.selectBoardAtIndex(1)}},{key:"hotkeySelectBoard3",value:function(){pe.Z.selectBoardAtIndex(2)}},{key:"hotkeySelectBoard4",value:function(){pe.Z.selectBoardAtIndex(3)}},{key:"hotkeySelectBoard5",value:function(){pe.Z.selectBoardAtIndex(4)}},{key:"hotkeySelectBoard6",value:function(){pe.Z.selectBoardAtIndex(5)}},{key:"hotkeySelectBoard7",value:function(){pe.Z.selectBoardAtIndex(6)}},{key:"hotkeySelectBoard8",value:function(){pe.Z.selectBoardAtIndex(7)}},{key:"hotkeySelectBoard9",value:function(){pe.Z.selectBoardAtIndex(8)}},{key:"hotkeySelectBoard10",value:function(){pe.Z.selectBoardAtIndex(9)}},{key:"hotkeyAddToCalendar",value:function(){var e=_o.pluginManager.getPluginGCalendar();e&&e.isOn()&&_.Z.focusedPane.applyToSelection((function(t){return e.createEventForItem(t)}))}},{key:"hotkeyEditNote",value:function(){_.Z.focusedPane&&(so.Z.beginBatch({pane:!0}),_.Z.focusedPane.applyToSelection((function(e,t,n,r){e.isNote()||_.Z.focusedPane.openNoteContextMenuByPaneObject(r)})),so.Z.commitBatch())}},{key:"hotkeyHelp",value:function(){_o.intro.toggleHelp()}},{key:"hotkeyHelpHotkeys",value:function(){_o.intro.toggleHotkeys()}},{key:"hotkeySettings",value:function(){_o.menus.openSettings()}},{key:"hotkeyDeleteItem",value:function(){_.Z.focusedPane.deleteSelected()}},{key:"hotkeyDate",value:function(){if(B.Z.isValid()){var e=B.Z.getStartIndex(),t=B.Z.getStartItem(),n=B.Z.getStartObject(),r=B.Z.getPane(),i=B.Z.getStartOffsetWithPrefix();if(e>=0){var a=r.elementAtIndex(e);a&&_o.menus.openDate({element:a,item:t,pane:r,paneObject:n,textOffset:i>=0?i:t.getParsedText().length})}}}},{key:"hotkeyNoop",value:function(){}},{key:"callbackOnPane",value:function(e,t){var n=_.Z.focusedPane;return n&&n.onHotkey&&n.onHotkey(e,t),!1}},{key:"printHotkeyByName",value:function(e,t){var n=this.config[t||"Pane"][e];try{_.Z.PAssert(89,n,"Getting an invalid hotkey")}catch(o){_.Z.reportError(o)}if(n)for(var r=0,i=0;i<n.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=n[i];if(this.isValidPlatform(a))return this.printHotkey(a)}}},{key:"convertToElectron",value:function(e){return e.replace(/ /g,"").replace("Pr",D.Z.mac?"Cmd":"Ctrl").replace("Se",D.Z.mac?"Ctrl":"Alt").replace("Op","Option").replace("Sh","Shift")}},{key:"printHotkey",value:function(e){for(var t=0,n=e.split(":"),r=n[n.length-1].split("+"),i="",a=0;a<r.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=r[a];a>0&&(i+=D.Z.windows?" + ":" "),i+="Pr"===o?D.Z.priModKey:"Se"===o?D.Z.secModKeyForce:"Sh"===o?D.Z.mac?"\u21e7":"Shift":"Op"===o?"\u2325":2===o.length&&"D"===o[0]?o[1]:"Slash"===o?"/":"Tilde"===o?"~":"ArrowLeft"===o?"\u2190":"ArrowRight"===o?"\u2192":"ArrowUp"===o?"\u2191":"ArrowDown"===o?"\u2193":"Period"===o?".":"Comma"===o?",":"Equal"===o?"=":"Plus"===o?"+":"Dash"===o?"-":"Backspace"===o?D.Z.mac?"Delete":o:o.startsWith("Bracket")||o.endsWith("Bracket")?o.includes("Left")?"[":"]":o}return i}},{key:"checkHotkeyOverlap",value:function(e,t){var n=t.mods,r=ho[e];if(r)for(var i=0,a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[a],s=o.mods,c=!0;if(!_.Z.isEmpty(n)||!_.Z.isEmpty(s))for(var l=0,u=0;u<4;u++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(n[u]!==s[u]){c=!1;break}}if(c&&(o.group!==t.group||o.name!==t.name)&&!o.isOnPane&&!t.isOnPane)return!0}}},{key:"setHotkey",value:function(e,t,n){var r=this;if(this.createHotkeyNew(e,t,n,"Global"===e,"Email"===e,e).some((function(e){return r.checkHotkeyOverlap(e.keyCode,e)})))return!1;var i=_.Z.cloneDeep(_o.settings.hotkeys.get());i[e]||(i[e]={}),_.Z.deepEqual(this.defaultConfig[e][t],n)?delete i[e][t]:i[e][t]=n,_o.settings.hotkeys.set(i)}},{key:"resetHotkey",value:function(e,t){var n=_.Z.cloneDeep(_o.settings.hotkeys.get());n[e]&&delete n[e][t],_o.settings.hotkeys.set(n)}}]),e}(),P()(uo.prototype,"updateConfig",[S.ZP],Object.getOwnPropertyDescriptor(uo.prototype,"updateConfig"),uo.prototype),uo);function ko(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=v()(e);if(t){var i=v()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return g()(this,n)}}const _o=new(function(e){p()(n,e);var t=ko(n);function n(){return s()(this,n),t.apply(this,arguments)}return l()(n,[{key:"init",value:function(){this.rollbar=window.Rollbar,this.ElectronBridge=new Wa,this.nativeBridge=new Xa,d()(v()(n.prototype),"init",this).call(this),this.setup=new $a,this.DesktopUI=new Ha,this.DesktopUI.init(),this.tooltip=new Ja,this.AppCache=new to,this.intro=new oo,this.hotkeys=new yo,ie.Z.init()}},{key:"onIntroAction",value:function(e){this.intro&&this.intro.onAction(e)}},{key:"openUrl",value:function(e,t,n){I.LA.isNativeApp()?I.LA.openURL(e):_.Z.openUrl(e)}},{key:"supportEmailViews",value:function(){return D.Z.appv>=2||!1}},{key:"supportOutlookViews",value:function(){return!1}},{key:"parseDate",value:function(e){return this.International.parseDate(e,this.settings.dateFormat.get())}},{key:"tryWithErrorMessageHandling",value:function(){var e=a()(k().mark((function e(t,n){var r,i;return k().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t();case 3:return r=e.sent,e.abrupt("return",r);case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0),(i=null===e.t0||void 0===e.t0?void 0:e.t0.message)&&this.menus.alert({text:i});case 12:return e.prev=12,null===n||void 0===n||n(),e.finish(12);case 15:case"end":return e.stop()}}}),e,this,[[0,7,12,15]])})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(ja))},1015:(e,t,n)=>{"use strict";n.d(t,{Z:()=>x});var r,i=n(4575),a=n.n(i),o=n(3913),s=n.n(o),c=n(6525),l=n.n(c),u=n(2205),d=n.n(u),h=n(8585),p=n.n(h),f=n(9754),g=n.n(f),m=n(8651),v=n(8855),y=n(3124),k=n.n(y),_=n(8572),Z=n(4654),w=n(5252),b=n(5193),P=n(5340),S=n(4327);const D=(r=function(){function e(){a()(this,e),this.undoStack=[],this.redoStack=[],this.isUndoing=!1,this._deleteSelection=void 0,this._batch=[],this.__numInBatch=0,this._batchPrevSel=void 0,this._groupTextChanges=!1,this._needsSelection=!1,w.Z.binder(this,"_onSelectionChanged"),S.Z.listen("selectionChanged",this._onSelectionChanged)}return s()(e,[{key:"_getLastState",value:function(){return this.undoStack[this.undoStack.length-1]}},{key:"_getLastAction",value:function(){var e=this.undoStack[this.undoStack.length-1];if(e&&1===e.actions.length)return e.actions[0]}},{key:"pushModified",value:function(e,t,n){if(!this.isUndoing){var r=Object.keys(t).filter((function(e){return"id"!==e&&"regexpFlags"!==e})).length;if(r>0){var i=!1;if("text"in t){var a=this._getLastAction(),o=this._getLastState();this._needsSelection=!0,this._groupTextChanges&&o&&a&&a.changes.text&&a.itemId===e.id&&(a.changes.text=t.text,i=1===r)}i||this._doPush(e,{itemId:e.id,type:"Modified",changes:t,prevState:n}),this.clearDeleteSelection()}}}},{key:"pushAdded",value:function(e,t){try{m.Z.PAssert(462,void 0!==t.index,"Item should have index when adding")}catch(n){m.Z.reportError(n)}this.isUndoing||(this._doPush(t,{itemId:t.id,type:"Added",changes:{parent:e.id,index:t.index}}),this.clearDeleteSelection())}},{key:"pushRemoved",value:function(e,t){try{m.Z.PAssert(463,void 0!==t.index,"Item should have index when removing")}catch(n){m.Z.reportError(n)}this.isUndoing||(this._doPush(t,{itemId:t.id,type:"Removed",changes:{parent:e.id,index:t.index}},this._deleteSelection),this.clearDeleteSelection())}},{key:"clearDeleteSelection",value:function(){this.__numInBatch<=0&&(this._deleteSelection=void 0)}},{key:"_doAction",value:function(e){if(!this.isUndoing)try{var t=e?this.redoStack:this.undoStack,n=e?this.undoStack:this.redoStack,r=t.pop();if(r){var i=r.actions;try{m.Z.PAssert(464,i.length>0,"Undo state should have some actions")}catch(a){m.Z.reportError(a)}i.length>0&&(this.isUndoing=!0,Z.default.PaneUpdateBatcher.beginUpdateItems(),m.Z.focusedPane.clearPreventUpdate(),i.forEach((function(t){var n=t.type,r=n===v.Z.CrudActions.Added||n===v.Z.CrudActions.Removed||e?t.changes:t.prevState;Object.keys(r).forEach((function(e){void 0===r[e]&&(r[e]=null)})),e?n===v.Z.CrudActions.Added?r.isDeleted=!1:n===v.Z.CrudActions.Removed&&(r.isDeleted=!0):n===v.Z.CrudActions.Added?(n=v.Z.CrudActions.Removed,r.isDeleted=!0):n!==v.Z.CrudActions.Removed&&null!==r.isDeleted||(n=v.Z.CrudActions.Added,r.isDeleted=!1);var i=b.Z.getItem(t.itemId);if(i){var a=i.getDocumentOwner(),o=b.Z.getItemDataLocal(a,t.itemId);P.Z.onRemoteChange(a,o,t.itemId,r),b.Z.saveItem(i,r,v.Z.ChangeType.Local,v.Z.SaveFlag.All)}})),Z.default.PaneUpdateBatcher.commitUpdateItems(),this.restoreSelFromState(e,r),n.push(r))}}finally{this.isUndoing=!1}}},{key:"restoreSelFromState",value:function(e,t){}},{key:"undo",value:function(){this._doAction(!1)}},{key:"redo",value:function(){this._doAction(!0)}},{key:"_onSelectionChanged",value:function(e){var t=this._getLastState();t&&this._needsSelection?(this._needsSelection=!1,t.selection=e,this._groupTextChanges=!0):this._groupTextChanges=!1}},{key:"saveDeleteSelection",value:function(){}},{key:"saveSelection",value:function(){}},{key:"beginAction",value:function(){this.__numInBatch++,m.Z.timeoutOnce("batch_beginAction",this.onActionTimeout,0)}},{key:"endAction",value:function(e){this.__numInBatch--;try{m.Z.PAssert(465,this.__numInBatch>=0,"Undo batch somehow went negative")}catch(t){m.Z.reportError(t)}(this.__numInBatch<=0||e)&&(this.__numInBatch=0,this._batch.length>0&&(this.undoStack.push({selection:this.saveSelection(),prevSel:this._batchPrevSel,actions:this._batch}),this._batch=[]),this._batchPrevSel=void 0,this._deleteSelection=void 0)}},{key:"onActionTimeout",value:function(){this.__numInBatch>0&&this.endAction(!0)}},{key:"clearGroupTextChanges",value:function(){this._needsSelection=!1,this._groupTextChanges=!1}}]),e}(),k()(r.prototype,"onActionTimeout",[_.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onActionTimeout"),r.prototype),r);var I=n(4472);function E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=g()(e);if(t){var i=g()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return p()(this,n)}}const x=new(function(e){d()(n,e);var t=E(n);function n(){return a()(this,n),t.apply(this,arguments)}return s()(n,[{key:"_doPush",value:function(e,t,n){if(this.redoStack=[],t.itemId=e.id,this.__numInBatch>0){var r=this._batch.indexOfWithProperty("itemId",e.id);if(r>=0){var i=this._batch[r];i.type===v.Z.CrudActions.Modified&&"Removed"===t.type?t.changes.text=i.prevState.text:(Object.assign(t.changes,i.changes,t.changes),Object.assign(t.prevState,i.prevState,t.prevState),t.type=i.type),this._batch[r]=t}else this._batch.push(t)}else{var a=n||this._batchPrevSel||I.Z.getSavedSelection()||this.saveSelection();this.undoStack.push({selection:a,prevSel:a,actions:[t]})}}},{key:"beginAction",value:function(){l()(g()(n.prototype),"beginAction",this).call(this),this._batchPrevSel||(this._batchPrevSel=I.Z.isValid()?this.saveSelection():void 0)}},{key:"restoreSelFromState",value:function(e,t){}},{key:"saveSelection",value:function(){}},{key:"saveDeleteSelection",value:function(){0}},{key:"pushRemoved",value:function(e,t){if(!this.isUndoing)try{m.Z.PAssert(225,this._deleteSelection,"Must have saved delete selection before deleting")}catch(r){m.Z.reportError(r)}l()(g()(n.prototype),"pushRemoved",this).call(this,e,t)}}]),n}(D))},4305:(e,t,n)=>{"use strict";n.d(t,{Z:()=>S});var r,i=n(4575),a=n.n(i),o=n(3913),s=n.n(o),c=n(3124),l=n.n(c),u=n(8572),d=n(8855),h=n(3162),p=n(8651),f=n(7100),g=n(4472),m=n(4654),v=n(1015),y=n(5216),k=n(7237),_=n(8721),Z=n(1095),w=n(3761),b=n(8133),P=d.Z.Regexp.Prefix;const S=new(r=function(){function e(){a()(this,e)}return s()(e,[{key:"init",value:function(){try{p.Z.PAssert(101,"complete"===document.readyState||"interactive"===document.readyState,"Setting up copy/paste too early")}catch(e){p.Z.reportError(e)}document.body.addEventListener("paste",this.handlepaste,!1),document.body.addEventListener("cut",this.handlecut,!1),document.body.addEventListener("copy",this.handlecopy,!1)}},{key:"parseTextForPrefix",value:function(e){var t,n;return P.lastIndex=0,null!==(t=P.exec(e))&&(n=t[1],e=e.substr(t[0].length)),{prefix:n,text:e}}},{key:"insertToNote",value:function(e,t,n){try{p.Z.PAssert(102,e,"Must have a valid start item")}catch(a){p.Z.reportError(a)}try{p.Z.PAssert(103,t,"Must have a valid end item")}catch(a){p.Z.reportError(a)}var r,i=e.getParsedText();r=t===e?i.substring(0,g.Z.getStartOffset())+n+i.substring(g.Z.getEndOffset()):i.substring(0,g.Z.getStartOffset())+n,e.setText(r,d.Z.ChangeType.Local)}},{key:"insert",value:function(e,t,n){var r=this;if(!g.Z.isValid())return!1;var i,a,o,s,c,l="",u=p.Z.focusedPane,b=f.Z.ie?"Text":"text/plain";if(p.Z.isString(e))o={items:[{text:e}]};else if(e&&e.getData){var P,S=e;p.Z.preventAndStop(t);var D=S.getData(b),I=null===D||void 0===D?void 0:D.startsWith("<?xml ");if(s=D&&(D.startsWith("<?opml ")||D.startsWith("<opml ")||I&&D.indexOf("<opml ")>=0),console.log("Paste types:",S.types),s)o=w.Z.parseOPML(D);else if(I)m.default.toasts.pushMessage({text:"Moo.do currently does not support pasting XML. Please contact support@moo.do.",action:d.Z.MessageAction.Contact,hold:!0});else{if(!S.types.includes("text/html")&&(null===(P=S.files)||void 0===P?void 0:P.length)>0)return m.default.pluginManager.handleDropEvent(t,(function(e){var t=g.Z.save(),n=g.Z.getStartItem(),r=n.parent(),i=u.createVMLI({text:e},{parent:r,changeType:d.Z.ChangeType.AllLocal});r.insertItem(i,n.getIndex()),g.Z.restore(t)})),!1;if(!(l=f.Z.ie?void 0:e.getData("moodo/html")||e.getData("text/html"))){l=S.getData(b),l=w.Z.convertPlaintextToHTML(l);var E=p.Z.parseEvernoteLink(l),x=p.Z.isBearLink(l);if(E||x){var C=g.Z.save(),A="Enter title of "+(E?"Evernote":x&&"Bear")+" document";return void m.default.menus.prompt({title:A,cb:function(e){e&&(l="["+e+"]("+l+")"),g.Z.restore(C),r.insert(l,t,"plugin")}})}p.Z.isUrlImage(l)&&m.default.settings.showImagesInline.get()&&(l="!"+l)}if(l){if(p.Z.shouldLog(d.Z.LogLevels.Input)&&p.Z.log(l),!l)return void(p.Z.shouldLog(d.Z.LogLevels.Input)&&p.Z.log("Paste buffer is empty"));var L=document.createElement("div"),M=l.replace(/[\r]|<head(.|\s)*?\/head>|<script(.|\s)*?\/script>/g,"").replace(/\u2022/g,"");0;var T;if((T=/<body(.|\s)*?\/body>/g.exec(M))&&(M=T[0]),L.innerHTML=M,g.Z.isValid()&&g.Z.getStartItem().isNote())this.insertToNote(g.Z.getStartItem(),g.Z.getEndItem(),L.innerText);else{var R=L.children[0];2===L.children.length&&"A"===R.nodeName&&p.Z.isOneNoteLink(R.href)&&(L.innerHTML=R.outerHTML),o=w.Z.traverseDOMNew(L),m.default.settings.showDebugInfo.get()&&m.default.toasts.pushMessage({text:"Pasted with the new paste system. If it doesn't look right, please save this and send it to Moo.do support.",actionText:"SAVE",timeout:1e4,action:function(){var e=new Blob([M],{type:"text/plain;charset=utf-8"});(0,h.saveAs)(e,"Moo.do paste failure.txt")}})}}else{p.Z.shouldLog(d.Z.LogLevels.Input)&&p.Z.log("Paste buffer is empty");try{p.Z.PAssert(104,!1,"Paste with unexpected data type",S.types)}catch(F){p.Z.reportError(F)}}}if(!o||!o.items||0===o.items.length)return!1}if(o){c=!0;var O=function(){var e;m.default.PaneUpdateBatcher.beginUpdateItems(),v.Z.beginAction();var t=g.Z.getStartObject(),n=g.Z.getEndObject(),l=g.Z.getStartItem(),h=l.isPrefixCodeBlock(),f=g.Z.getStartItem().parent(),k=g.Z.getStartItem().getIndex(),w=g.Z.getStartOffsetWithPrefix(),b=g.Z.getEndOffsetWithPrefix();if(i=l,t===n&&h&&(o.items.length>1||(null===(e=o.items[0].items)||void 0===e?void 0:e.length)>0)?(o.items[0].text=p.Z.mapRecursive(o.items,"items",(function(e,t){return" ".repeat(2*t)+e.text})).join("\n"),o.items[0].items=[],o.items=o.items.slice(0,1)):p.Z.mapRecursive(o.items,"items",(function(e){e.text&&!e.text.startsWith(d.Z.Prefix.CodeBlock)&&(e.text=e.text.replace(/[\n\t]/g," "))})),1!==o.items.length||o.items[0].items&&0!==o.items[0].items.length)if(u.isViewAgenda())m.default.toasts.pushMessage({text:"Pasting multiple items into the agenda is not supported. Please try pasting into an Outline pane.",actionText:"OKAY"}),c=!1;else{var P=0;if(p.Z.shouldLog(d.Z.LogLevels.Timing)&&console.time("paste"),u.clearPreventUpdate(),g.Z.getStartOffset()>0&&k++,o&&o.items){var S=0,D=p.Z.recursiveItemsToArray(o.items);_.Z.rewriteItemIDs(D,s),_.Z.convertItemDatas(D);for(var I=0;I<o.items.length;++I){if(S++>5e3&&__infLoop&&__infLoop(S))throw new RangeError;var E=o.items[I];if(E.isNote){if(!f.getNote()){var x=u.createVMLI({text:E.text,isNote:!0},{parent:f,changeType:d.Z.ChangeType.AllLocal});f.setNote(x,d.Z.ChangeType.Local)}}else{0===I&&0===l.getRawText().length&&0===l.numChildren()&&l.deleteSelf(d.Z.ChangeType.Local);var C=u.createVMLI(E,{parent:f,changeType:d.Z.ChangeType.AllLocal});f.insertItem(C,k++,!1),i=C}}}for(;i.hasChildren();){if(P++>5e3&&__infLoop&&__infLoop(P))throw new RangeError;i=i.getLastChild()}a=-1}else{var A=t.showMarkdown(),L=o.items[0];_.Z.convertItemData(L);var M=L.text,T=w>0?r.parseTextForPrefix(M).text:M,R="",O="";if(!g.Z.isSelectedFully(g.Z.getStartObject())){var F=l.elsNew.split(t,w),N=l.elsNew.split(t,b);R=F[0].getRawText(A),O=N[1]?N[1].getRawText(A):""}h||(!R.length||R.endsWith(" ")||T.startsWith(" ")||(T=" "+T),!O.length||T.endsWith(" ")||O.startsWith(" ")||(T+=" "));var B=R+T+O;if(L.date)try{l.setMooDate(Z.Z.fromData(L.date),d.Z.ChangeType.Local,!0)}catch(j){p.Z.reportError(j,"Error parsing MooDate in paste")}R||O||(L.isStarred&&l.setStarred(!0,d.Z.ChangeType.Local),L.priority&&l.setPriority(L.priority,d.Z.ChangeType.Local)),l.setText(B,d.Z.ChangeType.Local);var U=y.Z.parseTextNew(l,T).elsNew.getDisplayText(l,{showMarkdown:A}).length;a=g.Z.getStartOffset()+U}v.Z.endAction(),m.default.PaneUpdateBatcher.commitUpdateItems(),p.Z.shouldLog(d.Z.LogLevels.Timing)&&console.timeEnd("paste")};g.Z.getStartIndex()!==g.Z.getEndIndex()?k.Z.handleMultiselect({normCode:d.Z.KeyCode.Backspace,preventDefault:p.Z.emptyFn},O):O()}return c&&i&&(g.Z.selectItem(i,a),p.Z.focusedPane.scrollItemIntoView(i)),!1}},{key:"handlepaste",value:function(e){var t=e&&e.clipboardData?e.clipboardData:e.synthetic?e.data:window.clipboardData;if(g.Z.isValid()&&!m.default.menus.isContextMenuOpen()&&!m.default.menus.isModalOpen()&&!b.o0.isMenuOpen()){v.Z.saveDeleteSelection(),v.Z.beginAction();var n=this.insert(t,e,"paste");return v.Z.endAction(),n}}},{key:"handlecut",value:function(e){var t=!0;if(!this.ignoreCopy&&g.Z.isValid()&&!m.default.menus.isContextMenuOpen()&&!m.default.menus.isModalOpen()){var n=g.Z.getStartIndex(),r=g.Z.getStartItem(),i=n===g.Z.getEndIndex()&&g.Z.getStartOffset()===g.Z.getEndOffset();m.default.PaneUpdateBatcher.beginUpdateItems(),i&&g.Z.selectIndices(n,0,n,r.getParsedText().length),!this.handlecopy(e)&&(i?p.Z.focusedPane.deleteSelected():k.Z.handleMultiselect({normCode:d.Z.KeyCode.Backspace,preventDefault:p.Z.emptyFn}),t=!1),m.default.PaneUpdateBatcher.commitUpdateItems()}return t}},{key:"handlecopy",value:function(e){var t=g.Z.getPane();if(this.ignoreCopy||!g.Z.isValid()||m.default.menus.isContextMenuOpen()||m.default.menus.isModalOpen())return!0;if(!t.overrideCopyBehavior)return!0;var n=e&&e.clipboardData?e.clipboardData:window.clipboardData;if(n){var r=g.Z.getStartObject(),i=g.Z.getEndObject(),a=g.Z.getStartOffsetWithPrefix(),o=g.Z.getEndOffsetWithPrefix(),s=g.Z.getEndTotalWithPrefix(),c=r!==i||a===o||0===a&&o===s,l=g.Z.getSelectedItems(c,!0);return this.saveToClipboard(l,n,a,o,r,i),p.Z.preventAndStop(e),!1}}},{key:"saveToClipboard",value:function(e,t,n,r,i,a){var o=_.Z.generateExport(e,{html:!0,moodo:!0,plain:!0},n,r,i,a),s=o.html,c=o.moodo,l=o.plain;var u=!f.Z.ie;u&&s&&t.setData("text/html",s),u&&c&&t.setData("moodo/html",c),t.setData(f.Z.ie?"Text":"text/plain",l)}}]),e}(),l()(r.prototype,"handlepaste",[u.ZP],Object.getOwnPropertyDescriptor(r.prototype,"handlepaste"),r.prototype),l()(r.prototype,"handlecut",[u.ZP],Object.getOwnPropertyDescriptor(r.prototype,"handlecut"),r.prototype),l()(r.prototype,"handlecopy",[u.ZP],Object.getOwnPropertyDescriptor(r.prototype,"handlecopy"),r.prototype),r)},4280:(e,t,n)=>{"use strict";n(7802);var r=n(6744),i=n(7100);function a(){document.removeEventListener("DOMContentLoaded",a,!1),window.removeEventListener("load",a,!1),i.Z.demo?n(6315).Z():r.Z.preload((function(){n(6315).Z()}))}window.__isLoaded=!0,Date.Config={__DEV__:!0,DisableCache:!0},"complete"===document.readyState||"interactive"===document.readyState?a():(document.addEventListener("DOMContentLoaded",a,!1),window.addEventListener("load",a,!1))},7802:()=>{"http:"===window.location.protocol&&(window.location.hash.indexOf("state=")<0||window.location.hash.indexOf("app")<0&&window.location.hash.indexOf("appv")<0)&&(window.location=window.location.href.replace(/^http:/,"https:"));try{window.__checkpoints|=1,window.__SESSION_ID=Math.round(1e4*Math.random())+"|"+Date.now(),window.console||(window.console={log:function(){},error:function(){}});window.log=window.console.log.bind(window.console),window.__log=window.console.log.bind(window.console),window.__warn=window.console.warn.bind(window.console),window.__error=window.console.error.bind(window.console),window.performance&&window.performance.now?(window.log.start=window.performance.now(),window.log.now=function(){return window.performance.now()-window.log.start}):(window.log.start=Date.now(),window.performance={now:function(){return Date.now()-window.log.start}},window.log.now=window.performance.now),window.console.timeStamp||(Object.defineProperty?Object.defineProperty(window.console,"timeStamp",{value:function(){}}):window.console.timeStamp=function(){}),window.console.time||(Object.defineProperty?Object.defineProperty(console,"time",{value:function(){}}):window.console.time=function(){}),window.console.timeEnd||(Object.defineProperty?Object.defineProperty(window.console,"timeEnd",{value:function(){}}):window.console.timeEnd=function(){}),window.console.trace||(Object.defineProperty?Object.defineProperty(window.console,"trace",{value:function(){}}):window.console.trace=function(){})}catch(e){console.log("Error in main header",e),window.__ERRORINMAINHEADER=e}},9514:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(5503);n(4642),n(6550),n(7397);const i=r.Z},8651:(e,t,n)=>{"use strict";n.d(t,{Z:()=>J});var r=n(8926),i=n.n(r),a=n(4575),o=n.n(a),s=n(3913),c=n.n(s),l=n(6525),u=n.n(l),d=n(2205),h=n.n(d),p=n(8585),f=n.n(p),g=n(9754),m=n.n(g),v=n(3124),y=n.n(v),k=n(7757),_=n.n(k),Z=n(8572),w=n(8855),b=n(3162),P=n(7100),S=n(9955),D=n(8478),I=n(5252),E=n(319),x=n.n(E),C=n(8),A=n.n(C),L=n(632),M=n(2124),T=n.n(M);function R(e){this.str=(e||"").toString(),this.operatorCurrent="",this.operatorExpecting="",this.node=null,this.escaped=!1,this.list=[],this.operators={'"':'"',"(":")","<":">",",":"",":":";",";":""}}function O(){}R.prototype={tokenize:function(){for(var e,t=0,n=[],r=0,i=this.str.length;r<i;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e=this.str.charAt(r),this.checkChar(e)}return this.list.forEach((function(e){e.value=(e.value||"").toString().trim(),e.value&&n.push(e)})),n},checkChar:function(e){if((e in this.operators||"\\"===e)&&this.escaped)this.escaped=!1;else{if(this.operatorExpecting&&e===this.operatorExpecting)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting="",void(this.escaped=!1);if(!this.operatorExpecting&&e in this.operators)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting=this.operators[e],void(this.escaped=!1)}this.escaped||"\\"!==e?(this.node||(this.node={type:"text",value:""},this.list.push(this.node)),this.escaped&&"\\"!==e&&(this.node.value+="\\"),this.node.value+=e,this.escaped=!1):this.escaped=!0}},O.prototype={_handleAddress:function(e){var t,n,r,i,a=0,o=!1,s="text",c=[],l={address:[],comment:[],group:[],text:[]};for(r=0,i=e.length;r<i;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if("operator"===(t=e[r]).type)switch(t.value){case"<":s="address";break;case"(":s="comment";break;case":":s="group",o=!0;break;default:s="text"}else t.value&&("address"===s&&(t.value=t.value.replace(/^[^<]*<\s*/,"")),l[s].push(t.value))}if(!l.text.length&&l.comment.length&&(l.text=l.comment,l.comment=[]),o)l.text=l.text.join(" "),c.push({name:l.text||n&&n.name,group:l.group.length?this.parse(l.group.join(",")):[]});else{if(!l.address.length&&l.text.length){var u=0;for(r=l.text.length-1;r>=0;r--){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(l.text[r].match(/^[^@\s]+@[^@\s]+$/)){l.address=l.text.splice(r,1);break}}var d=function(e){return l.address.length?e:(l.address=[e.trim()]," ")};if(!l.address.length){var h=0;for(r=l.text.length-1;r>=0;r--){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(l.text[r]=l.text[r].replace(/\s*\b[^@\s]+@[^\s]+\b\s*/,d).trim(),l.address.length)break}}}if(!l.text.length&&l.comment.length&&(l.text=l.comment,l.comment=[]),l.address.length>1&&(l.text=l.text.concat(l.address.splice(1))),l.text=l.text.join(" "),l.address=l.address.join(" "),!l.address&&o)return[];(n={address:l.address||l.text||"",name:l.text||l.address||""}).address===n.name&&((n.address||"").match(/@/)?n.name="":n.address=""),c.push(n)}return c},parse:function(e){var t=this,n=0,r=new R(e).tokenize(),i=[],a=[],o=[];r.forEach((function(e){"operator"!==e.type||","!==e.value&&";"!==e.value?a.push(e):(a.length&&i.push(a),a=[])})),a.length&&i.push(a),i.forEach((function(e){var n=t._handleAddress(e);n.length&&(o=o.concat(n))}));for(var s=[],c=0;c<o.length;++c){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;s.push({type:"contact",text:o[c].name||o[c].address,email:o[c].address})}return s}};const F=new O;const N=function(){if("function"!==typeof Array.prototype.pushArray&&(Array.prototype.pushArray=function(e){try{J.PAssert(436,J.isArray(e),"Must only supply array to pushArray")}catch(t){J.reportError(t)}return this.push.apply(this,e)}),"function"!==typeof Array.prototype.removeArray&&(Array.prototype.removeArray=function(e){try{J.PAssert(437,J.isArray(e),"Must only supply array to removeArray")}catch(t){J.reportError(t)}return this.filter((function(t){return!e||e.indexOf(t)<0}))}),"function"!==typeof Array.prototype.removeAt&&(Array.prototype.removeAt=function(e){return this.splice(e,1)[0]}),"function"!==typeof Array.prototype.remove&&(Array.prototype.remove=function(e,t){var n=this.indexOf(e,t);return n>=0&&this.removeAt.call(this,n),n}),"function"!==typeof Array.prototype.equals){var e=function e(t,n,r){return t&&n&&"object"===A()(t)&&"object"===A()(n)?Object.keys(t).length===Object.keys(n).length&&Object.keys(t).reduce((function(i,a){return i&&(r?e(t[a],n[a],r):t[a]===n[a])}),!0):t===n};Array.prototype.equals=function(t,n){var r=0;if(!t)return!1;if(this.length!==t.length)return!1;for(var i=0,a=this.length;i<a;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(this[i]instanceof Array&&t[i]instanceof Array){if(!this[i].equals(t[i]))return!1}else if(this[i]!==t[i]&&!e(this[i],t[i],n))return!1}return!0}}"function"!==typeof Array.prototype.indexOfWithProperty&&(Array.prototype.indexOfWithProperty=function(e,t){var n=0;for(var r=0;r<this.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(this[r][e]===t)return r}return-1}),"function"!==typeof Array.prototype.findInsertIndex&&(Array.prototype.findInsertIndex=function(e,t){var n=0;try{J.PAssert(439,void 0!==e&&null!==e,"Require a valid element to insert")}catch(s){J.reportError(s)}try{J.PAssert(440,t,"Require a valid comparison function")}catch(s){J.reportError(s)}for(var r=0,i=this.length-1;r<=i;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=r+i>>1,o=t(this[a],e);if(o<0)r=a+1;else{if(!(o>0))return a;i=a-1}}return r}),"function"!==typeof Array.prototype.findSorted&&(Array.prototype.findSorted=function(e,t){var n=this.findInsertIndex(e,t);if(0===t(this[n],e))return this[n]}),"function"!==typeof Array.prototype.insertSorted&&(Array.prototype.insertSorted=function(e,t){var n=this.findInsertIndex(e,t);return this.splice.apply(this,[n,0,e]),n}),"function"!==typeof Array.prototype.pushOnlyUniques&&(Array.prototype.pushOnlyUniques=function(e,t){var n=0;if(!e)return this;for(var r=0,i=e.length;r<i;++r){var a=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var o=!0,s=0,c=this.length;s<c;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t&&t(e[r],this[s])||!t&&e[r]===this[s]){o=!1;break}}o&&this.push(e[r])}return this}),"function"!==typeof Array.prototype.pushIfUnique&&(Array.prototype.pushIfUnique=function(e){return this.includes(e)||this.push(e),this}),"function"!==typeof String.prototype.startsWith&&(Object.defineProperty?Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return t=t||0,this.lastIndexOf(e,t)===t}}):String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),"function"!==typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),"function"!==typeof String.prototype.prevIndexOf&&(String.prototype.prevIndexOf=function(e,t){for(var n=0,r=-1,i=t-1;i>=0;--i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(this[i]===e){r=i;break}}return r}),"function"!==typeof String.prototype.capitalize&&(String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)})};n(8697);var B,U=n(9515),j=n(4327),H={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"},V=/https:\/\/www.evernote.com\/shard\/([a-z0-9.\-]+)\/nl\/([a-z0-9.\-]+)\/([a-z0-9.\-]+)/g,W=["http://a.visadd.com/script/layer","https://gc.kis.v2.scr.kaspersky-labs.com"];const z=(B=function(){function e(){o()(this,e),N(),this.SESSION_BEGIN=Date.now(),this.LogLevel=w.Z.LogLevels.Error|w.Z.LogLevels.Warning,this.noLocalWrites=!1,this.totalItems=0,this.totalArchivedItems=0,this.totalArchivedParents=0,this.totalPanes=0,this.tempIndex=0,this.__FULL_NOTIFICATION_UPDATES=0,this.__SINGLE_NOTIFICATION_UPDATES=0,this.TEMP_PREFIX="~T^",this.fnRegex=/function\s+([^(]*?)\s*\(([^)]*)\)/,this.supportSimpleStack=!0,this.__LOG_BUFFER=new U.Z(50),this.isLoaded=!1,this.aggregateEvents={},this.anonID=void 0,this.defaultSeed=129831293,this._isInCompleteAction=!1,this.lastActivity=Date.now(),this.activityThreshold=this.seconds(5),this.__xhrRequests={},this.isRollbarConfigured=!1,this.lastErrorsReported={},this.timeouts={},this.animationFrames={},this.numReported=0,this.isReporting=!1,this.singletonPromises={},this.lazyLoadedComponents={}}return c()(e,[{key:"Assert",value:function(e){}},{key:"isFlagSet",value:function(e,t){return(e&t)===t}},{key:"isFunction",value:function(e){return!!(e&&e.constructor&&e.call&&e.apply)}},{key:"isEmpty",value:function(e){if(!e)return!0;for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}},{key:"isArray",value:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{key:"isString",value:function(e){return"string"===typeof e}},{key:"isObject",value:function(e){return"object"===A()(e)&&null!==e&&!this.isArray(e)}},{key:"isNumber",value:function(e){return"number"===typeof e&&!isNaN(e)}},{key:"isBoolean",value:function(e){return!0===e||!1===e}},{key:"isAnything",value:function(){return!0}},{key:"isNullOrUndefined",value:function(e){return null===e||void 0===e}},{key:"isValidColor",value:function(e){return this.isString(e)&&null!==/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.exec(e)}},{key:"parseBoolean",value:function(e){return!0===e||"true"===e}},{key:"parseDate",value:function(e){var t=new Date(e);return this.isDateValid(t)?t:void 0}},{key:"clone",value:function(e,t){var n;if(this.isArray(e))return this.cloneDeep(e);if(t)for(var r in n={},e)e.hasOwnProperty(r)&&(t&&void 0===e[r]||(n[r]=e[r]));else n=Object.assign({},e);return n}},{key:"cloneObject",value:function(e){return Object.assign({},e)}},{key:"cloneWithoutUndefineds",value:function(e){return this.clone(e,!0)}},{key:"cloneDeep",value:function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){0;try{this.PAssert(115,!1,this.safeStringify(t))}catch(n){this.reportError(n)}}}},{key:"assignDeep",value:function(e){for(var t=0,n=this,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i[a-1]=arguments[a]}try{var o;return i=i.map((function(e){return e&&(n.isObject(e)||n.isArray(e))?JSON.parse(JSON.stringify(e)):e})),(o=Object.assign).call.apply(o,[this,e].concat(x()(i)))}catch(s){0;try{this.PAssert(116,!1,this.safeStringify(s))}catch(c){this.reportError(c)}}}},{key:"mergeValues",value:function(e,t){return this.isObject(t)?this.mergeObjects(e||{},t):Array.isArray(e)&&Array.isArray(t)?this.mergeArrays(e,t):void 0===t?e:t}},{key:"mergeObjects",value:function(e,t){var n=this;return Object.keys(t).forEach((function(r){e[r]=n.mergeValues(e[r],t[r])})),e}},{key:"mergeArrays",value:function(e,t){var n=this;return t.forEach((function(t,r){e[r]=n.mergeValues(e[r],t)})),e}},{key:"merge",value:function(e){for(var t=0,n=this,r=0,i=arguments.length,a=new Array(i>1?i-1:0),o=1;o<i;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a[o-1]=arguments[o]}return a.forEach((function(t){return n.mergeValues(e,t)})),e}},{key:"arrayDifferenceWithMap",value:function(e,t){for(var n=0,r=[],i=0;i<e.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t[e[i]]||r.push(e[i])}return r}},{key:"emptyFn",value:function(){}},{key:"newEmptyFn",value:function(){return function(){}}},{key:"weeks",value:function(e){return 6048e5*e}},{key:"days",value:function(e){return 864e5*e}},{key:"hours",value:function(e){return 36e5*e}},{key:"minutes",value:function(e){return 6e4*e}},{key:"seconds",value:function(e){return 1e3*e}},{key:"parseInt",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return parseInt(e,10)}))},{key:"shouldLog",value:function(e){return this.__DEV__===e}},{key:"shouldWriteLocal",value:function(){return!this.noLocalWrites}},{key:"isLocalWriteReason",value:function(e){return this.noLocalWritesReason===e}},{key:"isValidChangeType",value:function(e){if(void 0!==e&&null!==e){var t=e&~w.Z.ChangeType.All;if(this.inMaskOnly(e,w.Z.ChangeType.Valid))return(t&w.Z.ChangeType.Locations)===w.Z.ChangeType.None||this.isOneFlagSet(t,w.Z.ChangeType.Local|w.Z.ChangeType.Remote|w.Z.ChangeType.Auto)}return!1}},{key:"isRemoteChange",value:function(e){try{this.PAssert(117,this.isValidChangeType(e),"Must supply a valid changeType")}catch(n){this.reportError(n)}var t=e&~w.Z.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,w.Z.ChangeType.Remote)}},{key:"isUndoRedoChange",value:function(e){try{this.PAssert(118,this.isValidChangeType(e),"Must supply a valid changeType")}catch(n){this.reportError(n)}var t=e&~w.Z.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,w.Z.ChangeType.UndoRedo)}},{key:"isLocalChange",value:function(e){try{this.PAssert(119,this.isValidChangeType(e),"Must supply a valid changeType")}catch(n){this.reportError(n)}var t=e&~w.Z.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,w.Z.ChangeType.Local)}},{key:"isAutoChange",value:function(e){try{this.PAssert(120,this.isValidChangeType(e),"Must supply a valid changeType")}catch(n){this.reportError(n)}var t=e&~w.Z.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,w.Z.ChangeType.Auto)}},{key:"inMaskOnly",value:function(e,t){return 0===(~t&e)}},{key:"isOneFlagSet",value:function(e,t){var n=e&t;return 0!==n&&0===(n&n-1)}},{key:"isAtLeastOneFlagSet",value:function(e,t){return 0!==(e&t)}},{key:"forEachFlagSet",value:function(e,t){for(var n=0;0!==e;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t(Math.abs(e&-e)),e&=e-1}}},{key:"generateTempId",value:function(){return this.TEMP_PREFIX+Date.now()+ ++this.tempIndex}},{key:"toLowerCase",value:function(e){return e.toLowerCase()}},{key:"uppercaseFirst",value:function(e){return e[0].toUpperCase()+e.slice(1)}},{key:"numberComparator",value:function(e,t){return e-t}},{key:"comparatorById",value:function(e,t){return e.id===t.id}},{key:"insertIntoText",value:function(e,t,n){try{this.PAssert(121,n<=e.length)}catch(r){this.reportError(r)}return e.substr(0,n)+t+e.substr(n,e.length-n)}},{key:"arrayUnion",value:function(e,t){for(var n=0,r=0,i=[],a=0;a<e.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;i.indexOf(e[a])<0&&i.push(e[a])}for(var o=0;o<t.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i.indexOf(t[o])<0&&i.push(t[o])}return i}},{key:"arrayUnionByKey",value:function(e,t,n){for(var r=0,i=0,a=[],o=0;o<e.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;a.indexOfWithProperty(n,e[o][n])<0&&a.push(e[o])}for(var s=0;s<t.length;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a.indexOfWithProperty(n,t[s][n])<0&&a.push(t[s])}return a}},{key:"arrayDiff",value:function(e,t){for(var n=0,r=0,i=[],a=0;a<e.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t.indexOf(e[a])<0&&i.push(e[a])}for(var o=0;o<t.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e.indexOf(t[o])<0&&i.push(t[o])}return i}},{key:"arrayIntersection",value:function(e,t){for(var n=0,r=[],i=0;i<e.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t.indexOf(e[i])>=0&&r.push(e[i])}return r}},{key:"arrayIntersectionByKey",value:function(e,t,n){for(var r=0,i=[],a=0;a<e.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;t.indexOfWithProperty(n,e[a][n])>=0&&i.push(e[a])}return i}},{key:"arrayUniques",value:function(e,t){return t?e.filter((function(n,r){return e.findIndex((function(e){return e[t]===n[t]}))===r})):e.filter((function(t,n){return e.indexOf(t)===n}))}},{key:"arrayUniques2",value:function(e){return Array.from(new Set(e))}},{key:"removeNullUndefined",value:function(e){var t={};return Object.keys(e).forEach((function(n){null!==e[n]&&void 0!==e[n]&&(t[n]=e[n])})),t}},{key:"deepEqual",value:function(e,t,n,r){return(e===t||void 0!==e&&void 0!==t&&null!==e&&null!==t)&&(n&&(this.isObject(e)&&(e=this.removeNullUndefined(e)),this.isObject(t)&&(t=this.removeNullUndefined(t))),r&&r.forEach((function(n){delete e[n],delete t[n]})),T()(e,t,!0))}},{key:"extend",value:function(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}},{key:"classNames",value:function(){for(var e=0,t=0,n=arguments.length,r=new Array(n),i=0;i<n;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;r[i]=arguments[i]}for(var a=arguments,o=[],s=0;s<a.length;s++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var c=a[s];if(c)if(this.isString(c)||this.isNumber(c))o.push(c);else if("object"===A()(c))for(var l in c)c.hasOwnProperty(l)&&c[l]&&o.push(l)}return o.join(" ")}},{key:"isPrefixTask",value:function(e){return e&&(e===w.Z.Prefix.Task||e===w.Z.Prefix.Task2||e===w.Z.Prefix.Task3||e===w.Z.Prefix.Task4)}},{key:"escape",value:function(e){return String(e).replace(/[&\"<>]/g,(function(e){return H[e]}))}},{key:"unescape",value:function(e){return String(e).replace(/&lt;|&gt;|&amp;|&quot;/g,(function(e){for(var t in H)if(H.hasOwnProperty(t)&&H[t]===e)return t;try{this.PAssert(122,!1,"Should have found a character to replace")}catch(n){this.reportError(n)}return e}))}},{key:"escapeRegExp",value:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}},{key:"stripTagsBasic",value:function(e){return e.replace(/<.*>/g,"")}},{key:"stripFormattingTags",value:function(e){return e.replace(/<\/?[biu]>/g,"")}},{key:"invertObject",value:function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}},{key:"filterWithNonMatches",value:function(e,t){for(var n=0,r={match:[],fail:[]},i=0;i<e.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=e[i];t(a)?r.match.push(a):r.fail.push(a)}return r}},{key:"isUrlImage",value:function(e){return(e=e.toLowerCase().split("?")[0]).endsWith(".png")||e.endsWith(".jpg")||e.endsWith(".gif")}},{key:"isDateSoft",value:function(e){if(e)switch(e.toUpperCase()){case"NEXT":case"SOON":case"LATER":case"SOMEDAY":case"NOW":return!0}return!1}},{key:"isDateValid",value:function(e){return e&&e instanceof Date&&!isNaN(e.getTime())}},{key:"parseEmailAddresses",value:function(e){return F.parse(e)}},{key:"isTempId",value:function(e){return e&&e[0]===this.TEMP_PREFIX[0]&&e[1]===this.TEMP_PREFIX[1]&&e[2]===this.TEMP_PREFIX[2]}},{key:"isLocalItem",value:function(e){try{this.PAssert(123,e.id,"All items should have an ID even if it is a temp one")}catch(t){this.reportError(t)}return this.isTempId(e.id)}},{key:"getCurrentStack",value:function(e){var t;if(this.supportSimpleStack)try{t=JSON.stringify(e)}catch(d){this.log("Error stringifying stack message",d,e)}if(this.supportSimpleStack){var n=new Error(t||e);if(n.stack)return n.stack}this.supportSimpleStack=!1;try{for(var r=0,i=["GenError: "+(t||e)],a=arguments.callee.caller,o=75,s=0;a&&s++<o;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var c,l=a.toString(),u=this.fnRegex.exec(l);c=u&&3===u.length&&""!==u[1]&&void 0!==u[1]?"at "+u[1]+"("+u[2].replace(/[\r\n]/g,"")+")":u&&3===u.length?"at <anonymous> ("+u[2].replace(/[\r\n]/g,"")+")":"at <anonymous> (<unknown>)",i.push(c),a=a.caller}return i.join("\n")}catch(h){this.log("Error generating stack trace",h)}return""}},{key:"isVMLI",value:function(e){return e&&e.__ISVMLI}},{key:"isPane",value:function(e){return e&&e.__ISPANE}},{key:"logQuiet",value:function(){for(var e=0,t=arguments.length,n=new Array(t),r=0;r<t;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n[r]=arguments[r]}try{this.__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," "))}catch(i){try{this.__LOG_BUFFER.push(Date.now()+": Invalid Log Arguments")}catch(a){console.log("Error adding to __LOG_BUFFER: ",arguments)}}}},{key:"log",value:function(){for(var e=0,t=arguments.length,n=new Array(t),r=0;r<t;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n[r]=arguments[r]}try{this.__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," "))}catch(i){try{this.__LOG_BUFFER.push(Date.now()+": Invalid Log Arguments")}catch(a){console.log("Error adding to __LOG_BUFFER: ",arguments)}}console.log.apply(console,arguments)}},{key:"registerEvent",value:function(e,t,n){try{this.PAssert(124,!this.aggregateEvents.hasOwnProperty(e),"Should only register an event once")}catch(i){this.reportError(i)}try{this.PAssert(125,void 0!==e,"Must specify a name for the event")}catch(i){this.reportError(i)}try{this.PAssert(126,void 0!==t,"Must specify a category for the event")}catch(i){this.reportError(i)}try{this.PAssert(127,void 0!==n,"Must specify an action for the event")}catch(i){this.reportError(i)}var r={category:t,action:n,label:this.getAnonUserIdentifier(),count:0};this.aggregateEvents[e]=r}},{key:"aggregateEvent",value:function(e,t){try{this.PAssert(128,this.aggregateEvents.hasOwnProperty(e),"Must register an event before using it")}catch(n){this.reportError(n)}void 0===t&&(t=1),this.aggregateEvents[e]&&(this.aggregateEvents[e].count+=t)}},{key:"UIAction",value:function(e){this.sendEvent("UIAction",e)}},{key:"getAggregateEvents",value:function(){return this.aggregateEvents}},{key:"getAnonUserIdentifier",value:function(){if(!this.anonID){var e=this.getUserIdentifier();this.anonID=e?e[0]+e[1]+e[2]+this.murmurhash3_32_gc(e,17124123):"loggedout"}return this.anonID}},{key:"murmurhash3_32_gc",value:function(e,t){var n,r,i,a,o,s,c,l,u=0;for(n=3&e.length,r=e.length-n,i=t,o=3432918353,s=461845907,l=0;l<r;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;c=255&e.charCodeAt(l)|(255&e.charCodeAt(++l))<<8|(255&e.charCodeAt(++l))<<16|(255&e.charCodeAt(++l))<<24,++l,i=27492+(65535&(a=5*(65535&(i=(i^=c=(65535&(c=(c=(65535&c)*o+(((c>>>16)*o&65535)<<16)&4294967295)<<15|c>>>17))*s+(((c>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16)}switch(c=0,n){case 3:c^=(255&e.charCodeAt(l+2))<<16;case 2:c^=(255&e.charCodeAt(l+1))<<8;case 1:i^=c=(65535&(c=(c=(65535&(c^=255&e.charCodeAt(l)))*o+(((c>>>16)*o&65535)<<16)&4294967295)<<15|c>>>17))*s+(((c>>>16)*s&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}},{key:"hashString",value:function(e){try{this.PAssert(129,this.isString(e),"Must always be passing a string to hash")}catch(t){this.reportError(t)}return this.murmurhash3_32_gc(e,this.defaultSeed)}},{key:"isDemoMode",value:function(){return!1}},{key:"getUserIdentifier",value:function(){var e=this.getToolbox();return this.isDemoMode()?"demouser":e?e.settings.activeUser.get():"Missing toolbox"}},{key:"beginCompleteAction",value:function(){this._isInCompleteAction=!0}},{key:"isInCompleteAction",value:function(){return this._isInCompleteAction}},{key:"endCompleteAction",value:function(){this._isInCompleteAction=!1}},{key:"getObjectInfo",value:function(e){try{if(e&&e.constructor)return e.constructor.name}catch(t){this.reportError(t)}return A()(e)}},{key:"hasTimeoutOnce",value:function(e){return!!this.timeouts[e]}},{key:"timeoutOnce",value:function(e,t,n,r,i,a,o,s){var c=this;try{this.PAssert(130,e,"Must supply a valid name")}catch(u){this.reportError(u)}try{this.PAssert(131,this.isFunction(t),"must supply a valid cb fn")}catch(u){this.reportError(u)}try{this.PAssert(132,arguments.length<=8,"Too many args passed in")}catch(u){this.reportError(u)}var l=this.timeouts[e];l&&clearTimeout(l),this.timeouts[e]=setTimeout((function(){delete c.timeouts[e],t(r,i,a,o,s)}),n)}},{key:"clearTimeoutOnce",value:function(e){var t=this.timeouts[e];t&&(clearTimeout(t),delete this.timeouts[e])}},{key:"timeoutIf",value:function(e,t,n){e?setTimeout(n,t):n()}},{key:"hasAnimationFrameOnce",value:function(e){return!!this.animationFrames[e]}},{key:"animationFrameOnce",value:function(e,t){var n=this;try{this.PAssert(133,e,"Must supply a valid name")}catch(i){this.reportError(i)}try{this.PAssert(134,this.isFunction(t),"must supply a valid cb fn")}catch(i){this.reportError(i)}try{this.PAssert(135,arguments.length<=8,"Too many args passed in")}catch(i){this.reportError(i)}var r=this.animationFrames[e];r&&cancelAnimationFrame(r),this.animationFrames[e]=requestAnimationFrame((function(){delete n.animationFrames[e],t()}))}},{key:"clearAnimationFrameOnce",value:function(e){var t=this.animationFrames[e];t&&(cancelAnimationFrame(t),delete this.animationFrames[e])}},{key:"sendEvent",value:function(e,t,n){}},{key:"objectValues",value:function(e){return Object.keys(e).map((function(t){return e[t]}))}},{key:"trimRight",value:function(e){for(var t=0,n=e.length-1;n>=0;n--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[n])break;e=e.substr(0,n)}return e}},{key:"getToolbox",value:function(){return n(4654).default}},{key:"searchFromVMLI",value:function(e,t,n,r){var i;n=n||0,r=r||{};var a=t.noCollapsed,o=t.pane,s=t.overview,c=!0;if(t.followMirrors){var l=e.getMirroredItem();l&&(e=l)}if(null===(i=r)||void 0===i||!i[e.id]){if(t.includeNotes&&!t.headers&&e.hasNote()){var u=e.getNote();t.comparator&&!t.comparator(u,t.comparatorOptions)||t.each&&(c=t.each(u))}if(!1!==c&&(!a||0===n&&!s||!o||!o.isCollapsedByID(e.id,e,s)))for(var d=0,h=e.items.get(),p=0;p<h.length;++p){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var f=h[p];if(!t.headers||f.showInOverview()){if((!t.comparator||t.comparator(f,t.comparatorOptions))&&t.each&&!1===(c=t.each(f)))return!1;r[e.id]=!0,this.searchFromVMLI(f,t,n+1,r)}}}}},{key:"searchVMLIs",value:function(e){var t=this;try{this.PAssert(136,e,"Must supply a valid options param")}catch(a){this.reportError(a)}var n=this.getToolbox();try{if(e.itemStoreFilter){var r=n.itemStoreManager,i=e.item;r.runForEachStore((function(n){var r=i&&i.belongsToItemStore(n)?i:n.getRoot();t.searchFromVMLI(r,e),n.forEachLinkedItem((function(t){var n;return e.each?e.each(t):null===(n=e.comparator)||void 0===n?void 0:n.call(e,t)}))}),e.itemStoreFilter)}else if(e.item){try{this.PAssert(137,!e.itemStore&&!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(a){this.reportError(a)}this.searchFromVMLI(e.item,e)}else if(e.itemStore){try{this.PAssert(138,!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(a){this.reportError(a)}this.searchFromVMLI(e.itemStore.getRoot(),e)}else try{this.PAssert(139,!1,"Must specify a valid search root, using the default root is deprecated")}catch(a){this.reportError(a)}}catch(o){this.reportError(o)}}},{key:"clamp",value:function(e,t,n){return Math.max(t,Math.min(n,e))}},{key:"padZeros",value:function(e,t){for(var n=0,r=e+"";r.length<(t||2);){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r="0"+r}return r}},{key:"pad2",value:function(e){return this.padZeros(e,2)}},{key:"parseSubtree",value:function(e,t){var n=0;try{this.PAssert(140,e,"Must supply a valid item to parse")}catch(a){this.reportError(a)}this.runSingleParse(e,t,!0);for(var r=e.getItems(),i=0;i<r.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this.parseSubtree(r[i],t)}}},{key:"runSingleParse",value:function(e,t,n){try{this.PAssert(141,e,"Must have a valid item to parse")}catch(r){this.reportError(r)}e.parseText("",t,n)}},{key:"notifyActivity",value:function(){this.lastActivity=Date.now(),this.lowActivityTimer||(this.lowActivityTimer=setTimeout(this.checkLowActivity,2*this.activityThreshold)),this.whenLowImpactEnd()}},{key:"checkLowActivity",value:function(){Date.now()-this.lastActivity>this.activityThreshold&&this.whenLowImpactBegin(),this.lowActivityTimer=void 0}},{key:"whenLowImpactBegin",value:function(){this._isLowImpact||(this._isLowImpact=!0,j.Z.fireEvent("lowImpactBegin",[]))}},{key:"whenLowImpactEnd",value:function(){this._isLowImpact&&(j.Z.fireEvent("lowImpactEnd",[]),this._isLowImpact=!1)}},{key:"isLowImpact",value:function(){return this._isLowImpact}},{key:"parseEvernoteLink",value:function(e){return e.startsWith("evernote:///view/")?{viewUrl:e}:(V.lastIndex=0,null!==(t=V.exec(e))?{shardId:t[1],userId:t[2],noteGuid:t[3]}:void 0);var t}},{key:"isOneNoteLink",value:function(e){return e.startsWith("onenote:https://")}},{key:"isBearLink",value:function(e){return e.startsWith("bear://x-callback-url/")}},{key:"isFileLink",value:function(e){return e.startsWith("file://")}},{key:"runDateRollover",value:function(){var e=this.getToolbox();try{this.PAssert(142,this.isLoaded,"Expect that we have fully loaded the page before performing rollover")}catch(t){this.reportError(t)}this.log("---- Running Date Rollover: ",new Date),Date.Parsing.Normalizer.buildReplaceData(),e.timeline.clearDailyCaches(),j.Z.fireEvent("beforeDateChanged",[]),e.PaneUpdateBatcher.updateAllItems(!0,!0),e.timeline.updateNotifications(),this.log("-------------------------------"),j.Z.fireEvent("dateChanged",[])}},{key:"setupDateRollover",value:function(){var e=this,t=(new Date).clearTime();!function n(){var r=new Date,i=1e3*(60-r.getSeconds());r.clearTime(),+r!==+t&&e.runDateRollover(),t=r,setTimeout(n,i)}()}},{key:"ensureStatsXHR",value:function(e){var t=this.sanitizeURL(e).split("?")[0];return this.__xhrRequests[t]||(this.__xhrRequests[t]={requests:0,successes:0,retries:0,failures:0}),this.__xhrRequests[t]}},{key:"notifyStatsXHRRequest",value:function(e){this.ensureStatsXHR(e).requests++}},{key:"notifyStatsXHRSuccess",value:function(e){this.ensureStatsXHR(e).successes++}},{key:"notifyStatsXHRRetry",value:function(e){this.ensureStatsXHR(e).retries++}},{key:"notifyStatsXHRFailure",value:function(e){this.ensureStatsXHR(e).failures++}},{key:"getXHRStats",value:function(){return this.__xhrRequests}},{key:"sanitizeURL",value:function(e){return e.replace(/&?access_token=[^&]*/g,"")}},{key:"generateQueryString",value:function(e){var t="";if("object"===A()(e)){t=Object.keys(e).map((function(t){return void 0!==e[t]?encodeURIComponent(t)+"="+encodeURIComponent(e[t]):""})).join("&").replace(/%20/g,"+")}else{try{this.PAssert(143,"string"===typeof e,"Only Objects or Strings are currently supported")}catch(n){this.reportError(n)}t=e}return t}},{key:"packedFnToString",value:function(e){for(var t=0,n="",r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n+=e[r]+"."}return n}},{key:"unpackFn",value:function(e,t){try{this.PAssert(144,this.isFunction(e)||this.isArray(e),"Must supply either a valid function or packed function")}catch(a){this.reportError(a)}var n=NaN;if(this.isFunction(e))n=e;else if(e)try{var r=0;0,n=t||window;for(var i=0;i<e.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;try{this.PAssert(145,this.isString(e[i]),"Packed fns must only contain strings: "+i)}catch(a){this.reportError(a)}try{this.PAssert(146,n,"Must be able to unpack each step in object chain: "+e[i]+" in "+this.packedFnToString(e))}catch(a){this.reportError(a)}if(!n){n=NaN;break}n=n[e[i]]}}catch(o){this.reportError(o),n=NaN}return n}},{key:"encodeMIMEHeader",value:function(e){return"=?UTF-8?B?"+this.btoa(unescape(encodeURIComponent(e)))+"?="}},{key:"utf8_to_b64",value:function(e){var t;try{t=this.btoa(unescape(encodeURIComponent(e))).replace(/\+/g,"-").replace(/\//g,"_")}catch(n){this.reportError(n,e)}return t}},{key:"b64_to_utf8",value:function(e){var t;try{t=decodeURIComponent(escape(this.atob(e.replace(/-/g,"+").replace(/_/g,"/"))))}catch(n){this.reportError(n,e)}return t}},{key:"qp_to_utf8",value:function(e){var t;try{t=e.replace(/[\t\x20]$/gm,"").replace(/=(?:\r\n?|\n|$)/g,"").replace(/=([a-fA-F0-9]{2})/g,(function(e,t){var n=parseInt(t,16);return String.fromCharCode(n)}))}catch(n){this.reportError(n,e)}return t}},{key:"isTextNode",value:function(e){return e&&3===e.nodeType}},{key:"isWhiteSpace",value:function(e){return/^\s*$/.test(e)}},{key:"isAncestor",value:function(e,t){var n=0;try{this.PAssert(147,e,"Must have a valid element")}catch(r){this.reportError(r)}try{this.PAssert(148,t,"Must have a valid ancestor: Node")}catch(r){this.reportError(r)}for(;e&&e!==t;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e=e.parentNode}return!!e}},{key:"isEmail",value:function(e){var t=!1;e&&(t=!!new RegExp(/\S+@\S+\.\S+/i).exec(e),t&&(t=e.indexOf('"')<0));return t}},{key:"intervalUntil",value:function(e){var t=0;if(!e())var n=setInterval((function(){t++,(e()||t>100)&&clearInterval(n)}),0);return!0}},{key:"hasGoogleError",value:function(e,t,n){try{this.PAssert(149,e,"Must specify a valid result object")}catch(c){this.reportError(c)}try{this.PAssert(150,t,"Must specify a valid error domain")}catch(c){this.reportError(c)}try{this.PAssert(151,n,"Must specify a valid error reason")}catch(c){this.reportError(c)}var r=!1;if(e&&e.error&&e.errors)for(var i=0,a=e.error.errors,o=0;o<a.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=a[o];if(s.domain===t&&s.reason===n){r=!0;break}}return r}},{key:"handleJSError",value:function(e,t,r,i){if(!e.message||!e.message.startsWith("Firebase Storage: Max retry time")&&!e.message.startsWith("ResizeObserver loop limit"))if(e){i||(i=w.Z.LogLevels.Error);var a=this.getToolbox();if(a&&a.rollbar)try{var o=this.lastErrorsReported[e.stack];if(!o||o<Date.now()-5e3){var s=this.__LOG_BUFFER.ordered().join("\r\n"),c=a.settings?a.settings.getUserIdentifier():"No User Identifier";this.isRollbarConfigured||(a&&a.settings&&"me"!==c&&(this.isRollbarConfigured=!0),a.rollbar.configure({payload:{person:{id:c}},maxItems:w.Z.__MAX_ERRORS_REPORTED,checkIgnore:this.rollbarIgnoreFn}));var l=this.parseExtra(t);if(this.numReported++,this.numReported<=w.Z.__MAX_ERRORS_REPORTED){var u=n(4867).Z,d={};if(!this.isReporting){this.isReporting=!0;try{u.getAppInfo(d)}catch(p){}this.isReporting=!1}d.numReported=this.numReported;var h=Object.assign(this.getRollbarData(),{logs:s,info:d,user:c,extra:l});this.sendRollbar(e,h,i)}}this.lastErrorsReported[e.stack]=Date.now()}catch(e){this.log("Badness happened reporting errors to server: ",e);try{a.rollbar.error(e)}catch(f){this.log("More badness happened reporting errors to rollbar: ",f)}}}else console.log(e)}},{key:"reportError",value:function(e,t,n,r){this.handleJSError(e,t,!1,n)}},{key:"rollbarIgnoreFn",value:function(e,t,n){return!!(n&&n.body&&n.body.trace&&n.body.trace.frames&&n.body.trace.frames[0]&&W.indexOf(n.body.trace.frames[0].filename)>=0)}},{key:"parseExtra",value:function(e){return e?this.safeStringify(e):void 0}},{key:"isVowel",value:function(e){var t=e.toLowerCase();return"a"===t||"e"===t||"i"===t||"o"===t||"u"===t}},{key:"forEachValue",value:function(e,t){Object.keys(e).forEach((function(n){return t(e[n])}))}},{key:"isHTTPStatusCode",value:function(e,t){return e&&e.error&&e.error.code===t}},{key:"safeStringify",value:function(e){try{return JSON.stringify(e)}catch(t){0}}},{key:"makeString",value:function(e){for(var t=0,n="",r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n+=" "+this.safeStringify(e[r])}return n}},{key:"decodeHtmlEntity",value:function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(t)})).replace(/<[^>]*>/g,"")}},{key:"deepFreeze",value:function(e){return e}},{key:"stringRemove",value:function(e,t,n){return e.substr(0,t)+e.substr(t+n)}},{key:"round",value:function(e,t){return t=t||2,Number(Math.round((""+e).includes("e")?e:e+"e"+t)+"e-"+t)}},{key:"debugTime",value:function(e,t){}},{key:"arrayToObjectById",value:function(e){var t={};return e.forEach((function(e){return t[e.id]=e})),t}},{key:"mapArrayToObject",value:function(e,t){var n={};return e.forEach((function(e){return n[e]=t(e)})),n}},{key:"objectToArray",value:function(e){return Object.keys(e).map((function(t){return e[t]}))}},{key:"arrayFlat",value:function(e){return[].concat.apply([],e)}},{key:"isEmoji",value:function(e){return!!e&&0===(0,L.z)(e.replace(/ /g,"")).length}},{key:"addSpacesToCamelCase",value:function(e){for(var t=0,n=e,r=n.length-1;r>=0;r--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;(n[r]>="A"&&n[r]<="Z"||!isNaN(n[r])&&(0===r||isNaN(n[r-1])))&&(n=n.substr(0,r)+" "+n.substr(r))}return n}},{key:"promiseSerial",value:function(e){return e.reduce((function(e,t){return e.then((function(e){return t().then(Array.prototype.concat.bind(e))}))}),Promise.resolve([]))}},{key:"decodeIDToken",value:function(e){try{var t,n=e.split(".");return null===(t=JSON.parse(this.b64_to_utf8(n[1])).email)||void 0===t?void 0:t.toLowerCase()}catch(r){this.reportError(r,"Error decoding id_token")}}},{key:"runSingletonPromise",value:function(){var e=i()(_().mark((function e(t,n){var r=this;return _().wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return this.singletonPromises[t]||(this.singletonPromises[t]=new Promise(function(){var e=i()(_().mark((function e(i){var a;return _().wrap((function(e){for(var o=0,s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,n();case 2:a=e.sent,i(a),delete r.singletonPromises[t];case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}())),e.abrupt("return",this.singletonPromises[t]);case 2:case"end":return e.stop()}}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"tryParseJSON",value:function(e){try{return JSON.parse(e)}catch(t){}}},{key:"arrayMove",value:function(e,t,n){var r=e[n];e.splice(t,0,r),t<n&&n++,e.splice(n,1)}},{key:"promisify",value:function(){var e=i()(_().mark((function e(t){var n,r,i,a=0,o=this,s=arguments;return _().wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:n=s.length,r=new Array(n>1?n-1:0),i=1;case 1:if(!(i<n)){e.next=8;break}if(!(a++>5e3&&__infLoop&&__infLoop(a))){e.next=4;break}throw new RangeError;case 4:r[i-1]=s[i];case 5:i++,e.next=1;break;case 8:return e.abrupt("return",new Promise((function(e){var n=r.concat((function(){e.apply(this,arguments)}));t.apply(o,n)})));case 9:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"logWithTime",value:function(e){var t=Date.now(),n=t-(this.prevLogTime||0);this.prevLogTime=t,console.log(n,e),console.trace()}},{key:"isArrayEqualWithProperty",value:function(e,t,n){var r=0;if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(var i=0;i<e.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=e[i],o=t[i];if(!a[n]||!o[n]||a[n]!==o[n])return!1}return!0}},{key:"distance",value:function(e,t){return Math.floor(Math.sqrt(Math.pow(e,2)+Math.pow(t,2)))}},{key:"sum",value:function(e,t){return e.reduce((function(e,n){return e+(t?t(n):n)}),0)}},{key:"max",value:function(e){return null!==e&&void 0!==e&&e.length?e.reduce((function(e,t){return Math.max(e,t)})):void 0}},{key:"maxObject",value:function(e,t){for(var n=0,r=Number.MIN_SAFE_INTEGER,i=-1,a=0;a<e.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=t(e[a]);o>r&&(i=a,r=o)}return e[i]}},{key:"minObject",value:function(e,t){for(var n=0,r=Number.MAX_SAFE_INTEGER,i=-1,a=0;a<e.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=t(e[a]);o<r&&(i=a,r=o)}return e[i]}},{key:"lazyLoad",value:function(e,t){return this.lazyLoadedComponents[e]||(this.lazyLoadedComponents[e]=(0,S.lazy)(t)),this.lazyLoadedComponents[e]}},{key:"_mapRecursive",value:function(e,t,n,r,i){var a=this;t.forEach((function(t){e.push(i(t,r)),t[n]&&a._mapRecursive(e,t[n],n,r+1,i)}))}},{key:"mapRecursive",value:function(e,t,n){var r=[];return this._mapRecursive(r,e,t,0,n),r}},{key:"truncate",value:function(e,t){return e.length>t?e.slice(0,t)+"...":e}},{key:"createUniqueDocName",value:function(e,t){for(var n=0;t.includes(e);){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var r=e.match(/\((\d+)\)$/);e=r?e.replace(/\((\d+)\)$/,"(".concat(+r[1]+1,")")):e+" (2)"}return e}},{key:"isBetween",value:function(e,t,n){return this.isNumber(e)&&e>=t&&e<=n}},{key:"timeoutPromise",value:function(e){return new Promise((function(t){return setTimeout(t,e)}))}},{key:"recursiveItemsToArray",value:function(e){var t=[];return this.recursiveForEachItem(e,(function(e){return t.push(e)})),t}},{key:"recursiveForEachItem",value:function(e,t){var n=this;e.forEach((function(e){t(e),e.items&&n.recursiveForEachItem(e.items,t)}))}},{key:"cropStringWithMatchingParens",value:function(e){for(var t=0,n=0,r=0;r<e.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[r];if("("===i)n++;else if(")"===i&&--n<0){e=e.slice(0,r);break}}return e}},{key:"isCharacterPrintable",value:function(e){return e>47&&e<58||32==e||13==e||e>64&&e<91||e>95&&e<112||e>185&&e<193||e>218&&e<223}},{key:"escapeItemText",value:function(e){return e.replace(w.Z.Regexp.MDFormat,(function(e){return"\\"+e}))}},{key:"containsInvalidCharacter",value:function(e){return null===e||void 0===e?void 0:e.includes(w.Z.CharCodeInvalid)}},{key:"spliceText",value:function(e,t,n,r){return e.slice(0,t)+(r||"")+e.slice(t+n)}},{key:"arrayAllValuesEqual",value:function(e,t){for(var n=0,r=0;r<e.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e[r]!==t)return!1}return!0}}]),e}(),y()(B.prototype,"parseBoolean",[Z.ZP],Object.getOwnPropertyDescriptor(B.prototype,"parseBoolean"),B.prototype),y()(B.prototype,"parseDate",[Z.ZP],Object.getOwnPropertyDescriptor(B.prototype,"parseDate"),B.prototype),y()(B.prototype,"cloneWithoutUndefineds",[Z.ZP],Object.getOwnPropertyDescriptor(B.prototype,"cloneWithoutUndefineds"),B.prototype),y()(B.prototype,"checkLowActivity",[Z.ZP],Object.getOwnPropertyDescriptor(B.prototype,"checkLowActivity"),B.prototype),y()(B.prototype,"runDateRollover",[Z.ZP],Object.getOwnPropertyDescriptor(B.prototype,"runDateRollover"),B.prototype),y()(B.prototype,"reportError",[Z.ZP],Object.getOwnPropertyDescriptor(B.prototype,"reportError"),B.prototype),B);var q;function G(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=m()(e);if(t){var i=m()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return f()(this,n)}}var K;!function(e){e[e.None=0]="None",e[e.Item=1]="Item",e[e.Element=2]="Element"}(K||(K={}));var Y=[0,5,15,35,80,170,400,1200],X=[0,408,429,500,502,503,504],Q=["itemParents","itemCheckbox","agendaTime","itemMenuIcon","vertLines","itemTime"];const J=new(q=function(e){h()(r,e);var t=G(r);function r(){var e;return o()(this,r),e=t.call(this),window.__infLoop=e.infLoop,e.vmMain=void 0,e.archivedPadding=34,e.itemTransitionTime=100,e.scrollbarWidth=12,e.hasFocus=!0,e.demoMode=!1,e.focusedPane=void 0,e.focusedItem=void 0,e.ClickThreshold=5,e.isReconnected=!1,e.isBlocked=!1,e.blockedMessage="",e.authImmediateFailed=!1,e.authUserLoggedIn=!1,e.noLocalWritesReason=w.Z.LocalWriteReason.Enabled,e.isLoadingRemote=!1,e.isSendingEmail=!1,e.isSavingDrafts=!1,e.itemMenuOpenedOn=void 0,e.errorPlatformInfo=void 0,e.MobileSideTapThreshold=40,e.MobileSideTapThresholdKeyboardOpen=15,e.colorBlue="#09d",e.colorLightBlue="#02b1ff",e.colorRed="#d43",e.colorLightRed="#f34433",e.MinItemWidth=50,e.paneTop=P.Z.app?20:0,e.activeDisplayMode=w.Z.DisplayMode.Default,e.eventStream=new U.Z(25),e.currentFindPass=0,e.scrollTimeouts={},e.scrollState={speedPane:0,pane:void 0,speedPanes:0,panes:!1},e.keyboardDestination=K.None,e.keyboardOpenedOn=void 0,e.keyboardBlurFn=void 0,e.keyboardStartScrollOffset=0,e.numLastLoop=-1,e.timeLastLoop=void 0,window.onerror=e.onWindowError,e.wrapAsyncCallbacks(),e.wrapXHR(),P.Z.demo&&e.enableDemoMode(),e}return c()(r,[{key:"addDevFunctions",value:function(){var e=this,t=window;t.__globals=function(){return e};var n=1;this.shouldLog(w.Z.LogLevels.Input)&&(t.__eventBuffer=new U.Z(100)),this.tagEvent=function(r,i,a){r.id||(r.id=n++,e.shouldLog(w.Z.LogLevels.Input)&&t.__eventBuffer.push(r)),e.shouldLog(w.Z.LogLevels.Input)&&(r.activeHandler={owner:i,fn:a},r.handlers?r.handlers.push(r.activeHandler):r.handlers=[r.activeHandler])},this.Assert=function(){for(var n=0,r=0,i=arguments.length,a=new Array(i),o=0;o<i;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;a[o]=arguments[o]}if(!a[0])try{a.length>1?t.__error.apply(console,a.slice(1).map((function(t){return e.isFunction(t)?t():t}))):t.__error("Assert Failure!")}catch(s){t.__error("Problem reporting Assert!")}},this.DAssert=function(t){t||e.log("Debug ONLY assert was hit.")},t.__getXHRStats=this.getXHRStats}},{key:"_dbgCatch",value:function(e){for(var t=0,n=0,r=arguments.length,i=new Array(r>1?r-1:0),a=1;a<r;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i[a-1]=arguments[a]}try{if(e)return e.apply(void 0,i)}catch(o){this.reportError(o,i)}}},{key:"fnCatch",value:function(e){try{this.PAssert(5,e,"Must specify a callback")}catch(t){this.reportError(t)}return this._dbgCatch.bind(this,e)}},{key:"getTransitionClass",value:function(e){var t;switch(e){case 50:t="trans05";break;case 100:t="trans1";break;case 200:t="trans2";break;case 300:t="trans3";break;case 400:t="trans4";break;case 500:t="trans5";break;case 1e3:t="trans10";break;default:console.log("ERROR: no time for ",e)}return t}},{key:"setTransformStyle",value:function(e,t,n){try{this.PAssert(6,e,"Must provide a valid element")}catch(r){this.reportError(r)}if(e){try{this.PAssert(7,void 0!==t,"Must supply a valid X offset")}catch(r){this.reportError(r)}try{this.PAssert(8,void 0!==n,"Must supply a valid Y offset")}catch(r){this.reportError(r)}P.Z.ie?e.style[P.Z.transform.style]="translate("+t+"px, "+n+"px)":e.style[P.Z.transform.style]="translate3d("+t+"px, "+n+"px, 0px)"}}},{key:"setTransitionStyle",value:function(e,t,n,r){try{this.PAssert(9,e,"Must provide a valid element")}catch(i){this.reportError(i)}e&&(r=r||"ease",e.style[P.Z.transition.style]=t+" "+n+"ms "+r,setTimeout((function(){e.style[P.Z.transition.style]=""}),n))}},{key:"setTransform",value:function(e,t,n,r,i){r>0?(this.setTransitionStyle(e,P.Z.transform.prop,r,i),this.setTransformStyle(e,t,n)):t||n?this.setTransformStyle(e,t,n):e.style[P.Z.transform.style]="none"}},{key:"reload",value:function(){window.location.reload()}},{key:"parseTokensFromText",value:function(e){for(var t,n=0,r=[],i=/(?:(?:["]([^"<>]*)["]\s))|(?:([^",<>]*)\s)<([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>,?|(^|[\s,])<?([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>?,?/g,a=0;null!==(t=i.exec(e));){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=e.substring(a,t.index),s=t[1]||t[2],c=t[3]||t[5];a=i.lastIndex,o&&o.trim().length>0&&r.push({text:o,type:"text"}),r.push({text:s||c,email:c,type:"contact"})}var l=e.substring(a,e.length);return l&&l.length>0&&r.push({text:l,type:"text"}),r}},{key:"preventLocalWrites",value:function(e){try{this.PAssert(10,!this.noLocalWrites,"Should only disable local writes once")}catch(t){this.reportError(t)}try{this.PAssert(11,e>=0,"Must provide a valid reason for disabling local writes")}catch(t){this.reportError(t)}this.isDemoMode()||this.shouldLog(w.Z.LogLevels.Warning)&&this.log("---- WARNING: Local Writes Disabled ----"),this.noLocalWrites=!0,this.noLocalWritesReason=e}},{key:"enableDemoMode",value:function(){var e=this;this.demoMode=!0,P.Z.isDevURL&&setTimeout((function(){e.getToolbox().settings.testBetaFeatures.set(!0)}),0),this.preventLocalWrites(w.Z.LocalWriteReason.DemoMode)}},{key:"isDemoMode",value:function(){return this.demoMode}},{key:"isDisplayModeActive",value:function(e){return(this.activeDisplayMode&e)===e}},{key:"isDemoInIframe",value:function(){return this.isDisplayModeActive(w.Z.DisplayMode.InIframe)}},{key:"enableMinMode",value:function(){try{var e=I.Z.getURLParam("dmode");if(e){var t=parseInt(e);this.addClass(document.body,"minMode"),this.isMinMode=!0,t&w.Z.DisplayMode.InIframe&&this.addClass(document.documentElement,"inIframe"),t&w.Z.DisplayMode.Invisible&&this.addClass(document.documentElement,"invisible"),t&w.Z.DisplayMode.NoBoards&&this.addClass(document.body,"noBoards"),t&w.Z.DisplayMode.NoMinPaneSize&&(this.minPaneWidth=0),t&w.Z.DisplayMode.NoPaneStyle&&this.addClass(document.body,"noPaneStyle"),t&w.Z.DisplayMode.NoPanePadding&&(this.addClass(document.body,"noPanePadding"),this.noPanePadding=!0),t&w.Z.DisplayMode.NoScrollbars&&(this.noScrollbars=!0),t&w.Z.DisplayMode.NoBackground&&this.addClass(document.documentElement,"noBackground"),t&w.Z.DisplayMode.ShowHelp&&this.getToolbox().intro.showHelp(),this.activeDisplayMode=t}}catch(n){this.reportError(n)}}},{key:"hasClass",value:function(e){try{this.PAssert(12,e,"Must pass in a valid element")}catch(r){this.reportError(r)}if(null!==e&&void 0!==e&&e.classList)for(var t=0,n=0;n<(arguments.length<=1?0:arguments.length-1);n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e.classList.contains(n+1<1||arguments.length<=n+1?void 0:arguments[n+1]))return!0}return!1}},{key:"removeClass",value:function(e,t){try{this.PAssert(13,e,"Must pass in a valid element")}catch(n){this.reportError(n)}e&&e.classList&&e.classList.remove(t)}},{key:"addClass",value:function(e,t){try{this.PAssert(14,e,"Must pass in a valid element")}catch(n){this.reportError(n)}e&&e.classList&&e.classList.add(t)}},{key:"toggleClass",value:function(e,t){try{this.PAssert(15,e,"Must pass in a valid element")}catch(n){this.reportError(n)}e&&e.classList&&e.classList.toggle(t)}},{key:"findChild",value:function(e,t){try{this.PAssert(16,e,"Must pass in a valid element")}catch(o){this.reportError(o)}if(e)for(var n=0,r=0;r<e.childElementCount;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=e.children[r];if(this.hasClass(i,t))return i;var a=this.findChild(i,t);if(a)return a}}},{key:"setupClick",value:function(e,t,n){var r=this;try{this.PAssert(17,e,"Expecting an object to bind the click handlers to.")}catch(M){this.reportError(M)}try{this.PAssert(18,t,"Must specify a valid owner for click handlers")}catch(M){this.reportError(M)}this.shouldLog(w.Z.LogLevels.Input)&&this.log("SetupClick: "+this.elementToString(e)),t||(t=e);var i,a,o,s,c,l,u,d,h,p,f,g,m,v=this,y=!1;this.isFunction(n)?n={onClick:n}:n&&n.useCapture&&(y=n.useCapture);var k=function(e,r){try{v.PAssert(19,!t.isDestroyed||!t.isDestroyed()||"onMove"===e||"onEnd"===e,"Owner must not be destroyed to handle a click")}catch(M){v.reportError(M)}return n[e].call(t,r)},_=function(e){v.shouldLog(w.Z.LogLevels.Input)&&r.log("Move: ",e.id);var t=e.eventX-i,f=e.eventY-a;if(0!==t||0!==f){var g=!c;if(i=e.eventX,a=e.eventY,e.distanceX=o+=Math.abs(t),e.distanceY=s+=Math.abs(f),(c||e.distanceX>r.ClickThreshold||e.distanceY>r.ClickThreshold)&&(c=!0,e.moved=c),n.onMove||n.onFirstMove)if(e.diffX=e.eventX-l,e.diffY=e.eventY-u,e.xThisFrame=t,e.yThisFrame=f,e.startX=l,e.startY=u,e.startClientX=d,e.startClientY=h,e.startSrc=p,g&&n.onFirstMove&&k("onFirstMove",e),n.onMove)k("onMove",e)&&e.stopImmediatePropagation()}},Z=function(t){v.shouldLog(w.Z.LogLevels.Input)&&v.log("End: ",t.id,v.elementToString(t.target),v.elementToString(e));var r=Date.now();f=f||r;var o=Math.max(0,r-f);g?g++:g=1,t.moved=c,t.timeDelta=o,t.diffX=i-l,t.diffY=a-u,t.startX=l,t.startY=u,t.startSrc=p,p=void 0,o<w.Z.DoubleClickTime&&o>0&&n.onDoubleClick&&!c&&k("onDoubleClick",t),isNaN(t.button)||t.button===w.Z.ButtonCode.Left?(f=r,!n.onClick||c||P.Z.mac&&t.ctrlKey||k("onClick",t),n.onEnd&&k("onEnd",t)):t.button===w.Z.ButtonCode.Middle&&n.onMiddleClick&&!c&&k("onMiddleClick",t),setTimeout((function(){f=void 0,g=void 0}),w.Z.DoubleClickTime)},b=function(t){v.shouldLog(w.Z.LogLevels.Input)&&v.log("Cancel: ",t.id,v.elementToString(t.target),v.elementToString(e)),n.onCancel&&k("onCancel",t)},S=function(t){v.shouldLog(w.Z.LogLevels.Input)&&v.log("Start: ",t.id,v.elementToString(t.target),v.elementToString(e)),t.timeStart=Date.now(),p=t.target,t.startSrc=t.target,c=!1,t.startX=l=t.eventX,t.startY=u=t.eventY,t.startClientX=d=t.clientX,t.startClientY=h=t.clientY,i=t.eventX,a=t.eventY,o=0,s=0,(isNaN(t.button)||t.button===w.Z.ButtonCode.Left||t.button===w.Z.ButtonCode.Right)&&((isNaN(t.button)||t.button===w.Z.ButtonCode.Left)&&n.onStart?k("onStart",t):t.button===w.Z.ButtonCode.Right&&n.onRightStart&&k("onRightStart",t)),isNaN(t.changeLastY)||(a+=t.changeLastY)},D=this.fnCatch((function(t){var n=P.Z.ie?t:t.touches[0];if(t.eventX=n.pageX,t.eventY=n.pageY,t.clientX=n.clientX,t.clientY=n.clientY,_.call(e,t),t.returnFalse)return!1})),I=this.fnCatch((function(t){v.shouldLog(w.Z.LogLevels.Input)&&v.log("TouchUp: ",t.id,v.elementToString(t.target),v.elementToString(e)),document.removeEventListener(P.Z.touchMoveEvent,D,y),document.removeEventListener(P.Z.touchEndEvent,I,y),document.removeEventListener(P.Z.touchCancelEvent,E,y);var n=P.Z.ie?t:t.changedTouches[0];if(t.eventX=n.pageX,t.eventY=n.pageY,t.clientX=n.clientX,t.clientY=n.clientY,Z.call(e,t),t.returnFalse)return!1})),E=this.fnCatch((function(t){if(v.shouldLog(w.Z.LogLevels.Input)&&v.log("TouchCancel: ",t.id,v.elementToString(t.target),v.elementToString(e)),document.removeEventListener(P.Z.touchMoveEvent,D,y),document.removeEventListener(P.Z.touchEndEvent,I,y),document.removeEventListener(P.Z.touchCancelEvent,E,y),b.call(e,t),t.returnFalse)return!1})),x=this.fnCatch((function(t){if(!t.handled&&!m)return v.shouldLog(w.Z.LogLevels.Input)&&v.log("MouseDown: ",t.id,v.elementToString(t.target),v.elementToString(e)),m=!1,t.eventX=t.pageX,t.eventY=t.pageY,S.call(e,t),t.ignore||(t.button===w.Z.ButtonCode.Left&&document.addEventListener(P.Z.moveEvent,C,y),document.addEventListener(P.Z.upEvent,A,y)),!t.returnFalse&&void 0})),C=this.fnCatch((function(t){if(!m)return t.eventX=t.pageX,t.eventY=t.pageY,_.call(e,t),!t.returnFalse&&void 0})),A=this.fnCatch((function(t){if(!t.handled&&!m)return v.shouldLog(w.Z.LogLevels.Input)&&v.log("MouseUp: ",t.id,v.elementToString(t.target),v.elementToString(e)),document.removeEventListener(P.Z.moveEvent,C,y),document.removeEventListener(P.Z.upEvent,A,y),t.button===w.Z.ButtonCode.Left&&Z.call(e,t),!t.returnFalse&&void 0})),L=this.fnCatch((function(t){t.handled||m||(v.shouldLog(w.Z.LogLevels.Input)&&v.log("ContextMenu: ",t.id,v.elementToString(t.target),v.elementToString(e)),n.onRightClick&&k("onRightClick",t))}));return e.addEventListener(P.Z.downEvent,x,y),n.onRightClick&&e.addEventListener("contextmenu",L,y),this}},{key:"isDOMNode",value:function(e){return"HTMLElement"in window?e instanceof HTMLElement||e instanceof SVGElement:e&&e.tagName&&e.nodeType===Node.ELEMENT_NODE}},{key:"ensureDOMNode",value:function(e){var t,n;e instanceof SVGPathElement?t=null===(n=e.parentElement)||void 0===n?void 0:n.parentElement:this.isDOMNode(e)?t=e:(this.isTextNode(e)||e instanceof SVGElement)&&(t=e.parentElement);return t}},{key:"enumToString",value:function(e,t){for(var n in e)if(e[n]===t)return n;return null}},{key:"elementToString",value:function(e,t){if(e){var n,r=e.nodeName;return e.id&&(r+="#"+e.id),null!==(n=e.className)&&void 0!==n&&n.replace&&(r+="."+e.className.replace(/ /g,".")),t&&e.innerText&&(r+=":"+e.innerText.length),r}return"UNDEFINED"}},{key:"getElementPath",value:function(e,t){var n=!0,r="";try{for(var i=0;e&&"container"!==e.id&&e!==document.documentElement&&e!==document.body;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r+=n?this.elementToString(e,t)+" ":this.elementToString(e)+" ",n=!1,e=e.nodeType===Node.TEXT_NODE?e.parentNode:e.parentElement}}catch(a){r+=a.message}return r}},{key:"setDimension",value:function(e,t){window.ga&&!this.isDemoMode()&&ga("set",e,t)}},{key:"sendEvent",value:function(e,t,n){try{this.PAssert(21,void 0===n||this.isNumber(n),"Values must be numeric")}catch(r){this.reportError(r)}if(window.ga&&!this.isDemoMode())try{ga("send","event",e,t,this.getAnonUserIdentifier(),n)}catch(i){this.reportError(i,"Category: "+e+" Action: "+t+" Value: "+n)}}},{key:"sendToGoogle",value:function(e,t){var n="//www.googleadservices.com/pagead/conversion/976910954/?label="+e+"&guid=ON";t&&(n+="&value="+t+"&currency_code=USD"),new Image(1,1).src=n}},{key:"reportAdConversion",value:function(e,t){try{this.sendToGoogle(e,t)}catch(n){this.reportError(n)}}},{key:"pageDataCleared",value:function(){this.isPageDataCleared=!0}},{key:"hasPageDataBeenCleared",value:function(){return this.isPageDataCleared}},{key:"findFirstDiff",value:function(e,t,n,r){var i=0;if(!e)return r?0:t.length;if(!t)return r?e.length:0;for(var a=Math.min(e.length,t.length),o=0;o<a;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(n){if(e.charAt(o).toLowerCase()!==t.charAt(o).toLowerCase())return o}else if(e.charAt(o)!==t.charAt(o))return o}return r?e.length:t.length}},{key:"lerp",value:function(e,t,n){return e+(t-e)*n}},{key:"hashCode",value:function(e){var t,n=0,r=0;if(0===e.length)return r;for(t=0;t<e.length;t++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r=(r<<5)-r+e.charCodeAt(t),r|=0}return r}},{key:"sanitizePaneState",value:function(e){try{for(var t=0,n=JSON.parse(JSON.stringify(e)),r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;""!==n[r].search&&(n[r].search="HasSearch")}return JSON.stringify(n)}catch(i){return"Failed to sanitize pane state"}}},{key:"sanitizeLocalSettings",value:function(e){try{var t=JSON.parse(e);return delete t.values.Default.paneState,delete t.values.Default.localPaneState,delete t.values.Default.gdocTitle,t}catch(n){return"Failed to parse settings"}}},{key:"sanitizeKey",value:function(e){switch(e){case w.Z.KeyCode.Backspace:return"BACKSPACE";case w.Z.KeyCode.Delete:return"DELETE";case w.Z.KeyCode.Enter:return"ENTER";case w.Z.KeyCode.Escape:return"ESCAPE";default:return"CHAR"}}},{key:"getLoadedScripts",value:function(e){try{for(var t=0,n=document.getElementsByTagName("script"),r=[],i=0;i<n.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=n[i];a.src&&r.push(a.src)}e.loadedScripts=r}catch(o){e.loadedScripts="ERROR: "+o.message}}},{key:"getExtraReportData",value:function(e){e.platformConfig=P.Z.getUserPlatformConfig()}},{key:"criticalErrorReported",value:function(){return this.hasCriticalError}},{key:"handleCriticalError",value:function(){var e=this;this.hasCriticalError=!0;try{document.body.innerHTML='<div class="centerVHFlex">There was a critical error while loading Moo.do. '.concat(P.Z.actionVerb().capitalize()," to reload and try again.</div>"),document.body.addEventListener("click",(function(){return e.reload()}))}catch(t){this.reportError(t)}}},{key:"reportEvent",value:function(e){if(!this.isDemoMode()){var t=this.parseExtra(e);t&&this.eventStream.push(t)}}},{key:"getEventStream",value:function(){return this.eventStream.ordered()}},{key:"parseExtra",value:function(e){var t;if(e)try{var n;if(e instanceof KeyboardEvent){var r=this.elementToString(e.target);["[INPUT#importPW]","[INPUT#importEmail]","[TEXTAREA#bugDescription.bugDescription editable]"].indexOf(r)<0&&(n={type:e.type,currentTarget:this.elementToString(e.currentTarget),target:r,keyCode:this.sanitizeKey(e.keyCode),normCode:this.sanitizeKey(e.normCode),ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,tstamp:Date.now()})}else if(e instanceof MouseEvent)n={type:e.type,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),clientX:e.clientX,clientY:e.clientY,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,which:e.which,button:e.button,tstamp:Date.now()};else if(window.TouchEvent&&e instanceof TouchEvent){n={type:e.type,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),tstamp:Date.now()};var i=e.touches[0];i&&(n.clientX=i.clientX,n.clientY=i.clientY)}else if(window.PointerEvent&&e instanceof PointerEvent)n={type:e.type,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),clientX:e.clientX,clientY:e.clientY,tstamp:Date.now()};else if(e instanceof Event)n={type:e.type,name:e.name,code:e.code,message:e.message,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),tstamp:Date.now()};else if(e instanceof Selection)if(0===e.rangeCount)n={rangeCount:0};else{var a=e.getRangeAt(0),o=a.startContainer,s=!1,c=a.endContainer,l=!1;o.nodeType===Node.TEXT_NODE&&(o=o.parentNode,s=!0),c.nodeType===Node.TEXT_NODE&&(c=c.parentNode,l=!0),n={rangeCount:e.rangeCount,startContainer:this.getElementPath(o),startWasTextNode:s,startOffset:a.startOffset,endContainer:this.getElementPath(c),endWasTextNode:l,endOffset:a.endOffset}}else n=e;t=n?this.safeStringify(n):void 0}catch(u){this.log("Error parsing extra "+u.message)}return t}},{key:"handleJSError",value:function(e,t,n,i){e&&(!n&&window.__error&&window.__error("JS Error: "+e.message,"  Stack: ",e.stack,"  Extra: ",t),u()(m()(r.prototype),"handleJSError",this).call(this,e,t,n,i))}},{key:"onWindowError",value:function(e,t,n,r,i){console.log(e,t,n,r,i),"ResizeObserver loop limit exceeded"!==e&&"Script error."!==e&&(i?(this.log("Reported Global OnError: "+e+" Script: "+t+" Line: "+n+" Column: "+r),this.reportError(i)):(this.log("Unreported Global OnError: "+e+" Script: "+t+" Line: "+n+" Column: "+r),this.reportError(e)))}},{key:"checkpoint",value:function(e){window.__checkpoints|=e}},{key:"wrapFn",value:function(e,t){var n=this;return function(){try{return e.apply(this,arguments)}catch(r){r&&"auth/network-request-failed"===r.code||(n.reportError(r),t&&t(r))}}}},{key:"wrapAsyncCallbacks",value:function(){var e=this,t=function(t){var n=window[t];window[t]=function(){var t=Array.prototype.slice.call(arguments),r=t[0];return"function"===typeof r&&(t[0]=e.wrapFn(r)),n.apply?n.apply(this,t):n(t[0],t[1])}};t("setTimeout"),t("setInterval")}},{key:"readyStateCallback",value:function(e,t,n){e.onloadDone=!1,e.onload=function(){e.onloadDone=!0,t&&t()},e.onreadystatechange=function(){"loaded"!==e.readyState||e.onloadDone||(e.onloadDone=!0,t&&t())},n&&(e.onerror=n)}},{key:"createPath",value:function(e){return window.location.protocol+"//"+window.location.host+"/"+e}},{key:"addScript",value:function(e,t,n,r){try{this.PAssert(22,!t||null===document.getElementById(t),"Should never include the same script ID multiple times")}catch(a){this.reportError(a)}var i=document.createElement("script");i.src=e,t&&(i.id=t),n&&this.readyStateCallback(i,n,r);try{this.PAssert(23,"undefined"!==typeof i,"Should always be able to create a valid script object")}catch(a){this.reportError(a)}"undefined"!==typeof i&&document.getElementsByTagName("head")[0].appendChild(i)}},{key:"addStylesheet",value:function(e,t,n){var r=document.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=e,t&&this.readyStateCallback(r,t,n),"undefined"!==typeof r&&document.getElementsByTagName("head")[0].appendChild(r)}},{key:"DAssert",value:function(e,t){}},{key:"PAssert",value:function(e,t){var n=this;if(!t){var r={isAssert:!0,tag:e};try{var i=Array.prototype.slice.call(arguments,2),a=this.makeString(i.map((function(e){return n.isFunction(e)?e():e})));arguments.length>2?this.log("Assert Failure "+e+": "+a):this.log("Assert Failure "+e),this.reportError(new Error("Assert Failure: "+a),r,w.Z.LogLevels.Warning)}catch(o){this.log("Exception in PAssert "+e+": ",o),this.reportError(o,r)}}}},{key:"getElementParent",value:function(e){var t=0;for(0;e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.hasClass(e,"paneItemElement")||this.hasClass(e,"itemNotInPane")||this.hasClass(e,"paneHiddenInput")||this.hasClass(e,"draggable"))return e;e=e.parentNode}}},{key:"isItemValidForPass",value:function(e,t){return!!e&&(t?e.lastFindPass===this.currentFindPass:e.lastFindPass<this.currentFindPass)}},{key:"markItemForPass",value:function(e,t){if(e){var n=this.isItemValidForPass(e,t);try{this.PAssert(25,n,"Item should always be valid")}catch(r){this.reportError(r)}return e.lastFindPass=this.currentFindPass,n}return!1}},{key:"getPreviousItem",value:function(e,t,n){return this.currentFindPass++,this._getPreviousItem(e,t,n)}},{key:"_getPreviousItem",value:function(e,t,n){var r;var i=n&&n.isTest,a=n&&n.ignoreSearch,o=n&&n.sameLevel,s=n&&n.includeNotes;if(this.markItemForPass(e,i)){var c=e.parent();if(c){if(e.isNote())return e.parent();var l=c.getChildIndex(e);if(l>0)for(var u=0;!r;){var d=0;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;for(var h=!1,p=l-1;p>=0;p--){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var f=c.getChild(p);if(!this.markItemForPass(f,i)){try{this.PAssert(27,!1,"Invalid child found during findPreviousItem")}catch(g){this.reportError(g)}return}if(o||!f.hasChildren()||t&&f.isCollapsed(t,!1)){if(a||!t||!f.isHidden(t,!1)){r=f,h=!0;break}}else if(a||!t||!f.isHidden(t,!1)){c=f,l=f.numChildren(),h=!0;break}}if(o)break;h||(r=c)}else o||(r=e.parent());s&&r&&r.hasNote()&&(r=r.getNote());try{this.PAssert(28,!o||!r||r.parent()===e.parent(),"Previous item must share the same parent")}catch(g){this.reportError(g)}try{this.PAssert(29,i||!r||t&&r.isCollapsed(t,!1)||e===this._getNextItem(r,t,{isTest:!0,ignoreSearch:a,sameLevel:o}),"Previous/Next should always match")}catch(g){this.reportError(g)}return r}}}},{key:"getNextItem",value:function(e,t,n){return this.currentFindPass++,this._getNextItem(e,t,n)}},{key:"_getNextItem",value:function(e,t,n){var r,i=0;var a=n&&n.isTest,o=n&&n.ignoreSearch,s=n&&n.sameLevel,c=n&&n.includeNotes;if(e){if(c&&e.hasNote())return e.getNote();if(e.isNote()&&(e=e.parent()),!s&&e.hasChildren()&&(!t||!e.isCollapsed(t,!1)))for(var l=0,u=e.numChildren(),d=0;d<u;++d){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var h=e.getChild(d);if(!this.markItemForPass(h,a)){try{this.PAssert(31,!1,"Invalid child found during findNextItem A")}catch(_){this.reportError(_)}return}if(o||!t||!h.isHidden(t,!1)){r=h,n&&n.numLevels++;break}}for(var p=e;!r;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(!this.markItemForPass(p,a)){try{this.PAssert(32,!1,"Invalid parent found during findNextItem B")}catch(_){this.reportError(_)}break}var f=p.parent();if(!f)break;var g=f.getChildIndex(p),m=f.numChildren();if(!t||!f.isCollapsed(t,!1))for(var v=0,y=g+1;y<m;++y){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;var k=f.getChild(y);if(!this.markItemForPass(k,a)){try{this.PAssert(34,!1,"Invalid child found during findNextItem C")}catch(_){this.reportError(_)}return}if(o||!t||!k.isHidden(t,!1)){r=k;break}}if(p=f,n&&!r&&n.numLevels--,s||t&&p===t.getItem())break}try{this.PAssert(35,!s||!r||r.parent()===e.parent(),"Next item must share the same parent")}catch(_){this.reportError(_)}try{this.PAssert(36,a||!r||e===this._getPreviousItem(r,t,{isTest:!0,ignoreSearch:o,sameLevel:s}),"Previous/Next should always match")}catch(_){this.reportError(_)}return r}}},{key:"easeOut",value:function(e,t,n){return-n*e*(e-2)+t}},{key:"scrollElementTo",value:function(e,t){var r=!1;if(e){try{if("smooth"===t.behavior)n(860)(t.top,300,void 0,e);else e.scrollTo(t);r=!0}catch(o){}if(!r){var i=t.left,a=t.top;void 0!==i&&(e.scrollLeft=i),void 0!==a&&(e.scrollTop=a)}}}},{key:"scrollTo",value:function(e,t,n,r,i){try{this.PAssert(37,void 0!==e||void 0!==t,"Must be scrolling something")}catch(o){this.reportError(o)}try{this.PAssert(38,void 0===e||this.isNumber(e),"Must provide a valid scrollPosX")}catch(o){this.reportError(o)}try{this.PAssert(39,void 0===t||this.isNumber(t),"Must provide a valid scrollPosY")}catch(o){this.reportError(o)}try{this.PAssert(40,this.isDOMNode(r),"Must provide a valid element to scroll")}catch(o){this.reportError(o)}try{this.PAssert(41,!i||this.isFunction(i),"Must provide a valid scrollDone callback")}catch(o){this.reportError(o)}var a=r.getAttribute("data-moo-id")||r.id;try{this.PAssert(42,a,"Should only scroll elements with ids")}catch(o){this.reportError(o)}this.scrollTimeouts[a]&&(cancelAnimationFrame(this.scrollTimeouts[a]),delete this.scrollTimeouts[a]),r?(this.scrollElementTo(r,{left:e,top:t,behavior:n}),i&&("smooth"===n?setTimeout(i,500):i())):this.reportError(new Error("Must specify an element to scroll to"))}},{key:"computeScrollSpeed",value:function(e,t,n,r,i){var a=(t-e-(t-(n=this.clamp(n,e,t))))/(t-e);return i<0&&(a-=1),a*r}},{key:"performRepeatScrollPane",value:function(){if(this.scrollState.pane){var e=this.scrollState.pane,t=e.id,n=this.scrollState.speedPane;e.addScrollDelta(n,"auto"),this.animationFrameOnce("repeatScroll"+t,this.performRepeatScrollPane)}}},{key:"repeatScrollPane",value:function(e,t){this.scrollState.speedPane=e,t!==this.scrollState.pane&&(this.scrollState.pane=t,this.animationFrameOnce("repeatScroll"+t.id,this.performRepeatScrollPane))}},{key:"performRepeatScroll",value:function(){if(this.scrollState.pane||this.scrollState.panes){var e;if(this.scrollState.pane){var t=6*this.scrollState.speedPane;e=this.scrollState.pane.addScrollDelta(t)}else{var n=6*this.scrollState.speedPanes,r=this.element("panes"),i=r.scrollLeft;r.scrollLeft+=n,e=i!==r.scrollLeft}e?requestAnimationFrame(this.performRepeatScroll):this.cancelRepeatScroll(this.scrollState.pane?"pane":"panes")}}},{key:"repeatScroll",value:function(e,t,n,r){this.scrollState["speed"+(n?"Pane":"Panes")]=t,(this.scrollState.pane||this.scrollState.panes)&&n===this.scrollState.pane||(this.scrollState.pane=n,this.scrollState.panes=r,requestAnimationFrame(this.performRepeatScroll))}},{key:"cancelRepeatScrolls",value:function(){this.scrollState.pane=void 0,this.scrollState.panes=void 0}},{key:"cancelRepeatScroll",value:function(e){this.scrollState[e]=void 0}},{key:"elementInPane",value:function(e){if(e){var t=0;for(e.nodeType===Node.TEXT_NODE&&(e=e.parentNode);e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.hasClass(e,"pane")||this.hasClass(e,"paneOverviewOutside"))return!!e;e=e.parentElement}}return!1}},{key:"trimString",value:function(e){for(var t=0,n=/\s/,r=(e=e.replace(/^\s\s*/,"")).length;n.test(e.charAt(--r));)if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;return e.slice(0,r+1)}},{key:"preventAndStop",value:function(e){this.preventDefault(e),this.stopPropagation(e)}},{key:"preventDefault",value:function(e){if(e&&e.preventDefault)e.preventDefault();else try{this.PAssert(43,!1,"Invalid event object: "+e)}catch(t){this.reportError(t)}}},{key:"stopPropagation",value:function(e){if(e&&e.stopPropagation)e.stopPropagation();else try{this.PAssert(44,!1,"Invalid event object: "+e)}catch(t){this.reportError(t)}}},{key:"preventClick",value:function(){var e=this;this.addClass(this.element("outerWrapper"),"noClick"),window.ontouchstart=this.preventDefault,requestAnimationFrame((function(){window.ontouchstart=void 0,e.removeClass(e.element("outerWrapper"),"noClick")}))}},{key:"loadXML",value:function(e){try{var t=window;if("undefined"!==typeof t.DOMParser)return(new t.DOMParser).parseFromString(e,"text/xml");if("undefined"!==typeof t.ActiveXObject&&new t.ActiveXObject("Microsoft.XMLDOM")){var n=new t.ActiveXObject("Microsoft.XMLDOM");return n.async="false",n.loadXML(e),n}try{this.PAssert(45,!1,"No XML parser found")}catch(r){this.reportError(r)}return}catch(i){return void this.reportError(i)}}},{key:"getPluginForElement",value:function(e){return this.findParent(e,"plugin",4)}},{key:"findParentInItem",value:function(e,t){for(var n=0;e&&!this.hasClass(e,"item");){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(this.hasClass(e,t))return e;e=e.parentNode}}},{key:"findParent",value:function(e,t,n){try{this.PAssert(46,e,"Must pass in a valid element")}catch(o){this.reportError(o)}if(n||(n=1e3),e)for(var r=0,i=e,a=0;a<n&&i;++a,i=i.parentElement){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if("string"===typeof t?this.hasClass(i,t):i===t)return i}}},{key:"findParentID",value:function(e,t,n){try{this.PAssert(48,e,"Must pass in a valid element")}catch(o){this.reportError(o)}if(n||(n=1e4),e)for(var r=0,i=e,a=0;a<n&&i;++a,i=i.parentElement){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i.id===t)return i}}},{key:"findParentAttr",value:function(e,t,n){try{this.PAssert(49,e,"Must pass in a valid element")}catch(c){this.reportError(c)}if(e)for(var r=0,i=e;i;i=i.parentElement){var a,o;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=null===(a=(o=i).getAttribute)||void 0===a?void 0:a.call(o,t);if(null!=s&&(!n||s===n))return i}}},{key:"getParentAttr",value:function(e,t,n){var r=this.findParentAttr(e,t,n);return null===r||void 0===r?void 0:r.getAttribute(t)}},{key:"prependChild",value:function(e,t){try{this.PAssert(50,e,"Must pass in a valid element")}catch(n){this.reportError(n)}try{this.PAssert(51,t,"Must pass in a valid element")}catch(n){this.reportError(n)}e.insertBefore(t,e.firstChild)}},{key:"isAttachedToDoc",value:function(e){try{this.PAssert(52,e,"Must supply a valid element to check")}catch(t){this.reportError(t)}try{this.PAssert(53,e.ownerDocument,"Checked element must have a valid owner document")}catch(t){this.reportError(t)}return!!e.ownerDocument&&(e.ownerDocument.body.contains(e)||e.ownerDocument.documentElement===e)}},{key:"offset",value:function(e){try{this.PAssert(54,e,"Must pass in a valid element")}catch(a){this.reportError(a)}var t=e.getBoundingClientRect(),n=e.ownerDocument,r=e.ownerDocument.documentElement,i=n.defaultView;return{top:t.top+i.pageYOffset-r.clientTop,left:t.left+i.pageXOffset-r.clientLeft,bottom:t.bottom+i.pageYOffset-r.clientTop,right:t.right+i.pageXOffset-r.clientLeft}}},{key:"position",value:function(e){var t=e.offsetParent,n=e.getBoundingClientRect(),r=t.getBoundingClientRect();return{left:n.left-r.left,top:n.top-r.top}}},{key:"height",value:function(e){try{this.PAssert(56,e,"Must pass in a valid element")}catch(r){this.reportError(r)}var t=e.offsetHeight,n=window.getComputedStyle(e);return n?("border-box"!==n.boxSizing&&(t-=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom)),t-=parseFloat(n.borderTopWidth)+parseFloat(n.borderBottomWidth)):this.shouldLog(w.Z.LogLevels.Error)&&this.log("GetComputedStyle failed in globals::height"),t}},{key:"width",value:function(e){try{this.PAssert(58,e,"Must pass in a valid element")}catch(r){this.reportError(r)}var t=e.offsetWidth,n=window.getComputedStyle(e);return n?("border-box"!==n.boxSizing&&(t-=parseFloat(n.paddingLeft)+parseFloat(n.paddingRight)),t-=parseFloat(n.borderLeftWidth)+parseFloat(n.borderRightWidth)):this.shouldLog(w.Z.LogLevels.Error)&&this.log("GetComputedStyle failed in globals::width"),t}},{key:"wrapXHR",value:function(){try{var e=window,t=e.XMLHttpRequest.prototype.open,n=e.XMLHttpRequest.prototype.send,r=this;e.XMLHttpRequest.prototype.open=function(e,n,i,a,o){this.url=n,void 0===i&&(i=!0);try{t.call(this,e,n,i,a,o)}catch(s){throw r.reportError(s),s}},e.XMLHttpRequest.prototype.send=function(e){this.timeout||(this.timeout=r.seconds(70));try{this.url&&!this.url.startsWith("https://nikkomsgchannel")&&n.call(this,e)}catch(t){throw r.reportError(t),t}}}catch(i){this.reportError(i)}}},{key:"element",value:function(e){try{this.PAssert(60,e,"Tried to get an element without an id")}catch(t){this.reportError(t)}return document.getElementById(e)}},{key:"openUrl",value:function(e,t,n){var r=this;try{this.PAssert(61,e,"Must always provide a valid URL to open")}catch(u){this.reportError(u)}if(!e)return!1;var i="/"===e[0]||e.indexOf("://")>0||e.startsWith("tel:")||e.startsWith("mailto:");e=i?e:"http://"+e;var a=this.getToolbox(),o=this.parseEvernoteLink(e);if(o){var s=!!a&&a.settings.openEvernoteApp.get();if(void 0===s)return void a.menus.confirm("Open Evernote links in Evernote app?",(function(i){a&&a.settings.openEvernoteApp.set(i),r.openUrl(e,t,n)}));s&&(e=o.viewUrl?o.viewUrl:"evernote:///view/"+o.userId+"/"+o.shardId+"/"+o.noteGuid+"/"+o.noteGuid+"/")}if(P.Z.standalone){var c=document.createElement("a");c.setAttribute("href",e),c.setAttribute("target","_blank"),c.setAttribute("rel","noopener noreferrer");var l=document.createEvent("HTMLEvents");l.initEvent("click",!0,!0),c.dispatchEvent(l)}else if(P.Z.app){try{this.PAssert(63,!1,"Should not open URL in globals on mobile")}catch(u){this.reportError(u)}P.Z.isChrome||!e.startsWith("http://")&&!e.startsWith("https://")?e.startsWith("/")&&(e=window.location.host+e):e=e.replace("http://","").replace("https://",""),e.startsWith("callto:")&&(e=e.replace("callto:","tel:")),a.nativeBridge.sendToApp("openURL",e),t&&(this.preventAndStop(t),t.returnFalse=!0)}else(n=n||e.startsWith("evernote:///")||e.startsWith("onenote:")||e.startsWith("bear:"))?open(e,"_self"):open(e,"_blank");return!0}},{key:"getLocationOrigin",value:function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}},{key:"isSpellcheckEnabled",value:function(){return!1}},{key:"fFalse",value:function(){return!1}},{key:"fTrue",value:function(){return!0}},{key:"toFileSize",value:function(e){if(e){var t=Math.log(e)/Math.log(1024)|0;return(e/Math.pow(1024,t)).toFixed(2)+" "+(0===t?"bytes":"KMGTPEZY"[t-1]+"B")}return null}},{key:"saveFile",value:function(e,t){var n=new Blob([e],{type:"text/plain;charset=utf-8"});(0,b.saveAs)(n,t)}},{key:"downloadFile",value:function(e,t){var n=this.getToolbox();if(P.Z.supportsNativeDownload())n.ElectronBridge.downloadFile(e,t);else if(document.createEvent){var r=document.createElement("a");r.href=e;var i=document.createEvent("MouseEvents");i.initEvent("click",!0,!0),r.dispatchEvent(i)}else window.open(e,"_this")}},{key:"printPage",value:function(e){P.Z.app||window.open(e).print()}},{key:"getItemForElement",value:function(e){var t=this.getPaneObjectForElement(e),n=t&&(this.isVMLI(t)?t:t.item);try{this.PAssert(64,!n||this.isVMLI(n),"Must always find a valid VMLI for a given element: "+this.elementToString(e))}catch(r){this.reportError(r)}if(n)return n}},{key:"getIndexForElement",value:function(e){var t=this.getPaneObjectForElement(e);return null===t||void 0===t?void 0:t.index}},{key:"getPaneForElement",value:function(e){var t=this.getPaneObjectForElement(e);return t?null===t||void 0===t?void 0:t.pane:this.getPropFromFiberNode(e,"pane")}},{key:"getPaneObjectForElement",value:function(e){var t=this.getPropFromFiberNode(e,"paneObject");if(t)return t}},{key:"getPropFromFiberNode",value:function(e,t){var n,r=0,i=e;for((null===(n=i)||void 0===n?void 0:n.nodeType)===Node.TEXT_NODE&&(i=i.parentElement);i&&i!==document;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i)for(var a in i)if(a.startsWith("__reactFiber$")){var o=i[a];if(o){var s,c,l=null===o||void 0===o||null===(s=o.child)||void 0===s||null===(c=s.pendingProps)||void 0===c?void 0:c[t];if(!l)for(var u=0,d=o,h=o.return;h&&!l&&h!==d;){var p;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;l=null===(p=h.pendingProps)||void 0===p?void 0:p[t],h=h.return}if(l)return l}break}i=i.parentElement}}},{key:"btoa",value:function(e){return window.btoa(e)}},{key:"atob",value:function(e){return window.atob(e)}},{key:"elementFromPoint",value:function(e,t){return document.elementFromPoint(e,t)}},{key:"parentTextForItem",value:function(e){for(var t=0,n=e.parents(),r="",i=1;i<n.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i>1&&(r+="  |  "),r+=n[i].generateTitleText()}return r}},{key:"batchRenderUpdates",value:function(e,t){return D.unstable_batchedUpdates(e,t)}},{key:"hexToRgb",value:function(e){return{r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}}},{key:"hexToRgbStr",value:function(e){var t=this.hexToRgb(e);return t.r+","+t.g+","+t.b}},{key:"rgbToHex",value:function(){for(var e=0,t=this,n=0,r=arguments.length,i=new Array(r),a=0;a<r;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;i[a]=arguments[a]}var o=i.map((function(e){return t.pad2(Math.round(e).toString(16))})).filter((function(e){return void 0!==e}));return o.join("")}},{key:"infLoop",value:function(e){if(!this.timeLastLoop||e<this.numLastLoop)this.timeLastLoop=Date.now();else if(e>this.numLastLoop&&e>3e4&&e%200===0&&Date.now()-this.timeLastLoop>1e4){0;try{this.PAssert(65,!1,"Infinite loop!",e)}catch(n){this.reportError(n)}var t=this.getToolbox();return t.toasts&&t.toasts.pushMessage(w.Z.MessageID.ReactError),!0}this.numLastLoop=e}},{key:"XHR_PrivateAPI",value:function(e){}},{key:"getRollbarData",value:function(){return{url:this.sanitizeURL(window.location.href),jsVersion:w.Z.jsVersion,htmlVersion:document&&document.body?document.body.getAttribute("ver"):"UNKNOWN"}}},{key:"sendRollbar",value:function(e,t,n){window.Rollbar&&(n===w.Z.LogLevels.Error?(Rollbar.error(e,t),this.sendEvent("ErrorReport","Error")):n===w.Z.LogLevels.Warning?(Rollbar.warning(e,t),this.sendEvent("ErrorReport","Warning")):(Rollbar.error(e,t),this.sendEvent("ErrorReport","Unknown")))}},{key:"textToJSONPromise",value:function(e){try{return Promise.resolve(JSON.parse(e))}catch(t){}}},{key:"textToTextPromise",value:function(e){return Promise.resolve(e)}},{key:"XHR",value:function(){var e=i()(_().mark((function e(t){var n,r,i,a,o,s,c,l,u,d,h=this;return _().wrap((function(e){for(var p=0;;){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;switch(e.prev=e.next){case 0:n=t.url,r=t.type,i=t.data,a=t.headers,o=t.autoRetry,s=t.timeout,c=t.maxRetries,l=t.username,u=t.password,d=this;try{d.PAssert(66,n,"Must specify a valid URL to use")}catch(f){d.reportError(f)}try{d.PAssert(67,r,"Must specify a valid request type")}catch(f){d.reportError(f)}return e.abrupt("return",new Promise((function(e){var t=0;c=Math.min(c||2,6),h.notifyStatsXHRRequest(n);var p=function(){try{d.PAssert(68,t<c,"Should not be calling retry once retries have been exhausted")}catch(f){d.reportError(f)}t<c?(t++,h.notifyStatsXHRRetry(n),setTimeout(g,1e3*Y[t])):(h.notifyStatsXHRFailure(n),h.reportError(new Error("XHR Failed: "+n)))},g=function(){var d,f=new XMLHttpRequest;(void 0===s||isNaN(s)||(f.timeout=s),f.onreadystatechange=function(){if(4===f.readyState){var r=f;r.json=h.textToJSONPromise.bind(h,f.response),r.text=h.textToTextPromise.bind(h,f.response),200!==f.status?t<c?(f.retry=p,o&&X.indexOf(f.status)>=0?f.retry():e(r)):(h.notifyStatsXHRFailure(n),e(r)):(h.notifyStatsXHRSuccess(n),e(r))}},l&&u?f.open(r.toUpperCase(),n,!0,l,u):f.open(r.toUpperCase(),n,!0),a&&Object.keys(a).forEach((function(e){return f.setRequestHeader(e,a[e])})),i)?(f.setRequestHeader("Accept","*/*"),a&&a["Content-Type"]||f.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),d=i instanceof Blob?i:h.generateQueryString(i),f.send(d)):f.send()};g()})));case 5:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"scheduleIdleTask",value:function(e){setTimeout(e,100)}},{key:"getReactChildByKey",value:function(e,t){var n;return S.Children.forEach(e,(function(e){e&&e.key===t&&(n=e)})),n}},{key:"onMouseMoveUp",value:function(e,t){document.addEventListener("mousemove",e),document.addEventListener("mouseup",(function n(r){t(r),document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",n)}))}},{key:"createStyles",value:function(e){return e}},{key:"enforceBodyScroll",value:function(){var e=this;this._enforceBodyScroll(),requestAnimationFrame((function(){e._enforceBodyScroll(),requestAnimationFrame((function(){e._enforceBodyScroll()}))}))}},{key:"_enforceBodyScroll",value:function(){document.body.scrollTop=0,document.documentElement.scrollTop=0;var e=document.getElementById("container");e&&(e.scrollTop=0)}},{key:"_isNodeTextParent",value:function(e){return Q.every((function(t){return!e.classList.contains(t)}))}},{key:"convertElementToText",value:function(e){var t="";if("TEXTAREA"===e.nodeName)t+=e.value;else if(e.nodeType===Node.TEXT_NODE)t+=e.nodeValue;else if(this._isNodeTextParent(e))for(var n=0,r=0;r<e.childNodes.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t+=this.convertElementToText(e.childNodes[r])}return t}}]),r}(z),y()(q.prototype,"onWindowError",[Z.ZP],Object.getOwnPropertyDescriptor(q.prototype,"onWindowError"),q.prototype),y()(q.prototype,"performRepeatScrollPane",[Z.ZP],Object.getOwnPropertyDescriptor(q.prototype,"performRepeatScrollPane"),q.prototype),y()(q.prototype,"performRepeatScroll",[Z.ZP],Object.getOwnPropertyDescriptor(q.prototype,"performRepeatScroll"),q.prototype),y()(q.prototype,"preventAndStop",[Z.ZP],Object.getOwnPropertyDescriptor(q.prototype,"preventAndStop"),q.prototype),y()(q.prototype,"preventDefault",[Z.ZP],Object.getOwnPropertyDescriptor(q.prototype,"preventDefault"),q.prototype),y()(q.prototype,"stopPropagation",[Z.ZP],Object.getOwnPropertyDescriptor(q.prototype,"stopPropagation"),q.prototype),y()(q.prototype,"infLoop",[Z.ZP],Object.getOwnPropertyDescriptor(q.prototype,"infLoop"),q.prototype),q)},6315:(e,t,n)=>{"use strict";n.d(t,{Z:()=>I});n(9810);Object.values=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))};Object.entries=Object.entries||function(e){return Object.keys(e).map((function(t){return[t,e[t]]}))};var r,i=n(8855),a=n(8651),o=n(7100),s=n(9955),c=n(8478),l=n(4654),u=(n(5252),n(4575)),d=n.n(u),h=n(3913),p=n.n(h),f=n(3124),g=n.n(f),m=n(8572),v=n(6744),y=(n(4472),n(4305)),k=n(4327),_=n(7274),Z=n(2269);const w=(r=function(){function e(){d()(this,e),this.isLoaded=!1,this.isRendered=new _.Z(!1),this.isInit=!1,this.help=void 0,this.failedInitialDocLoad=new _.Z(!1),this.loadedImages={},a.Z.vmMain=this,Rollbar.configure({payload:{environment:o.Z.getDeployVar(i.Z.DeployVariable.Environment),person:{id:l.default.settings.getUserIdentifier()},client:{javascript:{source_map_enabled:!0,code_version:i.Z.jsVersion,guess_uncaught_frames:!0}}},maxItems:i.Z.__MAX_ERRORS_REPORTED,checkIgnore:a.Z.rollbarIgnoreFn}),a.Z.element("outerWrapper").addEventListener("mousemove",this.mousemove),a.Z.isDemoMode()||(this.setupPageVisibility(),a.Z.checkLowActivity()),l.default.PaneManager.onResize(),this.checkLastCodeVersion(),this.init()}return p()(e,[{key:"loadPlugins",value:function(){}},{key:"init",value:function(){try{a.Z.PAssert(2,!this.isInit,"Should never double init VMMain, may cause severe issues")}catch(e){a.Z.reportError(e)}this.isInit=!0,y.Z.init(),Z.Z.init(),this.loadPlugins(),l.default.intro.init(),k.Z.fireEvent("VMMainLoaded",[]),o.Z.demo||(window.onbeforeunload=this.onUnload),o.Z.demo&&a.Z.enableMinMode(),n(4089).Z()}},{key:"loadData",value:function(){if(a.Z.shouldLog(i.Z.LogLevels.Timing))var e=performance.now();a.Z.shouldLog(i.Z.LogLevels.Profile)&&console.profile("Load Local Data"),a.Z.checkpoint(i.Z.Checkpoint.LocalDocLoad),a.Z.shouldLog(i.Z.LogLevels.Profile)&&console.profileEnd(),a.Z.isLoaded=!0,a.Z.isDemoMode()&&setTimeout((function(){window.parent.postMessage("loaded","*")}),0),this.afterLoaded(),a.Z.shouldLog(i.Z.LogLevels.Profile)&&console.profile("Apply Bindings"),this.isRendered.set(!0),a.Z.shouldLog(i.Z.LogLevels.Profile)&&console.profileEnd(),o.Z.app&&l.default.nativeBridge.sendToApp("localLoaded"),a.Z.shouldLog(i.Z.LogLevels.Timing)&&(a.Z.log("DONE LOCALLY",performance.now()),setTimeout((function(){var t=performance.now();a.Z.log("time react:",t-e,t)}),0))}},{key:"afterLoaded",value:function(){o.Z.app&&(document.onreadystatechange=function(){l.default.nativeBridge.sendToApp("loaded")},document.onreadystatechange())}},{key:"redoLastMouseMove",value:function(){var e=this.prevMove,t={target:document.elementFromPoint(e.clientX,e.clientY),clientX:e.clientX,clientY:e.clientY};this.mousemove(t,!0)}},{key:"mousemove",value:function(e,t){if(a.Z.notifyActivity(),!(a.Z.disableMouseMove&&!e.target||l.default.PaneManager.isResizingPane||!t&&this.prevMove&&e.clientX===this.prevMove.clientX&&e.clientY===this.prevMove.clientY||l.default.DragDrop.isDragging)){var n=a.Z.ensureDOMNode(e.target);if(n)this.prevMove&&this.prevMove.target===n||(this.prevMove&&this.prevMove.target&&k.Z.fireEvent("mouseout",[{target:this.prevMove.target}]),n&&k.Z.fireEvent("mouseover",[{clientX:e.clientX,clientY:e.clientY,target:n}])),this.prevMove={clientX:e.clientX,clientY:e.clientY,target:n};else try{a.Z.PAssert(3,!n,"Target should be defined",a.Z.getElementPath(e.target))}catch(r){a.Z.reportError(r)}}}},{key:"setupPageVisibility",value:function(){var e=this;o.Z.pageVisibilityChange&&document.addEventListener(o.Z.pageVisibilityChange,(function(){o.Z.isPageVisible()?(e.updateTimeout&&(clearTimeout(e.updateTimeout),e.updateTimeout=void 0),a.Z.whenLowImpactEnd()):e.updateTimeout=setTimeout((function(){a.Z.whenLowImpactBegin()}),5e3)}))}},{key:"checkLastCodeVersion",value:function(){if(a.Z.shouldWriteLocal()){var e="versionDesktop",t=+v.Z.getValue("versionDesktop"),n=o.Z.versionCurrent;if(isNaN(t)&&(t=+v.Z.getLegacyLocalStorage(e),isNaN(t)||(v.Z.deleteLegacyLocalStorage(e),v.Z.setValue(e,n))),!a.Z.isDemoMode()&&t>0&&n>t)for(var r=0,i=o.Z.getUpdateMessages(t),s=0;s<i.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var c=i[s];a.Z.isString(c)&&l.default.toasts.pushUpdateMessage({text:c,action1Text:"BLOG",action1Click:function(){return l.default.openUrl("https://www.moo.do/blog/")}})}t!==n&&v.Z.setValue(e,n)}}},{key:"getScrollOffset",value:function(){return this.panesContainer.scrollLeft}},{key:"setScrollOffset",value:function(e,t){a.Z.scrollTo(e,0,t,this.panesContainer)}},{key:"onUnload",value:function(){a.Z.log("Unloading the page"),l.default.AppCache.skipWaiting();try{var e=a.Z.getAggregateEvents();for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];a.Z.sendEvent(n.category,n.action,n.count),n.count=0}k.Z.fireEvent("onUnload",[]),l.default.setup.isLoggingOut.get()||a.Z.UIAction("PageUnload")}catch(r){a.Z.reportError(r)}}},{key:"checkDragForScroll",value:function(e){var t=e.clientX,n=document.getElementById("panes");if(n){var r=n.scrollLeft,i=n.clientWidth,o=i-80,s=0;t<80&&r>0?s=a.Z.computeScrollSpeed(0,80,t,4,-1):t>=o&&r<n.scrollWidth-n.clientWidth&&(s=a.Z.computeScrollSpeed(o,i,t,4)),0!==s?a.Z.repeatScroll("panes",s,void 0,!0):a.Z.cancelRepeatScroll("panes")}}}]),e}(),g()(r.prototype,"mousemove",[m.ZP],Object.getOwnPropertyDescriptor(r.prototype,"mousemove"),r.prototype),g()(r.prototype,"onUnload",[m.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onUnload"),r.prototype),r);var b=n(5193),P=n(7411);var S=n(7183),D=(n(6942),n(1157).Z);const I=function(){S.Z.ensurePolyfill(void 0,E)};var E=function(){try{if(document.addEventListener("scroll",(function(e){document.documentElement.scrollLeft=0})),!o.Z.blockedReason.get()){var e=function(){o.Z.updateOrientation()};a.Z.checkpoint(i.Z.Checkpoint.RequireLoaded),a.Z.isDemoMode()||P.Z.init(),l.default.init(),b.Z.init(),window.__ERRORINMAINHEADER&&a.Z.reportError(window.__ERRORINMAINHEADER);try{a.Z.PAssert(0,-1===navigator.userAgent.indexOf("Electron")||o.Z.appPlatform===i.Z.AppPlatform.Electron,"Electron app missing app platform set")}catch(u){a.Z.reportError(u)}a.Z.checkpoint(i.Z.Checkpoint.PageLoad);try{a.Z.PAssert(1,"loading"!==document.readyState,"Should only be calling mainjs after document is loaded"+document.readyState)}catch(u){a.Z.reportError(u)}if("loading"===document.readyState){var t="ERROR: MainJS running before document load! "+document.readyState;a.Z.shouldLog(i.Z.LogLevels.Error)&&a.Z.log(t),a.Z.reportError(new Error(t))}0,a.Z.isDemoMode()||o.Z.offline||(!function(e,t,n,r,i,a,o){e.GoogleAnalyticsObject=i,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,a=t.createElement(n),o=t.getElementsByTagName(n)[0],a.async=1,a.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(a,o)}(window,document,"script",0,"ga"),ga("create","UA-37740918-2",{cookieDomain:"auto"}),ga("send","pageview")),o.Z.updateBodyClass();var n=function(e){document.documentElement.addEventListener(e,(function(e){a.Z.reportEvent(e)}),!0)};0,n("keydown"),n("keyup"),n("keypress"),n("MSPointerDown"),n("MSPointerUp"),n("MSPointerHover"),n("MSPointerCancel"),n("mousedown"),n("mouseup"),n("touchstart"),n("touchend"),l.default.AppCache.init(),e(),a.Z.shouldLog(i.Z.LogLevels.Timing)&&a.Z.log("Running main.js: ",Date.now()),window.onblur=function(){a.Z.hasFocus=!1},window.onfocus=function(){a.Z.hasFocus=!0},new w,window.addEventListener("orientationchange",e),window.addEventListener("dragstart",(function(e){return e.preventDefault(),!1})),window.addEventListener("dragover",(function(e){return e.preventDefault(),!1}));var r=!1;b.Z.loadLocal((function(e){r||(r=!0,a.Z.checkpoint(i.Z.Checkpoint.InitializeMain),function(){try{a.Z.checkpoint(i.Z.Checkpoint.OnInitializedData),a.Z.vmMain.loadData(),a.Z.shouldLog(i.Z.LogLevels.Timing)&&a.Z.log("Data done loading: ",Date.now()),a.Z.isDemoMode()||a.Z.setupDateRollover()}catch(e){a.Z.reportError(e)}}())})),!a.Z.isDemoMode()&&o.Z.app&&l.default.nativeBridge.sendToApp("loaded")}c.render(s.createElement(D,{main:a.Z.vmMain}),document.getElementById("outerWrapper"))}catch(d){console.log(d),a.Z.handleCriticalError(),a.Z.reportError(d,"Critical Error")}}},2770:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ClassNameTopBarTitle:()=>u,TopBar:()=>d,TopBarIconButton:()=>h,TopBarTextButton:()=>p,SettingsHeading:()=>f,SettingsRow:()=>m});var r=n(8855),i=n(8651),a=n(9955),o=n(386),s=n(5428),c=n(9052),l=r.Z.Mobile.TopBarHeight,u="text-15 pl-1",d=function(e){var t=e.children,n={boxShadow:(0,o.Z)().paneShadow(),height:l,minHeight:l};return a.createElement("div",{className:"flex items-center c-background z-1",style:n},t)},h=function(e){var t=e.icon,n=e.className,r=e.disabled,i=e.onPress;return a.createElement(c.Z,{className:n,icon:t,iconSize:24,width:l,height:l,disabled:r,onPress:i})},p=function(e){var t=e.text,n=e.className,r=e.mode,o=e.onPress;return a.createElement(c.Z,{className:i.Z.classNames("px-3",n),text:t,mode:r,height:l,onPress:o})},f=function(e){var t=e.text;return a.createElement("div",{className:"pt-6 pb-2 pl-4 c-foreground-light text-12"},t)},g={height:48},m=function(e){var t=e.text,n=e.children,r=e.last,o=e.icon,c=e.iconSize,l=e.onPress;return a.createElement("div",{className:i.Z.classNames("flex c-background c-foreground pl-4 pr-2 items-center c-border border-t",{"border-b":r}),style:g,onClick:l},a.createElement("div",{className:"flex items-center flex-1"},o&&a.createElement(s.J,{name:o,size:c||18,className:t?"mr-2":void 0}),t),n)}},9052:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f});var r=n(3038),i=n.n(r),a=n(8855),o=n(3470),s=n(8651),c=n(7100),l=n(9955);var u=n(3234),d=n(5428),h=n(726),p=0;const f=(0,u.Z)((function(e){var t=e.mode,n=e.className,r=e.align,u=e.color,f=e.width,g=e.height,m=e.icon,v=e.iconSize,y=e.text,k=e.disabled,_=e.padding,Z=e.notRounded,w=e.fontSize,b=e.fontWeight,P=e.style,S=e.onPress,D=e.displayBlock,I=e.primary,E=(0,l.useState)(1),x=i()(E,2),C=x[0],A=x[1],L=function(){var e=(0,l.useRef)(!1),t=(0,l.useCallback)((function(){return e.current}),[]);return(0,l.useEffect)((function(){return e.current=!0,function(){e.current=!1}})),t}(),M=(0,l.useRef)();b=b||"bold",r=r||"center";var T=c.Z.isiOS&&c.Z.majorVersion<=12,R=(0,l.useCallback)((function(e){p=Date.now(),A(m&&!y?1.2:1.06),s.Z.preventAndStop(e)}),[m,y]),O=(0,l.useCallback)((function(e){T||(S(e),s.Z.preventAndStop(e))}),[T,S]),F=(0,l.useCallback)((function(e){if(s.Z.preventAndStop(e),L()){var t=Date.now();t-p<100?setTimeout((function(){return A(1)}),100-(t-p)):A(1)}}),[]),N=s.Z.classNames("cursor-pointer box-border mobutton pointer-events-auto select-none",{"flex items-center":m},{center:"center"===r},{"origin-left":"left"===r},{rounded:!Z},{"c-bg-gray-200":"contained"===t&&!I},{"border c-border":"outlined"===t},{"items-center text-center justify-center":m&&"center"===r},{ib:!m&&!D},{"px-4":void 0===f&&void 0===_&&"center"===r},{"px-4":void 0===f&&void 0===_&&"left"===r},{"py-3":void 0===g&&void 0===_},{"opacity-50 filter-grayscale":k},{"c-button-raised-primary c-white":I&&"contained"===t},_,u||"c-foreground-light",n),B=Object.assign({width:f,height:g,lineHeight:g+"px",touchAction:"manipulation"},P),U={fontSize:v},j={fontSize:w},H=s.Z.classNames({"font-bold":"bold"===b});return T&&(0,h.Z)(M,{onTouchStart:(0,l.useCallback)((function(e){s.Z.preventAndStop(e),S(e)}),[])}),l.createElement(o.E.div,{className:N,style:B,onPointerDown:R,onClick:O,onPointerUp:F,onTouchStart:function(e){return s.Z.preventAndStop(e)},animate:{scale:C},transition:a.Z.TransitionSpringFastest,ref:M},m&&l.createElement(d.J,{name:m,size:v,className:y?"mr-2":"",style:U}),y&&l.createElement("div",{className:H,style:j},y))}))},1728:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(3038),i=n.n(r),a=n(9955),o=n(3234),s=n(3170),c=n(8133);const l=(0,o.Z)((function(e){var t=e.keyboardToolbarHeight,n=(0,s.Z)(c.o0.keyboardHeight),r=i()(n,1)[0],o=r?r+(t||0):0;return a.createElement("div",{style:{height:o,minHeight:o,maxHeight:o}})}))},3067:(e,t,n)=>{"use strict";n.d(t,{Z:()=>_});var r=n(3038),i=n.n(r),a=n(4926),o=n(8855),s=n(5172),c=n(3470),l=n(8651),u=n(7100),d=n(9955);var h=n(2971),p=n(3234),f=n(3170),g=n(4074),m=n(726),v=n(4007),y=n(1728),k=n(5802);const _=(0,p.Z)((function(e){var t=e.type,n=e.className,r=e.classNameContent,p=e.classNameContentFullscreen,_=e.styleContent,Z=e.spring,w=e.fullscreen,b=e.noFullscreen,P=e.stayFullscreenOnceFullscreened,S=e.title,D=e.noBackdrop,I=e.topBar,E=e.ignoreAndroidBack,x=e.keyboardToolbarHeight,C=e.onFullscreenChange,A=e.onClosed,L=e.children,M=(0,f.Z)(u.Z.windowSize,g.Z.keyboardHeight),T=i()(M,2),R=T[0],O=T[1],F=R.height,N=(0,s._)(),B=(0,s._)(),U=(0,d.useRef)(),j=(0,d.useRef)(),H=(0,k.Z)((0,a.Z)(U)),V=H.current,W=(0,h.Z)(null===V||void 0===V?void 0:V.height),z=(0,h.Z)(D),q=g.Z.isMenuOpen(t),G=(0,d.useRef)(F),K=(0,h.Z)(w);!b&&(V.height>=R.height||O>0)&&(w=!0),P&&(w=function(e){var t=(0,d.useRef)(e);return t.current||(t.current=e),t.current}(w)),(0,d.useEffect)((function(){w!==K&&(null===C||void 0===C||C(w))}),[w,K,C]),w&&(V.height=R.height);var Y=(0,d.useCallback)((function(){if(g.Z.isMenuOpen(t)){var e=R.height-H.current.height;e!==G.current&&(G.current=e,N.start({y:e,transition:Z||o.Z.TransitionSpring}),B.start({opacity:.5,transition:Z||o.Z.TransitionSpring}))}}),[]);(null===V||void 0===V?void 0:V.height)!==W&&g.Z.isMenuOpen(t)&&Y(),!D!==!z&&B.start({opacity:D?0:.5,transition:o.Z.TransitionSpring});var X=(0,d.useCallback)((function(){g.Z.closeMenu(t),A&&(B.start({opacity:0,transition:Z||o.Z.TransitionSpring}).then((function(){return A()})),N.start({y:F,transition:Z||o.Z.TransitionSpring}))}),[]);E||(0,v.Z)(X);var Q=(0,d.useCallback)((function(e,t){var n=H.current,r=t.offset.y-n.height;G.current=R.height-n.height+t.offset.y,N.set({y:G.current}),B.set({opacity:l.Z.clamp(-r/n.height*.5,0,.7)})}),[]),J=(0,d.useCallback)((function(e,t){Math.abs(t.offset.y)<5||t.velocity.y>50?X():Y()}),[]),$=l.Z.classNames("fancySheet absolute inset-0 c-background z-0 c-shadow-popup will-change-transform",{"rounded-t-xlg":!w},n);r=l.Z.classNames("flex flex-col max-h-full",r,w&&p);var ee={height:R.height};u.Z.isiOS&&u.Z.majorVersion<=12&&(0,m.Z)(j,{onTouchMove:(0,d.useCallback)((function(e){l.Z.preventDefault(e)}),[])});var te=l.Z.classNames("absolute inset-0 z-0 bg-black will-change-opacity backdrop",{"pointer-events-none":D});return d.createElement("div",{ref:j},d.createElement(c.E.div,{className:te,onPan:Q,onPanEnd:J,animate:B,initial:{opacity:0},exit:{opacity:0,transition:o.Z.TransitionSpringFast},onClick:X}),d.createElement(c.E.div,{className:$,style:ee,animate:N,initial:{y:F},exit:{y:F,transition:o.Z.TransitionSpringFast}},d.createElement("div",{ref:U,className:r,style:_},(w||!q&&K)&&I,S&&d.createElement("div",{className:"pt-3 pb-3 font-bold border-b center text-16 c-border"},S),L,d.createElement(y.Z,{keyboardToolbarHeight:x}))))}))},5853:(e,t,n)=>{"use strict";n.d(t,{Z:()=>k});var r,i=n(8926),a=n.n(i),o=n(4575),s=n.n(o),c=n(3913),l=n.n(c),u=n(3124),d=n.n(u),h=n(7757),p=n.n(h),f=n(7100),g=n(8572),m=n(8855),v=n(8651),y=n(180);const k=new(r=function(){function e(){var t=this;s()(this,e),this.nextID=0,this.callbacks={},this.listeners={},this.pendingMessages={},y.nw.forEach((function(e){t[e]=t.sendMessage.bind(t,e)})),y.wR.forEach((function(e){t[e]=t.addNativeListener.bind(t,e),t.pendingMessages[e]=[]})),this.isNativeApp()&&(window.ReactNativeWebViewHandler=this.onMessage,this.onAppInfo((function(e){var n=e.version,r=e.codePushVersion,i=e.featureVersion;t.appVersion=n+(r?" - ".concat(r):""),f.Z.appv=i,t.featureVersion=i})),this.initialize({clientId:m.Z.ClientID,redirectUrl:"".concat(m.Z.ClientIDReversed,":/oauth2redirect/google")}))}return l()(e,[{key:"isNativeApp",value:function(){return!!window.ReactNativeWebView}},{key:"addNativeListener",value:function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t),this.pendingMessages[e].forEach((function(e){return t(e)}))}},{key:"onMessage",value:function(e,t){var n,r,i=t.v;v.Z.isNumber(e)?(null===(n=(r=this.callbacks)[e])||void 0===n||n.call(r,i),delete this.callbacks[e]):this.listeners[e]&&this.pendingMessages[e]&&(this.listeners[e].forEach((function(e){return e(i)})),this.pendingMessages[e].push(i))}},{key:"sendMessage",value:function(){var e=a()(p().mark((function e(t){var n,r,i,a=0,o=this,s=arguments;return p().wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:n=s.length,r=new Array(n>1?n-1:0),i=1;case 1:if(!(i<n)){e.next=8;break}if(!(a++>5e3&&__infLoop&&__infLoop(a))){e.next=4;break}throw new RangeError;case 4:r[i-1]=s[i];case 5:i++,e.next=1;break;case 8:if(!this.isNativeApp()){e.next=11;break}return e.abrupt("return",new Promise((function(e){var n=o.nextID++;o.callbacks[n]=e,ReactNativeWebView.postMessage(JSON.stringify({fn:t,num:n,args:r}))})));case 11:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAppVersion",value:function(){return this.appVersion}}]),e}(),d()(r.prototype,"addNativeListener",[g.ZP],Object.getOwnPropertyDescriptor(r.prototype,"addNativeListener"),r.prototype),d()(r.prototype,"onMessage",[g.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onMessage"),r.prototype),r)},4074:(e,t,n)=>{"use strict";n.d(t,{Z:()=>E});var r,i=n(8926),a=n.n(i),o=n(4575),s=n.n(o),c=n(3913),l=n.n(c),u=n(3124),d=n.n(u),h=n(7757),p=n.n(h),f=n(4654),g=n(8572),m=n(8651),v=n(7100),y=n(9955),k=n(8478),_=n(4472),Z=n(1015),w=n(8778),b=n(7274),P=n(9148),S=n(7048),D=n(7404),I=n(5853);const E=new(r=function(){function e(){var t=this;s()(this,e),this.viewportHeights={portrait:0,landscape:0},this.menusStack=new P.Z,this.portalsStack=new P.Z,this.keyboardHeightMax=new b.Z(0),this.keyboardHeight=new b.Z(0,(function(e){t.keyboardHeightMax.set(Math.max(t.keyboardHeightMax.get(),e))})),this.portaledToolbar=new b.Z,this.isKeyboardOpen=new S.Z([this.keyboardHeight],(function(e){return e>0})),this.isHoldDown=new b.Z,this.codePushStatus=new b.Z,this.touchEventListeners={},document.addEventListener("touchstart",(function(e){if(!m.Z.findParent(e.target,"bypassPaneObjectTouch",2)){var n=m.Z.getPaneObjectForElement(e.target);if(n){var r,i=n.id,a=e.touches[0].clientX,o=e.touches[0].clientY,s={x:a,y:o,clientX:a,clientY:o,diffX:0,diffY:0,distanceX:0,distanceY:0};if(!1!==(null===(r=t.touchEventListeners[i])||void 0===r?void 0:r.onTouchStart(s,e))&&!e.defaultPrevented)var c=D.Z.onTouchMoveEnd({ev:e,onMove:function(e,n){var r;null===(r=t.touchEventListeners[i])||void 0===r||r.onTouchMove(e,n,c)},onUp:function(e,n){var r;null===(r=t.touchEventListeners[i])||void 0===r||r.onTouchEnd(e,n,c)},active:!0})}}}),{passive:!1}),I.Z.onShake(a()(p().mark((function e(){return p().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,t.confirm("Undo typing?");case 2:e.sent&&Z.Z.undo();case 4:case"end":return e.stop()}}}),e)})))),I.Z.onCodePushStatus((function(e){t.codePushStatus.set(e)}))}return l()(e,[{key:"init",value:function(){var e=this;f.default.settings.emailViewAccounts.listen((function(e){I.Z.setEmailAccounts(e)}),!0),I.Z.onKeyboardChange(this.onKeyboardChange),I.Z.isNativeApp()||(window.visualViewport?(window.visualViewport.addEventListener("resize",this.onViewportResize),this.onViewportResize()):v.Z.isiOS&&document.addEventListener("selectionchange",(function(){var t,n=!(null===(t=window.getSelection())||void 0===t||!t.focusNode);_.Z.isKeyboardOpen=n,e.setKeyboardHeight(n?260:0),v.Z.majorVersion<=12&&n&&(document.body.scrollTop=0)})))}},{key:"onViewportResize",value:function(){var e;if(v.Z.isiOS&&window.visualViewport){var t=window.visualViewport,n=t.height,r=t.offsetTop,i=window.innerHeight-n+r;i>200?(_.Z.isKeyboardOpen=!0,e=i):(_.Z.isKeyboardOpen=!1,e=0)}else if(v.Z.isAndroid){var a=screen,o=a.width<a.height?"portrait":"landscape",s=window.innerHeight,c=Math.max(s,this.viewportHeights[o]);this.viewportHeights[o]=c,e=c-s>200?1:0}_.Z.isKeyboardOpen=e>0,_.Z.isKeyboardOpen||_.Z.reset(),this.setKeyboardHeight(e)}},{key:"onKeyboardChange",value:function(e){var t=e.isOpen,n=e.height;t||_.Z.reset(),_.Z.isKeyboardOpen=t,this.setKeyboardHeight(t?n:0)}},{key:"setKeyboardHeight",value:function(e){this.keyboardHeight.set(e),w.Z.hide()}},{key:"openMenu",value:function(e){this.menusStack.some((function(t){return t.type===e.type}))||this.menusStack.push(e)}},{key:"closeMenu",value:function(e){this.menusStack.remove((function(t){return t.type===e}))}},{key:"isMenuOpen",value:function(e){return"inline"===e||(e?this.menusStack.find((function(t){return t.type===e})):this.menusStack.length()>0)}},{key:"openActionSheet",value:function(e){this.openMenu(Object.assign({type:"ActionSheet"},e))}},{key:"KeyboardToolbarPortal",value:function(e){var t=this,n=e.children,r=(0,y.useMemo)((function(){return document.createElement("div")}),[]);return(0,y.useEffect)((function(){return t.portaledToolbar.set(r),function(){t.portaledToolbar.set(void 0)}}),[]),(0,k.createPortal)(n,r)}},{key:"setTouchEventListeners",value:function(e,t){this.touchEventListeners[e]=t}},{key:"confirm",value:function(){var e=a()(p().mark((function e(t){var n=this;return p().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){n.openMenu({type:"Confirm",text:t,callback:function(t){return e(t)}})})));case 1:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"alert",value:function(){var e=a()(p().mark((function e(t){var n=this;return p().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){n.openMenu({type:"Alert",text:t,callback:function(t){return e(t)}})})));case 1:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMaxKeyboardHeight",value:function(){return this.keyboardHeightMax.get()||(v.Z.isiOS?300:340)}}]),e}(),d()(r.prototype,"onViewportResize",[g.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onViewportResize"),r.prototype),d()(r.prototype,"onKeyboardChange",[g.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onKeyboardChange"),r.prototype),d()(r.prototype,"KeyboardToolbarPortal",[g.ZP],Object.getOwnPropertyDescriptor(r.prototype,"KeyboardToolbarPortal"),r.prototype),r)},4856:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var r,i=n(4575),a=n.n(i),o=n(3913),s=n.n(o),c=n(3124),l=n.n(c),u=n(4472),d=n(8572),h=n(4654),p=n(8855),f=n(9148),g=n(7274);const m=new(r=function(){function e(){a()(this,e)}return s()(e,[{key:"init",value:function(){this.panesInView=new f.Z,this.previewOpenOnPane=new g.Z,h.default.PaneManager.displayPanes.listen(this.onPanesChange)}},{key:"onPanesChange",value:function(e){if(e.length>0)if(0===this.panesInView.length()){var t,n,r=h.default.settings.panesInViewMobile.get();if(r&&(n=r.filter((function(e){return h.default.PaneManager.hasPaneById(e)})).map((function(e){return{type:"pane",pane:h.default.PaneManager.getPaneById(e)}}))),(null===(t=n)||void 0===t?void 0:t.length)>0)u.Z.setFocusedPane(n[0].pane),this.panesInView.set(n);else{var i=e.find((function(e){return"pane"===e.type&&e.pane.type===p.Z.PaneMode.Task}));this.setPanesInView([i])}}else{var a=e.find((function(e){return"emailPreview"===e.type}));this.previewOpenOnPane.set(null===a||void 0===a?void 0:a.pane)}}},{key:"setPanesInView",value:function(e){this.panesInView.set(e),u.Z.setFocusedPane(e[0].pane),h.default.settings.panesInViewMobile.set(e.map((function(e){return e.pane.id})))}}]),e}(),l()(r.prototype,"onPanesChange",[d.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onPanesChange"),r.prototype),r)},5024:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>_});var r=n(7154),i=n.n(r),a=n(3038),o=n.n(a),s=n(6479),c=n.n(s),l=n(9955),u=n(3234),d=n(4074),h=n(3067),p=n(8651),f=n(5428),g={height:48,lineHeight:"48px"};const m=(0,u.Z)((function(e){var t=e.icon,n=e.iconSize,r=e.text,i=e.last,a=e.onPress,o=p.Z.classNames("pl-4 flex items-center",{"border-b c-border-light":!i});return l.createElement("div",{className:o,style:g,onClick:a},t&&l.createElement(f.J,{className:"mr-4",name:t,size:n||18}),""===t&&l.createElement("div",{className:"mr-4",style:{width:18}}),r)}));var v=n(7100),y=n(3170),k=["type","items","selected","showCheckboxes","maxHeight"];const _=(0,u.Z)((function(e){var t=e.type,n=e.items,r=e.selected,a=e.showCheckboxes,s=e.maxHeight,u=c()(e,k),p=(0,y.Z)(v.Z.windowSize),f=o()(p,1)[0],g={maxHeight:s?f.height*s:void 0};return l.createElement(h.Z,i()({type:t},u,{classNameContent:"flex flex-col",styleContent:g}),l.createElement("div",{className:"flex-1 overflow-y-auto"},n.map((function(e,i){var o=e.text,s=e.icon,c=e.onPress;return l.createElement(m,{key:o,icon:s||(a?r===o?"MdCheck":"":void 0),text:o,onPress:function(){d.Z.closeMenu(t),c()},last:i===n.length-1})}))))}))},8623:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});var r=n(3038),i=n.n(r),a=n(3470),o=n(8855),s=n(8651),c=n(9955),l=n(3234),u=n(3170),d=n(4472),h=n(9052),p=n(4654),f=[];document.addEventListener("touchmove",(function(e){if(p.default.DragDrop.dragging.get()){var t=e.touches[0],n=t.clientX,r=t.clientY,i=document.elementFromPoint(n,r),a=i&&f.find((function(e){return s.Z.isAncestor(i,e.el)}));f.forEach((function(e){var t=e===a;e.isHovered!==t&&(e.isHovered=t,e.setHovered(t))}))}})),document.addEventListener("touchend",(function(){p.default.DragDrop.dragging.get()&&f.forEach((function(e){var t;e.isHovered&&(e.setHovered(!1),null===(t=e.onUp)||void 0===t||t.call(e))}))}),{capture:!0});const g=(0,l.Z)((function(e){var t=e.role,n=e.text,r=e.onPress,l=e.onUp;(0,u.Z)(d.Z.selectedMapObs);var p=d.Z.isInMobileMultiselect(),g=function(e){var t=(0,c.useState)(!1),n=i()(t,2),r=n[0],a=n[1],o=(0,c.useRef)(null);return(0,c.useEffect)((function(){var t=o.current;if(t){var n={el:t,setHovered:a,onUp:e};return f.push(n),function(){f.remove(n)}}}),[o.current]),[o,r]}(l),k=i()(g,2),_=k[0],Z=k[1],w="add"===t?"MdAdd":"MdContentPaste",b="add"===t?v:y,P={scale:"add"!==t?Z?1.2:1:void 0};return!("add"===t&&p)&&c.createElement(a.E.div,{className:"absolute fab",ref:_,style:b,animate:P,transition:o.Z.TransitionSpring},c.createElement(h.Z,{icon:w,iconSize:24,className:s.Z.classNames("flex items-center justify-center rounded-full fab c-button-raised-primary c-shadow-popup",t),onPress:r,style:m,text:n}))}));var m={minWidth:56,height:56},v={right:16,bottom:16},y={left:16,bottom:16+o.Z.Mobile.BottomBarHeight}},1157:(e,t,n)=>{"use strict";n.d(t,{Z:()=>En});var r=n(3038),i=n.n(r),a=n(8651),o=n(9955),s=n(4654),c=n(5097),l=n(8855),u=n(5172),d=n(3470),h=n(3869),p=n(8133),f=n(3234),g=n(7077),m=n(3170);const v=(0,f.Z)((function(){var e=s.default.DragDrop,t=(0,m.Z)(e.dragging,e.dropSucceeded,s.default.dropBucket.items),r=i()(t,3),a=r[0],c=(r[1],r[2]),f=!(null===a||void 0===a||!a.items),v=(0,u._)(),y=(0,u._)();(0,g.Z)(e.draggingPosition,(function(t){if(t){var n=t.x,r=t.y,i=e.dragging.get().positionOffset;y.set({x:n-i.x,y:r-i.y})}})),(0,g.Z)(e.linePosition,(function(e){if(e){var t=e.left,n=e.top,r=e.width,i=e.height;v.set({x:t,y:n,width:r,height:i||4,borderWidth:i?3:0,backgroundColor:i?null:l.Z.ColorBrand,opacity:1})}else v.set({opacity:0})}));var k=(0,o.useMemo)((function(){return null===a||void 0===a?void 0:a.items.map((function(e){return e.element}))}),[null===a||void 0===a?void 0:a.items]),_=null,Z=null,w=null,b=(0,o.useCallback)((function(){var t=e.dragging.get(),n=t.pane,r=t.items;null===r||void 0===r||r.forEach((function(e){s.default.dropBucket.addItemEntry(e.item,n)}))}),[]),P=(0,o.useCallback)((function(){p.o0.openMenu({type:"DropBucket"})}),[]);if(f||c.length>0){var S=n(8623).Z;w=o.createElement(S,{role:"dropBucket",onPress:P,onUp:b,text:f?"Clipboard":c.length?c.length:void 0})}if(f){var D=a.width,I=(a.positionOffset,{width:D}),E={transition:{duration:0}};_=o.createElement(d.E.div,{key:"dragging",className:"fixed z-10 opacity-75 pointer-events-none select-none dragging fontPane c-background c-shadow-popup",style:I,exit:E,animate:y},k),Z=o.createElement(d.E.div,{key:"dragLine",id:"dragLine",animate:v})}return o.createElement(o.Fragment,null,o.createElement(h.M,null,_),w,Z)}));var y=n(8926),k=n.n(y),_=n(7154),Z=n.n(_),w=n(6479),b=n.n(w),P=n(7757),S=n.n(P),D=n(7411),I=n(7100),E=n(9647),x=n(1319),C=n(386),A=n(5428),L=n(1728),M=["className"],T=["className"],R=function(e){var t=e.className,n=b()(e,M);return o.createElement(E.Z,Z()({iconSize:18,className:a.Z.classNames("mx-auto c-shadow-medium pl-4",t),iconPadding:"pr-4",mode:"contained",width:210,height:40,styleText:{width:140,textAlign:"left"},align:"left"},n))},O=function(e){var t=e.className,n=b()(e,T);return o.createElement(E.Z,Z()({iconSize:18,className:a.Z.classNames("mx-auto shadow-lg",t),mode:"contained",width:180,height:40},n))};const F=(0,f.Z)((function(){var e,t=(0,o.useRef)(),n=(0,o.useRef)(),r=(0,o.useRef)(),c=s.default.setup,l=(0,m.Z)(c.popupClosedError,c.loggedOutByAuthFailure),u=i()(l,2),d=u[0],h=u[1],p=(0,C.Z)().theme,f=(0,o.useState)(!1),g=i()(f,2),v=g[0],y=g[1],_=(0,o.useState)(!1),Z=i()(_,2),w=Z[0],b=Z[1],P=(0,o.useState)(),A=i()(P,2),M=A[0],T=A[1],F=(0,o.useState)(!1),N=i()(F,2),B=N[0],U=N[1],j=I.Z.isiOS&&I.Z.app&&I.Z.majorVersion>=13,H=function(){var e=k()(S().mark((function e(){var r,i;return S().wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(r=t.current.getValue(),i=n.current.getValue(),r&&a.Z.isEmail(r)){e.next=6;break}T("Invalid email address."),e.next=14;break;case 6:if(i){e.next=10;break}T("Invalid password."),e.next=14;break;case 10:return U("email"),e.next=13,D.Z.signInWithEmail(r,i);case 13:U(!1);case 14:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=k()(S().mark((function e(){var n;return S().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if((n=t.current.getValue())&&a.Z.isEmail(n)){e.next=5;break}T("Invalid email address."),e.next=14;break;case 5:return T(""),e.next=8,s.default.menus.confirm("Would you like to receive an email to reset your password?");case 8:if(!e.sent){e.next=14;break}return e.next=12,D.Z.sendResetEmail(n);case 12:e.sent&&s.default.menus.alert({text:"Password reset email sent."});case 14:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=k()(S().mark((function e(){return S().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return U("google"),e.next=3,D.Z.signInWithGoogle();case 3:U(!1);case 4:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=k()(S().mark((function e(){return S().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return U("apple"),e.next=3,D.Z.signInWithApple();case 3:U(!1);case 4:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}(),q=d?o.createElement(o.Fragment,null,o.createElement("div",{className:"popupClosedError red center"},d.message),d.message2&&o.createElement("div",{className:"popupClosedError"},d.message2),d.learnMore&&o.createElement("div",{className:"popupClosedError"},o.createElement("a",{target:"_blank",href:d.learnMore},"Learn more"))):M&&o.createElement("div",{className:"popupClosedError red center"},M);return e=v?o.createElement("div",{className:"pt-2 pb-8"},o.createElement("div",{className:"flex items-center pb-6 font-medium text-20"},o.createElement(E.Z,{icon:"IoIosArrowBack",onClick:function(){return y(!1)}}),w?"Sign up with email":"Sign in with email"),o.createElement("div",{className:"px-4"},o.createElement(x.Z,{floatingText:"Email address",height:48,fontSize:15,focused:!0,type:"email",autoComplete:"username",ref:t}),o.createElement(x.Z,{floatingText:"Password",height:48,type:"password",className:"mt-2",fontSize:15,onEnter:H,ref:n}),w&&o.createElement(x.Z,{floatingText:"Confirm Password",height:48,type:"password",className:"mt-2",fontSize:15,onEnter:H,ref:r}),o.createElement("div",{className:"px-2 py-6 text-right cursor-pointer",onClick:V},o.createElement("a",{className:"font-medium link c-blue"},"Forgot Your Password?")),q,o.createElement(O,{text:B?"Signing in...":w?"Sign up":"Login",className:"mx-auto mt-4 mb-6 font-bold",primary:!0,onClick:w?function(){var e=t.current.getValue(),i=n.current.getValue(),o=r.current.getValue();e&&a.Z.isEmail(e)?i?i.length<5?T("Please use a longer password."):o&&i===o?(T(""),D.Z.createUserWithEmailAndPassword(e,i)):T("Passwords do not match."):T("Invalid password."):T("Invalid email address.")}:H}),o.createElement("div",{className:"textInLine c-background"},o.createElement("div",null,"or")),o.createElement(O,{text:w?"Login":"Sign up",className:"mx-auto mt-6 font-bold",onClick:w?function(){return b(!1)}:function(){return b(!0)}}),o.createElement(L.Z,null))):o.createElement("div",{className:"px-4 py-8"},o.createElement("div",{id:"setupLogo",className:a.Z.classNames(p,"mx-auto mb-10")},!1),o.createElement(R,{iconSrc:"/img/google.svg",text:"google"===B?"Signing in...":"Sign in with Google",className:"mx-auto mt-4 font-bold c-bg-white",style:{color:"light"===p?"#555":"#000"},onClick:W}),j&&o.createElement(R,{icon:"FaApple",text:"apple"===B?"Signing in...":"Sign in with Apple",className:"mx-auto mt-6 font-bold",style:{backgroundColor:"light"===p?"#000":"#fff",color:"light"===p?"#fff":"#000"},onClick:z}),o.createElement(R,{icon:"MdEmail",text:"Sign in with email",className:"mx-auto mt-6 font-bold",primary:!0,onClick:function(){return y(!0)}}),q,h&&o.createElement("div",{className:"popupClosedError"},"Logged out due to an error connecting to Google. If you are using a privacy plugin such as Ghostery or Privacy Badger, please disable them or download the app below."),c.showDownload&&o.createElement(o.Fragment,null,o.createElement("div",{className:"py-8 textInLine c-background"},o.createElement("div",null,"or")),o.createElement("div",{id:"setupDownloadArea"},o.createElement(R,{icon:I.Z.getPlatformIcon(),text:"Download App",className:"mx-auto font-bold",color:"c-foreground-white",style:{backgroundColor:"#2a2a2a"},onClick:function(){return s.default.openUrl(I.Z.getAppDownloadURL())}}))),!(I.Z.isiOS&&I.Z.app)&&o.createElement("div",{className:"mt-8 text-sm c-foreground center"},"Learn more at ",o.createElement("a",{href:"https://www.moo.do",className:"cursor-pointer link c-blue-dark",onClick:function(e){a.Z.preventAndStop(e),s.default.openUrl("https://www.moo.do")}},o.createElement("b",null,"https://moo.do")))),o.createElement("div",{className:a.Z.classNames("absolute inset-0 z-0 flex flex-col justify-center c-bg-app items-center app-drag",{"px-3":!0})},!1,o.createElement("div",{className:"max-w-full",style:{width:380}},o.createElement("div",{className:"rounded-lg c-background c-foreground c-shadow-medium"},e)))}));var N=n(8373);const B=(0,f.Z)((function(e){var t=e.toast,n=e.paneToast;t||(t=n);var r=(0,m.Z)(t.text),s=i()(r,1)[0],c=!!t.actionText,l=a.Z.classNames("toast c-darkPopup noSelect rounded",{hasAction:c},{big:t.isBig});return o.createElement("div",{className:l,style:undefined,onClick:t.onTapIgnore},!t.noClose&&o.createElement(N.Z,{width:40,height:40,icon:"icon-close",className:"messageClose",onClick:t.onTapIgnore&&t.onTapIgnore}),o.createElement("span",{className:a.Z.classNames("messageText f1",{"pl-4":t.noClose}),dangerouslySetInnerHTML:{__html:s}}),o.createElement(N.Z,{primary:!0,className:"messageAction noShrink",onClick:t.doAction},t.actionText),t.action2&&o.createElement(N.Z,{primary:!0,className:"messageAction noShrink",onClick:function(e){t.action2.action(),a.Z.stopPropagation(e)}},t.action2.text))})),U=(0,f.Z)((function(){var e=(0,m.Z)(s.default.toasts.queue),t=i()(e,1)[0];return o.createElement("div",{id:"toasts",className:"absolute inset-x-0 bottom-0 mb-4 pointer-events-none"},t.map((function(e){return o.createElement(B,{key:e.id,toast:e})})))}));var j=n(4327),H=n(9355),V=n(9603),W=n(4575),z=n.n(W),q=n(3913),G=n.n(q),K=n(2205),Y=n.n(K),X=n(8585),Q=n.n(X),J=n(9754),$=n.n(J),ee=n(7691),te=n(1095),ne=n(404);const re=function(e,t){var n=(0,o.useRef)();(0,o.useEffect)((function(){n.current=e}),[e]),(0,o.useEffect)((function(){if(null!==t){var e=setInterval((function(){return n.current.apply(n,arguments)}),t);return function(){return clearInterval(e)}}}),[t])};const ie=(0,f.Z)((function(e){var t=e.blockHeight,n=function(){var e=new Date,t=(0,o.useState)(e),n=i()(t,2),r=n[0],a=n[1],s=1e3*(60-e.getSeconds());return re((function(){a(new Date)}),s),r}(),r={top:Math.floor((n.getHours()+n.getMinutes()/60)*t)};return o.createElement("div",{className:"calendarDayTimeLineWrap absolute w-full inset-x-0 pointer-events-none",style:r},o.createElement("div",{className:"calendarDayTimeLineTime absolute w-20 text-right font-bold"},o.createElement("div",{className:"relative inline-block",style:{paddingLeft:"0.4rem",paddingTop:"0.125rem",paddingBottom:"0.125rem",marginTop:"-0.125rem"}},o.createElement("div",{className:"c-background opacity-75 absFull rounded"}),o.createElement("div",{className:"relative"},s.default.International.formatDate(n,l.Z.DFormat.ShortTime)))),o.createElement("div",{className:"calendarDayTimeCircle absolute"}),o.createElement("div",{className:"calendarDayTimeLine"}))}));function ae(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=$()(e);if(t){var i=$()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Q()(this,n)}}const oe=function(e){Y()(n,e);var t=ae(n);function n(){return z()(this,n),t.apply(this,arguments)}return G()(n,[{key:"init",value:function(){this.createObservables({hoveredTime:void 0,hoveredDuration:void 0,resizingPlacement:void 0}),this.listenToDispatcher("dateChanged"),this.listenToDispatcher("endDrag")}},{key:"arePropsEqual",value:function(e,t,n){return"items"===e?t===n||t&&n&&t.length===n.length:"date"===e?t===n||t&&n&&t.equals(n):void 0}},{key:"areStatesEqual",value:function(e,t,n){if("items"===e){var r=0;if(!t||!n||t.length!==n.length)return!1;for(var i=0;i<t.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(!t[i].date||!n[i].date||!t[i].date.equals(n[i].date)||t[i].item!==n[i].item||t[i].duration!==n[i].duration)return!1}return!0}}},{key:"componentWillReceiveProps",value:function(e){(!e.date.equals(this.props.date)||e.items!==this.props.items&&(e.items.length>0||this.props.items.length>0))&&this.updateState(e)}},{key:"getState",value:function(e){var t={isToday:V.Z.isToday(e.date),numAllDay:e.pane.numAllDay};if(t.heightHeader=e.pane.getHeightAllDay(),e.items){var n=0;t.items=[];for(var r=0;r<e.items.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=e.items[r];if(!i.isNote()){var a=i.getNextDate(this.props.date);if(a){var o=a.clone();t.items.push({date:o,duration:i.getDuration(),item:i})}}}}return t}},{key:"onMount",value:function(){this.state.isToday&&this.runTimeTimer()}},{key:"onUnmount",value:function(){clearTimeout(this.timeTimeout)}},{key:"componentDidUpdate",value:function(e){this.props.date.equals(e.date)||(this.hoveredDuration.set(void 0,!1),this.hoveredTime.set(void 0))}},{key:"onBeforeChanged",value:function(e,t){return e.isToday?this.runTimeTimer():t.isToday&&!e.isToday&&clearTimeout(this.timeTimeout),void 0===t.hoveredTime||s.default.DragDrop.isDragging||this.resizing||(this.hoveredTime.set(void 0,!1),this.hoveredDuration.set(void 0,!1),e.hoveredTime=void 0,e.hoveredDuration=void 0),e}},{key:"runTimeTimer",value:function(){clearTimeout(this.timeTimeout),this.timeTimeout=setTimeout(this.updateState,3e5)}},{key:"resetHovered",value:function(){this.resizing&&(this.resizing.component&&this.resizing.component.stopResizing(),this.resizing=void 0,this.resizingPlacement.set(void 0),s.default.DesktopUI.cursor.set(void 0)),this.mouseDownAtTime=void 0,this.hoveredDuration.set(void 0,!1),this.hoveredTime.set(void 0)}},{key:"onMouseUp",value:function(e){if(document.removeEventListener("mouseup",this.onMouseUp),this.resizing&&this.resizing.placeholder)this.addTime(this.hoveredTime.get(),this.hoveredDuration.get(),e);else{if(this.resizing&&this.state.resizingPlacement){var t=Object.assign({isDate:!0},this.state.resizingPlacement);s.default.PaneUpdateBatcher.beginUpdateItems();var n=this.props.pane;n.applyDropOnBlock(t,[this.resizing.item],n),s.default.PaneUpdateBatcher.commitUpdateItems()}this.resetHovered()}}},{key:"onMouseLeave",value:function(){this.resizing||this.resetHovered()}},{key:"getTimeFromMouseEvent",value:function(e){var t=e.clientY;return s.default.DragDrop.isDragging&&s.default.DragDrop.startPane&&s.default.DragDrop.startPane.isViewDates()&&s.default.DragDrop.startInfo&&(t+=12-(s.default.DragDrop.startInfo.y-s.default.DragDrop.position.top)),t-=a.Z.findParent(e.target,"calendarDayTimes").getBoundingClientRect().top,Math.floor(t/(l.Z.CalendarDayViewBlockHeight+1)*4)/4}},{key:"onMouseDown",value:function(e){document.addEventListener("mouseup",this.onMouseUp),a.Z.hasClass(e.target,"calendarDayTimes")&&(this.mouseDownAtTime=this.getTimeFromMouseEvent(e)),e.preventDefault()}},{key:"onMouseMove",value:function(e){if(void 0!==this.mouseDownAtTime&&(this.resizing={placeholder:!0,pivot:this.mouseDownAtTime},this.mouseDownAtTime=void 0),s.default.DragDrop.isDragging||s.default.DragDrop.dragging.get()){var t=this.getTimeFromMouseEvent(e);if(!isNaN(t)){var n=1,r=s.default.DragDrop.dragItem;r&&r.getDuration()&&(n=r.getDuration()/l.Z.MSPerHour),this.hoveredDuration.set(n,!1),this.hoveredTime.set(t);var i=this.props.date.clone();i.setHours(Math.floor(t)),i.setMinutes(60*(t-Math.floor(t))),0===t&&i.setMilliseconds(1),s.default.DragDrop.setBlockTarget({pane:this.props.pane,date:i,dateTime:i,duration:1!==n?n*l.Z.MSPerHour:null,isDate:!0})}}else if(this.resizing){var a=this.getTimeFromMouseEvent(e);if(!isNaN(a)){var o=this.resizing,c=o.pivot,u=a>=c?c:a,d=Math.floor(4*(a>=c?a-c+.5:c-a))/4;if(!isNaN(u)&&d>=.25)if(o.item){var h=this.props.date.clone();h.setHours(Math.floor(u)),h.setMinutes(Math.round(60*(u-Math.floor(u)))),0===u&&h.setMilliseconds(1),this.resizingPlacement.set({date:h,duration:d*l.Z.MSPerHour})}else o.placeholder&&(d===this.hoveredDuration.get()&&u===this.hoveredTime.get()||(this.hoveredDuration.set(d,!1),this.hoveredTime.set(u,!0)))}}}},{key:"onMouseEnterAllDay",value:function(){if(s.default.DragDrop.isDragging){var e=this.props.date;this.hoveredDuration.set(1,!1),this.hoveredTime.set(-1),s.default.DragDrop.setBlockTarget({pane:this.props.pane,date:e,isDate:!0,allDay:!0})}}},{key:"onDoubleClickTimes",value:function(e){var t=this.getTimeFromMouseEvent(e);this.addTime(t,1,e)}},{key:"addTime",value:function(e,t,n){var r=this.props,i=r.pane,a=r.date.clone(),o=i.item.get();e&&(a=a.addHours(e));var s=new te.Z(a,{duration:t*l.Z.MSPerHour});i.openItemEditor({element:n.target,text:" "+l.Z.CharDate,parent:o,selectIndex:0,mooDate:s,pos:{left:n.clientX,top:n.clientY},addOnSave:!0,onClosed:this.resetHovered})}},{key:"onItemResizeStart",value:function(e,t,n){if(e.hasTime()){var r=e.getTimeOfDay(),i=e.getDuration()/l.Z.MSPerHour||1,o=a.Z.round(r/l.Z.MSPerHour,4),c=n?o:o+i;return this.resizing={item:e,component:t,pivot:c},s.default.DesktopUI.cursor.set("row-resize"),!0}}},{key:"addToDay",value:function(e,t,n,r){e.push({t:t,dur:n,item:r,top:t,bottom:t+n,obj:r})}},{key:"packItems",value:function(e){var t=0;e=e.sort((function(e,t){return e.top<t.top?-1:e.top>t.top?1:e.bottom<t.bottom?-1:e.bottom>t.bottom?1:0}));for(var n=[],r=[],i=null,a=0;a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=e[a];if(o.isPlaceholder)r=r.concat.apply(r,this.packEvents([[o]]));else{var s=0;null!==i&&o.top>=i&&(this.packEvents(n),r=r.concat.apply(r,n),n=[],i=null);for(var c=!1,l=0;l<n.length;l++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var u=n[l];if(!this.collidesWith(u[u.length-1],o)){u.push(o),c=!0;break}}c||n.push([o]),(null===i||o.bottom>i)&&(i=o.bottom)}}return n.length>0&&(this.packEvents(n),r=r.concat.apply(r,n)),r}},{key:"packEvents",value:function(e){for(var t=0,n=e.length,r=0;r<n;r++){var i=0;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;for(var a=e[r],o=0;o<a.length;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=a[o],c=this.expandEvent(s,r,e);s.pos=r/n*100,s.width=100*c/n}}return e}},{key:"collidesWith",value:function(e,t){return e.bottom>t.top&&e.top<t.bottom}},{key:"expandEvent",value:function(e,t,n){for(var r=0,i=1,a=t+1;a<n.length;a++){var o=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var s=n[a],c=0;c<s.length;c++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l=s[c];if(this.collidesWith(e,l))return i}i++}return i}},{key:"renderItems",value:function(){for(var e=0,t=this.props,n=this.state,r=n.resizingPlacement,i=t.pane,s=n.items,c=[],u=n.hoveredTime,d=n.hoveredDuration,h=0;h<s.length;h++){var p;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var f=s[h].item,g=(null===(p=this.resizing)||void 0===p?void 0:p.item)===f&&n.resizingPlacement?i.getDatePlacementOnDate(r.date,r.duration):i.getItemPlacementOnDate(f,t.date);g&&this.addToDay(c,g.time,g.duration,f)}isNaN(u)||isNaN(d)||c.push({t:u,dur:d,top:u,bottom:u+d,isPlaceholder:!0});var m,v=this.packItems(c);if(v.length){var y=0;m=[];for(var k=0;k<v.length;k++){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;var _=v[k],Z=_.isPlaceholder,w={height:_.dur*l.Z.CalendarDayViewBlockHeight+Math.ceil(_.dur)-1,left:Z?0:_.pos+"%",width:Z?"95%":_.width+"%",top:Math.floor(_.t*(l.Z.CalendarDayViewBlockHeight+1))},b=a.Z.classNames("dayTimeBlock abs",{placeholder:Z});m.push(o.createElement("div",{className:b,key:Z?"placeholder":_.item.id,style:w},_.item&&o.createElement(ee.Z,{className:"itemInCalendar itemInCalendarResizable",item:_.item,pane:i,coloredInCalendar:!0,showPriority:!0,resizable:!0,allowDrag:!0,onItemResizeStart:this.onItemResizeStart,editOnClick:!0})))}}return m}},{key:"renderItemsAllDay",value:function(){for(var e=0,t=this.props,n=this.state,r=n.items,i=t.pane,a=[],s=n.hoveredTime,c={},l=0;l<r.length;l++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var u=r[l].item;t.pane.getItemPlacementOnDate(u,t.date)||a.push(o.createElement("div",{className:"dayTimeBlock",key:u.id,style:c},o.createElement(ee.Z,{className:"itemInCalendar",item:u,pane:i,coloredInCalendar:!0,showPriority:!0,resizable:!0,allowDrag:!0,onItemResizeStart:this.onItemResizeStart,editOnClick:!0})))}return!isNaN(s)&&s<0&&a.push(o.createElement("div",{className:"dayTimeBlock placeholder",key:"placeholder"})),a}},{key:"render",value:function(){var e,t=this.props,n=this.state,r=t.date,i=0===r.getDay()||6===r.getDay(),s=this.renderItemsAllDay();n.isToday&&(e=o.createElement(ie,{blockHeight:l.Z.CalendarDayViewBlockHeight+1}));var c,u={width:t.width,left:t.style.left},d={top:n.heightHeader+30+3,height:t.height-n.heightHeader,width:t.width,left:t.style.left},h={height:n.heightHeader,minHeight:n.heightHeader},p=a.Z.classNames("allDay c-border-heavy f1 preventScrollPropagate",{"c-bg-faded weekend":i}),f=a.Z.classNames("calendarDayTimes c-border-heavy",{"c-bg-faded":i}),g=a.Z.classNames("calendarDay",{"weekend c-bg-faded":i},{today:n.isToday},{resizing:!!n.resizingPlacement},t.className),m=t.width<110;return r.getYear()!==V.Z.getToday().getYear()&&(c=r.toString(", yyyy")),o.createElement("div",{className:g},o.createElement("div",{className:"calendarDayHeader c-background c-border-heavy flexbox flexvert",style:u},o.createElement("div",{className:"dayTitle"},o.createElement("span",null,r.toString(m?"MMM ":"ddd MMM ")),o.createElement("span",{className:"dayTitleDay"},r.getDate()),c&&o.createElement("span",null,c)),o.createElement("ul",{className:p,style:h,onMouseEnter:this.onMouseEnterAllDay,onDoubleClick:this.addTime.bind(this,void 0,void 0),onMouseLeave:this.onMouseLeave},s)),o.createElement("div",{className:f,style:d,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onDoubleClick:this.onDoubleClickTimes,onMouseLeave:this.onMouseLeave},o.createElement("div",{className:"calendarDayGradient"}),o.createElement("div",{className:"calendarDayItems"},this.renderItems()),e))}}]),n}(ne.a),se=(0,f.c)((0,o.forwardRef)((function(e,t){var n=0,r=e.pane,s=e.height,c=e.showAllDay,l=(0,o.useRef)(),u=(0,m.Z)(r.numAllDay),d=(i()(u,1)[0],r.getHeightAllDay());(0,o.useImperativeHandle)(t,(function(){return{scrollTo:function(e){return a.Z.scrollElementTo(l.current,{top:e})}}}));for(var h={height:s},p={height:d+2},f={top:d+30+2},g=[],v=0;v<24;v++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var y=void 0;12===v?y="Noon":(y=0===v?12:v%12,y+=" "+(v>=12?"pm":"am")),g.push(o.createElement("div",{key:v,className:"time"},y))}return o.createElement("div",{className:"inset-y-0 calendarTimes inset-l-0 c-background",style:h},o.createElement("div",{className:"calendarTimesInner hideScrollbar c-border-heavy pb-80",style:f,ref:l},g),c&&o.createElement("div",{className:"calendarTimesAllDay c-border-heavy",style:p},"All day"))})));function ce(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=$()(e);if(t){var i=$()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Q()(this,n)}}const le=function(e){Y()(n,e);var t=ce(n);function n(){return z()(this,n),t.apply(this,arguments)}return G()(n,[{key:"init",value:function(){j.Z.listen("endDrag",this.onDragEnd),this.createObservables({isHovered:!1}),this.listenToDispatcher("dateChanged")}},{key:"arePropsEqual",value:function(e,t,n){return"items"===e?t===n||t&&n&&t.length===n.length:"date"===e?t===n||t&&n&&t.equals(n):void 0}},{key:"areStatesEqual",value:function(e,t,n){if("items"===e){var r=0;if(!t||!n||t.length!==n.length)return!1;for(var i=0;i<t.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(t[i].time!==n[i].time||t[i].item!==n[i].item)return!1}return!0}}},{key:"componentWillReceiveProps",value:function(e){e.items!==this.props.items&&this.updateState(e)}},{key:"getState",value:function(e){var t={};if(e.items){for(var n=0,r=[],i=[],o=0;o<e.items.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var c=e.items[o];if(!c.isNote()){var u=c.getNextDate(this.props.date),d=u&&u.hasTimeOfDay()&&u.toString(s.default.International.getFormat(l.Z.DFormat.ShortTime));try{a.Z.PAssert(1259,u,"itDate should be valid here",this.props.date)}catch(h){a.Z.reportError(h)}d?i.push({time:d,item:c}):r.push({item:c})}}i.sort(e.pane.compareItemDate),t.items=r.concat(i)}return t}},{key:"onMouseDown",value:function(e){e.preventDefault()}},{key:"onMouseEnter",value:function(){if(s.default.DragDrop.isDragging||s.default.DragDrop.dragging.get()){var e;this.isHovered.set(!0);var t=null===(e=s.default.DragDrop.dragItem)||void 0===e?void 0:e.getDate(),n=1,r=s.default.DragDrop.dragItem;r&&r.getDuration()&&(n=r.getDuration()/l.Z.MSPerHour),s.default.DragDrop.setBlockTarget({pane:this.props.pane,date:this.props.date,dateTime:t&&t.hasTimeOfDay()&&t,duration:1!==n?n*l.Z.MSPerHour:null,isDate:!0})}}},{key:"onDragEnd",value:function(){this.isHovered.set(!1)}},{key:"onMouseLeave",value:function(){this.isHovered.set(!1)}},{key:"onDoubleClick",value:function(e){var t=this.props,n=t.pane,r=t.date,i=n.item.get(),a=new te.Z(r,{duration:l.Z.DefaultEventDuration});n.openItemEditor({element:e.target,text:" "+l.Z.CharDate,parent:i,selectIndex:0,mooDate:a,pos:{top:e.clientY},showCalendarButtons:!0,addOnSave:!0})}},{key:"render",value:function(){var e,t=this.props,n=this.state,r=t.date,i=0===r.getDay()||6===r.getDay(),s=r.getDate(),c=Date.getDaysInMonth(r.getFullYear(),r.getMonth()),u=a.Z.classNames("dateBlock c-border",{firstDay:1===r.getDate()},{lastDay:r.getDate()===c},{"weekend c-bg-faded":i},{"c-background":!i},{hoveredInDrag:n.isHovered},{today:V.Z.isToday(r)}),d={left:t.left-1,width:t.width+1},h=a.Z.classNames("dateBlockDay");if(n.items){for(var p=0,f=0,g=[],m=!1,v=0;v<n.items.length;v++){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var y=n.items[v];y.time&&y.item.hasAttachmentType(l.Z.PluginType.Calendar)&&(m=!0)}for(var k=0;k<n.items.length;k++){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;var _=n.items[k],Z=_.time,w=_.item,b=m&&Z,P=a.Z.classNames("dateBlockItem flexbox",{hasCircle:b}),S=null;if(b){var D={background:w.hasAttachmentType(l.Z.PluginType.Calendar)&&w.getCalendarColor()};S=o.createElement("div",{className:"monthItemColorCircle",style:D})}g.push(o.createElement("div",{className:P,key:w.id},S,o.createElement(ee.Z,{className:"itemInCalendar",item:w,pane:t.pane,coloredInCalendar:!Z&&!!w.getCalendarColor(),showPriority:!0,allowDrag:!0,editOnClick:!0}),Z&&t.width>100&&o.createElement("span",{className:"itemTime"},Z)))}e=(t.items||n.isHovered)&&o.createElement("div",{className:"dateBlockItems"},g)}return o.createElement("div",{className:u,style:d,onMouseDown:this.onMouseDown,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onDoubleClick:this.onDoubleClick},o.createElement("div",{className:h},s),e)}}]),n}(ne.a);var ue=n(5802),de=n(4926),he=(0,f.Z)((function(e){var t=e.data,n=e.index,r=e.style,i=t[n],s=i.type,c=i.date,l=i.items,u=i.pane,d=u.getContentHeight(),h=u.isViewCalendarMonth()?u.heightWeek():u.getDayWidth();if((0,m.Z)(u.rect),"calendarDay"===s)return o.createElement(oe,{component:"div",className:"",date:c,items:l,pane:u,height:d,width:h,style:r});if("calendarWeek"===s){var p=0,f=a.Z.classNames("calendarWeek flexbox"),g=u.getWidth()+1,v=Math.floor(g/7),y=g-7*v,k=0,_=0;y>0&&(k=Math.ceil(y/2),_=y-k);for(var Z,w=Object.assign({},r,{height:h+1}),b=0;b<i.dates.length;b++){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var P=i.dates[b];if(P){var S=P.date;1===S.getDate()&&(Z=S.toString("MMMM"),S.getYear()!==V.Z.getToday().getYear()&&(Z+=S.toString(" yyyy")))}}return o.createElement("div",{className:f,style:w},i.dates.map((function(e,t){var n=v+(0===t?k:0)+(6===t?_:0);return o.createElement(le,{key:e.date.getTime(),pane:u,date:e.date,items:e.items,left:t*v+(t>0?k:0),width:n})})),Z&&o.createElement("div",{className:"calendarMonthTitle c-bg-app"},Z))}}));const pe=(0,f.c)((function(e){var t=e.className,n=e.pane,r=e.initialScrollIndex;var c=(0,m.Z)(n.items,n.orientation,s.default.settings.dayWeekStart,n.viewState),u=i()(c,3),d=u[0],h=u[1],p=u[2],f=(0,o.useRef)(),g=(0,o.useRef)(),v=(0,o.useRef)(),y=n.isViewCalendarMonth(),k=(0,ue.Z)(y),_=y?n.heightWeek():n.getDayWidth(),Z=(0,ue.Z)(_),w=(0,C.Z)(),b=(0,o.useRef)(),P=(0,de.Z)(b);y||(P={width:P.width-l.Z.CalendarTimesWidth,height:P.height});var S,D=(0,ue.Z)(P);void 0===r&&(r=null!==(S=n.initialScrollIndex)&&void 0!==S?S:n.getIndexOfToday());var I=(0,o.useRef)(r);(0,o.useEffect)((function(){if(n.paneContent=v.current,n.scrollElement=a.Z.findChild(v.current,"paneContent"),!y){var e=function(){if(f.current){var e=f.current.scrollTop;g.current.scrollTo(e)}};return f.current&&(f.current.style.position="relative",f.current.style.overflowY="auto",f.current.addEventListener("scroll",e),f.current.scrollTo({top:n.getDayViewY()}),requestAnimationFrame((function(){return f.current.scrollTo({top:n.getDayViewY()})}))),function(){var t;null===(t=f.current)||void 0===t||t.removeEventListener("scroll",e)}}}),[y]),I.current=n.listManager.getScrollIndex(),(0,o.useEffect)((function(){n.listManager.setVirtualList({scrollToIndex:function(e){var t=e.index,n=e.align,r=e.behavior,i=Z.current,o=k.current?D.current.height:D.current.width;"center"===n?t-=Math.floor(o/i/2):"end"===n&&(t-=Math.floor(o/i)),a.Z.scrollElementTo(v.current,{left:k.current?void 0:t*i+1,top:k.current?t*i+1:void 0,behavior:r})},getScrollOffset:function(){return v.current[k.current?"scrollTop":"scrollLeft"]},scrollTo:function(e,t){return v.current.scrollTo({left:k.current?e:void 0,top:k.current?void 0:e,behavior:t})},offsetById:function(e){return 0},offsetByIndex:function(e){return 0}})}),[y]),(0,o.useEffect)((function(){n.listManager.scrollToIndex(I.current,"start")}),[_]),(0,o.useEffect)((function(){n.scrollToToday("auto"),requestAnimationFrame((function(){return n.scrollToToday("auto")}))}),[]);var E,x=(0,o.useCallback)((function(e){var t=e.visibleStartIndex,r=e.visibleStopIndex;n.listManager.setScrollRange({startIndex:t,endIndex:r}),n.onScroll()}),[]),A=(0,o.useCallback)((function(e,t){var n;return null===(n=t[e])||void 0===n?void 0:n.id}),[]),L={};if(y){L.marginTop=30;var M={boxShadow:w.paneShadow()};E=o.createElement("div",{className:"calendarMonthDays z-4 inset-t-0 c-background flexbox",key:"overlay",style:M},0===p&&o.createElement("div",null,"SUN"),o.createElement("div",null,"MON"),o.createElement("div",null,"TUE"),o.createElement("div",null,"WED"),o.createElement("div",null,"THU"),o.createElement("div",null,"FRI"),o.createElement("div",null,"SAT"),1===p&&o.createElement("div",null,"SUN"))}else L.marginLeft=l.Z.CalendarTimesWidth,E=o.createElement(se,{pane:n,trackPane:!0,showAllDay:!0,ref:g});return o.createElement("div",{className:t+" relative c-foreground",ref:b},o.createElement(H.t7,{width:P.width,height:P.height,itemCount:d.length,itemData:d,itemSize:_,layout:h,className:"calendarList paneContent",innerRef:f,style:L,onItemsRendered:x,outerRef:v,itemKey:A},he),E)}));var fe=n(2935),ge=n(4472);const me=(0,f.Z)((function(e){var t=e.className,n=e.initial,r=e.exit,i=e.transition,a=e.children;return o.createElement(h.M,null,a&&o.createElement(d.E.div,{className:t,animate:{x:0,y:0},initial:n,exit:r,transition:i},a))}));var ve=n(2262),ye=n(6604),ke=n(3968);function _e(e,t,n){(0,o.useEffect)((function(){var t=function(t){var n=e[t.normCode]?e[t.normCode]:e.default;n&&(n(t),a.Z.preventAndStop(t))};return window.addEventListener(n,t),function(){window.removeEventListener(n,t)}}),t)}var Ze=function(e){var t=e.elements,n=function(e,t){var n=(0,o.useState)({}),r=i()(n,2),a=r[0],s=r[1],c=function(t){var n=t.keyCode;e.forEach((function(e,t){n===e&&s((function(t){return t[e]=!0,Object.assign({},t)}))}))},l=function(t){var n=t.keyCode;e.forEach((function(e,t){n===e&&s((function(t){return t[e]=!1,Object.assign({},t)}))}))};return(0,o.useEffect)((function(){return window.addEventListener("keydown",c,!0),window.addEventListener("keyup",l,!0),function(){window.removeEventListener("keydown",c,!0),window.removeEventListener("keyup",l,!0)}}),t),a}(a.Z.arrayUniques2(t.flatMap((function(e){return e.keys}))),[]),r=t.reduce((function(e,t,r){return!t.isModifier&&t.keys.every((function(e){return n[e]}))&&t.keys.length>e.num?{el:t,num:t.keys.length}:e}),{el:void 0,num:0}).el,s=t.filter((function(e){return e.isModifier&&e.keys.every((function(e){return n[e]}))}));return o.createElement("div",{className:"flex px-2 py-2 leading-tight whitespace-pre border-t text-11 c-border-heavy"},t.map((function(e){return o.createElement("div",{key:e.keyText,className:a.Z.classNames("px-2 py-1 mx-1 rounded",e===r||s.includes(e)?"c-bg-lighter":"")},o.createElement("span",{className:a.Z.classNames("pr-2 c-foreground-light font-bold")},e.keyText),o.createElement("span",{className:"font-medium c-foreground-light"},e.text))})))},we=n(3278),be=n(6950),Pe=["className"],Se=[{keyText:"ENTER",keys:[],text:"Open"},{keyText:"\u21e7 Enter",keys:[l.Z.KeyCode.Shift],text:"Zoom In"},{keyText:I.Z.priModKey+" ENTER",keys:[I.Z.priModKeyCode],text:"New Pane"},{keyText:I.Z.secModKeyForce+" ENTER",keys:[I.Z.secModKeyForceCode],text:"Popup"}],De=function(e,t){for(var n=0,r=e+1;r<t.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if("item"===t[r].type)return r}},Ie=function(e){var t=e.className,n=b()(e,Pe);return o.createElement(E.Z,Z()({mode:"contained",className:a.Z.classNames("searchX c-button noShrink",t),width:24,height:24},n))};const Ee=(0,f.Z)((function(e){var t=e.pane,n=(0,o.useRef)(0),r=(0,o.useRef)(""),c=r.current,u=(0,o.useRef)(),d=(0,o.useRef)(),h=d.current,p=(0,o.useRef)(),f=(0,m.Z)(I.Z.windowSize,t.isSearchingGlobal),g=i()(f,2),v=g[0].height,y=g[1],_=(0,ye.Z)(),Z=function(e){r.current=e,_()},w=function(){u.current=ge.Z.save(),ge.Z.reset()};y&&h&&!h.isFocused.get()&&(w(),h.focus(),h.selectEnd()),(0,o.useEffect)(w,[]);var b=(0,o.useMemo)((function(){return c?ve.Z.findMatchLike(c.trim(),{max:1e3,root:t.getRootItem(),allDocs:!0}):[]}),[c]),P=function(e){n.current=e,_()};(0,o.useEffect)((function(){P(De(0,b))}),[c]);var D=function(){var e=k()(S().mark((function e(n,r,i){var a,o,c,u,d;return S().wrap((function(e){for(var h=0;;){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;switch(e.prev=e.next){case 0:if(a=i?n:n.getDocumentOwner().getRootItem(),o=i?void 0:n,"pane"===r?c=s.default.PaneManager.addPaneByButton(l.Z.PaneMode.Task,void 0,a):"popup"===r?c=s.default.menus.openModalPaneHighlightingItem({zoomItem:a,highlightItem:o}):(c=t,t.zoomIn(a,{noSel:!0})),u=!0,i){e.next=12;break}if(d=function(){n.highlight(),requestAnimationFrame((function(){c.scrollItemToMiddle(n,"auto")}))},t!==c||t.search.isMatched(n,{forceCheck:!0})){e.next=11;break}return e.next=9,s.default.menus.confirm("Item is currently hidden by filters. Would you like to clear the filters and scroll to the selected item?");case 9:(u=e.sent)&&(t.search.resetFilters(),t.search.setValue(""));case 11:u&&d();case 12:u&&A(n,c);case 13:case"end":return e.stop()}}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),C=function(e,t){var n=(I.Z.isPriModKey(t)?"pane":I.Z.isSecModKey(t)&&"popup")||"scroll";D(e,n,t.shiftKey)},A=function(e,n){if(Z(""),t.isSearchingGlobal.set(!1),e){var r,i=n||t;if(i.getItem()===e)ge.Z.selectIndex(0,-1);else null===(r=i.paneObjectsByItem[e.id])||void 0===r||r.forEach((function(e){e.setUncollapsedToRoot()})),ge.Z.selectItem(e,-1)}else u.current&&ge.Z.restore(u.current)},L=function(){var e=function(e,t){for(var n=0,r=e-1;r>=0;r--){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if("item"===t[r].type)return r}}(n.current,b);return void 0!==e?(P(e),e):n.current},M=function(){var e=De(n.current,b)||b.length-1;return P(e),e},T=Math.abs(a.Z.clamp(1e3,100,.7*v)),R=(0,o.useCallback)((function(e,t){if("header"===e.type)return o.createElement("div",{className:"px-3 py-2 font-medium text-white c-bg-popup-title text-11"},e.text);if("item"===e.type){var i=e.item,s=t===n.current,c=a.Z.classNames("relative flex flexvert justify-center py-3 px-3 borderBox",{"selected c-bg-dark":s});return o.createElement("div",{className:c,onClick:function(e){C(i,e)},onContextMenu:I.Z.mac&&function(e){return a.Z.preventAndStop(e),0===e.button&&C(i,{ctrlKey:!0,shiftKey:e.shiftKey}),!1},onMouseMove:function(){return P(t)}},o.createElement(we.Z,{item:i,numberOfLines:s?4:2,highlightSearchText:r.current.toLowerCase(),displayParents:!0,selected:s}),s&&o.createElement("div",{className:"absolute inset-y-0 flex justify-center pr-2 inset-r-0 flexvert"},o.createElement(Ie,{icon:"MdAdd",tooltip:"Open in New Pane",onClick:function(e){D(i,"pane",e.shiftKey),a.Z.preventAndStop(e)}}),o.createElement(Ie,{className:"mt-1",icon:"MdOpenInNew",iconSize:16,tooltip:"Open in Popup Pane",onClick:function(e){D(i,"popup",e.shiftKey),a.Z.preventAndStop(e)}})))}}),[]);return o.createElement(ke.Z,null,o.createElement("div",{className:"flex my-2 overflow-hidden rounded t-popup flexvert",style:{width:496}},o.createElement("div",{className:"fixed inset-0",onClick:function(){A()}}),o.createElement("div",{className:"flex"},o.createElement(x.Z,{width:460,noBackground:!0,height:36,border:!1,fontSize:12,padding:{left:16,right:16},placeholder:"Find an item to open",value:c,onChange:Z,onKeyDown:function(e){if(e.keyCode===l.Z.KeyCode.Escape)A();else if(e.keyCode===l.Z.KeyCode.ArrowUp){var t;null===(t=p.current)||void 0===t||t.scrollToIndex({index:L(),align:"auto"}),a.Z.preventAndStop(e)}else if(e.keyCode===l.Z.KeyCode.ArrowDown){var r;null===(r=p.current)||void 0===r||r.scrollToIndex({index:M(),align:"auto"}),a.Z.preventAndStop(e)}else e.keyCode===l.Z.KeyCode.Enter&&C(b[n.current].item,e)},focused:!0,underline:!1,ref:d}),o.createElement(E.Z,{className:"searchX c-button noShrink",width:36,height:36,icon:"MdClose",onClick:function(){return A()}})),c&&o.createElement(o.Fragment,null,o.createElement(be.Z,{className:"border-t c-border-heavy",items:b,renderItem:R,defaultItemSize:58,style:{height:T},ref:p}),o.createElement(Ze,{elements:Se}))))}));var xe=n(374),Ce=n(7237),Ae=n(3205),Le=n(4764);const Me=(0,f.c)((0,o.forwardRef)((function(e,t){var n=e.pane,r=(0,o.useRef)(),i=(0,o.useRef)(!1);(0,o.useEffect)((function(){n.hiddenInput=r.current}),[]),(0,o.useImperativeHandle)(t,(function(){return{getElement:function(){return r.current}}}));var c=(0,o.useCallback)((function(){if(ge.Z.getPane()===n){var e;if(Ae.Z.resetSavedSelection(),null!==(e=getSelection())&&void 0!==e&&e.focusNode){if(Ae.Z.isInSelectionChange=!0,I.Z.isiOS&&!i.current&&ge.Z.isTouchDown()&&(i.current=!0,n.scrollElement.style.overflow="hidden",ge.Z.onTouchUp((function(){i.current=!1,n.scrollElement.style.overflow=null}),!1)),!ge.Z.isSelecting&&ge.Z.isValid()&&!s.default.menus.isContextMenuOpen()&&(!s.default.menus.isModalOpen()||s.default.menus.isModalOpen("modalPane"))){var t=ge.Z.getStartIndex(),o=ge.Z.getStartIndex();if(t===o){var c=ge.Z.getStartOffset(),u=ge.Z.getEndOffset(),d=ge.Z.getEndTotal(),h=Le.Z.getSelectionRangeNative();if(h&&a.Z.findParent(h.startContainer,r.current)){var p=a.Z.findParent(h.startContainer,"hiddenInputItem"),f=a.Z.findParent(h.endContainer,"hiddenInputItem");if(p&&f){var g=Le.Z.getSelectOffsetsInElement(p,h).start,m=g,v=Le.Z.getSelectOffsetsInElement(f,h).end,y=+(null===p||void 0===p?void 0:p.getAttribute("data-index")),k=+(null===f||void 0===f?void 0:f.getAttribute("data-index")),_=n.objectAtIndex(y);if(_){var Z=_.item;if(Z){var w=g,b=v;if(p.textContent===l.Z.TextSpace)w=0,b=0;else if(t===y){if(w===b&&(ge.Z.preferEndLine||"EndLine"===Ce.Z.lastNavigationAction||"Down"===Ce.Z.lastNavigationAction||"Up"===Ce.Z.lastNavigationAction)){var P=h.getBoundingClientRect();if(P.x-p.getBoundingClientRect().x<10&&" "===p.textContent[w-1]){var S,D=null===(S=Ae.Z.savedRange)||void 0===S?void 0:S.getBoundingClientRect();if("EndLine"===Ce.Z.lastNavigationAction||ge.Z.preferEndLine&&(ge.Z.preferEndLine.index===y||ge.Z.preferEndLine.offset===w)||D.x-p.getBoundingClientRect().x>20){var E=Le.Z.createRange(p,w-1,w-1);E.getBoundingClientRect().x-P.x>10&&(h=E,g--,v--,w--,b--)}}}var x=w-c,C=b-u;x&&(w=Z.elsNew.adjustOffsetAroundUneditables(_,w,x>0?1:-1)),C&&(b=Z.elsNew.adjustOffsetAroundUneditables(_,b,C>0?1:-1))}else w=Z.elsNew.adjustOffsetAroundUneditables(_,w),b=Z.elsNew.adjustOffsetAroundUneditables(_,b);y>=0&&(y!==t||c!==w||u!==b)&&(!ge.Z.modifiersDown.shiftKey||y===t&&k===o?(Ae.Z.setSavedRange(h),!ge.Z.preferEndLine||ge.Z.preferEndLine.index===y&&ge.Z.preferEndLine.offset===m||(ge.Z.preferEndLine=void 0),ge.Z.selectIndices(y,w,y,b,{fromInput:w===g&&b===v})):y<t&&c>0?ge.Z.selectIndices(t,0,t,u):k>t&&u<d?ge.Z.selectIndices(t,c,t,-1):ge.Z.selectIndices(t,0,t,-1))}}}}}}}else ge.Z.reset();Ae.Z.isInSelectionChange=!1}}),[n]);(0,xe.Z)("selectionchange",c,document);var u={};u={onKeyDown:function(e){ge.Z.getPane().keydown(I.Z.normalizeKeys(e.nativeEvent))},onKeyPress:function(e){ge.Z.getPane().keypress(I.Z.normalizeKeys(e.nativeEvent))},onKeyUp:function(e){ge.Z.getPane().keyup(I.Z.normalizeKeys(e.nativeEvent))}};var d=a.Z.classNames("select-text paneHiddenInput whitespace-pre-wrap-break-words",{"z-2":!0},{"z--1":!1});return o.createElement("div",Z()({contentEditable:!0,className:d,ref:r,suppressContentEditableWarning:!0,onInput:function(e){n.onInput(e.nativeEvent)},onBeforeInput:n.onBeforeInput,onCompositionStart:n.compositionStart,onCompositionEnd:n.compositionEnd},u))})));var Te=n(6877);const Re=(0,f.Z)((function(e){var t=e.paneObject.block,n=s.default.DisplaySettings.itemPadding(),r=(a.Z.classNames("c-foreground-ultra-faded c-foreground-hover cursor-pointer hide-print"),{paddingLeft:s.default.DisplaySettings.itemIndentStart(),paddingTop:n,paddingBottom:n});return o.createElement("div",{style:r},!t.noAddButton&&o.createElement("div",{className:"flex items-center cursor-pointer c-foreground-ultra-faded c-foreground-hover hide-print",onClick:function(){t.addFn(t)}},o.createElement(Te.x06,{className:"mr-2"}),"Add item"))}));const Oe=(0,f.Z)((function(e){var t,n,r=e.paneObject,c=r.index,u=r.pane,d=(0,m.Z)(u.dragHoveredBlock),h=i()(d,1)[0],p=r.block===h,f=s.default.DisplaySettings.itemPadding(),g=r.block,v=g.isCollapsed(),y=a.Z.classNames("blockHeader noItem flexbox items-stretch mb-2 text-xl font-bold",{blockHeaderDate:g.isDate},{"t-tag":u.isViewTag()},{"t-contact":u.isViewContact()},{agendaBlockRed:!v&&g.isOverdue},{dragHovered:p},{"collapsed c-foreground-super-faded":v},{firstBlock:0===c},{"border-b c-border-light pb-3":!g.isNewProject&&!v}),k={fontSize:s.default.DisplaySettings.fontSizeHeaderTopLevel(),paddingLeft:s.default.DisplaySettings.itemIndentStart(),paddingTop:f+(c>0?null!==(t=r.blockPrevious)&&void 0!==t&&t.isCollapsed()?l.Z.PaddingTopBlockHeader/4:l.Z.PaddingTopBlockHeader:0)},_=a.Z.classNames("blockCollapser c-foreground-super-faded pt-2 cursor-pointer",{"icon-angle-down":!v&&!g.isNewProject},{"icon-angle-right":v&&!g.isNewProject}),Z={marginLeft:-26,width:26},w={},b=a.Z.classNames("blockHeaderNumItems pl-4 text-xs font-normal",{"c-foreground-very-faded":!v}),P=o.createElement("div",{className:b},g.numItems()),S="blockHeaderText f1 flex items-center";if(g.isDate){var D=g.date,I=V.Z.getToday(),E=V.Z.isToday(D)?"Today":V.Z.isSameDay(D,V.Z.getTodayPlusDays(1))?"Tomorrow":D.toString("dddd"),x=D.toString("MMMM d"+(D.getYear()!==I.getYear()?", yyyy":""));S=a.Z.classNames(S,"blockHeaderDayName flex",{"c-foreground-light":!v});var C=a.Z.classNames("font-normal pl-4 text-sm",{"c-foreground-light":!v});n=o.createElement("div",{className:"flex items-center"},o.createElement("div",{className:"font-bold"},E),o.createElement("div",{className:C},x),P)}else if(g.isNewProject)w={marginLeft:-26,width:26},n=o.createElement("div",{className:S+" flex c-foreground-very-faded c-foreground-hover",style:w,onClick:function(){var e=u.getItem().numItems(),t=u.addItemToPane({text:l.Z.Prefix.Header+" "},e),n=u.indexOfItem(t);ge.Z.selectIndex(n,0)}},o.createElement(Te.x06,{className:"pr-2"}),"New project");else{var A=g.isStarred&&o.createElement("i",{className:"pr-2 icon-star"})||g.isImportant&&o.createElement("div",{className:"pr-2"},"!");w={paddingTop:s.default.DisplaySettings.itemPadding()},n=o.createElement("div",{className:S+" flex",style:w},A,g.text,P)}return o.createElement("div",{className:y,style:k},!g.isNewProject&&o.createElement("div",{className:_,style:Z,onClick:g.toggleCollapsed}),n)})),Fe=(0,f.Z)((function(e){var t=e.paneObject.data.numReferences;return t>0?o.createElement("div",{className:"pt-8 hide-print"},o.createElement("div",{className:"px-8 pt-8 pb-1 border-t c-foreground-very-faded text-12 c-border-light"},t," Linked Reference",t>1?"s":"")):null}));n(4918);const Ne=function(e,t){t||(t=j.Z);var n=(0,ye.Z)(),r=(0,o.useRef)();r.current||(t.listen(e,n),r.current=!0),(0,o.useEffect)((function(){return function(){r.current&&(t.unlisten(e,n),r.current=!1)}}),[e])};var Be=n(1831),Ue=n(8532),je=n(8778),He=n(2971);(0,f.Z)((function(e){var t=e.left,n=e.top,r=e.height,a=(0,o.useState)(!0),c=i()(a,2),l=c[0],u=c[1],d=(0,o.useRef)(),h=(0,o.useRef)(),p=(0,o.useRef)(),f=(0,m.Z)(s.default.settings.ui.cursorBlink,ge.Z.isWindowFocused,s.default.menus.contextMenuStack),g=i()(f,3),v=g[0],y=g[1],k=g[2],_=y&&0===k.filter((function(e){return!("ReactAutocomplete"===e.componentName&&"all"===je.Z.getMode())})).length,Z=(0,He.Z)(t),w=(0,He.Z)(n),b=(0,He.Z)(_),P=function e(t){clearTimeout(h.current),_&&(v||(t=!0),u(t),h.current=setTimeout(e,500,!t))};(t!==Z||n!==w||_!==b)&&(l=!0,p.current=requestAnimationFrame((function(){return P(!0)}))),(0,o.useEffect)((function(){return function(){cancelAnimationFrame(p.current),clearTimeout(h.current)}}),[]);var S={};return _&&ge.Z.isValid()?(S.opacity=l?1:0,S.left=t,S.top=n,S.height=r):(S.left=-1e3,S.top=-1e3),o.createElement("div",{className:"caret t-caret",style:S,ref:d})})),(0,f.Z)((function(e){var t=e.paneObject,n=(0,m.Z)(s.default.settings.showFormattingToolbar,t.pane.rect),r=i()(n,2),c=r[0],u=r[1],d=t.pane,h=ge.Z.numSelected(d),p=0===c,f=(0,o.useRef)(),g=(0,de.Z)(f),v=function(e){ge.Z.applyFormatToSelection(e,!0)},y=function(e){ge.Z.applyPrefixToSelection(e)},k=function(){var e=s.default.settings.showFormattingToolbar.get();e=0===e?1:0,s.default.settings.showFormattingToolbar.set(e)},_=d.getPaddingForPaneObject(t),w=p?24:36,b=p?24:36,P={marginTop:-b-4,left:Math.min(_,u.width-g.width-4)},S=(0,o.useCallback)((function(e){return o.createElement(E.Z,Z()({color:"t-popupButton",noHover:!0,iconWidth:24,width:w,height:b,iconSize:e.iconSize,onClick:e.onClick},e))}),[w,b]);return o.createElement("div",{className:a.Z.classNames("formattingToolbar t-popup absolute z-50 flex",{collapsed:p}),style:P,ref:f},p?o.createElement(N.Z,{icon:"icon-more_horiz",width:w,height:b,iconSize:14,tooltip:"Show formatting toolbar",onClick:k}):o.createElement(o.Fragment,null,o.createElement(S,{icon:"MdFormatBold",iconSize:20,onClick:v.bind(this,"bold"),tooltip:"Bold",tooltipHotkey:{name:"Bold"}}),o.createElement(S,{icon:"MdFormatItalic",iconSize:20,onClick:v.bind(this,"italic"),tooltip:"Italic",tooltipHotkey:{name:"Italic"}}),o.createElement(S,{icon:"MdFormatUnderlined",iconSize:18,onClick:v.bind(this,"underline"),tooltip:"Underline",tooltipHotkey:{name:"Underline"}}),o.createElement(S,{icon:"MdStrikethroughS",iconSize:18,onClick:v.bind(this,"strike"),tooltip:"Strikethrough",tooltipHotkey:{name:"Strike"}}),o.createElement(S,{icon:"FaHighlighter",iconSize:15,onClick:v.bind(this,"highlight"),tooltip:"Highlight",tooltipHotkey:{name:"Highlight"}}),o.createElement(S,{icon:"MdCode",iconSize:18,onClick:v.bind(this,"code"),tooltip:"Inline Code",tooltipHotkey:{name:"InlineCode"}}),o.createElement("div",{className:"divider t-popupDivider",style:{height:b}}),o.createElement(S,{icon:"icon-project",iconSize:18,onClick:y.bind(this,l.Z.Prefix.Header),tooltip:"Project",tooltipHotkey:{name:"PrefixHeader"}}),o.createElement(S,{icon:"MdCheckBoxOutlineBlank",iconSize:16,onClick:y.bind(this,l.Z.Prefix.Task),tooltip:"Task",tooltipHotkey:{name:"PrefixTask"}}),o.createElement(S,{icon:"MdFormatListBulleted",iconSize:18,onClick:y.bind(this,l.Z.Prefix.Bullet),tooltip:"Bulleted list",tooltipHotkey:{name:"PrefixBullet"}}),o.createElement(S,{icon:"icon-numlist",iconSize:14,onClick:y.bind(this,l.Z.Prefix.NumList),tooltip:"Numbered list",tooltipHotkey:{name:"PrefixNumList"}}),o.createElement(S,{icon:"IoMdCodeWorking",iconSize:18,onClick:y.bind(this,l.Z.Prefix.CodeBlock),tooltip:"Code Block",tooltipHotkey:{name:"CodeBlock"}}),o.createElement("div",{className:"divider t-popupDivider",style:{height:b}}),o.createElement(S,{icon:"MdLink",disabled:h>1,iconSize:18,onClick:function(){ge.Z.getStartItem().insertLinkAtSelection()},tooltip:"Create link",tooltipHotkey:{name:"InsertLink"}}),o.createElement(S,{icon:"FaRegStickyNote",disabled:h>1,iconSize:14,onClick:function(){var e=t.item,n=t.pane;e&&n.openNoteContextMenuByPaneObject(t)},tooltip:"Add note",tooltipHotkey:{name:"EditNote"}}),o.createElement("div",{className:"divider t-popupDivider",style:{height:b}}),o.createElement(S,{icon:"FaMinus",iconSize:10,tooltip:"Hide formatting toolbar",onClick:k})))}));var Ve=n(2701).Z;const We=(0,f.Z)((function(e){var t,n=e.paneObject,r=n.pane;if(!r||!r.search)return null;var c=r.objectAtIndex(n.index);(null===c||void 0===c?void 0:c.item)===n.item&&(n=c);var u=n,d=u.item,h=u.isBlockHeader,p=u.mirroringItem,f=d.getPrefixLength(),g=(r.isItemHeader(d,!1)||h)&&!n.noCollapse&&r.supportCollapsing&&r.canCollapse(),v=d.hasPrefix()&&!h,y=r.isPaneObjectCollapsed(n),k=ge.Z.isMultiselected(),_=s.default.DisplaySettings.paddingForItemTop(n),w=s.default.DisplaySettings.paddingForItemBottom(),b=d.isPrefixCodeBlock(),P=[(0,o.useRef)(),!1],S=i()(P,2),D=S[0],E=S[1],x=(0,o.useState)(!1),C=i()(x,2),A=C[0];C[1];Ne("numListChanged");(0,ye.Z)();var L=(0,m.Z)(d._note,d.isHighlighted,null===p||void 0===p?void 0:p.isHighlighted,s.default.settings.ui.showVerticalLines,s.default.settings.showMarkdown,r.search.isFocused,r.searchingPaneObjects,s.default.settings.showFormattingToolbar,s.default.settings.alignIndentToPrefix,d.levelsDeep,d.flags,r.viewState,s.default.DisplaySettings._itemPadding,s.default.DisplaySettings._itemIndentSize,s.default.DisplaySettings._boldHeaders,d.itemsLinked,d.itemsLinkedTo,Be.Z.noteLineClamp,r.search.onChanged,d.itemChanged),M=i()(L,9),T=M[0],R=M[1],O=M[2],F=M[3],N=M[4],B=M[5],U=M[6],j=M[7],H=M[8],V=R||O,W=U.selectedPaneObject===n.id,z=d.isLinkedOrLinking(),q=z&&d.isMirrorOrMirrored(),G=v?l.Z.PrefixWidthPlusOffset:0,K=r.getPaddingForPaneObject(n),Y=K-(H?0:G)-0,X=(v?l.Z.PrefixWidthPlusOffset:0)+0,Q=s.default.DisplaySettings.paddingForItemRight(n),J=ge.Z.getSelection(n),$=!!J,ee=s.default.ElementRenderer.renderToJSX(d,n,{noPrefix:!0,showMarkdown:N&&$,highlightSearch:B||U.isSearching}),te=!(null!==(t=ee)&&void 0!==t&&t.length),ne=(!b&&ge.Z.isMultiselected(),J&&(J.full||J.start!==J.end&&!te)),re=r.search.isMatchStuckHiding(d),ie=null===T||void 0===T?void 0:T.getNotePreviewText(),ae=r.supportVertLines&&F,oe=d.shouldShowParents(n,r);I.Z.safari&&te&&(ee=[l.Z.TextSpace]),(0,Ue.w)(n,D,"itemInPaneText");var se,ce,le,ue,de,he,pe,fe,me,ve=n.getPrevious(),ke=!ve||ve.item===d.parent(),_e={paddingLeft:Y,paddingTop:0===n.index||!h&&ke?0:void 0},Ze={paddingTop:_,paddingBottom:T?0:w,marginRight:g?0:40,minHeight:"1.1em"},we=a.Z.classNames(l.Z.ItemClass,"z-1 items-center cursor-grab",h&&"t-blockHeader",d.styleProps(n),{"c-border-light border-b mb-1":h&&!y},{collapsed:y},{hasSelection:$},{hasSelectionHighlight:ne},{itemHighlighted:A||W||V&&r.type!==l.Z.PaneMode.Gmail},{stuckMatch:re}),be=a.Z.classNames("itemInPaneText flex-1 relative whitespace-pre-wrap-break-words cursor-text z-1",{"pb-1":h},d.isPrefixHR()&&"flex");if(oe){var Pe=d.parents(r.getItem()).map((function(e){return e.generateTitleText()})),Se=Pe.map((function(e,t){return o.createElement("span",{key:t,className:"truncate-pre",style:{}},(t>0?" > ":"")+e)})),De={paddingTop:_,paddingLeft:X,paddingRight:Q+16};se=Se&&o.createElement("div",{className:"relative overflow-hidden whitespace-pre itemParents c-foreground-very-faded",style:De,"data-tooltip":Pe.join(" > ")},Se)}if(v){var Ie=d.isComplete(),Ee=d.isPrefixTask(),xe=d.isPrefixBullet(),Ce=d.isPrefixHeader();ce=s.default.ElementRenderer.renderPrefix(d,!0,Y,G,_,H,void 0,(function(e){s.default.DragDrop.isDraggingDelayed||(a.Z.preventAndStop(e),xe||Ce||I.Z.isPriModKey(e)?r.zoomIn(d,{forLoad:!1,showToast:!0}):Ee&&(a.Z.beginCompleteAction(),d.setComplete(!Ie,l.Z.ChangeType.Local),a.Z.endCompleteAction(),r.selectNearestItem(n)))}))}if(g){var Ae=a.Z.classNames("flex items-center justify-center",{"collapsed icon-angle-right":y},{"icon-angle-down":!y}),Le={width:void 0},Me={width:40,marginRight:0,textAlign:"center",fontSize:20},Re="<b>Click</b> to "+(y?"expand":"collapse")+" item.<br><b>Shift + Click</b> to "+(y?"expand":"collapse")+" item recursively.<br><b>"+I.Z.priModKey+" + Click</b> to zoom in.";le=o.createElement("div",{className:"flex self-stretch justify-end collapserNew c-color-hover t-collapser",style:Le,"data-tooltip":Re,onClick:function(e){s.default.DragDrop.isDraggingDelayed||(a.Z.preventAndStop(e),r.handleLeftSideTap(n,e))}},o.createElement("div",{className:Ae,style:Me}))}if(te){if(E&&!f&&!le&&!k){var Oe=a.Z.classNames("emptyItemAddButtonNew icon-add c-background c-shadow-light"),Fe={left:Y};ue=o.createElement("div",{className:Oe,style:Fe,onClick:function(e){s.default.DragDrop.isDraggingDelayed||(a.Z.preventAndStop(e),s.default.menus.openContextMenu({componentName:"ReactContextMenuSlashHelp",element:a.Z.findParent(e.target,"itemInPane"),positionOffset:{left:e.pageX-10},paneObject:n}))}})}0}if(ae){var je=r.extraPaddingForPaneObject?r.extraPaddingForPaneObject(n):0,He=s.default.DisplaySettings.itemIndentStart()+je-l.Z.PrefixWidth+2,We=K-He-(H?0:l.Z.PrefixWidth);if(We>0){var ze={left:He,width:We};de=o.createElement("div",{className:"vertLines t-vertLines",style:ze})}}if(h&&(he=o.createElement("span",{className:"inline-block pl-4 text-xs align-middle itemIgnoreText ns c-foreground-faded"},n.block.items.length)),r.shouldShowTime(n)){var qe,Ge=r.getItemDisplayTime(n),Ke=Ge;a.Z.isArray(Ge)&&(Ke=Ge[0],qe=Ge[1]);var Ye=a.Z.classNames("absolute right-0 top-0 pr-2 text-xxs leading-tight"),Xe={paddingTop:_};pe=o.createElement("div",{className:Ye,style:Xe,onClick:function(e){a.Z.preventAndStop(e),s.default.menus.openDate({element:e.target,item:d,pane:r,paneObject:n})}},o.createElement("div",{className:"c-blue"},Ke),o.createElement("div",{className:"c-foreground-very-faded"},qe))}if(void 0!==ie){var Qe=ie.lines,Je=ie.hasMore;fe=o.createElement("div",{className:"relative font-normal cursor-pointer itemInPaneNote z-1",style:{paddingRight:Q,paddingLeft:X,paddingBottom:w}},o.createElement("div",{className:"t-note line-clamp"},Qe.map((function(e,t){return o.createElement("div",{key:t},e+(Je&&t===Qe.length-1?"...":""))}))))}if(r.isViewArchived()||r.isViewDeleted()){me=o.createElement("div",{className:"absolute top-0 right-0 pr-2 c-button",onClick:function(e){a.Z.preventAndStop(e),r.handleRightSideTap(d)}},o.createElement(Te.TsG,{size:16}))}var $e,et,tt,nt=n.getDisplayLengthWithoutPrefix(),rt=nt>0;if(J&&(ge.Z.isValid()||J.full)&&ge.Z.pane.get()===r&&!ge.Z.isKeyboardOpen){var it=[];try{var at;if(J.full||rt&&0===J.start&&J.end===nt)at=!0,it.push({left:0,right:0,top:-1,bottom:-1,width:"auto",height:"auto"});else;if(it.length>0){var ot=a.Z.classNames("absolute textSelected t-selection pointer-events-none",{fullySelected:at});et=it.map((function(e,t){return o.createElement("div",{key:t,className:ot,style:e})}))}}catch(pt){try{a.Z.PAssert(1260,!1,"Error rendering selection",pt)}catch(ft){a.Z.reportError(ft)}}}z&&(E||q)&&(tt=o.createElement("div",{className:"flex items-center justify-center font-normal text-center rounded cursor-pointer c-bg-light c-foreground-faded text-14",style:{height:22,width:22,marginRight:8,marginLeft:-30},onMouseDownCapture:function(e){return a.Z.preventAndStop(e)},onClick:function(e){s.default.menus.openContextMenu({componentName:"ReactContextMenuItemList",element:e.target,items:d.getItemsLinked(),onSelect:function(e){r.openDocumentAndScrollToItem(e),(e.getMirroredItem()||e).highlight()}})}},d.numItemsLinking()));var st={},ct="";b&&(st.marginLeft=l.Z.PrefixWidthPlusOffset,st.marginRight=Q,Ze.marginRight=void 0,ct=d.stylePropsWrapper());var lt,ut=o.createElement("div",{className:ct,style:st},et,o.createElement("div",{className:"relative flex"},!b&&o.createElement("div",{className:a.Z.classNames("flex items-center self-start justify-center",{"cursor-pointer":d.isPrefixTask()||d.isPrefixBullet||d.isPrefixHeader}),style:{paddingTop:_,paddingBottom:T?0:w}},l.Z.TextSpace,!1,ce),o.createElement("div",{className:be,style:Ze},ee,he,$e),le,tt&&o.createElement("div",{className:"flex items-center self-start justify-center z-1",style:{paddingTop:_}},l.Z.TextSpace,tt)),me,de,ue,undefined,pe,undefined);d.getPriority()&&(lt=o.createElement("div",{className:a.Z.classNames(d.getPriorityProps())}));var dt,ht=Ve;return dt={paneObject:n},o.createElement(ht,Z()({style:_e,className:we,ref:D},dt),lt,se,ut,fe)}));var ze=36;const qe=(0,f.Z)((function(e){var t=e.pane,n=(0,o.useState)(0),r=i()(n,2),a=r[0],s=r[1],c=(0,m.Z)(t.searchingPaneObjects),u=i()(c,1)[0],d=u.text,h=u.isSearching,p=(0,o.useRef)(),f=(0,o.useRef)(),g=f.current,v=function(){p.current=ge.Z.save(),ge.Z.reset()};(0,o.useEffect)((function(){h&&g&&!g.isFocused.get()&&(v(),g.focus(),g.selectAll())})),(0,o.useEffect)(v,[]);var y=(0,o.useMemo)((function(){return d?t.searchPaneObjects(d):[]}),[d]);(0,o.useEffect)((function(){k(0,!0)}),[d]);var k=function(e,n){s(e);var r=y[e];n||(p.current=void 0),t.searchingPaneObjects.setProperty("selectedPaneObject",null===r||void 0===r?void 0:r.id),r&&t.scrollToIndex(r.index,"center")},_=function(){if(t.searchingPaneObjects.set({text:""}),p.current)ge.Z.restore(p.current);else{var e=y[a];e&&ge.Z.selectObject(e,-1)}},Z=function(){return k(a<=0?y.length-1:a-1)},w=function(){return k(a>=y.length-1?0:a+1)};return o.createElement(ke.Z,null,o.createElement("div",{className:"absolute flex items-center mx-2 my-2 overflow-hidden rounded t-popup inset-r-0 inset-t-0"},o.createElement(x.Z,{width:150,noBackground:!0,height:ze,border:!1,fontSize:12,padding:{left:16,right:16},placeholder:"Find",value:d,onChange:function(e){t.searchingPaneObjects.setProperty("text",e)},onKeyDown:function(e){e.keyCode===l.Z.KeyCode.Escape?_():e.keyCode===l.Z.KeyCode.Enter&&(e.shiftKey?Z():w())},focused:!0,underline:!1,ref:f}),o.createElement("div",{className:"pr-2 text-right text-11 c-foreground-light",style:{minWidth:30}},d?"".concat(y.length?a+1:0,"/").concat(y.length):void 0),o.createElement("div",{className:"mx-2 t-popupDivider",style:{height:24,width:1}}),o.createElement(E.Z,{className:"t-popupButton noShrink",noHover:!0,width:ze,height:ze,icon:"IoIosArrowUp",onClick:Z}),o.createElement(E.Z,{className:"t-popupButton noShrink",noHover:!0,width:ze,height:ze,icon:"IoIosArrowDown",onClick:w}),o.createElement(E.Z,{className:"searchX t-popupButton noShrink",noHover:!0,width:ze,height:ze,icon:"MdClose",onClick:_})))}));var Ge=n(8721);var Ke=["children","className","renderSmall"];const Ye=(0,f.Z)((function(e){var t=e.children,n=e.className,r=e.renderSmall,i=b()(e,Ke),s=(0,o.useRef)(),c=(0,o.useRef)(),l=function(e,t){var n=(0,de.Z)(e),r=(0,de.Z)(t);return{overflowingX:n.width>0&&r.width>0&&n.width>r.width,overflowingY:n.height>0&&r.height>0&&n.height>r.height}}(c,s).overflowingX;return o.createElement("div",Z()({},i,{className:a.Z.classNames(n,"relative"),ref:s}),o.createElement("div",{className:a.Z.classNames(l&&"invisible"),ref:c},t),l&&o.createElement("span",{className:"absolute inset-0"},r()))}));var Xe={};function Qe(){var e=function(e){var t=(0,o.useState)(e),n=i()(t,2),r=n[0],s=n[1],c=(0,o.useRef)(Xe);return c.current===Xe&&(c.current=a.Z.isFunction(e)?e():e),[r,(0,o.useCallback)((function(e){a.Z.isFunction(e)&&(e=e(c.current)),c.current=e,s(e)}),[]),c]}(!1),t=i()(e,3),n=t[0],r=t[1],s=t[2];return[function(e){var t=(0,o.useRef)(null),n=(0,o.useRef)();return(0,o.useCallback)((function(r){t.current&&n.current&&n.current(t.current),r&&(n.current=e(r)),t.current=r}),[])}((function(e){var t=function(e){return r(!0)},n=function(t){for(var n=0,i=t.toElement,a=!1;i&&!a;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;i===e&&(a=!0),i=i.parentElement}a||r(!1)};if(e)return e.addEventListener("mouseover",t),e.addEventListener("mouseout",n),function(e){e.removeEventListener("mouseover",t),e.removeEventListener("mouseout",n)}})),n,s]}(0,f.Z)((function(e){var t=e.pane,n=(0,m.Z)(t.itemStatus,t.textStatus,s.default.settings.showStatusBar,ge.Z.selectedMapObs),r=i()(n,3),a=r[0],c=r[1],l=r[2],u=Qe(),d=i()(u,2),h=d[0],p=d[1];if(l&&a){var f=a.numItemsInView,g=a.numItemsFiltered,v=a.numItemsZoomed,y=a.numItemsDoc,k=c.numChars,_=c.numWords,Z=ge.Z.numSelected(t),w=0,b=0;if(1===Z){var P=ge.Z.getStartOffsetWithPrefix(),S=ge.Z.getEndOffsetWithPrefix(),D=ge.Z.getStartObject();if(P!==S){var I=Ge.Z.printLI(D.item,{plain:!0},P,D,S,D,!1,!1).plain;w=I.length,b=I.split(" ").filter((function(e){return!!e})).length}else Z=0}else Z>0&&ge.Z.getSelectedItems().forEach((function(e){w+=e.numChars,b+=e.numWords}));var E=function(e){var t="monospace "+(e?"pr-3":"pr-2");return o.createElement(o.Fragment,null,o.createElement("span",null,e?"document":"doc"," "),o.createElement("b",{className:t},y),o.createElement("span",null,"pane"," "),o.createElement("b",{className:t},v),o.createElement("span",null,"filter"," "),o.createElement("b",{className:t},g),o.createElement("span",null,e?"visible":"vis"," "),o.createElement("b",{className:t},f),o.createElement("span",null,e?"selected":"sel"," "),o.createElement("b",{className:t},Z),o.createElement("span",null,e?"words":"w"," "),o.createElement("b",{className:t},b||_),o.createElement("span",null,e?"chars":"ch"," "),o.createElement("b",{className:"monospace "+(e?"pr-1":"")},w||k))},x="pl-4 font-bold";return o.createElement("div",{className:"px-2 border-t t-border c-foreground-faded hide-print",ref:h},o.createElement(Ye,{className:"flex justify-end overflow-hidden leading-5 text-right text-12 whitespace-nowrap",renderSmall:E},E(!0)),p&&o.createElement("div",{className:"absolute bottom-0 right-0 p-2 mb-6 mr-4 rounded c-bg-menu c-shadow-popup"},o.createElement("table",null,o.createElement("tbody",null,o.createElement("tr",null,o.createElement("td",null,"Items in document"),o.createElement("td",{className:x},y)),o.createElement("tr",null,o.createElement("td",null,"Items in pane zoomed item"),o.createElement("td",{className:x},v)),o.createElement("tr",null,o.createElement("td",null,"Items matching filter"),o.createElement("td",{className:x},g)),o.createElement("tr",null,o.createElement("td",null,"Items visible (not collapsed)"),o.createElement("td",{className:x},f)),o.createElement("tr",null,o.createElement("td",null,"Items selected"),o.createElement("td",{className:x},Z)),o.createElement("tr",null,o.createElement("td",null,"Word count ",b?"in selection":""),o.createElement("td",{className:x},b||_)),o.createElement("tr",null,o.createElement("td",null,"Character count ",w?"in selection":""),o.createElement("td",{className:x},w||k))))))}return null}));const Je=(0,f.Z)((function(e){var t,n,r=e.pane,c=(0,m.Z)(r.paddingTop,r.item.get()._note,s.default.DisplaySettings._noteFontSize,r.item,r.viewState,null===(t=r.item.get()._note.get())||void 0===t?void 0:t.itemChanged),u=i()(c,3),d=u[0],h=u[1],p=u[2],f=(0,o.useRef)(),g=(r.isViewOutline()||r.isViewProjectNoBlocks(),r.isViewAgenda(),{paddingTop:d}),v=null===h||void 0===h?void 0:h.getNotePreviewMultiline();if(v){var y={fontSize:p,textOverflow:"ellipsis",paddingLeft:30,paddingRight:l.Z.ItemPaddingRightVirtuoso};n=o.createElement("div",{className:"relative pt-1 overflow-hidden font-normal cursor-pointer itemInPaneNote c-foreground-faded z-1",style:y,onClick:function(){s.default.DragDrop.isDraggingDelayed||r.openNoteContextMenu(h,f.current)},ref:f},v.map((function(e){return o.createElement("div",{key:e},e)})))}var k=function(e){ge.Z.isInMobileMultiselect()||(a.Z.preventAndStop(e),I.Z.app?requestAnimationFrame((function(){ge.Z.selectIndex(0,0)})):(ge.Z.selectIndex(0,0),a.Z.enforceBodyScroll()))};return o.createElement("div",{style:g},n,o.createElement("div",{className:"paneTopBox",onClick:k}))}));var $e=(0,f.Z)((function(e){var t=e.pane,n=300,r=(0,m.Z)(p.o0.isKeyboardOpen),a=i()(r,1)[0];n=t.rect.get().height-(a?40:160);return o.createElement("div",{className:"paneFooter hide-print",style:{height:n},onMouseDown:function(e){ge.Z.onClickPaneBottom(t,e)}})}));const et=(0,f.Z)((function(e){var t=e.className,r=e.pane,c=e.initialScrollIndex,u=(0,o.useRef)(),d=(0,m.Z)(r.items,s.default.settings.disableAnimations,s.default.DisplaySettings._itemPadding,s.default.DisplaySettings._itemLineHeight,r.searchingPaneObjects,r.isSearchingGlobal,s.default.DragDrop.dragging,s.default.DisplaySettings.isPrinting),h=i()(d,8),p=h[0],f=h[1],g=h[2],v=h[3],y=h[4],k=h[5],_=h[6],Z=h[7],w=(0,o.useRef)(),b=(0,o.useRef)(),P=(0,o.useRef)(p),S=P&&a.Z.isArrayEqualWithProperty(p,P.current,"id")?P.current:p;void 0===c&&(c=r.initialScrollIndex),(0,o.useEffect)((function(){r.paneContent=u.current,r.scrollElement=a.Z.findChild(u.current,"paneContent"),r.listManager.setVirtualList(b.current)}),[]);var D=(0,o.useCallback)((function(e){r.listManager.setScrollRange(e)}),[]),E=(0,o.useCallback)((function(e,t){if(!(t<0||t>=r.items.length())){var n=e.type,i=e.item;if(null===i||void 0===i||!i.isNote()){if("blockItem"===n)return o.createElement(We,{paneObject:e});if("blockHeader"===n)return o.createElement(Oe,{paneObject:e});if("blockAddItem"===n)return o.createElement(Re,{paneObject:e});if("footer"===n)return o.createElement(Fe,{paneObject:e})}}}),[]),x=(0,o.useMemo)((function(){var e=n(1150).Z;return o.createElement(o.Fragment,null,o.createElement(e,{pane:r}),o.createElement(Je,{pane:r}))}),[]),C=(0,o.useMemo)((function(){return o.createElement($e,{pane:r})}),[]),A=(0,o.useMemo)((function(){var e,t=n(1974).Z;return e=o.createElement(t,{inPane:!0}),o.createElement(o.Fragment,null,o.createElement(Me,{ref:w,pane:r}),e)}),[]),L=(0,o.useCallback)((function(e){if(f)return!1;if(e){var t=e.item;return fe.Z.shouldAnimate(null===t||void 0===t?void 0:t.id)}}),[f]),M=v+2*g;return o.createElement("div",{className:t,ref:u},o.createElement(be.Z,{className:"flex1 paneDocumentContent paneContent select-none break-words t-text",items:S,header:x,footer:C,floating:A,renderItem:E,onRangeChanged:D,shouldAnimate:!f&&!I.Z.isMobile&&L,initialScrollIndex:c>=0&&c<S.length?c:void 0,defaultItemSize:M,overscan:Z?1e8:l.Z.ListOverscan,pinIDs:(null===_||void 0===_?void 0:_.pane)===r?_.items.map((function(e){return e.id})):void 0,shouldMemoize:!0,ref:b}),!1,o.createElement(me,{className:"absolute inset-t-0 inset-r-0 z-5",initial:{y:-40},exit:{y:-60},transition:l.Z.TransitionSpringMediumer},y.isSearching&&o.createElement(qe,{pane:r})),o.createElement(me,{className:"absolute inset-x-0 flex justify-center inset-t-0 z-5",initial:{y:-40},exit:{y:-60},transition:l.Z.TransitionSpringMediumer},k&&o.createElement(Ee,{pane:r})))})),tt=(0,f.Z)((function(e){var t=e.className,n=e.pane,r=e.initialScrollIndex,c=e.ItemComponent,u=e.defaultItemSize,d=e.header,h=e.onEndReached,p=e.footer,f=(0,m.Z)(n.items,s.default.DisplaySettings.isPrinting),g=i()(f,2),v=g[0],y=g[1],k=(0,o.useRef)(),_=(0,o.useRef)(),Z=(0,o.useRef)(v),w=Z&&a.Z.isArrayEqualWithProperty(v,Z.current,"id")?Z.current:v;(0,o.useEffect)((function(){return n.paneContent=_.current,n.scrollElement=a.Z.findChild(_.current,"paneContent"),n.listManager.setVirtualList(k.current),n.onLoad(),function(){return n.onUnload()}}),[]);var b=(0,o.useCallback)((function(e){n.listManager.setScrollRange(e)}),[]),P=(0,o.useCallback)((function(e,t){if(!(t<0||t>=n.items.length()))return"blockItem"===e.type?o.createElement(c,{paneObject:e}):void 0}),[]);return o.createElement("div",{className:t,ref:_},o.createElement(be.Z,{className:"flex-1 paneContent select-none break-words t-text",items:w,header:d,footer:p,renderItem:P,onRangeChanged:b,defaultItemSize:u,initialScrollIndex:r>=0&&r<w.length?r:void 0,onEndReached:h,overscan:y?1e8:l.Z.ListOverscan,shouldMemoize:!0,ref:k}))})),nt=(0,f.Z)((function(e){var t=e.className,n=e.pane,r=e.initialScrollIndex,c=e.ItemComponent,u=(e.itemHeight,e.header),d=e.defaultItemSize,h=e.onEndReached,p=e.footer,f=(0,m.Z)(n.itemsSimple,s.default.DisplaySettings.isPrinting),g=i()(f,2),v=g[0],y=g[1],k=(0,o.useRef)(),_=(0,o.useRef)();(0,o.useEffect)((function(){return n.paneContent=_.current,n.scrollElement=a.Z.findChild(_.current,"paneContent"),n.listManager.setVirtualList(k.current),n.onLoad(),function(){return n.onUnload()}}),[]);var Z=(0,o.useCallback)((function(e){n.listManager.setScrollRange(e)}),[]),w=(0,o.useCallback)((function(e,t){if(!(t<0||t>=n.itemsSimple.length()))return"item"===e.type?o.createElement(c,{paneObject:e}):void 0}),[]);return o.createElement("div",{className:t,ref:_},o.createElement(be.Z,{className:"flex-1 paneContent select-none break-words t-text",items:v,header:u,footer:p,defaultItemSize:d,renderItem:w,onRangeChanged:Z,initialScrollIndex:r>=0&&r<v.length?r:void 0,onEndReached:h,overscan:y?1e8:l.Z.ListOverscan,shouldMemoize:!0,ref:k}))}));var rt=n(3926),it=n(9607),at=n(2701).Z;const ot=(0,f.Z)((function(e){var t=e.paneObject,n=t.item,r=(t.index,t.pane);(0,m.Z)(n.itemChanged);var c=[(0,o.useRef)()],u=i()(c,2),d=u[0],h=(u[1],n.getAttachmentByPlugin(l.Z.PluginID.Gmail)),p=h&&(r.type,l.Z.PaneMode.Gmail,h===s.default.EmailPreview.getThreadAttach()&&s.default.EmailPreview.isOpenOnPane(r));if((0,Ue.w)(t,d),!h)return o.createElement("div",null,"Failed to render");var f=null===h||void 0===h?void 0:h.getPlugin(),g=a.Z.classNames("paneGmailItem paneItemElement relative",f.getCssClass(h,r),{"c-background-item-selected":p}),v=rt.Z.renderPaneJSX(t);return o.createElement(at,{className:g,ref:d,paneObject:t,onPress:function(e){s.default.DragDrop.isDraggingDelayed||(f.isEmailOpenByItem(n,r)?s.default.EmailPreview.close():f.openEmailByItem(n,r))},supportMultiselect:!1},v)}));var st=n(1998);const ct=(0,f.Z)((function(e){var t,n=e.paneObject,r=n.item,c=(n.index,n.pane),u=c.plugin,d=r.getAttachmentByPlugin(l.Z.PluginID.Drive),h=c.isItemHeader(r,!1),p=c.isPaneObjectCollapsed(n),f=s.default.DisplaySettings.lineHeightForItem(n),g=c.getPaddingForPaneObject(n),v=(0,m.Z)(s.default.DisplaySettings._itemPadding,s.default.DisplaySettings._fontSize,r.itemChanged),y=i()(v,2),k=y[0],_=y[1],Z=a.Z.classNames("itemNew itemInPane paneItemElement relative flex items-center"),w={paddingLeft:g,paddingTop:k,paddingBottom:k,paddingRight:30,lineHeight:Math.floor(1.2*f)+"px",fontSize:_};if(h){var b=a.Z.classNames("collapserNew c-foreground-super-faded c-color-hover",{"collapsed icon-angle-right":p},{"icon-angle-down":!p}),P={marginLeft:-g,paddingRight:4,width:g,lineHeight:f+"px"};t=o.createElement("div",{className:b,style:P,"data-tooltip":"<b>Click</b> to open in Drive",onClick:function(e){s.default.DragDrop.isDraggingDelayed||(a.Z.preventAndStop(e),c.handleLeftSideTap(n,e))}})}return o.createElement("div",{className:Z,style:w,onClick:function(e){s.default.DragDrop.isDraggingDelayed||u.handleTapClick(r,c,d.id,e)},onMouseDown:function(e){r.checkDragOnStart(e)},onContextMenu:function(e){s.default.menus.openContextMenu({componentName:"ReactContextMenuItem",key:"menu"+r.id+e.clientX+e.clientY,element:e.target,item:r,pane:c,paneObject:n,showExtra:e.ctrlKey||e.altKey||e.metaKey,pos:{left:e.pageX,top:e.pageY}}),a.Z.preventAndStop(e)}},t,st.Z.renderPaneJSX(n))}));n(4372);var lt=n(2701).Z;const ut=(0,f.Z)((function(e){var t=e.paneObject,n=t.item,r=t.pane,c=t.index,u=n.subject,d=n.participants,h=n.snippet,p=n.date,f=n.labels,g=n.plugin,v=n.hasAttachment,y=(0,o.useRef)(),k=(0,m.Z)(n.isRead,n.isStarred,n.numMessages,r.zoomedItem,it.Z.getSelectedForPaneObs(r),ge.Z.selectedMapObs),_=i()(k,5),Z=_[0],w=_[1],b=_[2],P=_[3],S=(_[4],!!ge.Z.getSelection(t));(0,Ue.w)(t,y);(0,o.useCallback)((function(e){it.Z.isSelected(c,r)||it.Z.setSelected([c],r),s.default.menus.openContextMenu({componentName:"ReactContextMenuInboxItem",element:r.elementAtIndex(c),pane:r}),a.Z.preventAndStop(e)}),[c]),(0,o.useMemo)((function(){return{id:n.id,width:400,pane:r}}),[]);var D,I=a.Z.classNames("paneGmailItemContent inboxPane relative flex flex-col justify-center border-b c-border-light",{"c-background-item-selected":S});p&&(D=V.Z.isToday(p)?s.default.International.getFormat(l.Z.DFormat.ShortTime):p.getYear()!==(new Date).getYear()?s.default.International.getFormat(l.Z.DFormat.MonthDayYearShort):s.default.International.getFormat(l.Z.DFormat.MonthDay));var E=!Z&&a.Z.classNames("unreadDot",{selected:S}),x=null===f||void 0===f?void 0:f.filter((function(e){return"starred"!==e&&e!==P.label})),C=o.createElement(o.Fragment,null,w&&o.createElement("div",{className:"absolute inset-y-0 left-0 flex items-center",style:{paddingLeft:6,color:"#fd2"}},o.createElement(A.J,{name:"MdStar"})),!w&&!Z&&o.createElement("div",{className:E}),o.createElement("div",{className:"flex flex-row justify-between line1"},o.createElement("div",{className:a.Z.classNames("from c-foreground",{"font-bold":!Z})},d.map((function(e){return e.text||e.email})).join(", ")),o.createElement("div",{className:"emailDate c-foreground-faded"},null===p||void 0===p?void 0:p.toString(D))),o.createElement("div",{className:"flex flex-row justify-between line2"},o.createElement("div",{className:a.Z.classNames("subject c-foreground",{"font-bold":!Z})},u),o.createElement("div",{className:"flex items-center"},v&&o.createElement(A.J,{name:"MdAttachFile",size:16}),b>1&&o.createElement("div",{className:"count"},b))),o.createElement("div",{className:"flex flex-row items-center justify-between truncate line3"},h&&o.createElement("div",{className:"snippet c-foreground-faded"},h),(null===x||void 0===x?void 0:x.length)>0&&o.createElement("div",{className:"truncate tags py-0p5",style:{maxWidth:140}},x.map((function(e,t){return o.createElement("span",{key:e,className:a.Z.classNames("px-1p5 py-0p5 rounded t-tag",{"c-bg-gray-200":!S,"ml-1":t>0})},g.getLabelName(e))})))));return o.createElement(lt,{className:I,ref:y,paneObject:t,onPress:function(){r.onDoubleClick(t.index)},supportMultiselect:!1},C)})),dt=(0,f.Z)((function(e){var t,r=e.pane,s=(e.isPopup,e.initialScrollIndex),c=(e.startDragging,e.header),u=(e.renderLeftButtons,e.renderRightButtons,e.onEndReached),d=e.footer,h=(0,m.Z)(r.toast,r.viewState),f=i()(h,2),g=f[0],v=(f[1],r.type),y=a.Z.classNames("pane flex flex-col t-pane",r.paneClass);(0,o.useEffect)((function(){return r.onLoad(),j.Z.fireEvent("paneAdded",[r]),function(){return r.onUnload()}}),[]);var k="relative flex flex-col flex1 fontPane overflow-hidden";v===l.Z.PaneMode.Task?t=r.isViewCalendar()?o.createElement(pe,{className:k,pane:r,initialScrollIndex:s}):o.createElement(et,{className:k,pane:r,initialScrollIndex:s}):v===l.Z.PaneMode.Gmail?t=o.createElement(tt,{className:k,pane:r,initialScrollIndex:s,ItemComponent:ot,defaultItemSize:80,onEndReached:u,header:c,footer:d}):v===l.Z.PaneMode.Drive?t=o.createElement(tt,{className:k,pane:r,initialScrollIndex:s,ItemComponent:ct,defaultItemSize:33,header:c,footer:d}):v===l.Z.PaneMode.Inbox&&(t=o.createElement(nt,{className:k,pane:r,initialScrollIndex:s,ItemComponent:ut,defaultItemSize:80,onEndReached:u,header:c,footer:d}));var _,Z=null,w=(0,m.Z)(p.o0.keyboardHeight),b=i()(w,1)[0],P=n(9120).Z;if(Z=o.createElement(P,{pane:r}),r.type===l.Z.PaneMode.Task){var S=n(8623).Z,D=(0,o.useCallback)((function(){r.onTapAddItem()}),[]);_=0===b&&o.createElement(S,{pane:r,role:"add",onPress:D})}return o.createElement("div",{className:y},null,Z,t,_,g&&o.createElement("div",{className:"paneToasts"},o.createElement(B,{paneToast:g})))}));var ht=n(2694),pt=n(5657),ft=n(8262);const gt=(0,f.Z)((function(e){var t=e.pane,n=e.isPopup,r=e.initialScrollIndex,a=e.startDragging,c=(0,m.Z)(t.viewState,t.item,t.plugin.isLoadingThreads),u=i()(c,3),d=(u[0],u[1]),h=u[2],p=t.getViewMode(),f=function(e){return o.createElement(ht.Z,{key:"contextMenuGmailSort",id:"contextMenuGmailSort",element:e.element},o.createElement(pt.Z,null,"Sort by"),o.createElement(ft.Z,{icon:"icon-access_time",onClick:t.setViewMode.bind(t,l.Z.GmailViewMode.Date)},l.Z.GmailViewMode.Date),o.createElement(ft.Z,{icon:"icon-exclamation",onClick:t.setViewMode.bind(t,l.Z.GmailViewMode.Priority)},l.Z.GmailViewMode.Priority))},g=function(e){s.default.menus.openContextMenu({fn:f,element:e.target})},v=function(){t.setViewMode(p===l.Z.GmailViewMode.Date?l.Z.GmailViewMode.Priority:l.Z.GmailViewMode.Date),s.default.menus.closeContextMenu()},y=function(){var e,t=s.default.pluginManager.getPluginGmail();d&&(e=t.getAccountIDFromItem(d)),s.default.menus.openComposeEmail(t,{accountID:e})},k=(0,o.useMemo)((function(){return o.createElement("div",{style:{height:l.Z.Mobile.TopBarHeight}})}),[]),_=(0,o.useMemo)((function(){return o.createElement("div",{className:"py-4 text-center c-foreground-light"},"Loading more emails...")}),[]);return o.createElement(dt,{pane:t,isPopup:n,initialScrollIndex:r,startDragging:a,renderLeftButtons:function(){return o.createElement(N.Z,{icon:"icon-mail_outline",iconSize:15,onClick:y,tooltip:"New Email",tooltipHotkey:{name:"EmailCompose",group:"Global"}})},renderRightButtons:function(){return o.createElement(N.Z,{className:"emailViewButton",tooltip:"Sort Order",icon:p===l.Z.GmailViewMode.Date?"icon-access_time":"icon-exclamation",iconSize:14,width:l.Z.PaneHeaderButtonWidth,height:l.Z.PaneHeaderButtonHeight,onClick:v,onHold:g})},onEndReached:function(e){e>5&&t.onScrollEnd()},header:k,footer:h?_:void 0})})),mt=(0,f.Z)((function(e){var t=e.pane,n=e.isPopup,r=e.initialScrollIndex,a=e.startDragging,s=(0,m.Z)(t.plugin.isLoadingFiles),c=i()(s,1)[0],u=(0,o.useMemo)((function(){return o.createElement(o.Fragment,null,o.createElement("div",{style:{height:l.Z.Mobile.TopBarHeight}}),!1)}),[]),d=(0,o.useMemo)((function(){return o.createElement("div",{className:"px-6 py-4 c-foreground-light"},"Loading files...")}),[]);return o.createElement(dt,{pane:t,isPopup:n,initialScrollIndex:r,startDragging:a,renderRightButtons:function(){return o.createElement(o.Fragment,null,o.createElement(E.Z,{icon:"IoIosArrowForward",iconSize:16,width:l.Z.PaneHeaderButtonWidth,height:l.Z.PaneHeaderButtonIconHeight,onClick:t.toggleCollapseAll,tooltip:"Collapse all",tooltipHotkey:{name:"CollapseAll",group:"Pane"},disabled:!t.canCollapse()}))},header:u,footer:c?d:void 0})}));var vt=(0,f.Z)((function(e){var t=e.pane.pluginNew,n=(0,m.Z)(t.isFirstLoaded,s.default.settings.emailViewAccounts),r=i()(n,2),a=r[0],c=r[1];return o.createElement(o.Fragment,null,o.createElement("div",{style:{height:l.Z.Mobile.TopBarHeight}}),!a&&s.default.supportEmailViews()&&c.length>0&&o.createElement("div",{className:"flex items-center justify-center py-4 c-foreground-light"},"Loading..."),!1)})),yt=(0,f.Z)((function(e){var t=e.pane.pluginNew,n=(0,m.Z)(t.isLoadingMore),r=i()(n,1)[0];return r?o.createElement("div",{className:"flex items-center justify-center pt-6 pb-12 c-foreground-light"},r&&"Loading more..."):null}));const kt=(0,f.Z)((function(e){var t=e.pane,n=e.isPopup,r=e.initialScrollIndex,i=e.startDragging,a=(0,o.useMemo)((function(){return o.createElement(yt,{pane:t})}),[]),s=(0,o.useMemo)((function(){return o.createElement(vt,{pane:t})}),[]);return o.createElement(dt,{pane:t,isPopup:n,initialScrollIndex:r,startDragging:i,header:s,footer:a,onEndReached:function(e){e>40&&t.onEndReached()}})}));function _t(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=$()(e);if(t){var i=$()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Q()(this,n)}}const Zt=function(e){Y()(n,e);var t=_t(n);function n(){return z()(this,n),t.apply(this,arguments)}return G()(n,[{key:"render",value:function(){return o.createElement(N.Z,Z()({},this.props,{className:"fancyCalendarDayButton",iconSize:16,padding:0,tooltip:"Jump to Today",icon:"icon-calendar-o",center:!0}),this.props.day)}}]),n}(ne.a),wt=(0,f.Z)((function(e){var t=e.pane,n=e.isPopup,r=e.initialScrollIndex,a=e.startDragging,c=(0,m.Z)(t.hasCollapsedObs,s.default.settings.calendarCustomDays,V.Z.todayObs,t.viewState),u=i()(c,3),d=u[0],h=(u[1],u[2]),p=t.isViewCalendar(),f=t.getViewMode(),g=l.Z.TaskViewModeText[f],v=l.Z.SearchHeight,y=(d?"Expand":"Collapse")+" all items in view",k=(t.isViewAgenda()&&["Agenda_Today","Agenda_Week","Agenda_Month","Agenda_All"]||t.isViewCalendar(),o.createElement(o.Fragment,null,t.isViewCalendar()&&o.createElement(E.Z,{icon:"IoMdArrowDropleft",iconSize:20,width:20,height:v,onClick:function(){t.scrollJump(-1,"smooth")},disabled:!p,tooltip:"Previous "+g,noShrink:!0}),o.createElement(Zt,{day:h.getDate(),width:v+(t.isViewAgenda()?8:0),height:v,onClick:function(){t.scrollToToday("smooth")}}),t.isViewCalendar()&&o.createElement(E.Z,{icon:"IoMdArrowDropright",iconSize:20,width:20,height:v,onClick:function(){t.scrollJump(1,"smooth")},disabled:!p,tooltip:"Next "+g,noShrink:!0})));return o.createElement(dt,{pane:t,isPopup:n,initialScrollIndex:r,startDragging:a,renderRightButtons:function(e,n){return o.createElement(o.Fragment,null,t.isViewDates()&&k,t.supportCollapsing&&!t.isViewCalendar()&&o.createElement(E.Z,{icon:d?"IoIosArrowDown":"IoIosArrowForward",iconSize:14,padding:e,height:n,onClick:t.toggleCollapseAll,tooltip:y,tooltipHotkey:{name:"CollapseAll",group:"Pane"},disabled:!t.canCollapse()}))}})}));var bt=n(8047),Pt=n(3479),St=n(1186),Dt=n(9758),It=n(9713),Et=n.n(It);function xt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=$()(e);if(t){var i=$()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Q()(this,n)}}const Ct=function(e){Y()(n,e);var t=xt(n);function n(){return z()(this,n),t.apply(this,arguments)}return G()(n,[{key:"render",value:function(){var e=this.props,t={height:e.height},n=Et()({},I.Z.transform.react,"scale("+e.percent+", 1)"),r={lineHeight:e.height-2+"px"};return o.createElement("div",{className:"fancyProgressBar",style:t},!e.error&&o.createElement("div",{className:"fancyProgressInside",style:n}),e.error&&o.createElement("div",{className:"fancyProgressError",style:r},e.errorMsg))}}]),n}(ne.a);function At(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=$()(e);if(t){var i=$()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Q()(this,n)}}const Lt=function(e){Y()(n,e);var t=At(n);function n(){return z()(this,n),t.apply(this,arguments)}return G()(n,[{key:"init",value:function(){this.createObservables({attachments:[]}),this.onAttachmentUpdate(),this.props.threadAttach.subscribe(this)}},{key:"onUnmount",value:function(){this.props.threadAttach.unsubscribe(this)}},{key:"onAttachmentUpdate",value:function(){var e=this;this.props.threadAttach.getPlugin().getMessageDisplayAttachments(this.props.message).then((function(t){return e.attachments.set(t)}))}},{key:"onAttachmentIDChange",value:function(){}},{key:"isAttachImage",value:function(e){var t=e.mimeType;return"image/png"===t||"image/jpg"===t||"image/jpeg"===t||"image/gif"===t}},{key:"onClickAttach",value:function(e,t){if(e.error)e.uploader&&!e.uploader.isDone()&&e.uploader.resume();else if(!e.uploader||e.uploader.isDone()){var n=this._getURL(e);this.props.editable?s.default.openUrl(n):e.attID?I.Z.mac&&t.metaKey||!I.Z.mac&&t.ctrlKey||!this.isAttachImage(e)?a.Z.downloadFile(n,e.cid):s.default.menus.openLightbox(n,"Download",(function(){a.Z.downloadFile(n,e.cid)})):s.default.openUrl(n)}t.stopPropagation()}},{key:"onClickDelete",value:function(e,t){var n=this;a.Z.preventAndStop(t),k()(S().mark((function t(){var r,i;return S().wrap((function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:return r=n.props.threadAttach.getPlugin(),t.next=3,r.removeAttachFiles(n.props.threadAttach,n.props.message,e);case 3:i=t.sent,n.props.onUpdate&&n.props.onUpdate(i);case 5:case"end":return t.stop()}}}),t)})))()}},{key:"onAttachDragStart",value:function(e){var t=e.target.getAttribute("data-downloadurl");e.stopPropagation(),e.dataTransfer.setData("DownloadURL",t),s.default.DragDrop.setExternalData(t)}},{key:"_getURL",value:function(e){return this.props.editable||!e.attID?s.default.EmailPreview.getPreviewURL(e):s.default.EmailPreview.getAttachmentURL(this.props.threadAttach.getField("accountID"),this.props.message.id,e.attID)}},{key:"_renderAttachment",value:function(e){var t=e.mimeType+":"+e.cid+":"+this._getURL(e),n=e.uploader?a.Z.clamp(e.uploader.getPercent(),.05,1):1,r=this.isAttachImage(e)?"Click to open image.\n"+I.Z.priModKey+" click to download image.":"Click to download image";return o.createElement("div",{key:e.id,className:"messageAttachment flexbox c-button-raised",draggable:!0,"data-downloadurl":t,onClick:this.onClickAttach.bind(this,e),onDragStart:this.onAttachDragStart,"data-tooltip":r},o.createElement("div",{className:"attachmentIcon icon-drive-file"}),o.createElement("div",{className:"attachmentText"},e.cid),o.createElement("div",{className:"f1"}),n<1&&o.createElement(Ct,{percent:n,height:22,error:e.error,errorMsg:"Click to retry"}),1===n&&e.error&&o.createElement("div",null,"ERROR"),o.createElement("div",{className:"attachmentSize"},a.Z.toFileSize(e.size)),this.props.editable&&o.createElement(N.Z,{className:"attachmentClose",icon:"icon-close",onClick:this.onClickDelete.bind(this,e),tooltip:"Remove"}))}},{key:"render",value:function(){var e=null,t=this.state.attachments;if(t.length>0){for(var n=0,r=[],i=0;i<t.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var a=t[i];r.push(this._renderAttachment(a))}e=o.createElement("div",{className:"messageAttachments c-border"},r)}return e}}]),n}(ne.a);var Mt,Tt=n(3124),Rt=n.n(Tt),Ot=n(8572),Ft=n(9401);const Nt=(Mt=function(){function e(t,n,r){z()(this,e),this.plugin=t.getPlugin(),this.threadAttach=t,this.message=n,this._getEmailData=r}return G()(e,[{key:"onMount",value:function(){this._isMounted=!0}},{key:"onUnmount",value:function(){this._isMounted=!1,this.flushUnsavedChanges({updateRemoteDraft:!0,forceFlush:!0})}},{key:"onEmailChanged",value:function(){this.saveDraft({updateRemoteDraft:!0,forceFlush:!1})}},{key:"saveDraft",value:function(e){var t=e.updateRemoteDraft,n=e.forceFlush;clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0,this.needsSaveDraft=t,this.needsForceFlush=n,this._isMounted&&(this._draftUpdateDebounce=setTimeout(this.flushUnsavedChanges.bind(this,{updateRemoteDraft:t,forceFlush:n}),1e3))}},{key:"flushUnsavedChanges",value:function(e){var t=e.updateRemoteDraft,n=e.forceFlush;this._draftUpdateDebounce&&(clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0,this._saveDraftUpdates(this.needsSaveDraft||t,this.needsForceFlush||n),this.needsSaveDraft=!1,this.needsForceFlush=!1)}},{key:"discardDraft",value:function(){this.plugin.discardDraft(this.threadAttach,this.message.id,this.message.draftID,(function(e){try{a.Z.PAssert(1344,e,"Should always be able to delete a draft")}catch(t){a.Z.reportError(t)}}))}},{key:"getComposeBody",value:function(){var e=k()(S().mark((function e(t){var n;return S().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(!t||!t.decoded){e.next=4;break}return e.next=3,Ft.Z.getComposeBody(t.decoded,t.resources);case 3:n=e.sent;case 4:return e.abrupt("return",n);case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"createTokensFromAddressText",value:function(e){var t=[];if(e)for(var n=0,r=0;r<e.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=e[r];i.text?t.push(i):i.email&&t.push({email:i.email,text:i.email})}return{tokens:t}}},{key:"_saveDraftUpdates",value:function(e,t){if(a.Z.shouldLog(l.Z.LogLevels.Compose)&&a.Z.log("Queue Save Draft: ",this.threadAttach.id,this.message.id,this.message.draftID,this._isMounted),this._isMounted){var n=this._getEmailData();this.plugin.updateDraft(this.threadAttach,this.message.id,this.message.draftID,n,e,t,(function(e){console.log("draft updated",e);try{a.Z.PAssert(1345,e,"Should always be able to update a draft")}catch(t){a.Z.reportError(t)}}))}}},{key:"prepForSend",value:function(e,t){this.flushUnsavedChanges({updateRemoteDraft:!1,forceFlush:!1}),e.to&&e.to.length?e.subject?e.decoded?t():s.default.menus.confirm("There is no email body. Send anyway?",(function(e){e&&t()})):s.default.menus.confirm("There is no email subject. Send anyway?",(function(e){e&&t()})):s.default.menus.alert({text:"Please enter a recipient."})}},{key:"changeFrom",value:function(){var e=k()(S().mark((function e(t){var n,r,i,a,o,s;return S().wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:return n=this.threadAttach,r=this.plugin.getSyncAccount(t),i=this.plugin.getSendingAccountInfo(t),this.flushUnsavedChanges({updateRemoteDraft:!1,forceFlush:!1}),e.next=6,this.plugin.changeMessageAccount(n,this.message.id,this.message.draftID,r,t,i);case 6:return a=e.sent,o=this.plugin.getDraftByID(r,a.threadID,a.messageID),this.threadAttach=o.attach,this.message=o.draftMsg,this.saveDraft({updateRemoteDraft:!0,forceFlush:!1}),e.next=13,this.getComposeBody(this.message);case 13:if(e.t0=e.sent,e.t0){e.next=16;break}e.t0="";case 16:return s=e.t0,e.abrupt("return",{body:s,threadAttach:this.threadAttach,message:this.message});case 18:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Rt()(Mt.prototype,"flushUnsavedChanges",[Ot.ZP],Object.getOwnPropertyDescriptor(Mt.prototype,"flushUnsavedChanges"),Mt.prototype),Mt);function Bt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=$()(e);if(t){var i=$()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Q()(this,n)}}const Ut=function(e){Y()(n,e);var t=Bt(n);function n(){return z()(this,n),t.apply(this,arguments)}return G()(n,[{key:"init",value:function(){var e=this.props;this.threadAttach=e.threadAttach,this.message=e.message,this._composeHelper=new Nt(this.threadAttach,this.message,this.getEmailData),this._dragEnterCounter=0,this._escapedFromDrag=!1,this.to=this._composeHelper.createTokensFromAddressText(this.message.to),this.cc=this._composeHelper.createTokensFromAddressText(this.message.cc);var t=!!this.message.cc&&this.message.cc.length>0;if(this.createObservables({showSubject:e.showSubject,showCc:t,showBcc:!1,isSending:!1,isDragOver:!1}),this.listenTo(St.Z.onAccountsUpdated),this.message.inReplyTo){var n=this.threadAttach.getData().messages,r=n.indexOfWithProperty("messageID",this.message.inReplyTo);if(r>=0){var i=n[r];try{a.Z.PAssert(1261,i.initializedForDisplay,"Message must be ready to display if being replied to")}catch(s){a.Z.reportError(s)}i&&i.responseMode&&(this.modeListener=i.responseMode.listen(this.onReplyModeChanged))}}a.Z.isDemoMode()&&(a.Z.reactEmailCompose=this),this.refBody=o.createRef(),this.refContainer=o.createRef(),this.refPicker=o.createRef(),this.refTo=o.createRef(),this.refCc=o.createRef(),this.refBcc=o.createRef(),this.refSubject=o.createRef(),this.refFrom=o.createRef(),this.refLink=o.createRef()}},{key:"onReplyModeChanged",value:function(){this.to=this._composeHelper.createTokensFromAddressText(this.message.to),this.cc=this._composeHelper.createTokensFromAddressText(this.message.cc),this.cc&&this.cc.tokens&&this.cc.tokens.length>0&&this.showCc.set(!0),this.updateState()}},{key:"_getHotkeys",value:function(){return[s.default.hotkeys.create(l.Z.KeyCode.Escape,!0,l.Z.Primary.Either,l.Z.Shift.Either,this.onEscape),s.default.hotkeys.create(l.Z.KeyCode.Enter,!0,l.Z.Primary.Yes,l.Z.Shift.Either,this.sendEmail),s.default.hotkeys.create(l.Z.KeyCode.K,!0,l.Z.Primary.Yes,l.Z.Shift.No,this.insertLinkHotkey)]}},{key:"getPlugin",value:function(){return this.threadAttach.getPlugin()}},{key:"getState",value:function(){return{attachments:this.getPlugin().getMessageDisplayAttachments(this.message),fromAccounts:this.getSendingAccounts()}}},{key:"onMount",value:function(){var e=this;this._composeHelper.onMount(),k()(S().mark((function t(){var n,r;return S().wrap((function(t){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(t.prev=t.next){case 0:return t.next=2,e._composeHelper.getComposeBody(e.message);case 2:(n=t.sent)&&e.refBody.current.setValue(n),e.refContainer.current.addEventListener("cdrop",e.onItemDrop),(r=e.refPicker.current).addEventListener("change",(function(){return e.getPlugin().notifyAttachFiles(e.threadAttach,e.message,r.files,e.onAttachUpdated),r.value=null,!1}),!1),e.refContainer.current.addEventListener("paste",(function(t){var n=t&&t.clipboardData?t.clipboardData:t.synthetic?t.data:window.clipboardData;if(n&&n.items&&n.items.length>0){for(var r=0,i=0,a=[],o=0;o<n.items.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;"file"===n.items[o].kind&&a.push(n.items[o].getAsFile())}if(a.length>0)return e.getPlugin().notifyAttachFiles(e.threadAttach,e.message,a,e.onAttachUpdated),!1}}),!1),document.addEventListener("mouseup",e.onMouseUp),document.addEventListener("keydown",e.onKeyDown);case 10:case"end":return t.stop()}}}),t)})))()}},{key:"onUnmount",value:function(){this.modeListener&&(this.modeListener.dispose(),this.modeListener=void 0),this._composeHelper.onUnmount(),document.removeEventListener("mouseup",this.onMouseUp)}},{key:"discard",value:function(){this.close(!1,!0,!0)}},{key:"onEscape",value:function(){var e=this;this.isDragOver.get()||(this.refTo.current.getTokens().length>0||this.refBody.current.getValue()||this.state.attachments.length>0?s.default.menus.confirm("Do you want to discard this draft?",(function(t){t&&e.discard()})):this.discard())}},{key:"onFocus",value:function(){this.__hotkeys||(this.__hotkeys=s.default.hotkeys.pushStack(this._getHotkeys())),ge.Z.reset()}},{key:"onBlur",value:function(){this.__hotkeys&&(s.default.hotkeys.popStack(this.__hotkeys),this.__hotkeys=void 0)}},{key:"onClickAttach",value:function(){this.refPicker.current.click()}},{key:"onAttachUpdated",value:function(e){this._isMounted&&(this.onDraftChanged(),e&&this._composeHelper.flushUnsavedChanges({updateRemoteDraft:!0,forceFlush:!0}),this.updateState())}},{key:"onDragEnter",value:function(e){e.preventDefault(),this._escapedFromDrag||(this._dragEnterCounter++,this.isDragOver.set(!0))}},{key:"onDragLeave",value:function(){this._dragEnterCounter--,0===this._dragEnterCounter&&this.isDragOver.set(!1)}},{key:"onMouseUp",value:function(){this._escapedFromDrag=!1,this.isDragOver.set(!1)}},{key:"onKeyDown",value:function(e){e.keyCode===l.Z.KeyCode.Escape&&this.isDragOver.get()&&(this._escapedFromDrag=!0,this.isDragOver.set(!1))}},{key:"onFileDrop",value:function(e){if(!this._escapedFromDrag){this.isDragOver.set(!1);var t=e.dataTransfer;if(t.files&&t.files.length>0)this.getPlugin().notifyAttachFiles(this.threadAttach,this.message,t.files,this.onAttachUpdated.bind(this)),e.preventDefault(),e.stopPropagation(),s.default.DragDrop.stop(),s.default.DragDrop.finish()}}},{key:"onItemDrop",value:function(e){if(e.item&&e.item.hasAttachmentType(l.Z.PluginType.Storage)){var t=e.item.getAttachmentByType(l.Z.PluginType.Storage);this.getPlugin().notifyAttachLinkedFile(this.threadAttach,this.message,t,this.onAttachUpdated.bind(this))}}},{key:"close",value:function(e,t,n){try{a.Z.PAssert(1262,a.Z.isBoolean(e),"Must supply a valid value for sendDraft")}catch(r){a.Z.reportError(r)}try{a.Z.PAssert(1263,a.Z.isBoolean(t),"Must supply a valid value for discardDraft")}catch(r){a.Z.reportError(r)}try{a.Z.PAssert(1264,a.Z.isBoolean(n),"Must supply a valid value for forceFlush")}catch(r){a.Z.reportError(r)}a.Z.shouldLog(l.Z.LogLevels.Compose)&&a.Z.log("Compose Close: ",e,t,n),!e&&t?this._composeHelper.discardDraft():this._composeHelper.flushUnsavedChanges({updateRemoteDraft:e,forceFlush:n}),this.props.onClose()}},{key:"openSubject",value:function(){var e=this;this.showSubject.set(!0),setTimeout((function(){e._setFocus(e.refSubject.current),e.refSubject.current.selectEnd()}),0)}},{key:"openCc",value:function(){var e=this;this.showCc.set(!0),setTimeout((function(){e._setFocus(e.refCc.current)}),0)}},{key:"openBcc",value:function(){var e=this;this.showBcc.set(!0),setTimeout((function(){e._setFocus(e.refBcc.current)}),0)}},{key:"focusTo",value:function(){this._setFocus(this.refTo.current)}},{key:"focusBody",value:function(){this._setFocus(this.refBody.current)}},{key:"_setFocus",value:function(e){e.isFocused.get()||e.focus()}},{key:"onClickSend",value:function(){this.sendEmail()}},{key:"sendEmail",value:function(){var e=this;this._composeHelper.prepForSend(this.message,k()(S().mark((function t(){return S().wrap((function(t){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(t.prev=t.next){case 0:return Le.Z.clearSelection(),e.isSending.set(!0),t.next=4,e.getPlugin().sendEmail(e.threadAttach,e.message);case 4:t.sent?e.close(!1,!1,!0):e.isSending.set(!1);case 6:case"end":return t.stop()}}}),t)}))))}},{key:"onDraftChanged",value:function(){this._composeHelper.saveDraft({updateRemoteDraft:!0,forceFlush:!1})}},{key:"getEmailData",value:function(){this.props;return{id:this.message.id,to:this.refTo.current.getTokens(),cc:this.refCc.current&&this.refCc.current.getTokens(),bcc:this.refBcc.current&&this.refBcc.current.getTokens(),subject:this.refSubject.current&&this.refSubject.current.getValue()||this.message.subject,decoded:this.refBody.current.getValue(),snippet:this.refBody.current.getTextValue()}}},{key:"onChangeFrom",value:function(){var e=this;k()(S().mark((function t(){var n,r;return S().wrap((function(t){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(t.prev=t.next){case 0:return n=e.refFrom.current.value,t.next=3,e._composeHelper.changeFrom(n);case 3:r=t.sent,e.threadAttach=r.threadAttach,e.message=r.message,e.refBody.current.setValue(r.body);case 7:case"end":return t.stop()}}}),t)})))()}},{key:"getSendingAccounts",value:function(){var e,t=this.getPlugin();return this.message.inReplyTo&&(e=this.threadAttach.getField("accountID")),t.getSendingAccounts(e)}},{key:"insertLinkHotkey",value:function(){this.refBody.current.hasFocus()&&this.insertLink()}},{key:"insertLink",value:function(){var e=Le.Z.getSelectedText(),t=this.refLink.current.getElement();this.savedSel=Le.Z.getSelectionRange(),s.default.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:t,onClosed:this.onInsertLinkClosed,onInsertLink:this.onInsertLink,text:e})}},{key:"onInsertLinkClosed",value:function(){this.savedSel&&(this.refBody.current.focus(),Le.Z.setSelectionRange(this.savedSel))}},{key:"onInsertLink",value:function(e){var t=document.createElement("a");t.href=e.url,t.innerText=e.text,this.refBody.current.insertNode(t)}},{key:"render",value:function(){var e=this.state,t=this.props,n=this.to,r=this.cc,i="(no subject)"===this.message.subject?"":this.message.subject,s=this.state.showCc||this.cc&&this.cc.length>0,u=8+(s?0:28)+(e.showBcc?0:34),d=this.message.from.email,h=e.fromAccounts.slice(0),p=e.fromAccounts.length>1,f=a.Z.classNames("emailCompose validDropTarget flexbox flexvert",t.className);h.remove(d),h.unshift(d);var g=a.Z.classNames("composeHeader c-border-heavy",{showingFrom:e.fromAccounts.length>1});return o.createElement("div",{className:f,style:{},ref:this.refContainer,onFocus:this.onFocus,onBlur:this.onBlur,onDrop:this.onFileDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave},o.createElement("div",{className:g},o.createElement("div",{className:"composeButtons"},!e.showSubject&&o.createElement(N.Z,{height:24,padding:6,onClick:this.openSubject},"Subject"),!s&&o.createElement(N.Z,{height:24,padding:6,onClick:this.openCc},"Cc"),!e.showBcc&&o.createElement(N.Z,{height:24,padding:6,onClick:this.openBcc},"Bcc")),o.createElement(x.Z,{className:"toBox",height:50,floatingText:"To",display:"block",ref:this.refTo,tokens:n.tokens,focused:"to"===this.props.focus,autocompleteMode:"email",padding:{right:0},margin:{right:u},onChange:this.onDraftChanged,onEscape:t.onEscape}),s&&o.createElement(x.Z,{height:50,floatingText:"Cc",display:"block",ref:this.refCc,tokens:r.tokens,autocompleteMode:"email",padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),e.showBcc&&o.createElement(x.Z,{height:50,floatingText:"Bcc",display:"block",ref:this.refBcc,autocompleteMode:"email",padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),e.showSubject&&o.createElement(x.Z,{height:50,floatingText:"Subject",display:"block",ref:this.refSubject,value:i,padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),p&&o.createElement("div",{className:"composeFrom"},o.createElement("span",null,"From"),o.createElement("select",{ref:this.refFrom,onChange:this.onChangeFrom},h.map((function(e){return o.createElement("option",{key:e,value:e},e)}))))),o.createElement(Dt.Z,{className:"emailComposeTextarea c-border-heavy f1",ref:this.refBody,onChange:this.onDraftChanged,spellCheck:!0,onEscape:t.onEscape,editable:!e.isSending,richText:!0}),o.createElement(Lt,{onUpdate:this.onAttachUpdated,threadAttach:this.threadAttach,message:this.message,editable:!0}),o.createElement("div",{className:"composeFooter"},o.createElement(N.Z,{className:"discardDraft",icon:"icon-delete",iconSize:20,onClick:this.discard,tooltip:"Discard Draft"}),o.createElement(N.Z,{className:"attachFile",icon:"icon-attach_file",iconSize:20,marginLeft:8,onClick:this.onClickAttach,tooltip:"Attach File"}),o.createElement(N.Z,{className:"insertLink",icon:"icon-link",ref:this.refLink,iconSize:20,marginLeft:8,onClick:this.insertLink,tooltip:"Insert Link"}),this.state.isSending?o.createElement(c.Z,{inline:!0,color:l.Z.ColorBrand,style:{height:32,lineHeight:"32px",fontWeight:"bold"}},"Sending..."):o.createElement(N.Z,{className:"buttonSend",primary:!0,marginLeft:16,onClick:!this.state.isSending&&this.onClickSend},e.isSending?"Sending...":"SEND")),o.createElement("input",{type:"file",ref:this.refPicker,className:"hidden",multiple:!0}),e.isDragOver&&o.createElement("div",{className:"dropNotice flexbox flex-center"},o.createElement("div",{className:"dropBg absFull"}),o.createElement("div",{className:"f1 center"},o.createElement("div",{className:"icon-attach_file"}),o.createElement("div",null,"Drop to attach"))))}}]),n}(ne.a);function jt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=$()(e);if(t){var i=$()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Q()(this,n)}}const Ht=function(e){Y()(n,e);var t=jt(n);function n(){return z()(this,n),t.apply(this,arguments)}return G()(n,[{key:"init",value:function(){this.refMessage=o.createRef(),this.refCompose=o.createRef()}},{key:"componentDidUpdate",value:function(){this._updateFocus()}},{key:"onMount",value:function(){this.refMessage.current&&(this.scrollIntoView(),this._updateFocus())}},{key:"getState",value:function(){var e=this.props.inReplyToMessage;return{responseMode:e.responseMode,replytoMessageHeight:e.height}}},{key:"onAfterChanged",value:function(e,t){e.replytoMessageHeight!==t.replytoMessageHeight&&this.scrollIntoView()}},{key:"scrollIntoView",value:function(){var e=this.refMessage.current;if(e){var t=a.Z.findParent(e,"fancyScrollContent"),n=e.offsetTop+e.offsetHeight-t.clientHeight+16;a.Z.scrollTo(0,n,"smooth",t)}}},{key:"_updateFocus",value:function(){var e=this.state.responseMode;switch(e){case l.Z.EmailResponseMode.None:break;case l.Z.EmailResponseMode.Reply:case l.Z.EmailResponseMode.ReplyAll:this.focusBody();break;case l.Z.EmailResponseMode.Forward:case l.Z.EmailResponseMode.Compose:this.focusTo();break;default:try{a.Z.PAssert(917,!1,"Unknown response mode for reply box",e)}catch(t){a.Z.reportError(t)}}}},{key:"focusTo",value:function(){this.refCompose.current.focusTo()}},{key:"focusBody",value:function(){this.refCompose.current.focusBody()}},{key:"onClose",value:function(){s.default.EmailPreview.setMessageResponseMode(this.props.inReplyToMessage.id,l.Z.EmailResponseMode.None)}},{key:"render",value:function(){return this.state.responseMode!==l.Z.EmailResponseMode.None?o.createElement("div",{className:"emailReplyBox emailBox c-shadow-popup",ref:this.refMessage},o.createElement(Ut,{threadAttach:this.props.threadAttach,message:this.props.message,ref:this.refCompose,onClose:this.onClose})):null}}]),n}(ne.a);var Vt=n(8276);function Wt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=$()(e);if(t){var i=$()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Q()(this,n)}}const zt=function(e){Y()(n,e);var t=Wt(n);function n(){return z()(this,n),t.apply(this,arguments)}return G()(n,[{key:"init",value:function(){this._initializedFrame=!1,this.createObservables({hovered:!1}),this.refFrame=o.createRef(),this.refMessage=o.createRef()}},{key:"onMount",value:function(){this.props.isLastMessage&&this.props.index>0&&(this.needsScrollIntoView=!0),this.checkIsHovered(),this._initializeFrame()}},{key:"_initializeFrame",value:function(){if(!this._initializedFrame){var e=this.refFrame.current;if(e){this._initializedFrame=!0;var t=e.contentWindow.document;I.Z.supportBlobURLIFrame||(t.open(),t.write(this.props.message.blob),t.close())}}}},{key:"getState",value:function(){var e=this.props,t=e.message,n=e.threadAttach,r=s.default.pluginManager.getPluginGmail();return{responseMode:t.responseMode,height:t.height,width:t.width,shouldUseNewEmailPlugin:n&&r.shouldUseNewEmailPlugin(s.default.EmailPreview.threadAttach)}}},{key:"onAfterChanged",value:function(e,t){this._initializeFrame(),e.height!==t.height&&e.height>0&&(this.checkIsHovered(),this.needsScrollIntoView&&(this.needsScrollIntoView=!1,this.scrollIntoView()))}},{key:"checkIsHovered",value:function(){var e=ge.Z.getMousePos(),t=document.elementFromPoint(e.x,e.y);t&&(a.Z.findParent(t,"emailMessageWrapper")===this.refMessage.current&&this.hovered.set(!0))}},{key:"scrollIntoView",value:function(){var e=this.refMessage.current,t=a.Z.findParent(e,"fancyScrollContent"),n=0;n=e.clientHeight>t.clientHeight?e.offsetTop:t.scrollHeight-t.clientHeight,a.Z.scrollTo(0,n,"auto",t)}},{key:"onClickHeader",value:function(){this.props.toggleExpanded()}},{key:"onMouseEnterMessage",value:function(){this.hovered.set(!0)}},{key:"onMouseLeaveMessage",value:function(){this.hovered.set(!1)}},{key:"openResponse",value:function(e){if(this.state.shouldUseNewEmailPlugin){var t=s.default.pluginManager.getPluginGmail().getURLForAttachment(this.props.threadAttach);s.default.openUrl(t)}else s.default.EmailPreview.setMessageResponseMode(this.props.message.id,e)}},{key:"onClickReply",value:function(){this.openResponse("Reply")}},{key:"onClickReplyAll",value:function(){this.openResponse("Reply All")}},{key:"onClickForward",value:function(){this.openResponse("Forward")}},{key:"onClickReport",value:function(){s.default.menus.openModal(l.Z.Modals.ReportProblem,{accountID:this.props.threadAttach.getField("accountID"),threadID:this.props.threadAttach.id,msgID:this.props.message.id})}},{key:"_generateParticipantText",value:function(e){return e.text?e.text:e.email}},{key:"isExpanded",value:function(){return this.props.expanded||this.props.isLastMessage||this.state.responseMode!==l.Z.EmailResponseMode.None}},{key:"openEmailDetails",value:function(e){var t=this.refs.messageHeaderText;s.default.menus.openContextMenu({componentName:"ReactContextMenuEmailDetails",element:t,message:this.props.message,accountID:this.props.threadAttach.getField("accountID")}),e.stopPropagation()}},{key:"render",value:function(){var e=this.props,t=this.state,n=e.message,r=this.isExpanded(),i={height:t.height},c=s.default.International.formatDate(n.date,l.Z.DFormat.MonthDay),u=s.default.International.formatDate(n.date,l.Z.DFormat.ShortTime),d=I.Z.windowWidth()>1080&&!a.Z.isDemoMode();r||t.hovered,d&&t.hovered;var h,p={cursor:r?"pointer":null},f=o.createElement("span",{className:"from",onClick:r?this.openEmailDetails:void 0,style:p},this._generateParticipantText(n.from));if(r){var g=(n.to?n.to:[]).concat(n.cc?n.cc:[]).map(this._generateParticipantText).join(", ");h=o.createElement("span",{className:"to c-foreground-faded",onClick:this.openEmailDetails,style:{cursor:"pointer"}},o.createElement("i",{className:"icon-long-arrow-right"}),o.createElement("span",null,g))}else h=o.createElement("span",{className:"snippet",dangerouslySetInnerHTML:{__html:n.snippet}});var m,v=o.createElement("span",{className:"emailDate c-foreground-faded"},o.createElement("div",{className:"emailDateDate"},c),o.createElement("div",{className:"emailDateTime"},u)),y=o.createElement(Vt.Z,{className:"messageHeader flexbox",onClick:this.onClickHeader},o.createElement("span",{className:"messageHeaderText f1",ref:"messageHeaderText"},f,h),!1,v);m=I.Z.supportBlobURLIFrame?o.createElement("iframe",{key:"ep_"+this.props.message.id,ref:this.refFrame,sandbox:"allow-scripts allow-same-origin",seamless:!0,id:"emailPreview_"+this.props.message.id,className:"emailPreviewFrame",src:n.blobURL,style:i,scrolling:"no"}):o.createElement("iframe",{key:"ep_"+this.props.message.id,ref:this.refFrame,sandbox:"allow-scripts allow-same-origin",seamless:!0,id:"emailPreview_"+this.props.message.id,className:"emailPreviewFrame",style:i});var k=a.Z.classNames("emailMessage emailBox c-border",{collapsed:!r},{prevCollapsed:!e.prevExpanded},{nextCollapsed:!e.nextExpanded}),_=a.Z.classNames("emailMessageWrapper",{replying:t.responseMode!==l.Z.EmailResponseMode.None});return o.createElement("div",{className:_,onMouseEnter:this.onMouseEnterMessage,onMouseLeave:this.onMouseLeaveMessage,ref:this.refMessage},o.createElement("div",{className:k},y,r&&o.createElement("div",{className:"messageContent",style:{}},m,o.createElement(Lt,{threadAttach:e.threadAttach,message:e.message,editable:!1}))),!1)}}]),n}(ne.a);var qt=n(7994);var Gt=function(e,t){return"https://mail.google.com/mail/u/".concat(e,"#all/").concat(t)};const Kt=(0,f.Z)((function(e){var t=e.accountID,n=e.threadID,r=e.needsFixSubject,s=e.isInFront,c=e.pane,l=e.onFixSubject,u=(0,o.useRef)(),d=(0,o.useRef)(),h=(0,o.useRef)(),p=(0,ue.Z)({accountID:t,threadID:n,needsFixSubject:r,onFixSubject:l}),f=(0,o.useState)(!1),g=i()(f,2),m=g[0],v=g[1],y=function(e,t){var n=(0,o.useRef)(),r=(0,o.useCallback)(function(){var r=k()(S().mark((function r(i,a){var o,s;return S().wrap((function(r){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(r.prev=r.next){case 0:if(n.current=i,o=t.current,!a){r.next=9;break}return r.next=5,qt.Z.getPluginNew("Email").resolveThreadHash(e,i);case 5:s=r.sent,o.executeJavaScript("location.assign('".concat(s,"')")),r.next=10;break;case 9:o.send("open-thread",i);case 10:case"end":return r.stop()}}}),r)})));return function(e,t){return r.apply(this,arguments)}}(),[]);return(0,o.useEffect)((function(){t.current.addEventListener("ipc-message",(function(e){var t=e.channel,i=e.args;"failed-load"===t&&i[0]===n.current&&r(n.current,!0)}))}),[]),{openThread:r}}(t,u).openThread;(0,o.useEffect)((function(){var e=u.current;e.addEventListener("dom-ready",(function(){h.current||(h.current=!0,v(!0))})),e.addEventListener("will-navigate",(function(t){if(t.url.startsWith("https://accounts.google.com/CheckCookie")){var n=Gt(p.current.accountID,p.current.threadID);n&&e.loadURL(n)}})),e.addEventListener("did-navigate",(function(t){var n=t.url,r=Gt(p.current.accountID,p.current.threadID);!n.startsWith("https://mail.google.com")||n.includes("#")&&!n.endsWith("#inbox")?(!function(e,t){e.send("accountID",t),setTimeout((function(){e.send("accountID",t)}),0)}(e,p.current.accountID),p.current.needsFixSubject&&e.send("get-subject",p.current.threadID)):r&&e.loadURL(r)})),e.addEventListener("ipc-message",(function(e){var t=e.channel,n=e.args;if("link-clicked"===t){var r=n[0];r&&a.Z.openUrl(r)}else if("onAction"===t){var o=n[0],s=qt.Z.getPluginNew("Email").getById(p.current.threadID);"report"===o?s.labels.pushIfUnique("spam"):"archive"===o?s.labels.remove("inbox"):"delete"===o&&s.labels.pushIfUnique("trash"),c.updateItemsImmediate()}else if("fix-subject"===t){var l=i()(n,2),u=l[0],d=l[1];p.current.onFixSubject(u,d)}}))}),[]),(0,o.useEffect)((function(){var e=u.current;m&&t&&n&&(d.current?y(n):(d.current=!0,e.loadURL(Gt(t,n))),r&&e.send("get-subject",n))}),[m,t,n,y,r]);var _={zIndex:s?1:0},Z=I.Z.getWebviewUserAgent();return o.createElement("webview",{src:"about:blank",className:"absolute inset-0",style:_,preload:"file:emailpreview.js",useragent:Z,allowpopups:"on",ref:u})}));const Yt=(0,f.Z)((function(e){var t,n=e.account,r=e.thread,s=e.isInFront,c=e.pane,u=n.e,d=n.n,h=qt.Z.getPluginNew("Email"),p="".concat(h.getURLForOutlookAccount(n),"/mail"),f=(0,o.useRef)(),g=(0,o.useRef)(),m=(0,ue.Z)({accountID:u,thread:r}),v=(0,o.useState)(!1),y=i()(v,2),k=y[0],_=y[1],Z=(0,o.useRef)(0);t={},Et()(t,l.Z.KeyCode.Alt,(function(e){Z.current>=0&&(Z.current++,Z.current>9&&(g.current&&f.current.send("debugShowEverything"),Z.current=void 0))})),Et()(t,"default",(function(e){Z.current&&(Z.current=0)})),_e(t,[],"keydown"),(0,o.useEffect)((function(){var e=f.current;e.addEventListener("dom-ready",(function(){g.current||(g.current=!0,_(!0))})),e.addEventListener("did-navigate",(function(t){t.url;!function(e,t){e.send("accountID",t),setTimeout((function(){e.send("accountID",t)}),0)}(e,m.current.accountID)})),e.addEventListener("ipc-message",(function(e){var t=e.channel,n=e.args;if("link-clicked"===t){var r=n[0];r&&a.Z.openUrl(r)}else if("onAction"===t){var i=n[0],o=qt.Z.getPluginNew("Email").getById(m.current.thread.id);"Archive"===i?o.labels.remove("inbox"):"Delete"===i&&o.labels.pushIfUnique("trash"),c.updateItemsImmediate()}}))}),[]),(0,o.useEffect)((function(){var e,t=f.current;k&&u&&r&&t.send("openThread",{threadID:r.id,date:null===(e=r.date)||void 0===e?void 0:e.toString("MMM/dd/yy"),subject:r.subject})}),[k,u,r]);var w={zIndex:s?1:0},b=I.Z.getWebviewUserAgent();return o.createElement("webview",{src:p,className:"absolute inset-0",style:w,preload:"file:outlookpreview.js",partition:"persist:outlook".concat(d),useragent:b,allowpopups:"on",ref:f})})),Xt=(0,f.Z)((function(e){var t=e.accountID,n=e.service,r=e.thread,a=e.pane,c=e.needsFixSubject,l=e.onFixSubject,u=(0,m.Z)(s.default.settings.emailViewAccounts),d=i()(u,1)[0],h=(0,o.useRef)({}).current;return t&&(h[n+":"+t]={account:d.find((function(e){return e.s===n&&e.e===t})),service:n,thread:r}),o.createElement("div",{className:"relative flex-1"},Object.entries(h).map((function(e){var r=i()(e,2),u=r[0],d=r[1];return d.account?"o"===d.service?o.createElement(Yt,{key:u,account:d.account,pane:a,thread:d.thread,isInFront:d.account.e===t&&d.service===n}):o.createElement(Kt,{key:u,accountID:d.account.e,pane:a,threadID:d.thread.id,isInFront:d.account.e===t&&d.service===n,needsFixSubject:c,onFixSubject:l}):o.createElement("div",{className:"absolute inset-0 c-background",style:{zIndex:2}},o.createElement("div",{className:"pt-8 mx-auto text-center",style:{maxWidth:400}},o.createElement("div",null,"This email is from an account which is not currently setup to sync. Please add it in the Gmail section of the Plugins settings."),o.createElement("div",{className:"mt-4"},o.createElement(E.Z,{text:"ADD ACCOUNT",mode:"contained",primary:!0,onClick:function(){s.default.menus.openSettings("Email")},newStyle:!0}))))})))}));function Qt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=$()(e);if(t){var i=$()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Q()(this,n)}}const Jt=function(e){Y()(n,e);var t=Qt(n);function n(){return z()(this,n),t.apply(this,arguments)}return G()(n,[{key:"init",value:function(){this.refWebview=(0,o.createRef)(),s.default.onIntroAction("Email"),this.createObservables({expandedMessages:[]}),a.Z.isDemoMode()&&(a.Z.reactEmailPreview=this)}},{key:"onMount",value:function(){}},{key:"onBeforeChanged",value:function(e,t){if(e.threadAttach!==t.threadAttach){var n=e.messages,r=[];if(n.length>0)for(var i=0,a=this.getLastMessage(e),o=0;o<n.length;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=n[o];(s===a||this.isMessageUnread(s))&&r.push(s.id)}this.expandedMessages.set(r,!1),e.expandedMessages=r}}},{key:"getURL",value:function(e){if(e=e||this.state.threadAttachObs){var t=e.id,n=e.getField("accountID");return"https://mail.google.com/mail/u/".concat(n,"#inbox/").concat(t)}}},{key:"getState",value:function(){var e=s.default.pluginManager.getPluginGmail();return{pane:s.default.EmailPreview.openOnPane,isLoading:s.default.EmailPreview.isLoading,threadAttach:s.default.EmailPreview.threadAttach,threadItem:s.default.EmailPreview.threadItem,messageIDs:s.default.EmailPreview.messageIDs,messages:s.default.EmailPreview.getMessages(),errorMessage:s.default.EmailPreview.errorMessage,messagesLoaded:s.default.EmailPreview.messagesLoaded,shouldUseNewEmailPlugin:s.default.EmailPreview.threadAttach&&e.shouldUseNewEmailPlugin(s.default.EmailPreview.threadAttach),colorTheme:(0,C.m)(),showSidebar:s.default.DesktopUI.showSidebar,threadAttachObs:s.default.EmailPreview.threadAttachObs}}},{key:"getLastMessage",value:function(e){return e=e||this.state,s.default.pluginManager.getPluginGmail().getLastMessage(e.threadAttach)}},{key:"onEscapeKey",value:function(){s.default.EmailPreview.close()}},{key:"isMessageDraft",value:function(e){return e.labelIds.indexOf("DRAFT")>=0}},{key:"isMessageUnread",value:function(e){return e.labelIds.indexOf("UNREAD")>=0}},{key:"onClickClose",value:function(){s.default.EmailPreview.close()}},{key:"onClickArchive",value:function(){this.props.pane.archiveItem(!0,this.state.threadItem)}},{key:"onClickLabel",value:function(e){this.props.pane.autocompleteLabel({elementDisplay:e.target,item:this.state.threadItem})}},{key:"onClickMove",value:function(e){this.props.pane.autocompleteMove({elementDisplay:e.target,item:this.state.threadItem})}},{key:"onClickSchedule",value:function(e){this.props.pane.autocompleteSchedule({element:e.target,item:this.state.threadItem})}},{key:"onClickUnread",value:function(){this.props.pane.markItemRead(!1,this.state.threadItem)}},{key:"onClickDelete",value:function(){var e,t=this.state,n=this.props.pane,r=s.default.pluginManager.getPluginGmail();if(n.type===l.Z.PaneMode.Gmail)n.deleteSelected({comparator:r.isGmailItem});else if(ge.Z.getStartItem()===t.threadItem&&(e=n.indexOfPrevVMLI(ge.Z.getStartIndex(),!0)),t.threadItem.deleteSelf(l.Z.ChangeType.Local),s.default.EmailPreview.reset(),e){var i=n.itemAtIndex(e);if(i){var a=i.getParsedText().length;ge.Z.selectIndex(e,a)}}}},{key:"onClickPrint",value:function(){var e=s.default.pluginManager.getPluginGmail().createPrintURLForThread(this.state.threadAttach);a.Z.printPage(e)}},{key:"onClickViewInGmail",value:function(){var e=s.default.pluginManager.getPluginGmail().getURLForAttachment(this.state.threadAttach);s.default.openUrl(e)}},{key:"openResponse",value:function(e){if(this.state.shouldUseNewEmailPlugin)this.onClickViewInGmail();else{var t=this.getLastMessage();s.default.EmailPreview.setMessageResponseMode(t.id,e)}}},{key:"onClickReply",value:function(){this.openResponse("Reply")}},{key:"onClickReplyAll",value:function(){this.openResponse("Reply All")}},{key:"onClickForward",value:function(){this.openResponse("Forward")}},{key:"toggleExpanded",value:function(e){var t=this.state.messages,n=t[e];this.expandedMessages.indexOf(n.id)>=0?!(t.length>1&&e<t.length-1)||t[e+1]&&this.isMessageDraft(t[e+1])||this.expandedMessages.remove(n.id):this.expandedMessages.push(n.id)}},{key:"onClickDown",value:function(){this.props.pane.keyMoveDown()}},{key:"onClickUp",value:function(){this.props.pane.keyMoveUp()}},{key:"renderMessages",value:function(){var e,t,n=this.props.noHeader,r=this.state,i=r.threadAttach,s=r.isLoading,u=r.errorMessage,d=r.messagesLoaded,h=r.shouldUseNewEmailPlugin,p=this.state.messages;if((p=p||[]).length>0){var f=0;t=p[0].subject||"(no subject)";for(var g=[],m=this.expandedMessages.get(),v=this.getLastMessage(),y=0;y<p.length;++y){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;var k=p[y],_=void 0;if(this.isMessageDraft(k)){try{a.Z.PAssert(470,y>0,"Should never have a draft as the first message in the list")}catch(L){a.Z.reportError(L)}var Z=p[y-1];_=o.createElement(Ht,{key:Z.id+"_draft",threadAttach:i,message:k,inReplyToMessage:Z})}else{var w=m.indexOf(k.id)>=0,b=p[y-1],P=p[y+1],S=0===y||m.indexOf(b.id)>=0||this.isMessageDraft(b),D=y>=p.length-2||m.indexOf(P.id)>=0||this.isMessageDraft(P);_=o.createElement(zt,{key:k.id,index:y,threadAttach:i,message:k,toggleExpanded:this.toggleExpanded.bind(this,y),expanded:w,isLastMessage:k===v,prevExpanded:S,nextExpanded:D})}g.push(_)}e=o.createElement("div",{className:"emailMessages c-background c-border c-foreground",style:{opacity:d?1:0}},g)}else e=s?o.createElement(c.Z,{center:!0},"Loading messages..."):u?o.createElement("div",{className:"noMessages center"},u):o.createElement("div",{className:"noMessages center"},"No conversation selected");var E=36,x=a.Z.classNames("emailPreviewTop c-foreground c-background"),C=l.Z.PaneHeadingHeightSmall,A={height:C,minHeight:C,boxShadow:this.state.colorTheme.paneShadow()};return o.createElement(o.Fragment,null,!n&&o.createElement("div",{className:x,style:A},p.length>0&&o.createElement(o.Fragment,null,o.createElement("div",{className:"emailHeaderRow"},o.createElement("div",{className:"emailButtons"},!h&&o.createElement(o.Fragment,null,o.createElement(N.Z,{icon:"icon-check",iconSize:17,width:E,height:E,tooltip:"Archive (E)",onClick:this.onClickArchive}),o.createElement(N.Z,{icon:"icon-unread icon-unread-header",iconSize:15,width:E,height:E,tooltip:"Mark Unread (U)",onClick:this.onClickUnread}),o.createElement(N.Z,{icon:"icon-tag",iconSize:15,width:E,height:E,tooltip:"Label (L)",onClick:this.onClickLabel}),o.createElement(N.Z,{icon:"icon-align-left",iconSize:15,width:E,height:E,tooltip:"Add to Outline (M)",onClick:this.onClickMove}),o.createElement(N.Z,{icon:"icon-calendar",iconSize:15,width:E,height:E,tooltip:"Add to Calendar (C)",onClick:this.onClickSchedule}),o.createElement(N.Z,{icon:"icon-delete",iconSize:18,width:E,height:E,tooltip:"Delete (Backspace)",onClick:this.onClickDelete})),!I.Z.app&&o.createElement(N.Z,{icon:"icon-print",iconSize:18,width:E,height:E,tooltip:"Print (P)",onClick:this.onClickPrint}),o.createElement(N.Z,{icon:"icon-gmail",iconSize:15,width:E,height:E,tooltip:"Open in Gmail (G)",onClick:this.onClickViewInGmail}))),o.createElement("div",{className:"pt-2 emailHeaderRow emailSubject"},t)),o.createElement(N.Z,{className:"closeButton",icon:"icon-close",iconSize:18,width:40,height:40,onClick:this.onClickClose,tooltip:"Close"})),o.createElement(Pt.Z,{className:"overflow-hidden emailMessagesScroller f1"},e))}},{key:"renderGmailView",value:function(){var e=l.Z.PaneHeaderHeight,t={height:e,minHeight:e},n=this.state.threadAttachObs,r=null===n||void 0===n?void 0:n.id,i=null===n||void 0===n?void 0:n.getField("accountID"),a=(null===n||void 0===n?void 0:n.getField("service"))||"g",s="g"===a&&!(null!==n&&void 0!==n&&n.getField("subject")||null!==n&&void 0!==n&&n.getField("text"))&&r,c=qt.Z.getPluginNew("Email").getById(r);return o.createElement(o.Fragment,null,o.createElement("div",{className:"flex justify-end emailPreviewTop c-foreground c-background",style:t},o.createElement(N.Z,{className:"closeButton",icon:"icon-close",iconSize:18,width:l.Z.PaneHeaderHeight,height:l.Z.PaneHeaderHeight,onClick:this.onClickClose,tooltip:"Close"})),o.createElement(Xt,{pane:this.props.pane,accountID:i,service:a,thread:c||{id:r},needsFixSubject:!!s,onFixSubject:function(e,t){e===s&&(null===n||void 0===n||n.updateInlineField("subject",t))}}))}},{key:"render",value:function(){var e=a.Z.classNames("emailPreview c-background c-border overflow-hidden flex flexvert h-full",{noClick:s.default.PaneManager.isResizingPane},{"border-r max-h-full":!1},{"border-t":!1},{transition:!s.default.PaneManager.isResizingPane});return o.createElement("div",{className:e},s.default.supportEmailViews()?this.renderGmailView():this.renderMessages())}}]),n}(ne.a);var $t=n(6769),en=function(e){var t=e.name,n=e.pane,r=e.rect,c=e.width,h=e.offset,p=e.Component,f=(0,o.useState)(0),g=i()(f,2),v=g[0],y=g[1],k=(0,m.Z)(s.default.settings.disableAnimations),_=i()(k,1)[0],Z=r.left+h,w=(0,u._)(),b=(0,He.Z)(Z);(0,o.useEffect)((function(){y(1)}),[]),void 0!==b&&b!==Z&&(_?w.set({x:Z}):w.start({x:Z,transition:l.Z.TransitionSpringFaster}));var P=Object.assign({width:c,opacity:v}),S=a.Z.classNames("paneWrapper paneWrapperMotion absolute inset-0 will-change-transform",{"paneWrapperOverview hide-print":"overview"===t},{paneWrapperPreview:"preview"===t},{"z-1":!0},{"t-border border-t border-b":!1});return o.createElement(d.E.div,{key:n.id+t,className:S,style:P,animate:w,initial:{x:Z}},o.createElement(p,{pane:n}))},tn=function(e){return e.rect.get().left},nn=function(e){var t=e.pane,n=e.rect,r=e.Component,c=e.refPane,h=(0,m.Z)(s.default.settings.disableAnimations,I.Z.supportsMultiplePanes,s.default.DesktopUI.resizingPane),p=i()(h,2),f=p[0],g=p[1],v=(0,o.useState)(!1),y=i()(v,2),k=y[0],_=y[1],Z=(0,o.useState)(!1),w=i()(Z,2),b=w[0],P=w[1],S=(0,u._)(),D=(0,o.useRef)(),E=(n.width,(0,He.Z)(n.left)),x=(0,o.useRef)();x.current=k||f;var C=(0,o.useCallback)((function(e){x.current?S.set({x:e}):S.start({x:e,transition:l.Z.TransitionSpringFaster})}),[]);void 0===E||E===n.left||k||C(n.left);var A=(0,o.useCallback)((function(e){D.current&&clearTimeout(D.current);var n=e.clientX,r=tn(t);document.body.classList.add("pointer-events-none"),bt.Z.beginBatch(),s.default.DragDrop.isDraggingPane.set(!0),_(!0),P(!0),bt.Z.endBatch(),C(r);a.Z.onMouseMoveUp((function(e){var i=e.clientX-n+r;s.default.PaneManager.dragPaneTo(t,i-tn(t)),C(i)}),(function(e){bt.Z.beginBatch(),s.default.DragDrop.isDraggingPane.set(!1),_(!1),bt.Z.endBatch();var n=tn(t);C(n),document.body.classList.remove("pointer-events-none"),D.current=setTimeout((function(){P(!1)}),300)}))}),[]),L=n.numPanes>1,M=g&&((L?n.isFirst:!n.isFirst)||k||t.isOverviewVisible()),T=a.Z.classNames("paneWrapperMotion will-change-transform",{"c-shadow-popup":k},{notFirst:!n.isFirst}),R={width:void 0,right:0,zIndex:b?2:0,borderColor:"transparent"},O={borderLeftWidth:M?1:0,borderRightWidth:L?1:void 0,borderTopWidth:0},F=a.Z.classNames("paneWrapper paneWrapperPane absFull t-border");return o.createElement(d.E.div,{className:T,style:R,animate:S,initial:{x:n.left},ref:c},o.createElement("div",{className:F,style:O},o.createElement(r,{pane:t,startDragging:A})))};const rn=(0,f.Z)((function(e){var t,r,c,u=e.pane,d=e.Component,h=(0,o.useRef)(),p=(0,m.Z)(u.rect,I.Z.supportsMultiplePanes),f=i()(p,2),g=f[0],v=f[1],y=(0,m.Z)(v&&(null===(t=u.overview)||void 0===t?void 0:t.isVisible),v&&u.isExpanded),k=i()(y,2),_=k[0],Z=k[1];g.left,g.width,g.left,g.width,g.widthExpanded,(0,o.useCallback)((function(e){var t=e.clientX-a.Z.offset(h.current).left-g.width-(Z?g.widthExpanded:0),n=!1;ge.Z.reset(),s.default.DesktopUI.resizingPane.set(!0);a.Z.onMouseMoveUp((function(e){n||(document.body.classList.add("pointer-events-none"),n=!0);var r=a.Z.offset(h.current),i=e.clientX-r.left-t;Z&&(i-=g.width),u.setWidthManual(i,Z)}),(function(){s.default.PaneManager.updatePaneRects(),s.default.DesktopUI.resizingPane.set(!1),document.body.classList.remove("pointer-events-none")})),a.Z.preventDefault(e)}),[u,g,Z]),(0,o.useCallback)((function(){u.widthManual&&u.setWidthManual(void 0,Z)}),[u,Z]);if(v)_&&(r=o.createElement(en,{key:u.id+"overview",name:"overview",pane:u,rect:g,width:l.Z.OverviewWidth,offset:-l.Z.OverviewWidth,Component:$t.Z})),Z&&(c=o.createElement(en,{key:u.id+"preview",name:"preview",pane:u,rect:g,width:g.widthExpanded,offset:g.width+(g.isFirst?2:1),Component:Jt}));else{var w=n(2027).Z;r=o.createElement(w,{key:u.id+"overview",pane:u})}var b=o.createElement(nn,{key:u.id+"pane",name:"pane",pane:u,rect:g,Component:d,refPane:h});return v?[r,b,!1,c]:[b,r,c]}));var an=n(5193),on=n(5853),sn=n(4856);const cn=(0,f.Z)((function(){var e=(0,m.Z)(s.default.PaneManager._panes,sn.Z.panesInView,p.o0.isKeyboardOpen,an.Z.onlineStatus),t=i()(e,4),n=t[0],r=t[1],c=t[2],u=t[3],d=function(e){return function(){ge.Z.setFocusedPane(e),sn.Z.setPanesInView([{type:"pane",pane:e}])}},h=n.map((function(e,t){var i,s,c=r.find((function(t){return t.pane===e})),l=a.Z.classNames("flex flex-col items-center justify-center flex-1 text-center mobutton",c?"c-blue":"c-foreground-light",{"ml-auto":0===t},{"mr-auto":t===n.length-1});return o.createElement("div",{key:e.id,className:l,style:ln.button,onClick:d(e)},o.createElement(A.J,{name:e.getMobileIcon(),size:20}),o.createElement("div",{className:"pt-1 text-12"},e.name.get()||(null===e||void 0===e||null===(i=(s=e).getNewViewMode)||void 0===i?void 0:i.call(s))||e.title||e.type.replace("Pane","")))})),f={height:l.Z.Mobile.BottomBarHeight};return c?null:o.createElement("div",{className:"border-t c-background c-border-heavy"},!a.Z.isDemoMode()&&"Online"!==u&&o.createElement("div",{className:"pt-1 font-bold center text-12"},u.toUpperCase()+("Connecting"===u?"...":"")),o.createElement("div",{className:"flex items-stretch overflow-x-auto",style:f},h))}));var ln=a.Z.createStyles({button:{minWidth:50,maxWidth:100}}),un=n(9052),dn=n(4074);const hn=(0,f.Z)((function(e){var t=e.children;return o.createElement("div",{ref:function(e){return null===e||void 0===e?void 0:e.appendChild(t)}})}));var pn=["className","selected","selectedColor","noOutline"],fn=["selected","selectedColor"],gn=[0,.42,.58,1],mn=function(e){var t=e.className,n=e.selected,r=e.selectedColor,i=e.noOutline,s=b()(e,pn),c=a.Z.classNames(t,n&&(r||"c-button-raised-primary"));return o.createElement(un.Z,Z()({},s,{className:c,width:30,height:30,mode:i?void 0:"outlined"}))},vn=function(e){var t=e.selected,n=e.selectedColor,r=b()(e,fn),i=a.Z.classNames(t&&(n||"c-button-raised-primary"));return o.createElement(un.Z,Z()({},r,{className:i,width:30,height:30,notRounded:!0}))},yn=function(e){var t=e.children;return o.createElement("div",{className:"flex mr-3 overflow-hidden border rounded c-border"},t)},kn=function(){return Ce.Z.handleTab(!0,!0)},_n=function(){return Ce.Z.handleTab(!0)};const Zn=(0,f.Z)((function(){var e,t,n=(0,m.Z)(ge.Z.pane,dn.Z.keyboardHeight,dn.Z.portaledToolbar,null===(e=ge.Z.pane.get())||void 0===e?void 0:e.search.isFocused,dn.Z.menusStack,ge.Z.selectedMapObs),r=i()(n,5),c=r[0],u=r[1],p=r[2],f=r[3],g=r[4],v=u&&ge.Z.getSelectedObjects(),y=null===v||void 0===v?void 0:v[0];(0,m.Z)(null===y||void 0===y||null===(t=y.item)||void 0===t?void 0:t.flags);var k=u>0&&(!!y||f);(0,m.Z)(null===y||void 0===y?void 0:y.item.itemChanged);var _,Z=a.Z.classNames("absolute inset-x-0 c-shadow-popup c-background-toolbar flex flex-wrap will-change-transform select-none");if(u>0&&p)_=o.createElement(hn,null,p);else if(k&&0===g.length){var w=function(){var e,t;null===(e=document.activeElement)||void 0===e||null===(t=e.blur)||void 0===t||t.call(e),ge.Z.reset()},b=function(e){f?(c.search.addToValue(e),c.search.updateAutocomplete()):y.item&&(ge.Z.insertTextAtSelection(e),je.Z.updateFromPane({owner:y,index:y.index,start:ge.Z.getStartOffset(),element:ge.Z.getStartElement(),forceShow:!0}))},P=function(){b(l.Z.ContactPrefix)},S=function(){b(l.Z.TagPrefix)},D=function(e){return function(){var t=y.item;t&&(t.setPrefix(t.prefix===e?null:e),s.default.settings.alignIndentToPrefix.get()&&ge.Z.updateCaret())}},E=function(e){return function(){var t=y.item;if(t){var n=t.getPriority(),r=e===n?0:e;t.setPriority(r,l.Z.ChangeType.Local)}}};if(f)_=o.createElement("div",{key:"search",className:"flex flex-1 p-2"},o.createElement(mn,{icon:"FaHashtag",iconSize:12,onPress:S,className:"mr-3"}),o.createElement(mn,{icon:"MdPerson",onPress:P,className:"mr-3"}),o.createElement("div",{className:"flex-1"}),o.createElement(mn,{icon:"IoIosArrowDown",iconSize:18,noOutline:!0,onPress:w}));else if(c){var x,C,A,L,M;if(y){var T=y.item;if(T.hasNote())A=T.getNote().getNotePreviewText().lines.length>0;x=T.isStarred(),C=T.getPriority(),M=(T.isPrefixHeader()?"header":T.isPrefixTask()&&"task")||T.isPrefixBullet()&&"bullet"||T.isPrefixNumList()&&"numlist"||"",L=!!T.getMooDate()}_=o.createElement(o.Fragment,null,o.createElement("div",{className:"flex pt-2 pl-2"},c.type===l.Z.PaneMode.Task&&c.isViewOutline()&&o.createElement(mn,{icon:"MdArrowBack",onPress:kn,className:"mr-3"}),c.type===l.Z.PaneMode.Task&&c.isViewOutline()&&o.createElement(mn,{icon:"MdArrowForward",onPress:_n,className:"mr-3"}),o.createElement(mn,{icon:"FaHashtag",iconSize:12,onPress:S,className:"mr-3"}),o.createElement(mn,{icon:"MdPerson",onPress:P,className:"mr-3"}),o.createElement(mn,{icon:"IoIosCalendar",onPress:function(){y.item&&dn.Z.openMenu({type:"Date",item:ge.Z.getStartItem(),paneObject:ge.Z.getStartObject(),fullscreen:!0,focused:!0})},className:"mr-3",selected:L,selectedColor:"c-button-raised-primary"}),o.createElement(mn,{icon:"FaRegStickyNote",onPress:function(){y.item&&c.openNoteContextMenuByPaneObject(y,{startFullscreen:!0})},selected:A,selectedColor:"c-button-raised-primary"})),o.createElement("div",{className:"flex p-2 f1"},o.createElement(yn,null,o.createElement(vn,{icon:"icon-project",onPress:D(l.Z.Prefix.Header),selected:"header"===M}),o.createElement(vn,{icon:"MdCheck",onPress:D(l.Z.Prefix.Task),selected:"task"===M}),o.createElement(vn,{icon:"FaCircle",iconSize:8,onPress:D(l.Z.Prefix.Bullet),selected:"bullet"===M}),o.createElement(vn,{text:"1.",fontSize:12,onPress:D(l.Z.Prefix.NumList),selected:"numlist"===M})),o.createElement(yn,null,o.createElement(vn,{icon:"FaExclamation",iconSize:12,onPress:E(l.Z.VMLIFlag.P1),selected:C===l.Z.VMLIFlag.P1,selectedColor:"p1Button c-foreground-white",color:"t-priority1"}),o.createElement(vn,{icon:"FaExclamation",iconSize:12,onPress:E(l.Z.VMLIFlag.P2),selected:C===l.Z.VMLIFlag.P2,selectedColor:"p2Button c-foreground-white",color:"t-priority2"}),o.createElement(vn,{icon:"FaExclamation",iconSize:12,onPress:E(l.Z.VMLIFlag.P3),selected:C===l.Z.VMLIFlag.P3,selectedColor:"p3Button c-foreground-white",color:"t-priority3"})),o.createElement(mn,{icon:"MdStar",iconSize:18,onPress:function(){var e=y.item;if(e){var t=e.isStarred();e.setStarred(!t,l.Z.ChangeType.Local),ge.Z.updateCaret()}},selected:x}),o.createElement("div",{className:"flex-1"}),o.createElement(mn,{icon:"IoIosArrowDown",iconSize:18,noOutline:!0,onPress:w})))}}return o.createElement(h.M,null,_?o.createElement(d.E.div,{className:Z,id:"keyboardToolbar",style:{paddingBottom:100,marginBottom:-100},animate:{bottom:u,transition:{ease:gn,duration:I.Z.isiOS?.25:0}},initial:{bottom:0},exit:{bottom:-100,transition:{ease:gn,duration:I.Z.isiOS?.5:.2}},onMouseDown:a.Z.preventAndStop},_):null)}));var wn={ActionSheet:n(5024),Settings:n(6229),Contact:n(1257),OpenUrl:n(6441),Note:n(7056),Date:n(7259),Prompt:n(1806),Confirm:n(9361),DropBucket:n(2402),Alert:n(4006)};const bn=(0,f.Z)((function(){var e=(0,m.Z)(dn.Z.menusStack,dn.Z.portalsStack),t=i()(e,2),n=t[0],r=t[1];return o.createElement(o.Fragment,null,o.createElement(h.M,null,n.map((function(e){return o.createElement(wn[e.type].default,Object.assign({key:e.type},e))}))),r.map((function(e){return o.createElement(hn,{key:e.key},e.el)})))}));var Pn=n(1974),Sn=n(2770);const Dn=(0,f.Z)((function(){var e=(0,m.Z)(ge.Z.selectedMapObs,p.o0.isHoldDown,s.default.DragDrop.dragging),t=i()(e,3),n=t[0],r=t[1],c=t[2],u=(0,C.Z)();if(ge.Z.isInMobileMultiselect()){var d=Object.keys(n).length,h=r&&d<2,f=function(e,t){var n;ge.Z.forEach((function(r){void 0===n&&(n=!r[e]()),r[t](n,l.Z.ChangeType.Local)})),ge.Z.reset()},g={height:l.Z.Mobile.TopBarHeight,boxShadow:u.paneShadow()},v={height:l.Z.Mobile.BottomBarHeight,boxShadow:u.paneShadow()},y=!h&&!c,k=a.Z.classNames("absolute inset-x-0 flex inset-b-0 c-background",{"justify-end":y},{"justify-center items-center":c});return o.createElement("div",{className:"pointer-events-none absFull z-2"},!c&&o.createElement("div",{className:"relative flex items-center c-background",style:g},y?o.createElement(o.Fragment,null,o.createElement(Sn.TopBarIconButton,{icon:"IoIosArrowBack",className:"absolute",onPress:function(){ge.Z.reset()}}),o.createElement("div",{className:"flex-1 center"},d," selected")):o.createElement("div",{className:"flex-1 center"},o.createElement("div",{className:"text-13"},o.createElement("div",null,"Move to drag or"),o.createElement("div",null,"lift to multiselect")))),o.createElement("div",{className:k,style:v},y&&o.createElement(o.Fragment,null,o.createElement(Sn.TopBarIconButton,{icon:"MdCheck",onPress:function(){f("isComplete","setComplete")}}),o.createElement(Sn.TopBarIconButton,{icon:"MdStar",onPress:function(){f("isStarred","setStarred")}}),o.createElement(Sn.TopBarIconButton,{icon:"IoMdTrash",onPress:function(){ge.Z.forEach((function(e){e.deleteSelf(l.Z.ChangeType.Local)})),ge.Z.reset()}})),c&&o.createElement(o.Fragment,null,o.createElement("div",{className:""},"Drag here to cancel"))))}return null}));var In=function(e){var t=e.target;t&&t.scrollTop>0&&(t.scrollTop=0)};const En=(0,f.Z)((function(){var e=s.default.PaneManager,t=a.Z.vmMain,n=(0,o.useRef)(),r=(0,m.Z)(sn.Z.panesInView,e.isLoading,t.isRendered,an.Z.documentsArray,s.default.settings.activeUser,s.default.setup.isLoggingOut),u=i()(r,6),d=u[0],h=u[1],p=u[2],f=u[3],g=u[4],y=u[5];(0,o.useEffect)((function(){on.Z.notifyLoaded()}),[]),(0,o.useEffect)((function(){var e=!1,t=[document.body,document.documentElement,n.current];if(t.some((function(e){return!e}))||(e=!0,t.forEach((function(e){return e.addEventListener("scroll",In)}))),e)return function(){t.forEach((function(e){return e.removeEventListener("scroll",In)}))}}),[g,p,h,f.length]);var k=function(e){for(var t=0,n=[],r=0;r<(null===e||void 0===e?void 0:e.length);++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e[r],s=i.type,c=i.pane;if("pane"===s){var u=c.type,d=u===l.Z.PaneMode.Task&&wt||u===l.Z.PaneMode.Drive&&mt||u===l.Z.PaneMode.Gmail&&gt||u===l.Z.PaneMode.Inbox&&kt;if(d)n.push(o.createElement(rn,{key:"pane"+c.id,pane:c,Component:d}));else try{a.Z.PAssert(99,!1,"Invalid pane mode requested"+u)}catch(h){a.Z.reportError(h)}}}return n}(d);return y?o.createElement("div",{id:"container"},o.createElement(c.Z,{center:!0},"Signing out...")):g?p?h&&!a.Z.isDemoMode()?o.createElement("div",{id:"container"},o.createElement("div",{key:"loadingRemote",id:"loadingRemote",className:"c-foreground-light centerVH"},o.createElement("div",{className:"loading loading20"}),o.createElement("div",{className:"loadingText"},"Loading documents...")),o.createElement(bn,null)):0===f.length?o.createElement("div",{id:"container"},o.createElement(c.Z,{center:!0},"Connecting...")):o.createElement("div",{id:"container",className:"flex flex-col overflow-hidden select-none absFull fontPane c-foreground",ref:n},o.createElement("div",{className:"relative flex-1"},k),o.createElement(Pn.Z,{inPane:!1}),o.createElement(v,null),o.createElement(cn,null),o.createElement(Dn,null),o.createElement(bn,null),o.createElement(Zn,null),o.createElement(U,null)):null:o.createElement(F,null)}))},4006:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>o});var r=n(9955),i=n(3234),a=n(3067);const o=(0,i.Z)((function(e){var t=e.type,n=e.text,i=e.callback,o=(0,r.useRef)(!1);return(0,r.useEffect)((function(){return function(){i(o.current)}}),[i]),r.createElement(a.Z,{type:t,title:"Alert"},r.createElement("div",{className:"p-4"},n))}))},1974:(e,t,n)=>{"use strict";n.d(t,{Z:()=>v});var r=n(3038),i=n.n(r),a=n(9955),o=n(8778),s=n(2971),c=n(3234),l=n(3170),u=n(8001),d=n(8855),h=n(7100),p=n(4472),f=n(6950),g=n(8133);const m=(0,c.Z)((function(e){var t=e.inPane,n=e.owner,r=e.offset,o=e.children,s=(0,l.Z)(g.o0.keyboardHeight,h.Z.windowSize),c=i()(s,2),m=c[0],v=c[1],y=(0,a.useMemo)((function(){return n instanceof u.Z?n.pane.listManager.offsetOfIndex(n.index)+30:p.Z.pane.get().search.isFocused.get()?2*d.Z.Mobile.TopBarHeight:void 0}),[n]);if(void 0!==y){var k=y+(r||0),_=(t?v.height-3*d.Z.Mobile.TopBarHeight:v.height-k)-m-16,Z={top:k,maxHeight:_},w={maxHeight:_};return a.createElement("div",{className:"absolute inset-x-0 ml-4 mr-4 rounded c-shadow-popup c-background z-3",style:Z},a.createElement(f.Z,{defaultItemSize:34,style:w,shouldMemoize:!0,containerSize:_},o))}return null})),v=(0,c.Z)((function(e){var t=e.inPane,n=(0,l.Z)(o.Z.matches),r=i()(n,1)[0],c=o.Z.owner,d=r.length>0&&c instanceof u.Z===t,h=(0,s.Z)(d);(0,a.useEffect)((function(){if(d&&!h&&c instanceof u.Z){var e=c,t=e.pane,n=e.index;t.scrollIndexToTop(n,"smooth")}}),[c,d,h]);var p=function(e){return function(){o.Z.onSelectedMatch(e)}};return d?a.createElement(m,{inPane:t,owner:c},r.map((function(e){return a.createElement("div",{key:e.text,className:"px-2 py-2",onClick:p(e)},e.text)}))):null}))},9361:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>c});var r=n(9955),i=n(3234),a=n(3067),o=n(9052),s=n(4074);const c=(0,i.Z)((function(e){var t=e.type,n=e.text,i=e.callback,c=(0,r.useRef)(!1),l=function(e){return function(){c.current=e,s.Z.closeMenu(t)}};return(0,r.useEffect)((function(){return function(){i(c.current)}}),[i]),r.createElement(a.Z,{type:t,title:"Confirm"},r.createElement("div",{className:"p-4"},n,r.createElement("div",{className:"flex justify-center pt-4"},r.createElement(o.Z,{mode:"contained",text:"NO",padding:"px-6 py-3",className:"mr-6",onPress:l(!1)}),r.createElement(o.Z,{mode:"contained",text:"YES",padding:"px-6 py-3",primary:!0,onPress:l(!0)}))))}))},2027:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var r=n(3038),i=n.n(r),a=n(8855),o=n(3869),s=n(8651),c=n(9955),l=n(4654),u=n(6769),d=n(5193),h=n(3234),p=n(7077),f=n(3170),g=n(9052),m=n(4074),v=n(5172),y=n(3470),k=n(7100),_=n(2971),Z=n(4007);const w=(0,h.Z)((function(e){var t=e.className,n=e.children,r=e.side,o=e.width,l=e.background,u=e.onClose,d=(0,f.Z)(k.Z.windowSize),h=i()(d,1)[0],p=(0,v._)(),g=(0,v._)(),m=h.width*o,w=(0,_.Z)(m),b="left"===r?0:h.width,P=function(){p.start({x:"left"===r?m:-m,transition:a.Z.TransitionSpring}),l&&g.start({opacity:.7,transition:a.Z.TransitionSpring})};m!==w&&P();var S=function(){null===u||void 0===u||u()};(0,Z.Z)(S);var D=s.Z.classNames("fixed inset-y-0 c-background-toolbar rounded-r box-border",t),I={left:"right"===r?h.width:void 0,right:"left"===r?h.width:void 0,width:h.width,paddingLeft:h.width-m};return c.createElement("div",{className:"fixed inset-0 z-0"},l&&c.createElement(y.E.div,{className:"absolute inset-0 bg-black",onPan:function(e,t){var n="left"===r?t.offset.x+m:b+t.offset.x-m;p.set({x:n}),l&&g.set({opacity:s.Z.clamp(n/m*.7,0,.9)})},onPanEnd:function(e,t){Math.abs(t.offset.x)<5||("left"===r?t.velocity.x<-50:t.velocity.x>50)?S():P()},onClick:S,animate:g,initial:{opacity:0},exit:{opacity:0,transition:a.Z.TransitionSpring}}),c.createElement(y.E.div,{className:D,style:I,animate:p,initial:{x:b},exit:{x:b,transition:a.Z.TransitionSpring}},n))})),b=(0,h.Z)((function(e){var t,n=e.pane,r=(0,f.Z)(null===(t=n.overview)||void 0===t?void 0:t.isVisible,d.Z.onlineStatus,l.default.settings.lastSync),h=i()(r,3),v=h[0],y=h[1],k=h[2],_="Offline"!==y,Z=function(){var e;null===(e=n.overview)||void 0===e||e.setVisibility(!1)};(0,p.Z)(n.item,Z);var b=k>0?new Date(k).toString(l.default.International.getFormat(a.Z.DFormat.LongDayTime)):"Not synced",P=s.Z.isDemoMode()?"DEMO MODE":(_?"Last sync: ":"OFFLINE SINCE: ")+b;return c.createElement(o.M,null,v&&c.createElement(w,{className:"flex flex-col",side:"left",width:.8,background:!0,onClose:Z},c.createElement("div",{className:"flex-1 overflow-hidden"},c.createElement(u.Z,{pane:n})),c.createElement("div",{className:"pb-1 border-t c-border-heavy"},c.createElement("div",{className:"px-4 pt-2 text-12 c-foreground-light"},P),c.createElement(g.Z,{icon:"MdSettings",text:"Settings",height:48,fontSize:15,iconSize:15,align:"left",onPress:function(){m.Z.openMenu({type:"Settings"})}}))))}))},6229:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ae});var r=n(9955),i=n(3234),a=n(3038),o=n.n(a),s=n(8855),c=n(3470),l=n(3869),u=n(8651),d=n(7100),h=n(6604),p=n(3170),f=n(2770),g=n(4074),m=n(4007),v=n(3067),y={opacity:1,transition:{duration:.5}},k=(0,r.createContext)({}),_=function(){return(0,r.useContext)(k)},Z=(0,i.Z)((function(e){var t=e.title,n=e.children;return r.createElement(r.Fragment,null,r.createElement("div",{className:"flex items-center justify-center c-foreground",style:{height:s.Z.Mobile.TopBarHeight}},t),r.createElement("div",{className:"flex-1 overflow-auto pointer-events-auto"},n))})),w=(0,i.Z)((function(e){var t=e.type,n=e.className,i=e.initialPage,a=e.pageMap,_=(0,r.useRef)([{page:i}]),w=(0,h.Z)(),b=(0,p.Z)(d.Z.windowSize),P=o()(b,1)[0],S=(0,r.useCallback)((function(){_.current.length>1?(_.current.pop(),w()):g.Z.closeMenu(t)}),[]);(0,m.Z)(S);var D={height:P.height},I=(0,r.useMemo)((function(){return{goBack:function(){_.current.splice(_.current.length-1,1),w()},navigate:function(e,t){_.current=_.current.concat({page:e,props:t}),w()}}}),[]);return r.createElement(v.Z,{type:t,spring:s.Z.TransitionSpringFast,ignoreAndroidBack:!0},r.createElement("div",{style:D,className:u.Z.classNames("flex flex-col",n)},r.createElement(f.TopBar,null,r.createElement(f.TopBarIconButton,{icon:"IoIosArrowBack",onPress:S}),r.createElement("div",{className:"font-bold text-15"},"Settings")),r.createElement(k.Provider,{value:I},r.createElement(c.E.div,{className:"absolute inset-0 pointer-events-none",animate:{x:-(_.current.length-1)*P.width},transition:s.Z.TransitionSpringDamped},r.createElement(l.M,null,_.current.map((function(e,t){var n=e.page,i=e.props;return r.createElement(c.E.div,{key:t,className:"absolute inset-y-0 flex flex-col",style:{left:t*P.width,width:P.width},exit:y},r.createElement(Z,{title:u.Z.addSpacesToCamelCase(n)},(0,r.createElement)(a[n],i)))})))))))})),b=n(8926),P=n.n(b),S=n(7757),D=n.n(S),I=n(4654),E=n(4926);n(7274);const x=(0,i.Z)((function(e){var t,n=e.checked,i=e.checkedObservable,a=e.disabled,l=e.onChange,d=e.getCheckedFromObservable,h=e.getValueFromChecked;var f=(0,r.useRef)(),g=(0,E.Z)(f),m=(0,p.Z)(i),v=o()(m,1)[0],y=void 0===n?null!==(t=null===d||void 0===d?void 0:d(v))&&void 0!==t?t:v:n;g.width||(g.width=42);var k={backgroundColor:y?s.Z.ColorBrand:"#888"},_={x:y?g.width-24:4},Z=u.Z.classNames("relative flex items-center cursor-pointer c-button-raised-primary c-shadow-thin borderBox",{mobutton:!0});return r.createElement(c.E.div,{className:Z,style:C,initial:k,animate:k,onClick:function(e){if(!a){var t=!y;l&&!1===l(t)||function(e){var t;null===i||void 0===i||i.set(null!==(t=null===h||void 0===h?void 0:h(e))&&void 0!==t?t:e)}(t),u.Z.stopPropagation(e)}},ref:f,transition:{duration:.5}},r.createElement(c.E.div,{className:"absolute c-background c-shadow-light",style:A,initial:_,animate:_,transition:s.Z.TransitionSpring}))}));var C={borderRadius:16,width:48,height:26},A={borderRadius:50,width:20,height:20},L=n(8133),M=function(e){I.default.openUrl(e)};const T=(0,i.Z)((function(){var e=d.Z.isBeta;return r.createElement(r.Fragment,null,r.createElement(f.SettingsHeading,{text:"LINKS"}),r.createElement(f.SettingsRow,{text:"Moo.do website",onPress:function(){return M("https://www.moo.do")}}),r.createElement(f.SettingsRow,{text:"Moo.do blog",onPress:function(){return M("https://www.moo.do/blog/")}}),r.createElement(f.SettingsRow,{text:"Moo.do changelog",onPress:function(){return M("https://www.moo.do/changelog/")},last:!0}),r.createElement(f.SettingsHeading,{text:"LEGAL"}),r.createElement(f.SettingsRow,{text:"Privacy Policy",onPress:function(){return M("https://www.moo.do/privacy/")}}),r.createElement(f.SettingsRow,{text:"Terms of Service",onPress:function(){return M("https://www.moo.do/terms/")},last:!0}),r.createElement(f.SettingsHeading,{text:"ADVANCED"}),r.createElement(f.SettingsRow,{text:"Use beta version",last:!0},r.createElement(x,{checked:e,onChange:function(e){P()(D().mark((function t(){return D().wrap((function(t){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(t.prev=t.next){case 0:return t.next=2,g.Z.confirm("Would you like to restart into the ".concat(e?"beta":"stable"," version? You will need to sign in again."));case 2:if(!t.sent){t.next=10;break}if(!d.Z.app){t.next=9;break}return t.next=7,L.LA.setUseBeta(e);case 7:t.next=10;break;case 9:location.host=e?"beta.moo.do":"www.moo.do";case 10:case"end":return t.stop()}}}),t)})))()}})))}));var R=n(1186),O=n(1319);const F=(0,i.Z)((function(e){var t,n=e.title,i=e.description,a=e.checkedObservable,s=e.disabled,c=e.onChange,l=e.getCheckedFromObservable,d=e.getValueFromChecked;var h=(0,p.Z)(a),f=o()(h,1)[0],g=null!==(t=null===l||void 0===l?void 0:l(f))&&void 0!==t?t:f,m=function(e){var t;return a.set(null!==(t=null===d||void 0===d?void 0:d(e))&&void 0!==t?t:e)},v=u.Z.classNames("cursor-pointer py-4",{"px-4":!0}),y=u.Z.classNames("flex",{"flex-row-reverse":!0}),k=u.Z.classNames("f1","pr-3");return r.createElement("div",{className:v,onClick:function(){if(!s){var e=!g;m(e),c&&!1===c(e)&&m(!e)}}},r.createElement("div",{className:y},r.createElement(x,{checkedObservable:a,getCheckedFromObservable:l,getValueFromChecked:d,disabled:s,onChange:c}),r.createElement("div",{className:k},r.createElement("div",{className:"font-bold font-big1",style:N},n),i&&r.createElement("div",{className:"pt-1 text-xs leading-tight c-foreground-light"},i))))}));var N={lineHeight:"18px"},B=n(2377),U=n(2269),j=n(9052);const H=(0,i.Z)((function(e){var t=e.email,n=(0,p.Z)(I.default.settings.syncAccounts),i=o()(n,1)[0],a=_(),c=U.Z.pluginsAvailableNew,l=t&&i?i[t]:{},d=(0,r.useRef)(),h=(0,r.useState)(),f=o()(h,2),m=f[0],v=f[1],y=(0,r.useState)(!1),k=o()(y,2),Z=k[0],w=k[1],b=l?I.default.pluginManager.getAllPluginScopes(Object.keys(l).filter((function(e){return l[e]})),!1):[],S=!l||t&&!R.Z.isAuthorizedForScopes(t,b),E=u.Z.mapArrayToObject(c,(function(e){return(0,B.Z)(!t||(null===l||void 0===l?void 0:l[e]))[0]})),x=(0,r.useCallback)((function(){w(!0)}),[]),C=function(){var e=P()(D().mark((function e(){var n;return D().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,g.Z.confirm("Are you sure you want to delete this account?");case 2:e.sent&&(delete(n=u.Z.clone(i||{}))[t],I.default.settings.syncAccounts.set(n),a.goBack());case 4:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}();return r.createElement(r.Fragment,null,t?r.createElement("div",{className:"px-4 pt-6 pb-2 c-foreground-faded"},t):r.createElement("div",{className:"px-4 pt-6 pb-2"},r.createElement(O.Z,{height:44,placeholder:"Enter email address",type:"email",ref:d})),m&&r.createElement("div",{className:"px-4 py-2 c-error"},m),r.createElement("div",null,c.map((function(e){return r.createElement(F,{key:e,title:s.Z.PluginNames[e],checkedObservable:E[e],onChange:x})}))),S&&r.createElement("div",{className:"px-4 font-medium c-error center text-15"},"Error detected with this account. Please press SAVE to fix it."),r.createElement("div",{className:"pt-4 center"},r.createElement("div",null,r.createElement(j.Z,{mode:"contained",color:"c-button-raised-primary c-foreground-white",text:"SAVE",onPress:function(){var e=t||d.current.getValue();if(u.Z.isEmail(e)){v("");var n=u.Z.clone(i||{}),r=[];n[e]={},c.forEach((function(t){var i=E[t].get();i&&(n[e][t]=i,r.push(t))}));var o=I.default.pluginManager.getAllPluginScopes(r);R.Z.authAccount(e,o,(function(e){console.log(e,n),e&&(I.default.settings.syncAccounts.set(n),a.goBack())}))}else v("Please enter a valid email address.")},disabled:t&&!Z&&!S})),t&&r.createElement("div",{className:"pt-4"},r.createElement(j.Z,{mode:"contained",color:"c-warning c-foreground-white",text:"DELETE ACCOUNT",onPress:C}))))}));var V=n(7411),W=n(5097);const z=(0,i.Z)((function(e){var t=e.visible,n=e.text;return r.createElement(l.M,null,t&&r.createElement(c.E.div,{className:"absolute inset-0 c-bg-black",initial:{opacity:0},animate:{opacity:.75},exit:{opacity:0},transition:{duration:.2}},r.createElement(W.Z,{center:!0},n)))}));var q=n(5853);const G=(0,i.Z)((function(){var e,t=(0,r.useState)(),n=o()(t,2),i=n[0],a=n[1],c=(0,r.useState)(!1),l=o()(c,2),u=l[0],h=l[1],g=I.default.billingManager,m=V.Z.getAccountEmail(),v=(0,p.Z)(g._premiumStatus,g.daysLeftInTrial),y=o()(v,2),k=y[0],_=y[1],Z=d.Z.isiOS&&d.Z.app,w=Z,b="Premium status";switch(k){case s.Z.PremiumStatus.Trial:b="Days left in trial",e=_;break;case s.Z.PremiumStatus.TrialOver:e="Trial over";break;case s.Z.PremiumStatus.Active:e="Premium",w=!1;break;case s.Z.PremiumStatus.CanceledPastDue:case s.Z.PremiumStatus.CanceledUser:e="Cancelled";break;case s.Z.PremiumStatus.PastDue:e="Past Due",w=!1;break;default:e="Free user"}Z&&(0,r.useEffect)((function(){if(w)return P()(D().mark((function e(){var t;return D().wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,q.Z.getIAPSubscriptions();case 2:t=e.sent,a(t);case 4:case"end":return e.stop()}}}),e)})))(),function(){q.Z.endIAPConnection()}}),[w]);var S=function(e){return P()(D().mark((function t(){return D().wrap((function(t){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(t.prev=t.next){case 0:return h(!0),I.default.billingManager.appleIAPPurchase.listen((function(e){e&&q.Z.finishTransaction(e),h(!1)})),t.next=4,q.Z.requestIAPSubscription(e);case 4:case"end":return t.stop()}}}),t)})))};return r.createElement(r.Fragment,null,r.createElement(f.SettingsHeading,{text:"Moo.do ACCOUNT".toUpperCase()}),r.createElement(f.SettingsRow,{text:"Account email"},r.createElement("div",{className:"pr-2 c-foreground-faded"},m)),r.createElement(f.SettingsRow,{text:b,last:!0},r.createElement("div",{className:"pr-2 c-foreground-faded"},e)),w&&(i?r.createElement(r.Fragment,null,r.createElement(f.SettingsHeading,{text:"GO PREMIUM"}),r.createElement(f.SettingsRow,{text:"Subscribe Monthly for ".concat(i.monthly.localizedPrice),onPress:S("monthly")}),r.createElement(f.SettingsRow,{text:"Subscribe Yearly for ".concat(i.yearly.localizedPrice),onPress:S("yearly"),last:!0}),r.createElement(f.SettingsHeading,{text:"PREMIUM FEATURES"}),r.createElement(f.SettingsRow,{text:"Google Calendar Sync"}),r.createElement(f.SettingsRow,{text:"Google Drive Sync"}),r.createElement(f.SettingsRow,{text:"Desktop: Unlimited Boards and Folders"}),r.createElement(f.SettingsRow,{text:"Desktop: Advanced Display Settings"}),r.createElement(f.SettingsRow,{text:"Desktop: Custom Hotkeys"})):r.createElement(W.Z,{className:"pt-4"},"Loading In App Purchases...")),r.createElement(z,{visible:u,text:"Performing In App Purchase..."}))}));var K=n(180),Y=n(5428),X=["auto","light","dark"];const Q=(0,i.Z)((function(){var e=(0,r.useState)(!1),t=o()(e,2),n=t[0],i=t[1],a=(0,p.Z)(I.default.settings.syncAccounts,I.default.settings.ui.themeMobile,I.default.settings.activeUser,I.default.AppCache.hasUpdate,g.Z.codePushStatus),c=o()(a,5),l=c[0],h=c[1],m=c[2],v=c[3],y=c[4],k=_(),Z=q.Z.getAppVersion(),w="".concat(s.Z.jsVersion," (").concat(new Date(+s.Z.jsVersion).toString("MMMM d, h:mm tt"),")"),b=Z?"".concat(Z," - ").concat(w):w,S=v||y===K.MY.UPDATE_INSTALLED,E=function(){var e=P()(D().mark((function e(){return D().wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:if(!I.default.AppCache.hasUpdate.get()){e.next=5;break}i(!0),I.default.AppCache.skipWaiting(),e.next=13;break;case 5:if(y!==K.MY.UPDATE_INSTALLED){e.next=9;break}q.Z.restartApp(),e.next=13;break;case 9:return i(!0),e.next=12,Promise.all([I.default.AppCache.update(),d.Z.app&&q.Z.checkForUpdates(),u.Z.promisify((function(e){return setTimeout(e,2e3)}))]);case 12:i(!1);case 13:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}();return r.createElement(r.Fragment,null,r.createElement(f.SettingsHeading,{text:"OPTIONS"}),r.createElement(f.SettingsRow,{text:"Notifications",onPress:function(){return I.default.settings.disableNotifications.set(!I.default.settings.disableNotifications.get())}},r.createElement(x,{checkedObservable:I.default.settings.disableNotifications,getValueFromChecked:function(e){return!e},getCheckedFromObservable:function(e){return!e}})),r.createElement(f.SettingsRow,{text:"Dark mode",last:!0},X.map((function(e){return r.createElement(j.Z,{key:e,mode:"outlined",height:40,text:e.capitalize(),className:u.Z.classNames("ml-2",e.toLowerCase()===h&&"c-button-raised-primary"),onPress:function(){return I.default.DisplaySettings.changeColorTheme(e)}})}))),!u.Z.isDemoMode()&&r.createElement(r.Fragment,null,r.createElement(f.SettingsHeading,{text:"ACCOUNTS"}),Object.keys(l).map((function(e){var t=l[e],n=I.default.pluginManager.getAllPluginScopes(Object.keys(t).filter((function(e){return t[e]})),!1),i=!R.Z.isAuthorizedForScopes(e,n);return r.createElement(f.SettingsRow,{key:e,text:e,onPress:function(){return k.navigate("EditAccount",{email:e})}},i&&r.createElement(Y.J,{name:"MdWarning",size:18,color:"red"}))})),r.createElement(f.SettingsRow,{text:"Add Account",icon:"MdAdd",last:!0,iconSize:18,onPress:function(){return k.navigate("AddAccount")}})),r.createElement(f.SettingsHeading,{text:"Moo.do Account"}),d.Z.app&&r.createElement(f.SettingsRow,{text:"Linked Signin Accounts",onPress:function(){return k.navigate("SignInAccounts")}}),r.createElement(f.SettingsRow,{text:"Moo.do Premium",onPress:function(){return k.navigate("Premium")}}),r.createElement(f.SettingsRow,{text:"Security",onPress:function(){return k.navigate("Security")}}),r.createElement(f.SettingsRow,{text:"About Moo.do",last:!0,onPress:function(){return k.navigate("About")}}),r.createElement("div",{className:"px-4 py-4 text-13 c-foreground-light"},r.createElement("div",null,b),r.createElement("div",{className:"pt-4"},m)),r.createElement("div",{className:"pb-16 center"},r.createElement("div",null,r.createElement(j.Z,{mode:"contained",color:"c-button-raised-primary",text:S?"UPDATE AND RESTART":n?"CHECKING...":"CHECK FOR UPDATES",onPress:E})),r.createElement("div",{className:"pt-4"},r.createElement(j.Z,{mode:"contained",color:"c-button-raised-primary",text:"SIGN OUT",onPress:function(){I.default.setup.logout()}}))))}));var J=n(5986),$=n(7978),ee=n(5802),te=n(8478);const ne=(0,i.Z)((function(e){var t=(0,r.useMemo)((function(){return document.createElement("div")}),[]);return(0,r.useEffect)((function(){var e={el:t,key:"0"};return L.o0.portalsStack.push(e),function(){L.o0.portalsStack.remove(e)}}),[]),(0,te.createPortal)(e.children,t)})),re=(0,i.Z)((function(){var e=(0,p.Z)(I.default.settings.encryptionKeys),t=o()(e,1)[0],n=(0,r.useState)(!1),i=o()(n,2),a=i[0],c=i[1],l=(0,r.useState)(!1),d=o()(l,2),h=d[0],g=d[1],m=(0,r.useState)(!1),y=o()(m,2),k=y[0],_=y[1],Z=(0,r.useState)(),w=o()(Z,2),b=w[0],P=w[1],S=(0,r.useRef)(),D=(0,r.useRef)(),E=(0,ee.Z)(t&&!!t[s.Z.EncryptionKeys.UserPassword]),x=(0,r.useCallback)((function(){I.default.menus.confirm("Are you sure you want to remove your encryption password?",(function(e){if(e){_(!0);var t=I.default.crypto.getKey(s.Z.EncryptionKeys.UserPassword);J.Z.backupAuto().then((function(){$.Z.updateUserEncryption(I.default.crypto.getGlobalKeyInfo(),t).then((function(){_(!1)}))}))}}))}),[]),C=(0,r.useCallback)((function(){var e=S.current.getValue(),t=D.current.getValue(),n=s.Z.EncryptionKeys.UserPassword;e?e!==t?P("Passwords do not match"):e.length<5?P("Password is too short. Please enter a longer password to make it secure."):u.Z.isDemoMode()||(g(!0),J.Z.backupAuto().then((function(){(E.current?I.default.crypto.updateKey:I.default.crypto.addKey)({name:n,password:e,sentinelSalt:V.Z.getEncryptionUid()}).then((function(e){var t=I.default.crypto.getKey(s.Z.EncryptionKeys.UserPassword);$.Z.updateUserEncryption(e,t).then((function(){u.Z.batchRenderUpdates((function(){g(!1),c(!1)}))}))}))}))):P("No password entered")}),[]),A=(0,r.useCallback)((function(){c(!1),P("")}),[]);return r.createElement(r.Fragment,null,E.current?r.createElement(r.Fragment,null,r.createElement(f.SettingsHeading,{text:"Your data is encrypted with your password."}),r.createElement(f.SettingsRow,{text:"Change encryption password",onPress:function(){return c(!0)}}),r.createElement(f.SettingsRow,{text:k?"Removing...":"Remove encryption password",onPress:x})):r.createElement(r.Fragment,null,r.createElement(f.SettingsHeading,{text:"Encrypt your data with a password. This makes it so that even the developers cannot read your data, and it CANNOT be recovered."}),r.createElement(f.SettingsRow,{text:"Set a password",onPress:function(){return c(!0)}})),a&&r.createElement(ne,null,r.createElement(v.Z,{type:"inline",className:"z-100",noFullscreen:!0,onClosed:A},r.createElement("div",{className:"flex justify-center p-4"},r.createElement("div",{style:{maxWidth:400}},r.createElement("div",null,r.createElement("p",null,"It is very important that you remember this password."),r.createElement("p",{style:{color:"red",fontWeight:"bold"}},"It cannot be recovered.")),r.createElement(O.Z,{className:"my-4",type:"password",placeholder:"Password",focused:!0,ref:S}),r.createElement(O.Z,{type:"password",placeholder:"Confirm Password",ref:D}),b&&r.createElement("div",{className:"my-4 error"},b),r.createElement("div",{className:"flex justify-center mt-4"},r.createElement(j.Z,{text:h?"Saving...":"SAVE",mode:"contained",primary:!0,onPress:C})))))))}));var ie={Settings:Q,AddAccount:H,EditAccount:H,Premium:G,About:T,SignInAccounts:(0,i.Z)((function(){var e,t,n,i=null===(e=V.Z.getEmailProvider())||void 0===e?void 0:e.email,a=null===(t=V.Z.getGoogleProvider())||void 0===t?void 0:t.email,s=d.Z.isiOS?null===(n=V.Z.getAppleProvider())||void 0===n?void 0:n.email:void 0,c=(0,r.useState)(!1),l=o()(c,2),h=l[0],p=l[1],g=[i,a,s].filter((function(e){return e})).length>1,m=function(e,t){return function(n){if(n||g)return p(!0),P()(D().mark((function r(){return D().wrap((function(r){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(r.prev=r.next){case 0:if(!n){r.next=5;break}return r.next=3,e();case 3:r.next=7;break;case 5:return r.next=7,t();case 7:p(!1);case 8:case"end":return r.stop()}}}),r)})))(),!1}},v=m(V.Z.linkWithGoogle,V.Z.unlinkGoogle),y=m(V.Z.linkWithApple,V.Z.unlinkApple),k=function(e){if(p(!0),e)I.default.menus.promptComplex({title:"Create account with email signin",text:"After pressing OK you will be asked to sign in with ".concat(s?"Apple":"Google"," again."),fields:[{placeholder:"Email address"},{placeholder:"Password",type:"password"},{placeholder:"Confirm email address",type:"password"}],validate:function(){var e=P()(D().mark((function e(t){var n,r,i,a;return D().wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:if(n=o()(t,3),r=n[0],i=n[1],a=n[2],r&&u.Z.isEmail(r)){e.next=5;break}return e.abrupt("return","Invalid email address.");case 5:if(i){e.next=9;break}return e.abrupt("return","Invalid password.");case 9:if(!(i.length<5)){e.next=13;break}return e.abrupt("return","Please use a longer password.");case 13:if(a&&i===a){e.next=15;break}return e.abrupt("return","Passwords do not match.");case 15:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}(),callback:function(){var e=P()(D().mark((function e(t){var n,r,i,a;return D().wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(n=o()(t,2),r=n[0],i=n[1],a=!1,!r||!i){e.next=7;break}return e.next=5,s?V.Z.reauthenticateApple():V.Z.reauthenticateGoogle();case 5:e.sent&&(a=!0,m((function(){return V.Z.linkWithEmail(r,i)}),V.Z.unlinkEmail)(!0));case 7:a||p(!1);case 8:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()});else if(g){m(void 0,V.Z.unlinkEmail)(!1)}return!1};return r.createElement(r.Fragment,null,r.createElement(f.SettingsHeading,{text:"Sign in with"}),r.createElement(f.SettingsRow,{icon:"MdEmail",text:i||"Email",onPress:function(){return k(!i)}},r.createElement(x,{checked:!!i,onChange:k})),r.createElement(f.SettingsRow,{icon:"IoLogoGoogle",text:a||"Google",onPress:function(){return v(!a)}},r.createElement(x,{checked:!!a,onChange:v})),d.Z.isiOS&&r.createElement(f.SettingsRow,{icon:"FaApple",text:s||"Apple",onPress:function(){return y(!s)},last:!0},r.createElement(x,{checked:!!s,onChange:y})),r.createElement(z,{visible:h,text:"Saving..."}))})),Security:re};const ae=(0,i.Z)((function(e){var t=e.type;return r.createElement(w,{type:t,className:"c-bg-light",initialPage:"Settings",pageMap:ie})}))},9120:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Y});var r=n(319),i=n.n(r),a=n(3038),o=n.n(a),s=n(8855),c=n(4880),l=n(572),u=n(3470),d=n(8651),h=n(9955),p=n(386),f=n(4926),g=n(9585),m=n(4472),v=n(6604);var y=n(4575),k=n.n(y),_=n(3913),Z=n.n(_),w=n(2205),b=n.n(w),P=n(8585),S=n.n(P),D=n(9754),I=n.n(D),E=n(4654),x=n(404),C=n(7100),A=n(8778),L=n(2269),M=n(4764);function T(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I()(e);if(t){var i=I()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S()(this,n)}}const R=function(e){b()(n,e);var t=T(n);function n(){return k()(this,n),t.apply(this,arguments)}return Z()(n,[{key:"init",value:function(){var e=this.props.filter;this.firstValue=this.props.filterValue||e.initialValue}},{key:"onMouseDown",value:function(e){d.Z.preventAndStop(e)}},{key:"onClickIcon",value:function(e){var t=this.props.filter,n=this.props.filterValue;++n>1&&(n=-1),this.props.search.setFilter(t.name,n,!0)}},{key:"render",value:function(){var e=this.props,t=e.filter,n=e.filterValue,r=this.firstValue===n,i=e.noClick?void 0:this.props.search.getFilterTooltip(t),a=d.Z.classNames("searchButton",{"c-border-super-light":e.hasBorder},{"c-button":!n},{selected:!!n},{inSearch:e.inSearch},{"noHover mobutton":!0},t.icon,t.isOption&&(1===n?"yes":-1===n?"only":""),!t.isOption&&((n?this.firstValue>0&&r||this.firstValue<0&&!r:this.firstValue>0)?"yes":"no"));return h.createElement("div",{className:a,"data-tooltip":i,onMouseDown:this.onMouseDown,onClick:e.noClick?void 0:this.onClickIcon})}}]),n}(x.a);var O=n(1319),F=n(8373);function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I()(e);if(t){var i=I()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S()(this,n)}}const B=function(e){b()(n,e);var t=N(n);function n(){return k()(this,n),t.apply(this,arguments)}return Z()(n,[{key:"init",value:function(){this.refInput=h.createRef(),this.refSearchBox=h.createRef()}},{key:"onMount",value:function(){this.props.pane.search.UI=this,this.listenTo(this.props.pane.search.onChanged),this.forceUpdate()}},{key:"getState",value:function(){for(var e=0,t=this.props.pane,n=t.search,r={search:n.value,calendars:L.Z.GCalendarsAvailable,displayCalendars:t.displayCalendars,displayLocalItems:t.displayLocalItems},i=0;i<n.filters.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=n.filters[i];r[a.name]=a.value,r[a.name+"Enabled"]=a.enabled}return r}},{key:"onChange",value:function(e){this.props.pane.search.setValue(e)}},{key:"onParsed",value:function(e){this.props.pane.search.onParsed(e)}},{key:"setSearch",value:function(e,t){this.props.pane.search.setValue(e),!1!==t&&this.setSelectionOffset(e.length)}},{key:"getSelectionOffset",value:function(){return this.refInput.current.getSelectionOffset()}},{key:"setSelectionOffset",value:function(e){this.refInput.current.setSelectionOffset(e)}},{key:"updateAutocomplete",value:function(){this.refInput.current.updateAutocomplete()}},{key:"onFocus",value:function(){var e=this.props.pane,t=e.search;t&&(this._selectionBeforeBlur=m.Z.save(),m.Z.reset(),t.isFocused.set(!0),A.Z.hide(),d.Z.sendEvent("SearchFocus","Desktop"),t.filters.length>0&&!E.default.menus.isContextMenuOpen("ReactContextMenuSearch")&&E.default.menus.openContextMenu({componentName:"ReactContextMenuSearch",key:"search"+e.id,element:this.refSearchBox.current,positionOffset:{top:4},noBackdrop:!0,pane:e,showFilters:this.props.showFilters,onClosed:this.blur}))}},{key:"onBlur",value:function(){var e=this.props.pane.search;e&&e.isFocused.set(!1)}},{key:"focus",value:function(){this.refInput.current.focus(),this.refInput.current.selectEnd()}},{key:"blur",value:function(){this.refInput.current&&this.refInput.current.blur(),E.default.menus.isContextMenuOpen("ReactContextMenuSearch")&&E.default.menus.closeContextMenu("ReactContextMenuSearch")}},{key:"onTapX",value:function(e){var t=this.props.pane;if(this.state.search.length>0){var n=m.Z.save();this.setSearch("",!1),n&&t.restoreSelection(n),d.Z.preventDefault(e),d.Z.sendEvent("Menu","ClearSearch")}else this.focus(),d.Z.sendEvent("Menu","FocusSearch")}},{key:"onKeyDown",value:function(e){if(this.saveScrollOfTop(),C.Z.mac&&e.ctrlKey&&e.keyCode===s.Z.KeyCode.T)return d.Z.preventDefault(e),this.blur(),void E.default.hotkeys.hotkeyAddPane();var t=this.props.pane;e.keyCode===s.Z.KeyCode.Enter&&(t.search.update(!0,!0),this.setSelectionOffset(this.state.search.length));if(e.keyCode===s.Z.KeyCode.Tab||e.keyCode===s.Z.KeyCode.Enter){var n=t.indexOfFirstItem();if(n>=0){var r=n,i=this._selectionBeforeBlur;this.blur(),i&&(m.Z.restore(i)?(this._selectionBeforeBlur=void 0,r=i.startIndex):i=null),i||(t.selectIndex(n,0),setTimeout((function(){t.selectIndex(n,0)}),0)),r>=0&&d.Z.focusedPane.scrollIndexIntoView(r,"smooth")}else t.type===s.Z.PaneMode.Task&&t.addItem();e.preventDefault(),e.stopPropagation()}}},{key:"onAutocompleteSelected",value:function(e){if(e.item){var t=this.props.pane.search,n=t.getValue(),r=n.indexOf(s.Z.PrefixItemAutocomplete);n=n.substr(0,r),t.setValue(n),this.props.pane.zoomIn(e.item,{forLoad:!1,showToast:!1,noSel:!0}),this.setSelectionOffset(n.length)}this.refInput.current.updateAutocomplete(),this.focus()}},{key:"onClickFilters",value:function(){this.focus()}},{key:"onClickPriority",value:function(){this.props.pane.search.setFilter("priority",0)}},{key:"onClickText",value:function(e){if(e.altKey){var t,n,r;if(d.Z.hasClass(e.target,"fancyInputInput")){var i=M.Z.getSelectionRange().getNativeRange();if(i){var a=(t=i.cloneRange()).startContainer.nodeValue;if(d.Z.isString(a)){for(var o=0,s=0,c=0,l=a.length,u=t.startOffset;u>=0;u--){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(" "===a[u]||160===a.charCodeAt(u)){c=u+1;break}}for(var h=t.endOffset;h<a.length;h++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(" "===a[h]||160===a.charCodeAt(h)){l=h;break}}n=l-c,r=c}}}else(t=M.Z.createSelectionRange()).selectNodeContents(e.target),r=t.startOffset,n=t.toString().length;if(t&&!isNaN(r)&&n){t.setEnd(t.startContainer,r),t.setStart(t.startContainer.parentNode,0);var p=t.toString().length,f=this.props.pane.search,g=f.getValue();E.default.PaneUpdateBatcher.beginUpdateItems(),g=(g.substr(0,p)+g.substr(p+n)).replace(/  +/g," ").trim(),f.setValue(g),E.default.PaneUpdateBatcher.commitUpdateItems(),this.setSelectionOffset(p)}}}},{key:"saveScrollOfTop",value:function(){this.props.pane}},{key:"renderSearchButton",value:function(e){var t=this.props.pane;return h.createElement(R,{key:e.name,filter:e,filterValue:e.value.get(),search:t.search,inSearch:!0})}},{key:"renderSearchPriority",value:function(){var e=this.props.pane.search.filter_priority.value.get(),t=e===s.Z.VMLIFlag.P1?1:e===s.Z.VMLIFlag.P2?2:e===s.Z.VMLIFlag.P3&&3,n=d.Z.classNames("searchPriority searchP"+t+" selected");return h.createElement("span",{key:"priority",className:n,onClick:this.onClickPriority})}},{key:"render",value:function(){var e=this.props,t=this.state,n=e.pane,r=(n.search,t.search),i=r.length>0?"icon-close":"",a=s.Z.SearchHeight,o=[],c=h.createElement(F.Z,{className:"searchX c-button noShrink",width:24,height:a,icon:i,onClick:this.onTapX}),l=h.createElement("div",{className:"searchInnerWrap",ref:"searchInnerWrap"},h.createElement(O.Z,{ref:this.refInput,className:"search",id:"search",height:a,value:r,onClick:this.onClickText,onChange:this.onChange,onKeyDown:this.onKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,onParsed:this.onParsed,parse:!0,placeholder:"Filter",autocompleteMode:"all",border:!1,underline:!1,autocompleteElementDisplay:this.refSearchBox.current,padding:{left:0,right:0},onAutocompleteSelected:this.onAutocompleteSelected,supportSearchItemAutocomplete:n.supportSearchItemAutocomplete,canAutocompleteItems:n.type===s.Z.PaneMode.Task,isSearch:!0,pane:n}));return h.createElement("div",{className:"flex-shrink-0 pr-2 searchWrap",style:{marginTop:7}},h.createElement("div",{className:"searchBox c-bg-gray-200 flexbox hide-print",ref:this.refSearchBox},h.createElement("div",{className:"searchBoxInner flexbox"},l,c),o.length>0&&h.createElement("div",{className:"box-border searchButtons noShrink"},o)))}}]),n}(x.a);function U(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=I()(e);if(t){var i=I()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return S()(this,n)}}const j=function(e){b()(n,e);var t=U(n);function n(){return k()(this,n),t.apply(this,arguments)}return Z()(n,[{key:"init",value:function(){this.DISABLE_LISTENER_ASSERT=!0}},{key:"getState",value:function(e){for(var t=0,n=e.pane,r=n.search,i={hasFilter:!1,showHelp:E.default.settings.shouldShowHelp("searchHelp"),viewState:n.viewState,viewMode:n.getViewMode(),sortModeBlocks:n.supportsSortBlocks()&&n.getSortModeBlocks(),sortModeItems:n.supportsSortItems()&&n.getSortModeItems(),calendars:L.Z.GCalendarsAvailable,displayCalendars:n.displayCalendars,displayLocalItems:n.displayLocalItems,closedHelps:E.default.settings.closedHelps},a=0;a<r.filters.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=r.filters[a];i[o.name]=o.value,i[o.name+"Enabled"]=o.enabled,0!==o.value.get()&&(i.hasFilter=!0)}return i}},{key:"onMount",value:function(){this.listenTo(this.props.pane.search.onChanged)}},{key:"componentWillReceiveProps",value:function(e){e.pane!==this.props.pane&&(this.refreshListeners(e),this.updateState(e))}},{key:"onClickSelectCalendars",value:function(e){E.default.menus.openContextMenu({componentName:"ReactContextMenuCalendars",element:e.target,pane:this.props.pane})}},{key:"saveScrollOfTop",value:function(){this.props.pane}},{key:"onToggleButton",value:function(e){this.saveScrollOfTop(),this.props.pane.search.toggleFilter(e)}},{key:"setPriority",value:function(e){this.saveScrollOfTop();var t=this.props.pane.search;t.getFilterValue("priority")===e&&(e=0),t.setFilter("priority",e)}},{key:"onClickCloseHelp",value:function(){E.default.settings.closeHelp("searchHelp")}},{key:"onClickShowHelp",value:function(){E.default.settings.uncloseHelp("searchHelp")}},{key:"renderSearchButton",value:function(e){var t=this.props.pane,n="showOnlyMatches"===e.name&&t.isViewFlatList()?1:e.value.get();return h.createElement(R,{key:e.name,filter:e,filterValue:n,search:t.search,hasBorder:!0})}},{key:"renderSearchPriority",value:function(){var e=this.props.pane.search.filter_priority.value.get(),t=d.Z.classNames("searchPriorities c-border-light",{"noScale mobutton":!0},{hasSelected:!!e}),n=d.Z.classNames("searchPriority",{"noScale mobutton":!0}),r=d.Z.classNames(n,"searchP1 t-priority1",{selected:e===s.Z.VMLIFlag.P1}),i=d.Z.classNames(n,"searchP2 t-priority2",{selected:e===s.Z.VMLIFlag.P2}),a=d.Z.classNames(n,"searchP3 t-priority3",{selected:e===s.Z.VMLIFlag.P3});return h.createElement("span",{key:"priority",className:t},h.createElement("span",{className:r,"data-tooltip":"Show only high priority",onClick:this.setPriority.bind(this,s.Z.VMLIFlag.P1)}),h.createElement("span",{className:i,"data-tooltip":"Show medium priority and higher",onClick:this.setPriority.bind(this,s.Z.VMLIFlag.P2)}),h.createElement("span",{className:a,"data-tooltip":"Show low priority and higher",onClick:this.setPriority.bind(this,s.Z.VMLIFlag.P3)}))}},{key:"render",value:function(){for(var e=0,t=this.state,n=this.props.pane,r=n.search,i=t.showHelp,a=[],o=[],s=d.Z.classNames("filterSection flexbox",{showHelp:i}),c=0;c<r.filters.length;c++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var l=r.filters[c];l.enabled.get()&&(l.isOption?l.hideInView||o.push(this.renderSearchButton(l)):l.icon?a.push(this.renderSearchButton(l)):"priority"===l.name&&a.push(this.renderSearchPriority()))}if(n.isViewDates()){var u=n.isCalFilterActive(),p=d.Z.classNames("buttonCalendars searchButton icon-calendar c-border-light c-button",{selected:u});o.push(h.createElement("div",{key:"calendars",className:p,onClick:this.onClickSelectCalendars,"data-tooltip":"Select calendars to display in this pane"}))}return h.createElement("div",{className:s},a.length>0&&h.createElement("div",null,h.createElement("div",{className:"searchFilters c-border-light"},a)),o.length>0&&h.createElement("div",null,h.createElement("div",{className:"searchFilters c-border-light"},o)))}}]),n}(x.a);var H=n(3234),V=n(3170),W=n(2770),z=n(9052),q=n(4074),G=s.Z.Mobile.TopBarHeight,K=G;const Y=(0,H.Z)((function(e){var t,n=e.pane,r=n.getTitleList(),a=V.Z.apply(void 0,[n.item,n.history,q.Z.isKeyboardOpen,n.viewState,n.document,null===(t=n.document.get())||void 0===t?void 0:t.text].concat(i()(r.map((function(e){return e.itemChanged}))))),y=o()(a,3),k=y[0],_=y[1],Z=y[2],w=(0,p.Z)(),b=(0,h.useRef)(),P=r.slice(0,r.length-1),S=r[r.length-1],D=(0,h.useRef)(),I=(0,f.Z)(D),E=K;n.mobileHeadingScrollThreshold=E,(0,h.useEffect)((function(){n.paddingTop.set(E)}),[E]);var x=n.type===s.Z.PaneMode.Task&&!n.isViewCalendar(),C=function(e,t,n,r){var i=(0,h.useMemo)((function(){return(0,g.B)(0)}),[]),a=(0,h.useState)("above"),s=o()(a,2),c=s[0],l=s[1],u=(0,v.Z)(),p=(0,h.useRef)(!1),f=(0,h.useRef)("above"),y=(0,h.useRef)();y.current={top:t,bottom:n};var k=(0,h.useRef)(e.current),_=(0,h.useCallback)((function(){if(m.Z.isTouchDown())d.Z.timeoutOnce("useScrollThreshold",_,70);else{var t=y.current,n=t.top,r=t.bottom,a=i.get();if(a<r){p.current=!0;var o=Math.abs(a-n)<Math.abs(a-r)?n:r;d.Z.scrollElementTo(e.current,{top:o,behavior:"smooth"}),d.Z.timeoutOnce("useScrollThreshold_scrolling",(function(){return p.current=!1}),140)}}}),[]),Z=(0,h.useCallback)((function(){var t=e.current;if(t){var n,a=t.scrollTop;n=a<=y.current.top?"above":a>=y.current.bottom?"below":"on",i.set(t.scrollTop),f.current!==n&&(f.current=n,l(n)),r&&!p.current&&d.Z.timeoutOnce("useScrollThreshold",_,70)}}),[]);return(0,h.useEffect)((function(){if(e.current)return k.current||(k.current=e.current,Z(),e.current.addEventListener("resize",Z),e.current.addEventListener("scroll",Z,!0)),function(){k.current.removeEventListener("resize",Z),k.current.removeEventListener("scroll",Z,!0),k.current=void 0}}),[e.current]),{scrollY:i,scrollState:c,forceRender:u}}(b,0,E,!0),A=C.scrollState,L=C.scrollY,M=C.forceRender,T=x?A:"below";(0,h.useEffect)((function(){b.current=x?d.Z.findChild(D.current.parentElement.parentElement,"paneDocumentContent"):void 0,M()}),[x,x&&k.id]);var R,O=function(e){return function(){n.onClickTitle(e)}},F=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return x?(0,c.H)(L,[n,E],[e,t]):(0,c.H)(L,[0,1],[t,t])},N=P.length>0,U=N?-2:14,H=F(17,G),Y=F(I.height-G,K+G),X=F(1,16/24),Q=F(1,10/14),J=F(36,U+6),$=F(36,14),ee=F(x?w.paneShadow(!0):0,x?w.paneShadow():0),te=F(1,0),ne=F(0,(Z?-K:0)-G),re=Z?F(0,-G,K):(0,c.H)(L,[0,1],[0,0]),ie=(0,l.c)(1),ae=function(){n.goBack()};if(n.usesVMLIs)R=function(e){var t=!x||!e&&"below"===T,r={boxShadow:ee,height:!e&&Y,translateY:ne},i=d.Z.classNames("z-10 c-background overflow-visible pointer-events-auto will-change-transform",{"invisible w-full":e},{"absolute inset-x-0 inset-y-0 inset-t-0 ":!e}),a=d.Z.classNames("flex",{"invisible w-full":e},{"absolute inset-x-0 inset-y-0 inset-t-0 ":!e}),o={marginTop:G-6},s=d.Z.classNames("c-foreground-faded origin-top-left pr-1 will-change-transform box-content",{truncate:t},{"pb-3":!0}),c={fontSize:e||"below"!==T?14:10,scale:!e&&("on"===T?Q:ie),height:14,translateX:!e&&H,translateY:e?36:$,marginBottom:-1,paddingRight:t?2*G:36},l=d.Z.classNames("font-bold whitespace-pre-wrap-break-words origin-top-left pr-1 cursor-pointer will-change-transform",{"truncate pr-1":t}),p=d.Z.classNames({truncate:t}),f={fontSize:e||"below"!==T?24:16,scale:!e&&("on"===T?X:ie),translateX:!e&&H,translateY:e?void 0:J,marginTop:e&&36,paddingRight:t?2*G:36},g={opacity:te},m=d.Z.classNames("flex flex-shrink-0 justify-center items-center will-change-transform",{"absolute inset-x-0":!t});return h.createElement(u.E.div,{className:i,style:r,ref:e?D:void 0,onClick:function(){n.scrollToTop("smooth")}},h.createElement("div",{className:"flex",style:{marginLeft:G,marginRight:G}},n.supportHistory&&h.createElement(W.TopBarIconButton,{icon:"MdArrowBack",disabled:_.length<=1,onPress:ae}),h.createElement("div",{className:"flex-1"})),h.createElement("div",{className:a,style:o},h.createElement("div",{className:"truncate f1"},n.usesVMLIs&&N&&h.createElement(u.E.div,{className:s,style:c},P.map((function(e,t){return h.createElement(h.Fragment,{key:t},t>0&&h.createElement("span",{className:"px-2"},">"),h.createElement(z.Z,{text:e.generateTitleText(n),fontWeight:"normal",className:"c-button",onPress:O(e),color:"c-foreground",padding:"",align:"left"}))}))),n.usesVMLIs?h.createElement(u.E.div,{className:l,style:f},h.createElement(z.Z,{text:S.generateTitleText(n),onPress:function(e){b.current.scrollTop>E?n.scrollToTop("smooth"):n.overview.toggle()},color:"c-foreground",padding:"",align:"left",displayBlock:!0,className:p})):void 0),!t&&h.createElement(u.E.div,{className:m,style:g},h.createElement(B,{pane:n}),h.createElement(j,{pane:n}))))};else{var oe=(0,V.Z)(n.titles),se=o()(oe,1)[0],ce={boxShadow:w.paneShadow(),paddingLeft:s.Z.Mobile.TopBarHeight,paddingRight:s.Z.Mobile.TopBarHeight},le={marginTop:-4};R=function(){return h.createElement("div",{className:"flex items-center h-full pointer-events-auto c-background",style:ce},h.createElement("div",{className:"flex-1 pr-2 truncate"},(null===se||void 0===se?void 0:se.length)>1&&h.createElement("div",{className:"truncate text-10 c-foreground-faded"},se[0]),h.createElement("div",{className:"font-bold text-15"},se[1]||se[0]||"Email")),h.createElement("div",{className:"relative flex",style:le},h.createElement(B,{pane:n}),h.createElement(j,{pane:n})))}}var ue={translateY:re};return h.createElement("div",{className:"absolute inset-x-0 pointer-events-none z-3",style:{height:K}},x&&R(!0),R(),h.createElement(u.E.div,{className:"absolute inset-x-0 z-10 flex inset-t-0 will-change-transform",style:ue},h.createElement(W.TopBarIconButton,{icon:"MdMenu",onPress:function(){n.onTapOverviewButton()}}),h.createElement("div",{className:"flex-1"}),h.createElement(W.TopBarIconButton,{icon:"MdMoreHoriz",onPress:function(e){var t=n.getActionSheetItems();t&&q.Z.openActionSheet({element:e.target,items:t})}})))}))},1257:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>f});var r=n(7154),i=n.n(r),a=n(6479),o=n.n(a),s=n(9955),c=n(7100),l=n(4654),u=n(3234);const d=(0,u.Z)((function(e){var t=e.contact,n=function(e){return function(t){l.default.menus.closeContextMenu(),l.default.openUrl(e.link,t,!0)}},r=function(e){return function(t){var n=l.default.pluginManager.getPluginGmail();if(n.isActive()&&n.isEnabled()&&!c.Z.demo){l.default.menus.closeContextMenu();var r={to:[{text:"",email:e.address}]};l.default.menus.openComposeEmail(n,{initData:r})}else l.default.openUrl(e.link,t,!0)}};return s.createElement("div",{className:"contactPreview"},s.createElement("div",{className:"contactName c-border"},t.text),t.phoneNumbers&&t.phoneNumbers.map((function(e){return s.createElement("div",{className:"contactRow contactPhone",key:e.number},s.createElement("i",{className:"contactButton icon-phone c-foreground-super-faded"}),s.createElement("span",{className:"contactNumber link",onClick:n(e)},e.number),s.createElement("span",{className:"phoneType c-foreground-faded"},e.type))})),t.emails&&t.emails.map((function(e){return s.createElement("div",{className:"contactRow contactEmail",key:e.address},s.createElement("i",{className:"icon-mail_outline contactButton c-foreground-super-faded"}),s.createElement("span",{className:"contactEmail link",onClick:r(e)},e.address))})))}));var h=n(3067),p=["type","contact"];const f=(0,u.Z)((function(e){var t=e.type,n=e.contact,r=o()(e,p);return s.createElement(h.Z,i()({type:t},r),s.createElement(d,{contact:n}))}))},7259:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>G});var r=n(7154),i=n.n(r),a=n(6479),o=n.n(a),s=n(9955),c=n(8133),l=n(3234),u=n(8926),d=n.n(u),h=n(3038),p=n.n(h),f=n(7757),g=n.n(f),m=n(8855),v=n(8651),y=n(7151),k=n(4654),_=n(9603),Z=n(6604),w=n(1095),b=n(2377),P=n(9647),S=n(3170);n(7274);const D=(0,l.c)((0,s.forwardRef)((function(e,t){var n,r,i=e.id,a=e.style,o=e.tabIndex,c=e.className,l=e.classNameText,u=e.checked,d=e.checkedObservable,h=e.initialChecked,f=e.disabled,g=e.onChange,y=e.checkedColor,k=e.size,_=e.radio,Z=e.error,w=e.tooltip,b=e.extra,P=e.getCheckedFromObservable,D=e.rightAlign,I=e.children,E=(0,s.useRef)(),x=(0,s.useState)(!1),C=p()(x,2),A=C[0],L=C[1];if(d){var M;0;var T=(0,S.Z)(d),R=p()(T,1)[0];r=d.set.bind(d),n=null!==(M=null===P||void 0===P?void 0:P(R))&&void 0!==M?M:R}else{var O=(0,s.useState)(!f&&(u||h)),F=p()(O,2);n=F[0],r=F[1],void 0!==u&&(0,s.useEffect)((function(){r(u)}),[u])}(0,s.useImperativeHandle)(t,(function(){return{getValue:function(){return n},setValue:function(e){return r(e)},getExtra:function(){return b},reset:function(){return r(h)}}}));var N=function(){if(!f){L(!0),setTimeout((function(){L(!1)}),300);var e=!n;r(e),g&&!1===g(e)&&r(!e)}},B={background:n&&y,width:k,height:k,lineHeight:k&&k-1+"px",fontSize:k&&k-4+"px"},U=v.Z.classNames("fancyCheckbox",{checked:n},{disabled:f},{animate:A},{radio:_},{error:Z},c),j=v.Z.classNames("fancyCheckboxText",l),H=v.Z.classNames("fancyCheckboxCheck",{"c-button-raised-primary":n&&!f}),V=s.createElement("span",{className:H,style:B,"data-tooltip":w||null});return s.createElement("span",{className:U,onClick:N,id:i,style:a,tabIndex:o,onKeyDown:function(e){e.keyCode===m.Z.KeyCode.Enter&&N()},ref:E,"data-tooltip":w||null},s.createElement("input",{className:"fancyCheckboxInput",type:"checkbox",checked:n||!1,onChange:v.Z.emptyFn}),!D&&V,I&&s.createElement("span",{className:j},I),D&&V)})));var I=n(1319),E=n(7100),x=["onChange"];const C=(0,l.Z)((function(e){var t=e.onChange,n=o()(e,x),r=(0,s.useRef)(),a=(0,s.useCallback)((function(e){return 0===e.length||!!k.default.parseDate(e)}),[]),c=(0,s.useCallback)((function(e){r.current=k.default.parseDate(e),E.Z.isiOS||t(r.current)}),[t]),l=(0,s.useCallback)((function(){E.Z.isiOS&&t(r.current)}),[t]);return s.createElement(I.Z,i()({},n,{onChange:c,onBlur:l,validator:a,type:"date",noUpdateValueWhileFocused:!0}))}));var A=["onChange","value"],L=/^(1[0-2]|0?[1-9])(?:[:.]?([0-5]?[0-9]))?(\u25cf?[AP]M)?$/,M=/^(2[0-3]|[01]?[0-9])(?:[:.]?([0-5]?[0-9]))?$/,T=function(e){var t=+e[1],n=+e[2]||0;return 12===t&&"AM"===e[3]?t=0:12!==t&&"PM"===e[3]&&(t+=12),{hours:t,minutes:n}};const R=(0,l.Z)((function(e){var t,n=e.onChange,r=e.value,a=o()(e,A),c=(0,s.useRef)(),l=(0,s.useCallback)((function(e){var t=e.toUpperCase();return 0===e.length||!(!t.match(L)&&!t.match(M))}),[]),u=(0,s.useCallback)((function(e){var t;if(e.length>0){var r=e.toUpperCase(),i=r.match(L)||r.match(M);if(i){var a=T(i),o=a.hours,s=a.minutes;t={hours:o,minutes:s,ms:0===o&&0===s?1:0}}}c.current=t,E.Z.isiOS||n(t)}),[n]),d=(0,s.useCallback)((function(){E.Z.isiOS&&n(c.current)}),[n]),h=null===(t=r)||void 0===t?void 0:t.toUpperCase().match(L);if(h){var p=T(h),f=p.hours,g=p.minutes;r="".concat(f,":").concat(v.Z.pad2(g))}return s.createElement(I.Z,i()({},a,{value:r,onChange:u,validator:l,noUpdateValueWhileFocused:!0,type:"time",onBlur:d}))}));var O,F=n(5428),N=n(2770),B=n(3687),U=(n(794),{weekends:{daysOfWeek:[0,6]},all:{daysOfWeek:[0,1,2,3,4,5,6]}});const j=(0,l.Z)((function(e){var t,n=e.refMooDate,r=e.onDoubleClick,i=e.onChange,a=(0,S.Z)(k.default.settings.dayWeekStart),o=p()(a,1)[0],c=(0,s.useRef)({day:void 0,time:0}),l=(0,Z.Z)(),u=n.current,d=null===u||void 0===u?void 0:u.getStart(),h=null===u||void 0===u?void 0:u.getEnd(),f=(null===u||void 0===u?void 0:u.isRepeatDate())&&!(null!==u&&void 0!==u&&u.isRange()),g=Object.assign({from:d,to:h},U),v=f?null===u||void 0===u?void 0:u.getAllDates():[d,{from:d,to:h}],y=(0,s.useCallback)((function(e){var t=n.current;e.clearTime(),O=e,t?t.setDate(e):t=n.current=new w.Z(e),l(),i()}),[]),b=(0,s.useCallback)((function(e,t,r){var a=n.current;if(1===r.buttons&&a){var o;e.clearTime();var s=null!==(o=O)&&void 0!==o&&o.isBefore(e)?[O,e]:[e,O],c=p()(s,2),u=c[0],d=c[1];if(_.Z.isSameDay(u,d))a.setDate(u);else{var h=null===a||void 0===a?void 0:a.getTime(),f=h?h/m.Z.MSPerHour:0;a.setRange(u,d,f)}l(),i()}}),[]),P=(0,s.useCallback)((function(e){var t=Date.now();c.current.day===e&&t-c.current.time<500?(c.current=null,r()):c.current={day:e,time:t}}),[]),D=f?"":"DatePickerRange";return t={all:{padding:12}},s.createElement("div",{className:"flex justify-center",style:{lineHeight:"normal"}},s.createElement(B.ZP,{className:D,showOutsideDays:!0,modifiers:g,modifiersStyles:t,selectedDays:v,firstDayOfWeek:o,onDayMouseDown:y,onDayMouseEnter:b,onDayClick:P}))}));var H=[{id:"none",value:"No repeat"},{id:"daily",value:"Daily"},{id:"weekly",value:"Weekly"},{id:"weekdays",value:"Weekdays"},{id:"monthly",value:"Monthly"},{id:"yearly",value:"Yearly"}],V=32;const W=(0,l.Z)((function(e){var t,r,i,a,o,l,u=e.item,h=e.paneObject,f=e.textOffset,S=e.focused,E=e.onUnmount,x=e.close,A=(0,s.useRef)(!1),L=(0,s.useRef)(null===(t=u.getMooDate())||void 0===t?void 0:t.clone()),M=(0,s.useRef)(),T=(0,s.useRef)(),O=(0,s.useState)(null===(r=L.current)||void 0===r?void 0:r.toText()),B=p()(O,2),U=B[0],W=B[1],z=(0,b.Z)(null===(i=L.current)||void 0===i?void 0:i.repeatComplete),q=p()(z,1)[0],G=(0,Z.Z)(),K=k.default.pluginManager.getPluginGCalendar(),Y=u.hasPluginAttachment(m.Z.PluginID.GCalendar),X=K.getWriteableCalendarsForItem(u),Q=X.calendars,J=X.selected;!v.Z.isDemoMode()&&!L.current&&K.isEnabled()&&K.getSetting("syncPopup")&&(M.current=K.getDefaultExportCalendarID()),void 0!==M.current&&(J=M.current);var $,ee="",te="",ne="",re="";if(L.current){var ie=L.current;o=ie.getStart(),l=ie.getEnd();var ae,oe=ie.getRRuleOptions(),se=oe&&function(e){var t=e.interval,n=e.freq,r=e.byweekday;return n===y.Di.DAILY&&1===t?"daily":n===y.Di.WEEKLY&&r&&r.length>1?"weekdays":n===y.Di.WEEKLY&&1===t?"weekly":n===y.Di.MONTHLY&&1===t?"monthly":n===y.Di.YEARLY&&1===t?"yearly":"Custom"}(oe);if(se)$=(null===(ae=H.find((function(e){return e.id===se})))||void 0===ae?void 0:ae.value)||"Custom";var ce=ie.isRange(),le=ie.isRepeatDate()&&!ce;ee=o.toString("yyyy-MM-dd")||"",te=o.hasTimeOfDay()?_.Z.getTimeText(o):"",ne=ce||ie.hasUntil()||ie.getDuration()&&!le?l.toString("yyyy-MM-dd"):"",re=o.hasTimeOfDay()&&l.hasTimeOfDay()?_.Z.getTimeText(l):""}(0,s.useEffect)((function(){return S&&setTimeout((function(){T.current.focus()}),150),k.default.onIntroAction("Date"),function(){if(u){var e=L.current,t=h?h.getDisplayText():u.getDisplayText({showMarkdown:!1});e&&e.setRepeatOnComplete(q.get()),u.setMooDate(e,m.Z.ChangeType.Local,["repeatComplete"].concat(null!==e&&void 0!==e&&e.duration?["duration"]:[]));var n=h||{item:u,showMarkdown:function(){return k.default.settings.showMarkdown.get()}};if(e&&u.getRawText().indexOf(m.Z.CharDate)<0){void 0===f&&(f=t.length);var r=f,i=0,a="";t[f-1]&&t[f-1]!==m.Z.PrefixDate&&" "!==t[r]&&(a=" "),t[f-1]===m.Z.PrefixDate&&(r--,i++);var o=u.elsNew.spliceText(a+m.Z.CharDate+" ",r,i,n);o[f-1]===m.Z.PrefixDate&&(o=v.Z.stringRemove(o,r-1,1)),u.setText(o,m.Z.ChangeType.Local)}else if(A.current&&f&&!e&&t[f-1]===m.Z.PrefixDate){var s=u.elsNew.spliceText("",f-1,1,n);u.setText(s,m.Z.ChangeType.Local)}if(e){var c=M.current;if(void 0!==c)k.default.pluginManager.getPluginGCalendar().setCalendarForItem(u,c)}}null===E||void 0===E||E()}}),[]);var ue,de=(0,s.useCallback)((function(){var e;A.current=!0,W((null===(e=L.current)||void 0===e?void 0:e.toText())||""),G()}),[]),he=(0,s.useCallback)((function(){de()}),[]),pe=(0,s.useCallback)((function(){x()}),[]),fe=(0,s.useCallback)((function(e){A.current=!0,L.current=e?_.Z.parseText(e):void 0,W(e),G()}),[]),ge=(0,s.useCallback)((function(e){L.current||(L.current=new w.Z(e)),L.current.setDate(e),de()}),[]),me=(0,s.useCallback)((function(e){L.current||(L.current=new w.Z(Date.today()));var t=L.current;if(e){var n=e.hours,r=e.minutes;t.setHours(n+r/60),0===t.getDuration()&&t.setDuration(m.Z.MSPerHour)}else t.clearTime();de()}),[]),ve=(0,s.useCallback)((function(e){L.current||(L.current=new w.Z(Date.today()));var t=L.current;if(e)if(t.isSingleDate()){var n=t.getEnd();e.setHours(n.getHours(),n.getMinutes(),0,n.getMilliseconds());var r=+e-+t.getDate();r>0&&t.setDuration(r)}else t.setUntil(e);else t.clearTime(),t.setDuration(0);de()}),[]),ye=(0,s.useCallback)((function(e){L.current||(L.current=new w.Z(new Date));var t=L.current;if(e){var n=e.hours,r=e.minutes,i=e.ms,a=t.getStart(),o=(t.isSingleDate()?t.getEnd():t.getStart()).clone();o.setHours(n,r,0,i);var s=+o-+a;t.setDuration(s)}de()}),[]),ke=(0,s.useCallback)(function(){var e=d()(g().mark((function e(t){var n,r,i,a;return g().wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!(n=L.current)){e.next=9;break}return e.next=4,k.default.menus.openContextMenuList("Repeat",t.target,H);case 4:r=e.sent,i=n.getStart(),"daily"===r?a={freq:y.Ci.DAILY,interval:1}:"weekdays"===r?a={freq:y.Ci.WEEKLY,interval:1,byweekday:[0,1,2,3,4].map((function(e){return new y.OG(e,void 0)}))}:"weekly"===r?a={freq:y.Ci.WEEKLY,interval:1}:"monthly"===r?a={freq:y.Ci.MONTHLY,interval:1}:"yearly"===r?a={freq:y.Ci.YEARLY,interval:1}:"none"===r&&n.setDate(i),a&&(a.byweekday||(a.byweekday=null),a=Object.assign({dtstart:_.Z.toUTCDate(i.clearTime())},a),n.updateRRuleOptions(a)),de();case 9:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),_e=(0,s.useCallback)(function(){var e=d()(g().mark((function e(t){var n,r;return g().wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(n=(J?[{id:null,value:"Remove from Calendar"}]:[]).concat(Q.map((function(e){return{id:e.id,value:e.summary}}))),!$){e.next=5;break}k.default.toasts.pushMessage("Syncing repeat dates with Google Calendar is not currently supported"),e.next=16;break;case 5:return e.next=8,v.Z.promisify((function(e){c.o0.openActionSheet({title:"Choose an account",items:n.map((function(t){return{text:t.value,onPress:function(){return e(t.id)}}}))})}));case 8:r=e.sent,e.next=14;break;case 11:return e.next=13,k.default.menus.openContextMenuList("Select a calendar",t.target,n);case 13:r=e.sent;case 14:M.current=r,G();case 16:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}(),[J,$,Q,G]),Ze=(0,s.useCallback)((function(){L.current=void 0,de()}),[]),we=J?(null===Q||void 0===Q||null===(a=Q.find((function(e){return e.id===J})))||void 0===a?void 0:a.summary)||J:"".concat(Y?"Remove from":"Add to"," calendar"),be=$||"Repeat",Pe=s.createElement(I.Z,{placeholder:"Type or select a date",className:"flex-1",border:!1,value:U,onChange:fe,focused:!1,height:m.Z.Mobile.TopBarHeight,buttonText:void 0,onButtonClick:Ze,buttonEnabled:!!U,onEnter:x,ref:T}),Se=n(2770),De=Se.TopBar,Ie=Se.TopBarIconButton;return ue=s.createElement(De,null,s.createElement(Ie,{icon:"IoIosArrowBack",onPress:function(){c.o0.closeMenu("Date")}}),Pe,s.createElement(N.TopBarTextButton,{text:"Clear",mode:"contained",onPress:Ze})),s.createElement("div",{className:"flex flex-col c-foreground"},ue,s.createElement("div",null,s.createElement("div",{className:"flex items-center px-2 pt-2 border-t c-border"},s.createElement("div",{className:"pr-3 c-foreground-light",style:{width:52}},"Starts:"),s.createElement(F.J,{name:"MdToday",size:18,className:"c-foreground-light"}),s.createElement(C,{placeholder:"Start date",value:ee,height:V,width:140,className:"ml-2",onChange:ge}),s.createElement(R,{placeholder:"Start time",border:!0,value:te,height:V,width:120,className:"ml-2",onChange:me})),s.createElement("div",{className:"flex items-center px-2 pt-2"},s.createElement("div",{className:"pr-3 c-foreground-light",style:{width:52}},"Ends:"),s.createElement(F.J,{name:"IoMdCalendar",size:18,className:"c-foreground-light"}),s.createElement(C,{placeholder:"End date",value:ne,height:V,width:140,className:"ml-2",onChange:ve}),s.createElement(R,{placeholder:"End time",border:!0,value:re,height:V,width:120,className:"ml-2",onChange:ye})),(null===Q||void 0===Q?void 0:Q.length)>0&&s.createElement("div",{className:"flex items-center px-2 pt-2"},s.createElement(P.Z,{mode:"outlined",padding:"px-3",icon:"IoIosCalendar",iconSize:18,text:we,height:V,align:"left",onMouseDown:_e})),s.createElement("div",{className:"flex items-center px-2 pt-2"},(v.Z.isDemoMode()||!J)&&s.createElement(P.Z,{mode:"outlined",padding:"px-3",icon:"IoIosRepeat",iconSize:18,text:be,height:V,align:"left",onMouseDown:ke,disabled:!L.current}),(!v.Z.isDemoMode()||$)&&s.createElement(D,{className:"ml-3",checkedObservable:q,disabled:!$},"Repeat from complete")),s.createElement(j,{data:U,refMooDate:L,onChange:he,onDoubleClick:pe})))}));var z=n(3067),q=["type","item","paneObject","focused"];const G=(0,l.Z)((function(e){var t=e.type,n=e.item,r=e.paneObject,a=e.focused,l=o()(e,q);return s.createElement(z.Z,i()({type:t},l,{className:"overflow-y-auto",stayFullscreenOnceFullscreened:!0}),s.createElement(W,{item:n,paneObject:r,focused:a,close:function(){c.o0.closeMenu(t)}}))}))},2402:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>m});var r=n(3038),i=n.n(r),a=n(8651),o=n(8855),s=n(9955),c=n(4654),l=n(4372),u=n(3278),d=n(3234),h=n(3170),p=n(3067),f=n(9052),g=n(4074);const m=(0,d.Z)((function(e){var t=e.type,n=(0,h.Z)(c.default.dropBucket.items,c.default.DragDrop.dragging),r=i()(n,2),d=r[0],m=r[1],y=function(e){return function(){c.default.dropBucket.hasItemEntry(e.item)&&(c.default.dropBucket.removeItemEntry(e.item.id),c.default.dropBucket.hasItems()||g.Z.closeMenu(t))}},k="flex-1 py-4 pr-1",_=d.map((function(e){return s.createElement("div",{key:e.item.id,style:v,className:"flex items-center dropBucket"},s.createElement(l.Z,{className:"flex-1",pane:e.pane,dragOptions:{id:e.item.id,item:e.item,pane:e.pane,onDrop:y(e)}},a.Z.isVMLI(e.item)?s.createElement(u.Z,{item:e.item,numberOfLines:4,className:k}):s.createElement("div",{className:k},e.item.text)),s.createElement(f.Z,{icon:"MdClose",iconSize:24,width:o.Z.Mobile.TopBarHeight,height:o.Z.Mobile.TopBarHeight,onPress:y(e)}))}));return s.createElement(p.Z,{type:t,noBackdrop:(null===m||void 0===m?void 0:m.items.length)>0,title:"Clipboard"},s.createElement("div",{className:"pb-8 pl-4"},_))}));var v={minHeight:48}},7056:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>L});var r=n(7154),i=n.n(r),a=n(3038),o=n.n(a),s=n(6479),c=n.n(s),l=n(8855),u=n(8651),d=n(7100),h=n(9955),p=n(8133),f=n(4575),g=n.n(f),m=n(3913),v=n.n(m),y=n(2205),k=n.n(y),_=n(8585),Z=n.n(_),w=n(9754),b=n.n(w),P=n(4654),S=n(9758);function D(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=b()(e);if(t){var i=b()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Z()(this,n)}}const I=function(e){k()(n,e);var t=D(n);function n(){return g()(this,n),t.apply(this,arguments)}return v()(n,[{key:"init",value:function(){var e=this.props,t=e.item.hasNote()&&e.item.getNote(),n=t?t.getParsedText():void 0;this.createObservables({hasValue:!!n}),this.refNoteText=h.createRef()}},{key:"onUnmount",value:function(){clearTimeout(this._noteUpdateTimeout),this._noteUpdateTimeout=void 0,this._saveNote()}},{key:"getValue",value:function(){return this.refNoteText.current.getValue()}},{key:"_saveNote",value:function(){if(this.props.shouldSave){P.default.PaneUpdateBatcher.beginUpdateItems();var e=this.props.item,t=e.hasNote()&&e.getNote(),n=this.refNoteText.current.getValue();!t&&n&&(t=e.createNote()),t&&(n!==t.getRawText()&&t.setText(n,l.Z.ChangeType.Local),n||e.setNote(void 0,l.Z.ChangeType.Local)),P.default.PaneUpdateBatcher.commitUpdateItems()}}},{key:"focus",value:function(){this.refNoteText.current.focus()}},{key:"onChange",value:function(){var e=this,t=this.refNoteText.current.getValue().length>0;t!==this.hasValue.get()&&(this.hasValue.set(t),t&&this.props.onValueSet&&requestAnimationFrame((function(){return e.props.onValueSet}))),clearTimeout(this._noteUpdateTimeout),this._noteUpdateTimeout=setTimeout(this._saveNote,8e3)}},{key:"render",value:function(){var e=this.props,t=P.default.DisplaySettings.fontSize(),n=e.item.hasNote()&&e.item.getNote(),r=n?n.getParsedText():void 0,i=n?void 0:"Add note",a=this.state.hasValue?e.heightValue:e.heightEmpty,o=!e.item.canHaveNote();return h.createElement(S.Z,{ref:this.refNoteText,className:e.className,value:r,placeholder:i,focused:e.focused,onChange:this.onChange,onKeyDown:e.onKeyDown,onKeyPress:e.onKeyPress,selectionStart:e.selectionStart,selectionEnd:e.selectionEnd,fontSize:t,margin:0,height:a,tabIndex:e.tabIndex,richText:!!e.richText,onMaximize:e.richText&&e.onMaximize,isMaximized:e.richText&&e.isMaximized,onClickClose:e.onClickClose,isReadOnly:o,style:e.style})}}]),n}(n(404).a);var E=n(3234),x=n(2770),C=n(3067),A=["type","item","startFullscreen","onClosed"];const L=(0,E.Z)((function(e){var t=e.type,n=e.item,r=e.startFullscreen,a=e.onClosed,s=c()(e,A),f=(0,h.useRef)(),g=(0,h.useState)(r),m=o()(g,2),v=m[0],y=m[1];(0,h.useEffect)((function(){return r&&setTimeout((function(){var e;null===(e=f.current)||void 0===e||e.focus()}),150),function(){a()}}),[]);var k=(0,h.useCallback)((function(e){y(e),e&&setTimeout((function(){var e;null===(e=f.current)||void 0===e||e.focus()}),150)}),[]),_=u.Z.classNames("flex-1",{"px-2 py-2":!v},{"px-1 py-1":v}),Z={height:v?"100%":void 0},w=d.Z.isiOS&&d.Z.majorVersion<=12?{paddingBottom:100}:void 0,b=(0,h.useMemo)((function(){return h.createElement(x.TopBar,null,h.createElement(x.TopBarIconButton,{icon:"IoIosArrowBack",onPress:function(){var e,n;null===(e=document.activeElement)||void 0===e||null===(n=e.blur)||void 0===n||n.call(e),p.o0.closeMenu(t)}}),h.createElement("div",{className:x.ClassNameTopBarTitle},"Edit note"))}),[]);return h.createElement(C.Z,i()({type:t},s,{spring:l.Z.TransitionSpringFaster,classNameContentFullscreen:"h-full",fullscreen:r,stayFullscreenOnceFullscreened:!0,topBar:b,keyboardToolbarHeight:l.Z.KeyboardToolbarButtonHeight+8,onFullscreenChange:k}),h.createElement("div",{className:"box-border flex flex-col overflow-auto",style:Z},h.createElement(I,{className:_,richText:!0,shouldSave:!0,item:n,ref:f,style:w})))}))},6441:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>p});var r=n(7154),i=n.n(r),a=n(6479),o=n.n(a),s=n(9955),c=n(4654),l=n(3234),u=n(3067),d=n(9052),h=["type","href"];const p=(0,l.Z)((function(e){var t=e.type,n=e.href,r=o()(e,h);return s.createElement(u.Z,i()({type:t},r),s.createElement("div",{className:"flex items-center px-4 py-3 overflow-hidden"},s.createElement("div",{className:"flex-1 pr-4 overflow-hidden break-words whitespace-pre-wrap"},n),s.createElement(d.Z,{text:"OPEN",color:"c-button-primary",onPress:function(){c.default.openUrl(n)}})))}))},1806:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Z});var r=n(7154),i=n.n(r),a=n(8926),o=n.n(a),s=n(3038),c=n.n(s),l=n(6479),u=n.n(l),d=n(7757),h=n.n(d),p=n(8651),f=n(9955),g=n(1319),m=n(8133),v=n(3234),y=n(3067),k=n(9052),_=["type","title","text","fields","noCancel","validate","callback"];const Z=(0,v.Z)((function(e){var t=e.type,n=e.title,r=e.text,a=e.fields,s=e.noCancel,l=e.validate,d=e.callback,v=u()(e,_),Z=(0,f.useRef)(!1),w=[];a.forEach((function(e,t){w[t]=(0,f.useRef)()}));var b=(0,f.useState)(),P=c()(b,2),S=P[0],D=P[1];(0,f.useEffect)((function(){return function(){I([])}}),[]);var I=function(e){Z.current||(Z.current=!0,null===d||void 0===d||d(e),m.o0.closeMenu(t))},E=function(){var e=o()(h().mark((function e(){var t,n;return h().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return t=w.map((function(e){return e.current.getValue()})),e.next=3,null===l||void 0===l?void 0:l(t);case 3:(n=e.sent)?D(n):I(t);case 5:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}(),x=p.Z.classNames("p-4 c-foreground",{"absolute inset-0 flex flex-col items-center justify-center":s});return f.createElement(y.Z,i()({classNameContent:x,type:t,fullscreen:s},v),f.createElement("div",{style:{maxWidth:460}},n&&f.createElement("div",{className:"pb-6 font-bold text-18"},n),r&&f.createElement("div",{className:"pb-4"},r),a.map((function(e,t){return f.createElement(g.Z,{key:t,focused:0===t,ref:w[t],type:e.type,placeholder:e.placeholder,value:e.value,className:"mb-4",onEnter:t===a.length-1&&E})})),S&&f.createElement("div",{className:"mt-2 error"},S),f.createElement("div",{className:"flex justify-center"},f.createElement(k.Z,{color:"c-button-primary",text:"OK",onPress:E}),!s&&f.createElement(k.Z,{text:"CANCEL",onPress:function(){return I([])},className:"ml-6"}))))}))},2701:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var r=n(3038),i=n.n(r),a=n(8926),o=n.n(a),s=n(7757),c=n.n(s),l=n(8855),u=n(5172),d=n(3470),h=n(8651),p=n(9955),f=n(4472),g=n(4654),m=n(6604),v=n(5802),y=n(3234),k=n(8047),_=n(4074),Z={},w=(0,y.c)((0,p.forwardRef)((function(e,t){var n=e.paneObject,r=e.className,i=e.state,a=e.children,s=e.style,f=e.setAnimated,g=(0,u._)(),v=(0,m.Z)(),y=(0,p.useCallback)(function(){var e=o()(c().mark((function e(t){return c().wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return 0===t||i.scrollListener||(n.pane.addScrollListener(k),i.scrollListener=k),i.positionPrevious=t,i.isOpen=0!==t,e.next=5,g.start({x:t,transition:l.Z.TransitionSpring});case 5:0!==t||i.isOpen||(i.direction=!1,delete Z[n.id],f(!1));case 6:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),k=(0,p.useCallback)((function(){i.scrollListener&&(n.pane.removeScrollListener(k),i.scrollListener=void 0),y(0)}),[]);i.close=k,(0,p.useImperativeHandle)(t,(function(){return{updateOnMove:function(e,t){t&&(i.isOpen=!0,v()),g.stop(),g.set({x:e})},updateOnUp:function(e){y(e)}}}));var _,w=i.direction;if(!1!==w&&i.swipeMenu){var b=h.Z.classNames("absFull flex pointer-events-none",w>0?"justify-start":"justify-end"),P=i.swipeMenu[w>0?"left":"right"];_=p.createElement("div",{className:b,style:{backgroundColor:P[0].backgroundColor,zIndex:2}},P.map((function(e){return p.createElement("div",{key:e.icon,className:"flex items-center justify-center pointer-events-auto bypassPaneObjectTouch mobutton",onClick:(t=e.onActivated,function(){k(),t()}),style:{backgroundColor:e.backgroundColor,width:!e.text&&50,height:"100%"}},p.createElement("div",{className:h.Z.classNames("icon-"+e.icon,e.text&&"pl-3"),style:{fontSize:18,color:"white"}}),e.text&&p.createElement("div",{className:"pl-3 c-foreground-white"},e.text));var t})))}return p.createElement(p.Fragment,null,_,p.createElement(d.E.div,{className:r+" pointer-events-none inset-x-0",animate:g,style:Object.assign({position:"absolute",top:0,zIndex:3},s)},a))})));const b=(0,y.c)((0,p.forwardRef)((function(e,t){var n=e.paneObject,r=e.className,a=e.supportMultiselect,o=e.onPress,s=e.children,c=e.style,l=(0,p.useRef)(),u=(0,p.useState)(!1),d=i()(u,2),m=d[0],y=d[1],b=(0,p.useMemo)((function(){return{direction:!1,isOpen:!1,didHold:!1,swipeMenu:void 0,timeoutReset:void 0,positionPrevious:0,close:void 0,scrollListener:void 0}}),[]),P=(0,v.Z)({children:s,style:c,className:r,paneObject:n,supportMultiselect:a,onPress:o}),S=(0,p.useMemo)((function(){return{onTouchStart:function(e,t){var n=P.current.paneObject;if(_.Z.isKeyboardOpen.get()||_.Z.isMenuOpen()||n.pane.isOverviewVisible())return!1;clearTimeout(b.timeoutReset),Object.keys(Z).forEach((function(e){var t,r;e!==n.id&&(null===(t=(r=Z[e]).close)||void 0===t||t.call(r))})),b.direction=!1,b.didHold=!1,b.isOpen&&h.Z.preventDefault(t),b.timeoutHold=setTimeout((function(){b.direction||b.isOpen||(b.didHold=!0,k.Z.beginBatch(),!1!==P.current.supportMultiselect&&f.Z.multiselect(n),_.Z.isHoldDown.set(!0),k.Z.endBatch())}),400)},onTouchMove:function(e,n,r){var i=e.x,a=e.y,o=e.diffX,s=e.distanceX,c=e.distanceY,u=(o+=b.positionPrevious)>0?1:-1,d=u!==b.direction,m=P.current.paneObject;if(b.didHold){if(!f.Z.isMultiselected()){var v=t.current,k=P.current,w=p.createElement("div",{className:k.className,style:k.style,key:0},k.children),S=h.Z.offset(v),D={pane:m.pane,width:400,items:[{id:m.item.id,item:m.item,element:w}],positionOffset:{x:i-S.left,y:a-S.top},mousePositionStart:{x:i,y:a}};g.default.DragDrop.checkDragMoveNew(D,e)&&_.Z.isHoldDown.set(!1)}}else b.direction||b.didHold||f.Z.isInMobileMultiselect()||(s>3&&c<3?(b.direction=u,b.swipeMenu=m.pane.getSwipeMenuItems(m),Z[m.id]=b,y(!0)):c>=3&&(clearTimeout(b.timeoutHold),r()));b.direction&&(b.direction=u,clearTimeout(b.timeoutHold),l.current&&l.current.updateOnMove(o,d)),(b.direction||b.didHold)&&h.Z.preventDefault(n)},onTouchEnd:function(e,t){var n=e.clientX,r=e.clientY,i=e.diffX,a=e.distanceX,o=e.distanceY,s=P.current.paneObject;if(clearTimeout(b.timeoutHold),b.direction)if(((i+=b.positionPrevious)>0?1:-1)>0||i>-100){var c;null===(c=b.close)||void 0===c||c.call(b),i>100&&setTimeout((function(){b.swipeMenu.left[0].onActivated()}),300)}else{var u,d=-50*b.swipeMenu.right.length;null===(u=l.current)||void 0===u||u.updateOnUp(d)}else if(b.didHold)g.default.DragDrop.dragging.get()?(g.default.DragDrop.checkDragEndNew({clientX:n,clientY:r,dataTransfer:{pane:s.pane}}),f.Z.reset(),h.Z.cancelRepeatScrolls()):_.Z.isHoldDown.set(!1),h.Z.preventAndStop(t);else if(!b.didHold&&a<3&&o<3){var p,m;if(b.isOpen)b.close();else if(f.Z.hasFullSelection())h.Z.preventAndStop(t),f.Z.multiselect(s);else null===(p=(m=P.current).onPress)||void 0===p||p.call(m,t)}}}}),[P,b,t]);return function(e,t){(0,p.useEffect)((function(){_.Z.setTouchEventListeners(e,t)}),[e])}(n.id,S),(0,p.useEffect)((function(){return function(){clearTimeout(b.timeoutHold)}}),[]),r=(r||"")+" swiper",p.createElement("div",{ref:t},p.createElement("div",{style:c,className:r},s),m&&p.createElement(w,{paneObject:n,className:r,style:c,state:b,setAnimated:y,ref:l},s))})))},7404:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a);const s=new(function(){function e(){i()(this,e)}return o()(e,[{key:"onTouchMoveEnd",value:function(e){var t=e.ev,n=e.onMove,r=e.onUp,i=e.onPress,a=e.active,o=0,s=0,c=0,l=0,u=t.touches[0].clientX,d=t.touches[0].clientY,h=function(e){try{var t=e.touches[0].clientX,r=e.touches[0].clientY,i=t-u,a=t-d;o+=Math.abs(t-(c||t)),s+=Math.abs(r-(l||r)),null===n||void 0===n||n({x:t,y:r,clientX:t,clientY:r,diffX:i,diffY:a,distanceX:o,distanceY:s},e),c=t,l=r}catch(h){console.log(h)}},p=function(){document.removeEventListener("touchmove",h),document.removeEventListener("touchend",f)},f=function(e){var t={x:c,y:l,clientX:c,clientY:l,diffX:c-u,diffY:l-d,distanceX:o,distanceY:s};e.clientX=c,e.clientY=l,null===r||void 0===r||r(t,e),o<2&&s<2&&(null===i||void 0===i||i(t,e)),p()};return document.addEventListener("touchmove",h,a?{passive:!1}:{passive:!0}),document.addEventListener("touchend",f,a?{passive:!1}:{passive:!0}),p}}]),e}())},4089:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var r,i=n(4074),a=n(4575),o=n.n(a),s=n(3913),c=n.n(s),l=n(3124),u=n.n(l),d=n(8572),h=n(4654),p=n(5853);const f=new(r=function(){function e(){o()(this,e),p.Z.onAppearanceChange(this.onAppearanceChange)}return c()(e,[{key:"init",value:function(){}},{key:"onAppearanceChange",value:function(e){console.log(e),h.default.DisplaySettings.setSystemDarkMode("dark"===e)}},{key:"update",value:function(){}}]),e}(),u()(r.prototype,"onAppearanceChange",[d.ZP],Object.getOwnPropertyDescriptor(r.prototype,"onAppearanceChange"),r.prototype),u()(r.prototype,"update",[d.ZP],Object.getOwnPropertyDescriptor(r.prototype,"update"),r.prototype),r);var g=n(4856);function m(){g.Z.init(),i.Z.init(),f.init()}},726:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(3038),i=n.n(r),a=n(9955);function o(e,t){(0,a.useEffect)((function(){Object.entries(t).forEach((function(t){var n=i()(t,2),r=n[0],a=n[1],o=r.replace("on","").toLowerCase();e.current.addEventListener(o,a,{passive:!1})}))}),Object.values(t))}},4007:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(9955),i=n(8133),a=[];function o(e){(0,r.useEffect)((function(){return a.push(e),function(){a.remove(e)}}),[])}i.LA.onBackButton((function(){var e=a[a.length-1];null===e||void 0===e||e()}))},7100:(e,t,n)=>{"use strict";n.d(t,{Z:()=>D});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(1506),c=n.n(s),l=n(2205),u=n.n(l),d=n(8585),h=n.n(d),p=n(9754),f=n.n(p),g=n(3124),m=n.n(g),v=n(8651),y=n(5252),k=n(6470),_=n(8855),Z=n(7274);const w=function(){function e(){i()(this,e),this.onResize=new k.Z,this.onForeground=new k.Z,this.windowSize=new Z.Z({width:0,height:0})}return o()(e,[{key:"windowWidth",value:function(){return this.windowSize.get().width}},{key:"windowHeight",value:function(){return this.windowSize.get().height}}]),e}();var b,P=n(8572);function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=f()(e);if(t){var i=f()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return h()(this,n)}}const D=new(b=function(e){u()(r,e);var t=S(r);function r(){var e;i()(this,r),e=t.call(this),y.Z.binder(c()(e),"normalizeKeys","getKeyCode"),e.blockedReason=new Z.Z,e.supportsMultiplePanes=new Z.Z(!1),e.versionRequired=[],e.versionAvailable=[],e.versionRequired[_.Z.AppPlatform.Electron]=1,e.versionAvailable[_.Z.AppPlatform.Electron]=7,e.versionCurrent=21,e.versionMessages={21:"Moo.do just got a big design update with tons of customization option. Check the blog for more details!"},e.appSubVersion=void 0,e.setDeployEnvironments(),e.appPlatform=void 0,e.bodyClass=void 0,e.b=document.documentElement,e.orientation=_.Z.Orientation.Portrait,e.isNativeFullscreen=new Z.Z(!1),e.onResize=new k.Z,e.appState=void 0,e.isHosted=!1,e.hostedBy=void 0,e.initStorageQuota={quota:NaN,usage:NaN},e.isNearStorageQuota=!1,e.pageVisibilityHidden=void 0,e.pageVisibilityChange=void 0,e._allowNativeNotifications=!0;return e.isDevURL=["localhost","dev","beta","staging"].some((function(e){return window.location.hostname.includes(e)})),e.isBeta=window.location.hostname.includes("beta"),e._features={},e.init(),e.app&&(e.customRedirectState={app:!0,appv:e.appv,webview:e.getAppState("webview")}),window.addEventListener("resize",e._onResize),e._onResize(),e}return o()(r,[{key:"_onResize",value:function(){var e=this,t=this.windowSize.get(),n=document.body.clientWidth,r=document.body.clientHeight;t.width===n&&t.height===r||this.windowSize.set({width:n,height:r}),this.isNativeApp()&&this.appv<4&&setTimeout((function(){e.screenTop!==window.screenTop&&(e.screenTop=window.screenTop,e.isNativeFullscreen.set(0===e.screenTop))}),100)}},{key:"getDeployVar",value:function(e){return this.deployEnvironment[e]}},{key:"setDeployEnvironments",value:function(){this.deployEnvironment={};var e=window.location.hostname;this.deployEnvironment[_.Z.DeployVariable.Environment]="dev.moo.do"===e||"staging.legendapp.com"===e?"dev":"beta.moo.do"===e||"beta.legendapp.com"===e?"beta":"localhost"===e?"local":this.isMobile?"mobile":"web"}},{key:"getLocaleInfo",value:function(e){try{e.lang=navigator.language||navigator.userLanguage}catch(t){e.lang="EXCEPTION"}}},{key:"getPlatformInfo",value:function(e){e.os=this.OSName,e.browser=this.browser,e.majorVersion=this.majorVersion,e.minorVersion=this.minorVersion,e.appVersionRequired=this.versionRequired[this.appPlatform],e.app=this.app,e.appPlatform=this.appPlatform,e.standalone=this.standalone,e.packagedApp=this.packagedApp,e.isTouch=this.touch,e.isTouchDevice=this.isTouchDevice,e.usePointerEvents=this.usePointerEvents,e.appState=this.appState,e.isHosted=this.isHosted,e.hostedBy=this.hostedBy,e.embed=this.embed,e.bodyClass=this.b.className,e.rawUA=navigator.userAgent,e.referrer=document.referrer,e.devicePixelRatio=window.devicePixelRatio,e.pageVisibilityChange=!!this.pageVisibilityChange,e.appSubVersion=this.appSubVersion,e.initStorageQuota=this.initStorageQuota,e.isNearStorageQuota=this.isNearStorageQuota,this.getLocaleInfo(e)}},{key:"getUserPlatformConfig",value:function(){return(this.platformBrowser&&this.platformOS?"".concat(this.platformOS).concat(this.platformBrowser):navigator.userAgent)+(this.isBeta?"b":"")}},{key:"getAppDownloadURL",value:function(){return"https://moo.do/download/"}},{key:"getChromeExtensionURL",value:function(){return"https://chrome.google.com/webstore/detail/moodo/dfphnckjoinkfflhfbnjoiggfflnekcb"}},{key:"getGmailAddonURL",value:function(){return"https://gsuite.google.com/marketplace/app/moodo/597847337936"}},{key:"getPrivacyPolicyURL",value:function(){return"https://www.moo.do/privacy/"}},{key:"supportsNativeApp",value:function(){switch(this.OSName){case"Windows":case"MacOS":return!0;default:return!1}}},{key:"isNativeApp",value:function(){return this.appPlatform===_.Z.AppPlatform.Electron}},{key:"supportLocalFiles",value:function(){return this.isNativeApp()&&this.appv>=3}},{key:"isNativeMac",value:function(){return this.isNativeApp()&&this.mac}},{key:"canDownloadNativeApp",value:function(){return this.supportsNativeApp()&&!this.isNativeApp()}},{key:"init",value:function(){var e=this;this.initAppState(),this.initHostState(),this.initFeatures();var t,r,i=navigator.userAgent,a="";((y.Z.getURLParam("rn")||window.ReactNativeWebView)&&(this.isRNApp=!0,this.isMobile=!0,this.app=!0),this.OSName="Unknown OS",this.app&&(a+=" app"),i.includes("Win")?(this.platformOS=_.Z.PlatformOS.Windows,this.OSName="Windows",this.windows=!0):i.includes("iPhone")?(this.platformOS=_.Z.PlatformOS.iPhone,this.OSName="iPhone"):i.includes("iPod")?(this.platformOS=_.Z.PlatformOS.iPod,this.OSName="iPod"):i.includes("Mac")?(this.platformOS=_.Z.PlatformOS.iPad,this.OSName="iPad"):-1!==i.indexOf("Mac")?(this.platformOS=_.Z.PlatformOS.Mac,this.OSName="MacOS",this.mac=!0):-1!==i.indexOf("X11")?-1!==i.indexOf("CrOS")?(this.platformOS=_.Z.PlatformOS.ChromeOS,this.OSName="ChromeOS",this.chromeOS=!0):(this.platformOS=_.Z.PlatformOS.Linux,this.OSName="Linux",this.linux=!0):-1!==i.indexOf("Linux")&&(this.platformOS=_.Z.PlatformOS.Linux,this.OSName="Linux",this.linux=!0,i.indexOf("Android")&&(this.isMobile=!0,this.isAndroid=!0)),this.majorVersion=1e3,this.minorVersion=1e3,-1!==i.indexOf("MSIE")||-1!==i.indexOf("Trident"))&&(this.platformBrowser=_.Z.PlatformBrowser.IE,this.browser="Trident",this.ie=!0,(null!==("Microsoft Internet Explorer"===navigator.appName?new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")).exec(i)||null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(i))&&(this.majorVersion=parseFloat(RegExp.$1)));if(this.app||-1===i.indexOf("Edge/")&&-1===i.indexOf("Edg/")?-1!==i.indexOf("Chrome")||-1!==i.indexOf("CriOS")?(this.platformBrowser=_.Z.PlatformBrowser.Chrome,this.browser="Chrome",this.isChrome=!0,null!==new RegExp("Chrome/([0-9]{1,}).").exec(i)&&(this.majorVersion=parseFloat(RegExp.$1))):-1!==i.indexOf("Firefox")?(this.platformBrowser=_.Z.PlatformBrowser.Firefox,this.browser="Firefox",this.isFirefox=!0,null!==new RegExp("Firefox/([0-9]{1,}).").exec(i)&&(this.majorVersion=parseFloat(RegExp.$1))):-1!==i.indexOf("Safari")||"iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName?(this.platformBrowser=_.Z.PlatformBrowser.Safari,this.browser="Safari",this.safari=!0,null!==new RegExp("Version/([0-9]{1,}).([0-9]{1,}).").exec(i)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2)),"iPad"!==this.OSName&&"iPhone"!==this.OSName&&"iPod"!==this.OSName||(this.isMobile=!0,this.isiOS=!0)):-1!==i.indexOf("Opera")?(this.platformBrowser=_.Z.PlatformBrowser.Opera,this.browser="Opera"):-1!==i.indexOf("Edge")&&(this.ieEdge=!0,this.platformBrowser=_.Z.PlatformBrowser.Edge):(this.ieEdge=!0,this.platformBrowser=_.Z.PlatformBrowser.Edge,this.browser="Edge",null!==/Edg(?:e)*\/([0-9]{1,})\./i.exec(i)&&(this.majorVersion=parseFloat(RegExp.$1))),i.includes("Legend")||i.includes("Moo.do")){this.browser="Chrome",this.isFirefox=!1,this.isChrome=!0,this.majorVersion=void 0,this.platformBrowser=_.Z.PlatformBrowser.Electron,this.app=!0,this.appPlatform=_.Z.AppPlatform.Electron,a+=" electron";var o,s=new RegExp("Moo\\.do/([^\\s]+)\\s");if((null!==new RegExp("Legend/([^\\s]+)").exec(navigator.userAgent)||null!==s.exec(navigator.userAgent))&&(this.appVersion=RegExp.$1),this.appVersion)(o=this.isAppVersionMin("1.7.2")?7:this.isAppVersionMin("1.6.17")?6:this.isAppVersionMin("1.6.0")?5:this.isAppVersionMin("1.4.2")?4:this.isAppVersionMin("1.2.1")?3:this.isAppVersionMin("1.1.0")?2:1)<5&&setTimeout((function(){Promise.resolve().then(n.bind(n,4654)).then((function(t){t.default.toasts.pushMessage({text:"A new version is available with important fixes. Future versions will update themselves, but please download this manually.",hold:!0,holdOnAction:!0,actionText:"DOWNLOAD",action:function(){t.default.openUrl(e.getAppDownloadURL())}})}))}),2e3),this.appv=o;this.mac&&(a+=" electronMac"),this.appState||(this.appState={}),this.appState.appType||(this.appState.appType="electron"),this._enableFeature(_.Z.Feature.OAuth)}if(this.isTouchDevice=!(!("ontouchstart"in window)&&!navigator.msMaxTouchPoints),this.usePointerEvents=!!window.navigator.msPointerEnabled,this.isMobile&&(a+=" moweb"),this.usePointerEvents?(this.downEvent="MSPointerDown",this.moveEvent="MSPointerMove",this.upEvent="MSPointerUp"):(this.downEvent="mousedown",this.moveEvent="mousemove",this.upEvent="mouseup"),y.Z.hasURLParam("touch","false")?this.touch=!1:y.Z.hasURLParam("touch","true")&&(this.touch=!0),this.mac){a+=" mac";(function(){var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var n=document.createElement("div");n.style.width="100%",e.appendChild(n);var r=n.offsetWidth;return e.parentNode.removeChild(e),t-r})()>0&&(a+=" showScrollbars")}if(this.windows&&(a+=" windows",this.ie&&(a+=" ie")),"Firefox"===this.browser&&(a+=" firefox"),this.safari&&(a+=" safari"),this.embed===_.Z.EmbedApps.Mailbird&&(this.platformBrowser=_.Z.PlatformBrowser.Mailbird,a+=" mailbird",this.isMailbirdSidebar()&&(a+=" mailbirdSidebar")),this.demo&&(a+=" demoMode"),this.isChrome&&this.app&&(this.isPackagedApp=!0),this.cmdChar=this.mac?"\u2318":"ctrl",this.priModKey=this.mac?"\u2318":"Ctrl",this.priModKeyCode=this.mac?_.Z.KeyCode.LeftMeta:_.Z.KeyCode.Ctrl,this.secModKeyForce=this.mac?"\u2303":"Alt",this.secModKeyForceCode=this.mac?_.Z.KeyCode.Ctrl:_.Z.KeyCode.Alt,this.secModKey=this.app?this.priModKey:this.secModKeyForce,this.secModKeyCode=this.app?this.priModKeyCode:this.secModKeyForceCode,this.noErrorStacks="iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName,this.standalone=!!navigator.standalone||window.navigator.userAgent.indexOf("FluidApp")>=0,a&&a.length>0&&(this.bodyClass=a,this.b.className+=a),this.URL=window.URL||window.webkitURL,this.supportBlobURLIFrame=!1,this.transition=this.addPrefix("transition"),this.animation=this.addPrefix("animation"),this.transform=this.addPrefix("transform"),this.transformOrigin=this.addPrefix("transformOrigin","transform-origin"),this.userSelect=this.addPrefix("userSelect","user-select"),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame||function(e){clearTimeout(e)},this.ie&&(document.documentElement.addEventListener("MSHoldVisual",(function(e){e.preventDefault()}),!1),document.documentElement.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1)),document.documentElement.addEventListener("keydown",this.normalizeKeys,!0),document.documentElement.addEventListener("keypress",this.normalizeKeys,!0),document.documentElement.addEventListener("keyup",this.normalizeKeys,!0),"undefined"!==typeof document.hidden?(t="hidden",r="visibilitychange"):["moz","ms","webkit"].forEach((function(e){if("undefined"!==document[e+"Hidden"])return t=e+"Hidden",r=e+"visibilitychange",!1})),void 0!==t&&(this.pageVisibilityHidden=t,this.pageVisibilityChange=r),this.supportsEstimatedStorage()){this.estimateAvailableStorage((function(t){e.initStorageQuota=t,t.usage/t.quota>.9&&(e.isNearStorageQuota=!0)}),(function(){}))}this.StatusBarElementsDropItems=[{keyText:"\u21e7",keys:[_.Z.KeyCode.Shift],text:"Insert at top",isModifier:!0},{keyText:this.mac?"\u2303":"Ctrl + Alt",keys:this.mac?[_.Z.KeyCode.Ctrl]:[_.Z.KeyCode.Ctrl,_.Z.KeyCode.Alt],text:"Link"},{keyText:this.mac?"\u2325":"Ctrl",keys:[this.mac?_.Z.KeyCode.Alt:_.Z.KeyCode.Ctrl],text:"Copy"},{keyText:this.mac?"\u2318":"Alt",keys:[this.mac?_.Z.KeyCode.LeftMeta:_.Z.KeyCode.Alt],text:"Mirror"}]}},{key:"updateBodyClass",value:function(){this.bodyClass&&(document.body.className+=this.bodyClass)}},{key:"supportsNotifications",value:function(){return this.supportsNativeNotifications()||this.supportsHTML5Notifications()}},{key:"supportsNativeNotifications",value:function(){var e=!1;return this._allowNativeNotifications&&(this.app||this.app&&this.appPlatform!==_.Z.AppPlatform.Electron&&this.isChrome||this.embed===_.Z.EmbedApps.Mailbird)&&(e=!0),e}},{key:"supportsHTML5Notifications",value:function(){return"Notification"in window}},{key:"usesHTML5Notifications",value:function(){return!this.supportsNativeNotifications()&&this.supportsHTML5Notifications()}},{key:"hasNotificationPermission",value:function(){return!this.usesHTML5Notifications()||"granted"===Notification.permission}},{key:"disallowNativeNotifications",value:function(){this._allowNativeNotifications=!1}},{key:"supportsPersistedStorage",value:function(){var e=!1;return"storage"in navigator&&"persist"in navigator.storage&&(e=!0),e}},{key:"requestStoragePersistence",value:function(e,t){navigator.storage.persisted().then((function(n){n?e():navigator.storage.persist().then(e,t)}))}},{key:"isStoragePersisted",value:function(e){this.supportsPersistedStorage()?navigator.storage.persisted().then(e):setTimeout(e,0,!1)}},{key:"supportsNativePromises",value:function(){return!!window.Promise}},{key:"supportsEstimatedStorage",value:function(){var e=!1;return("storage"in navigator&&"estimate"in navigator.storage||"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage)&&(e=!0),e&&this.supportsNativePromises()}},{key:"estimateAvailableStorage",value:function(e,t){this.supportsEstimatedStorage()?this._estimateAvailableStorage().then(e,t):setTimeout(t,0)}},{key:"_estimateAvailableStorage",value:function(){return"storage"in navigator&&"estimate"in navigator.storage?navigator.storage.estimate():"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage?new Promise((function(e,t){navigator.webkitTemporaryStorage.queryUsageAndQuota((function(t,n){e({usage:t,quota:n})}),t)})):Promise.resolve({usage:NaN,quota:NaN})}},{key:"supportsWebworkers",value:function(){var e=!1;return window.Worker&&(e=!0),e}},{key:"supportsNativeDownload",value:function(){return this.isNativeApp()&&this.appv>=2}},{key:"supportsIDBWebworkers",value:function(){var e=!1;if(this.supportsWebworkers())switch(this.browser){case"Firefox":e=this.majorVersion>=37;break;case"Chrome":e=this.majorVersion>=24}return e}},{key:"supportsPassiveListeners",value:function(){if(void 0===this._supportsPassiveListeners){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(n){}this._supportsPassiveListeners=e}return this._supportsPassiveListeners}},{key:"addPassiveListener",value:function(e,t,n){this.supportsPassiveListeners()?e.addEventListener(t,n,{passive:!0}):e.addEventListener(t,n)}},{key:"isMobro",value:function(){var e,t=null;try{new ActiveXObject("")}catch(n){e=n.name}try{t=!!new ActiveXObject("htmlfile")}catch(n){t=!1}return!(t="ReferenceError"===e||!1!==t)}},{key:"normalizeKeys",value:function(e){var t=e;return void 0!==t.normCode&&(e.synthetic||t instanceof KeyboardEvent)||(t.normCode=this.getKeyCode(e)),t}},{key:"getKeyCode",value:function(e){var t;return 46===(t=null===e.keyCode||0===e.keyCode?null!==e.charCode?e.charCode:e.which:e.keyCode)&&"keypress"===e.type&&(t=190),t}},{key:"initAppState",value:function(){var e=location.hash.substring(1);if(e)for(var t,n=0,r=/([^&=]+)=([^&]*)/g;null!==(t=r.exec(e));){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if("state"===decodeURIComponent(t[1])){var i=decodeURIComponent(t[2]);if(i){var a=function(t){try{e=JSON.parse(t)}catch(n){}};a(i),e||a(i.replace(/\\"/g,'"')),e&&(this.app=!0===e.app,this.appv=e.appv,this.debugApp=e.debug,this.live=e.live,this.offline=e.offline,this.test=e.test,this.embed=e.embed,this.appState=e)}break}}this.live=this.live||y.Z.hasURLParam("live","true"),this.test=!1,this.offline=this.offline||y.Z.hasURLParam("offline","true")||!1,this.demo=y.Z.hasURLParam("demo")||y.Z.hasURLParam("template")||!1,this.app=this.app||!1}},{key:"getAppState",value:function(e){return this.appState?this.appState[e]:void 0}},{key:"_enableFeature",value:function(e){this._features[e]=!0}},{key:"_disableFeature",value:function(e){this._features[e]=!1}},{key:"initFeatures",value:function(){this._enableFeature(_.Z.Feature.ClonePane)}},{key:"isMailbirdSidebar",value:function(){return this.embed===_.Z.EmbedApps.Mailbird&&"true"===this.getAppState("sidebar")}},{key:"initHostState",value:function(){try{this.isHosted=window.self!==window.top}catch(e){this.isHosted=!0}this.isHosted&&(this.hostedBy=document.referrer)}},{key:"addPrefix",value:function(e,t){var n="",r=["ms","webkit","moz","o"],i=this.b.style;if(t||(t=e),"string"===typeof i[e])n="";else for(var a=0,o=0;o<r.length;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if("string"===typeof i["-"+r[o]+"-"+t]){n=r[o];break}}var s=n.length>0?e.charAt(0).toUpperCase()+e.slice(1):e;if(n){var c=n.length>0?n.charAt(0).toUpperCase()+n.slice(1):e;return{prop:"-"+n+"-"+t,style:n+s,react:c+s}}return{prop:e,style:s,react:s}}},{key:"blockClient",value:function(){switch(this.browser){case"Firefox":if(this.majorVersion<16)return{platform:"Firefox",browser:this.browser,update:!0};break;case"Chrome":if(this.majorVersion<26)return{platform:"Chrome",browser:this.browser,update:!0};break;case"Native Android":if(this.majorVersion<4)return{platform:"Native Android",browser:"NativeAndroid",update:!0};break;case"Opera":return{platform:this.browser,browser:this.browser,update:!1};case"Trident":return{platform:"Internet Explorer",browser:this.browser,update:!1};case"Safari":if(6===this.majorVersion&&this.minorVersion<1||this.majorVersion<6)return{platform:"Safari",browser:this.browser,update:!0};break;case"Edge":if(!v.Z.isDemoMode()&&this.windows&&this.majorVersion<70)return{platform:this.browser,browser:this.browser,update:!1}}if(this.app){if(this.appv<this.versionRequired[this.appPlatform]){n(8651).Z.log("App Version out of date.");var e={version:this.versionRequired[this.appPlatform]};return n(8651).Z.nativeBridge.sendToApp("updateRequired"),e}if(this.appv>this.versionAvailable[this.appPlatform])return n(8651).Z.log("App is newer than the javascript, forcing an app cache update: "+this.appv+" vs. "+this.versionAvailable[this.appPlatform]),{cacheUpdate:!0}}}},{key:"actionVerb",value:function(){return this.touch?"tap":"click"}},{key:"actionVerbCaps",value:function(){return this.touch?"Tap":"Click"}},{key:"updateOrientation",value:function(){return this.orientation=90===Math.abs(window.orientation)?_.Z.Orientation.Landscape:_.Z.Orientation.Portrait,this.orientation}},{key:"isPageVisible",value:function(){return!this.pageVisibilityHidden||!document[this.pageVisibilityHidden]}},{key:"getUpdateMessages",value:function(e){for(var t=0,n=[],r=(e||0)+1;r<=this.versionCurrent;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.versionMessages[r];i&&n.push(i)}return n}},{key:"isFeatureEnabled",value:function(e){return this._features[e]}},{key:"recordAppSubVersion",value:function(e){this.appSubVersion=e}},{key:"getPlatformName",value:function(){return this.mac?"Mac":this.windows?"Windows":"Chrome"}},{key:"getPlatformIcon",value:function(){return this.mac?"FaApple":this.windows?"FaWindows":this.linux?"FaLinux":"FaChrome"}},{key:"getActualWindowWidth",value:function(){return document.body&&document.body.clientWidth||0}},{key:"getActualWindowHeight",value:function(){return document.body&&document.body.clientHeight||0}},{key:"hasBetaFeatures",value:function(){return this.isDevURL}},{key:"isPriModKey",value:function(e){return this.mac&&e.metaKey||!this.mac&&e.ctrlKey}},{key:"isSecModKey",value:function(e){return this.mac&&e.ctrlKey||!this.mac&&e.altKey}},{key:"supportSmoothScrollWithKeyboard",value:function(){return!this.isiOS||this.app}},{key:"parseTextForFilePath",value:function(e){return this.isNativeApp()&&(!this.windows&&e.startsWith("/")?e="file://"+e.replace(/ /g,"%20"):this.windows&&e.match(/^[a-z]:\\/i)&&(e="file:///"+e.replace(/\\/g,"/").replace(/ /g,"%20"))),e}},{key:"compareSemVer",value:function(e,t){for(var n=0,r=e.split("."),i=t.split("."),a=0;a<3;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=+r[a],s=+i[a];if(o>s)return 1;if(s>o)return-1;if(!isNaN(o)&&isNaN(s))return 1;if(isNaN(o)&&!isNaN(s))return-1}return 0}},{key:"isAppVersionMin",value:function(e){return this.compareSemVer(this.appVersion,e)>=0}},{key:"getWebviewUserAgent",value:function(){return this.defaultElectronUserAgent||"".concat(this.mac?"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7)":"Mozilla/5.0 (Windows NT 10.0; Win64; x64)","AppleWebKit/537.36 (KHTML, like Gecko) Legend/2.0.1 Chrome/91.0.4472.124 Safari/537.36")}}]),r}(w),m()(b.prototype,"_onResize",[P.ZP],Object.getOwnPropertyDescriptor(b.prototype,"_onResize"),b.prototype),b)},5252:(e,t,n)=>{"use strict";n.d(t,{Z:()=>k});var r=n(4575),i=n.n(r),a=n(3913),o=n.n(a),s=n(2205),c=n.n(s),l=n(8585),u=n.n(l),d=n(9754),h=n.n(d);const p=function(){function e(){i()(this,e),this.storage={getItem:function(){console.log("refactor this")},setItem:function(){console.log("refactor this")}}}return o()(e,[{key:"extendPrototype",value:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e.prototype[n]=t[n])}},{key:"extendClass",value:function(e,t,n){for(var r=0,i=Object.getOwnPropertyNames(t.prototype),a=0;a<i.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=i[a];n&&e[o]||(e.prototype[o]=t.prototype[o])}}},{key:"defineBase",value:function(e){e.prototype.constructor=e}},{key:"extend",value:function(e,t,n,r){if(t)for(var i in t)if(t.hasOwnProperty(i)&&(!r||!e[i])){var a=t[i],o=n&&a&&a.bind?a.bind(e):a;e[i]=o}return e}},{key:"inherit",value:function(e,t){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._super=e.prototype}},{key:"binder",value:function(e){var t=0;for(var n=0;n<(arguments.length<=1?0:arguments.length-1);n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=n+1<1||arguments.length<=n+1?void 0:arguments[n+1];e[r]=e[r].bind(e)}}},{key:"forceBind",value:function(e,t){var n=t[e].bind(t);return t[e]=n,n}}]),e}();function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h()(e);if(t){var i=h()(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return u()(this,n)}}var g=n(8855).Z.URLPart;function m(e,t){e===g.Search?window.location.search=t:e===g.Hash&&(window.location.hash=t)}function v(e){return e===g.Search?window.location.search:e===g.Hash?window.location.hash:void 0}function y(e){return"state"===e?g.Search:g.Hash}const k=new(function(e){c()(r,e);var t=f(r);function r(){return i()(this,r),t.call(this)}return o()(r,[{key:"hasURLParam",value:function(e,t){var n=e+"=";return t&&(n+=t),v(y(e)).indexOf(n)>=0}},{key:"getURLParam",value:function(e,t){var r=t||y(e);if(r===g.Search){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp('[\\?&]" + key + "=([^&#]*)').exec(window.location.href);return null===i?void 0:decodeURIComponent(i[1].replace(/\+/g," "))}if(r!==g.Hash)n(8651).Z.log("Invalid URL part");else for(var a,o=0,s=v(g.Hash).substring(1),c=/([^&=]+)=([^&]*)/g;a=c.exec(s);){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(decodeURIComponent(a[1])===e)return decodeURIComponent(a[2])}}},{key:"insertURLParam",value:function(e,t,n){var r=0;e=encodeURIComponent(e),t=encodeURIComponent(t);var i,a=y(e),o=v(a).substr(1).split("&");for(i=o.length-1;i>=0;i--){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=o[i].split("=");if(s[0]==e){s[1]=t,o[i]=s.join("=");break}}i<0&&(o[o.length]=[e,t].join("=")),m(a,o.join("&")),a!==g.Hash||n||window.location.reload()}},{key:"removeURLParam",value:function(e,t){for(var n=0,r=y(e=encodeURIComponent(e)),i=v(r).substr(1).split("&"),a=i.length-1;a>=0;a--){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(i[a].split("=")[0]==e){i.splice(a,1),m(r,i.join("&")),r!==g.Hash||t||window.location.reload();break}}}}]),r}(p))},4289:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAwCAYAAAB5R9gVAAAABGdBTUEAALGPC/xhBQAAAVVJREFUWAnN2G0KgjAYwPHpGfRkaZeqvgQaK+hY3SUHrk1YzNLay/OiEFp92I+/Mp2F2Mh2lLISWnflFjzH263RQjzMZ19wgs73ez0o1WmtW+dgA01VxrE3p6l2GLsnBy1VYQOtVSEH/atCCgqpQgKKqYIOiq2CBkqtggLKqQIKgqgCBjpJ2Y5CdJ+zrT9A7HHSTA1dxUdHgzCqJIEwq0SDsKsEg6iqBIEoq/wEcVRZBXFV+QJxV5mBtlDFB5VjYTaGZ2sf4R9PM7U9ZU+lLuaetPP/5Die3ToO1+u+MKtHs06qODB2zBnI/jBd4MPQm1VkY79Tb18gB+C62FdBFsZR6yeIo1YQiLJWMIiqVjQIu1YSCLNWFgijVjYIuhYYCKoWKAiiFgoopxYaKLUWOii2FgkophYp6F3r42W5A9s9OcgNvva8xQaysKXlFytoqdYmQH6tF3toSUo0INq9AAAAAElFTkSuQmCC"},6040:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAwCAYAAAB5R9gVAAAABGdBTUEAALGPC/xhBQAAAXRJREFUWAnN119ugjAcwPHWzJ1gnmxzB/BBE0n24m4xfNkTaOL7wOtsl3AXMMb+Vjaa1BG00N8fSEibPpAP3xAKKs2yjzTPH9RAjhEo9WzPr/Vm8zgE0+gXATAxxuxtqeJ9t5tIwv5AtQAApsfT6TPdbp+kUBcgVwvO51KqVhMkXKsVJFXrOkigVhCIs1Y4iKlWZxB1rX4gwlpRIIpa8SDkWmggrFq4IIRaJKCYWnSgnrXIQV1r8YD+1Vrn+bReagysIFfLABRt31v8oBu1xEBttfRbltmfjgEcWh9snUS2kNdBK6WN1vrOWxObWsz+fjxevsxmB1GQDfINWiev83nhaoiB/CoOU438oPrhXS0WpQ9xc1ZQWxWHqUYe0I0qrKCQKjygDlXIQV2r0IF6ViEBxVTBBSFUQQNhVYkHIVeJAtkNsbQ7c1LtzP6FsObhb2rCKv7NBIGoq4SDmKoEgTirXAcJVGkFSVVpgoSrXICGUMUH/QBZNSUy5XWUhwAAAABJRU5ErkJggg=="}},n={};function i(t){var r=n[t];if(void 0!==r)return r.exports;var a=n[t]={id:t,loaded:!1,exports:{}};return e[t].call(a.exports,a,a.exports,i),a.loaded=!0,a.exports}i.m=e,(()=>{var e=[];i.O=(t,n,r,a)=>{if(!n){var o=1/0;for(u=0;u<e.length;u++){for(var[n,r,a]=e[u],s=!0,c=0;c<n.length;c++)(!1&a||o>=a)&&Object.keys(i.O).every((e=>i.O[e](n[c])))?n.splice(c--,1):(s=!1,a<o&&(o=a));if(s){e.splice(u--,1);var l=r();void 0!==l&&(t=l)}}return t}a=a||0;for(var u=e.length;u>0&&e[u-1][2]>a;u--)e[u]=e[u-1];e[u]=[n,r,a]}})(),i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;i.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"===typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"===typeof n.then)return n}var a=Object.create(null);i.r(a);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&r&&n;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((e=>o[e]=()=>n[e]));return o.default=()=>n,i.d(a,o),a}})(),i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.f={},i.e=e=>Promise.all(Object.keys(i.f).reduce(((t,n)=>(i.f[n](e,t),t)),[])),i.u=e=>({45:"codeBlock",425:"textEncoding"}[e]+"-1631767948879.js"),i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),i.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="Legend:";i.l=(n,r,a,o)=>{if(e[n])e[n].push(r);else{var s,c;if(void 0!==a)for(var l=document.getElementsByTagName("script"),u=0;u<l.length;u++){var d=l[u];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==t+a){s=d;break}}s||(c=!0,(s=document.createElement("script")).charset="utf-8",s.timeout=120,i.nc&&s.setAttribute("nonce",i.nc),s.setAttribute("data-webpack",t+a),s.src=n),e[n]=[r];var h=(t,r)=>{s.onerror=s.onload=null,clearTimeout(p);var i=e[n];if(delete e[n],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach((e=>e(r))),t)return t(r)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),c&&document.head.appendChild(s)}}})(),i.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="js/",(()=>{i.b=document.baseURI||self.location.href;var e={143:0};i.f.j=(t,n)=>{var r=i.o(e,t)?e[t]:void 0;if(0!==r)if(r)n.push(r[2]);else{var a=new Promise(((n,i)=>r=e[t]=[n,i]));n.push(r[2]=a);var o=i.p+i.u(t),s=new Error;i.l(o,(n=>{if(i.o(e,t)&&(0!==(r=e[t])&&(e[t]=void 0),r)){var a=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+a+": "+o+")",s.name="ChunkLoadError",s.type=a,s.request=o,r[1](s)}}),"chunk-"+t,t)}},i.O.j=t=>0===e[t];var t=(t,n)=>{var r,a,[o,s,c]=n,l=0;for(r in s)i.o(s,r)&&(i.m[r]=s[r]);if(c)var u=c(i);for(t&&t(n);l<o.length;l++)a=o[l],i.o(e,a)&&e[a]&&e[a][0](),e[o[l]]=0;return i.O(u)},n=self.webpackChunkLegend=self.webpackChunkLegend||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})();var a=i.O(void 0,[736],(()=>i(4280)));a=i.O(a)})();
