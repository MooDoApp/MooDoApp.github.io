/*! For license information please see app-1611757255991.js.LICENSE.txt */
!function(e){function t(t){for(var n,o,s=t[0],l=t[1],u=t[2],d=0,h=[];d<s.length;d++)o=s[d],Object.prototype.hasOwnProperty.call(r,o)&&r[o]&&h.push(r[o][0]),r[o]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(c&&c(t);h.length;)h.shift()();return i.push.apply(i,u||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],n=!0,s=1;s<a.length;s++){var l=a[s];0!==r[l]&&(n=!1)}n&&(i.splice(t--,1),e=o(o.s=a[0]))}return e}var n={},r={0:0},i=[];function o(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,o),a.l=!0,a.exports}o.e=function(e){var t=[],a=r[e];if(0!==a)if(a)t.push(a[2]);else{var n=new Promise((function(t,n){a=r[e]=[t,n]}));t.push(a[2]=n);var i,s=document.createElement("script");s.charset="utf-8",s.timeout=120,o.nc&&s.setAttribute("nonce",o.nc),s.src=function(e){return o.p+""+({1:"codeBlock",3:"textEncoding"}[e]||e)+"-1611757255991.js"}(e);var l=new Error;i=function(t){s.onerror=s.onload=null,clearTimeout(u);var a=r[e];if(0!==a){if(a){var n=t&&("load"===t.type?"missing":t.type),i=t&&t.target&&t.target.src;l.message="Loading chunk "+e+" failed.\n("+n+": "+i+")",l.name="ChunkLoadError",l.type=n,l.request=i,a[1](l)}r[e]=void 0}};var u=setTimeout((function(){i({type:"timeout",target:s})}),12e4);s.onerror=s.onload=i,document.head.appendChild(s)}return Promise.all(t)},o.m=e,o.c=n,o.d=function(e,t,a){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(o.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(a,n,function(t){return e[t]}.bind(null,n));return a},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="js/",o.oe=function(e){throw console.error(e),e};var s=window.webpackJsonp=window.webpackJsonp||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var c=l;i.push([183,4]),a()}([function(e,t,a){"use strict";a.r(t);var n=a(5),r=a.n(n),i=a(12),o=a.n(i),s=a(53),l=a.n(s),u=a(7),c=a.n(u),d=a(8),h=a.n(d),f=a(24),p=a.n(f),g=a(20),m=a.n(g),v=a(21),y=a.n(v),k=a(13),_=a.n(k),b=a(10),w=a.n(b),S=a(11),D=a(2),P=a(144),I=a(9),E=a(3),C=a.n(E),x=a(97),A=a.n(x),T=a(26),M=a(174),L=a(175),O=a.n(L);function R(e){this.str=(e||"").toString(),this.operatorCurrent="",this.operatorExpecting="",this.node=null,this.escaped=!1,this.list=[],this.operators={'"':'"',"(":")","<":">",",":"",":":";",";":""}}function F(){}R.prototype={tokenize:function(){for(var e,t=0,a=[],n=0,r=this.str.length;n<r;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e=this.str.charAt(n),this.checkChar(e)}return this.list.forEach((function(e){e.value=(e.value||"").toString().trim(),e.value&&a.push(e)})),a},checkChar:function(e){if((e in this.operators||"\\"===e)&&this.escaped)this.escaped=!1;else{if(this.operatorExpecting&&e===this.operatorExpecting)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting="",void(this.escaped=!1);if(!this.operatorExpecting&&e in this.operators)return this.node={type:"operator",value:e},this.list.push(this.node),this.node=null,this.operatorExpecting=this.operators[e],void(this.escaped=!1)}this.escaped||"\\"!==e?(this.node||(this.node={type:"text",value:""},this.list.push(this.node)),this.escaped&&"\\"!==e&&(this.node.value+="\\"),this.node.value+=e,this.escaped=!1):this.escaped=!0}},F.prototype={_handleAddress:function(e){var t,a,n,r,i=0,o=!1,s="text",l=[],u={address:[],comment:[],group:[],text:[]};for(n=0,r=e.length;n<r;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if("operator"===(t=e[n]).type)switch(t.value){case"<":s="address";break;case"(":s="comment";break;case":":s="group",o=!0;break;default:s="text"}else t.value&&("address"===s&&(t.value=t.value.replace(/^[^<]*<\s*/,"")),u[s].push(t.value))}if(!u.text.length&&u.comment.length&&(u.text=u.comment,u.comment=[]),o)u.text=u.text.join(" "),l.push({name:u.text||a&&a.name,group:u.group.length?this.parse(u.group.join(",")):[]});else{if(!u.address.length&&u.text.length){var c=0;for(n=u.text.length-1;n>=0;n--){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(u.text[n].match(/^[^@\s]+@[^@\s]+$/)){u.address=u.text.splice(n,1);break}}var d=function(e){return u.address.length?e:(u.address=[e.trim()]," ")};if(!u.address.length){var h=0;for(n=u.text.length-1;n>=0;n--){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(u.text[n]=u.text[n].replace(/\s*\b[^@\s]+@[^\s]+\b\s*/,d).trim(),u.address.length)break}}}if(!u.text.length&&u.comment.length&&(u.text=u.comment,u.comment=[]),u.address.length>1&&(u.text=u.text.concat(u.address.splice(1))),u.text=u.text.join(" "),u.address=u.address.join(" "),!u.address&&o)return[];(a={address:u.address||u.text||"",name:u.text||u.address||""}).address===a.name&&((a.address||"").match(/@/)?a.name="":a.address=""),l.push(a)}return l},parse:function(e){var t=this,a=0,n=new R(e).tokenize(),r=[],i=[],o=[];n.forEach((function(e){"operator"!==e.type||","!==e.value&&";"!==e.value?i.push(e):(i.length&&r.push(i),i=[])})),i.length&&r.push(i),r.forEach((function(e){var a=t._handleAddress(e);a.length&&(o=o.concat(a))}));for(var s=[],l=0;l<o.length;++l){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;s.push({type:"contact",text:o[l].name||o[l].address,email:o[l].address})}return s}};var N,B,j=new F,U=function(){if("function"!==typeof Array.prototype.pushArray&&(Array.prototype.pushArray=function(e){try{Z.PAssert(378,Z.isArray(e),"Must only supply array to pushArray")}catch(t){Z.reportError(t)}return this.push.apply(this,e)}),"function"!==typeof Array.prototype.removeArray&&(Array.prototype.removeArray=function(e){try{Z.PAssert(379,Z.isArray(e),"Must only supply array to removeArray")}catch(t){Z.reportError(t)}return this.filter((function(t){return!e||e.indexOf(t)<0}))}),"function"!==typeof Array.prototype.removeAt&&(Array.prototype.removeAt=function(e){return this.splice(e,1)[0]}),"function"!==typeof Array.prototype.remove&&(Array.prototype.remove=function(e,t){var a=this.indexOf(e,t);return a>=0&&this.removeAt.call(this,a),a}),"function"!==typeof Array.prototype.equals){var e=function e(t,a,n){return t&&a&&"object"===l()(t)&&"object"===l()(a)?Object.keys(t).length===Object.keys(a).length&&Object.keys(t).reduce((function(r,i){return r&&(n?e(t[i],a[i],n):t[i]===a[i])}),!0):t===a};Array.prototype.equals=function(t,a){var n=0;if(!t)return!1;if(this.length!==t.length)return!1;for(var r=0,i=this.length;r<i;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(this[r]instanceof Array&&t[r]instanceof Array){if(!this[r].equals(t[r]))return!1}else if(this[r]!==t[r]&&!e(this[r],t[r],a))return!1}return!0}}"function"!==typeof Array.prototype.indexOfWithProperty&&(Array.prototype.indexOfWithProperty=function(e,t){var a=0;for(var n=0;n<this.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this[n][e]===t)return n}return-1}),"function"!==typeof Array.prototype.findInsertIndex&&(Array.prototype.findInsertIndex=function(e,t){var a=0;try{Z.PAssert(381,void 0!==e&&null!==e,"Require a valid element to insert")}catch(s){Z.reportError(s)}try{Z.PAssert(382,t,"Require a valid comparison function")}catch(s){Z.reportError(s)}for(var n=0,r=this.length-1;n<=r;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=n+r>>1,o=t(this[i],e);if(o<0)n=i+1;else{if(!(o>0))return i;r=i-1}}return n}),"function"!==typeof Array.prototype.findSorted&&(Array.prototype.findSorted=function(e,t){var a=this.findInsertIndex(e,t);if(0===t(this[a],e))return this[a]}),"function"!==typeof Array.prototype.insertSorted&&(Array.prototype.insertSorted=function(e,t){var a=this.findInsertIndex(e,t);return this.splice.apply(this,[a,0,e]),a}),"function"!==typeof Array.prototype.pushOnlyUniques&&(Array.prototype.pushOnlyUniques=function(e,t){var a=0;if(!e)return this;for(var n=0,r=e.length;n<r;++n){var i=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var o=!0,s=0,l=this.length;s<l;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(t&&t(e[n],this[s])||!t&&e[n]===this[s]){o=!1;break}}o&&this.push(e[n])}return this}),"function"!==typeof Array.prototype.pushIfUnique&&(Array.prototype.pushIfUnique=function(e){return this.includes(e)||this.push(e),this}),"function"!==typeof String.prototype.startsWith&&(Object.defineProperty?Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(e,t){return t=t||0,this.lastIndexOf(e,t)===t}}):String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),"function"!==typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),"function"!==typeof String.prototype.prevIndexOf&&(String.prototype.prevIndexOf=function(e,t){for(var a=0,n=-1,r=t-1;r>=0;--r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this[r]===e){n=r;break}}return n}),"function"!==typeof String.prototype.capitalize&&(String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)})},H=(a(197),a(109)),V=a(27),W={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"},z=/https:\/\/www.evernote.com\/shard\/([a-z0-9.\-]+)\/nl\/([a-z0-9.\-]+)\/([a-z0-9.\-]+)/g,q=["http://a.visadd.com/script/layer","https://gc.kis.v2.scr.kaspersky-labs.com"],G=(N=function(){function e(){c()(this,e),U(),this.SESSION_BEGIN=Date.now(),this.LogLevel=D.a.LogLevels.Error|D.a.LogLevels.Warning,this.noLocalWrites=!1,this.totalItems=0,this.totalArchivedItems=0,this.totalArchivedParents=0,this.totalPanes=0,this.tempIndex=0,this.__FULL_NOTIFICATION_UPDATES=0,this.__SINGLE_NOTIFICATION_UPDATES=0,this.TEMP_PREFIX="~T^",this.fnRegex=/function\s+([^(]*?)\s*\(([^)]*)\)/,this.supportSimpleStack=!0,this.__LOG_BUFFER=new H.a(50),this.isLoaded=!1,this.aggregateEvents={},this.anonID=void 0,this.defaultSeed=129831293,this._isInCompleteAction=!1,this.lastActivity=Date.now(),this.activityThreshold=this.seconds(5),this.__xhrRequests={},this.isRollbarConfigured=!1,this.lastErrorsReported={},this.timeouts={},this.animationFrames={},this.numReported=0,this.isReporting=!1,this.singletonPromises={},this.lazyLoadedComponents={}}return h()(e,[{key:"Assert",value:function(e){}},{key:"isFlagSet",value:function(e,t){return(e&t)===t}},{key:"isFunction",value:function(e){return!!(e&&e.constructor&&e.call&&e.apply)}},{key:"isEmpty",value:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}},{key:"isArray",value:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{key:"isString",value:function(e){return"string"===typeof e}},{key:"isObject",value:function(e){return"object"===l()(e)&&null!==e&&!this.isArray(e)}},{key:"isNumber",value:function(e){return"number"===typeof e&&!isNaN(e)}},{key:"isBoolean",value:function(e){return!0===e||!1===e}},{key:"isAnything",value:function(){return!0}},{key:"isNullOrUndefined",value:function(e){return null===e||void 0===e}},{key:"isValidColor",value:function(e){return this.isString(e)&&null!==/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.exec(e)}},{key:"parseBoolean",value:function(e){return!0===e||"true"===e}},{key:"parseDate",value:function(e){var t=new Date(e);return this.isDateValid(t)?t:void 0}},{key:"clone",value:function(e,t){var a;if(this.isArray(e))return this.cloneDeep(e);if(t)for(var n in a={},e)e.hasOwnProperty(n)&&(t&&void 0===e[n]||(a[n]=e[n]));else a=Object.assign({},e);return a}},{key:"cloneWithoutUndefineds",value:function(e){return this.clone(e,!0)}},{key:"cloneDeep",value:function(e){try{return JSON.parse(JSON.stringify(e))}catch(t){0;try{this.PAssert(157,!1,this.safeStringify(t))}catch(a){this.reportError(a)}}}},{key:"arrayDifference",value:function(e,t){for(var a=0,n=[],r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t[e[r]]||n.push(e[r])}return n}},{key:"emptyFn",value:function(){}},{key:"newEmptyFn",value:function(){return function(){}}},{key:"weeks",value:function(e){return 6048e5*e}},{key:"days",value:function(e){return 864e5*e}},{key:"hours",value:function(e){return 36e5*e}},{key:"minutes",value:function(e){return 6e4*e}},{key:"seconds",value:function(e){return 1e3*e}},{key:"parseInt",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return parseInt(e,10)}))},{key:"shouldLog",value:function(e){return this.__DEV__===e}},{key:"shouldWriteLocal",value:function(){return!this.noLocalWrites}},{key:"isLocalWriteReason",value:function(e){return this.noLocalWritesReason===e}},{key:"isValidChangeType",value:function(e){if(void 0!==e&&null!==e){var t=e&~D.a.ChangeType.All;if(this.inMaskOnly(e,D.a.ChangeType.Valid))return(t&D.a.ChangeType.Locations)===D.a.ChangeType.None||this.isOneFlagSet(t,D.a.ChangeType.Local|D.a.ChangeType.Remote|D.a.ChangeType.Auto)}return!1}},{key:"isRemoteChange",value:function(e){try{this.PAssert(158,this.isValidChangeType(e),"Must supply a valid changeType")}catch(a){this.reportError(a)}var t=e&~D.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,D.a.ChangeType.Remote)}},{key:"isUndoRedoChange",value:function(e){try{this.PAssert(159,this.isValidChangeType(e),"Must supply a valid changeType")}catch(a){this.reportError(a)}var t=e&~D.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,D.a.ChangeType.UndoRedo)}},{key:"isLocalChange",value:function(e){try{this.PAssert(160,this.isValidChangeType(e),"Must supply a valid changeType")}catch(a){this.reportError(a)}var t=e&~D.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,D.a.ChangeType.Local)}},{key:"isAutoChange",value:function(e){try{this.PAssert(161,this.isValidChangeType(e),"Must supply a valid changeType")}catch(a){this.reportError(a)}var t=e&~D.a.ChangeType.All;return this.isValidChangeType(e)&&this.isFlagSet(t,D.a.ChangeType.Auto)}},{key:"inMaskOnly",value:function(e,t){return 0===(~t&e)}},{key:"isOneFlagSet",value:function(e,t){var a=e&t;return 0!==a&&0===(a&a-1)}},{key:"isAtLeastOneFlagSet",value:function(e,t){return 0!==(e&t)}},{key:"forEachFlagSet",value:function(e,t){for(var a=0;0!==e;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t(Math.abs(e&-e)),e&=e-1}}},{key:"generateTempId",value:function(){return this.TEMP_PREFIX+Date.now()+ ++this.tempIndex}},{key:"toLowerCase",value:function(e){return e.toLowerCase()}},{key:"numberComparator",value:function(e,t){return e-t}},{key:"comparatorById",value:function(e,t){return e.id===t.id}},{key:"insertIntoText",value:function(e,t,a){try{this.PAssert(162,a<=e.length)}catch(n){this.reportError(n)}return e.substr(0,a)+t+e.substr(a,e.length-a)}},{key:"arrayUnion",value:function(e,t){for(var a=0,n=0,r=[],i=0;i<e.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;r.indexOf(e[i])<0&&r.push(e[i])}for(var o=0;o<t.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r.indexOf(t[o])<0&&r.push(t[o])}return r}},{key:"arrayUnionByKey",value:function(e,t,a){for(var n=0,r=0,i=[],o=0;o<e.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;i.indexOfWithProperty(a,e[o][a])<0&&i.push(e[o])}for(var s=0;s<t.length;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i.indexOfWithProperty(a,t[s][a])<0&&i.push(t[s])}return i}},{key:"arrayDiff",value:function(e,t){for(var a=0,n=0,r=[],i=0;i<e.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t.indexOf(e[i])<0&&r.push(e[i])}for(var o=0;o<t.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e.indexOf(t[o])<0&&r.push(t[o])}return r}},{key:"arrayIntersection",value:function(e,t){for(var a=0,n=[],r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t.indexOf(e[r])>=0&&n.push(e[r])}return n}},{key:"arrayIntersectionByKey",value:function(e,t,a){for(var n=0,r=[],i=0;i<e.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t.indexOfWithProperty(a,e[i][a])>=0&&r.push(e[i])}return r}},{key:"arrayUniques",value:function(e,t){return t?e.filter((function(a,n){return e.findIndex((function(e){return e[t]===a[t]}))===n})):e.filter((function(t,a){return e.indexOf(t)===a}))}},{key:"arrayUniques2",value:function(e){return Array.from(new Set(e))}},{key:"removeNullUndefined",value:function(e){var t={};return Object.keys(e).forEach((function(a){null!==e[a]&&void 0!==e[a]&&(t[a]=e[a])})),t}},{key:"deepEqual",value:function(e,t,a,n){return(e===t||void 0!==e&&void 0!==t&&null!==e&&null!==t)&&(a&&(this.isObject(e)&&(e=this.removeNullUndefined(e)),this.isObject(t)&&(t=this.removeNullUndefined(t))),n&&n.forEach((function(a){delete e[a],delete t[a]})),O()(e,t,!0))}},{key:"extend",value:function(e,t){if(t)for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a]);return e}},{key:"classNames",value:function(){for(var e=0,t=0,a=arguments.length,n=new Array(a),r=0;r<a;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n[r]=arguments[r]}for(var i=arguments,o=[],s=0;s<i.length;s++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var u=i[s];if(u)if(this.isString(u)||this.isNumber(u))o.push(u);else if("object"===l()(u))for(var c in u)u.hasOwnProperty(c)&&u[c]&&o.push(c)}return o.join(" ")}},{key:"isPrefixTask",value:function(e){return e&&(e===D.a.Prefix.Task||e===D.a.Prefix.Task2||e===D.a.Prefix.Task3||e===D.a.Prefix.Task4)}},{key:"escape",value:function(e){return String(e).replace(/[&\"<>]/g,(function(e){return W[e]}))}},{key:"unescape",value:function(e){return String(e).replace(/&lt;|&gt;|&amp;|&quot;/g,(function(e){for(var t in W)if(W.hasOwnProperty(t)&&W[t]===e)return t;try{this.PAssert(163,!1,"Should have found a character to replace")}catch(a){this.reportError(a)}return e}))}},{key:"escapeRegExp",value:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}},{key:"stripTagsBasic",value:function(e){return e.replace(/<.*>/g,"")}},{key:"stripFormattingTags",value:function(e){return e.replace(/<\/?[biu]>/g,"")}},{key:"invertObject",value:function(e){var t={};for(var a in e)e.hasOwnProperty(a)&&(t[e[a]]=a);return t}},{key:"filterWithNonMatches",value:function(e,t){for(var a=0,n={match:[],fail:[]},r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=e[r];t(i)?n.match.push(i):n.fail.push(i)}return n}},{key:"isUrlImage",value:function(e){return(e=e.toLowerCase().split("?")[0]).endsWith(".png")||e.endsWith(".jpg")||e.endsWith(".gif")}},{key:"isDateSoft",value:function(e){if(e)switch(e.toUpperCase()){case"NEXT":case"SOON":case"LATER":case"SOMEDAY":case"NOW":return!0}return!1}},{key:"isDateValid",value:function(e){return e&&e instanceof Date&&!isNaN(e.getTime())}},{key:"parseEmailAddresses",value:function(e){return j.parse(e)}},{key:"isTempId",value:function(e){return e&&e[0]===this.TEMP_PREFIX[0]&&e[1]===this.TEMP_PREFIX[1]&&e[2]===this.TEMP_PREFIX[2]}},{key:"isLocalItem",value:function(e){try{this.PAssert(164,e.id,"All items should have an ID even if it is a temp one")}catch(t){this.reportError(t)}return this.isTempId(e.id)}},{key:"getCurrentStack",value:function(e){var t;if(this.supportSimpleStack)try{t=JSON.stringify(e)}catch(d){this.log("Error stringifying stack message",d,e)}if(this.supportSimpleStack){var a=new Error(t||e);if(a.stack)return a.stack}this.supportSimpleStack=!1;try{for(var n=0,r=["GenError: "+(t||e)],i=arguments.callee.caller,o=75,s=0;i&&s++<o;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l,u=i.toString(),c=this.fnRegex.exec(u);l=c&&3===c.length&&""!==c[1]&&void 0!==c[1]?"at "+c[1]+"("+c[2].replace(/[\r\n]/g,"")+")":c&&3===c.length?"at <anonymous> ("+c[2].replace(/[\r\n]/g,"")+")":"at <anonymous> (<unknown>)",r.push(l),i=i.caller}return r.join("\n")}catch(h){this.log("Error generating stack trace",h)}return""}},{key:"isVMLI",value:function(e){return e&&e.__ISVMLI}},{key:"isPane",value:function(e){return e&&e.__ISPANE}},{key:"logQuiet",value:function(){for(var e=0,t=arguments.length,a=new Array(t),n=0;n<t;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a[n]=arguments[n]}try{this.__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," "))}catch(r){try{this.__LOG_BUFFER.push(Date.now()+": Invalid Log Arguments")}catch(i){console.log("Error adding to __LOG_BUFFER: ",arguments)}}}},{key:"log",value:function(){for(var e=0,t=arguments.length,a=new Array(t),n=0;n<t;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a[n]=arguments[n]}try{this.__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," "))}catch(r){try{this.__LOG_BUFFER.push(Date.now()+": Invalid Log Arguments")}catch(i){console.log("Error adding to __LOG_BUFFER: ",arguments)}}console.log.apply(console,arguments)}},{key:"registerEvent",value:function(e,t,a){try{this.PAssert(165,!this.aggregateEvents.hasOwnProperty(e),"Should only register an event once")}catch(r){this.reportError(r)}try{this.PAssert(166,void 0!==e,"Must specify a name for the event")}catch(r){this.reportError(r)}try{this.PAssert(167,void 0!==t,"Must specify a category for the event")}catch(r){this.reportError(r)}try{this.PAssert(168,void 0!==a,"Must specify an action for the event")}catch(r){this.reportError(r)}var n={category:t,action:a,label:this.getAnonUserIdentifier(),count:0};this.aggregateEvents[e]=n}},{key:"aggregateEvent",value:function(e,t){try{this.PAssert(169,this.aggregateEvents.hasOwnProperty(e),"Must register an event before using it")}catch(a){this.reportError(a)}void 0===t&&(t=1),this.aggregateEvents[e]&&(this.aggregateEvents[e].count+=t)}},{key:"UIAction",value:function(e){this.sendEvent("UIAction",e)}},{key:"getAggregateEvents",value:function(){return this.aggregateEvents}},{key:"getAnonUserIdentifier",value:function(){if(!this.anonID){var e=this.getUserIdentifier();this.anonID=e?e[0]+e[1]+e[2]+this.murmurhash3_32_gc(e,17124123):"loggedout"}return this.anonID}},{key:"murmurhash3_32_gc",value:function(e,t){var a,n,r,i,o,s,l,u,c=0;for(a=3&e.length,n=e.length-a,r=t,o=3432918353,s=461845907,u=0;u<n;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;l=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24,++u,r=27492+(65535&(i=5*(65535&(r=(r^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|r>>>19))+((5*(r>>>16)&65535)<<16)&4294967295))+((58964+(i>>>16)&65535)<<16)}switch(l=0,a){case 3:l^=(255&e.charCodeAt(u+2))<<16;case 2:l^=(255&e.charCodeAt(u+1))<<8;case 1:r^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(u)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return r^=e.length,r=2246822507*(65535&(r^=r>>>16))+((2246822507*(r>>>16)&65535)<<16)&4294967295,r=3266489909*(65535&(r^=r>>>13))+((3266489909*(r>>>16)&65535)<<16)&4294967295,(r^=r>>>16)>>>0}},{key:"hashString",value:function(e){try{this.PAssert(170,this.isString(e),"Must always be passing a string to hash")}catch(t){this.reportError(t)}return this.murmurhash3_32_gc(e,this.defaultSeed)}},{key:"isDemoMode",value:function(){return!1}},{key:"getUserIdentifier",value:function(){var e=this.getToolbox();return this.isDemoMode()?"demouser":e?e.settings.activeUser.get():"Missing toolbox"}},{key:"beginCompleteAction",value:function(){this._isInCompleteAction=!0}},{key:"isInCompleteAction",value:function(){return this._isInCompleteAction}},{key:"endCompleteAction",value:function(){this._isInCompleteAction=!1}},{key:"getObjectInfo",value:function(e){try{if(e&&e.constructor)return e.constructor.name}catch(t){this.reportError(t)}return l()(e)}},{key:"hasTimeoutOnce",value:function(e){return!!this.timeouts[e]}},{key:"timeoutOnce",value:function(e,t,a,n,r,i,o,s){var l=this;try{this.PAssert(171,e,"Must supply a valid name")}catch(c){this.reportError(c)}try{this.PAssert(172,this.isFunction(t),"must supply a valid cb fn")}catch(c){this.reportError(c)}try{this.PAssert(173,arguments.length<=8,"Too many args passed in")}catch(c){this.reportError(c)}var u=this.timeouts[e];u&&clearTimeout(u),this.timeouts[e]=setTimeout((function(){delete l.timeouts[e],t(n,r,i,o,s)}),a)}},{key:"clearTimeoutOnce",value:function(e){var t=this.timeouts[e];t&&(clearTimeout(t),delete this.timeouts[e])}},{key:"timeoutIf",value:function(e,t,a){e?setTimeout(a,t):a()}},{key:"hasAnimationFrameOnce",value:function(e){return!!this.animationFrames[e]}},{key:"animationFrameOnce",value:function(e,t){var a=this;try{this.PAssert(174,e,"Must supply a valid name")}catch(r){this.reportError(r)}try{this.PAssert(175,this.isFunction(t),"must supply a valid cb fn")}catch(r){this.reportError(r)}try{this.PAssert(176,arguments.length<=8,"Too many args passed in")}catch(r){this.reportError(r)}var n=this.animationFrames[e];n&&cancelAnimationFrame(n),this.animationFrames[e]=requestAnimationFrame((function(){delete a.animationFrames[e],t()}))}},{key:"clearAnimationFrameOnce",value:function(e){var t=this.animationFrames[e];t&&(cancelAnimationFrame(t),delete this.animationFrames[e])}},{key:"sendEvent",value:function(e,t,a){}},{key:"objectValues",value:function(e){return Object.keys(e).map((function(t){return e[t]}))}},{key:"trimRight",value:function(e){for(var t=0,a=e.length-1;a>=0;a--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[a])break;e=e.substr(0,a)}return e}},{key:"getToolbox",value:function(){return a(4).default}},{key:"searchFromVMLI",value:function(e,t,a){a=a||0;var n=t.noCollapsed,r=t.pane,i=t.overview,o=!0;if(t.includeNotes&&!t.headers&&e.hasNote()){var s=e.getNote();t.comparator&&!t.comparator(s,t.comparatorOptions)||t.each&&(o=t.each(s))}if(!1!==o&&(!n||0===a||!r||!e.isCollapsed(r,i)))for(var l=0,u=e.items.get(),c=0;c<u.length;++c){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=u[c];if(!t.headers||d.showInOverview()){if((!t.comparator||t.comparator(d,t.comparatorOptions))&&t.each&&!1===(o=t.each(d)))return!1;this.searchFromVMLI(d,t,a+1)}}}},{key:"searchVMLIs",value:function(e){var t=this;try{this.PAssert(177,e,"Must supply a valid options param")}catch(n){this.reportError(n)}var a=this.getToolbox();try{if(e.itemStoreFilter)a.itemStoreManager.runForEachStore((function(a){var n=e.item,r=n&&n.belongsToItemStore(a)?n:a.getRoot();t.searchFromVMLI(r,e)}),e.itemStoreFilter);else if(e.item){try{this.PAssert(178,!e.itemStore&&!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(n){this.reportError(n)}this.searchFromVMLI(e.item,e)}else if(e.itemStore){try{this.PAssert(179,!e.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(n){this.reportError(n)}this.searchFromVMLI(e.itemStore.getRoot(),e)}else try{this.PAssert(180,!1,"Must specify a valid search root, using the default root is deprecated")}catch(n){this.reportError(n)}}catch(r){this.reportError(r)}}},{key:"clamp",value:function(e,t,a){return Math.max(t,Math.min(a,e))}},{key:"padZeros",value:function(e,t){for(var a=0,n=e+"";n.length<(t||2);){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n="0"+n}return n}},{key:"pad2",value:function(e){return this.padZeros(e,2)}},{key:"parseSubtree",value:function(e,t){var a=0;try{this.PAssert(181,e,"Must supply a valid item to parse")}catch(i){this.reportError(i)}this.runSingleParse(e,t,!0);for(var n=e.getItems(),r=0;r<n.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this.parseSubtree(n[r],t)}}},{key:"runSingleParse",value:function(e,t,a){try{this.PAssert(182,e,"Must have a valid item to parse")}catch(n){this.reportError(n)}e.parseText("",t,a)}},{key:"notifyActivity",value:function(){this.lastActivity=Date.now(),this.lowActivityTimer||(this.lowActivityTimer=setTimeout(this.checkLowActivity,2*this.activityThreshold)),this.whenLowImpactEnd()}},{key:"checkLowActivity",value:function(){Date.now()-this.lastActivity>this.activityThreshold&&this.whenLowImpactBegin(),this.lowActivityTimer=void 0}},{key:"whenLowImpactBegin",value:function(){this._isLowImpact||(this._isLowImpact=!0,V.a.fireEvent("lowImpactBegin",[]))}},{key:"whenLowImpactEnd",value:function(){this._isLowImpact&&(V.a.fireEvent("lowImpactEnd",[]),this._isLowImpact=!1)}},{key:"isLowImpact",value:function(){return this._isLowImpact}},{key:"parseEvernoteLink",value:function(e){return e.startsWith("evernote:///view/")?{viewUrl:e}:(z.lastIndex=0,null!==(t=z.exec(e))?{shardId:t[1],userId:t[2],noteGuid:t[3]}:void 0);var t}},{key:"isOneNoteLink",value:function(e){return e.startsWith("onenote:https://")}},{key:"isBearLink",value:function(e){return e.startsWith("bear://x-callback-url/")}},{key:"isFileLink",value:function(e){return e.startsWith("file://")}},{key:"runDateRollover",value:function(){var e=this.getToolbox();try{this.PAssert(183,this.isLoaded,"Expect that we have fully loaded the page before performing rollover")}catch(t){this.reportError(t)}this.log("---- Running Date Rollover: ",new Date),Date.Parsing.Normalizer.buildReplaceData(),e.timeline.clearDailyCaches(),V.a.fireEvent("beforeDateChanged",[]),e.PaneUpdateBatcher.updateAllItems(!0,!0),e.timeline.updateNotifications(),this.log("-------------------------------"),V.a.fireEvent("dateChanged",[])}},{key:"setupDateRollover",value:function(){var e=this,t=(new Date).clearTime();!function a(){var n=new Date,r=1e3*(60-n.getSeconds());n.clearTime(),+n!==+t&&e.runDateRollover(),t=n,setTimeout(a,r)}()}},{key:"ensureStatsXHR",value:function(e){var t=this.sanitizeURL(e).split("?")[0];return this.__xhrRequests[t]||(this.__xhrRequests[t]={requests:0,successes:0,retries:0,failures:0}),this.__xhrRequests[t]}},{key:"notifyStatsXHRRequest",value:function(e){this.ensureStatsXHR(e).requests++}},{key:"notifyStatsXHRSuccess",value:function(e){this.ensureStatsXHR(e).successes++}},{key:"notifyStatsXHRRetry",value:function(e){this.ensureStatsXHR(e).retries++}},{key:"notifyStatsXHRFailure",value:function(e){this.ensureStatsXHR(e).failures++}},{key:"getXHRStats",value:function(){return this.__xhrRequests}},{key:"sanitizeURL",value:function(e){return e.replace(/&?access_token=[^&]*/g,"")}},{key:"generateQueryString",value:function(e){var t="";if("object"===l()(e)){t=Object.keys(e).map((function(t){return void 0!==e[t]?encodeURIComponent(t)+"="+encodeURIComponent(e[t]):""})).join("&").replace(/%20/g,"+")}else{try{this.PAssert(184,"string"===typeof e,"Only Objects or Strings are currently supported")}catch(a){this.reportError(a)}t=e}return t}},{key:"packedFnToString",value:function(e){for(var t=0,a="",n=0;n<e.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a+=e[n]+"."}return a}},{key:"unpackFn",value:function(e,t){try{this.PAssert(185,this.isFunction(e)||this.isArray(e),"Must supply either a valid function or packed function")}catch(i){this.reportError(i)}var a=NaN;if(this.isFunction(e))a=e;else if(e)try{var n=0;0,a=t||window;for(var r=0;r<e.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;try{this.PAssert(186,this.isString(e[r]),"Packed fns must only contain strings: "+r)}catch(i){this.reportError(i)}try{this.PAssert(187,a,"Must be able to unpack each step in object chain: "+e[r]+" in "+this.packedFnToString(e))}catch(i){this.reportError(i)}if(!a){a=NaN;break}a=a[e[r]]}}catch(o){this.reportError(o),a=NaN}return a}},{key:"encodeMIMEHeader",value:function(e){return"=?UTF-8?B?"+this.btoa(unescape(encodeURIComponent(e)))+"?="}},{key:"utf8_to_b64",value:function(e){var t;try{t=this.btoa(unescape(encodeURIComponent(e))).replace(/\+/g,"-").replace(/\//g,"_")}catch(a){this.reportError(a,e)}return t}},{key:"b64_to_utf8",value:function(e){var t;try{t=decodeURIComponent(escape(this.atob(e.replace(/-/g,"+").replace(/_/g,"/"))))}catch(a){this.reportError(a,e)}return t}},{key:"qp_to_utf8",value:function(e){var t;try{t=e.replace(/[\t\x20]$/gm,"").replace(/=(?:\r\n?|\n|$)/g,"").replace(/=([a-fA-F0-9]{2})/g,(function(e,t){var a=parseInt(t,16);return String.fromCharCode(a)}))}catch(a){this.reportError(a,e)}return t}},{key:"isTextNode",value:function(e){return e&&3===e.nodeType}},{key:"isWhiteSpace",value:function(e){return/^\s*$/.test(e)}},{key:"isAncestor",value:function(e,t){var a=0;try{this.PAssert(188,e,"Must have a valid element")}catch(n){this.reportError(n)}try{this.PAssert(189,t,"Must have a valid candidate")}catch(n){this.reportError(n)}for(;e&&e!==t;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e=e.parentNode}return!!e}},{key:"isEmail",value:function(e){var t=!1;e&&(t=!!new RegExp(/\S+@\S+\.\S+/i).exec(e),t&&(t=e.indexOf('"')<0));return t}},{key:"intervalUntil",value:function(e){var t=0;if(!e())var a=setInterval((function(){t++,(e()||t>100)&&clearInterval(a)}),0);return!0}},{key:"hasGoogleError",value:function(e,t,a){try{this.PAssert(190,e,"Must specify a valid result object")}catch(l){this.reportError(l)}try{this.PAssert(191,t,"Must specify a valid error domain")}catch(l){this.reportError(l)}try{this.PAssert(192,a,"Must specify a valid error reason")}catch(l){this.reportError(l)}var n=!1;if(e&&e.error&&e.errors)for(var r=0,i=e.error.errors,o=0;o<i.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=i[o];if(s.domain===t&&s.reason===a){n=!0;break}}return n}},{key:"handleJSError",value:function(e,t,n,r){if(!e.message||!e.message.startsWith("Firebase Storage: Max retry time")&&!e.message.startsWith("ResizeObserver loop limit"))if(e){r||(r=D.a.LogLevels.Error);var i=this.getToolbox();if(i&&i.rollbar)try{var o=this.lastErrorsReported[e.stack];if(!o||o<Date.now()-5e3){var s=this.__LOG_BUFFER.ordered().join("\r\n"),l=i.settings?i.settings.getUserIdentifier():"No User Identifier";this.isRollbarConfigured||(i&&i.settings&&"me"!==l&&(this.isRollbarConfigured=!0),i.rollbar.configure({payload:{person:{id:l}},maxItems:D.a.__MAX_ERRORS_REPORTED,checkIgnore:this.rollbarIgnoreFn}));var u=this.parseExtra(t);if(this.numReported++,this.numReported<=D.a.__MAX_ERRORS_REPORTED){var c=a(161).default,d={};if(!this.isReporting){this.isReporting=!0;try{c.getAppInfo(d)}catch(f){}this.isReporting=!1}d.numReported=this.numReported;var h=Object.assign(this.getRollbarData(),{logs:s,info:d,user:l,extra:u});this.sendRollbar(e,h,r)}}this.lastErrorsReported[e.stack]=Date.now()}catch(e){this.log("Badness happened reporting errors to server: ",e);try{i.rollbar.error(e)}catch(p){this.log("More badness happened reporting errors to rollbar: ",p)}}}else console.log(e)}},{key:"reportError",value:function(e,t,a,n){this.handleJSError(e,t,!1,a)}},{key:"rollbarIgnoreFn",value:function(e,t,a){return!!(a&&a.body&&a.body.trace&&a.body.trace.frames&&a.body.trace.frames[0]&&q.indexOf(a.body.trace.frames[0].filename)>=0)}},{key:"parseExtra",value:function(e){return e?this.safeStringify(e):void 0}},{key:"isVowel",value:function(e){var t=e.toLowerCase();return"a"===t||"e"===t||"i"===t||"o"===t||"u"===t}},{key:"forEachValue",value:function(e,t){Object.keys(e).forEach((function(a){return t(e[a])}))}},{key:"isHTTPStatusCode",value:function(e,t){return e&&e.error&&e.error.code===t}},{key:"safeStringify",value:function(e){try{return JSON.stringify(e)}catch(t){0}}},{key:"makeString",value:function(e){for(var t=0,a="",n=0;n<e.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a+=" "+this.safeStringify(e[n])}return a}},{key:"decodeHtmlEntity",value:function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(t)})).replace(/<[^>]*>/g,"")}},{key:"deepFreeze",value:function(e){return e}},{key:"stringRemove",value:function(e,t,a){return e.substr(0,t)+e.substr(t+a)}},{key:"round",value:function(e,t){return t=t||2,Number(Math.round((""+e).includes("e")?e:e+"e"+t)+"e-"+t)}},{key:"debugTime",value:function(e,t){}},{key:"arrayToObjectById",value:function(e){var t={};return e.forEach((function(e){return t[e.id]=e})),t}},{key:"mapArrayToObject",value:function(e,t){var a={};return e.forEach((function(e){return a[e]=t(e)})),a}},{key:"objectToArray",value:function(e){return Object.keys(e).map((function(t){return e[t]}))}},{key:"arrayFlat",value:function(e){return[].concat.apply([],e)}},{key:"isEmoji",value:function(e){return!!e&&0===Object(M.withoutEmoji)(e.replace(/ /g,"")).length}},{key:"addSpacesToCamelCase",value:function(e){for(var t=0,a=e,n=a.length-1;n>=0;n--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;(a[n]>="A"&&a[n]<="Z"||!isNaN(a[n])&&(0===n||isNaN(a[n-1])))&&(a=a.substr(0,n)+" "+a.substr(n))}return a}},{key:"promiseSerial",value:function(e){return e.reduce((function(e,t){return e.then((function(e){return t().then(Array.prototype.concat.bind(e))}))}),Promise.resolve([]))}},{key:"decodeIDToken",value:function(e){try{var t=e.split(".");return JSON.parse(this.b64_to_utf8(t[1])).email.toLowerCase()}catch(a){this.reportError(a,"Error decoding id_token")}}},{key:"runSingletonPromise",value:function(){var e=o()(r.a.mark((function e(t,a){var n=this;return r.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return this.singletonPromises[t]||(this.singletonPromises[t]=new Promise(function(){var e=o()(r.a.mark((function e(i){var o;return r.a.wrap((function(e){for(var r=0,s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,a();case 2:o=e.sent,i(o),delete n.singletonPromises[t];case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}())),e.abrupt("return",this.singletonPromises[t]);case 2:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"tryParseJSON",value:function(e){try{return JSON.parse(e)}catch(t){}}},{key:"arrayMove",value:function(e,t,a){var n=e[a];e.splice(t,0,n),t<a&&a++,e.splice(a,1)}},{key:"promisify",value:function(){var e=o()(r.a.mark((function e(t){var a,n,i,o=0,s=this,l=arguments;return r.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:a=l.length,n=new Array(a>1?a-1:0),i=1;case 1:if(!(i<a)){e.next=8;break}if(!(o++>5e3&&__infLoop&&__infLoop(o))){e.next=4;break}throw new RangeError;case 4:n[i-1]=l[i];case 5:i++,e.next=1;break;case 8:return e.abrupt("return",new Promise((function(e){var a=n.concat((function(){e.apply(this,arguments)}));t.apply(s,a)})));case 9:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"logWithTime",value:function(e){var t=Date.now(),a=t-(this.prevLogTime||0);this.prevLogTime=t,console.log(a,e),console.trace()}},{key:"isArrayEqualWithProperty",value:function(e,t,a){var n=0;if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(var r=0;r<e.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=e[r],o=t[r];if(!i[a]||!o[a]||i[a]!==o[a])return!1}return!0}},{key:"distance",value:function(e,t){return Math.floor(Math.sqrt(Math.pow(e,2)+Math.pow(t,2)))}},{key:"sum",value:function(e){return e.reduce((function(e,t){return e+t}),0)}},{key:"max",value:function(e){return(null===e||void 0===e?void 0:e.length)?e.reduce((function(e,t){return Math.max(e,t)})):void 0}},{key:"maxObject",value:function(e,t){for(var a=0,n=Number.MIN_SAFE_INTEGER,r=-1,i=0;i<e.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=t(e[i]);o>n&&(r=i,n=o)}return e[r]}},{key:"minObject",value:function(e,t){for(var a=0,n=Number.MAX_SAFE_INTEGER,r=-1,i=0;i<e.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=t(e[i]);o<n&&(r=i,n=o)}return e[r]}},{key:"lazyLoad",value:function(e,t){return this.lazyLoadedComponents[e]||(this.lazyLoadedComponents[e]=Object(E.lazy)(t)),this.lazyLoadedComponents[e]}},{key:"_mapRecursive",value:function(e,t,a,n,r){var i=this;t.forEach((function(t){e.push(r(t,n)),t[a]&&i._mapRecursive(e,t[a],a,n+1,r)}))}},{key:"mapRecursive",value:function(e,t,a){var n=[];return this._mapRecursive(n,e,t,0,a),n}},{key:"truncate",value:function(e,t){return e.length>t?e.slice(0,t)+"...":e}}]),e}(),w()(N.prototype,"parseBoolean",[S.a],Object.getOwnPropertyDescriptor(N.prototype,"parseBoolean"),N.prototype),w()(N.prototype,"parseDate",[S.a],Object.getOwnPropertyDescriptor(N.prototype,"parseDate"),N.prototype),w()(N.prototype,"cloneWithoutUndefineds",[S.a],Object.getOwnPropertyDescriptor(N.prototype,"cloneWithoutUndefineds"),N.prototype),w()(N.prototype,"checkLowActivity",[S.a],Object.getOwnPropertyDescriptor(N.prototype,"checkLowActivity"),N.prototype),w()(N.prototype,"runDateRollover",[S.a],Object.getOwnPropertyDescriptor(N.prototype,"runDateRollover"),N.prototype),w()(N.prototype,"reportError",[S.a],Object.getOwnPropertyDescriptor(N.prototype,"reportError"),N.prototype),N);function K(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=_()(e);if(t){var r=_()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return y()(this,a)}}var Y;!function(e){e[e.None=0]="None",e[e.Item=1]="Item",e[e.Element=2]="Element"}(Y||(Y={}));var X=[0,5,15,35,80,170,400,1200],Q=[0,408,429,500,502,503,504],J=(B=function(e){m()(n,e);var t=K(n);function n(){var e;return c()(this,n),e=t.call(this),window.__infLoop=e.infLoop,e.vmMain=void 0,e.archivedPadding=34,e.itemTransitionTime=100,e.scrollbarWidth=12,e.hasFocus=!0,e.demoMode=!1,e.focusedPane=void 0,e.focusedItem=void 0,e.ClickThreshold=5,e.isReconnected=!1,e.isBlocked=!1,e.blockedMessage="",e.authImmediateFailed=!1,e.authUserLoggedIn=!1,e.noLocalWritesReason=D.a.LocalWriteReason.Enabled,e.isLoadingRemote=!1,e.isSendingEmail=!1,e.isSavingDrafts=!1,e.itemMenuOpenedOn=void 0,e.errorPlatformInfo=void 0,e.MobileSideTapThreshold=40,e.MobileSideTapThresholdKeyboardOpen=15,e.colorBlue="#09d",e.colorLightBlue="#02b1ff",e.colorRed="#d43",e.colorLightRed="#f34433",e.MinItemWidth=50,e.paneTop=I.a.app?20:0,e.activeDisplayMode=D.a.DisplayMode.Default,e.eventStream=new H.a(25),e.currentFindPass=0,e.scrollTimeouts={},e.scrollState={speedPane:0,pane:void 0,speedPanes:0,panes:!1},e.keyboardDestination=Y.None,e.keyboardOpenedOn=void 0,e.keyboardBlurFn=void 0,e.keyboardStartScrollOffset=0,e.numLastLoop=-1,e.timeLastLoop=void 0,window.onerror=e.onWindowError,e.wrapAsyncCallbacks(),e.wrapXHR(),I.a.demo&&e.enableDemoMode(),e}return h()(n,[{key:"addDevFunctions",value:function(){var e=this,t=window;t.__globals=function(){return e};var a=1;this.shouldLog(D.a.LogLevels.Input)&&(t.__eventBuffer=new H.a(100)),this.tagEvent=function(n,r,i){n.id||(n.id=a++,e.shouldLog(D.a.LogLevels.Input)&&t.__eventBuffer.push(n)),e.shouldLog(D.a.LogLevels.Input)&&(n.activeHandler={owner:r,fn:i},n.handlers?n.handlers.push(n.activeHandler):n.handlers=[n.activeHandler])},this.Assert=function(){for(var a=0,n=0,r=arguments.length,i=new Array(r),o=0;o<r;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i[o]=arguments[o]}if(!i[0])try{i.length>1?t.__error.apply(console,i.slice(1).map((function(t){return e.isFunction(t)?t():t}))):t.__error("Assert Failure!")}catch(s){t.__error("Problem reporting Assert!")}},this.DAssert=function(t){t||e.log("Debug ONLY assert was hit.")},t.__getXHRStats=this.getXHRStats}},{key:"_dbgCatch",value:function(e){for(var t=0,a=0,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r[i-1]=arguments[i]}try{if(e)return e.apply(void 0,r)}catch(o){this.reportError(o,r)}}},{key:"fnCatch",value:function(e){try{this.PAssert(5,e,"Must specify a callback")}catch(t){this.reportError(t)}return this._dbgCatch.bind(this,e)}},{key:"getTransitionClass",value:function(e){var t;switch(e){case 50:t="trans05";break;case 100:t="trans1";break;case 200:t="trans2";break;case 300:t="trans3";break;case 400:t="trans4";break;case 500:t="trans5";break;case 1e3:t="trans10";break;default:console.log("ERROR: no time for ",e)}return t}},{key:"setTransformStyle",value:function(e,t,a){try{this.PAssert(6,e,"Must provide a valid element")}catch(n){this.reportError(n)}if(e){try{this.PAssert(7,void 0!==t,"Must supply a valid X offset")}catch(n){this.reportError(n)}try{this.PAssert(8,void 0!==a,"Must supply a valid Y offset")}catch(n){this.reportError(n)}I.a.ie?e.style[I.a.transform.style]="translate("+t+"px, "+a+"px)":e.style[I.a.transform.style]="translate3d("+t+"px, "+a+"px, 0px)"}}},{key:"setTransitionStyle",value:function(e,t,a,n){try{this.PAssert(9,e,"Must provide a valid element")}catch(r){this.reportError(r)}e&&(n=n||"ease",e.style[I.a.transition.style]=t+" "+a+"ms "+n,setTimeout((function(){e.style[I.a.transition.style]=""}),a))}},{key:"setTransform",value:function(e,t,a,n,r){n>0?(this.setTransitionStyle(e,I.a.transform.prop,n,r),this.setTransformStyle(e,t,a)):t||a?this.setTransformStyle(e,t,a):e.style[I.a.transform.style]="none"}},{key:"reload",value:function(e){window.location.reload(e)}},{key:"parseTokensFromText",value:function(e){for(var t,a=0,n=[],r=/(?:(?:["]([^"<>]*)["]\s))|(?:([^",<>]*)\s)<([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>,?|(^|[\s,])<?([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>?,?/g,i=0;null!==(t=r.exec(e));){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=e.substring(i,t.index),s=t[1]||t[2],l=t[3]||t[5];i=r.lastIndex,o&&o.trim().length>0&&n.push({text:o,type:"text"}),n.push({text:s||l,email:l,type:"contact"})}var u=e.substring(i,e.length);return u&&u.length>0&&n.push({text:u,type:"text"}),n}},{key:"preventLocalWrites",value:function(e){try{this.PAssert(10,!this.noLocalWrites,"Should only disable local writes once")}catch(t){this.reportError(t)}try{this.PAssert(11,e>=0,"Must provide a valid reason for disabling local writes")}catch(t){this.reportError(t)}this.isDemoMode()||this.shouldLog(D.a.LogLevels.Warning)&&this.log("---- WARNING: Local Writes Disabled ----"),this.noLocalWrites=!0,this.noLocalWritesReason=e}},{key:"enableDemoMode",value:function(){this.demoMode=!0,this.preventLocalWrites(D.a.LocalWriteReason.DemoMode)}},{key:"isDemoMode",value:function(){return this.demoMode}},{key:"isDisplayModeActive",value:function(e){return(this.activeDisplayMode&e)===e}},{key:"isDemoInIframe",value:function(){return this.isDisplayModeActive(D.a.DisplayMode.InIframe)}},{key:"enableMinMode",value:function(){try{var e=T.a.getURLParam("dmode");if(e){var t=parseInt(e);this.addClass(document.body,"minMode"),this.isMinMode=!0,t&D.a.DisplayMode.InIframe&&this.addClass(document.documentElement,"inIframe"),t&D.a.DisplayMode.Invisible&&this.addClass(document.documentElement,"invisible"),t&D.a.DisplayMode.NoBoards&&this.addClass(document.body,"noBoards"),t&D.a.DisplayMode.NoMinPaneSize&&(this.minPaneWidth=0),t&D.a.DisplayMode.NoPaneStyle&&this.addClass(document.body,"noPaneStyle"),t&D.a.DisplayMode.NoPanePadding&&(this.addClass(document.body,"noPanePadding"),this.noPanePadding=!0),t&D.a.DisplayMode.NoScrollbars&&(this.noScrollbars=!0),t&D.a.DisplayMode.NoBackground&&this.addClass(document.documentElement,"noBackground"),t&D.a.DisplayMode.ShowHelp&&this.getToolbox().intro.showHelp(),this.activeDisplayMode=t}}catch(a){this.reportError(a)}}},{key:"hasClass",value:function(e){try{this.PAssert(12,e,"Must pass in a valid element")}catch(n){this.reportError(n)}if(null===e||void 0===e?void 0:e.classList)for(var t=0,a=0;a<(arguments.length<=1?0:arguments.length-1);a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e.classList.contains(a+1<1||arguments.length<=a+1?void 0:arguments[a+1]))return!0}return!1}},{key:"removeClass",value:function(e,t){try{this.PAssert(13,e,"Must pass in a valid element")}catch(a){this.reportError(a)}e&&e.classList&&e.classList.remove(t)}},{key:"addClass",value:function(e,t){try{this.PAssert(14,e,"Must pass in a valid element")}catch(a){this.reportError(a)}e&&e.classList&&e.classList.add(t)}},{key:"toggleClass",value:function(e,t){try{this.PAssert(15,e,"Must pass in a valid element")}catch(a){this.reportError(a)}e&&e.classList&&e.classList.toggle(t)}},{key:"findChild",value:function(e,t){try{this.PAssert(16,e,"Must pass in a valid element")}catch(o){this.reportError(o)}if(e)for(var a=0,n=0;n<e.childElementCount;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e.children[n];if(this.hasClass(r,t))return r;var i=this.findChild(r,t);if(i)return i}}},{key:"setupClick",value:function(e,t,a){var n=this;try{this.PAssert(17,e,"Expecting an object to bind the click handlers to.")}catch(L){this.reportError(L)}try{this.PAssert(18,t,"Must specify a valid owner for click handlers")}catch(L){this.reportError(L)}this.shouldLog(D.a.LogLevels.Input)&&this.log("SetupClick: "+this.elementToString(e)),t||(t=e);var r,i,o,s,l,u,c,d,h,f,p,g,m,v=this,y=!1;this.isFunction(a)?a={onClick:a}:a&&a.useCapture&&(y=a.useCapture);var k=function(e,n){try{v.PAssert(19,!t.isDestroyed||!t.isDestroyed()||"onMove"===e||"onEnd"===e,"Owner must not be destroyed to handle a click")}catch(L){v.reportError(L)}return a[e].call(t,n)},_=function(e){v.shouldLog(D.a.LogLevels.Input)&&n.log("Move: ",e.id);var t=e.eventX-r,p=e.eventY-i;if(0!==t||0!==p){var g=!l;if(r=e.eventX,i=e.eventY,e.distanceX=o+=Math.abs(t),e.distanceY=s+=Math.abs(p),(l||e.distanceX>n.ClickThreshold||e.distanceY>n.ClickThreshold)&&(l=!0,e.moved=l),a.onMove||a.onFirstMove)if(e.diffX=e.eventX-u,e.diffY=e.eventY-c,e.xThisFrame=t,e.yThisFrame=p,e.startX=u,e.startY=c,e.startClientX=d,e.startClientY=h,e.startSrc=f,g&&a.onFirstMove&&k("onFirstMove",e),a.onMove)k("onMove",e)&&e.stopImmediatePropagation()}},b=function(t){v.shouldLog(D.a.LogLevels.Input)&&v.log("End: ",t.id,v.elementToString(t.target),v.elementToString(e));var n=Date.now();p=p||n;var o=Math.max(0,n-p);g?g++:g=1,t.moved=l,t.timeDelta=o,t.diffX=r-u,t.diffY=i-c,t.startX=u,t.startY=c,t.startSrc=f,f=void 0,o<D.a.DoubleClickTime&&o>0&&a.onDoubleClick&&!l&&k("onDoubleClick",t),isNaN(t.button)||t.button===D.a.ButtonCode.Left?(p=n,!a.onClick||l||I.a.mac&&t.ctrlKey||k("onClick",t),a.onEnd&&k("onEnd",t)):t.button===D.a.ButtonCode.Middle&&a.onMiddleClick&&!l&&k("onMiddleClick",t),setTimeout((function(){p=void 0,g=void 0}),D.a.DoubleClickTime)},w=function(t){v.shouldLog(D.a.LogLevels.Input)&&v.log("Cancel: ",t.id,v.elementToString(t.target),v.elementToString(e)),a.onCancel&&k("onCancel",t)},S=function(t){v.shouldLog(D.a.LogLevels.Input)&&v.log("Start: ",t.id,v.elementToString(t.target),v.elementToString(e)),t.timeStart=Date.now(),f=t.target,t.startSrc=t.target,l=!1,t.startX=u=t.eventX,t.startY=c=t.eventY,t.startClientX=d=t.clientX,t.startClientY=h=t.clientY,r=t.eventX,i=t.eventY,o=0,s=0,(isNaN(t.button)||t.button===D.a.ButtonCode.Left||t.button===D.a.ButtonCode.Right)&&((isNaN(t.button)||t.button===D.a.ButtonCode.Left)&&a.onStart?k("onStart",t):t.button===D.a.ButtonCode.Right&&a.onRightStart&&k("onRightStart",t)),isNaN(t.changeLastY)||(i+=t.changeLastY)},P=this.fnCatch((function(t){var a=I.a.ie?t:t.touches[0];if(t.eventX=a.pageX,t.eventY=a.pageY,t.clientX=a.clientX,t.clientY=a.clientY,_.call(e,t),t.returnFalse)return!1})),E=this.fnCatch((function(t){v.shouldLog(D.a.LogLevels.Input)&&v.log("TouchUp: ",t.id,v.elementToString(t.target),v.elementToString(e)),document.removeEventListener(I.a.touchMoveEvent,P,y),document.removeEventListener(I.a.touchEndEvent,E,y),document.removeEventListener(I.a.touchCancelEvent,C,y);var a=I.a.ie?t:t.changedTouches[0];if(t.eventX=a.pageX,t.eventY=a.pageY,t.clientX=a.clientX,t.clientY=a.clientY,b.call(e,t),t.returnFalse)return!1})),C=this.fnCatch((function(t){if(v.shouldLog(D.a.LogLevels.Input)&&v.log("TouchCancel: ",t.id,v.elementToString(t.target),v.elementToString(e)),document.removeEventListener(I.a.touchMoveEvent,P,y),document.removeEventListener(I.a.touchEndEvent,E,y),document.removeEventListener(I.a.touchCancelEvent,C,y),w.call(e,t),t.returnFalse)return!1})),x=this.fnCatch((function(t){if(!t.handled&&!m)return v.shouldLog(D.a.LogLevels.Input)&&v.log("MouseDown: ",t.id,v.elementToString(t.target),v.elementToString(e)),m=!1,t.eventX=t.pageX,t.eventY=t.pageY,S.call(e,t),t.ignore||(t.button===D.a.ButtonCode.Left&&document.addEventListener(I.a.moveEvent,A,y),document.addEventListener(I.a.upEvent,T,y)),!t.returnFalse&&void 0})),A=this.fnCatch((function(t){if(!m)return t.eventX=t.pageX,t.eventY=t.pageY,_.call(e,t),!t.returnFalse&&void 0})),T=this.fnCatch((function(t){if(!t.handled&&!m)return v.shouldLog(D.a.LogLevels.Input)&&v.log("MouseUp: ",t.id,v.elementToString(t.target),v.elementToString(e)),document.removeEventListener(I.a.moveEvent,A,y),document.removeEventListener(I.a.upEvent,T,y),t.button===D.a.ButtonCode.Left&&b.call(e,t),!t.returnFalse&&void 0})),M=this.fnCatch((function(t){t.handled||m||(v.shouldLog(D.a.LogLevels.Input)&&v.log("ContextMenu: ",t.id,v.elementToString(t.target),v.elementToString(e)),a.onRightClick&&k("onRightClick",t))}));return e.addEventListener(I.a.downEvent,x,y),a.onRightClick&&e.addEventListener("contextmenu",M,y),this}},{key:"isDOMNode",value:function(e){return"HTMLElement"in window?e instanceof HTMLElement:e&&e.tagName&&e.nodeType===Node.ELEMENT_NODE}},{key:"ensureDOMNode",value:function(e){var t,a;e instanceof SVGPathElement?t=null===(a=e.parentElement)||void 0===a?void 0:a.parentElement:this.isDOMNode(e)?t=e:(this.isTextNode(e)||e instanceof SVGElement)&&(t=e.parentElement);return t}},{key:"enumToString",value:function(e,t){for(var a in e)if(e[a]===t)return a;return null}},{key:"elementToString",value:function(e,t){if(e){var a,n=e.nodeName;return e.id&&(n+="#"+e.id),(null===(a=e.className)||void 0===a?void 0:a.replace)&&(n+="."+e.className.replace(/ /g,".")),t&&e.innerText&&(n+=":"+e.innerText.length),n}return"UNDEFINED"}},{key:"getElementPath",value:function(e,t){var a=!0,n="";try{for(var r=0;e&&"container"!==e.id&&e!==document.documentElement&&e!==document.body;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;n+=a?this.elementToString(e,t)+" ":this.elementToString(e)+" ",a=!1,e=e.nodeType===Node.TEXT_NODE?e.parentNode:e.parentElement}}catch(i){n+=i.message}return n}},{key:"setDimension",value:function(e,t){window.ga&&!this.isDemoMode()&&ga("set",e,t)}},{key:"sendEvent",value:function(e,t,a){try{this.PAssert(21,void 0===a||this.isNumber(a),"Values must be numeric")}catch(n){this.reportError(n)}if(window.ga&&!this.isDemoMode())try{ga("send","event",e,t,this.getAnonUserIdentifier(),a)}catch(r){this.reportError(r,"Category: "+e+" Action: "+t+" Value: "+a)}}},{key:"sendToGoogle",value:function(e,t){var a="//www.googleadservices.com/pagead/conversion/976910954/?label="+e+"&guid=ON";t&&(a+="&value="+t+"&currency_code=USD"),new Image(1,1).src=a}},{key:"reportAdConversion",value:function(e,t){try{this.sendToGoogle(e,t)}catch(a){this.reportError(a)}}},{key:"pageDataCleared",value:function(){this.isPageDataCleared=!0}},{key:"hasPageDataBeenCleared",value:function(){return this.isPageDataCleared}},{key:"findFirstDiff",value:function(e,t,a,n){var r=0;if(!e)return n?0:t.length;if(!t)return n?e.length:0;for(var i=Math.min(e.length,t.length),o=0;o<i;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(a){if(e.charAt(o).toLowerCase()!==t.charAt(o).toLowerCase())return o}else if(e.charAt(o)!==t.charAt(o))return o}return n?e.length:t.length}},{key:"lerp",value:function(e,t,a){return e+(t-e)*a}},{key:"hashCode",value:function(e){var t,a=0,n=0;if(0===e.length)return n;for(t=0;t<e.length;t++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n=(n<<5)-n+e.charCodeAt(t),n|=0}return n}},{key:"sanitizePaneState",value:function(e){try{for(var t=0,a=JSON.parse(JSON.stringify(e)),n=0;n<a.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;""!==a[n].search&&(a[n].search="HasSearch")}return JSON.stringify(a)}catch(r){return"Failed to sanitize pane state"}}},{key:"sanitizeLocalSettings",value:function(e){try{var t=JSON.parse(e);return delete t.values.Default.paneState,delete t.values.Default.localPaneState,delete t.values.Default.gdocTitle,t}catch(a){return"Failed to parse settings"}}},{key:"sanitizeKey",value:function(e){switch(e){case D.a.KeyCode.Backspace:return"BACKSPACE";case D.a.KeyCode.Delete:return"DELETE";case D.a.KeyCode.Enter:return"ENTER";case D.a.KeyCode.Escape:return"ESCAPE";default:return"CHAR"}}},{key:"getLoadedScripts",value:function(e){try{for(var t=0,a=document.getElementsByTagName("script"),n=[],r=0;r<a.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=a[r];i.src&&n.push(i.src)}e.loadedScripts=n}catch(o){e.loadedScripts="ERROR: "+o.message}}},{key:"getExtraReportData",value:function(e){e.platformConfig=I.a.getUserPlatformConfig()}},{key:"criticalErrorReported",value:function(){return this.hasCriticalError}},{key:"handleCriticalError",value:function(){var e=this;this.hasCriticalError=!0;try{document.body.innerHTML='<div class="centerVHFlex">There was a critical error while loading Moo.do. '.concat(I.a.actionVerb().capitalize()," to reload and try again.</div>"),document.body.addEventListener("click",(function(){return e.reload()}))}catch(t){this.reportError(t)}}},{key:"reportEvent",value:function(e){if(!this.isDemoMode()){var t=this.parseExtra(e);t&&this.eventStream.push(t)}}},{key:"getEventStream",value:function(){return this.eventStream.ordered()}},{key:"parseExtra",value:function(e){var t;if(e)try{var a;if(e instanceof KeyboardEvent){var n=this.elementToString(e.target);["[INPUT#importPW]","[INPUT#importEmail]","[TEXTAREA#bugDescription.bugDescription editable]"].indexOf(n)<0&&(a={type:e.type,currentTarget:this.elementToString(e.currentTarget),target:n,keyCode:this.sanitizeKey(e.keyCode),normCode:this.sanitizeKey(e.normCode),ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,tstamp:Date.now()})}else if(e instanceof MouseEvent)a={type:e.type,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),clientX:e.clientX,clientY:e.clientY,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,which:e.which,button:e.button,tstamp:Date.now()};else if(window.TouchEvent&&e instanceof TouchEvent){a={type:e.type,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),tstamp:Date.now()};var r=e.touches[0];r&&(a.clientX=r.clientX,a.clientY=r.clientY)}else if(window.PointerEvent&&e instanceof PointerEvent)a={type:e.type,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),clientX:e.clientX,clientY:e.clientY,tstamp:Date.now()};else if(e instanceof Event)a={type:e.type,name:e.name,code:e.code,message:e.message,currentTarget:this.elementToString(e.currentTarget),relatedTarget:this.elementToString(e.relatedTarget),target:this.elementToString(e.target),tstamp:Date.now()};else if(e instanceof Selection)if(0===e.rangeCount)a={rangeCount:0};else{var i=e.getRangeAt(0),o=i.startContainer,s=!1,l=i.endContainer,u=!1;o.nodeType===Node.TEXT_NODE&&(o=o.parentNode,s=!0),l.nodeType===Node.TEXT_NODE&&(l=l.parentNode,u=!0),a={rangeCount:e.rangeCount,startContainer:this.getElementPath(o),startWasTextNode:s,startOffset:i.startOffset,endContainer:this.getElementPath(l),endWasTextNode:u,endOffset:i.endOffset}}else a=e;t=a?this.safeStringify(a):void 0}catch(c){this.log("Error parsing extra "+c.message)}return t}},{key:"handleJSError",value:function(e,t,a,r){e&&(!a&&window.__error&&window.__error("JS Error: "+e.message,"  Stack: ",e.stack,"  Extra: ",t),p()(_()(n.prototype),"handleJSError",this).call(this,e,t,a,r))}},{key:"onWindowError",value:function(e,t,a,n,r){console.log(e,t,a,n,r),"ResizeObserver loop limit exceeded"!==e&&"Script error."!==e&&(r?(this.log("Reported Global OnError: "+e+" Script: "+t+" Line: "+a+" Column: "+n),this.reportError(r)):(this.log("Unreported Global OnError: "+e+" Script: "+t+" Line: "+a+" Column: "+n),this.reportError(e)))}},{key:"checkpoint",value:function(e){window.__checkpoints|=e}},{key:"wrapFn",value:function(e,t){var a=this;return function(){try{return e.apply(this,arguments)}catch(n){n&&"auth/network-request-failed"===n.code||(a.reportError(n),t&&t(n))}}}},{key:"wrapAsyncCallbacks",value:function(){var e=this,t=function(t){var a=window[t];window[t]=function(){var t=Array.prototype.slice.call(arguments),n=t[0];return"function"===typeof n&&(t[0]=e.wrapFn(n)),a.apply?a.apply(this,t):a(t[0],t[1])}};t("setTimeout"),t("setInterval")}},{key:"mergeObjects",value:function(e,t){var a,n=this;return Array.isArray(t)?(a=(a=[]).concat(e=e||[]),t.forEach((function(t,r){"undefined"===typeof a[r]?a[r]=t:"object"===l()(t)?a[r]=n.mergeObjects(e[r],t):-1===e.indexOf(t)&&a.push(t)}))):(a={},e&&"object"===l()(e)&&Object.keys(e).forEach((function(t){a[t]=e[t]})),Object.keys(t).forEach((function(r){"object"===l()(t[r])&&t[r]&&e[r]?a[r]=n.mergeObjects(e[r],t[r]):a[r]=t[r]}))),a}},{key:"readyStateCallback",value:function(e,t,a){e.onloadDone=!1,e.onload=function(){e.onloadDone=!0,t&&t()},e.onreadystatechange=function(){"loaded"!==e.readyState||e.onloadDone||(e.onloadDone=!0,t&&t())},a&&(e.onerror=a)}},{key:"createPath",value:function(e){return window.location.protocol+"//"+window.location.host+"/"+e}},{key:"addScript",value:function(e,t,a,n){try{this.PAssert(22,!t||null===document.getElementById(t),"Should never include the same script ID multiple times")}catch(i){this.reportError(i)}var r=document.createElement("script");r.src=e,t&&(r.id=t),a&&this.readyStateCallback(r,a,n);try{this.PAssert(23,"undefined"!==typeof r,"Should always be able to create a valid script object")}catch(i){this.reportError(i)}"undefined"!==typeof r&&document.getElementsByTagName("head")[0].appendChild(r)}},{key:"addStylesheet",value:function(e,t,a){var n=document.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,t&&this.readyStateCallback(n,t,a),"undefined"!==typeof n&&document.getElementsByTagName("head")[0].appendChild(n)}},{key:"DAssert",value:function(e,t){}},{key:"PAssert",value:function(e,t){var a=this;if(!t){var n={isAssert:!0,tag:e};try{var r=Array.prototype.slice.call(arguments,2),i=this.makeString(r.map((function(e){return a.isFunction(e)?e():e})));arguments.length>2?this.log("Assert Failure "+e+": "+i):this.log("Assert Failure "+e),this.reportError(new Error("Assert Failure: "+i),n,D.a.LogLevels.Warning)}catch(o){this.log("Exception in PAssert "+e+": ",o),this.reportError(o,n)}}}},{key:"getElementParent",value:function(e){var t=0;for(0;e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.hasClass(e,"paneItemElement")||this.hasClass(e,"itemNotInPane")||this.hasClass(e,"paneHiddenInput")||this.hasClass(e,"draggable"))return e;e=e.parentNode}}},{key:"isItemValidForPass",value:function(e,t){return!!e&&(t?e.lastFindPass===this.currentFindPass:e.lastFindPass<this.currentFindPass)}},{key:"markItemForPass",value:function(e,t){if(e){var a=this.isItemValidForPass(e,t);try{this.PAssert(25,a,"Item should always be valid")}catch(n){this.reportError(n)}return e.lastFindPass=this.currentFindPass,a}return!1}},{key:"getPreviousItem",value:function(e,t,a){return this.currentFindPass++,this._getPreviousItem(e,t,a)}},{key:"_getPreviousItem",value:function(e,t,a){var n;var r=a&&a.isTest,i=a&&a.ignoreSearch,o=a&&a.sameLevel,s=a&&a.includeNotes;if(this.markItemForPass(e,r)){var l=e.parent();if(l){if(e.isNote())return e.parent();var u=l.getChildIndex(e);if(u>0)for(var c=0;!n;){var d=0;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;for(var h=!1,f=u-1;f>=0;f--){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var p=l.getChild(f);if(!this.markItemForPass(p,r)){try{this.PAssert(27,!1,"Invalid child found during findPreviousItem")}catch(g){this.reportError(g)}return}if(o||!p.hasChildren()||t&&p.isCollapsed(t,!1)){if(i||!t||!p.isHidden(t,!1)){n=p,h=!0;break}}else if(i||!t||!p.isHidden(t,!1)){l=p,u=p.numChildren(),h=!0;break}}if(o)break;h||(n=l)}else o||(n=e.parent());s&&n&&n.hasNote()&&(n=n.getNote());try{this.PAssert(28,!o||!n||n.parent()===e.parent(),"Previous item must share the same parent")}catch(g){this.reportError(g)}try{this.PAssert(29,r||!n||t&&n.isCollapsed(t,!1)||e===this._getNextItem(n,t,{isTest:!0,ignoreSearch:i,sameLevel:o}),"Previous/Next should always match")}catch(g){this.reportError(g)}return n}}}},{key:"getNextItem",value:function(e,t,a){return this.currentFindPass++,this._getNextItem(e,t,a)}},{key:"_getNextItem",value:function(e,t,a){var n,r=0;var i=a&&a.isTest,o=a&&a.ignoreSearch,s=a&&a.sameLevel,l=a&&a.includeNotes;if(e){if(l&&e.hasNote())return e.getNote();if(e.isNote()&&(e=e.parent()),!s&&e.hasChildren()&&(!t||!e.isCollapsed(t,!1)))for(var u=0,c=e.numChildren(),d=0;d<c;++d){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var h=e.getChild(d);if(!this.markItemForPass(h,i)){try{this.PAssert(31,!1,"Invalid child found during findNextItem A")}catch(_){this.reportError(_)}return}if(o||!t||!h.isHidden(t,!1)){n=h,a&&a.numLevels++;break}}for(var f=e;!n;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(!this.markItemForPass(f,i)){try{this.PAssert(32,!1,"Invalid parent found during findNextItem B")}catch(_){this.reportError(_)}break}var p=f.parent();if(!p)break;var g=p.getChildIndex(f),m=p.numChildren();if(!t||!p.isCollapsed(t,!1))for(var v=0,y=g+1;y<m;++y){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;var k=p.getChild(y);if(!this.markItemForPass(k,i)){try{this.PAssert(34,!1,"Invalid child found during findNextItem C")}catch(_){this.reportError(_)}return}if(o||!t||!k.isHidden(t,!1)){n=k;break}}if(f=p,a&&!n&&a.numLevels--,s||t&&f===t.getItem())break}try{this.PAssert(35,!s||!n||n.parent()===e.parent(),"Next item must share the same parent")}catch(_){this.reportError(_)}try{this.PAssert(36,i||!n||e===this._getPreviousItem(n,t,{isTest:!0,ignoreSearch:o,sameLevel:s}),"Previous/Next should always match")}catch(_){this.reportError(_)}return n}}},{key:"easeOut",value:function(e,t,a){return-a*e*(e-2)+t}},{key:"scrollElementTo",value:function(e,t){var n=!1;if(e){try{if("smooth"===t.behavior)a(278)(t.top,300,void 0,e);else e.scrollTo(t);n=!0}catch(o){}if(!n){var r=t.left,i=t.top;void 0!==r&&(e.scrollLeft=r),void 0!==i&&(e.scrollTop=i)}}}},{key:"scrollTo",value:function(e,t,a,n,r){try{this.PAssert(37,void 0!==e||void 0!==t,"Must be scrolling something")}catch(o){this.reportError(o)}try{this.PAssert(38,void 0===e||this.isNumber(e),"Must provide a valid scrollPosX")}catch(o){this.reportError(o)}try{this.PAssert(39,void 0===t||this.isNumber(t),"Must provide a valid scrollPosY")}catch(o){this.reportError(o)}try{this.PAssert(40,this.isDOMNode(n),"Must provide a valid element to scroll")}catch(o){this.reportError(o)}try{this.PAssert(41,!r||this.isFunction(r),"Must provide a valid scrollDone callback")}catch(o){this.reportError(o)}var i=n.getAttribute("data-moo-id")||n.id;try{this.PAssert(42,i,"Should only scroll elements with ids")}catch(o){this.reportError(o)}this.scrollTimeouts[i]&&(cancelAnimationFrame(this.scrollTimeouts[i]),delete this.scrollTimeouts[i]),n?(this.scrollElementTo(n,{left:e,top:t,behavior:a}),r&&("smooth"===a?setTimeout(r,500):r())):this.reportError(new Error("Must specify an element to scroll to"))}},{key:"computeScrollSpeed",value:function(e,t,a,n,r){var i=(t-e-(t-(a=this.clamp(a,e,t))))/(t-e);return r<0&&(i-=1),i*n}},{key:"performRepeatScrollPane",value:function(){if(this.scrollState.pane){var e=this.scrollState.pane,t=e.id,a=this.scrollState.speedPane;e.addScrollDelta(a,"auto"),this.animationFrameOnce("repeatScroll"+t,this.performRepeatScrollPane)}}},{key:"repeatScrollPane",value:function(e,t){this.scrollState.speedPane=e,t!==this.scrollState.pane&&(this.scrollState.pane=t,this.animationFrameOnce("repeatScroll"+t.id,this.performRepeatScrollPane))}},{key:"performRepeatScroll",value:function(){if(this.scrollState.pane||this.scrollState.panes){var e;if(this.scrollState.pane){var t=6*this.scrollState.speedPane;e=this.scrollState.pane.addScrollDelta(t)}else{var a=6*this.scrollState.speedPanes,n=this.element("panes"),r=n.scrollLeft;n.scrollLeft+=a,e=r!==n.scrollLeft}e?requestAnimationFrame(this.performRepeatScroll):this.cancelRepeatScroll(this.scrollState.pane?"pane":"panes")}}},{key:"repeatScroll",value:function(e,t,a,n){this.scrollState["speed"+(a?"Pane":"Panes")]=t,(this.scrollState.pane||this.scrollState.panes)&&a===this.scrollState.pane||(this.scrollState.pane=a,this.scrollState.panes=n,requestAnimationFrame(this.performRepeatScroll))}},{key:"cancelRepeatScrolls",value:function(){this.scrollState.pane=void 0,this.scrollState.panes=void 0}},{key:"cancelRepeatScroll",value:function(e){this.scrollState[e]=void 0}},{key:"elementInPane",value:function(e){if(e){var t=0;for(e.nodeType===Node.TEXT_NODE&&(e=e.parentNode);e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.hasClass(e,"pane")||this.hasClass(e,"paneOverviewOutside"))return!!e;e=e.parentElement}}return!1}},{key:"trimString",value:function(e){for(var t=0,a=/\s/,n=(e=e.replace(/^\s\s*/,"")).length;a.test(e.charAt(--n));)if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;return e.slice(0,n+1)}},{key:"preventAndStop",value:function(e){this.preventDefault(e),this.stopPropagation(e)}},{key:"preventDefault",value:function(e){if(e&&e.preventDefault)e.preventDefault();else try{this.PAssert(43,!1,"Invalid event object: "+e)}catch(t){this.reportError(t)}}},{key:"stopPropagation",value:function(e){if(e&&e.stopPropagation)e.stopPropagation();else try{this.PAssert(44,!1,"Invalid event object: "+e)}catch(t){this.reportError(t)}}},{key:"preventClick",value:function(){var e=this;this.addClass(this.element("outerWrapper"),"noClick"),window.ontouchstart=this.preventDefault,requestAnimationFrame((function(){window.ontouchstart=void 0,e.removeClass(e.element("outerWrapper"),"noClick")}))}},{key:"loadXML",value:function(e){try{var t=window;if("undefined"!==typeof t.DOMParser)return(new t.DOMParser).parseFromString(e,"text/xml");if("undefined"!==typeof t.ActiveXObject&&new t.ActiveXObject("Microsoft.XMLDOM")){var a=new t.ActiveXObject("Microsoft.XMLDOM");return a.async="false",a.loadXML(e),a}try{this.PAssert(45,!1,"No XML parser found")}catch(n){this.reportError(n)}return}catch(r){return void this.reportError(r)}}},{key:"getPluginForElement",value:function(e){return this.findParent(e,"plugin",4)}},{key:"findParentInItem",value:function(e,t){for(var a=0;e&&!this.hasClass(e,"item");){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(this.hasClass(e,t))return e;e=e.parentNode}}},{key:"findParent",value:function(e,t,a){try{this.PAssert(46,e,"Must pass in a valid element")}catch(o){this.reportError(o)}if(a||(a=1e3),e)for(var n=0,r=e,i=0;i<a&&r;++i,r=r.parentElement){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if("string"===typeof t?this.hasClass(r,t):r===t)return r}}},{key:"findParentID",value:function(e,t,a){try{this.PAssert(48,e,"Must pass in a valid element")}catch(o){this.reportError(o)}if(a||(a=1e4),e)for(var n=0,r=e,i=0;i<a&&r;++i,r=r.parentNode){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r.id===t)return r}}},{key:"findParentAttr",value:function(e,t,a){try{this.PAssert(49,e,"Must pass in a valid element")}catch(i){this.reportError(i)}if(e)for(var n=0,r=e;r&&r.getAttribute;r=r.parentNode){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r.getAttribute(t)===a)return r}}},{key:"prependChild",value:function(e,t){try{this.PAssert(50,e,"Must pass in a valid element")}catch(a){this.reportError(a)}try{this.PAssert(51,t,"Must pass in a valid element")}catch(a){this.reportError(a)}e.insertBefore(t,e.firstChild)}},{key:"isAttachedToDoc",value:function(e){try{this.PAssert(52,e,"Must supply a valid element to check")}catch(t){this.reportError(t)}try{this.PAssert(53,e.ownerDocument,"Checked element must have a valid owner document")}catch(t){this.reportError(t)}return!!e.ownerDocument&&(e.ownerDocument.body.contains(e)||e.ownerDocument.documentElement===e)}},{key:"offset",value:function(e){try{this.PAssert(54,e,"Must pass in a valid element")}catch(i){this.reportError(i)}var t=e.getBoundingClientRect(),a=e.ownerDocument,n=e.ownerDocument.documentElement,r=a.defaultView;return{top:t.top+r.pageYOffset-n.clientTop,left:t.left+r.pageXOffset-n.clientLeft,bottom:t.bottom+r.pageYOffset-n.clientTop,right:t.right+r.pageXOffset-n.clientLeft}}},{key:"position",value:function(e){var t=e.offsetParent,a=e.getBoundingClientRect(),n=t.getBoundingClientRect();return{left:a.left-n.left,top:a.top-n.top}}},{key:"height",value:function(e){try{this.PAssert(56,e,"Must pass in a valid element")}catch(n){this.reportError(n)}var t=e.offsetHeight,a=window.getComputedStyle(e);return a?("border-box"!==a.boxSizing&&(t-=parseFloat(a.paddingTop)+parseFloat(a.paddingBottom)),t-=parseFloat(a.borderTopWidth)+parseFloat(a.borderBottomWidth)):this.shouldLog(D.a.LogLevels.Error)&&this.log("GetComputedStyle failed in globals::height"),t}},{key:"width",value:function(e){try{this.PAssert(58,e,"Must pass in a valid element")}catch(n){this.reportError(n)}var t=e.offsetWidth,a=window.getComputedStyle(e);return a?("border-box"!==a.boxSizing&&(t-=parseFloat(a.paddingLeft)+parseFloat(a.paddingRight)),t-=parseFloat(a.borderLeftWidth)+parseFloat(a.borderRightWidth)):this.shouldLog(D.a.LogLevels.Error)&&this.log("GetComputedStyle failed in globals::width"),t}},{key:"wrapXHR",value:function(){try{var e=window,t=e.XMLHttpRequest.prototype.open,a=e.XMLHttpRequest.prototype.send,n=this;e.XMLHttpRequest.prototype.open=function(e,a,r,i,o){this.url=a,void 0===r&&(r=!0);try{t.call(this,e,a,r,i,o)}catch(s){throw n.reportError(s),s}},e.XMLHttpRequest.prototype.send=function(e){this.timeout||(this.timeout=n.seconds(70));try{this.url&&!this.url.startsWith("https://nikkomsgchannel")&&a.call(this,e)}catch(t){throw n.reportError(t),t}}}catch(r){this.reportError(r)}}},{key:"element",value:function(e){try{this.PAssert(60,e,"Tried to get an element without an id")}catch(t){this.reportError(t)}return document.getElementById(e)}},{key:"openUrl",value:function(e,t,a){var n=this;try{this.PAssert(61,e,"Must always provide a valid URL to open")}catch(c){this.reportError(c)}if(!e)return!1;var r="/"===e[0]||e.indexOf("://")>0||e.startsWith("tel:")||e.startsWith("mailto:");e=r?e:"http://"+e;var i=this.getToolbox(),o=this.parseEvernoteLink(e);if(o){var s=!!i&&i.settings.openEvernoteApp.get();if(void 0===s)return void i.menus.confirm("Open Evernote links in Evernote app?",(function(r){i&&i.settings.openEvernoteApp.set(r),n.openUrl(e,t,a)}));s&&(e=o.viewUrl?o.viewUrl:"evernote:///view/"+o.userId+"/"+o.shardId+"/"+o.noteGuid+"/"+o.noteGuid+"/")}if(I.a.standalone){var l=document.createElement("a");l.setAttribute("href",e),l.setAttribute("target","_blank"),l.setAttribute("rel","noopener noreferrer");var u=document.createEvent("HTMLEvents");u.initEvent("click",!0,!0),l.dispatchEvent(u)}else if(I.a.app){try{this.PAssert(63,!1,"Should not open URL in globals on mobile")}catch(c){this.reportError(c)}I.a.isChrome||!e.startsWith("http://")&&!e.startsWith("https://")?e.startsWith("/")&&(e=window.location.host+e):e=e.replace("http://","").replace("https://",""),e.startsWith("callto:")&&(e=e.replace("callto:","tel:")),i.nativeBridge.sendToApp("openURL",e),t&&(this.preventAndStop(t),t.returnFalse=!0)}else(a=a||e.startsWith("evernote:///")||e.startsWith("onenote:")||e.startsWith("bear:"))?open(e,"_self"):open(e,"_blank");return!0}},{key:"getLocationOrigin",value:function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}},{key:"isSpellcheckEnabled",value:function(){return!1}},{key:"fFalse",value:function(){return!1}},{key:"fTrue",value:function(){return!0}},{key:"toFileSize",value:function(e){if(e){var t=Math.log(e)/Math.log(1024)|0;return(e/Math.pow(1024,t)).toFixed(2)+" "+(0===t?"bytes":"KMGTPEZY"[t-1]+"B")}return null}},{key:"saveFile",value:function(e,t){var a=new Blob([e],{type:"text/plain;charset=utf-8"});Object(P.saveAs)(a,t)}},{key:"downloadFile",value:function(e,t){var a=this.getToolbox();if(I.a.supportsNativeDownload())a.ElectronBridge.downloadFile(e,t);else if(document.createEvent){var n=document.createElement("a");n.href=e;var r=document.createEvent("MouseEvents");r.initEvent("click",!0,!0),n.dispatchEvent(r)}else window.open(e,"_this")}},{key:"printPage",value:function(e){I.a.app||window.open(e).print()}},{key:"getItemForElement",value:function(e){var t=this.getPaneObjectForElement(e),a=t&&(this.isVMLI(t)?t:t.item);try{this.PAssert(64,!a||this.isVMLI(a),"Must always find a valid VMLI for a given element: "+this.elementToString(e))}catch(n){this.reportError(n)}if(a)return a}},{key:"getIndexForElement",value:function(e){var t=this.getPaneObjectForElement(e);return null===t||void 0===t?void 0:t.index}},{key:"getPaneForElement",value:function(e){var t=this.getPaneObjectForElement(e);return t?null===t||void 0===t?void 0:t.pane:this.getPropFromFiberNode(e,"pane")}},{key:"getPaneObjectForElement",value:function(e){var t=this.getPropFromFiberNode(e,"paneObject");if(t)return t}},{key:"getPropFromFiberNode",value:function(e,t){var a,n=0,r=e;for((null===(a=r)||void 0===a?void 0:a.nodeType)===Node.TEXT_NODE&&(r=r.parentElement);r&&r!==document;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r)for(var i in r)if(i.startsWith("__reactInternalInstance$")){var o=r[i];if(o){var s,l,u=null===o||void 0===o||null===(s=o.child)||void 0===s||null===(l=s.pendingProps)||void 0===l?void 0:l[t];if(!u)for(var c=0,d=o,h=o.return;h&&!u&&h!==d;){var f;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;u=null===(f=h.pendingProps)||void 0===f?void 0:f[t],h=h.return}if(u)return u}break}r=r.parentElement}}},{key:"btoa",value:function(e){return window.btoa(e)}},{key:"atob",value:function(e){return window.atob(e)}},{key:"elementFromPoint",value:function(e,t){return document.elementFromPoint(e,t)}},{key:"parentTextForItem",value:function(e){for(var t=0,a=e.parents(),n="",r=1;r<a.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r>1&&(n+="  |  "),n+=a[r].generateTitleText()}return n}},{key:"batchRenderUpdates",value:function(e,t){return A.a.unstable_batchedUpdates(e,t)}},{key:"hexToRgb",value:function(e){return{r:parseInt(e.substr(1,2),16),g:parseInt(e.substr(3,2),16),b:parseInt(e.substr(5,2),16)}}},{key:"hexToRgbStr",value:function(e){var t=this.hexToRgb(e);return t.r+","+t.g+","+t.b}},{key:"rgbToHex",value:function(e,t,a){return[this.pad2(Math.round(e).toString(16)),this.pad2(Math.round(t).toString(16)),this.pad2(Math.round(a).toString(16))].join("")}},{key:"infLoop",value:function(e){if(!this.timeLastLoop||e<this.numLastLoop)this.timeLastLoop=Date.now();else if(e>this.numLastLoop&&e>3e4&&e%200===0&&Date.now()-this.timeLastLoop>1e4){0;try{this.PAssert(65,!1,"Infinite loop!",e)}catch(a){this.reportError(a)}var t=this.getToolbox();return t.toasts&&t.toasts.pushMessage(D.a.MessageID.ReactError),!0}this.numLastLoop=e}},{key:"XHR_PrivateAPI",value:function(e){var t=I.a.getDeployVar(D.a.DeployVariable.APIHost);e.url="https:".concat(t).concat(e.path),this.XHR(e)}},{key:"getRollbarData",value:function(){return{url:this.sanitizeURL(window.location.href),jsVersion:D.a.jsVersion,htmlVersion:document&&document.body?document.body.getAttribute("ver"):"UNKNOWN"}}},{key:"sendRollbar",value:function(e,t,a){window.Rollbar&&(a===D.a.LogLevels.Error?(Rollbar.error(e,t),this.sendEvent("ErrorReport","Error")):a===D.a.LogLevels.Warning?(Rollbar.warning(e,t),this.sendEvent("ErrorReport","Warning")):(Rollbar.error(e,t),this.sendEvent("ErrorReport","Unknown")))}},{key:"textToJSONPromise",value:function(e){try{return Promise.resolve(JSON.parse(e))}catch(t){}}},{key:"textToTextPromise",value:function(e){return Promise.resolve(e)}},{key:"XHR",value:function(){var e=o()(r.a.mark((function e(t){var a,n,i,o,s,l,u,c,d,h,f=this;return r.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:a=t.url,n=t.type,i=t.data,o=t.headers,s=t.autoRetry,l=t.timeout,u=t.maxRetries,c=t.username,d=t.password,h=this;try{h.PAssert(66,a,"Must specify a valid URL to use")}catch(p){h.reportError(p)}try{h.PAssert(67,n,"Must specify a valid request type")}catch(p){h.reportError(p)}return e.abrupt("return",new Promise((function(e){var t=0;u=Math.min(u||2,6),f.notifyStatsXHRRequest(a);var r=function(){try{h.PAssert(68,t<u,"Should not be calling retry once retries have been exhausted")}catch(p){h.reportError(p)}t<u?(t++,f.notifyStatsXHRRetry(a),setTimeout(g,1e3*X[t])):(f.notifyStatsXHRFailure(a),f.reportError(new Error("XHR Failed: "+a)))},g=function(){var h,p=new XMLHttpRequest;(void 0===l||isNaN(l)||(p.timeout=l),p.onreadystatechange=function(){if(4===p.readyState){var n=p;n.json=f.textToJSONPromise.bind(f,p.response),n.text=f.textToTextPromise.bind(f,p.response),200!==p.status?t<u?(p.retry=r,s&&Q.indexOf(p.status)>=0?p.retry():e(n)):(f.notifyStatsXHRFailure(a),e(n)):(f.notifyStatsXHRSuccess(a),e(n))}},c&&d?p.open(n.toUpperCase(),a,!0,c,d):p.open(n.toUpperCase(),a,!0),o&&Object.keys(o).forEach((function(e){return p.setRequestHeader(e,o[e])})),i)?(p.setRequestHeader("Accept","*/*"),o&&o["Content-Type"]||p.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),h=i instanceof Blob?i:f.generateQueryString(i),p.send(h)):p.send()};g()})));case 5:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"scheduleIdleTask",value:function(e){setTimeout(e,100)}},{key:"getReactChildByKey",value:function(e,t){var a;return C.a.Children.forEach(e,(function(e){e&&e.key===t&&(a=e)})),a}},{key:"onMouseMoveUp",value:function(e,t){document.addEventListener("mousemove",e),document.addEventListener("mouseup",(function a(n){t(n),document.removeEventListener("mousemove",e),document.removeEventListener("mouseup",a)}))}},{key:"createStyles",value:function(e){return e}},{key:"enforceBodyScroll",value:function(){var e=this;this._enforceBodyScroll(),requestAnimationFrame((function(){e._enforceBodyScroll(),requestAnimationFrame((function(){e._enforceBodyScroll()}))}))}},{key:"_enforceBodyScroll",value:function(){document.body.scrollTop=0,document.documentElement.scrollTop=0;var e=document.getElementById("container");e&&(e.scrollTop=0)}}]),n}(G),w()(B.prototype,"onWindowError",[S.a],Object.getOwnPropertyDescriptor(B.prototype,"onWindowError"),B.prototype),w()(B.prototype,"performRepeatScrollPane",[S.a],Object.getOwnPropertyDescriptor(B.prototype,"performRepeatScrollPane"),B.prototype),w()(B.prototype,"performRepeatScroll",[S.a],Object.getOwnPropertyDescriptor(B.prototype,"performRepeatScroll"),B.prototype),w()(B.prototype,"preventAndStop",[S.a],Object.getOwnPropertyDescriptor(B.prototype,"preventAndStop"),B.prototype),w()(B.prototype,"preventDefault",[S.a],Object.getOwnPropertyDescriptor(B.prototype,"preventDefault"),B.prototype),w()(B.prototype,"stopPropagation",[S.a],Object.getOwnPropertyDescriptor(B.prototype,"stopPropagation"),B.prototype),w()(B.prototype,"infLoop",[S.a],Object.getOwnPropertyDescriptor(B.prototype,"infLoop"),B.prototype),B),Z=t.default=new J},,function(e,t,a){"use strict";var n,r=a(38),i=a.n(r);Error.stackTraceLimit=1/0;var o={ScrollLock:3,Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,NumLock:19,CapsLock:20,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,ArrowLeft:37,ArrowUp:38,ArrowRight:39,ArrowDown:40,Insert:45,Delete:46,D0:48,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,Colon:58,LAngle:60,RAngle:62,At:64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,ContextMenu:93,Numpad0:96,Numpad1:97,Numpad2:98,Numpad3:99,Numpad4:100,Numpad5:101,Numpad6:102,Numpad7:103,Numpad8:104,Numpad9:105,NumpadMultiply:106,NumPlus:107,NumpadAdd:107,Minus:109,NumpadSubtract:109,NumpadDecimal:110,NumpadDivide:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,F13:124,F14:125,F15:126,F16:127,F17:128,F18:129,F19:130,F20:131,F21:132,F22:133,F23:134,F24:135,VolumeMute:181,VolumeDown:182,VolumeUp:183,Semicolon:186,Equal:187,Plus:187,Comma:188,Dash:189,Period:190,Slash:191,Tilde:192,BracketLeft:219,Backslash:220,BracketRight:221,Quote:222,Backquote:229},s={CarriageReturn:10},l={};Object.keys(s).forEach((function(e){return l[e]=String.fromCharCode(s[e])}));var u={None:0,Note:32,Archived:128,Complete:4096,P2:8192,P1:16384,P0:32768,Starred:65536,HasPageToken:131072,DisplayComplete:262144},c={Calendar:"https://www.googleapis.com/auth/calendar",CalendarRO:"https://www.googleapis.com/auth/calendar.readonly",Contacts:"https://www.googleapis.com/auth/contacts.readonly",Drive:"https://www.googleapis.com/auth/drive.file",DriveMetadataRO:"https://www.googleapis.com/auth/drive.metadata.readonly",DriveFull:"https://www.googleapis.com/auth/drive",DriveReadOnly:"https://www.googleapis.com/auth/drive.readonly",GmailCompose:"https://www.googleapis.com/auth/gmail.compose",GmailModify:"https://www.googleapis.com/auth/gmail.modify",TasksRO:"https://www.googleapis.com/auth/tasks.readonly",UserInfoEmail:"https://www.googleapis.com/auth/userinfo.email",UserInfoProfile:"https://www.googleapis.com/auth/userinfo.profile",DriveAppData:"https://www.googleapis.com/auth/drive.appdata",Plus:"",DriveInstall:"https://www.googleapis.com/auth/drive.install",Email:"email",Profile:"Profile"},d="api.moo.do",h="https://".concat(d),f="597847337936-8oiuh4nlenctu9bpginvqq768g32apkt",p={FirebaseAppID:"597847337936",FirebaseProjectID:"api-project-597847337936",APIKey:"AIzaSyCgYrT1vXClB5Y9lRl0iOTtM4W4aBvLn50",ClientID:"".concat(f,".apps.googleusercontent.com"),ClientIDReversed:"com.googleusercontent.apps.".concat(f),APIBaseURL:d,APIFullURL:h,CloudFunctionsURL:"".concat(h,"/appapi/1/"),EmailOpenTime:250,ItemTransitionTime:150,DoubleClickTime:500,EmailPreviewSizeMin:600,EmailPreviewSizeMaxFlex:800,EmailPreviewSizeMax:1200,PremiumMaxBoards:5,PremiumMaxPanes:3,ExpandedPaneWidth:400,HelpWidth:360,PaneWidthMin:200,StdPaneWidthMin:400,StdPaneWidthMax:900,PaneWidthMax:1400,OverviewWidth:260,OverviewItemHeightDesktop:26,EmailItemHeight:80,RightMenuWidth:100,TrialDuration:14,MSPerMinute:6e4,MSPerHour:36e5,MSPerDay:864e5,MSPerWeek:6048e5,DefaultEventDuration:36e5,MaxBatchSize:45,TooltipDelay:1e3,HorizScrollbarHeight:18,DesktopToolbarHeight:32,PaneHeaderButtonWidth:32,PaneHeaderButtonHeight:36,PaneHeaderButtonIconHeight:28,PaneHeadingHeightSmall:40,CalendarResizeHandleHeight:8,CalendarTimesWidth:50,DesktopMenuWidthDefault:120,DesktopMenuWidthMax:240,DesktopMenuWidthMinBig:66,DesktopMenuWidthSmall:36,RootItemName:"Home",MinEmailScale:.25,SidebarDragHandleSize:16,SearchHeight:22,PaneAddItemBoxHeight:36,DateFormat:{DMY:"dmy",DMYDot:"dmydot",MDY:"mdy",YMD:"ymd",YMDDot:"ymddot"},MatchState:{Unknown:void 0,No:0,Yes:1,Negated:2,ChildYes:3},EmailResponseMode:{None:"None",Reply:"Reply",ReplyAll:"Reply All",Forward:"Forward",Compose:"New Message"},PluginType:{Unknown:0,Storage:1,Calendar:2,Email:3},SyncResult:{Success:0,FailureOAuth:1,FailureNoWrite:2,FailureNoRead:3,FailureNetwork:4,FailureUnknown:5},Primary:{No:0,Yes:1,Either:2,Both:3,Never:4,Only:5},Shift:{No:0,Yes:1,Either:2},FavoriteGroup:{EmailRoot:1},DropEffect:{Copy:"copy",Move:"move"},HoveredID:{Plugin:"plugin",Collapser:"collapser",Checkbox:"checkbox",Bullet:"bullet"},TaskViewModesNew:["Outline","List","Calendar","-","Archived","Deleted"],PaneModesNonTask:["Email","Files","Legacy Email"],TaskViewGroups:["None","Project","Tag","Contact","Priority","Agenda","Date","Created","Modified","Completed"],TaskViewSorts:["None","Alphabetical","NumItems","Priority","Date","Created","Completed","Modified"],TaskAgendaOptions:["Today","Week","Month","All"],TaskCalendarOptions:["Day","Custom","Week","Month"],TaskViewModesPremium:{Groups_Tag:!0,Groups_Contact:!0,Groups_Priority:!0},TaskViewModeText:{Outline:"Outline",List_Flat:"Flat List",Groups_Project:"Project",Groups_Tag:"Tag",Groups_Contact:"Contact",Groups_Priority:"Priority",Agenda_Today:"Today",Agenda_Week:"Week",Agenda_Month:"Month",Agenda_All:"All",Calendar_Day:"Day",Calendar_Custom:"# Days",Calendar_Week:"Week",Calendar_Month:"Month",Archived:"Archive",Deleted:"Deleted"},TaskViewModeTextSimple:{Outline:"Outline",List_Flat:"Flat List",Groups_Project:"Projects",Groups_Tag:"Tags",Groups_Contact:"Contacts",Groups_Priority:"Priorities",Agenda_Today:"Agenda",Agenda_Week:"Agenda",Agenda_All:"Agenda",Calendar_Day:"Calendar",Calendar_Custom:"Calendar",Calendar_Week:"Calendar",Calendar_Month:"Calendar",Archived:"Archived Items",Deleted:"Deleted Items"},TaskViewModeIcon:{Outline:"icon-format_list_bulleted",List_Flat:"icon-reorder",Groups_Project:"icon-project",Groups_Tag:"icon-hash",Groups_Contact:"icon-user",Groups_Priority:"icon-exclamation",Agenda_Today:"icon-today",Agenda_Week:"icon-view-groups",Agenda_Month:"icon-reorder",Agenda_All:"icon-format_align_justify",Calendar_Day:"icon-view_carousel",Calendar_Custom:"icon-view_week",Calendar_Week:"icon-cal-week",Calendar_Month:"icon-view_comfy",Archived:"icon-inbox",Deleted:"icon-delete"},TaskSortModeText:{None:"None",Alphabetical:"A-Z",NumItems:"# Items",Priority:"!!!",Date:"Date",Created:"Created",Completed:"Completed",Modified:"Modified"},DocumentSortMode:{Alphabetical:"Alphabetical",Modified:"Modified"},CalendarMonthViewWeekHeight:150,CalendarMonthViewMonthTitleHeight:50,CalendarMonthViewNumWeeksPad:52,CalendarDayViewNumDaysPad:364,CalendarDayViewMaxAllDayHeight:164,CalendarDayViewBlockHeight:50,CalendarMaxSyncWeeks:52,CalendarMinSyncWeeks:-52,HTTPStatusCode:{Network:0,Success:200,Created:201,PermRedirect:308,BadRequest:400,Unauthorized:401,Forbidden:403,NotFound:404,Timeout:408,Conflict:409,Gone:410,TooMany:429,ServerError:500,BadGateway:502,Unavailable:503,GatewayTimeout:504},PluginAction:{Gmail:{Archive:1,Unarchive:2,Trash:3,Untrash:4,AddLabel:5,RemoveLabel:6,Star:7,Unstar:8,MarkRead:9,MarkUnread:10,SetPriority:11,Move:12,Snooze:13,ScheduleSend:14,DiscardDraft:15}},DFormat:{LongDayTime:0,ShortDayTime:1,ShortTime:2,ShortDate:3,MonthDay:4,MonthDayYear:5,LongStrDate:6,DayYearTime:7,MonthDayYearShort:8,DayMonthDateYear:9,MonthDayLong:10,MonthDayYearLong:11,DayDate:12,NoPadShortDayTime:13,MonthDayShort:14},HelpMode:{None:0,Normal:1,Hotkeys:3},Pricing:{None:-1,EarlyMonthly:0,EarlyYearly:1,RegMonthly:2,RegYearly:3,ThreeYear:4},Analytics:{Dimensions:{PremiumStatus:"dimension1"}},Feature:{ClonePane:"clonePane",OAuth:"oauth"},GmailViewMode:{Date:"Date",Priority:"Priority"},MaxGmailSyncTime:{Premium:120,Free:5},MessageListVisibility:{Hide:"hide",Show:"show"},LabelListVisibility:{Hide:"labelHide",Show:"labelShow",ShowIfUnread:"labelShowIfUnread"},GoogleError:{FailedPrecondition:"failedPrecondition",InsufficientPermissions:"insufficientPermissions",Forbidden:"forbidden",DailyLimitExceeded:"dailyLimitExceeded",UserRateLimitExceeded:"userRateLimitExceeded",RateLimitExceeded:"rateLimitExceeded",SharingRateLimitExceeded:"sharingRateLimitExceeded",QuotaExceeded:"quotaExceeded"},GoogleErrorDomain:{UsageLimits:"usageLimits"},KeyboardToolbarHeight:44,KeyboardToolbarMode:{Item:0,Search:1,Modal:2},DocLoadSkipReason:{None:"None",Already:"Already Loading",Main:"Main Not Loaded",Drive:"Drive Not Loaded",NotAuth:"Not Authorized",LoginState:"Not Logged In"},TopBarMode:{Normal:"Normal",Multiselect:"Selected",Contact:"Contacts",Date:"Date",Tag:"Tag",Note:"Note"},ComponentDisplay:{Desktop:1,Mobile:2,Everywhere:3},RequestPriority:{Low:0,Default:50,UserBlocking:100},Orientation:{Vertical:0,Horizontal:1,Portrait:0,Landscape:1},DragDropPosition:{Above:-1,On:0,Below:1},SetMode:{Toggle:-1,No:0,Yes:1},SelectOption:{Delay:1,DoNothing:2,AllowPrefix:3},DisplayTheme:{Simple:"Classic",OutlineLight:"Light",OutlineHeavy:"Outliner",Markdown:"Markdown",SpacingCompact:"SpacingCompact",SpacingComfortable:"SpacingComfortable",PrefixesFaded:"PrefixesFaded",PrefixesStrong:"PrefixesStrong"},LocalWriteReason:{Enabled:-1,DemoMode:1,QuotaError:2,NoLocal:3,NoPermission:4,Generic:5},ConversionID:{Purchase:"ha4uCMXduXUQ6vTp0QM",Signup:"LAulCIvcuXUQ6vTp0QM"},IntroVideoID:"qE14CrQiXwc",Prefix:{Header:"#",Header2:"^",Bullet:"-",Bullet2:"*",Task:"[",Task2:"[]",Task3:"]",Task4:"[ ]",NumList:"1.",CodeBlock:"```"},InlinePrefix:{ItemLink:"[["},SearchFilterTexts:{Star:"*",Pri0:"!!!",Pri1:"!!",Pri2:"!"},MinimumTokenExpireTimeMS:6e4,MinimumTokenExpireTime:60,ToastTimeoutDefault:5e3,PrefixWidth:20,PrefixOffsetFromItem:5,PaddingAgendaTime:30,HeightAgendaParents:18,LineLeftPad:5,TextSpace:"\ufeff",TextSpaceRegexp:/\uFEFF/g,AttachChar:"\u2000",EmbedAttachChar:"\u2001",RNSpace:"\u2002",CharDate:"\ufefe",PerPaneStateField:{Element:"element",OverviewElement:"oelement",Collapsed:"collapsed",CollapsedOverview:"collapsedOverview",CollapsedSearch:"collapsedSearch"},ItemStoreFilter:{None:0,Dates:1,Contacts:2,Priority:4},NumKeys:[o.D1,o.D2,o.D3,o.D4,o.D5,o.D6,o.D7,o.D8,o.D9,o.D0],ContactPrefix:"+",TagPrefix:"#",PrefixDate:"!",PrefixItemAutocomplete:"$",KeyCode:o,KeyCodesModifiers:[o.LeftMeta,o.ContextMenu,o.Ctrl,o.Alt,o.Shift],KeyCodesArrows:[o.ArrowUp,o.ArrowDown,o.ArrowLeft,o.ArrowRight],PrivateAPIErrorCodes:{Success:0,UnknownFailure:1,Unexpected:2,DatabaseReadError:3,DatabaseWriteError:4,MissingParameter:5,InvalidParameter:6,UnauthorizedUser:7,ErrorSendingEmail:8,AlreadyReferred:9,ErrorContactingRemote:10,BraintreeUnknown:11,InvalidToken:12,InvalidReferralCode:13,NoSignupFound:14,TrialOver:15,RemoteServerError:16,TokenMissing:17,BraintreePaypalBlock:18,BraintreeInvalidCCN:19,AlreadyExists:20,DomainPolicy:21,InvalidCode:22,RejectedEmail:23,AlreadyPremium:24,MissingIDToken:25},SearchDates:{Overdue:"@overdue",Before:"before:",After:"after:",Date:"date:",Between:"between:"},Regexp:{MDLink:/(!?)\[([^\[]*)\]\(([^\s\)]+)(\s=\d{0,3}x)?(?=\))\)/g,Prefix:/^(```[A-Za-z]*|\#+|\^|\-|\*|\[(?: ?\])?|\]|[0-9]+\.) /gi,HR:/^(?:(\#+|\^|\-|\*|\[(?: ?\])?|\]|\((?: ?\))?|\)|\+|[0-9]+\.) )?(-{3,})$/gi,Interlink:/\[\[([\w|~|-]*)\]\]/g,InterlinkWithText:/\[\[([\w|~|-]*)(?:[^\[\]]*)\]\]/g,MDFormat:/[*_~`]/g,DataImage:/(?:!?(?:\[\]\()?)(data:image\/(?:[a-zA-Z]*);base64,(?:[^\"\)\s]*))(\s=\d{0,3}x)?(?:\)?)/gi},DefaultBackupFrequency:36e5,DriveFolder:{Root:"root",Attach:"attach",Backup:"backup"},CrudActions:{Added:"Added",Modified:"Modified",Removed:"Removed"},TestDocName:"demo",LocalStoreMode:{Mirror:"mirror"},LogLevels:{Off:0,Error:1,Warning:2,Timing:4,Data:8,Status:16,Search:32,Timeline:64,Input:128,Tracker:256,Profile:512,PageLoad:1024,Toolbar:2048,Picker:4096,Intro:8192,Import:16384,Version:32768,Settings:65536,Selection:131072,Edit:262144,NativeAuth:524288,DateRoll:1048576,DebugDOM:2097152,RepeatDate:4194304,Connection:8388608,Plugin:16777216,Folders:33554432,Verbose:67108864,Account:134217728,React:268435456,Autocomplete:536870912,Compose:1073741824},URLPart:{Search:1,Hash:2},PremiumStatus:{Unknown:0,Never:1,Trial:2,TrialOver:3,Active:4,PastDue:5,CanceledUser:6,CanceledPastDue:7},UninitializedVersion:-1,DETAILED_STATS:!1,DEBUG_DATE:!1,OAuthSchemeType:{Invalid:-1,None:0,Web:1,Native:2,Count:2},RepeatFreq:{Once:0,Daily:1,Weekly:2,Monthly:3,DayOfMonth:4,Yearly:5,EndOfMonthOffset:6,NthMonthInst:7},ChangeType:{None:0,Local:1,Remote:2,Auto:4,Structure:33554432,Text:67108864,Property:134217728,UndoRedo:2097152,PluginLoad:4194304,ItemLoad:8388608,DocLoad:65536,Locations:7,All:234881024,AllLocal:234881025,AllRemote:234881026,Valid:250675207},DataChangeType:{Add:1,Remove:2,Change:3},VMLIFlag:u,VersionType:{Structure:1,Text:2},SearchResultStatus:{Done:1,TooMany:2,None:3,Error:4},PaneMode:{Task:"PaneTask",Archived:"PaneArchived",Drive:"PaneDrive",Gmail:"PaneGmail",Inbox:"PaneInbox"},LoadState:{Connecting:0,NeedPassword:1,LoadingDocs:2,Connected:3},LoginState:{NONE:0,LOGGED_OUT:1,LOGGED_IN:2},ButtonCode:{None:-1,Left:0,Middle:1,Right:2},Direction:{Up:-1,None:0,Down:1},MessageAction:{Default:0,Reload:1,LoginScreen:2,Demo:3,ResetClient:4,None:5,SyncContacts:6,OpenURL:7,Okay:8,Blog:9,Undo:10,Contact:11,OpenSettings:12,OpenAccountSettings:13,OpenGoogleDrive:14,OpenDisplaySettings:15,StartDemo:16,OpenGeneralSettings:18,OpenCalendarSettings:19},MessageType:{Info:0,Warning:1,Error:2,Fatal:3,Subtitle:4,Intro:5,RequiredUpdate:6,InfoGray:7},MessageID:{Undefined:0,ConnectionError:1,OfflineUndo:2,FatalError:3,DocChange:4,OfflineWarn:5,OnlineInfo:6,CacheReset:7,RequiredUpdate:8,Updated:9,SyncContacts:10,ExitDemo:11,Reauthorize:12,ShareFailure:13,ThisIsDemo:14,MailbirdClick:15,InviteFailure:16,InviteSuccess:17,PremiumRequired:18,TrialOver:19,TrialEndSoon:20,DisabledFolderDrop:21,WarnLargeFile:22,InviteInvalid:23,NoSharingWarning:24,LostPermission:25,CalendarSync:26,EmailSendFail:28,EmailUpdateFail:29,EmailLabelFail:30,EmailSyncFail:31,DemoPluginClick:33,PromptScriptStart:34,SnoozeOffline:35,NeedDrivePermission:36,LostLinked:38,GmailDisabled:39,LocalWritesDisabled:40,FlatSearchMultiSelect:43,FlatSearchTab:45,ReadOnlyCalendar:46,CalendarSaveFail:47,QuotaError:48,ReselectEmail:49,ReactError:50,PaneLoadTimeout:51,SetupGmailViews:52,GmailViewsNeedSignin:53},SaveFlag:{None:0,Prop:1,Text:2,All:3},DateType:{Once:1,Repeat:2},StorageType:{InMemory:1,LocalStorage:2,IndexedDB:3},DataSource:{Paste:1,Drop:2,Plugin:3},PluginID:{Date:"Date",Moodo:"Moodo",Contacts:"Contacts",Drive:"Drive",Mailbird:"Mailbird",Gmail:"Gmail",GCalendar:"GCalendar",Email:"Email"},PluginNames:{Date:"Date",Moodo:"Moodo",Contacts:"Google Contacts",Drive:"Google Drive",Mailbird:"Mailbird",Gmail:"Gmail",GCalendar:"Google Calendar",Email:"Email"},PluginSettingsID:{Date:{IsEnabled:"isEnabled"},Moodo:{IsEnabled:"isEnabled"},Mailbird:{IsEnabled:"isEnabled"},Gmail:{IsEnabled:"isEnabled",ArchiveOnSchedule:"archiveOnSchedule",ArchiveOnOrganize:"archiveOnOrganize",InsertSignatureAboveReplies:"insertSignatureAboveReplies",SyncTime:"syncTime",SyncAccounts:"syncAccounts"},Drive:{IsEnabled:"isEnabled",LastChangeId:"lastChangeId",DriveRootId:"driveRootId"},GCalendar:{IsEnabled:"isEnabled",ImportCalendars:"importCalendars",ExportCalendar:"exportCalendar",WeeksPast:"weeksPast",WeeksFuture:"weeksFuture",DisplayOverdueInAgenda:"displayOverdueInAgenda",SyncNewEvents:"syncNewEvents",SyncDraggedEvents:"syncDraggedEvents",CreateLocalEvents:"createLocalEvents",SyncPopup:"syncPopup"}},PluginLoad:{None:0,Preview:1,Full:2,Runtime:4,Autocomplete:8,Inline:16},PluginDependency:{DemoMode:"DemoMode",PremiumSub:"PremiumSub",EarlyAccess:"EarlyAccess"},PluginRenderTypes:{Generic:0,StyledText:1,UnstyledText:2,Measure:3,RichText:4},Modals:{ReportBug:"reportBug",ImportData:"importData",ExportData:"exportData",ShareDoc:"shareDoc",MobileSettings:"mobileSettings",Settings:"settings",Confirm:"confirm",Alert:"alert",Options:"options",Billing:"billing",DeleteAccount:"deleteAccount",EmailPreview:"emailPreview",ReportProblem:"reportProblem",EmailCompose:"emailCompose",EmailReply:"emailReply",Invoices:"invoices",Prompt:"prompt",Lightbox:"lightbox",EnterCode:"enterCode",Backups:"backups",ConfirmEncrypt:"confirmEncrypt",Date:"date",Note:"note",AutocompleteList:"autocompleteList",Contact:"contact",ExternalLink:"ExternalLink",DropBucket:"dropBucket",ModalPane:"modalPane",ModalAccountSettings:"accountSettings",ErrorCookies:"ErrorCookies",CreateTemplate:"CreateTemplate",ItemEditor:"ItemEditor",About:"About",GmailAuth:"GmailAuth",OutlookAuth:"OutlookAuth"},DisplayMode:{Default:0,InIframe:1,NoBoards:2,Invisible:4,NoScrollbars:8,NoBackground:16,ShowHelp:64,NoPanePadding:128,NoPaneStyle:256,NoRightClick:512,ShowDemoExit:1024,NoMinPaneSize:2048,FullMin:8191},Checkpoint:{MainRun:1,RequireLoaded:2,PageLoad:4,LocalDocLoad:8,InitData:16,DBLoaded:32,OnInitializedData:64,InitializeMain:128,LoadDefaultFile:256,DocLoadRequested:512,DocLoaded:1024,MaskRequired:2047},PlatformOS:{Unknown:0,iPhone:1,iPad:2,iPod:3,Android:4,Mac:5,Windows:6,Linux:7,ChromeOS:8},PlatformBrowser:{Unknown:0,Electron:1,Mailbird:2,Chrome:3,Firefox:4,Safari:5,IE:6,Edge:7,Opera:8},PlatformConfig:{DesktopWindows:0,DesktopMac:1,DesktopOther:2,ChromeApp:3,AndroidBrowser:4,AndroidApp:5,iOSBrowser:6,iOSApp:7,WinPhoneBrowser:8,WinPhoneApp:9,MobileOther:10,Unknown:11,EmbedDesktopApp:12,EmbedMobileApp:13,ElectronMac:14,ElectronWindows:15,ElectronUnknown:16},AppPlatform:{iOS:0,Android:1,Embed:2,Electron:3},EmbedApps:{Mailbird:"mailbird"},DeployVariable:{Environment:"Environment",APIHost:"APIHost",APIProtocol:"APIProtocol"},GScope:c,GScopeArray:[c.Calendar,c.CalendarRO,c.Contacts,c.Drive,c.DriveMetadataRO,c.DriveFull,c.DriveReadOnly,c.GmailCompose,c.GmailModify,c.TasksRO,c.UserInfoEmail,c.UserInfoProfile,c.DriveAppData,c.Plus,c.Email,c.Profile,c.DriveInstall,"openid"],ScopesDefault:[c.UserInfoEmail,c.UserInfoProfile],jsVersion:"1611757255991",__devServerURL:"##DEV_SERVER_URL##",__MAX_ERRORS_REPORTED:50,ProductName:"Moo.do",EncryptionSentinel:"MDsentinel",EncryptionKeys:{Global:"Global",UserPassword:"UserPassword"},PMask:u.P0|u.P1|u.P2,PriorityClass:(n={},i()(n,u.None," "),i()(n,u.P0," p0"),i()(n,u.P1," p1"),i()(n,u.P2," p2"),n),OverviewPaddingStart:0,OverviewPaddingIncrement:10,ColorBrand:"#0099dd",DocumentAccessRoles:{Read:0,Write:1,Admin:2},Colors:{Brand:"#0099dd",Red:"#C9302C",P0:"#f30",P1:"#fa0",P2:"#fc3",Star:"#ffb",Complete:"#d6d6d6",Mobile:{Header:"#f6f6f6"}},SPThresholdRight:42,ItemPaddingRightVirtuoso:30,ItemPaddingRightVirtuosoAgenda:50,PluginPad:8,MinItemWidth:50,ModalMaxWidthPerc:90,ModalMaxHeightPerc:85,RegexpFlags:{WebUrl:1,MDLink:2,Date:4,Markdown:8,HR:16,Email:32,Contact:64,Tag:128,ItemLink:256,Plugin:512,Prefix:1024,FileUrl:2048,MarkdownEscaped:4096,DataImage:8192,All:16383},MobileItemIndentStart:10,OverviewItemHeightMobile:36,CollapserWidth:36,WidthAgendaTime:70,Markdown:{bold:"**",italic:"*",underline:"__",strike:"~~",code:"`"},TransitionSpring:{type:"spring",duration:.4,bounce:.21},TransitionSpring2:{type:"spring",duration:.3,bounce:.21},TransitionSpring3:{type:"spring",duration:.25,bounce:.21},TransitionSpring4:{type:"spring",duration:.2,bounce:.21},TransitionSpring5:{type:"spring",duration:.15,bounce:.21},TransitionSpring6:{type:"spring",duration:.1,bounce:.21},TransitionSpring7:{type:"spring",duration:.05,bounce:.21},TransitionSpringFastestest:{type:"spring",damping:200,stiffness:4e3},TransitionSpringFastest:{type:"spring",damping:56,stiffness:1e3},TransitionSpringFaster:{type:"spring",damping:40,stiffness:600},TransitionSpringFast:{type:"spring",duration:.3,bounce:.21},TransitionSpringMediumer:{type:"spring",damping:30,stiffness:500},TransitionSpringMedium:{type:"spring",damping:25,stiffness:400},TransitionSpringSlow:{type:"spring",damping:20,stiffness:400},TransitionSpringSlower:{type:"spring",damping:15,stiffness:400},TransitionTime:{duration:1},TransitionImmediate:{duration:0},PaddingTopBlockHeader:32,TopBoxHeight:36,TextPaddingLeft:5,SizeReductionInlineCode:2,ListOverscan:300,Mobile:{TopBarHeight:48,BottomBarHeight:48},CharCode:s,Chars:l,ItemClass:"itemInPane itemNew paneItemElement",KeyboardToolbarButtonHeight:36};t.a=p},,function(e,t,a){"use strict";a.r(t);var n,r=a(7),i=a.n(r),o=a(8),s=a.n(o),l=a(24),u=a.n(l),c=a(20),d=a.n(c),h=a(21),f=a.n(h),p=a(13),g=a.n(p),m=a(0),v=a(161),y=a(2),k=a(10),_=a.n(k),b=a(11),w=a(9),S=a(32),D=a(93),P=a(15),I=a(83);function E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var C,x,A={Desktop:{noteLineHeight:18,notePadding:0,noteFontSize:12,grayscale:!1,boldHeaders:!1,fontSize:14,showVerticalLines:!0,verticalLinesOpacity:6,font:"",fontWeight:"normal",Colors:{light:{prefixColor:"#222222",verticalLinesColor:32,tagColor:"#0099DD",dateColor:"#AA3300",contactColor:"#22AA66",linkColor:"#3333BB",calendarLinesColor:"#E6E6E6"},dark:{prefixColor:"#F6F6F6",verticalLinesColor:255,tagColor:"#0099DD",dateColor:"#C9302C",contactColor:"#00AF4A",linkColor:"#539bd8",calendarLinesColor:"#444444"}}}},T=(n=function(e){d()(a,e);var t=E(a);function a(){var e;return i()(this,a),(e=t.call(this)).styles={},e.stylesheet={},e._paddingsForLevel={},e.isOpen=new P.a,e.systemColorTheme=new P.a,e._fontSize=new P.a,e._fontSizeHeader=new P.a,e._fontSizeHeaderTopLevel=new P.a,e._noteFontSize=new P.a,e._itemPadding=new P.a,e._notePadding=new P.a,e._itemLineHeight=new P.a,e._noteLineHeight=new P.a,e._itemIndentSize=new P.a,e._font=new P.a(void 0,e._onFontChange),e._fontWeight=new P.a,e._boldHeaders=new P.a,e._fontSizeCodeBlock=new I.a([e._fontSize],(function(e){return e-2})),e.isPrinting=new P.a(!1),e.Themes={SpacingCompact:{itemLineHeight:18,itemPadding:3,itemIndentSize:20,fontSizeHeader:16,fontSizeHeaderTopLevel:16},SpacingComfortable:{itemLineHeight:18,itemPadding:5,itemIndentSize:30,fontSizeHeader:16,fontSizeHeaderTopLevel:18},PrefixesFaded:{projectOpacity:30,numListOpacity:30,collapserOpacity:20,bulletOpacity:30,checkboxOpacity:25,checkboxBackgroundOpacity:0},PrefixesStrong:{projectOpacity:80,numListOpacity:80,collapserOpacity:80,bulletOpacity:80,checkboxOpacity:80,checkboxBackgroundOpacity:20}},w.a.app?bo.settings.ui.themeMobile.listen((function(){S.a.setColorTheme(e.getColorTheme())})):(e.timeoutSettingChanged=void 0,e.hookMediaQuery("(prefers-color-scheme: dark)",(function(t,a){a?e.systemColorTheme.set(t?"dark":"light"):e.setSystemDarkMode(t)}))),e.hookPrinting(),e}return s()(a,[{key:"init",value:function(){this.updateSettingValues(),bo.settings.ui.listen(this.onSettingChanged),this.updateStyles()}},{key:"hookMediaQuery",value:function(e,t){var a=window.matchMedia(e);if(a){t(a.matches,!0);var n=function(e){t(e.matches,!1)};a.addEventListener?a.addEventListener("change",n):a.addListener&&a.addListener((function(e){"change"===e.type&&n(e)}))}}},{key:"hookPrinting",value:function(){var e=this;this.hookMediaQuery("print",(function(t){e.isPrinting.set(t),e._updateColorTheme(t?"light":e.getColorTheme())}))}},{key:"getSettingValue",value:function(e){var t=bo.settings.ui[e].get();return t===A.Desktop.Colors.light[e]?A.Desktop.Colors[this._colorTheme][e]:t}},{key:"getThemeValue",value:function(e){var t=this.Themes.SpacingComfortable[e];return void 0===t&&(t=this.Themes.PrefixesFaded[e]),void 0===t&&(t=A.Desktop[e]),void 0===t&&(t=A.Desktop.Colors[this._colorTheme][e]),t}},{key:"setFromThemeValue",value:function(e,t){bo.settings.ui[t].set(this.getThemeValue(t))}},{key:"updateSettingValues",value:function(){try{this._colorTheme=this.getColorTheme(),m.default.isString(this._colorTheme)||(this._colorTheme="light"),this._prefixColor=A.Desktop.Colors[this._colorTheme].prefixColor,this._verticalLinesColor=A.Desktop.Colors[this._colorTheme].verticalLinesColor,this._boldHeaders.set(this.getSettingValue("boldHeaders")),this._showVerticalLines=this.getSettingValue("showVerticalLines"),this._fontSize.set(15),this._fontSizeHeader.set(16),this._fontSizeHeaderTopLevel.set(18),this._noteFontSize.set(12),this._itemPadding.set(7),this._notePadding.set(2),this._itemLineHeight.set(18),this._noteLineHeight.set(18),this._itemIndentSize.set(y.a.PrefixWidth),this._fontWeight.set("normal"),this._bulletOpacity=this.getSettingValue("bulletOpacity",!0),this._projectOpacity=this.getSettingValue("projectOpacity",!0),this._numListOpacity=this.getSettingValue("numListOpacity",!0),this._collapserOpacity=this.getSettingValue("collapserOpacity",!0),this._checkboxOpacity=this.getSettingValue("checkboxOpacity",!0),this._checkboxBackgroundOpacity=this.getSettingValue("checkboxBackgroundOpacity",!0),this._verticalLinesOpacity=this.getSettingValue("verticalLinesOpacity",!0),this._tagColor=this.getSettingValue("tagColor",!0),this._dateColor=this.getSettingValue("dateColor",!0),this._contactColor=this.getSettingValue("contactColor",!0),this._linkColor=this.getSettingValue("linkColor",!0),this._grayscale=this.getSettingValue("grayscale"),this._cursorBlink=this.getSettingValue("linkColor",!0);var e=this.getSettingValue("font",!0),t=w.a.windows&&e.w||w.a.mac&&e.m||e.l;this._font.set(t)}catch(a){}}},{key:"_onFontChange",value:function(e){var t=(w.a.windows?"w":w.a.mac&&"m")||"l";bo.settings.ui.font.setProperty(t,e)}},{key:"onSettingChanged",value:function(){this.timeoutSettingChanged||this.isChangingTheme||(this.timeoutSettingChanged=setTimeout(this._updateSettings,0))}},{key:"_updateSettings",value:function(){var e=this._fontSize.get(),t=this._fontSizeHeader.get(),a=this._fontSizeHeaderTopLevel.get(),n=this._noteFontSize;this.timeoutSettingChanged=void 0,this.updateSettingValues();var r=this._fontSize.get()!==e||this._fontSizeHeader.get()!==t||this._fontSizeHeaderTopLevel.get()!==a||this._noteFontSize!==n;this._paddingsForLevel={},this.fireEvent("settingsChanged",[r]),bo.PaneManager&&bo.PaneManager.clearPaneCaches(),this.updateStyles()}},{key:"fontSize",value:function(){return this._fontSize.get()}},{key:"fontSizeHeader",value:function(){return this._fontSizeHeader.get()}},{key:"fontSizeHeaderTopLevel",value:function(){return this._fontSizeHeaderTopLevel.get()}},{key:"fontSizeHeaderProjectView",value:function(){return 17}},{key:"noteFontSize",value:function(){return this._noteFontSize.get()}},{key:"itemPadding",value:function(){return this._itemPadding.get()}},{key:"notePadding",value:function(){return this._notePadding.get()}},{key:"itemLineHeight",value:function(){return this._itemLineHeight.get()}},{key:"noteLineHeight",value:function(){return this._noteLineHeight.get()}},{key:"itemIndentSize",value:function(){return this._itemIndentSize.get()}},{key:"itemIndentStart",value:function(){return 30}},{key:"paddingForBlockHeader",value:function(){return 0}},{key:"paddingForItemBottom",value:function(){return this.itemPadding()}},{key:"paddingForItemTop",value:function(e){var t,a=this.itemPadding();e.index>0&&e.isBlockHeader&&(a+=(null===(t=e.blockPrevious)||void 0===t?void 0:t.isCollapsed())?y.a.PaddingTopBlockHeader/4:y.a.PaddingTopBlockHeader);return a}},{key:"paddingForItemRight",value:function(e){var t,a;return(null===(t=(a=e.pane).shouldShowTime)||void 0===t?void 0:t.call(a,e))?y.a.ItemPaddingRightVirtuosoAgenda:y.a.ItemPaddingRightVirtuoso}},{key:"fontSizeForItem",value:function(e){return this.fontSizeObsForItem(e).get()}},{key:"fontSizeObsForItem",value:function(e){var t=e.item,a=e.pane;if(t.isPrefixCodeBlock())return this._fontSizeCodeBlock;if(t.isPrefixHeader()){if(a.isItemTopLevel(e))return this._fontSizeHeaderTopLevel;if(a.isViewOutline())return this._fontSizeHeader}return this._fontSize}},{key:"lineHeightForItem",value:function(e){var t=e.item,a=this.itemLineHeight()-this.fontSize();return t.isNote()?this.noteLineHeight():this.fontSizeForItem(e)+a}},{key:"boldHeaders",value:function(){return this._boldHeaders.get()}},{key:"createSheet",value:function(){var e=document.head||document.getElementsByTagName("head")[0],t=document.createElement("style");t.type="text/css",t.rel="stylesheet",e.appendChild(t),this.sheet=t.sheet}},{key:"getThemeObs",value:function(){return bo.settings.ui.themeMobile}},{key:"changeColorTheme",value:function(e){this.getThemeObs().set(e),this._updateColorTheme(e)}},{key:"_updateColorTheme",value:function(e){e!==this._colorTheme&&(this._colorTheme=e,this.updateSettingValues(),this.updateStyles(),this.fireEvent("themeChanged",[]))}},{key:"changeTheme",value:function(e,t){this.isChangingTheme=!0;var a=this.Themes[t];for(var n in a)a.hasOwnProperty(n)&&bo.settings.ui[n].set(a[n]);e.set(t),this.isChangingTheme=!1,this._updateSettings()}},{key:"updateStyles",value:function(){var e=0;if(this.sheet){var t=this.sheet.ownerNode;t.parentNode.removeChild(t)}try{m.default.PAssert(335,"light"===this._colorTheme||"dark"===this._colorTheme,"Color theme is not light or dark",this._colorTheme)}catch(k){m.default.reportError(k)}"light"!==this._colorTheme&&"dark"!==this._colorTheme&&(this._colorTheme="light"),this.createSheet();var a=[];if(this.boldHeaders()&&a.push(".item:not(.overviewItem).pHeader { font-weight: bold; }"),this._showVerticalLines){var n=this.itemIndentSize(),r=this._verticalLinesColor,i="rgba("+r+","+r+","+r+",",o=i+.01*this._verticalLinesOpacity+")",s=i+"0)";a.push(".vertLines { background: repeating-linear-gradient(to right, "+s+" 0, "+o+" 1px, "+s+" 2px, "+s+" "+n+"px) }")}a.push(".item:not(.hasNote) .line.last .itemPrefix:not(.prefixTask):before { bottom: "+this.itemPadding()+"px; }"),a.push(".item:not(.hasNote) .line.last .prefixTask:before { bottom: "+(this.itemPadding()+(this.itemLineHeight()-18)/2)+"px; }"),a.push(".item .prefixTask:before { margin-top: "+(this.itemLineHeight()-14)/2+"px; }"),a.push(".heightLineHeight { min-height: ".concat(this.itemLineHeight(),"px; }"));var l="rgba("+m.default.hexToRgbStr(this._prefixColor)+","+.01*this._bulletOpacity+")";a.push(".prefixBulletNew>div { background-color: "+l+"; }");var u="rgba("+m.default.hexToRgbStr(this._prefixColor)+","+.01*this._projectOpacity+")";a.push(".prefixHeaderNew { color: "+u+"; }");var c="rgba("+m.default.hexToRgbStr(this._prefixColor)+","+.01*this._numListOpacity+")";a.push(".prefixNumListNew { color: "+c+"; }");var d="rgba("+m.default.hexToRgbStr(this._prefixColor)+","+.01*this._collapserOpacity+")";a.push(".collapserNew { color: "+d+"; }");var h="rgba("+m.default.hexToRgbStr(this._prefixColor)+","+.01*this._checkboxOpacity+")";a.push(".prefixTaskNew>div { border-color: "+h+"; }");var f="rgba("+m.default.hexToRgbStr(this._prefixColor)+","+.01*this._checkboxBackgroundOpacity+")";a.push(".prefixTaskNew:not(.searchButton)>div { background-color: "+f+"; }"),a.push(".c-tag { color: "+this._tagColor+";}"),a.push(".c-date { color: ".concat(this._dateColor,"; }")),a.push(".c-date.syncedToCalendar { border-color: ".concat(this._dateColor," !important;}")),a.push(".c-contact { color: "+this._contactColor+";}"),a.push(".c-link, .fancyContenteditable a    { color: "+this._linkColor+";}"),a.push(".calendarDayTimes { background-image: linear-gradient(to bottom, "+A.Desktop.Colors[this._colorTheme].calendarLinesColor+" 1px, transparent 1px) !important; }");var p=this._font.get();p&&(p="San Francisco"===p?"-apple-system, BlinkMacSystemFont":'"'.concat(p,'"'),a.push(".fontPane { font-family: ".concat(p," }")));var g=this._fontWeight.get();if(g){var v=("light"===g?300:"normal"===g&&400)||"medium"===g&&500||"semibold"===g&&600||"bold"===g&&700;a.push(".fontPane { font-weight: ".concat(v," }"))}bo.settings.ui.underlineP.get()?m.default.addClass(document.body,"underlineTags"):m.default.removeClass(document.body,"underlineTags"),this._grayscale?m.default.addClass(document.body,"grayscale"):m.default.removeClass(document.body,"grayscale"),m.default.removeClass(document.body,"theme-light"),m.default.removeClass(document.body,"theme-dark"),m.default.addClass(document.body,"theme-"+this._colorTheme);for(var y=0;y<a.length;y++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.sheet.insertRule(a[y],0)}}},{key:"tagColor",value:function(){return this._tagColor}},{key:"dateColor",value:function(){return this._dateColor}},{key:"contactColor",value:function(){return this._contactColor}},{key:"noteColor",value:function(){return""}},{key:"isDark",value:function(){return"dark"===this._colorTheme}},{key:"lineItemHeight",value:function(e,t){var a;return(void 0===t||(null===(a=e.item)||void 0===a?void 0:a.isNote()))&&(t=1),this.paddingForItemTop(e)+this.paddingForItemBottom()+this.lineHeightForItem(e)*t}},{key:"getPaddingForLevel",value:function(e,t){var a=1e4*(t?1:0)+(e=Math.max(e+(t?1:0),0)),n=this._paddingsForLevel[a];return void 0===n&&(n=t?y.a.OverviewPaddingStart+e*y.a.OverviewPaddingIncrement:this.itemIndentStart()+e*this.itemIndentSize(),this._paddingsForLevel[a]=n),n}},{key:"getColorTheme",value:function(){return this.isPrinting.get()?"light":("auto"===(e=bo.settings.ui.themeMobile.get())&&(e=this.systemColorTheme.get()),e||"light");var e}},{key:"setSystemDarkMode",value:function(e){var t=e?"dark":"light";this.systemColorTheme.set(t),this._updateColorTheme(t)}}]),a}(D.a),_()(n.prototype,"_onFontChange",[b.a],Object.getOwnPropertyDescriptor(n.prototype,"_onFontChange"),n.prototype),_()(n.prototype,"onSettingChanged",[b.a],Object.getOwnPropertyDescriptor(n.prototype,"onSettingChanged"),n.prototype),_()(n.prototype,"_updateSettings",[b.a],Object.getOwnPropertyDescriptor(n.prototype,"_updateSettings"),n.prototype),_()(n.prototype,"updateStyles",[b.a],Object.getOwnPropertyDescriptor(n.prototype,"updateStyles"),n.prototype),n),M=a(162),L=a(51),O=a.n(L),R=a(3),F=a.n(R),N=a(6),B=a(70),j=a(18),U=a(72),H=a(16),V=a.n(H),W=a(125),z=a(79),q=a(17),G=a(138),K=Object(q.b)((function(e){var t,a,n,r,i,o=e.paneObject,s=e.el,l=o.item,u=s.props,c=s.getText(),d=!!u.plugin;if(u.plugin){var h=bo.pluginManager.getPluginDrive(),f=h.getAttachment(u.plugin.id);t=h.getAttachWidth(f),a=h.getAttachUrl(f),n=h.getAttachDataUrl(f),i=(r=f.isLocalOnlyAttachment())&&{background:"rgba(0,0,0,0.5)"}}else t=u.link.imageSize,a=u.link.href;var p=Object(R.useState)(t),g=V()(p,2),v=g[0],k=g[1],_=Object(R.useState)(!1),b=V()(_,2),w=b[0],S=b[1],D=Object(G.a)(),P=V()(D,2),I=P[0],E=P[1],C=Object(R.useRef)(),x=Object(R.useRef)(),A=m.default.classNames("max-w-full align-top",{mdImage:!d},{driveImage:d}),T={maxWidth:v},M=c.match(y.a.Regexp.DataImage)?void 0:c;return F.a.createElement("div",{className:"relative",style:T,ref:I},F.a.createElement("img",{className:A,src:n||a,"data-original-text":M,onLoad:function(e){var t=e.target.naturalWidth;x.current=t,v||k(t)}}),r&&F.a.createElement(z.a,{style:i,color:"#eee",center:!0},"Uploading..."),(E||w)&&F.a.createElement(W.a,{className:"mdImageResizer flexbox flexvert",onMouseDown:function(e){S(!0),m.default.preventAndStop(e),m.default.isDraggingImage=!0},onMouseMove:function(e){var t=Math.round(e.clientX-I.current.getBoundingClientRect().left);t<=x.current&&k(t),m.default.preventAndStop(e)},onMouseUp:function(){if(S(!1),m.default.isDraggingImage=!1,d){var e=bo.pluginManager.getPluginDrive(),t=e.getAttachment(u.plugin.id);e.setAttachWidth(l,t,v)}else{var a=l.elsNew.findElement(o,(function(e){return e.props.link&&e.props.link.showImage}));a&&(a.el.props.link.imageSize=v,l.setTextFromEls(y.a.ChangeType.Local))}},globalEvents:!0,ref:C}))})),Y=(C=function(){function e(){i()(this,e)}return s()(e,[{key:"onClickHandler",value:function(e,t,a){if(!N.a.hasFullSelection()||!w.a.isPriModKey(a)){var n=t.item,r=t.pane,i=e.props,o=N.a.wasSelectedBeforeThisMouseEvent(t),s=w.a.mac&&a.metaKey||!w.a.mac&&a.ctrlKey;if(i.itemLink){var l=j.a.getItem(i.itemLink);s?a.shiftKey?bo.PaneManager.clonePane(r,{item:l}):bo.menus.openModalPaneHighlightingItem({highlightItem:l}):l&&r.zoomIn(l,{showToast:!0})}else if(i.link){var u=i.link.href;o||s||!m.default.isUrlImage(u)?o&&!s||(bo.menus.openLink(u,a),m.default.preventAndStop(a)):(bo.menus.openLightbox(u),m.default.preventAndStop(a))}else if(i.contact||i.tag){var c=e.getText(),d=i.tag&&!o||s,h=a.altKey;if((d||h)&&N.a.reset(),h){bo.PaneUpdateBatcher.beginUpdateItems();var f=n.getParsedText();f=f.replace(new RegExp(c,"g"),"").replace(/  +/g," "),n.setText(f,y.a.ChangeType.Local),bo.PaneUpdateBatcher.commitUpdateItems()}else if(d)r.search.toggleText(c,a.shiftKey);else if(i.contact&&!o){var p=B.a.findMatchExact(c[0]===y.a.ContactPrefix?c.substr(1):c);p&&(bo.menus.openContact(p,a),m.default.preventAndStop(a))}}else if(i.email){if(s){var g=bo.pluginManager.getPluginGmail();if(g.isActive()){N.a.reset();var v={to:[{text:"",email:e.getText()}]};bo.menus.openComposeEmail(g,{initData:v})}}}else i.date?a.altKey?(N.a.reset(),n.setMooDate(void 0,y.a.ChangeType.Local,!0)):bo.menus.openDate({element:a.target,item:n,pane:r,paneObject:t}):i.plugin&&bo.pluginManager.handleTapClick(e,t,a)}}},{key:"renderToJSX",value:function(e,t,a){var n,r=0,i=[],o=a.noPrefix,s=a.highlightSearch,l=e.elsNew.elements,u=t&&N.a.isSelected(t);if(s)if(m.default.isString(s))n=s.split(" ").filter((function(e){return!!e}));else if(t){var c=t.pane.searchingPaneObjects.get();n=c.isSearching?c.text.split(" ").filter((function(e){return!!e})):t.pane.search.getSearchWords()}for(var d=0;d<l.length;d++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var h=l[d];if(!o||!h.props.prefixType){var f=h.getStyledText(e,a);if(f){var p=this.renderElToJSX(l,d,e,t,f,u,n,a);i.push(p)}}}return i}},{key:"renderElToJSX",value:function(e,t,n,r,i,o,s,l){var u=e[t],c=u.props,d=c.plugin||c.date;if(r&&u.isImage())return F.a.createElement(K,{key:t,paneObject:r,el:u});if(d){var h,f="mobutton "+d.displayElement.attrs.cls.join(" ");if(t>0&&(f+=" padB"),t<e.length-1&&(f+=" padA"),u.props.date&&n.isRepeatDate()&&i.includes("\u27f3")){var p=i.split("\u27f3");i=p[0],h=F.a.createElement(F.a.Fragment,null,F.a.createElement(U.a,{name:"MdLoop"}),p[1])}return F.a.createElement("span",{key:t,className:f,plugin:d.p,"plugin-id":d.id,onClick:r&&this.onClickHandler.bind(this,u,r)},F.a.createElement("span",null,i,h))}if(c.itemLink||c.link&&c.link.appLink){var g=u.getClassNames(!0);return t>0&&(g+=" padB"),t<e.length-1&&(g+=" padA"),F.a.createElement("span",{key:t,className:g,onClick:r&&this.onClickHandler.bind(this,u,r)},F.a.createElement("span",null,i))}var v=n.isPrefixCodeBlock();v&&!r&&(i=i.slice(0,Math.min(i.length,100)).replace(/\n/g," "));var k=!l.highlightSearch||v&&r?i:this.replaceTextWithSearchJSX(i,s,t),_={};c.link&&(_["data-href"]=c.link.href),c.code&&r&&(_.style={fontSize:bo.DisplaySettings.fontSizeForItem(r)-y.a.SizeReductionInlineCode});var b=!l.noFormat&&u.getClassNames(!1,o);if(b)return F.a.createElement("span",O()({key:t,className:b.trim()},_,{onClick:this.onClickHandler.bind(this,u,r)}),k);if(v&&r){var w=m.default.lazyLoad("ReactCodeBlock",(function(){return a.e(1).then(a.bind(null,339))}));return F.a.createElement(R.Suspense,{key:t,fallback:F.a.createElement("div",null,F.a.createElement("pre",null,k))},F.a.createElement(w,{paneObject:r},i))}return k}},{key:"replaceTextWithSearchJSX",value:function(e,t,a){for(var n=0,r=e.toLowerCase(),i=[],o=e.length+1,s=0;s<t.length;s++){var l=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var u=t[s],c=void 0,d=void 0;(c=r.indexOf(u,d))>=0;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(c>=0)for(var h=0,f=c;f<c+u.length;f++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;(isNaN(o)||f<o)&&(o=f),i[f]=!0}d=c+1}}if(o<=e.length){for(var p=0,g=-1,m=!0,v=e.length-1;v>=o-1;v--){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;if(g>=0&&(v<0||!i[v])){var y=e.substring(v+1,g+1),k=e.substr(g+1),_=e.substr(0,v+1);m&&(m=!1),e=_+'<span class="c-search-highlight">'+y+"</span>"+k,g=-1}i[v]&&g<0&&(g=v)}return F.a.createElement("span",{key:a,dangerouslySetInnerHTML:{__html:e}})}return e}},{key:"renderElNew",value:function(e,t,a,n,r,i){var o=e[t],s=o.props,l=s.plugin||s.date;if(l&&r&&!r.plugin&&l.displayElement.attrs.cls.includes("plugin_drive_image_inline")){var u=bo.pluginManager.getPluginDrive(),c=u.getAttachment(l.id);if(u.getAttachUrl(c))return o.getText()}else if(o.isImage()&&!s.plugin)return a||s.link.href;if(l)return this.renderPlugin(a,o,t,e.length);if(t>0&&"code"===e[0].props.prefixType)return"\n"===a[a.length-1]&&(a+=y.a.TextSpace),a;if(s.itemLink||s.link&&s.link.appLink){var d=o.getClassNames(!0),h=s.itemLink?' data-itemid="'.concat(s.itemLink,'"'):' data-href="'.concat(s.link.href,'"');return t>0&&(d+=" padB"),t<e.length-1&&(d+=" padA"),'<span class="'.concat(d,'"').concat(h,"><span>").concat(a,"</span></span>")}var f=i.highlightSearch,p=i.convertSpaces,g=i.fontSize;a=f?this.replaceTextWithSearch(a,r):m.default.escape(a),p&&(a=a&&a.replace(/ /g,"&nbsp;"));var v="";s.link&&(v=' data-href="'.concat(s.link.href,'"')),s.code&&g&&(v+=' style="font-size: '.concat(g-y.a.SizeReductionInlineCode,'px"'));var k=!i.noFormat&&o.getClassNames();return k?'<span class="'+k.trim()+'"'+v+">"+a+"</span>":a}},{key:"renderNew",value:function(e,t,a,n){for(var r=0,i=[],o=n.noPrefix,s=(n.forHiddenInput,0);s<e.length;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=e[s];if(!o||!l.props.prefixType){var u=l.getStyledText(t,n);if(u){var c=this.renderElNew(e,s,u,t,a,n);i.push(c)}}}return i.join("")}},{key:"renderPlugin",value:function(e,t,a,n){var r=t.props.plugin||t.props.date,i=r.displayElement.attrs.cls.join(" ");return a>0&&(i+=" padB"),a<n-1&&(i+=" padA"),'<span class="'.concat(i,'" plugin="').concat(r.p,'" plugin-id="').concat(r.id,'"><span>').concat(e,"</span></span>")}},{key:"replaceTextWithSearch",value:function(e,t){for(var a=0,n=t.searchingPaneObjects.get(),r=n.isSearching?n.text.split(" ").filter((function(e){return!!e})):t.search.getSearchWords(),i=e.toLowerCase(),o=[],s=e.length+1,l=0;l<r.length;l++){var u=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var c=r[l],d=void 0,h=void 0;(d=i.indexOf(c,h))>=0;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(d>=0)for(var f=0,p=d;p<d+c.length;p++){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;(isNaN(s)||p<s)&&(s=p),o[p]=!0}h=d+1}}if(s<=e.length)for(var g=0,v=-1,y=!0,k=e.length-1;k>=s-1;k--){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;if(v>=0&&(k<0||!o[k])){var _=e.substring(k+1,v+1),b=e.substr(v+1),w=e.substr(0,k+1);k===s&&(w=m.default.escape(w)),y&&(b=m.default.escape(b),y=!1),e=w+'<span class="c-search-highlight">'+m.default.escape(_)+"</span>"+b,v=-1}o[k]&&v<0&&(v=k)}else e=m.default.escape(e);return e}}]),e}(),_()(C.prototype,"renderElNew",[b.a],Object.getOwnPropertyDescriptor(C.prototype,"renderElNew"),C.prototype),C),X=a(52),Q=a.n(X),J=a(38),Z=a.n(J),$=a(35),ee=a(34),te=a(42),ae=a(81),ne=a(73);var re,ie,oe=(x=function(){function e(){i()(this,e),this.modalStack=new te.a,this.contextMenuStack=new te.a,this.emailComposeStack=new te.a}return s()(e,[{key:"openAddPaneMenu",value:function(e){e.componentName="ReactContextMenuPaneView",e.isAddPane=!0,this.openContextMenu(e)}},{key:"openContextMenu",value:function(e){e.element&&m.default.isString(e.element)&&(e.element=m.default.element(e.element)),e.element&&m.default.findParent(e.element,"desktopSidebar")&&(e.pos={left:bo.DesktopUI.getSidebarWidth()+4},e.side="right",m.default.findParent(e.element,"desktopMenuBottom")&&(e.openFromBottom=!0)),this.contextMenuStack.push(e)}},{key:"indexOfContextMenu",value:function(e){var t=this.contextMenuStack.get(),a=t.indexOfWithProperty("fn",e);return a<0&&(a=t.indexOfWithProperty("componentName",e)),a}},{key:"closeContextMenu",value:function(e,t,a){if(e){var n=this.indexOfContextMenu(e);try{m.default.PAssert(315,n>=0,"Tried to close a context menu that was not open")}catch(s){m.default.reportError(s)}if(n>=0){var r=this.contextMenuStack.get()[n];this.contextMenuStack.removeAt(n),r.onClosed&&r.onClosed(t,a)}}else{var i,o=this.contextMenuStack.pop();if(o)null===(i=o.onClosed)||void 0===i||i.call(o,!1,a)}0===this.contextMenuStack.length()&&N.a.updateCaret()}},{key:"getTopContextMenu",value:function(){var e=this.contextMenuStack.get();if(e&&e.length){var t=e[e.length-1];return t.componentName||t.fn}}},{key:"closeTopContextMenu",value:function(){var e=this.getTopContextMenu();e&&this.closeContextMenu(e)}},{key:"isAutocompleteOpen",value:function(){return this.indexOfContextMenu("ReactAutocomplete")>=0||this.indexOfContextMenu("ReactContextMenuDate")>=0}},{key:"isOnlyAutocompleteOpen",value:function(){return this.isAutocompleteOpen()&&1===this.contextMenuStack.get().length}},{key:"isContextMenuOpen",value:function(e){return e?this.indexOfContextMenu(e)>=0:this.contextMenuStack.get().length>0}},{key:"isModalOpen",value:function(e){var t=this.modalStack.get();if(!e)return t.length>0;for(var a=0,n=0;n<t.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t[n].id===e)return!0}}},{key:"openModal",value:function(e,t){try{m.default.PAssert(316,void 0===t||m.default.isObject(t),"Must always pass in a valid object for params")}catch(a){m.default.reportError(a)}if(!this.isModalOpen(e)){t=t||{};try{m.default.PAssert(317,void 0===t.id,"Should not already have an ID defined with modal params")}catch(a){m.default.reportError(a)}t.id=e,N.a.reset(),this.modalStack.push(t)}}},{key:"closeModal",value:function(e,t){var a=this.modalStack.get().indexOfWithProperty("id",e);if(a>=0){var n=this.modalStack.get()[a],r=!0;n.onClosing&&(r=n.onClosing()),r&&(this.modalStack.removeAt(a),n.callback&&n.callback(t))}}},{key:"confirm",value:function(e,t,a){return new Promise((function(a){S.b.openMenu({type:"Alert",text:e,callback:function(e){a(e),t&&t(e)}})}))}},{key:"prompt",value:function(e){var t=e.title,a=e.text,n=e.cb,r=e.value;try{m.default.PAssert(318,n,"Prompt modals should have callbacks",t)}catch(i){m.default.reportError(i)}S.b.openMenu({type:"Prompt",title:t,text:a,fields:[{value:r}],callback:function(e){return n(e?e[0]:void 0)}})}},{key:"promptComplex",value:function(e){S.b.openMenu(Object.assign(e,{type:"Prompt"}))}},{key:"alert",value:function(e){S.b.alert(e.text)}},{key:"options",value:function(e,t,a){try{m.default.PAssert(320,m.default.isArray(t),"Must have valid options array")}catch(n){m.default.reportError(n)}try{m.default.PAssert(321,a,"Options modal must have a callback")}catch(n){m.default.reportError(n)}this.openModal(y.a.Modals.Options,{text:e,options:t,callback:a})}},{key:"openSettings",value:function(e){bo.onIntroAction("SettingsMenu"),this.openModal(y.a.Modals.Settings,{section:e,onClosing:this.onClosingSettings})}},{key:"onClosingSettings",value:function(){var e=!ne.a.isSaveEnabled.get();return e||this.confirm("You have unsaved changes. Are you sure you want to cancel your changes?",function(e){e&&(ne.a.isSaveEnabled.set(!1),this.closeModal(y.a.Modals.Settings))}.bind(this)),e}},{key:"openDisplaySettings",value:function(){N.a.reset(),bo.DisplaySettings.isOpen.set(!0),bo.onIntroAction("DisplaySettings")}},{key:"getUserName",value:function(){return m.default.isDemoMode()?"Demo":$.a.getAccountName()}},{key:"_indexOfCompose",value:function(e){for(var t=0,a=this.emailComposeStack.get(),n=0;n<a.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(a[n].draftMsg.id===e)return n}return-1}},{key:"isComposeOpenForEmail",value:function(e){return e?this._indexOfCompose(e)>=0:this.emailComposeStack.length()>0}},{key:"openComposeEmail",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.threadID,r=a.messageID,i=a.initData,o=a.accountID;try{m.default.PAssert(322,e,"Must have a valid email plugin")}catch(s){m.default.reportError(s)}try{m.default.PAssert(323,!n||m.default.isString(n),"Must have a string threadID")}catch(s){m.default.reportError(s)}try{m.default.PAssert(324,!r||m.default.isString(r),"Must have a string messageID")}catch(s){m.default.reportError(s)}N.a.reset(),this.isComposeOpenForEmail()||ee.a.onLoaded((function(){var a=e.getDraftByID(o||e.getDefaultAccount(),n,r,i);try{m.default.PAssert(325,a,"Must always create a valid draft")}catch(s){m.default.reportError(s)}try{m.default.PAssert(326,t.emailComposeStack.indexOf(a)<0,"Must not double-open drafts, should re-use")}catch(s){m.default.reportError(s)}t.emailComposeStack.get().indexOfWithProperty("attach",a.attach)<0&&t.emailComposeStack.push(a)}))}},{key:"closeComposeEmail",value:function(e,t){var a=this._indexOfCompose(t.id);try{m.default.PAssert(327,a>=0,"Must have found a valid composing email to remove")}catch(n){m.default.reportError(n)}this.emailComposeStack.removeAt(a)}},{key:"openItemEditor",value:function(e){try{m.default.PAssert(328,!e.item===!!e.addOnSave,"Must be adding item if no item prop")}catch(n){m.default.reportError(n)}if(!e.item){e.parent||(e.parent=e.pane&&e.pane.type===y.a.PaneMode.Task?e.pane.getRootItem():j.a.getDefaultDocument().getRootItem());var t=j.a.createTempVMLI({text:e.text||bo.settings.getDefaultItemText(),date:e.mooDate},{changeType:y.a.ChangeType.AllLocal});e.item=t;var a=e.endSave;e.endSave=function(e){setTimeout((function(){j.a.destroyTempVMLI(t.id)}),0),a&&a(e)}}e.componentName="ReactItemDetailsPopup",this.openContextMenu(e)}},{key:"openLightbox",value:function(e,t,a){this.openModal(y.a.Modals.Lightbox,{src:e,buttonText:t,buttonAction:a})}},{key:"confirmEncrypt",value:function(e,t){this.openModal(y.a.Modals.ConfirmEncrypt,{password:e,onYes:function(){return t(!0)},onCancel:function(){return t(!1)}})}},{key:"openModalPaneHighlightingItem",value:function(e){var t=e.zoomItem,a=e.highlightItem,n=ae.a.createPane(y.a.PaneMode.Task,{id:"TEMP_Pane"+Date.now(),document:(t||a).getDocumentOwner(),item:t,rect:{left:0,right:0,width:1e3,height:1e3},viewState:{viewMode:"Outline"}});return n.init(),this.openModal(y.a.Modals.ModalPane,{pane:n,scrollToItem:a}),N.a.setFocusedPane(n),n}},{key:"getModalPanes",value:function(){return this.modalStack.get().filter((function(e){return e.id===y.a.Modals.ModalPane})).map((function(e){return e.pane}))}},{key:"openDate",value:function(e){S.b.openMenu({type:"Date",item:e.item,paneObject:e.paneObject,focused:N.a.isKeyboardOpen})}},{key:"openOptions",value:function(){this.openContextMenu({componentName:"ReactContextMenuOptions",element:m.default.element("optionsButton")})}},{key:"openItemContextMenu",value:function(e,t,a){var n=e.pane,r=e.item,i=e.index,o=(null===a||void 0===a?void 0:a.element)||n.listManager.getElementByIndex(i);this.openContextMenu(Object.assign({componentName:"ReactContextMenuItem",key:"menu"+r.id+(t||""),item:r,pane:n,paneObject:e,element:o},a))}},{key:"openContextMenuList",value:function(e,t,a,n,r,i){var o=m.default.isString(a[0]),s=a;return o&&(s=a.map((function(e){return m.default.isString(e)?{id:e,value:e}:e}))),m.default.promisify((function(t){S.b.openActionSheet({title:e,maxHeight:.8,selected:r,showCheckboxes:n,items:s.map((function(e){return{text:e.value,onPress:function(){return t(e.id)}}}))})}))}},{key:"openContact",value:function(e,t){S.b.openMenu({type:"Contact",contact:e})}},{key:"openLink",value:function(e,t){S.b.openMenu({type:"OpenUrl",element:t.target,href:e})}}]),e}(),_()(x.prototype,"onClosingSettings",[b.a],Object.getOwnPropertyDescriptor(x.prototype,"onClosingSettings"),x.prototype),x),se=a(27),le=(re=function(){function e(){i()(this,e),this.enableTempPanePosition=!1,this.totalWidth=new P.a(0),this._panesById={},this._panes=new te.a,this.displayPanes=new te.a,this.isLoading=new P.a(!0),this._isInitialStateLoaded=!1,this.animatePaneSwap=!1,this._iteratingPanes=!1,this._savedPaneState=void 0}return s()(e,[{key:"init",value:function(){}},{key:"load",value:function(){bo.settings.activeUser.get()&&this.setupInitialTimeout(),this.isLoaded||(this._panes.listen(this.updateDisplayPanes),w.a.windowSize.listen(this.onResize),se.a.listen("panesChanged",this.updateDisplayPanes),this.onResize(),this.isLoaded=!0)}},{key:"getStats",value:function(e){var t={};return void 0===e?this.runForEachPane((function(e){t[e.id]=e.getStats()})):t=this.getPaneById(e).getStats(),t}},{key:"setupInitialTimeout",value:function(){0===this._panes.length()&&(clearTimeout(this._initialTimeout),this._initialTimeout=setTimeout(this._timeoutLoadFailed.bind(this),3e4))}},{key:"notifyPanes",value:function(){this._panes.notify()}},{key:"onResize",value:function(){this.updatePaneRects()}},{key:"getNextPaneID",value:function(){return++m.default.totalPanes+"P"+Date.now()}},{key:"getAllPerPaneState",value:function(e,t){for(var a=0,n=[],r=this.paneCount(),i=0;i<r;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this.getPaneAtIndex(i);n.push(o.getPerPaneState(e,t))}return n}},{key:"setAllPerPaneState",value:function(e,t,a){for(var n=0,r=this.paneCount(),i=0;i<r;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this.getPaneAtIndex(i).setPerPaneState(e,t,a)}}},{key:"deletePerPaneState",value:function(e,t){var a=this.getPaneById(e);a&&a.deletePerPaneState(t)}},{key:"updatePaneStateForPane",value:function(e,t){try{m.default.PAssert(494,e,"Must pass in a valid pane to update")}catch(a){m.default.reportError(a)}this._isLoading||this.savePaneState(t)}},{key:"recreatePaneState",value:function(){var e=[];return this.runForEachPane((function(t){e.push(t.getSaveInfo())})),e}},{key:"isPaneActive",value:function(e){return!!this._panesById[e]}},{key:"createPaneAtIndex",value:function(e,t,a,n){try{m.default.PAssert(495,e,"Must supply a valid pane type")}catch(i){m.default.reportError(i)}try{m.default.PAssert(496,!this._iteratingPanes,"Should not change pane array while iterating")}catch(i){m.default.reportError(i)}isNaN(t)&&(t=this.paneCount()),(a=a||{}).id=a.id||this.getNextPaneID(),a.document=a.document||j.a.getDefaultDocument(),m.default.isString(a.item)&&(a.item=j.a.getItem(a.item));var r=ae.a.createPane(e,a);return r?this.addPaneAtIndex(r,t,!1,n):m.default.reportError(new Error("Invalid pane created: "+e+" | "+t)),r}},{key:"addPaneAtIndex",value:function(e,t,a,n){try{m.default.PAssert(497,e,"Must supply a valid pane")}catch(o){m.default.reportError(o)}this._panesById[e.id]&&(e.id=this.getNextPaneID());try{m.default.PAssert(498,!this._panesById[e.id],"Should never add the same pane twice")}catch(o){m.default.reportError(o)}if(this._panesById[e.id]=e,this.enableTempPanePosition&&this._panes.length()>0&&t===this._panes.length()){var r=this._panes.get()[this._panes.length()-1];this.tempPositionForNewPane={pane:r,left:r.rect.get().left}}if(isNaN(t)?this._panes.push(e,n):this._panes.splice(t,0,e,n),this._initPane(e),this.tempPositionForNewPane&&(this.tempPositionForNewPane=null,setTimeout(this.onResize.bind(this),0)),this.ensurePaneInView(e),!a){var i=this.getPaneState();isNaN(t)?i.push(e.getSaveInfo()):i.splice(t,0,e.getSaveInfo()),this.savePaneState()}}},{key:"_initPane",value:function(e){e.init(),e.isExpanded.listen(this.onResize),this._panesById[e.id]=e}},{key:"unloadPane",value:function(e){e.unload(),e.isExpanded.unlisten(this.onResize),se.a.fireEvent("paneRemoved",[e]);try{m.default.PAssert(499,this._panesById[e.id],"Should never unload a pane that does not exist")}catch(t){m.default.reportError(t)}this._panesById[e.id]=void 0,e.destroy()}},{key:"removePaneAtIndex",value:function(e,t){try{m.default.PAssert(500,!isNaN(e),"Must supply a valid index to remove from")}catch(r){m.default.reportError(r)}try{m.default.PAssert(501,!this._iteratingPanes,"Should not change pane array while iterating")}catch(r){m.default.reportError(r)}var a,n=this._panes.splice(e,1,void 0,t)[0];try{m.default.PAssert(502,n,"Must have removed a valid pane")}catch(r){m.default.reportError(r)}return this.unloadPane(n),this.getPaneState().splice(e,1),this.savePaneState(),a=n.id,this.ensurePaneInView(),a}},{key:"loadPaneFromState",value:function(e){if(e.id&&this.isPaneActive(e.id))return this._panesById[e.id];var t=e.item||e.focus,a=t&&j.a.getItem(t),n=e.document,r=j.a.getDocumentById(n);a&&a.isDeleted()&&(a=void 0);var i,o=e.type||"PaneTask",s=m.default.clone(e);return s.item=a,s.document=r,s.deferredItemID=a?void 0:t,s.offset=e.offset,s.id&&this.isPaneActive(s.id)||(i=ae.a.createPane(o,s))&&(e.id=i.id,e.showarch&&i.showArchived.set(!0),i.applyItemState(e.itemState)),i}},{key:"removeFocusedPane",value:function(){return this.removePane(m.default.focusedPane)}},{key:"removePane",value:function(e){var t=this.getPaneIndex(e);return this.removePaneAtIndex(t)}},{key:"clearPanes",value:function(e){try{m.default.PAssert(503,m.default.isDemoMode(),"Should only be clearing panes in demo mode")}catch(t){m.default.reportError(t)}N.a.setFocusedPane(void 0),this.runForEachPane((function(e){e.destroy()})),this._panesById={},this._panes.set([],e)}},{key:"clearPaneCaches",value:function(){this.runForEachPane((function(e){e.listManager.clearCache()}))}},{key:"getPaneAtIndex",value:function(e){return this._panes.get()[e]}},{key:"getPaneIndex",value:function(e){return this._panes.get().indexOf(e)}},{key:"getFocusedPaneIndex",value:function(){return this.getPaneIndex(m.default.focusedPane)}},{key:"hasPaneById",value:function(e){return!!this._panesById[e]}},{key:"getPaneById",value:function(e){try{m.default.PAssert(506,this._panesById[e],"Should never request a pane that is not currently loaded")}catch(t){m.default.reportError(t)}return this._panesById[e]}},{key:"getPaneByName",value:function(e){try{m.default.PAssert(507,this._panesByName[e],"Should never request a pane that is not currently loaded")}catch(t){m.default.reportError(t)}return this._panesByName[e]}},{key:"getPanesByType",value:function(e){for(var t=0,a=[],n=this.paneCount(),r=0;r<n;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.getPaneAtIndex(r);e&&i.type!==e||a.push(i)}return a}},{key:"paneCount",value:function(){return this._panes.get().length}},{key:"runForEachPane",value:function(e,t){var a=0;this._iteratingPanes=!0;for(var n=this._panes.get().concat(bo.menus.getModalPanes()),r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=n[r];try{m.default.PAssert(508,!i.isDestroyed(),"Should never have a destroyed pane in pane list")}catch(o){m.default.reportError(o)}if(!t||i.type===t)try{e(i)}catch(s){m.default.reportError(s)}}this._iteratingPanes=!1}},{key:"distance",value:function(e,t){return Math.abs(e-t)}},{key:"findIndex",value:function(e,t){var a=this._panes.get(),n=a.map((function(e){return e.rect.get()})),r=a.indexOf(e),i=r,o=n[i],s=o.left,l=s+o.width;if(t>0){var u=n[r+1];if(void 0===u)return r;t>this.distance(l,u.left+u.width/2)+5&&(i=r+1)}else if(t<0){var c=n[r-1];if(void 0===c)return r;var d=c.left+c.width;t<-(this.distance(s,d-c.width/2)+5)&&(i=r-1)}return m.default.clamp(i,0,n.length)}},{key:"dragPaneTo",value:function(e,t){var a,n=this._panes.get(),r=this.findIndex(e,t);if(r>=0){var i=n.indexOf(e);i!==r&&(n.splice(r,0,n.splice(i,1)[0]),this._panes.set(n),this.savePaneState(),a=!0)}return a}},{key:"movePaneTo",value:function(e,t){var a=this._panes.get(),n=a.indexOf(e);a.splice(t,0,a.splice(n,1)[0]),this._panes.set(a),this.savePaneState()}},{key:"paneSortFn",value:function(e,t){return e.uniquePaneID-t.uniquePaneID}},{key:"clearLoadTimeout",value:function(){clearTimeout(this._initialTimeout),this._initialTimeout=void 0,bo.toasts.clearMessage(y.a.MessageID.PaneLoadTimeout)}},{key:"updateDisplayPanes",value:function(){var e=0;this._initialTimeout&&this.clearLoadTimeout();for(var t=this._panes.get().slice(0).sort(this.paneSortFn),a=[],n=0;n<t.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t[n];r.isOverviewVisible()&&a.push({type:"overview",pane:r}),a.push({type:"pane",pane:r}),r.isExpanded.get()&&a.push({type:"emailPreview",pane:r})}this.updatePaneRects(),this.displayPanes.set(a),this.isLoading.set(!1)}},{key:"hasScrollbar",value:function(){return this.totalWidth.get()>w.a.windowWidth()}},{key:"onBoardChanged",value:function(){this.loadPanesFromState()}},{key:"_addPaneByButton",value:function(e,t,a,n){var r=this.createPaneAtIndex(e,void 0,{viewState:{viewMode:t},item:a});return N.a.setFocusedPane(r),r.onAdded(),r}},{key:"addPaneByButton",value:function(e,t,a){var n=ae.a.canCreatePane(e);if(!0===n)return this._addPaneByButton(e,t,a);bo.toasts.pushMessage("Cannot create pane because ".concat(n))}},{key:"emailPreviewSize",value:function(e){var t=this._panes.length()>1?y.a.EmailPreviewSizeMaxFlex:y.a.EmailPreviewSizeMax,a=e.widthManual||y.a.ExpandedPaneWidth;return e.getOverview().isVisible.get()&&(a+=y.a.OverviewWidth),Math.max(Math.min(t,w.a.windowWidth()-a),y.a.EmailPreviewSizeMin)}},{key:"onLoadRemote",value:function(){}}]),e}(),_()(re.prototype,"onResize",[b.a],Object.getOwnPropertyDescriptor(re.prototype,"onResize"),re.prototype),_()(re.prototype,"updateDisplayPanes",[b.a],Object.getOwnPropertyDescriptor(re.prototype,"updateDisplayPanes"),re.prototype),_()(re.prototype,"onBoardChanged",[b.a],Object.getOwnPropertyDescriptor(re.prototype,"onBoardChanged"),re.prototype),re),ue=a(55);function ce(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var de,he=(ie=function(e){d()(a,e);var t=ce(a);function a(){return i()(this,a),t.call(this)}return s()(a,[{key:"load",value:function(){this.isLoaded||(ue.a.init(),u()(g()(a.prototype),"load",this).call(this),bo.DesktopUI.sidebarChanged.listen(this.onResize))}},{key:"onPluginGmailToggled",value:function(){this.savePaneState(),this.loadPanesFromState()}},{key:"loadPanesFromState",value:function(){var e=this;this.load();var t=this.getPaneState();if(t){var a=0,n=0,r=!1;this._isLoading=!0,bo.PaneUpdateBatcher.beginUpdateItems();for(var i={},o=function(n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e.getPaneAtIndex(n),o=t.find((function(e){return e.id===r.id}));o?(r.onRemoteUpdate(o),i[r.id]=r):e.unloadPane(r)},s=0;s<this.paneCount();++s)o(s);this._panes.set([],!1);for(var l=[],u=0;u<t.length;++u){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var c=t[u];if(w.a.supportsMultiplePanes.get()||(c.isOverviewVisible=!1),i[c.id])l[u]=i[c.id];else{var d=this.loadPaneFromState(c);if(d){if(l[u]=d,this._initPane(d),d.usesVMLIs){var h=d.getItem(!0);if(!h&&d.type===y.a.PaneMode.Task)h=j.a.getDefaultDocument().getRootItem();d.zoomIn(h,{forLoad:!0})}}else r=!0}}l=m.default.arrayUniques(l.filter((function(e){return!!e})),"id"),this._panes.set(l),this._isLoading=!1,r&&this.savePaneState(),bo.PaneUpdateBatcher.commitUpdateItems()}}},{key:"loadPaneFromState",value:function(e){if(e.id&&this.isPaneActive(e.id))return this._panesById[e.id];var t=e.item||e.focus,a=t&&j.a.getItem(t);a&&a.isDeleted()&&(a=void 0);var n=e.type||"PaneTask";a||(n===y.a.PaneMode.Task?a=j.a.getDefaultDocument().getRootItem():n===y.a.PaneMode.Inbox&&(a=t));var r,i=m.default.clone(e);return i.item=a,i.deferredItemID=a?void 0:t,i.scrollIndex=e.scrollIndex,this._panesById[e.id]&&(e.id=this.getNextPaneID()),i.id&&this.isPaneActive(i.id)||(r=ae.a.createPane(n,i))&&(e.id=r.id,e.showarch&&r.showArchived.set(!0),r.applyItemState(e.itemState)),r}},{key:"savePaneState",value:function(e){try{m.default.PAssert(314,!this._isLoading,"Bad stuff! Saving pane state during load")}catch(a){m.default.reportError(a)}if(m.default.isDemoMode()||this._isInitialStateLoaded&&bo.settings.activeUser.get()){var t=this.recreatePaneState();ue.a.savePaneState(t,e)}}},{key:"getPaneState",value:function(){return ue.a.getPaneState()}},{key:"hasLoadedPaneState",value:function(){return ue.a.hasLoadedPaneState()}},{key:"loadInitialState",value:function(){this._isInitialStateLoaded||(this.loadPanesFromState(),ue.a.selected.listen(this.onBoardChanged),this._isInitialStateLoaded=!0)}},{key:"addBoard",value:function(){var e=ue.a.add();return this.selectBoard(e),bo.onIntroAction("AddBoard"),e}},{key:"selectBoard",value:function(e){ue.a.selectBoard(e)}},{key:"removePanesByType",value:function(e){var t=0,a=[];this.runForEachPane((function(e){a.push(e)}),e);for(var n=0;n<a.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.removePane(a[n])}}},{key:"getAvailableArea",value:function(){return bo.DesktopUI.getSidebarWidth()-2}},{key:"updatePaneRects",value:function(e){this.isResizingPane=e;var t=this._panes.get(),a=w.a.windowHeight()-bo.DesktopUI.topBarHeight(),n=w.a.windowWidth()-bo.DesktopUI.getSidebarWidth();if(w.a.supportsMultiplePanes.get()){var r,i,o=bo.DesktopUI.getSidebarWidth();if(n+=2,m.default.isDemoInIframe()&&(n-=5),t.length>0){var s,l,u=0,c=0,d=0,h=[],f=[],p=0;for(r=0;r<t.length;r++){var g;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var v=t[r];v.widthManual?(f[r]=v.widthManual,p+=v.widthManual):v.isExpanded.get()?(f[r]=y.a.ExpandedPaneWidth,p+=y.a.ExpandedPaneWidth):h.push({index:r,pane:v}),v.isExpanded.get()&&(p+=v.widthManualExpanded||this.emailPreviewSize(v)),(null===(g=v.getOverview())||void 0===g?void 0:g.isVisible.get())&&(p+=y.a.OverviewWidth)}for(var k=n-p;h.length>0;){var _=0;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var b=Math.floor(k/h.length),S=-1,D=b;for(r=0;r<h.length;r++){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;var P=h[r].pane;P.maxWidthFlex<D&&(S=r,D=P.maxWidthFlex)}if(S>=0){var I=h[S].pane;s=Math.min(1===t.length?I.widthBiggerInSingle?I.maxWidthSingle:I.maxWidthFlex:h[S].pane.maxWidthFlex,k),f[h[S].index]=s,p+=s,k-=s,h.splice(S,1)}else{var E=0,C=-1,x=b;for(r=0;r<h.length;r++){if(E++>5e3&&__infLoop&&__infLoop(E))throw new RangeError;var A=h[r].pane;A.minWidthFlex>x&&(C=r,x=A.minWidthFlex)}if(!(C>=0)){var T=0;for(r=0;r<h.length;r++){if(T++>5e3&&__infLoop&&__infLoop(T))throw new RangeError;f[h[r].index]=b,p+=b}break}s=h[C].pane.minWidthFlex,f[h[C].index]=s,p+=s,k-=s,h.splice(C,1)}}var M=Math.max((n-p)/2,0),L=!1;for((i=Math.floor(M)+o)!==Math.round(M)&&(L=p+1===n),m.default.isDemoInIframe()&&(i+=2),r=0;r<t.length;r++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var O=t[r];s=f[r]+(L&&r===t.length-1?1:0),l=O.isExpanded.get()?O.widthManualExpanded||this.emailPreviewSize(O):0,O.isOverviewVisible()&&(i+=y.a.OverviewWidth),this.tempPositionForNewPane&&O.rect.get()?(O.rect.get().width=s,O.rect.notify()):O.setRect({left:i,top:0,width:s-(0===r?2:1),height:a,right:i+s,bottom:a,isFirst:0===r,widthExpanded:l}),r>0&&O.isOverviewVisible()&&s++,i+=s,O.isExpanded.get()&&(i+=l)}}if(this.tempPositionForNewPane){var R=t[t.length-1].rect.get(),F=this.tempPositionForNewPane;R.left=F.left+F.pane.rect.get().width}this.totalWidth.set(i),e||se.a.fireEvent("paneSizeChanged",[]),N.a.updateCaretAndCaretItem(),setTimeout((function(){N.a.updateCaretAndCaretItem()}),500)}else t.forEach((function(e){return e.rect.set({left:0,right:0,width:n,top:0,bottom:a,height:a})}))}},{key:"ensurePaneInView",value:function(e){if(m.default.vmMain.panesContainer){if(!e){var t=this._panes.get();e=t[t.length-1]}if(e){var a=e.rect.get();if(a){var n=a.width+(e.isExpanded.get()?a.widthExpanded:0),r=w.a.windowWidth()-(bo.DesktopUI.getSidebarWidth()-2),i=m.default.vmMain.getScrollOffset(),o=a.left-i,s=a.left+n-i;(o<0||s>r)&&m.default.vmMain.setScrollOffset(a.left+n-r)}}}}},{key:"scrollToAndHighlightItem",value:function(e,t){e.highlight(),this.runForEachPane((function(a){a!==t&&a.type===y.a.PaneMode.Task&&a.isViewOutline()&&a.scrollToMiddle(e)}))}},{key:"_timeoutLoadFailed",value:function(){0===this._panes.length()&&0===bo.menus.modalStack.length()&&(m.default.reportError(new Error("Pane Load Timeout")),bo.toasts.pushMessage(y.a.MessageID.PaneLoadTimeout))}},{key:"onRemoteUpdate",value:function(e){var t=this;e.forEach((function(e){if(t.hasPaneById(e.id)){var a=t.getPaneById(e.id);a&&(a.applyItemState(e.itemState),a.updateItemsImmediate())}}))}},{key:"clonePane",value:function(e,t){var a=this.getPaneIndex(e),n=e.getSaveInfoForClone();return t&&(n=Object.assign(n,t)),this.createPaneAtIndex(n.type,a+1,n)}}]),a}(le),_()(ie.prototype,"savePaneState",[b.a],Object.getOwnPropertyDescriptor(ie.prototype,"savePaneState"),ie.prototype),ie),fe=a(5),pe=a.n(fe),ge=a(12),me=a.n(ge),ve=a(26),ye=a(76),ke=a(87),_e=["4.95","49.95","5","49"],be=w.a.demo,we=(de=function(){function e(){var t=this;i()(this,e),this._premiumStatus=new P.a(y.a.PremiumStatus.Unknown),this.userProperties=new ke.a,this.appleIAPPurchase=new P.a,be&&this._premiumStatus.set(y.a.PremiumStatus.Active),this.hasPremiumFeaturesObservable=new I.a([this._premiumStatus],(function(){return t.hasPremiumFeatures()})),this._lastSignupError=-1,this._earlyAdopter=!1,this._inviteCode=void 0,this._referredBy=void 0,this._joinDate=void 0,this._premiumStartDate=void 0,this._premiumEndDate=void 0,this._premiumCode=void 0,this._premiumCodeExpired=!1,this._nextBillingDate=void 0,this._trialStart=void 0,this._trialDuration=void 0,this._trialExtended=void 0,this._pricingSelected=y.a.Pricing.None,this._billingIdentifier=void 0,this._hasValidBillingData=new P.a(!1),this.daysLeftInTrial=new P.a(-1),this.inviteCodeError=new P.a,this.inviteEmailError=new P.a,this.inviteEmailSuccess=new P.a,this.init()}return s()(e,[{key:"init",value:function(){var e=this;this._premiumStatus.listen((function(t,a){e.hasPremiumFeatures()?(bo.pluginManager.notifyDependencyLoad(y.a.PluginDependency.EarlyAccess),bo.pluginManager.notifyDependencyLoad(y.a.PluginDependency.PremiumSub)):e.hasEarlyAccess()&&bo.pluginManager.notifyDependencyLoad(y.a.PluginDependency.EarlyAccess),t!==a&&a&&bo.DisplaySettings.onSettingChanged()})),be||bo.settings.onLoaded((function(){if(e.userProperties.set(bo.settings.userProperties.get()),e.userProperties.get()){e.updateBillingData(),m.default.shouldLog(y.a.LogLevels.Account)&&m.default.log("Premium Status (Local): ",e.userProperties.get().premiumStatus);var t=ve.a.getURLParam("premium");void 0!==t&&ve.a.removeURLParam("premium",!0),t&&setTimeout((function(){bo.menus.openSettings("Account")}),100)}})),w.a.app&&S.a.onIAPUpdated(function(){var t=me()(pe.a.mark((function t(a){return pe.a.wrap((function(t){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(t.prev=t.next){case 0:if(!a){t.next=8;break}if(!a.transactionReceipt){t.next=6;break}return t.next=5,ye.a.updateIAP(a);case 5:e.appleIAPPurchase.set(a);case 6:t.next=9;break;case 8:e.appleIAPPurchase.set(null);case 9:case"end":return t.stop()}}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"setLastSignupError",value:function(e){this._lastSignupError=e}},{key:"_reportRemoteStatusFailure",value:function(){m.default.sendEvent("Billing","RemoteStatusFailure")}},{key:"getBillingIdentifier",value:function(){var e;this._billingIdentifier;return this._billingIdentifier}},{key:"onBillingIdentifierAvailable",value:function(e){}},{key:"onConnected",value:function(e){}},{key:"hasPremium",value:function(){return this._premiumStatus.get()===y.a.PremiumStatus.Active||this._premiumStatus.get()===y.a.PremiumStatus.PastDue}},{key:"isTrialState",value:function(){return this._premiumStatus.get()===y.a.PremiumStatus.Trial||this._premiumStatus.get()===y.a.PremiumStatus.TrialOver}},{key:"isCanceledState",value:function(){return this._premiumStatus.get()===y.a.PremiumStatus.CanceledUser||this._premiumStatus.get()===y.a.PremiumStatus.CanceledPastDue}},{key:"canceledUserHasPremiumAccess",value:function(){var e=this.getPremiumEndDate();return this.isCanceledState()&&e&&e.getTime()>Date.now()}},{key:"isInFreeMonthAndPremium",value:function(){return(this.hasPremium()||this.canceledUserHasPremiumAccess())&&this._nonReferralDiscounts>=100}},{key:"hasSubscription",value:function(){return!!this._subscriptionID||!!this._appleIAP}},{key:"updateBillingData",value:function(){var e,t=this.userProperties.get(),a=t.premiumStatus;this._earlyAdopter=t.earlyAdopter,this._joinDate=t.joinDate?new Date(t.joinDate):new Date,this._premiumStartDate=t.premiumSignupDate?new Date(t.premiumSignupDate):new Date,this._premiumEndDate=t.premiumEndDate?new Date(t.premiumEndDate):void 0,this._premiumCode=t.premiumCode,this._nextBillingDate=t.nextBillingDate?new Date(t.nextBillingDate):void 0,this._trialStart=t.trialStart?new Date(t.trialStart):new Date,this._trialDuration=t.trialDuration||y.a.TrialDuration,this._trialExtended=t.trialExtended||!1,this._subscriptionID=t.subscriptionID,this._appleIAP={plan:t.appleIAPPlan,transactionID:t.appleIAPTransactionId},e=a===y.a.PremiumStatus.CanceledPastDue||a===y.a.PremiumStatus.CanceledUser?-1:Math.round(this._trialDuration-(Date.now()-this._trialStart.getTime())/864e5);try{m.default.PAssert(240,e<=320,"Sanity check on trial length",e)}catch(n){m.default.reportError(n)}this.daysLeftInTrial.set(e),a===y.a.PremiumStatus.Trial&&e<0?(a=y.a.PremiumStatus.TrialOver,ye.a.updatePremiumStatus(),this.notifyTrialOver()):a===y.a.PremiumStatus.Trial&&e<5&&this.notifyTrialEndSoon(),!be&&a&&this.setPremiumStatus(a),this._hasValidBillingData.set(!0)}},{key:"setPremiumStatus",value:function(e){if(!be){try{m.default.PAssert(241,m.default.isNumber(e),"Status must be a valid number",e)}catch(t){m.default.reportError(t)}try{m.default.PAssert(242,e>0&&e<8,"Should be a valid status identifier",e)}catch(t){m.default.reportError(t)}e!==this._premiumStatus.get()&&(this._premiumStatus.set(e),m.default.setDimension(y.a.Analytics.Dimensions.PremiumStatus,e))}}},{key:"hasValidBillingData",value:function(){return this._hasValidBillingData.get()}},{key:"getPremiumStatus",value:function(){return this._premiumStatus.get()}},{key:"getInviteCode",value:function(){return this._inviteCode}},{key:"getJoinDate",value:function(){return this._joinDate||new Date}},{key:"getPremiumStartDate",value:function(){return this._premiumStartDate||new Date}},{key:"getPremiumEndDate",value:function(){return this._premiumEndDate}},{key:"hasTrialExtended",value:function(){return this._trialExtended||!1}},{key:"isEligibleForTrialExtension",value:function(){return!1}},{key:"getNextBillingDate",value:function(){return this._nextBillingDate}},{key:"hasEarlyAccess",value:function(){return this.hasPremiumFeatures()||this.canceledUserHasPremiumAccess()}},{key:"cancelSubscription",value:function(e,t){m.default.sendEvent("Billing","SubCancelTapped");var a=function(){t&&m.default.isFunction(t)&&t()};return bo.menus.confirm("Are you sure you want to cancel your subscription?",(function(e){e?(m.default.sendEvent("Billing","SubCancelYES"),ye.a.cancelPremium().then((function(e){var t=e.value?"Your premium subscription has been canceled. Please contact support@moo.do if you need assistance.":"There was a server error, please try again in a few minutes or contact support@moo.do.";bo.menus.alert({text:t}),a()}))):(a(),m.default.sendEvent("Billing","SubCancelNO"))})),!0}},{key:"getCustomPurchaseURL",value:function(){}},{key:"_openPaymentWindow",value:function(e){bo.menus.openModal(y.a.Modals.Billing,{isUpdate:e})}},{key:"onTapUpdatePaymentMethod",value:function(){this._openPaymentWindow(!0)}},{key:"onTapViewInvoices",value:function(e,t){return ye.a.listTransactions().then((function(e){if(e&&e.value)try{bo.menus.openModal(y.a.Modals.Invoices,e.value)}catch(a){m.default.reportError(a)}else bo.menus.alert({text:"There was an error retreiving your invoice data. Please contact support@moo.do."});t()})),!0}},{key:"onTapDeleteAccount",value:function(e,t){return me()(pe.a.mark((function e(){return pe.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,bo.menus.confirm('Are you sure you want to delete your account? This will delete all of your data. You may want to export your documents first.<br/><br/><div class="c-error font-bold">This cannot be undone.</div>',void 0,{isHTML:!0});case 2:e.sent?bo.menus.openModal(y.a.Modals.DeleteAccount,{callback:function(e){e?ye.a.deleteAccount().then((function(e){e.value?j.a.clearLocalData():bo.menus.alert({text:"There was a server error. Please try again in a few minutes or contact support@moo.do."}),t()})):t()}}):t();case 4:case"end":return e.stop()}}}),e)})))(),!0}},{key:"getInviteUrl",value:function(){return"https://www.moo.do/"}},{key:"getSelectText",value:function(){return"Select and press "+w.a.cmdChar+" + C to copy to clipboard"}},{key:"wasInvited",value:function(){return!!this._referredBy}},{key:"sendInviteEmail",value:function(e,t){}},{key:"joinDateText",value:function(){return this.getJoinDate().toString(bo.International.getFormat(y.a.DFormat.LongStrDate))}},{key:"premiumStartDateText",value:function(){return this.getPremiumStartDate().toString(bo.International.getFormat(y.a.DFormat.LongStrDate))}},{key:"premiumEndDateText",value:function(){var e=this.getPremiumEndDate();return e?e.toString(bo.International.getFormat(y.a.DFormat.LongStrDate)):"Never"}},{key:"nextBillingDateText",value:function(){var e=this.getNextBillingDate();return e?e.toString(bo.International.getFormat(y.a.DFormat.LongStrDate)):"Never"}},{key:"shareTwitter",value:function(){var e="https://twitter.com/share?url="+escape(this.getInviteUrl())+"&text=I love this new organization app!";this.showPopup(e,550,420),m.default.sendEvent("Billing","ShareTwitter")}},{key:"shareFacebook",value:function(){var e="https://www.facebook.com/sharer/sharer.php?u="+escape(this.getInviteUrl());this.showPopup(e,600,303),m.default.sendEvent("Billing","ShareFacebook")}},{key:"shareGoogle",value:function(){var e="https://plus.google.com/share?url="+this.getInviteUrl();this.showPopup(e,500,650),m.default.sendEvent("Billing","ShareGoogle")}},{key:"showPopup",value:function(e,t,a){var n=t,r=a,i=window.screen.height,o=window.screen.width,s="scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+n+",height="+r+",left="+Math.round(o/2-n/2)+",top="+Math.round(i/2-r/2);window.open(e,null,s)}},{key:"onTapSignupMonth",value:function(){this._pricingSelected=this.getMonthlyPricing(),this._openPaymentWindow(!1),m.default.sendEvent("Billing","OpenSignupModal")}},{key:"onTapSignupYear",value:function(){this._pricingSelected=this.getYearlyPricing(),this._openPaymentWindow(!1),m.default.sendEvent("Billing","OpenSignupModal")}},{key:"onTapSignupThreeYear",value:function(){this._pricingSelected=this.getThreeYearPricing(),this._openPaymentWindow(!1),m.default.sendEvent("Billing","OpenSignupModal")}},{key:"onTapCodeSignup",value:function(){bo.menus.alert({text:"Redeeming code is not ready yet in the new backend. Please contact support.",callback:function(){bo.menus.openModal(y.a.Modals.ReportBug)}})}},{key:"getMonthlyPricing",value:function(){return this._earlyAdopter?y.a.Pricing.EarlyMonthly:y.a.Pricing.RegMonthly}},{key:"getYearlyPricing",value:function(){return this._earlyAdopter?y.a.Pricing.EarlyYearly:y.a.Pricing.RegYearly}},{key:"getThreeYearPricing",value:function(){return y.a.Pricing.ThreeYear}},{key:"getMonthlyPrice",value:function(){return _e[this.getMonthlyPricing()]}},{key:"getYearlyPrice",value:function(){return _e[this.getYearlyPricing()]}},{key:"getPlanPrice",value:function(e){return _e[e]}},{key:"notifyTrialOver",value:function(){var e=this;bo.settings.onLoaded((function(){if(!bo.settings.notifiedTrialOver.get()){if(!bo.toasts)return void setTimeout(e.notifyTrialOver.bind(e),0);bo.toasts.pushMessage(y.a.MessageID.TrialOver),bo.settings.notifiedTrialOver.set(!0)}}))}},{key:"notifyTrialEndSoon",value:function(){if(!bo.settings.notifiedTrialEndSoon.get()){if(!bo.toasts)return void setTimeout(this.notifyTrialEndSoon.bind(this),0);bo.toasts.pushMessage(y.a.MessageID.TrialEndSoon),bo.settings.notifiedTrialEndSoon.set(!0)}}},{key:"isTrialOver",value:function(){return this._premiumStatus.get()===y.a.PremiumStatus.TrialOver||(this._premiumStatus.get()===y.a.PremiumStatus.CanceledUser||this._premiumStatus.get()===y.a.PremiumStatus.CanceledPastDue)&&!this.canceledUserHasPremiumAccess()}},{key:"isTrialPossible",value:function(){return this._premiumStatus.get()===y.a.PremiumStatus.Unknown||this._premiumStatus.get()===y.a.PremiumStatus.Never}},{key:"startTrial",value:function(){var e=me()(pe.a.mark((function e(){var t;return pe.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:try{m.default.PAssert(247,!this.isTrialOver(),"Should never try to start a trial once it is over")}catch(n){m.default.reportError(n)}return e.next=3,ye.a.startTrial();case 3:if((t=e.sent).error)if(t.errorCode===y.a.PrivateAPIErrorCodes.TrialOver)bo.toasts.pushMessage({text:"Your free trial of Premium has ended. Please contact support@moo.do to extend.",actionText:"OKAY"}),this._premiumStatus.set(y.a.PremiumStatus.TrialOver);else{try{m.default.PAssert(248,!1,"Failed to start trial for user")}catch(n){m.default.reportError(n)}bo.toasts.pushMessage({text:"There was an error starting your trial. Please contact support@moo.do.<br><br>"+t.error,action:y.a.MessageAction.Contact})}case 5:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hasPremiumFeatures",value:function(){return this.hasPremium()||this._premiumStatus.get()===y.a.PremiumStatus.Trial||this.canceledUserHasPremiumAccess()}},{key:"getBillingPeriod",value:function(){return this._pricingSelected}},{key:"loadUserProperties",value:function(e){var t=bo.settings.userProperties.get();t=Object.assign({},t,e),bo.settings.userProperties.set(t),this.userProperties.set(t),this.updateBillingData()}},{key:"setJoinDate",value:function(e){this.userProperties.setProperty("joinDate",e),ye.a.setUserProperties({joinDate:e})}},{key:"updateUserProfile",value:function(e){var t=this,a=m.default.removeNullUndefined(e);this.userProperties.onHasValue((function(e){var n=Object.keys(a).filter((function(t){return a[t]&&!e[t]}));if(n.length>0){t.userProperties.set(Object.assign({},e,a));var r={};n.forEach((function(e){return r[e]=a[e]})),ye.a.setUserProperties(r)}}))}}]),e}(),_()(de.prototype,"cancelSubscription",[b.a],Object.getOwnPropertyDescriptor(de.prototype,"cancelSubscription"),de.prototype),_()(de.prototype,"onTapUpdatePaymentMethod",[b.a],Object.getOwnPropertyDescriptor(de.prototype,"onTapUpdatePaymentMethod"),de.prototype),_()(de.prototype,"onTapViewInvoices",[b.a],Object.getOwnPropertyDescriptor(de.prototype,"onTapViewInvoices"),de.prototype),_()(de.prototype,"onTapDeleteAccount",[b.a],Object.getOwnPropertyDescriptor(de.prototype,"onTapDeleteAccount"),de.prototype),_()(de.prototype,"onTapSignupMonth",[b.a],Object.getOwnPropertyDescriptor(de.prototype,"onTapSignupMonth"),de.prototype),_()(de.prototype,"onTapSignupYear",[b.a],Object.getOwnPropertyDescriptor(de.prototype,"onTapSignupYear"),de.prototype),_()(de.prototype,"onTapSignupThreeYear",[b.a],Object.getOwnPropertyDescriptor(de.prototype,"onTapSignupThreeYear"),de.prototype),_()(de.prototype,"onTapCodeSignup",[b.a],Object.getOwnPropertyDescriptor(de.prototype,"onTapCodeSignup"),de.prototype),_()(de.prototype,"startTrial",[b.a],Object.getOwnPropertyDescriptor(de.prototype,"startTrial"),de.prototype),de),Se=a(23),De=function(){function e(t,a){i()(this,e),this._id=t,this._isOpen=!1,this._isReady=!1,this._isAllLoaded=!1,this._storageError=!1,this._loggingEnabled=!1,this._preloadConsumed=!1,this._usesDiskSpace||(this._usesDiskSpace=!1),this._onReadyFns=[],this._onMetadataReadyFns=[],this._cache={},this._useInMemoryStore=!a||!a.noInMemoryCache,this._useMetadataInMemoryStore=!a||!a.noMetadataInMemoryCache,this._metadataKeys=a&&a.metadataKeys?a.metadataKeys:[]}return s()(e,[{key:"getStats",value:function(){var e=this;return this.getFilterEntriesSync((function(){return!0})).map((function(t){return{id:e._id,count:t.length,size:JSON.stringify(t).length}}))}},{key:"getState",value:function(){return{isAllLoaded:this._isAllLoaded,storageError:this._storageError}}},{key:"enableLogging",value:function(){this._loggingEnabled=!0}},{key:"disableLogging",value:function(){this._loggingEnabled=!1}},{key:"isLoggingEnabled",value:function(){return this._loggingEnabled}},{key:"usesDiskSpace",value:function(){return this._usesDiskSpace}},{key:"_cacheInMemory",value:function(){return this._useInMemoryStore}},{key:"_cacheMetadataInMemory",value:function(){return this._useMetadataInMemoryStore}},{key:"_hasLoadedAll",value:function(){return this._isAllLoaded}},{key:"getStorageType",value:function(){try{m.default.PAssert(909,!1,"SubClass must override")}catch(e){m.default.reportError(e)}}},{key:"_setRawInMemoryCache",value:function(e){try{m.default.PAssert(910,this._cacheInMemory(),"Must be running an in-memory cache")}catch(t){m.default.reportError(t)}this._cache=e}},{key:"_getRawInMemoryCache",value:function(){return this._cacheInMemory()?this._cache:void 0}},{key:"count",value:function(e){e(this._cacheInMemory()?Object.keys(this._cache).length:void 0)}},{key:"size",value:function(e){e(this._cacheInMemory()?2*JSON.stringify(this._cache).length:void 0)}},{key:"loadAll",value:function(e){this._isAllLoaded=!0}},{key:"getEntrySync",value:function(e){return this._cacheInMemory()?this._cache[e]:void 0}},{key:"getBoundEntries",value:function(e,t,a,n){try{m.default.PAssert(911,!n,"In memory query is sync")}catch(o){m.default.reportError(o)}var r;if(this._cacheInMemory())for(var i in r=[],this._cache)this._cache[i][e]>=t&&this._cache[i][e]<=a&&r.push(this._cache[i]);return r}},{key:"getFilterEntriesSync",value:function(e){var t,a=this;return this._cacheInMemory()&&(t=[],Object.keys(this._cache).forEach((function(n){e&&!e(a._cache[n])||t.push(a._cache[n])}))),t}},{key:"removeEntrySync",value:function(e){delete this._cache[e]}},{key:"hasEntrySync",value:function(e){return!!this._cacheInMemory()&&this._cache.hasOwnProperty(e)}},{key:"saveEntrySync",value:function(e){try{m.default.PAssert(912,e,"Must be saving data")}catch(t){m.default.reportError(t)}try{m.default.PAssert(913,e&&e.id,"Saved data must have id")}catch(t){m.default.reportError(t)}this.isLoggingEnabled()&&m.default.log("Cache Entry: ",e),this._cacheInMemory()&&e&&(this._cache[e.id]=e)}},{key:"clearCacheSync",value:function(){this._cache={}}},{key:"clearBackingStore",value:function(){try{m.default.PAssert(914,!1,"SubClass must override")}catch(e){m.default.reportError(e)}}},{key:"dumpData",value:function(e){console.log("-- Cache: ",this._id,"--"),console.log(this._cache)}},{key:"onCacheError",value:function(e){m.default.reportError(e)}}]),e}();function Pe(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var Ie,Ee=function(e){d()(a,e);var t=Pe(a);function a(e,n){var r;return i()(this,a),(r=t.call(this,e,n)).keyFieldsRN=n.keyFieldsRN,r}return s()(a,[{key:"getPreloadData",value:function(){return Se.a.getTableData(this._id)}},{key:"getMetadata",value:function(e){return Se.a.getValue(this._id+"_"+e)}},{key:"setMetadata",value:function(e,t){Se.a.setValue(this._id+"_"+e,t)}},{key:"removeMetadata",value:function(e){Se.a.deleteValue(this._id+"_"+e)}},{key:"clearMetadata",value:function(){var e=this;this._metadataKeys&&this._metadataKeys.forEach((function(t){return e.removeMetadata(t)}))}},{key:"hasEntry",value:function(){var e=me()(pe.a.mark((function e(t){var a;return pe.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.getEntry(t);case 2:return a=e.sent,e.abrupt("return",void 0!==a);case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getEntry",value:function(){var e=me()(pe.a.mark((function e(t,a){var n;return pe.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(this._useInMemoryStore&&(n=this.getEntrySync(t)),void 0===n&&(n=Se.a.getTableValue(this._id,t)),void 0!==n){e.next=6;break}return e.next=5,Se.a.tableGet(this._id,t);case 5:n=e.sent;case 6:return n&&a&&(n=m.default.clone(n)),e.abrupt("return",n);case 8:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"removeEntry",value:function(){var e=me()(pe.a.mark((function e(t){var n;return pe.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return this._useInMemoryStore?u()(g()(a.prototype),"removeEntrySync",this).call(this,t):(n=Se.a.getTableData(this._id))&&delete n[t],e.abrupt("return",Se.a.tableDelete(this._id,t));case 2:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"saveEntry",value:function(){var e=me()(pe.a.mark((function e(t,n){var r;return pe.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:0,r=Se.a.getTableValue(this._id,t.id),(!r||(n?n(r,t):r!==t&&!m.default.deepEqual(r,t,!0)))&&(this._useInMemoryStore&&u()(g()(a.prototype),"saveEntrySync",this).call(this,t),Se.a.setTableValue(this._id,t.id,t));case 4:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"clearCache",value:function(){var e=me()(pe.a.mark((function e(){return pe.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return this._useInMemoryStore&&u()(g()(a.prototype),"clearCacheSync",this).call(this),e.abrupt("return",Se.a.tableClear(this._id));case 2:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getFilterEntries",value:function(){var e=me()(pe.a.mark((function e(t){return pe.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Se.a.tableFilter(this._id,t));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"ensureTableLoaded",value:function(){var e=me()(pe.a.mark((function e(t){return pe.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Se.a.ensureTableLoaded(this._id,t));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),a}(De);function Ce(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var xe,Ae,Te=(Ie=function(e){d()(a,e);var t=Ce(a);function a(e,n){var r;if(i()(this,a),n){try{m.default.PAssert(466,!n.noInMemoryCache,"Invalid in-memory cache option")}catch(s){m.default.reportError(s)}try{m.default.PAssert(467,!n.noMetadataInMemoryCache,"Invalid metadata in-memory cache option")}catch(s){m.default.reportError(s)}n.noInMemoryCache=!1,n.noMetadataInMemoryCache=!1}if(r=t.call(this,e,n),n?(r.saveTime=isNaN(n.saveTime)?5e3:n.saveTime,n.writeOnUnload&&se.a.listen("onUnload",r.writeCache),n.clearBackingOnLoad&&(r.clearBackingOnLoad=!0,se.a.listen("enterForeground",r.clearBackingStore))):r.saveTime=5e3,r.storageKey="MDC_"+r._id,r._cache=Se.a.getValue(r.storageKey)||{},m.default.isString(r._cache))try{var o=JSON.parse(r._cache);r._cache=o}catch(l){}return r._saveTimeout=void 0,r}return s()(a,[{key:"_onWrite",value:function(e){e||0===this.saveTime?(this._saveTimeout&&(clearTimeout(this._saveTimeout),this._saveTimeout=void 0),this.writeCache()):this.saveTime>=0&&(this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(this.writeCache,this.saveTime))}},{key:"writeCache",value:function(){if(bo.settings.activeUser.get()){var e=this._getRawInMemoryCache();try{Se.a.setValue(this.storageKey,e)}catch(t){m.default.reportError(t)}}}},{key:"getStorageType",value:function(){return y.a.StorageType.LocalStorage}},{key:"removeEntrySync",value:function(e){delete this._cache[e],this._onWrite()}},{key:"getEntrySync",value:function(e){return this._cache[e]}},{key:"saveEntrySync",value:function(e){var t=e.id,a=e.value;void 0===a||null===a?delete this._cache[t]:this._cache[t]=a,this._onWrite()}},{key:"clearCacheSync",value:function(){u()(g()(a.prototype),"clearCacheSync",this).call(this),this._onWrite(!0)}},{key:"clearBackingStore",value:function(){Se.a.deleteValue(this.storageKey)}}]),a}(De),_()(Ie.prototype,"writeCache",[b.a],Object.getOwnPropertyDescriptor(Ie.prototype,"writeCache"),Ie.prototype),_()(Ie.prototype,"clearBackingStore",[b.a],Object.getOwnPropertyDescriptor(Ie.prototype,"clearBackingStore"),Ie.prototype),Ie),Me=function(){function e(){i()(this,e),this._reportedQuotaError=!1,this._migrationRequired=!1,this._registeredCaches={},this._storageReady=[]}return s()(e,[{key:"init",value:function(){this._storageReady[y.a.StorageType.InMemory]=!0,this._storageReady[y.a.StorageType.LocalStorage]=!0}},{key:"getInfo",value:function(){return{reportedQuotaError:this._reportedQuotaError,migrationRequired:this._migrationRequired,numCaches:Object.keys(this._registeredCaches).length}}},{key:"registerLocalCache",value:function(e,t,a){try{m.default.PAssert(237,e,"Must provide a valid cache ID")}catch(r){m.default.reportError(r)}try{m.default.PAssert(238,void 0===this._registeredCaches[e],"Must not have a previously registered cache with the same id")}catch(r){m.default.reportError(r)}var n;switch(t){case y.a.StorageType.InMemory:0;break;case y.a.StorageType.LocalStorage:n=new Te(e,a);break;case y.a.StorageType.IndexedDB:n=new Ee(e,a)}try{m.default.PAssert(239,n,"Must have valid cache after creation")}catch(r){m.default.reportError(r)}return this._registeredCaches[e]=n,n}},{key:"_notifyIDBReady",value:function(e){}},{key:"notifyMigrationRequired",value:function(){this._migrationRequired=!0}},{key:"needsMigration",value:function(){return this._migrationRequired||1!==bo.settings.localDataVersion.get()}},{key:"hasReportedQuotaError",value:function(){return this._reportedQuotaError}},{key:"reportQuotaExceeded",value:function(){this._reportedQuotaError||(this._reportedQuotaError=!0,m.default.reportError(new Error("Quota exceeded!")))}}]),e}(),Le=a(46),Oe=function(){function e(){i()(this,e)}return s()(e,[{key:"init",value:function(){this.isEnabled=!m.default.isDemoMode(),this.isEnabled&&(this.storage=Le.a.storage())}},{key:"uploadString",value:function(){var e=me()(pe.a.mark((function e(t,a){var n=this;return pe.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.isEnabled){e.next=2;break}return e.abrupt("return",new Promise((function(e,r){var i=n.storage.ref(t).putString(a);i.on("state_changed",(function(e){}),(function(e){r(e)}),(function(){i.snapshot.ref.getDownloadURL().then((function(t){return e(t)}))}))})));case 2:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getString",value:function(){var e=me()(pe.a.mark((function e(t){var a,n;return pe.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.isEnabled){e.next=15;break}return e.next=3,this.storage.ref(t).getDownloadURL();case 3:if(!(a=e.sent)){e.next=15;break}return e.prev=5,e.next=8,fetch(a);case 8:return n=e.sent,e.abrupt("return",n.text());case 12:e.prev=12,e.t0=e.catch(5),m.default.reportError(e.t0);case 15:case"end":return e.stop()}}}),e,this,[[5,12]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Re=(xe=function(){function e(t,a,n,r,o,s,l,u,c){i()(this,e),this._id=t,this._remoteID=o,this._type=a;try{m.default.PAssert(481,m.default.isDateValid(n),"Must specify a valid schedule date for deferred task")}catch(d){m.default.reportError(d)}this._scheduleDate=n,this._timeout=void 0,this._data=s,this._cbRun=l,this._cbCancel=u,this._cbPersistRemote=c,this._hasRun=!1,this._isCanceled=r,this._destroyed=!1}return s()(e,[{key:"schedule",value:function(){var e=this;try{m.default.PAssert(482,!this._timeout,"Should not schedule the same task multiple times")}catch(a){m.default.reportError(a)}try{m.default.PAssert(483,!this._hasRun,"Should not schedule a task once it has already run once")}catch(a){m.default.reportError(a)}try{m.default.PAssert(484,!this._isCanceled,"Should not schedule canceled tasks")}catch(a){m.default.reportError(a)}var t=Math.max(0,this._scheduleDate.getTime()-Date.now());this._timeout=setTimeout(this.runTask,t),!this._remoteID&&t>0&&ee.a.onLoaded((function(){try{e._cbPersistRemote(e,e._onPersistedRemote)}catch(t){m.default.reportError(t)}}))}},{key:"_onCanceled",value:function(e){e&&(this._destroyed=!0,bo.deferredTaskManager._notifyTaskComplete(this._id))}},{key:"_onPersistedRemote",value:function(e,t){e&&(this._remoteID=t,bo.deferredTaskManager._updateTask(this._id))}},{key:"reschedule",value:function(e){try{m.default.PAssert(485,!this._hasRun,"Should never reschedule a task that has already run")}catch(t){m.default.reportError(t)}try{m.default.PAssert(486,!this._isCanceled,"Should not reschedule canceled tasks")}catch(t){m.default.reportError(t)}try{m.default.PAssert(487,this._timeout,"Must always have already schedule a task that is being rescheduled")}catch(t){m.default.reportError(t)}clearTimeout(this._timeout),this._timeout=void 0,this._scheduleDate=e,this.schedule()}},{key:"cancel",value:function(){var e=this;try{m.default.PAssert(488,this._timeout||this._remoteID,"Must always have already scheduled (locally or remotely) a task that is being canceled")}catch(t){m.default.reportError(t)}try{m.default.PAssert(489,!this._hasRun,"Should not cancel tasks that have already been run")}catch(t){m.default.reportError(t)}this._isCanceled=!0,clearTimeout(this._timeout),this._timeout=void 0,this._remoteID&&ee.a.onLoaded((function(){try{e._cbCancel(e,e._onCanceled)}catch(t){m.default.reportError(t)}})),bo.deferredTaskManager._updateTask(this._id)}},{key:"runTask",value:function(){this._timeout=void 0,this._hasRun=!0;try{this._cbRun(this)}catch(e){m.default.reportError(e)}bo.deferredTaskManager._notifyTaskComplete(this._id)}},{key:"getData",value:function(){return this._data}},{key:"getType",value:function(){return this._type}},{key:"getScheduleDate",value:function(){return this._scheduleDate}},{key:"getSaveData",value:function(){return{id:this._id,remoteID:this._remoteID,type:this._type,scheduleDate:this._scheduleDate,data:this._data,isCanceled:this._isCanceled}}},{key:"isPersistedRemote",value:function(){return!!this._remoteID}}]),e}(),_()(xe.prototype,"_onCanceled",[b.a],Object.getOwnPropertyDescriptor(xe.prototype,"_onCanceled"),xe.prototype),_()(xe.prototype,"_onPersistedRemote",[b.a],Object.getOwnPropertyDescriptor(xe.prototype,"_onPersistedRemote"),xe.prototype),_()(xe.prototype,"runTask",[b.a],Object.getOwnPropertyDescriptor(xe.prototype,"runTask"),xe.prototype),xe),Fe=function(){function e(){i()(this,e),this._registeredTypes={},this._deferredTasks={},this._stats={}}return s()(e,[{key:"init",value:function(){var e=0;this._taskCache=bo.cacheManager.registerLocalCache("DeferredTasks",y.a.StorageType.LocalStorage);for(var t=this._taskCache.getFilterEntriesSync(),a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=t[a];this.scheduleTask(n.id,n.type,new Date(n.scheduleDate),n.isCanceled,n.remoteID,n.data,!0)}}},{key:"getLastSyncDate",value:function(){var e=bo.settings.lastTaskSync.get();try{m.default.PAssert(292,!e||m.default.isString(e),"Must have a valid string sync date")}catch(t){m.default.reportError(t)}return e}},{key:"getStats",value:function(){return{}}},{key:"registerTaskType",value:function(e,t,a,n){try{m.default.PAssert(293,!this._registeredTypes[e],"Must not double register task type")}catch(r){m.default.reportError(r)}try{m.default.PAssert(294,m.default.isFunction(t),"Must register a valid run callback")}catch(r){m.default.reportError(r)}try{m.default.PAssert(295,m.default.isFunction(a),"Must register a valid cancel callback")}catch(r){m.default.reportError(r)}try{m.default.PAssert(296,m.default.isFunction(n),"Must register a valid persist callback")}catch(r){m.default.reportError(r)}this._registeredTypes[e]={cbRun:t,cbCancel:a,cbPersistRemote:n}}},{key:"_notifyTaskComplete",value:function(e){this._removeTask(e)}},{key:"scheduleTask",value:function(e,t,a,n,r,i,o){try{m.default.PAssert(297,e,"Must supply a valid task ID")}catch(c){m.default.reportError(c)}try{m.default.PAssert(298,t,"Must supply a valid task type")}catch(c){m.default.reportError(c)}try{m.default.PAssert(299,m.default.isDateValid(a),"Must always have a valid scheduled date available")}catch(c){m.default.reportError(c)}try{m.default.PAssert(300,this._registeredTypes[t],"Must request a valid registered task type")}catch(c){m.default.reportError(c)}if(this._deferredTasks[e]){var s=this._deferredTasks[e];try{m.default.PAssert(301,s.getType()===t,"Task types must match")}catch(c){m.default.reportError(c)}try{m.default.PAssert(302,s.getScheduleDate().equals(a),"Task schedule dates must match")}catch(c){m.default.reportError(c)}}else{var l=this._registeredTypes[t];if(l){var u=new Re(e,t,a,n,r,i,l.cbRun,l.cbCancel,l.cbPersistRemote);if(this._deferredTasks[e]){m.default.log("Overriding existing task");try{m.default.PAssert(303,this._deferredTasks[e].type===t,"Should only update deferred tasks of the same type")}catch(c){m.default.reportError(c)}}this._addTask(e,u,o),n?u.cancel():u.schedule()}}}},{key:"cancelTask",value:function(e,t){this._deferredTasks[e].cancel()}},{key:"_updateTask",value:function(e){var t=this._deferredTasks[e];this._taskCache.saveEntrySync(t.getSaveData())}},{key:"_addTask",value:function(e,t,a){this._deferredTasks[e]=t,a||this._updateTask(e)}},{key:"_removeTask",value:function(e){this._deferredTasks[e]=void 0,this._taskCache.removeEntrySync(e)}}]),e}(),Ne=function(){function e(){i()(this,e),this.items=new te.a}return s()(e,[{key:"addItemEntry",value:function(e,t){this.hasItemEntry(e)||this.items.push({id:e.id,item:e,pane:t})}},{key:"removeItemEntry",value:function(e){var t=this.items.indexOfWithProperty("id",e);if(t>=0)return this.items.splice(t,1)[0]}},{key:"hasItemEntry",value:function(e){return!!this.getItemEntry(e)}},{key:"getItemEntry",value:function(e){var t=this.items.indexOfWithProperty("id",e.id);return this.items.get()[t]}},{key:"getItems",value:function(){return this.items}},{key:"hasItems",value:function(){return this.items.get().length>0}}]),e}(),Be=a(85),je=a(114),Ue=a(67),He=(Ae=function(){function e(){i()(this,e),this.openOnPane=void 0,this.messageIDs=new te.a,this.messagesLoaded=new P.a(!1),this.isLoading=new P.a(!1),this.errorMessage=new P.a(""),this.threadAttachObs=new P.a,this.threadAttach=void 0,this.threadAttachLoading=void 0,this.threadItem=void 0,this.numLoaded=0,this._cachedCSS=void 0,ve.a.binder(this,"onAttachmentUpdate","reset","_onWindowResizeTimeout")}return s()(e,[{key:"init",value:function(){var e=this;bo.DisplaySettings.listen("themeChanged",this.onDisplaySettingsChanged.bind(this)),window.addEventListener("message",(function(t){if(m.default.getLocationOrigin()===t.origin&&t.data&&t.data.startsWith&&t.data.startsWith("-")){var a=t.data.indexOf("-",1),n=t.data.indexOf("-",a+1);n<0&&(n=void 0);var r=t.data.substring(1,a),i=t.data.substring(a+1,n),o=n?t.data.substring(n+1):void 0;m.default.batchRenderUpdates((function(){e.handleFrameMessage(i,r,o,t)}))}})),se.a.listen("selectedIndexChanged",this.onSelectedIndexChanged.bind(this)),w.a.windowSize.listen(this._onWindowResize)}},{key:"reset",value:function(e,t){if(this.threadAttach){for(var a=0,n=this.threadAttach.getField("messages"),r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n[r].initializedForDisplay&&this._destroyMessageDisplay(n[r])}this.threadAttach.unsubscribe(this)}this.numLoaded=0,this.threadAttach=void 0,this.threadItem=void 0,this.emailElement=void 0,this.errorMessage.set("",!1),this.isLoading.set(t,!1),this.messagesLoaded.set(!1,!1),this.messageIDs.get().length>0&&this.messageIDs.set([],e)}},{key:"_onWindowResizeTimeout",value:function(){if(this.threadAttach)for(var e=0,t=this.threadAttach.getField("messages"),a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.updateMessageHeight(t[a].id,!0)}}},{key:"_onWindowResize",value:function(){m.default.timeoutOnce("email resize",this._onWindowResizeTimeout,0)}},{key:"getPlugin",value:function(){return this.threadAttach?this.threadAttach.getPlugin():bo.pluginManager.getPluginGmail()}},{key:"_sendReply",value:function(e,t,a){try{m.default.PAssert(271,e,"Must supply a valid target")}catch(r){m.default.reportError(r)}try{m.default.PAssert(272,t,"Must supply a valid action")}catch(r){m.default.reportError(r)}try{var n="-"+t+(void 0!==a?"-"+a:"");e.postMessage(n,"*")}catch(i){m.default.reportError(i)}}},{key:"handleFrameMessage",value:function(e,t,a,n){var r=this;switch(t){case"resize":try{var i=JSON.parse(a);this.updateMessageHeight(e,!0===i.canBeShorter,i.scale)}catch(f){m.default.reportError(f)}break;case"click":se.a.fireEvent("tapMain",[]);break;case"keypress":try{var o=JSON.parse(a);w.a.normalizeKeys(o),N.a.fireKeyEvent(document.documentElement,o)}catch(f){m.default.reportError(f)}break;case"href":if(a.startsWith("mailto:")){var s=this.parseMailtoURL(a.replace(/^mailto:/gi,"")),l={to:[{email:s.to}],subject:s.subject&&unescape(s.subject),body:s.body&&unescape(s.body).replace(/\r?\n/g,"<br>")};bo.menus.openComposeEmail(this.getPlugin(),{initData:l})}else bo.openUrl(a);break;case"epLoaded":this.onMessageLoaded(e);break;case"reloadMessage":this.threadAttach&&this._requestMessageReload(e,this.threadAttach,e);break;case"reqResource":try{try{m.default.PAssert(273,n,"Must provide a valid request event")}catch(p){m.default.reportError(p)}if(this.threadAttach)for(var u=0,c=JSON.parse(a),d=function(t){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var a=c[t],i=!1;a.startsWith("attach:")&&(a=a.replace(/^attach:/gi,""),i=!0),r.getPlugin().loadResource(r.threadAttach.id,e,a,function(){var e=me()(pe.a.mark((function e(t,a){var o,s,l,u;return pe.a.wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(!t){e.next=10;break}if(!i){e.next=8;break}return e.next=4,r._createMessageHTML(r.getPlugin()._decodeEmail(t.data,void 0,{}),{},"text/html");case 4:l=e.sent,s=l.parsed,e.next=9;break;case 8:s=t.data;case 9:o={cid:a,data:s,mimeType:t.mimeType};case 10:try{n&&n.source&&o&&(u=i?"contentLoad":"resLoad",r._sendReply(n.source,u,o?JSON.stringify(o):void 0))}catch(d){m.default.reportError(d)}case 11:case"end":return e.stop()}}}),e)})));return function(t,a){return e.apply(this,arguments)}}())},h=0;h<c.length;++h)d(h)}catch(f){m.default.reportError(f)}break;default:m.default.log("Unknown message from child frame: ",e,t,a,n)}}},{key:"isOpen",value:function(){return this.openOnPane&&this.openOnPane.isExpanded.get()}},{key:"isOpenOnPane",value:function(e){return this.openOnPane===e&&this.openOnPane.isExpanded.get()}},{key:"isOpenOnThread",value:function(e){return this.isOpen()&&this.threadAttach===e}},{key:"close",value:function(){this.isOpen()&&(this.wantsPaneTransition=!0,this.setOpenPane(null),this.reset(),this.wantsPaneTransition=!1,se.a.fireEvent("EmailPreview","onClosed",[]))}},{key:"setOpenPane",value:function(e,t){this.openOnPane&&this.openOnPane!==e&&this.openOnPane.setExpanded(!1,t),this.openOnPane=e,e&&e.setExpanded(!0,t)}},{key:"_openPane",value:function(e,t){var a=this;try{m.default.PAssert(274,t,"Must supply a valid cb to openPane")}catch(n){m.default.reportError(n)}e!==this.openOnPane?(this.wantsPaneTransition=!0,setTimeout((function(){a.wantsPaneTransition=!1,t()}),y.a.EmailOpenTime+100)):t(),this.setOpenPane(e)}},{key:"getPane",value:function(){try{m.default.PAssert(275,this.openOnPane,"Should not be trying to get pane if email preview is not open")}catch(e){m.default.reportError(e)}return this.openOnPane}},{key:"startOpenOnLoad",value:function(e){this.setOpenPane(e,!1)}},{key:"open",value:function(e,t,a,n){t.getPlugin();if(w.a.app&&S.a.featureVersion>=1){var r=null===t||void 0===t?void 0:t.getField("accountID"),i=null===t||void 0===t?void 0:t.getField("service"),o=null===t||void 0===t?void 0:t.id,s=Ue.a.getPluginNew("Email").getAccount(r,i);s&&S.a.openEmail(r,o,i,s.b)}else{var l=bo.pluginManager.getPluginGmail().getURLForAttachment(t);bo.openUrl(l)}}},{key:"_getReplyToFromMessage",value:function(e){return this._selfSentMessage(e)?e.to:e.replyTo?[e.replyTo]:[e.from]}},{key:"_getSenderFromMessage",value:function(e){var t=this.threadAttachLoading||this.threadAttach;return this._findSelf(t.getField("accountID"),e)}},{key:"_selfSentMessage",value:function(e){return this.getPlugin().isMyAccountID(e.from.email)}},{key:"_removeSelf",value:function(e){if(e){for(var t=0,a=e.slice(0),n=this.getPlugin(),r=0;r<a.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n.isMyAccountID(a[r].email)&&(a.splice(r,1),r--)}return a}}},{key:"_findSelf",value:function(e,t){var a,n=this.getPlugin(),r=n.getSendingAccounts(e);if(r.indexOf(t.from.email)>=0)a=t.from.email;else{if(t.to)for(var i=0,o=0;o<t.to.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(r.indexOf(t.to[o].email)>=0){a=t.to[o].email;break}}if(!a&&t.cc)for(var s=0,l=0;l<t.cc.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(r.indexOf(t.cc[l].email)>=0){a=t.cc[l].email;break}}if(!a&&t.bcc)for(var u=0,c=0;c<t.bcc.length;++c){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(r.indexOf(t.bcc[c].email)>=0){a=t.bcc[c].email;break}}}return a||(a=n.getDefaultSendingAccount(e)),{text:n.getDisplayName(a),email:a}}},{key:"_updateDraftFromMessage",value:function(e,t,a){var n,r,i,o,s=this.getPlugin(),l=e.subject,u=this._getSenderFromMessage(e);try{m.default.PAssert(276,a!==y.a.EmailResponseMode.Compose,"Should never pass Compose mode to _updateDraftFromMessage")}catch(d){m.default.reportError(d)}a===y.a.EmailResponseMode.Reply?n=this._getReplyToFromMessage(e):a===y.a.EmailResponseMode.ReplyAll?(n=this._removeSelf(this._getReplyToFromMessage(e).concat(e.to)),r=this._removeSelf(e.cc)):a===y.a.EmailResponseMode.Forward&&(o=Object.assign({},e.resources)),a&&(i=s.createMessageBody(e,t.from.email,a)),n=m.default.arrayUniques(n||[],"email"),r=m.default.arrayUniques(r||[],"email"),a===y.a.EmailResponseMode.Reply||a===y.a.EmailResponseMode.ReplyAll?(0!==l.toLowerCase().indexOf("re")&&(l="Re: "+l),o=t.resources):a===y.a.EmailResponseMode.Forward&&0!==l.toLowerCase().indexOf("fwd")&&(l="Fwd: "+l);var c={id:t.id,to:n,from:u,cc:r,bcc:void 0,subject:l,decoded:i,resources:o||{}};this.getPlugin().updateDraft(this.threadAttach,t.id,t.draftID,c,!0,!1,(function(e){try{m.default.PAssert(277,e,"Should always be able to update a draft")}catch(d){m.default.reportError(d)}}))}},{key:"requestAttachment",value:function(e,t,a,n){this.getPlugin().loadResource(e,t,a,n)}},{key:"getAttachmentURL",value:function(e,t,a){return this.getPlugin().getAttachmentURL(e,t,a)}},{key:"getPreviewURL",value:function(e){return this.getPlugin().getPreviewURL(e)}},{key:"reportMessage",value:function(e,t,a,n,r){this.getPlugin().reportMessage(e,t,a,n,r)}},{key:"dumpMessage",value:function(e,t,a){try{m.default.PAssert(278,!1,"Should not be dumping message in non-__DEV__ modes")}catch(n){m.default.reportError(n)}this.getPlugin().dumpMessage(e,t,a)}},{key:"parseMailtoURL",value:function(e){var t={to:void 0,subject:void 0,body:void 0},a=e.split("?");if(t.to=a[0],a[1])for(var n=0,r=a[1].split("&"),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=r[i].split("=");switch(o[0].toUpperCase()){case"SUBJECT":t.subject=o[1];break;case"BODY":t.body=o[1]}}return t}},{key:"parseListUnsubscribe",value:function(e){for(var t=0,a={emailData:void 0,url:void 0},n=e.split(","),r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=/^<?(http|https|mailto):([^<>]*)>?/gi.exec(n[r]);if(i)switch(i[1]){case"http":case"https":a.url=i[1]+":"+i[2];break;case"mailto":a.emailData=this.parseMailtoURL(i[2]);break;default:try{m.default.PAssert(279,!1,"Unknown List Unsubscribe Format: "+e)}catch(o){m.default.reportError(o)}}}return a}},{key:"setMessageResponseMode",value:function(e,t){var a=this.getMessages(),n=a[a.indexOfWithProperty("id",e)];try{m.default.PAssert(280,n,"Must be able to find a valid reply message to update response mode for")}catch(o){m.default.reportError(o)}if(n){var r,i=this.getPlugin();if(t!==y.a.EmailResponseMode.None){try{m.default.PAssert(281,n.initializedForDisplay,"Must be initialized for display to set response mode")}catch(o){m.default.reportError(o)}r=i.getDraftForMessage(this.threadAttach.getField("accountID"),this.threadAttach.id,e,this._getSenderFromMessage(n)),this._updateDraftFromMessage(n,r,t)}n.responseMode&&n.responseMode.set(t)}}},{key:"setLastMessageResponseMode",value:function(e){if(e){var t=this.getMessages(),a=t[t.length-1];try{m.default.PAssert(282,a,"Setting message response mode when there are no messages")}catch(n){m.default.reportError(n)}a&&this.setMessageResponseMode(a.id,e)}}},{key:"_createErrorHTML",value:function(){var e=me()(pe.a.mark((function e(){return pe.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Be.a.update('<html><body>There was an error loading your mail message.<br><br><a href="moodoAction:reloadMessage">Retry</a></body></html>',{},{},"text/html"));case 1:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"_createMessageHTML",value:function(){var e=me()(pe.a.mark((function e(t,a,n,r){var i,o;return pe.a.wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:if(i={collapseQuotes:!0,replaceLinks:!0,createLinksFromText:!0},r)for(o in r)r.hasOwnProperty(o)&&(i[o]=r[o]);return e.abrupt("return",Be.a.update(t,a,i,n));case 3:case"end":return e.stop()}}}),e)})));return function(t,a,n,r){return e.apply(this,arguments)}}()},{key:"_generateCSS",value:function(){if(!this._cachedCSS){var e={html:{"transform-origin":"0 0"},body:{"overflow-x":"auto","overflow-y":"hidden","font-family":"'Helvetica Neue', Helvetica, Arial, Sans-serif","font-size":"14px","text-rendering":"optimizeLegibility","-moz-font-smoothing":"antialiased","-webkit-font-smoothing":"antialiased","font-smoothing":"antialiased",margin:0},"#moodoAttach":{display:"none"},'[moodoAttach="true"]':{display:"none"},'[quote="collapsed"]':{display:"none"},'[place="true"]':{cursor:"pointer",display:"inline-block",height:"12px",width:"26px","text-align":"center","margin-top":"8px","margin-bottom":"8px",color:"#aaa",border:"1px solid #ddd","background-color":"#f6f6f6","border-radius":"3px"},'[place="true"]:before':{content:'"..."',"line-height":"5px","font-size":"16px","vertical-align":"text-top"}};bo.DisplaySettings.isDark()&&(e.body["-webkit-filter"]="invert(100%) hue-rotate(180deg)",e.img={"-webkit-filter":"invert(100%) hue-rotate(180deg)"});var t="";Object.keys(e).forEach((function(a){t+=a+"{",Object.keys(e[a]).forEach((function(n){var r=e[a][n];t+=n+":"+r+";"})),t+="}"})),this._cachedCSS="<style>"+t+"</style>"}return this._cachedCSS}},{key:"_createFrameBlob",value:function(e,t,a){var n={isApp:w.a.app},r=this._generateCSS(),i="<script>("+Ve+')("'+a+'",'+JSON.stringify(n)+");<\/script>",o="<!DOCTYPE html>";return t='<meta http-equiv="Content-Type" content="'+t+'">',w.a.supportBlobURLIFrame?new Blob([o,"<html>","<head>",t,r,i,"</head>",e,"</html>"],{type:"text/html"}):[o,"<html>","<head>",t,r,i,"</head>",e,"</html>"].join("")}},{key:"onMessageLoaded",value:function(e){this.updateMessageHeight(e),this.messagesLoaded.set(!0)}},{key:"getPreviewIFrame",value:function(e){return document.getElementById("emailPreview_"+e)}},{key:"updateMessageHeight",value:function(e,t,a){var n=this.getPreviewIFrame(e);if(n){var r=this.getMessages(),i=r[r.indexOfWithProperty("id",e)];t&&(n.style.height="0px");try{var o=n.contentDocument.documentElement;if(o){var s=a||i.defaultScale.get(),l=Math.ceil(o.scrollWidth*s),u=Math.ceil(o.scrollHeight*s);t&&u===i.height.get()&&(n.style.height=u+"px"),i.width.set(l),i.height.set(u),a&&i.defaultScale.get()!==a&&i.defaultScale.set(a)}}catch(c){m.default.reportError(c)}}}},{key:"_generateAltParts",value:function(e,t){var a=this.getPlugin().getMessageAttachments(t);if(a)for(var n=0,r=0;r<a.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=a[r];"application/ics"===i.mimeType&&this.getPlugin().loadResource(e.id,t.id,i.cid,(function(e){if(e){var t=je.a.parseICS(m.default.b64_to_utf8(e.data));m.default.log("Parsed ICS Data: ",t)}}))}}},{key:"_computeResponseMode",value:function(e){var t=y.a.EmailResponseMode.None;return e&&e.labelIds.indexOf("DRAFT")>=0&&(t=e.subject.startsWith("Fwd:")?y.a.EmailResponseMode.Forward:e.subject.startsWith("Re:")?1===e.to.length?y.a.EmailResponseMode.Reply:y.a.EmailResponseMode.ReplyAll:y.a.EmailResponseMode.Compose),t}},{key:"_createMessageDisplay",value:function(){var e=me()(pe.a.mark((function e(t,a,n,r){var i,o;return pe.a.wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:try{m.default.PAssert(283,!a.initializedForDisplay,"Should only initialize message for display once")}catch(l){m.default.reportError(l)}try{m.default.PAssert(284,a.to,"Must have a valid to object")}catch(l){m.default.reportError(l)}try{m.default.PAssert(285,a.from,"Mus have a valid from object")}catch(l){m.default.reportError(l)}if(i=!0,!a.decoded){e.next=12;break}return a.isErrorMessage=!1,e.next=8,this._createMessageHTML(a.decoded,a.resources,a.mimeType,r);case 8:(o=e.sent).missingResourceData&&(i=!1),e.next=17;break;case 12:return m.default.reportError(new Error("Missing message decoded data"),"Missing message decoded data: "+m.default.isString(a.decoded)),a.isErrorMessage=!0,e.next=16,this._createErrorHTML();case 16:o=e.sent;case 17:0;try{m.default.PAssert(286,o.parsed,"Must have valid parsed data")}catch(l){m.default.reportError(l)}return a.blob=this._createFrameBlob(o.parsed,a.contentType,a.id),m.default.isString(a.blob)||(a.blobURL&&(w.a.URL.revokeObjectURL(a.blobURL),a.blobURL=void 0),a.blobURL=w.a.URL.createObjectURL(a.blob)),a.specialLinks=o.specialLinks,a.width||(a.width=new P.a(0)),a.height||(a.height=new P.a(0)),a.defaultScale||(a.defaultScale=new P.a(1)),a.responseMode||(a.responseMode=new P.a(this._computeResponseMode(n))),a.initializedForDisplay=!0,i||this.getPlugin().reportMessage(t.getField("accountID"),t.id,a.id,"Error creating display",!1),e.abrupt("return",a);case 29:case"end":return e.stop()}}}),e,this)})));return function(t,a,n,r){return e.apply(this,arguments)}}()},{key:"_destroyMessageDisplay",value:function(e){try{m.default.PAssert(287,e.initializedForDisplay,"Message must first be initialized before being destroyed")}catch(t){m.default.reportError(t)}e.initializedForDisplay=!1,e.isErrorMessage=!1,e.width=void 0,e.height=void 0,e.defaultScale=void 0,e.responseMode&&(e.responseMode=void 0),e.specialLinks=void 0,e.blob=void 0,e.blobURL&&(w.a.URL.revokeObjectURL(e.blobURL),e.blobURL=void 0)}},{key:"ensureDisplayMessages",value:function(){var e=me()(pe.a.mark((function e(t){var a,n=this;return pe.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(t!==this.threadAttach){e.next=11;break}return e.prev=1,a=this.getMessages(),e.next=5,Promise.all(a.map((function(e,r){if(!t.getPlugin().isMessageDraft(e)&&!e.initializedForDisplay){try{n._generateAltParts(t,e)}catch(i){m.default.reportError(i)}return n._createMessageDisplay(t,e,a[r+1],0===r?{collapseQuotes:!1}:void 0)}})));case 5:a.equals(this.messageIDs.get())||this.messageIDs.set(a.map((function(e){return e.id}))),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),m.default.reportError(e.t0);case 11:case"end":return e.stop()}}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getMessages",value:function(){return this.threadAttach&&this.threadAttach.getField("messages")||[]}},{key:"_requestMessageReload",value:function(){var e=me()(pe.a.mark((function e(t,a,n){var r=this;return pe.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:a.getPlugin().forceReloadMessage(a,n,function(){var e=me()(pe.a.mark((function e(i){var o,s,l,u,c;return pe.a.wrap((function(e){for(var d=0,h=0;;){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(e.prev=e.next){case 0:try{m.default.PAssert(288,i,"Must be able to re-load message data")}catch(f){m.default.reportError(f)}if(a!==r.threadAttach){e.next=12;break}if(o=a.getField("messages"),s=o.indexOfWithProperty("id",n),!(l=o[s])){e.next=12;break}if(!(u=r.getPreviewIFrame(t))){e.next=12;break}return l.initializedForDisplay=!1,e.next=11,r.ensureDisplayMessages(a);case 11:w.a.supportBlobURLIFrame?u.src=l.blobURL:((c=u.contentWindow.document).documentElement.innerHTML="",c.open(),c.write(l.blob),c.close());case 12:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"onAttachmentUpdate",value:function(e,t,a){var n=this;(!t||t.indexOf("messages")>=0)&&setTimeout((function(){e.getPlugin().loadThread(e,(function(t,a){try{m.default.PAssert(289,t,"Must be able to re-load thread data")}catch(r){m.default.reportError(r)}a&&e===n.threadAttach&&n.ensureDisplayMessages(e)}))}),0)}},{key:"getThreadAttach",value:function(){return this.threadAttach}},{key:"_setThread",value:function(){var e=me()(pe.a.mark((function e(t,a){var n;return pe.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:try{m.default.PAssert(290,t.hasField("messages"),"Must supply valid messages to the email preview")}catch(i){m.default.reportError(i)}try{m.default.PAssert(291,t.getPlugin().shouldUseNewPlugin(t)||this.errorMessage.get()||t.getField("dataLoaded"),"Must have loaded remote data or have an error")}catch(i){m.default.reportError(i)}if(this.threadAttach&&this.threadAttach.id===t.id){e.next=12;break}return this.reset(),this.threadAttach=t,this.threadItem=a,t.subscribe(this),e.next=9,this.ensureDisplayMessages(t);case 9:(n=t.getPlugin()).attachmentHasLabelByID(t,"UNREAD")&&n.performAction(y.a.PluginAction.Gmail.MarkRead,!0,t),se.a.fireEvent("EmailPreview","openThreadChanged",[]);case 12:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"onSelectedIndexChanged",value:function(e,t,a){this.isOpen()&&t===this.openOnPane&&(a&&a.hasAttachmentType(y.a.PluginType.Email)?a.getAttachmentByType(y.a.PluginType.Email).getPlugin()===this.getPlugin()&&this.getPlugin().openEmailByItem(a,t):"PaneGmail"===t.type&&this.reset())}},{key:"onDisplaySettingsChanged",value:function(){this._cachedCSS=void 0,this.threadAttach&&this.ensureDisplayMessages(this.threadAttach)}}]),e}(),_()(Ae.prototype,"_onWindowResize",[b.a],Object.getOwnPropertyDescriptor(Ae.prototype,"_onWindowResize"),Ae.prototype),Ae);var Ve=function(e,t){!function(){function a(e){console.log("ERROR: ",e)}var n,r=window.InjectedJS={postMessage:function(t,n){try{var r;if(void 0!==n)if("string"===typeof n)r=n;else try{r=JSON.stringify(n)}catch(i){a(i),r=""}else r="";window.parent.postMessage("-"+t+"-"+e+"-"+r,"*")}catch(i){a(i)}}};n=function(e){var a=1;t.isAndroid&&(a=function(e){var t=document.documentElement.clientWidth/e;return Math.max(t,.25)}(document.documentElement.scrollWidth))<1&&(document.documentElement.style.transform="scale("+a+")"),r.postMessage("resize",{canBeShorter:e,scale:a})};var i=!1;function o(){document.removeEventListener("DOMContentLoaded",o,!1),i?n():(i=!0,function(){var e=0,t=0,a=0;document.documentElement.addEventListener("click",(function(e){r.postMessage("click")})),document.addEventListener("keydown",(function(e){var t={type:e.type,keyCode:e.keyCode,charCode:e.charCode,which:e.which,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey};r.postMessage("keypress",t)}),!0);for(var i=function(e){e.stopImmediatePropagation(),e.preventDefault();var t=this.getAttribute("href");return t.startsWith("attach:")?r.postMessage("reqResource",[t]):t.startsWith("moodoAction:")?r.postMessage(t.replace(/^moodoAction:/gi,"")):r.postMessage("href",t),!1},o=document.querySelectorAll("[mlink]"),s=0;s<o.length;++s){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;o[s].addEventListener("click",i)}for(var l=document.querySelectorAll("[place]"),u=0;u<l.length;++u){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;l[u].addEventListener("click",(function(e){for(var t=0,a=this.id,r=this.nextElementSibling,i=!1;r&&r.getAttribute("group")===a;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o="collapsed"===r.getAttribute("quote")?"uncollapsed":"collapsed";"collapsed"===o&&(i=!0),r.setAttribute("quote",o),r=r.nextElementSibling}return setTimeout((function(){n(i)}),0),e.stopImmediatePropagation(),e.preventDefault(),!1}))}for(var c=[],d=document.querySelectorAll("img"),h=0;h<d.length;++h){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var f=d[h].getAttribute("cid");f&&c.push(f),d[h].addEventListener("load",(function(){n()}))}c.length>0&&r.postMessage("reqResource",c)}(),r.postMessage("epLoaded"))}window.addEventListener("message",(function(e){if(e.data&&e.data.startsWith&&e.data.startsWith("-")){var t=e.data.indexOf("-",1),r=e.data.substring(1,t),i=e.data.substring(t+1);switch(r){case"resLoad":try{if(i)for(var o=0,s=JSON.parse(i),l=document.querySelectorAll('[cid="'+s.cid+'"]'),u="data:"+s.mimeType+";base64,"+s.data,c=0;c<l.length;++c){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;l[c].src=u}}catch(h){a(h)}break;case"contentLoad":try{if(i){var d=JSON.parse(i);document.open(),document.write(d.data),document.close(),setTimeout(n,0)}}catch(h){a(h)}break;default:a(new Error("Unknown PreviewFrame message: "+r))}}})),"complete"===document.readyState||"interactive"===document.readyState?setTimeout(o):(document.addEventListener("DOMContentLoaded",o,!1),window.addEventListener("load",o,!1))}()}.toString(),We=He,ze=a(25),qe=function(){function e(){i()(this,e),this._localized=[],this._loadedDateFormat=void 0}return s()(e,[{key:"init",value:function(){var e=this,t=bo.settings.dateFormat.get()||y.a.DateFormat.MDY;this._loadLocalized(t),bo.settings.dateFormat.listen((function(t){e._loadLocalized(t||y.a.DateFormat.MDY),j.a.parseAll(y.a.ChangeType.Auto),bo.PaneUpdateBatcher.updateAllItems(!1,!0)}))}},{key:"parseDate",value:function(e,t){return Date.parse(this.normalizeDateString(e,t))}},{key:"parseDateDefaultFormat",value:function(e){return Date.parse(this.normalizeDateString(e,this.getCurrentDateFormat()))}},{key:"getFormat",value:function(e){try{m.default.PAssert(249,this._localized[e],"Invalid format request")}catch(t){m.default.reportError(t)}return this._localized[e]}},{key:"getCurrentDateFormat",value:function(){return this._loadedDateFormat||y.a.DateFormat.MDY}},{key:"_loadLocalized",value:function(e){if(this._loadedDateFormat=e,this._localized[y.a.DFormat.LongDayTime]="dddd h:mm tt",this._localized[y.a.DFormat.ShortTime]="h:mm tt",this._localized[y.a.DFormat.MonthDay]="MMM d",this._localized[y.a.DFormat.LongStrDate]="MMMM dd, yyyy",this._localized[y.a.DFormat.DayMonthDateYear]="ddd, MMM dd, yyyy",this._localized[y.a.DFormat.MonthDayLong]="MMMM d",this._localized[y.a.DFormat.MonthDayYearLong]="MMMM d, yyyy",e===y.a.DateFormat.MDY)this._localized[y.a.DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[y.a.DFormat.ShortDate]="MM/dd",this._localized[y.a.DFormat.MonthDayYear]="MM/dd/yy",this._localized[y.a.DFormat.MonthDayYearShort]="M/d/yy",this._localized[y.a.DFormat.DayYearTime]="MM/dd/yy h:mm tt",this._localized[y.a.DFormat.DayDate]="ddd M/d",this._localized[y.a.DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[y.a.DFormat.MonthDayShort]="M/d";else if(e===y.a.DateFormat.DMY)this._localized[y.a.DFormat.ShortDayTime]="dd/MM h:mm tt",this._localized[y.a.DFormat.ShortDate]="dd/MM",this._localized[y.a.DFormat.MonthDayYear]="dd/MM/yy",this._localized[y.a.DFormat.MonthDayYearShort]="d/M/yy",this._localized[y.a.DFormat.DayYearTime]="dd/MM/yy h:mm tt",this._localized[y.a.DFormat.DayDate]="ddd d/M",this._localized[y.a.DFormat.NoPadShortDayTime]="dd/M h:mm tt",this._localized[y.a.DFormat.MonthDayShort]="d/M";else if(e===y.a.DateFormat.DMYDot)this._localized[y.a.DFormat.ShortDayTime]="dd.MM h:mm tt",this._localized[y.a.DFormat.ShortDate]="dd.MM",this._localized[y.a.DFormat.MonthDayYear]="dd.MM.yy",this._localized[y.a.DFormat.MonthDayYearShort]="d.M.yy",this._localized[y.a.DFormat.DayYearTime]="dd.MM.yy h:mm tt",this._localized[y.a.DFormat.DayDate]="ddd d.M",this._localized[y.a.DFormat.NoPadShortDayTime]="dd.M h:mm tt",this._localized[y.a.DFormat.MonthDayShort]="d.M";else if(e===y.a.DateFormat.YMD)this._localized[y.a.DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[y.a.DFormat.ShortDate]="MM/dd",this._localized[y.a.DFormat.MonthDayYear]="yy/MM/dd",this._localized[y.a.DFormat.MonthDayYearShort]="yy/M/d",this._localized[y.a.DFormat.DayYearTime]="yy/MM/dd h:mm tt",this._localized[y.a.DFormat.DayDate]="ddd M/d",this._localized[y.a.DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[y.a.DFormat.MonthDayShort]="M/d";else if(e===y.a.DateFormat.YMDDot)this._localized[y.a.DFormat.ShortDayTime]="MM.dd h:mm tt",this._localized[y.a.DFormat.ShortDate]="MM.dd",this._localized[y.a.DFormat.MonthDayYear]="yy.MM.dd",this._localized[y.a.DFormat.MonthDayYearShort]="yy.M.d",this._localized[y.a.DFormat.DayYearTime]="yy.MM.dd h:mm tt",this._localized[y.a.DFormat.DayDate]="ddd M.d",this._localized[y.a.DFormat.NoPadShortDayTime]="M.dd h:mm tt",this._localized[y.a.DFormat.MonthDayShort]="M.d";else try{m.default.PAssert(250,!1,"Unsupport date format requested: "+e)}catch(t){m.default.reportError(t)}}},{key:"formatDate",value:function(e,t,a){try{m.default.PAssert(251,m.default.isDateValid(e),"Must provide a valid date to format")}catch(i){m.default.reportError(i)}try{m.default.PAssert(252,t,"Must provide a valid format for the date")}catch(i){m.default.reportError(i)}var n;if(m.default.isDateValid(e)){var r=e.toString(this.getFormat(t));n=a&&a!==this._loadedDateFormat?this.convertDateFormat(r,this._loadedDateFormat,a):r}return n}},{key:"_isParsedDateValid",value:function(e,t,a){var n=!0,r=m.default.parseInt(e),i=m.default.parseInt(t),o=m.default.parseInt(a);return(void 0!==e&&r<13||i<=0||i>12||o<=0||o>31)&&(n=!1),n}},{key:"_detectDelim",value:function(e){var t="/";return e.indexOf("-")>=0?t="-":e.indexOf(".")>=0&&(t="."),t}},{key:"convertDateFormat",value:function(e,t,a){try{m.default.PAssert(253,t,"Must provide a date format to convert from")}catch(h){m.default.reportError(h)}try{m.default.PAssert(254,a,"Must provide a date format to convert to")}catch(h){m.default.reportError(h)}var n=e;if(t!==a){var r,i,o=0;for(Ke.lastIndex=0,Ge.lastIndex=0,r=t===y.a.DateFormat.YMD||t===y.a.DateFormat.YMDDot?Ke:Ge;null!==(i=r.exec(n));){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var s,l,u,c,d=this._detectDelim(n);if(t===y.a.DateFormat.DMYDot?t=y.a.DateFormat.DMY:t===y.a.DateFormat.YMDDot&&(t=y.a.DateFormat.YMD),a===y.a.DateFormat.MDY)switch(t){case y.a.DateFormat.DMY:i[4]?(l=i[4],s=(u=i[3])+d+(c=i[2])+d+l):i[2]&&i[3]&&(s=(u=i[3])+d+(c=i[2]));break;case y.a.DateFormat.YMD:i[2]?(l=i[2],s=(u=i[3])+d+(c=i[4])+d+l):i[3]&&i[4]&&(s=(u=i[3])+d+(c=i[4]));break;default:try{m.default.PAssert(255,!1,"Invalid date format requested from MDY: ",t)}catch(h){m.default.reportError(h)}}else if(a===y.a.DateFormat.DMY)switch(t){case y.a.DateFormat.MDY:i[4]?(l=i[4],u=i[2],s=(c=i[3])+d+u+d+l):i[2]&&i[3]&&(u=i[2],s=(c=i[3])+d+u);break;case y.a.DateFormat.YMD:i[2]?(l=i[2],u=i[3],s=(c=i[4])+d+u+d+l):i[3]&&i[4]&&(u=i[3],s=(c=i[4])+d+u);break;default:try{m.default.PAssert(256,!1,"Invalid date format requested from DMY: ",t)}catch(h){m.default.reportError(h)}}else if(a===y.a.DateFormat.YMD)switch(t){case y.a.DateFormat.MDY:i[4]?s=(l=i[4])+d+(u=i[2])+d+(c=i[3]):i[2]&&i[3]&&(s=(u=i[2])+d+(c=i[3]));break;case y.a.DateFormat.DMY:i[4]?s=(l=i[4])+d+(u=i[3])+d+(c=i[2]):i[2]&&i[3]&&(s=(u=i[3])+d+(c=i[2]));break;default:try{m.default.PAssert(257,!1,"Invalid date format requested from YMD: ",t)}catch(h){m.default.reportError(h)}}else try{m.default.PAssert(258,!1,"Invalid date format requested: ",a)}catch(h){m.default.reportError(h)}s&&this._isParsedDateValid(l,u,c)&&(n=n.substr(0,i.index)+i[1]+s+n.substr(i.index+i[0].length))}}return n}},{key:"normalizeDateString",value:function(e,t){var a=e;return this.convertDateFormat(a,t,y.a.DateFormat.MDY)}},{key:"getAppendDateText",value:function(e,t,a){var n,r=ze.a.getToday();n=e<r||e.getFullYear()!==r.getFullYear()?this.getFormat(y.a.DFormat.MonthDayYearShort):this.getFormat(y.a.DFormat.MonthDayShort);var i=e.toString(n);if(t instanceof Date)n=0===t.getMinutes()?" htt":" h:mmtt",i+=t.toString(n);else if(m.default.isNumber(t)){var o=Math.floor(t),s=o%12;0===s&&(s=12),i+=" "+s+":"+m.default.pad2(60*(t-o))+(o>11?"pm":"am")}return isNaN(a)||(i+=" "+m.default.round(a,2)+"hr"),i}}]),e}(),Ge=/([\s]|^)(\d{1,2})[-/.](\d{1,2})(?:[-/.](\d{2,4}))?/g,Ke=/([\s]|^)(?:(\d{2,4})[-/.])?(\d{1,2})(?:[-/.](\d{1,2}))/g,Ye=qe,Xe=a(53),Qe=a.n(Xe);function Je(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var Ze=a(61),$e=a(59),et=a(62),tt=a(37);function at(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var nt=a(48),rt=a(75),it=a(78);function ot(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var st,lt=a(88),ut=new Date(9e12),ct=y.a.VMLIFlag,dt=(st=function(){function e(t,a){i()(this,e),ve.a.binder(this,"sizeInPane","onInsertLink"),"dragScroll"in this&&ve.a.binder(this,"dragScroll"),this.__ISVMLI=!0,this.isInitialized=!1;try{m.default.PAssert(918,a,"Each VMLI must be given a set of additional info")}catch(r){m.default.reportError(r)}try{m.default.PAssert(919,m.default.isValidChangeType(a.changeType),"Must specify a valid change type when creating a VMLI")}catch(r){m.default.reportError(r)}try{m.default.PAssert(920,a.store,"Must supply a valid itemStore for each VMLI")}catch(r){m.default.reportError(r)}try{m.default.PAssert(921,!a.parent||a.parent._store===a.store,"All VMLIs in a tree must share the same owner")}catch(r){m.default.reportError(r)}this.__TEMP_InitCalled=!1,this.__TEMP_InitParseCalled=!1,this.__TEMP_ParseCalled=!1,this.__TEMP_SkippedInitParsed=!1;try{m.default.PAssert(922,void 0===t.v,"We should never be passing in 'v'")}catch(r){m.default.reportError(r)}try{m.default.PAssert(923,void 0===t.extern,"We should never be passing in 'extern'")}catch(r){m.default.reportError(r)}try{m.default.PAssert(924,a.store,"Must specify a valid item store this item belongs to")}catch(r){m.default.reportError(r)}this._store=a.store,this._parent=a.parent,this._documentOwner=a.documentOwner,this._rawText=t.text||"",this._searchText=void 0,this._parsedText=void 0,this._notePreviewText=void 0,this.elsNew=void 0,this.id=void 0,this.index=t.index,this.regexpFlags=t.regexpFlags,this._isArchived=t.isArchived||!1,this.items=new te.a([],this.itemsHasMutated),this._note=new P.a,this.itemChanged=new et.a,this._demandLoadChildren=t.demandLoadChildren||!1,this._loadedOnDemandData=!this._demandLoadChildren,this._paginationToken=void 0,this._canDestroy=a.canDestroy||!1,this._destroyed=!1,this._date=void 0,this._attachments=void 0,this.draggedInPane=new P.a;var n=t.flags;t.isNote&&(n|=y.a.VMLIFlag.Note),t.isComplete&&(n|=y.a.VMLIFlag.Complete),t.isStarred&&(n|=y.a.VMLIFlag.Starred),t.priority&&(n|=t.priority),this._cachedFlagProps={},this.flags=new P.a(n),this._updateCachedFlagProps(n),this.prefix=void 0,this._favorites=void 0,this.dateCreated=t.dateCreated?new Date(t.dateCreated):new Date,this.dateCompleted=t.dateCompleted?new Date(t.dateCompleted):void 0,this.dateModified=t.dateModified?new Date(t.dateModified):this.dateCreated,this._activeTags=void 0,this.isRoot=t.isRoot||a.isRoot,this._isDeleted=t.isDeleted||!1,this.highlightTimeout=void 0,this._version=y.a.UninitializedVersion,this._versionText=y.a.UninitializedVersion,this._versionRemote=void 0,this._versionRemoteText=void 0,this.lastFindPass=0,this.isEditable=new P.a(a.isEditable||!1),this.levelsDeep=new P.a(this._parent?this._parent.levelsDeep.get()+1:0),this.isHighlighted=new P.a,m.default.totalItems++,t.isArchived&&m.default.totalArchivedItems++,this._needsParse=!1,this.isLoaded=void 0,this.init(t,a),this.isInitialized=!0}return s()(e,[{key:"getReactKey",value:function(){return this._store.id+this.id}},{key:"notifyDemandLoadUpdate",value:function(e,t){e&&!this._loadedOnDemandData&&(t.requestDemandLoadData(this),this.notifyLoadedData())}},{key:"notifyLoadedData",value:function(){this._loadedOnDemandData=!0}},{key:"notifyLoadDataFailed",value:function(e){this.setCollapsed(!1,e,!1),this._loadedOnDemandData=!1}},{key:"isDemandLoad",value:function(){return this._demandLoadChildren}},{key:"isDemandNotYetLoaded",value:function(){return this._demandLoadChildren&&!this._loadedOnDemandData}},{key:"showInOverview",value:function(){return this.numItems()>0||this._demandLoadChildren}},{key:"paginationTokenInUse",value:function(){try{m.default.PAssert(925,this._paginationToken,"Should always have a valid pagination token when beginning to load a data page")}catch(e){m.default.reportError(e)}return this._paginationToken.isInUse()}},{key:"hasPaginationToken",value:function(){return!!(this.flags.get()&y.a.VMLIFlag.HasPageToken)}},{key:"needsPaginationToken",value:function(){return!this.hasPaginationToken()&&!this._paginationToken}},{key:"setPaginationToken",value:function(e){try{m.default.PAssert(926,e,"Should never be setting an undefined token - use clear instead")}catch(t){m.default.reportError(t)}try{m.default.PAssert(927,!this._paginationToken,"Should never be overriding a pagination token - clear then set")}catch(t){m.default.reportError(t)}this._paginationToken=e,this.setFlags(this.flags.get()|y.a.VMLIFlag.HasPageToken)}},{key:"clearPaginationToken",value:function(){this._paginationToken&&this._paginationToken.isInUse()&&this._paginationToken.notifyEndUse(),this._paginationToken=void 0,this.setFlags(this.flags.get()&~y.a.VMLIFlag.HasPageToken)}},{key:"beginDataPageLoad",value:function(){try{m.default.PAssert(929,this._paginationToken,"Should always have a valid pagination token when beginning to load a data page")}catch(e){m.default.reportError(e)}try{m.default.PAssert(930,!this._paginationToken.isInUse(),"Token should not already be in use when beginning a page load")}catch(e){m.default.reportError(e)}return this._paginationToken.notifyBeginUse(),this._paginationToken}},{key:"endDataPageLoad",value:function(e){try{m.default.PAssert(932,this._paginationToken,"Should always have a valid pagination token when done loading a data page")}catch(t){m.default.reportError(t)}try{m.default.PAssert(933,this._paginationToken.isInUse(),"Token should always be in use when running a request")}catch(t){m.default.reportError(t)}e?this._paginationToken.notifyEndUse():this.setFlags(this.flags.get()&~y.a.VMLIFlag.HasPageToken)}},{key:"canHaveNote",value:function(){var e=this.belongsToItemStore(bo.itemStoreManager.getDefaultItemStore()),t=this.belongsToItemStore(bo.itemStoreManager.getTempItemStore());return e||t}},{key:"createNote",value:function(){try{m.default.PAssert(934,!this.isNote(),"Should never create a note on a note item")}catch(t){m.default.reportError(t)}var e;return this.hasNote()?e=this.getNote():(e=this._store.createItemRaw({id:void 0,text:"",isNote:!0},{parent:this,documentOwner:this._documentOwner,changeType:y.a.ChangeType.AllLocal}),this.setNote(e,y.a.ChangeType.Local)),e}},{key:"hasNote",value:function(){return void 0!==this._note.get()}},{key:"getNote",value:function(){try{m.default.PAssert(935,this.hasNote(),"Must have a note to get one")}catch(e){m.default.reportError(e)}return this._note.get()}},{key:"getNoteIfExists",value:function(){return this._note.get()}},{key:"setNote",value:function(t,a){try{m.default.PAssert(936,m.default.isValidChangeType(a),"Must supply a valid changeType")}catch(r){m.default.reportError(r)}try{m.default.PAssert(937,!t||this.belongsToSameItemStore(t),"Note must belong to the same item store")}catch(r){m.default.reportError(r)}try{m.default.PAssert(938,!this.isNote(),"Should never set a note on a note")}catch(r){m.default.reportError(r)}try{m.default.PAssert(939,!this._note.get()||!t,"Should never set a note multiple times on a single item")}catch(r){m.default.reportError(r)}try{m.default.PAssert(940,!t||t.isNote(),"Should only set items that are notes as notes")}catch(r){m.default.reportError(r)}try{m.default.PAssert(941,!t||!t.isDeleted(),"Should note set a deleted note")}catch(r){m.default.reportError(r)}try{m.default.PAssert(942,!t||t instanceof e,"Note must be a valid VMLI")}catch(r){m.default.reportError(r)}try{m.default.PAssert(943,!t||t.parent()===this,"Should always have a valid parent set before setting note on item")}catch(r){m.default.reportError(r)}var n=this._note.get();lt.a.animateNext(),this._note.set(t),this.shouldSave()&&j.a.setNote(this,t,n,a)}},{key:"isNote",value:function(e){return this._cachedFlagProps.isNote}},{key:"shouldSave",value:function(){return this._shouldSave}},{key:"canDestroy",value:function(){return this._canDestroy}},{key:"getPadding",value:function(e,t,a){try{m.default.PAssert(947,e,"Invalid pane")}catch(n){m.default.reportError(n)}return this.isNote()?this.parent().getPadding(e,t,a):bo.DisplaySettings.getPaddingForLevel(a,t)}},{key:"_updateStylePadding",value:function(e,t){try{m.default.PAssert(948,this._parent,"Must have a valid parent to update padding, root should never change")}catch(s){m.default.reportError(s)}var a=e+(this.isNote()?0:1),n=this.levelsDeep.get()!==a;if(n||t){var r=0;n&&this.levelsDeep.set(a);for(var i=this.getItems(),o=0;o<i.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i[o]._updateStylePadding(a,t)}}}},{key:"setFlags",value:function(e){this._updateCachedFlagProps(e),this.flags.set(e)}},{key:"_updateCachedFlagProps",value:function(e){this._cachedFlagProps={isComplete:!!(e&ct.Complete),isStarred:!!(e&ct.Starred),isNote:!!(e&ct.Note),isDisplayComplete:!!(e&ct.DisplayComplete)}}},{key:"getPriorityProps",value:function(){var e=this.flags.get();return y.a.PriorityClass[e&y.a.PMask]+" "}},{key:"styleProps",value:function(e,t){var a=this.flags.get(),n=this.isHeader()&&!e.isViewFlatList()?"pHeader ":"";e.isItemBold(this)&&(n+="font-bold "),this.prefix&&(n+="hasPrefix ",this.isPrefixCodeBlock()&&(n+="codeBlock rounded "));var r=!1;if((a&y.a.VMLIFlag.Complete||!(a&y.a.VMLIFlag.Note)&&a&y.a.VMLIFlag.DisplayComplete)&&(r=!0),r?(n+="pComplete ",e.search.isMatchStuckHiding(this)||(n+="pDisplayComplete c-foreground-super-faded c-before-super-faded ")):!t&&a&y.a.PMask?n+=y.a.PriorityClass[a&y.a.PMask]+" ":n+="pNormal ",a&y.a.VMLIFlag.Starred&&!(a&y.a.VMLIFlag.Complete||a&y.a.VMLIFlag.DisplayComplete)&&(n+="pStar c-star "),a&y.a.VMLIFlag.Note){n+="pNote c-foreground-faded ";var i=this.parent().flags.get();(i&y.a.VMLIFlag.Complete||i&y.a.VMLIFlag.DisplayComplete)&&(n+="pComplete c-foreground-super-faded c-before-super-faded "),i&y.a.PMask&&(n+=y.a.PriorityClass[i&y.a.PMask]+" "),i&y.a.VMLIFlag.Starred&&!(i&y.a.VMLIFlag.Complete||i&y.a.VMLIFlag.DisplayComplete)&&(n+="pStar c-star ")}var o=this.getAttachments();if(o)for(var s=0,l=0;l<o.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var u=o[l];if(u.isLoaded()){var c=u.getPlugin().getCssClass(u,e);c&&(n+=c)}}return n}},{key:"onAttachmentIDChange",value:function(e,t){if(e.getPlugin().id===y.a.PluginID.GCalendar){var a=this.getMooDate();a&&(a.setGCalId(e.id),this.onMooDateUpdated(y.a.ChangeType.Local,!0))}this.setTextToWhatItAlreadyIs(y.a.ChangeType.Local)}},{key:"onAttachmentUpdate",value:function(e,t,a){var n=e.getPlugin();if(n===bo.pluginManager.getPluginGCalendar()){var r=this.getMooDate();if(r&&!r.getGCalCalendar()&&e.hasField("calendarID")){var i=e.getField("calendarID");if(r.setGCalCalendar(i),this.shouldSave()){var o={date:this._date?this._date.toData():null};j.a.saveItem(this,o,y.a.ChangeType.Local,y.a.SaveFlag.Text)}}}else n===bo.pluginManager.getPluginGmail()&&t&&(t.includes("accountID")||t.includes("subject"))&&this.onAttachInlineUpdate();t&&e.fieldsHaveParseEffect(t)&&(this.parseText(this.getRawText(),a),Ze.a.beginBatch(this),Ze.a.itemTextChanged(this))}},{key:"setAttachments",value:function(e,t,a){var n=!1;if(!this._attachments&&e&&(this._attachments=[]),this._attachments){for(var r=0,i=0,o=this._attachments,s=0;s<o.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e.indexOf(o[s])<0&&(o[s].unsubscribe(this),o[s].notifyItemTextChanged(this,!0),this.shouldSave()&&o[s].markUnused(t),n=!0)}for(var l=0;l<e.length;++l){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var u=e[l];if(o.indexOf(u)<0){if(u.shouldBeDeleted()){var c=u.getEmbedString(),d=this.getRawText().replace(c,"File failed to upload");return void this.setText(d,y.a.ChangeType.Local)}u.subscribe(this),this.shouldSave()&&u.markInUse(t),n=!0}}n&&(this._attachments=e)}n&&!1!==a&&this.itemChanged.notify()}},{key:"getAttachment",value:function(e){try{m.default.PAssert(949,this._attachments,"Must have valid attachments in order to query")}catch(t){m.default.reportError(t)}if(this._attachments)return this._attachments[e]}},{key:"hasAttachment",value:function(e){if(this._attachments)for(var t=0,a=0;a<this._attachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._attachments[a].id===e)return!0}return!1}},{key:"hasPluginAttachment",value:function(e){try{m.default.PAssert(950,e,"Must provide a valid plugin type to query")}catch(n){m.default.reportError(n)}if(this._attachments)for(var t=0,a=0;a<this._attachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._attachments[a].getPlugin().id===e)return!0}return!1}},{key:"getAttachmentByType",value:function(e){try{m.default.PAssert(951,e,"Must provide a valid plugin type to query")}catch(r){m.default.reportError(r)}if(this._attachments)for(var t=0,a=0;a<this._attachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this._attachments[a];if(n.isType(e))return n}}},{key:"getAttachmentByPlugin",value:function(e){try{m.default.PAssert(952,e,"Must provide a valid plugin type to query")}catch(r){m.default.reportError(r)}if(this._attachments)for(var t=0,a=0;a<this._attachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this._attachments[a];if(n.isPlugin(e))return n}}},{key:"getAttachments",value:function(){if(this._attachments&&this._attachments.length>0)return this._attachments}},{key:"hasAttachments",value:function(){return this._attachments&&this._attachments.length>0}},{key:"getNumAttachments",value:function(){return this._attachments?this._attachments.length:0}},{key:"hasAttachmentType",value:function(e){return bo.pluginManager.hasAttachmentType(this,e)}},{key:"copyProperties",value:function(e){this.setStarred(e.isStarred(),y.a.ChangeType.Auto),this.setComplete(e.isComplete(),y.a.ChangeType.Auto),this.setPriority(e.getPriority(),y.a.ChangeType.Auto)}},{key:"moveNote",value:function(e,t){try{m.default.PAssert(953,e.hasNote(),"Must have a note to move")}catch(n){m.default.reportError(n)}try{m.default.PAssert(954,!this.hasNote(),"Must not already have a note")}catch(n){m.default.reportError(n)}var a=e.getNote();e.setNote(void 0,t),a&&(a.setParent(this),this.setNote(a,t))}},{key:"parent",value:function(){return this._parent}},{key:"setParent",value:function(e){var t=this._parent;return this._parent=e,e&&e!==t&&this._updateStylePadding(this._parent.levelsDeep.get(),!1),this._parent}},{key:"requireStoredEls",value:function(){var e=this.getItemStore();return!!e&&e.requireStoredEls()}},{key:"getItemStore",value:function(){try{m.default.PAssert(955,this._store,"Should never be getting the item store from a destroyed VMLI")}catch(e){m.default.reportError(e)}return this._store}},{key:"belongsToSameItemStore",value:function(e){return this.getItemStore()===e.getItemStore()}},{key:"belongsToItemStore",value:function(e){return this.getItemStore()===e}},{key:"notifyItemPropertyChanged",value:function(e,t){if(this.hasAttachments())for(var a=0,n=this.getAttachments(),r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n[r].notifyItemPropertyChanged(this,e,t)}}},{key:"unArchive",value:function(e){this._documentOwner.unArchiveItem(this,e)}},{key:"archiveSelf",value:function(e){try{m.default.PAssert(956,this._documentOwner,"Trying to archive item without a document")}catch(t){m.default.reportError(t)}this._documentOwner&&this._documentOwner.archiveItem(this,e)}},{key:"isArchived",value:function(){return this._isArchived}},{key:"setArchived",value:function(e,t){this._isArchived=e}},{key:"isHidden",value:function(e){try{m.default.PAssert(957,e,"Must specify the pane for the item being checked")}catch(t){m.default.reportError(t)}try{m.default.PAssert(958,!e||e.search,"Pane search obj must exist: ",e.isDestroyed())}catch(t){m.default.reportError(t)}return!(!e||!e.search)&&!e.search.isMatched(this)}},{key:"getRawText",value:function(){return this._rawText}},{key:"getParsedText",value:function(){try{m.default.PAssert(959,!1===this._needsParse,"Text should be parsed before calling get")}catch(e){m.default.reportError(e)}return void 0!==this._parsedText?this._parsedText:this._rawText}},{key:"getSearchText",value:function(e){if(e){var t=e.search.getItemSearchText(this);if(t)return t}return void 0===this._searchText&&(this._searchText=this.generateSearchText()),this._searchText}},{key:"setRawText",value:function(e){void 0!==e&&null!==e||(e="");try{m.default.PAssert(960,e.indexOf(y.a.AttachChar)<0,"Should never have an AttachChar present in raw text")}catch(t){m.default.reportError(t)}this._rawText=e,this._searchText=void 0,this._parsedText=void 0,this._notePreviewText=void 0,this._needsParse=!0}},{key:"setParsedText",value:function(e){this._parsedText=e,this._needsParse=!1}},{key:"setElsNew",value:function(e){this.elsNew=e,this.isLoaded&&(this._searchText=this.generateSearchText())}},{key:"generateSearchText",value:function(){return this.elsNew.getDisplayText(this,{showMarkdown:!1,noPrefix:!0,noDates:!0,noDataImages:!0,linkedItemDepth:0}).toLowerCase()}},{key:"getPriority",value:function(e){if(e){var t=e.search.getItemPriority(this);if(void 0!==t)return t}return this.flags.get()&y.a.PMask}},{key:"setPriority",value:function(e,t){try{m.default.PAssert(962,m.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(r){m.default.reportError(r)}try{m.default.PAssert(963,null===e||y.a.PriorityClass[e],"Priority must be defined in globals")}catch(r){m.default.reportError(r)}if(e!==this.getPriority()){var a=this.flags.get()&~y.a.PMask|e;if(this.setFlags(a),this.shouldSave()){var n={flags:a};j.a.saveItem(this,n,t,y.a.SaveFlag.Text)}this.notifyItemPropertyChanged(t,"priority"),Ze.a.itemPriorityChanged(this),bo.onIntroAction("Priority")}}},{key:"isScheduled",value:function(){return!!this._date}},{key:"getDuration",value:function(e,t){if(e){var a=e.search.getItemDuration(this);if(a)return a}if(this._date)return this._date.duration||y.a.DefaultEventDuration}},{key:"setDuration",value:function(e){this._date?this._date.setDuration(e):this._date=new $e.a(void 0,{duration:e})}},{key:"getEndDate",value:function(e){if(this._date)return this._date.getEnd()}},{key:"isMultidayEvent",value:function(){var e=!1;if(this.getDate()&&this.getDuration()>0){var t=this.getEndDate();ze.a.isSameDay(this.getDate(),t)||(e=!0)}return e}},{key:"getStickySearchInfo",value:function(){return{prefix:this.getPrefix(),date:this.getDate(),duration:this.getDuration(),tagsLower:this.getTagsLower(),contacts:this.getContacts(),searchText:this.getSearchText(),priority:this.getPriority(),isComplete:this.isComplete(),isStarred:this.isStarred()}}},{key:"onMooDateUpdated",value:function(e,t){var a=this;if(bo.timeline.updateNotifications(this),t||m.default.isFlagSet(e,y.a.ChangeType.ItemLoad)||Ze.a.itemDateChanged(this),this.itemChanged.notify(),this.shouldSave()||this._attachments){var n={date:this._date?this._date.toData():null};this.shouldSave()&&j.a.saveItem(this,n,e,y.a.SaveFlag.Text),!t&&this._attachments&&m.default.isLocalChange(e)&&this._attachments.forEach((function(e){e.getPlugin().id===y.a.PluginID.GCalendar&&e.notifyItemDateChanged(a)}))}}},{key:"setMooDate",value:function(e,t,a){if(e!==this._date){this._date&&e?this._date.copyFrom(e,a):this._date=e;var n=this.getRawText();this.onMooDateUpdated(t),!e&&n.includes(y.a.CharDate)&&(n=m.default.trimRight(n.replace(new RegExp(y.a.CharDate,"g"),"").replace(/' {2}'/g," ")),this.setText(n,t))}}},{key:"setDate",value:function(e,t,a){if(this._date)e!==this._date.getDate()&&(this._date.setDate(e),this._date.setDuration(t),this.onMooDateUpdated(a));else if(this.setMooDate(new $e.a(e),a,[]),this.getRawText().indexOf(y.a.CharDate)<0){this.getParsedText();this.setText(this.getParsedText()+" "+y.a.CharDate,y.a.ChangeType.Local)}}},{key:"getMooDate",value:function(){return this._date}},{key:"getNextDate",value:function(e){return this._date?this._date.getNext(e):void 0}},{key:"getDate",value:function(e){if(e){var t=e.search.getItemDate(this);if(t)return t}return this._date?this._date.getDate():void 0}},{key:"allDayDate",value:function(){return!!this._date&&!this._date.getTime()}},{key:"_setFlagHelper",value:function(e,t){var a=t?this.flags.get()|e:this.flags.get()&~e;this.setFlags(a)}},{key:"isDeleted",value:function(){return this._isDeleted}},{key:"setDeleted",value:function(e,t){try{m.default.PAssert(964,m.default.isValidChangeType(t),"Must supply a valid changetype to delete an item: "+t)}catch(i){m.default.reportError(i)}if(this._isDeleted=e,e&&(e!==this._isDeleted&&this.shouldSave()&&j.a.deleteItem(this.parent(),this,t),this._attachments)){for(var a=0,n=this._attachments,r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e?(n[r].unsubscribe(this),this.shouldSave()&&n[r].markUnused(t)):(n[r].subscribe(this),this.shouldSave()&&n[r].markInUse(t))}e&&(this._attachments=[])}}},{key:"isImportant",value:function(e){return this.getPriority(e)}},{key:"forceComplete",value:function(e,t){return this.setComplete(e,t,!0)}},{key:"isDisplayComplete",value:function(){return this._cachedFlagProps.isDisplayComplete}},{key:"computeDisplayComplete",value:function(){var e=this.parent(),t=e&&!this.isComplete()&&(e.isComplete()||e.isDisplayComplete());this._setFlagHelper(y.a.VMLIFlag.DisplayComplete,t)}},{key:"propagateDisplayComplete",value:function(){var e=0;this.computeDisplayComplete();for(var t=0;t<this.numItems();t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.itemAtIndex(t);a.isComplete()||a.propagateDisplayComplete()}}},{key:"isComplete",value:function(){return this._cachedFlagProps.isComplete}},{key:"setComplete",value:function(e,t,a){var n=e,r={};try{m.default.PAssert(965,m.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(o){m.default.reportError(o)}if(e){var i=!1;this.isRepeatDate()&&this._date.complete()&&(i=!0,this.onMooDateUpdated(t),Ze.a.itemRepeatDateCompleted(this),n=!1,bo.toasts.pushMessage({text:"Completed. Next occurrence: "+ze.a.toHumanText(this._date.getNext()),action:y.a.MessageAction.Undo,hold:!1})),i||this.dateCompleted||(this.dateCompleted=new Date,r.dateCompleted=this.getDateCompletedTime()),m.default.isLocalChange(t)&&m.default.aggregateEvent("ItemCompleted")}else this.dateCompleted=void 0,r.dateCompleted=null,!0;this._setFlagHelper(y.a.VMLIFlag.Complete,n),m.default.isRemoteChange(t)||(r.flags=this.flags.get(),this.shouldSave()&&j.a.saveItem(this,r,t,y.a.SaveFlag.Text),bo.onIntroAction("Complete")),this.notifyItemPropertyChanged(t,"isComplete"),this.propagateDisplayComplete(),bo.timeline.updateNotifications(this),Ze.a.itemCompleteChanged(this),Ze.a.itemSearchChanged(this)}},{key:"setStarred",value:function(e,t){if(void 0!==e){try{m.default.PAssert(966,m.default.isValidChangeType(t),"Must supply a valid changetype when completing an item: "+t)}catch(i){m.default.reportError(i)}if(e!==this._cachedFlagProps.isStarred){var a=this.flags.get(),n=e?a|y.a.VMLIFlag.Starred:a&~y.a.VMLIFlag.Starred;this.setFlags(n);var r={flags:n};this.shouldSave()&&j.a.saveItem(this,r,t,y.a.SaveFlag.Text),this.notifyItemPropertyChanged(t,"isStarred"),Ze.a.itemPriorityChanged(this)}}}},{key:"isStarred",value:function(e){if(e){var t=e.search.getItemStarred(this);if(void 0!==t)return t}return this._cachedFlagProps.isStarred}},{key:"isHeader",value:function(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)}},{key:"getVisibleChildren",value:function(e){if(!this.isNote()){for(var t=0,a=this.getItems(),n=[],r=0;r<a.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a[r].isHidden(e)||n.push(a[r])}return n}}},{key:"hasVisibleChildren",value:function(e){if(this.isNote())return!1;for(var t=0,a=this.getItems(),n=0;n<a.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!a[n].isHidden(e))return!0}return!1}},{key:"hasHeaderChildren",value:function(){if(this.isNote())return!1;for(var e=0,t=this.getItems(),a=0;a<t.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(t[a].isHeader())return!0}return!1}},{key:"getCollapsedField",value:function(e,t){return t?y.a.PerPaneStateField.CollapsedOverview:e.collapsedFieldName}},{key:"isCollapsed",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{m.default.PAssert(967,e,"Must specify the pane for the item being checked for collapsed")}catch(n){m.default.reportError(n)}if(!e||!t&&!e.canCollapse()||this.isNote())return!1;var a=e.isSearchedText()?e.getPerPaneState(this.id,y.a.PerPaneStateField.CollapsedSearch):void 0;return void 0===a&&void 0===(a=e.getPerPaneState(this.id,this.getCollapsedField(e,t)))&&(a=this.isDemandLoad()?0===this.numItems()||!e.isSearched()&&!t:e.getCollapsedDefault(this,t)),!!a}},{key:"setCollapsed",value:function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3?arguments[3]:void 0;try{m.default.PAssert(968,t,"Must specify the pane for the item being checked for collapsed")}catch(i){m.default.reportError(i)}if(!t||e&&!this.isCollapsible())return!1;var r=this.isCollapsed(t,a);void 0!==e&&(t.isSearchedText()&&t.setPerPaneState(this.id,y.a.PerPaneStateField.CollapsedSearch,void 0),t.setPerPaneState(this.id,this.getCollapsedField(t,a),e),!1!==n&&bo.PaneManager.updatePaneStateForPane(t),a?t.updateHeaders():(bo.onIntroAction("Collapse"),this.isDemandLoad()&&this.notifyDemandLoadUpdate(!e,m.default.focusedPane),e!==r&&t.updateItems())),this.itemChanged.notify()}},{key:"setCollapsedQuiet",value:function(e,t){t.setPerPaneState(this.id,this.getCollapsedField(t,!1),e)}},{key:"toggleCollapsed",value:function(e){try{m.default.PAssert(969,e,"Must specify the pane that this item is being collapsed in")}catch(t){m.default.reportError(t)}this.setCollapsed(!this.isCollapsed(e),e)}},{key:"isCollapsible",value:function(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)}},{key:"isDraggable",value:function(){return!this.isNote()}},{key:"setTags",value:function(e,t){var a=this._activeTags&&!e&&this._activeTags||!this._activeTags&&e&&e||m.default.arrayDiff(this._activeTags,e);this._activeTags=e,this._activeTagsLower=e?e.map((function(e){return e.toLowerCase()})):void 0,a&&a.length>0&&!m.default.isFlagSet(t,y.a.ChangeType.ItemLoad)&&Ze.a.itemTagsChanged(this,a)}},{key:"getTags",value:function(){return this._activeTags}},{key:"getTagsLower",value:function(e){if(e){var t=e.search.getItemTagsLower(this);if(t)return t}return this._activeTagsLower}},{key:"setContacts",value:function(e,t){var a=!(this._activeContacts&&e&&this._activeContacts.equals(e));if(this._activeContacts=e,a&&!m.default.isFlagSet(t,y.a.ChangeType.ItemLoad))return!0}},{key:"getContacts",value:function(e){if(e){var t=e.search.getItemContacts(this);if(t)return t}return this._activeContacts}},{key:"hasCompletedAncestor",value:function(){for(var e=0,t=this.parent();t;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(t.isComplete())return!0;t=t.parent()}}},{key:"hasTime",value:function(){return this._date&&!!this._date.getTime()}},{key:"getTimeOfDay",value:function(){return this._date?this._date.getTime():this.dateCompleted?this.dateCompleted.getTimeOfDay():0}},{key:"_formatDateTime",value:function(e){return e.toString(bo.International.getFormat(y.a.DFormat.ShortTime))}},{key:"getDisplayDateWithDuration",value:function(e,t){var a=this,n=this.getDate(t);if(n){var r=this.getEndDate(t);+ze.a.clearTime(n)===+n||+ze.a.clearTime(r)===+n&&(n=r)}else if(this.isRepeatDate()){var i=this.getMooDate();i&&(n=i.getNext(e))}if(!m.default.isDemoMode())try{m.default.PAssert(970,n,"No display date with duration",(function(){return a.getMooDate()&&a.getMooDate().toData()}))}catch(o){m.default.reportError(o)}return n}},{key:"getTime",value:function(){var e="",t=this.getNextDate();if(this.dateCompleted&&this.isComplete())e=this._formatDateTime(this.dateCompleted);else if(t){var a;if(t.hasTimeOfDay())this.getDuration()>0&&(a=this.getDisplayDateWithDuration()),a?a.equals(t)?e=[this._formatDateTime(t),this._formatDateTime(this.getEndDate())]:a.equals(this.getEndDate())&&(e="Ends "+this._formatDateTime(this.getEndDate())):e=this._formatDateTime(t)}return e}},{key:"createDateString",value:function(e){return e.isBefore(ze.a.getTodayPlusDays(7))?e.toString(bo.International.getFormat(y.a.DFormat.LongDayTime)):e.toString(bo.International.getFormat(y.a.DFormat.ShortDayTime))}},{key:"fullTime",value:function(){var e=this.getDate();if(!e)return"";this.createDateString(e)}},{key:"init",value:function(e,t){this._shouldSave=!(t&&t.noSave);try{m.default.PAssert(971,!this._shouldSave||!this._demandLoadChildren,"Should never be saving results of demand loaded items")}catch(r){m.default.reportError(r)}if(this.id=e.id||j.a.generateID(),e.date&&"undefined"!==e.date){var a=e.date instanceof $e.a?e.date.clone():$e.a.fromData(e.date);a?this._date=a:m.default.reportError(new Error("Initial invalid date: "+e.date))}e.dateCompleted&&(this.dateCompleted=new Date(e.dateCompleted)),this.computeDisplayComplete(),(e.items&&e.items.length>0||e.note)&&this.initItems(e.items,e.note,t.changeType),this.__TEMP_InitCalled=!0;try{m.default.PAssert(972,t,"Missing required properties in extraInfo")}catch(r){m.default.reportError(r)}var n=t?t.changeType:y.a.ChangeType.Auto;try{m.default.PAssert(973,m.default.isValidChangeType(n),"Must supply a valid changetype to VMLIs")}catch(r){m.default.reportError(r)}(this.__TEMP_InitParseCalled=!0,this.shouldSave()&&!m.default.isAutoChange(t.changeType))?(m.default.isLocalChange(t.changeType)?y.a.SaveFlag.All:y.a.SaveFlag.None,this.getItemStore().trackGlobally()&&j.a.setItem(this)):this.getItemStore().trackGlobally()&&j.a.setItem(this);this.parseText(this.getRawText(),t.changeType|y.a.ChangeType.ItemLoad),m.default.isLocalChange(t.changeType)&&m.default.aggregateEvent("ItemCreated")}},{key:"onLoad",value:function(e){this.isLoaded||(!this.isDemandLoad()||this.isCollapsed(e,!1)||e.isSearched()||this.notifyDemandLoadUpdate(!0,e),this.isLoaded=!0)}},{key:"destroy",value:function(e){try{m.default.PAssert(974,this._canDestroy||e,"VMLI must be explicitly marked as destroyable")}catch(i){m.default.reportError(i)}try{m.default.PAssert(975,e||!this.shouldSave()||m.default.isDemoMode(),"Should never destroy a saveable VMLI")}catch(i){m.default.reportError(i)}var t=this.getItemStore();if(this._destroyed=!0,this._attachments){for(var a=0,n=this._attachments,r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n[r].unsubscribe(this)}this._attachments=void 0}t.trackGlobally()&&j.a.clearItem(this.id),this.items.unlisten(this.itemsHasMutated),Ze.a.itemSearchChanged(this),this._store=void 0}},{key:"isDestroyed",value:function(){return this._destroyed}},{key:"isFullscreen",value:function(){return m.default.focusedItem===this}},{key:"findItem",value:function(e){var t=this.getIndexOf(e.id);if(t>=0)return{index:t,arr:this.items,isArchived:!1}}},{key:"setItems",value:function(e){for(var t=0,a=this.items.get(),n=a.length>0,r=!1,i=0;i<e.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=e[i],s=a.indexOfWithProperty("id",o.id);if(s>=0){var l=a[s];o.items&&l.setItems(o.items)}else a.push(this._store.createItemRaw(o,{documentOwner:this._documentOwner,parent:this,changeType:y.a.ChangeType.Auto})),r=!0}r&&(n&&a.sort(tt.a.compareItemIndex),this.items.set(a),this.itemsHasMutated())}},{key:"initItems",value:function(t,a,n){var r=!1;if(t&&t.length>0){var i=0;try{m.default.PAssert(976,!this.hasChildren(),"Update items should only be called from initialize when there are no items already loaded")}catch(g){m.default.reportError(g)}for(var o=0;o<t.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=t[o],l=void 0;if(s instanceof e?l=s:m.default.isString(s)&&(l=j.a.getItem(s)),l){var u=j.a.getItem(l.parent().id);if(u&&u.id!==this.id){var c=u.items.indexOf(l.id);try{m.default.PAssert(979,-1===c,"Expect that the old parent has been notified")}catch(g){m.default.reportError(g)}var d=l.getIndex();d>-1&&l.parent().removeChildAtIndex(d,n)}l.setParent(this)}else if("object"!==Qe()(s)){var h=j.a.getItemDataLocal(this._documentOwner,s);try{m.default.PAssert(977,h,"Referenced item doesn't exist",s)}catch(g){m.default.reportError(g)}h&&(l=this._store.createItemRaw(h,{documentOwner:this._documentOwner,parent:this,changeType:n}),this.checkMismatchedDocument(l,h))}else{try{m.default.PAssert(978,s,"Item must exist otherwise we arent creating anything")}catch(g){m.default.reportError(g)}s&&(l=this._store.createItemRaw(s,{documentOwner:this._documentOwner,parent:this,changeType:n}),this.checkMismatchedDocument(l,s))}try{m.default.PAssert(980,l,"There must be a model at this point")}catch(g){m.default.reportError(g)}if(l){if(l.isNote()){a=l.id;continue}r=!0,this.items.push(l)}}}if(a){try{m.default.PAssert(981,!this._note.get(),"Must not already have a valid note set")}catch(g){m.default.reportError(g)}try{m.default.PAssert(982,m.default.isString(a)||m.default.isObject(a),"Note must be a valid ID")}catch(g){m.default.reportError(g)}var f;if(m.default.isString(a)){if(!(f=j.a.getItem(a))){var p=j.a.getItemDataLocal(this._documentOwner,a);try{m.default.PAssert(983,p,"Referenced note doesn't exist",a)}catch(g){m.default.reportError(g)}p&&(p.isDeleted?f=null:(p=Object.assign({isNote:!0},p),f=this._store.createItemRaw(p,{documentOwner:this._documentOwner,parent:this,changeType:n}),this.checkMismatchedDocument(f,p)))}}else m.default.isObject(a)&&(f=this._store.createItemRaw(a,{documentOwner:this._documentOwner,parent:this,changeType:n}));try{m.default.PAssert(984,void 0!==f,"Must have a valid note VM at this point")}catch(g){m.default.reportError(g)}f&&(this._note.set(f),r=!0)}r&&this.itemsHasMutated()}},{key:"addItemAtIndex",value:function(e,t,a){try{m.default.PAssert(985,a,"Must pass pane when adding item at index")}catch(r){m.default.reportError(r)}var n=a.createVMLI(e,{documentOwner:this._documentOwner,parent:this,changeType:y.a.ChangeType.AllLocal,isEditable:!0});return this.insertItem(n,t),this.isCollapsed(a,!1)&&this.setCollapsed(!1,a),n}},{key:"insertItem",value:function(e,t,a){try{m.default.PAssert(986,!this.isNote(),"Notes cannot use this function")}catch(n){m.default.reportError(n)}try{m.default.PAssert(987,e,"Must specify a valid item to be inserted")}catch(n){m.default.reportError(n)}try{m.default.PAssert(988,this!==e,"Should not insert an item into itself")}catch(n){m.default.reportError(n)}try{m.default.PAssert(989,this.belongsToSameItemStore(e),"Items must belong to the same item store")}catch(n){m.default.reportError(n)}this!==e&&(isNaN(t)||t<0?this.items.push(e):this.items.splice(t,0,e),this.shouldSave()&&j.a.addItem(this,e,t,a))}},{key:"insertSorted",value:function(e,t,a){try{m.default.PAssert(990,!this.isNote(),"Notes cannot use this function")}catch(r){m.default.reportError(r)}try{m.default.PAssert(991,e,"Must specify a valid item to be inserted")}catch(r){m.default.reportError(r)}try{m.default.PAssert(992,t,"Must supply a valid comparator")}catch(r){m.default.reportError(r)}try{m.default.PAssert(993,this.belongsToSameItemStore(e),"Items must belong to the same item store")}catch(r){m.default.reportError(r)}var n=this.items.insertSorted(e,t,a);this.shouldSave()&&j.a.addItem(this,e,n)}},{key:"moveTo",value:function(t,a){var n=t.parent,r=t.index,i=t.shouldBeArchived;try{m.default.PAssert(994,n instanceof e,"New parent must be a valid VMLI")}catch(f){m.default.reportError(f)}void 0===r&&(r=-1),void 0===i&&(i=!1);var o=this.parent(),s=o.findItem(this),l=this.index;if(s)if(n.getDocumentOwner().getBacking()!==o.getDocumentOwner().getBacking())bo.toasts.pushMessage({text:"Moving items between local and synced documents is not yet supported. Please copy and paste these items for now."});else{var u=r;if(o===n){if(s.index===u)return;s.index<u&&u--}lt.a.animateNext(this.id),bo.PaneUpdateBatcher.beginUpdateItems(),s.arr.splice(s.index,1);var c=n.items;u<0?c.push(this,!1):c.splice(u,0,this,!1);var d=n.getDocumentOwner(),h=this.getDocumentOwner();d!==h&&this.forEachChildRecursive((function(e){return e.setDocumentOwner(d)}),!0,!0),this.setParent(n),c.notify(),this.hasNote()&&this.getNote().itemChanged.notify(),bo.PaneUpdateBatcher.commitUpdateItems(),Ze.a.itemSearchChanged(this),Ze.a.itemIndentChanged(this);try{m.default.PAssert(995,this.shouldSave(),"Item must be marked as saveable")}catch(f){m.default.reportError(f)}try{m.default.PAssert(996,o.shouldSave(),"Old parent must be marked as saveable")}catch(f){m.default.reportError(f)}try{m.default.PAssert(997,this.parent().shouldSave(),"New parent must be marked as saveable")}catch(f){m.default.reportError(f)}this.shouldSave()&&(j.a.moveItem(this,o,l,a),d!==h&&this.forEachChildRecursive((function(e){return j.a.moveItemDocument(e,h.id,a)}),!0)),o!==n&&(o.propagateDisplayComplete(),n.propagateDisplayComplete()),this.isInitialized&&this.isPrefixNumList()&&se.a.fireEvent("numListChanged",[])}else bo.toasts.pushMessage({text:"Error moving item"})}},{key:"getItemsArrayForSave",value:function(){var e=0;try{m.default.PAssert(998,!this.isNote(),"Notes cannot use this function")}catch(r){m.default.reportError(r)}for(var t=[],a=this.getItems(),n=0;n<a.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t.push(a[n].id)}return t}},{key:"getDateTime",value:function(){if(this.getDate())return this.getDate().getTime()}},{key:"getDateCompletedTime",value:function(){if(this.dateCompleted)return this.dateCompleted.getTime()}},{key:"isForceCompleted",value:function(){return!(!this.dateCompleted||!this.dateCompleted.equals(ut))}},{key:"getMetaTextSaveData",value:function(){this.getDate();return{date:this._date?this._date.toData():void 0,dateCompleted:this.getDateCompletedTime()}}},{key:"_generateNotificationEntry",value:function(e,t){var a=new Date(e);try{m.default.PAssert(999,m.default.isDateValid(a),"Must provide a valid alert date: "+e)}catch(n){m.default.reportError(n)}return a=e.hasTimeOfDay()?a.addMinutes(-bo.settings.notificationDelay.get()):ze.a.clearTime(a.addDays(-1)).addHours(17),{id:this.id,text:this.generateTitleText(void 0,!0),date:e,alertDate:a,endDate:t}}},{key:"getNotificationEntry",value:function(){try{m.default.PAssert(1e3,this.getNextDate(),"Must have a valid date")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1001,!this.allDayDate(),"All day dates should not be scheduled")}catch(t){m.default.reportError(t)}if(!this.allDayDate())try{var e=this.getNextDate();if(e&&e>new Date)return this._generateNotificationEntry(e,this.getEndDate())}catch(a){return void m.default.reportError(a)}}},{key:"getDebugData",value:function(){return{id:this.id,parent:this._parent?this._parent.id:void 0,items:this.isNote()?void 0:this.getItemsArrayForSave(),text:this.getRawText(),note:this.hasNote()?this.getNote().id:void 0,isNote:this.isNote(),isDeleted:this.isDeleted()}}},{key:"getFullSaveData",value:function(e,t){var a=this;try{m.default.PAssert(1002,e||this.shouldSave(),"Item must be marked as saveable")}catch(o){m.default.reportError(o)}var n=this.flags.get();try{m.default.PAssert(1003,this._documentOwner,"Item has no document")}catch(o){m.default.reportError(o)}var r={id:this.id,index:this.index,text:this.getRawText(),date:this._date?this._date.toData():void 0,dateCreated:this.dateCreated.getTime(),dateModified:this.dateModified.getTime(),dateCompleted:this.getDateCompletedTime(),flags:n||void 0,isRoot:this.isRoot,docId:this._documentOwner?this._documentOwner.id:void 0,note:this.hasNote()?this.getNote().id:void 0,isArchived:this.isArchived()||void 0,isDeleted:void 0,parent:this.parent()?this.parent().id:void 0,regexpFlags:this.regexpFlags};if(Object.keys(r).forEach((function(e){void 0===r[e]&&delete r[e]})),this.isNote()&&(r.text=r.text.replace(/\n/g,"<br>")),t){var i=this.elsNew.elements.reduce((function(e,t){var n=t.props.itemLink;return n&&e.push({id:n,text:t.getStyledText(a)}),e}),[]);i&&i.length>0&&(r.itemLinks=i)}return r}},{key:"highlight",value:function(){var e=this;this.highlightTimeout?(this.isHighlighted.set(!1),clearTimeout(this.highlightTimeout),this.highlightTimeout=void 0,setTimeout((function(){e.isHighlighted.set(!0)}),0)):this.isHighlighted.set(!0),this.highlightTimeout=setTimeout((function(){e.isHighlighted.set(!1)}),2e3)}},{key:"removeChild",value:function(e,t){try{m.default.PAssert(1004,!this.isNote(),"Notes cannot use this function")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1005,!e.isNote(),"Do not use remove child to remove notes from items")}catch(a){m.default.reportError(a)}return this.items.remove(e)}},{key:"removeChildAtIndex",value:function(e,t){try{m.default.PAssert(1006,!this.isNote(),"Notes cannot use this function")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1007,!this.itemAtIndex(e).isArchived())}catch(a){m.default.reportError(a)}this.items.removeAt(e)}},{key:"_moveChildrenHelper",value:function(e,t){var a=e.newParent,n=e.index,r=e.isArchived;try{m.default.PAssert(1008,void 0!==a&&void 0!==r,"_moveChildrenHelper is missing parameters")}catch(c){m.default.reportError(c)}var i=this.getItems();if(i.length>0){var o=0,s=a.getItems();!r&&(isNaN(n)||n<0)&&(n=s.length);for(var l=0;i.length>0;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=i[0];try{m.default.PAssert(1009,u!==a,"Should never be reparenting to a child")}catch(c){m.default.reportError(c)}u.moveTo({parent:a,index:n+l,shouldBeArchived:r},t),l++}}}},{key:"moveChildren",value:function(e,t,a){try{m.default.PAssert(1010,!this.isNote(),"Notes cannot use this function")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1011,this.id!==e.id,"Do not use moveChildren to move a child to the same parent")}catch(n){m.default.reportError(n)}e.parent()===this&&this.removeChild(e,a),bo.PaneUpdateBatcher.beginUpdateItems(),this._moveChildrenHelper({newParent:e,index:t,isArchived:!1},a),this._moveChildrenHelper({newParent:e,index:t,isArchived:!0},a),bo.PaneUpdateBatcher.commitUpdateItems()}},{key:"deleteSelf",value:function(e){this.parent()&&this.parent().deleteChild(this,void 0,void 0,e)}},{key:"deleteChild",value:function(e,t,a,n,r){try{m.default.PAssert(1012,e,"Must provide a valid child to delete")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1013,!this.isNote(),"Notes cannot use this function")}catch(u){m.default.reportError(u)}if(bo.PaneUpdateBatcher.beginUpdateItems(),e.isNote())this.setNote(void 0,n);else if(e.hasChildren())if(t)e.moveChildren(t,a,n);else for(var i=0,o=e.getItems(),s=o.length-1;s>=0;s--){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e.deleteChild(o[s],void 0,void 0,n,!0)}e.hasNote()&&e.getNote().setDeleted(!0,n);if(e.setAttachments([],n),!e.isDeleted())if(e.isNote()||r||this.removeChild(e,n),this._documentOwner)this._documentOwner.deleteItem(e,n,r);else{var l=this.getItemStore();l&&l.destroyItem(e.id)}e.notifyItemPropertyChanged(n,"isDeleted"),Ze.a.itemItemsChanged(this),bo.timeline.updateNotifications(e),bo.PaneUpdateBatcher.commitUpdateItems()}},{key:"unDelete",value:function(e){if(this._documentOwner.unDeleteItem(this,e),this.hasNote()){var t=this.getNote();t.isDeleted()&&this._documentOwner.unDeleteItem(t,e)}}},{key:"replaceChild",value:function(e,t,a){try{m.default.PAssert(1014,!this.isNote(),"Notes cannot use this function")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1015,!e.isNote(),"Old child should not be a note")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1016,!t.isNote(),"New child should not be a note")}catch(r){m.default.reportError(r)}var n=e.getIndex();this.items.removeAt(n),j.a.deleteItem(this,e,a),t.moveTo({parent:this,index:n},a),e.moveChildren(t,t.numChildren(),a),t.parent().id!==this.id&&t.parent().items.remove(t)}},{key:"forEachChildRecursive",value:function(e,t,a){a&&e(this),t&&this.hasNote()&&e(this.getNote()),this.items.forEach((function(a){return a.forEachChildRecursive(e,t,!0)}))}},{key:"getChildren",value:function(){if(!this.isNote())return this.hasNote()?[this.getNote()].concat(this.getItems()):this.getItems()}},{key:"getChild",value:function(e){try{m.default.PAssert(1017,!this.isNote(),"Notes cannot use this function")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1018,e>=0,"Child index is out of range: ",e)}catch(t){m.default.reportError(t)}try{m.default.PAssert(1019,e<this.numItems(),"Child index out of range: ",e,this.numItems())}catch(t){m.default.reportError(t)}return this.itemAtIndex(e)}},{key:"getFirstChild",value:function(){try{m.default.PAssert(1020,!this.isNote(),"Notes cannot use this function")}catch(e){m.default.reportError(e)}return this.hasChildren()?this.itemAtIndex(0):void 0}},{key:"isFirstChild",value:function(){try{m.default.PAssert(1021,!this.isNote(),"Notes cannot use this function")}catch(e){m.default.reportError(e)}return!!this.parent()&&this.parent().getFirstChild()===this}},{key:"getLastChild",value:function(){try{m.default.PAssert(1022,!this.isNote(),"Notes cannot use this function")}catch(e){m.default.reportError(e)}return this.hasChildren()?this.itemAtIndex(this.numItems()-1):void 0}},{key:"isLastChild",value:function(){try{m.default.PAssert(1023,!this.isNote(),"Notes cannot use this function")}catch(e){m.default.reportError(e)}return!!this.parent()&&this.parent().getLastChild()===this}},{key:"isDescendantOf",value:function(e){for(var t=0,a=this.parent();a&&a!==e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a=a.parent()}return void 0!==a}},{key:"hasChild",value:function(e){return this.getIndexOf(e.id)>=0}},{key:"getChildIndex",value:function(e){try{m.default.PAssert(1024,!this.isNote(),"Notes cannot use this function")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1025,!e.isNote(),"Should not get the index of an item note")}catch(t){m.default.reportError(t)}return this.getIndexOf(e.id)}},{key:"getIndexOf",value:function(e){try{m.default.PAssert(1026,!this.isNote(),"Notes cannot use this function")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1027,m.default.isString(e),(function(){return"ID must be a valid string: "+m.default.getObjectInfo(e)}))}catch(i){m.default.reportError(i)}var t=-1,a=this.getItems();if(a)for(var n=0,r=0;r<a.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(a[r].id===e){t=r;break}}return t}},{key:"getIndex",value:function(){try{m.default.PAssert(1028,!this.isNote(),"Should never be getting a child index of a note")}catch(e){m.default.reportError(e)}return this.parent().getChildIndex(this)}},{key:"indexInItemFromStringIndex",value:function(e){var t={index:e},a=this.items.get(),n=a.findIndex((function(e){return tt.a.compareItemIndex(e,t)>0}));return n>=0?n:a.length}},{key:"hasChildren",value:function(){return!this.isNote()&&this.numItems()>0}},{key:"numChildren",value:function(){try{m.default.PAssert(1029,!this.isNote(),"Notes cannot use this function")}catch(e){m.default.reportError(e)}return this.numItems()}},{key:"canZoom",value:function(){return!this.isNote()&&(this.numChildren()>0||this.getParsedText().length>0)}},{key:"parents",value:function(e){for(var t=0,a=[],n=this.parent();n&&n!==e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a.splice(0,0,n),n=n.parent()}return a}},{key:"getSiblings",value:function(e){try{m.default.PAssert(1030,!this.isNote(),"Notes cannot use this function")}catch(o){m.default.reportError(o)}e=e||0;var t=[];if(this.parent())for(var a=0,n=this.parent().getItems(),r=e,i=n.length;r<i;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n[r]!==this&&t.push(n[r])}return t}},{key:"nextSibling",value:function(){var e=this.getIndex();return this.parent().getItems()[e+1]}},{key:"isRootItem",value:function(){var e=this.getItemStore();return!!e&&e.isRoot(this)}},{key:"clone",value:function(e,t){var a=0;try{m.default.PAssert(1031,!m.default.isAutoChange(t),"Cloning should always be a user action")}catch(s){m.default.reportError(s)}for(var n=e.getItemStore().createItemRaw({id:void 0,text:this.getRawText(),isComplete:this.isComplete(),date:this._date?this._date.clone():void 0,priority:this.getPriority(),isStarred:this.isStarred(),isNote:this.isNote()},{parent:e,documentOwner:e.getDocumentOwner()||this._documentOwner,changeType:t}),r=0;r<this.numItems();++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=this.itemAtIndex(r).clone(n,t);n.insertItem(i)}if(this.hasNote()){var o=this.getNote().clone(n,t);n.setNote(o,t)}return n}},{key:"getItems",value:function(){return this.items.get()}},{key:"itemAtIndex",value:function(e){return this.items.get()[e]}},{key:"numItems",value:function(){return this.items.length()}},{key:"itemsHasMutated",value:function(){try{m.default.PAssert(1032,!this._destroyed,"Item should not fire mutation events once destroyed: ",this.id)}catch(e){m.default.reportError(e)}!this._destroyed&&this.isInitialized&&Ze.a.itemItemsChanged(this)}},{key:"numChildrenRecursive",value:function(){var e=0,t={item:this,each:function(t){e++}};return m.default.searchVMLIs(t),e}},{key:"isOnDate",value:function(e){return!!this._date&&this._date.isOnDate(e)}},{key:"getCalendarColor",value:function(){var e,t=bo.pluginManager.getPluginGCalendar();if(this.isComplete())e="#ddd";else if(this.hasAttachmentType(y.a.PluginType.Calendar)&&t.isEnabled()&&t.isAvailable()){var a=this.getAttachmentByType(y.a.PluginType.Calendar);e=t.getCalendarBackgroundColor(a.getField("calendarID"))}else e="rgba(0, 153, 221, 0.85)";return e}},{key:"getCalendarDisplayProps",value:function(){var e,t=bo.pluginManager.getPluginGCalendar();if(this.hasAttachmentType(y.a.PluginType.Calendar)&&t.isEnabled()&&t.isAvailable()){var a=this.getAttachmentByType(y.a.PluginType.Calendar);e=t.getCalendarDisplayProps(a.getField("calendarID"))}return e}},{key:"allowTextEditing",value:function(){return!0}},{key:"getPreviousItem",value:function(){var e=this.parent(),t=e.getChildIndex(this);if(t>0)return e.getChild(t-1)}},{key:"isRepeatDate",value:function(){return this._date&&this._date.isRepeatDate()}},{key:"getDocumentOwner",value:function(){return this._documentOwner}},{key:"setDocumentOwner",value:function(e){this._documentOwner=e}},{key:"onAttachInlineUpdate",value:function(){this.setTextToWhatItAlreadyIs(y.a.ChangeType.Local)}},{key:"setDateModified",value:function(e){this.dateModified=e,Ze.a.itemModifiedChanged(this)}},{key:"getDisplayText",value:function(e){var t;return(null===(t=this.elsNew)||void 0===t?void 0:t.getDisplayText(this,e))||""}},{key:"getHTML",value:function(e,t){return this.elsNew.getHTML(this,e,t)}},{key:"getPlaintext",value:function(e,t){return this.elsNew.getPlaintext(this,e,t)}},{key:"hasItemLinks",value:function(){var e;return(null===(e=this._itemsLinked)||void 0===e?void 0:e.length)>0}},{key:"getItemsLinkedTo",value:function(){return this._itemsLinkedTo}},{key:"addLinkedTo",value:function(e){this._itemsLinkedTo||(this._itemsLinkedTo=[]),this._itemsLinkedTo.push(e)}},{key:"removeLinkedTo",value:function(e){this._itemsLinkedTo||(this._itemsLinkedTo=[]),this._itemsLinkedTo.remove(e)}},{key:"setItemsLinked",value:function(e){var t=this;this._itemsLinked&&this._itemsLinked.forEach((function(a){e&&!e.includes(a.id)&&a.removeLinkedTo(t)})),e&&j.a.isLoadedLocal.onValue(!0,(function(){var a=e.map((function(e){if(!t._itemsLinked||!t._itemsLinked.find((function(t){return t.id===e}))){var a=j.a.getItem(e);if(a)return a.addLinkedTo(t),a}}));t._itemsLinked=a.filter((function(e){return!!e}))}))}},{key:"checkDeleteProblem",value:function(){var e;if((null===(e=this._itemsLinkedTo)||void 0===e?void 0:e.length)>0)return"linked to another item"}},{key:"checkMismatchedDocument",value:function(e,t){}}]),e}(),_()(st.prototype,"itemsHasMutated",[b.a],Object.getOwnPropertyDescriptor(st.prototype,"itemsHasMutated"),st.prototype),st);ve.a.extendClass(dt,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ft,t=function(e){d()(a,e);var t=ot(a);function a(){return i()(this,a),t.apply(this,arguments)}return s()(a,[{key:"_runAndGetSaveData",value:function(e,t){var a=this.shouldSave()&&this.getMetaTextSaveData();this.regexpFlags=void 0;var n,r=this.getRawText();if(this.setRawText(this.generateSaveText(e)),this.parseText(r,t),this.shouldSave()){var i=this.getMetaTextSaveData();for(var o in n={},i)a[o]!==i[o]&&(n[o]=i[o])}return n}},{key:"setText",value:function(e,t){var a=this.isPrefixCodeBlock()||e.startsWith(y.a.Prefix.CodeBlock);try{m.default.PAssert(1249,m.default.isLocalChange(t)||!e||e.indexOf(y.a.AttachChar)<0,"Should never be setting text with an attach char in it")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1250,this.isNote()||a||!e||e.indexOf("\n")<0,"Non-notes should never have newlines")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1251,!e||m.default.isRemoteChange(t)||e.indexOf(y.a.TextSpace)<0,"Should never insert text space into item when editing locally")}catch(i){m.default.reportError(i)}t|=y.a.ChangeType.Text;var n=this.isPrefixHeader();!this.isNote()&&!a&&e&&e.indexOf("\n")>=0&&(e=e.replace(/\n/g," ")),Ze.a.beginBatch(this);var r=this._runAndGetSaveData(e,t);this.shouldSave()&&(r.text=this.generateSaveText(e),r.regexpFlags=this.regexpFlags,j.a.saveItem(this,r,t,y.a.SaveFlag.Text)),Ze.a.itemTextChanged(this),this.isPrefixHeader()!==n&&Ze.a.itemHeaderChanged(this),Ze.a.commitBatch(this)}},{key:"setTextFromEls",value:function(e){var t=this.elsNew.getRawText();this.setText(t,e)}},{key:"sizeInPane",value:function(e,t,a){if(a)return y.a.OverviewItemHeightDesktop;if(this.isNote()){var n=e.objectAtIndex(t);return bo.DisplaySettings.lineItemHeight(n,1)}var r=e.objectAtIndex(t),i=this.metricsInPane(e,t).height;return this.shouldShowParents(r,e)&&(i+=y.a.HeightAgendaParents),i}},{key:"shouldShowParents",value:function(e,t){return t.type===y.a.PaneMode.Task&&e.item&&!t.isViewFlatList()&&(t.isViewTag()||t.isViewAgenda()||t.isViewContact()||t.isViewPriority())&&!e.item.isNote()&&0===e.levelsDeepNew()&&e.item.getItemStore()===bo.itemStoreManager.getDefaultItemStore()&&e.item.parent()!==t.getItem()}},{key:"generateSaveText",value:function(e){return void 0!==e&&null!==e?this._generateUsableText(e,"getEmbedString"):null}},{key:"generateTitleText",value:function(e,t){var a=this.parent();return e&&!a?e.titleOfFirstItem():!a&&this.getDocumentOwner()?this.getDocumentOwner().text.get():(this.elsNew?this.elsNew.getDisplayText(this,{showMarkdown:!1,noPrefix:!0,noDates:t}):this.getParsedTextWithoutPrefix()).trim()}},{key:"_generateUsableText",value:function(e,t,a,n){var r=this;try{m.default.PAssert(1252,this.hasAttachments()||e.indexOf(y.a.AttachChar)<0,"Should either have attachments or no embedded attachment chars")}catch(l){m.default.reportError(l)}var i=e;if(this.hasAttachments()&&e.indexOf(y.a.AttachChar)>=0){var o=a||0,s=this.getNumAttachments();i=e.replace(new RegExp(y.a.AttachChar,"g"),(function(){if(o<s){var e=r.getAttachment(o);return o++,!e.isLoaded()&&!e.hasInlineData()||n&&e.getPlugin().id===y.a.PluginID.Date?"":e[t]()}try{m.default.PAssert(1253,!1,"Unable to find valid attachment for AttachChar")}catch(l){m.default.reportError(l)}return""}));try{m.default.PAssert(1254,i.indexOf(y.a.AttachChar)<0,"Should convert all attachments to their string form")}catch(l){m.default.reportError(l)}}return i}},{key:"parseText",value:function(e,t,a){if(!this._isParsing){try{m.default.PAssert(1255,!this.isDestroyed(),"Must not parse a destroyed VMLI")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1256,m.default.isValidChangeType(t),"Must specify a valid changetype")}catch(l){m.default.reportError(l)}var n;this._isParsing=!0;try{var r,i;this.__TEMP_ParseCalled=!0,i=this.isNote()?(r=rt.a.parseNoteNew(this)).elsNew:(r=rt.a.runParseTextNew(this,a)).elsNew,this.isInitialized&&nt.a.beginAction();var o=this.isPrefixNumList();if(n=this.styleText(r,e,t,i),this.isInitialized){var s;if(this.itemChanged.notify(),this.isNote())null===(s=this.parent())||void 0===s||s.itemChanged.notify();this.isInitialized&&this.isPrefixNumList()!==o&&se.a.fireEvent("numListChanged",[]),nt.a.endAction()}}catch(u){m.default.reportError(u)}return this._isParsing=!1,n}}},{key:"styleText",value:function(e,t,a,n){try{m.default.PAssert(1257,m.default.isValidChangeType(a),"Must specify a valid changetype")}catch(S){m.default.reportError(S)}var r=!1,i=[];if(e){this.prefix=e.prefix;var o=(!t.includes(y.a.CharDate)||this.getRawText().includes(y.a.CharDate))&&this.getMooDate();if(o&&""!==e.parsedText){var s=o.getGCalId();if(s){var l=o.getGCalCalendar();e.attachments||(e.attachments=[]);var u=e.attachments.indexOfWithProperty("p",y.a.PluginID.GCalendar);u>=0&&e.attachments.splice(u,1),e.attachments.push({p:y.a.PluginID.GCalendar,id:s,calendarID:l,hasInlineData:!0})}}if(e.attachments||this.hasAttachments()){for(var c=0,d=[],h=0;e.attachments&&h<e.attachments.length;++h){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var f=e.attachments[h];f.p===y.a.PluginID.Date&&(f.id=this.id);var p=bo.pluginManager.getAttachment(f,f.hasInlineData);p&&(d.push(p),m.default.isLocalChange(a)&&!p.getOldID()&&i.push(p))}r=!0,this.setAttachments(d,a,!1)}(e.itemLinks||this._itemsLinked&&this._itemsLinked.length>0)&&this.setItemsLinked(e.itemLinks),this.setParsedText(e.parsedText);try{m.default.PAssert(1258,e.elsNew||m.default.isFlagSet(a,y.a.ChangeType.ItemLoad),"Must always return an els list")}catch(S){m.default.reportError(S)}n&&this.setElsNew(n),(e.tags||this._activeTags)&&this.setTags(e.tags,a),(e.contacts||this._activeContacts)&&this.setContacts(e.contacts,a)&&(r=!0),this.regexpFlags=e.regexpFlags;var g=this.getRawText();!(t&&this.getMooDate()&&t.includes(y.a.CharDate))||g&&g.includes(y.a.CharDate)||this.setMooDate(void 0,a,!0)}if(this.isInitialized){if(i.length>0)for(var v=0,k=0;k<i.length;k++){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;i[k].notifyItemTextChanged(this,!1)}if(m.default.isLocalChange(a)&&this.isNote()&&this.parent().hasAttachments())for(var _=0,b=this.parent().getAttachments(),w=0;w<b.length;++w){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;b[w].notifyItemNoteChanged(this)}r&&this.itemChanged.notify()}return!1}},{key:"getCalendarRawText",value:function(){return this.getRawText().replace(/^ +/g,"").replace(/ +$/g,"")}},{key:"getCalendarParsedText",value:function(){return this.getDisplayText({showMarkdown:!1,noPrefix:!0,noDates:!0}).trim()}},{key:"getUnstyledText",value:function(){var e=this;return this.elsNew.elements.map((function(t){return t.getStyledText(e)})).join("")}},{key:"getStyledTextAsOneLine",value:function(e,t,a){var n,r=this.getDocumentOwner();if(this.isRoot&&r)return r.text.get();t&&(n='<span class="numChildren c-foreground-super-faded">'+this.numItems()+"</span>");var i=this.elsNew.elements;return a&&(i=i.filter(this.overviewElsFilter)),bo.ElementRenderer.renderNew(i,this,void 0,{convertSpaces:!1,noPrefix:e,suffix:n,noFormat:a})}},{key:"overviewElsFilter",value:function(e){return!e.props.date&&!e.props.prefixType}},{key:"hasText",value:function(){var e=this.getParsedText();return(e=e.replace(/ /g,"")).length>0}},{key:"hasTextWithoutPrefix",value:function(){var e=this.getParsedTextWithoutPrefix();return(e=e.replace(/ /g,"")).length>0}},{key:"setPrefix",value:function(e){var t=this.getRawText(),a=this.getPrefix();a&&(t=t.substr(a.length)),this.prefix=e,t=(e?e+" ":"")+t,this.setText(t,y.a.ChangeType.Local)}},{key:"getPrefix",value:function(){return this.prefix?this.prefix+" ":""}},{key:"getPrefixLength",value:function(){return this.prefix?this.prefix.length+1:0}},{key:"isPrefixHeader",value:function(e){var t;return e&&(t=e.search.getItemPrefix(this)),void 0===t&&(t=this.prefix),t&&(t[0]===y.a.Prefix.Header||t[0]===y.a.Prefix.Header2)}},{key:"isPrefixTask",value:function(){return this.prefix&&m.default.isPrefixTask(this.prefix)}},{key:"isPrefixBullet",value:function(){return this.prefix&&this.prefix===y.a.Prefix.Bullet||this.prefix===y.a.Prefix.Bullet2}},{key:"isPrefixNumList",value:function(){return!!(this.prefix&&+this.prefix[0]>=0&&+this.prefix[0]<10)}},{key:"isPrefixCodeBlock",value:function(){var e;return null===(e=this.prefix)||void 0===e?void 0:e.startsWith(y.a.Prefix.CodeBlock)}},{key:"hasPrefix",value:function(){return!!this.prefix}},{key:"numListNumber",value:function(){if(this.isPrefixNumList()){for(var e=0,t=1,a=this.parent(),n=this.getIndex()-1;n>=0;--n,++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=a.getChild(n);if(!r||!r.isPrefixNumList())break}return t}}},{key:"shouldCopyPrefix",value:function(){return this.isPrefixTask()||this.isPrefixBullet()||this.isPrefixNumList()}},{key:"getParsedTextWithoutPrefix",value:function(){var e=this.getPrefix(),t=this.getParsedText();return e?t.substr(e.length):t}},{key:"applyFormatToSelection",value:function(e,t,a,n,r){a+=this.getPrefixLength(),n+=this.getPrefixLength(),"toggle"===r&&(r=this.elsNew.displayRangeHasFormat(e,t,a,n)?"no":"yes");var i,o="yes"===r||null;if(bo.settings.showMarkdown.get()&&n-a===0){var s=y.a.Markdown[e];this.elsNew.insertEl(new it.a(s+s),t,a),i=a+s.length}else this.elsNew.insert(a,n-a,Z()({},e,o),t);var l=this.elsNew.getRawText();return this.setText(l,y.a.ChangeType.Local),void 0!==i&&N.a.selectObject(t,i-this.getPrefixLength()),"yes"===r}},{key:"insertLinkAtSelection",value:function(){var e=N.a.getStartIndex();if(N.a.isValid()&&e===N.a.getEndIndex()){var t,a,n=N.a.getStartOffset(),r=N.a.getStartOffsetWithPrefix(),i=N.a.getEndOffsetWithPrefix(),o=N.a.getEndTotal(),s=N.a.getStartObject(),l=s.getDisplayText();if(r!==i)t=l.substr(r,i-r);else if(l.length>0&&n>=0&&n<=o){var u=s.item.elsNew.elementAtOffset(s,n),c=u&&u.props.link;c&&(a=c.href,t=c.text)}bo.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:N.a.getEndElement(),onInsertLink:this.onInsertLink,text:t,href:a})}}},{key:"onInsertLink",value:function(e,t){var a=e.text,n=e.href,r=e.isUpdate;if(N.a.isValid()&&N.a.getStartIndex()===N.a.getEndIndex()){t&&!a&&(a=n);var i=N.a.getStartOffset(),o=N.a.getStartOffsetWithPrefix(),s=N.a.getEndOffsetWithPrefix(),l=N.a.getStartObject(),u=l.getDisplayText().substr(o,s-o),c=s+a.length-u.length,d=n&&m.default.isUrlImage(n);if(r){var h=l.item.elsNew.elementAtOffset(l,i);if(h&&h.props.link)if(n){h.props.link.text=a,h.props.link.href=n;var f=l.item.elsNew.findElement(l,(function(e){return e===h}));f&&(c=f.offset+f.length)}else delete h.props.link,h.setText(a,l.showMarkdown())}else s!==o?this.elsNew.insert(o,s-o,{link:{text:a,href:n}},l):this.elsNew.insertEl(new it.a(a,{link:{href:n,text:a,showImage:t,isImage:d}}),l,o);this.setTextFromEls(y.a.ChangeType.Local),N.a.selectObject(l,c-l.item.getPrefixLength())}}},{key:"getTextLength",value:function(){return this.getParsedText().length}},{key:"getNotePreviewMultiline",value:function(){var e=this.getParsedText();if(e){e=e.substr(0,Math.min(e.length,4e3));var t=0,a=e.split(/<\/?(?:div|p|br|li)[^>]*>\s*/im).map((function(e){if(!(t>280)){var a=document.createElement("div");a.innerHTML=e;var n=a.textContent||a.innerText;return t+n.length>280&&(n=n.slice(0,280-t)+"..."),t+=n.length,n}})).filter((function(e){return!!e}));return a.length>4&&((a=a.slice(0,4))[3]+="..."),a}}},{key:"getNotePreviewText",value:function(){if(this._notePreviewText)return this._notePreviewText;var e=this.getParsedText();if(e){var t=(e=e.substr(0,Math.min(e.length,5e3))).match(/[^\r\n]+/);if(t){for(var a=0,n=(e=t[0]).split(/<\/?(?:div|p|br|li)[^>]*>\s*/im),r=0;r<n.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=n[r];if(i){var o=document.createElement("div");o.innerHTML=i;var s=o.textContent||o.innerText;if(s){if(e&&e!==t[0]){e+="...";break}e=s}}}e=e.substr(0,Math.min(e.length,200))}}return this._notePreviewText=e,e}},{key:"setTextToWhatItAlreadyIs",value:function(e){var t=this.getParsedText();this.setText(t,e)}},{key:"getPrefixForExport",value:function(){var e=this.prefix;return this.isPrefixNumList()?e=this.numListNumber()+".":this.isPrefixTask()&&(e=this.isComplete()?"[x]":"[ ]"),e?e+" ":""}}]),a}(e);return t}(dt),!0),ve.a.extendClass(dt,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ft,t=function(e){d()(a,e);var t=Je(a);function a(){return i()(this,a),t.apply(this,arguments)}return s()(a,[{key:"dragStart",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.pane||m.default.focusedPane;try{m.default.PAssert(1261,n.isItemDraggable(),"Pane must be draggable in order to start a drag")}catch(g){m.default.reportError(g)}try{m.default.PAssert(1262,bo.DragDrop.startDragItem,"Should always have a valid item to start dragging from")}catch(g){m.default.reportError(g)}var r=m.default.getElementParent(e.startSrc||e.target);try{m.default.PAssert(1263,r,"Must have a valid target node")}catch(g){m.default.reportError(g)}if(r){bo.DragDrop.startDragItem=void 0,bo.DragDrop.dragItem=this;var i,o,s,l=m.default.getPaneObjectForElement(r);if(n.isViewCalendar()||a||m.default.findParent(r,"itemNotInPane"))i=[{item:this,pane:n}],o=[this];else{s=l.block;var u=N.a.getSelectedObjects();0!==u.length&&u.find((function(e){return e.id===l.id}))?(i=[],o=[],u.forEach((function(e){i.includes(e)||(o.push(e.item),i=i.concat(e).concat(n.getChildrenOfPaneObject(e)))}))):(i=[l].concat(n.getChildrenOfPaneObject(l)),o=[l.item])}var c=m.default.offset(r),d=c.left,h=c.top;bo.PaneManager.runForEachPane((function(e){e.addScrollListener(t.dragScroll)}));var f={x:e.clientX,y:e.clientY,items:i},p={dropEffect:n.dropEffect(this),itemsDragging:o,element:r,block:s,pane:n};bo.DragDrop.start(this,i,d,h,n,f,p,a),m.default.disableMouseMove=!0}}},{key:"dragMove",value:function(e){try{m.default.PAssert(1264,bo.DragDrop.startInfo,"Must have started a drag to be valid")}catch(r){m.default.reportError(r)}if(bo.DragDrop.startInfo){"touchmove"===e.type&&(e.returnValue=!1,e.returnFalse=!0,m.default.preventAndStop(e));var t=e.clientX-bo.DragDrop.startInfo.x,a=e.clientY-bo.DragDrop.startInfo.y,n=m.default.elementFromPoint(e.clientX,e.clientY);bo.DragDrop.setTransform(t,a),n&&bo.DragDrop.handleDragOver({item:this,dataTransfer:bo.DragDrop.dataTransfer,clientX:e.clientX,clientY:e.clientY})}}},{key:"dragScroll",value:function(){var e=this;!bo.DragDrop.isDragging||isNaN(N.a.mousePos.x)||isNaN(N.a.mousePos.y)||m.default.animationFrameOnce("DragOnScroll",(function(){var t={clientX:N.a.mousePos.x,clientY:N.a.mousePos.y,preventDefault:m.default.emptyFn,stopPropagation:m.default.emptyFn,diffY:0};e.dragMove(t)}))}},{key:"dragEnd",value:function(e){var t=this;m.default.disableMouseMove=!1,bo.DragDrop.stop(),e&&(m.default.findParent(e.target,"paneContent")||m.default.findParent(e.target,"paneOverviewScroller"))&&bo.DragDrop.handleDrop({target:e.target,dataTransfer:bo.DragDrop.dataTransfer,fromDropBucket:e.fromDropBucket,ctrlKey:e.ctrlKey,altKey:e.altKey}),bo.DragDrop.finish(),bo.PaneManager.runForEachPane((function(e){e.removeScrollListener(t.dragScroll)})),m.default.disableMouseMove=!1}},{key:"checkDragOnStart",value:function(e,t){var a=this;bo.DragDrop.escapedDragging=!1,bo.DragDrop.startDragItem=this,m.default.preventAndStop(e),N.a.addMouseHandler({move:function(e){a.checkDragOnMove(e,t)},up:function(e){a.checkDragOnEnd(e)}})}},{key:"checkDragOnMove",value:function(e,t){if(bo.DragDrop.startDragItem&&!bo.DragDrop.escapedDragging&&(!w.a.touch||m.default.distance(e.distanceX,e.distanceY)>m.default.ClickThreshold)){var a=e.pane||m.default.focusedPane;bo.DragDrop.startDragItem===this&&this.isDraggable()&&a.isItemDraggable(this)&&this.dragStart(e,t)}bo.DragDrop.isDragging&&(this.dragMove(e),m.default.preventAndStop(e))}},{key:"checkDragOnEnd",value:function(e){bo.DragDrop.startDragItem=void 0,bo.DragDrop.isDragging&&this.dragEnd(e)}}]),a}(e);return t}(dt),!0),ve.a.extendClass(dt,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ft,t=function(e){d()(a,e);var t=at(a);function a(){return i()(this,a),t.apply(this,arguments)}return s()(a,[{key:"onChangeRemote",value:function(e,t){var a=this,n=!1,r=this.getRawText();Object.keys(e).map((function(i){var o,s=e[i];switch(i){case"text":a.onChangeRemoteText(s,t);break;case"parent":n||a.parent()&&a.parent().id===s&&(a.parent().hasChild(a)||a.isNote())||(a.onChangeRemoteParentOrIndex(e),n=!0);break;case"index":n||a.index===s||(a.onChangeRemoteParentOrIndex(e),n=!0);break;case"priority":a.setPriority(s||0,t);break;case"isComplete":a.setComplete(s||!1,t);break;case"isStarred":a.setStarred(s||!1,t);break;case"dateCompleted":a.dateCompleted=s?new Date(s):null,o=!0;break;case"date":a.setMooDate($e.a.fromData(s),t,!0),o=!0;break;case"note":s?a.addRemoteNote(s,t):a.hasNote()&&a.removeRemoteNote(t);break;case"dateModified":a.setDateModified(new Date(s));break;case"flags":var l=m.default.isFlagSet(s,y.a.VMLIFlag.Complete);a.isComplete()!==l?a.setComplete(l,t):a.setFlags(s),Ze.a.itemSearchChanged(a);break;case"isArchived":s!==a.isArchived()&&(s?a.archiveSelf(t):a.unArchive(t));break;case"isDeleted":s!==a.isDeleted()&&(s?a.deleteSelf(t):a.unDelete(t));break;case"id":case"items":case"dateCreated":case"pendingSync":case"docId":break;default:0}o&&a.parseText(r,t)}))}},{key:"onChangeRemoteText",value:function(e,t){this.setText(e,t)}},{key:"onChangeRemoteParentOrIndex",value:function(e){var t=this.parent(),a=e.parent?j.a.getItem(e.parent):t;try{m.default.PAssert(1259,a,"Must have a new parent")}catch(s){m.default.reportError(s)}if(a){if(bo.PaneUpdateBatcher.beginUpdateItems(),32===(32&e.flags)||this.isNote())this.setParent(a),a.hasNote()&&a.getNote()===this||this.isDeleted()||a.setNote(this,y.a.ChangeType.Remote);else{if(void 0===e.index){var n=j.a.getItemDataLocal(this.getDocumentOwner(),e.id);n&&(e.index=n.index)}try{m.default.PAssert(1260,void 0!==e.index,"Index is undefined")}catch(s){m.default.reportError(s)}if(void 0!==e.index&&(this.index=e.index),!0!==e.isDeleted&&!this.isDeleted()&&!0!==e.isArchived&&!this.isArchived())if(t===a&&a.hasChild(this))a.items.sort(tt.a.compareItemIndex);else{var r=a.getDocumentOwner();r!==this.getDocumentOwner()&&this.forEachChildRecursive((function(e){return e.setDocumentOwner(r)}),!0,!0),this.setParent(a);var i=void 0!==e.index?e.index:this.index,o=a.indexInItemFromStringIndex(i);a.items.splice(o,0,this),t&&t!==a&&t.items.remove(this)}}Ze.a.itemSearchChanged(this),bo.PaneUpdateBatcher.commitUpdateItems()}}},{key:"addRemoteNote",value:function(e,t){}},{key:"removeRemoteNote",value:function(e){}}]),a}(e);return t}(dt),!0);var ht,ft=dt,pt=(ht=function(){function e(t,a,n,r,o,s,l,u){i()(this,e),this.id=t,this.numItems=0,this._readonly=!!a,this._isDestructible=!!n,this._enabledFilters=l,this._trackGlobally=!!r,this._requireStoredEls=!!o,this._owner=u,this._root=void 0,this._data={},this._destroyed=!1}return s()(e,[{key:"areFiltersEnabled",value:function(e){return m.default.isAtLeastOneFlagSet(this._enabledFilters,e)}},{key:"getEnabledFilters",value:function(){return this._enabledFilters}},{key:"isOwner",value:function(e){return this._owner===e}},{key:"destroy",value:function(){try{m.default.PAssert(509,this._isDestructible,"Item store must be destructible to destroy")}catch(e){m.default.reportError(e)}this._destroyed=!0,this.clearStore(),this._root.destroy(),this._root=void 0,this._owner=void 0}},{key:"checkDestroyed",value:function(){try{m.default.PAssert(510,!this._destroyed,"Should not be using a destroyed item store")}catch(e){m.default.reportError(e)}}},{key:"trackGlobally",value:function(){return this._trackGlobally}},{key:"requireStoredEls",value:function(){return this._requireStoredEls}},{key:"clearStore",value:function(){if(this._isDestructible){for(var e in bo.PaneUpdateBatcher.beginUpdateItems(),this._data)this._root&&e===this._root.id||this._data[e].destroy();bo.PaneUpdateBatcher.commitUpdateItems()}this._data={},this._root&&(this._root.items.set([]),this._data[this._root.id]=this._root)}},{key:"createRoot",value:function(e,t){return this.checkDestroyed(),this._root=this.createItem(e,t,void 0,{isRoot:!0},y.a.ChangeType.None),this._root}},{key:"createItem",value:function(e,t,a,n,r,i){try{m.default.PAssert(511,a||n&&n.isRoot,"Must always specify a valid parentID when creating a new item")}catch(c){m.default.reportError(c)}this.checkDestroyed();try{m.default.PAssert(512,!this._data[e],"Should never double-create for the same item, should use update instead")}catch(c){m.default.reportError(c)}var o;if(void 0===r&&(r=y.a.ChangeType.None),a){o=this._data[a];try{m.default.PAssert(513,o,"Parent must be valid if defined")}catch(c){m.default.reportError(c)}}var s={id:e,text:t};if(n)for(var l in n)n.hasOwnProperty(l)&&(s[l]=n[l]);var u=new ft(s,{store:this,parent:o,changeType:r,canDestroy:this._isDestructible,noSave:this._readonly,documentOwner:i});return this.numItems++,this._data[u.id]=u,u}},{key:"createItemRaw",value:function(e,t){try{m.default.PAssert(514,t.parent||t&&(t.isRoot||t.noSave||t.noParentOkay),"Must always specify a valid parentID when creating a new item")}catch(n){m.default.reportError(n)}this.checkDestroyed();try{m.default.PAssert(515,!!t.canDestroy===this._isDestructible,"When creating raw items, canDestroy must match")}catch(n){m.default.reportError(n)}try{m.default.PAssert(516,!!t.noSave===this._readonly,"When creating raw items, noSave must match")}catch(n){m.default.reportError(n)}t.store=this;var a=new ft(e,t);try{m.default.PAssert(517,!this._data[a.id],"Should not create an item that already exists in this store",(function(){var t=Object.assign({},e,{text:null,items:null});return m.default.safeStringify(t)}))}catch(n){m.default.reportError(n)}return this._data[a.id]=a,this.numItems++,a}},{key:"destroyItem",value:function(e){try{m.default.PAssert(518,this._isDestructible,"ItemStore must be destructible to destroy items")}catch(a){m.default.reportError(a)}var t=this._data[e];try{m.default.PAssert(519,t,"Must always destroy a valid item")}catch(a){m.default.reportError(a)}if(t){try{m.default.PAssert(520,!t.isDestroyed(),"Should never destroy an item twice")}catch(a){m.default.reportError(a)}t.parent()&&(t.parent().getChildIndex(t)>=0&&t.parent().removeChild(t,y.a.ChangeType.Local),t.setParent(void 0)),t.destroy()}delete this._data[e]}},{key:"removeItemFromStore",value:function(e){this._data[e].destroy(!0),delete this._data[e]}},{key:"modifyItemID",value:function(e,t){try{m.default.PAssert(521,e.belongsToItemStore(this),"Item must belong to this item store")}catch(a){m.default.reportError(a)}try{m.default.PAssert(522,e.id!==t,"Must actually be modifying the item ID")}catch(a){m.default.reportError(a)}try{m.default.PAssert(523,this._data[e.id],"Must have a valid item stored under the current ID: "+e.id+" - "+t+" - "+e.isDestroyed())}catch(a){m.default.reportError(a)}try{m.default.PAssert(524,!this._data[t],"Must not be overwriting an existing item"+e.id+" - "+t+" - "+e.isDestroyed())}catch(a){m.default.reportError(a)}delete this._data[e.id],this._data[t]=e}},{key:"manualModifyItemID",value:function(e,t){try{m.default.PAssert(525,!this._data[t],"Must not be overwriting an existing item"+e+" - "+t)}catch(n){m.default.reportError(n)}var a=this._data[e];try{m.default.PAssert(526,a,"Must have valid item to change its ID")}catch(n){m.default.reportError(n)}a&&(delete this._data[e],this._data[t]=a)}},{key:"addItemToRoot",value:function(e){this._root.items.push(e)}},{key:"removeItemFromRoot",value:function(e){this._root.items.remove(e)}},{key:"getItem",value:function(e){return this.checkDestroyed(),this._data[e]}},{key:"hasItem",value:function(e){return this.checkDestroyed(),!!this._data[e]}},{key:"getRoot",value:function(){return this.checkDestroyed(),this._root}},{key:"isRoot",value:function(e){return this.checkDestroyed(),this._root===e}},{key:"getCount",value:function(){return this.checkDestroyed(),Object.keys(this._data).length}},{key:"forEach",value:function(e){for(var t in this.checkDestroyed(),this._data)this._data[t]&&e(this._data[t])}},{key:"_markPaneDirty",value:function(e){e.usesItemStore(this)&&e!==m.default.focusedPane&&e.setItemsDirty()}},{key:"updateItems",value:function(e){var t=this;e&&!e.belongsToItemStore(this)||(bo.PaneManager.runForEachPane((function(a){a.usesItemStore(t,e)&&(a.preventUpdateItemsForItem&&a.preventUpdateItemsForItem.item===e||a.setItemsDirty())})),bo.PaneUpdateBatcher.updateAllItems())}},{key:"onItemChanged",value:function(e,t){var a,n=this;e&&!e.belongsToItemStore(this)||(bo.PaneManager.runForEachPane((function(r){if(r.usesItemStore(n,e)){var i=r.handleItemChanged(e,t),o=e.getItemsLinkedTo();o&&o.forEach((function(e){e&&(e.itemChanged.notify(),r.handleItemChanged(e,t))})),a=a||i}})),bo.PaneUpdateBatcher.updateAllItemHeights()),a&&bo.PaneUpdateBatcher.updateAllItems()}}]),e}(),_()(ht.prototype,"_markPaneDirty",[b.a],Object.getOwnPropertyDescriptor(ht.prototype,"_markPaneDirty"),ht.prototype),_()(ht.prototype,"updateItems",[b.a],Object.getOwnPropertyDescriptor(ht.prototype,"updateItems"),ht.prototype),ht);function gt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var mt,vt,yt,kt="DefaultStore",_t=function(e){d()(a,e);var t=gt(a);function a(){var e;return i()(this,a),(e=t.call(this))._itemStores={},e._iteratingStores=!1,e.Events={StoreAdded:"StoreAdded",StoreRemoved:"StoreRemoved"},e}return s()(a,[{key:"init",value:function(){var e=y.a.ItemStoreFilter.Dates|y.a.ItemStoreFilter.Priority;this.registerItemStore(kt,void 0,{isReadonly:!1,isDestructible:!1,listenToItemStateChanged:!0,enabledFilters:e}).createRoot("Item store root","Item store root"),this._tempItemStore=this.registerItemStore("TempStore",void 0,{isReadonly:!0,isDestructible:!0,trackGlobally:!1,noRegister:!0})}},{key:"registerItemStore",value:function(e,t,a){try{m.default.PAssert(266,!this._itemStores[e],"Should only register a single item store per plugin: ",e)}catch(c){m.default.reportError(c)}try{m.default.PAssert(267,!this._iteratingStores,"Should never add a store while iterating")}catch(c){m.default.reportError(c)}var n=!0,r=!0,i=!0,o=!0,s=!1,l=y.a.ItemStoreFilter.None;rt.a.runParseTextNew;a&&(void 0!==a.isReadonly&&(n=a.isReadonly),void 0!==a.isDestructible&&(r=a.isDestructible),void 0!==a.enabledFilters&&(l=a.enabledFilters),void 0!==a.parserFn&&a.parserFn,void 0!==a.trackGlobally&&(i=a.trackGlobally),void 0!==a.requireStoredEls&&(o=a.requireStoredEls),void 0!==a.listenToItemStateChanged&&(s=a.listenToItemStateChanged));var u=new pt(e,n,r,i,o,s,l,t);return a&&a.noRegister||(this._itemStores[e]=u,this.fireEvent(this.Events.StoreAdded,u.getEnabledFilters(),[u])),u}},{key:"unregisterItemStore",value:function(e){try{m.default.PAssert(268,this._itemStores[e],"Must register an item store before destroying it")}catch(a){m.default.reportError(a)}try{m.default.PAssert(269,!this._iteratingStores,"Should never remove a store while iterating")}catch(a){m.default.reportError(a)}var t=this._itemStores[e];delete this._itemStores[e],t.destroy(),this.fireEvent(this.Events.StoreRemoved,t.getEnabledFilters(),[t])}},{key:"getItemStore",value:function(e){try{m.default.PAssert(270,this._itemStores[e],"Must register an item store before using it")}catch(t){m.default.reportError(t)}return this._itemStores[e]}},{key:"getDefaultItemStore",value:function(){return this._itemStores.DefaultStore}},{key:"getTempItemStore",value:function(){return this._tempItemStore}},{key:"runForEachStore",value:function(e,t){for(var a in t=t||y.a.ItemStoreFilter.None,this._iteratingStores=!0,this._itemStores)if(this._itemStores.hasOwnProperty(a)){var n=this._itemStores[a];if(t===y.a.ItemStoreFilter.None||n.areFiltersEnabled(t))try{e(n)}catch(r){m.default.reportError(r)}}this._iteratingStores=!1}}]),a}(D.a),bt=a(54),wt=(mt=function(){function e(){i()(this,e),this._numTimesItemsUpdated=0,this._itemsUpdateTimeout=void 0,this._queuedPaneUpdates={},this.itemFlushStacks=[],this.EnableItemFlushStacks=!0,this._isUpdating=!1,this._numFlushesInCommit=0,this._isWaitingUpdateItems=0,this._itemsDirty=!1,this._itemHeightsDirty=!1,this._forceNotify=!1,this._updateSearch=!1,this._itemsUpdateWatchdog=void 0,this._lastUpdateItemsStack=void 0}return s()(e,[{key:"checkItemsUpdated",value:function(){0}},{key:"notifyItemsUpdated",value:function(e,t){this._numTimesItemsUpdated++,this.EnableItemFlushStacks&&this.itemFlushStacks.push({stack:m.default.getCurrentStack("Update Items Stack"),panes:e,forceNotify:t}),this._itemsUpdateTimeout||(this._itemsUpdateTimeout=setTimeout(this.checkItemsUpdated,0))}},{key:"_updateAllItems",value:function(){var e=this._forceNotify;this._forceNotify=!1;var t=this._updateSearch;(this._updateSearch=!1,this._itemsDirty||e)&&(this._itemsDirty=!1,this._isUpdating=!0,bt.a.beginBatch(),bo.PaneManager.runForEachPane((function(a){(e||a.isItemsDirty())&&a.updateItemsImmediate(t,e)})),bt.a.endBatch(),this._isUpdating=!1)}},{key:"queuePaneUpdate",value:function(e,t,a){var n=this._queuedPaneUpdates[e.id];n||(n=this._queuedPaneUpdates[e.id]={}),n.forceNotify=n.forceNotify||a,n.updateSearch=n.updateSearch||t}},{key:"flushQueuedUpdates",value:function(e){var t=this._queuedPaneUpdates[e.id];t&&(e.updateItemsImmediate(t.updateSearch,t.forceNotify),delete this._queuedPaneUpdates[e.id])}},{key:"updateWatchdog",value:function(){m.default.log("Last Update Items Stack: "+this._lastUpdateItemsStack);try{m.default.PAssert(260,!1,"Update Watchdog Triggered - This should never happen.",this._isWaitingUpdateItems)}catch(e){m.default.reportError(e)}this._isWaitingUpdateItems=1,this.commitUpdateItems()}},{key:"isUpdatingItems",value:function(){return this._isWaitingUpdateItems>0&&this._itemsDirty}},{key:"beginUpdateItems",value:function(){this._isWaitingUpdateItems++,bt.a.beginBatch(),1===this._isWaitingUpdateItems&&(this._lastUpdateItemsStack=m.default.getCurrentStack("Update Items Stack"),this._itemsUpdateWatchdog=setTimeout(this.updateWatchdog,0))}},{key:"commitUpdateItems",value:function(e,t){try{m.default.PAssert(263,this._isWaitingUpdateItems>0,"Missing a call to beginUpdateItems: ",this._isWaitingUpdateItems)}catch(a){m.default.reportError(a)}this._isWaitingUpdateItems--,0===this._isWaitingUpdateItems&&(clearTimeout(this._itemsUpdateWatchdog),this._itemsUpdateWatchdog=void 0,this._lastUpdateItemsStack=void 0,this._numFlushesInCommit=0,!this._itemsDirty&&this._itemHeightsDirty&&this._updateAllItemHeights(),this._itemHeightsDirty=!1),this._itemsDirty&&this.updateAllItems(e,t),bt.a.endBatch()}},{key:"flushItemsUpdate",value:function(e){return!!this.isUpdatingItems()&&(e?e.isItemsDirty()&&(this._itemsDirty||this._forceNotify)&&(this._numFlushesInCommit++,e.updateItemsImmediate(this._updateSearch,this._forceNotify)):(this._numFlushesInCommit++,this._updateAllItems()),!0)}},{key:"updateAllItems",value:function(e,t){try{m.default.PAssert(264,void 0===e||m.default.isBoolean(e),"Must supply a bool param for updateSearch")}catch(a){m.default.reportError(a)}try{m.default.PAssert(265,void 0===t||m.default.isBoolean(t),"Must supply a bool param for forceNotify")}catch(a){m.default.reportError(a)}this._itemsDirty=!0,t&&(this._forceNotify=t),e&&(this._updateSearch=e),0===this._isWaitingUpdateItems&&this._updateAllItems()}},{key:"_updateAllItemHeights",value:function(){bo.PaneManager.runForEachPane((function(e){e.itemsHeightDirty&&e.updateItemHeights()}))}},{key:"updateAllItemHeights",value:function(){0===this._isWaitingUpdateItems?this._updateAllItemHeights():this._itemHeightsDirty=!0}}]),e}(),_()(mt.prototype,"checkItemsUpdated",[b.a],Object.getOwnPropertyDescriptor(mt.prototype,"checkItemsUpdated"),mt.prototype),_()(mt.prototype,"updateWatchdog",[b.a],Object.getOwnPropertyDescriptor(mt.prototype,"updateWatchdog"),mt.prototype),mt),St=a(109),Dt="Suspend",Pt="Resume",It="AsyncSkip",Et="SyncSkip",Ct="Run",xt="AsyncBegin",At="AsyncComplete",Tt="AsyncAbort",Mt="AsyncTimeout",Lt=(vt=function(){function e(t,a){i()(this,e);try{m.default.PAssert(469,a,"Must provide a valid set of task options: "+t)}catch(n){m.default.reportError(n)}this._id=t,this._iterationID=void 0,this._isAsync=a.async,this._isAsyncRunning=!1;try{m.default.PAssert(471,a.task&&m.default.isFunction(a.task),"Must provide a valid task function")}catch(n){m.default.reportError(n)}this._task=a.task,this._delay=a.delay;try{m.default.PAssert(472,void 0===a.asyncTimeout||a.async,"Should never specify an async timeout for a non-async task")}catch(n){m.default.reportError(n)}this._asyncTimeout=a.asyncTimeout||0,this._pauseWhileIdle=a.pauseWhileIdle||!1,this._minDelayOnResume=a.minDelayOnResume||!1;try{m.default.PAssert(473,this._pauseWhileIdle||!this._minDelayOnResume,"Must use pauseWhileIdle to support minDelayOnResume")}catch(n){m.default.reportError(n)}this._suspended=!1,this._remainingTime=0,this._lastUpdate=a.runOnCreate?0:Date.now(),this._asyncStartTime=-1,this._numUpdatesRun=0,this._numUpdatesSkipped=0,this._numUpdatesAsyncSkipped=0,this._numAsyncAborts=0,this._numAsyncTimeouts=0,this._minDelay=a.minDelay||0,this._lastSetDelay=this._delay,this._runningTimeout=void 0,this._asyncAbortTimeout=void 0,this._updateIsRunning=!1,this._isCancelled=!1,this._updateTimes=new St.a(10),this._actions=new St.a(20),this.init()}return s()(e,[{key:"init",value:function(){this._lastUpdate>0?(clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,this._delay)):this._runUpdate()}},{key:"getStats",value:function(){return{numUpdatesRun:this._numUpdatesRun,numUpdatesSkipped:this._numUpdatesSkipped,numUpdatesAsyncSkipped:this._numUpdatesAsyncSkipped,numAsyncAborts:this._numAsyncAborts,numAsyncTimeouts:this._numAsyncTimeouts,updateIsRunning:this._updateIsRunning,isAsync:this._isAsync,isAsyncRunning:this._isAsyncRunning,cancelled:this._isCancelled,suspended:this._suspended,lastUpdate:this._lastUpdate,asyncRunTime:this._asyncRunTime(),timeSinceLastUpdate:this._timeSinceLastUpdate(),updateTimes:this._updateTimes.ordered(),actions:this._actions.ordered()}}},{key:"cancel",value:function(){this._isCancelled=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0}},{key:"abortAsync",value:function(){this._numAsyncAborts++,this.performAction(Tt),this._notifyAsyncAborted()}},{key:"performAction",value:function(e){try{m.default.PAssert(474,e,"Invalid action reported")}catch(t){m.default.reportError(t)}this._actions.push({action:e,time:Date.now()})}},{key:"notifyOfSuspend",value:function(){this._pauseWhileIdle&&(this.performAction(Dt),this._suspended=!0,this._remainingTime=Math.max(0,this._lastSetDelay-this._timeSinceLastUpdate()),clearTimeout(this._runningTimeout),this._runningTimeout=void 0)}},{key:"notifyOfResume",value:function(){if(this._pauseWhileIdle){this.performAction(Pt);var e,t=!this._suspended;if(this._suspended=!1,this._minDelayOnResume)e=Math.max(0,this._minDelay-this._timeSinceLastUpdate());else{try{m.default.PAssert(475,t||this._remainingTime>=0,"Must have a valid remaining time set for task")}catch(a){m.default.reportError(a)}e=this._remainingTime,this._remainingTime=-1}e=Math.max(500,e),clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,e)}}},{key:"isAsync",value:function(){return this._isAsync}},{key:"isAsyncRunning",value:function(){return this.isAsync()&&this._isAsyncRunning}},{key:"_notifyUpdateAsyncSkipped",value:function(){this._numUpdatesAsyncSkipped++,this.performAction(It)}},{key:"_notifyUpdateSkipped",value:function(){this._numUpdatesSkipped++,this.performAction(Et)}},{key:"_notifyUpdateRun",value:function(){this._lastUpdate=Date.now(),this._updateTimes.push(this._lastUpdate),this._numUpdatesRun++,this.performAction(Ct)}},{key:"_timeSinceLastUpdate",value:function(){return Date.now()-this._lastUpdate}},{key:"_asyncRunTime",value:function(){var e=0;return this._asyncStartTime>0&&(e=Date.now()-this._asyncStartTime),e}},{key:"_notifyAsyncBegin",value:function(){return this.performAction(xt),this._isAsyncRunning=!0,this._iterationID=m.default.generateTempId(),this._asyncStartTime=Date.now(),this._asyncTimeout&&(this._asyncAbortTimeout=setTimeout(this._handleAsyncAbortTimeout,this._asyncTimeout)),this._iterationID}},{key:"_notifyAsyncComplete",value:function(){this.performAction(At),this._isAsyncRunning=!1,this._asyncStartTime=-1,this._iterationID=void 0,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)}},{key:"_notifyAsyncAborted",value:function(){this._isAsyncRunning=!1,this._asyncStartTime=-1,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)}},{key:"_handleAsyncAbortTimeout",value:function(){this._numAsyncTimeouts++,this.performAction(Mt),this._notifyAsyncAborted()}},{key:"_runUpdate",value:function(e){var t=arguments,a=this;try{m.default.PAssert(476,!this._isCancelled,"Should never run a cancelled task")}catch(r){m.default.reportError(r)}try{m.default.PAssert(478,!this._updateIsRunning,"Should not run another update while already running one: "+this._id)}catch(r){m.default.reportError(r)}if(!this._updateIsRunning){if(this._updateIsRunning=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0,this._notifyUpdateRun(),this.isAsync())if(this.isAsyncRunning())this._asyncTimeout&&this._asyncTimeout<this._asyncRunTime()?(this.abortAsync(),setTimeout(this._runUpdate.bind(this,e),0)):this._notifyUpdateAsyncSkipped();else{var n=this._notifyAsyncBegin();try{this._task((function(){try{m.default.PAssert(480,n===a._iterationID,"Callback is only valid while task is considered running")}catch(r){m.default.reportError(r)}a._notifyAsyncComplete(),e&&e.apply(a,t)}))}catch(i){m.default.reportError(i),this._notifyAsyncComplete()}}else try{this._task()}catch(i){m.default.reportError(i)}this._runningTimeout=setTimeout(this._runUpdate,this._delay),this._lastSetDelay=this._delay,this._remainingTime=this._delay,this._updateIsRunning=!1}}},{key:"requestUpdate",value:function(){if(this._timeSinceLastUpdate()>this._minDelay)this._runUpdate();else{this._notifyUpdateSkipped();var e=this._minDelay-this._timeSinceLastUpdate();clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,e),this._lastSetDelay=this._minDelay}}},{key:"forceUpdate",value:function(e){this._runUpdate(e)}},{key:"breakOnNextUpdate",value:function(){0}}]),e}(),_()(vt.prototype,"_notifyAsyncComplete",[b.a],Object.getOwnPropertyDescriptor(vt.prototype,"_notifyAsyncComplete"),vt.prototype),_()(vt.prototype,"_handleAsyncAbortTimeout",[b.a],Object.getOwnPropertyDescriptor(vt.prototype,"_handleAsyncAbortTimeout"),vt.prototype),_()(vt.prototype,"_runUpdate",[b.a],Object.getOwnPropertyDescriptor(vt.prototype,"_runUpdate"),vt.prototype),vt),Ot=function(){function e(){i()(this,e),this._tasks={}}return s()(e,[{key:"init",value:function(){window.addEventListener("focus",this._handleFocus.bind(this)),window.addEventListener("blur",this._handleBlur.bind(this))}},{key:"getStats",value:function(){var e=this,t={};return Object.keys(this._tasks).forEach((function(a){return t[a]=e._tasks[a].getStats()})),t}},{key:"createRecurringTask",value:function(e,t){try{m.default.PAssert(304,!this._tasks[e],"Must not register multiple tasks with the same ID")}catch(n){m.default.reportError(n)}var a=new Lt(e,t);return this._tasks[e]=a,a}},{key:"getRecurringTask",value:function(e){try{m.default.PAssert(305,this._tasks[e],"Must only retreive a valid recurring task")}catch(t){m.default.reportError(t)}return this._tasks[e]}},{key:"hasRecurringTask",value:function(e){return!!this._tasks[e]}},{key:"cancelRecurringTask",value:function(e){try{m.default.PAssert(306,this._tasks[e],"Must only cancel a valid recurring task")}catch(t){m.default.reportError(t)}this._tasks[e].cancel(),delete this._tasks[e]}},{key:"_handleFocus",value:function(){for(var e in this._tasks)this._tasks[e].notifyOfResume()}},{key:"_handleBlur",value:function(){for(var e in this._tasks)this._tasks[e].notifyOfSuspend()}}]),e}(),Rt=a(80),Ft=new(function(){function e(){i()(this,e)}return s()(e,[{key:"deriveKey",value:function(e,t){var a=Rt.a.textEncoder.encode(e),n=Rt.a.str2ab(t);return crypto.subtle.importKey("raw",a,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]).then((function(e){return crypto.subtle.deriveKey({name:"PBKDF2",salt:n,iterations:2e5,hash:"SHA-512"},e,{name:"AES-CTR",length:256},!1,["encrypt","decrypt"])})).then((function(e){return e}))}},{key:"importKey",value:function(e){return crypto.subtle.importKey("raw",e,"AES-CTR",!0,["encrypt","decrypt"])}},{key:"exportKey",value:function(e){return crypto.subtle.exportKey("raw",e)}},{key:"encrypt",value:function(e,t,a){var n={name:"AES-CTR",counter:a,length:128};return crypto.subtle.encrypt(n,t,e)}},{key:"decrypt",value:function(e,t,a){var n={name:"AES-CTR",counter:a,length:128};return crypto.subtle.decrypt(n,t,e)}}]),e}()),Nt=new(function(){function e(){i()(this,e)}return s()(e,[{key:"key",value:function(e,t){return Ft.deriveKey(e,t)}},{key:"saltToCounter",value:function(e){var t=Rt.a.str2ab(e);if(t.length>16)t=t.slice(0,16);else if(t.length<16){for(var a=0,n=new Uint8Array(16),r=0;r<t.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n[r]=t[r]}t=n}return t}},{key:"encrypt",value:function(e,t,a){var n=this.saltToCounter(a),r=Rt.a.unicode2ab(e);return Ft.encrypt(r,t,n).then((function(e){return Rt.a.ab2str(e)}))}},{key:"decrypt",value:function(e,t,a){var n=this.saltToCounter(a),r=Rt.a.str2ab(e);return Ft.decrypt(r,t,n).then((function(e){return Rt.a.ab2unicode(e)}))}}]),e}()),Bt="afolaw8klslbsahgbeoiya4pifoqlncduzvxgze60lvk17sevauroatsxm8qqia",jt=new Uint8Array([76,30,217,70,117,53,119,240,33,22,147,24,106,228,253,86,175,251,159,47,232,124,89,230,19,65,243,211,58,83,88,158]).buffer;function Ut(e){this.message=e,"captureStackTrace"in Error?Error.captureStackTrace(this,Ut):this.stack=(new Error).stack}function Ht(e){this.message=e,"captureStackTrace"in Error?Error.captureStackTrace(this,Ht):this.stack=(new Error).stack}Ut.prototype=Object.create(Error.prototype),Ut.prototype.name="InvalidArgumentError",Ut.prototype.constructor=Ut,Ht.prototype=Object.create(Ut.prototype),Ht.prototype.name="InvalidPasswordError",Ht.prototype.constructor=Ht;var Vt,Wt=(yt=function(){function e(){var t=this;i()(this,e),this.sentinel=y.a.EncryptionSentinel,this.keys={},this.onLoadCbs=[],this.onUpdated=new et.a,this.importKeys({}).then((function(){t.isLoaded=!0,t.onLoadCbs.forEach((function(e){return e()}))}))}return s()(e,[{key:"onLoad",value:function(e){this.isLoaded?e():this.onLoadCbs.push(e)}},{key:"canDecryptSentinel",value:function(e){return!!this.getKeyBySentinel(e)}},{key:"getKeyBySentinel",value:function(e){for(var t in this.keys)if(this.keys[t].sentinel===e)return this.keys[t].key}},{key:"encryptSentinel",value:function(e,t){return Nt.encrypt(this.sentinel,e,t)}},{key:"createKeyInfo",value:function(e){var t=this,a=e.name,n=e.password,r=e.sentinelSalt;return Nt.key(n,Bt).then((function(e){return t.encryptSentinel(e,r).then((function(t){return{name:a,key:e,sentinel:t}}))}))}},{key:"importKeys",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.keys.Global||(t[y.a.EncryptionKeys.Global]=jt),t[y.a.EncryptionKeys.UserPassword]&&!$.a.getEncryptionUid()?new Promise((function(a){bo.settings.userId.onHasValue((function(n){e.importKeys(t).then((function(e){return a(e)}))}))})):Promise.all(Object.keys(t).map((function(a){var n=t[a],r=(a===y.a.EncryptionKeys.Global?Bt:a===y.a.EncryptionKeys.UserPassword&&$.a.getEncryptionUid())||a;return n instanceof CryptoKey?e.encryptSentinel(n,r).then((function(t){e.keys[a]={name:a,key:n,sentinel:t}})):(m.default.isString(n)&&(n=Rt.a.str2ab(n)),Ft.importKey(n).then((function(t){return e.encryptSentinel(t,r).then((function(n){e.keys[a]={name:a,key:t,sentinel:n}}))})))}))).then((function(){return e.keys})).catch((function(t){return console.log(t),e.onUpdated.notify(),e.keys}))}},{key:"getGlobalKeyInfo",value:function(){return this.keys[y.a.EncryptionKeys.Global]}},{key:"getGlobalKey",value:function(){return this.keys[y.a.EncryptionKeys.Global].key}},{key:"getKey",value:function(e){return this.keys[e].key}},{key:"getKeyInfo",value:function(e){return this.keys[e]}},{key:"setKey",value:function(e){var t=this,a=e.name,n=e.password,r=e.sentinelSalt;return this.createKeyInfo({name:a,password:n,sentinelSalt:r}).then((function(e){return t.keys[a]=e,t.onUpdated.notify(),e}))}},{key:"canDecrypt",value:function(e){var t=e.source,a=e.target,n=e.key;return Nt.decrypt(t,n.key,n.salt).then((function(e){return e===a}))}},{key:"findDecryptKeys",value:function(e){var t=e.source,a=e.target,n=e.keys,r=m.default.objectValues(n).map((function(e){return Nt.decrypt(t,e.key,e.salt).then((function(t){return{name:e,text:t}}))}));return Promise.all(r).then((function(e){return e.filter((function(e){return e.text===a})).map((function(e){return e.name}))}))}},{key:"addKey",value:function(e){var t=e.name,a=e.password,n=e.sentinelSalt;return"string"!==typeof t?Promise.reject(new Ut("Name must be a string. Saw: ".concat(t))):t in this.keys?Promise.reject(new Ut("".concat(t," exists. Use 'updateKey' to change existing keys."))):this.setKey({name:t,password:a,sentinelSalt:n})}},{key:"updateKey",value:function(e){var t=e.name,a=e.password,n=e.sentinelSalt;return"string"!==typeof t?Promise.reject(new Ut("Name must be a string. Saw: ".concat(t))):t in this.keys?this.setKey({name:t,password:a,sentinelSalt:n}):Promise.reject(new Ut("".concat(t," does not exist. Use 'addKey' to add new key.")))}},{key:"removeKey",value:function(e){delete this.keys[e]}},{key:"createKey",value:function(e){var t=e.name,a=e.password,n=e.sentinelSalt;return"string"!==typeof t?Promise.reject(new Ut("Name must be a string. Saw: ".concat(t))):this.createKeyInfo({name:t,password:a,sentinelSalt:n})}},{key:"exists",value:function(e){return!!(e in this.keys)}},{key:"encryptText",value:function(e,t,a){var n="string"===typeof e?this.keys[e]?this.keys[e].key:void 0:e;try{m.default.PAssert(307,n,"No valid encryption key")}catch(r){m.default.reportError(r)}return"string"!==typeof t?Promise.reject(new Ut("Text must be a string. Saw: ".concat(t))):Nt.encrypt(t,n,a)}},{key:"decryptText",value:function(e,t,a){var n="string"===typeof e?this.keys[e]?this.keys[e].key:void 0:e;return"string"!==typeof t?Promise.reject(new Ut("Text must be a string. Saw: ".concat(t))):Nt.decrypt(t,n,a)}},{key:"exportKey",value:function(e){return Ft.exportKey(e)}}]),e}(),_()(yt.prototype,"addKey",[b.a],Object.getOwnPropertyDescriptor(yt.prototype,"addKey"),yt.prototype),_()(yt.prototype,"updateKey",[b.a],Object.getOwnPropertyDescriptor(yt.prototype,"updateKey"),yt.prototype),yt);function zt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var qt,Gt,Kt=["platforms","appHotkeys","hotkeys","syncAccounts","documentIndices","font","syncAccountRefreshParts","driveFolders"],Yt=["emailViewAccounts"],Xt=["syncAccountRefreshParts"],Qt=(Vt=function(e){d()(a,e);var t=zt(a);function a(){var e;return i()(this,a),(e=t.call(this)).oldSettings={c:!0,u:!0,aA:!0,t:!0,z:!0,aX:!0},e.onLoadCbs=[],e.onLoadRemoteCbs=[],e.init(),e}return s()(a,[{key:"init",value:function(){var e=this;this._allSettings=[],this._allGroups=[],this._groupAbbrevs={},this._groupAbbrevsIn={},this.registerGroup(this,""),this.registerGroup("ui","u");var t=[["agendaSort","a",this.createDefaultAgendaSort()],["backupFrequency","d",0],["calendarCustomDays","e",3],["closedImport","f"],["closedHelps","g"],["closedVideo","h"],["dateFormat","i",y.a.DateFormat.MDY],["dayWeekStart","j",0],["defaultItemPrefix","k",""],["helpPaneState","l"],["helpState","m"],["inTooltipIntro","n"],["backupsDrive","o"],["needsBackup","p"],["notificationDelay","q",30],["openEvernoteApp","r",!0],["panesMobile","s"],["showFormattingToolbar","v",1],["showMarkdown","w"],["showImagesInline","x",!0],["shownTutorial","y"],["trialOverHidden","A"],["userEncryptionSentinel","aE"],["encryptBackup","aH"],["driveFolders","aI"],["fixedMissingCalendars","aJ"],["platforms","aK"],["encryptLocalFiles","aM"],["syncAccounts","aN",{}],["panesRN","aO"],["testBetaFeatures","aQ"],["appSystemDarkMode","aS",!0],["appHotkeys","aT"],["showDebugInfo","aU"],["hotkeys","aV"],["documentIndices","aW"],["alignIndentToPrefix","bc"],["syncAccountRefreshParts","be",{}],["useServerAuth","bf",!0],["emailViewAccounts","bi",[]],["archiveEmailsOnOrganize","bj"]],a=[["activeUser","b"],["cacheSizeRatio","B",1],["disableNotifications","C"],["displayName","D"],["lastContactSync","I"],["lastServerVersion","J"],["lastTaskSync","K"],["lastQuickAddSync","L"],["localDataVersion","M",7],["localIntegrity","N"],["localPaneState","O"],["localRecoverVersion","P"],["notifiedTrialOver","R"],["notifiedTrialEndSoon","S"],["selectedBoard","V"],["showSidebar","W",!1],["sidebarWidth","X",y.a.DesktopMenuWidthDefault],["userId","ab"],["encryptionKeys","aD"],["lastSync","aF"],["userProperties","aG"],["backupLocal","aL",!0],["refreshTokensRN","aR"],["disableAnimations","bd"],["panesInViewMobile","bg"]],n=[["boldHeaders","ac",!1],["bulletOpacity","ad",30],["checkboxOpacity","ae",30],["checkboxBackgroundOpacity","af",0],["contactColor","ag","#22AA66"],["dateColor","ah","#AA3300"],["displayPrefixes","ai",y.a.DisplayTheme.PrefixesFaded],["displaySpacing","aj",y.a.DisplayTheme.SpacingComfortable],["fontSize","ak",14],["fontSizeHeader","al",16],["fontSizeHeaderTopLevel","am",18],["grayscale","an",!1],["itemIndentSize","ao",30],["itemLineHeight","ap",18],["itemPadding","aq",5],["linkColor","ar","#3333BB"],["noteFontSize","as",12],["noteLineHeight","at",18],["notePadding","au",0],["projectOpacity","av",30],["showVerticalLines","aw",!0],["tagColor","ax","#0099DD"],["themeDesktop","ay","auto"],["underlineP","az",!1],["verticalLinesOpacity","aC",6],["cursorBlink","aP",!0],["font","aY",{}],["fontWeight","aZ","normal"],["numListOpacity","ba",30],["collapserOpacity","bb",30],["themeMobile","bh","auto"]];this.registerSettings(t,this,!0),this.registerSettings(a,this,!1),this.registerSettings(n,this.ui,!0),m.default.isDemoMode()&&this.activeUser.set("demo"),this.syncAccounts.listen((function(t){if(t){var a=!1;if(void 0!==t.undefined){try{m.default.PAssert(311,!1,"Sync account is somehow undefined")}catch(n){m.default.reportError(n)}e.syncAccounts.deleteProperty("undefined"),a=!0}else Object.keys(t).forEach((function(e){var n=e.toLowerCase();e!==e.toLowerCase()&&(t[n]=t[e],delete t[e],a=!0)}));a&&setTimeout((function(){e._save("syncAccounts",void 0,e.syncAccounts.get())}),0)}})),this.encryptionKeys.listen(this._onEncryptionKeysChange)}},{key:"load",value:function(){var e=me()(pe.a.mark((function e(t,a,n){var r,i,o=this;return pe.a.wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:if(r=[],!a&&!n){e.next=4;break}return e.next=4,Promise.all(Object.keys(t).filter((function(e){return Xt.includes(o.getSettingInfoFromAbbrev(e).key)})).map(function(){var e=me()(pe.a.mark((function e(a){var n,r;return pe.a.wrap((function(e){for(var i=0,s=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:return n=o.getSettingInfoFromAbbrev(a),r=n.key,e.next=3,o.decryptValue(r,t[a].v,bo.crypto.getKeyInfo(o.getBestUserEncryption()));case 3:t[a].v=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:this.isLoading=!0,Object.keys(t).map((function(e){var a=o.getSettingInfoFromAbbrev(e),n=a.group,i=a.key,s=t[e].v;if(n&&n[i])if("isEnabled"===i)r.push({group:n,key:i,value:s});else{var l=n[i].get();if(void 0===s||null===s)void 0!==s&&null!==s||(s=n._settingsDefault[i]),n[i].set(s);else if(!m.default.isObject(l)||!m.default.isObject(s)||!m.default.deepEqual(l,s)){if(m.default.isString(s)&&(Kt.includes(i)||Yt.includes(i)))try{s=JSON.parse(s)}catch(u){}n[i].set(s)}}})),r.forEach((function(e){var t=e.group,a=e.key,n=e.value;t[a].set(n)})),i=function(){return JSON.stringify({uid:o.userId.get(),name:o.displayName.get(),email:o.activeUser.get()})};try{m.default.PAssert(312,!this.userId.get()||this.userId.get().length>4,"Bad UID",i)}catch(l){m.default.reportError(l)}a&&(this._allSettings.forEach((function(e){if(!t[e.path]){var a=e.group._settingsDefault[e.key];e.setting.get()!==a&&e.setting.set(a)}})),!this.userEncryptionSentinel.get()&&bo.crypto.getKeyInfo(y.a.EncryptionKeys.UserPassword)&&this.removeEncryptionKey(y.a.EncryptionKeys.UserPassword),setTimeout((function(){"string"===typeof o.platforms.get()&&o.platforms.set({},!1),o.platforms.setProperty(w.a.getUserPlatformConfig(),{d:Date.now(),v:y.a.jsVersion})}),0)),"Sunday"===this.dayWeekStart.get()&&this.dayWeekStart.set(0),"Monday"===this.dayWeekStart.get()&&this.dayWeekStart.set(1),bo.DisplaySettings.init(),this.isLoading=!1,this._isLoaded=!0,this.onLoadCbs.forEach((function(e){return e()})),this.onLoadCbs=[],a&&(this.onLoadRemoteCbs.forEach((function(e){return e()})),this.onLoadRemoteCbs=[],this._isLoadedRemote=!0);case 18:case"end":return e.stop()}}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"registerGroup",value:function(e,t,a){var n,r=this,i=[];m.default.isString(e)&&(m.default.shouldLog(y.a.LogLevels.Settings)&&m.default.log("SETTINGS: Registered Group - ",e),n=e,this[e]={oldSettings:a},e=this[e]),e.listen=function(e){i.push(e)},e.unlisten=function(e){i.remove(e)},e.onChange=function(e,t,a){if(r._isLoaded&&(m.default.isObject(t)?!m.default.deepEqual(t,a):t!==a)){var o=0;r._save(e,n,t);for(var s=0;s<i.length;s++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;i[s](t,a)}}},e._settingsDefault||(e._settingsRemote={},e._settingsDefault={},e._settingsAbbrevs={},e._settingsAbbrevsIn={}),this._allGroups.push({id:t,group:e}),n&&(this._groupAbbrevs[n]=t,this._groupAbbrevsIn[t]=n)}},{key:"registerSettings",value:function(e,t,a){for(var n=0,r=0;r<e.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=e[r],o=i[0],s=i[1],l=i[2];this.registerSetting(o,s,t,a,l)}}},{key:"registerSetting",value:function(e,t,a,n,r){if(m.default.isString(a)&&(a=this[a]),n&&(a._settingsRemote[e]=!0),void 0!==r&&(a._settingsDefault[e]=r),a._settingsAbbrevs[e]=t,a._settingsAbbrevsIn[t]=e,Kt.includes(e)?a[e]=new ke.a(r,a.onChange.bind(this,e)):Yt.includes(e)?a[e]=new te.a(r,a.onChange.bind(this,e)):a[e]=new P.a(r,a.onChange.bind(this,e),!0),n){var i=this._allGroups.indexOfWithProperty("group",a);if(i>=0){var o=this._allGroups[i].id;this._allSettings.push({path:(o?o+"\\":"")+t,group:a,key:e,abbrev:t,setting:a[e]})}else 0}}},{key:"getDefaultItemText",value:function(e){return(e=e||this.defaultItemPrefix.get())?e+" ":""}},{key:"getSettingAbbrev",value:function(e,t){return(t?this[t]:this)._settingsAbbrevs[e]}},{key:"getSettingInfoFromAbbrev",value:function(e){var t,a,n=e.split("\\");if(n.length>1?(a=this[a=this._groupAbbrevsIn[n[0]]],t=n[1]):(a=this,t=n[0]),(!a.oldSettings||!a.oldSettings[t])&&(t=a._settingsAbbrevsIn[t],!e.includes("\\")||!e.endsWith("w"))){0;try{m.default.PAssert(313,a&&a[t],"Missing group for setting",e)}catch(r){m.default.reportError(r)}}return{group:a,key:t}}},{key:"getValueFromAbbrev",value:function(e){var t=this.getSettingInfoFromAbbrev(e),a=t.group,n=t.key;if(a&&a[n])return a[n].get()}},{key:"_save",value:function(){var e=me()(pe.a.mark((function e(t,a,n){var r,i,o,s,l,u;return pe.a.wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(r=a?this[a]:this,i=!this.isLoading&&r._settingsRemote[t],o=r._settingsAbbrevs[t],s=a?this._groupAbbrevs[a]+"\\":"",l=s+o,!Xt.includes(t)){e.next=14;break}return e.next=11,this.getEncryptedValue(t,n,bo.crypto.getKeyInfo(this.getBestUserEncryption()));case 11:e.t0=e.sent,e.next=15;break;case 14:e.t0=n;case 15:u=e.t0,j.a.setSetting(l,n,i,u);case 17:case"end":return e.stop()}}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"getEncryptionKey",value:function(e){var t=this._encryptionKeyInfo;return t&&t[e]?t[e].key:void 0}},{key:"removeEncryptionKey",value:function(e){var t=Object.assign({},this.encryptionKeys.get());bo.crypto.removeKey(e),delete t[e],this.encryptionKeys.set(t)}},{key:"addEncryptionKey",value:function(){var e=me()(pe.a.mark((function e(t,a){var n;return pe.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:(n=Object.assign({},this.encryptionKeys.get()))[t]=a,e.next=6;break;case 6:return e.abrupt("return",this.setEncryptionKeys(n));case 7:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"setEncryptionKeys",value:function(){var e=me()(pe.a.mark((function e(t){return pe.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return this._isSettingEncryptionKeys=!0,this.encryptionKeys.set(t),this._isSettingEncryptionKeys=!1,e.abrupt("return",this._onEncryptionKeysChange(t));case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"shouldShowHelp",value:function(e){var t=this.closedHelps.get();return!t||!t[e]}},{key:"closeHelp",value:function(e){var t=m.default.clone(this.closedHelps.get())||{};t[e]=!0,this.closedHelps.set(t)}},{key:"uncloseHelp",value:function(e){var t=m.default.clone(this.closedHelps.get())||{};delete t[e],this.closedHelps.set(t)}},{key:"isBackupEnabled",value:function(){return this.backupFrequency.get()>0}},{key:"hasUserPassword",value:function(){var e=this.encryptionKeys.get();return e&&!!e[y.a.EncryptionKeys.UserPassword]}},{key:"getBestUserEncryption",value:function(){var e=this.encryptionKeys.get();return e&&e[y.a.EncryptionKeys.UserPassword]?y.a.EncryptionKeys.UserPassword:y.a.EncryptionKeys.Global}},{key:"createDefaultAgendaSort",value:function(){return{overdue:-2,"#now":-1,starred:1,important:2,"#next":3,"#soon":101,"#later":301,"#someday":1401}}},{key:"getUserIdentifier",value:function(){return m.default.isDemoMode()?"demouser":this.activeUser.get()}},{key:"onLoaded",value:function(e){this._isLoaded?e():this.onLoadCbs.push(e)}},{key:"onLoadedRemote",value:function(e){this._isLoadedRemote?e():this.onLoadRemoteCbs.push(e)}},{key:"_onEncryptionKeysChange",value:function(){var e=me()(pe.a.mark((function e(t){var a,n;return pe.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(this._isSettingEncryptionKeys){e.next=8;break}return this._encryptionKeyInfo={},a={},Object.keys(t).forEach((function(e){a[e]=t[e]})),e.next=6,bo.crypto.importKeys(a);case 6:n=e.sent,this._encryptionKeyInfo=n;case 8:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getEncryptedSettings",value:function(){var e=this;return Xt.map((function(t){var a=e.getSettingAbbrev(t),n=e.getValueFromAbbrev(a);if(n)return[t,a,n]})).filter((function(e){return!!e}))}},{key:"getRemoteSaveValue",value:function(){var e=me()(pe.a.mark((function e(t,a){var n;return pe.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(n=this[t].get(),!Xt.includes(t)){e.next=3;break}return e.abrupt("return",this.getEncryptedValue(t,n,a));case 3:return e.abrupt("return",n);case 4:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getEncryptedValue",value:function(){var e=me()(pe.a.mark((function e(t,a,n){var r;return pe.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!m.default.isObject(a)){e.next=7;break}return r=m.default.clone(a),e.next=4,Promise.all(Object.keys(a).map(function(){var e=me()(pe.a.mark((function e(t){return pe.a.wrap((function(e){for(var i=0,o=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,bo.crypto.encryptText(n.key,a[t],t);case 2:r[t]=e.sent;case 3:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 4:return e.abrupt("return",r);case 7:return e.abrupt("return",bo.crypto.encryptText(n.key,a,t));case 8:case"end":return e.stop()}}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"decryptValue",value:function(){var e=me()(pe.a.mark((function e(t,a,n){return pe.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(!m.default.isObject(a)){e.next=6;break}return e.next=3,Promise.all(Object.keys(a).map(function(){var e=me()(pe.a.mark((function e(t){return pe.a.wrap((function(e){for(var r=0,i=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,bo.crypto.decryptText(n.key,a[t],t);case 2:a[t]=e.sent;case 3:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return e.abrupt("return",a);case 6:return e.abrupt("return",bo.crypto.decryptText(n.key,a,t));case 7:case"end":return e.stop()}}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"addEmailViewAccount",value:function(e,t,a,n){this.emailViewAccounts.find((function(a){return a.e===e&&a.s===t}))||this.emailViewAccounts.push(m.default.removeNullUndefined({e:e,s:t,n:a,b:n}))}}]),a}(D.a),_()(Vt.prototype,"_onEncryptionKeysChange",[b.a],Object.getOwnPropertyDescriptor(Vt.prototype,"_onEncryptionKeysChange"),Vt.prototype),Vt),Jt=0,Zt=(qt=function(){function e(t,a){i()(this,e);try{m.default.PAssert(558,t,"Must provide valid message info")}catch(n){m.default.reportError(n)}try{m.default.PAssert(559,a,"Must provide a valid message owner")}catch(n){m.default.reportError(n)}if(this.info=t,this.id=t.id||"Message_"+Jt++,this.owner=a,this.timeout=t.timeout||y.a.ToastTimeoutDefault,this.text=new P.a(t.text),this.action=t.action||y.a.MessageAction.Default,this.action2=t.action2,this.isBig=t.big,this.noClose=t.noClose,this.data=t.data,this.hold=!t.timeout&&!1!==t.hold&&(t.hold||this.action!==y.a.MessageAction.Default),this.hold&&(this.timeout=Number.MAX_SAFE_INTEGER),this.noIgnore=t.noIgnore,this.onCloseFn=t.onClose,this.clearTimeout=void 0,this._isVisible=!1,this.actionText=t.actionText,!this.actionText)switch(this.action){case y.a.MessageAction.Default:this.actionText="";break;case y.a.MessageAction.Reload:case y.a.MessageAction.ResetClient:this.actionText="RELOAD";break;case y.a.MessageAction.Okay:this.actionText="OKAY";break;case y.a.MessageAction.Blog:this.actionText="BLOG";break;case y.a.MessageAction.Undo:this.actionText="UNDO";break;case y.a.MessageAction.LoginScreen:this.actionText="LOGIN";break;case y.a.MessageAction.Contact:this.actionText="CONTACT";break;case y.a.MessageAction.OpenSettings:case y.a.MessageAction.OpenAccountSettings:case y.a.MessageAction.OpenGeneralSettings:case y.a.MessageAction.OpenCalendarSettings:this.actionText="SETTINGS";break;case y.a.MessageAction.OpenGoogleDrive:this.actionText="GOOGLE DRIVE";break;case y.a.MessageAction.OpenDisplaySettings:this.actionText="DISPLAY SETTINGS";break;case y.a.MessageAction.StartDemo:this.actionText="START DEMO"}}return s()(e,[{key:"show",value:function(){this._isVisible||(this._isVisible=!0,this.hold||(this.clearTimeout=setTimeout(this.hide,this.timeout)),this.owner.onMessageShow(this))}},{key:"hide",value:function(){this._isVisible&&(this._isVisible=!1,clearTimeout(this.clearTimeout),this.clearTimeout=void 0,this.onCloseFn&&this.onCloseFn(this),this.owner.onMessageHide(this))}},{key:"isVisible",value:function(){return this._isVisible}},{key:"doAction",value:function(e){if(this.isVisible()){if(m.default.isFunction(this.action))this.action();else switch(this.action){case y.a.MessageAction.None:case y.a.MessageAction.Okay:case y.a.MessageAction.Default:break;case y.a.MessageAction.Reload:m.default.reload();break;case y.a.MessageAction.LoginScreen:ve.a.removeURLParam("demo"),ve.a.removeURLParam("demo",!0);break;case y.a.MessageAction.Demo:ve.a.insertURLParam("demo","true");break;case y.a.MessageAction.ResetClient:break;case y.a.MessageAction.OpenURL:var t=this.data?this.data.url:void 0;try{m.default.PAssert(560,t,"Should always have a valid URL to navigate")}catch(a){m.default.reportError(a)}t&&bo.openUrl(t);break;case y.a.MessageAction.Blog:bo.openUrl("https://www.moo.do/blog/updates");break;case y.a.MessageAction.Undo:nt.a.undo();break;case y.a.MessageAction.Contact:bo.menus.openModal(y.a.Modals.ReportBug);break;case y.a.MessageAction.OpenSettings:bo.menus.openSettings("Plugins");break;case y.a.MessageAction.OpenGeneralSettings:bo.menus.openSettings("General");break;case y.a.MessageAction.OpenAccountSettings:bo.menus.openSettings("Account");break;case y.a.MessageAction.OpenCalendarSettings:bo.menus.openSettings("Calendar");break;case y.a.MessageAction.OpenGoogleDrive:bo.openUrl("https://drive.google.com");break;case y.a.MessageAction.OpenDisplaySettings:bo.DisplaySettings.isOpen.set(!0);break;case y.a.MessageAction.StartDemo:window.postMessage("resume","*");break;default:try{m.default.PAssert(561,!1,"Invalid message action, add a new case here or pass in a function",this.action)}catch(a){m.default.reportError(a)}}e&&m.default.stopPropagation(e),this.info.holdOnAction||this.hide()}}},{key:"onTapIgnore",value:function(e){this.isVisible()&&!this.noIgnore&&this.hide()}},{key:"setText",value:function(e){this.text.set(e)}}]),e}(),_()(qt.prototype,"hide",[b.a],Object.getOwnPropertyDescriptor(qt.prototype,"hide"),qt.prototype),_()(qt.prototype,"doAction",[b.a],Object.getOwnPropertyDescriptor(qt.prototype,"doAction"),qt.prototype),_()(qt.prototype,"onTapIgnore",[b.a],Object.getOwnPropertyDescriptor(qt.prototype,"onTapIgnore"),qt.prototype),qt),$t=function(){function e(){i()(this,e),this.queue=new te.a,this.queueUpdateMessages=new te.a,this.defaultMessages=[],this.defaultMessages[y.a.MessageID.Undefined]=void 0}return s()(e,[{key:"getMessageById",value:function(e){void 0===this.defaultMessages[e]&&this.initMessageById(e);try{m.default.PAssert(455,void 0!==this.defaultMessages[e],"After init message should always be defined")}catch(t){m.default.reportError(t)}return this.defaultMessages[e]}},{key:"testMessageById",value:function(e){return!!this.defaultMessages[e]}},{key:"initMessageById",value:function(e){var t;switch(e){case y.a.MessageID.ConnectionError:t={text:"Connection error detected. Please reload to try again.",action:y.a.MessageAction.Reload};break;case y.a.MessageID.OfflineUndo:t={text:"Offline undo/redo has been disabled temporarily.",hold:!0};break;case y.a.MessageID.FatalError:t={text:"There was a fatal error in the application. "+w.a.actionVerbCaps()+" to restart.",action:y.a.MessageAction.Reload};break;case y.a.MessageID.MailbirdClick:t={text:"Sorry, emails can currently only be opened from inside Mailbird.",action:y.a.MessageAction.Okay};break;case y.a.MessageID.ExitDemo:t={text:"Changes are not saved in demo",action:y.a.MessageAction.LoginScreen,hold:!0,noIgnore:!0};break;case y.a.MessageID.ShareFailure:t={text:"There was an error sharing the file you attached.",action:y.a.MessageAction.OpenSettings,timeout:8e3};break;case y.a.MessageID.ThisIsDemo:t={text:"Click anywhere to try this live demo of <b>Moo.do</b>",onClose:function(){window.parent.postMessage("userInteracted","*")},hold:!0,big:!0};break;case y.a.MessageID.InviteFailure:t={text:"Failed to use referral code. Please try again in your account settings.",action:y.a.MessageAction.OpenAccountSettings};break;case y.a.MessageID.InviteSuccess:t={text:"You have successfully used your referral code. Enjoy your additional free trial of premium Moo.do!",action:y.a.MessageAction.Okay};break;case y.a.MessageID.PremiumRequired:t={text:"You must be a premium subscriber to use plugins.",action:y.a.MessageAction.OpenAccountSettings,actionText:"LEARN MORE"};break;case y.a.MessageID.TrialOver:t={text:"Your trial of Premium has come to an end. Please sign up to continue using Premium features.",action:y.a.MessageAction.OpenAccountSettings,actionText:"SETTINGS"};break;case y.a.MessageID.TrialEndSoon:t={text:"Your trial of Premium is ending soon. Please sign up to continue using Premium features after your trial ends.",action:y.a.MessageAction.OpenAccountSettings,actionText:"SETTINGS"};break;case y.a.MessageID.WarnLargeFile:t={text:"Warning: You are uploading a large file. If the upload is not successful, try uploading directly to Google Drive.",action:y.a.MessageAction.OpenGoogleDrive};break;case y.a.MessageID.InviteInvalid:t={text:"Invalid referral code. Please try again in your account settings.",action:y.a.MessageAction.OpenAccountSettings,actionText:"OKAY"};break;case y.a.MessageID.NoSharingWarning:t={text:"You have shared your document with someone else, however the files attached have not been shared due to your permissions settings.",action:y.a.MessageAction.OpenSettings,actionText:"SETTINGS"};break;case y.a.MessageID.LostPermission:0,m.default.log("Moo.do has lost permissions for a plugin or option you enabled. Please update your plugin settings."),console.trace(),t={text:"Moo.do has lost permissions for a plugin or option you enabled. Please update your plugin settings.",action:y.a.MessageAction.OpenSettings,actionText:"SETTINGS"};break;case y.a.MessageID.CalendarSync:t={text:"There was an error syncing your calendars.",action:y.a.MessageAction.OpenCalendarSettings,actionText:"SETTINGS"};break;case y.a.MessageID.EmailSendFail:t={text:"Your email was not sent, there was an error contacting the remote server."};break;case y.a.MessageID.EmailUpdateFail:t={text:"Unable to save draft to Gmail. Your draft is still saved locally."};break;case y.a.MessageID.EmailLabelFail:t={text:"Unable to sync you changes to Gmail. Your changes are still saved locally."};break;case y.a.MessageID.EmailSyncFail:t={text:"There was an error syncing your Gmail data.",action:function(){bo.pluginManager.getPluginGmail().runThreadSync()},actionText:"RETRY"};break;case y.a.MessageID.DemoPluginClick:t={text:"Outside of demo mode this would show you more information about the plugin.",timeout:3e3};break;case y.a.MessageID.PromptScriptStart:t={text:"Start demo",hold:!0,big:!0,action:y.a.MessageAction.StartDemo};break;case y.a.MessageID.SnoozeOffline:t={text:"You must be online to Snooze. Please try again when Moo.do has connected.",action:y.a.MessageAction.Okay};break;case y.a.MessageID.NeedDrivePermission:t={text:"Attaching files already in Drive requires 'Shared Drive' to be enabled in settings.",action:y.a.MessageAction.OpenSettings};break;case y.a.MessageID.SetupGmailViews:t={text:"Sending email requires setting up Gmail accounts in settings.",action:y.a.MessageAction.OpenSettings};break;case y.a.MessageID.LostLinked:t={text:"Moo.do has lost access to one of your linked accounts.",action:y.a.MessageAction.OpenSettings};break;case y.a.MessageID.GmailDisabled:t={text:"Gmail may not be enabled on your Google account. Please contact your domain admin or reload app.",action:y.a.MessageAction.Okay};break;case y.a.MessageID.LocalWritesDisabled:t={text:"There was an error writing to the local cache. Please restart Moo.do.",action:y.a.MessageAction.Reload};break;case y.a.MessageID.FlatSearchMultiSelect:t={text:"Editing multiple items in flat search results is not supported because it would have unpredictable results."};break;case y.a.MessageID.FlatSearchTab:t={text:"Indenting is not supported in List view because it would have unpredictable results."};break;case y.a.MessageID.ReadOnlyCalendar:t={text:"You do not have write permission for the calendar you are trying to modify."};break;case y.a.MessageID.CalendarSaveFail:t={text:"Some changes you made were not able to be saved properly. Please free up disk space and try again."};break;case y.a.MessageID.QuotaError:t={text:"You have run out of disk space. Moo.do will be unable to operate offline.",timeout:3e3};break;case y.a.MessageID.ReselectEmail:t={text:"Please re-select the email item and try again."};break;case y.a.MessageID.ReactError:t={text:"The application has encountered an error. The developers have been notified, but sending a bug report describing what happened would be very helpful!",actionText:"REPORT",action:function(){bo.menus.openModal(y.a.Modals.ReportBug)}};break;case y.a.MessageID.PaneLoadTimeout:t={text:"The file is taking an unusually long time to load. Please try loading again.",actionText:"RELOAD",action:m.default.reload};break;case y.a.MessageID.GmailViewsNeedSignin:m.default.log("Moo.do is not signed into your Gmail account. Please open settings and click FIX in the Gmail accounts to continue syncing your emails."),t={text:"Moo.do is not signed into your Gmail account. Please open settings and click FIX in the Gmail accounts to continue syncing your emails.",action:y.a.MessageAction.OpenSettings,actionText:"SETTINGS"};break;default:try{m.default.PAssert(456,!1,"Invalid MessageID: ",e)}catch(a){m.default.reportError(a)}}t&&(this.defaultMessages[e]=new Zt(t,this))}},{key:"pushMessage",value:function(e){try{m.default.PAssert(457,e,"Must supply a valid message to display")}catch(a){m.default.reportError(a)}var t;if(e instanceof Zt)t=e;else if(m.default.isObject(e))this.hasMsgWithText(e.text)||(t=new Zt(e,this));else if(m.default.isString(e))this.hasMsgWithText(e)||(t=new Zt({text:e},this));else if(!(t=this.getMessageById(e))){try{m.default.PAssert(458,!1,"Invalid data passed to message creation")}catch(a){m.default.reportError(a)}m.default.log("Message not created properly",e)}return t&&t.show(),t}},{key:"clearMessageByID",value:function(e){this.queue.get().some((function(t){if(t.id===e)return t.hide(),!0}))}},{key:"clearMessage",value:function(e){var t;return e instanceof Zt?t=e:this.testMessageById(e)&&(t=this.getMessageById(e)),t&&t.hide(),t}},{key:"isMessageVisible",value:function(e){var t=!1;e instanceof Zt?t=e.isVisible():this.testMessageById(e)&&(t=this.getMessageById(e).isVisible());return t}},{key:"onMessageShow",value:function(e){try{m.default.PAssert(459,e,"Must pass in a valid message to add to the queue")}catch(t){m.default.reportError(t)}try{m.default.PAssert(460,e&&e.doAction,"Message added to queue must have valid API exposed - doAction")}catch(t){m.default.reportError(t)}e instanceof Zt?this.queue.push(e):m.default.reportError(new Error("Toast message must be an instance of Toast"),e)}},{key:"onMessageHide",value:function(e){try{m.default.PAssert(461,e,"Must pass in a valid message to be removed from the queue")}catch(a){m.default.reportError(a)}var t=this.queue.indexOf(e);if(t<0)try{m.default.PAssert(462,!1,"Trying to remove an invalid message from the queue")}catch(a){m.default.reportError(a)}else this.queue.splice(t,1)}},{key:"hasMsgWithText",value:function(e){return!!this.queue.get().find((function(t){return t.text.get()===e}))}},{key:"pushUpdateMessage",value:function(e){var t=this,a=e;a.onClose=function(){t.queueUpdateMessages.remove(a)},this.queueUpdateMessages.push(a)}}]),e}(),ea=a(40),ta=(Gt=function(){function e(t){i()(this,e),this._taskCB=t,this._isRunning=!1,this._disabled=!1,this._workAvailable=!1,this._runCount=0,se.a.listen("lowImpactBegin",this.handleLowImpactBegin)}return s()(e,[{key:"getStats",value:function(){return{runCount:this._runCount,isRunning:this._isRunning,isDisabled:this._disabled}}},{key:"disable",value:function(){this._disabled=!0}},{key:"enable",value:function(){this._disabled=!1}},{key:"handleLowImpactBegin",value:function(){this._startTaskRun()}},{key:"requestRun",value:function(){this._forceRun=!0,this._startTaskRun()}},{key:"notifyWorkAvailable",value:function(){this._workAvailable=!0,m.default.isLowImpact()&&!this._isRunning&&this._startTaskRun()}},{key:"_startTaskRun",value:function(){if(!this._isRunning&&!this._disabled&&this._workAvailable){try{m.default.PAssert(1336,this._forceRun||m.default.isLowImpact(),"Must always run a task during a low impact timeframe")}catch(e){m.default.reportError(e)}this._workAvailable=!1,this._isRunning=!0,this._runCount++,this._taskCB(this._onTaskEndRun)}}},{key:"_onTaskEndRun",value:function(e){try{m.default.PAssert(1337,this._isRunning,"Must be currently running task to finish")}catch(t){m.default.reportError(t)}this._isRunning=!1,this._forceRun=!1,(e||this._workAvailable)&&(this._workAvailable=!0,m.default.isLowImpact()&&this._startTaskRun())}}]),e}(),_()(Gt.prototype,"handleLowImpactBegin",[b.a],Object.getOwnPropertyDescriptor(Gt.prototype,"handleLowImpactBegin"),Gt.prototype),_()(Gt.prototype,"_onTaskEndRun",[b.a],Object.getOwnPropertyDescriptor(Gt.prototype,"_onTaskEndRun"),Gt.prototype),Gt);function aa(e,t,a,n,r,i){try{m.default.PAssert(1331,m.default.isFunction(r),"Must supply a valid entry CB")}catch(o){m.default.reportError(o)}try{m.default.PAssert(1332,m.default.isFunction(i),"Must supply a valid done CB")}catch(o){m.default.reportError(o)}this._nextPageToken=e,this._inUse=!1,this._q=t,this._info=a,this._maxResults=n,this._entryCB=r,this._doneCB=i}var na={updateToken:function(e){try{m.default.PAssert(1333,this._nextPageToken!==e,"Should never update token to be same value")}catch(t){m.default.reportError(t)}this._nextPageToken=e},getNextPageToken:function(){return this._nextPageToken},getInfo:function(){return this._info},getQuery:function(){return this._q},getEntryCB:function(){return this._entryCB},getDoneCB:function(){return this._doneCB},getMaxResults:function(){return this._maxResults},hasMorePages:function(){return!!this._nextPageToken},notifyBeginUse:function(){try{m.default.PAssert(1334,!this._inUse,"Should not currently be in use")}catch(e){m.default.reportError(e)}this._inUse=!0},notifyEndUse:function(){try{m.default.PAssert(1335,this._inUse,"Should always be using token when done")}catch(e){m.default.reportError(e)}this._inUse=!1},isInUse:function(){return this._inUse}};ve.a.defineBase(aa),ve.a.extend(aa.prototype,na);var ra,ia=aa,oa=1,sa=2,la=3,ua=4,ca=5,da=6,ha=function(){function e(t,a,n){i()(this,e),this.id=a,this._oldLocalID=void 0,this._plugin=t,this._loadState=oa,this._subscribers=[],this._countInUse=0,this._iteratingSubscribers=!1,this._numRemoteRequests=0,this._inlineData=n,this.load()}return s()(e,[{key:"load",value:function(e){this._loadState=sa,this._plugin.requestData(this,e)}},{key:"notifyDataRequested",value:function(){try{m.default.PAssert(1171,!this.isLoaded(),"Should not request additional data once loaded")}catch(e){m.default.reportError(e)}this._numRemoteRequests++,this._loadState=la}},{key:"notifyDataLoaded",value:function(e,t,a,n){try{m.default.PAssert(1172,t||this._loadState!==ca||m.default.isFlagSet(e,y.a.PluginLoad.Full),"Should not load preview data after full data has been loaded")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1173,!t||this._loadState===ua||m.default.isFlagSet(e,y.a.PluginLoad.Full),"Incoming update much match previous type")}catch(r){m.default.reportError(r)}this._loadState=m.default.isFlagSet(e,y.a.PluginLoad.Full)?ca:ua,this.onUpdate(!0,a,n)}},{key:"notifyDataMutated",value:function(e,t){try{m.default.PAssert(1174,e&&m.default.isArray(e),"Must specify valid update fields when mutating attachment state manually")}catch(a){m.default.reportError(a)}this.onUpdate(!0,e,t)}},{key:"notifyDataRequestFailed",value:function(){try{m.default.PAssert(1175,this._loadState===da||this._loadState===la||this._loadState===ua,"Must be requesting remote data or a preview cache was able to service after the request was sent")}catch(e){m.default.reportError(e)}if(this._loadState===da);else if(this._loadState===la)this._loadState=da;else if(this._loadState===ua)try{m.default.PAssert(1176,!1,"Failed remote reuqest but serviced by preview cache, should not have made the request?")}catch(e){m.default.reportError(e)}else try{m.default.PAssert(1177,!1,"Invalid loadstate when remote request failed: ",this._loadState)}catch(e){m.default.reportError(e)}}},{key:"isLoaded",value:function(){return this._loadState===ua||this._loadState===ca}},{key:"needsRemoteData",value:function(){return this._loadState!==ca}},{key:"getOldID",value:function(){return this._oldLocalID}},{key:"changeID",value:function(e){try{m.default.PAssert(1178,this.id!==e,"Change the ID of an attachment to the same value")}catch(r){m.default.reportError(r)}if(this.id!==e){var t=0,a=this.id;this.id=e,this._oldLocalID=a;try{m.default.PAssert(1179,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(r){m.default.reportError(r)}this._iteratingSubscribers=!0;for(var n=0;n<this._subscribers.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{this._subscribers[n].onAttachmentIDChange(this,a)}catch(i){m.default.reportError(i)}}this._iteratingSubscribers=!1,this._oldLocalID=void 0}}},{key:"delayChangeID",value:function(){var e=0;try{m.default.PAssert(1180,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(r){m.default.reportError(r)}this._iteratingSubscribers=!0;for(var t=0;t<this._subscribers.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._subscribers[t];try{var n=a.onAttachmentIDChange.bind(a,this,this.id);setTimeout(n,0)}catch(i){m.default.reportError(i)}}this._iteratingSubscribers=!1}},{key:"isFieldDefined",value:function(e){return this._plugin.isFieldDefined(e)}},{key:"hasField",value:function(e){return this._plugin.hasAttachField(this,e)}},{key:"getField",value:function(e){return this._plugin.getAttachField(this,e)}},{key:"updateField",value:function(e,t,a,n){return this._plugin.updateAttachField(this,e,t,a,n)}},{key:"updateInlineField",value:function(e,t){this._inlineData&&(this._inlineData[e]=t,this.onUpdate(!0,[e],y.a.ChangeType.Local))}},{key:"fieldsHaveParseEffect",value:function(e){return this._plugin.fieldsHaveParseEffect(e)}},{key:"isFieldDefault",value:function(e){return this._plugin.isAttachFieldDefault(this,e)}},{key:"fieldNeedsWrite",value:function(e,t){return this._plugin.fieldNeedsWrite(this,e,t)}},{key:"getFieldAsDate",value:function(e){var t=this._plugin.getAttachField(this,e);if(t)return new Date(t).toString(bo.International.getFormat(y.a.DFormat.MonthDay));try{m.default.PAssert(1181,!1,"Invalid attachment date field: ",this._plugin.id,e)}catch(a){m.default.reportError(a)}}},{key:"getPlugin",value:function(){return this._plugin}},{key:"getData",value:function(){return this._plugin.getCacheData(this.id)}},{key:"getEmbedString",value:function(){return this._plugin.getAttachmentEmbedString(this)}},{key:"getTitleString",value:function(){return this._plugin.getAttachmentTitleString(this)}},{key:"unload",value:function(){this._loadState=oa,this._plugin.releaseAttachment(this)}},{key:"match",value:function(e){return!!this.isLoaded()&&this._plugin.matchAttachment(this,e)}},{key:"markInUse",value:function(e){0===this._countInUse&&this._plugin.notifyAttachmentInUse(this,e),this._countInUse++}},{key:"markUnused",value:function(e){this._countInUse--,0===this._countInUse&&this._plugin.notifyAttachmentUnused(this,e);try{m.default.PAssert(1182,this._countInUse>=0,"Should never have negative users of the attachment")}catch(t){m.default.reportError(t)}}},{key:"isInUse",value:function(){return this._countInUse>0}},{key:"subscribe",value:function(e){try{m.default.PAssert(1183,this._subscribers.indexOf(e)<0,"Must not double subscribe")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1184,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1185,e.onAttachmentUpdate,"Must specify a valid subscriber callback")}catch(t){m.default.reportError(t)}this._subscribers.push(e)}},{key:"unsubscribe",value:function(e){try{m.default.PAssert(1187,this._subscribers.indexOf(e)>=0,"Subscriber should be active")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1188,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(t){m.default.reportError(t)}this._subscribers.remove(e)}},{key:"forEachItem",value:function(e,t){var a=0;try{m.default.PAssert(1190,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(r){m.default.reportError(r)}this._iteratingSubscribers=!0;for(var n=0;n<this._subscribers.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(m.default.isVMLI(this._subscribers[n])&&(!e||this._subscribers[n].belongsToItemStore(e)))try{t(this._subscribers[n])}catch(i){m.default.reportError(i)}}this._iteratingSubscribers=!1}},{key:"onUpdate",value:function(e,t,a){var n=0;try{m.default.PAssert(1191,!t||m.default.isArray(t),"Must supply a valid value for updateFields:",t)}catch(s){m.default.reportError(s)}if(a=a||y.a.ChangeType.Remote,e&&this.isInUse())try{this._plugin.notifyAttachmentUpdated(this)}catch(l){m.default.reportError(l)}if(e||(a|=y.a.ChangeType.PluginLoad),t)for(var r=0,i=0;i<t.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;try{m.default.PAssert(1192,this._plugin.isFieldDefined(t[i]),"Invalid field supplied to be updated: ",t[i])}catch(s){m.default.reportError(s)}}try{m.default.PAssert(1193,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(s){m.default.reportError(s)}this._iteratingSubscribers=!0;for(var o=0;o<this._subscribers.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;try{this._subscribers[o].onAttachmentUpdate(this,t,a)}catch(l){m.default.reportError(l)}}this._iteratingSubscribers=!1}},{key:"notifyItemNoteChanged",value:function(e){this._plugin.notifyItemNoteChanged(this,e)}},{key:"notifyItemTextChanged",value:function(e,t){this._plugin.notifyItemTextChanged(this,e,t)}},{key:"notifyItemDateChanged",value:function(e){this._plugin.notifyItemDateChanged(this,e)}},{key:"notifyItemPropertyChanged",value:function(e,t,a){this._plugin.notifyItemPropertyChanged(this,e,t,a)}},{key:"isLocalOnlyAttachment",value:function(){return m.default.isTempId(this.id)}},{key:"isType",value:function(e){return this._plugin.getType()===e}},{key:"isPlugin",value:function(e){return this._plugin.id===e}},{key:"shouldBeDeleted",value:function(){return this.isFieldDefined("isDeleted")&&this.hasField("isDeleted")&&this.getField("isDeleted")&&this.isLocalOnlyAttachment()}},{key:"hasFatalError",value:function(){return this._loadState===da&&this._numRemoteRequests>3}},{key:"hasInlineData",value:function(){return!!this._inlineData}},{key:"getInlineData",value:function(){return this._inlineData}},{key:"setInlineData",value:function(e){this._inlineData=e,this._loadState=ca}},{key:"clearInlineData",value:function(){this._inlineData=void 0}}]),e}(),fa=[1,5,20,40,80,170],pa=[y.a.HTTPStatusCode.Network,y.a.HTTPStatusCode.Timeout,y.a.HTTPStatusCode.TooMany,y.a.HTTPStatusCode.ServerError,y.a.HTTPStatusCode.BadGateway,y.a.HTTPStatusCode.Unavailable,y.a.HTTPStatusCode.GatewayTimeout,null],ga=[y.a.HTTPStatusCode.Forbidden,y.a.HTTPStatusCode.TooMany],ma={};ma[y.a.PluginDependency.DemoMode]={online:!1},ma[y.a.PluginDependency.PremiumSub]={online:!1},ma[y.a.PluginDependency.EarlyAccess]={online:!1};var va=y.a.DETAILED_STATS,ya=(ra=function(){function e(t,a,n,r,o){var s=this;i()(this,e);try{m.default.PAssert(1040,t,"Must supply a valid id")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1041,n,"Must supply a valid name")}catch(l){m.default.reportError(l)}this.id=t,this.name=n,this.isBuiltin=r,this.DefaultRequestTimeout=m.default.seconds(15),this.LongWaitThreshold=m.default.seconds(7),this._paneType="Pane"+t,this._acProviderId="AC"+t,this._settingsGroup="plugin"+this.id,this.pluginMargin=12,this.pluginPadding=24,this.isActiveObs=new P.a(!1),this._isReady=!1,this._hasDeactivated=!1,this._propertyDescriptors={},this._propertySets={},this._attachKeys=[],this._attachCache={},this._dataCache={},this._defaultItemStore=void 0,this._activeItemStore={},this._defaultZoomItems={},this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._isRateLimited=!1,this._lastRateLimitTime=void 0,this._numLongWaitRequests=0,this._numSendRequests=0,this._numHandledRequests=0,this._totalRequestSendTime=0,this._totalRequestHandleTime=0,this._requiresOfflineAuth=!1,this._activeAttachments=[],this._numActivePanes=0,this._requestCounter=0,this._unloadedDependencies=this.getDependencies(),this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._loadedInitialData=!1,this._hasLoadedCaches=!1,this._registeredCaches={},this._registeredModals={},this._createdModals={},this._recurringTasks=[],this._lowImpactTasks={},this._batchedResponses={},this._requestsInProgress={},this.Settings={},ve.a.binder(this,"_retryRemoteRequest","_reqSortFn"),bo.settings.registerGroup(this._settingsGroup,a,o),this.registerSetting("IsEnabled","isEnabled","e",!0,r),this.getDataPane()&&ae.a.registerPaneType(this,this._paneType,this.name,this.getDataPane(),this.getPaneIcon(),this.getPanePriority()),va&&(this.__Stats={requestData:0,remoteRequests:0,canceledRequests:0,dupedRequests:0,combinedRequests:0,remoteBatches:0,remoteRetries:0,canceledBatches:0,actualRemoteCallsSent:0,cacheWrites:0,cacheUpdates:0,findByField:0,createdAttachments:0},this.__TrackedStats={},this.__ReqStats=[]),bo.settings.syncAccounts.listen(this._onSyncAccountsChanged),this.onSettingChanged(this.Settings.IsEnabled,(function(e,t){e&&bo.pluginManager.activatePlugin(s)}))}return s()(e,[{key:"getType",value:function(){return y.a.PluginType.Unknown}},{key:"sendEvent",value:function(e,t){return m.default.sendEvent(this.id,e,t)}},{key:"getSettingObs",value:function(e){return bo.settings[this._settingsGroup][e]}},{key:"getSetting",value:function(e){return bo.settings[this._settingsGroup][e].get()}},{key:"setSetting",value:function(e,t,a){return bo.settings[this._settingsGroup][e].set(t,a)}},{key:"registerSetting",value:function(e,t,a,n,r){this.Settings[e]=t,bo.settings.registerSetting(t,a,this._settingsGroup,n,r)}},{key:"onSettingChanged",value:function(e,t){bo.settings[this._settingsGroup][e].listen(t)}},{key:"getCacheStats",value:function(e){var t={},a=Object.keys(this._registeredCaches).length,n=0,r=function(r){t[r.id]=r,a===++n&&e(t)};if(a>0)for(var i in this._registeredCaches){if(this._registeredCaches.hasOwnProperty(i))this._registeredCaches[i].getStats(r)}else e()}},{key:"getCacheState",value:function(){var e={};for(var t in this._registeredCaches)if(this._registeredCaches.hasOwnProperty(t)){var a=this._registeredCaches[t];e[t]=a.getState()}return e}},{key:"registerLocalCache",value:function(e,t,a){var n=bo.cacheManager.registerLocalCache(e,t,a);return this._registeredCaches[e]=n,n}},{key:"registerDeferredTaskType",value:function(e,t,a,n){try{m.default.PAssert(1042,e,"Must specify a valid deferred task type")}catch(r){m.default.reportError(r)}bo.deferredTaskManager.registerTaskType(e,t,a,n)}},{key:"scheduleDeferredTask",value:function(e,t,a,n){try{m.default.PAssert(1043,e,"Must supply a valid local ID for deferred task")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1044,t,"Must specify a valid deferred task type")}catch(r){m.default.reportError(r)}bo.deferredTaskManager.scheduleTask(e,t,a,!1,void 0,n)}},{key:"cancelDeferredTask",value:function(e,t){bo.deferredTaskManager.cancelTask(e,t)}},{key:"createRecurringTask",value:function(e,t){var a,n=this.id+"_"+e;return this.hasRecurringTask(e)?a=bo.recurringTaskManager.getRecurringTask(n):(this._recurringTasks.push(e),a=bo.recurringTaskManager.createRecurringTask(n,t)),a}},{key:"getRecurringTask",value:function(e){return bo.recurringTaskManager.getRecurringTask(this.id+"_"+e)}},{key:"hasRecurringTask",value:function(e){return bo.recurringTaskManager.hasRecurringTask(this.id+"_"+e)}},{key:"cancelRecurringTask",value:function(e){var t=this.id+"_"+e;return this._recurringTasks.remove(e),bo.recurringTaskManager.cancelRecurringTask(t)}},{key:"cancelRecurringTasks",value:function(){for(var e=0;this._recurringTasks.length>0;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.cancelRecurringTask(this._recurringTasks[0])}}},{key:"getRecurringStats",value:function(){for(var e=0,t={},a=0;a<this._recurringTasks.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._recurringTasks[a],r=this.getRecurringTask(n);t[n]=r.getStats()}return t}},{key:"registerLowImpactTask",value:function(e,t){try{m.default.PAssert(1045,!this._lowImpactTasks[e],"Must specify different IDs for each task: ",e)}catch(n){m.default.reportError(n)}var a=new ta(t);return this._lowImpactTasks[e]=a,a}},{key:"getLowImpactStats",value:function(){var e={};for(var t in this._lowImpactTasks)if(this._lowImpactTasks.hasOwnProperty(t)){var a=this._lowImpactTasks[t];e[t]=a.getStats()}return e}},{key:"getTrackedStat",value:function(e){if(va)return this.__TrackedStats[e]}},{key:"addTrackedStat",value:function(e){if(va){try{m.default.PAssert(1046,!this.__TrackedStats.hasOwnProperty(e),"Should not double define a tracked stat for a plugin")}catch(t){m.default.reportError(t)}this.__TrackedStats[e]=0}}},{key:"reportTrackedStat",value:function(e){if(va){try{m.default.PAssert(1047,this.__TrackedStats.hasOwnProperty(e),"Must first register a tracked stat before reporting instantces of it")}catch(t){m.default.reportError(t)}this.__TrackedStats[e]++}}},{key:"getStats",value:function(){return{fnCalls:va?this.__Stats:void 0,tracked:va?this.__TrackedStats:void 0,remoteReqs:va?this.__ReqStats:void 0,numItems:this._defaultItemStore?this._defaultItemStore.getCount():-1,activeAttachments:this._activeAttachments.length,numAttach:this._attachKeys.length,numSendRequests:this._numSendRequests,numHandledRequests:this._numHandledRequests,numLongWaitRequests:this._numLongWaitRequests,avgRequestSendTime:this._numSendRequests>0?this._totalRequestSendTime/this._numSendRequests:0,avgRequestHandleTime:this._numHandledRequests>0?this._totalRequestHandleTime/this._numHandledRequests:0,lowImpact:this.getLowImpactStats(),recurring:this.getRecurringStats()}}},{key:"getState",value:function(){return{isActive:this.isActiveObs.get(),isReady:this._isReady,isRateLimited:this._isRateLimited,hasDeactivated:this._hasDeactivated,numOutstandingReqs:this._numOutstandingReqs,numPendingReqs:this._pendingRequests.length,numActivePanes:this._numActivePanes,unloadedDeps:this._unloadedDependencies,isFirstLoad:this._isFirstLoad,hasRunOfflineLoad:this._hasRunOfflineLoad,loadedInitialData:this._loadedInitialData,hasLoadedCaches:this._hasLoadedCaches,cacheState:this.getCacheState()}}},{key:"isPluginPane",value:function(e){return e.type===this._paneType}},{key:"getPaneType",value:function(){return this._paneType}},{key:"activate",value:function(e){var t=this.isActiveObs.get();if(t||(this.isActiveObs.set(!0),this.useItemStore()&&(this._defaultItemStore=bo.itemStoreManager.registerItemStore(this.id,this,this.itemStoreOptions()),this._defaultItemStore.createRoot(this.isActive()?this.useItemStore():this.id+"Root","")),this._hasLoadedCaches||(this.supportUsageCache()&&m.default.shouldWriteLocal()&&this.loadUsageCache(),this._hasLoadedCaches=!0),this.ensurePaneTypeIsActive()),this._unloadedDependencies)for(var a in e)e.hasOwnProperty(a)&&this.onDependencyLoaded(a,e[a]);return this._unloadedDependencies||this.onAllDependenciesLoaded(),this._activate&&this._activate(),t||bo.pluginManager.fireEvent("pluginActiveChanged",this.id,"activated",[this,!0]),!t}},{key:"deactivate",value:function(){try{m.default.PAssert(1048,this.isActiveObs.get(),"Must be active in order to deactivate pane")}catch(e){m.default.reportError(e)}return this.isActiveObs.set(!1),bo.pluginManager.fireEvent("pluginActiveChanged",this.id,"deactivated",[this,!1]),this.getDataPane()&&ae.a.deactivatePaneType(this._paneType),this.useItemStore()&&(bo.itemStoreManager.unregisterItemStore(this.id),this._defaultItemStore=void 0),this.cancelRecurringTasks(),this._loadedInitialData=!1,this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._hasDeactivated=!0,this._deactivate&&this._deactivate(),!0}},{key:"ensurePaneTypeIsActive",value:function(){(!this.hasDependency(y.a.PluginDependency.PremiumSub)||bo.billingManager.hasPremiumFeatures())&&this.getDataPane()&&!ae.a.isPaneTypeActive(this._paneType)&&(this.getSetting(this.Settings.IsEnabled)||m.default.isDemoMode())&&ae.a.activatePaneType(this._paneType)}},{key:"isActive",value:function(){return this.isActiveObs.get()}},{key:"isReady",value:function(){return this._isReady}},{key:"isEnabled",value:function(){return m.default.isDemoMode()&&this.id!==y.a.PluginID.Gmail||this.isAvailable()&&this.getSetting(this.Settings.IsEnabled)}},{key:"isAvailable",value:function(){var e=!1,t=this.hasDependency(y.a.PluginDependency.EarlyAccess),a=this.hasDependency(y.a.PluginDependency.PremiumSub);try{m.default.PAssert(1049,!a||!t,"Must not require both early access and premium sub: "+this.id)}catch(i){m.default.reportError(i)}var n=bo.billingManager.hasEarlyAccess(),r=bo.billingManager.hasPremiumFeatures();return t&&n||a&&r?e=!0:t||a?m.default.isDemoMode()&&(e=!0):e=!0,e}},{key:"isOn",value:function(){return this.isActive()&&!this.isPluginBlocked()}},{key:"hasSettingsError",value:function(){return!1}},{key:"isSyncAccountEnabled",value:function(e){if(!e)return!1;var t=bo.settings.syncAccounts.get();if(t){var a=t[e];return a&&a[this.id]}}},{key:"isCurrentlyAuthorized",value:function(e){var t=this.googleScopes();return!t||ee.a.isAuthorizedForScopes(e,t)}},{key:"shouldUseNewPlugin",value:function(e){return!!Ue.a.getPluginData(e.id)}},{key:"onAuthorized",value:function(e){this._pendingRequests.length>0&&bo.pluginManager.notifyHasPendingRemoteRequest()}},{key:"verifyAuthorization",value:function(e){return!0}},{key:"notifyUnauthorized",value:function(e,t){}},{key:"isOnline",value:function(){return bo.pluginManager.isOnline()}},{key:"goOnline",value:function(){}},{key:"onDocumentShared",value:function(e){}},{key:"onShutdown",value:function(){}},{key:"onDependencyLoaded",value:function(e,t){if(this._unloadedDependencies){var a=this._unloadedDependencies.indexOf(e);if(a>=0&&(m.default.shouldLog(y.a.LogLevels.Plugin)&&m.default.log("Plugin Dependency Loaded: ",this.id,e),this._unloadedDependencies.removeAt(a),e===y.a.PluginDependency.PremiumSub&&this.ensurePaneTypeIsActive()),0===this._unloadedDependencies.length)this._unloadedDependencies=void 0,this.onAllDependenciesLoaded();else if(this.supportOfflineLoad()&&!this._hasRunOfflineLoad){for(var n=0,r=!1,i=0;i<this._unloadedDependencies.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=this._unloadedDependencies[i];ma[o].online||(r=!0)}!r&&this.isActiveObs.get()&&this.offlineLoad()}}}},{key:"onAllDependenciesLoaded",value:function(){this.isActiveObs.get()&&(m.default.shouldLog(y.a.LogLevels.Plugin)&&m.default.log("Plugin All Dependencies Loaded: ",this.id),this._isReady=!0,this._updateAttachmentStates(),this.offlineLoad(),this.load())}},{key:"areDependenciesLoaded",value:function(){return void 0===this._unloadedDependencies}},{key:"hasDependencyBeenLoaded",value:function(e){var t=!1;return this.hasDependency(e)&&(this.getUnloadedDependencies()?this.getUnloadedDependencies().indexOf(e)<0&&(t=!0):t=!0),t}},{key:"getUnloadedDependencies",value:function(){return this._unloadedDependencies}},{key:"areRemoteAPIsLoaded",value:function(){return!0}},{key:"forceLoad",value:function(){this._loadedInitialData=!1,this.activate({}),this._unloadedDependencies&&(this._unloadedDependencies=void 0,this.onAllDependenciesLoaded())}},{key:"hasDependency",value:function(e){var t=this.getDependencies();return!!t&&t.indexOf(e)>=0}},{key:"migrateOldOfflineCache",value:function(){if(this.supportUsageCache()&&m.default.shouldWriteLocal()){var e="ocache_"+this.id,t=Se.a.getLegacyLocalStorage(e);if(t)try{var a=JSON.parse(t);if(a){var n=0;try{m.default.PAssert(1050,a,"Must provide a valid dataset to load")}catch(u){m.default.reportError(u)}a.props;var r=a.data;try{m.default.PAssert(1051,r,"Load object must contain valid data")}catch(u){m.default.reportError(u)}for(var i=Object.keys(r),o=0;o<i.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=i[o],l=this.createEntryFromLocal(s,r[s]);l.id=s,Se.a.savePluginUsage(this.id,l)}Se.a.deleteLegacyLocalStorage(e)}}catch(c){m.default.reportError(c)}else m.default.shouldLog(y.a.LogLevels.Plugin)&&m.default.log("No offline cache present: ",this.id)}}},{key:"loadUsageCache",value:function(){var e=this;if(this.supportUsageCache()&&m.default.shouldWriteLocal()){this.migrateOldOfflineCache();var t=Se.a.getPluginTableUsage(this.id);t&&Object.keys(t).forEach((function(a){return e._dataCache[a]=e.createEntryFromLocal(a,t[a])}))}}},{key:"supportOfflineLoad",value:function(){return!1}},{key:"supportUsageCache",value:function(){return!1}},{key:"createEntryFromLocal",value:function(e,t){try{m.default.PAssert(1052,!1,"SubClass must override createEntryFromLocal",this.id)}catch(a){m.default.reportError(a)}}},{key:"clearData",value:function(){for(var e=0,t=0;t<this._attachKeys.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._attachCache[this._attachKeys[t]].unload()}this._attachKeys=[],this._attachCache={},this._dataCache={},this.useItemStore()&&(this.getDefaultItemStore().clearStore(),this._activeItemStore={}),this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._activeAttachments=[]}},{key:"onCacheLimitExceeded",value:function(){for(var e in this._registeredCaches)if(this._registeredCaches.hasOwnProperty(e)){var t=this._registeredCaches[e];t.usesDiskSpace()&&t.clearCache()}}},{key:"changeID",value:function(e,t,a){try{m.default.PAssert(1053,t!==a,"Should never be switching to the same ID")}catch(o){m.default.reportError(o)}if(this._attachCache[a])e.delayChangeID(),delete this._attachCache[t],this._attachKeys.remove(t),delete this._dataCache[t];else{var n=this._attachCache[t];try{m.default.PAssert(1054,e===n,"Attach entries must match")}catch(o){m.default.reportError(o)}n&&(delete this._attachCache[t],this._attachCache[a]=n,this._attachKeys.remove(t),this._attachKeys.push(a));var r=this._dataCache[t];delete this._dataCache[t],r&&(r.id===t&&(r.id=a),this._dataCache[a]=r);var i=e.isLocalOnlyAttachment();e.isInUse()&&i&&this.deleteAttachmentFromUsageCache(e),e.changeID(a),e.isInUse()&&i&&this.saveAttachmentToUsageCache(e)}}},{key:"_isFullData",value:function(e){for(var t=0,a=this.getPropertySet(y.a.PluginLoad.Full),n=0;n<a.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!this.getPropertyDescriptor(a[n]).isOpt&&!e.hasOwnProperty(a[n]))return!1}return!0}},{key:"cacheData",value:function(e,t,a,n,r){try{m.default.PAssert(1055,e,"Must supply a valid key for data")}catch(s){m.default.reportError(s)}if(va&&this.__Stats.cacheWrites++,this._dataCache[e]=t,this._attachCache[e]){var i=this._attachCache[e],o=this._getPluginLoadType(t);try{m.default.PAssert(1057,o,"Must contain valid full data")}catch(s){m.default.reportError(s)}i.notifyDataLoaded(o,a,n,r)}}},{key:"getCacheData",value:function(e){var t=Ue.a.getPluginDataTranslated(e);return!t||this._dataCache[e]&&this.isSyncAccountEnabled(this._dataCache[e].accountID)?this._dataCache[e]:t}},{key:"_attachMetadataFields",value:function(){}},{key:"fieldsHaveParseEffect",value:function(e){var t=!1;if(e){var a=this._attachMetadataFields();if(a)for(var n=0,r=0;r<e.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(a.indexOf(e[r])<0){t=!0;break}}else t=!0}else t=!0;return t}},{key:"isFieldDefined",value:function(e){return!!this.getPropertyDescriptor(e)}},{key:"hasAttachField",value:function(e,t){var a=!1,n=this.getCacheData(e.id);if(n&&n.hasOwnProperty(t))a=!0;else{var r=this.getPropertyDescriptor(t);try{m.default.PAssert(1059,r,"Must have a valid field descriptor",t)}catch(o){m.default.reportError(o)}if(r&&r.isOpt)a=!0;else{var i=e.getInlineData();i&&i.hasOwnProperty(t)&&void 0!==i[t]&&(a=!0)}}return a}},{key:"getAttachField",value:function(e,t){var a,n=this.getCacheData(e.id);if(n&&n.hasOwnProperty(t))a=n[t];else{var r=this.getPropertyDescriptor(t);try{m.default.PAssert(1060,r,"Must have a valid field descriptor",t)}catch(o){m.default.reportError(o)}var i=e.getInlineData();a=i&&i.hasOwnProperty(t)?i[t]:r?r.defaultValue:void 0}return a}},{key:"updateAttachField",value:function(e,t,a,n,r){var i=!1;try{m.default.PAssert(1062,this.isFieldDefined(t),"Must be updating a valid attachment field")}catch(l){m.default.reportError(l)}var o=this.getCacheData(e.id);try{m.default.PAssert(1063,o,"Invalid field request: ",this.id,t)}catch(l){m.default.reportError(l)}o&&((r||this.dataFieldNeedsWrite(o,t,a))&&(o[t]=a,this.cacheData(e.id,o,!0,[t])),i=!0);var s=e.getInlineData();if(s&&s.hasOwnProperty(t)&&!n)try{m.default.PAssert(1066,s[t]===a,"Should never change inline field value")}catch(l){m.default.reportError(l)}return i}},{key:"isAttachFieldDefault",value:function(e,t){var a=!1,n=this.getCacheData(e.id);try{m.default.PAssert(1067,n,"Invalid field request: ",this.id,t)}catch(i){m.default.reportError(i)}if(n){var r=this.getPropertyDescriptor(t);try{m.default.PAssert(1068,r,"Must have a valid field descriptor",t)}catch(i){m.default.reportError(i)}n.hasOwnProperty(t)?r&&r.isOpt&&r.defaultValue===n[t]&&(a=!0):r&&r.isOpt&&(a=!0)}return a}},{key:"fieldNeedsWrite",value:function(e,t,a){var n=this.getCacheData(e.id);try{m.default.PAssert(1069,n,"Invalid field request: ",this.id,t)}catch(r){m.default.reportError(r)}return this.dataFieldNeedsWrite(n,t,a)}},{key:"dataFieldNeedsWrite",value:function(e,t,a){var n=!1;if(e){var r=this.getPropertyDescriptor(t);try{m.default.PAssert(1070,r,"Must have a valid field descriptor",t)}catch(o){m.default.reportError(o)}var i=this.compactCacheField(e,t);e.hasOwnProperty(t)?void 0===a&&i===r.defaultValue||(r&&r.comparator?r.comparator(i,a)||(n=!0):(i!==a||m.default.isObject(i)||m.default.isObject(a)||m.default.isArray(i)||m.default.isArray(a))&&(n=!0)):void 0!==a&&(r&&r.isOpt&&r.defaultValue===a||(n=!0))}return n}},{key:"hasCacheData",value:function(e){return!!this._dataCache[e]}},{key:"findCachedItemsByField",value:function(e,t,a){var n=this;va&&this.__Stats.findByField++;var r=[];return Object.keys(this._dataCache).some((function(i){var o=n._dataCache[i];if(o&&o[e]===t&&(r.push(o),r.length>=a))return!0})),r}},{key:"findCachedItemsByFn",value:function(e,t){var a=this;try{m.default.PAssert(1071,e,"Must supply a valid match function")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1072,m.default.isFunction(e),"Match function must be a valid function")}catch(r){m.default.reportError(r)}va&&this.__Stats.findByFn++;var n=[];return Object.keys(this._dataCache).some((function(r){var i=a._dataCache[r];if(e(i)&&(n.push(i),n.length>=t))return!0})),n}},{key:"notifyAttachmentInUse",value:function(e,t){try{m.default.PAssert(1073,this._activeAttachments.indexOf(e)<0,"Attachment should not already be active")}catch(a){m.default.reportError(a)}this._activeAttachments.push(e),m.default.isLocalChange(t)&&this.supportUsageCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.saveAttachmentToUsageCache(e,!0)}},{key:"notifyAttachmentUpdated",value:function(e){this.supportUsageCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.saveAttachmentToUsageCache(e)}},{key:"notifyAttachmentUnused",value:function(e,t){try{m.default.PAssert(1074,this._activeAttachments.indexOf(e)>=0,"Attachment should be marked active")}catch(a){m.default.reportError(a)}this._activeAttachments.remove(e),m.default.isLocalChange(t)&&this.supportUsageCache()&&e.isLoaded()&&!e.isLocalOnlyAttachment()&&this.deleteAttachmentFromUsageCache(e)}},{key:"onAuthorizedSetting",value:function(e,t){}},{key:"notifyItemNoteChanged",value:function(e,t){}},{key:"notifyItemDateChanged",value:function(e,t){}},{key:"notifyItemTextChanged",value:function(e,t,a){}},{key:"notifyItemPropertyChanged",value:function(e,t,a,n){}},{key:"getAttachment",value:function(e,t){try{m.default.PAssert(1075,e,"Must provide a valid key")}catch(a){m.default.reportError(a)}return e&&(this._attachCache[e]?t&&!this._attachCache[e].hasInlineData()&&this._attachCache[e].setInlineData(t):(this._attachCache[e]=this._requestAttachment(e,t),this._attachKeys.push(e))),this._attachCache[e]}},{key:"hasAttachment",value:function(e){return!!this._attachCache[e]}},{key:"forEachActiveAttachment",value:function(e){for(var t=0,a=0;a<this._activeAttachments.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e(this._activeAttachments[a])}}},{key:"forEachAttachment",value:function(e){for(var t=0,a=0;a<this._attachKeys.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e(this._attachCache[this._attachKeys[a]])}}},{key:"numActiveAttachments",value:function(){return this._activeAttachments.length}},{key:"getAttachmentEmbedString",value:function(e){for(var t,a=0,n=(null===(t=e.getInlineData())||void 0===t?void 0:t.p)||this.id,r=y.a.EmbedAttachChar+"p:"+n+",id:"+e.id,i=this.getPropertySet(y.a.PluginLoad.Inline),o=0;o<i.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=i[o],l=this.getPropertyDescriptor(s),u=encodeURIComponent(e.getField(s));try{m.default.PAssert(1076,l.isOpt||u&&u.indexOf(":")<0&&u.indexOf(" ")<0,"Property value is invalid: "+s+", "+u)}catch(c){m.default.reportError(c)}void 0!==u&&"undefined"!==u&&(r+=","+s+":"+u)}return r+=y.a.EmbedAttachChar}},{key:"getAttachmentTitleString",value:function(e){return this.getUnstyledText(e)}},{key:"_getTextForItem",value:function(e,t){try{m.default.PAssert(1077,e,"Must pass in a valid item to get text for")}catch(a){m.default.reportError(a)}return m.default.isString(e),y.a.EmbedAttachChar+"p:"+this.id+",id:"+e+(t?",accountID:"+t:"")+y.a.EmbedAttachChar}},{key:"_requestAttachment",value:function(e,t){try{m.default.PAssert(1078,e,"Must provide a valid key")}catch(a){m.default.reportError(a)}return va&&this.__Stats.createdAttachments++,new ha(this,e,t)}},{key:"releaseAttachment",value:function(e){}},{key:"saveAttachmentToUsageCache",value:function(e,t){this.supportUsageCache()&&m.default.shouldWriteLocal()&&!this.shouldUseNewPlugin(e)&&(t&&Se.a.getPluginUsage(this.id,e.id)||Se.a.savePluginUsage(this.id,this.serializeEntry(e.id)))}},{key:"deleteAttachmentFromUsageCache",value:function(e){this.supportUsageCache()&&m.default.shouldWriteLocal()&&Se.a.deletePluginUsage(this.id,e.id)}},{key:"dataHasChanged",value:function(e,t){for(var a=0,n=!e,r=this.getPropertySet(y.a.PluginLoad.Full),i=0;!n&&i<r.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=r[i];this.dataFieldNeedsWrite(e,o,t[o])&&(n=!0)}return n}},{key:"getChangedFields",value:function(e,t){for(var a=0,n=[],r=this.getPropertySet(y.a.PluginLoad.Full),i=0;i<r.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=r[i];this.dataFieldNeedsWrite(e,o,t[o])&&n.push(o)}return n}},{key:"matchAttachment",value:function(e,t){try{m.default.PAssert(1079,!1,"SubClass must override matchAttachment",this.id)}catch(a){m.default.reportError(a)}}},{key:"getStyledText",value:function(e,t,a,n){try{m.default.PAssert(1080,!1,"SubClass must override getStyledText",this.id)}catch(r){m.default.reportError(r)}return""}},{key:"getUnstyledText",value:function(e,t){try{m.default.PAssert(1081,!1,"SubClass must override getUnstyledText",this.id)}catch(a){m.default.reportError(a)}return""}},{key:"getRichText",value:function(e){try{m.default.PAssert(1082,!1,"SubClass must override getRichText",this.id)}catch(t){m.default.reportError(t)}return""}},{key:"getBlockedText",value:function(e){return"Blocked"}},{key:"getDisplayText",value:function(e,t){return this.getUnstyledText(e,t)}},{key:"createDisplayElement",value:function(e){var t=this.getAttachmentClass(e);try{m.default.PAssert(1083,m.default.isArray(t),"Must have a valid class list")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1084,t.indexOf("plugin")<0,"Should not already have plugin as a class")}catch(i){m.default.reportError(i)}t.push("plugin inlineBordered"),this.isPluginBlocked()&&t.push("blocked");var a=this.getDisplayText(e),n={attrs:{cls:t,plugin:this.id,"plugin-id":e.id},text:a},r=this.getAttachmentTooltip(e);return r&&(n.attrs["data-tooltip"]=r),n}},{key:"getAttachmentClass",value:function(e){return[]}},{key:"getAttachmentTooltip",value:function(e){}},{key:"isPluginBlocked",value:function(){var e=!1;return bo.billingManager.hasPremiumFeatures()||!this.hasDependency(y.a.PluginDependency.PremiumSub)&&!this.hasDependency(y.a.PluginDependency.EarlyAccess)||(e=!0),e}},{key:"_displayMissingProperties",value:function(e,t,a){var n=0,r=!1,i=this.getPropertySet(a);m.default.log("Displaying Missing Properties: ",e);for(var o=0;o<i.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this.getPropertyDescriptor(i[o]).isOpt||t.hasOwnProperty(i[o])||(m.default.log(" Missing Property: ",i[o]),r=!0)}try{m.default.PAssert(1085,r,"Must be missing props to run this")}catch(s){m.default.reportError(s)}}},{key:"_getPluginLoadType",value:function(e){try{m.default.PAssert(1086,e,"Must be querying loaded data for load state with valid data")}catch(a){m.default.reportError(a)}var t=y.a.PluginLoad.None;return this._isFullData(e)&&(t|=y.a.PluginLoad.Full),t}},{key:"requestData",value:function(e,t){var a=this;va&&this.__Stats.requestData++,t=t||y.a.PluginLoad.Full;var n,r=this.getCacheData(e.id);r?(n=this._getPluginLoadType(r),m.default.isFlagSet(n,t)?e.notifyDataLoaded(n,!1,void 0,y.a.ChangeType.Remote):(m.default.forEachFlagSet(t,(function(t){a._displayMissingProperties(e.id,r,t)})),!e.isLocalOnlyAttachment()&&this.allowRemoteRequests()&&this._getRemoteAttachmentData(e,t))):e.isLocalOnlyAttachment()||(n=y.a.PluginLoad.None,this.allowRemoteRequests()&&!m.default.isFlagSet(n,t)&&this._getRemoteAttachmentData(e,t))}},{key:"_getRemoteAttachmentData",value:function(e,t){this.getRemoteAttachmentData(e,t)}},{key:"getRemoteAttachmentData",value:function(e,t){try{m.default.PAssert(1087,!1,"SubClass must override getRemoteAttachmentData",this.id)}catch(a){m.default.reportError(a)}}},{key:"_appendDupeRequest",value:function(e,t){try{m.default.PAssert(1088,e,"Must provide a valid queued request")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1089,t,"Must provide a valid duped request")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1090,!e.duped,"Must never use an already duped request as a dupe for another request")}catch(a){m.default.reportError(a)}t.attach&&(e.attach||(e.attach=[]),e.attach.pushOnlyUniques(t.attach)),e.successCB.pushOnlyUniques(t.successCB),e.failureCB.pushOnlyUniques(t.failureCB)}},{key:"_areRequestFnsEqual",value:function(e,t){var a=!1;return e===t?a=!0:m.default.isArray(e)&&m.default.isArray(t)&&(a=e.equals(t)),a}},{key:"_areRequestsEqual",value:function(e,t){try{m.default.PAssert(1091,e,"Must have a valid request A")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1092,t,"Must have a valid request B")}catch(i){m.default.reportError(i)}var a=!0;if(e.accountID!==t.accountID)a=!1;else if(e.forceNoDupe||t.forceNoDupe)a=!1;else if(e.id!==t.id&&this._areRequestFnsEqual(e.requestFn,t.requestFn))if(e.data===t.data)a=!0;else{for(var n in e.data){if(!e.data.hasOwnProperty(n)||!t.data.hasOwnProperty(n)){a=!1;break}if(e.data[n]!==t.data[n]){a=!1;break}}if(a)for(var r in t.data){if(!e.data.hasOwnProperty(r)||!t.data.hasOwnProperty(r)){a=!1;break}if(e.data[r]!==t.data[r]){a=!1;break}}}else a=!1;return a}},{key:"_getDupeRequest",value:function(e){for(var t,a=0,n=0,r=0;!t&&r<this._outstandingRequests.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;!this._outstandingRequests[r].duped&&this._areRequestsEqual(this._outstandingRequests[r],e)&&(t=this._outstandingRequests[r])}for(var i=0;!t&&i<this._pendingRequests.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;!this._pendingRequests[i].duped&&this._areRequestsEqual(this._pendingRequests[i],e)&&(t=this._pendingRequests[i])}return t}},{key:"_combineRequest",value:function(e,t){try{m.default.PAssert(1093,e,"Must provide a valid queued request")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1094,t,"Must provide a valid combine request")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1095,!e.combined,"Must never use an already combined request as a target for another request")}catch(a){m.default.reportError(a)}e.data=m.default.mergeObjects(e.data,t.data),e.successCB.pushOnlyUniques(t.successCB),e.failureCB.pushOnlyUniques(t.failureCB)}},{key:"_areRequestsCombinable",value:function(e,t){try{m.default.PAssert(1096,e,"Must have a valid request A")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1097,t,"Must have a valid request B")}catch(n){m.default.reportError(n)}var a=!1;return e.id!==t.id&&e.combinable&&t.combinable&&e.accountID===t.accountID&&this._areRequestFnsEqual(e.requestFn,t.requestFn)&&e.type===t.type&&(e.attach||t.attach?e.attach&&t.attach&&e.attach.equals(t.attach)&&(a=!0):a=!0),a}},{key:"_getCombineRequest",value:function(e){var t;if(e.combinable)for(var a=0,n=0;!t&&n<this._pendingRequests.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;!this._pendingRequests[n].combined&&this._areRequestsCombinable(this._pendingRequests[n],e)&&(t=this._pendingRequests[n])}return t}},{key:"_handleBatchRequestResponse",value:function(e){this._numOutstandingReqs--;try{m.default.PAssert(1098,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(t){m.default.reportError(t)}}},{key:"_handleRequestResponse",value:function(e,t){if(!t){this._numOutstandingReqs--;try{m.default.PAssert(1099,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(a){m.default.reportError(a)}}}},{key:"_queueRemoteRequestMulti",value:function(){var e=me()(pe.a.mark((function e(t,a,n,r,i,o,s,l){var u,c=this;return pe.a.wrap((function(e){for(var d=0;;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(e.prev=e.next){case 0:try{m.default.PAssert(1100,t,"Missing accountID parameter")}catch(h){m.default.reportError(h)}try{m.default.PAssert(1101,!m.default.isArray(t),"Missing accountID paramter")}catch(h){m.default.reportError(h)}try{m.default.PAssert(1102,!m.default.isFunction(t),"Missing accountID parameter")}catch(h){m.default.reportError(h)}try{m.default.PAssert(1103,!l||void 0===l.accountID,"AccountID is specified as a separate param")}catch(h){m.default.reportError(h)}return(u=l?m.default.clone(l):{}).accountID=t,e.next=8,m.default.promisify((function(e){ee.a.getAccountAuthToken(t,c.googleScopes(),e)}));case 8:return e.abrupt("return",this._queueRemoteRequest(a,n,r,i,o,s,u));case 9:case"end":return e.stop()}}}),e,this)})));return function(t,a,n,r,i,o,s,l){return e.apply(this,arguments)}}()},{key:"_queueRemoteRequest",value:function(){var e=me()(pe.a.mark((function e(t,a,n,r,i,o,s){var l,u;return pe.a.wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(l=t.join("")+JSON.stringify(a)+JSON.stringify(s||{}),this._requestsInProgress[l]){e.next=25;break}try{m.default.PAssert(1104,n,"Must supply a callback for request success")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1105,m.default.isFunction(n),"Success callback must be a valid function")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1106,r,"Must supply a callback for request failure")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1107,m.default.isFunction(r),"Failure callback must be a valid function")}catch(d){m.default.reportError(d)}s=s||{};try{m.default.PAssert(1108,t&&m.default.isArray(t),"RequestFn must be a valid packed function")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1109,a,"Must provide valid data for the request")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1111,o,"Request type must be specified")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1112,s.accountID||s.token,"Must have an accountID")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1113,!s.combinable,"Combinable is not currently a valid option. Do not use.")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1114,!i||!i.isLocalOnlyAttachment(),"Must either specify a valid remote attachment or none at all",i?i.id:"UNDEFINED")}catch(d){m.default.reportError(d)}if(!s.accountID||this.hasSyncAccount(s.accountID)){e.next=16;break}return e.abrupt("return");case 16:s.token&&!s.accountID&&(s.accountID="from_token"),va&&(this.__ReqStats[o]=this.__ReqStats[o]?this.__ReqStats[o]+1:1),u={id:++this._requestCounter,plugin:this,attach:i?[i]:void 0,request:void 0,requestFn:t,data:a,successCB:[n],failureCB:[r],type:o,queueTime:Date.now(),sendTimes:[],handleTimes:[],handled:!1,failed:!1,duped:!1,canceled:!1,timedOut:!1,wasBatched:!1,batchID:void 0,batchRequestID:void 0,noBatch:s.noBatch,requestsBehind:this._pendingRequests.length,token:s.token,accountID:s.accountID,scopes:this.googleScopes(),combinable:s.combinable,forceNoDupe:s.forceNoDupe,priority:s.priority?s.priority:y.a.RequestPriority.Default},m.default.shouldLog(y.a.LogLevels.Plugin)&&m.default.log("Request Queued: ",this.name,o,u.id,u),this._insertPendingRequest(u),bo.pluginManager.notifyHasPendingRemoteRequest();case 25:case"end":return e.stop()}}}),e,this)})));return function(t,a,n,r,i,o,s){return e.apply(this,arguments)}}()},{key:"_insertPendingRequest",value:function(e){e.priority++;var t=this._pendingRequests.insertSorted(e,this._reqSortFn);return e.priority--,t}},{key:"_reqSortFn",value:function(e,t){return e.priority===t.priority?0:e.priority<t.priority?-1:1}},{key:"_queuePagedRemoteRequestMulti",value:function(e,t,a,n,r,i,o,s){try{m.default.PAssert(1115,e,"Missing accountID parameter")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1116,!m.default.isArray(e),"Missing accountID paramter")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1117,!m.default.isFunction(e),"Missing accountID parameter")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1118,!s||void 0===s.accountID,"AccountID is specified as a separate param")}catch(u){m.default.reportError(u)}var l=s?m.default.clone(s):{};return l.accountID=e,this._queuePagedRemoteRequest(t,a,n,r,i,o,l)}},{key:"_queuePagedRemoteRequest",value:function(e,t,a,n,r,i,o){var s=this;try{m.default.PAssert(1119,o,"Must supply a valid options param")}catch(p){m.default.reportError(p)}try{m.default.PAssert(1120,!o.getAllPages||!o.maxPages,"Should only define either maxPages or getAllPages: ",o.getAllPages,o.maxPages)}catch(p){m.default.reportError(p)}o.maxPages=o.maxPages||1,o.getAllPages=o.getAllPages||!1,o.maxPageResults=o.maxPageResults||(o.maxResults?o.maxResults:100),o.maxResults=o.maxResults||1/0,o.resultsField=o.resultsField||"items";var l,u=0,c=[],d=m.default.clone(t);d.maxResults=o.maxPageResults;var h=function(e){e[o.resultsField]?c.pushArray(e[o.resultsField]):e.items?c.pushArray(e.items):e.history&&c.pushArray(e.history),e.nextPageToken&&(o.getAllPages||o.maxPages>u)&&c.length<o.maxResults?l(e.nextPageToken):e.nextPageToken||e.nextSyncToken||e.historyId?a(c,t,e):a(c)},f=function(e){var t,a;(null===(t=e.error)||void 0===t||null===(a=t.message)||void 0===a?void 0:a.startsWith("Request had invalid authentication credentials."))||n(e,c)};(l=function(t){t&&(d.pageToken=t),u++,s._queueRemoteRequest(e,d,h,f,void 0,i,o)})()}},{key:"_retryRemoteRequest",value:function(e,t){var a=this;m.default.shouldLog(y.a.LogLevels.Plugin)&&m.default.log("Request Re-Queued: ",this.name,e.type,e.id,e),va&&this.__Stats.remoteRetries++,e.request=void 0,e.wasBatched=void 0,e.batchID=void 0,e.batchRequestID=void 0,setTimeout((function(){e.currentRetries=e.currentRetries?e.currentRetries+1:1,a._insertPendingRequest(e),bo.pluginManager.notifyHasPendingRemoteRequest()}),this._getRetryDelay(e,t))}},{key:"getNumOutstandingReqs",value:function(){return this._numOutstandingReqs}},{key:"_pumpRequestQueue",value:function(e,t,a,n){var r=0,i=0,o=this;try{m.default.PAssert(1121,this.areRemoteAPIsLoaded(),"Must have loaded remote APIs before pumping the request queue")}catch(T){m.default.reportError(T)}var s=0,l=0,u=0,c=0,d=0,h=0,f=0;try{m.default.PAssert(1122,this._numOutstandingReqs>=0,"Should never have fewer than zero outstanding requests")}catch(T){m.default.reportError(T)}var p=t;try{m.default.PAssert(1123,p>0,"Should never have more than max outstanding requests for a given plugin")}catch(T){m.default.reportError(T)}for(var g={},v=this._pendingRequests.filter((function(e){return!e.noBatch})),k=p>1&&v.length>1,_=[],b=0;p>0&&b<this._pendingRequests.length&&f<y.a.MaxBatchSize;++b){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var w=this._pendingRequests[b],S=void 0;if(k&&!w.noBatch&&((S=g[w.accountID])||(S=g[w.accountID]=this.createBatch({accountID:w.accountID,scopes:w.scopes}))),w.priority<e)h++;else{m.default.shouldLog(y.a.LogLevels.Plugin)&&m.default.log("Request Pumped: ",this.name,w.type,w.id,w);try{m.default.PAssert(1124,!m.default.isFunction(w),"Should never use a deferred request")}catch(T){m.default.reportError(T)}try{m.default.PAssert(1125,!1===w.handled,"Should never service a request that has already been handled")}catch(T){m.default.reportError(T)}var D=this._getDupeRequest(w);if(D)va&&this.__Stats.dupedRequests++,w.duped=!0,_.push(w),u++,this._appendDupeRequest(D,w);else{var P=this._getCombineRequest(w);if(P)va&&this.__Stats.combinedRequests++,w.combined=!0,_.push(w),c++,this._combineRequest(P,w);else{var I=!1;if(w.attach)for(var E=0,C=0;C<w.attach.length;++C){if(E++>5e3&&__infLoop&&__infLoop(E))throw new RangeError;w.attach[C].needsRemoteData()&&(w.attach[C].notifyDataRequested(),I=!0)}else I=!0;if(I)if(w.token||this.isCurrentlyAuthorized(w.accountID)){var x=this._runRemoteRequest(S,w,a);if(va&&this.__Stats.remoteRequests++,x.isNewRequest||0===f){try{m.default.PAssert(1126,t>s,"Should not be making more requests for plugin than allowed")}catch(T){m.default.reportError(T)}s++,p--,this._numOutstandingReqs++,va&&this.__Stats.actualRemoteCallsSent++}x.wasBatched&&f++,_.push(w)}else ee.a.notifyUnauthorizedRequest(w.accountID),d++;else va&&this.__Stats.canceledRequests++,w.canceled=!0,l++,_.push(w)}}}}this._pendingRequests=this._pendingRequests.removeArray(_);for(var A=0;A<_.length;++A){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;_[A].canceled||_[A].duped||this._addRequest(this._outstandingRequests,_[A])}return Object.keys(g).forEach((function(e){var t=g[e];try{m.default.PAssert(1127,!t||f+l+u+c+d+h>1,"Batches should always have multiple items in them")}catch(T){m.default.reportError(T)}t&&(f>0?(va&&o.__Stats.remoteBatches++,o.commitBatch(t,n)):va&&o.__Stats.canceledBatches++)})),s}},{key:"_clearRequestQueue",value:function(){m.default.log("Clear Request Queue: ",this.id),this._pendingRequests=[],this._outstandingRequests=[],this._numOutstandingReqs=0}},{key:"_addRequest",value:function(e,t){try{m.default.PAssert(1128,e.indexOf(t)<0,"Should never re-add a request to a queue without removing it first")}catch(a){m.default.reportError(a)}return e.push(t)}},{key:"_removeRequest",value:function(e,t){return e.remove(t)}},{key:"isRateLimited",value:function(){return this._isRateLimited}},{key:"_notifyRateLimitedOver",value:function(){this._isRateLimited=!1}},{key:"_notifyRateLimited",value:function(e){this._isRateLimited=!0,this._lastRateLimitTime=new Date}},{key:"isRateLimitError",value:function(e){var t=!1;return e&&ga.indexOf(e.status)>=0&&(e.status===y.a.HTTPStatusCode.Forbidden?(m.default.hasGoogleError(e,y.a.GoogleErrorDomain.UsageLimits,y.a.GoogleError.UserRateLimitExceeded)||m.default.hasGoogleError(e,y.a.GoogleErrorDomain.UsageLimits,y.a.GoogleError.RateLimitExceeded)||m.default.hasGoogleError(e,y.a.GoogleErrorDomain.UsageLimits,y.a.GoogleError.QuotaExceeded))&&(t=!0):t=!0),t}},{key:"_getRetryDelay",value:function(e,t){var a=e.currentRetries;return t&&(a=Math.max(2,e.currentRetries)),m.default.seconds(fa[a])}},{key:"_notifyRequestSuccess",value:function(e,t){var a={cbList:e.successCB,result:t};e.wasBatched?(this._batchedResponses[e.batchID]||(this._batchedResponses[e.batchID]=[]),this._batchedResponses[e.batchID].push(a)):this._handleResponse(a)}},{key:"_notifyRequestFailure",value:function(e,t){var a={cbList:e.failureCB,result:t};e.wasBatched?(this._batchedResponses[e.batchID]||(this._batchedResponses[e.batchID]=[]),this._batchedResponses[e.batchID].push(a)):this._handleResponse(a)}},{key:"_handleResponse",value:function(e){for(var t=0,a=0;a<e.cbList.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{var n=e.result;e.cbList[a](n)}catch(r){m.default.reportError(r)}}}},{key:"_notifyBatchCompleted",value:function(e){var t=this._batchedResponses[e.getBatchID()];if(delete this._batchedResponses[e.getBatchID()],t){var a=0;bo.PaneUpdateBatcher.beginUpdateItems(),Se.a.beginBatch();for(var n=0;n<t.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._handleResponse(t[n])}Se.a.commitBatch(),bo.PaneUpdateBatcher.commitUpdateItems()}}},{key:"computeBatchGroupID",value:function(e){return e.accountID}},{key:"computeRequestID",value:function(e){return e.id+"-"+Date.now()}},{key:"_setSendTime",value:function(e){var t=Date.now();if(0===e.sendTimes.length){var a=t-e.queueTime;this._numSendRequests++,this._totalRequestSendTime+=a,a>this.LongWaitThreshold&&this._numLongWaitRequests++}e.sendTimes.push(t)}},{key:"_setHandleTime",value:function(e){var t=Date.now();if(0===e.handleTimes.length){var a=t-e.queueTime;this._numHandledRequests++,this._totalRequestHandleTime+=a}e.handleTimes.push(t)}},{key:"_runRemoteRequest",value:function(e,t,a){var n,r=this,i={wasBatched:!1,isNewRequest:!1};if(ea.a.canConstruct(t.requestFn))n=t.request=ea.a.createRequest(t.accountID,t.requestFn,t.data,t.token,this.googleScopes());else{0;var o=m.default.unpackFn(t.requestFn);try{m.default.PAssert(1129,m.default.isFunction(o),"Must specify a valid packed function: ",t.requestFn)}catch(c){m.default.reportError(c)}o&&(n=t.request=o(t.data))}if(n){try{m.default.PAssert(1130,n.then,"Remote request must be thenable")}catch(c){m.default.reportError(c)}if(e){var s=this.computeBatchGroupID(t),l=this.computeRequestID(t);i.isNewRequest=e.add(n,s,l);try{m.default.PAssert(1131,m.default.isBoolean(i.isNewRequest),"Add must return whether it will create a new remote request for this request")}catch(c){m.default.reportError(c)}i.wasBatched=!0,t.wasBatched=!0,t.batchID=e.getBatchID(),t.batchRequestID=l}else t.wasBatched=!1,t.batchID=void 0,t.batchRequestID=void 0;m.default.shouldLog(y.a.LogLevels.Plugin)&&m.default.log("Request Run: ",this.name,t.type,t.id,t);try{m.default.PAssert(1132,t.token||this.isCurrentlyAuthorized(t.accountID),"Must be currently authorized to make this request")}catch(c){m.default.reportError(c)}this._setSendTime(t);var u=function(e){try{m.default.PAssert(1133,!1===t.handled,"Must not handle the same request multiple times")}catch(c){m.default.reportError(c)}m.default.shouldLog(y.a.LogLevels.Plugin)&&m.default.log("Request Failed: ",r.name,t.type,t.id,t,e),r._setHandleTime(t);var n=r.isRateLimitError(e);if(n&&r._notifyRateLimited(e),(n||pa.indexOf(e.status)>=0)&&t.autoRetry&&t.currentRetries<t.numRetries)a(t.attach,t.plugin,t.wasBatched),r._removeRequest(r._outstandingRequests,t),r._retryRemoteRequest(t,n);else{if(t.handled=!0,t.failed=!0,t.attach)for(var i=0,o=0;o<t.attach.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t.attach[o].notifyDataRequestFailed()}r._notifyRequestFailure(t,e.result),a(t.attach,t.plugin,t.wasBatched),r._removeRequest(r._outstandingRequests,t)}};t.request.then((function(e){var n=e.result;if(n&&!n.error||204===e.status){try{m.default.PAssert(1134,!1===t.handled,"Must not handle the same request multiple times")}catch(c){m.default.reportError(c)}m.default.shouldLog(y.a.LogLevels.Plugin)&&m.default.log("Request Success: ",r.name,t.type,t.id,t,e),r._setHandleTime(t),t.handled=!0,r._notifyRateLimitedOver(),r._notifyRequestSuccess(t,n),a(t.attach,t.plugin,t.wasBatched),r._removeRequest(r._outstandingRequests,t)}else u(e)}),u)}return i}},{key:"createPaginationToken",value:function(e,t,a,n,r,i){return new ia(e,t,a,n,r,i)}},{key:"updatePaginationToken",value:function(e,t){try{m.default.PAssert(1135,e,"Must specify a valid token to update")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1136,t,"Must update the pagination token with a valid next page token")}catch(a){m.default.reportError(a)}return e.updateToken(t),e}},{key:"createBatch",value:function(e){return ea.a.createBatch(e)}},{key:"commitBatch",value:function(e,t){var a=this;try{m.default.PAssert(1137,e,"Batch to commit must be specified")}catch(n){m.default.reportError(n)}e.then((function(){a._notifyBatchCompleted(e),t(a,!0)}),(function(){a._notifyBatchCompleted(e),t(a,!1)}))}},{key:"addModifiedOffline",value:function(e,t){try{m.default.PAssert(1138,e,"Must have a valid cache entry to update")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1139,m.default.isBoolean(t)||m.default.isArray(t),"Incoming fields must be valid")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1140,!1!==t,"Use removeModifiedOffline to clear data instead")}catch(n){m.default.reportError(n)}if(e){var a=e.modifiedOffline||!1;try{m.default.PAssert(1141,m.default.isBoolean(a)||m.default.isArray(a),"Previous fields must be valid")}catch(n){m.default.reportError(n)}!1===a?e.modifiedOffline=t:!0===a||(!0===t?e.modifiedOffline=!0:e.modifiedOffline?e.modifiedOffline.pushOnlyUniques(t):e.modifiedOffline=t)}}},{key:"removeModifiedOffline",value:function(e,t){try{m.default.PAssert(1142,e,"Must have a valid cache entry to update")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1143,m.default.isBoolean(t)||m.default.isArray(t),"Incoming fields must be valid")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1144,!0!==t,"Use addModifiedOffline to add data instead")}catch(n){m.default.reportError(n)}if(e){var a=e.modifiedOffline||!1;try{m.default.PAssert(1145,m.default.isBoolean(a)||m.default.isArray(a),"Previous fields must be valid")}catch(n){m.default.reportError(n)}!1===a||(!0===a?!1===t&&(e.modifiedOffline=!1):!1===t?e.modifiedOffline=!1:(e.modifiedOffline=e.modifiedOffline.removeArray(t),0===e.modifiedOffline.length&&(e.modifiedOffline=!1)))}}},{key:"compactCacheField",value:function(e,t){return e[t]}},{key:"_serializeObj",value:function(e,t){var a=0;try{m.default.PAssert(1146,e,"Must specify a valid entry to serialize")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1147,t,"Must provide a valid property list")}catch(u){m.default.reportError(u)}for(var n={},r=0;r<t.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=t[r],o=this.getPropertyDescriptor(i);if(!o.isOpt||o.defaultValue!==e[i]){var s=this.compactCacheField(e,i);void 0!==s&&(n[i]=s)}}var l=this.getBlobData(e);return l&&(n._blob=l),n}},{key:"serializeEntry",value:function(e){var t=this.getPropertySet(y.a.PluginLoad.Full),a=this.getCacheData(e);if(a){var n=this._serializeObj(a,t);return n.id=e,n.plugin=this.id,n}}},{key:"serializeExternalData",value:function(e){try{m.default.PAssert(1148,e,"Must supply valid data to serialize")}catch(n){m.default.reportError(n)}var t=this.getPropertySet(y.a.PluginLoad.Full),a=this._serializeObj(e,t);return a.id=e.id,e.parents&&(a.parents=e.parents),a}},{key:"declareProperty",value:function(e,t,a,n,r){var i=this;try{m.default.PAssert(1149,!this._propertyDescriptors[e],"Should not declare the same property twice")}catch(o){m.default.reportError(o)}t=t||y.a.PluginLoad.Full,a=a||!1,m.default.forEachFlagSet(t,(function(t){i._propertySets[t]||(i._propertySets[t]=[]),i._propertySets[t].push(e)})),this._propertyDescriptors[e]={isOpt:a,defaultValue:n,comparator:r}}},{key:"getPropertySet",value:function(e){return this._propertySets[e]||[]}},{key:"getPropertyDescriptor",value:function(e){return this._propertyDescriptors[e]}},{key:"getBlobData",value:function(e){}},{key:"_updateAttachmentStates",value:function(){try{var e=0;bo.PaneUpdateBatcher.beginUpdateItems();for(var t=0;t<this._attachKeys.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._attachCache[this._attachKeys[t]];a.isInUse()&&a.onUpdate(!1,void 0,y.a.ChangeType.Auto)}bo.PaneUpdateBatcher.commitUpdateItems()}catch(n){m.default.reportError(n)}}},{key:"offlineLoad",value:function(){if(!this._hasRunOfflineLoad&&this.supportOfflineLoad())try{this._offlineLoad&&(this._hasRunOfflineLoad=this._offlineLoad())}catch(e){m.default.reportError(e)}}},{key:"load",value:function(){if(this._isFirstLoad){this._isFirstLoad=!1;try{this._load&&this._load()}catch(e){m.default.reportError(e)}}this._loadedInitialData||!m.default.isDemoMode()&&!this.hasActiveDataPanes()||this.isPluginBlocked()||this.loadInitialData()}},{key:"loadInitialData",value:function(){try{m.default.PAssert(1151,!this._loadedInitialData,"Do not make multiple requests for initial data load")}catch(e){m.default.reportError(e)}try{m.default.PAssert(1152,!this.isPluginBlocked(),"Should not load data for blocked plugins")}catch(e){m.default.reportError(e)}this._loadedInitialData=!0}},{key:"getDataPane",value:function(){}},{key:"getPaneIcon",value:function(){return"icon-question"}},{key:"getPanePriority",value:function(){return 0}},{key:"getDefaultDisplayItem",value:function(e){}},{key:"useItemStore",value:function(){}},{key:"itemStoreOptions",value:function(){}},{key:"getDefaultItemStore",value:function(){try{m.default.PAssert(1153,this.useItemStore(),"Must request an item store")}catch(e){m.default.reportError(e)}return this._defaultItemStore}},{key:"getActiveItemStore",value:function(e){try{m.default.PAssert(1154,e,"Must specify a valid paneID to get the item store for")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1155,this.useItemStore(),"Must request item store usage")}catch(a){m.default.reportError(a)}var t=this._activeItemStore[e];return t||this._defaultItemStore}},{key:"getBucketItemStore",value:function(e){return this._searchBuckets[e]}},{key:"allowRemoteRequests",value:function(){return!1}},{key:"handleDropEvent",value:function(e,t){return!1}},{key:"handleTapClick",value:function(e,t,a,n){return!1}},{key:"notifyPaneCreated",value:function(){this._numActivePanes++,!this.isActive()||this._loadedInitialData||this.isPluginBlocked()||this.areDependenciesLoaded()&&this.loadInitialData()}},{key:"notifyPaneDestroyed",value:function(){this._numActivePanes--;try{m.default.PAssert(1158,this._numActivePanes>=0,"Should never have negative active panes")}catch(e){m.default.reportError(e)}}},{key:"notifyPanesReadyForLoad",value:function(){bo.PaneManager.runForEachPane((function(e){e.notifyPluginLoaded()}),this.getPaneType())}},{key:"hasActiveDataPanes",value:function(){return this._numActivePanes>0}},{key:"allowTextEditing",value:function(e,t){return!0}},{key:"_createSearchBucket",value:function(e,t){var a;a=m.default.generateTempId();var n=bo.itemStoreManager.registerItemStore(a,this,{trackGlobally:!1});return n.createRoot(t||m.default.generateTempId(),"Search Results"),this._searchBuckets[a]=n,a}},{key:"_destroySearchBucket",value:function(e){this._searchBuckets[e].clearStore()}},{key:"swapInSearchBucket",value:function(e,t){try{m.default.PAssert(1159,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(i){m.default.reportError(i)}if(m.default.shouldLog(y.a.LogLevels.Plugin)&&m.default.log("Swap IN search bucket: ",e),bo.PaneManager.isPaneActive(t)){var a=bo.PaneManager.getPaneById(t),n=this._searchBuckets[e];if(!this._activeSearchBucket[t]||this._activeSearchBucket[t].id!==e){var r=n.getRoot();this._activeSearchBucket[t]||(this._defaultZoomItems[t]=a.getItem()),this._activeItemStore[t]=n,this._activeSearchBucket[t]=n,a.setRootItem(r,!0),a.useItemStore(n)}}}},{key:"swapOutSearchBucket",value:function(e,t){try{m.default.PAssert(1160,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(o){m.default.reportError(o)}var a=this._activeSearchBucket[e].id;m.default.shouldLog(y.a.LogLevels.Plugin)&&m.default.log("Swap OUT search bucket: ",a);var n=bo.PaneManager.getPaneById(e),r=this._searchBuckets[a];try{m.default.PAssert(1161,r,"Must have a valid bucket we are swapping from")}catch(o){m.default.reportError(o)}var i=n.getRootItem();try{m.default.PAssert(1162,i===r.getRoot(),"Current root for pane should match bucket root")}catch(o){m.default.reportError(o)}t=t||this._defaultZoomItems[e];try{m.default.PAssert(1163,t,"Must always be able to get a valid default zoom item")}catch(o){m.default.reportError(o)}this._activeItemStore[e]=void 0,this._activeSearchBucket[e]=void 0,this._defaultZoomItems[e]=void 0,n.setItem(t,!0),n.stopUsingItemStore(r),this._destroySearchBucket(a)}},{key:"runSearch",value:function(e,t,a,n,r){try{m.default.PAssert(1164,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(o){m.default.reportError(o)}var i;return n&&(i=this._createSearchBucket(e,a)),this.runRemoteSearch(e,t,i,r)}},{key:"getSearchRoot",value:function(e){var t=this._searchBuckets[e];try{m.default.PAssert(1165,t,"Should always reference a valid search bucket")}catch(a){m.default.reportError(a)}return t.getRoot()}},{key:"isRemoteSearchBucketActive",value:function(e){return!!this._activeSearchBucket[e]}},{key:"clearSearch",value:function(e,t){this._activeSearchBucket[e]&&this.swapOutSearchBucket(e,t)}},{key:"refreshCurrentView",value:function(e){try{m.default.PAssert(1166,!1,"SubClass must override refreshCurrentView",this.id)}catch(t){m.default.reportError(t)}}},{key:"dumpRequestQueue",value:function(e){var t=0,a=0;console.log("---- Outstanding Requests ["+this._numOutstandingReqs+"] ----");for(var n=0;n<this._outstandingRequests.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._outstandingRequests[n];console.log("  ",r.requestFn,":",r.id," - ",r.data)}console.log("---- Pending Requests ["+this._pendingRequests.length+"] ----");for(var i=0;i<this._pendingRequests.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this._pendingRequests[i];console.log("  ",o.requestFn,":",o.id," - ",o.data)}if(e){var s=0;try{m.default.PAssert(1167,!1,"Must be in __DEV__ mode to display info on handled requests")}catch(c){m.default.reportError(c)}console.log("---- Handled Requests ["+this._handledRequests.length+"] ----");for(var l=0;l<this._handledRequests.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var u=this._handledRequests[l];u.failed?console.log(" !",u.requestFn,":",u.id," - ",u.data):console.log("  ",u.requestFn,":",u.id," - ",u.data)}}}},{key:"dumpQueueStats",value:function(){console.log("  Rate Limited: "+this._isRateLimited),console.log("  Long Wait Requests: "+this._numLongWaitRequests),console.log("  Num Requests: ",this._numSendRequests,this._numHandledRequests),console.log("  Num Pending Requests: ",this._pendingRequests.length),console.log("  Avg. Send Time: ",this._totalRequestSendTime/this._numSendRequests),console.log("  Avg. Handle Time: ",this._totalRequestHandleTime/this._numHandledRequests)}},{key:"getCssClass",value:function(e,t){return""}},{key:"getSyncAccounts",value:function(){var e=this,t=[],a=bo.settings.syncAccounts.get();return a&&(t=Object.keys(a).filter((function(t){return!!a[t][e.id]}))),t}},{key:"numSyncAccounts",value:function(){return this.getSyncAccounts().length}},{key:"hasSyncAccount",value:function(e,t){var a=!1,n=bo.settings.syncAccounts.get();if(n){var r=n[e];a=r&&r[this.id]}return a||t||e!==ee.a.getDefaultAccountID()||(a=!0),a}},{key:"_onSyncAccountsChanged",value:function(e,t){var a=this;if(!bo.settings.isLoading&&!this.isBuiltin){var n=Object.keys(e).some((function(t){return e[t][a.id]}));n!==this.isEnabled()&&(n?(console.log("Enabling",this.id),ne.a.enablePlugin(this.id)):(console.log("Disabling",this.id),ne.a.disablePlugin(this.id)));var r=[],i=[];Object.keys(e).forEach((function(n){var i,o;(null===(i=e[n])||void 0===i?void 0:i[a.id])&&!(null===(o=t[n])||void 0===o?void 0:o[a.id])&&r.push(n)})),t&&Object.keys(t).forEach((function(n){var r,o;(null===(r=t[n])||void 0===r?void 0:r[a.id])&&!(null===(o=e[n])||void 0===o?void 0:o[a.id])&&i.push(n)})),this.onSyncAccountsChanged(r,i)}}},{key:"_getVMLIForAccount",value:function(e){var t=this.getDefaultItemStore(),a="A~"+e;return null===t||void 0===t?void 0:t.getItem(a)}},{key:"_ensureVMLIsForAccount",value:function(e,t){try{m.default.PAssert(1169,e,"Must specify a valid account ID")}catch(i){m.default.reportError(i)}var a="A~"+e,n=(t=t||this.getDefaultItemStore()).getItem(a);if(!n){var r=t.getRoot();n=t.createItem(a,e,r.id),r.insertSorted(n,this.sortFn)}return n}},{key:"getAccountIDFromItem",value:function(e){var t,a=e.id;if(a.startsWith("R~")&&(a=a.substr(2)),a.startsWith("A~"))(t=a.substr(2)).startsWith("S~")&&(t=t.substr(2));else if(a.startsWith("L~"))t=a.substring(2,a.indexOf("~",2));else if(a.startsWith("T~"))t=a.substring(2,a.indexOf("~",2));else{var n=e.getAttachmentByPlugin(this.id);t=null===n||void 0===n?void 0:n.getField("accountID")}try{m.default.PAssert(1170,!t||t.indexOf("~")<0,"Should not contain delim in label ID")}catch(r){m.default.reportError(r)}return t}},{key:"getAccountIDForPane",value:function(e){var t;return(null===(t=e.plugin)||void 0===t?void 0:t.getAccountIDFromItem(e.item.get()))||ee.a.getDefaultAccountID()}},{key:"sortFn",value:function(e,t){return e.getParsedText().localeCompare(t.getParsedText())}},{key:"onPaneActivated",value:function(e){}},{key:"getWordStyles",value:function(){return{}}},{key:"_activate",value:function(){}},{key:"_deactivate",value:function(){}},{key:"_offlineLoad",value:function(){}},{key:"_load",value:function(){}},{key:"runRemoteSearch",value:function(e,t,a,n){}},{key:"googleScopes",value:function(e){return[]}},{key:"getDependencies",value:function(){return[]}},{key:"getTextIconPadding",value:function(){return 0}},{key:"getURLForAttachment",value:function(e){return""}},{key:"onSyncAccountsChanged",value:function(e,t){}}]),e}(),_()(ra.prototype,"_onSyncAccountsChanged",[b.a],Object.getOwnPropertyDescriptor(ra.prototype,"_onSyncAccountsChanged"),ra.prototype),ra);ve.a.defineBase(ya);var ka=ya;function _a(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var ba=function(e){d()(a,e);var t=_a(a);function a(){var e;return i()(this,a),(e=t.call(this,y.a.PluginID.Date,"t","Date",!0)).pluginMargin=0,e.pluginPadding=8,e.declareProperty("itemID",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!1),e}return s()(a,[{key:"getDisplayText",value:function(e,t){return this.getUnstyledText(e,t)}},{key:"getStyledText",value:function(e,t,a){return this.getUnstyledText(e,a)}},{key:"getUnstyledText",value:function(e,t){if(t=t||j.a.getItem(e.id)){var a=t.getMooDate();if(a)return a.toText(!0)}return""}},{key:"getWordStyles",value:function(){return{fontSize:11}}},{key:"getAttachmentEmbedString",value:function(){return y.a.CharDate}},{key:"_getTextForItem",value:function(e){try{m.default.PAssert(908,e,"Must pass in a valid item to get text for")}catch(t){m.default.reportError(t)}return y.a.CharDate}},{key:"getAttachmentClass",value:function(e){var t=["inlineDate","c-date","c-border-light","pressable"],a=j.a.getItem(e.id);if(a){var n=a.getMooDate();n&&n.getGCalId()&&(t=t.concat("syncedToCalendar"))}return t}},{key:"requestData",value:function(e){e.notifyDataLoaded(y.a.PluginLoad.Full,!1,void 0,y.a.ChangeType.Remote)}}]),a}(ka),wa=a(134);function Sa(e){this._cb=e,this._pageToken=void 0,this._validToken=!1}ve.a.defineBase(Sa),ve.a.extend(Sa.prototype,{hasPaginationToken:function(){return this._validToken},needsPaginationToken:function(){return!this.hasPaginationToken()&&!this._pageToken},setPaginationToken:function(e){this._pageToken=e,this._validToken=!0,this._cb&&this._cb(this)},beginDataPageLoad:function(){return this._pageToken.notifyBeginUse(),this._pageToken},endDataPageLoad:function(e){e?this._pageToken.notifyEndUse():this._validToken=!1}});var Da=Sa;function Pa(e,t,a){this._super.constructor.call(this),this._searchQuery=e,this._invalid=!1,this._hasError=!1,this._remoteRequestCB=a,this._activePageRequest=void 0,this._lastPageRequest=void 0,this._cachedResults=[],this._localPageOffset=0,this._automaticPageRequests=0,this._pageSize=t,ve.a.forceBind("onEntry",this)}var Ia={invalidate:function(){this._invalid=!0},isValid:function(){return!this._invalid},hasError:function(){return this._hasError},getNextPage:function(e,t){try{m.default.PAssert(1199,m.default.isFunction(e)&&m.default.isFunction(t)||this._lastPageRequest,"Must provide valid callbacks")}catch(s){m.default.reportError(s)}try{m.default.PAssert(1200,!this._invalid,"Should never request another page from an invalidated search")}catch(s){m.default.reportError(s)}try{m.default.PAssert(1201,this.hasMoreResults(),"Should never request another page if there are no possible results")}catch(s){m.default.reportError(s)}try{m.default.PAssert(1202,!this._activePageRequest,"Should only run a single request at a time")}catch(s){m.default.reportError(s)}if(e||t||!this._lastPageRequest||(e=this._lastPageRequest.entryCB,t=this._lastPageRequest.doneCB),this._activePageRequest)t(!1);else if(this._cachedResults.length>this._localPageOffset+this._pageSize){for(var a=0,n=0;n<this._pageSize;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._cachedResults[this._localPageOffset+n];try{e(r)}catch(l){m.default.reportError(l)}}this._localPageOffset+=this._pageSize,t(!0)}else if(this.hasPaginationToken()&&this._automaticPageRequests<5)this._activePageRequest={entryCB:e,doneCB:t},this._automaticPageRequests++,this._remoteRequestCB(this);else if(this._localPageOffset<this._cachedResults.length){for(var i=0,o=this._localPageOffset;o<this._cachedResults.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r=this._cachedResults[o];try{e(r)}catch(l){m.default.reportError(l)}this._localPageOffset++}t(!0)}},onEntry:function(e){this._invalid||this._cachedResults.push(e)},onDone:function(e){this._invalid||this._activePageRequest&&(this._lastPageRequest=this._activePageRequest,this._activePageRequest=void 0,e?this.getNextPage(this._lastPageRequest.entryCB,this._lastPageRequest.doneCB):(this._invalid=!0,this._hasError=!0,this._lastPageRequest.doneCB(e)))},hasResults:function(){return this._cachedResults.length>0},hasMoreResults:function(){return this._cachedResults.length>this._localPageOffset||this.hasPaginationToken()}};ve.a.inherit(Da,Pa),ve.a.extend(Pa.prototype,Ia);var Ea,Ca=Pa,xa=a(124),Aa=a(120),Ta=a(96),Ma=a(107);function La(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var Oa,Ra=(Ea=function(e){d()(a,e);var t=La(a);function a(e){var n;i()(this,a);var r={title:"Files",contextMenuMode:"Drive",paneEmptyMessage:"Loading Google Drive...",paneEmptySearchMessage:"",titleContextMenuHeader:"Open folder",dropEffect:function(){return y.a.DropEffect.Copy},isWriteable:!1,isDropTarget:!1,overrideCopyBehavior:!1,canAddItem:!1,supportCollapsing:!0,supportCompleting:!1,supportCheckbox:!1,supportOffline:!1,supportPerformArchive:!1,supportDataRefresh:"Drive",supportPagination:!0,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportClickOverviewScroll:!1,supportClone:!1,supportDates:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,searchFilters:[],supportsDocuments:!1};return e.plugin=bo.pluginManager.getPlugin(y.a.PluginID.Drive),(n=t.call(this,e,r)).type=n.plugin._paneType,n.paneClass="paneOutline panePlugin paneDrive noComplete",n._isSearchingRemote=new P.a(!1),n._currentSearch=void 0,n.initDrive(),n}return s()(a,[{key:"initDrive",value:function(){this.search.onChanged.listen(this.notifySearchChanged),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0,this.item.get()===this.plugin.getDefaultItemStore().getRoot()&&this.setItem(this.getDefaultDisplayItem())}},{key:"destroy",value:function(){this.search.onChanged.unlisten(this.notifySearchChanged),clearTimeout(this._searchTimeout),this._searchTimeout=void 0,u()(g()(a.prototype),"destroy",this).call(this)}},{key:"_getNotReadyStatus",value:function(){var e="Unknown Error: Unable to load pane data.",t=this.plugin.getUnloadedDependencies();return t&&t.indexOf(y.a.PluginDependency.PremiumSub)>=0&&(e="Only available to premium subscribers."),e}},{key:"getItemStore",value:function(){return this.plugin.getActiveItemStore(this.id)}},{key:"getRootItem",value:function(){var e=this.getItemStore();return e?e.getRoot():void 0}},{key:"getDefaultDisplayItem",value:function(e){return this.plugin.getDefaultDisplayItem(e)}},{key:"bottomListMessage",value:function(){var e;return!this.isSearched()&&this.getItem().hasPaginationToken()&&(e="LOAD MORE"),{text:e,clickable:!0}}},{key:"searchACName",value:function(){}},{key:"getPaneIcon",value:function(){return this.plugin.getPaneIcon()}},{key:"requestDemandLoadData",value:function(e){this.plugin.requestDemandLoadData(this.id,e)}},{key:"requestDataPage",value:function(e){this.plugin.requestDataPage(e)}},{key:"onClose",value:function(){u()(g()(a.prototype),"onClose",this).call(this)}},{key:"_runRemoteSearch",value:function(){var e=this;if(bo.PaneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var t=this.search.getValue();this._lastSearchValue=t,this._lastSearchTime=Date.now(),this.isLoading.set(!0),this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0),this._currentSearch=this.plugin.runSearch(t,this.id,void 0,!1,(function(t){switch(e.isLoading.set(!1),t){case y.a.SearchResultStatus.Done:e.paneTopText.set("");break;case y.a.SearchResultStatus.TooMany:e.paneTopText.set("Too many search results! Be more specific.");break;case y.a.SearchResultStatus.None:e.paneTopText.set("There were no search results");break;case y.a.SearchResultStatus.Error:e.paneTopText.set("There was an error running your search, try again.");break;default:try{m.default.PAssert(1196,!1,"Invalid search state: ",t)}catch(a){m.default.reportError(a)}}}))}}},{key:"notifySearchChanged",value:function(e){var t=this.search.getValue();if(t!==this._lastSearchValue||Date.now()-this._lastSearchTime>5e3)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,t){var a=e?0:2500;this._searchTimeout=setTimeout(this._runRemoteSearch.bind(this),a)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this.isLoading.set(!1),this.paneTopText.set("")}},{key:"_refreshPaneData",value:function(){this.plugin.refreshCurrentView()}},{key:"notifyDropFrom",value:function(e,t){this.plugin.notifyDropFrom(e,t)}},{key:"applyDropOnBlock",value:function(e,t){if(e.isDate){var a,n=e.dateTime||e.date;a=m.default.isString(n)?bo.International.parseDate(n,y.a.DateFormat.MDY):n;try{m.default.PAssert(1197,m.default.isDateValid(a),"Must provide a valid date when scheduling an email",e.dateTime,e.date)}catch(r){m.default.reportError(r)}m.default.isDateValid(a)&&this.plugin.scheduleFile(t,a)}}},{key:"dropEffectCopyBehavior",value:function(e,t){return u()(g()(a.prototype),"dropEffectCopyBehavior",this).call(this,e,t)}},{key:"isSearchingRemote",value:function(){return this._isSearchingRemote.get()}},{key:"_onRemoteDataLoaded",value:function(){}},{key:"isItemHeader",value:function(e,t){if(e.id.startsWith("A~"))return!0;var a=this.plugin,n=e.getAttachmentByPlugin(a.id),r=n&&a.getCacheData(n.id);return r&&a.isFolder(r)}},{key:"titleOfFirstItem",value:function(){return"My Drive Files"}},{key:"getPaddingForPaneObject",value:function(e){return u()(g()(a.prototype),"getPaddingForPaneObject",this).call(this,e)-(e.overview?10:0)}},{key:"getMobileIcon",value:function(){return"FaFile"}}]),a}(Ma.a),_()(Ea.prototype,"notifySearchChanged",[b.a],Object.getOwnPropertyDescriptor(Ea.prototype,"notifySearchChanged"),Ea.prototype),Ea);function Fa(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var Na,Ba="application/octet-stream",ja="application/vnd.google-apps.folder",Ua="application/vnd.google-apps.spreadsheet",Ha="application/vnd.google-apps.presentation",Va="application/vnd.google-apps.document",Wa="application/vnd.google-apps.drive-sdk.597847337936",za="image/png",qa="image/jpg",Ga="image/jpeg",Ka="image/gif",Ya="S~SharedWithMe",Xa="https://drive.google.com/open?id=",Qa=1e8,Ja=(Oa=function(e){d()(a,e);var t=Fa(a);function a(){var e;return i()(this,a),(e=t.call(this,y.a.PluginID.Drive,"d","Files",!1)).displaySharedWithMe=!m.default.isDemoMode(),e._requiresOfflineAuth=!0,e.doesRender=!0,e.isLoadingFiles=new P.a(!1),e.registerSetting("LastChangeId","lastChangeId","i"),e.registerSetting("DriveRootId","driveRootId","d"),e._folderCache=e.registerLocalCache(e.id,y.a.StorageType.IndexedDB,{metadataKeys:["isSyncd"],keyFieldsRN:[]}),e.declareProperty("accountID",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,m.default.isDemoMode(),m.default.isDemoMode()?"me":void 0),e.declareProperty("showInline",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!0),e.declareProperty("imageWidth",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!0),e.declareProperty("titleLower",y.a.PluginLoad.Runtime,!1,""),e.declareProperty("dataUrl",y.a.PluginLoad.Preview|y.a.PluginLoad.Runtime,!0),e.declareProperty("pinToTop",y.a.PluginLoad.Runtime,!0,!1),e.declareProperty("title"),e.declareProperty("mimeType"),e.declareProperty("fileSize",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0),e.declareProperty("alternateLink",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0),e.declareProperty("webContentLink",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0),e.declareProperty("isDeleted",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,!1),e.declareProperty("modifiedDate",y.a.PluginLoad.Autocomplete,!0),e.declareProperty("parents",y.a.PluginLoad.Autocomplete,!0),e}return s()(a,[{key:"getType",value:function(){return y.a.PluginType.Storage}},{key:"getDataPane",value:function(){try{m.default.PAssert(877,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(e){m.default.reportError(e)}return Ra}},{key:"getPaneIcon",value:function(){return"icon-drive-file"}},{key:"getPanePriority",value:function(){return 96}},{key:"useItemStore",value:function(){return"Google Drive"}},{key:"itemStoreOptions",value:function(){return{requireStoredEls:!1,parserFn:rt.a.runParseSinglePlugin}}},{key:"getSettingForAccount",value:function(e,t){var a=this.getSetting(t);return null===a||void 0===a?void 0:a[e]}},{key:"setSettingForAccount",value:function(e,t,a,n){var r=this.getSetting(t);r&&m.default.isObject(r)||(r={}),r=Object.assign({},r,Z()({},e,a)),this.setSetting(t,r,n)}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"_ensureSpecialFolders",value:function(){}},{key:"_load",value:function(){var e=this;this._ensureSpecialFolders(),this.getSyncAccounts().forEach((function(t){return e._ensureVMLIsForAccount(t)})),m.default.isDemoMode()||this.createRecurringTask("ChangeListUpdates",{delay:m.default.minutes(15),minDelay:m.default.minutes(2),runOnCreate:!0,pauseWhileIdle:!0,task:this.performChangeListUpdate})}},{key:"getDefaultDisplayItem",value:function(e){return e||(e=this.getSyncAccounts()[0]),this._ensureVMLIsForAccount(e)}},{key:"_notifyFailedRequest",value:function(e){e&&e.error&&m.default.log("Failed Drive request",e.error.code)}},{key:"refreshCurrentView",value:function(){this.hasRecurringTask("ChangeListUpdates")&&this.getRecurringTask("ChangeListUpdates").forceUpdate()}},{key:"loadInitialData",value:function(){var e=this;u()(g()(a.prototype),"loadInitialData",this).call(this);new Da((function(){}));setTimeout((function(){if(!e._folderCache.getMetadata("isSyncd")){m.default.log("Folder cache unsyncd - running folder sync");var t="trashed=false and mimeType contains '"+ja+"'";e._requestRemoteFiles(Ta.a.FolderStruct,t,999,(function(t,a){e._folderCache.saveEntry(e.serializeExternalData(a))}),(function(){0})),e._folderCache.setMetadata("isSyncd",!0)}}),100);var t=!1,n="trashed=false and 'root' in parents and mimeType != '"+Wa+"'";this._requestRemoteFiles(Ta.a.SubFolder,n,70,(function(t,a){if(e.hasCacheData(a.id)||e._addRemoteEntry(t,a),e.createItem(t,void 0,a),!e.getSettingForAccount(t,e.Settings.DriveRootId)&&a.parents)for(var n=0,r=0;r<a.parents.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;a.parents[r].isRoot&&e.setSettingForAccount(t,e.Settings.DriveRootId,a.parents[r].id)}}),(function(){t||(t=!0)}))}},{key:"performChangeListUpdate",value:function(){var e=this;this.getSyncAccounts().forEach((function(t){var a,n=e.getSettingForAccount(t,e.Settings.LastChangeId);e._requestChangeList(t,n,(function(t,r){try{m.default.PAssert(878,!n||parseInt(r.id)>parseInt(n),"Must have correctly ordered change entry")}catch(i){m.default.reportError(i)}a=r.id;try{!r.fileId||r.file&&r.file.mimeType===Wa||e._handleChange(t,r)}catch(o){m.default.reportError(o)}}),(function(n){n&&-1!==a&&e.setSettingForAccount(t,e.Settings.LastChangeId,a)}))}))}},{key:"_deleteFile",value:function(e){e.forEachItem(this.getDefaultItemStore(),(function(e){e.parent().removeChild(e,y.a.ChangeType.Remote),e.setParent(void 0)})),e.updateField("isDeleted",!0)}},{key:"_handleChange",value:function(e,t){var a=this;try{m.default.PAssert(879,t&&(t.deleted||t.file),"Must have a valid formed change entry to handle")}catch(g){m.default.reportError(g)}if((t.deleted||t.file.mimeType===ja)&&(t.deleted?this._folderCache.hasEntry(t.fileId).then((function(e){e&&a._folderCache.removeEntry(t.fileId)})):this._folderCache.saveEntry(this.serializeExternalData(t.file))),!this.hasCacheData(t.fileId)&&!t.deleted&&t.file){for(var n=0,r=t.file.parents,i=!1,o=0;o<r.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(this.hasCacheData(r[o].id)||r[o].isRoot){i=!0;break}}i&&this._addRemoteEntry(e,t.file)}var s=this.getCacheData(t.fileId);if(s){t.deleted||this.dataHasChanged(s,t.file)&&this._addRemoteEntry(e,t.file);var l=this.getDefaultItemStore();if(t.deleted){var u=this.getAttachment(t.fileId);this._deleteFile(u)}else{var c=0,d=[];this.getAttachment(t.fileId).forEachItem(l,(function(e){for(var n=0,r=!1,i=0;i<t.file.parents.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=t.file.parents[i];if(o.isRoot&&e.parent()&&e.parent().isRootItem()||e.parent()&&e.parent().hasAttachment(o.id)){r=!0,d.push(o.id);break}}e.parent()&&a._isSpecialFolder(e.parent().id)&&(r=!0,d.push(e.parent().id)),!r&&e.parent()&&(e.parent().removeChild(e,y.a.ChangeType.Remote),e.setParent(void 0))}));for(var h=0;h<t.file.parents.length;++h){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var f=t.file.parents[h];if(d.indexOf(f.id)<0)if(f.isRoot)this.createItem(e,void 0,{id:t.fileId,mimeType:t.file.mimeType});else this.getAttachment(f.id).forEachItem(l,(function(n){a.createItem(e,n,{id:t.fileId,mimeType:t.file.mimeType})}))}if(this.displaySharedWithMe&&t.file.sharedWithMeDate&&d.indexOf(Ya)<0){var p=l.getItem(Ya);this.createItem(e,p,{id:t.fileId,mimeType:t.file.mimeType})}}}}},{key:"_isValidFileID",value:function(e){return e.indexOf("~")<0}},{key:"_createItemID",value:function(e,t){var a=0;try{m.default.PAssert(880,e,"Must provide a fileID")}catch(i){m.default.reportError(i)}try{m.default.PAssert(881,this._isValidFileID(e),"Invalid fileID - "+e)}catch(i){m.default.reportError(i)}try{m.default.PAssert(882,t,"Must provide a valid itemStore")}catch(i){m.default.reportError(i)}for(var n=e,r=0;t.hasItem(n)&&r<50;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n=e+"~"+ ++r}try{m.default.PAssert(883,r<50,"SANITY: Should not have items with 50+ parents")}catch(i){m.default.reportError(i)}return n}},{key:"_hasSameItem",value:function(e,t,a){for(var n=0,r=!1,i=e,o=0;a.hasItem(i)&&o<50;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=a.getItem(i);if(s&&s.parent()&&s.parent().id===t){r=!0;break}i=e+"~"+ ++o}return r}},{key:"_isSpecialFolder",value:function(e){return e.startsWith("S~")}},{key:"requestDemandLoadData",value:function(e,t){var a=this;try{m.default.PAssert(884,1===t.getNumAttachments(),"Should only have a single attachment for Drive Pane VMLIs")}catch(l){m.default.reportError(l)}var n,r=bo.PaneManager.getPaneById(e),i=t.getAttachmentByPlugin(this.id);if(this._isSpecialFolder(t.id))switch(t.id){case Ya:n="trashed=false and sharedWithMe and mimeType != '"+Wa+"'";break;default:try{m.default.PAssert(885,!1,"Invalid special folder ID")}catch(l){m.default.reportError(l)}}n||(n="trashed=false and '"+i.id+"' in parents and mimeType != '"+Wa+"'");var o=this.getActiveItemStore(e),s=this.getAccountIDFromItem(t);this._requestRemoteFilesForAccount(s,Ta.a.SubFolder,t,n,70,(function(e,n){a.hasCacheData(n.id)||a._addRemoteEntry(e,n),a._hasSameItem(n.id,t.id,o)||a.createItem(e,t,n)}),(function(e,a){a||t.hasPaginationToken()||t.notifyLoadDataFailed(r)})),this.sendEvent("RequestDemandLoadData")}},{key:"requestDataPage",value:function(e){this._requestRemoteFiles(Ta.a.DataPage,e)}},{key:"_ensureAncestorChain",value:function(e,t,a,n,r){var i=this;try{m.default.PAssert(886,n,"Must provide a valid success callback")}catch(g){m.default.reportError(g)}try{m.default.PAssert(887,r,"Must provide a valid error callback")}catch(g){m.default.reportError(g)}if(a.parents&&a.parents.length)for(var o=0,s=a.parents.length,l=0,u=function(){++l===s&&n()},c=function(a){try{m.default.PAssert(888,a,"Must provide valid fileInfo up ancestor chain")}catch(g){m.default.reportError(g)}i.hasCacheData(a.id)||i._addRemoteEntry(e,a),i._ensureAncestorChain(e,t,a,u,r)},d=function(e){if(e){var t=i.serializeExternalData(e);i._folderCache.saveEntry(t),c(t)}else r({error:"Undefined success result."})},h=function(t){if(t)c(t);else{var a=ea.a.fns("drive").files.get.packedFn,n={fileId:t.id};i._queueRemoteRequestMulti(e,a,n,d,r,void 0,Ta.a.SingleFolder)}},f=0;f<a.parents.length;++f){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var p=a.parents[f].id;try{m.default.PAssert(889,p,"Must supply a valid parent ID to query")}catch(g){m.default.reportError(g)}h(this._folderCache.getEntry(p))}else n()}},{key:"_hasAttachmentChild",value:function(e,t){for(var a=0,n=!1,r=0;r<e.numItems();++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e.itemAtIndex(r).hasAttachment(t)){n=!0;break}}return n}},{key:"_attachAncestorChain",value:function(e,t,a){var n=this;try{m.default.PAssert(890,a,"Must provide a valid cache entry to create items for")}catch(s){m.default.reportError(s)}if(a.parents&&a.parents.length>0)for(var r=0,i=0;i<a.parents.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=a.parents[i];try{m.default.PAssert(891,o&&o.id,"Must supply a valid parent ID to query")}catch(s){m.default.reportError(s)}o.isRoot?this.createItem(e,void 0,a):this._folderCache.getEntry(o.id).then((function(r){n._attachAncestorChain(e,t,r),n.getAttachment(r.id).forEachItem(t,(function(t){n._hasAttachmentChild(t,a.id)||n.createItem(e,t,a)}))}))}}},{key:"getNextSearchPage",value:function(){this._lastCompletedSearch&&this._lastCompletedSearch.isValid()&&this._lastCompletedSearch.getNextPage()}},{key:"runRemoteSearch",value:function(e,t,a,n){var r=this;try{m.default.PAssert(892,e,"Must provide a valid search")}catch(v){m.default.reportError(v)}try{m.default.PAssert(893,t,"Must provide a valid pane")}catch(v){m.default.reportError(v)}try{m.default.PAssert(894,m.default.isFunction(n),"Must provide a valid search callback")}catch(v){m.default.reportError(v)}var i=!1,o=0,s=0,l=0,u=new Ca(e,10,this.requestDataPage.bind(this)),c=function(){if(o===s&&i){m.default.log("Done Searching! "+o);var e=y.a.SearchResultStatus.Done;if(u.isValid())bo.PaneManager.getPaneById(t).search.update(!0),u.isValid()&&u.hasMoreResults()?(m.default.log("Too many search results"),e=y.a.SearchResultStatus.TooMany):u.hasError()||l>0?e=y.a.SearchResultStatus.Error:0===o&&(e=y.a.SearchResultStatus.None),r._lastCompletedSearch=u;n(e)}},d=function(e){i=!0,c()},h=!1,f="trashed=false and (fullText contains '"+e+"')",p=bo.PaneManager.getPaneById(t),g=this.getAccountIDForPane(p);return this._requestRemoteFilesForAccount(g,Ta.a.Search,u,f,100,u.onEntry,(function(e,a){u.onDone(a),h||(h=!0,u.isValid()&&(u.hasResults()?u.getNextPage((function(a){return function(e,a){o++,r.hasCacheData(a.id)||r._addRemoteEntry(e,a);var n=r.getActiveItemStore(t);r._ensureAncestorChain(e,n,a,(function(){u.isValid()&&r._attachAncestorChain(e,n,a),s++,c()}),(function(e){m.default.reportError(new Error("Error during remote search: "+e)),s++,l++,c()}))}(e,a)}),d):d()))})),this.sendEvent("RemoteSearch"),u}},{key:"_requestRemoteFiles",value:function(e,t,a,n,r){var i=this;this.getSyncAccounts().forEach((function(o){return i._requestRemoteFilesForAccount(o,e,i._ensureVMLIsForAccount(o,i.getDefaultItemStore()),t,a,n,r)}))}},{key:"_requestRemoteFilesForAccount",value:function(e,t,a,n,r,i,o){var s=this;this.isLoadingFiles.set(!0);var l,u=function(e,t,a){o(e,t,a),s.isLoadingFiles.set(!1)};a&&a.hasPaginationToken()&&!a.paginationTokenInUse()?(n=(l=a.beginDataPageLoad()).getQuery(),r=l.getMaxResults(),i=l.getEntryCB(),u=l.getDoneCB()):a&&a.needsPaginationToken()&&(l=this.createPaginationToken(void 0,n,{},r,i,u),a.setPaginationToken(l),a.beginDataPageLoad()),r=r||70;try{m.default.PAssert(895,i&&m.default.isFunction(i),"Must define a valid entry callback")}catch(p){m.default.reportError(p)}try{m.default.PAssert(896,u&&m.default.isFunction(u),"Must define a valid done callback")}catch(p){m.default.reportError(p)}var c,d,h=ea.a.fns("drive").files.list.packedFn,f={fields:"items,nextPageToken",maxResults:r,q:n,pageToken:l&&l.hasMorePages()?l.getNextPageToken():void 0};ee.a.onLoaded((function(){e&&(l||!a?(c=function(t){if(t.items){var n=0;bo.PaneUpdateBatcher.beginUpdateItems();for(var r=0;r<t.items.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;i(e,t.items[r])}bo.PaneUpdateBatcher.commitUpdateItems()}t.nextPageToken&&l&&s.updatePaginationToken(l,t.nextPageToken),a&&l&&a.endDataPageLoad(!!t.nextPageToken),u(e,!0)},d=function(){console.log(e,"failure"),l&&a.endDataPageLoad(!!l),u(e,!1)}):(c=function(){u(e,!0)},d=function(){u(e,!1)}),s._queueRemoteRequestMulti(e,h,f,c,d,void 0,t))}))}},{key:"getRemoteAttachmentData",value:function(e){var t=this,a=ea.a.fns("drive").files.get.packedFn,n={fileId:e.id},r=e.getField("accountID");ee.a.onLoaded((function(){var i=function(a){try{m.default.PAssert(897,!a||a.id===e.id,"If valid result, attachment should match remote file ID")}catch(n){m.default.reportError(n)}a&&!a.error&&(t._addRemoteEntry(r,a),(a.deleted||a.mimeType===ja)&&(a.deleted?t._folderCache.hasEntry(a.id).then((function(e){e&&t._folderCache.removeEntry(a.id)})):t._folderCache.saveEntry(t.serializeExternalData(a))),e.forEachItem(void 0,(function(e){e.itemChanged.notify()})))};if(r){t._queueRemoteRequestMulti(r,a,n,i,(function(a){if(m.default.isHTTPStatusCode(a,y.a.HTTPStatusCode.NotFound)){var n={id:e.id,mimeType:Ba,title:"Unknown",titleLower:"unknown",fileSize:0};t._addRemoteEntry(r,n),t._deleteFile(e)}else e.notifyDataRequestFailed(),t._notifyFailedRequest(a)}),e,Ta.a.SingleFile)}else t.getSyncAccounts().forEach((function(o){t._queueRemoteRequestMulti(o,a,n,(function(t){r=o,t.accountID=r,i(t),e.notifyDataMutated(["accountID"],y.a.ChangeType.Local)}),(function(){}),e,Ta.a.SingleFile)}))}))}},{key:"_requestChangeList",value:function(e,t,a,n){var r,i,o,s,l=this;ee.a.onLoaded((function(){if(e){if(t&&t>=0){try{m.default.PAssert(898,a,"Must supply a valid entry CB")}catch(u){m.default.reportError(u)}try{m.default.PAssert(899,n,"Must provide a valid done CB")}catch(u){m.default.reportError(u)}r=ea.a.fns("drive").changes.list.packedFn,i={includeDeleted:!0,includeSubscribed:!0,maxResults:500,startChangeId:+t+1,fields:"items,nextPageToken"},o=function(r){var i=0,o=t;bo.PaneUpdateBatcher.beginUpdateItems();for(var s=0;s<r.items.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var c=r.items[s];try{m.default.PAssert(900,c,"Must have a valid change entry")}catch(u){m.default.reportError(u)}try{m.default.PAssert(901,parseInt(c.id)<Qa,"Must have a valid entry ID")}catch(u){m.default.reportError(u)}try{m.default.PAssert(902,parseInt(c.id)>parseInt(o),"Must be ordered monotonic increasing")}catch(u){m.default.reportError(u)}o=c.id,a(e,c)}bo.PaneUpdateBatcher.commitUpdateItems(),r.nextPageToken&&o!==t?l._requestChangeList(e,o,a,n):n(!0)},s=function(e){n(!1)}}else r=ea.a.fns("drive").changes.list.packedFn,i={includeDeleted:!0,includeSubscribed:!0,maxResults:1,startChangeId:Qa},o=function(t){var r=t.largestChangeId;a(e,{id:r}),n(!0)},s=function(e){n(!1)};l._queueRemoteRequestMulti(e,r,i,o,s,void 0,Ta.a.ChangeList)}}))}},{key:"_createRemoteEntry",value:function(e,t){var a={accountID:e,id:t.id,mimeType:t.mimeType,title:t.title,titleLower:t.title.toLowerCase(),alternateLink:t.alternateLink,webContentLink:t.webContentLink||t.alternateLink,dataUrl:t.dataUrl,fileSize:+t.fileSize,parents:t.parents,modifiedDate:t.modifiedDate?new Date(t.modifiedDate):void 0};if(a.parents)for(var n=0,r=0;r<a.parents.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this._updateParentsEntry(a.parents[r])}return this.isFolder(a)&&(a.items=[]),a}},{key:"_addRemoteEntry",value:function(e,t){var a=this._createRemoteEntry(e,t);this.cacheData(a.id,a)}},{key:"createEntryFromLocal",value:function(e,t){if(this.isFolder(t)&&(t.items=[]),t.titleLower=t.title.toLowerCase(),t.modifiedDate=t.modifiedDate?new Date(t.modifiedDate):void 0,t.isDeleted=t.isDeleted||m.default.isTempId(e),t.parents)for(var a=0,n=0;n<t.parents.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._updateParentsEntry(t.parents[n])}return t}},{key:"_updateParentsEntry",value:function(e){this._folderCache.getEntry(e.id).then((function(t){t&&(e.title=t.title)}))}},{key:"isFolder",value:function(e){return e.mimeType===ja}},{key:"_getCompStringForItem",value:function(e){return e.hasPluginAttachment(this.id)?e.getAttachmentByPlugin(this.id).getTitleString():e.getParsedText()}},{key:"_isItemPinnedToTop",value:function(e){return!!e.hasPluginAttachment(this.id)&&e.getAttachmentByPlugin(this.id).getField("pinToTop")}},{key:"sortFn",value:function(e,t){return this._isItemPinnedToTop(e)?-1:this._isItemPinnedToTop(t)?1:this._getCompStringForItem(e).localeCompare(this._getCompStringForItem(t))}},{key:"getAttachmentClass",value:function(e){var t=["plugin_drive"];return e.hasField("mimeType")?t.push(this.getMimetypeClass(e)):t.push("plugin_drive_unk"),e.hasField("isDeleted")&&e.getField("isDeleted")&&t.push("fileDeleted"),t}},{key:"getMimetypeClass",value:function(e){var t=e.getField("mimeType");if(this.isMimetypeImage(t))return e.getField("showInline")?"plugin_drive_image_inline":"plugin_drive_image";switch(t){case ja:return"plugin_drive_folder";case Ua:return"plugin_drive_sheet";case Ha:return"plugin_drive_slide";case Va:return"plugin_drive_doc";default:return"plugin_drive_unk"}}},{key:"isMimetypeImage",value:function(e){switch(e){case za:case Ka:case qa:case Ga:return!0}}},{key:"isImage",value:function(e){var t=this.getMimetypeClass(e);return e.hasField("mimeType")&&("plugin_drive_image"===t||"plugin_drive_image_inline"===t)}},{key:"googleScopes",value:function(e){return e?[y.a.GScope.DriveFull]:[y.a.GScope.Drive]}},{key:"getDependencies",value:function(){return[y.a.PluginDependency.PremiumSub]}},{key:"verifyAuthorization",value:function(e){return ee.a.isAuthorizedForScopes(e,this.googleScopes())}},{key:"handleDropEvent",value:function(e,t){var a,n,r=e.dataTransfer,i=e.target,o=e.clipboardData,s=null===r||void 0===r?void 0:r.getData("text/uri-list"),l=m.default.getPaneForElement(i);if(s&&s.startsWith(Xa)){var u=s.replace(Xa,""),c=u.indexOf("&"),d=u.substr(0,c);return m.default.shouldLog(y.a.LogLevels.Plugin)&&m.default.log("Dropped File: ",d),t(this.getAttachment(d).getEmbedString()),!0}if((null===r||void 0===r||null===(a=r.files)||void 0===a?void 0:a.length)>0){for(var h=0,f=0;f<r.files.length;++f){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var p=r.files[f];this.handleDropFile(p,l,{target:i},t)}return bo.onIntroAction("DragFromComp"),!0}if((null===o||void 0===o||null===(n=o.items)||void 0===n?void 0:n.length)>0){for(var g=0,v=0;v<o.items.length;++v){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;var k=o.items[v],_=null===k||void 0===k?void 0:k.getAsFile();_&&(_.customName="Moo.do Upload "+Date.now(),this.handleDropFile(_,l,{target:i},t))}return bo.onIntroAction("DragFromComp"),!0}return!1}},{key:"highlightItem",value:function(e){e.highlight()}},{key:"handleDropFile",value:function(){var e=me()(pe.a.mark((function e(t,a,n,r){var i,o,s,l,u,c,d,h,f,p,g,v,k,_,b,S=0,D=this;return pe.a.wrap((function(e){for(var P=0;;){if(P++>5e3&&__infLoop&&__infLoop(P))throw new RangeError;switch(e.prev=e.next){case 0:i=t.customName||t.name,o=this.findCachedItemsByField("title",i),s=this.getDefaultItemStore(),l=a.type===y.a.PaneMode.Task&&this.isMimetypeImage(t.type)&&bo.settings.showImagesInline.get()?{showInline:!0}:void 0,u=!1,c=0;case 6:if(!(c<o.length)){e.next=20;break}if(!(S++>5e3&&__infLoop&&__infLoop(S))){e.next=9;break}throw new RangeError;case 9:if((d=o[c]).fileSize!==t.size||d.isDeleted){e.next=17;break}return h=this.getAttachment(d.id,l),a&&a.isWriteable&&a.plugin!==this?r(this.getAttachmentEmbedString(h),!1):a&&a.plugin===this&&(f=this.getDefaultItemStore(),h.forEachItem(f,this.highlightItem)),u=!0,e.abrupt("break",20);case 17:++c,e.next=6;break;case 20:if(u){e.next=32;break}if(p=m.default.generateTempId(),g=this.getSyncAccounts(),v="Insert link to file",k=(a.plugin||1===g.length)&&this.getAccountIDForPane(a),_=w.a.isNativeApp()&&t.path,k&&!_){e.next=31;break}return b=_?[v,{header:"Upload to Google Drive"}].concat(g):g,e.next=30,bo.menus.openContextMenuList(_?"Link to local file":"Select a Google Drive account to upload to",n.target,b);case 30:k=e.sent;case 31:k===v?r("[".concat(t.name,"](file://").concat(t.path.replace(/\\/g,"/").replace(/ /g,"%20"),")")):ee.a.onLoaded((function(){if(k){D.cacheData(p,{accountID:k,title:i,titleLower:i.toLowerCase(),mimeType:t.type});var e,o,u=D.getAttachment(p,l),c=a&&a.isWriteable&&a.plugin!==D,d=!1,h=null===n||void 0===n?void 0:n.target;if(a&&a.isWriteable&&a.plugin!==D?d=!0:h&&(e=m.default.hasClass(h,"paneContent")?a.getItem():m.default.getItemForElement(h))&&!e.isHeader()&&(e=e.parent()),e){if(!e.isRootItem()){var f=e.getAttachmentByPlugin(D.id);try{m.default.PAssert(903,f,"Drive items must have valid attachments")}catch(v){m.default.reportError(v)}o=f.id}}else e=s.getRoot(),o=D.getSettingForAccount(k,D.Settings.DriveRootId);var g=a.getDocument();D._upload(k,t,u,c,g,o,(function(){try{m.default.PAssert(904,!s.hasItem(u.id),"When uploading a new file, should never have duplicated items")}catch(v){m.default.reportError(v)}var t=s.createItem(u.id,D.getAttachmentEmbedString(u),e.id);e.insertSorted(t,D.sortFn),d&&r(D.getAttachmentEmbedString(u),!0),(null===g||void 0===g?void 0:g.isShared())&&bo.toasts.pushMessage({text:"Note: Sharing files with collaborators is temporarily disabled while we rebuild it for the new backend",timeout:8e3})}))}}));case 32:case"end":return e.stop()}}}),e,this)})));return function(t,a,n,r){return e.apply(this,arguments)}}()},{key:"notifyDropFrom",value:function(){var e=me()(pe.a.mark((function e(t,a){var n,r,i,o;return pe.a.wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:try{m.default.PAssert(905,t,"Must have a valid item that was dropped")}catch(l){m.default.reportError(l)}try{m.default.PAssert(906,a,"Must have a valid pane the item was dropped on")}catch(l){m.default.reportError(l)}if(m.default.isDemoMode()){e.next=12;break}if(n=t.getAttachmentByPlugin(this.id),!(r=a.getDocument())){e.next=11;break}return i=this.getAccountIDForPane(a),e.next=9,Aa.a.getDocumentFolder(i,r.id);case 9:o=e.sent,Aa.a.copyFileToFolder(i,n.id,o,(function(e,t){}));case 11:this.sendEvent("AttachmentDropped");case 12:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getAttachUrl",value:function(e){var t=this.getCacheData(e.id);if(t)return t.webContentLink&&t.webContentLink.replace("export=download","")||t.dataUrl}},{key:"getAttachDataUrl",value:function(e){var t=this.getCacheData(e.id);return t&&t.dataUrl}},{key:"handleTapClick",value:function(e,t,a,n){var r=this.getAttachment(a);if(w.a.mac&&n.metaKey||!w.a.mac&&n.ctrlKey||this.isPluginPane)return this.openAttach(r,e,t,!1,n)}},{key:"getURLForAttachment",value:function(e){var t,a=this.getCacheData(e.id);return null!==(t=null===a||void 0===a?void 0:a.alternateLink)&&void 0!==t?t:this._createDriveURL(e.id,null===a||void 0===a?void 0:a.mimeType)}},{key:"openAttach",value:function(e,t,a,n,r){var i=this.getCacheData(e.id);if(i&&this.isPluginPane(a)&&this.isFolder(i))a.zoomIn(t),this.sendEvent("Tap_FolderZoom");else{var o=this.getURLForAttachment(e);o&&(n&&!(w.a.mac&&r.metaKey||!w.a.mac&&r.ctrlKey)&&this.isImage(e)?(o="https://drive.google.com/uc?export=view&id="+i.id,bo.menus.openLightbox(o)):o&&(m.default.isDemoMode()?bo.toasts.pushMessage(y.a.MessageID.DemoPluginClick):(bo.openUrl(o,r),this.sendEvent("Tap_OpenFileDesktop"))))}return!0}},{key:"createFolderURL",value:function(e){return"https://drive.google.com/drive/folders/"+e}},{key:"_createDriveURL",value:function(e,t){var a="https://docs.google.com/";switch(t){case ja:return a+"folderview?id="+e+"&usp=drivesdk";case Ua:return a+"spreadsheets/d/"+e+"/edit?usp=drivesdk";case Va:return a+"document/d/"+e+"/edit?usp=drivesdk";case Ha:return a+"presentation/d/"+e+"/edit?usp=drivesdk";default:return a+"file/d/"+e+"/edit?usp=drivesdk"}}},{key:"compactCacheField",value:function(e,t){var a;switch(t){case"alternateLink":e[t]!==this._createDriveURL(e.id,e.mimeType)&&(a=e[t]);break;default:a=e[t]}return a}},{key:"supportUsageCache",value:function(){return!0}},{key:"matchAttachment",value:function(e,t){return e.getField("titleLower").indexOf(t)>=0}},{key:"getBlockedText",value:function(e){return"Go Premium to view Drive files"}},{key:"onDocumentShared",value:function(e){e&&this._ensureAttachmentsAreShared()}},{key:"_ensureAttachmentsAreShared",value:function(){}},{key:"notifyAttachmentUnused",value:function(e,t){u()(g()(a.prototype),"notifyAttachmentUnused",this).call(this,e,t),m.default.isDemoMode()}},{key:"_upload",value:function(e,t,a,n,r,i,o){var s=this;t.size>20971520?(bo.toasts.pushMessage(y.a.MessageID.WarnLargeFile),this.sendEvent("Upload_Large")):this.sendEvent("Upload");var l=this.isMimetypeImage(t.type)&&bo.settings.showImagesInline.get();if(l){var u=new FileReader;u.onload=function(e){var t=s.getCacheData(a.id);t.dataUrl=e.target.result,s.cacheData(a.id,t),o(e)},u.readAsDataURL(t)}var c=new FileReader;c.readAsBinaryString(t),c.onload=function(n){ee.a.onLoaded((function(){ee.a.getAccountAuthToken(e,s.googleScopes(),function(){var n=me()(pe.a.mark((function n(i){var o,l;return pe.a.wrap((function(n){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(n.prev=n.next){case 0:if(o=function(n){new xa.a(t,e,{id:n},void 0,(function(){}),(function(t){s.changeID(a,a.id,t.id),bo.remoteAPI().drivePermissionsPublic(e,t.id,(function(){var n=s.getAttachDataUrl(a);n&&(t.dataUrl=n),s._addRemoteEntry(e,t)}),(function(e){m.default.reportError(new Error("Error adding permission"))}))}),(function(){0})).upload()},!r){n.next=7;break}return n.next=4,s.getDocumentFolder(e,r);case 4:n.t0=n.sent,n.next=10;break;case 7:return n.next=9,Aa.a.getRootFolder(e);case 9:n.t0=n.sent;case 10:l=n.t0,i?o(l):bo.toasts.pushMessage({text:"Uploading file failed because of missing authorization. Please check the Drive plugin is enabled.",action:y.a.MessageAction.OpenSettings});case 12:case"end":return n.stop()}}}),n)})));return function(e){return n.apply(this,arguments)}}())}))},l||o()}},{key:"getDocumentFolder",value:function(e,t){return Aa.a.getDocumentFolder(e,t.id)}},{key:"scheduleFile",value:function(e,t){var a=e.getAttachmentByPlugin(this.id);try{m.default.PAssert(907,a,"Must be able to get a valid attachment from item")}catch(l){m.default.reportError(l)}var n=y.a.MSPerHour,r=bo.pluginManager.getPluginGCalendar();if(r){var i=r.getDefaultExportCalendarID();if(i){var o=a.getField("title"),s=this._createDriveURL(a.id,a.getField("mimeType"));r.createEventForEmail(i,o,s,t,n,(function(e,t,a,n){e||t?t||bo.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar.",action:y.a.MessageAction.Okay}):bo.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:function(){bo.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:y.a.MessageAction.Okay})}})}))}else bo.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:y.a.MessageAction.OpenCalendarSettings})}else bo.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule files.",action:y.a.MessageAction.OpenSettings})}},{key:"findMatchExact",value:function(e){}},{key:"findMatchLike",value:function(e,t){var a=e.toLowerCase(),n=this.findCachedItemsByFn((function(e){return e.titleLower.indexOf(a)>=0}),t);return n.sort((function(e,t){return e.modifiedDate&&t.modifiedDate?Date.compare(e.modifiedDate,t.modifiedDate):e.modifiedDate?-1:t.modifiedDate?1:e.titleLower.localeCompare(t.titleLower)})),n}},{key:"getAttachWidth",value:function(e){return e.hasField("imageWidth")&&e.getField("imageWidth")?+e.getField("imageWidth"):void 0}},{key:"setAttachWidth",value:function(e,t,a){t.updateField("imageWidth",a,!0),e.onAttachInlineUpdate()}},{key:"setShowInline",value:function(e,t,a){t.updateField("showInline",a,!0),e.onAttachInlineUpdate()}},{key:"getStyledText",value:function(e,t,a,n){return wa.a.renderStyled(e,t,a,n)}},{key:"getUnstyledText",value:function(e){return wa.a.renderPlain(e)}},{key:"getTextIconPadding",value:function(){return 24}},{key:"hasCacheData",value:function(e){var t;return!!(null===(t=this._dataCache[e])||void 0===t?void 0:t.accountID)}},{key:"createItem",value:function(e,t,a){var n=this.getDefaultItemStore();if(t||(t=this._ensureVMLIsForAccount(e,n)),!this._hasAttachmentChild(t,a.id)){var r=n.createItem(this._createItemID(a.id,n),this._getTextForItem(a.id,e),t.id,{demandLoadChildren:a.mimeType===ja});t.insertSorted(r,this.sortFn)}}},{key:"pickFilesFromDrive",value:function(){var e=me()(pe.a.mark((function e(t,a){var n,r=this;return pe.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,ee.a.ensureGapiLib("picker");case 2:if((n=(t.plugin||1===this.getSyncAccounts().length)&&this.getAccountIDForPane(t))||!a){e.next=7;break}return e.next=6,bo.menus.openContextMenuList("Select a Google Drive account",a,this.getSyncAccounts());case 6:n=e.sent;case 7:return e.abrupt("return",new Promise((function(e){ee.a.getAccountAuthToken(n,[y.a.GScope.Drive],(function(t){var a=window.google;if(a&&a.picker&&a.picker.PickerBuilder){(new a.picker.PickerBuilder).addView(a.picker.ViewId.DOCS).setAppId(y.a.FirebaseAppID).enableFeature(a.picker.Feature.MULTISELECT_ENABLED).setOAuthToken(null===t||void 0===t?void 0:t.access_token).setCallback((function(t){"picked"===t.action&&t.docs&&m.default.isArray(t.docs)&&(e(t.docs.map((function(e,t){return r._getTextForItem(e.id,n)}))),r.performChangeListUpdate())})).setSize(1051,650).hideTitleBar().build().setVisible(!0)}}))})));case 8:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"onSyncAccountsChanged",value:function(e,t){var n=this;u()(g()(a.prototype),"onSyncAccountsChanged",this).call(this,e,t),e.length>0&&(this._loadedInitialData=!1,this.loadInitialData()),t.forEach((function(e){var t=n._getVMLIForAccount(e);t&&t.deleteSelf(y.a.ChangeType.Remote)}))}}]),a}(ka),_()(Oa.prototype,"performChangeListUpdate",[b.a],Object.getOwnPropertyDescriptor(Oa.prototype,"performChangeListUpdate"),Oa.prototype),_()(Oa.prototype,"sortFn",[b.a],Object.getOwnPropertyDescriptor(Oa.prototype,"sortFn"),Oa.prototype),Oa);function Za(e){var t=function(e,t){if("object"!==Qe()(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!==Qe()(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Qe()(t)?t:String(t)}function $a(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var en=["description","end","start","status","summary","extendedProperties"],tn="syncTokens",an="calendarList",nn="MDCProp_",rn="isComplete",on="priority",sn="isStarred",ln="isArchived",un=["modifiedOffline"],cn=2,dn=3,hn=4,fn=6,pn=7,gn=8,mn=9,vn=10,yn=11,kn=12,_n=13,bn=14,wn=y.a.DefaultEventDuration,Sn=(Na=function(e){d()(a,e);var t=$a(a);function a(){var e;return i()(this,a),(e=t.call(this,y.a.PluginID.GCalendar,"c","Calendar",!1)).pluginMargin=4,e.pluginPadding=14,e._requiresOfflineAuth=!0,e._numEntriesSyncd=0,e._calendarList={},e.declareProperty("accountID",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,m.default.isDemoMode()),e.registerSetting("ImportCalendars","importCalendars","i",!0),e.registerSetting("ExportCalendar","exportCalendar","x",!0),e.registerSetting("WeeksPast","weeksPast","p",!0,1),e.registerSetting("WeeksFuture","weeksFuture","f",!0,4),e.registerSetting("DisplayOverdueInAgenda","displayOverdueInAgenda","o",!0,!1),e.registerSetting("SyncNewEvents","syncNewEvents","n",!0,!0),e.registerSetting("SyncDraggedEvents","syncDraggedEvents","d",!0,!0),e.registerSetting("SyncPopup","syncPopup","y",!0,!0),e.registerSetting("CreateLocalEvents","createLocalEvents","l",!0,!0),e._updateSyncTimes(),e.onCalendarsSynced=new et.a,e._eventCache=e.registerLocalCache(e.id,y.a.StorageType.IndexedDB,{metadataKeys:[tn,an],keyFieldsRN:["startTime","calendarID","modifiedOffline"]}),e._cacheCleanup=e.registerLowImpactTask("CacheCleanup",e._purgeOldData),e.declareProperty("isInvalid",y.a.PluginLoad.Runtime,!0,!1),m.default.isDemoMode()?e.declareProperty("calendarID",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!0,"me"):e.declareProperty("calendarID",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline),e.declareProperty("summary",y.a.PluginLoad.Preview|y.a.PluginLoad.Full),e.declareProperty("status",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,"confirmed"),e.declareProperty("startTime",y.a.PluginLoad.Preview|y.a.PluginLoad.Full),e.declareProperty("endTime",y.a.PluginLoad.Preview|y.a.PluginLoad.Full),e.declareProperty("allDayEvent",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,!1),e.declareProperty("recurringEventId",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0),e.declareProperty("eid",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0),e.declareProperty("isComplete",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,!1),e.declareProperty("isArchived",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,!1),e.declareProperty("isStarred",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,!1),e.declareProperty("priority",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,y.a.VMLIFlag.None),e.declareProperty("locked",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,!1),e.declareProperty("modifiedOffline",y.a.PluginLoad.Full,!0,!1),e.declareProperty("source",y.a.PluginLoad.Full,!0),e.declareProperty("location",y.a.PluginLoad.Full,!0),e.declareProperty("description",y.a.PluginLoad.Full,!0),e.declareProperty("attendees",y.a.PluginLoad.Full,!0),e.declareProperty("organizer",y.a.PluginLoad.Full,!0),e._pendingCreates={},e._syncingOfflineChanges=!1,e._hasInitializedTasks=!1,e._purgeOldDataTimeout=void 0,e._eventUpdateTimeout=void 0,e._eventUpdateQueue={},e._propConverter={},e._propConverter[rn]=m.default.parseDate,e._propConverter[ln]=m.default.parseBoolean,e._propConverter[sn]=m.default.parseBoolean,e._propConverter[on]=e.parsePriority,e}return s()(a,[{key:"getType",value:function(){return y.a.PluginType.Calendar}},{key:"_attachMetadataFields",value:function(){return un}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"useItemStore",value:function(){return"Google Calendar"}},{key:"itemStoreOptions",value:function(){return{listenToItemStateChanged:!0,enabledFilters:y.a.ItemStoreFilter.Dates}}},{key:"supportOfflineLoad",value:function(){return!0}},{key:"supportUsageCache",value:function(){return!0}},{key:"googleScopes",value:function(){return[y.a.GScope.Calendar]}},{key:"getDependencies",value:function(){return[y.a.PluginDependency.PremiumSub]}},{key:"hasSettingsError",value:function(){return!1}},{key:"verifyAuthorization",value:function(e){var t=this.googleScopes();return ee.a.isAuthorizedForScopes(e,t)}},{key:"getBlockedText",value:function(){return""}},{key:"computeBatchGroupID",value:function(e){var t="me";return e.data&&e.data.calendarId&&(t=e.data.calendarId),t}},{key:"_serializeDate",value:function(e){return e instanceof Date?e.toISOString():m.default.isNumber(e)?new Date(e).toISOString():e}},{key:"compactCacheField",value:function(e,t){var a;switch(t){case"startTime":case"endTime":a=this._serializeDate(e[t]);break;default:a=e[t]}return a}},{key:"_updateSyncTimes",value:function(){var e=-(this.getSetting(this.Settings.WeeksPast)||1),t=this.getSetting(this.Settings.WeeksFuture)||4;try{m.default.PAssert(800,m.default.isNumber(e)&&e<=0,"Invalid value for weeksPast: ",e)}catch(a){m.default.reportError(a)}try{m.default.PAssert(801,m.default.isNumber(t)&&t>=0,"Invalid valid for weeksFuture: ",t)}catch(a){m.default.reportError(a)}this._syncTokenDuration=m.default.weeks(10),this._minSyncStartTime=this._minDisplayStartTime=ze.a.getTodayPlusDays(7*e),this._maxSyncStartTime=this._maxDisplayStartTime=ze.a.getTodayPlusDays(7*t);try{m.default.PAssert(802,this._minDisplayStartTime.isBefore(this._maxDisplayStartTime),"Must have a valid start display date")}catch(a){m.default.reportError(a)}}},{key:"_shouldDisplayTime",value:function(e,t){return t>=this._minDisplayStartTime&&t<=this._maxDisplayStartTime||e>=this._minDisplayStartTime&&e<=this._maxDisplayStartTime}},{key:"_filterDates",value:function(e,t,a){return function(n){var r=new Date(n[e]);return r>=t&&r<=a}}},{key:"_purgeOldData",value:function(e){var t=this,a=this._minDisplayStartTime.clone().addDays(-1);this._eventCache.getFilterEntries((function(e){return new Date(e.endTime||e.startTime)<=a})).then((function(a){if(a){var n=0;m.default.log("Removing "+a.length+" old calendar entries.");for(var r=0;r<a.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t._eventCache.removeEntry(a[r].id)}}e&&e(!1)}))}},{key:"_offlineLoad",value:function(){var e,t=this;if(this.isEnabled()){var a=this._eventCache.getMetadata(an);m.default.isEmpty(this._calendarList)&&(this._calendarList=a||{});var n=this._filterDates("startTime",this._minDisplayStartTime,this._maxDisplayStartTime),r=this._eventCache.getPreloadData();if(r){try{m.default.PAssert(804,m.default.isObject(r),"Calendar preload is not object")}catch(i){m.default.reportError(i)}e=r,m.default.batchRenderUpdates((function(){bo.PaneUpdateBatcher.beginUpdateItems();var a=t.getDefaultItemStore(),r=a.getRoot();Object.keys(e).forEach((function(o){var s=e[o];if(n(s)){var l=t.createEntryFromLocal(s.id,s);t.cacheData(l.id,l,void 0,void 0,y.a.ChangeType.Auto);try{m.default.PAssert(803,!a.hasItem(l.id),"Load should never try to create a VMLI that has already been created")}catch(i){m.default.reportError(i)}if(t._eventNeedsItem(l)){if(l.source){var u=bo.pluginManager.parseEmailURL(l.source.url);if(u.plugin&&!u.plugin.hasCacheData(u.threadID)){var c=u.plugin.createEntryFromLocal(u.threadID,{accountID:u.accountID,subject:l.source.title});u.plugin.cacheData(u.threadID,c)}}var d=t._createItem(a,l,r.id);r.insertItem(d)}}})),bo.PaneUpdateBatcher.commitUpdateItems(),t._cacheCleanup.notifyWorkAvailable()}))}return!0}}},{key:"_activate",value:function(){}},{key:"_deactivate",value:function(){bo.PaneUpdateBatcher.beginUpdateItems(),this._hasInitializedTasks=!1,bo.PaneUpdateBatcher.updateAllItems(!0,!0),bo.PaneUpdateBatcher.commitUpdateItems()}},{key:"_load",value:function(){!m.default.isDemoMode()&&this.isEnabled()&&(this.createRecurringTask("CalendarListSync",{delay:m.default.hours(2),minDelay:m.default.hours(1),runOnCreate:!0,pauseWhileIdle:!0,async:!0,asyncTimeout:m.default.minutes(2),task:this.runCalendarListSync}),this.createRecurringTask("CalendarEventSync",{delay:m.default.minutes(15),minDelay:m.default.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:m.default.minutes(2),task:this.runCalendarSync}),this._hasInitializedTasks=!0)}},{key:"goOnline",value:function(){this._hasInitializedTasks&&this.getRecurringTask("CalendarEventSync").forceUpdate()}},{key:"handleTapClick",value:function(e,t,a,n){var r=this.getCacheData(a);if(r){var i=this.getAttachment(a).getField("calendarID"),o=this._getCalendarInfo(i);if(o)try{m.default.PAssert(805,o.accountID,"Should have an accountID on the calendar")}catch(l){m.default.reportError(l)}if(r.eid&&o.accountID){var s="https://www.google.com/calendar/event?eid="+r.eid+"&authuser="+o.accountID;m.default.isDemoMode()?bo.toasts.pushMessage(y.a.MessageID.DemoPluginClick):(bo.openUrl(s,n),this.sendEvent("Tap_OpenGCalendarDesktop"))}return!0}return!1}},{key:"_durationToString",value:function(e){var t=Math.round(e/6e4),a=0,n=0;t>0&&(t-=60*(a=Math.floor(t/60)),a>0&&(a-=24*(n=Math.floor(a/24))));var r="";return n>0&&(r+=n+"d "),a>0&&(r+=a+"h "),t>0&&(r+=t+"m "),r.trim()}},{key:"_createItemDateText",value:function(e){return e.allDayEvent?e.startTime.toString(bo.International.getFormat(y.a.DFormat.MonthDayYear)):e.startTime.toString(bo.International.getFormat(y.a.DFormat.DayYearTime))}},{key:"_createItemDurationText",value:function(e){var t,a=e.endTime-e.startTime;if(e.allDayEvent)if(a>m.default.days(1)){var n=e.endTime.clone();n.addMilliseconds(-1),t="until "+n.toString(bo.International.getFormat(y.a.DFormat.MonthDayYear))}else t="";else t=this._durationToString(a);return t}},{key:"_createItemSummaryText",value:function(e){var t;if(e.source&&e.source.url){var a=bo.pluginManager.parseEmailURL(e.source.url);a.plugin&&(t=a.plugin._getTextForItem({id:a.threadID}))}return t||(t=e.summary?e.summary.replace(/\u2000/g,""):""),t+" "+y.a.CharDate}},{key:"_createItemText",value:function(e){try{m.default.PAssert(806,e,"Must specify a valid attachment")}catch(t){m.default.reportError(t)}return this._createItemSummaryText(e)}},{key:"_eventNeedsItem",value:function(e){return"cancelled"!==e.status&&!e.isArchived}},{key:"mooDateFromCacheEntry",value:function(e){var t=!e.allDayEvent&&e.endTime-e.startTime||void 0;return new $e.a(new Date(e.startTime.getTime()),{gcalId:e.id,duration:t,gcalCalendar:e.calendarID})}},{key:"_createItem",value:function(e,t,a){var n;try{m.default.PAssert(807,this._eventNeedsItem(t),"Item must always be required to cause create")}catch(s){m.default.reportError(s)}m.default.isDateValid(t.isComplete)&&(n=t.isComplete);var r={date:this.mooDateFromCacheEntry(t).toData(),priority:t.priority,isComplete:!!t.isComplete,isArchived:t.isArchived,dateCompleted:n,isStarred:t.isStarred},i=e.createItem(t.id,this._createItemText(t),a,r,y.a.ChangeType.Auto);if(t.description){var o=e.createItem(t.id+"_note",t.description,i.id,{isNote:!0},y.a.ChangeType.Auto);i.setNote(o,y.a.ChangeType.Auto)}return i}},{key:"getRemoteAttachmentData",value:function(e){var t=this;if(e.hasField("calendarID")){var a=e.getField("calendarID"),n=this._getCalendarInfo(a);if(n)try{m.default.PAssert(809,n.accountID,"Should have an accountID on the calendar")}catch(o){m.default.reportError(o)}var r=ea.a.fns("calendar").events.get.packedFn,i={eventId:e.id,calendarId:a};n&&this._queueRemoteRequestMulti(n.accountID,r,i,(function(r){try{m.default.PAssert(810,!r||r.id===e.id,"If valid result, attachment should match remote event ID")}catch(o){m.default.reportError(o)}if(r){var i=t._addRemoteEntry(n.accountID,a,r);t._eventCache.saveEntry(t.serializeExternalData(i))}}),(function(){e.notifyDataRequestFailed()}),e,fn)}else bo.settings.fixedMissingCalendars.get()?e.isLoaded()&&e.updateField("status","cancelled"):(this.needsFixMissingData||(this.needsFixMissingData=[]),this.needsFixMissingData.push(e),m.default.timeoutOnce("fixcalendar",this.fixMissingCalendars,5e3,(function(){return t.needsFixMissingData=void 0}),this.needsFixMissingData))}},{key:"_createRemoteEntry",value:function(e,t,a){var n,r,i,o=!1;try{m.default.PAssert(811,a.start,"Must always have valid start date",Object.keys(a))}catch(c){m.default.reportError(c)}if(a.start)if(a.start.dateTime){try{m.default.PAssert(812,a.end.dateTime,"End date format should always match start")}catch(c){m.default.reportError(c)}n=new Date(a.start.dateTime),r=new Date(a.end.dateTime)}else if(a.start.date){try{m.default.PAssert(813,a.end.date,"End date format should always match start")}catch(c){m.default.reportError(c)}var s=a.start.date.split("-"),l=a.end.date.split("-");n=new Date(s[0],s[1]-1,s[2]),r=new Date(l[0],l[1]-1,l[2]),o=!0}a.htmlLink&&(i=a.htmlLink.split("?eid=")[1]);var u={id:a.id,accountID:e,calendarID:t,status:a.status,summary:a.summary,startTime:n,endTime:r,allDayEvent:o,recurringEventId:a.recurringEventId,eid:i,isComplete:this._getRemoteProperty(a,rn),isArchived:this._getRemoteProperty(a,ln),isStarred:this._getRemoteProperty(a,sn),priority:this._getRemoteProperty(a,on),locked:a.locked||!1,attendees:a.attendees,location:a.location,description:a.description,organizer:a.organizer?a.organizer.displayName||a.organizer.email||a.organizer.id:"Unknown"};return a.source&&(u.source={title:a.source.title,url:a.source.url}),u}},{key:"_addRemoteEntry",value:function(e,t,a){var n=this._createRemoteEntry(e,t,a);return this.cacheData(n.id,n),n}},{key:"createEntryFromLocal",value:function(e,t){return t.startTime=t.startTime?new Date(t.startTime):void 0,t.endTime=t.endTime?new Date(t.endTime):void 0,t.isComplete=this._propConverter[rn](t.isComplete),t.isArchived=this._propConverter[ln](t.isArchived),t.isStarred=this._propConverter[sn](t.isStarred),t.priority=this._propConverter[on](t.priority),t}},{key:"_notifyFailedRequest",value:function(e,t){e&&e.error&&!e.isInvalidToken&&"Invalid Credentials"!==e.error.message&&(e.error.code===y.a.HTTPStatusCode.Unauthorized?(m.default.log("LostPermission",t,e),bo.toasts.pushMessage(y.a.MessageID.LostPermission)):e.error.code>=400&&e.error.code<500&&m.default.log("Failed GCalendar request",e.error.code,e))}},{key:"_getRemoteProperty",value:function(e,t){try{m.default.PAssert(814,e,"Must provide valid event info")}catch(n){m.default.reportError(n)}try{m.default.PAssert(815,t,"Must provide valid remote prop")}catch(n){m.default.reportError(n)}try{m.default.PAssert(816,this._propConverter[t],"Missing prop converter: ",t)}catch(n){m.default.reportError(n)}var a;return e.extendedProperties&&e.extendedProperties.private&&(a=e.extendedProperties.private[nn+t]),this._propConverter[t]&&(a=this._propConverter[t](a)),a}},{key:"_updateAttachFromData",value:function(e,t){var a=[];for(var n in t)t.hasOwnProperty(n)&&e.isFieldDefined(n)&&(e.updateField(n,t[n]),a.push(n));return a}},{key:"_runRemoteUpdate",value:function(e,t,a,n,r,i){var o,s,l,u,c=arguments,d=this;try{m.default.PAssert(817,!e.getField("locked"),"Should never try to modify an event that is locked")}catch(p){m.default.reportError(p)}try{m.default.PAssert(818,m.default.isBoolean(t)||m.default.isArray(t),"Must specify a boolean or list of fields for modified value")}catch(p){m.default.reportError(p)}try{m.default.PAssert(819,m.default.isFunction(n),"Must provide a valid localDoneCB")}catch(p){m.default.reportError(p)}try{m.default.PAssert(820,m.default.isFunction(r),"Must provide a valid remoteDoneCB")}catch(p){m.default.reportError(p)}try{m.default.PAssert(821,m.default.isFunction(i),"Must provide a valid allDoneCB")}catch(p){m.default.reportError(p)}var h=function(e,t,a){try{m.default.PAssert(822,m.default.isFunction(e),"Must supply a valid CB function")}catch(p){m.default.reportError(p)}try{m.default.PAssert(823,void 0!==t,"Must always pass success back from CB")}catch(p){m.default.reportError(p)}if(e.apply(d,Array.prototype.slice.call(c,1)),e===n){try{m.default.PAssert(824,void 0===o,"Local CB called twice")}catch(p){m.default.reportError(p)}o=t,l=a}else if(e===r){try{m.default.PAssert(825,void 0===s,"Remote CB called twice")}catch(p){m.default.reportError(p)}s=t,u=a}void 0!==o&&void 0!==s&&i(o,s,l,u)},f=this.getCacheData(e.id);try{m.default.PAssert(826,f,"Performing update on event that does not have local data")}catch(p){m.default.reportError(p)}f?(this.addModifiedOffline(f,t),this._eventCache.saveEntry(this.serializeExternalData(f)),a((function(a,i){if(a){var o=d.getCacheData(e.id),s=!0!==t&&t;d.removeModifiedOffline(o,s),d._eventCache.saveEntry(d.serializeExternalData(o)),h(r,!0)}else h(n,!1),h(r,!1,i)}))):(h(n,!1),h(r,!1))}},{key:"_updateEvent",value:function(e,t,a,n,r,i){var o=this,s=this._updateAttachFromData(e,t);this._runRemoteUpdate(e,s,(function(n){o._updateRemoteEvent(e.getField("calendarID"),e.id,t,a,n)}),n,r,i)}},{key:"_updateRemoteEvent",value:function(e,t,a,n,r){var i=this;try{m.default.PAssert(827,this.hasWritePermissionForCalendar(e),"Should not be calling _updateRemoteEvent for a read-only calendar")}catch(c){m.default.reportError(c)}var o=this._createEventUpdateInfo(a),s=this._getCalendarInfo(e);try{m.default.PAssert(828,s,"Missing calendar "+e)}catch(c){m.default.reportError(c)}if(s){try{m.default.PAssert(829,s.accountID,"Should have an accountID on the calendar")}catch(c){m.default.reportError(c)}var l=ea.a.fns("calendar").events.patch.packedFn,u={calendarId:e,eventId:t,resource:o};this._queueRemoteRequestMulti(s.accountID,l,u,(function(){r(!0)}),(function(a){if(a&&a.error&&a.error.code===y.a.HTTPStatusCode.NotFound)i._eventCache.removeEntry(t),r(!0);else{var n=Object.keys(o);if(m.default.log("Failed Update: ",e,t,n),m.default.isHTTPStatusCode(a,y.a.HTTPStatusCode.Forbidden)&&!i.isRateLimitError(a)){var s=i.getCacheData(t);s&&(s.locked=!0),i.cacheData(t,s,!0,["locked"])}r(!1,a),i._notifyFailedRequest(a,e)}}),void 0,gn||n)}}},{key:"_updateRemoteProperty",value:function(e,t,a,n,r,i){var o=this;e.updateField(t,a);var s={},l=void 0===a?null:a;s[nn+t]=l;var u={extendedProperties:{private:s}};this._runRemoteUpdate(e,[t],(function(t){o._updateRemoteEvent(e.getField("calendarID"),e.id,u,dn,t)}),n,r,i)}},{key:"_getStartEndFromDateInfo",value:function(e,t){var a,n,r,i=!1;if(e instanceof Date)e.hasTimeOfDay()||(i=!0),a=e,n=e.clone().addMilliseconds(t);else if(e instanceof $e.a)a=e.getStart(),n=e.getEnd(),r=e.toICal();else try{m.default.PAssert(830,!1,"Should always have a valid date")}catch(o){m.default.reportError(o)}return{startTime:a,endTime:n,allDayEvent:i,recurrence:r}}},{key:"deleteCalendarEventForItem",value:function(e,t,a,n,r){var i=this;this.sendEvent("DeleteEvent");this._runRemoteUpdate(t,["status"],(function(a){e.getMooDate().removeGCal(),e.getDocumentOwner()&&(e.onMooDateUpdated(y.a.ChangeType.Local,!0),e.onAttachInlineUpdate()),t.isLocalOnlyAttachment()?(t.updateField("status","cancelled"),a(!0)):i.deleteCalendarEvent(t,a)}),a,n,r)}},{key:"deleteCalendarEvent",value:function(e,t){var a=this;try{m.default.PAssert(831,!e.isLocalOnlyAttachment(),"Should never make a remote request to delete a local-only event")}catch(u){m.default.reportError(u)}var n=e.getField("calendarID"),r=this._getCalendarInfo(n);try{m.default.PAssert(832,n&&r,"Tried to delete calendar event with no calendar")}catch(u){m.default.reportError(u)}if(r){try{m.default.PAssert(833,r.accountID,"Should have an accountID on the calendar")}catch(u){m.default.reportError(u)}var i=e.id,o=ea.a.fns("calendar").events.delete.packedFn,s={calendarId:n,eventId:i},l=function(){var n=a.getDefaultItemStore();e.updateField("status","cancelled"),e.forEachItem(n,(function(e){e.parent()&&(e.parent().removeChild(e,y.a.ChangeType.Local),e.setParent(void 0))})),e.getData()?a._eventCache.saveEntry(a.serializeExternalData(e.getData())):a._eventCache.removeEntry(i),t(!0)};this._queueRemoteRequestMulti(r.accountID,o,s,(function(){l()}),(function(n){n&&n.error&&n.error.code===y.a.HTTPStatusCode.Gone||n&&n.error&&n.error.code===y.a.HTTPStatusCode.NotFound?l():(t(!1,n),a._notifyFailedRequest(n,e.getField("calendarID")))}),void 0,vn)}else t(!0)}},{key:"forceRemoteEventSync",value:function(e){if(!m.default.isDemoMode()&&this._hasInitializedTasks){if(e&&this._eventCache.setMetadata(tn,{}),this.hasRecurringTask("CalendarEventSync"))this.getRecurringTask("CalendarEventSync").forceUpdate();if(this.hasRecurringTask("CalendarListSync"))this.getRecurringTask("CalendarListSync").forceUpdate()}}},{key:"getDefaultExportCalendarID",value:function(){return m.default.isDemoMode()?"DemoCal":this.getSetting(this.Settings.ExportCalendar)}},{key:"isExportCalendarID",value:function(e){return this.getSetting(this.Settings.ExportCalendar)===e}},{key:"hasWritePermissionForAttach",value:function(e){var t=!1,a=e.getField("calendarID"),n=this._getCalendarInfo(a);return n&&("writer"!==n.accessRole&&"owner"!==n.accessRole||(t=!0)),t}},{key:"hasWritePermissionForCalendar",value:function(e){var t=!1,a=this._getCalendarInfo(e);return a&&("writer"!==a.accessRole&&"owner"!==a.accessRole||(t=!0)),t}},{key:"getCalendarBackgroundColor",value:function(e){var t="rgba(0, 120, 255, 0.75)",a=this._getCalendarInfo(e);return a&&a.backgroundColor&&(t=a.backgroundColor),t}},{key:"getCalendarForegroundColor",value:function(e){var t="#000000",a=this._getCalendarInfo(e);return a&&a.foregroundColor&&(t=a.foregroundColor),t}},{key:"getCalendarDisplayProps",value:function(e){var t,a=this._getCalendarInfo(e);return a&&"reader"===a.accessRole&&(t={style:{backgroundImage:"url(/img/stripe.png)",backgroundRepeat:"repeat"}}),t}},{key:"shouldDisplayOverdueInAgenda",value:function(){return this.getSetting(this.Settings.DisplayOverdueInAgenda)}},{key:"createEventForEmail",value:function(e,t,a,n,r,i){var o=this;try{m.default.PAssert(834,m.default.isString(e),"Must provide a valid calendarID for email")}catch(l){m.default.reportError(l)}try{m.default.PAssert(835,m.default.isString(t),"Must provide a valid subject")}catch(l){m.default.reportError(l)}try{m.default.PAssert(836,m.default.isString(a),"Must provide a valid email url")}catch(l){m.default.reportError(l)}try{m.default.PAssert(837,m.default.isDateValid(n),"Must provide a valid schedule date")}catch(l){m.default.reportError(l)}try{m.default.PAssert(838,m.default.isNumber(r),"Must provide a valid event duration")}catch(l){m.default.reportError(l)}this.sendEvent("AddEmailEvent");var s={duration:r,summary:t,date:n,source:{title:t,url:a}};this.createNewCalendarEvent(e,s,(function(e){if(e){var t=o.getDefaultItemStore();if(!t.hasItem(e.id)){bo.PaneUpdateBatcher.beginUpdateItems();var a=t.getRoot(),n=o._createItem(t,e,a.id);a.insertItem(n),bo.PaneUpdateBatcher.commitUpdateItems()}}}),m.default.newEmptyFn(),i)}},{key:"createEventForItem",value:function(e,t){!e.hasPluginAttachment(this.id)&&e.getNextDate()&&((t=t||this.getDefaultExportCalendarID())?e.getDate()?(this.sendEvent("AddSingleEvent"),this.newCalendarEventForItem(t,e,(function(e,t,a,n){e||t?t||n&&n.error&&-1===n.error.code?bo.onIntroAction("AddCalendar"):bo.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:y.a.MessageAction.Okay}):a&&!1===a.isValid?bo.toasts.pushMessage({text:"The event you are trying to create is not valid.",action:y.a.MessageAction.Okay}):bo.toasts.pushMessage({text:'There was an error creating your calendar event. There may be a problem with your authorization. Please try toggling your "Save To" calendar off and back on, or try toggling the Google Calendar plugin off and on. Contact support@moo.do if you have questions',action:y.a.MessageAction.OpenCalendarSettings})}))):(this.sendEvent("AddRepeatEvent"),bo.toasts.pushMessage({text:"Moo.do does not currently support adding repeated dates to Google Calendar.",action:y.a.MessageAction.Okay})):bo.toasts.pushMessage({text:"Please select a valid Google Calendar to save your events to.",action:y.a.MessageAction.OpenCalendarSettings}))}},{key:"newCalendarEventForItem",value:function(e,t,a){var n=this;try{m.default.PAssert(839,t,"Must provide a valid item")}catch(s){m.default.reportError(s)}try{m.default.PAssert(840,t.getNextDate(),"Item must have a valid date")}catch(s){m.default.reportError(s)}try{m.default.PAssert(841,!t.hasPluginAttachment(y.a.PluginID.GCalendar),"Must not already have a valid calendar attachment associated with the item")}catch(s){m.default.reportError(s)}var r=t.getDuration();r||(r=t.allDayDate()?m.default.days(1):wn);var i={duration:r,summary:t.getCalendarParsedText()};if(t.getDate()&&(i.date=t.getDate()),t.hasNote()&&(i.description=t.getNote().getParsedText()),t.hasAttachmentType(y.a.PluginType.Email)){var o=t.getAttachmentByType(y.a.PluginType.Email);i.source={title:o.getField("subject"),url:o.getPlugin().getURLForAttachment(o)}}this.createNewCalendarEvent(e,i,(function(e){if(e)if(t.isDestroyed()){var a=n.getDefaultItemStore();if(!a.hasItem(e.id)){bo.PaneUpdateBatcher.beginUpdateItems();var r=a.getRoot(),i=n._createItem(a,e,r.id);r.insertItem(i),bo.PaneUpdateBatcher.commitUpdateItems()}}else t.getMooDate().setGCalIdAndCalendar(e.id,e.calendarID),t.onMooDateUpdated(y.a.ChangeType.Local,!0),t.setTextToWhatItAlreadyIs(y.a.ChangeType.Local)}),m.default.newEmptyFn(),a)}},{key:"createNewCalendarEvent",value:function(e,t,a,n,r){var i=this;try{m.default.PAssert(843,t,"Must have valid event info passed in")}catch(d){m.default.reportError(d)}try{m.default.PAssert(844,t.date,"Must have valid date for event")}catch(d){m.default.reportError(d)}try{m.default.PAssert(845,void 0!==t.duration,"Must have a valid event duration")}catch(d){m.default.reportError(d)}try{m.default.PAssert(846,t.summary,"Must have a valid event summary")}catch(d){m.default.reportError(d)}try{m.default.PAssert(847,m.default.isFunction(a),"Must supply a valid local done CB")}catch(d){m.default.reportError(d)}try{m.default.PAssert(848,m.default.isFunction(n),"Must supply a valid remote done CB")}catch(d){m.default.reportError(d)}var o=m.default.generateTempId(),s=this._getStartEndFromDateInfo(t.date,t.duration),l=this._getCalendarInfo(e);if(l){try{m.default.PAssert(849,l.accountID,"Should have an accountID on the calendar")}catch(d){m.default.reportError(d)}var u={id:o,accountID:l.accountID,calendarID:e,status:"confirmed",summary:t.summary,source:t.source,description:t.description,startTime:s.startTime,endTime:s.endTime,allDayEvent:s.allDayEvent,recurrence:s.recurrence,organizer:l.accountID,modifiedOffline:!0};this.cacheData(o,u),this._eventCache.saveEntry(u),a(u,!0);var c=this.getAttachment(u.id);m.default.isDemoMode()?(n(!0),r(!0,!0)):this._runRemoteUpdate(c,!0,(function(t){i._createRemoteEventFromCacheData(l.accountID,e,u,m.default.newEmptyFn(),t,r)}),m.default.newEmptyFn(),n,(function(){i.getDefaultItemStore().updateItems()}))}}},{key:"_createRemoteEventFromCacheData",value:function(e,t,a,n,r,i){var o,s,l,u,c=arguments,d=this;try{m.default.PAssert(850,!this._pendingCreates[a.id],"Should never try and double create a calendar event")}catch(f){m.default.reportError(f)}this._pendingCreates[a.id]=!0;var h=function(e,t,a){try{m.default.PAssert(851,m.default.isFunction(e),"Must supply a valid CB function")}catch(f){m.default.reportError(f)}try{m.default.PAssert(852,void 0!==t,"Must always pass success back from CB")}catch(f){m.default.reportError(f)}if(e.apply(d,Array.prototype.slice.call(c,1)),e===n){try{m.default.PAssert(853,void 0===o,"Local CB called twice")}catch(f){m.default.reportError(f)}o=t,l=a}else if(e===r){try{m.default.PAssert(854,void 0===s,"Remote CB called twice")}catch(f){m.default.reportError(f)}s=t,u=a}void 0!==o&&void 0!==s&&i(o,s,l,u)};this._createNewRemoteEvent(t,a,(function(i,o){delete d._pendingCreates[a.id],bo.PaneUpdateBatcher.beginUpdateItems();var s=d.getAttachment(a.id);if(i){var l=a.id;d.changeID(s,s.id,i.id);var u=d.getDefaultItemStore(),c=u.getRoot();u.hasItem(l)&&u.destroyItem(l),d._eventCache.removeEntry(l);var f=d._addRemoteEntry(e,t,i),p=d._createItem(u,f,c.id);c.insertItem(p),d._eventCache.saveEntry(d.serializeExternalData(f)),h(n,!0),s.updateField("isInvalid",!1),h(r,!0)}else s.updateField("isInvalid",!0),h(n,!1),h(r,!1,o);bo.PaneUpdateBatcher.commitUpdateItems()}))}},{key:"_createNewRemoteEvent",value:function(e,t,a){var n=this;try{m.default.PAssert(855,t,"Must specify valid event info")}catch(u){m.default.reportError(u)}try{m.default.PAssert(856,t.startTime instanceof Date,"Must have a valid start time")}catch(u){m.default.reportError(u)}try{m.default.PAssert(857,t.endTime instanceof Date,"Must have a valid end time")}catch(u){m.default.reportError(u)}try{m.default.PAssert(858,t.summary,"Must have a valid event title")}catch(u){m.default.reportError(u)}var r,i,o=this._getCalendarInfo(e);try{m.default.PAssert(859,o.accountID,"Should have an accountID on the calendar")}catch(u){m.default.reportError(u)}t.allDayEvent?(r={date:t.startTime.toString("yyyy-MM-dd")},i={date:t.endTime.toString("yyyy-MM-dd")}):(r={dateTime:t.startTime.toISOString()},i={dateTime:t.endTime.toISOString()});var s=ea.a.fns("calendar").events.insert.packedFn,l={calendarId:e,resource:{start:r,end:i,recurrence:t.recurrence,summary:t.summary,description:t.description,status:t.status,source:t.source}};this._queueRemoteRequestMulti(o.accountID,s,l,(function(e){a(e)}),(function(t){a(void 0,t),n._notifyFailedRequest(t,e)}),void 0,pn)}},{key:"getImportCalendarList",value:function(){var e=this,t=this.getSetting(this.Settings.ImportCalendars);return t?t.filter((function(t){return e.hasSyncAccount(t.accountID,!0)})):[]}},{key:"getReadableCalendarList",value:function(e){return this._getCalendarList("reader",e)}},{key:"getWritableCalendarList",value:function(e){return this._getCalendarList("writer",e)}},{key:"getWritableCalendarListSync",value:function(e){var t=this.getImportCalendarList();return t?t.filter((function(t){return(!e||t.accountID===e||!t.accountID&&e===ee.a.getDefaultAccountID())&&("writer"===t.accessRole||"owner"===t.accessRole)})):[]}},{key:"getFullCalendarList",value:function(e){var t=this,a=this.getImportCalendarList();this.getReadableCalendarList((function(n){if(a&&n){var r=a.map((function(e){var t=m.default.clone(e);return t.accessRole="none",t})).filter((function(e){if(t.hasSyncAccount(e.accountID)){for(var a=0,r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(n[r].id===e.id)return!1}return!0}}));n.pushArray(r)}e(n)}))}},{key:"createCalendar",value:function(e,t,a){var n=this,r=ea.a.fns("calendar").calendars.insert.packedFn,i={resource:{summary:t}};this._queueRemoteRequestMulti(e,r,i,(function(e){a(e)}),(function(e){a(),n._notifyFailedRequest(e,void 0)}),void 0,yn,{}),this.sendEvent("CreateCalendar")}},{key:"_getCalendarList",value:function(e,t){var a=this.getSyncAccounts(),n=a.length,r=[],i=function(e){if(n--,e&&(r=m.default.arrayUniques(r.concat(e))),0===n){var a={};r=r.filter((function(e,t){var n=r.find((function(a,n){return t!==n&&a.id===e.id}));return n&&a[e.backgroundColor]&&(e.backgroundColor=n.backgroundColor),a[e.backgroundColor]=!0,!n||"owner"===e.accessRole||"owner"!==n.accessRole})),t(r)}};if(0===a.length)t([]);else for(var o=0,s=0;s<a.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;this._getCalendarListForAccount(a[s],e,i)}}},{key:"_getCalendarListForAccount",value:function(e,t,a){var n=this,r=ea.a.fns("calendar").calendarList.list.packedFn,i={minAccessRole:t,userId:"me"};this._queuePagedRemoteRequestMulti(e,r,i,(function(t){t=t.map((function(t){return t.accountID=e,t})),a(t)}),(function(e){n._notifyFailedRequest(e,void 0),a([])}),void 0,hn,{getAllPages:!0,timeoutMS:0})}},{key:"handleEventUpdate",value:function(e,t,a){this._numEntriesSyncd++;var n=this.getDefaultItemStore();if("cancelled"===a.status){if(this.hasAttachment(a.id)){var r=this.getAttachment(a.id);r.getField("calendarID")===t&&(this._eventCache.removeEntry(a.id),this.hasCacheData(a.id)&&(r.updateField("status","cancelled"),r.forEachItem(n,(function(e){e.parent()&&(e.parent().removeChild(e,y.a.ChangeType.Remote),e.setParent(void 0))}))))}}else{var i=this.getCacheData(a.id),o=this._createRemoteEntry(e,t,a);i&&i.modifiedOffline&&this._mergeEventData(i,o),this.cacheData(o.id,o),this._eventCache.saveEntry(this.serializeExternalData(o),this.compareCachedData);var s=n.getRoot(),l=this.getAttachment(a.id);this._beginIgnorePropertyChanges();try{this.updateVMLIsFromUpdate(l,i,o)}catch(c){m.default.reportError(c)}if(this._endIgnorePropertyChanges(),!n.hasItem(o.id)&&this._shouldDisplayTime(o.startTime,o.endTime)&&this._eventNeedsItem(o)){var u=this._createItem(n,o,s.id);s.insertItem(u)}}}},{key:"compareCachedData",value:function(e,t){return this._propertySets[y.a.PluginLoad.Full].some((function(a){var n=e[a];return"endTime"===a&&(n=m.default.isString(n)?new Date(n):n),(n||t[a])&&!m.default.deepEqual(n,t[a])}))}},{key:"_mergeEventData",value:function(e,t){var a=0;try{m.default.PAssert(862,e.modifiedOffline,"Should only merge events that were locally modified")}catch(o){m.default.reportError(o)}var n=e.modifiedOffline;try{m.default.PAssert(863,m.default.isArray(n),"Should not be receiving an update for an event that was created locally")}catch(o){m.default.reportError(o)}for(var r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=n[r];0,t[i]=e[i]}t.modifiedOffline=e.modifiedOffline}},{key:"updateVMLIsFromUpdate",value:function(e,t,a){var n=this;try{m.default.PAssert(864,e,"Must provide a valid attachment")}catch(r){m.default.reportError(r)}try{m.default.PAssert(865,a,"Must provide valid new data")}catch(r){m.default.reportError(r)}if(t)e.forEachItem(void 0,(function(e){e.getParsedText();if(e.belongsToItemStore(bo.itemStoreManager.getTempItemStore()),t.summary!==a.summary&&!e.hasAttachmentType(y.a.PluginType.Email)){var r=a.summary?a.summary.replace(/\u2000/g,""):"",i=e.getPrefix()+r+" "+y.a.CharDate;e.setText(i,y.a.ChangeType.Remote)}var o=n.mooDateFromCacheEntry(a);if(e.setMooDate(o,y.a.ChangeType.Remote,["gcalCalendar","gcalId","duration"]),t.description!==a.description&&e.belongsToItemStore(n.getDefaultItemStore()))if(e.hasNote())a.description?e.getNote().setText(a.description,y.a.ChangeType.Remote):e.setNote(void 0,y.a.ChangeType.Remote);else if(a.description){var s,l=a.id+"_note";n.getDefaultItemStore().hasItem(l)?(s=n.getDefaultItemStore().getItem(l)).setText(a.description,y.a.ChangeType.Remote):s=n.getDefaultItemStore().createItem(l,a.description,e.id,{isNote:!0},y.a.ChangeType.Remote),e.setNote(s,y.a.ChangeType.Remote)}n.areDatesEqual(t.isComplete,a.isComplete)||e.setComplete(!!a.isComplete,y.a.ChangeType.Remote),t.isArchived!==a.isArchived&&e.setArchived(a.isArchived),t.isStarred!==a.isStarred&&e.setStarred(a.isStarred,y.a.ChangeType.Remote),t.priority!==a.priority&&e.setPriority(a.priority,y.a.ChangeType.Remote)}));else{this._createItemText(a);e.forEachItem(void 0,(function(e){e.setTextToWhatItAlreadyIs(y.a.ChangeType.Remote)}))}}},{key:"setSyncToken",value:function(e,t){try{m.default.PAssert(866,m.default.isString(e),"Must provide a valid calendar ID to clear sync token for")}catch(r){m.default.reportError(r)}try{m.default.PAssert(867,m.default.isString(t),"Must provide a valid calendar ID to clear sync token for")}catch(r){m.default.reportError(r)}var a=this._eventCache.getMetadata(tn)||{},n=Date.now()+this._syncTokenDuration;a=Object.assign({},a,Z()({},e,{token:t,date:Date.now(),expires:n})),this._eventCache.setMetadata(tn,a)}},{key:"clearSyncToken",value:function(e){try{m.default.PAssert(868,m.default.isString(e),"Must provide a valid calendar ID to clear sync token for")}catch(n){m.default.reportError(n)}var t=this._eventCache.getMetadata(tn);if(t){t[e];var a=Q()(t,[e].map(Za));this._eventCache.setMetadata(tn,a)}}},{key:"clearCalendarEventCache",value:function(e,t){var a=this;try{m.default.PAssert(869,m.default.isString(e),"Must provide a valid calendar ID to clear event cache for")}catch(n){m.default.reportError(n)}this._eventCache.getFilterEntries((function(t){return t.calendarID===e})).then((function(e){if(e){for(var n=0,r=0;r<e.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;a._eventCache.removeEntry(e[r].id)}t&&t(!0)}else t&&t(!1)}))}},{key:"_calendarSyncComplete",value:function(e,t){if(t.length>0){if(ne.a.notifySyncError(t),this.isOnline())for(var a=0,n=0;n<t.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=t[n];r.result!==y.a.SyncResult.FailureNetwork&&r.result!==y.a.SyncResult.Success&&bo.toasts.pushMessage(y.a.MessageID.CalendarSync)}}else ne.a.notifySyncError(void 0),bo.toasts.clearMessage(y.a.MessageID.CalendarSync);var i=this.getSetting(this.Settings.ExportCalendar);if(i){for(var o=0,s=!1,l=0;l<t.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(t[l].id===i){s=!0;break}}s||this._syncOfflineChanges(this._notifyOfflineSyncFailures)}e.length>0&&this.onCalendarsSynced.notify()}},{key:"_shouldExpireToken",value:function(e){var t=!0;return e&&(e.expires?t=e.expires<Date.now():e.date&&(t=e.date+this._syncTokenDuration<Date.now())),t}},{key:"_getCalendarInfo",value:function(e){return this._calendarList[e]}},{key:"allowTextEditing",value:function(e,t){var a=t.getField("calendarID");return this.hasWritePermissionForCalendar(a)||t.isLocalOnlyAttachment()}},{key:"_createCalendarFromRemote",value:function(e){var t={id:e.id,accountID:e.accountID,summary:e.summary,accessRole:e.accessRole};return m.default.isValidColor(e.backgroundColor)&&(t.backgroundColor=e.backgroundColor),m.default.isValidColor(e.foregroundColor)&&(t.foregroundColor=e.foregroundColor),t}},{key:"runCalendarListSync",value:function(e){var t=this;this.getReadableCalendarList((function(a){if(a){var n=0;0,t._calendarList={};for(var r=0;r<a.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=a[r];t._calendarList[i.id]=t._createCalendarFromRemote(i)}bo.toasts.clearMessage(y.a.MessageID.CalendarSync);var o=t.getDefaultExportCalendarID();o&&!t._calendarList[o]&&(t.setSetting(t.Settings.ExportCalendar,void 0),bo.toasts.pushMessage({text:"Your Default Save calendar is no longer accessible. Please select another or update your sync accounts.",action:y.a.MessageAction.OpenCalendarSettings})),t._eventCache.setMetadata(an,t._calendarList)}else t.isOnline()&&bo.toasts.pushMessage(y.a.MessageID.CalendarSync);e&&e()}))}},{key:"_notifyTokenExpired",value:function(e){this._purgeOldDataTimeout&&clearTimeout(this._purgeOldDataTimeout),this._purgeOldDataTimeout=setTimeout(this._purgeOldData,0)}},{key:"_notifyCalendarUnsyncd",value:function(e){m.default.log("Detected calendar "+e+" is no longer syncd"),this._clearCachedData(e,(function(t){t||m.default.log("Failure unsyncing calendar "+e)})),this._clearCalendarItems(e)}},{key:"_clearCalendarItems",value:function(e){var t=this.getDefaultItemStore();bo.PaneUpdateBatcher.beginUpdateItems(),t.forEach((function(a){a.hasAttachments()&&(a.getAttachment(0).getField("calendarID")===e&&t.destroyItem(a.id))})),bo.PaneUpdateBatcher.commitUpdateItems()}},{key:"_getSyncResultFromResult",value:function(e,t){var a=y.a.SyncResult.Success;if(t&&t.error&&t.error.code){var n=t.error.code;if(n===y.a.HTTPStatusCode.Unauthorized){var r=this._getCalendarInfo(e);a=r&&"owner"===r.accessRole?y.a.SyncResult.FailureOAuth:r&&"writer"===r.accessRole?y.a.SyncResult.FailureNoWrite:y.a.SyncResult.FailureNoRead}else a=n===y.a.HTTPStatusCode.NotFound?y.a.SyncResult.FailureNoRead:n===y.a.HTTPStatusCode.Network?y.a.SyncResult.FailureNetwork:n===y.a.HTTPStatusCode.Forbidden?y.a.SyncResult.FailureNoRead:y.a.SyncResult.FailureUnknown}return a}},{key:"runCalendarSync",value:function(e,t){var a=this,n=0,r=0,i=[],o=[],s=function(t,s,l){try{m.default.PAssert(870,r<n,"Should never have more calendars syncd than we tried to sync")}catch(u){m.default.reportError(u)}t?i.push({id:s,result:y.a.SyncResult.Success}):o.push({id:s,result:a._getSyncResultFromResult(s,l)}),++r===n&&(a._calendarSyncComplete(i,o),e&&e())},l=this._eventCache.getMetadata(tn);this._updateSyncTimes();var u=this.getImportCalendarList();if(u&&u.length>0){var c=0;n=u.length;for(var d=0;d<u.length;++d){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var h=u[d];m.default.isObject(h)||(h={id:u[d]});var f=l?l[h.id]:void 0,p=void 0;this._shouldExpireToken(f)?(this._notifyTokenExpired(h.id),p=void 0):p=f.token,this.performCalendarSync(h,p,s,t)}for(var g in l)if(l.hasOwnProperty(g)){for(var v=0,k=!1,_=0;_<u.length;++_){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;var b=u[_];if(m.default.isObject(b)||(b={id:u[_]}),b.id===g){k=!0;break}}k||this._notifyCalendarUnsyncd(g)}}else this._clearAllData(),this._calendarSyncComplete([],[]),e&&e()}},{key:"performCalendarSync",value:function(e,t,a,n){var r=this,i=e.id,o=e.accountID;try{m.default.PAssert(871,m.default.isString(i),"Must provide a valid calendar ID for each sync op")}catch(c){m.default.reportError(c)}if(!o){var s=this._getCalendarInfo(e.id);s&&(o=s.accountID),o||(o=ee.a.getDefaultAccountID())}var l=ea.a.fns("calendar").events.list.packedFn,u={calendarId:i,singleEvents:!0};n||(t?u.syncToken=t:(u.timeMin=this._minSyncStartTime.toISOString(),u.timeMax=this._maxSyncStartTime.toISOString()));this._queuePagedRemoteRequestMulti(o,l,u,(function(e,t,n){var s,l=0;n&&(s=n.nextSyncToken,r.setSyncToken(i,s)),bo.PaneUpdateBatcher.beginUpdateItems();for(var u=0;u<e.length;++u){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;r.handleEventUpdate(o,i,e[u])}bo.PaneUpdateBatcher.commitUpdateItems(),a(!0,i)}),(function(t){t&&t.error&&t.error.code===y.a.HTTPStatusCode.Gone?r._clearCachedData(i,(function(o){o?r.performCalendarSync(e,void 0,a,n):a(!1,i,t)})):(a(!1,i,t),r._notifyFailedRequest(t,i))}),void 0,cn,{getAllPages:!0,timeoutMS:0})}},{key:"_createEventUpdateInfo",value:function(e){var t={};for(var a in e)e.hasOwnProperty(a)&&en.indexOf(a)>=0&&(t[a]=e[a]);return t}},{key:"_notifyOfflineSyncFailures",value:function(e,t,a){t>0&&(ne.a.notifySyncError(a),m.default.log("Failed to sync offlineChanges: ",t))}},{key:"_syncOfflineChanges",value:function(e){var t=this;if(!this._syncingOfflineChanges){this._syncingOfflineChanges=!0;var a=0,n=0,r=0,i=[],o=function(o,s){s===y.a.SyncResult.Success?n++:(r++,i.push({id:o,result:s})),a===n+r&&(t._syncingOfflineChanges=!1,e(n,r,i))};this._eventCache.getFilterEntries((function(e){return!!e.modifiedOffline})).then((function(e){a=e.length,e.forEach((function(e){var a=t.createEntryFromLocal(e.id,e);if(!a.isInvalid){var n=a.calendarID,r=a.accountID;m.default.isTempId(a.id)&&!t._pendingCreates[a.id]?t._createRemoteEventFromCacheData(r,a.calendarID,a,m.default.newEmptyFn(),(function(e,a){o(n,t._getSyncResultFromResult(n,a))}),m.default.newEmptyFn()):t.hasWritePermissionForCalendar(n)?t._updateRemoteEvent(n,a.id,a,mn,(function(e,r){e?(delete a.modifiedOffline,t._eventCache.saveEntry(a).then((function(){return o(n,y.a.SyncResult.Success)})).catch((function(){return o(n,y.a.SyncResult.FailureUnknown)}))):o(n,t._getSyncResultFromResult(n,r))})):(delete a.modifiedOffline,t._eventCache.saveEntry(a),o(a.calendarID,y.a.SyncResult.Success))}}))}))}}},{key:"_getEventDuration",value:function(e){try{m.default.PAssert(872,!e.getField("allDayEvent"),"All day events do not have valid durations")}catch(n){m.default.reportError(n)}var t=e.getField("startTime"),a=e.getField("endTime");try{m.default.PAssert(873,t&&a,"Must always have valid start and end times")}catch(n){m.default.reportError(n)}return a-t}},{key:"_computeItemDates",value:function(e,t,a){var n,r;t.getDate()&&(r=(n=t.getDate().clone()).clone().addMilliseconds(t.getDuration())),n&&r&&(t.allDayDate()?(e.start={date:n.toString("yyyy-MM-dd"),dateTime:null},e.end={date:r.toString("yyyy-MM-dd"),dateTime:null}):(e.start={dateTime:n.toISOString(),date:null},e.end={dateTime:r.toISOString(),date:null})),e.startTime=n,e.endTime=r}},{key:"_queueEventUpdate",value:function(e,t){if(this._updateAttachFromData(e,t),this._eventUpdateTimeout&&clearTimeout(this._eventUpdateTimeout),this._eventUpdateTimeout=setTimeout(this._flushEventUpdateQueue,2e3),!e.isLocalOnlyAttachment()){var a=this._eventUpdateQueue[e.id];if(a)for(var n in t)t.hasOwnProperty(n)&&(a.info[n]=t[n]);else this._eventUpdateQueue[e.id]={attach:e,info:t}}}},{key:"onShutdown",value:function(){}},{key:"_flushEventUpdateQueue",value:function(){this._eventUpdateTimeout=void 0;var e=function(e,t){e||t?bo.toasts.clearMessage(y.a.MessageID.CalendarSaveFail):bo.toasts.pushMessage(y.a.MessageID.CalendarSaveFail)};for(var t in this._eventUpdateQueue)if(this._eventUpdateQueue.hasOwnProperty(t)){var a=this._eventUpdateQueue[t];this._updateEvent(a.attach,a.info,kn,m.default.newEmptyFn(),m.default.newEmptyFn(),e)}this._eventUpdateQueue={}}},{key:"_handleAttachDeleted",value:function(e,t){var a=this,n=e.getField("status");this.deleteCalendarEvent(e,(function(r){if(r){bo.toasts.pushMessage({text:"Event removed from your calendar.",actionText:"UNDO",action:function r(){a._updateEvent(e,{status:n},_n,m.default.newEmptyFn(),(function(e){e||bo.toasts.pushMessage({text:"There was an error re-adding the event to your calendar",actionText:"RETRY",action:r,timeout:1e4})}),m.default.newEmptyFn());var i=a._createItemText(e.getData());t.setText(i,y.a.ChangeType.Local),t.parent()||t.setParent(a.getDefaultItemStore().getRoot()),t.getIndex()<0&&t.parent().insertItem(t)},timeout:1e4})}else bo.toasts.pushMessage({text:"There was an error removing the event from your calendar.",actionText:"RETRY",action:a._handleAttachDeleted.bind(a,e,t),timeout:1e4})}))}},{key:"notifyItemNoteChanged",value:function(e,t){this._queueEventUpdate(e,{description:t.getRawText()})}},{key:"notifyItemDateChanged",value:function(e,t){var a={};this._computeItemDates(a,t,e),this._queueEventUpdate(e,a)}},{key:"notifyItemTextChanged",value:function(e,t,a){if(a)this._handleAttachDeleted(e,t);else if(e.getField("recurringEventId")&&t.getCalendarParsedText()===e.getField("summary"))bo.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"});else if(!m.default.isDemoMode())if(t.getDate()){var n,r=t.getCalendarParsedText(),i=e.getField("summary"),o=e.getField("source");if(t.hasAttachmentType(y.a.PluginType.Email)){var s=t.getAttachmentByType(y.a.PluginType.Email);n={title:s.getField("subject"),url:s.getPlugin().getURLForAttachment(s)}}var l={summary:r,start:void 0,end:void 0,source:void 0},u=!1;r!==i&&(u=!0),o&&!n||!o&&n?u=!0:o&&n&&(o.title===n.title&&o.url===n.url||(u=!0));var c=t.getDate(),d=e.getField("startTime");this.areDatesEqual(d,c)||(u=!0);var h=t.getEndDate(),f=e.getField("endTime");this.areDatesEqual(f,h)||(u=!0),u&&(this._computeItemDates(l,t,e),l.source=n,this._queueEventUpdate(e,l)),e.updateField("isInvalid",!1)}else e.updateField("isInvalid",!0)}},{key:"_beginIgnorePropertyChanges",value:function(){this._ignoringPropertyChanges=!0}},{key:"_endIgnorePropertyChanges",value:function(){this._ignoringPropertyChanges=!1}},{key:"_isIgnoringPropertyChanges",value:function(){return this._ignoringPropertyChanges}},{key:"notifyItemPropertyChanged",value:function(e,t,a){if(!e.getField("locked")&&this.hasWritePermissionForCalendar(e.getField("calendarID"))&&(!m.default.isRemoteChange(a)||!this._isIgnoringPropertyChanges())){var n=e.getField("isComplete"),r=e.getField("isArchived"),i=e.getField("isStarred"),o=e.getField("priority"),s=t.dateCompleted,l=t.isArchived(),u=t.isStarred(),c=t.getPriority(),d=m.default.newEmptyFn(),h=m.default.newEmptyFn(),f=function(e,t,a,n){e||t?bo.toasts.clearMessage(y.a.MessageID.CalendarSaveFail):bo.toasts.pushMessage(y.a.MessageID.CalendarSaveFail)};this.areDatesEqual(n,s)||(m.default.isLocalChange(a)?this._updateRemoteProperty(e,"isComplete",s,d,h,f):e.updateField("isComplete",s)),r!==l&&(m.default.isLocalChange(a)?this._updateRemoteProperty(e,"isArchived",l,d,h,f):e.updateField("isArchived",l)),i!==u&&(m.default.isLocalChange(a)?this._updateRemoteProperty(e,"isStarred",u,d,h,f):e.updateField("isStarred",u)),o!==c&&(m.default.isLocalChange(a)?this._updateRemoteProperty(e,"priority",c,d,h,f):e.updateField("priority",c))}}},{key:"_clearCachedData",value:function(e,t){this.clearSyncToken(e),this.clearCalendarEventCache(e,t)}},{key:"_clearAllData",value:function(e){var t;this._eventCache.clearMetadata(),this._eventCache.clearCache().then((function(){e&&e(!0)})),null===(t=this.getDefaultItemStore())||void 0===t||t.clearStore()}},{key:"getAttachmentClass",value:function(e){var t=["plugin_gcalendar","c-date"];return e.isLoaded()&&(e.getField("isInvalid")&&t.push("invalid"),"cancelled"===e.getField("status")&&t.push("eventDeleted")),t}},{key:"getAttachmentTooltip",value:function(e){var t;return this.isPluginBlocked()?t="Go premium to view calendar events":e.isLoaded()?(e.isLocalOnlyAttachment()?t="Syncing event...":e.getField("isInvalid")&&(t="Item has an invalid date"),"cancelled"===e.getField("status")&&(t="Item was deleted from Google Calendar")):t="Plugin is loading data",t}},{key:"areDatesEqual",value:function(e,t){var a=!1;return e&&t?m.default.isDateValid(e)&&m.default.isDateValid(t)&&(a=e.equals(t)):a=!e&&!t,a}},{key:"parsePriority",value:function(e){var t=m.default.parseInt(e);return isNaN(t)&&(t=y.a.VMLIFlag.None),t}},{key:"fieldsHaveParseEffect",value:function(e){return(!e||1!==e.length||"isComplete"!==e[0])&&u()(g()(a.prototype),"fieldsHaveParseEffect",this).call(this,e)}},{key:"changeCalendarForEvent",value:function(e,t){var a=this,n=e.getField("calendarID"),r=this._getCalendarInfo(n),i=r.id;try{m.default.PAssert(876,r.accountID,"Should have an accountID on the calendar")}catch(u){m.default.reportError(u)}var o=ea.a.fns("calendar").events.move.packedFn,s={eventId:e.id,calendarId:n,destination:t};e.updateField("calendarID",t,!0);var l=function(){e.forEachItem(bo.itemStoreManager.getDefaultItemStore(),(function(e){var a=e.getMooDate();a&&(a.setGCalCalendar(t),e.onMooDateUpdated(y.a.ChangeType.Local,!0),e.setTextToWhatItAlreadyIs(y.a.ChangeType.Local))}))};this._queueRemoteRequestMulti(r.accountID,o,s,l,(function(t){e.updateField("calendarID",i,!0),t&&t.error&&t.error.code===y.a.HTTPStatusCode.Gone?l():(t&&t.error&&(t.error.code,y.a.HTTPStatusCode.NotFound),a._notifyFailedRequest(t,e.getField("calendarID")))}),void 0,bn)}},{key:"getCalendarForAttach",value:function(e){if(e.hasField("calendarID"))return this._getCalendarInfo(e.getField("calendarID"))}},{key:"fixMissingCalendars",value:function(){this.runCalendarSync(),bo.settings.fixedMissingCalendars.set(!0)}},{key:"getWriteableCalendarsForItem",value:function(e){var t,a,n;if(this.isAvailable()&&this.isEnabled()){if(e.hasPluginAttachment(y.a.PluginID.GCalendar)){var r=e.getAttachmentByPlugin(y.a.PluginID.GCalendar),i=this.getCalendarForAttach(r);i&&(a=i.id,t=i.accountID)}n=this.getWritableCalendarListSync(t)}return{selected:a,calendars:n}}},{key:"setCalendarForItem",value:function(e,t){var a=e.getAttachmentByPlugin(y.a.PluginID.GCalendar);t?e.hasPluginAttachment(y.a.PluginID.GCalendar)?this.changeCalendarForEvent(a,t):this.createEventForItem(e,t):e.hasPluginAttachment(y.a.PluginID.GCalendar)&&this.deleteCalendarEventForItem(e,a,m.default.newEmptyFn(),m.default.newEmptyFn(),(function(){console.log("Done")}))}},{key:"onSyncAccountsChanged",value:function(e,t){var n=this;u()(g()(a.prototype),"onSyncAccountsChanged",this).call(this,e,t),t.forEach((function(e){n._clearCachedData(e)})),this.isActive()&&e.length>0&&this.runCalendarSync()}},{key:"getUnstyledText",value:function(e){return""}}]),a}(ka),_()(Na.prototype,"_purgeOldData",[b.a],Object.getOwnPropertyDescriptor(Na.prototype,"_purgeOldData"),Na.prototype),_()(Na.prototype,"createEventForItem",[b.a],Object.getOwnPropertyDescriptor(Na.prototype,"createEventForItem"),Na.prototype),_()(Na.prototype,"compareCachedData",[b.a],Object.getOwnPropertyDescriptor(Na.prototype,"compareCachedData"),Na.prototype),_()(Na.prototype,"runCalendarListSync",[b.a],Object.getOwnPropertyDescriptor(Na.prototype,"runCalendarListSync"),Na.prototype),_()(Na.prototype,"runCalendarSync",[b.a],Object.getOwnPropertyDescriptor(Na.prototype,"runCalendarSync"),Na.prototype),_()(Na.prototype,"_flushEventUpdateQueue",[b.a],Object.getOwnPropertyDescriptor(Na.prototype,"_flushEventUpdateQueue"),Na.prototype),_()(Na.prototype,"parsePriority",[b.a],Object.getOwnPropertyDescriptor(Na.prototype,"parsePriority"),Na.prototype),_()(Na.prototype,"fixMissingCalendars",[b.a],Object.getOwnPropertyDescriptor(Na.prototype,"fixMissingCalendars"),Na.prototype),Na),Dn=a(60),Pn=a.n(Dn),In=a(111),En=function(){function e(t,a,n){i()(this,e);try{m.default.PAssert(1318,m.default.isFunction(t),"Must provide a valid entry callback")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1319,m.default.isFunction(a),"Must provide a valid done callback")}catch(r){m.default.reportError(r)}this._entryCB=t,this._doneCB=a,this._delay=n||5e3,this._flushTimeout=void 0,this._entries=[],ve.a.binder(this,"_onEntry","_onDone","_flushEntries","_flushEntriesWatchdog")}return s()(e,[{key:"getEntryCB",value:function(){return this._onEntry}},{key:"getDoneCB",value:function(){return this._onDone}},{key:"_onEntry",value:function(e){e&&this._entries.push(e),this._flushTimeout||(this._flushTimeout=setTimeout(this._flushEntriesWatchdog,this._delay))}},{key:"_onDone",value:function(e,t){bo.PaneUpdateBatcher.beginUpdateItems(),this._flushEntries();try{0,this._doneCB(e,t)}catch(a){m.default.reportError(a)}bo.PaneUpdateBatcher.commitUpdateItems()}},{key:"_flushEntriesWatchdog",value:function(){0}},{key:"_flushEntries",value:function(){var e=0;this._flushTimeout&&(clearTimeout(this._flushTimeout),this._flushTimeout=void 0),bo.PaneUpdateBatcher.beginUpdateItems(),Se.a.beginBatch();for(var t=0;t<this._entries.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;try{this._entryCB(this._entries[t])}catch(a){m.default.reportError(a)}}this._entries=[],Se.a.commitBatch(),bo.PaneUpdateBatcher.commitUpdateItems()}}]),e}();function Cn(){this._favMap={}}Cn.prototype={_ensureGroup:function(e){var t=[];return this._favMap[e]||(this._favMap[e]=t),t},notifyAdd:function(e,t){var a=this._ensureGroup(t);try{m.default.PAssert(1316,a.indexOf(e)<0,"Should not double add item to group")}catch(n){m.default.reportError(n)}a.push(e)},notifyRemove:function(e,t){var a=this._ensureGroup(t);try{m.default.PAssert(1317,a.indexOf(e)>=0,"Must have been added to group before removing")}catch(n){m.default.reportError(n)}a.remove(e)},getItems:function(e){return this._favMap[e]},hasItems:function(e){var t=this.getItems(e);return t&&t.length>0}};var xn,An=new Cn,Tn="Moo.do",Mn={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},Ln={INBOX:100,UNREAD:99,STARRED:98,IMPORTANT:97,SENT:96,DRAFT:95,"==MOODO_ARCHIVED==":94,"==MOODO_ALLMAIL==":93,TRASH:92,CATEGORY_PERSONAL:80,CATEGORY_SOCIAL:79,CATEGORY_PROMOTIONS:78,CATEGORY_UPDATES:77,CATEGORY_FORUMS:76},On={"==MOODO_ARCHIVED==":"Archived","==MOODO_ALLMAIL==":"All Mail"},Rn={CATEGORY_PERSONAL:!0,CATEGORY_SOCIAL:!0,CATEGORY_PROMOTIONS:!0,CATEGORY_UPDATES:!0,CATEGORY_FORUMS:!0},Fn={DRAFT:!0,CHAT:!0,SENT:!0,SPAM:!0,"==MOODO_ALLMAIL==":!0},Nn=function(){function e(t,a,n,r,o,s){i()(this,e);try{m.default.PAssert(1302,t,"Must specify a valid account ID")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1303,a,"Must specify a valid label ID")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1305,!r||m.default.isDateValid(r),"Must provide a valid oldestSync date")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1306,s,"Must supply a valid label store this label belongs to")}catch(l){m.default.reportError(l)}this._labelStore=s,this._accountID=t,this._labelID=a,this._fullName=n,this._minName=void 0,this._matchName=null===n||void 0===n?void 0:n.toUpperCase(),this._oldestSync=r,this._numUnread=0,this._ancestors=[],this._isDeleted=!(!o||!o.isDeleted),this._labelListVisibility=o&&o.labelListVisibility?o.labelListVisibility:y.a.LabelListVisibility.Show,this._messageListVisibility=o&&o.messageListVisibility?o.messageListVisibility:y.a.MessageListVisibility.Show,this._origLabelID=void 0}return s()(e,[{key:"_getDisplayPriority",value:function(){return Ln[this.getLabelID()]||-1}},{key:"displayCompare",value:function(e){var t=this.isSystemOrSpecialLabel(),a=e.isSystemOrSpecialLabel();return t&&a?this._getDisplayPriority()<e._getDisplayPriority()?1:-1:t?-1:a?1:this.getName().localeCompare(e.getName())}},{key:"isDropTarget",value:function(){return!Fn[this.getLabelID()]}},{key:"_getStoreLabel",value:function(e){var t,a=this,n=e.toUpperCase();return Object.keys(this._labelStore).some((function(e){var r=a._labelStore[e].getRawName();if(r&&r.toUpperCase()===n)return t=a._labelStore[e],!0})),t}},{key:"_computeAncestors",value:function(){try{m.default.PAssert(1307,this._fullName||this.isSystemLabel()||this.isSpecialLabel(),"Must specify a valid fullName to run _computeAncestors")}catch(i){m.default.reportError(i)}if(this._ancestors=[],!this.isSystemLabel()&&!this.isSpecialLabel()&&this._fullName&&this._fullName.indexOf("/")>0){for(var e=0,t=this._fullName.split("/"),a="",n=0;n<t.length-1;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a+=t[n];var r=this._getStoreLabel(a);r&&r!==this&&this._ancestors.push(r),a+="/"}this._computeMinName()}try{m.default.PAssert(1308,this._ancestors.indexOf(this)<0,"Self should never be in the ancestors list")}catch(i){m.default.reportError(i)}}},{key:"_computeMinName",value:function(){for(var e=0,t=this.getRawName(),a=0;a<this._ancestors.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._ancestors[a].getMinName()+"/",r=t.indexOf(n);t=t.substr(r+n.length)}this._minName=t}},{key:"getAccountID",value:function(){return this._accountID}},{key:"getLabelID",value:function(){return this._labelID}},{key:"getRawName",value:function(){return this._fullName}},{key:"getMinName",value:function(){var e;return null!==(e=this._minName)&&void 0!==e?e:this._fullName}},{key:"getMatchName",value:function(){return this._matchName}},{key:"isMatched",value:function(e){try{m.default.PAssert(1309,m.default.isString(e),"Must pass in a valid string for label name")}catch(n){m.default.reportError(n)}var t=!1,a=this.getMatchName();return e&&a&&a.indexOf(e.toUpperCase())>=0&&(t=!0),t}},{key:"isNamed",value:function(e){try{m.default.PAssert(1310,m.default.isString(e),"Must pass in a valid string for label name")}catch(n){m.default.reportError(n)}var t=!1,a=this.getMatchName();return e&&a&&a===e.toUpperCase()&&(t=!0),t}},{key:"getName",value:function(e){var t;if(Mn[this.getLabelID()])t=Mn[this.getLabelID()];else if(On[this.getLabelID()])t=On[this.getLabelID()];else if(e&&this._minName)t=this.getMinName();else if(this._fullName)t=this._fullName;else{try{m.default.PAssert(1311,!this.isLocalOnly(),"Should not have a local-only label without a name")}catch(a){m.default.reportError(a)}t=this.getLabelID()}return t||""}},{key:"hasName",value:function(){return Mn[this.getLabelID()]||On[this.getLabelID()]||!!this._fullName}},{key:"clearOldestSync",value:function(){this._oldestSync=void 0}},{key:"getOldestSync",value:function(){return this._oldestSync}},{key:"setOldestSync",value:function(e){try{m.default.PAssert(1312,m.default.isDateValid(e),"Must provide a valid oldestSync date")}catch(t){m.default.reportError(t)}this._oldestSync=e}},{key:"getMessageListVisibility",value:function(){return this._messageListVisibility}},{key:"getLabelListVisibility",value:function(){return this._labelListVisibility}},{key:"isLocalOnly",value:function(){return m.default.isTempId(this.getLabelID())}},{key:"updateLabelID",value:function(e){try{m.default.PAssert(1314,this.isLocalOnly(),"Should only ever modify local labels")}catch(t){m.default.reportError(t)}this._origLabelID=this.getLabelID(),this._labelID=e}},{key:"updateLabelName",value:function(e){this._fullName=e,this._matchName=e.toUpperCase(),this._computeAncestors()}},{key:"getSaveData",value:function(){var e={id:this.getLabelID(),name:this._fullName,messageListvisibility:this.getMessageListVisibility(),labelListVisibility:this.getLabelListVisibility(),isDeleted:this._isDeleted};return this.getOldestSync()&&(e.oldestSync=this.getOldestSync()),e}},{key:"getDisplayText",value:function(e){var t;return this.getName()&&(t=this.getName().startsWith("Moo.do/")?this.getName().substr(Tn.length+1):this.getName(e)),t}},{key:"getOutlineText",value:function(){var e=this.getDisplayText();return null===e||void 0===e?void 0:e.replace(/ /g,"_")}},{key:"matchesText",value:function(e){return this.getDisplayText().toLowerCase().indexOf(e)>=0}},{key:"hasAncestors",value:function(){return!!this._fullName&&this.getAncestors().length>0}},{key:"getAncestors",value:function(){return this._computeAncestors(),this._ancestors}},{key:"getParent",value:function(){var e=this.getAncestors();return e[e.length-1]}},{key:"isSystemLabel",value:function(){return!!Mn[this.getLabelID()]}},{key:"isSpecialLabel",value:function(){return!!On[this.getLabelID()]}},{key:"isSystemOrSpecialLabel",value:function(){return this.isSystemLabel()||this.isSpecialLabel()}},{key:"isCategoryLabel",value:function(){return!!Rn[this.getLabelID()]}},{key:"isArchived",value:function(){return"Archived"===this.getName()}},{key:"isStarred",value:function(){return"Starred"===this.getName()}},{key:"isInbox",value:function(){return"Inbox"===this.getName()}},{key:"isDraft",value:function(){return"Draft"===this.getName()}},{key:"isTrash",value:function(){return"Trash"===this.getName()}},{key:"isCustom",value:function(){return!this.isSystemLabel()&&!this.isSpecialLabel()}},{key:"getUnreadCount",value:function(){return this._numUnread}},{key:"shouldDisplayInLabelList",value:function(){var e=!1;return this._isDeleted||(this.getLabelListVisibility()===y.a.LabelListVisibility.Show||this.getLabelListVisibility()===y.a.LabelListVisibility.ShowIfUnread&&this.getUnreadCount()>0)&&(e=!0),e}},{key:"shouldDisplayInMessageList",value:function(){return this._messageListVisibility===y.a.MessageListVisibility.Show}},{key:"delete",value:function(){try{m.default.PAssert(1315,!this.isSystemOrSpecialLabel(),"Should never delete a special or system label")}catch(e){m.default.reportError(e)}this._isDeleted=!0}}]),e}(),Bn=a(31),jn=a(56),Un=a(69);function Hn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var Vn=(xn=function(e){d()(a,e);var t=Hn(a);function a(e){var n;i()(this,a);var r={title:"Legacy Email",contextMenuMode:"Gmail",paneEmptyMessage:"No emails here",paneEmptySearchMessageDefault:"Press enter to search",paneEmptySearchMessage:"Press enter to search",titleContextMenuHeader:"Open label",dropEffect:function(){return y.a.DropEffect.Copy},isWriteable:!1,overrideCopyBehavior:!1,canAddItem:!1,supportCollapsing:!1,supportCompleting:!0,supportCheckbox:!0,supportOffline:!1,supportPerformArchive:!1,supportDataRefresh:"Emails",supportReportError:!0,supportCompose:!0,supportPagination:!0,supportVertLines:!1,supportSearchItemAutocomplete:!1,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportLocalSearch:!1,supportClone:!1,supportDeferredItemLoad:!0,supportCellTransition:!1,shouldSearchMatchParents:!1,noOverviewStyle:!0,supportStarClick:!0,supportClickOverviewScroll:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,overviewHasPaneItems:!1,overviewPadLevels:-1,maxWidthFlex:y.a.ExpandedPaneWidth,maxWidth:y.a.ExpandedPaneWidth+200,maxWidthSingle:y.a.ExpandedPaneWidth,widthBiggerInSingle:!1,supportsDocuments:!1,_topBoxHeight:0,searchFilters:[{name:"unread",initialValue:1,icon:"icon-drafts",tooltip:"unread emails",remoteStringFn:function(e){var t;switch(e){case-1:t="-in:trash -is:unread";break;case 1:t="-in:trash is:unread";break;default:t=""}return t},matchFn:function(e,t){var a=n.plugin.isItemUnread(t);if(e)return a&&e>0||!a&&e<0?y.a.MatchState.Yes:y.a.MatchState.No}},{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred emails",remoteStringFn:function(e){var t;switch(e){case-1:t="-is:starred";break;case 1:t="is:starred";break;default:t=""}return t},matchFn:function(e,t){var a=n.plugin.isItemStarred(t);if(e)return a&&e>0||!a&&e<0?y.a.MatchState.Yes:y.a.MatchState.No}},{name:"priority",remoteStringFn:function(e){var t;switch(e){case y.a.VMLIFlag.P0:t="label:Moo.do/Priority High";break;case y.a.VMLIFlag.P1:t="label:Moo.do/Priority Medium";break;case y.a.VMLIFlag.P2:t="label:Moo.do/Priority Low";break;default:t=""}return t},matchFn:function(e,t){return n.plugin.getItemPriority(t)>=e?y.a.MatchState.Yes:y.a.MatchState.No}},{name:"category",remoteStringFn:function(e){return e?"category:"+e:""},matchFn:function(e,t){return e?n.plugin.itemHasLabel(t,e)?y.a.MatchState.Yes:y.a.MatchState.No:y.a.MatchState.Yes}}]};return e.plugin=bo.pluginManager.getPlugin(a.getPluginID()),(n=t.call(this,e,r)).type=n.plugin._paneType,n.paneClass="panePlugin paneGmail",n.isInitializing=!0,n._lines=[{text:"\u2000",start:0,length:1,width:0}],n.dragMarginTop=25,n.blocks=[],n.blocksByKey={},n._focusedTrash=!1,n.shouldCheckHeight=!0,n.maxScrollOffset=0,n.selectedIndex=new P.a(-1,n.onSelectedIndexChanged.bind(Pn()(n))),n._isSearchingRemote=new P.a(!1),n._overviewAccount=new P.a,n._currentSearch=void 0,n._ignoreRestoreScroll=!0,n._failedPageRequest=new P.a(!1),n.viewState=new P.a(e.viewState&&e.viewState.viewMode?e.viewState:{viewMode:y.a.GmailViewMode.Date}),n.item.get()||n.item.set(n.plugin.tempRootVMLI),n.item.listen((function(e){return n._onItemChange(e,!1)})),n.viewState.listen(n._onViewStateChange.bind(Pn()(n))),ve.a.binder(Pn()(n),"_runRemoteSearch","searchCompare","onTopTextChanged","headerSearchCompare","onMultiselectReset","changeView","onEmailComposeClosed","onEmailPreviewClosed"),n.initGmail(),n._firstSelectedItemID=void 0,e.isExpanded&&(bo.EmailPreview.startOpenOnLoad(Pn()(n)),n._firstSelectedItemID=e.selectedItem),n.isInitializing=void 0,n}return s()(a,[{key:"initGmail",value:function(){Bn.a.listen("reset",this.onMultiselectReset),this.search.isSearched()&&this.onSearchChanged(!0),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0,this.paneTopText.listen(this.onTopTextChanged),se.a.listen("EmailCompose","onClosed",this.onEmailComposeClosed),se.a.listen("EmailPreview","onClosed",this.onEmailPreviewClosed)}},{key:"destroy",value:function(){clearTimeout(this._searchTimeout),this._searchTimeout=void 0,this.paneTopText.unlisten(this.onTopTextChanged),se.a.unlisten("EmailCompose","onClosed",this.onEmailComposeClosed),se.a.unlisten("EmailPreview","onClosed",this.onEmailPreviewClosed),Bn.a.unlisten("reset",this.onMultiselectReset),u()(g()(a.prototype),"destroy",this).call(this)}},{key:"onLoad",value:function(){u()(g()(a.prototype),"onLoad",this).call(this),this._onItemChange(this.getItem(),!0)}},{key:"notifyPluginLoaded",value:function(){var e=this.deferredItemState;if(e){var t=this.getItemStore().getItem(e.itemID);t&&(this.setItem(t,!0),this.updateHeaders(!0))}}},{key:"getItemStore",value:function(){return this.plugin.getActiveItemStore(this.id)}},{key:"getRootItem",value:function(){var e=this.getItemStore();return e?e.getRoot():void 0}},{key:"getDefaultDisplayItem",value:function(e){return this.plugin.getDefaultDisplayItem(e)}},{key:"searchCompare",value:function(e){var t=!1,a=e.getAttachmentByPlugin(this.plugin.id);if(a){var n=a.getField("accountID");this.plugin.hasSyncAccount(n)&&(this.plugin.isOnline()?(!this.isSearched()||!this.isLoading.get()&&this.paneTopText.get()||this.isRemoteSearchActive())&&this.plugin.isDisplayItem(e,this._focusedTrash)&&(t=!0):this.search.isMatched(e)&&this.plugin.isDisplayItem(e,this._focusedTrash)&&(t=!0))}return t}},{key:"runItemSearch",value:function(e){try{m.default.PAssert(1280,e,"Must supply a valid param set for local item search")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1281,e.item,"Gmail pane always expects a valid item when running local item search")}catch(t){m.default.reportError(t)}return e.item.belongsToItemStore(this.plugin.getDefaultItemStore())?this.plugin.runLocalItemSearch(e):u()(g()(a.prototype),"runItemSearch",this).call(this,e)}},{key:"getItemSearchParams",value:function(){var e=this.plugin.getLabelForVMLI(this.getItem());return this._focusedTrash=e&&e.isTrash(),{item:this.getItem(),comparator:this.searchCompare,pane:this}}},{key:"setOverviewAccount",value:function(e){this._overviewAccount.set(e),this.updateHeaders(!0)}},{key:"headerSearchCompare",value:function(e){if(this.plugin.isLabelItem(e)){var t=this.plugin.getLabelForVMLI(e);return!t||t.shouldDisplayInLabelList()}return!!this.plugin.isAccountItem(e)}},{key:"getHeaderSearchParams",value:function(){return{item:this.plugin.getDefaultItemStore().getRoot(),comparator:this.headerSearchCompare,noCollapsed:!0,collapseAfterDepth:this.plugin.numSyncAccounts()>1?1:NaN,overview:!0,pane:this}}},{key:"saveSelection",value:function(){return Bn.a.getSelectedItems(this)}},{key:"restoreSelection",value:function(e){if(e.length>0){for(var t=0,a=[],n=0;n<e.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.indexOfItem(e[n]);r>=0&&a.push(r)}if(a.length>1)this.selectedIndex.set(a[0],!1),Bn.a.setSelected(a,this);else if(1===a.length)this.selectIndex(a[0]);else{var i=this.selectedIndex.get();i>=this.numItems()&&(i=this.numItems()-1),this.selectIndex(i,!0)}}}},{key:"_setItems",value:function(e,t){for(var a,n=0,r=this.saveSelection(),i=[],o={},s=this.getViewMode()===y.a.GmailViewMode.Date?this.plugin.threadSortFn:this.plugin.threadSortPriorityFn,l=0;l<e.length;++l){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=e[l],c=this.plugin._getThreadIDFromItem(u);c&&!o[c]&&(i.insertSorted(u,s),this._firstSelectedItemID&&u.id===this._firstSelectedItemID&&(a=u),o[c]=!0)}if(this.updateOutline(i),this.restoreSelection(r),a&&e.length>0){var d=this.indexOfItem(a);d>=0&&(this.selectIndex(d),this.scrollToIndex(d,"start")),this._firstSelectedItemID=void 0}}},{key:"setHeaders",value:function(e,t){var a=0,n=this;if(!this._overviewAccount.get()||"me"===this._overviewAccount.get()){var r=this.plugin.getDescriptorForItem(this.getItem());this._overviewAccount.set(r.accountID)}this._allHeaders=e;for(var i=[],o={},s={},l=0;l<this._allHeaders.length;++l){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var u=this._allHeaders[l],c=this.plugin.getAccountIDFromItem(u);if(o[c]||(o[c]=[]),this.plugin.isAccountItem(u))s[c]=u;else{var d=o[c];this.plugin.isDisplayHeader(u)&&d.insertSorted(u,this.plugin.labelVMLISortFn)}}var h=this._overviewAccount.get(),f=o[this._overviewAccount.get()];if(f){var p=s[h];try{m.default.PAssert(1282,p,"Must have valid account item")}catch(w){m.default.reportError(w)}if(p)for(var g=0,v=0;v<f.length;++v){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;if(v>0){var k=this.plugin.getLabelForVMLI(f[v-1]),_=this.plugin.getLabelForVMLI(f[v]);(k.isSystemOrSpecialLabel()&&!_.isSystemOrSpecialLabel()||!k.isCategoryLabel()&&_.isCategoryLabel())&&i.push(new Un.a({type:"hr",id:"hr"+h+v,pane:this,index:v,overview:!0,sizeInPane:this.heightOverviewHR}))}i.push(f[v])}}this.headersArr=i;var b=i.map((function(e,t){return m.default.isVMLI(e)?new Un.a({type:"blockItem",item:e,id:e.id,pane:n,index:t,overview:!0,sizeInPane:y.a.OverviewItemHeightDesktop}):new Un.a(Object.assign({pane:n,overview:!0},e))}));this.headerPaneObjects.set(b)}},{key:"heightOverviewHR",value:function(){return 4}},{key:"getTitleList",value:function(){var e=this.getItem();if(e===this.plugin.tempRootVMLI)return[e];var t=this.plugin.getDescriptorForItem(e),a=this.plugin.getVMLIForAccount(t.accountID);return a===e?[e]:[a,e]}},{key:"onClickTitle",value:function(e){return this.plugin.isAccountItem(e)?e=this.plugin.getDefaultDisplayItem(this.plugin.getAccountIDFromItem(e)):e===this.getRootItem()?e=this.plugin.getDefaultDisplayItem(this.plugin.getAccountIDFromItem(this.getItem())):this.plugin.isLabelItem(e)||(e=this.plugin.getDefaultDisplayItem(this.plugin.getDefaultAccount())),u()(g()(a.prototype),"onClickTitle",this).call(this,e)}},{key:"onTopTextChanged",value:function(){this.topBoxHeight.set(this.paneTopText.get()?36:0)}},{key:"searchACName",value:function(){}},{key:"getPaneIcon",value:function(){return this.plugin.getPaneIcon()}},{key:"requestDataPage",value:function(e){this.isLoadingNewPage.set(!0),this.plugin.requestDataPage(e,this.onDataPagedIn.bind(this))}},{key:"dropEffectCopyBehavior",value:function(e,t){if(!this.plugin.isLabelItem(t)||!e.belongsToItemStore(this.getItemStore())){try{m.default.PAssert(1283,!e.belongsToSameItemStore(t),"Dropping onto a Gmail pane is not supported")}catch(r){m.default.reportError(r)}return this.plugin.createOutlinePaneItem(e,t)}var a=this.plugin.getLabelForVMLI(t),n=e.getAttachmentByPlugin(this.plugin.id);n&&(null===a||void 0===a?void 0:a.isDropTarget())&&this.plugin.addLabelToAttachment(n,a.getName())}},{key:"_refreshPaneData",value:function(){this.plugin.refreshCurrentView()}},{key:"reportPaneError",value:function(){bo.menus.openModal(y.a.Modals.ReportBug)}},{key:"_onItemChange",value:function(e,t){var a=this;Bn.a.reset(this);var n=this.plugin.getAccountIDFromItem(this.getRootItem());this.setOverviewAccount(n),this._clearCurrentSearch();var r=this.plugin.getLabelForVMLI(e);this._focusedTrash=r&&r.isTrash(),e.hasPaginationToken()||this.plugin.handleItemChange(e,(function(){a.isLoading.set(!1)})),this.numItems()>0&&this.selectIndex(0)}},{key:"_onViewStateChange",value:function(){Bn.a.reset(this),this.plugin.handleViewModeChange(this.getItem(),this.getViewMode()),this.updateItemsImmediate(!0,void 0,void 0,!0),bo.PaneManager.updatePaneStateForPane(this),this.scrollToIndex(0,"start")}},{key:"getItemLabel",value:function(e){var t=e?this.getActualPaneItem():this.getItem();return this.plugin.getLabelForVMLI(t)}},{key:"onDataPagedIn",value:function(e){e?this._failedPageRequest.set(!1):this._failedPageRequest.set(!0),this.isLoadingNewPage.set(!1)}},{key:"onScrollEnd",value:function(){this.isLoadingNewPage.get()||this.isSearched()||this.requestDataPage(this.getItem())}},{key:"handleStatusClick",value:function(){}},{key:"_getLoadingMessage",value:function(){var e=this.plugin.getAccountIDFromItem(this.getItem());return ee.a.isAuthorizedForScopes(e,[y.a.GScope.GmailModify])?"Loading...":"Authorizing..."}},{key:"bottomListMessage",value:function(){var e;return this.getItem().hasPaginationToken()&&(e=this._failedPageRequest.get()?"RETRY LOAD":this.isLoadingNewPage.get()||this.getItem().paginationTokenInUse()?"Loading...":"Click to load more emails"),{text:e,clickable:!0}}},{key:"_onRemoteDataLoaded",value:function(){}},{key:"onClickItem",value:function(e,t,a,n){if(n.shiftKey){var r=Bn.a.getFirstSelectedIndex(this),i=Bn.a.getLastSelectedIndex(this);e<r?r=e:e>i&&(i=e),Bn.a.selectInOrder(r,i,this),!1}else if(m.default.hasClass(n.target,"emailLabel")){var o=n.target.textContent,s=t.getAttachmentByPlugin(this.plugin.id).getField("accountID"),l=this.plugin._getLabelByName(s,o);try{m.default.PAssert(1284,l,"Must be able to get a valid label if clicking a valid label: ",o)}catch(c){m.default.reportError(c)}if(l){var u=this.plugin.getVMLIForLabel(s,l);this.zoomIn(u),!1}}else m.default.hasClass(n.target,"itemCheckbox")||this.selectIndex(e)}},{key:"handleRightSideTap",value:function(e){if(e&&e.hasPluginAttachment(this.plugin.id)){this.archiveEmailFromCurrentLabel(e);var t=this.selectedIndex.get();t>=this.numItems()&&(t=this.numItems()-1),this.selectIndex(t,!0),m.default.vmMain.redoLastMouseMove()}}},{key:"onMultiselectReset",value:function(e){this===e&&this.selectedIndex.set(-1)}},{key:"selectIndex",value:function(e,t,a){var n=this.selectedIndex.get();this.selectedIndex.set(e,t),e>=0?Bn.a.setSelected([e],this):Bn.a.reset(this),(t||n!==e)&&this.selectedIndex.notify(),a||bo.PaneManager.updatePaneStateForPane(this)}},{key:"selectItem",value:function(e,t){if(e){var a=this.indexOfItem(e);a>=0&&this.selectIndex(a,t)}else this.selectIndex(-1,t)}},{key:"onSelectedIndexChanged",value:function(e){if(bo.EmailPreview.isOpenOnPane(this))if(e>=0){var t=this.itemAtIndex(e);this.openEmailByItem(t)}else e<0&&bo.EmailPreview.reset()}},{key:"_runRemoteSearch",value:function(){var e=this;if(bo.PaneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var t=this.search.getRemoteValue(),a=this.plugin.getDescriptorForItem(this.item.get());if(a.labelID){var n=this.plugin._getLabelByID(a.accountID,a.labelID);n.isSpecialLabel()||n.isInbox()||!n.hasName()||(t+=" label:"+n.getName())}this._lastSearchValue=t,this._lastSearchTime=Date.now(),this.paneEmptySearchMessage="",this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._clearCurrentSearch();var r="R~"+this.getActualPaneItem().id+"~"+m.default.generateTempId();m.default.log("Gmail Remote Search ItemID: ",r),this._currentSearch=this.plugin.runSearch(t,this.id,r,!0,(function(t){if(!e._destroyed&&e._isSearchingRemote.get())switch(e.paneEmptySearchMessage=t===y.a.SearchResultStatus.Done?e.paneEmptySearchMessageDefault:"",e.isLoading.set(!1),t){case y.a.SearchResultStatus.Done:e.paneTopText.set(""),e.scrollToIndex(0,"start");break;case y.a.SearchResultStatus.TooMany:e.paneTopText.set("Too many search results! Be more specific.");break;case y.a.SearchResultStatus.None:e.paneTopText.set("There were no search results");break;case y.a.SearchResultStatus.Error:e.paneTopText.set("There was an error running your search, try again.");break;default:try{m.default.PAssert(1285,!1,"Invalid search state: ",t)}catch(a){m.default.reportError(a)}}}))}}},{key:"_clearCurrentSearch",value:function(){this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0)}},{key:"onSearchChanged",value:function(e){var t=this.search.getRemoteValue();if(t!==this._lastSearchValue||Date.now()-this._lastSearchTime>5e3)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,t){var a=e?0:2500;this._searchTimeout=setTimeout(this._runRemoteSearch,a)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this._clearCurrentSearch(),this.isLoading.set(!1),this.paneTopText.set("")}},{key:"isSearchingRemote",value:function(){return this._isSearchingRemote.get()}},{key:"isRemoteSearchActive",value:function(){return this.plugin.isRemoteSearchBucketActive(this.id)}},{key:"onEmailComposeClosed",value:function(){var e=this.plugin,t=e.getDefaultAccount(),a=e._getLabelByID(t,Qn.DRAFT),n=e.getVMLIForLabel(t,a);this.item.get()===n&&this.selectIndex(-1)}},{key:"onEmailPreviewClosed",value:function(){0}},{key:"applyToSelection",value:function(e){var t=this.saveSelection();Bn.a.forEach(this,e),this.restoreSelection(t)}},{key:"_autocompletePopup",value:function(e,t,a){var n=this;if(!e.elementDisplay){var r=Bn.a.getFirstSelectedIndex(this),i=this.elementAtIndex(r);e.elementDisplay=i}var o=[];Bn.a.forEach(this,(function(e){o.push(e)})),e.items=o,e.onSelected=function(r){n.plugin.beginAction(),e.item?t(e.item,r):Bn.a.forEach(n,(function(e){t(e,r)})),a&&a(),n.plugin.endAction()},jn.a.showPopup(e)}},{key:"getPaddingForPaneObject",value:function(e){return e.overview?u()(g()(a.prototype),"getPaddingForPaneObject",this).call(this,e)-20:0}},{key:"getWidth",value:function(){return this.rect.get().width}},{key:"getFirstSelectedItem",value:function(){return Bn.a.getFirstSelectedItem(this)}},{key:"getFirstSelectedIndex",value:function(){return Bn.a.getFirstSelectedIndex(this)}},{key:"autocompleteSchedule",value:function(e){var t=this,n=e.onClose,r=this.selectedIndex.get();e.element=e.element||this.elementAtIndex(r),e.onClose=function(){r>=t.numItems()&&(r=t.numItems()-1),t.selectIndex(r,!0),n&&n()},u()(g()(a.prototype),"autocompleteSchedule",this).call(this,e)}},{key:"autocompleteMove",value:function(e,t){var n=this;e=e||{};var r=this.selectedIndex.get();e.positionOffset={left:40},u()(g()(a.prototype),"autocompleteMove",this).call(this,e,(function(){r>=n.numItems()&&(r=n.numItems()-1),n.selectIndex(r,!0),t&&t()}))}},{key:"autocompleteCreateTask",value:function(){var e=this,t=this.selectedIndex.get();if(!isNaN(t)){var a=this.elementAtIndex(t),n=Bn.a.getSelectedItems(this);bo.menus.openItemEditor({element:a,pane:this,selectIndex:0,addOnSave:!0,selectDocument:!0,side:"bottom",children:n,positionOffset:{left:10},options:[{text:"Archive email",value:bo.pluginManager.getSetting(y.a.PluginID.Gmail,y.a.PluginSettingsID.Gmail.ArchiveOnOrganize)||!1,cb:function(){for(var t=0,a=0;a<n.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=n[a].getAttachmentByPlugin(e.plugin.id);e.plugin.performAction(y.a.PluginAction.Gmail.Archive,!1,r)}}}],beginSave:function(){var t=0;bo.PaneUpdateBatcher.beginUpdateItems(),e.plugin.beginAction();for(var a=0;a<n.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=n[a].getAttachmentByPlugin(e.plugin.id);e.plugin.attachmentHasLabel(r,"Moo.do/Handled")||e.plugin.performAction(y.a.PluginAction.Gmail.AddLabel,!1,r,"Moo.do/Handled")}},endSave:function(){e.plugin.endAction(),bo.PaneUpdateBatcher.commitUpdateItems()}})}}},{key:"toggleStarSelected",value:function(){u()(g()(a.prototype),"toggleStarSelected",this).call(this),this.updateItems()}},{key:"toggleStar",value:function(e){var t=e.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1287,t,"Must be able to get a valid attachment")}catch(n){m.default.reportError(n)}var a=t.getPlugin();a.isItemStarred(e)?a.performAction(y.a.PluginAction.Gmail.Unstar,!1,t):a.performAction(y.a.PluginAction.Gmail.Star,!1,t),this.updateItems()}},{key:"_openSelectedInMode",value:function(e){var t=Bn.a.getFirstSelectedIndex(this);this.selectIndex(t);var a=this.itemAtIndex(t);this.openEmailByItem(a,e)}},{key:"replySelected",value:function(){this._openSelectedInMode(y.a.EmailResponseMode.Reply)}},{key:"replyAllSelected",value:function(){this._openSelectedInMode(y.a.EmailResponseMode.ReplyAll)}},{key:"forwardSelected",value:function(){this._openSelectedInMode(y.a.EmailResponseMode.Forward)}},{key:"archiveSelected",value:function(e){this.plugin.beginAction(),this.applyToSelection(this.archiveEmailFromCurrentLabel),this.plugin.endAction()}},{key:"archiveItem",value:function(e,t){var a=t.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1288,a,"Must be able to get a valid attachment")}catch(n){m.default.reportError(n)}!e&&this.plugin.isItemArchived(t)?this.plugin.performAction(y.a.PluginAction.Gmail.Unarchive,!1,a):e&&!this.plugin.isItemArchived(t)&&this.plugin.performAction(y.a.PluginAction.Gmail.Archive,!1,a)}},{key:"deleteSelected",value:function(e,t){this.plugin.beginAction(),this.applyToSelection(this.deleteEmailFromCurrentLabel),this.plugin.endAction()}},{key:"applyPriorityToSelection",value:function(e,t){var a=this,n=e,r=!0;this.plugin.beginAction(),this.applyToSelection((function(i){var o=i.getAttachmentByPlugin(a.plugin.id);try{m.default.PAssert(1289,o,"Must be able to get a valid attachment")}catch(s){m.default.reportError(s)}t&&r&&(a.plugin.getAttachmentPriority(o)===e&&(n=y.a.VMLIFlag.None),r=!1),a.plugin.performAction(y.a.PluginAction.Gmail.SetPriority,!1,o,n),a.updateItems()})),this.plugin.endAction()}},{key:"handleUndo",value:function(){this.plugin.handleUndo()}},{key:"handleRedo",value:function(){this.plugin.handleRedo()}},{key:"keyMoveDown",value:function(e){var t;-1===this.selectedIndex.get()?this.selectIndex(0):e&&e.shiftKey?(Bn.a.isInverted(this)&&1===Bn.a.numSelectedInPane(this)&&Bn.a.setInverted(!1,this),Bn.a.isInverted(this)?(t=Bn.a.getFirstSelectedIndex(this),Bn.a.removeSelected(t,this)):(t=this.indexOfNextVMLI(Bn.a.getLastSelectedIndex(this)))>=0&&t<this.numItems()&&(Bn.a.addSelected(t,this),this.scrollIndexIntoView(t))):(t=this.indexOfNextVMLI(Bn.a.getLastSelectedIndex(this)))>=0&&t<this.numItems()&&(this.selectIndex(t),this.scrollIndexIntoView(t))}},{key:"keyMoveUp",value:function(e){var t;-1===this.selectedIndex.get()?this.selectIndex(0):e&&e.shiftKey?(Bn.a.isInverted(this)||1!==Bn.a.numSelectedInPane(this)||Bn.a.setInverted(!0,this),Bn.a.isInverted(this)?(t=this.indexOfPrevVMLI(Bn.a.getFirstSelectedIndex(this)))>=0&&(Bn.a.addSelected(t,this),this.scrollIndexIntoView(t,"smooth")):(t=Bn.a.getLastSelectedIndex(this),Bn.a.removeSelected(t,this))):(t=this.indexOfPrevVMLI(Bn.a.getFirstSelectedIndex(this)))>=0&&(this.selectIndex(t),this.scrollIndexIntoView(t,"smooth"))}},{key:"onHotkey",value:function(e,t){if(this.selectedIndex.get()>=0&&!bo.menus.isContextMenuOpen()){var a=this.objectAtIndex(this.selectedIndex.get()),n=a.item,r=!0;if(n){if("Up"===e)this.keyMoveUp(t);else if("Down"===e)this.keyMoveDown(t);else if("Open"===e)bo.EmailPreview.isOpenOnPane(this)||this.openEmailByItem(n);else if("Archive"===e){t.shiftKey&&bo.EmailPreview.isOpenOnPane(this)&&bo.EmailPreview.close();var i=!this.getItemLabel(!0).isArchived();this.archiveSelected(i)}else if("Delete"===e)this.deleteSelected(this.plugin.isGmailItem,!0);else if("Schedule"===e)this.autocompleteSchedule({item:n});else if("Move"===e)this.autocompleteMove();else if("Task"===e)this.autocompleteCreateTask();else if("Label"===e)this.autocompleteLabel({item:n});else if("MarkRead"===e)this.markReadSelected(!0);else if("MarkUnread"===e)this.markReadSelected(!1);else if("Star"===e)this.toggleStarSelected();else if("Reply"===e)this.replySelected();else if("ReplyAll"===e)this.replyAllSelected();else if("Forward"===e)this.forwardSelected();else if("Priority1"===e)this.applyPriorityToSelection(y.a.VMLIFlag.P0,!0);else if("Priority2"===e)this.applyPriorityToSelection(y.a.VMLIFlag.P1,!0);else if("Priority3"===e)this.applyPriorityToSelection(y.a.VMLIFlag.P2,!0);else if("RemoveFromLabel"===e)this.search.isSearched()||(this.plugin.beginAction(),this.applyToSelection(this.removeItemFromCurrentLabel),this.plugin.endAction());else if("Undo"===e)this.handleUndo();else if("Print"===e){if(1===Bn.a.numSelectedInPane(this)){var o=Bn.a.getFirstSelectedItem(this),s=this.plugin.createPrintURLForThread(o.getAttachmentByPlugin(this.plugin.id));m.default.printPage(s)}}else if("OpenInGmail"===e){if(1===Bn.a.numSelectedInPane(this)){var l=Bn.a.getFirstSelectedItem(this),u=this.plugin.getURLForAttachment(l.getAttachmentByPlugin(this.plugin.id));bo.openUrl(u)}}else"Menu"===e?bo.menus.openItemContextMenu(a):r=!1;r&&m.default.preventDefault(t)}}}},{key:"archiveEmailFromCurrentLabel",value:function(e){var t=this.getItemLabel(!0),a=!t.isArchived();this.archiveItem(a,e),t.isInbox()||t.isArchived()||this.plugin.removeItemFromLabel(t,e)}},{key:"deleteEmailFromCurrentLabel",value:function(e){var t=this.getItemLabel(!0);this.plugin.deleteItem(e,t)}},{key:"removeItemFromCurrentLabel",value:function(e){var t=this.getItemLabel(!0);this.plugin.removeItemFromLabel(t,e)}},{key:"canAcceptDragOver",value:function(e,t,a,n){if(this.type===(null===e||void 0===e?void 0:e.type)&&n&&(a||e&&this!==e)){var r,i=e.getItemLabel();if(a){var o=m.default.getElementParent(t);r=o&&m.default.getItemForElement(o)}else r=this.getItem();if(r&&this.plugin.isLabelItem(r)&&this.plugin.areItemsFromSameAccount(n,r)){var s=this.plugin.getLabelForVMLI(r);if(s!==i&&s.isDropTarget())return!0}}else if(this.type!==e.type){if(n.getAttachmentByPlugin(this.plugin.id))return!0}return!1}},{key:"_handleDragOverPane",value:function(e,t,a,n,r,i,o){return{targetPane:this,targetElement:t,targetItem:this.getItem()}}},{key:"_handleDragDrop",value:function(e,t,a,n,r){var i=this,o=a.targetItem,s=a.overview,l=(n.ctrlKey,n.altKey,s?o:this.getActualPaneItem()),u=this.plugin.getLabelForVMLI(l);return e.forEach((function(e){var t=e.getAttachmentByPlugin(i.plugin.id);if(t&&(t.getField("accountID")===u.getAccountID()&&(null===u||void 0===u?void 0:u.isDropTarget()))){var a=u.getName();i.plugin.attachmentHasLabel(t,a)||i.plugin.addLabelToAttachment(t,a)}})),!0}},{key:"_handleDragDropItem",value:function(e,t,a,n,r){n.ctrlKey,n.altKey;var i=!1;if(a){var o=t.pane,s=o.getItemLabel(),l=a.targetItem,u=this.plugin.getLabelForVMLI(l);if(e.hasPluginAttachment(this.plugin.id)&&this.plugin.areItemsFromSameAccount(e,l)){var c=e.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1290,c,"Must be able to get a valid attachment")}catch(d){m.default.reportError(d)}this.plugin.beginAction(),this.plugin.performAction(y.a.PluginAction.Gmail.RemoveLabel,!1,c,s.getName()),this.plugin.attachmentHasLabel(c,u.getName())||this.plugin.performAction(y.a.PluginAction.Gmail.AddLabel,!1,c,u.getName()),o.notifyDropFrom(e,this),this.plugin.endAction(),i=!0}}return i}},{key:"notifyDropFrom",value:function(e,t){if(this.selectIndex(-1),t.type===y.a.PaneMode.Task){var a=e.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1291,a,"Must be able to get a valid attachment")}catch(r){m.default.reportError(r)}this.plugin.attachmentHasLabel(a,"Moo.do/Handled")||(this.plugin.beginAction(),this.plugin.getSetting(this.plugin.Settings.ArchiveOnOrganize)&&this.plugin.performAction(y.a.PluginAction.Gmail.RemoveLabel,!1,a,"Inbox"),this.plugin.performAction(y.a.PluginAction.Gmail.AddLabel,!1,a,"Moo.do/Handled"),this.plugin.endAction());var n=this.plugin.getAttachmentPriority(a);n!==y.a.VMLIFlag.None&&e.setPriority(n,y.a.ChangeType.Local),this.plugin.attachmentHasLabelByID(a,"STARRED")&&e.setStarred(!0,y.a.ChangeType.Local)}}},{key:"maxWidthOfPaneObject",value:function(){return this.getWidth()-56}},{key:"allowZoom",value:function(e){var t=!1;return this.plugin.isLabelItem(e)&&(t=!0),t}},{key:"performOverviewAction",value:function(e){if(this.plugin.isAccountItem(e)){e.setCollapsed(!e.isCollapsed(this,!0),this,!0);var t=e=this.plugin.getDefaultDisplayItem(this.plugin.getAccountIDFromItem(e));this.zoomIn(t),m.default.sendEvent("Menu","OverviewZoom_Gmail")}}},{key:"setItem",value:function(e,t){return this.selectIndex(-1,void 0,!0),u()(g()(a.prototype),"setItem",this).call(this,e,t)}},{key:"isItemHeader",value:function(e,t){if(!t)return e.isHeader();for(var a=0,n=this.plugin,r=e.getItems(),i=0;i<r.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(n.isLabelItem(r[i])||n.isAccountItem(r[i]))return!0}}},{key:"getActualPaneItem",value:function(){return this.plugin._defaultZoomItems[this.id]||this.item.get()}},{key:"canResetMultiselect",value:function(){return!bo.EmailPreview.isOpenOnPane(this)||0===this.numItems()}},{key:"setExpanded",value:function(e,t){u()(g()(a.prototype),"setExpanded",this).call(this,e,t),e||this===m.default.focusedPane||Bn.a.reset(this)}},{key:"_applyDropOnBlockItem",value:function(e,t,a,n){var r=e,i=t.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1292,i,"Must be able to get a valid attachment")}catch(u){m.default.reportError(u)}if(r.isDate){var o,s=r.dateTime||r.date;o=m.default.isString(s)?bo.International.parseDate(s,y.a.DateFormat.MDY):s;try{m.default.PAssert(1293,m.default.isDateValid(o),"Must provide a valid date when scheduling an email",r.dateTime,r.date)}catch(u){m.default.reportError(u)}m.default.isDateValid(o)&&this.plugin.scheduleEmail(t,o)}else{var l;r.isStarred?this.plugin.performAction(y.a.PluginAction.Gmail.Star,!1,i):r.isImportant&&(l=y.a.VMLIFlag.P0),l&&this.plugin.performAction(y.a.PluginAction.Gmail.SetPriority,!1,i,l)}}},{key:"getSaveInfo",value:function(){var e=u()(g()(a.prototype),"getSaveInfo",this).call(this);e.viewState=this.viewState.get();var t=Bn.a.getFirstSelectedItem(this);return e.selectedItem=t?t.id:void 0,e}},{key:"setIgnoreRestoreScroll",value:function(){}},{key:"getSwipeMenuItems",value:function(e){var t=this,a=e.item;return{left:[{icon:"check",text:"Archive",backgroundColor:"#0c0",onActivated:function(){t.archiveEmailFromCurrentLabel(a)}}],right:[{icon:"format-align-left",backgroundColor:"#09d",onActivated:function(){bo.menus.openItemAutocomplete((function(e){t.plugin.moveEmailToItem(a,e.extraInfo)}))}},{icon:"delete",backgroundColor:"#a30",onActivated:function(){t.deleteEmailFromCurrentLabel(a)}}]}}},{key:"titleOfFirstItem",value:function(){return this.getItem().getParsedText()}},{key:"onTapAddItem",value:function(){bo.menus.openComposeEmail(bo.pluginManager.getPluginGmail())}},{key:"isOverviewVisibleInPane",value:function(){return!0}},{key:"getMinItemSize",value:function(){return y.a.EmailItemHeight}},{key:"widthOfDrag",value:function(e){return this.getWidth()}},{key:"viewModeIcon",value:function(){return"Date"===this.getViewMode()?"icon-access_time":"icon-exclamation"}},{key:"viewModeColor",value:function(){return y.a.Colors.Red}},{key:"changeView",value:function(e){this.viewMode.set(e),this.updateItems(!1,!0)}},{key:"getViewMode",value:function(){return this.viewState.get().viewMode}},{key:"setViewMode",value:function(e){var t=this.viewState.get();t.viewMode!==e&&this.viewState.set(Object.assign({},t,{viewMode:e}),!this.isFakePane)}},{key:"becomeReal",value:function(){this.getItem()&&this.setItem(this.getItem(),!0)}},{key:"setDocument",value:function(){}},{key:"getItemHeight",value:function(){return y.a.EmailItemHeight}},{key:"getStatusMessage",value:function(e){return this.paneTopText.get()?"":u()(g()(a.prototype),"getStatusMessage",this).call(this,e)}},{key:"getDeferredItem",value:function(e){for(var t=0,a=e.split("~"),n=0;n<a.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if("L"===a[n]){var r=a[n+1],i=a[n+2];if(r&&i){var o=this.plugin._getLabelByID(r,i);return o&&this.plugin.getVMLIForLabel(r,o)}}}}},{key:"itemLevelsDeep",value:function(e){return e.levelsDeep.get()-1}},{key:"getMobileIcon",value:function(){return"MdEmail"}}],[{key:"getPluginID",value:function(){return y.a.PluginID.Gmail}}]),a}(Ma.a),_()(xn.prototype,"archiveEmailFromCurrentLabel",[b.a],Object.getOwnPropertyDescriptor(xn.prototype,"archiveEmailFromCurrentLabel"),xn.prototype),_()(xn.prototype,"deleteEmailFromCurrentLabel",[b.a],Object.getOwnPropertyDescriptor(xn.prototype,"deleteEmailFromCurrentLabel"),xn.prototype),_()(xn.prototype,"removeItemFromCurrentLabel",[b.a],Object.getOwnPropertyDescriptor(xn.prototype,"removeItemFromCurrentLabel"),xn.prototype),xn),Wn=0,zn=function(){function e(t){i()(this,e),this._plugin=t,this._headers=[],this._mimeTree=void 0}return s()(e,[{key:"reset",value:function(){this._headers=[],this._mimeTree=void 0}},{key:"getMessageText",value:function(e){return e.decoded}},{key:"updateFromDraft",value:function(){var e=me()(pe.a.mark((function e(t,a,n,r,i,o){var s,l,u,c,d,h,f,p,g,v,y,k,_,b,w,S,D,P,I,E,C,x=this;return pe.a.wrap((function(e){for(var A=0;;){if(A++>5e3&&__infLoop&&__infLoop(A))throw new RangeError;switch(e.prev=e.next){case 0:if(this.reset(),this.addHeader("From",this._plugin._formatAddressText(n,r,!0)),this.addHeader("To",this._plugin._createAddressTextFromTokens(a.to,!0)),a.cc&&this.addHeader("Cc",this._plugin._createAddressTextFromTokens(a.cc,!0)),a.bcc&&this.addHeader("Bcc",this._plugin._createAddressTextFromTokens(a.bcc,!0)),this.addHeader("X-Mailer","Moo.do (https://moo.do)"),this.addHeader("Subject",m.default.encodeMIMEHeader(a.subject||"(no subject)")),a.inReplyTo){this.addHeader("In-Reply-To",a.inReplyTo.trim()),l=t.messages.indexOfWithProperty("messageID",a.inReplyTo);try{m.default.PAssert(1294,l>=0,"Must always be able to find the message being replied to")}catch(T){m.default.reportError(T)}s=t.messages[l]}return a.references?u=a.references:s&&(u=(m.default.isTempId(s.messageID)?"":s.messageID)+(s.references?" "+s.references:"")),u&&this.addHeader("References",u.trim()),e.next=12,Be.a.generatePlaintext(this.getMessageText(a));case 12:if(c=e.sent,(h=this._getAttachedResources(a)).length>0&&(d=this.createMimePart("multipart/mixed"),this.addMimePart(d)),!c){e.next=43;break}if(f=this.createMimePart("multipart/alternative"),this.addMimePart(f,d),p=this.createMimePart("text/plain",c,"7bit"),this.addMimePart(p,f),!((g=this._getInlineResources(a)).length>0)){e.next=39;break}v=0,y=this.createMimePart("multipart/related"),this.addMimePart(y,f),k=this.createMimePart("text/html",this.getMessageText(a),"7bit"),this.addMimePart(k,y),_=0;case 28:if(!(_<g.length)){e.next=37;break}if(!(v++>5e3&&__infLoop&&__infLoop(v))){e.next=31;break}throw new RangeError;case 31:b=g[_],(w=this.createResourcePart(b))&&this.addMimePart(w,y);case 34:++_,e.next=28;break;case 37:e.next=41;break;case 39:S=this.createMimePart("text/html",this.getMessageText(a),"7bit"),this.addMimePart(S,f);case 41:e.next=45;break;case 43:D=this.createMimePart(a.contentType||"text/html",this.getMessageText(a),"7bit"),this.addMimePart(D,d);case 45:if(!d||!i){e.next=59;break}P=0,I=0,E=function(){if(++I===h.length){for(var e=0,t=0,a=0;a<h.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=h[a];if(n.id&&m.default.isTempId(!n.id)){var r=x.createResourcePart(n);r&&x.addMimePart(r,d)}}o()}},C=0;case 50:if(!(C<h.length)){e.next=57;break}if(!(P++>5e3&&__infLoop&&__infLoop(P))){e.next=53;break}throw new RangeError;case 53:this._plugin.loadResource(t.id,a.id,h[C].cid,E);case 54:++C,e.next=50;break;case 57:e.next=60;break;case 59:setTimeout(o,0);case 60:case"end":return e.stop()}}}),e,this)})));return function(t,a,n,r,i,o){return e.apply(this,arguments)}}()},{key:"_getInlineResources",value:function(e){var t=[];return m.default.forEachValue(e.resources,(function(e){"inline"===e.disposition&&t.push(e)})),t}},{key:"_getAttachedResources",value:function(e){var t=[];return m.default.forEachValue(e.resources,(function(e){"attachment"===e.disposition&&e.id&&t.push(e)})),t}},{key:"addHeader",value:function(e,t){try{m.default.PAssert(1295,t.indexOf("\n")<0,"Header should not have a newline: "+e)}catch(n){m.default.reportError(n)}var a=t.trim().replace(/[\r\n]/g,"");this._headers.push(e+": "+a)}},{key:"_generateBoundary",value:function(){return"=========3141592653589moodo"+Date.now()+ ++Wn}},{key:"createMimePart",value:function(e,t,a,n){try{m.default.PAssert(1296,e,"Must supply a valid content type")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1297,void 0===t||a,"Must supply a valid content encoding")}catch(r){m.default.reportError(r)}return{boundary:this._generateBoundary(),contentType:e,content:t,contentEncoding:a,contentDisposition:n,children:[]}}},{key:"createResourcePart",value:function(e){try{m.default.PAssert(1298,e&&e.data,"Must have valid data loaded for resource to embed it in message")}catch(r){m.default.reportError(r)}var t;if(e&&e.data){var a=e.mimeType+'; name="'+e.cid+'"',n=e.disposition+'; filename="'+e.cid+'"';(t=this.createMimePart(a,e.data,e.contentEncoding,n)).contentID=e.cid}return t}},{key:"addMimePart",value:function(e,t){try{m.default.PAssert(1299,e,"Must supply a valid mime part")}catch(a){m.default.reportError(a)}if(t)t.children.push(e);else{try{m.default.PAssert(1300,!this._mimeTree,"Must not yet have a valid mime tree root")}catch(a){m.default.reportError(a)}this._mimeTree=e}}},{key:"_mimePartToBlob",value:function(e){var t="\r\n",a=[];function n(e,t){if(t){try{m.default.PAssert(1301,t.indexOf("\n")<0,"Header should not have a newline: "+e)}catch(r){m.default.reportError(r)}var n=t.trim().replace(/[\r\n]/g,"");a.push(e+": "+n)}}var r=e.contentType;(e.content||(r+='; boundary="'+e.boundary+'"'),n("MIME-Version","1.0"),n("Content-Type",r),n("Content-Transfer-Encoding",e.contentEncoding),n("Content-Disposition",e.contentDisposition),e.contentID)&&n("Content-ID","<"+e.contentID+">");if(t=a.join("\r\n").trim(),t+="\r\n",e.content)t+="\r\n"+e.content+"\r\n";else if(e.children&&e.children.length>0){for(var i=0,o=0;o<e.children.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t+="\r\n--"+e.boundary+"\r\n",t+=this._mimePartToBlob(e.children[o])}t+="--"+e.boundary+"--\r\n"}else t+="\r\n(no text)\r\n";return t}},{key:"generateBlob",value:function(){var e=this._headers.join("\r\n").trim();return e+="\r\n"+this._mimePartToBlob(this._mimeTree)}}]),e}();function qn(e){this._maxSize=e,this._groups=[],this._groupID=0,this._cursor=-1,this._performingActions=!1,this._actionsPreventUndo=!1,this._aggregateActions=0,this._currentAction=[],this._registeredOwners={},this._registeredActions={}}qn.prototype={registerOwner:function(e,t){try{m.default.PAssert(1265,e,"Must supply a valid owner object")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1266,!this._registeredOwners[t],"Must not double define an owner")}catch(a){m.default.reportError(a)}this._registeredOwners[t]=e,this._registeredActions[t]={}},registerAction:function(e,t,a){try{m.default.PAssert(1267,e,"Must provide a valid owner")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1268,t,"Must provide a valid action ID")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1269,this._registeredOwners[e],"Must have already registered a valid owner")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1270,!this._registeredActions[e][t],"Must not double define an action for an owner")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1271,a,"Must pass in a valid undo/redo descriptor")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1272,m.default.isFunction(a.undo),"Must provide a valid undo fn")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1273,m.default.isFunction(a.redo),"Must provide a valid redo fn")}catch(n){m.default.reportError(n)}this._registeredActions[e][t]=a},_getOwner:function(e){try{m.default.PAssert(1274,this._registeredOwners[e.ownerID],"Must have previously registered owner")}catch(t){m.default.reportError(t)}return this._registeredOwners[e.ownerID]},_getActionData:function(e){try{m.default.PAssert(1275,this._registeredOwners[e.ownerID],"Must have previously registered owner")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1276,this._registeredActions[e.ownerID][e.actionID],"Must have previously registered action for owner")}catch(t){m.default.reportError(t)}return this._registeredActions[e.ownerID][e.actionID]},_useNextGroupID:function(){return++this._groupID},_getCurrentGroup:function(){return this._groups[this._cursor]},_createGroup:function(e){return{id:this._useNextGroupID(),events:e||[]}},_pushNewGroup:function(e){var t=this._createGroup(e);this._groups.length>this._cursor+1&&(this._groups=this._groups.slice(0,this._cursor+1)),this._groups.push(t),this._cursor<this._maxSize-1&&this._cursor++,this._groups.length>this._maxSize&&this._trimAction()},_trimAction:function(){this._groups.shift()},isUndoableAction:function(){return!this._actionsPreventUndo},beginAction:function(e){if(0===this._aggregateActions){try{m.default.PAssert(1277,0===this._currentAction.length,"Current actions should be flushed")}catch(t){m.default.reportError(t)}this._actionsPreventUndo=!!e}this._aggregateActions++},runAction:function(e,t,a){var n={ownerID:e,actionID:t},r=this._getOwner(n);return this._getActionData(n).redo.apply(r,a)},performAction:function(e,t,a){try{m.default.PAssert(1278,this._aggregateActions>0,"Must be in a begin/end action block")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1279,a,"Must provide valid data for the action")}catch(n){m.default.reportError(n)}this._currentAction.push({ownerID:e,actionID:t,data:a})},performActions:function(e){if(e&&e.length>0){var t=0;this.beginAction();for(var a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e[a];this.performAction(n.ownerID,n.actionID,n.data)}this.endAction()}},endAction:function(){1===this._aggregateActions&&(this._currentAction.length>0&&(this._pushNewGroup(this._currentAction),this._currentAction=[]),this._actionsPreventUndo=!1),this._aggregateActions=Math.max(0,this._aggregateActions-1)},undoAction:function(){if(this._cursor>=0)for(var e=0,t=this._groups[this._cursor--],a=t.events.length-1;a>=0;a--){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=t.events[a],r=this._getOwner(n);this._getActionData(n).undo.apply(r,n.data.undoParams)}},redoAction:function(){if(this._cursor>=-1&&this._cursor<this._groups.length-1)for(var e=0,t=this._groups[++this._cursor],a=0;a<t.events.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=t.events[a],r=this._getOwner(n);this._getActionData(n).redo.apply(r,n.data.redoParams)}}};var Gn,Kn=qn;function Yn(e){var t=function(e,t){if("object"!==Qe()(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!==Qe()(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===Qe()(t)?t:String(t)}function Xn(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var Qn,Jn="EnsureLabelVMLI",Zn="CreateLabelVMLI",$n="MergeThread",er="SyncdMessage",tr="ErrorSyncdMessage",ar="UnsyncdMessage",nr="OldUnsyncdMessage",rr="MessagesSyncd",ir="MessageDataCached",or="snoozemail",sr="sendmail",lr=1,ur=2,cr=3,dr=4,hr=5,fr=6,pr=7,gr=8,mr=9,vr=10,yr=11,kr=12,_r=13,br=14,wr=15,Sr=16,Dr=17,Pr=18,Ir=19,Er=20,Cr="historyIDs",xr="labels",Ar="sendAs",Tr="Moo.do";!function(e){e.INBOX="INBOX",e.SPAM="SPAM",e.TRASH="TRASH",e.UNREAD="UNREAD",e.STARRED="STARRED",e.IMPORTANT="IMPORTANT",e.SENT="SENT",e.DRAFT="DRAFT",e.CHAT="CHAT",e.CATEGORY_PERSONAL="CATEGORY_PERSONAL",e.CATEGORY_SOCIAL="CATEGORY_SOCIAL",e.CATEGORY_PROMOTIONS="CATEGORY_PROMOTIONS",e.CATEGORY_UPDATES="CATEGORY_UPDATES",e.CATEGORY_FORUMS="CATEGORY_FORUMS"}(Qn||(Qn={}));var Mr,Lr={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},Or="==MOODO_ARCHIVED==",Rr="==MOODO_ALLMAIL==",Fr={PRI0:"Moo.do/Priority High",PRI1:"Moo.do/Priority Medium",PRI2:"Moo.do/Priority Low"},Nr="Moo.do/Handled",Br=["id","labelIds","messageID","draftID","decoded","mimeType","contentType","from","replyTo","to","cc","bcc","snippet","subject","date","internalDate","references","inReplyTo","listUnsubscribe","resources","cached","cachedError","modifiedOffline"],jr="multipart/signed",Ur="multipart/related",Hr="message/partial",Vr="multipart/mixed",Wr="multipart/report",zr="multipart/parallel",qr="multipart/alternative",Gr="multipart/digest",Kr="multipart/encrypted",Yr="multipart/voice-message",Xr="text/calendar",Qr="text/plain",Jr="text/html",Zr="text/watch-html",$r="text/x-watch-html";!function(e){e.Unknown="unknown",e.Inline="inline",e.FormData="form-data",e.Attachment="attachment"}(Mr||(Mr={}));var ei,ti="text/html;charset=utf-8",ai=["application","audio","example","image","message","model","video","text"],ni=[qr,Vr,Qr,Jr,Wr],ri=[Qr,Jr],ii=[Xr,Yr,Kr,Vr],oi=["modifiedOffline","pendingSend","isDeleted","dataLoaded"],si=/(?:[\"]?([^\"]*)[\"]?\s)?<(.*)>/g,li=/\'(.*)\'/g,ui=(Gn=function(e){d()(a,e);var t=Xn(a);function a(){var e;return i()(this,a),(e=t.call(this,y.a.PluginID.Gmail,"g","Email",!1,{s:!0}))._lastSyncTime=void 0,e._requiresOfflineAuth=!0,e.doesRender=!0,ve.a.binder(Pn()(e),"threadSortFn","threadSortPriorityFn","labelSortFn","labelVMLISortFn","sortFn","_fromComparator","_toComparator","_dateComparator","_messagesComparator","_shallowObjComparator","isGmailItem","_flushPendingDraftUpdates","driveMessageContentSync","_cleanupLocalCaches","_handleDeferredSnoozeTask","_cancelDeferredSnoozeTask","_persistRemoteSnoozeTask","_handleDeferredSendMailTask","_cancelDeferredSendMailTask","_persistRemoteSendMailTask"),e._emailCache={},e._labelsByID={},e._labelsByName={},e._priorityLabels={},e._creatingDrafts={},e._pendingDraftUpdates={},e._pendingThreadLoads={},e._loadThreadMutex=0,e._activeDraftUpdates=0,e._accountSettings={},e._pendingSends={},e._draftCache={},e._unsyncdMessages={},e._pendingSyncdMessages={},e._numUnsyncdMessages=0,e._numSyncdMessages=0,e._outstandingContentSync=!1,e.isLoadingThreads=new P.a(!1),e._undoStack=new Kn(10),e._generateUndoRedo(),e._syncingOfflineChanges=!1,e._draftFlushTimer=void 0,e.registerSetting("SyncTime","syncTime","t",!0,y.a.MaxGmailSyncTime.Free),e.registerSetting("ArchiveOnSchedule","archiveOnSchedule","a",!0,!1),e.registerSetting("ArchiveOnOrganize","archiveOnOrganize","o",!0,!1),e.registerSetting("InsertSignatureAboveReplies","insertSignatureAboveReplies","i",!0,!1),e.addTrackedStat(Jn),e.addTrackedStat(Zn),e.addTrackedStat($n),e.addTrackedStat(er),e.addTrackedStat(tr),e.addTrackedStat(ar),e.addTrackedStat(nr),e.addTrackedStat(rr),e.addTrackedStat(ir),e._threadCache=e.registerLocalCache(e.id,y.a.StorageType.IndexedDB,{noInMemoryCache:!0,metadataKeys:[Cr,xr,Ar],keyFieldsRN:["date","accountID","modifiedOffline"]}),e._rawCache=e.registerLocalCache(e.id+"Messages",y.a.StorageType.IndexedDB,{noInMemoryCache:!0,keyFieldsRN:["internalDate"]}),e.registerDeferredTaskType(or,e._handleDeferredSnoozeTask,e._cancelDeferredSnoozeTask,e._persistRemoteSnoozeTask),e.registerDeferredTaskType(sr,e._handleDeferredSendMailTask,e._cancelDeferredSendMailTask,e._persistRemoteSendMailTask),e._contentSyncTask=e.registerLowImpactTask("ContentSync",e.driveMessageContentSync),e._cacheCleanup=e.registerLowImpactTask("CacheCleanup",e._cleanupLocalCaches),e._lastCacheCleanup=0,e.declareProperty("accountID",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!1),e.declareProperty("from",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!1,void 0,e._fromComparator),e.declareProperty("to",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!1,void 0,e._toComparator),e.declareProperty("text",y.a.PluginLoad.Preview|y.a.PluginLoad.Inline),e.declareProperty("subject",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline),e.declareProperty("service",y.a.PluginLoad.Preview|y.a.PluginLoad.Inline,!1,"g"),e.declareProperty("date",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,new Date(0),e._dateComparator),e.declareProperty("lastModifiedDate",y.a.PluginLoad.Full,!0,void 0,e._dateComparator),e.declareProperty("modifiedOffline",y.a.PluginLoad.Full,!0,!1),e.declareProperty("pendingSend",y.a.PluginLoad.Full,!0,!1),e.declareProperty("messages",y.a.PluginLoad.Full,!0,[],e._messagesComparator),e.declareProperty("snippet",y.a.PluginLoad.Full),e.declareProperty("participants",y.a.PluginLoad.Runtime,!0,[]),e.declareProperty("subjectLower",y.a.PluginLoad.Runtime),e.declareProperty("count",y.a.PluginLoad.Runtime),e.declareProperty("dataLoaded",y.a.PluginLoad.Runtime,!0,!1),e.declareProperty("isDeleted",y.a.PluginLoad.Runtime,!0,!1),e.declareProperty("labelIds",y.a.PluginLoad.Runtime,!0,[]),e.declareProperty("hasAttachments",y.a.PluginLoad.Full,!0,!1),e.tempRootVMLI=j.a.createTempVMLI({id:"loading",text:"Loading emails"},{changeType:y.a.ChangeType.Auto}),e}return s()(a,[{key:"getType",value:function(){return y.a.PluginType.Email}},{key:"_attachMetadataFields",value:function(){return oi}},{key:"getDataPane",value:function(){try{m.default.PAssert(563,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(e){m.default.reportError(e)}return Vn}},{key:"getPaneIcon",value:function(){return"icon-mail_outline"}},{key:"getPanePriority",value:function(){return 97}},{key:"useItemStore",value:function(){return"Gmail"}},{key:"itemStoreOptions",value:function(){return{requireStoredEls:!1,enabledFilters:y.a.ItemStoreFilter.Priority,parserFn:rt.a.runParseSinglePlugin}}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"ensureAccountEmail",value:function(e){return"me"===e?this.getDefaultAccount():e}},{key:"getDefaultAccount",value:function(e){var t,a=ee.a.getDefaultAccountID();if(a){try{m.default.PAssert(564,"me"!==a,'Should never return "me" as a valid user')}catch(n){m.default.reportError(n)}this.hasSyncAccount(a)&&(t=a)}else if(!e){try{m.default.PAssert(565,!1,'Unable to get default account name, returning "me"')}catch(n){m.default.reportError(n)}t="me"}return t||(t=Object.keys(ee.a.authTokens)[0]),t||(t=a),t}},{key:"isSameAccount",value:function(e,t){return"me"===e&&(e=this.getDefaultAccount()),"me"===t&&(t=this.getDefaultAccount()),e===t}},{key:"areItemsFromSameAccount",value:function(e,t){var a=this.getAccountIDFromItem(e),n=this.getAccountIDFromItem(t);return this.isSameAccount(a,n)}},{key:"_handleAccountChanges",value:function(){var e=this,t=0,a=[];bo.PaneManager.runForEachPane((function(t){var n=e.getAccountIDFromItem(t.getItem());try{m.default.PAssert(566,n,"Missing Account ID: ",t.id,t.getItem().id)}catch(r){m.default.reportError(r)}e.hasSyncAccount(n)||a.push(t)}),this.getPaneType());for(var n=0;n<a.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;bo.PaneManager.removePane(a[n])}0===a.length&&bo.PaneManager.notifyPanes()}},{key:"onSyncAccountsChanged",value:function(e,t){var n=this;u()(g()(a.prototype),"onSyncAccountsChanged",this).call(this,e,t),bo.PaneUpdateBatcher.beginUpdateItems(),t.forEach((function(e){if(n._clearCachedData(e),n.getDefaultItemStore()){var t=n.getVMLIForAccount(e);t&&(t.deleteSelf(y.a.ChangeType.Local),t.isDestroyed()||t.getItemStore().destroyItem(t.id))}n._handleAccountChanges()})),e.forEach((function(e){n.isActive()&&(n._ensureLabel(e,Qn.INBOX,"Inbox",void 0,void 0,y.a.ChangeType.Local),n._ensureLabel(e,Qn.UNREAD,"Unread",void 0,void 0,y.a.ChangeType.Local),n._ensureLabel(e,Or,"Archived",void 0,void 0,y.a.ChangeType.Local),n._ensureLabel(e,Rr,"All Mail",void 0,void 0,y.a.ChangeType.Local),n._forceLabelSync((function(){n._forceThreadSync()}))),n._handleAccountChanges()})),bo.PaneUpdateBatcher.commitUpdateItems()}},{key:"_iterateSendAs",value:function(e){for(var t=0,a=this.getSyncAccounts(),n=!1,r=0;!n&&r<a.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.getAccountSetting(a[r],"sendAs");if(i)for(var o=0,s=0;s<i.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l=i[s];if(e(a[r],l)){n=!0;break}}else e(a[r])}}},{key:"getSignature",value:function(e){var t;return this._iterateSendAs((function(a,n){if(n&&n.sendAsEmail===e)return t=n.signature,!0})),t}},{key:"getReplyToAddress",value:function(e){var t;return this._iterateSendAs((function(a,n){if(n&&n.sendAsEmail===e&&n.replyToAddress)return t=n.replyToAddress,!0})),t}},{key:"_computeDisplayName",value:function(e,t){var a;return!t.displayName&&t.isPrimary||(a=t.displayName),a}},{key:"getDisplayName",value:function(e){var t,a=this;return this._iterateSendAs((function(n,r){if(r&&r.sendAsEmail===e)return t=a._computeDisplayName(n,r),!0})),t}},{key:"getDefaultSendingAccount",value:function(e){var t;return this._iterateSendAs((function(a,n){if(a===e&&n&&n.isDefault)return t=n.sendAsEmail,!0})),t||(t=e),t}},{key:"getDefaultFromInfo",value:function(e){var t=this.getDefaultSendingAccount(e);try{m.default.PAssert(567,t,"Must have found a valid account to send from")}catch(a){m.default.reportError(a)}return{text:this.getDisplayName(t),email:t}}},{key:"getSendingAccounts",value:function(e){var t=[];return this._iterateSendAs((function(a,n){e&&e!==a||(n?"pending"!==n.verificationStatus&&t.push(n.sendAsEmail):t.push(a))})),t}},{key:"getSyncAccount",value:function(e){var t;return this._iterateSendAs((function(a,n){if(n){if(n.sendAsEmail===e)return t=a,!0}else if(e===a)return t=a,!0})),t}},{key:"getSendingAccountInfo",value:function(e){var t,a=this;return this._iterateSendAs((function(n,r){if(r){if(r.sendAsEmail===e)return t={text:a._computeDisplayName(n,r),email:e},!0}else if(e===n)return!0})),t}},{key:"_getSettingsSendAs",value:function(e){var t=this,a=this.getSyncAccounts(),n=a.length,r=0,i={},o=function(t,a,o){t&&(i[a]=o.sendAs),++r===n&&e(i)};a.forEach((function(e){t._requestSettings(e,o)}))}},{key:"_requestSettings",value:function(e,t){var a=this,n=ea.a.fns("gmail").users.settings.sendAs.list.packedFn,r={userId:e};this._queueRemoteRequestMulti(e,n,r,(function(a){t(!0,e,a)}),(function(n){t(!1,e,n),a._notifyFailedRequest(e,n)}),void 0,Er)}},{key:"_emailComparator",value:function(e,t){var a=m.default.isString(e)?this.parseEmailAddress(e):e,n=m.default.isString(t)?this.parseEmailAddress(t):t;return a.text===n.text&&a.email===n.email}},{key:"_fromComparator",value:function(e,t){var a=!1;return e||t?e&&t&&(a=this._emailComparator(e,t)):a=!0,a}},{key:"_toComparator",value:function(e,t){var a=!1;return e||t?e&&t&&(a=this._emailComparator(e,t)):a=!0,a}},{key:"_dateComparator",value:function(e,t){var a=!1;if(e||t){if(e&&t){m.default.isString(e)&&(e=this.parseDateHeader(e)),m.default.isString(t)&&(t=this.parseDateHeader(t));try{m.default.PAssert(568,m.default.isDateValid(e),"Must be an old valid date to compare")}catch(n){m.default.reportError(n)}try{m.default.PAssert(569,m.default.isDateValid(t),"Must be a new valid date to compare")}catch(n){m.default.reportError(n)}m.default.isDateValid(e)&&m.default.isDateValid(t)&&(a=e.equals(t))}}else a=!0;return a}},{key:"_messagesComparator",value:function(e,t){var a=!0;if(e&&t)if(e.length===t.length)for(var n=0,r=0;a&&r<t.length;++r){var i=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var o=e[r],s=t[r],l=0;l<Br.length;++l){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var u=Br[l],c=!0;switch(u){case"from":c=this._fromComparator(o[u],s[u]);break;case"to":c=this._toComparator(o[u],s[u]);break;case"resources":case"listUnsubscribe":c=this._shallowObjComparator(o[u],s[u]);break;case"labelIds":c=s[u].equals(o[u]);break;case"date":case"internalDate":c=this._dateComparator(o[u],s[u]);break;default:c=o[u]===s[u]}c||(a=!1)}}else a=!1;else a=!1;return a}},{key:"_shallowObjComparator",value:function(e,t){var a=!1;if(e||t){if(e&&t)if(e===t)a=!0;else for(var n in a=!0,e)if(!t.hasOwnProperty(n)){a=!1;break}}else a=!0;return a}},{key:"onPaneActivated",value:function(e){this._offlineLoad(),e&&e()}},{key:"_offlineLoad",value:function(){var e=this,t=0;if(this._isOfflineLoaded)return!0;if(!m.default.isDemoMode()){var a=this._threadCache.getMetadata(Ar);a&&Object.keys(a).forEach((function(t){return e.setAccountSetting(t,"sendAs",a[t])}))}var n=this._threadCache.getMetadata(xr),r=this.getSyncAccounts();!m.default.isDemoMode()&&n||(n={}),n.me&&!n[this.getDefaultAccount()]&&(n[this.getDefaultAccount()]=n.me),bo.PaneUpdateBatcher.beginUpdateItems();for(var i=0;i<r.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=r[i];this._ensureLabel(o,Qn.INBOX,"Inbox",void 0,void 0,y.a.ChangeType.Local),this._ensureLabel(o,Qn.UNREAD,"Unread",void 0,void 0,y.a.ChangeType.Local),this._ensureLabel(o,Or,"Archived",void 0,void 0,y.a.ChangeType.Local),this._ensureLabel(o,Rr,"All Mail",void 0,void 0,y.a.ChangeType.Local);var s=n[o];if(s){for(var l in s)if(s.hasOwnProperty(l)){var u=s[l];if(!Qn[u.id]){var c=u.name||"LocalLabel"+Date.now();m.default.isString(u.oldestSync)&&(u.oldestSync=new Date(u.oldestSync)),this._ensureLabel(o,l,c,u.oldestSync,u,y.a.ChangeType.Local)}}for(var d in Qn)if(Qn.hasOwnProperty(d)){var h=Lr[d];this._ensureLabel(o,d,h,void 0,void 0,y.a.ChangeType.Local)}}this._ensureLabelVMLIsForAccount(o)}var f=+this._getMetadataSyncTime(),p=+this._getUnreadSyncTime(),g=this._threadCache.getPreloadData();if(g){m.default.isArray(g)&&(g=m.default.arrayToObjectById(g));try{m.default.PAssert(570,m.default.isObject(g),"Thread preload is not object")}catch(k){m.default.reportError(k)}this._isLoadingLocal=!0;var v=[];Object.keys(g).forEach((function(t){var a=g[t];try{m.default.PAssert(571,a,"Must always contain a valid entry when retreiving data from preload")}catch(k){m.default.reportError(k)}if(a&&(e.ensureThreadDates(a),function(t){var a=e.getEntryDateAsNumber(t.date);return r.indexOf(t.accountID)>=0&&a>p}(a))){var n=e.createEntryFromLocal(a.id,a);(e.isPriorityData(n)||+a.date>f)&&(e.cacheData(n.id,n)&&v.push(n),e._updateSpecialLabels(n))}})),this._isLoadingLocal=!1,this._isOfflineLoaded=!0,m.default.scheduleIdleTask((function(){var t=0;Se.a.beginBatch();for(var a=0;a<v.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e._checkUnsyncdMessageContent(v[a])}Se.a.commitBatch()}))}return bo.PaneUpdateBatcher.commitUpdateItems(),this.notifyPanesReadyForLoad(),!0}},{key:"isPriorityData",value:function(e){var t=!1;return(e.labelIds.indexOf(Qn.UNREAD)>=0||e.labelIds.indexOf(Fr.PRI0)>=0||e.labelIds.indexOf(Fr.PRI1)>=0||e.labelIds.indexOf(Fr.PRI2)>=0)&&(t=!0),t}},{key:"_load",value:function(){m.default.isDemoMode()||this.createRecurringTask("GmailThreadSync",{delay:m.default.minutes(15),minDelay:m.default.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:m.default.minutes(2),task:this.runThreadSync}),this.runSettingsSync(),this.createRecurringTask("GmailLabelSync",{delay:m.default.minutes(30),minDelay:m.default.minutes(15),runOnCreate:!0,pauseWhileIdle:!0,async:!0,task:this.runLabelSync})}},{key:"_notifyFailedRequest",value:function(e,t){try{m.default.PAssert(572,m.default.isString(e),"Must supply a valid accountID string")}catch(l){m.default.reportError(l)}if(t&&t.error)if(t.error.code===y.a.HTTPStatusCode.Unauthorized)bo.pluginManager.verifyAuthorization(e);else if(t.error.code===y.a.HTTPStatusCode.BadRequest)for(var a=0,n=t.error.errors,r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n[r].reason===y.a.GoogleError.FailedPrecondition&&(bo.toasts.pushMessage(y.a.MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}else if(t.error.code===y.a.HTTPStatusCode.Forbidden)for(var i=0,o=t.error.errors,s=0;s<o.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;o[s].reason===y.a.GoogleError.InsufficientPermissions&&(bo.toasts.pushMessage(y.a.MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}else t.error.code>=400&&t.error.code<500&&this._reportErrorCode(t.error.code)&&m.default.reportError(new Error("Failed Gmail request: "+t.error.code),t)}},{key:"_reportErrorCode",value:function(e){var t=!1;return e!==y.a.HTTPStatusCode.NotFound&&(t=!0),t}},{key:"_notifySendFailed",value:function(){bo.toasts.pushMessage(y.a.MessageID.EmailSendFail)}},{key:"_createResourceCID",value:function(e,t){var a=0;t||(t="UnnamedFile");for(var n=t,r=1;e[n];){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=t.split(".");n=i[0]+"_"+r,i[1]&&(n+="."+i[1]),r++}return n}},{key:"_createResource",value:function(e,t){try{m.default.PAssert(573,e,"Must have valid resources lib to add to")}catch(a){m.default.reportError(a)}return{cid:this._createResourceCID(e,t.name),id:m.default.generateTempId(),attID:void 0,realAttrID:void 0,data:void 0,size:void 0,thumbnail:void 0,uploader:void 0,link:void 0,error:!1,disposition:Mr.Attachment,parentType:Vr,mimeType:t.type,contentEncoding:void 0}}},{key:"_getLinkedResourceString",value:function(e){return'<a cid="'+e.cid+'" style="background-color:#f3f3f3;border:1px solid #dddddd;padding:8px;width:396px;font-weight:bold;min-height:18px;display:block;border-radius:3px;margin-bottom:8px;" href="'+e.link+'"><img style="vertical-align:top;border:none;margin-right:8px;" src="https://ssl.gstatic.com/docs/doclist/images/icon_10_generic_list.png">'+e.cid+"</a>"}},{key:"_removeAttachContent",value:function(){var e=me()(pe.a.mark((function e(t,a,n){var r,i;return pe.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return r=!1,e.next=3,Be.a.removeElementsByAttribute(a.decoded,"cid",n.cid);case 3:return i=e.sent,r=i!==a.decoded,a.decoded=i,e.abrupt("return",r);case 7:case"end":return e.stop()}}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"notifyAttachLinkedFile",value:function(e,t,a,n){var r={name:a.getField("title"),type:a.getField("mimeType")},i=this._createResource(t.resources,r);i.size=a.getField("fileSize"),i.link=a.getField("alternateLink"),this._shareAttachment(e,a.id,i,n),t.resources[i.cid]=i,e.notifyDataMutated(["hasAttachments"],y.a.ChangeType.Local)}},{key:"notifyAttachFiles",value:function(e,t,a,n){for(var r=0,i=this,o=e.getField("accountID"),s=0;s<a.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=a[s],u=this._createResource(t.resources,l);u.size=l.size,u.uploader=new xa.a(l,o,{named:y.a.DriveFolder.Attach},void 0,(function(){e.notifyDataMutated(["hasAttachments"],y.a.ChangeType.Local)}),function(t,a){t.error=!1,t.link=a.alternateLink,t.thumbnail=a.thumbnailLink,i._shareAttachment(e,a.id,t,n)}.bind(this,u),function(t){t.error=!0,bo.toasts.pushMessage({text:"There was an error uploading your attachment.",actionText:"RETRY",action:function(){t.uploader.resume()}}),e.notifyDataMutated(["hasAttachments"],y.a.ChangeType.Local),n&&n(!1)}.bind(this,u)),u.uploader.upload(),t.resources[u.cid]=u}e.notifyDataMutated(["messages"],y.a.ChangeType.Local)}},{key:"_shareAttachment",value:function(e,t,a,n){var r=this;try{m.default.PAssert(574,t,"Must supply a valid fileID to share")}catch(o){m.default.reportError(o)}try{m.default.PAssert(575,a,"Must supply a valid resource object to share")}catch(o){m.default.reportError(o)}var i=e.getField("accountID");bo.remoteAPI().drivePermissionsPublic(i,t,(function(){a.error=!1,e.notifyDataMutated(["messages"],y.a.ChangeType.Local),n&&n(!0)}),(function(i){a.error=!0,m.default.isHTTPStatusCode(i,y.a.HTTPStatusCode.Forbidden)?bo.toasts.pushMessage({text:"Sharing files/attachments in Google Drive is disabled on your domain. Please contact your domain administrator.",actionText:"OKAY",hold:!0}):bo.toasts.pushMessage({text:"There was an error sharing your attachment.",actionText:"RETRY",action:function(){r._shareAttachment(e,t,a,n)}}),e.notifyDataMutated(["hasAttachments"],y.a.ChangeType.Local),n&&n(!1)}))}},{key:"removeAttachFiles",value:function(){var e=me()(pe.a.mark((function e(t,a,n){var r;return pe.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:try{m.default.PAssert(576,n,"Must always specify a valid resource to remove from the message")}catch(o){m.default.reportError(o)}return r=!1,n.uploader&&!n.uploader.isDone()&&(n.uploader.cancel(),r=!0),a.resources[n.cid]&&delete a.resources[n.cid],e.next=6,this._removeAttachContent(t,a,n);case 6:if(e.t0=e.sent,e.t0){e.next=9;break}e.t0=r;case 9:return r=e.t0,t.notifyDataMutated(["messages"],y.a.ChangeType.Local),e.abrupt("return",r);case 12:case"end":return e.stop()}}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"notifyItemPropertyChanged",value:function(e,t,a,n){var r=e.getField("accountID");if(this.hasSyncAccount(r)){var i=this.attachmentIsArchived(e);if(t.belongsToItemStore(this.getDefaultItemStore()))t.dateCompleted&&!i&&this.archiveAttachment(e);if("priority"===n)this.getAttachmentPriority(e)!==t.getPriority()&&this.setAttachmentPriority(e,t.getPriority());else"isArchived"===n&&(i&&!t.isArchived()?this.unarchiveAttachment(e):!i&&t.isArchived()&&(this.archiveAttachment(e),bo.EmailPreview.isOpenOnThread(e)&&bo.EmailPreview.reset()))}}},{key:"createLabelString",value:function(e){if(!Lr[e.toUpperCase()])return e}},{key:"isDisplayTag",value:function(e,t){var a=!1;if(e&&e.shouldDisplayInMessageList()){var n=e.isCustom()||e.getLabelID()===Qn.DRAFT,r=t&&!t.isInbox()&&e.isInbox();if(n||r)switch(a=!0,e.getName()){case Fr.PRI0:case Fr.PRI1:case Fr.PRI2:case Nr:case Lr.STARRED:a=!1}}return a}},{key:"isDisplayHeader",value:function(e){var t=!1;this.isLabelItem(e)&&(this._getLabelIDFromItem(e)!==Qn.UNREAD&&(t=!0));return t}},{key:"isMessageDraft",value:function(e){return e&&e.labelIds&&e.labelIds.indexOf(Qn.DRAFT)>=0}},{key:"getDisplayTags",value:function(e,t,a){var n,r=0,i=e.getField("labelIds"),o=e.getField("accountID"),s=[];t&&(n=t.getItemLabel(!0));for(var l=0;l<i.length;++l){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=this._getLabelByID(o,i[l]);if(u&&this.isDisplayTag(u,n)){var c=a?u.getOutlineText():u.getDisplayText();c&&s.push(c)}}return s}},{key:"_getParticipantDisplayName",value:function(e,t){var a;if(this.isMyAccountID(e.email))a="me";else if(e.text)if(1===t)a=e.text;else{var n=e.text.split(" ");a=n&&n.length>0?n[0]:e.email}else a=e.email;return a}},{key:"getDisplayParticipants",value:function(e){for(var t=0,a=e.getField("participants"),n=[],r=0;r<a.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n.push(this._getParticipantDisplayName(a[r],a.length))}return n.join(", ")}},{key:"getDefaultDisplayItem",value:function(e){e=e||this.getDefaultAccount(!0);try{m.default.PAssert(577,e,"Should not be getting default display item without accountID")}catch(a){m.default.reportError(a)}if(e){var t=this._getLabelByID(e,Qn.INBOX);return t&&this.getVMLIForLabel(e,t)}return this.tempRootVMLI}},{key:"getEmailRootItem",value:function(){return An.getItems(y.a.FavoriteGroup.EmailRoot)[0]}},{key:"hasEmailRootItem",value:function(){return An.hasItems(y.a.FavoriteGroup.EmailRoot)}},{key:"createEmailRootItem",value:function(){try{m.default.PAssert(578,!this.hasEmailRootItem(),"Should not create email root if it already exists")}catch(a){m.default.reportError(a)}var e=bo.itemStoreManager.getDefaultItemStore().getRoot(),t=j.a.createVMLI({text:"Email"},{parent:e,changeType:y.a.ChangeType.AllLocal,documentOwner:void 0});return e.insertItem(t,0),bo.toasts.pushMessage({text:'A new "Email" item was created at the top of your document for snoozed emails.',action:y.a.MessageAction.Okay,hold:!0}),t}},{key:"ensureEmailItem",value:function(e){var t=0;this.hasEmailRootItem()||this.createEmailRootItem();for(var a,n=this.getEmailRootItem(),r=n.getItems(),i=0;i<r.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(r[i].getRawText()===e){a=r[i];break}}return a||(a=j.a.createVMLI({text:e},{parent:n,changeType:y.a.ChangeType.AllLocal,documentOwner:void 0}),n.insertItem(a,0)),a}},{key:"getWaitingItem",value:function(e){e(this.ensureEmailItem("Waiting"))}},{key:"allowTextEditing",value:function(e){var t=!0,a=this.getDefaultItemStore();return e.belongsToItemStore(a)&&(t=!1),t}},{key:"getDraftForMessage",value:function(e,t,a,n){try{m.default.PAssert(579,t,"Must have a valid thread ID")}catch(l){m.default.reportError(l)}try{m.default.PAssert(580,a,"Must have a valid message ID")}catch(l){m.default.reportError(l)}var r,i=this.getAttachment(t).getField("messages"),o=i.indexOfWithProperty("id",a);try{m.default.PAssert(581,o>=0,"Must be able to find the requested message")}catch(l){m.default.reportError(l)}var s=i[o+1];s&&s.labelIds.indexOf(Qn.DRAFT)>=0?r=s:(this.createDraft(e,t,a,{from:n}),r=i[o+1]);try{m.default.PAssert(582,r.labelIds.indexOf(Qn.DRAFT)>=0,"Must return a valid draft")}catch(l){m.default.reportError(l)}return r}},{key:"getDraftByID",value:function(e,t,a,n){var r,i;if(t){var o=(r=this.getAttachment(t)).getField("messages");i=a?this._getMessageFromAttachment(r,a):o[0];try{m.default.PAssert(583,i.labelIds.indexOf(Qn.DRAFT)>=0,"Must be a valid draft")}catch(l){m.default.reportError(l)}}else{var s=this.createDraft(e,void 0,void 0,n);i=(r=this.getAttachment(s.threadID)).getField("messages")[0]}return{attach:r,draftMsg:i}}},{key:"_notifyDraftMessage",value:function(e,t,a){var n=this;try{m.default.PAssert(584,e,"Must supply a valid accountID")}catch(r){m.default.reportError(r)}try{m.default.PAssert(585,t&&!m.default.isTempId(t),"Must supply a valid threadID: ",t)}catch(r){m.default.reportError(r)}try{m.default.PAssert(586,a&&!m.default.isTempId(a),"Must supply a valid messageID: ",a)}catch(r){m.default.reportError(r)}setTimeout((function(){n.hasCacheData(t)&&n._getRemoteDraftID(e,t,a,(function(e,a){a&&(m.default.log("DraftID: ",e),n.cacheData(t,n.getCacheData(t),!0,["messages"]))}))}),0)}},{key:"_getInlineResources",value:function(e){var t={};return m.default.forEachValue(e.resources,(function(e){e.disposition===Mr.Inline&&(t[e.cid]=Object.assign({},e))})),t}},{key:"createDraft",value:function(e,t,a,n){n=n||{};try{m.default.PAssert(587,!n.body||!n.decoded,"Must not supply both a decoded field and a body")}catch(f){m.default.reportError(f)}this.sendEvent("CreateDraft");var r=m.default.generateTempId(),i=n.from||this.getDefaultFromInfo(e),o=n.body||n.decoded||"";""===o&&(o=this.createSignature(i.email));var s,l,u={id:r,modifiedOffline:!0,labelIds:[Qn.DRAFT],messageID:void 0,raw:"",decoded:o,mimeType:Jr,contentType:ti,from:i,replyTo:this.getReplyToAddress(i.email),to:n.to||[],cc:n.cc||[],bcc:n.bcc||[],snippet:"",subject:n.subject||"",date:new Date,references:void 0,inReplyTo:void 0,resources:{}};if(t){s=this.getCacheData(t);try{m.default.PAssert(588,a,"When supplying a thread ID, must also supply a valid message ID")}catch(f){m.default.reportError(f)}var c=s.messages.indexOfWithProperty("id",a);try{m.default.PAssert(589,c>=0,"If requesting a reply to a message, it must exist in the thread")}catch(f){m.default.reportError(f)}var d=s.messages[c];if(d&&(u.references=(m.default.isTempId(d.messageID)?"":d.messageID)+(d.references?" "+d.references:""),m.default.isTempId(d.messageID)||(u.inReplyTo=d.messageID),u.resources=this._getInlineResources(d)),s.messages.splice(c+1,0,u),this.hasAttachment(t)){var h=this.getAttachment(t);this._updateAttachmentFromMessages(h,y.a.ChangeType.Local),h.notifyDataMutated(["messages"],y.a.ChangeType.Local)}this.addModifiedOffline(s,["messages"]),l=s}else s={id:r,accountID:e,modifiedOffline:!0,messages:[u],labelIds:[Qn.DRAFT],subject:n.subject||"",from:e},l=this.createEntryFromLocal(r,s),this.cacheData(l.id,l);return this.cacheThreadData(l.id,this.serializeExternalData(l)),{threadID:l.id,draftID:r,messageID:a}}},{key:"_updateDraftID",value:function(e,t,a){try{m.default.PAssert(590,a,"Must provide a valid set of draft info")}catch(i){m.default.reportError(i)}try{m.default.PAssert(591,a.id&&a.message,"Draft info must contain valid data")}catch(i){m.default.reportError(i)}var n=e.isLocalOnlyAttachment();n&&(this._handleThreadLabelUpdates(e.getData(),void 0,e.getData().labelIds),this.changeID(e,e.id,a.message.threadId),this._threadCache.removeEntry(t));var r=this._findDraft(e,t,a.id);if(r){r.id=a.message.id;try{m.default.PAssert(592,r.draftID===a.id,"Should have valid draft ID associated with the message")}catch(i){m.default.reportError(i)}this._draftCache[r.id]=a.id,n&&this.cacheData(e.id,e.getData()),this._pendingDraftUpdates[t]&&(this._pendingDraftUpdates[r.id]=this._pendingDraftUpdates[t],delete this._pendingDraftUpdates[t]),this._pendingSends[t]&&(this._pendingSends[r.id]=this._pendingSends[t],delete this._pendingSends[t]),e.notifyDataMutated(["messages"],y.a.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(e.getData()))}}},{key:"_updateDraftFromSend",value:function(e,t,a){try{m.default.PAssert(593,a,"Must provide a valid set of draft info")}catch(r){m.default.reportError(r)}try{m.default.PAssert(594,a.id&&a.threadId,"Draft info must contain valid data")}catch(r){m.default.reportError(r)}if(e.isLocalOnlyAttachment()){this._handleThreadLabelUpdates(e.getData(),void 0,e.getData().labelIds),this.changeID(e,e.id,a.threadId);try{m.default.PAssert(595,!m.default.isTempId(e.id),"After an ID change, should never be a temp ID")}catch(r){m.default.reportError(r)}this._threadCache.removeEntry(t)}var n=this._getMessageFromAttachment(e,t);n.id=a.id,n.labelIds=a.labelIds||[],this._updateAttachmentFromMessages(e,y.a.ChangeType.Remote),this._draftCache[n.id]=a.id,this._pendingDraftUpdates[t]&&(this._pendingDraftUpdates[n.id]=this._pendingDraftUpdates[t],delete this._pendingDraftUpdates[t]),this._pendingSends[t]&&(this._pendingSends[n.id]=this._pendingSends[t],delete this._pendingSends[t]),e.notifyDataMutated(["messages"],y.a.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(e.getData()))}},{key:"_createRemoteDraft",value:function(e,t,a){var n=this;if(this._creatingDrafts[t])a(!1,{msg:"Already creating remote draft for given message"});else{this._creatingDrafts[t]=!0;var r=this._getMessageFromAttachment(e,t);if(r)this._createRFC822Message(e.getData(),r,!1,(function(i){var o={raw:i};e.isLocalOnlyAttachment()||(o.threadId=e.id);var s=ea.a.fns("gmail").users.drafts.create.packedFn,l={userId:e.getField("accountID"),resource:{message:o}};n._queueRemoteRequestMulti(e.getField("accountID"),s,l,(function(i){n._attachmentHasMessage(e,t)&&(delete n._creatingDrafts[t],r.draftID=i.id,n.removeModifiedOffline(e.getData(),!1),n.removeModifiedOffline(r,!1),n._pendingDraftUpdates[t]&&n._notifyPendingDraftUpdate(),n._updateDraftID(e,t,i),n._updateIsSavingDrafts()),a(!0)}),(function(r){delete n._creatingDrafts[t],n._updateIsSavingDrafts(),a(!1,r),n._notifyFailedRequest(e.getField("accountID"),r)}),void 0,_r,{noBatch:!0})}));else{try{var i={length:e.getField("messages").length};m.default.reportError(new Error("Unable to find valid draft for creation"),i)}catch(o){m.default.reportError(o)}a(!1,{msg:"Unable to find requested message in thread"})}}}},{key:"_updateIsSavingDrafts",value:function(){m.default.isSavingDrafts=this._activeDraftUpdates>0||!m.default.isEmpty(this._pendingDraftUpdates)||!m.default.isEmpty(this._creatingDrafts)}},{key:"_notifyPendingDraftUpdate",value:function(e,t,a,n){e&&t&&(this._pendingDraftUpdates[t]={attach:e,draftID:a,lastUpdate:Date.now()},n&&this._runDraftUpdate(t)),this._draftFlushTimer&&clearTimeout(this._draftFlushTimer),this._draftFlushTimer=setTimeout(this._flushPendingDraftUpdates,12e3),this._updateIsSavingDrafts()}},{key:"_flushPendingDraftUpdates",value:function(){if(this.isOnline()){for(var e in this._pendingDraftUpdates)this._pendingDraftUpdates.hasOwnProperty(e)&&this._runDraftUpdate(e);this._draftFlushTimer=void 0}}},{key:"_runDraftUpdate",value:function(e){var t=this;if(!this._creatingDrafts[e]){var a=this._pendingDraftUpdates[e];try{m.default.PAssert(596,a,"Must be able to find valid draft info for pending draft update")}catch(n){m.default.reportError(n)}this._updateRemoteDraft(a.attach,e,a.draftID,!1,(function(e,a){e||m.default.isHTTPStatusCode(a,y.a.HTTPStatusCode.NotFound)?bo.toasts.clearMessage(y.a.MessageID.EmailUpdateFail):bo.toasts.pushMessage(y.a.MessageID.EmailUpdateFail),t._updateIsSavingDrafts()})),delete this._pendingDraftUpdates[e],this.sendEvent("UpdateDraft")}}},{key:"_clearPendingDraftUpdate",value:function(e,t){var a=this._pendingDraftUpdates[t];if(a){try{m.default.PAssert(597,a.attach===e,"Must have the correct attachment for the draft update")}catch(n){m.default.reportError(n)}delete this._pendingDraftUpdates[t]}}},{key:"hasPendingSends",value:function(){return Object.keys(this._pendingSends).length>0}},{key:"notifyPendingSend",value:function(e,t){try{m.default.PAssert(598,!this._pendingSends[t],"Must not have an already pending send for a message")}catch(a){m.default.reportError(a)}this._pendingSends[t]=e,m.default.isSendingEmail=!0}},{key:"notifySent",value:function(e,t){try{m.default.PAssert(599,this._pendingSends[t],"Must have a pending send to be sent")}catch(a){m.default.reportError(a)}delete this._pendingSends[t],this.hasPendingSends()||(m.default.isSendingEmail=!1)}},{key:"notifySendError",value:function(e,t){try{m.default.PAssert(600,this._pendingSends[t],"Must have a pending send to have an error")}catch(a){m.default.reportError(a)}delete this._pendingSends[t],this.hasPendingSends()||(m.default.isSendingEmail=!1)}},{key:"onShutdown",value:function(){clearTimeout(this._draftFlushTimer),this._draftFlushTimer=void 0,this._flushPendingDraftUpdates(),this._updateIsSavingDrafts()}},{key:"_getLinkedResources",value:function(e){var t=[];return m.default.forEachValue(e,(function(e){"attachment"===e.disposition&&e.link&&t.push(e)})),t}},{key:"_createDraftBody",value:function(e,t){var a;if(t){var n=this._getLinkedResources(t);if(n.length>0){for(var r=0,i="<br/><br/>",o=0;o<n.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i+=this._getLinkedResourceString(n[o])}a=e+'<var id="moodoAttach" moodoAttach="true">'+i+"</var>"}else a=e}else a=e;return a}},{key:"updateDraft",value:function(e,t,a,n,r,i,o){try{m.default.PAssert(601,m.default.isBoolean(r),"Must supply a valid bool for updateRemoteDraft")}catch(l){m.default.reportError(l)}try{m.default.PAssert(602,m.default.isBoolean(i),"Must supply a valid bool for forceFlush")}catch(l){m.default.reportError(l)}try{m.default.PAssert(603,m.default.isFunction(o),"Must supply a valid bool for cb")}catch(l){m.default.reportError(l)}var s=this._findDraft(e,t,a);if(s)return s.to=n.to,s.from=n.from||s.from,s.cc=n.cc,s.bcc=n.bcc,s.subject=n.subject,s.decoded=this._createDraftBody(n.decoded,s.resources),s.snippet=n.snippet?m.default.escape(n.snippet.substring(0,60)):"",s.modifiedOffline=!0,n.hasOwnProperty("resources")&&(s.resources=n.resources),this._updateAttachmentFromMessages(e,y.a.ChangeType.Local),e.notifyDataMutated(["messages"],y.a.ChangeType.Local),this.cacheThreadData(e.id,this.serializeExternalData(this.getCacheData(e.id))),!this._creatingDrafts[s.id]&&r?m.default.isTempId(s.id)?this._createRemoteDraft(e,s.id,(function(e,t){e||bo.toasts.pushMessage(y.a.MessageID.EmailUpdateFail),o(e,t)})):(this._notifyPendingDraftUpdate(e,s.id,s.draftID,i),o(!0)):(r&&this._notifyPendingDraftUpdate(e,s.id,s.draftID,i),o(!0)),this._updateIsSavingDrafts(),{threadID:e.id,draftID:s.draftID,messageID:s.id};try{m.default.PAssert(604,!1,"Unable to update draft as expected from compose window")}catch(l){m.default.reportError(l)}o(!1)}},{key:"_updateRemoteDraft",value:function(e,t,a,n,r){var i=this;try{m.default.PAssert(605,t&&a,"Must specify both a valid messageID and draftID"+t+"."+a)}catch(s){m.default.reportError(s)}var o=this._findDraft(e,t,a);try{m.default.PAssert(606,o&&o.labelIds.indexOf(Qn.DRAFT)>=0,"Must be updating a valid draft"+!!o)}catch(s){m.default.reportError(s)}try{m.default.PAssert(607,!this._creatingDrafts[o.id],"Should not send a remote update while the original draft is being created")}catch(s){m.default.reportError(s)}this._activeDraftUpdates++,this._getRemoteDraftID(e.getField("accountID"),e.id,o.id,(function(t){if(t)i._createRFC822Message(e.getData(),o,n,(function(a){var n=ea.a.fns("gmail").users.drafts.update.packedFn,s={userId:e.getField("accountID"),id:t,resource:{message:{raw:a,threadId:e.id}}};i._queueRemoteRequestMulti(e.getField("accountID"),n,s,(function(t){i._updateDraftID(e,o.id,t),i._activeDraftUpdates--,r(t)}),(function(t){r(void 0,t),i._activeDraftUpdates--,i._notifyFailedRequest(e.getField("accountID"),t)}),void 0,br)}));else{try{m.default.PAssert(608,!1,"Must always be able to get a valid draft ID when updating")}catch(s){m.default.reportError(s)}r(!1)}}))}},{key:"sendDraft",value:function(e,t,a,n,r){var i=this;try{m.default.PAssert(609,!e.getField("pendingSend"),"Should not try to re-send a message after it has already been sent")}catch(h){m.default.reportError(h)}var o=!0,s=this._findDraft(e,t,a),l=function(t,a){t?(e.updateField("pendingSend",!1),i.removeModifiedOffline(e.getData(),!1),i.removeModifiedOffline(s,!1),i.notifySent(e,s.id)):(m.default.isHTTPStatusCode(a,y.a.HTTPStatusCode.Network)||e.updateField("pendingSend",!1),i.notifySendError(e,s.id)),r(t,a)},u=this._verifyEmailRecipients(e,s.id,s.draftID);if(u||(u=this._verifyEmailAttachments(e,s.id,s.draftID)),u){o=!1;var c=bo.toasts.pushMessage({text:u.message,action:y.a.MessageAction.Okay});u.handleMessageFn&&u.handleMessageFn(c),this.notifyPendingSend(e,s.id),l(!1)}else if(!n){e.updateField("pendingSend",!0),this.notifyPendingSend(e,s.id);var d=!1;this.onEmailReadyToSend(s,(function(){try{m.default.PAssert(610,!d,"Should not send an email twice")}catch(h){m.default.reportError(h)}d||(d=!0,e.isLocalOnlyAttachment()||m.default.isTempId(s.id)?i._sendEmail(e,s.id,s.draftID,l):i._sendRemoteDraft(e,s.id,l))}))}return o}},{key:"onEmailReadyToSend",value:function(e,t){var a=this,n=!0;m.default.forEachValue(e.resources,(function(r){if(r.uploader&&!r.uploader.isDone())if(n=!1,r.uploader.hasError())try{m.default.PAssert(611,!1,"Attachment has error when sending.")}catch(i){m.default.reportError(i)}else r.uploader.notifyOnComplete(a.onEmailReadyToSend.bind(a,e,t))})),n&&setTimeout(t,0)}},{key:"_sendRemoteDraft",value:function(e,t,a){var n=this;this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(e,t),this._getRemoteDraftID(e.getField("accountID"),e.id,t,(function(r){if(r)n._updateRemoteDraft(e,t,r,!0,(function(t){if(t&&t.message){var i=ea.a.fns("gmail").users.drafts.send.packedFn,o={userId:e.getField("accountID"),resource:{id:r}};n._queueRemoteRequestMulti(e.getField("accountID"),i,o,(function(r){n._updateLocalDraftFromSend(e,t.message.id,r,a)}),(function(t){n._notifySendFailed(),a(!1,t),n._notifyFailedRequest(e.getField("accountID"),t)}),void 0,Sr)}else bo.toasts.pushMessage(y.a.MessageID.EmailUpdateFail),a(!1)}));else{try{m.default.PAssert(612,!1,"Must always be able to get a valid draft ID when sending")}catch(i){m.default.reportError(i)}bo.toasts.pushMessage(y.a.MessageID.EmailUpdateFail),a(!1)}}))}},{key:"_updateLocalDraftFromSend",value:function(e,t,a,n){try{m.default.PAssert(613,a,"Must have a valid draft result")}catch(i){m.default.reportError(i)}var r=this._getMessageFromAttachment(e,t);try{m.default.PAssert(614,r,"Must always be able to find the sent message")}catch(i){m.default.reportError(i)}r&&(this.removeModifiedOffline(e.getData(),!1),this.removeModifiedOffline(r,!1),this._updateDraftFromSend(e,t,a)),m.default.isDemoMode()||this._requestRemoteMessageData(e,a.id,(function(e){try{m.default.PAssert(615,e,"Should always be able to update message data after send")}catch(i){m.default.reportError(i)}})),n(!0)}},{key:"runDiscardDraft",value:function(e){var t=this._getDraftFromAttachment(e);this.discardDraft(e,t.id,t.draftID,(function(e){try{m.default.PAssert(616,e,"Must be able to discard message draft")}catch(t){m.default.reportError(t)}}))}},{key:"discardDraft",value:function(e,t,a,n){var r=e.getData(),i=this._findDraft(e,t,a),o=r.messages.indexOf(i);m.default.isTempId(t)?n(!0):this._deleteRemoteDraft(e,t,n);var s=r.messages[o];r.messages.splice(o,1),this._removeRemoteResources(s),this._updateAttachmentFromMessages(e,y.a.ChangeType.Local),this._clearPendingDraftUpdate(e,t),e.notifyDataMutated(["messages"],y.a.ChangeType.Local),this.cacheThreadData(r.id,this.serializeExternalData(r)),this.sendEvent("DiscardDraft")}},{key:"_removeRemoteResources",value:function(e){e&&m.default.forEachValue(e.resources,(function(e){e.uploader&&!e.uploader.isDone()&&e.uploader.cancel()}))}},{key:"_deleteRemoteDraft",value:function(e,t,a){var n=this;try{m.default.PAssert(617,!m.default.isTempId(t),"Should not try to remotely delete a local message")}catch(r){m.default.reportError(r)}this._getRemoteDraftID(e.getField("accountID"),e.id,t,(function(t){if(t){var i=ea.a.fns("gmail").users.drafts.delete.packedFn,o={userId:e.getField("accountID"),id:t};n._queueRemoteRequestMulti(e.getField("accountID"),i,o,(function(){a(!0)}),(function(t){m.default.isHTTPStatusCode(t,y.a.HTTPStatusCode.NotFound)?a(!0):a(!1,t),n._notifyFailedRequest(e.getField("accountID"),t)}),void 0,wr)}else{try{m.default.PAssert(618,!1,"Must always be able to get a valid draft ID when deleting")}catch(r){m.default.reportError(r)}bo.toasts.pushMessage(y.a.MessageID.EmailUpdateFail),a(!1)}}))}},{key:"_getRemoteDraftIDRaw",value:function(e,t,a,n){var r=ea.a.fns("gmail").users.drafts.list.packedFn,i={userId:e,q:"rfc822msgid:"+t};this._queuePagedRemoteRequestMulti(e,r,i,a,n,void 0,Dr,{getAllPages:!0,resultsField:"drafts"})}},{key:"_getRemoteDraftID",value:function(e,t,a,n){var r=this;try{m.default.PAssert(619,m.default.isString(e),"Must provide a valid accountID")}catch(s){m.default.reportError(s)}try{m.default.PAssert(620,m.default.isString(t)&&!m.default.isTempId(t),"Should not try to remotely get the draft ID of a local thread: ",t)}catch(s){m.default.reportError(s)}try{m.default.PAssert(621,m.default.isString(a)&&!m.default.isTempId(a),"Should not try to remotely get the draft ID of a local draft: ",a)}catch(s){m.default.reportError(s)}var i=this.getAttachment(t);try{m.default.PAssert(622,i,"Must be able to find a valid attachment for the requested thread")}catch(s){m.default.reportError(s)}if(!i)return setTimeout(n,0,void 0,!1);var o=this._getMessageFromAttachment(i,a);try{m.default.PAssert(623,o,"Must be able to find a valid message for the requested draft")}catch(s){m.default.reportError(s)}if(!o)return setTimeout(n,0,void 0,!1);if(o.draftID)setTimeout(n,0,o.draftID,!1);else{try{m.default.PAssert(624,o.messageID&&!m.default.isTempId(o.messageID),"Must have a valid messageID for the draft being queried")}catch(s){m.default.reportError(s)}if(!o.messageID||m.default.isTempId(o.messageID))return setTimeout(n,0,void 0,!1);this._getRemoteDraftIDRaw(e,o.messageID,(function(l){try{m.default.PAssert(625,l&&l.length<=1,"Must find only a single draft ID for a given message: ",l.length,o.messageID)}catch(s){m.default.reportError(s)}if(l){for(var u=0,c=0;c<l.length;++c){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var d=l[c];if(1===l.length||d.message.threadId===t){try{m.default.PAssert(626,!o.draftID||o.draftID===d.id,"Draft ID must either match or not be known yet")}catch(s){m.default.reportError(s)}o.draftID=d.id}}try{m.default.PAssert(627,0===l.length||o.draftID,"Draft returned but IDs dont match: ",l[0]?l[0].message.threadId:"NO RESULT",t,l[0]?l[0].message.id:"NO RESULT",a)}catch(s){m.default.reportError(s)}}return o.draftID?n(o.draftID,!0):o.contentType&&o.mimeType&&o.decoded?void r._createRemoteDraft(i,o.id,(function(a,i){return a?n(o.draftID,!0):(m.default.isHTTPStatusCode(i,y.a.HTTPStatusCode.NotFound)&&r._deleteCachedThread(e,t),n(void 0,!1))})):n(void 0,!1)}),(function(t){return r._notifyFailedRequest(e,t),n(void 0,!1)}))}}},{key:"_attachmentHasMessage",value:function(e,t){return e.getField("messages").indexOfWithProperty("id",t)>=0}},{key:"_getMessageFromAttachment",value:function(e,t){var a=e.getField("messages"),n=a.indexOfWithProperty("id",t);try{m.default.PAssert(628,n>=0,"Must have a vald draft")}catch(r){m.default.reportError(r)}return a[n]}},{key:"_getDraftFromAttachment",value:function(e,t){for(var a,n=0,r=e.getField("messages"),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r[i].labelIds.indexOf(Qn.DRAFT)>=0){t&&t!==r[i].draftID||(a=r[i]);break}}return a}},{key:"_findDraft",value:function(e,t,a){var n,r=e.getField("messages"),i=r.indexOfWithProperty("id",t);if(i>=0)n=r[i];else if(a){var o=r.indexOfWithProperty("draftID",a);o>=0&&(n=r[o])}try{m.default.PAssert(629,n,"Must be able to find a valid draft for given messageID/draftID")}catch(s){m.default.reportError(s)}return n}},{key:"isAttachmentDraftOnly",value:function(e){return!this.shouldUseNewPlugin(e)&&this.attachmentHasLabel(e,Lr.DRAFT)&&1===e.getField("messages").length}},{key:"archiveAttachment",value:function(e){try{m.default.PAssert(630,!this.attachmentIsArchived(e),"Should not archive a thread that is already archived")}catch(t){m.default.reportError(t)}return this.sendEvent("ArchiveMail"),this.removeLabelFromAttachment(e,Lr.INBOX)}},{key:"unarchiveAttachment",value:function(e){try{m.default.PAssert(631,this.attachmentIsArchived(e),"Thread must be unarchived to archive it")}catch(t){m.default.reportError(t)}return this.sendEvent("UnarchiveMail"),this.addLabelToAttachment(e,Lr.INBOX)}},{key:"trashAttachment",value:function(e){return this.sendEvent("TrashMail"),this.trashMail(e.getField("accountID"),e.id,void 0,(function(e){try{m.default.PAssert(632,e,"Must have successfully trashed remote thread")}catch(t){m.default.reportError(t)}}))}},{key:"untrashAttachment",value:function(e){return this.sendEvent("UntrashMail"),this.untrashMail(e.getField("accountID"),e.id,void 0,(function(e){try{m.default.PAssert(633,e,"Must have successfully untrashed remote thread")}catch(t){m.default.reportError(t)}}))}},{key:"markAttachmentRead",value:function(e){return this.sendEvent("MarkMailRead"),this.removeLabelFromAttachment(e,Lr.UNREAD)}},{key:"markAttachmentUnread",value:function(e){return this.sendEvent("MarkMailUnread"),this.addLabelToAttachment(e,Lr.UNREAD)}},{key:"snoozeAttachment",value:function(e,t){}},{key:"unsnoozeAttachment",value:function(e){this.sendEvent("UnsnoozeThread"),this.removeLabelFromAttachment(e,"Moo.do/Snoozed"),this.addLabelToAttachment(e,Lr.INBOX),this.addLabelToAttachment(e,Lr.UNREAD),this.cancelDeferredTask(e.id,or)}},{key:"_handleDeferredSnoozeTask",value:function(e){}},{key:"scheduleSendMessage",value:function(e,t,a){}},{key:"cancelSendMessage",value:function(e,t){var a=this;this.sendEvent("UnscheduleMail"),this.removeLabelFromAttachment(e,"Moo.do/ScheduledSend"),this._getRemoteDraftID(e.getField("accountID"),e.id,t,(function(e){e&&a.cancelDeferredTask(e,sr)}))}},{key:"_handleDeferredSendMailTask",value:function(e){var t=e.getData();try{m.default.PAssert(636,t.gidLinked,"Must have valid gidLinked")}catch(a){m.default.reportError(a)}try{m.default.PAssert(637,t.threadID,"Must have a valid threadID")}catch(a){m.default.reportError(a)}m.default.log("Handling deferred send mail: ",t)}},{key:"_ensureNoPriority",value:function(e){var t=y.a.VMLIFlag.None;return this.attachmentHasLabel(e,Fr.PRI0)&&(this.removeLabelFromAttachment(e,Fr.PRI0),t=y.a.VMLIFlag.P0),this.attachmentHasLabel(e,Fr.PRI1)&&(this.removeLabelFromAttachment(e,Fr.PRI1),t=y.a.VMLIFlag.P1),this.attachmentHasLabel(e,Fr.PRI2)&&(this.removeLabelFromAttachment(e,Fr.PRI2),t=y.a.VMLIFlag.P2),t}},{key:"getAttachmentPriority",value:function(e){return this._attachmentHasPriorityLabel(e,y.a.VMLIFlag.P0)&&y.a.VMLIFlag.P0||this._attachmentHasPriorityLabel(e,y.a.VMLIFlag.P1)&&y.a.VMLIFlag.P1||this._attachmentHasPriorityLabel(e,y.a.VMLIFlag.P2)&&y.a.VMLIFlag.P2||y.a.VMLIFlag.None}},{key:"setAttachmentPriority",value:function(e,t){this.sendEvent("SetMailPriority");var a=this._ensureNoPriority(e);switch(t){case y.a.VMLIFlag.None:break;case y.a.VMLIFlag.P0:this.addLabelToAttachment(e,Fr.PRI0);break;case y.a.VMLIFlag.P1:this.addLabelToAttachment(e,Fr.PRI1);break;case y.a.VMLIFlag.P2:this.addLabelToAttachment(e,Fr.PRI2);break;default:try{m.default.PAssert(638,!1,"Invalid priority for email attachment")}catch(n){m.default.reportError(n)}}return a}},{key:"markAttachmentStarred",value:function(e){return this.sendEvent("StarMail"),this.addLabelToAttachment(e,Lr.STARRED)}},{key:"markAttachmentUnstarred",value:function(e){return this.sendEvent("UnstarMail"),this.removeLabelFromAttachment(e,Lr.STARRED)}},{key:"attachmentHasLabelByID",value:function(e,t){return this.hasLabelByID(e.getField("accountID"),e.id,void 0,t)}},{key:"attachmentHasLabel",value:function(e,t){return this.hasLabel(e.getField("accountID"),e.id,void 0,t)}},{key:"attachmentHasFullLabel",value:function(e,t){return this.hasFullLabel(e.getField("accountID"),e.id,t)}},{key:"attachmentIsArchived",value:function(e){return this._threadIsArchived(e.getData())}},{key:"addLabelToAttachment",value:function(e,t){return this.addLabel(e.getField("accountID"),e.id,void 0,t)}},{key:"removeLabelFromAttachment",value:function(e,t){return this.removeLabel(e.getField("accountID"),e.id,void 0,t)}},{key:"trashMail",value:function(e,t,a,n){var r=this.getAttachment(t);if(this.isAttachmentDraftOnly(r)){var i=r.getField("messages")[0];this.discardDraft(r,i.id,i.draftID,n)}else this.removeLabelsFromMessage(e,t,a,[Qn.INBOX],y.a.ChangeType.Local),this.addLabelsToMessage(e,t,a,[Qn.TRASH],y.a.ChangeType.Local),m.default.isTempId(t)?n(!0):this._trashRemoteMail(e,t,a,n)}},{key:"untrashMail",value:function(e,t,a,n){this.removeLabelsFromMessage(e,t,a,[Qn.TRASH],y.a.ChangeType.Local),m.default.isTempId(t)?(this.addLabelsToMessage(e,t,a,[Qn.INBOX],y.a.ChangeType.Local),n(!0)):(this.addLabel(e,t,a,Lr.INBOX),this._untrashRemoteMail(e,t,a,n))}},{key:"moveItem",value:function(e,t,a){return a.insertItem(t,0),[t,a]}},{key:"unmoveItem",value:function(e,t,a){return a.removeChild(t,y.a.ChangeType.Local),[t,a]}},{key:"hasLabelByID",value:function(e,t,a,n){try{m.default.PAssert(639,!a,"We don't support individual queries on messages, only threads")}catch(r){m.default.reportError(r)}return this.getAttachment(t).getField("labelIds").indexOf(n)>=0}},{key:"hasLabel",value:function(e,t,a,n){try{m.default.PAssert(640,!a,"We don't support individual queries on messages, only threads")}catch(o){m.default.reportError(o)}var r=!1;if(!a){var i=this._getLabelByName(e,n,!0);i&&(r=this.hasLabelByID(e,t,a,i.getLabelID()))}return r}},{key:"hasFullLabel",value:function(e,t,a){var n=!1,r=this.getCacheData(t),i=this._getLabelByName(e,a,!0);if(i&&r){var o=0,s=r.messages;n=!0;for(var l=0;l<s.length;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(!s[l].labelIds||s[l].labelIds.indexOf(i.getLabelID())<0){n=!1;break}}}return n}},{key:"hasLabelLike",value:function(e,t,a){var n=!1,r=this.getAttachment(t);if(r){var i=r.getField("labelIds"),o=this._getAccountLib(e,this._labelsByID);if(o)for(var s=0,l=0;l<i.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var u=o[i[l]];u&&u.isMatched(a)&&(n=!0)}}return n}},{key:"addLabel",value:function(e,t,a,n){var r=this;try{m.default.PAssert(641,!a,"We currently do not support setting labels on single messages")}catch(s){m.default.reportError(s)}try{m.default.PAssert(642,!this.hasLabel(e,t,a,n),"Should not add the same label to a thread/message twice")}catch(s){m.default.reportError(s)}var i=this._getLabelByName(e,n,!0);if(i)i.isLocalOnly()?this._createRemoteLabel(e,n,!1,(function(a){if(a){try{m.default.PAssert(644,a,"Should have successfully created the remote label")}catch(s){m.default.reportError(s)}r._changeLabelID(e,i.getLabelID(),a.id),r._modifyRemoteThreadLabels(e,t,[a.id],void 0)}})):this._modifyRemoteThreadLabels(e,t,[i.getLabelID()],void 0);else{var o=m.default.generateTempId();i=this._ensureLabel(e,o,n,void 0,void 0,y.a.ChangeType.Local),this._ensureVMLIsForLabel(e,i),this._writeLabelsToCache(),this._createRemoteLabel(e,n,!1,(function(a){try{m.default.PAssert(643,a,"Should have successfully created the remote label")}catch(s){m.default.reportError(s)}a&&(r._changeLabelID(e,o,a.id),r._modifyRemoteThreadLabels(e,t,[a.id],void 0))}))}return this.addLabelsToMessage(e,t,a,[i.getLabelID()],y.a.ChangeType.Local),n}},{key:"removeLabel",value:function(e,t,a,n){try{m.default.PAssert(645,!a,"We currently do not support setting labels on single messages")}catch(i){m.default.reportError(i)}var r=this._getLabelByName(e,n);try{m.default.PAssert(646,r,"Must have valid label for gmail in order to remove")}catch(i){m.default.reportError(i)}return r&&(r.isLocalOnly()||this._modifyRemoteThreadLabels(e,t,void 0,[r.getLabelID()]),this.removeLabelsFromMessage(e,t,a,[r.getLabelID()],y.a.ChangeType.Local)),n}},{key:"_threadIsArchived",value:function(e){if(e){var t=e.labelIds.indexOf(Qn.INBOX)>=0,a=this.hasFullLabel(e.accountID,e.id,Lr.TRASH),n=e.labelIds.indexOf(Qn.SPAM)>=0,r=this.hasFullLabel(e.accountID,e.id,Lr.DRAFT);return!m.default.isTempId(e.id)&&!t&&!a&&!n&&!r}return!1}},{key:"_trashRemoteMail",value:function(e,t,a,n){var r,i,o=this;try{m.default.PAssert(647,!m.default.isTempId(t),"Should not try to trash local only threads")}catch(s){m.default.reportError(s)}try{m.default.PAssert(648,!a||!m.default.isTempId(a),"Should not try to trash local only messages")}catch(s){m.default.reportError(s)}a?(r=ea.a.fns("gmail").users.messages.trash.packedFn,i={userId:e,id:a}):(r=ea.a.fns("gmail").users.threads.trash.packedFn,i={userId:e,id:t});this._queueRemoteRequestMulti(e,r,i,(function(){n(!0)}),(function(t){n(!1,t),o._notifyFailedRequest(e,t)}),void 0,yr)}},{key:"_untrashRemoteMail",value:function(e,t,a,n){var r,i,o=this;try{m.default.PAssert(649,!m.default.isTempId(t),"Should not try to untrash local only threads")}catch(s){m.default.reportError(s)}try{m.default.PAssert(650,!a||!m.default.isTempId(a),"Should not try to untrash local only messages")}catch(s){m.default.reportError(s)}a?(r=ea.a.fns("gmail").users.messages.untrash.packedFn,i={userId:e,id:a}):(r=ea.a.fns("gmail").users.threads.untrash.packedFn,i={userId:e,id:t});this._queueRemoteRequestMulti(e,r,i,(function(){n(!0)}),(function(t){n(!1,t),o._notifyFailedRequest(e,t)}),void 0,yr)}},{key:"_createRemoteLabel",value:function(e,t,a,n){var r=this,i=ea.a.fns("gmail").users.labels.create.packedFn,o={userId:e,resource:{name:t,labelListVisibility:a?"labelHide":"labelShowIfUnread",messageListVisibility:a?"hide":"show"}};this._queueRemoteRequestMulti(e,i,o,(function(e){n&&n(e)}),(function(t){m.default.isHTTPStatusCode(t,y.a.HTTPStatusCode.Conflict)?n&&n(void 0,t):(n&&n(void 0,t),r._notifyFailedRequest(e,t))}),void 0,mr)}},{key:"_modifyRemoteThreadLabels",value:function(e,t,a,n,r){var i=this,o=ea.a.fns("gmail").users.threads.modify.packedFn,s={userId:e,id:t,resource:{addLabelIds:a,removeLabelIds:n}};this._queueRemoteRequestMulti(e,o,s,(function(e){r&&r(e)}),(function(t){r&&r(void 0,t),i._notifyFailedRequest(e,t)}),void 0,vr)}},{key:"_ensureRemoteLabel",value:function(e,t,a,n,r){this._getLabelByName(e,t,!0)?r&&r(!0):(this._ensureLabel(e,m.default.generateTempId(),t,void 0,void 0,a),this._createRemoteLabel(e,t,n,(function(e,t){try{m.default.PAssert(651,e||m.default.isHTTPStatusCode(t,y.a.HTTPStatusCode.Conflict),"Should have successful root label creation")}catch(a){m.default.reportError(a)}r&&r(!!e)})))}},{key:"_createInMemoryLabel",value:function(e,t,a,n,r,i){var o=new Nn(e,t,a,this._clampSyncTime(n),r,i);i[t]=o,this._ensureAccountLib(e,this._labelsByName)[a]=o}},{key:"_updateLabelName",value:function(e,t){var a=e.getAccountID(),n=this._getAccountLib(a,this._labelsByName);try{m.default.PAssert(652,n,"Must have valid label name bucket")}catch(r){m.default.reportError(r)}try{m.default.PAssert(653,n[e.getRawName()],"Must have valid label in bucket")}catch(r){m.default.reportError(r)}e.updateLabelName(t),delete n[e.getRawName()],n[t]=e}},{key:"_ensureLabel",value:function(e,t,a,n,r,i){try{m.default.PAssert(654,t.length>3,"Label ID should be longer than a couple of chars")}catch(l){m.default.reportError(l)}var o=this._ensureAccountLib(e,this._labelsByID);if(o[t])!m.default.isRemoteChange(i)&&o[t].hasName()||o[t].isSystemLabel()||this._updateLabelName(o[t],a);else{var s=this._getLabelByName(e,a,!0);if((null===s||void 0===s?void 0:s.isLocalOnly())&&!m.default.isTempId(t))this._changeLabelID(e,s.getLabelID(),t);else{try{m.default.PAssert(656,a||!m.default.isTempId(t),"All local labels must have a valid name")}catch(l){m.default.reportError(l)}this._createInMemoryLabel(e,t,a,n,r,o)}}return o[t]}},{key:"_clampSyncTime",value:function(e){return e&&e.isBefore(this._getMetadataSyncTime())?this._getMetadataSyncTime():e}},{key:"_ensureLabelVMLIsForAccount",value:function(e){var t=this._getAccountLib(e,this._labelsByID);for(var a in t)t.hasOwnProperty(a)&&this._ensureVMLIsForLabel(e,t[a])}},{key:"_changeLabelID",value:function(e,t,a){var n=this._getLabelByID(e,t);bo.PaneUpdateBatcher.beginUpdateItems(),null===n||void 0===n||n.updateLabelID(a),this._getAccountLib(e,this._labelsByID)[a]=n,this._ensureVMLIsForLabel(e,n),bo.PaneUpdateBatcher.commitUpdateItems(),this.forEachAttachment((function(e){var n=e.getField("labelIds");if(n.remove(t)>=0){for(var r=0,i=e.getField("messages"),o=0;o<i.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i[o].labelIds.remove(t)>=0&&i[o].labelIds.push(a)}n.push(a),e.updateField("labelIds",n)}}));var r=this.getDefaultItemStore(),i="L~"+e+"~"+t;r.hasItem(i)&&r.destroyItem(i)}},{key:"labelExists",value:function(e,t){var a=this._getAccountLib(e,this._labelsByID);return a&&a[t]}},{key:"_getLabelByID",value:function(e,t){try{m.default.PAssert(657,e,"Must supply a valid accountID")}catch(r){m.default.reportError(r)}try{m.default.PAssert(658,t,"Must supply a valid labelID")}catch(r){m.default.reportError(r)}var a=this._ensureAccountLib(e,this._labelsByID);if(!a[t]){var n=Lr[t];n&&this._createInMemoryLabel(e,t,n,void 0,void 0,a)}return a[t]}},{key:"_getLabelByName",value:function(e,t,a){try{m.default.PAssert(659,this.hasSyncAccount(e),"Must provide a valid accountID with a matching sync account: "+e)}catch(i){m.default.reportError(i)}var n,r=this._getAccountLib(e,this._labelsByName);try{m.default.PAssert(660,a||r,"Unable to find labelsByName for given account: "+e)}catch(i){m.default.reportError(i)}return r&&(n=r[t]),n}},{key:"_getPriorityLabel",value:function(e,t){var a=this._ensureAccountLib(e,this._priorityLabels);if(!a[t]){var n;switch(t){case y.a.VMLIFlag.P0:n=Fr.PRI0;break;case y.a.VMLIFlag.P1:n=Fr.PRI1;break;case y.a.VMLIFlag.P2:n=Fr.PRI2;break;default:try{m.default.PAssert(661,!1,"Invalid priority for email attachment")}catch(r){m.default.reportError(r)}}a[t]=this._getLabelByName(e,n)}return a[t]}},{key:"_getAccountLib",value:function(e,t){try{m.default.PAssert(662,e,"Must provide valid accountID")}catch(r){m.default.reportError(r)}try{m.default.PAssert(663,t,"Must provide valid lib object")}catch(r){m.default.reportError(r)}var a;if(e)if(t[e])a=t[e];else for(var n in t)n.toLowerCase()===e.toLowerCase()&&(a=t[n]);return a}},{key:"_ensureAccountLib",value:function(e,t){try{m.default.PAssert(665,e,"Must provide valid accountID")}catch(r){m.default.reportError(r)}try{m.default.PAssert(666,t,"Must provide valid lib object")}catch(r){m.default.reportError(r)}var a;if(e)if(t[e=e.toLowerCase()])a=t[e];else{for(var n in t)if(t.hasOwnProperty(n))try{m.default.PAssert(667,!e||!n||n.toUpperCase()!==e.toUpperCase(),"Dupe accountID found with non-matching case: "+e,n)}catch(r){m.default.reportError(r)}a=t[e]={}}return a}},{key:"_deleteAccountLib",value:function(e,t){try{m.default.PAssert(668,e,"Must provide valid accountID")}catch(a){m.default.reportError(a)}try{m.default.PAssert(669,t,"Must provide valid lib object")}catch(a){m.default.reportError(a)}try{m.default.PAssert(670,t[e],"Trying to delete an account lib that doesnt exist: ",e)}catch(a){m.default.reportError(a)}delete t[e]}},{key:"_attachmentHasPriorityLabel",value:function(e,t){var a=this._getPriorityLabel(e.getField("accountID"),t);return!!a&&e.getField("labelIds").indexOf(a.getLabelID())>=0}},{key:"getLabels",value:function(e,t,a){var n=[],r=t.toLowerCase(),i=0,o=this._labelsByID[e];for(var s in o)if(o.hasOwnProperty(s)){var l=o[s];if(l.matchesText(r)&&this.isDisplayTag(l)&&n.indexOf(l)<0&&(n.push(l),i++),a&&i>=a)break}return n}},{key:"_writeLabelsToCache",value:function(){var e={};for(var t in this._labelsByID)if(this._labelsByID.hasOwnProperty(t)){e[t]={};var a=this._labelsByID[t];for(var n in a)a.hasOwnProperty(n)&&(e[t][n]=a[n].getSaveData())}this._threadCache.setMetadata(xr,e)}},{key:"_writeSendAsToCache",value:function(){var e={};this._iterateSendAs((function(t,a){e[t]||(e[t]=[]),e[t].push(a)})),this._threadCache.setMetadata(Ar,e)}},{key:"runLabelSync",value:function(){var e=me()(pe.a.mark((function e(t){var a=this;return pe.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,m.default.runSingletonPromise("runLabelSync",(function(){return new Promise((function(e){var t=a.getSyncAccounts(),n=t.length,r=0,i=0,o=function(t,o){if(a.hasSyncAccount(t)){bo.PaneUpdateBatcher.beginUpdateItems();var s={};if(o)for(var l=0,u=0,c=0;c<o.length;++c){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var d,h=o[c];s[h.id]=!0,d="system"===h.type&&Lr[h.id]?Lr[h.id]:h.name,a._ensureLabel(t,h.id,d,void 0,h,y.a.ChangeType.Remote)}a._ensureLabelVMLIsForAccount(t),a._ensureRemoteLabel(t,Tr,y.a.ChangeType.Local,!0),a._ensureRemoteLabel(t,Fr.PRI0,y.a.ChangeType.Local,!0),a._ensureRemoteLabel(t,Fr.PRI1,y.a.ChangeType.Local,!0),a._ensureRemoteLabel(t,Fr.PRI2,y.a.ChangeType.Local,!0),a._ensureRemoteLabel(t,Nr,y.a.ChangeType.Local,!0),a._ensureRemoteLabel(t,"Moo.do/Scheduled",y.a.ChangeType.Local,!0);var f=a._getAccountLib(t,a._labelsByID);if(f)for(var p in f)if(f.hasOwnProperty(p)){var g=f[p];if(g.isLocalOnly()){try{m.default.PAssert(671,g.hasName(),"Label must have a valid name to be created on remote")}catch(v){m.default.reportError(v)}a._createRemoteLabel(t,g.getName(),!1,function(e,a){a&&!a.error&&this._changeLabelID(t,e,a.id)}.bind(a,p))}else 0!==i||s[p]||g.isSystemOrSpecialLabel()||m.default.isDemoMode()||g.delete()}bo.PaneUpdateBatcher.commitUpdateItems(),a._writeLabelsToCache(),i+r===n&&e()}else e()},s=function(e,t){i++,o(e),a._notifyFailedRequest(e,t)},l=function(e,t){t?(r++,o(e,t.labels)):s(e,t)},u=ea.a.fns("gmail").users.labels.list.packedFn;t.forEach((function(e){var t={userId:e,timeoutMS:0};a._queueRemoteRequestMulti(e,u,t,l.bind(a,e),s.bind(a,e),void 0,gr)}))}))}));case 2:t&&t();case 3:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getDescriptorForItem",value:function(e){try{m.default.PAssert(673,e,"Must have a valid item to get a description for")}catch(i){m.default.reportError(i)}var t=this.getAccountIDFromItem(e),a=this._getLabelIDFromItem(e),n={accountID:t,labelID:a,threadID:this._getThreadIDFromItem(e)};if(t&&a){var r=this._getLabelByID(t,a);n.labelName=null===r||void 0===r?void 0:r.getName()}return n}},{key:"handleItemChange",value:function(e,t){var a=this,n=this.getDescriptorForItem(e);if(n.labelID){try{m.default.PAssert(674,n.accountID,"Must specify a valid accountID")}catch(r){m.default.reportError(r)}setTimeout((function(){a._getThreadsForLabel(n.accountID,a._getLabelByID(n.accountID,n.labelID),e,!1,(function(e){try{m.default.PAssert(675,e,"Expected success when querying for remote threads")}catch(r){m.default.reportError(r)}t&&t()}))}),0)}}},{key:"handleViewModeChange",value:function(e,t){if(t===y.a.GmailViewMode.Priority){var a=this.getAccountIDFromItem(e);try{m.default.PAssert(676,a,"Missing Account ID: ",e.id)}catch(o){m.default.reportError(o)}var n=this._getLabelByName(a,Fr.PRI0);n&&this._getThreadsForLabel(a,n,void 0,!1,(function(e){try{m.default.PAssert(677,e,"Expected success when querying for remote PRI0 threads")}catch(o){m.default.reportError(o)}}));var r=this._getLabelByName(a,Fr.PRI1);r&&this._getThreadsForLabel(a,r,void 0,!1,(function(e){try{m.default.PAssert(678,e,"Expected success when querying for remote PRI1 threads")}catch(o){m.default.reportError(o)}}));var i=this._getLabelByName(a,Fr.PRI2);i&&this._getThreadsForLabel(a,i,void 0,!1,(function(e){try{m.default.PAssert(679,e,"Expected success when querying for remote PRI2 threads")}catch(o){m.default.reportError(o)}}))}}},{key:"_getThreadsForLabel",value:function(e,t,a,n,r){var i=this;try{m.default.PAssert(680,t,"Must provide a valid label to get thrads for")}catch(c){m.default.reportError(c)}var o="-in:chats -in:spam label:"+t.getName(),s=t.getOldestSync();m.default.isDateValid(s)&&(o+=" before:"+Math.floor(s.getTime()/1e3));var l=new Date,u=new En((function(t){if(t){var a=i._addRemoteEntry(e,t);a.internalDate.isBefore(l)&&(l=a.internalDate),i.cacheThreadData(a.id,i.serializeExternalData(a))}}),(function(e){t.setOldestSync(l),i._writeLabelsToCache(),r(e)}));this._requestRemoteThreads(e,kr,a,o,n?999:25,void 0,u.getEntryCB(),u.getDoneCB())}},{key:"createOutlinePaneItem",value:function(e,t){for(var a=0,n=t.getItemStore(),r=e.getRawText(),i=e.getAttachmentByPlugin(this.id),o=this.getDisplayTags(i,void 0,!0),s=0;s<o.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;r+=" #"+o[s]}return n.createItem(m.default.generateTempId(),r,t.id,void 0,y.a.ChangeType.Local,t.getDocumentOwner())}},{key:"refreshCurrentView",value:function(e){this._forceThreadSync(e)}},{key:"goOnline",value:function(){this._forceThreadSync(this._notifyPendingDraftUpdate)}},{key:"loadInitialData",value:function(){u()(g()(a.prototype),"loadInitialData",this).call(this),m.default.isDemoMode()&&this._forceThreadSync()}},{key:"_forceThreadSync",value:function(e){this.hasRecurringTask("GmailThreadSync")&&this.getRecurringTask("GmailThreadSync").forceUpdate(e)}},{key:"_forceLabelSync",value:function(e){this.hasRecurringTask("GmailLabelSync")&&this.getRecurringTask("GmailLabelSync").forceUpdate(e)}},{key:"_syncOfflineChanges",value:function(){try{m.default.PAssert(681,!1,"Currently we do not perform a sync offline step for Gmail changes")}catch(e){m.default.reportError(e)}this._syncingOfflineChanges||(this._syncingOfflineChanges=!0)}},{key:"_cleanupLocalCaches",value:function(e){var t=this;try{m.default.PAssert(682,m.default.isFunction(e),"Must have a valid callback when cleaning local caches")}catch(s){m.default.reportError(s)}var a=0,n=0,r=+this._getFullSyncTime(),i=this._getUnreadSyncTime(),o=this._getMetadataSyncTime();this._threadCache.getFilterEntries((function(e){if(e&&e.date)return t.getEntryDateAsNumber(e.date)<r})).then((function(r){if(r)for(var s=0,l=0;l<r.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var u=r[l],c=!0;if(t.ensureThreadDates(u),!u.date.isBefore(i))for(var d=0,h=0;c&&h<u.messages.length;++h){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var f=u.messages[h];if(t.isPriorityData(f)){c=!1;break}}if(c){var p=0;u.date.isBefore(o)&&(t._threadCache.removeEntry(u.id),a++);for(var g=0;g<u.messages.length;++g){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var v=u.messages[g];t._rawCache.removeEntry(v.id),n++}}}m.default.log("Gmail Cache Pruned: ",a,n),e(!1)}))}},{key:"_cleanupRawCache",value:function(e){var t=this;try{m.default.PAssert(683,m.default.isFunction(e),"Must have a valid callback when cleaning local caches")}catch(r){m.default.reportError(r)}var a=0,n=+this._getUnreadSyncTime();this._rawCache.getFilterEntries((function(e){return!e.internalDate||t.getEntryDateAsNumber(e.internalDate)<n})).then((function(n){if(n)for(var r=0,i=0;i<n.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=n[i];t._rawCache.removeEntry(o.id),a++}m.default.log("Raw Cache Pruned: ",a),e()}))}},{key:"getAccountSetting",value:function(e,t){var a,n=this._getAccountLib(e,this._accountSettings);return n&&(a=n[t]),a}},{key:"setAccountSetting",value:function(e,t,a){var n,r=this._ensureAccountLib(e,this._accountSettings);return n=r[t],r[t]=a,n}},{key:"runSettingsSync",value:function(){var e=this;this._getSettingsSendAs((function(t){for(var a in t)t.hasOwnProperty(a)&&e.setAccountSetting(a,"sendAs",t[a]);e._writeSendAsToCache()}))}},{key:"_getSyncDays",value:function(){var e=this.getSetting(this.Settings.SyncTime);bo.billingManager.isTrialOver()&&(e=y.a.MaxGmailSyncTime.Free);var t=bo.pluginManager.getCacheSizeRatio();return t<1&&t>0&&(e=Math.round(e*t)),e}},{key:"_getMetadataSyncDays",value:function(){var e=Math.max(this.getSetting(this.Settings.SyncTime),15),t=bo.pluginManager.getCacheSizeRatio();return t<.5&&(e=Math.max(Math.round(e*t),7)),e}},{key:"_getUnreadSyncTime",value:function(){var e=this._getSyncDays();return(new Date).addDays(-1.5*e)}},{key:"_getFullSyncTime",value:function(){var e=this._getSyncDays();return(new Date).addDays(-e)}},{key:"_getMetadataSyncTime",value:function(){var e=this._getMetadataSyncDays();return(new Date).addDays(-e)}},{key:"_getFullSyncTimeStr",value:function(){return this._getSyncDays()+"d"}},{key:"_getMetadataSyncTimeStr",value:function(){return this._getMetadataSyncDays()+"d"}},{key:"runThreadSync",value:function(){var e=me()(pe.a.mark((function e(t){var a,n=this;return pe.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,m.default.runSingletonPromise("runThreadSync",(function(){return new Promise((function(e){var t,a=0,r=0,i=[],o=[],s=function(s,l,u){s?(a++,i.push(l)):(r++,!m.default.isHTTPStatusCode(u,y.a.HTTPStatusCode.Network)&&n.isOnline()&&o.push(l)),r+a===t&&(o.length>0?bo.toasts.pushMessage(y.a.MessageID.EmailSyncFail):bo.toasts.clearMessage(y.a.MessageID.EmailSyncFail),i.length>0&&n._contentSyncTask.requestRun(),e(0===o.length))},l=!1,u=n._getSyncDays();void 0!==n._lastSyncTime&&n._lastSyncTime<u&&(l=!0,m.default.log("Forcing full gmail sync")),n._lastSyncTime=u;var c=n._threadCache.getMetadata(Cr),d=n.getSyncAccounts();t=d.length,d.forEach((function(e){var t;if(!l){var a=c?c[e]:void 0;t=a?a.historyID:void 0}n.performThreadSync(e,t,s)}))}))}));case 2:a=e.sent,t&&t(a);case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"syncAllAccountsFull",value:function(e){this._lastSyncTime=0,this.runThreadSync(e)}},{key:"performThreadSync",value:function(e,t,a){t?(Date.now()-this._lastCacheCleanup>m.default.hours(12)&&(this._lastCacheCleanup=Date.now(),this._cacheCleanup.notifyWorkAvailable()),this._performThreadSyncPartial(e,t,a)):this._performThreadSyncFull(e,a)}},{key:"_performThreadSyncFull",value:function(e,t){var a,n=this,r="-in:chats -in:spam newer_than:"+this._getMetadataSyncTimeStr(),i=this.getDefaultItemStore(),o=this._ensureVMLIsForAccount(e,i);o.clearPaginationToken();var s=new En((function(t){if(t&&(!a&&t.historyId&&(a=t.historyId,n.setHistoryID(e,a)),n._shouldCacheThread(t))){var r=n._addRemoteEntry(e,t);n.cacheThreadData(r.id,n.serializeExternalData(r))}}),(function(a){t(a,e)}));this._requestRemoteThreads(e,lr,o,r,999,0,s.getEntryCB(),s.getDoneCB()),this.runLabelSync((function(){var t=n._getLabelByName(e,Nr,!0);t&&n._getThreadsForLabel(e,t,void 0,!0,(function(e){try{m.default.PAssert(684,e,"Expect to be able to get all handled messages")}catch(t){m.default.reportError(t)}})),n._getThreadsForLabel(e,n._getLabelByID(e,Qn.UNREAD),void 0,!1,(function(e){try{m.default.PAssert(685,e,"Expect to be able to get all unread messages")}catch(t){m.default.reportError(t)}}))}))}},{key:"_compactHistoryEntries",value:function(e){for(var t=0,a={messages:{},messagesAdded:{},messagesDeleted:{},labelsAdded:{},labelsRemoved:{}},n=0;n<e.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[n],i=0;if(r.messagesAdded){for(var o=0,s=0;s<r.messagesAdded.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l=r.messagesAdded[s].message,u=a.messagesAdded[l.threadId];u||(u=a.messagesAdded[l.threadId]=[]),u.indexOf(l.id)<0&&u.push(l.id)}i+=r.messagesAdded.length}if(r.messagesDeleted){for(var c=0,d=0;d<r.messagesDeleted.length;++d){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var h=r.messagesDeleted[d].message,f=a.messagesDeleted[h.threadId];f||(f=a.messagesDeleted[h.threadId]=[]),f.indexOf(h.id)<0&&f.push(h.id)}i+=r.messagesDeleted.length}if(r.labelsAdded){for(var p=0,g=0;g<r.labelsAdded.length;++g){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var v=r.labelsAdded[g].message,y=a.labelsAdded[v.threadId];y||(y=a.labelsAdded[v.threadId]={}),y[v.id]||(y[v.id]=[]),y[v.id].pushOnlyUniques(r.labelsAdded[g].labelIds)}i+=r.labelsAdded.length}if(r.labelsRemoved){for(var k=0,_=0;_<r.labelsRemoved.length;++_){if(k++>5e3&&__infLoop&&__infLoop(k))throw new RangeError;var b=r.labelsRemoved[_].message,w=a.labelsRemoved[b.threadId];w||(w=a.labelsRemoved[b.threadId]={}),w[b.id]||(w[b.id]=[]),w[b.id].pushOnlyUniques(r.labelsRemoved[_].labelIds)}i+=r.labelsRemoved.length}try{m.default.PAssert(686,0===i||i===r.messages.length,"Must have handled all or none of the generic messages")}catch(R){m.default.reportError(R)}if(0===i)for(var S=0,D=0;D<r.messages.length;++D){if(S++>5e3&&__infLoop&&__infLoop(S))throw new RangeError;var P=r.messages[D],I=a.messages[P.threadId];I||(I=a.messages[P.threadId]=[]),I.indexOf(P.id)<0&&I.push(P.id)}}var E={messages:[],messagesAdded:[],messagesDeleted:[],labelsAdded:[],labelsRemoved:[]};for(var C in a.messages)a.messages.hasOwnProperty(C)&&E.messages.push({id:C,msgIDs:a.messages[C]});for(var x in a.messagesAdded)a.messagesAdded.hasOwnProperty(x)&&!a.messages[x]&&E.messagesAdded.push({id:x,msgIDs:a.messagesAdded[x]});for(var A in a.messagesDeleted)a.messagesDeleted.hasOwnProperty(A)&&!a.messages[A]&&E.messagesDeleted.push({id:A,msgIDs:a.messagesDeleted[A]});for(var T in a.labelsAdded)if(a.labelsAdded.hasOwnProperty(T)&&!a.labelsAdded[T])for(var M in a.labelsAdded[T])a.labelsAdded[T].hasOwnProperty(M)&&E.labelsAdded.push({id:T,msgID:M,labelIDs:a.labelsAdded[T][M]});for(var L in a.labelsRemoved)if(a.labelsRemoved.hasOwnProperty(L)&&!a.messages[L])for(var O in a.labelsRemoved[L])a.labelsRemoved[L].hasOwnProperty(O)&&E.labelsRemoved.push({id:L,msgID:O,labelIDs:a.labelsRemoved[L][O]});return E}},{key:"_performThreadSyncPartial",value:function(e,t,a){var n=this,r=ea.a.fns("gmail").users.history.list.packedFn,i={userId:e,startHistoryId:t},o={getAllPages:!0,maxPageResults:999,resultsField:"history",timeoutMS:0},s=function(e,t){m.default.log("History Sync Request Failed: ",e,t)};this._queuePagedRemoteRequestMulti(e,r,i,(function(t,r,i){var o;i&&(o=i.historyId,n.setHistoryID(e,o)),bo.PaneUpdateBatcher.beginUpdateItems();var l=n._compactHistoryEntries(t);n._handleCompactHistory(e,l,s),bo.PaneUpdateBatcher.commitUpdateItems(),a(!0,e)}),(function(t){t&&t.error&&t.error.code===y.a.HTTPStatusCode.NotFound?n._clearCachedData(e,(function(r){r?n.performThreadSync(e,void 0,a):a(!1,e,t)})):(a(!1,e,t),n._notifyFailedRequest(e,t))}),void 0,ur,o)}},{key:"_handleCompactHistory",value:function(e,t,a){for(var n=0,r=0,i=0,o=0,s=0,l=0,u=0;u<t.messages.length;++u){var c=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var d=t.messages[u],h=0;h<d.msgIDs.length;++h){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;this._handleMessageUpdated(e,d.id,d.msgIDs[h],a),l++}}for(var f=0;f<t.messagesAdded.length;++f){var p=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var g=t.messagesAdded[f],m=0;m<g.msgIDs.length;++m){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;this._handleMessageAdded(e,g.id,g.msgIDs[m],a),l++}}for(var v=0;v<t.messagesDeleted.length;++v){var y=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var k=t.messagesDeleted[v],_=0;_<k.msgIDs.length;++_){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;this._handleMessageDeleted(e,k.id,k.msgIDs[_]),l++}}for(var b=0;b<t.labelsAdded.length;++b){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var w=t.labelsAdded[b];this._handleLabelsAdded(e,w.id,w.msgID,w.labelIDs),l++}for(var S=0;S<t.labelsRemoved.length;++S){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var D=t.labelsRemoved[S];this._handleLabelsRemoved(e,D.id,D.msgID,D.labelIDs),l++}return l}},{key:"_handleMessageAdded",value:function(e,t,a,n){this.refreshThreadCacheData(e,t,a,n)}},{key:"_handleMessageDeleted",value:function(e,t,a){this._deleteCachedMessage(e,t,a)}},{key:"_handleLabelsAdded",value:function(e,t,a,n){this.addLabelsToMessage(e,t,a,n,y.a.ChangeType.Remote)}},{key:"_handleLabelsRemoved",value:function(e,t,a,n){this.removeLabelsFromMessage(e,t,a,n,y.a.ChangeType.Remote)}},{key:"_handleMessageUpdated",value:function(e,t,a,n){this.refreshThreadCacheData(e,t,a,n)}},{key:"getLastSyncTime",value:function(e){var t,a=this._threadCache.getMetadata(Cr);if(a){var n=a[e];n&&n.date&&(t=new Date(n.date))}return t}},{key:"getAllLastSyncTimes",value:function(){for(var e=0,t=this._threadCache.getMetadata(Cr),a={},n=this.getSyncAccounts(),r=0;r<n.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=n[r],o=t?t[i]:void 0;o&&o.date?a[i]=new Date(o.date):a[i]=void 0}return a}},{key:"setHistoryID",value:function(e,t){try{m.default.PAssert(688,m.default.isString(e),"Must provide a valid account ID to set history ID")}catch(n){m.default.reportError(n)}try{m.default.PAssert(689,m.default.isString(t),"Must provide a valid history ID to set")}catch(n){m.default.reportError(n)}var a=Object.assign({},this._threadCache.getMetadata(Cr));a[e]={historyID:t,date:Date.now()},this._threadCache.setMetadata(Cr,a)}},{key:"clearHistoryID",value:function(e){try{m.default.PAssert(690,m.default.isString(e),"Must provide a valid account ID to clear history ID for")}catch(n){m.default.reportError(n)}var t=this._threadCache.getMetadata(Cr);if(t){t[e];var a=Q()(t,[e].map(Yn));this._threadCache.setMetadata(Cr,a)}}},{key:"clearCachedLabel",value:function(e){try{m.default.PAssert(691,m.default.isString(e),"Must provide a valid account ID to clear history ID for")}catch(n){m.default.reportError(n)}var t=this._threadCache.getMetadata(xr);if(t){t[e];var a=Q()(t,[e].map(Yn));this._threadCache.setMetadata(xr,a)}}},{key:"_clearCachedData",value:function(e,t){this.clearHistoryID(e),this.clearCachedLabel(e),this.clearAccountThreadCache(e,t)}},{key:"clearAccountThreadCache",value:function(e,t){var a=this;try{m.default.PAssert(692,m.default.isString(e),"Must provide a valid account ID to clear thread cache for")}catch(n){m.default.reportError(n)}try{m.default.PAssert(693,!t||m.default.isFunction(t),"Must provide valid CB function when clearing thread cache")}catch(n){m.default.reportError(n)}this._threadCache.getFilterEntries((function(t){return t.accountID===e})).then((function(n){if(n){var r=0;m.default.log("Clearing account thread cache: "+e);for(var i=0;i<n.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=n[i];if(a._threadCache.removeEntry(o.id),o.messages)for(var s=0,l=0;l<o.messages.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;a._rawCache.removeEntry(o.messages[l].id)}}t&&t(!0)}else t&&t(!1)}))}},{key:"requestDataPage",value:function(e,t){m.default.log("Data Page: ",e.hasPaginationToken()),e.hasPaginationToken()&&!e.paginationTokenInUse()&&e?this._requestRemoteThreads(void 0,fr,e,void 0,25,void 0,void 0,t):t(!0)}},{key:"_requestRemoteThreads",value:function(e,t,a,n,r,i,o,s){var l=this;this.isLoadingThreads.set(!0);var u,c=function(e){s(e),l.isLoadingThreads.set(!1)};if(a&&a.hasPaginationToken()&&!a.paginationTokenInUse()){u=a.beginDataPageLoad();try{m.default.PAssert(696,!n,"Should not define a new q for paged token")}catch(v){m.default.reportError(v)}try{m.default.PAssert(697,!o,"Should not define a new entryCB for paged token")}catch(v){m.default.reportError(v)}if(n=u.getQuery(),r=u.getMaxResults(),o=u.getEntryCB(),c){var d=c;c=function(){for(var e=0,t=0,a=arguments.length,n=new Array(a),r=0;r<a;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n[r]=arguments[r]}u.getDoneCB().apply(null,n),d.apply(null,n)}}else c=u.getDoneCB();e=e||u.getInfo().accountID}else a&&a.needsPaginationToken()&&(u=this.createPaginationToken(void 0,n,{accountID:e},r,o,c),a.setPaginationToken(u),a.beginDataPageLoad());r=r||25;try{m.default.PAssert(698,o&&m.default.isFunction(o),"Must define a valid entry callback")}catch(v){m.default.reportError(v)}try{m.default.PAssert(699,c&&m.default.isFunction(c),"Must define a valid done callback")}catch(v){m.default.reportError(v)}var h,f,p=ea.a.fns("gmail").users.threads.list.packedFn,g={userId:e,maxResults:r,timeoutMS:i,q:n,pageToken:u&&u.hasMorePages()?u.getNextPageToken():void 0};u||!a?(h=function(t){if(t.nextPageToken&&u&&l.updatePaginationToken(u,t.nextPageToken),a&&u&&a.endDataPageLoad(!!t.nextPageToken),t.threads)for(var n=0,r=t.threads.length,i=0,s=0,d=function(e){e?(o(e),i++):(o(void 0),s++),i+s===r&&c(!0)},h=0;h<t.threads.length;++h){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var f=t.threads[h];l._requestRemoteThreadMetadata(e,f.id,void 0,d)}else c(!0)},f=function(t){a&&u&&a.endDataPageLoad(u),c(!1),l._notifyFailedRequest(e,t)}):(h=function(){c(!0)},f=function(t){c(!1),l._notifyFailedRequest(e,t)}),this._queueRemoteRequestMulti(e,p,g,h,f,void 0,t)}},{key:"_requestRemoteMessageData",value:function(e,t,a){var n=this;try{m.default.PAssert(700,!e.isLocalOnlyAttachment(),"Should never request remote data for a local only attachment")}catch(s){m.default.reportError(s)}var r=ea.a.fns("gmail").users.messages.get.packedFn,i={userId:e.getField("accountID"),id:t,format:"full"},o=function(){var r=me()(pe.a.mark((function r(i){var o;return pe.a.wrap((function(r){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(r.prev=r.next){case 0:return r.next=2,n._parseMailMessage(i);case 2:o=r.sent;try{m.default.PAssert(701,o,"Must be able to parse message")}catch(s){m.default.reportError(s)}n._updateMessageData(e,t,o),a(!0);case 6:case"end":return r.stop()}}}),r)})));return function(e){return r.apply(this,arguments)}}();this._queueRemoteRequestMulti(e.getField("accountID"),r,i,o,(function(t){a(!1,t),n._notifyFailedRequest(e.getField("accountID"),t)}),void 0,Ir)}},{key:"_requestRemoteMessageDataRaw",value:function(e,t,a,n,r){var i=this,o=ea.a.fns("gmail").users.messages.get.packedFn,s={userId:e,id:a,format:"full"};this._queueRemoteRequestMulti(e,o,s,(function(a){a&&i._handleContentSyncdMessage(e,t,a),r(a)}),(function(t){r(!1,t,"This thread belongs to an account ("+e+") you are not authorized to access."),i._notifyFailedRequest(e,t)}),void 0,Ir,{priority:n?y.a.RequestPriority.UserBlocking:y.a.RequestPriority.Default})}},{key:"_requestRemoteThreadDataRaw",value:function(e,t,a){var n=this,r=ea.a.fns("gmail").users.threads.get.packedFn,i={userId:e,id:t,format:"full"};this._queueRemoteRequestMulti(e,r,i,a,(function(t){a(void 0,t),n._notifyFailedRequest(e,t)}),void 0,cr)}},{key:"_requestRemoteThreadMetadata",value:function(e,t,a,n){var r=this,i=ea.a.fns("gmail").users.threads.get.packedFn,o={userId:e,id:t,format:"metadata"};this._queueRemoteRequestMulti(e,i,o,(function(e){n(e)}),(function(t){n(void 0,t),r._notifyFailedRequest(e,t)}),a,dr)}},{key:"_persistRemoteSnoozeTask",value:function(e,t){e.getData()}},{key:"_cancelDeferredSnoozeTask",value:function(e,t){e.getData()}},{key:"_persistRemoteSendMailTask",value:function(e,t){e.getData()}},{key:"_cancelDeferredSendMailTask",value:function(e,t){e.getData()}},{key:"_handleRemotePersist",value:function(e,t){if(t.status!==y.a.HTTPStatusCode.Success)return e(!1);try{return e(!0,JSON.parse(t.response).data.messageID)}catch(a){return m.default.reportError(a),e(!1)}}},{key:"_parseMailThread",value:function(){var e=me()(pe.a.mark((function e(t,a){var n,r,i=this;return pe.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return n=[],e.next=3,Promise.all(a.messages.map(function(){var e=me()(pe.a.mark((function e(t){var a;return pe.a.wrap((function(e){for(var r=0,o=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,i._parseMailMessage(t);case 2:a=e.sent;try{m.default.PAssert(702,a,"Must be able to parse each message")}catch(s){m.default.reportError(s)}a&&n.push(a);case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:return r=t.getField("messages"),this._mergeMessagesData(r,n,["labelIds","draftID"]),t.updateField("messages",n),t.updateField("dataLoaded",!0),this._updateAttachmentFromMessages(t,y.a.ChangeType.Remote),e.abrupt("return",n);case 9:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getAttachmentURL",value:function(e,t,a){return"https://mail.google.com/mail/b/"+e+"/?ui=2&view=att&disp=safe&zw"+("&th="+t)+("&attid="+a)}},{key:"getPreviewURL",value:function(e){return e.link}},{key:"reportMessage",value:function(e,t,a,n,r){var i=ea.a.fns("gmail").users.messages.get.packedFn,o={userId:e,id:a,format:"full",forceNoDupe:!0};this._queueRemoteRequestMulti(e,i,o,this._sendReport.bind(this,r,n),(function(){try{m.default.PAssert(703,!1,"Failed to report message")}catch(e){m.default.reportError(e)}}),void 0,Ir)}},{key:"dumpMessage",value:function(e,t,a){var n=this.getAttachment(t),r=this._getMessageFromAttachment(n,a);console.log("Message Dump: ",r)}},{key:"_sanitizeMessage",value:function(){var e=me()(pe.a.mark((function e(t){var a,n,r,i,o,s=this;return pe.a.wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:if(!t.parts){e.next=3;break}return e.next=3,Promise.all(t.parts.map((function(e){return s._sanitizeMessage(e)})));case 3:if(!t.body||!t.body.data){e.next=13;break}if(!(a=this._runDecodeEmail(t))||a.mimeType!==Jr){e.next=11;break}return e.next=8,Be.a.sanitizeContent(a.decoded);case 8:n=e.sent,e.next=12;break;case 11:t.body.data=this._encodeEmail(Be.a.sanitizePlaintext(a.decoded));case 12:t.body.data=this._encodeEmail(n);case 13:if(!t.headers){e.next=30;break}r=0,i=0;case 16:if(!(i<t.headers.length)){e.next=30;break}if(!(r++>5e3&&__infLoop&&__infLoop(r))){e.next=19;break}throw new RangeError;case 19:o=t.headers[i],e.t0=o.name.toUpperCase(),e.next="TO"===e.t0||"CC"===e.t0||"BCC"===e.t0||"FROM"===e.t0?23:"SUBJECT"===e.t0||"SNIPPET"===e.t0?25:27;break;case 23:return o.value=o.value.replace(/[A-Za-z0-9]/g,"#"),e.abrupt("break",27);case 25:return o.value=new Array(o.name.length+1).join("#"),e.abrupt("break",27);case 27:++i,e.next=16;break;case 30:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_sendReport",value:function(){var e=me()(pe.a.mark((function e(t,a,n){var r;return pe.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:try{m.default.PAssert(704,m.default.isBoolean(t),"Must provide a valid boolean for sendContent")}catch(o){m.default.reportError(o)}try{m.default.PAssert(705,m.default.isString(a),"Must provide a valid description string")}catch(o){m.default.reportError(o)}try{m.default.PAssert(706,m.default.isObject(n),"Must provide valid raw data")}catch(o){m.default.reportError(o)}if(e.prev=3,m.default.log("Sending Message Report",n),t){e.next=8;break}return e.next=8,this._sanitizeMessage(n.payload);case 8:r={description:a,payload:n.payload},m.default.reportError(new Error("Report Message"),r),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),m.default.reportError(e.t0);case 15:case"end":return e.stop()}}}),e,this,[[3,12]])})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"loadResource",value:function(e,t,a,n){if(this.hasCacheData(e)){var r=this.getAttachment(e),i=this._getMessageFromAttachment(r,t).resources[a];i?(i.data?n(i,a):this._requestRemoteAttachment(r.getField("accountID"),t,i.id,(function(e,t){e&&(i.data=e,i.size=t),n(i,a)})),this.sendEvent("FetchAttachment")):n(void 0,a)}else n(void 0,a)}},{key:"_requestRemoteAttachment",value:function(e,t,a,n){var r=this,i=ea.a.fns("gmail").users.messages.attachments.get.packedFn,o={id:a,messageId:t,userId:e};this._queueRemoteRequestMulti(e,i,o,(function(e){n(e.data.replace(/-/g,"+").replace(/_/g,"/"),e.size)}),(function(t){n(void 0),r._notifyFailedRequest(e,t)}),void 0,Pr)}},{key:"_parseAttachment",value:function(e,t,a){try{m.default.PAssert(707,e,"Must have valid multipart lib")}catch(g){m.default.reportError(g)}try{m.default.PAssert(708,a.body,"Must have a valid attachment body")}catch(g){m.default.reportError(g)}try{m.default.PAssert(709,a.body.attachmentId,"Must have a valid attachment ID")}catch(g){m.default.reportError(g)}var n,r,i,o,s,l="0."+a.partId;if(a.headers)for(var u=0,c=0;c<a.headers.length;++c){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var d=a.headers[c];switch(d.name.toUpperCase()){case"CONTENT-ID":var h=/^<(.*)>$/.exec(d.value);r=n=h?h[1]:d.value;break;case"CONTENT-TRANSFER-ENCODING":s=d.value;break;case"CONTENT-DISPOSITION":var f=d.value.split(";");o=f[0]?f[0].toLowerCase():void 0;break;case"X-ATTACHMENT-ID":i=d.value}}n&&o!==Mr.Attachment||!a.filename?!n&&a.body.attachmentId&&(n=a.body.attachmentId):n=a.filename;try{m.default.PAssert(710,n,"Must be able to find a valid resource ID")}catch(g){m.default.reportError(g)}var p={cid:n,rawContentID:r,id:a.body.attachmentId,attID:l,realAttrID:i,data:void 0,size:a.body.size,uploader:void 0,disposition:o,parentType:t.mimeType,mimeType:a.mimeType,contentEncoding:s};e[p.cid]=p}},{key:"_decodeFlowed",value:function(e,t){return e.split(/\r?\n/).reduce((function(e,a,n){var r=e;return t&&(r=r.replace(/[ ]+$/,"")),/ $/.test(e)&&!/(^|\n)\-\- $/.test(e)||1===n?r+a:r+"\n"+a})).replace(/^ /gm,"")}},{key:"_decodeEmail",value:function(e,t,a){try{m.default.PAssert(711,m.default.isString(e),"Passing in an invalid string to decode")}catch(r){m.default.reportError(r)}var n;if(e)try{n=m.default.b64_to_utf8(e),"FLOWED"===a.format&&(n=this._decodeFlowed(n,a.delSp))}catch(i){m.default.reportError(i)}return n}},{key:"_encodeEmail",value:function(e){var t;try{t=m.default.utf8_to_b64(e)}catch(a){m.default.reportError(a)}return t}},{key:"_runDecodeEmail",value:function(e){try{m.default.PAssert(712,e&&e.body,"Must pass in a valid part")}catch(o){m.default.reportError(o)}var t,a=this._getHeader(e,"Content-Transfer-Encoding"),n=!1;if(ii.indexOf(e.mimeType)>=0)return{decoded:t=this._generateMessageDisplayNode(e),mimeType:Jr,contentType:ti,name:"GeneratedContent",hasError:n};var r=this._getHeader(e,"Content-Type")||ti;try{m.default.PAssert(713,r,"Must have a valid contentType")}catch(o){m.default.reportError(o)}var i=this._sanitizeContentType(r);return e.body&&e.body.data?t=this._decodeEmail(e.body.data,a,i):e.body&&e.body.attachmentId?t='<a href="attach:'+e.body.attachmentId+'">Load Message</a>':(t="Unable to decode email content",n=!0),{decoded:t,mimeType:e.mimeType,contentType:i.type,name:i.name,hasError:n}}},{key:"_runDecodeMessage",value:function(e){var t=this._decodeMessagePart(e);return 0===t.length&&e?ni.indexOf(e.mimeType)>=0||ii.indexOf(e.mimeType)>=0?[this._runDecodeEmail(e)]:[]:t}},{key:"_decodeMessagePart",value:function(e){var t=[];if(e)if(e.mimeType===Vr||e.mimeType===Wr||e.mimeType===Hr)for(var a=0,n=0;n<e.parts.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._decodeMessagePart(e.parts[n]);t.pushArray(r)}else if(e.mimeType===Ur||e.mimeType===jr||e.mimeType===jr||e.mimeType===qr)for(var i=0,o=e.parts.length-1;o>=0;o--){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(this._isValidDisplayPart(e.parts[o])){var s=this._decodeMessagePart(e.parts[o]);if(s.length>0){t.pushArray(s);break}}}else this._isValidDisplayPart(e)&&t.push(this._runDecodeEmail(e));return t}},{key:"_combineMessageParts",value:function(){var e=me()(pe.a.mark((function e(t){var a,n,r,i,o,s;return pe.a.wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:if(a="",n=Qr,r=ti,i=!1,!(t&&t.length>0)){e.next=22;break}o=0,n=t[0].mimeType,r=t[0].contentType,t.length,s=0;case 10:if(!(s<t.length)){e.next=17;break}if(!(o++>5e3&&__infLoop&&__infLoop(o))){e.next=13;break}throw new RangeError;case 13:ri.indexOf(t[s].mimeType)<0&&(i=!0);case 14:++s,e.next=10;break;case 17:return e.next=19,Be.a.combineParts(t);case 19:a=e.sent,e.next=23;break;case 22:a=" ";case 23:return n===Qr&&(n=Jr,r=Jr+";charset="+r.split(";charset=")[1]),e.abrupt("return",{decoded:a,mimeType:n,contentType:r,reportMessage:i});case 25:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"_isValidDisplayPart",value:function(e){var t=!1;return!this._isResourcePart(e)&&ni.indexOf(e.mimeType)>=0&&(t=!0),t}},{key:"_isResourcePart",value:function(e){var t=!1;return(e.filename||this._getHeader(e,"CONTENT-ID")&&(this._getHeader(e,"CONTENT-DISPOSITION")||ni.indexOf(e.mimeType)<0))&&(t=!0),t}},{key:"_parseMessagePart",value:function(e,t){var a=0,n=0,r={parent:t,raw:e,mimeType:e.mimeType,children:[],resources:[]};switch(e.mimeType){case Qr:case Jr:case Gr:break;case jr:case Hr:case Kr:case Ur:case zr:case Wr:case Yr:case Vr:for(var i=0;i<e.parts.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=e.parts[i],s=this._parseMessagePart(o,r);this._isResourcePart(o)?r.resources.push(s):r.children.push(s)}break;case qr:for(var l=0;l<e.parts.length;++l){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=this._parseMessagePart(e.parts[l],r);r.children.push(u)}break;default:var c=e.mimeType.split("/")[0];ai.indexOf(c)<0&&(m.default.log("Unknown Part Mimetype: ",e),m.default.reportError(new Error("Unknown attachment mimetype: "+e.mimeType)))}return r}},{key:"_getMessageDisplay",value:function(e,t){var a=0;switch(e.mimeType){case Qr:case Jr:case Vr:case Wr:case zr:t.push(e);break;case Ur:case jr:case qr:case Hr:for(var n=0;n<e.children.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._getMessageDisplay(e.children[n],t)}break;case Zr:case $r:break;case Kr:case Xr:case Yr:t.push(e);break;default:try{m.default.PAssert(714,!1,"Should never have an unknown multipart mimetype in the tree: ",e.mimeType)}catch(r){m.default.reportError(r)}}}},{key:"_getResourcesForNode",value:function(e,t){for(var a=0,n=e.resources,r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=n[r].raw;this._parseAttachment(t,e,i)}e.raw&&e.raw.body&&e.raw.body.attachmentId&&this._parseAttachment(t,e.parent,e.raw)}},{key:"_getResourcesForPart",value:function(e){var t=0,a={};if(e.mimeType===Vr||e.mimeType===Wr)for(var n=0,r=0;r<e.children.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this._getResourcesForNode(e.children[r],a)}for(;e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._getResourcesForNode(e,a),e=e.parent}return a}},{key:"_displayAttachment",value:function(e,t){var a=!1;return e.cid===t&&(e.disposition===Mr.Attachment||e.disposition===Mr.Inline&&e.parentType===Vr)&&(a=!0),a}},{key:"getMessageAttachments",value:function(e){var t=this,a=[];return e.resources&&m.default.forEachValue(e.resources,(function(e){t._displayAttachment(e,e.cid)&&a.push(e)})),a}},{key:"getMessageDisplayAttachments",value:function(){var e=me()(pe.a.mark((function e(t){var a,n,r,i,o,s,l=0;return pe.a.wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(a=this.getMessageAttachments(t),!t.initializedForDisplay){e.next=5;break}n=t.specialLinks?t.specialLinks.attachments:[],e.next=9;break;case 5:return r={ignoreQuotedAttachments:!!(t.labelIds.indexOf(Qn.DRAFT)>=0)},e.next=8,Be.a.getAttachmentLinks(t.decoded,r);case 8:n=e.sent;case 9:i=0;case 10:if(!(i<n.length)){e.next=18;break}if(!(l++>5e3&&__infLoop&&__infLoop(l))){e.next=13;break}throw new RangeError;case 13:o=n[i],t.resources[o.name]||((s=this._createResource(t.resources,o)).link=o.href,a.push(s));case 15:++i,e.next=10;break;case 18:return e.abrupt("return",a);case 19:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_verifyDKIM",value:function(e){var t;if(e)for(var a=0,n=e.split(";"),r=/([a-z]+)[=](.*)/i,i=0;i<n.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=n[i].trim();if(o){var s=r.exec(o);if(s)switch(t={},s[1]){case"d":t.domain=s[2];break;case"h":t.headers=s[2].split(":").map(Function.prototype.call,String.prototype.trim)}}}return t}},{key:"_sanitizeContentType",value:function(e){var t=ti;try{var a,n,r,i,o=0,s=e.replace(/[\"\']/g,"").split(";"),l=s[0].trim().toLowerCase();try{m.default.PAssert(715,l===Qr||l===Jr,"Unknown ContentType MediaType: "+l)}catch(p){m.default.reportError(p)}for(var u=1;u<s.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var c=s[u].trim();if(c){var d=c.indexOf("=");if(d>=1){var h=c.substr(0,d).trim(),f=c.substr(d+1).trim();if(h&&f)switch(h.toUpperCase()){case"CHARSET":a=f;break;case"FORMAT":n=f.toUpperCase();break;case"DELSP":r="YES"===f.toUpperCase();break;case"NAME":i=f;break;case"BOUNDARY":break;default:try{m.default.PAssert(716,!1,"Unknown param in ContentType: "+c)}catch(p){m.default.reportError(p)}}else try{m.default.PAssert(717,!1,"Malformed contentType part: ",e)}catch(p){m.default.reportError(p)}}else try{m.default.PAssert(718,!1,"Invalid contentType part: ",e)}catch(p){m.default.reportError(p)}}}a||(a="utf-8"),l&&a&&(t=l+";charset="+a)}catch(g){m.default.reportError(g)}return{type:t,format:n,delSp:r,name:i}}},{key:"_getHeader",value:function(e,t){var a;if(e&&e.headers)for(var n=0,r=0;r<e.headers.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e.headers[r].name.toUpperCase()===t.toUpperCase()){a=e.headers[r].value;break}}return a}},{key:"_generateMessageDisplayNode",value:function(e){try{m.default.PAssert(720,ii.indexOf(e.mimeType)>=0,"Must be a valid mimeType to generate content from")}catch(n){m.default.reportError(n)}var t;if(e.body&&e.body.attachmentId)t='<a href="attach:'+e.body.attachmentId+'">Load Message</a>';else{var a;switch(e.mimeType){case Xr:case Yr:case Vr:a="&nbsp;";break;case Kr:a="Unable to display encrypted message content.";break;default:a="Unable to display unknown content type: "+e.mimeType}t="<html><body>"+a+"</body></html>"}return t}},{key:"_parseMailMessage",value:function(){var e=me()(pe.a.mark((function e(t){return pe.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this._parseMailMessageInternal(t));case 4:e.prev=4,e.t0=e.catch(0),m.default.reportError(e.t0);case 7:case"end":return e.stop()}}}),e,this,[[0,4]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_parseMailMessageInternal",value:function(){var e=me()(pe.a.mark((function e(t){var a,n,r,i,o,s,l,u,c,d,h,f,p,g,v,y,k=0;return pe.a.wrap((function(e){for(var _=0;;){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;switch(e.prev=e.next){case 0:a=t.payload,n=!!a.body&&a.body.size>0;try{m.default.PAssert(721,n!==a.mimeType.startsWith("multipart/")||a.mimeType===Hr,"Checking the body size should be the same as checking whether this is a multipart message")}catch(b){m.default.reportError(b)}this._verifyDKIM(this._getHeader(t.payload,"DKIM-Signature")),r=t.payload.headers,i=0;case 6:if(!(i<r.length)){e.next=40;break}if(!(k++>5e3&&__infLoop&&__infLoop(k))){e.next=9;break}throw new RangeError;case 9:o=r[i],e.t0=o.name.toUpperCase(),e.next="FROM"===e.t0?13:"REPLY-TO"===e.t0?15:"TO"===e.t0?17:"CC"===e.t0?19:"BCC"===e.t0?21:"SUBJECT"===e.t0?23:"DATE"===e.t0?25:"MESSAGE-ID"===e.t0?28:"REFERENCES"===e.t0?30:"IN-REPLY-TO"===e.t0?32:"LIST-UNSUBSCRIBE"===e.t0?34:36;break;case 13:return t.from=this.parseEmailAddress(o.value),e.abrupt("break",37);case 15:return t.replyTo=this.parseEmailAddress(o.value),e.abrupt("break",37);case 17:return t.to=this.parseEmailAddresses(o.value),e.abrupt("break",37);case 19:return t.cc=this.parseEmailAddresses(o.value),e.abrupt("break",37);case 21:return t.bcc=this.parseEmailAddresses(o.value),e.abrupt("break",37);case 23:return t.subject=o.value,e.abrupt("break",37);case 25:t.date=this.parseDateHeader(o.value);try{m.default.PAssert(722,m.default.isDateValid(t.date),"Must have a valid message date3: ",t.date)}catch(b){m.default.reportError(b)}return e.abrupt("break",37);case 28:return t.messageID=o.value,e.abrupt("break",37);case 30:return t.references=o.value,e.abrupt("break",37);case 32:return t.inReplyTo=o.value,e.abrupt("break",37);case 34:return t.listUnsubscribe=o.value,e.abrupt("break",37);case 36:return e.abrupt("break",37);case 37:++i,e.next=6;break;case 40:if(t.messageID||(t.messageID=m.default.generateTempId()),!n){e.next=45;break}l=a,e.next=64;break;case 45:u=0,c=this._parseMessagePart(a),d=[],this._getMessageDisplay(c,d),f=d.length-1;case 50:if(h||!(f>=0)){e.next=57;break}if(!(u++>5e3&&__infLoop&&__infLoop(u))){e.next=53;break}throw new RangeError;case 53:if(ni.indexOf(d[f].mimeType)>=0)h=d[f];else if(ii.indexOf(d[f].mimeType)>=0)h=d[f];else{m.default.log("Unknown bestNode mimepart: ",d[f]);try{m.default.PAssert(723,!1,"Unknown mimePart display type: ",d[f].mimeType)}catch(b){m.default.reportError(b)}}case 54:f--,e.next=50;break;case 57:if(!h){e.next=62;break}s=this._getResourcesForPart(h),l=h.raw,e.next=64;break;case 62:return e.next=64,this._sendReport(!1,"Missing bestNode",t);case 64:try{m.default.PAssert(724,l,"Must have found a valid message part to display")}catch(b){m.default.reportError(b)}p=this._runDecodeMessage(l);try{m.default.PAssert(725,p.length>0,"Should have at least one decoded message part available")}catch(b){m.default.reportError(b)}if(0!==p.length){e.next=77;break}return e.prev=68,g=JSON.parse(JSON.stringify(t)),e.next=72,this._sendReport(!0,"No valid decoded part",g);case 72:e.next=77;break;case 74:e.prev=74,e.t1=e.catch(68),m.default.reportError(e.t1);case 77:return e.next=79,this._combineMessageParts(p);case 79:if(!(v=e.sent)){e.next=87;break}if(y={id:t.id,labelIds:t.labelIds,messageID:t.messageID,decoded:v.decoded,mimeType:v.mimeType,contentType:v.contentType,from:t.from,to:t.to||[],cc:t.cc,bcc:t.bcc,snippet:t.snippet,subject:t.subject||"",date:t.date,internalDate:t.internalDate?m.default.isDateValid(t.internalDate)?t.internalDate:new Date(m.default.parseInt(t.internalDate)):new Date,references:t.references,inReplyTo:t.inReplyTo,listUnsubscribe:t.listUnsubscribe,resources:s||{}},!v.reportMessage){e.next=85;break}return e.next=85,this._sendReport(!1,"Mismatch mimeType/contentType",t);case 85:return e.abrupt("return",y);case 87:case"end":return e.stop()}}}),e,this,[[68,74]])})));return function(t){return e.apply(this,arguments)}}()},{key:"parseEmailAddress",value:function(e){if(m.default.isObject(e))return e;si.lastIndex=0;var t=si.exec(e),a={};if(t){var n=li.exec(t[1]);a.text=n?n[1]:t[1],a.email=t[2]}else a.email=e;return a.email&&(a.email=a.email.replace(/[\r\n]/g,"")),a.text&&(a.text=a.text.replace(/[\r\n]/g,"")),a}},{key:"parseEmailAddresses",value:function(e){for(var t=0,a=[],n=m.default.parseEmailAddresses(e),r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=n[r];"contact"===i.type&&i.email&&a.push(i)}return a}},{key:"parseDateHeader",value:function(e){var t=ze.a.parseDate(e);return m.default.isDateValid(t)||(t=bo.International.parseDate(e,y.a.DateFormat.MDY)),t}},{key:"runRemoteSearch",value:function(e,t,a,n){var r=this;try{m.default.PAssert(727,e,"Must provide a valid search")}catch(k){m.default.reportError(k)}try{m.default.PAssert(728,t,"Must provide a valid pane")}catch(k){m.default.reportError(k)}try{m.default.PAssert(729,a,"Must provide a valid bucket ID")}catch(k){m.default.reportError(k)}try{m.default.PAssert(730,m.default.isFunction(n),"Must provide a valid search callback")}catch(k){m.default.reportError(k)}var i="-in:chats -in:spam "+e,o=bo.PaneManager.getPaneById(t),s=this.getAccountIDFromItem(o.getItem())||this.getDefaultAccount(),l=!1,u=0,c=0,d=new Ca(e,25,this.requestDataPage.bind(this)),h=function(e){if(u===c&&l){m.default.log("Done Searching: ",u);var i=e?y.a.SearchResultStatus.Error:u>0?y.a.SearchResultStatus.Done:y.a.SearchResultStatus.None;d.isValid()&&r.swapInSearchBucket(a,t),n(i)}},f=function(e){if(u++,e){var t=r._addRemoteEntry(s,e),n=r.getBucketItemStore(a);r._ensureVMLIsForSearchResult(t,n),c++}else c++;h()},p=function(e){l=!0,h(!e)},g=!1,v=new En(d.onEntry,(function(e){d.onDone(e),g||(g=!0,d.isValid()&&d.hasResults()?d.getNextPage(f,p):p(e))}));return this._requestRemoteThreads(s,hr,void 0,i,25,void 0,v.getEntryCB(),v.getDoneCB()),d}},{key:"_addSearchCacheEntryInternal",value:function(e,t,a){var n=!1,r=this._ensureAccountLib(e,this._emailCache);return r[t]||(r[t]={}),r[t][a]||(r[t][a]=!0,n=!0),n}},{key:"_removeSearchCacheEntryInternal",value:function(e,t,a){var n,r=this._getAccountLib(e,this._emailCache);return r&&r[t]&&(n=r[t][a],delete r[t][a]),n}},{key:"_getSearchCacheLabelEntryInternal",value:function(e,t){var a,n=this._getAccountLib(e,this._emailCache);return n&&n[t]&&(a=n[t]),a}},{key:"_addEmailToSearchCache",value:function(e,t){var a=!1;if(t&&m.default.isArray(t.labelIds))for(var n=0,r=0;r<t.labelIds.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;a=this._addSearchCacheEntryInternal(t.accountID,t.labelIds[r],e)||a}return a}},{key:"_removeEmailFromSearchCache",value:function(e,t){var a=!1;if(t&&m.default.isArray(t.labelIds))for(var n=0,r=0;r<t.labelIds.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=!!this._removeSearchCacheEntryInternal(t.accountID,t.labelIds[r],e);a=a||i,i&&this._removeThreadLabelVMLI(t.accountID,e,t.labelIds[r])}return a}},{key:"_addEmailLabelToSearchCache",value:function(e,t,a){return this._addSearchCacheEntryInternal(e,a,t)}},{key:"_removeEmailLabelFromSearchCache",value:function(e,t,a){var n=!!this._removeSearchCacheEntryInternal(e,a,t);return n&&this._removeThreadLabelVMLI(e,t,a),n}},{key:"runLocalItemSearch",value:function(e){var t=this.getDescriptorForItem(e.item),a=this._getSearchCacheLabelEntryInternal(t.accountID,t.labelID);if(a)for(var n in a)if(a.hasOwnProperty(n)){var r=this.getCacheData(n);try{m.default.PAssert(731,r,"Must have valid data for search entry")}catch(o){m.default.reportError(o)}if(r){var i=this._ensureThreadLabelVMLI(r,t.labelID);e.comparator&&!e.comparator(i)||e.each&&e.each(i)}}}},{key:"getRemoteAttachmentData",value:function(e){var t,a=this;try{m.default.PAssert(732,e.hasField("accountID"),"Must have a valid accountID for a thread")}catch(r){m.default.reportError(r)}var n=function(n,r){n?a._addRemoteEntry(t,n):(e.notifyDataRequestFailed(),a._notifyFailedRequest(t,r))};e.hasField("accountID")?(t=e.getField("accountID"),this.getSyncAccounts().includes(t)&&this._requestRemoteThreadMetadata(t,e.id,e,n)):this.getSyncAccounts().forEach((function(r){a._requestRemoteThreadMetadata(r,e.id,e,(function(a,i){a&&(t=r,a.accountID=t,n(a,i),e.notifyDataMutated(["accountID"],y.a.ChangeType.Local))}))}))}},{key:"_updateThreadFromMessages",value:function(e){var t,a=0,n=this;try{m.default.PAssert(733,!e.isDeleted||0===e.messages.length,"Should never run an update on a deleted thread with messages")}catch(v){m.default.reportError(v)}var r=e.labelIds,i=ee.a.getDefaultAccountID();"me"===e.accountID&&"me"!==i&&(e.accountID=i),e.labelIds=[],e.date=void 0,e.participants=[],e.count=e.messages.length,e.snippet=e.count>0?e.messages[e.messages.length-1].snippet:"",e.hasPriority=!1;for(var o=0;o<e.messages.length;++o){var s,l,u;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var c=e.messages[o];try{m.default.PAssert(734,c.id,"Each message must have a valid ID")}catch(v){m.default.reportError(v)}null===(s=e.labelIds)||void 0===s||s.pushOnlyUniques(c.labelIds);var d=(null===(l=c.labelIds)||void 0===l?void 0:l.indexOf(Qn.DRAFT))>=0,h=!1;if((null===(u=c.labelIds)||void 0===u?void 0:u.indexOf(Qn.SENT))>=0)for(var f=0,p=0;p<c.to.length;++p){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;var g=c.to[p];if(this.isMyAccountID(g.email)){h=!0;break}}else h=!0;(!e.date||c.date&&e.date.isBefore(c.date)&&!d&&h)&&(e.date=c.date),(!e.internalDate||c.internalDate&&e.internalDate.isBefore(c.internalDate))&&(e.internalDate=c.internalDate),c.from&&e.participants.indexOfWithProperty("email",c.from.email)<0&&e.participants.push(c.from),c.resources&&m.default.forEachValue(c.resources,(function(t){n._displayAttachment(t,t.cid)&&(e.hasAttachments=!0)}))}return e.date=e.date?new Date(e.date):new Date(0),m.default.isDateValid(e.date)||(e.date=new Date(0)),e.internalDate=e.internalDate?new Date(e.internalDate):new Date,m.default.isDateValid(e.internalDate)||(e.internalDate=new Date),e.lastModifiedDate=e.lastModifiedDate?new Date(e.lastModifiedDate):e.date,m.default.isDateValid(e.lastModifiedDate)&&!e.lastModifiedDate.isBefore(e.date)||(e.lastModifiedDate=e.date),e.messages.length>0&&(e.subject=e.messages[0].subject,e.subjectLower=e.subject.toLowerCase(),e.from=e.messages[e.messages.length-1].from,e.to=e.messages[0].to),{labelsAdded:r?null===(t=e.labelIds)||void 0===t?void 0:t.removeArray(r):e.labelIds,labelsRemoved:r?r.removeArray(e.labelIds):void 0}}},{key:"_updateAttachmentFromMessages",value:function(e,t){var a=this._updateThreadFromMessages(e.getData());this._handleThreadLabelUpdates(e.getData(),a.labelsAdded,a.labelsRemoved),e.notifyDataMutated(["labelIds","date","lastModifiedDate","count","snippet","subject","subjectLower","hasAttachments","from","to"],t)}},{key:"_createRemoteEntry",value:function(e,t){var a={id:t.id,accountID:e,messages:[],labelIds:[]};try{m.default.PAssert(735,t.messages,"_createRemoteEntry with no messages",Object.keys(t))}catch(c){m.default.reportError(c)}if(t.messages)for(var n=0,r=0;r<t.messages.length;++r){var i=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=t.messages[r];try{m.default.PAssert(736,o.id,"Message must have a valid id")}catch(c){m.default.reportError(c)}try{m.default.PAssert(737,!o.labelIds||o.labelIds.indexOf(Qn.CHAT)<0,"Should never receive a chat message")}catch(c){m.default.reportError(c)}o.labelIds&&o.labelIds.indexOf(Qn.DRAFT)>=0&&this._notifyDraftMessage(e,t.id,o.id);for(var s={id:o.id,messageID:void 0,internalDate:o.internalDate?new Date(m.default.parseInt(o.internalDate)):new Date,snippet:o.snippet,labelIds:o.labelIds||[],to:[],resources:{},subject:""},l=0;l<o.payload.headers.length;++l){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var u=o.payload.headers[l];switch(u.name.toUpperCase()){case"TO":s.to=this.parseEmailAddresses(u.value);break;case"FROM":s.from=this.parseEmailAddress(u.value);break;case"SUBJECT":s.subject=u.value;break;case"MESSAGE-ID":s.messageID=u.value;break;case"IN-REPLY-TO":s.inReplyTo=u.value;break;case"DATE":s.date=this.parseDateHeader(u.value);try{m.default.PAssert(738,m.default.isDateValid(s.date),"Must have a valid message date1: ",u.value)}catch(c){m.default.reportError(c)}}}m.default.isDateValid(s.date)||(s.date=s.internalDate),s.subject||(s.subject=""),s.messageID||(s.messageID=m.default.generateTempId()),a.messages.push(s)}return this._updateThreadFromMessages(a),a}},{key:"_addRemoteEntry",value:function(e,t){var a=this._createRemoteEntry(e,t);if(this.hasCacheData(a.id)){var n=this.getCacheData(a.id);if(n){this._mergeThreadData(n,a);var r=this._updateThreadFromMessages(a);this._handleThreadLabelUpdates(a,r.labelsAdded,r.labelsRemoved)}var i=this.getChangedFields(n,a);if(this.cacheData(a.id,a,!!n,i),this.fieldsHaveParseEffect(i))if(this.hasAttachment(a.id))this.getAttachment(a.id).notifyDataMutated(i,y.a.ChangeType.Remote)}else this.cacheData(a.id,a),this._updateSearchPanes(a,a.labelIds,[]);return a}},{key:"cacheData",value:function(e,t,n,r){this._verifyMessageState(t,!1);var i=this._addEmailToSearchCache(e,t);if(u()(g()(a.prototype),"cacheData",this).call(this,e,t,n,r),t.messages&&!this._isLoadingLocal&&this._checkUnsyncdMessageContent(t),i){var o=this.getDefaultItemStore();o&&o.updateItems()}return!!t.messages}},{key:"cacheThreadData",value:function(e,t){this._verifyMessageState(t,!0),"string"===typeof t.date&&(t.date=+new Date(t.date)),"string"===typeof t.internalDate&&(t.internalDate=+new Date(t.internalDate)),this._threadCache.saveEntry(t,this.compareCachedData)}},{key:"compareCachedData",value:function(e,t){return this._propertySets[y.a.PluginLoad.Full].some((function(a){return!m.default.deepEqual(e[a],t[a])}))}},{key:"_verifyMessageState",value:function(e,t){}},{key:"ensureThreadDates",value:function(e){(m.default.isString(e.internalDate)||m.default.isNumber(e.internalDate))&&(e.internalDate=new Date(e.internalDate)),(m.default.isString(e.date)||m.default.isNumber(e.date))&&(e.date=new Date(e.date))}},{key:"createEntryFromLocal",value:function(e,t){var a=0;t.subjectLower=t.subject.toLowerCase(),this.ensureThreadDates(t),t.messages=t.messages||[];for(var n=0;n<t.messages.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=t.messages[n];m.default.isString(r.date)?r.date=this.parseDateHeader(r.date):r.date||(r.date=new Date),m.default.isString(r.internalDate)?r.internalDate=new Date(r.internalDate):r.internalDate||(r.internalDate=new Date),m.default.isString(r.to)&&(r.to=this.parseEmailAddresses(r.to)),m.default.isString(r.cc)&&(r.cc=this.parseEmailAddresses(r.cc)),m.default.isString(r.bcc)&&(r.bcc=this.parseEmailAddresses(r.bcc)),m.default.isString(r.from)&&(r.from=this.parseEmailAddress(r.from)),r.to||(r.to=[]),r.resources?(r.resources=Object.assign({},r.resources),delete r.resources._lib):r.resources={};try{m.default.PAssert(742,r.draftID||r.messageID||m.default.isTempId(r.id),"Remotely saved messages must have a valid message ID")}catch(i){m.default.reportError(i)}try{m.default.PAssert(743,m.default.isDateValid(r.date),"Must have a valid message date2: ",r.date)}catch(i){m.default.reportError(i)}try{m.default.PAssert(744,m.default.isDateValid(r.internalDate),"Must have a valid internal message date: ",r.internalDate)}catch(i){m.default.reportError(i)}!m.default.isTempId(r.id)&&!r.draftID&&r.labelIds&&r.labelIds.indexOf(Qn.DRAFT)>=0&&this._notifyDraftMessage(t.accountID,e,r.id),r.decoded&&this.reportTrackedStat(ir)}return this._updateThreadFromMessages(t),t}},{key:"_updateMessageData",value:function(e,t,a){var n=e.getField("messages"),r=n.indexOfWithProperty("id",t);try{m.default.PAssert(745,r>=0,"Must always be able to find the message being updated")}catch(i){m.default.reportError(i)}r>=0&&(this._mergeMessageData(n[r],a,["labelIds"]),n[r]=a,e.updateField("messages",n),this._updateAttachmentFromMessages(e,y.a.ChangeType.Remote))}},{key:"_mergeMessageData",value:function(e,t,a){try{m.default.PAssert(746,m.default.isObject(e),"Must pass in a valid old message")}catch(s){m.default.reportError(s)}try{m.default.PAssert(747,m.default.isObject(t),"Must pass in a valid new message")}catch(s){m.default.reportError(s)}if(e.modifiedOffline){var n=e.modifiedOffline;if(m.default.isArray(n))for(var r=0,i=0;i<n.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;t[n[i]]=e[n[i]]}else Object.keys(e).forEach((function(a){t[a]=e[a]})),Object.keys(t).forEach((function(a){t[a]=e[a]}));t.modifiedOffline=e.modifiedOffline}for(var o in a&&a.forEach((function(a){return t[a]=e[a]})),e)if(e.hasOwnProperty(o))switch(o){case"snippet":this._pendingDraftUpdates[e.id]&&(t[o]=e[o]);break;default:t.hasOwnProperty(o)||(t[o]=e[o])}}},{key:"_mergeMessagesData",value:function(e,t,a){var n=0;try{m.default.PAssert(748,m.default.isArray(e),"Must have a valid old messages array")}catch(d){m.default.reportError(d)}try{m.default.PAssert(749,m.default.isArray(t),"Must have a valid new messages array")}catch(d){m.default.reportError(d)}try{m.default.PAssert(750,e!==t,"Should not pass in the same array for old and new")}catch(d){m.default.reportError(d)}for(var r=0;r<e.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=e[r],o=t.indexOfWithProperty("id",i.id);if(o>=0){var s=t[o];try{m.default.PAssert(751,s,"Must have a valid new message")}catch(d){m.default.reportError(d)}this._mergeMessageData(i,s,a)}else if(i.labelIds.indexOf(Qn.DRAFT)>=0)if(m.default.isTempId(i.id)){var l=t.indexOfWithProperty("messageID",i.inReplyTo);try{m.default.PAssert(752,l>=0,"Must be able to find the message being replied to")}catch(d){m.default.reportError(d)}l>=0&&t.splice(l+1,0,i)}else if(i.inReplyTo){var u=t.indexOfWithProperty("inReplyTo",i.inReplyTo);if(u>=0){var c=t[u];try{m.default.PAssert(753,c,"Must have a valid new message")}catch(d){m.default.reportError(d)}this._mergeMessageData(i,c,a)}}}}},{key:"_mergeThreadData",value:function(e,t){this.reportTrackedStat($n);try{m.default.PAssert(755,!e.isDeleted,"Should never merge message data in a deleted thread")}catch(s){m.default.reportError(s)}if(this._mergeMessagesData(e.messages,t.messages,["resources","draftID"]),e.modifiedOffline){var a=0,n=e.modifiedOffline;try{m.default.PAssert(756,m.default.isArray(n),"Should not be receiving an update for an event that was created locally")}catch(s){m.default.reportError(s)}for(var r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=n[r];switch(i){case"messages":break;default:t[i]=e[i]}}t.modifiedOffline=e.modifiedOffline}for(var o in e)t.hasOwnProperty(o)||(t[o]=e[o]);t.labelIds=e.labelIds}},{key:"_shouldCacheThread",value:function(e){var t=!0;try{m.default.PAssert(757,e&&e.messages,"Thread should have messages",e&&Object.keys(e))}catch(i){m.default.reportError(i)}if(e.messages)for(var a=0,n=0;n<e.messages.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e.messages[n];if(r.labelIds&&(r.labelIds.indexOf(Qn.SPAM)>=0||r.labelIds.indexOf(Qn.CHAT)>=0)){t=!1;break}}return t}},{key:"_shouldCacheMessageData",value:function(e){var t=!1,a=this._getFullSyncTime(),n=this._getUnreadSyncTime();if(e.date.isAfter(a))t=!0;else if(e.date.isAfter(n))for(var r=0,i=0;i<e.messages.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=e.messages[i];if(this.isPriorityData(o)){t=!0;break}}return t}},{key:"refreshThreadCacheData",value:function(e,t,a,n,r){var i=this;this._requestRemoteThreadMetadata(e,t,void 0,(function(a,o){if(a)if(i._shouldCacheThread(a)){var s=i._addRemoteEntry(e,a);i.cacheThreadData(t,i.serializeExternalData(s)),r&&r(!0)}else i._deleteCachedThread(e,t,r);else o&&o.error&&o.error.code===y.a.HTTPStatusCode.NotFound?i._deleteCachedThread(e,t,r):(n(e,t),r&&r(!1))}))}},{key:"_deleteCachedThread",value:function(e,t,a){if(this.hasCacheData(t)){for(var n=0,r=this.getAttachment(t),i=r.getField("messages"),o=0;o<i.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;bo.menus.isComposeOpenForEmail(i[o].id)&&(this._clearPendingDraftUpdate(r,i[o].id),se.a.fireEvent("EmailCompose","onClosed",[]),bo.menus.closeComposeEmail(r,i[o])),this._rawCache.removeEntry(i[o].id)}r.updateField("isDeleted",!0),r.updateField("messages",[]),this._updateAttachmentFromMessages(r,y.a.ChangeType.Remote)}this._threadCache.removeEntry(t),a&&a(!0)}},{key:"_deleteCachedMessage",value:function(e,t,a){var n=this;try{m.default.PAssert(758,a,"Must specify a valid message ID to remove from thread")}catch(l){m.default.reportError(l)}if(this.hasCacheData(t))for(var r=0,i=this.getAttachment(t),o=i.getField("messages"),s=0;s<o.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(o[s].id===a){o.removeAt(s),this._updateAttachmentFromMessages(i,y.a.ChangeType.Remote),i.updateField("messages",o);break}}this._threadCache.getEntry(t,!0).then((function(e){if(e)for(var r=0,i=0;i<e.messages.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(e.messages[i].id===a){e.messages.removeAt(i),n.cacheThreadData(t,e);break}}})),this._rawCache.removeEntry(a)}},{key:"setLastModifiedDate",value:function(e,t,a){var n=this;this.hasCacheData(t)&&this.getAttachment(t).updateField("lastModifiedDate",a);this._threadCache.getEntry(t,!0).then((function(e){e&&(e.lastModifiedDate=a,n.cacheThreadData(t,e))}))}},{key:"addLabelsToMessage",value:function(e,t,a,n,r){var i=this;if(this.hasCacheData(t)){for(var o=0,s=this.getAttachment(t),l=s.getField("messages"),u=0;u<l.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if((!a||l[u].id===a)&&(l[u].labelIds.pushOnlyUniques(n),a))break}this._updateAttachmentFromMessages(s,r),s.updateField("messages",l,void 0,!0);var c=s.getField("labelIds");c&&(c.pushOnlyUniques(n),s.updateField("labelIds",c,void 0,!0))}this._threadCache.getEntry(t,!0).then((function(e){if(e){var r=0,o=!1;e.labelIds&&e.labelIds.pushOnlyUniques(n);for(var s=0;s<e.messages.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(!a||e.messages[s].id===a){e.messages[s].labelIds.pushOnlyUniques(n),i.cacheThreadData(t,e),o=!0;break}}try{m.default.PAssert(760,o,"Must have found message to add labels to")}catch(l){m.default.reportError(l)}}}))}},{key:"removeLabelsFromMessage",value:function(e,t,a,n,r){var i=this;if(this.hasCacheData(t)){for(var o=0,s=this.getAttachment(t),l=s.getField("messages"),u=0;u<l.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(!a||l[u].id===a){for(var c=0,d=0;d<n.length;++d){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;l[u].labelIds.remove(n[d])}if(a)break}}this._updateAttachmentFromMessages(s,r),s.updateField("messages",l,void 0,!0);var h=s.getField("labelIds");if(h){for(var f=0,p=0;p<n.length;++p){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;h.remove(n[p])}s.updateField("labelIds",h,void 0,!0)}}this._threadCache.getEntry(t,!0).then((function(e){if(e){var r=0,o=!1;if(e.labelIds)for(var s=0,l=0;l<n.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;e.labelIds.remove(n[l])}for(var u=0;u<e.messages.length;++u){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(!a||e.messages[u].id===a){for(var c=0,d=0;d<n.length;++d){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;e.messages[u].labelIds.remove(n[d])}i.cacheThreadData(t,e),o=!0;break}}try{m.default.PAssert(761,o,"Must have found message to remove labels from")}catch(h){m.default.reportError(h)}}}))}},{key:"changeMessageAccount",value:function(){var e=me()(pe.a.mark((function e(t,a,n,r,i,o){var s,l,u;return pe.a.wrap((function(e){for(var c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:try{m.default.PAssert(762,o,"Must supply a valid from contact")}catch(d){m.default.reportError(d)}return l=r!==t.getField("accountID"),u=this._findDraft(t,a,n),l&&this.discardDraft(t,u.id,u.draftID,(function(e){try{m.default.PAssert(763,e,"Must successfully delete remote draft")}catch(d){m.default.reportError(d)}})),u.from=o,u.replyTo=this.getReplyToAddress(o.email),e.next=8,Be.a.replaceSignature(u.decoded,this.getSignature(i));case 8:return u.decoded=e.sent,s=l?this.createDraft(r,void 0,void 0,u):this.updateDraft(t,u.id,u.draftID,u,!0,!0,(function(e){try{m.default.PAssert(764,e,"Must be able to successfully update the draft when swiching sending accounts")}catch(d){m.default.reportError(d)}})),e.abrupt("return",s);case 11:case"end":return e.stop()}}}),e,this)})));return function(t,a,n,r,i,o){return e.apply(this,arguments)}}()},{key:"_ensureVMLIsForSearchResult",value:function(e,t){try{m.default.PAssert(765,t,"Should never be ensuring a search VMLI in the default item store")}catch(o){m.default.reportError(o)}var a="S~"+e.accountID,n=this._ensureVMLIsForAccount(a,t),r=this._createThreadID(a,"",e.id);if(!t.hasItem(r)){var i=t.createItem(r,this._getTextForItem(e.id,e.accountID),n.id);n.insertSorted(i,this.sortFn)}}},{key:"_removeVMLIFromSearchResult",value:function(e,t){try{m.default.PAssert(766,t,"Should never be ensuring a search VMLI in the default item store")}catch(r){m.default.reportError(r)}var a="S~"+e.accountID,n=this._createThreadID(a,"",e.id);t.hasItem(n)&&t.destroyItem(n)}},{key:"_createThreadID",value:function(e,t,a){return"T~"+e+"~"+t+"~"+a}},{key:"_getItemProps",value:function(e,t){var a;return t.isNamed(Fr.PRI0)?a={priority:y.a.VMLIFlag.P0}:t.isNamed(Fr.PRI1)?a={priority:y.a.VMLIFlag.P1}:t.isNamed(Fr.PRI2)&&(a={priority:y.a.VMLIFlag.P2}),a}},{key:"_ensureThreadLabelVMLI",value:function(e,t,a){a=a||this.getDefaultItemStore();var n,r=this._getLabelByID(e.accountID,t),i=this._ensureVMLIsForLabel(e.accountID,r,a),o=this._createThreadID(e.accountID,t,e.id);if(this.reportTrackedStat(Jn),a.hasItem(o))n=a.getItem(o);else{this.reportTrackedStat(Zn);var s=this._getItemProps(e,r);n=a.createItem(o,this._getTextForItem(e.id,e.accountID),i.id,s),i.insertSorted(n,this.threadSortFn,!1)}return n}},{key:"_removeThreadLabelVMLI",value:function(e,t,a,n){n=n||this.getDefaultItemStore();var r=this._createThreadID(e,a,t);n.hasItem(r)&&n.destroyItem(r)}},{key:"_getRequiredSearchLabels",value:function(e){for(var t=0,a=[Qn.INBOX],n=e.split(" "),r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=n[r].split(":");i&&2===i.length&&("label"!==i[0]&&"category"!==i[0]&&"is"!==i[0]||a.push(i[1].toUpperCase()))}return a}},{key:"_handleThreadLabelUpdates",value:function(e,t,a){bo.PaneUpdateBatcher.beginUpdateItems();var n=!1;if(t)for(var r=0,i=0;i<t.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;n=this._addEmailLabelToSearchCache(e.accountID,e.id,t[i])||n}if(a)for(var o=0,s=0;s<a.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;n=this._removeEmailLabelFromSearchCache(e.accountID,e.id,a[s])||n}this._updateSpecialLabels(e),this._updateSearchPanes(e,t,a),n&&this.getDefaultItemStore().updateItems(),bo.PaneUpdateBatcher.commitUpdateItems()}},{key:"_updateSearchPanes",value:function(e,t,a){var n=this;bo.PaneUpdateBatcher.beginUpdateItems(),bo.PaneManager.runForEachPane((function(r){if(r.isSearchingRemote()){var i=n.getActiveItemStore(r.id),o=r.search.getRemoteValue(),s=n._getRequiredSearchLabels(o),l=!1,u=!1;s.forEach((function(e){a&&a.indexOf(e)>=0?l=!0:t&&t.indexOf(e)>=0&&(u=!0)})),l?i!==n.getDefaultItemStore()&&(m.default.focusedPane===r&&0===t.length&&a&&1===a.length&&a[0]===Qn.UNREAD||n._removeVMLIFromSearchResult(e,i)):u&&i!==n.getDefaultItemStore()&&n._ensureVMLIsForSearchResult(e,i)}}),this.getPaneType()),bo.PaneUpdateBatcher.commitUpdateItems()}},{key:"_updateSpecialLabels",value:function(e){this._threadIsArchived(e)?this._addEmailLabelToSearchCache(e.accountID,e.id,Or):this._removeEmailLabelFromSearchCache(e.accountID,e.id,Or),this._addEmailLabelToSearchCache(e.accountID,e.id,Rr)}},{key:"_ensureVMLIsForLabel",value:function(e,t,a){try{m.default.PAssert(767,t,"Must specify a valid label")}catch(l){m.default.reportError(l)}try{m.default.PAssert(768,t instanceof Nn,"Must pass in a valid label object")}catch(l){m.default.reportError(l)}a=a||this.getDefaultItemStore();var n="L~"+e+"~"+t.getLabelID(),r=a.getItem(n),i=t.getDisplayText(!0);if(r)r.getParsedText()!==i&&r.setText(i,y.a.ChangeType.Auto);else{var o;if(t.hasAncestors()){var s=this._getLabelByName(e,t.getParent().getRawName(),!0);o=s?this._ensureVMLIsForLabel(e,s,a):this._ensureVMLIsForAccount(e,a)}else o=this._ensureVMLIsForAccount(e,a);r=a.createItem(n,i,o.id),o.insertSorted(r,this.sortFn)}return r}},{key:"getVMLIForAccount",value:function(e){if(e)return this._ensureVMLIsForAccount(e)}},{key:"getVMLIForLabel",value:function(e,t){return this._ensureVMLIsForLabel(e,t)}},{key:"getLabelForVMLI",value:function(e){var t,a=this.getDescriptorForItem(e);return a.accountID&&a.labelID&&(t=this._getLabelByID(a.accountID,a.labelID)),t}},{key:"_getLabelIDFromItem",value:function(e){var t,a=e.id;(a.startsWith("L~")||a.startsWith("T~"))&&(t=a.substr(a.indexOf("~",2)+1));try{m.default.PAssert(769,!t||m.default.isTempId(t)||t.indexOf("~")<0,"Should not contain delim in label ID")}catch(n){m.default.reportError(n)}try{m.default.PAssert(770,!t||t.length>3,"Label ID should be longer than a couple of chars")}catch(n){m.default.reportError(n)}return t}},{key:"_getThreadIDFromItem",value:function(e){return this._getThreadID(e.id)}},{key:"_getThreadID",value:function(e){var t;e.startsWith("T~")?t=e.substr(e.lastIndexOf("~")+1):e.startsWith("A~")||e.startsWith("L~")||e.startsWith("R~")||(t=e);try{m.default.PAssert(771,!t||m.default.isTempId(t)||t.indexOf("~")<0,"Should not contain delim in thread ID")}catch(a){m.default.reportError(a)}try{m.default.PAssert(772,!t||t.length>3,"Thread ID should be longer than a couple of chars")}catch(a){m.default.reportError(a)}return t}},{key:"isAccountItem",value:function(e){return e.id.startsWith("A~")}},{key:"isLabelItem",value:function(e){return e.id.startsWith("L~")}},{key:"isThreadItem",value:function(e){return e.id.startsWith("T~")}},{key:"getAttachmentClass",value:function(){return["plugin_gmail"]}},{key:"googleScopes",value:function(){return[y.a.GScope.GmailModify,y.a.GScope.GmailCompose]}},{key:"getDependencies",value:function(){return[]}},{key:"verifyAuthorization",value:function(e){return!this.getSetting(this.Settings.IsEnabled)||this.isCurrentlyAuthorized(e)}},{key:"handleUnauthorized",value:function(e){0}},{key:"_activate",value:function(){}},{key:"_deactivate",value:function(){}},{key:"handleTapClick",value:function(e,t,a,n){var r=n.target;try{m.default.PAssert(773,t,"Gmail tapped but is not actually a pane",m.default.getElementPath(r))}catch(i){m.default.reportError(i)}if(t)return this.openEmailByItem(e,t)}},{key:"isMyAccountID",value:function(e){try{m.default.PAssert(774,"me"!==e||m.default.isDemoMode(),"Should not be checking me")}catch(a){m.default.reportError(a)}var t=ee.a.getDefaultAccountID();try{m.default.PAssert(775,m.default.isDemoMode()||"me"!==t,"Should not be checking against current account until loaded")}catch(a){m.default.reportError(a)}return e===t}},{key:"getURLForAttachment",value:function(e){var t=e.getField("accountID");t&&"me"!==t||(t=ee.a.getDefaultAccountID());var a=e.getField("service");if("o"===a){var n=Ue.a.getPluginNew("Email"),r=n.getAccount(t,a);return n.getURLForOutlookAccount(r)}return t?"https://mail.google.com/mail/mu/mp/0/?authuser=".concat(t,"#cv/Inbox/").concat(e.id):"https://mail.google.com/mail/u/0/#all/"+e.id}},{key:"createPrintURLForThread",value:function(e){var t=e.getField("accountID");return"me"===t&&(t=ee.a.getDefaultAccountID()),"https://mail.google.com/mail/b/"+t+"/?ui=2&view=pt&search=all&th="+e.id}},{key:"openEmailByItem",value:function(e,t,a){var n=e.getAttachmentByPlugin(y.a.PluginID.Gmail);bo.EmailPreview.open(e,n,t,a)}},{key:"isEmailOpenByItem",value:function(e,t){var a=e.getAttachmentByPlugin(y.a.PluginID.Gmail);return a&&bo.EmailPreview.isOpenOnPane(t)&&bo.EmailPreview.isOpenOnThread(a)}},{key:"_convertRawMessage",value:function(e,t,a,n){var r={id:t,payload:a},i=this._getMessageFromAttachment(e,t);try{m.default.PAssert(776,i,"Must be able to get message metadata")}catch(o){m.default.reportError(o)}r.labelIds=i.labelIds,r.messageID=i.messageID,r.snippet=i.snippet,r.internalDate=a.internalDate,n(r)}},{key:"getThreadData",value:function(e,t,a){var n=this;if(0!==e.getField("messages").length)return this._getThreadData(e,t,a);this._requestRemoteThreadMetadata(e.getField("accountID"),e.id,void 0,(function(r,i){var o=!0;r?n._addRemoteEntry(e.getField("accountID"),r):i&&i.error&&i.error.code===y.a.HTTPStatusCode.NotFound&&(o=!1),o?n._getThreadData(e,t,a):t(!1,"The conversation that you requested no longer exists.")}))}},{key:"_getThreadData",value:function(e,t,a){for(var n=0,r=e.getField("messages"),i=r.length,o=0,s=!1,l=!1,u={},c=function(){if(!l&&o===i&&s){var e=0;l=!0;for(var a={messages:[]},n=0,c=0;c<r.length;++c){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var d=u[r[c].id];d?a.messages.push(d):++n}try{m.default.PAssert(777,a.messages.length+n===r.length,"Messages should always be found for thread")}catch(h){m.default.reportError(h)}0===r.length?t(void 0,"This message is not cached locally and we could not contact the remote server."):t(a)}},d=function(e){e&&(u[e.id]=e),++o,c()},h=0;h<r.length;++h){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var f=r[h];this.getMessageData(e,f.id,d)}s=!0,setTimeout(c,0)}},{key:"getMessageData",value:function(e,t,a){var n=this;this._rawCache.getEntry(t).then((function(r){r?n._convertRawMessage(e,t,r,a):(m.default.log("Warning: Local message cache missing email display data: ",e.id,t),n._requestRemoteMessageDataRaw(e.getField("accountID"),e.id,t,!0,a))}))}},{key:"_handleThreadLoaded",value:function(e,t,a,n){var r=this._pendingThreadLoads[e];try{m.default.PAssert(778,r,"Must always have a valid pending load when handling laod")}catch(s){m.default.reportError(s)}if(delete this._pendingThreadLoads[e],r)for(var i=0,o=0;o<r.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;try{r[o](t,a,n)}catch(l){m.default.reportError(l)}}}},{key:"loadThread",value:function(e,t){try{m.default.PAssert(779,0===this._loadThreadMutex,"Should never have an outstanding lock on thread load")}catch(a){m.default.reportError(a)}this._loadThreadMutex++;e.getField("accountID");this._loadThread(e,t,8e3),this._loadThreadMutex--}},{key:"_loadThread",value:function(e,t,a){var n=this,r=this.isAttachmentDraftOnly(e),i=this._pendingThreadLoads[e.id];if(i)m.default.log("Duped pending thread load: ",e.id),i.push(t);else if(this._pendingThreadLoads[e.id]=[t],e.getField("dataLoaded")||e.isLocalOnlyAttachment()){for(var o=0,s=e.getField("messages"),l=!1,u=!1,c=0,d=0,h=s.length,f=0,p=function(){l&&c===d&&(h===f&&(u=!0),n._handleThreadLoaded(e.id,!0,u))},g=function(){var t=me()(pe.a.mark((function t(a){var r;return pe.a.wrap((function(t){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(t.prev=t.next){case 0:if(d++,!a){t.next=9;break}return""===a.decoded&&(a.decoded=void 0),t.next=5,n._parseMailMessage(a);case 5:r=t.sent;try{m.default.PAssert(780,r,"Must be able to parse message")}catch(o){m.default.reportError(o)}n._updateMessageData(e,r.id,r),u=!0;case 9:p();case 10:case"end":return t.stop()}}}),t)})));return function(e){return t.apply(this,arguments)}}(),v=0;v<s.length;++v){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var y=s[v];void 0===y.decoded?(y.decoded="",c++,this.getMessageData(e,y.id,g)):(y.decoded||y.labelIds.indexOf(Qn.DRAFT)>=0)&&f++}l=!0,p()}else if(r){var k=e.getField("messages")[0];this.getMessageData(e,k.id,function(){var t=me()(pe.a.mark((function t(a){var r;return pe.a.wrap((function(t){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(t.prev=t.next){case 0:if(!a){t.next=6;break}return t.next=3,n._parseMailMessage(a);case 3:r=t.sent;try{m.default.PAssert(781,r,"Must be able to parse message")}catch(o){m.default.reportError(o)}n._updateMessageData(e,r.id,r);case 6:u=!0,n._handleThreadLoaded(e.id,!0,u);case 8:case"end":return t.stop()}}}),t)})));return function(e){return t.apply(this,arguments)}}())}else this.getThreadData(e,function(){var t=me()(pe.a.mark((function t(a,r){return pe.a.wrap((function(t){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(t.prev=t.next){case 0:if(!a){t.next=3;break}return t.next=3,n._parseMailThread(e,a);case 3:u=!0,n._handleThreadLoaded(e.id,!!e.getField("dataLoaded"),u,r);case 5:case"end":return t.stop()}}}),t)})));return function(e,a){return t.apply(this,arguments)}}(),a)}},{key:"forceReloadMessage",value:function(e,t,a){this._requestRemoteMessageData(e,t,a)}},{key:"_verifyEmailAttachments",value:function(e,t,a){var n,r,i=this,o=this._findDraft(e,t,a);return o?m.default.forEachValue(o.resources,(function(e){e.uploader&&(e.uploader.hasError()?n="There was an error uploading one or more attachments. Please remove them or try uploading again.":e.uploader.isDone()||(n="One or more of your attachments is still uploading.",r=function(e){i.onEmailReadyToSend(o,(function(){bo.toasts.clearMessage(e)}))}))})):n="Could not find message to verify attachments.",n?{message:n,handleMessageFn:r}:void 0}},{key:"_verifyEmailRecipients",value:function(e,t,a){var n,r=this._findDraft(e,t,a);if(r)if(r.to&&0!==r.to.length)for(var i=0,o=0;o<r.to.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=r.to[o];s&&s.email?m.default.isEmail(s.email)||(n="You have entered an invalid email"):n="You have entered a contact with an invalid email address"}else n="You must enter at least one person to send this email to";else n="Unable to find the message you are trying to send";return n?{message:n}:void 0}},{key:"_formatAddressText",value:function(e,t,a){return e?a?'"'+m.default.encodeMIMEHeader(e)+'" <'+t+">":'"'+e+'" <'+t+">":t}},{key:"_createAddressTextFromTokens",value:function(e,t){var a="";if(e)for(var n=0,r=0;r<e.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=e[r];m.default.isEmail(i.email)&&(0!==r&&(a+=", "),a+=this._formatAddressText(i.text,i.email,t))}try{m.default.PAssert(782,!a.startsWith(","),"Should not start with a comma")}catch(o){m.default.reportError(o)}try{m.default.PAssert(783,!a.endsWith(","),"Should not end with a comma")}catch(o){m.default.reportError(o)}try{m.default.PAssert(784,a.indexOf(",,")<0,"Should not have two commas in a row")}catch(o){m.default.reportError(o)}return a.trim()}},{key:"_createRFC822Message",value:function(e,t,a,n){var r=this;try{m.default.PAssert(785,t,"Must specify a valid draft")}catch(l){m.default.reportError(l)}try{m.default.PAssert(786,t.contentType,"Must specify a valid content type for the draft")}catch(l){m.default.reportError(l)}try{m.default.PAssert(787,t.from,"Must be able to get the from information for a user.")}catch(l){m.default.reportError(l)}try{m.default.PAssert(788,!t.inReplyTo||t.inReplyTo.indexOf("undefined")<0,"Should not have an undefined message id in reply-to: "+t.inReplyTo)}catch(l){m.default.reportError(l)}try{m.default.PAssert(789,!t.references||t.references.indexOf("undefined")<0,"Should not have an undefined message id in references: "+t.references)}catch(l){m.default.reportError(l)}var i=t.from.text,o=t.from.email,s=new zn(this);s.updateFromDraft(e,t,i,o,a,(function(){var e=s.generateBlob();n(r._encodeEmail(e))}))}},{key:"createSignature",value:function(e){var t=this.getSignature(e);return t?this.getSetting(this.Settings.InsertSignatureAboveReplies)?'<br/><br/><div class="gmail_signature">'+t+"</div><br/>":'<br/><br/>--<br/><div class="gmail_signature">'+t+"</div>":'<div class="gmail_signature"></div>'}},{key:"createReplyQuote",value:function(e){var t;e&&(t='<br>\n<div class="gmail_extra">\n<br>\n<div class="gmail_quote">'+("On "+e.date.toString("MMM dd, y")+" at "+e.date.toString("hh:mm tt")+", "+m.default.escape(this._createAddressTextFromTokens([e.from]))+" wrote:")+'\n<br>\n<blockquote class="gmail_quote" style="margin:0 0 0 0.8ex;border-left:1px #ccc solid;padding-left:1ex">\n'+e.decoded+"\n</blockquote>\n</div>\n<br>\n</div>\n");return t}},{key:"createForwardQuote",value:function(e){var t,a=m.default.isArray(e.to)?e.to:[e.to];return e&&(t='<br>\n<div class="gmail_quote">\n<br>\n---------- Forwarded message ----------<br>\nFrom: '+m.default.escape(this._createAddressTextFromTokens([e.from]))+"<br>\nDate: "+e.date.toString("ddd, MMM dd, y")+" at "+e.date.toString("hh:mm tt")+"<br>\nSubject: "+e.subject+"<br>\nTo: "+m.default.escape(this._createAddressTextFromTokens(a))+"\n<br>\n<br>\n"+e.decoded+"\n</div>\n<br>\n"),t}},{key:"createMessageBody",value:function(e,t,a){var n,r=this.createSignature(t);if(a===y.a.EmailResponseMode.Reply||a===y.a.EmailResponseMode.ReplyAll)n=this.createReplyQuote(e);else if(a===y.a.EmailResponseMode.Forward)n=this.createForwardQuote(e);else try{m.default.PAssert(790,!1,"Invalid email response mode: "+a)}catch(i){m.default.reportError(i)}return this.getSetting(this.Settings.InsertSignatureAboveReplies)?r+n:n+r}},{key:"_sendEmail",value:function(e,t,a,n){var r=this;this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(e,t);var i=this._findDraft(e,t,a);this._createRFC822Message(e.getData(),i,!0,(function(t){var a={raw:t};e.isLocalOnlyAttachment()||(a.threadId=e.id);var o=ea.a.fns("gmail").users.messages.send.packedFn,s={userId:e.getField("accountID"),resource:a};r._queueRemoteRequestMulti(e.getField("accountID"),o,s,(function(t){r._updateLocalDraftFromSend(e,i.id,t,n)}),(function(t){r._notifySendFailed(),n(!1,t),r._notifyFailedRequest(e.getField("accountID"),t)}),void 0,pr)}))}},{key:"_shouldSaveMessageContent",value:function(e,t){var a;return(null===(a=t.labelIds)||void 0===a?void 0:a.indexOf(Qn.DRAFT))>=0}},{key:"compactCacheField",value:function(e,t){var a,n=0;switch(t){case"messages":a=[];for(var r=e[t],i={},o=function(e){var t=m.default.clone(e);delete t.data,delete t.size,delete t.uploader,i[e.id]=t},s=0;s<r.length;++s){var l=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var u=r[s],c={},d=0;d<Br.length;++d){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var h=u[Br[d]];void 0!==h&&null!==h&&(c[Br[d]]=u[Br[d]])}this._shouldSaveMessageContent(e,u)||(delete c.decoded,delete c.mimeType,delete c.contentType,delete c.listUnsubscribe),c.resources&&(m.default.forEachValue(c.resources,o),c.resources=i),a.push(c)}break;default:a=e[t]}return a}},{key:"_generateUndoRedo",value:function(){this._undoStack.registerOwner(this,this.id),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.Archive,{undo:this.unarchiveAttachment,redo:this.archiveAttachment}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.Unarchive,{undo:this.archiveAttachment,redo:this.unarchiveAttachment}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.Trash,{undo:this.untrashAttachment,redo:this.trashAttachment}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.Untrash,{undo:this.trashAttachment,redo:this.untrashAttachment}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.AddLabel,{undo:this.removeLabelFromAttachment,redo:this.addLabelToAttachment}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.RemoveLabel,{undo:this.addLabelToAttachment,redo:this.removeLabelFromAttachment}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.MarkRead,{undo:this.markAttachmentUnread,redo:this.markAttachmentRead}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.MarkUnread,{undo:this.markAttachmentRead,redo:this.markAttachmentUnread}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.Star,{undo:this.markAttachmentUnstarred,redo:this.markAttachmentStarred}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.Unstar,{undo:this.markAttachmentStarred,redo:this.markAttachmentUnstarred}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.SetPriority,{undo:this.setAttachmentPriority,redo:this.setAttachmentPriority}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.Move,{undo:this.unmoveItem,redo:this.moveItem}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.Snooze,{undo:this.unsnoozeAttachment,redo:this.snoozeAttachment}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.ScheduleSend,{undo:this.cancelSendMessage,redo:this.scheduleSendMessage}),this._undoStack.registerAction(this.id,y.a.PluginAction.Gmail.DiscardDraft,{undo:m.default.emptyFn,redo:this.runDiscardDraft})}},{key:"performAction",value:function(e,t,a,n,r){try{m.default.PAssert(791,e,"Must supply a valid action")}catch(l){m.default.reportError(l)}try{m.default.PAssert(792,m.default.isBoolean(t),"Invalid preventUndo param")}catch(l){m.default.reportError(l)}var i;this.beginAction(t);var o=[a,n,r];try{i=this._undoStack.runAction(this.id,e,o)}catch(u){m.default.reportError(u)}if(this._undoStack.isUndoableAction()){var s=[a];m.default.isArray(i)?s.pushArray(i):s.push(i),this._undoStack.performAction(this.id,e,{undoParams:s,redoParams:o})}this.endAction()}},{key:"performActions",value:function(e,t){var a=0;this.beginAction(t);for(var n=0;n<e.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this.performAction(e[n].action,!1,e[n].attach,e[n].param)}this.endAction()}},{key:"beginAction",value:function(e){this._undoStack.beginAction(e)}},{key:"endAction",value:function(){this._undoStack.endAction()}},{key:"handleUndo",value:function(){this._undoStack.undoAction()}},{key:"handleRedo",value:function(){this._undoStack.redoAction()}},{key:"supportUsageCache",value:function(){return!0}},{key:"supportOfflineLoad",value:function(){return!0}},{key:"_matchParticipant",value:function(e,t){var a=!1;return e&&(e.text&&(a=e.text.toLowerCase().indexOf(t)>=0),!a&&e.email&&(a=e.email.toLowerCase().indexOf(t)>=0)),a}},{key:"_matchLabels",value:function(e,t){return this.hasLabelLike(e.accountID,e.id,t)}},{key:"_matchEntry",value:function(e,t){return e.subjectLower.indexOf(t)>=0||this._matchParticipant(e.from,t)||this._matchLabels(e,t)}},{key:"matchAttachment",value:function(e,t){return this._matchEntry(e.getData(),t)}},{key:"findMatchExact",value:function(){}},{key:"findMatchLike",value:function(e,t){var a=this,n=e.toLowerCase();return this.findCachedItemsByFn((function(e){return a._matchEntry(e,n)}),t)}},{key:"isGmailItem",value:function(e){return!!e.getAttachmentByPlugin(this.id)}},{key:"itemHasLabelByID",value:function(e,t){var a=e.getAttachmentByPlugin(this.id);return!!a&&this.attachmentHasLabelByID(a,t)}},{key:"itemHasLabel",value:function(e,t){var a=e.getAttachmentByPlugin(this.id);return!!a&&this.attachmentHasLabel(a,t)}},{key:"itemHasFullLabel",value:function(e,t){var a=e.getAttachmentByPlugin(this.id);return!!a&&this.attachmentHasFullLabel(a,t)}},{key:"itemHasDraft",value:function(e){return this.itemHasLabelByID(e,Qn.DRAFT)}},{key:"isItemUnread",value:function(e){return this.itemHasLabelByID(e,Qn.UNREAD)}},{key:"isItemImportant",value:function(e){return this.itemHasLabelByID(e,Qn.IMPORTANT)}},{key:"isItemStarred",value:function(e){return this.itemHasLabelByID(e,Qn.STARRED)}},{key:"isItemArchived",value:function(e){var t=e.getAttachmentByPlugin(this.id);return!!t&&this.attachmentIsArchived(t)}},{key:"isItemTrashed",value:function(e){return this.itemHasLabelByID(e,Qn.TRASH)}},{key:"isItemFullTrashed",value:function(e){return this.itemHasFullLabel(e,Lr.TRASH)}},{key:"isItemSpam",value:function(e){return this.itemHasLabelByID(e,Qn.SPAM)}},{key:"isDisplayItem",value:function(e,t){var a=!1;return this.isItemSpam(e)||!this.isThreadItem(e)||this.isItemFullTrashed(e)&&!t||(a=!0),a}},{key:"getItemPriority",value:function(e){return e.hasPluginAttachment(this.id)?this.getAttachmentPriority(e.getAttachmentByPlugin(this.id)):0}},{key:"_getCompDateForItem",value:function(e){var t=0,a=e.getAttachmentByPlugin(this.id);if(a){var n=a.getField("lastModifiedDate");if(n)t=n.getTime();else{var r=a.getField("internalDate");r&&(t=r.getTime())}}return t}},{key:"_timeCompare",value:function(e,t){return e>t?1:e<t?-1:0}},{key:"threadSortFn",value:function(e,t){return this._timeCompare(this._getCompDateForItem(t),this._getCompDateForItem(e))}},{key:"threadSortPriorityFn",value:function(e,t){var a=e.getAttachmentByPlugin(this.id),n=t.getAttachmentByPlugin(this.id),r=this.getAttachmentPriority(a),i=this.getAttachmentPriority(n),o=this.attachmentHasLabelByID(a,Qn.STARRED),s=this.attachmentHasLabelByID(n,Qn.STARRED);return r>i?-1:r<i?1:o&&!s?-1:s&&!o?1:this._timeCompare(this._getCompDateForItem(t),this._getCompDateForItem(e))}},{key:"labelSortFn",value:function(e,t){return e.displayCompare(t)}},{key:"labelVMLISortFn",value:function(e,t){var a=this._getLabelByID(this.getAccountIDFromItem(e),this._getLabelIDFromItem(e)),n=this._getLabelByID(this.getAccountIDFromItem(t),this._getLabelIDFromItem(t));return this.labelSortFn(a,n)}},{key:"getCssClass",value:function(e,t){if(t&&t.type===this.getPaneType())return m.default.classNames({starred:this.attachmentHasLabelByID(e,Qn.STARRED)},{unread:this.attachmentHasLabelByID(e,Qn.UNREAD)},{p0:this.attachmentHasLabel(e,Fr.PRI0)},{p1:this.attachmentHasLabel(e,Fr.PRI1)},{p2:this.attachmentHasLabel(e,Fr.PRI2)})}},{key:"getUnsyncdMessageCount",value:function(){return this._numUnsyncdMessages}},{key:"getSyncdMessageCount",value:function(){return this._numSyncdMessages}},{key:"_checkUnsyncdMessageContent",value:function(e){var t=this;e.messages.forEach((function(a){a.cached?(t.reportTrackedStat(er),t._numSyncdMessages++):a.cachedError?t.reportTrackedStat(tr):t._shouldCacheMessageData(e)?t._rawCache.getEntry(a.id).then((function(n){n||(t.reportTrackedStat(ar),t._notifyUnsyncdMessage(e.accountID,e.id,a.id))})):t.reportTrackedStat(nr)}))}},{key:"_notifyUnsyncdMessage",value:function(e,t,a){m.default.isTempId(t)||m.default.isTempId(a)||(this._handleSyncContentCacheOp(this._unsyncdMessages,e,t,a),this._numUnsyncdMessages++,this._contentSyncTask.notifyWorkAvailable())}},{key:"_notifyContentCached",value:function(e,t,a){this._numSyncdMessages++,this._handleSyncContentCacheOp(this._pendingSyncdMessages,e,t,a)}},{key:"_handleSyncContentCacheOp",value:function(e,t,a,n){var r=this._ensureAccountLib(t,e);r[a]?!0!==r[a]&&r[a].indexOf(n)<0&&r[a].push(n):r[a]=!n||[n]}},{key:"_removeUnsyncdMessage",value:function(e,t,a){this.reportTrackedStat(rr),this._numUnsyncdMessages--;var n=this._getAccountLib(e,this._unsyncdMessages);if(a){var r=n[t];r.remove(a),0===r.length&&delete n[t]}else delete n[t];m.default.isEmpty(n)&&this._deleteAccountLib(e,this._unsyncdMessages)}},{key:"_setCachedFieldForMessage",value:function(e,t,a){var n=this;if(this.hasCacheData(t))for(var r=0,i=this.getAttachment(t).getField("messages"),o=0;o<i.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;(!0===a||a.indexOf(i[o].id)>=0)&&(i[o].cached=!0)}this._threadCache.getEntry(t,!0).then((function(e){if(e){for(var r=0,i=0;i<e.messages.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=e.messages[i];(!0===a||a.indexOf(o.id)>=0)&&(o.cached=!0)}n.cacheThreadData(t,e)}}))}},{key:"_updateCachedErrorFieldForMessage",value:function(e,t,a){var n=this;if(this.hasCacheData(t))for(var r=0,i=this.getAttachment(t).getField("messages"),o=0;o<i.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;(!0===a||a.indexOf(i[o].id)>=0)&&(i[o].cachedError?i[o].cachedError++:i[o].cachedError=1)}this._threadCache.getEntry(t,!0).then((function(e){if(e){for(var r=0,i=0;i<e.messages.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=e.messages[i];(!0===a||a.indexOf(o.id)>=0)&&(o.cached?o.cachedError++:o.cachedError=1)}n.cacheThreadData(t,e)}}))}},{key:"_processSyncdContent",value:function(){for(var e in this._pendingSyncdMessages)if(this._pendingSyncdMessages.hasOwnProperty(e)){var t=this._pendingSyncdMessages[e];for(var a in t)if(t.hasOwnProperty(a)){var n=t[a];if(m.default.isArray(n)){for(var r=0,i=0;i<n.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=n[i];this._removeUnsyncdMessage(e,a,o)}this._setCachedFieldForMessage(e,a,n)}else!0===n&&this._removeUnsyncdMessage(e,a)}}this._pendingSyncdMessages={}}},{key:"_processSyncErrors",value:function(e){for(var t in m.default.log("Process Sync Errors: ",e),e)if(e.hasOwnProperty(e)){var a=e[t];for(var n in a)if(a.hasOwnProperty(n)){var r=0,i=a[n];try{m.default.PAssert(793,m.default.isArray(i),"Must have a valid message ID list")}catch(l){m.default.reportError(l)}for(var o=0;o<i.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=i[o];this._removeUnsyncdMessage(t,n,s)}this._updateCachedErrorFieldForMessage(t,n,i)}}}},{key:"driveMessageContentSync",value:function(e){var t=this;if(bo.cacheManager.hasReportedQuotaError())return e(!1);this._outstandingContentSync=!0,this._runMessageContentSync(35,(function(a,n){if(!a)try{t._processSyncErrors(n)}catch(r){m.default.reportError(r)}return t._processSyncdContent(),t._outstandingContentSync=!1,e(!m.default.isEmpty(t._unsyncdMessages))}))}},{key:"_runMessageContentSync",value:function(e,t){var a=0,n=0,r=!1,i=0,o=0,s={},l=function(e,a,l){if(e?i++:(o++,s[a]=l),r&&i+o===n){var u=0===o;t(u,u?void 0:s)}},u=this.getSyncAccounts();for(var c in this._unsyncdMessages)if(u.indexOf(c)>=0&&(a+=this._syncMessageContentForAccount(c,this._unsyncdMessages[c],e-a,l),n++,a>=e))break;return r=!0,0===a&&setTimeout((function(){t(!0)}),0),a}},{key:"_syncMessageContentForAccount",value:function(e,t,a,n){var r=0,i=0,o=0,s=0,l={},u=function(t,a,r){if(t?o++:(s++,l[a]=r),o+s===i){var u=0===s;n(u,e,u?void 0:l)}};for(var c in t)if(t.hasOwnProperty(c)&&(r+=this._syncMessageContentForThread(e,c,t[c],a-r,u),i++,r>=a))break;return r}},{key:"_syncMessageContentForThread",value:function(e,t,a,n,r){var i=this,o=0;if(m.default.isArray(a)){var s=!1,l=0,u=[],c=function(a,n){if(n?(l++,i._notifyContentCached(e,t,a)):u.push(a),s&&l+u.length===o){var c=0===u.length;r(c,t,c?void 0:u)}};a.forEach((function(a){o<n&&i._requestRemoteMessageDataRaw(e,t,a,!1,(function(e,t){c(a,!!e)})),o++})),s=!0}else this._requestRemoteThreadDataRaw(e,t,(function(a,n){a?i._handleContentSyncdThread(e,a,(function(a){i._notifyContentCached(e,t),r(a,t)})):r(!1,t,!0)})),o++;return o}},{key:"_handleContentSyncdMessage",value:function(e,t,a,n){a.error||(a.internalDate=new Date(+a.internalDate),a.payload.id=a.id,a.payload.internalDate=a.internalDate,this._rawCache.saveEntry(a.payload)),n&&n(!0)}},{key:"_handleContentSyncdThread",value:function(e,t,a){for(var n=0,r=0;r<t.messages.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=t.messages[r];this._handleContentSyncdMessage(e,t.id,i,a)}}},{key:"scheduleEmail",value:function(e,t){var a=this,n=e.getAttachmentByPlugin(this.id);try{m.default.PAssert(794,n,"Must be able to get a valid attachment from item")}catch(u){m.default.reportError(u)}var r=n.getField("subject"),i=this.getURLForAttachment(n),o=y.a.MSPerHour,s=bo.pluginManager.getPluginGCalendar();if(s){var l=s.getDefaultExportCalendarID();l?s.createEventForEmail(l,r,i,t,o,(function(e,t){e||t?t?(a.addLabelToAttachment(n,"Moo.do/Scheduled"),a.getSetting(a.Settings.ArchiveOnSchedule)&&a.archiveAttachment(n)):t||bo.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:y.a.MessageAction.Okay}):bo.toasts.pushMessage({text:"There was an error adding the email to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:function(){bo.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:y.a.MessageAction.Okay})}})})):bo.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:y.a.MessageAction.OpenCalendarSettings})}else bo.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule emails.",action:y.a.MessageAction.OpenSettings})}},{key:"getIconInfoForLabel",value:function(e){var t,a,n=!1,r=16;switch(e.getParsedText()){case"Inbox":a="inbox2",t=y.a.ColorBrand;break;case"Starred":a="star",t="#fd3";break;case"Important":a="exclamation",t="#d43";break;case"Sent Mail":a="send",t="#08c",r=13;break;case"Draft":a="drafts",t="#fafafa";break;case"Archived":a="task",r=13;break;case"Trash":a="delete",t="#ff738c";break;case"Primary":a="user";break;case"Social":a="group",r=13;break;case"Promotions":a="tag";break;case"Updates":a="flag";break;case"Forums":a="question_answer";break;case"Chat":a="chat";break;case"Spam":a="warning";break;default:n}return{icon:a,color:t,size:r}}},{key:"archiveItem",value:function(e,t){var a=t.getAttachmentByPlugin(this.id);try{m.default.PAssert(795,a,"Must be able to get a valid attachment")}catch(n){m.default.reportError(n)}!e&&this.isItemArchived(t)?this.performAction(y.a.PluginAction.Gmail.Unarchive,!1,a):e&&!this.isItemArchived(t)&&this.performAction(y.a.PluginAction.Gmail.Archive,!1,a)}},{key:"deleteItem",value:function(e,t){var a=e.getAttachmentByPlugin(this.id);try{m.default.PAssert(796,a,"Must be able to get a valid attachment")}catch(n){m.default.reportError(n)}t&&t.isDraft()&&this.itemHasDraft(e)?this.performAction(y.a.PluginAction.Gmail.DiscardDraft,!0,a):t&&t.isTrash()&&this.isItemFullTrashed(e)?this.performAction(y.a.PluginAction.Gmail.Untrash,!1,a):this.isItemFullTrashed(e)||this.performAction(y.a.PluginAction.Gmail.Trash,!1,a)}},{key:"undeleteItem",value:function(e){var t=e.getAttachmentByPlugin(this.id);try{m.default.PAssert(797,t,"Must be able to get a valid attachment")}catch(a){m.default.reportError(a)}this.isItemFullTrashed(e)&&this.performAction(y.a.PluginAction.Gmail.Untrash,!1,t)}},{key:"removeItemFromLabel",value:function(e,t){var a=t.getAttachmentByPlugin(this.id);try{m.default.PAssert(798,a,"Must be able to get a valid attachment")}catch(n){m.default.reportError(n)}e&&(e.isCustom()?this.performAction(y.a.PluginAction.Gmail.RemoveLabel,!1,a,e.getName()):e.isInbox()?this.performAction(y.a.PluginAction.Gmail.Archive,!1,a):e.isArchived()?this.performAction(y.a.PluginAction.Gmail.Unarchive,!1,a):e.isStarred()&&this.performAction(y.a.PluginAction.Gmail.Unstar,!1,a))}},{key:"moveEmailToItem",value:function(e,t,a){this.beginAction(),a||(e=e.clone(t,y.a.ChangeType.Local));var n=e.getAttachmentByPlugin(this.id);try{m.default.PAssert(799,n,"Must be able to get a valid attachment")}catch(r){m.default.reportError(r)}this.performAction(y.a.PluginAction.Gmail.Move,!1,n,e,t),this.getSetting(this.Settings.ArchiveOnOrganize)&&this.performAction(y.a.PluginAction.Gmail.Archive,!1,n),this.attachmentHasLabel(n,"Moo.do/Handled")||this.performAction(y.a.PluginAction.Gmail.AddLabel,!1,n,"Moo.do/Handled"),this.endAction()}},{key:"getLastMessage",value:function(e){var t=e.getField("messages")||[],a=t.length-1;return this.isMessageDraft(t[a])&&!this.getAttachField(e,"pendingSend")&&a--,t[a]}},{key:"sendEmail",value:function(){var e=me()(pe.a.mark((function e(t,a){var n=this;return pe.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){n.sendDraft(t,a.id,a.draftID,void 0,(function(a,n){bo.EmailPreview.ensureDisplayMessages(t),a||(m.default.isHTTPStatusCode(n,y.a.HTTPStatusCode.Network)?bo.toasts.pushMessage({text:"You are offline. Your message will be sent when Moo.do is open and you are online.",action:y.a.MessageAction.Okay,hold:!0}):n&&bo.toasts.pushMessage({text:"There was an error sending your message. Please try again in a minute.",action:y.a.MessageAction.Okay})),e(!!a)}))||e(!1)})));case 1:case"end":return e.stop()}}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getStyledText",value:function(e,t,a,n){return In.a.renderStyled(e,t,a,n)}},{key:"getUnstyledText",value:function(e){return In.a.renderPlain(e)}},{key:"getTextIconPadding",value:function(){return 24}},{key:"getEntryDateAsNumber",value:function(e){return"number"===typeof e&&e||"string"===typeof e&&+new Date(e)||+e}}]),a}(ka),_()(Gn.prototype,"_notifyPendingDraftUpdate",[b.a],Object.getOwnPropertyDescriptor(Gn.prototype,"_notifyPendingDraftUpdate"),Gn.prototype),_()(Gn.prototype,"runLabelSync",[b.a],Object.getOwnPropertyDescriptor(Gn.prototype,"runLabelSync"),Gn.prototype),_()(Gn.prototype,"runThreadSync",[b.a],Object.getOwnPropertyDescriptor(Gn.prototype,"runThreadSync"),Gn.prototype),_()(Gn.prototype,"compareCachedData",[b.a],Object.getOwnPropertyDescriptor(Gn.prototype,"compareCachedData"),Gn.prototype),_()(Gn.prototype,"removeItemFromLabel",[b.a],Object.getOwnPropertyDescriptor(Gn.prototype,"removeItemFromLabel"),Gn.prototype),Gn);function ci(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var di="Gmail";function hi(e){var t={subject:e.subject||"",from:e.from||"",id:e.mailMessageId?e.mailMessageId:"mailbird_"+e.id,latestMessageAt:e.latestMessageAt};return e.gmailID&&(t.provider="Gmail",t.threadID=e.gmailID),t}var fi=new(function(){function e(){i()(this,e)}return s()(e,[{key:"dragOver",value:function(e){var t=m.default.elementFromPoint(e.x,e.y);if(t){var a=void 0!==this._prevX?e.x-this._prevX:0,n=void 0!==this._prevY?e.y-this._prevY:0;this._prevX=e.x,this._prevY=e.y;var r={clientX:e.x,clientY:e.y,diffX:a,diffY:n,target:t,dataTransfer:{}};bo.DragDrop.handleDragOver(r)}}},{key:"drop",value:function(e){var t=m.default.elementFromPoint(e.x,e.y);var a={clientX:e.x,clientY:e.y,target:t,dataTransfer:{getData:function(t){if("mailbird/email"===t)return hi(e)}}};setTimeout((function(){bo.DragDrop.handleDrop(a)}),0)}},{key:"dragLeave",value:function(){bo.DragDrop.handleDragLeave({target:document.getElementById("container")})}},{key:"reportError",value:function(e){m.default.reportError(new Error(e))}}]),e}()),pi=(ei=function(e){d()(a,e);var t=ci(a);function a(){var e;if(i()(this,a),(e=t.call(this,y.a.PluginID.Mailbird,"b","Mailbird",!0)).declareProperty("subject",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!1,""),e.declareProperty("from",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!1,""),e.declareProperty("date",y.a.PluginLoad.Preview|y.a.PluginLoad.Full,!0,new Date),e.declareProperty("subjectLower",y.a.PluginLoad.Runtime,!1,""),e.declareProperty("fromLower",y.a.PluginLoad.Runtime,!1,""),e.declareProperty("unread",y.a.PluginLoad.Runtime,!0,!1),e.declareProperty("snippet",y.a.PluginLoad.Runtime,!0,""),e.declareProperty("count",y.a.PluginLoad.Runtime,!0,1),e.declareProperty("latestMessageAt",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!1),e.declareProperty("provider",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!0),e.declareProperty("threadID",y.a.PluginLoad.Preview|y.a.PluginLoad.Full|y.a.PluginLoad.Inline,!0),e.declareProperty("hasAttachments",y.a.PluginLoad.Full,!0,!1),e.isMailbirdEmbed=w.a.embed===y.a.EmbedApps.Mailbird,e.isMailbirdEmbed){e.setSetting(e.Settings.IsEnabled,!0),e._needInlineDataUpdate=[],bo.nativeBridge.registerEmbedBridge(Pn()(e));var n=bo.nativeBridge.registerInboundAPI("mailbird");try{m.default.PAssert(546,n,"Error creating native inbound API for mailbird")}catch(r){m.default.reportError(r)}n&&(n.registerVariable("_prevX"),n.registerVariable("_prevY"),n.registerFunction("dragOver",fi.dragOver,!0),n.registerFunction("drop",fi.drop,!0),n.registerFunction("dragLeave",fi.dragLeave,!0),n.registerFunction("reportError",fi.reportError,!0)),e._mailbirdOutAPI=bo.nativeBridge.registerOutboundAPI("mailbird");try{m.default.PAssert(547,e._mailbirdOutAPI,"Error creating native outbound API for mailbird")}catch(r){m.default.reportError(r)}e._mailbirdOutAPI&&(e._mailbirdOutAPI.requireFunction("selectConversation"),e._mailbirdOutAPI.requireFunction("selectConversationEx",!0),e._mailbirdOutAPI.requireFunction("scheduleNotifications",!0),e._mailbirdOutAPI.requireFunction("getByIdEx",!0),e._canUpdateInlineData=e._mailbirdOutAPI.hasOptionalFunction("getByIdEx"))}return e}return s()(a,[{key:"getPaneIcon",value:function(){return"icon-envelope"}},{key:"useItemStore",value:function(){return"Mailbird"}},{key:"_addRemoteEntry",value:function(e){var t={id:e.id,provider:e.provider,threadID:e.threadID,subject:e.subject,subjectLower:e.subject.toLowerCase(),from:e.from,fromLower:e.from.toLowerCase(),latestMessageAt:e.latestMessageAt};return this.cacheData(t.id,t),t}},{key:"createEntryFromLocal",value:function(e,t){return t.subjectLower=t.subject.toLowerCase(),t.fromLower=t.from.toLowerCase(),t}},{key:"getAttachmentClass",value:function(e){return["plugin_mailbird"]}},{key:"isPluginBlocked",value:function(){return!1}},{key:"handleEmbedMessage",value:function(e,t){switch(e){case"scheduledItems":if(this._mailbirdOutAPI.hasOptionalFunction("scheduleNotifications"))try{var a=JSON.stringify(t);this._mailbirdOutAPI.call("scheduleNotifications",a)}catch(n){m.default.reportError(n)}break;default:try{m.default.PAssert(548,!1,"Unknown embed message: "+e)}catch(r){m.default.reportError(r)}}}},{key:"handleDropEvent",value:function(e,t){try{m.default.PAssert(549,t,"Must provide a valid callback to the drop event")}catch(i){m.default.reportError(i)}if(e.dataTransfer){var a=e.dataTransfer.getData("mailbird/email");if(a){var n=this._addRemoteEntry(a),r=this.getAttachment(n.id,n);try{m.default.PAssert(550,r.isLoaded(),"Mailbird attachments must always be loaded after creation")}catch(i){m.default.reportError(i)}return t(this.getAttachmentEmbedString(r)),!0}}return!1}},{key:"handleTapClick",value:function(e,t,a,n){var r=this.getCacheData(a);if(!r){var i=this.getAttachment(a);i&&(r=i.getInlineData())}if(r){if(this.isMailbirdEmbed){var o;if(!r.id.startsWith("mailbird_")&&this._mailbirdOutAPI.hasOptionalFunction("selectConversationEx")){var s=null;if("Gmail"===r.provider){try{m.default.PAssert(551,r.threadID,"Must provide a valid Gmail ID if it is defined as the provider")}catch(u){m.default.reportError(u)}s=parseInt(r.threadID)}var l=r.id;o=this._mailbirdOutAPI.call("selectConversationEx",s,l,+r.latestMessageAt)}else{l=r.id.replace("mailbird_","");o=this._mailbirdOutAPI.call("selectConversation",l)}try{m.default.PAssert(552,void 0!==o,"Must always receive a value back from Mailbird")}catch(u){m.default.reportError(u)}if(!0===o||!1===o)try{m.default.PAssert(553,o,"Must have successfully selected the email conversation in Mailbird: ",r.id,r.provider)}catch(u){m.default.reportError(u)}else{try{m.default.PAssert(554,o&&o.then,"Must have a valid promise object returned")}catch(u){m.default.reportError(u)}o.then((function(e){try{m.default.PAssert(555,e,"Must have successfully selected the email conversation in Mailbird: ",r.id,r.provider)}catch(u){m.default.reportError(u)}}),(function(e){try{m.default.PAssert(556,!1,"Failed to successfully select the email conversation in Mailbird: ",r.id,r.provider)}catch(u){m.default.reportError(u)}}))}}else switch(r.provider){case di:m.default.openUrl("https://mail.google.com/mail/u/0/#inbox/"+r.threadID);break;default:bo.toasts.pushMessage(y.a.MessageID.MailbirdClick)}return!0}return!1}},{key:"getDisplayTags",value:function(e){return[]}},{key:"getDisplayParticipants",value:function(e){return""}},{key:"matchAttachment",value:function(e,t){return e.getField("fromLower").indexOf(t)>=0||e.getField("subjectLower").indexOf(t)>=0}},{key:"findMatchExact",value:function(e){}},{key:"findMatchLike",value:function(e,t){var a=e.toLowerCase();return this.findCachedItemsByFn((function(e){return e.subjectLower.indexOf(a)>=0||e.fromLower.indexOf(a)>=0}),t)}},{key:"requestData",value:function(e,t){e.hasField("subject")?(e.notifyDataLoaded(y.a.PluginLoad.Full,!1,void 0,y.a.ChangeType.Remote),e.hasInlineData()||!this.isMailbirdEmbed||this._needInlineDataUpdate.includes(e)||(this._needInlineDataUpdate.push(e),this._timeoutInlineDataUpdate||(this._timeoutInlineDataUpdate=setTimeout(this.processMissingInlineUpdates,1e3))),e.hasField("latestMessageAt")||this.requestMissingData(e)):this.requestMissingData(e)}},{key:"requestMissingData",value:function(e){var t=this;this._canUpdateInlineData&&setTimeout((function(){t._mailbirdOutAPI.call("getByIdEx",e.id).then((function(a){try{var n=JSON.parse(a);if(n){var r=hi(n);t.cacheData(r.id,r),t.fixAttach(e)}}catch(i){m.default.reportError(i)}}))}),1e3)}},{key:"processMissingInlineUpdates",value:function(){var e=this._needInlineDataUpdate;if(e.length>0)for(var t=0,a=0;a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e[a];n.isLoaded()&&this.fixAttach(n)}}},{key:"fixAttach",value:function(e){var t=this;e.forEachItem(bo.itemStoreManager.getDefaultItemStore(),(function(a){var n=a.getRawText();n=n.replace(t._getTextForItem(e.getData().id,e.getData().accountID),t.getAttachmentEmbedString(e)),a.setText(a.getParsedText(),y.a.ChangeType.Local)}))}},{key:"getStyledText",value:function(e,t,a,n){return In.a.renderStyled(e,t,a,n)}},{key:"getUnstyledText",value:function(e){return In.a.renderPlain(e)}}]),a}(ka),_()(ei.prototype,"processMissingInlineUpdates",[b.a],Object.getOwnPropertyDescriptor(ei.prototype,"processMissingInlineUpdates"),ei.prototype),ei);function gi(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var mi,vi=1,yi=3,ki=4,_i=5,bi=6,wi=7,Si=8,Di=9,Pi=10,Ii=11,Ei=12,Ci=13,xi=6,Ai="createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)",Ti=function(e){d()(a,e);var t=gi(a);function a(){var e;return i()(this,a),(e=t.call(this,y.a.PluginID.Moodo,"m","Moodo",!0)).setSetting(e.Settings.IsEnabled,!0,!1),e}return s()(a,[{key:"isPluginBlocked",value:function(){return!1}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"hasSyncAccount",value:function(e,t){return u()(g()(a.prototype),"hasSyncAccount",this).call(this,e,t)||bo.pluginManager.getPluginDrive().hasSyncAccount(e,t)}},{key:"getRemoteAttachmentData",value:function(e){this.cacheData(e.id,{})}},{key:"runRemoteSingleRequest",value:function(e,t,a,n,r,i,o){this._queueRemoteRequestMulti(e,t,a,n,r,void 0,i||vi,o)}},{key:"runRemotePagedRequest",value:function(e,t,a,n,r,i,o){i||(i={}),this._queuePagedRemoteRequestMulti(e,t,a,n,r,void 0,o,i)}},{key:"drivePermissionsInsert",value:function(e,t,a,n,r,i){try{m.default.PAssert(557,m.default.isEmail(a),"Should pass in a valid email address")}catch(l){m.default.reportError(l)}var o=ea.a.fns("drive").permissions.insert.packedFn,s={fileId:t,sendNotificationEmails:n,resource:{value:a,type:"user",role:"writer",withLink:!1}};this.runRemoteSingleRequest(e,o,s,r,i,void 0,yi)}},{key:"drivePermissionsDelete",value:function(e,t,a,n,r){var i=ea.a.fns("drive").permissions.delete.packedFn,o={fileId:t,permissionId:a};this.runRemoteSingleRequest(e,i,o,n,r,void 0,ki)}},{key:"drivePermissionsList",value:function(e,t,a,n){var r=ea.a.fns("drive").permissions.list.packedFn,i={fileId:t,fields:"items(id,name,role,type,emailAddress)"};this.runRemoteSingleRequest(e,r,i,a,n,void 0,_i)}},{key:"drivePermissionsPublic",value:function(e,t,a,n){var r=ea.a.fns("drive").permissions.insert.packedFn,i={fileId:t,sendNotificationEmails:!1,resource:{type:"anyone",role:"reader",withLink:!0}};this.runRemoteSingleRequest(e,r,i,a,n,void 0,yi)}},{key:"driveFilesGet",value:function(e,t,a,n,r){var i=ea.a.fns("drive").files.get.packedFn,o={fileId:t,fields:Ai};r&&r.props&&Object.assign(o,r.props),this.runRemoteSingleRequest(e,i,o,a,n,void 0,bi)}},{key:"driveFilesExport",value:function(e,t,a,n,r){var i=ea.a.fns("drive").files.export.packedFn,o={fileId:t,mimeType:"application/vnd.google-apps.drive-sdk.597847337936"};this.runRemoteSingleRequest(e,i,o,a,n,void 0,xi)}},{key:"driveFilesList",value:function(e,t,a,n,r){var i=ea.a.fns("drive").files.list.packedFn,o={q:t,fields:"items(createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)),nextPageToken"};r&&r.props&&Object.assign(o,r.props),this.runRemotePagedRequest(e,i,o,a,n,void 0,wi)}},{key:"driveFilesTrash",value:function(e,t,a,n){var r=ea.a.fns("drive").files.trash.packedFn,i={fileId:t};this.runRemoteSingleRequest(e,r,i,a,n,void 0,wi)}},{key:"driveFilesUntrash",value:function(e,t,a,n){var r=ea.a.fns("drive").files.untrash.packedFn,i={fileId:t};this.runRemoteSingleRequest(e,r,i,a,n,void 0,Si)}},{key:"drivePropertiesInsert",value:function(e,t,a,n,r,i){var o=ea.a.fns("drive").properties.insert.packedFn,s={fileId:t,resource:{key:a,value:n,visibility:"PRIVATE"}};this.runRemoteSingleRequest(e,o,s,r,i,void 0,Di)}},{key:"drivePropertiesUpdate",value:function(e,t,a,n,r,i){var o=ea.a.fns("drive").properties.update.packedFn,s={fileId:t,propertyKey:a,resource:{key:a,value:n,visibility:"PRIVATE"}};this.runRemoteSingleRequest(e,o,s,r,i,void 0,Pi)}},{key:"driveParentsInsert",value:function(e,t,a,n,r){var i=ea.a.fns("drive").parents.insert.packedFn,o={fileId:t,resource:{id:a}};this.runRemoteSingleRequest(e,i,o,n,r,void 0,Ii)}},{key:"driveParentsDelete",value:function(e,t,a,n,r){var i=ea.a.fns("drive").parents.delete.packedFn,o={fileId:t,parentId:a};this.runRemoteSingleRequest(e,i,o,n,r,void 0,Ei)}},{key:"driveChildrenList",value:function(e,t,a,n,r){var i=ea.a.fns("drive").children.list.packedFn,o={folderId:t,fields:"items(id),nextPageToken"};this.runRemoteSingleRequest(e,i,o,a,n,void 0,Ci)}}]),a}(ka);function Mi(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var Li,Oi,Ri,Fi=m.default.seconds(30),Ni={Email:{a:"accountID",t:"text",s:"service"},Gmail:{a:"accountID",s:"subject"}},Bi=(mi=function(e){d()(a,e);var t=Mi(a);function a(){var e;return i()(this,a),(e=t.call(this))._plugins={},e._activePlugins=[],e._loadedDependencies={},e._iteratingPlugins=!1,e._hasAdjustedCacheSizeRatio=!1,e._queueTimeout=void 0,e._forcedLastPossible=!1,e._numOutstandingReqs=0,ee.a.onAuthTokensUpdated.listen(e.pokeRequestQueues),e}return s()(a,[{key:"init",value:function(){var e=this;this._setupRequestQueues(),m.default.isDemoMode()&&this.notifyDependencyLoad(y.a.PluginDependency.DemoMode);var t=function(){"Online"===j.a.onlineStatus.get()&&ee.a.isLoaded.get()&&e.goOnline()};j.a.onlineStatus.listen(t),ee.a.isLoaded.listen(t),w.a.onForeground.listen(t),se.a.listen("resetEverything",this._clearRequestQueues),this.registerPlugins()}},{key:"printStats",value:function(e){if(m.default.log("---- Plugin Stats ----"),void 0!==e){var t=this._plugins[e];m.default.log(t.name),m.default.log(" Stats: ",t.getStats())}else for(var a=0,n=Object.keys(this._plugins),r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=this._plugins[n[r]],o=i.getStats();m.default.log(i.name),m.default.log(" Stats: ",o)}m.default.log("----------------------")}},{key:"dumpQueueState",value:function(){var e=0,t=Object.keys(this._plugins);console.log("Queue State: ["+this._numOutstandingReqs+"]");for(var a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._plugins[t[a]];console.log(n.name),n.dumpRequestQueue(!1)}}},{key:"dumpQueueStats",value:function(){for(var e=0,t=Object.keys(this._plugins),a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._plugins[t[a]];console.log(n.name),n.dumpQueueStats()}}},{key:"getStats",value:function(e){var t={};if(void 0!==e)t[e]=this._plugins[e].getStats();else for(var a=0,n=Object.keys(this._plugins),r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=this._plugins[n[r]];t[i.id]=i.getStats()}return t}},{key:"getCacheStats",value:function(e,t){var a=this,n={};void 0!==e?this._plugins[e].getCacheStats(t):function(){for(var e=0,r=Object.keys(a._plugins),i=0,o=0;o<r.length;++o){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a._plugins[r[o]].getCacheStats(function(e,a){a&&(n[e]=a),r.length===++i&&t(n)}.bind(a,r[o]))}}()}},{key:"getState",value:function(e){var t={};if(void 0!==e)t[e]=this._plugins[e].getState();else for(var a=0,n=Object.keys(this._plugins),r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=this._plugins[n[r]];t[i.id]=i.getState()}return t}},{key:"registerPlugins",value:function(){try{this.registerPlugin(new Ti)}catch(t){m.default.reportError(t)}try{this.registerPlugin(new Ja)}catch(t){m.default.reportError(t)}try{var e=new ui;this.registerPlugin(e),this._plugins[y.a.PluginID.Email]=e}catch(t){m.default.reportError(t)}try{this.registerPlugin(new Sn)}catch(t){m.default.reportError(t)}try{this.registerPlugin(new pi)}catch(t){m.default.reportError(t)}this.registerPlugin(new ba)}},{key:"registerPlugin",value:function(e){try{m.default.PAssert(428,!this._plugins[e.id],"Should never double-register a plguin")}catch(t){m.default.reportError(t)}this._plugins[e.id]=e,this.isAuthorized(e.id)&&this.loadPlugin(e.id)}},{key:"getPlugin",value:function(e){return this._plugins[e]}},{key:"getPluginGmail",value:function(){return this._plugins[y.a.PluginID.Gmail]}},{key:"getPluginDrive",value:function(){return this._plugins[y.a.PluginID.Drive]}},{key:"getPluginGCalendar",value:function(){return this._plugins[y.a.PluginID.GCalendar]}},{key:"loadPlugin",value:function(e){var t=this.getPlugin(e);try{m.default.PAssert(429,t,"Must register a plugin before loading it")}catch(a){m.default.reportError(a)}this.activatePlugin(t)}},{key:"unloadPlugin",value:function(e){}},{key:"authorizePlugin",value:function(e,t,a){a(!0)}},{key:"deauthorizePlugin",value:function(e,t){try{m.default.PAssert(432,t&&m.default.isFunction(t),"Must provide a valid callback fn")}catch(n){m.default.reportError(n)}var a=this.getPlugin(e);try{m.default.PAssert(433,a,"Must register a plugin before loading it")}catch(n){m.default.reportError(n)}a.setSetting(a.Settings.IsEnabled,!1),m.default.shouldLog(y.a.LogLevels.Plugin)&&m.default.log("Plugin Deauthorized: ",e),this.deactivatePlugin(a),t(!0)}},{key:"onPluginAuthorized",value:function(e,t){e.setSetting(e.Settings.IsEnabled,t),m.default.shouldLog(y.a.LogLevels.Plugin)&&m.default.log("Plugin Authorized: ",e.id,t),t&&this.activatePlugin(e)}},{key:"activatePlugin",value:function(e){try{m.default.PAssert(434,e,"Plugin must be valid to be activated")}catch(t){m.default.reportError(t)}e.activate(this._loadedDependencies)&&this._activePlugins.indexOf(e.id)<0&&this._activePlugins.push(e.id),e.ensurePaneTypeIsActive(),m.default.shouldLog(y.a.LogLevels.Plugin)&&m.default.log("Plugin Activated: ",e.id)}},{key:"deactivatePlugin",value:function(e){try{m.default.PAssert(435,e,"Plugin must be valid to be deactivated")}catch(t){m.default.reportError(t)}this._activePlugins.indexOf(e.id)>=0&&(e.deactivate()&&this._activePlugins.remove(e.id),m.default.shouldLog(y.a.LogLevels.Plugin)&&m.default.log("Plugin Deactivated: ",e.id))}},{key:"isOnline",value:function(){return j.a.isConnected()||m.default.isDemoMode()}},{key:"goOnline",value:function(){var e=this;setTimeout((function(){var t=0;e._setupRequestQueues(!0);for(var a=0;a<e._activePlugins.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e._plugins[e._activePlugins[a]];try{n.goOnline()}catch(r){e._reportPluginError(r)}}}),0)}},{key:"onDocumentShared",value:function(e){for(var t=0,a=0;a<this._activePlugins.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this._plugins[this._activePlugins[a]];try{n.onDocumentShared(e)}catch(r){this._reportPluginError(r)}}}},{key:"onShutdown",value:function(){for(var e=0,t=[],a=0;a<this._activePlugins.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._plugins[this._activePlugins[a]];try{var r=n.onShutdown();r&&t.push(r)}catch(i){this._reportPluginError(i)}}return t.length>0?t:void 0}},{key:"onClearData",value:function(){for(var e=0,t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._plugins[this._activePlugins[t]];try{a.clearData()}catch(n){this._reportPluginError(n)}}}},{key:"getCacheSizeRatio",value:function(){var e=bo.settings.cacheSizeRatio.get()||1;try{m.default.PAssert(436,e>=0&&e<=1,"Invalid ratio value: "+e)}catch(t){m.default.reportError(t)}return e}},{key:"hasAdjustedCacheSizeRatio",value:function(){return this._hasAdjustedCacheSizeRatio}},{key:"_adjustCacheSizeRatio",value:function(){var e=this.getCacheSizeRatio();1===e&&m.default.sendEvent("CacheRatioChange","FromDefault");e>.35?e-=.1:m.default.sendEvent("CacheRatioChange","Minimum"),m.default.sendEvent("CacheRatioChange","Change",e),bo.settings.cacheSizeRatio.set(e)}},{key:"onCacheLimitExceeded",value:function(){if(!this._hasAdjustedCacheSizeRatio){var e=0;this._hasAdjustedCacheSizeRatio=!0,this._adjustCacheSizeRatio();for(var t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._plugins[this._activePlugins[t]];try{a.onCacheLimitExceeded()}catch(n){this._reportPluginError(n)}}}}},{key:"getPluginsForType",value:function(e){var t;switch(e){case y.a.PluginType.Calendar:t=[y.a.PluginID.GCalendar];break;case y.a.PluginType.Email:t=[y.a.PluginID.Gmail];break;case y.a.PluginType.Storage:t=[y.a.PluginID.Drive];break;case y.a.PluginType.Unknown:t=[y.a.PluginID.Mailbird,y.a.PluginID.Moodo]}return t}},{key:"hasAttachmentType",value:function(e,t){var a=!1;if(e.hasAttachments())for(var n=0,r=this.getPluginsForType(t),i=0;i<r.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e.hasPluginAttachment(r[i])){a=!0;break}}return a}},{key:"allowTextEditing",value:function(e){var t=!0;if(e&&e.hasAttachments())for(var a=0,n=e.getAttachments(),r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!n[r].getPlugin().allowTextEditing(e,n[r])){t=!1;break}}return t}},{key:"validatePlugin",value:function(e){}},{key:"runForEachPlugin",value:function(e){var t=0;this._iteratingPlugins=!0;for(var a=0;a<this._activePlugins.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{e(this.getPlugin(this._activePlugins[a]))}catch(n){m.default.reportError(n)}}this._iteratingPlugins=!1}},{key:"getAttachment",value:function(e,t){try{m.default.PAssert(437,e.p,"Must specify the plugin string to be used: ",e)}catch(n){m.default.reportError(n)}try{m.default.PAssert(438,e.id,"Must specify the ID of the data to use from the plugin: ",e)}catch(n){m.default.reportError(n)}var a=this.getPlugin("Email"===e.p?"Gmail":e.p);try{m.default.PAssert(439,a,"Must specify a valid plugin: ",e)}catch(n){m.default.reportError(n)}if(a)return a.getAttachment(e.id,t?e:void 0)}},{key:"createDisplayElement",value:function(e,t){try{m.default.PAssert(440,e.p,"Must specify the plugin string to be used")}catch(i){m.default.reportError(i)}try{m.default.PAssert(441,e.id,"Must specify the ID of the data to use from the plugin")}catch(i){m.default.reportError(i)}var a,n=this.getPlugin(e.p);if(n){var r=this.getAttachment(e,t);if(r)try{a=n.createDisplayElement(r)}catch(o){this._reportPluginError(o),a=this.createUnknownPluginElement(e.p)}else a=this.createUnknownPluginElement(e.p)}else a=this.createUnknownPluginElement(e.p);return a}},{key:"createUnknownPluginElement",value:function(e){return{attrs:{cls:[],isUnknown:!0,plugin:y.a.PluginID.Moodo,"plugin-id":"Invalid"}}}},{key:"parseAttachmentEmbedString",value:function(e,t){try{m.default.PAssert(442,e,"Must provide a valid string to parse")}catch(o){m.default.reportError(o)}var a,n=e.replace(/&quot;/g,'"').split(","),r={};if(n.forEach((function(e){var t,n=e.indexOf(":"),i=e.substr(0,n);i=a&&(null===(t=Ni[a])||void 0===t?void 0:t[i])||i;var o=e.substr(n+1,e.length-n-1);if("p"!==i&&"id"!==i)try{o=decodeURIComponent(o)}catch(s){}r[i]=o,"p"===i&&(a=o)})),t){var i=n.length>2;r.displayElement=this.createDisplayElement(r,i),r.hasInlineData=i}return r}},{key:"createSimpleAttachment",value:function(e){return e.isSimpleAttachment=!0,e}},{key:"handleDropEvent",value:function(e,t){for(var a,n,r=0,i=e.dataTransfer,o=e.clipboardData,s=e.target,l=!1,u=!1,c=0;c<this._activePlugins.length&&!l;++c){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var d=this._activePlugins[c],h=this.getPlugin(d);try{l=h.handleDropEvent({dataTransfer:i,clipboardData:o,target:s},t)}catch(p){this._reportPluginError(p),u=!0}}if(!l&&((null===i||void 0===i||null===(a=i.files)||void 0===a?void 0:a.length)>0||(null===o||void 0===o||null===(n=o.items)||void 0===n?void 0:n.length)>0)){var f=u?{text:"An error was detected handling drag drop and the developers have been notified",action:y.a.MessageAction.OpenSettings}:{text:"Attaching files is a Premium feature, using the Drive plugin. Please enable Drive in the settings.",action:y.a.MessageAction.OpenSettings};bo.toasts.pushMessage(f),l=!0}return l}},{key:"handleTapClick",value:function(e,t,a){var n=!1,r=e.props.plugin,i=r.p,o=r.id,s=this.getPlugin(i);try{m.default.PAssert(443,s,"Must be able to get a valid plugin from a plugin element")}catch(d){m.default.reportError(d)}if(s.isPluginBlocked())bo.toasts.pushMessage(y.a.MessageID.PremiumRequired),n=!0;else{try{m.default.PAssert(444,o,"Must have a valid item ID for a plugin element")}catch(d){m.default.reportError(d)}try{var l,u=t.item,c=t.pane;n=null===(l=s.handleTapClick)||void 0===l?void 0:l.call(s,u,c,o,a)}catch(h){this._reportPluginError(h)}}return n}},{key:"isAuthorized",value:function(e){return!(!m.default.isDemoMode()||e===y.a.PluginID.Gmail)||!!this.getPlugin(e)&&!!this.getSetting(e,this.getPlugin(e).Settings.IsEnabled)}},{key:"getSetting",value:function(e,t){return this.getPlugin(e).getSetting(t)}},{key:"setSetting",value:function(e,t,a){return this.getPlugin(e).setSetting(t,a)}},{key:"onAuthorizedSetting",value:function(e,t,a){this.getPlugin(e).onAuthorizedSetting(t,a)}},{key:"notifyDependencyLoad",value:function(e,t){for(var a in this._loadedDependencies[e]=t||!0,this._plugins)if(this._plugins.hasOwnProperty(a))try{this.getPlugin(a).onDependencyLoaded(e,t)}catch(n){this._reportPluginError(n)}}},{key:"notifyDependencyUnload",value:function(e,t){}},{key:"_handleBatchRequestResponse",value:function(e,t){try{m.default.PAssert(446,e,"Plugin must be passed to response to know who is handling it")}catch(a){m.default.reportError(a)}this._numOutstandingReqs--;try{m.default.PAssert(447,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(a){m.default.reportError(a)}try{e._handleBatchRequestResponse(t)}catch(n){this._reportPluginError(n)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()}},{key:"_handleRequestResponse",value:function(e,t,a){try{m.default.PAssert(448,t,"Plugin must be passed to response to know who is handling it")}catch(n){m.default.reportError(n)}if(!a){this._numOutstandingReqs--;try{m.default.PAssert(449,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(n){m.default.reportError(n)}}try{t._handleRequestResponse(e,a)}catch(r){this._reportPluginError(r)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()}},{key:"notifyNoOutstandingReqs",value:function(){try{m.default.PAssert(450,0===this._numOutstandingReqs,"Should only notify when there are no outstanding reqs left")}catch(e){m.default.reportError(e)}0===this._numOutstandingReqs&&this._setupRequestQueues(!0)}},{key:"notifyHasPendingRemoteRequest",value:function(){this._numOutstandingReqs<6&&this._setupRequestQueues(!0)}},{key:"notifyAuthorizationAdded",value:function(e){this._numOutstandingReqs<6&&this._setupRequestQueues(!0),this.verifyAuthorization(e)}},{key:"verifyAuthorization",value:function(e,t){for(var a,n,r=0,i=0;i<this._activePlugins.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=this._activePlugins[i],s=this.getPlugin(o);if(s.isEnabled())!s.verifyAuthorization(e)&&(n=(n||[]).concat(s.googleScopes())),a=a||!s.verifyAuthorization(e)}}},{key:"pokeRequestQueues",value:function(){this._setupRequestQueues(!0)}},{key:"_setupRequestQueues",value:function(e){var t=e?1:Fi;this._forcedLastPossible||(clearTimeout(this._queueTimeout),this._queueTimeout=setTimeout(this._pumpRequestQueues,t)),this._forcedLastPossible=this._forcedLastPossible||!!e}},{key:"_pumpRequestQueues",value:function(){this._runPumpRequestQueues(y.a.RequestPriority.UserBlocking),this._runPumpRequestQueues(y.a.RequestPriority.Default),this._runPumpRequestQueues(y.a.RequestPriority.Low)}},{key:"_runPumpRequestQueues",value:function(e){var t=0;if(this.isOnline()){var a=0,n=6-this._numOutstandingReqs;try{m.default.PAssert(451,n>=0,"Should never have more than max outstanding requests at any given point in time")}catch(c){m.default.reportError(c)}for(var r=0;n>0&&r<this._activePlugins.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=this._activePlugins[r],o=this.getPlugin(i),s=4-o.getNumOutstandingReqs();try{m.default.PAssert(452,s>=0,"Must always have a postiive number of available plugin reqs")}catch(c){m.default.reportError(c)}var l=Math.min(n,s);if(l>0&&o.isReady()){var u=0;try{u=o._pumpRequestQueue(e,l,this._handleRequestResponse,this._handleBatchRequestResponse);try{m.default.PAssert(453,u>=0,"Number of requests sent can never be negative")}catch(c){m.default.reportError(c)}}catch(d){this._reportPluginError(d)}try{m.default.PAssert(454,n-u>=0,"Too Many requests sent")}catch(c){m.default.reportError(c)}t+=u,n-=u,this._numOutstandingReqs+=u}}}else 0;return this._forcedLastPossible=!1,this._setupRequestQueues(),t}},{key:"_clearRequestQueues",value:function(){var e=0;this._numOutstandingReqs=0;for(var t=0;t<this._activePlugins.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._activePlugins[t],n=this.getPlugin(a);try{n._clearRequestQueue()}catch(r){this._reportPluginError(r)}}}},{key:"_reportPluginError",value:function(e){m.default.reportError(e)}},{key:"parseEmailURL",value:function(e){var t={accountID:void 0,threadID:void 0,plugin:void 0},a=/https:\/\/mail.google.com\/mail\/b\/(.*)#all\/(.*)/g.exec(e);return a&&(t.accountID=a[1],t.threadID=a[2],t.plugin=this.getPlugin(y.a.PluginID.Gmail)),t}},{key:"isAvailable",value:function(e){return this.getPlugin(e).isAvailable()}},{key:"isActive",value:function(e){return this.getPlugin(e).isActive()}},{key:"isEnabled",value:function(e){return this.getPlugin(e).isEnabled()}},{key:"isGmailEnabled",value:function(){return this.isEnabled(y.a.PluginID.Gmail)}},{key:"isDriveEnabled",value:function(){return this.isEnabled(y.a.PluginID.Drive)}},{key:"getPluginScopes",value:function(e,t){return e===y.a.PluginID.Contacts?[y.a.GScope.Contacts]:this.getPlugin(e).googleScopes(e===y.a.PluginID.Drive&&t)}},{key:"getAllPluginScopes",value:function(e,t){return y.a.ScopesDefault.concat(m.default.arrayFlat(e.map((function(e){return bo.pluginManager.getPluginScopes(e,t)}))))}}]),a}(D.a),_()(mi.prototype,"goOnline",[b.a],Object.getOwnPropertyDescriptor(mi.prototype,"goOnline"),mi.prototype),_()(mi.prototype,"_handleBatchRequestResponse",[b.a],Object.getOwnPropertyDescriptor(mi.prototype,"_handleBatchRequestResponse"),mi.prototype),_()(mi.prototype,"_handleRequestResponse",[b.a],Object.getOwnPropertyDescriptor(mi.prototype,"_handleRequestResponse"),mi.prototype),_()(mi.prototype,"pokeRequestQueues",[b.a],Object.getOwnPropertyDescriptor(mi.prototype,"pokeRequestQueues"),mi.prototype),_()(mi.prototype,"_pumpRequestQueues",[b.a],Object.getOwnPropertyDescriptor(mi.prototype,"_pumpRequestQueues"),mi.prototype),_()(mi.prototype,"_clearRequestQueues",[b.a],Object.getOwnPropertyDescriptor(mi.prototype,"_clearRequestQueues"),mi.prototype),_()(mi.prototype,"getPluginScopes",[b.a],Object.getOwnPropertyDescriptor(mi.prototype,"getPluginScopes"),mi.prototype),mi),ji=new(Li=function(){function e(){i()(this,e),this.scheduledItems=[],this.notifiedItems={},this.timeouts={},this.timeoutNextNotification=void 0,this.frequency=15*y.a.MSPerMinute}return s()(e,[{key:"scheduleItems",value:function(e){var t=this;this.scheduledItems=e,w.a.hasNotificationPermission()?this.runNotifications():Notification.requestPermission((function(){t.runNotifications()}))}},{key:"runNotifications",value:function(){for(var e=0,t=0;t<this.scheduledItems.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.scheduledItems[t];this.notifiedItems[a.id]&&this.notifiedItems[a.id]===a.date||this.runNotification(a)}m.default.shouldLog(y.a.LogLevels.Timeline)&&m.default.log("Next Notifications in: ",this.frequency),clearTimeout(this.timeoutNextNotification),this.timeoutNextNotification=setTimeout(this.runNotifications,this.frequency)}},{key:"runNotification",value:function(e){var t=e.id,a=new Date,n=e.alertDate,r=Math.max(n.getTime()-a.getTime(),0);r<0?this.doNotification(e):r<=this.frequency?(clearTimeout(this.timeouts[t]),this.timeouts[t]=setTimeout(this.doNotification.bind(this,e),r)):this.notifiedItems[t]=e.date}},{key:"doNotification",value:function(e){var t=e.date,a=Math.ceil((t.getTime()-Date.now())/y.a.MSPerMinute);new Notification(e.text,{body:a>0?"in "+a+" minutes":"now",icon:w.a.isNativeApp()?void 0:"/img/favicon-96x96.png",requireInteraction:!0});this.notifiedItems[e.id]=e.date,m.default.shouldLog(y.a.LogLevels.Timeline)&&m.default.log("Show HTML5 Notification: ",e)}}]),e}(),_()(Li.prototype,"runNotifications",[b.a],Object.getOwnPropertyDescriptor(Li.prototype,"runNotifications"),Li.prototype),Li),Ui=new(function(){function e(){i()(this,e)}return s()(e,[{key:"setNotifications",value:function(e){if(w.a.app){var t=e.map((function(e){return{id:e.id,text:e.text,alertDate:+e.alertDate,date:+e.date,endDate:+e.endDate,message:"".concat(bo.International.formatDate(e.date,y.a.DFormat.ShortTime)," - ").concat(bo.International.formatDate(e.endDate,y.a.DFormat.ShortTime))}}));S.a.setNotifications(t)}else w.a.usesHTML5Notifications()?(ji.scheduleItems(e),m.default.shouldLog(y.a.LogLevels.Timeline)&&m.default.log("HTML5 Scheduling Completed: ",e.length)):bo.nativeBridge.isEnabled()?bo.nativeBridge.sendToApp("scheduledItems",this.convertForSend(e)):bo.nativeBridge.hasEmbedBridge()&&bo.nativeBridge.sendToEmbed("scheduledItems",this.convertForSend(e))}},{key:"convertForSend",value:function(e){return e.map((function(e){return{id:e.id,text:e.text,date:e.date.toJSON(),alertDate:e.date.toJSON()}}))}}]),e}()),Hi=5e3,Vi=(Oi=function(){function e(){i()(this,e),this.notificationItems={},this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0,this.oldSoftDates=["now","next","soon","later","someday"],this.agendaSort=bo.settings.agendaSort}return s()(e,[{key:"clearDailyCaches",value:function(){}},{key:"addNotification",value:function(e){try{m.default.PAssert(308,e,"Must provide a valid item to schedule notifications for")}catch(t){m.default.reportError(t)}this.notificationItems[e.id]=e,this.numNotificationItemsChanged++,clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,Hi),m.default.shouldLog(y.a.LogLevels.Timeline)&&m.default.log("Add Notification: ",e)}},{key:"removeNotification",value:function(e){try{m.default.PAssert(309,e,"Must provide a valid item to unschedule notifications for")}catch(t){m.default.reportError(t)}this.notificationItems[e.id]&&(this.notificationItems[e.id]=void 0,this.numNotificationItemsChanged++,clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,Hi),m.default.shouldLog(y.a.LogLevels.Timeline)&&m.default.log("Remove Notification: ",e))}},{key:"clearNotifications",value:function(){var e=this;Object.keys(this.notificationItems).forEach((function(t){e.notificationItems[t]=void 0,e.numNotificationItemsChanged++})),clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,Hi),m.default.shouldLog(y.a.LogLevels.Timeline)&&m.default.log("Clear Notifications")}},{key:"shouldNotify",value:function(e,t){var a=e.getNextDate();return!e.isDestroyed()&&!e.isDeleted()&&!e.isComplete()&&!e.hasCompletedAncestor()&&!e.allDayDate()&&a&&a>t&&+a-Date.now()<864e5}},{key:"updateNotifications",value:function(e){var t=this;if(w.a.supportsNotifications()&&ne.a.isNotificationsEnabled()&&!m.default.isDemoMode()){var a=new Date;e?(m.default.__SINGLE_NOTIFICATION_UPDATES++,this.shouldNotify(e,a)?this.addNotification(e):this.removeNotification(e)):(m.default.__FULL_NOTIFICATION_UPDATES++,this.clearNotifications(),j.a.runOnAllDocumentRoots((function(e){m.default.searchVMLIs({item:e,each:function(e){t.shouldNotify(e,a)&&t.addNotification(e)}})})))}}},{key:"setupNotifications",value:function(){var e=this;try{m.default.PAssert(310,w.a.supportsNotifications(),"Platform must support notifications")}catch(a){m.default.reportError(a)}var t=[];Object.keys(this.notificationItems).forEach((function(a){var n=e.notificationItems[a];if(n&&n.getNotificationEntry){var r=n.getNotificationEntry();r&&t.push(r)}else delete e.notificationItems[a]})),Ui.setNotifications(t),m.default.shouldLog(y.a.LogLevels.Timeline)&&m.default.log("Notifications Scheduled: "+this.numNotificationItemsChanged),this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0,m.default.shouldLog(y.a.LogLevels.Timeline)&&m.default.log("Scheduled Notifications: ",t)}},{key:"getDateForKey",value:function(e){return this.oldSoftDates.indexOf(e)>=0&&(e="#"+e),this.agendaSort.get()[e]}},{key:"saveAgendaSort",value:function(e){this.agendaSort.set(e),bo.settings.agendaSort.set(e),bo.PaneManager.runForEachPane((function(e){e.isViewAgenda()&&e.setItemsDirty()})),bo.PaneUpdateBatcher.updateAllItems()}}]),e}(),_()(Oi.prototype,"updateNotifications",[b.a],Object.getOwnPropertyDescriptor(Oi.prototype,"updateNotifications"),Oi.prototype),_()(Oi.prototype,"setupNotifications",[b.a],Object.getOwnPropertyDescriptor(Oi.prototype,"setupNotifications"),Oi.prototype),Oi),Wi=function(){function e(){i()(this,e)}return s()(e,[{key:"init",value:function(){this.settings=new Qt,this.International=new Ye,this.billingManager=new we,this.pluginManager=new Bi,this.DisplaySettings=new T,this.itemStoreManager=new _t,this.PaneUpdateBatcher=new wt,this.PaneManager=new he,this.DragDrop=new M.default,this.timeline=new Vi,this.cacheManager=new Me,this.recurringTaskManager=new Ot,this.deferredTaskManager=new Fe,this.toasts=new $t,this.ElementRenderer=new Y,this.crypto=new Wt,this.cloudStorage=new Oe,this.dropBucket=new Ne,this.menus=new oe,this.EmailPreview=new We,this.International.init(),this.itemStoreManager.init(),this.cacheManager.init(),this.pluginManager.init(),this.PaneManager.init(),this.recurringTaskManager.init(),this.deferredTaskManager.init(),this.cloudStorage.init(),this.EmailPreview.init(),B.a.init(),Ue.a.init()}},{key:"sendFeedback",value:function(e,t){var a={};v.default.getAppInfo(a),a.eventStream=void 0;var n={name:e,message:t,appInfo:a,email:this.settings.getUserIdentifier(),premiumStatus:this.billingManager.getPremiumStatus()};return ye.a.sendFeedback(n)}},{key:"remoteAPI",value:function(){return this.pluginManager.getPlugin(y.a.PluginID.Moodo)}},{key:"onIntroAction",value:function(e){}}]),e}(),zi=function(){function e(){i()(this,e),this.sidebarTransitioning=!1,this.isDraggingSidebar=new P.a(!1),this.lightboxPosition=new P.a,this.lightboxSrc=new P.a,this.lightboxElement=void 0,this.sidebarChanged=new et.a,this.resizingPane=new P.a,this.cursor=new P.a}return s()(e,[{key:"init",value:function(){var e=this;this.showSidebar=w.a.isMailbirdSidebar()||m.default.isDemoInIframe()?new P.a(!1):bo.settings.showSidebar,this._savedSidebarWidth=y.a.DesktopMenuWidthDefault,this.sidebarWidth=bo.settings.sidebarWidth,bo.settings.onLoaded((function(){var t=bo.settings.sidebarWidth.get();e._savedSidebarWidth=t===y.a.DesktopMenuWidthSmall?y.a.DesktopMenuWidthDefault:t}))}},{key:"toggleSidebar",value:function(e){this.sidebarTransitioning=!0;var t=void 0!==e?e:!this.showSidebar.get();t&&(!0===e&&this._savedSidebarWidth===y.a.DesktopMenuWidthSmall&&(this._savedSidebarWidth=y.a.DesktopMenuWidthDefault),this.sidebarWidth.set(this._savedSidebarWidth)),this._setSidebarVisible(t),this.sidebarChanged.notify()}},{key:"minimize",value:function(){this.sidebarTransitioning=!0;var e=y.a.DesktopMenuWidthSmall;this.sidebarWidth.set(e),this.sidebarChanged.notify()}},{key:"restore",value:function(){this.toggleSidebar(!0)}},{key:"getSidebarWidth",value:function(){return w.a.isMailbirdSidebar()||!this.showSidebar.get()?0:this.sidebarWidth.get()}},{key:"setSidebarWidthMoving",value:function(e){this.showSidebar.set(!0),this.sidebarTransitioning=!1,this.isDraggingSidebar.set(!0),this.sidebarWidth.set(e)}},{key:"setSidebarWidthUp",value:function(){var e=this.sidebarWidth.get();e<20?e=0:e<y.a.DesktopMenuWidthMinBig&&(e=y.a.DesktopMenuWidthSmall),e!==this.sidebarWidth.get()&&(this.sidebarTransitioning=!0,this.sidebarWidth.set(e)),e>0&&(this._savedSidebarWidth=e),this._setSidebarVisible(e>0),this.isDraggingSidebar.set(!1),this.sidebarChanged.notify()}},{key:"_setSidebarVisible",value:function(e){bo.settings.showSidebar.set(e),this.showSidebar.set(e)}},{key:"shouldShowTopBar",value:function(){return!m.default.isDemoInIframe()&&(!this.showSidebar.get()||w.a.isNativeMac()&&this.sidebarWidth.get()<y.a.DesktopMenuWidthMinBig)}},{key:"topBarHeight",value:function(){return this.shouldShowTopBar()?w.a.isNativeMac()?36:32:0}}]),e}(),qi=(Ri=function(){function e(){i()(this,e)}return s()(e,[{key:"setup",value:function(){var e=this;this.downloadToasts={},this.callbacks={},this.nextId=0,this.ipcBridge=window.___electronIPCBridge,this.windowID=ve.a.getURLParam("windowID");try{m.default.PAssert(91,this.ipcBridge,"IPC bridge was not created")}catch(t){m.default.reportError(t)}this.ipcBridge&&(this.ipcBridge.onElectronMessage=this.handleMessage),setTimeout((function(){bo.settings.onLoaded((function(){bo.settings.appHotkeys.listen((function(){return e.sendHotkeys()})),e.sendHotkeys()}))}),100)}},{key:"handleMessage",value:function(e,t){try{if(m.default.isString(t)&&"{"===t[0]&&"}"===t[t.length-1])try{t=JSON.parse(t)}catch(r){m.default.reportError(r)}if(isNaN(+e)){try{m.default.PAssert(92,this["onEvent_"+e],"Missing handler for native event")}catch(i){m.default.reportError(i)}this["onEvent_"+e](t)}else{var a=this.callbacks[+e],n=!1;a&&(m.default.isObject(t)&&("error"in t||"value"in t)&&(a(t.error,t.value),n=!0),!n&&a&&a(t))}}catch(r){m.default.reportError(r)}}},{key:"sendMessage",value:function(e,t,a){if(this.ipcBridge){var n=this.nextId++,r=n+"~"+e;w.a.appv>=7&&(m.default.isString(t)&&(t={value:t}),void 0!==this.windowID&&(t=Object.assign({},t,{windowID:this.windowID}))),void 0!==t&&(r+="~"+(m.default.isString(t)?t:JSON.stringify(t))),a&&(this.callbacks[n]=a),this.ipcBridge.send("moodo-message",r)}}},{key:"sendHotkeys",value:function(){var e=bo.settings.appHotkeys.get();if(e&&!m.default.isEmpty(e)){var t=Object.keys(e).map((function(t){return bo.hotkeys.convertToElectron(e[t])}));this.sendMessage("setShortcuts",t)}}},{key:"saveBackup",value:function(e,t,a){this.sendMessage("saveBackup",{filename:e,data:t},a)}},{key:"saveDoc",value:function(e,t,a){this.sendMessage("saveDoc",{filename:e,data:t},a)}},{key:"listDocss",value:function(e,t){this.sendMessage("listDocs",{folder:e},t)}},{key:"getDoc",value:function(e,t){this.sendMessage("getDoc",{filename:e},t)}},{key:"deleteDoc",value:function(e,t){this.sendMessage("deleteDoc",{filename:e},t)}},{key:"renameDoc",value:function(e,t,a){this.sendMessage("renameDoc",{filenameOld:e,filenameNew:t},a)}},{key:"openDirectoryDialog",value:function(e){this.sendMessage("openDirectoryDialog",{},e)}},{key:"getAllDocs",value:function(e){this.sendMessage("getAllDocs",void 0,(function(t,a){t?e(t):e(void 0,a)}))}},{key:"listenToDocChanges",value:function(e){this._fileListener=e}},{key:"getPrefs",value:function(e){this.sendMessage("getPrefs",void 0,e)}},{key:"setDocsFolder",value:function(e,t,a){this.sendMessage("setDocsFolder",{folder:e,moveFiles:t},a)}},{key:"selectBoard",value:function(e,t){this.sendMessage("selectBoard",{board:e},t)}},{key:"onEvent_fullscreen",value:function(e){w.a.isNativeFullscreen.set(e)}},{key:"onEvent_features",value:function(e){try{e.version&&w.a.recordAppSubVersion(e.version),!1===e.notifications&&w.a.disallowNativeNotifications(),void 0!==e.darkMode&&this.onEvent_darkMode(e.darkMode),void 0!==e.fullscreen&&this.onEvent_fullscreen(e.fullscreen)}catch(t){m.default.reportError(t)}}},{key:"downloadFile",value:function(e,t){try{m.default.PAssert(93,!this.downloadToasts[e],"Should not double create a download for the same file")}catch(a){m.default.reportError(a)}this.downloadToasts[e]=bo.toasts.pushMessage({text:"Downloading "+t+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%",hold:!0,actionText:""}),this.sendMessage("downloadURL",{url:e,name:t})}},{key:"onEvent_downloadProgress",value:function(e){var t=this,a=e.url,n=e.name,r=e.progress,i=e.filename,o=this.downloadToasts[a];if(o)if(1===r)i?(console.log(i),o.action=function(){console.log("toast action"),t.sendMessage("openFile",{filename:i})},o.actionText="OPEN",o.setText("Downloaded: ".concat(n))):o.hide(),delete this.downloadToasts[a];else{var s=isNaN(r)?"...":Math.round(100*r)+"%";o.setText("Downloading "+n+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+s)}}},{key:"onEvent_reportError",value:function(e){m.default.reportError(new Error("Native Error"),e)}},{key:"onEvent_onMenuClick",value:function(e){"NewMessage"===e||"NewEmail"===e?bo.hotkeys.hotkeyEmailCompose():"NewPane"===e?bo.hotkeys.hotkeyAddPane():"NewItem"===e?bo.hotkeys.hotkeyNewItem():"Preferences"===e?bo.menus.openSettings():"GoPremium"===e?bo.menus.openSettings("Account"):"DisplaySettings"===e?bo.menus.openDisplaySettings():"ToggleSidebar"===e?bo.DesktopUI.toggleSidebar():m.default.reportError(new Error("Unknown Native Menu Click: "+e))}},{key:"onEvent_darkMode",value:function(e){this._darkMode=e,bo.DisplaySettings.setSystemDarkMode(e)}},{key:"onEvent_fileChanged",value:function(e){try{this._fileListener(y.a.CrudActions.Modified,e)}catch(t){bo.toasts.pushMessage("A local document has gotten corrupted. Please check the Moo.do documents saved on your computer."),m.default.reportError(t)}}},{key:"onEvent_fileDeleted",value:function(e){try{this._fileListener(y.a.CrudActions.Removed,e)}catch(t){m.default.reportError(t)}}},{key:"onEvent_hotkeyPressed",value:function(e){bo.menus.isModalOpen()||setTimeout((function(){var t=bo.settings.appHotkeys.get(),a=t.newItem,n=t.newEmail;if(a&&bo.hotkeys.convertToElectron(a)===e)bo.menus.openItemEditor({addOnSave:!0,selectDocument:!0,element:"newItemButton"});else if(n&&bo.hotkeys.convertToElectron(n)===e)bo.menus.openComposeEmail(bo.pluginManager.getPluginGmail());else try{m.default.PAssert(94,!1,"Missing action for hotkey")}catch(r){m.default.reportError(r)}}),10)}},{key:"getDarkMode",value:function(){return this._darkMode}}]),e}(),_()(Ri.prototype,"handleMessage",[b.a],Object.getOwnPropertyDescriptor(Ri.prototype,"handleMessage"),Ri.prototype),Ri);function Gi(e){try{m.default.PAssert(414,void 0===window.__MoodoBridge[e],"Registering an Inbound API that already exists on the window object",e)}catch(t){m.default.reportError(t)}this._name=e,this._publicObj={},this._privateObj={},window.__MoodoBridge[e]=this._publicObj,this.init()}Gi.prototype={init:function(){},_createWrapper:function(e){return function(){try{return e.apply(this,arguments)}catch(t){m.default.reportError(t)}}},registerFunction:function(e,t,a){try{m.default.PAssert(415,e,"Name must be provided to register function")}catch(n){m.default.reportError(n)}try{m.default.PAssert(416,t,"A valid function must be provided to register")}catch(n){m.default.reportError(n)}try{m.default.PAssert(417,void 0===this._privateObj[e],"Re-registering an api function on private obj",e)}catch(n){m.default.reportError(n)}try{m.default.PAssert(418,void 0===this._publicObj[e],"Re-registering an api function on public obj",e)}catch(n){m.default.reportError(n)}this._privateObj[e]=t.bind(this._privateObj),a&&(this._publicObj[e]=this._createWrapper(this._privateObj[e]))},registerVariable:function(e,t,a){try{m.default.PAssert(419,e,"Name must be provided to register variable")}catch(n){m.default.reportError(n)}try{m.default.PAssert(420,!a,"Public variables are not currently supported")}catch(n){m.default.reportError(n)}try{m.default.PAssert(421,void 0===this._privateObj[e],"Re-registering an api variable on private obj")}catch(n){m.default.reportError(n)}try{m.default.PAssert(422,void 0===this._publicObj[e],"Re-registering an api variable on public obj")}catch(n){m.default.reportError(n)}this._privateObj[e]=t}},ve.a.defineBase(Gi);var Ki=Gi;function Yi(e){this._name=e,this._apiLoaded=!1,this._apiError=!1,this._listeners=void 0,this._requiredFns=[],this._missingFns=void 0,this.init()}Yi.prototype={init:function(){m.default.isObject(window[this._name])?this.onAPILoaded():(ve.a.forceBind("_checkAPI",this),setTimeout(this._checkAPI,1e3))},_checkAPI:function(){try{m.default.PAssert(329,!this._apiLoaded,"Should not be checking for API load if already loaded")}catch(e){m.default.reportError(e)}m.default.isObject(window[this._name])&&this.onAPILoaded(),this._apiLoaded||setTimeout(this._checkAPI,1e3)},onAPILoaded:function(){var e=0;this._apiLoaded=!0;for(var t=0;t<this._requiredFns.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._requiredFns[t];m.default.isFunction(window[this._name][a])||(this._apiError=!0,this._addMissingFn(a))}this.notifyListeners()},requestNotification:function(e){this._apiLoaded?setTimeout(e,0):this._listeners?this._listeners.push(e):this._listeners=[e]},notifyListeners:function(){try{m.default.PAssert(330,this._apiLoaded,"API must be loaded to notify listeners")}catch(a){m.default.reportError(a)}if(this._listeners)for(var e=0,t=0;t<this._listeners.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._listeners[t]()}this._listeners=void 0},requireFunction:function(e,t){try{m.default.PAssert(331,this._requiredFns.indexOf(e)<0,"Should not double require a single function")}catch(a){m.default.reportError(a)}this._requiredFns.push(e),this._apiLoaded&&(m.default.isFunction(window[this._name][e])||t||(this._apiError=!0,this._addMissingFn(e)))},_addMissingFn:function(e){if(this._missingFns){try{m.default.PAssert(332,this._missingFns.indexOf(e)<0,"Should not be missing the same function multiple times")}catch(t){m.default.reportError(t)}this._missingFns.push(e)}else this._missingFns=[e]},hasOptionalFunction:function(e){try{m.default.PAssert(333,this._requiredFns.indexOf(e)>=0,"Must be querying for a registered function")}catch(t){m.default.reportError(t)}return!!window[this._name]&&!!window[this._name][e]},call:function(e){try{m.default.PAssert(334,this._apiLoaded,"Trying to call an API function before it is loaded",e)}catch(a){m.default.reportError(a)}if(this._apiLoaded){var t=Array.prototype.slice.call(arguments,1);try{return window[this._name][e].apply(window[this._name],t)}catch(n){m.default.reportError(n)}}}},ve.a.defineBase(Yi);var Xi,Qi,Ji,Zi,$i=Yi,eo=(Xi=function(){function e(){i()(this,e)}return s()(e,[{key:"init",value:function(){if(!w.a.isMobile){try{m.default.PAssert(96,this.setupFn,"Must have a valid setup function")}catch(e){m.default.reportError(e)}try{m.default.PAssert(97,this.sendFn,"Must have a valid send function")}catch(e){m.default.reportError(e)}if(!this.setupFn||!this.sendFn)return;this.setupFn()}}},{key:"isEnabled",value:function(){return this._isEnabled}},{key:"registerEmbedBridge",value:function(e){try{m.default.PAssert(98,e,"Must supply a valid embed bridge")}catch(t){m.default.reportError(t)}try{m.default.PAssert(99,w.a.embed,"Must be embedded")}catch(t){m.default.reportError(t)}this._embedBridge=e}},{key:"hasEmbedBridge",value:function(){return!!this._embedBridge}},{key:"sendToEmbed",value:function(e,t){try{m.default.PAssert(100,this.hasEmbedBridge(),"Must have a valid embed bridge to send message: ",e)}catch(a){m.default.reportError(a)}this._embedBridge.handleEmbedMessage(e,t)}},{key:"registerInboundAPI",value:function(e){try{m.default.PAssert(101,!this._inboundAPIs[e],"Should not have already registered an outbound API with this name")}catch(a){m.default.reportError(a)}if(this._canRegisterAPIs){var t=new Ki(e);return this._inboundAPIs[e]=t,t}}},{key:"registerOutboundAPI",value:function(e){try{m.default.PAssert(102,!this._outboundAPIs[e],"Should not have already registered an outbound API with this name")}catch(a){m.default.reportError(a)}if(this._canRegisterAPIs){var t=new $i(e);return this._outboundAPIs[e]=t,t}}},{key:"setupElectron",value:function(){bo.ElectronBridge.setup()}},{key:"sendToApp",value:function(e,t){}},{key:"sendToAppElectron",value:function(e,t){bo.ElectronBridge.sendMessage(e,t)}}]),e}(),_()(Xi.prototype,"setupElectron",[b.a],Object.getOwnPropertyDescriptor(Xi.prototype,"setupElectron"),Xi.prototype),_()(Xi.prototype,"sendToApp",[b.a],Object.getOwnPropertyDescriptor(Xi.prototype,"sendToApp"),Xi.prototype),_()(Xi.prototype,"sendToAppElectron",[b.a],Object.getOwnPropertyDescriptor(Xi.prototype,"sendToAppElectron"),Xi.prototype),Xi),to=y.a.TooltipDelay,ao=function(){function e(){i()(this,e),this.tooltip=new P.a,this.tooltipsSticky=new te.a,this.displayElement=void 0,this.isSticky=!1,this.displayTimeout=void 0,w.a.touch||(se.a.listen("mouseover",this.handleEleOver.bind(this)),se.a.listen("mouseout",this.handleEleOut.bind(this)),window.addEventListener("mouseout",this.windowOut.bind(this)),document.addEventListener("mousedown",this.hideTip.bind(this),!0))}return s()(e,[{key:"windowOut",value:function(e){(e.pageX>=w.a.windowWidth()||e.pageY>=w.a.windowHeight()||e.pageX<=0||e.pageY<=0)&&this.hideTip()}},{key:"register",value:function(e,t){this.update(e,t)}},{key:"update",value:function(e,t){e.setAttribute("tooltip",t)}},{key:"displayTipSticky",value:function(e){e.sticky=!0,this.displayTip(e)}},{key:"displayTip",value:function(e){try{m.default.PAssert(105,e,"When display a tooltip, must pass in some info")}catch(r){m.default.reportError(r)}clearTimeout(this.displayTimeout),this.displayTimeout=void 0;var t=this.displayElement=e.element;if(e&&t&&t.offsetWidth>0&&t.offsetHeight>0){var a=e.text;this.isSticky=e.sticky;try{m.default.PAssert(106,a,"When display a tooltip, elements should always have valid data set")}catch(r){m.default.reportError(r)}if(a){var n={text:a,hotkey:e.hotkey,element:t,blue:e.blue,sticky:e.sticky,maxWidth:e.maxWidth,onRight:e.onRight,arrowClass:e.arrowDirection||"hidden"};e.sticky?this.tooltipsSticky.push(n):this.tooltip.set(n)}}}},{key:"tipOut",value:function(e){var t=!0;e.target&&(t=m.default.isAttachedToDoc(e.target)&&!m.default.findParent(e.target,"tooltip")),t&&this.hideTip()}},{key:"getAttr",value:function(e){return e&&e.getAttribute&&(e.getAttribute("tooltip")||e.getAttribute("data-tooltip"))}},{key:"getAttrHotkey",value:function(e){return e&&e.getAttribute&&(e.getAttribute("tooltipHotkey")||e.getAttribute("data-tooltiphotkey"))}},{key:"getByClassName",value:function(e,t){var a,n=w.a.priModKey,r=e.parentElement,i=e.textContent,o=w.a.mac?"Option":"Alt";if(!m.default.findParent(e,"fancyInputInner")&&!m.default.findParentID(e,"ReactAutocomplete")&&!bo.menus.isModalOpen()){var s=m.default.getPaneObjectForElement(e),l=s&&N.a.isSelected(s);if(m.default.hasClass(e,"linkImage"))a="<b>Click</b> to open image.<br><b>"+n+" + Click</b> to open in "+(w.a.app?"browser":"new tab")+".";else if(m.default.findParent(e,"itemLink"))a="<b>Click</b> to open linked item<br><b>".concat(n," + Click</b> to open linked item in popup pane<br><b>").concat(n," + Shift + Click</b> to open linked item in new pane");else if(r&&m.default.hasClass(r,"appLink")){a="<b>"+n+" + Click</b> to open in "+((m.default.hasClass(r,"evernote")?"Evernote":m.default.hasClass(r,"onenote")&&"OneNote")||m.default.hasClass(r,"bear")&&"Bear"||"")}else if(m.default.hasClass(e,"link")&&e.getAttribute("data-href")){var u=e.getAttribute("data-href"),c=l?"".concat(n," + "):"";a=(u!==i?u+"<br>":"")+"<b>".concat(c,"Click</b> to open")}else m.default.hasClass(e,"tag")?a="<b>Click</b> to show only "+i+"<br><b>Shift + Click</b> to hide "+i+"<br><b>"+o+" + Click</b> to remove "+i:m.default.hasClass(e,"contact")?a="<b>"+n+"+ Click</b> to show only "+i+"<br><b>"+n+" + Shift + Click</b> to hide "+i+"<br><b>"+o+" + Click</b> to remove "+i:m.default.hasClass(e,"email")?a="<b>"+n+"+ Click</b> to email "+i:m.default.hasClass(e,"prefixHeader")||m.default.hasClass(e,"prefixBullet")?a="<b>Click</b> to zoom in":m.default.hasClass(e,"prefixTask")?a="<b>Click</b> to toggle complete.<br><b>"+n+" + Click</b> to zoom in.":m.default.hasClass(e,"prefixNumList")?a="<b>"+n+" + Click</b> to zoom in":m.default.hasClass(e,"inlineDate")?a="<b>Click</b> to edit date<br><b>"+o+" + Click</b> to remove date":m.default.hasClass(e,"plugin")&&(a=(t>0?"<b>"+n+" + Click</b>":"<b>Click icon</b>")+" to open")}return a}},{key:"getTooltipText",value:function(e,t){return this.getAttr(e)||this.getByClassName(e,t)}},{key:"handleEleOver",value:function(e){try{m.default.PAssert(107,m.default.isDOMNode(e.target),"Must have a valid DOM node: ",Qe()(e.target))}catch(o){m.default.reportError(o)}if(e.target){for(var t,a,n=0,r=e.target,i=0;!t&&r&&i<3;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t=this.getTooltipText(r,i),a=this.getAttrHotkey(r),t||a||(r=r.parentElement)}if(r&&(!t&&a&&(t=a,a=void 0),t&&this.displayElement!==r&&!bo.DragDrop.isDragging&&!N.a.isMouseDown())){clearTimeout(this.displayTimeout),this.displayTimeout=setTimeout(this.displayTip.bind(this),to,{element:r,offset:{y:5},text:t,hotkey:a})}}}},{key:"handleEleOut",value:function(e){this.tipOut(e)}},{key:"isOpenSticky",value:function(){return this.tooltipsSticky.get().length>0}},{key:"hideSticky",value:function(e){for(var t=0,a=this.tooltipsSticky.get(),n=0;n<a.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(a[n].text===e){this.tooltipsSticky.removeAt(n);break}}}},{key:"hideTip",value:function(){this.displayElement=void 0,clearTimeout(this.displayTimeout),this.displayTimeout=void 0,this.tooltip.set(void 0)}}]),e}(),no=function(){function e(){i()(this,e),this.popupClosedError=new P.a,this.gapiFailedToLoad=new P.a,this.loggedOutByAuthFailure=new P.a,this.isLoggingOut=new P.a,this.downloadIcon=this.getDownloadIcon(),this.showDownload=w.a.canDownloadNativeApp(),this.loginRequested=!1,this.loginRequestTimer=void 0}return s()(e,[{key:"getDownloadIcon",value:function(){return w.a.getPlatformIcon()}},{key:"logout",value:function(){var e=me()(pe.a.mark((function e(){return pe.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:if(!bo.settings.activeUser.get()){e.next=7;break}return m.default.log("Logging out"),this.isLoggingOut.set(!0),e.next=5,j.a.clearLocalData();case 5:return e.next=7,$.a.signOut();case 7:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logoutClicked",value:function(){var e=this;m.default.isDemoMode()?ve.a.removeURLParam("demo"):j.a.hasPendingRemoteUpdates()?bo.menus.confirm("You have unsaved changes which will be lost if you log out. Are you sure?",(function(t){t&&e.logout()})):this.logout()}},{key:"_reportLoginTapSkip",value:function(e){}},{key:"closeConnectionError",value:function(){bo.tooltip.hideSticky(this.textErrorConnecting)}}]),e}(),ro=(Qi=function(){function e(){var t=this;i()(this,e),this.useServiceWorker="serviceWorker"in navigator,this.notifiedOfNew=!1,this.hasUpdate=new P.a,setInterval(this.update,y.a.MSPerHour),w.a.app&&S.a.onAppStateChange((function(e){var a=e.isForeground;t.isAppBackgrounded=!a,a||(t.hasUpdate.get()?m.default.reload():t.update())}))}return s()(e,[{key:"init",value:function(){var e=this;this.useServiceWorker&&navigator.serviceWorker.addEventListener("message",(function(t){bo.settings.activeUser.get()&&("ServiceWorker_Activated"===t.data?e.onUpdateReady():"ServiceWorker_Installed"===t.data&&setTimeout(e.onUpdateReady,2e3))}))}},{key:"update",value:function(){var e=me()(pe.a.mark((function e(t){var a;return pe.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(this.hasUpdate.get()){e.next=12;break}if(e.prev=1,!this.useServiceWorker){e.next=8;break}if(!(a=window.__registeredServiceWorker)){e.next=8;break}return e.next=7,a.update();case 7:null===t||void 0===t||t(!!a.installing);case 8:e.next=12;break;case 10:e.prev=10,e.t0=e.catch(1);case 12:case"end":return e.stop()}}}),e,this,[[1,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onUpdateReady",value:function(){m.default.log("Cache: New version available"),this.useServiceWorker&&m.default.log("Service worker has update"),this.updateAction()}},{key:"onFirstUpdateReady",value:function(){m.default.log("Cache: first update")}},{key:"onUpdateError",value:function(e){!w.a.demo&&j.a.isConnected()&&(m.default.log("Update Error: ",e),"quota"===e.reason&&bo.toasts.pushMessage({text:"A new version of Moo.do is available but you do not have enough free disk space to update. You may want to clear up some disk space.",actionText:"OKAY"}))}},{key:"onUpdateDownloading",value:function(){m.default.log("Cache: New version downloading")}},{key:"updateAction",value:function(){this.hasUpdate.set(!0),w.a.app&&this.isAppBackgrounded&&m.default.reload()}}]),e}(),_()(Qi.prototype,"update",[b.a],Object.getOwnPropertyDescriptor(Qi.prototype,"update"),Qi.prototype),_()(Qi.prototype,"onUpdateReady",[b.a],Object.getOwnPropertyDescriptor(Qi.prototype,"onUpdateReady"),Qi.prototype),Qi),io=a(29),oo={display:"inline-block",height:"24px"},so=function(e){return'<span class="introHotkey c-bg-light c-blue">'.concat(e,"</span>")},lo=(Ji=function(){function e(){i()(this,e)}return s()(e,[{key:"init",value:function(){var e=this;this.itemsByAction={},this.itemsByID={},this.isHelpOpen=new P.a(!1,this.saveHelpPaneState),this.isHotkeysOpen=new P.a(!1,this.saveHelpPaneState),this.priKey=w.a.priModKey,this.secKey=w.a.secModKey,this.secKeyForce=w.a.secModKeyForce,this.tooltipIntroSection=void 0;var t=bo.settings.helpPaneState.get();void 0===t&&(t={e:!1,o:!1}),this.initHelp(),m.default.isDemoMode()||(this.loadState(),bo.settings.inTooltipIntro.get()&&this.tooltipIntroSection.isComplete.get()&&bo.settings.inTooltipIntro.set(!1)),bo.settings.helpPaneState.listen((function(t,a){void 0===t||m.default.deepEqual(t,a)||(e.isHelpOpen.set(t.e),e.isHotkeysOpen.set(t.o))})),bo.settings.helpState.listen((function(t,a){t&&t!==a&&e.loadState()}))}},{key:"getItem",value:function(e){return this.itemsByAction[e]}},{key:"createItem",value:function(e,t){var a=t;return a.isComplete=new P.a(!1),a.isDisabled=new P.a(!1),a.show=function(){return a.isDisabled.set(!1)},this.itemsByAction[e]=a,this.itemsByID[a.id]=a,a}},{key:"saveHelpPaneState",value:function(){bo.settings.helpPaneState.set({o:this.isHotkeysOpen.get(),e:this.isHelpOpen.get()})}},{key:"showHelp",value:function(){this.isHelpOpen.set(!0)}},{key:"toggleHelp",value:function(){this.isHelpOpen.set(!this.isHelpOpen.get())}},{key:"showHotkeys",value:function(){this.isHotkeysOpen.set(!0)}},{key:"toggleHotkeys",value:function(){this.isHotkeysOpen.set(!this.isHotkeysOpen.get())}},{key:"_getHelpStateObj",value:function(){var e={},t=bo.settings.helpState.get();if(m.default.isString(t)){if(t)try{(e=JSON.parse(t))&&!m.default.isString(e)||(e={})}catch(a){m.default.reportError(a)}}else e=t;return e||{}}},{key:"loadState",value:function(){var e=this._getHelpStateObj();if(e&&!m.default.isEmpty(e)){var t=this.itemsByID;Object.keys(e).forEach((function(a){return e[a]&&t[a]&&t[a].isComplete.set(!0)}))}}},{key:"saveState",value:function(){if(m.default.shouldWriteLocal())try{var e=m.default.clone(this._getHelpStateObj()),t=!1,a=this.itemsByID;Object.keys(a).forEach((function(n){return a[n].isComplete.get()&&!e[n]&&(t=!0,e[n]=1)})),t&&bo.settings.helpState.set(JSON.stringify(e))}catch(n){m.default.reportError(n)}}},{key:"getState",value:function(){var e=m.default.clone(this._getHelpStateObj()),t=this.itemsByAction;return Object.keys(t).forEach((function(a){return t[a].isComplete.get()&&(e[t[a].id]=1)})),e}},{key:"initHelp",value:function(){this.createItem("PluginSettings",{id:"pS",jsx:F.a.createElement("span",null,"Open the ",F.a.createElement(io.a,{raised:!0,primary:!0,className:"mx-1 align-bottom",padding:10,height:24,onClick:function(){return bo.menus.openSettings("Plugins")}},"Settings")," to setup sync with Google services.")}),this.createItem("Encryption",{id:"en",jsx:F.a.createElement("span",null,"Optionally ",F.a.createElement(io.a,{raised:!0,primary:!0,className:"mx-1 align-bottom",padding:10,height:24,onClick:function(){return bo.menus.openSettings("Security")}},"Enable Encryption")," to add an extra layer of security to your data.")}),this.createItem("Import",{id:"i",jsx:F.a.createElement("span",null,F.a.createElement(io.a,{raised:!0,primary:!0,className:"mx-1 align-bottom",padding:10,height:24,onClick:function(){return bo.menus.openModal(y.a.Modals.ImportData)}},"Import your data")," from another app or just start typing to get started.")}),this.createItem("Demo",{id:"d",jsx:F.a.createElement("span",null,"Try the ",F.a.createElement(io.a,{raised:!0,primary:!0,className:"mx-1 align-bottom",padding:10,height:24,onClick:function(){bo.openUrl("/demo")}},"Demo")," to explore all of Moo.do's features.")}),this.createItem("AddItem",{id:"a",text:"Moo.do works like a text editor. Type some text to get started and press ".concat(so("Enter")," to add a new item.")}),this.createItem("SlashHelp",{id:"h",text:"Type ".concat(so("/")," in an empty item to see available options.")}),this.createItem("Search",{id:"s",text:"Use search to focus on a subset of your items. Click the search box at the top of the pane to see search options."}),this.createItem("ViewMode",{id:"v",text:"Click the <b>Outline</b> button at the top of a pane to explore view modes."}),this.createItem("AddPane",{id:"aP",jsx:F.a.createElement("span",null,"Click the ",F.a.createElement(io.a,{icon:"icon-add-pane",className:"align-text-bottom",iconSize:15,width:28,height:16,onClick:function(){return bo.menus.openAddPaneMenu({element:"addPaneButton"})}})," button to add a new pane.")}),this.createItem("AddBoard",{id:"aB",jsx:F.a.createElement("span",null,"Click the ",F.a.createElement(io.a,{icon:"icon-add",className:"align-text-bottom",iconSize:15,width:28,height:16,onClick:function(){bo.PaneManager.addBoard()}})," button to add a new board.")}),this.createItem("Email",{id:"e",text:"Use the Email pane to read and reply to your emails. Double click an email to open it."}),this.createItem("EmailCompose",{id:"eC",jsx:F.a.createElement("span",null,"Click the ",F.a.createElement(io.a,{icon:"icon-mail_outline",className:"mx-1 align-middle",iconSize:14,width:16,height:16,onClick:function(){return bo.menus.openComposeEmail(bo.pluginManager.getPluginGmail())}})," button to compose a new email, and use the Email pane to read and reply to your emails.")}),this.createItem("NewDoc",{id:"nD",text:'Click the <i class="icon-menu g mx-1"></i> button in a pane to open the documents list and click <i class="icon-add mx-1"></i> to add a new document.'}),this.createItem("ShareDoc",{id:"sD",text:"Right click on a document and select Share to collaborate on a document."}),this.createItem("ChangeDoc",{id:"cD",text:"Select a document in the document list or click on the document name at the top of a pane to change documents."}),this.createItem("Indent",{id:"458052715",text:"Moo.do has infinite hierarchy. Press ".concat(so("Tab")," to indent an item under its parent and ").concat(so("Shift + Tab")," unindent it.")}),this.createItem("Drag",{id:"3825397189",text:"Click and drag the left edge of an item to move it around or to another pane."}),this.createItem("Collapse",{id:"441256378",text:'Click <i class="icon-angle-down font-bold"></i> next to an item or press '.concat(so(bo.hotkeys.printHotkeyByName("Collapse"))," to collapse its subitems.")}),this.createItem("Date",{id:"321249113",text:"Add a date by typing ".concat(so("!")," in the text of an item or pressing ").concat(so(this.priKey+" + Shift + D")," to add it to your calendar.")}),this.createItem("AddCalendar",{id:"adc2",text:"Add an item with a date to Google Calendar by pressing ".concat(so(this.secKeyForce+" C")," or selecting the calendar in the date popup.")}),this.createItem("RightClickItem",{id:"3288459206",text:"Right click an item to explore more options."}),this.createItem("Priority",{id:"215510164",text:"Set a priority with the right click menu or ".concat(so(this.secKey+" 1|2|3"),"</span>.")}),this.createItem("Complete",{id:"2165585377",text:"Click the right edge of an item or ".concat(so(this.secKey+" /"),"</span> to complete it.")}),this.createItem("Zoom",{id:"1829655333",text:"Zoom into an item to focus on only its children. Press ".concat(so(this.priKey+" Enter")," or hold ").concat(so(this.priKey)," and click its left edge.")}),this.createItem("Overview",{id:"801492595",text:'The overview shows only parents for easy scrolling and zooming. Click the <i class="icon-menu g mx-1"></i> button in a pane to open the documents list, and click <i class="icon-format_list_bulleted g mx-1"></i> to open the overview.'}),this.createItem("Tag",{id:"3689209442",text:'Mark similar items with a <span class="tag">#tag</span> to easily search for all items matching that tag.'}),this.createItem("DragFromComp",{id:"drDr",text:"Drag a file from your computer to upload it to Drive and add it to a list."}),this.createItem("SettingsMenu",{id:"oS",jsx:F.a.createElement("span",null,"Click ",F.a.createElement("span",{style:oo},F.a.createElement(io.a,{icon:"icon-settings",className:"align-text-bottom",width:16,height:16,onClick:function(){return bo.menus.openOptions()}}))," and select Settings to customize Moo.do's various options.")}),this.createItem("DisplaySettings",{id:"oDS",jsx:F.a.createElement("span",null,"Click ",F.a.createElement("span",{style:oo},F.a.createElement(io.a,{icon:"icon-settings",className:"align-text-bottom",width:16,height:16,onClick:function(){return bo.menus.openOptions()}}))," and select Display Settings to customize your view.")})}},{key:"onAction",value:function(e){if(!bo.menus.isModalOpen(y.a.Modals.ImportData)||"Import"===e){var t=this.itemsByAction[e];t.isComplete.get()||(t.isComplete.set(!0),this.saveState())}}}]),e}(),_()(Ji.prototype,"getItem",[b.a],Object.getOwnPropertyDescriptor(Ji.prototype,"getItem"),Ji.prototype),_()(Ji.prototype,"saveHelpPaneState",[b.a],Object.getOwnPropertyDescriptor(Ji.prototype,"saveHelpPaneState"),Ji.prototype),Ji),uo=a(58),co=function(){function e(){i()(this,e),this.stack=[]}return s()(e,[{key:"push",value:function(e){this.stack.push(e)}},{key:"pop",value:function(e){this.stack.remove(e)}},{key:"peek",value:function(){return this.stack[this.stack.length-1]}},{key:"contains",value:function(e){return this.stack.indexOf(e)>=0}},{key:"forEach",value:function(e){for(var t=0,a=this.stack.length-1;a>=0;a--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(!1===e(this.stack[a],a))break}}}]),e}(),ho={},fo=0,po=1,go=2,mo=3,vo={Pane:{Search:["Pr+F"],Filter:["Se+F"],Overview:["Se+O"],Complete:["Pr+Enter"],ZoomOut:["Se+Sh+Enter","Se+ArrowLeft"],ZoomIn:["Se+Enter","Se+ArrowRight"],EditNote:["Sh+Enter"],Collapse:["Pr+Period","mac:Se+Space"],CollapseRecursive:["Pr+Sh+Period","mac:Se+Sh+Space"],CollapseAll:["Pr+Se+Period","mac:Pr+Se+Sh+Space"],Unindent:["Sh+Tab"],Indent:["Tab"],UnindentWithoutChildren:["Pr+BracketLeft","Se+BracketLeft","Se+Sh+ArrowLeft"],IndentWithoutChildren:["Pr+BracketRight","Se+BracketRight","Se+Sh+ArrowRight"],MoveUp:["win:Se+Sh+ArrowUp","mac:Op+ArrowUp","win:Pr+Sh+ArrowUp"],MoveDown:["win:Se+Sh+ArrowDown","mac:Op+ArrowDown","win:Pr+Sh+ArrowDown"],Priority1:["Pr+D1"],Priority2:["Pr+D2"],Priority3:["Pr+D3"],PriorityNone:["Pr+D0","Pr+D4"],Star:["Pr+D8","win:Pr+Tilde"],NextPane:["mac:app:Se+Tilde","mac:app:Pr+Op+ArrowRight","win:Se+Tilde"],PreviousPane:["mac:app:Se+Sh+Tilde","mac:app:Pr+Op+ArrowLeft","win:Se+Sh+Tilde"],SelectItem:["Se+L"],ClosePane:["Sh+F4"],Bold:["Pr+B"],Italic:["Pr+I"],Underline:["Pr+U"],Strike:["Pr+Sh+X"],InlineCode:["Pr+Sh+C"],CodeBlock:["Pr+Sh+Se+C","mac:Pr+Sh+Op+C"],InsertLink:["Pr+K"],MoveAutocomplete:["Se+M"],HighlightInAllPanes:["Se+G"],PrefixHeader:["Pr+Sh+D6","Pr+Sh+P","Pr+Sh+H","win:Pr+Sh+D3"],PrefixTask:["mac:app:Pr+Sh+BracketLeft","win:Pr+Sh+BracketLeft","Se+Sh+BracketLeft","Pr+Sh+D9","Pr+Sh+D0"],PrefixBullet:["Pr+Sh+D8"],PrefixNumList:["Pr+Sh+D1"],AddToCalendar:["Se+C"],DeleteItem:["Pr+Sh+Backspace","Pr+Sh+K"],Date:["Pr+Sh+D"]},Global:{GlobalSearch:["Pr+P","Pr+Sh+F","Se+J"],SelectPane1:["app:Se+D1"],SelectPane2:["app:Se+D2"],SelectPane3:["app:Se+D3"],SelectPane4:["app:Se+D4"],SelectPane5:["app:Se+D5"],SelectPane6:["app:Se+D6"],SelectPane7:["app:Se+D7"],SelectPane8:["app:Se+D8"],SelectPane9:["app:Se+D9"],SelectPane10:["app:Se+D0"],Undo:["Pr+Z"],Redo:["Pr+Y","Pr+Sh+Z"],AddPane:["app:Pr+T","Se+T"],NewItem:["app:Pr+N","Se+N"],EmailCompose:["Pr+E"],NextBoard:["mac:app:Se+Tab","win:app:Pr+Tab"],PreviousBoard:["mac:app:Se+Sh+Tab","win:app:Pr+Sh+Tab"],SelectBoard1:["Se+Sh+D1"],SelectBoard2:["Se+Sh+D2"],SelectBoard3:["Se+Sh+D3"],SelectBoard4:["Se+Sh+D4"],SelectBoard5:["Se+Sh+D5"],SelectBoard6:["Se+Sh+D6"],SelectBoard7:["Se+Sh+D7"],SelectBoard8:["Se+Sh+D8"],SelectBoard9:["Se+Sh+D9"],SelectBoard10:["Se+Sh+D0"],HelpHotkeys:["Pr+Slash","Se+Slash"],Help:["Pr+Sh+Slash","Se+Sh+Slash"],Settings:["mac:app:Pr+Comma"]},Email:{Down:["ArrowDown","Sh+ArrowDown","J","Sh+J"],Up:["ArrowUp","Sh+ArrowUp","K","Sh+K"],Open:["Enter"],Archive:["E","Slash","Pr+Enter"],MarkRead:["I"],MarkUnread:["U"],OpenInGmail:["G"],CopyToItem:["M"],CopyToNewItem:["T"],Star:["S","D8"],Delete:["Backspace","Delete"]},"Legacy Email":{Down:["ArrowDown","J"],Up:["ArrowUp","K"],Open:["Enter"],Archive:["E","Slash"],Delete:["Delete","Backspace","Sh+D3"],Schedule:["C"],Move:["M","V"],Task:["T"],Label:["L"],MarkRead:["I"],MarkUnread:["U"],Star:["S","D8"],Reply:["R"],ReplyAll:["Sh+R","A"],Forward:["F"],Priority1:["D1"],Priority2:["D2"],Priority3:["D3"],RemoveFromLabel:["Y"],Undo:["Z"],Print:["P"],OpenInGmail:["G"],Menu:["win:ContextMenu"]}},yo=(Zi=function(){function e(){var t,a=this;i()(this,e),this.currentArrowsMode=void 0,this.platformPrimaryKey=w.a.mac?po:fo,this.platformSecondaryKey=w.a.mac?fo:go;var n=function(e,t,n){var r=0;if(n||!bo.menus.isContextMenuOpen()&&!bo.menus.isModalOpen()){for(var i,o={},s=o.ctrlKey,l=o.metaKey,u=o.altKey,c=o.shiftKey,d=0;d<t.length;d++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var h,f=t[d],p=!f.mods,g=void 0,v=void 0,k=void 0,_=void 0;if(p||(g=!!f.mods[fo]===!!s,v=!!f.mods[po]===!!l||f.keyCode===y.a.KeyCode.ContextMenu,k=!!f.mods[go]===!!u,_=!!f.mods[mo]===!!c),p||g&&v&&k&&_)if(f.isGlobal||e.target===document.body&&!bo.menus.isContextMenuOpen()&&!bo.menus.isModalOpen()||m.default.findParent(e.target,"paneContent")||m.default.findParent(e.target,"paneHiddenInput"))if(!f.isOnPane||f.group===(null===(h=m.default.focusedPane)||void 0===h?void 0:h.title)){i=f;break}}if(i){a.currentArrowsMode&&!i.isOnPane&&(a._exitingArrowsMode=a.currentArrowsMode,a._exitArrowsMode());var b=i.callback.call(a,e);return(i.stopPropagation||n)&&e.stopPropagation(),a._exitingArrowsMode=void 0,!1===b||(e.handled=!0,m.default.preventDefault(e),!1)}}},r=function(e){if(bo.setup&&bo.settings.activeUser.get()){w.a.normalizeKeys(e);var r,i=e.normCode;if(w.a.mac&&e.altKey&&e.code){var o=y.a.KeyCode[e.code.replace("Key","")];o&&(i=o)}if(t=i,a.currentArrowsMode&&a._updateArrowsMode(e),a.hotkeyStack.forEach((function(t){if(t&&t[i]&&(r=n(e,[t[i]],!0)),void 0!==r)return!1})),void 0===r){var s=ho[i];s&&(r=n(e,s))}return r}};this.hotkeyStack=new co,this.currentArrowsMode=void 0,this.arrowsModeHotkeys={},ve.a.binder(this,"onMouseDownArrowsMode"),document.addEventListener("keydown",r,!0),document.addEventListener("keyup",(function(e){bo.setup&&bo.settings.activeUser.get()&&(w.a.normalizeKeys(e),w.a.windows&&t!==e.normCode&&(e.normCode!==y.a.KeyCode.D1&&e.normCode!==y.a.KeyCode.D2&&e.normCode!==y.a.KeyCode.D3&&e.normCode!==y.a.KeyCode.D8||ho[e.normCode]&&(r(e),t=void 0)))}),!0),bo.settings.onLoaded((function(){a.updateConfig(),bo.settings.hotkeys.listen(a.updateConfig)})),this.loadDefaultConfig(),this.updateConfig()}return s()(e,[{key:"loadDefaultConfig",value:function(){this.defaultConfig=vo}},{key:"updateConfig",value:function(){var e=this,t=bo.billingManager.hasPremiumFeatures()&&bo.settings.hotkeys.get()||{};this.config={},ho={},Object.keys(this.defaultConfig).forEach((function(a){return e.config[a]=Object.assign({},e.defaultConfig[a],t[a])})),Object.keys(this.config.Email).forEach((function(t){return e.createAndAddHotkeyNew("Email",t,e.config.Email[t],!1,!0,"Email")})),Object.keys(this.config["Legacy Email"]).forEach((function(t){return e.createAndAddHotkeyNew("Legacy Email",t,e.config["Legacy Email"][t],!1,!0,"Legacy Email")})),Object.keys(this.config.Pane).forEach((function(t){return e.createAndAddHotkeyNew("Pane",t,e.config.Pane[t],!1)})),Object.keys(this.config.Global).forEach((function(t){return e.createAndAddHotkeyNew("Global",t,e.config.Global[t],!0)})),this.createAndAddHotkeyNew("None","Noop",["Pr+S"],!0)}},{key:"createAndAddHotkeyNew",value:function(e,t,a,n){var r=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=this.createHotkeyNew(e,t,a,n,i,o);s.forEach((function(e){return r.addHotkeyNew(e)}))}},{key:"createHotkeyNew",value:function(e,t,a,n){var r=0,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=[],s=i?this.callbackOnPane.bind(this,t):this["hotkey"+t];try{m.default.PAssert(82,s&&m.default.isFunction(s),"Missing hotkey handler",t)}catch(p){m.default.reportError(p)}for(var l=0;l<a.length;l++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=a[l],c=u.split(":"),d=c[c.length-1].split("+"),h=y.a.KeyCode[d[d.length-1]];try{m.default.PAssert(83,h,"Key code must be defined",u)}catch(p){m.default.reportError(p)}if(this.isValidPlatform(u)){var f={group:e,name:l>0?t+l:t,isGlobal:n,keyCode:h,primary:d.indexOf("Pr")>=0,secondary:d.indexOf("Se")>=0,shift:d.indexOf("Sh")>=0,option:d.indexOf("Op")>=0,isOnPane:i,callback:s,mods:{}};f.mods={},f.primary&&(f.mods[this.platformPrimaryKey]=!0),f.secondary&&(f.mods[this.platformSecondaryKey]=!0),f.option&&(f.mods[go]=!0),f.shift&&(f.mods[mo]=!0),o.push(f)}}return o}},{key:"isValidPlatform",value:function(e){var t=e.split(":");return 1===t.length||(t.indexOf("win")<0||!w.a.mac)&&(t.indexOf("mac")<0||w.a.mac)&&(t.indexOf("app")<0||w.a.isNativeApp())}},{key:"pushStack",value:function(e){for(var t=0,a={},n=0;n<e.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[n];a[r.keyCode]=r}return this.hotkeyStack.push(a),a}},{key:"pushStackEscape",value:function(e){return this.pushStack([this.createEscape(e)])}},{key:"popStack",value:function(e){this.hotkeyStack.pop(e)}},{key:"getHotkey",value:function(e){var t,a=ho[e.normCode];if(a)for(var n=0,r=0;r<a.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=a[r],o=!i.mods,s=void 0,l=void 0,u=void 0,c=void 0;if(o||(s=!!i.mods[fo]===!!e.ctrlKey,l=!!i.mods[po]===!!e.metaKey,u=!!i.mods[go]===!!e.altKey,c=!!i.mods[mo]===!!e.shiftKey),o||s&&l&&u&&c){t=i.name;break}}return t}},{key:"create",value:function(e,t,a,n,r,i){try{m.default.PAssert(84,m.default.isNumber(e),"Invalid keyCode")}catch(s){m.default.reportError(s)}try{m.default.PAssert(85,m.default.isBoolean(t),"Invalid isGlobal")}catch(s){m.default.reportError(s)}try{m.default.PAssert(86,m.default.isFunction(r),"Invalid callback")}catch(s){m.default.reportError(s)}var o={group:"",name:"",keyCode:e,mods:{},callback:r,isGlobal:t};return a!==y.a.Primary.Yes&&a!==y.a.Primary.Both&&a!==y.a.Primary.Only||(o.mods[this.platformPrimaryKey]=!0),a!==y.a.Primary.No&&a!==y.a.Primary.Never&&a!==y.a.Primary.Both||(o.mods[this.platformSecondaryKey]=!0),i&&w.a.mac&&(o.mods[go]=!0),n===y.a.Shift.Yes&&(o.mods[mo]=!0),o}},{key:"addHotkeyNew",value:function(e){var t=e.keyCode;return ho[t]||(ho[t]=[]),ho[t].push(e),e}},{key:"createEscape",value:function(e){return this.create(y.a.KeyCode.Escape,!0,y.a.Primary.Either,y.a.Shift.Either,e)}},{key:"_addHotkey",value:function(e,t,a,n,r,i,o){try{m.default.PAssert(87,a,"Must supply a valid keycode")}catch(l){m.default.reportError(l)}if(ho[a]=ho[a]||[],n===y.a.Primary.Either)return this._addHotkey(e,t,a,y.a.Primary.No,r,i,o),void this._addHotkey(e,t,a,y.a.Primary.Yes,r,i,o);if(r===y.a.Shift.Either)return this._addHotkey(e,t,a,n,y.a.Shift.No,i,o),void this._addHotkey(e,t,a,n,y.a.Shift.Yes,i,o);try{m.default.PAssert(88,!w.a.windows||n!==y.a.Primary.Both,"Should never require AltGr combo on windows")}catch(l){m.default.reportError(l)}var s=this.create(a,t,n,r,i);s.stopPropagation=o,s.name=e,ho[a].push(s)}},{key:"registerArrowsMode",value:function(e,t,a,n,r,i){var o=this["arrowsModeIndex"+e]=new P.a(-1);return!0===t?this._enterArrowsMode(e,a,n,r):this._addHotkey(e,!0,t.keyCode,t.primary,t.shift,this._onKeyDownArrowsMode.bind(this,e,a,n,r,i)),o}},{key:"getArrowsModeObs",value:function(e){return this["arrowsModeIndex"+e]}},{key:"isInArrowsMode",value:function(e){return this.currentArrowsMode&&this.currentArrowsMode.name===e}},{key:"exitArrowsMode",value:function(e){this.isInArrowsMode(e)&&this._exitArrowsMode()}},{key:"_onKeyDownArrowsMode",value:function(e,t,a,n,r){this.currentArrowsMode?this._exitArrowsMode():this._exitingArrowsMode&&this._exitingArrowsMode.name===e||this._enterArrowsMode(e,t,a,n,r)}},{key:"_enterArrowsMode",value:function(e,t,a,n,r){this.currentArrowsMode={name:e,cbGetMax:t,cbSelect:a,cbKey:n,cbOnHotkey:r},r&&r(),document.addEventListener("mousedown",this.onMouseDownArrowsMode,!0),this["arrowsModeIndex"+e].set(-1)}},{key:"_exitArrowsMode",value:function(){this.currentArrowsMode&&(document.removeEventListener("mousedown",this.onMouseDownArrowsMode,!0),this.getArrowsModeObs(this.currentArrowsMode.name).set(-1),this.currentArrowsMode=void 0)}},{key:"onMouseDownArrowsMode",value:function(e){this._exitArrowsMode()}},{key:"_updateArrowsMode",value:function(e){var t=this.currentArrowsMode,a=this.getArrowsModeObs(t.name),n=w.a.getKeyCode(e),r=a.get(),i=t.cbGetMax();if(n===y.a.KeyCode.Enter)r>=0&&t.cbSelect(r),this._exitArrowsMode(),m.default.preventAndStop(e);else if(n===y.a.KeyCode.Escape)this._exitArrowsMode();else if(n===y.a.KeyCode.ArrowUp)r>0&&a.set(r-1);else if(n===y.a.KeyCode.ArrowDown)r<i-1&&a.set(r+1);else if(t.cbKey){var o=t.cbKey(n,e);o>=0&&(t.cbSelect(o),this._exitArrowsMode(),m.default.preventAndStop(e))}}},{key:"checkToggleSearchFilter",value:function(e){var t=m.default.focusedPane;return!(!t||!t.search.isFocused.get())&&(t.search.toggleFilterDefault(e),!0)}},{key:"checkToggleSearchPriority",value:function(e){var t=m.default.focusedPane;return!(!t||!t.search.isFocused.get())&&(t.search.getFilterValue("priority")===e&&(e=0),t.search.setFilter("priority",e),!0)}},{key:"hotkeyNewItem",value:function(){bo.menus.closeContextMenu(),bo.menus.openItemEditor({addOnSave:!0,selectDocument:!0,element:"newItemButton"})}},{key:"hotkeyAddPane",value:function(){bo.menus.closeContextMenu(),bo.menus.openAddPaneMenu({element:"addPaneButton"})}},{key:"hotkeyFilter",value:function(){var e=m.default.focusedPane||bo.PaneManager.getPaneAtIndex(0);if(e){var t=e.search;t.isFocused.get()||t.focus()}}},{key:"hotkeySearch",value:function(){var e=m.default.focusedPane||bo.PaneManager.getPaneAtIndex(0);null===e||void 0===e||e.searchingPaneObjects.setProperty("isSearching",!0,!0)}},{key:"hotkeyHighlightInAllPanes",value:function(){m.default.focusedPane.applyToSelection((function(e){return bo.PaneManager.scrollToAndHighlightItem(e,m.default.focusedPane),!1}))}},{key:"hotkeyOverview",value:function(){m.default.focusedPane&&m.default.focusedPane.toggleOverviewVisibility()}},{key:"hotkeyComplete",value:function(){var e,t=N.a.getPane(),a=N.a.getSelectedItems(),n=N.a.getStartObject(),r=t.findNextSiblingItem(n);if(N.a.isValid()&&1===a.length&&!a[0].isComplete()&&(e=!0),m.default.beginCompleteAction(),t.applyFnToSelection("setComplete",{toggle:"isComplete",value2:y.a.ChangeType.Local,noRestoreSel:!0}),e&&r){var i=t.findPaneObject(r.id);0,N.a.selectObject(i,0)}m.default.endCompleteAction(),m.default.sendEvent("Hotkey","Complete")}},{key:"_hotkeyPriorityHelper",value:function(e){m.default.focusedPane&&!this.checkToggleSearchPriority(e)&&m.default.focusedPane.applyPriorityToSelection(e,!0)}},{key:"hotkeyPriority1",value:function(){this._hotkeyPriorityHelper(y.a.VMLIFlag.P0)}},{key:"hotkeyPriority2",value:function(){this._hotkeyPriorityHelper(y.a.VMLIFlag.P1)}},{key:"hotkeyPriority3",value:function(){this._hotkeyPriorityHelper(y.a.VMLIFlag.P2)}},{key:"hotkeyPriorityNone",value:function(){m.default.focusedPane.applyPriorityToSelection(y.a.VMLIFlag.None)}},{key:"hotkeyStar",value:function(){this.checkToggleSearchFilter("starred")||m.default.focusedPane.applyFnToSelection("setStarred",{toggle:"isStarred",value2:y.a.ChangeType.Local})}},{key:"selectPaneAtIndex",value:function(e){if(e>=0&&e<bo.PaneManager.paneCount()){var t=bo.PaneManager.getPaneAtIndex(e);if(t&&(N.a.focusPaneAndRestoreSelection(t),!N.a.isValid()&&t.isEditable)){var a=t.indexOfFirstItem();t.selectIndex(a),t.scrollIndexIntoView(a,"smooth")}}}},{key:"hotkeySelectPane1",value:function(){this.selectPaneAtIndex(0)}},{key:"hotkeySelectPane2",value:function(){this.selectPaneAtIndex(1)}},{key:"hotkeySelectPane3",value:function(){this.selectPaneAtIndex(2)}},{key:"hotkeySelectPane4",value:function(){this.selectPaneAtIndex(3)}},{key:"hotkeySelectPane5",value:function(){this.selectPaneAtIndex(4)}},{key:"hotkeySelectPane6",value:function(){this.selectPaneAtIndex(5)}},{key:"hotkeySelectPane7",value:function(){this.selectPaneAtIndex(6)}},{key:"hotkeySelectPane8",value:function(){this.selectPaneAtIndex(7)}},{key:"hotkeySelectPane9",value:function(){this.selectPaneAtIndex(8)}},{key:"hotkeySelectPane10",value:function(){this.selectPaneAtIndex(9)}},{key:"hotkeyPreviousPane",value:function(){var e=bo.PaneManager,t=e.getFocusedPaneIndex()-1;t<0&&(t=e.paneCount()-1),this.selectPaneAtIndex(t)}},{key:"hotkeyNextPane",value:function(){var e=bo.PaneManager,t=e.getFocusedPaneIndex()+1;t>=e.paneCount()&&(t=0),this.selectPaneAtIndex(t)}},{key:"hotkeyZoomIn",value:function(){m.default.focusedPane&&m.default.focusedPane.applyToSelection((function(e){return e.isNote()||m.default.focusedPane.zoomIn(e),!1}))}},{key:"hotkeyZoomOut",value:function(){var e=m.default.focusedItem;e&&e.parent()&&m.default.focusedPane.zoomOut(e.parent())}},{key:"hotkeyCollapse",value:function(){m.default.focusedPane.applyToSelection((function(e){m.default.focusedPane.supportCollapsing&&e.toggleCollapsed(m.default.focusedPane)}))}},{key:"hotkeyCollapseAll",value:function(){m.default.focusedItem&&m.default.focusedPane&&m.default.focusedPane.supportCollapsing&&m.default.focusedPane.toggleCollapseAll()}},{key:"hotkeyCollapseRecursive",value:function(){var e,t=m.default.focusedPane;m.default.focusedPane.applyToSelection((function(a,n,r,i){t.supportCollapsing&&(void 0===e&&(e=!t.isPaneObjectCollapsed(i)),t.collapseAll(a,e,!0))}))}},{key:"hotkeyIndent",value:function(){uo.a.compoundOperation((function(){N.a.isValid()&&uo.a.handleTab(!0)}))}},{key:"hotkeyUnindent",value:function(){uo.a.compoundOperation((function(){N.a.isValid()&&uo.a.handleTab(!0,!0)}))}},{key:"hotkeyIndentWithoutChildren",value:function(){uo.a.compoundOperation((function(){N.a.isValid()&&uo.a.handleTab(!1)}))}},{key:"hotkeyUnindentWithoutChildren",value:function(){uo.a.compoundOperation((function(){N.a.isValid()&&uo.a.handleTab(!1,!0)}))}},{key:"hotkeyMoveUp",value:function(){uo.a.moveUp()}},{key:"hotkeyMoveDown",value:function(){uo.a.moveDown()}},{key:"hotkeySelectItem",value:function(){uo.a.handleSelectAllItem()}},{key:"hotkeyClosePane",value:function(e){void 0!==bo.PaneManager.removeFocusedPane()&&(bo.tooltip.hideTip(),e.stopImmediatePropagation())}},{key:"hotkeyBold",value:function(e){return N.a.isValid()&&N.a.applyFormatToSelection("bold"),m.default.preventDefault(e),!1}},{key:"hotkeyItalic",value:function(e){return N.a.isValid()&&N.a.applyFormatToSelection("italic"),m.default.preventDefault(e),!1}},{key:"hotkeyUnderline",value:function(e){return N.a.isValid()&&N.a.applyFormatToSelection("underline"),m.default.preventDefault(e),!1}},{key:"hotkeyStrike",value:function(e){return N.a.isValid()&&N.a.applyFormatToSelection("strike"),m.default.preventDefault(e),!1}},{key:"hotkeyInlineCode",value:function(e){return N.a.isValid()&&N.a.applyFormatToSelection("code"),m.default.preventDefault(e),!1}},{key:"hotkeyInsertLink",value:function(e){N.a.isValid()&&N.a.getStartItem().insertLinkAtSelection();return m.default.preventDefault(e),!1}},{key:"hotkeyMoveAutocomplete",value:function(){m.default.focusedPane&&N.a.isValid()&&m.default.focusedPane.autocompleteMove()}},{key:"hotkeyGlobalSearch",value:function(){var e=m.default.focusedPane||bo.PaneManager.getPaneAtIndex(0);null===e||void 0===e||e.isSearchingGlobal.set(!0,!0)}},{key:"hotkeyUndo",value:function(){m.default.focusedPane?m.default.focusedPane.handleUndo():nt.a.undo()}},{key:"hotkeyRedo",value:function(){m.default.focusedPane?m.default.focusedPane.handleRedo():nt.a.redo()}},{key:"hotkeyPrefixHeader",value:function(){N.a.applyPrefixToSelection(y.a.Prefix.Header)}},{key:"hotkeyPrefixTask",value:function(){N.a.applyPrefixToSelection(y.a.Prefix.Task)}},{key:"hotkeyPrefixBullet",value:function(){N.a.applyPrefixToSelection(y.a.Prefix.Bullet)}},{key:"hotkeyPrefixNumList",value:function(){N.a.applyPrefixToSelection(y.a.Prefix.NumList)}},{key:"hotkeyCodeBlock",value:function(){N.a.applyPrefixToSelection(y.a.Prefix.CodeBlock)}},{key:"hotkeyEmailCompose",value:function(){var e=bo.supportEmailViews();if(e&&bo.settings.emailViewAccounts.length()>0)Ue.a.getPluginNew("Email").composeEmail(!0);else{var t=bo.pluginManager.getPluginGmail();t.isEnabled()?bo.menus.openComposeEmail(t):!m.default.isDemoMode()&&e&&bo.toasts.pushMessage(y.a.MessageID.SetupGmailViews)}}},{key:"hotkeyPreviousBoard",value:function(){ue.a.hotkeyPrevBoard()}},{key:"hotkeyNextBoard",value:function(){ue.a.hotkeyNextBoard()}},{key:"hotkeySelectBoard1",value:function(){ue.a.selectBoardAtIndex(0)}},{key:"hotkeySelectBoard2",value:function(){ue.a.selectBoardAtIndex(1)}},{key:"hotkeySelectBoard3",value:function(){ue.a.selectBoardAtIndex(2)}},{key:"hotkeySelectBoard4",value:function(){ue.a.selectBoardAtIndex(3)}},{key:"hotkeySelectBoard5",value:function(){ue.a.selectBoardAtIndex(4)}},{key:"hotkeySelectBoard6",value:function(){ue.a.selectBoardAtIndex(5)}},{key:"hotkeySelectBoard7",value:function(){ue.a.selectBoardAtIndex(6)}},{key:"hotkeySelectBoard8",value:function(){ue.a.selectBoardAtIndex(7)}},{key:"hotkeySelectBoard9",value:function(){ue.a.selectBoardAtIndex(8)}},{key:"hotkeySelectBoard10",value:function(){ue.a.selectBoardAtIndex(9)}},{key:"hotkeyAddToCalendar",value:function(){var e=bo.pluginManager.getPluginGCalendar();e&&e.isOn()&&m.default.focusedPane.applyToSelection((function(t){return e.createEventForItem(t)}))}},{key:"hotkeyEditNote",value:function(){m.default.focusedPane&&(bo.PaneUpdateBatcher.beginUpdateItems(),m.default.focusedPane.clearPreventUpdate(),m.default.focusedPane.applyToSelection((function(e,t,a,n){e.isNote()||m.default.focusedPane.openNoteContextMenuByPaneObject(n)})),bo.PaneUpdateBatcher.commitUpdateItems())}},{key:"hotkeyHelp",value:function(){bo.intro.toggleHelp()}},{key:"hotkeyHelpHotkeys",value:function(){bo.intro.toggleHotkeys()}},{key:"hotkeySettings",value:function(){bo.menus.openSettings()}},{key:"hotkeyDeleteItem",value:function(){m.default.focusedPane.deleteSelected()}},{key:"hotkeyDate",value:function(){if(N.a.isValid()){var e=N.a.getStartIndex(),t=N.a.getStartItem(),a=N.a.getStartObject(),n=N.a.getPane(),r=N.a.getStartOffsetWithPrefix();if(e>=0){var i=n.elementAtIndex(e);i&&bo.menus.openDate({element:i,item:t,pane:n,paneObject:a,textOffset:r>=0?r:t.getParsedText().length,selectAfter:!0})}}}},{key:"hotkeyNoop",value:function(){}},{key:"callbackOnPane",value:function(e,t){var a=m.default.focusedPane;return a&&a.onHotkey&&a.onHotkey(e,t),!1}},{key:"printHotkeyByName",value:function(e,t){var a=this.config[t||"Pane"][e];try{m.default.PAssert(89,a,"Getting an invalid hotkey")}catch(o){m.default.reportError(o)}if(a)for(var n=0,r=0;r<a.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=a[r];if(this.isValidPlatform(i))return this.printHotkey(i)}}},{key:"convertToElectron",value:function(e){return e.replace(/ /g,"").replace("Pr",w.a.mac?"Cmd":"Ctrl").replace("Se",w.a.mac?"Ctrl":"Alt").replace("Op","Option").replace("Sh","Shift")}},{key:"printHotkey",value:function(e){for(var t=0,a=e.split(":"),n=a[a.length-1].split("+"),r="",i=0;i<n.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=n[i];i>0&&(r+=w.a.windows?" + ":" "),r+="Pr"===o?w.a.priModKey:"Se"===o?w.a.secModKeyForce:"Sh"===o?w.a.mac?"\u21e7":"Shift":"Op"===o?"\u2325":2===o.length&&"D"===o[0]?o[1]:"Slash"===o?"/":"Tilde"===o?"~":"ArrowLeft"===o?"\u2190":"ArrowRight"===o?"\u2192":"ArrowUp"===o?"\u2191":"ArrowDown"===o?"\u2193":"Period"===o?".":"Comma"===o?",":"Equal"===o?"=":"Plus"===o?"+":"Dash"===o?"-":"Backspace"===o?w.a.mac?"Delete":o:o.startsWith("Bracket")||o.endsWith("Bracket")?o.startsWith("L")?"[":"]":o}return r}},{key:"checkHotkeyOverlap",value:function(e,t){var a=t.mods,n=ho[e];if(n)for(var r=0,i=0;i<n.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=n[i],s=o.mods,l=!0;if(!m.default.isEmpty(a)||!m.default.isEmpty(s))for(var u=0,c=0;c<4;c++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(a[c]!==s[c]){l=!1;break}}if(l&&(o.group!==t.group||o.name!==t.name)&&!o.isOnPane&&!t.isOnPane)return!0}}},{key:"setHotkey",value:function(e,t,a){var n=this;if(this.createHotkeyNew(e,t,a,"Global"===e,"Email"===e,e).some((function(e){return n.checkHotkeyOverlap(e.keyCode,e)})))return!1;var r=m.default.cloneDeep(bo.settings.hotkeys.get());r[e]||(r[e]={}),m.default.deepEqual(this.defaultConfig[e][t],a)?delete r[e][t]:r[e][t]=a,console.log("setting to",r),bo.settings.hotkeys.set(r)}},{key:"resetHotkey",value:function(e,t){var a=m.default.cloneDeep(bo.settings.hotkeys.get());a[e]&&delete a[e][t],bo.settings.hotkeys.set(a)}}]),e}(),_()(Zi.prototype,"updateConfig",[b.a],Object.getOwnPropertyDescriptor(Zi.prototype,"updateConfig"),Zi.prototype),Zi);function ko(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var _o=function(e){d()(a,e);var t=ko(a);function a(){return i()(this,a),t.apply(this,arguments)}return s()(a,[{key:"init",value:function(){this.rollbar=window.Rollbar,this.ElectronBridge=new qi,this.nativeBridge=new eo,u()(g()(a.prototype),"init",this).call(this),this.setup=new no,this.DesktopUI=new zi,this.DesktopUI.init(),this.tooltip=new ao,this.AppCache=new ro,this.intro=new lo,this.hotkeys=new yo,ee.a.init()}},{key:"onIntroAction",value:function(e){this.intro&&this.intro.onAction(e)}},{key:"openUrl",value:function(e,t,a){S.a.isNativeApp()?S.a.openURL(e):m.default.openUrl(e)}},{key:"supportEmailViews",value:function(){return!1}},{key:"supportOutlookViews",value:function(){return!1}}]),a}(Wi),bo=t.default=new _o},,function(e,t,a){"use strict";var n,r=a(84),i=a.n(r),o=a(38),s=a.n(o),l=a(7),u=a.n(l),c=a(8),d=a.n(c),h=a(60),f=a.n(h),p=a(24),g=a.n(p),m=a(20),v=a.n(m),y=a(21),k=a.n(y),_=a(13),b=a.n(_),w=a(10),S=a.n(w),D=a(11),P=a(2),I=a(0),E=a(9),C=a(4),x=a(48),A=a(27),T=[" ","-","/","[","]","(",")","*","_","@",".",":"],M=new(function(){function e(){u()(this,e)}return d()(e,[{key:"getPreviousWord",value:function(e,t){var a=0,n=e.getDisplayTextWithoutPrefix();t<0&&(t=n.length);for(var r=t-1;r>=0;r--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=n[r];if(I.default.shouldLog(P.a.LogLevels.Edit)&&console.log(r,i),T.indexOf(i)>=0&&this.isElementEditable(e,r))return r}return-1}},{key:"getNextWord",value:function(e,t){for(var a=0,n=e.getDisplayTextWithoutPrefix(),r=t+1;r<n.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=n[r];if(T.indexOf(i)>=0&&this.isElementEditable(e,r))return r}return n.length}},{key:"isElementEditable",value:function(e,t){return e.item.elsNew.isElementAtOffsetEditable(e,t)}}]),e}()),L=new(function(){function e(){u()(this,e),this.listeners={}}return d()(e,[{key:"onEvent",value:function(e,t,a){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push({persistent:a,cb:t})}},{key:"offEvent",value:function(e,t){if(this.listeners[e]){var a=this.listeners[e].indexOfWithProperty("cb",t);a>=0&&this.listeners[e].removeAt(a)}}},{key:"hasEvent",value:function(e,t){return this.listeners[e].indexOfWithProperty("cb",t)>=0}},{key:"fireEvent",value:function(e){var t=this.listeners[e];if(t){for(var a=0,n=0,r=0,i=arguments.length,o=new Array(i>1?i-1:0),s=1;s<i;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;o[s-1]=arguments[s]}for(var l=t.length-1;l>=0;l--){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=t[l];u.cb.apply(u,o),u.persistent||t.splice(l,1)}}}}]),e}()),O=a(31),R=a(15),F=a(69),N=function(){function e(){u()(this,e),this.pane=new R.a}return d()(e,[{key:"setSelectedPaneObject",value:function(e){}},{key:"scrollStartIntoView",value:function(){}},{key:"scrollEndIntoView",value:function(){}},{key:"updateCaret",value:function(){}},{key:"checkValid",value:function(){}},{key:"getPane",value:function(){try{I.default.PAssert(410,this.pane.get()===I.default.focusedPane,"Should these always match?")}catch(e){I.default.reportError(e)}return this.pane.get()}},{key:"setFocusedPane",value:function(e){I.default.focusedPane=e,this.pane.set(e)}},{key:"applyFormatToSelection",value:function(e,t){var a=this,n=!1,r=0,i=!1;if(I.default.focusedPane.applyToSelection((function(t,o,s,l){var u=0===o?a.getStartOffset():0,c=o===s-1?a.getEndOffset():t.getParsedText().length;if(0===o){var d=t.elsNew.elementInfoAtOffset(l,u),h=d.el;d.offset;h&&(i=!!h.props[e])}var f=t.applyFormatToSelection(e,l,u,c,0===o?"toggle":n?"yes":"no");if(n=f,0===o&&l.showMarkdown()){var p=("bold"===e||"underline"===e||"strike"===e?2:("italic"===e||"code"===e)&&1)||0;0,r=f&&!i&&p||!f&&i&&-p||0}})),r){var o=function(){return a.selectIndices(a.getStartIndex(),a.getStartOffset()+r,a.getEndIndex(),a.getEndOffset()+r)};t?requestAnimationFrame(o):o()}else this.updateCaret()}},{key:"applyPrefixToSelection",value:function(e,t){var a;if(this.isValid()&&(a=this.getStartItem().getPrefixLength(),this.getEndItem().getPrefixLength()),t)e=t.prefix===e?null:e,t.setPrefix(e);else{var n=!0;I.default.focusedPane.applyToSelection((function(t){if(t.prefix!==e)return n=!1,!1})),n&&(e=null),I.default.focusedPane.applyFnToSelection("setPrefix",{value:e,noRestoreSel:!0})}isNaN(a)||this.updateCaret()}},{key:"selectIndex",value:function(e,t,a,n){return void 0===a&&(a=t),this.selectIndices(e,t,e,a,n)}}]),e}(),B=a(89),j=a(33);function U(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=b()(e);if(t){var r=b()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return k()(this,a)}}var H=[["ignoreSel",!0],"mdImageResizer","emptyItemAddButton",["itemNotInPane",!0],"itemCheckbox","itemPrefix","itemPrefixNew",["searchWrap",!0],"collapser","collapserNew","itemMenuIcon",["formattingToolbar",!0],"itemTime","paneFooter","fab",["inlineDate",!0],["itemLink",!0],["plugin",!0],["dropBucket",!0]],V=["contact","tag","inlineDate"];H.pushArray(V);var W=(n=function(e){v()(n,e);var t=U(n);function n(){var e;u()(this,n),(e=t.call(this))._isValid=!1,e._isDirty=!1,e._isWatchingChange=!0,e._isMouseDown=!1,e._isTouchDown=!1,e.modifiersDown={},e.isWindowFocused=new R.a(!0),e._previousSelectedObject=void 0,e._previousIsValid=void 0,e._previousSelectedMap={},e._selectedMap={},e.selectedMapObs=new R.a(e._selectedMap),e.mouseHandlers=[],e.mousePos={x:-1,y:-1},e.mouseDownPos={x:-1,y:-1},e._downOffset={start:0,end:0},e._lastClickTime=0,e._numClicks=0,e._isMouseDownDisabled=!1,e._savedPaneSels={};var a={};return a.onStart=e.handleMouseDown,a.onEnd=e.handleMouseUp,a.onRightStart=e.handleRightMouseDown,a.onMove=e.handleMouseMove,document.addEventListener("mousemove",e.handleMouseMoveDocument,!0),window.addEventListener("blur",e.onWindowBlur),window.addEventListener("focus",e.onWindowFocus),document.addEventListener("touchstart",(function(){e._isTouchDown=!0}),!0),document.addEventListener("touchend",(function(t){0===t.touches.length&&(e._isTouchDown=!1,L.fireEvent("SelOnTouchUp"))}),!0),document.addEventListener("keydown",(function(t){e.setModifiersDown(t.ctrlKey,t.metaKey,t.altKey,t.shiftKey)})),document.addEventListener("keyup",(function(){e.setModifiersDown()})),I.default.setupClick(document,f()(e),a),A.a.listen("paneAdded",e.onPaneAdded.bind(f()(e))),A.a.listen("paneRemoved",e.onPaneRemoved.bind(f()(e))),e}return d()(n,[{key:"reset",value:function(e,t){if(this._isValid){I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::reset");var a=!t&&this.save();a&&(this._previousSelection=a),this._selectedMap={},this._dblClickOffsets=void 0,this.isMultiselecting=!1,this._isValid=!1,this.isKeyboardOpen=!1,this._isArrowSelectInverted=!1;var n=this.getPane();!n||n.isUnloaded()||n.isDestroyed()||(this._isDirty=!0,this._updateSelection(),this.updateHiddenInput())}}},{key:"getPreviousSelection",value:function(){return this._previousSelection}},{key:"dumpState",value:function(){var e={isValid:this._isValid,isDirty:this._isDirty,isWatchingChange:this._isWatchingChange,isMouseDown:this._isMouseDown,isWindowFocused:this.isWindowFocused.get(),numClicks:this._numClicks,start:{index:this.getStartIndex(),offset:this.getStartOffset()},end:{index:this.getEndIndex(),offset:this.getEndOffset()}};try{var t=!!this.pane.get();e.paneInfo=t?{hasPane:t,id:this.pane.get().id,numItems:this.pane.get().items.get().length,displayTop:this.pane.get().indexOfTop()}:"No Pane Set"}catch(a){e.paneInfo="Invalid Pane"}try{void 0!==this.getStartIndex()&&(e.start.item=this.pane.get().items.get()[this.getStartIndex()].id)}catch(a){e.start.item="Invalid Item"}try{void 0!==this.getEndIndex()&&(e.end.item=this.pane.get().items.get()[this.getEndIndex()].id)}catch(a){e.end.item="Invalid Item"}return e}},{key:"setValid",value:function(e){if(e){try{I.default.PAssert(113,!isNaN(this.getStartIndex())&&this.getStartIndex()>=0,"Must have a valid start index when sel is valid: ",this.getStartIndex())}catch(n){I.default.reportError(n)}try{I.default.PAssert(114,!isNaN(this.getEndIndex())&&this.getEndIndex()>=0,"Must have a valid end index when sel is valid: ",this.getEndIndex())}catch(n){I.default.reportError(n)}try{if(this.getStartObject()instanceof F.a){var t=this.pane.get().items.get()[this.getStartIndex()];try{I.default.PAssert(115,t&&(I.default.isVMLI(t)||I.default.isVMLI(t.item)),"Valid selection must always be into a VMLI for start item")}catch(n){I.default.reportError(n)}var a=this.pane.get().items.get()[this.getEndIndex()];try{I.default.PAssert(116,a&&(I.default.isVMLI(a)||I.default.isVMLI(a.item)),"Valid selection must always be into a VMLI for end item")}catch(n){I.default.reportError(n)}}}catch(r){I.default.reportError(r)}}else this.reset();this._isValid=e}},{key:"isArrowSelectInverted",value:function(){return this._isArrowSelectInverted}},{key:"setArrowSelectInverted",value:function(e){this._isArrowSelectInverted=e}},{key:"getStartItem",value:function(){var e;return null===(e=this.getStartObject())||void 0===e?void 0:e.item}},{key:"getStartObject",value:function(){var e;return null===(e=this.getStartSelectionOfMap(this._selectedMap))||void 0===e?void 0:e.paneObject}},{key:"getStartOffset",value:function(e){var t=this.getStartSelectionOfMap(this._selectedMap),a=t?t.full?0:t.start:-1;return e||(this.getStartIndex()!==this.getEndIndex()&&this.isValid()?a=0:-1===a&&t&&(a=this.getStartTotal())),a}},{key:"getStartOffsetWithPrefix",value:function(){var e=this.getStartOffset();return e>=0?e+this.getStartObject().item.getPrefixLength():e}},{key:"getStartIndex",value:function(){var e;return null===(e=this.getStartSelectionOfMap(this._selectedMap))||void 0===e?void 0:e.paneObject.index}},{key:"getStartSelectionOfMap",value:function(e){var t,a=I.default.minObject(Object.values(e),(function(e){return e.paneObject.index}));if(a&&this.updatePaneObjectFromSelectedMap(a),null===(t=a)||void 0===t?void 0:t.paneObject)return a.full&&(a=Object.assign({start:0,end:a.total},a)),a}},{key:"getStartTotal",value:function(){var e=this.getStartSelectionOfMap(this._selectedMap);return e?e.total:0}},{key:"getEndItem",value:function(){var e;return null===(e=this.getEndObject())||void 0===e?void 0:e.item}},{key:"getEndObject",value:function(){var e;return null===(e=this.getEndSelectionOfMap(this._selectedMap))||void 0===e?void 0:e.paneObject}},{key:"getEndOffset",value:function(e){var t=this.getEndSelectionOfMap(this._selectedMap),a=t?t.full?this.getEndTotal():t.end:-1;return e||(this.getStartIndex()!==this.getEndIndex()&&this.isValid()&&this.getEndObject()||-1===a)&&(a=this.getEndTotal()),a}},{key:"getEndOffsetWithPrefix",value:function(){var e=this.getEndOffset();return e>=0?e+this.getEndObject().item.getPrefixLength():e}},{key:"getEndIndex",value:function(){var e;return null===(e=this.getEndSelectionOfMap(this._selectedMap))||void 0===e?void 0:e.paneObject.index}},{key:"getEndSelectionOfMap",value:function(e){var t,a=I.default.maxObject(Object.values(e),(function(e){return e.paneObject.index}));if(a&&this.updatePaneObjectFromSelectedMap(a),null===(t=a)||void 0===t?void 0:t.paneObject)return a.full&&(a=Object.assign({start:0,end:a.total},a)),a}},{key:"getEndTotal",value:function(){var e=this.getEndSelectionOfMap(this._selectedMap);return e?e.total:0}},{key:"getEndTotalWithPrefix",value:function(){var e,t=this.getEndSelectionOfMap(this._selectedMap),a=(null===t||void 0===t||null===(e=t.paneObject.item)||void 0===e?void 0:e.getPrefix().length)||0;return t?t.total+a:0}},{key:"isMouseDown",value:function(){return this._isMouseDown}},{key:"isTouchDown",value:function(){return this._isTouchDown}},{key:"setSelectionObjects",value:function(e,t,a,n,r){var i,o,l,u,c,d,h,f,p,g,m,v;(this.isMultiselecting=!1,I.default.shouldLog(P.a.LogLevels.Selection))&&console.log("setSelectionObjects1",!!e,!!a,null===(c=e)||void 0===c?void 0:c.index,null===(d=a)||void 0===d?void 0:d.index,t,n,null===(h=e)||void 0===h?void 0:h.id,null===(f=e)||void 0===f?void 0:f.item.getRawText(),this._downOffset);(e=null!==(i=e)&&void 0!==i?i:this.getStartObject(),a=null!==(o=a)&&void 0!==o?o:this.getEndObject(),t=null!==(l=t)&&void 0!==l?l:e?this.getStartOffset(!0):void 0,n=null!==(u=n)&&void 0!==u?u:a?this.getEndOffset(!0):void 0,e&&t<0&&(t=e.getDisplayLengthWithoutPrefix()),a&&n<0&&(n=a.getDisplayLengthWithoutPrefix()),I.default.shouldLog(P.a.LogLevels.Selection))&&console.log("setSelectionObjects2",null===(p=e)||void 0===p?void 0:p.index,null===(g=a)||void 0===g?void 0:g.index,t,n,null===(m=e)||void 0===m?void 0:m.id,null===(v=e)||void 0===v?void 0:v.item.getRawText());var y={};if(e&&a){var k,_,b=e.index,w=a.index,S=e.getDisplayLengthWithoutPrefix();if((null===(k=e)||void 0===k?void 0:k.id)!==(null===(_=a)||void 0===_?void 0:_.id)||0===t&&n>0&&n===S){for(var D=0,E=b;E<=w;E++){if(D++>5e3&&__infLoop&&__infLoop(D))throw new RangeError;var C=this.objectAtIndex(E);C.item&&(y[C.id]={paneObject:C,full:!0,total:C.getDisplayLengthWithoutPrefix()})}I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::setSelectionObjects2",y,this._selectedMap)}else y=s()({},e.id,{paneObject:e,start:t,end:n,total:S}),I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::setSelectionObjects1",this._selectedMap);this.setArrowSelectInverted(b<this._downIndex&&b===this._downIndex&&t<this._downOffset.start)}else I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("setSelectionObjects {}"),this.setArrowSelectInverted(!1);return a&&void 0!==r&&(a=this.adjustSelectionBelow(y,a,r,!0)),this._setSelectedMap(y),this._isDirty=!0,a}},{key:"setSelectionIndices",value:function(e,t,a,n){var r=void 0!==e?this.getPane().objectAtIndex(e):void 0,i=void 0!==a?this.getPane().objectAtIndex(a):void 0;this.setSelectionObjects(r,t,i,n)}},{key:"isValid",value:function(){return this._isValid&&!C.default.menus.isContextMenuOpen("ReactContextMenuDate")}},{key:"checkValid",value:function(){var e=this.getPane(),t=!1;if(e&&this.getStartIndex()>=0&&this.getStartIndex()<e.numItems()&&this.getEndIndex()>=0&&this.getEndIndex()<e.numItems())if(this.getStartItem()&&this.getEndItem()){var a=this.getStartObject();if(a instanceof F.a){var n=a.getDisplayText(!0,!0),r=this.getEndObject().getDisplayText(!0,!0),i=this.getStartOffset(),o=this.getEndOffset();i>=0&&o>=0&&(void 0===n||i<=n.length)&&(void 0===r||o<=r.length)&&(t=!0)}else t=!0}else t=!1;return!t&&this.isValid()&&this.reset(void 0,!0),t}},{key:"clearSelection",value:function(e){this.reset(e)}},{key:"onPaneAdded",value:function(e){e.addScrollListener(this.onScroll)}},{key:"onPaneRemoved",value:function(e){e.removeScrollListener(this.onScroll),this.getPane()===e&&this.setFocusedPane(void 0)}},{key:"onScroll",value:function(e){var t=this;this._isMouseDown&&e===this.getPane()&&e.isWriteable&&!C.default.DragDrop.isDragging&&I.default.animationFrameOnce("SelOnScroll",(function(){var e=t.getMousePos(),a=document.elementFromPoint(e.x,e.y),n={clientX:e.x,clientY:e.y,target:a,shiftKey:t.modifiersDown.shiftKey};t._updateFromMouse(n),t._updateSelection()}))}},{key:"handleRightMouseDown",value:function(e){var t=!I.default.hasClass(e.target,"mdImage"),a=I.default.findParent(e.target,"item")&&I.default.getElementParent(e.target);if(a&&!I.default.findParent(a,"autocompleteItem",2)&&!I.default.hasClass(a,"itemNotInPane")){var n=I.default.getPaneObjectForElement(a);n&&this.isSelected(n)&&(t=!1)}t&&this.handleMouseDown(e,!0)}},{key:"checkDoubleClick",value:function(){this._isValid&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()!==this.getEndOffset()&&(this._dblClickOffsets={index:this.getStartIndex(),start:this.getStartOffset(),end:this.getEndOffset()}),this._dblClickTimeout=void 0}},{key:"handleMouseDown",value:function(e,t){var a=I.default.getPaneForElement(e.target);if(this.isWindowFocused.set(!0),t||(this._isMouseDown=!0),this.selectedBeforeThisMouseEvent=this.save(),a&&!this._isMouseDownDisabled){this.setFocusedPane(a);var n=e.target;if(I.default.findParent(n,"itemInPaneNote")){if(!C.default.DragDrop.isDraggingDelayed){var r=I.default.getPaneObjectForElement(e.target);0,a.openNoteContextMenuByPaneObject(r),I.default.preventAndStop(e)}}else if(I.default.findParent(n,"itemInPaneText")&&a.supportSel&&!H.some((function(e){return I.default.isArray(e)?I.default.findParent(n,e[0]):I.default.hasClass(n,e)}))&&(this.isKeyboardOpen||!I.default.findParent(n,"pressable",2))&&!this.isInMobileMultiselect()){this.setArrowSelectInverted(!1);var i=this.mouseDownPos.x,o=this.mouseDownPos.y,s=I.default.getElementParent(n),l=!1;if(this.mouseDownPos.x=e.pageX,this.mouseDownPos.y=e.pageY,I.default.findParent(n,"paneContent"))if(a&&a.isWriteable&&a.isEditable&&s){if(t)this._numClicks=1,this._lastClickTime=0,this._dblClickOffsets=void 0;else{var u=Date.now();u-this._lastClickTime<P.a.DoubleClickTime&&Math.abs(e.pageX-this.mouseDownPos.x)<2&&Math.abs(e.pageY-this.mouseDownPos.y)<2&&Math.abs(e.pageX-i)<2&&Math.abs(e.pageY-o)<2?this._numClicks++:(this._numClicks=1,this._dblClickOffsets=void 0),this._lastClickTime=u}var c=j.default.getCursorSelectionRange(e);if(c){I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::handleMouseDown - Default");var d=I.default.getPaneObjectForElement(e.target);if(!d||d.overview||t&&this.isSelected(d))return;if(e.shiftKey&&this._downObject||(this._downIndex=d.index,this._downObject=d),E.a.isPriModKey(e))!this.hasFullSelection()&&V.some((function(t){return I.default.hasClass(e.target,t)}))||(this.multiselect(d),l=!0,this._downOffset={start:0,end:this._downObject.getDisplayLengthWithoutPrefix()});else{var h=a.listManager?I.default.findChild(s,"itemInPaneText"):s;if(e.shiftKey&&!(E.a.mac&&e.metaKey||!E.a.mac&&e.ctrlKey))this._updateFromMouse(e);else if(1===this._numClicks||this._numClicks>3){try{I.default.PAssert(117,this._downIndex>=0,"Must have a valid index in react item")}catch(y){I.default.reportError(y)}if(this._downIndex<0)try{I.default.PAssert(118,this._downIndex>=0,"Dead cell error",I.default.getElementPath(c.getStartElement()),I.default.getElementPath(e.target))}catch(y){I.default.reportError(y)}var f=this._downObject.item;try{I.default.PAssert(119,this._downObject,"Must have a valid item in react item")}catch(y){I.default.reportError(y)}var p=c.getSelectOffsetsInElement(h);C.default.settings.showMarkdown.get()&&!this._selectedMap[d.id]&&(this._downObject.forceIsSelected=!0,p.start+=f.elsNew.numFormattingCharsBeforeOffset(this._downObject,p.start),p.end+=f.elsNew.numFormattingCharsBeforeOffset(this._downObject,p.end)),p.start=f.elsNew.adjustOffsetAroundUneditables(this._downObject,p.start),p.end=f.elsNew.adjustOffsetAroundUneditables(this._downObject,p.end),0===f.getParsedTextWithoutPrefix().length?this._downOffset={start:p.total,end:p.total}:this._downOffset={start:p.start,end:p.start},this.preferEndLine=Math.abs(e.clientX-I.default.offset(h).right)<30&&{index:this._downIndex,offset:this._downOffset.start},this.setSelectionObjects(this._downObject,this._downOffset.start,this._downObject,this._downOffset.end)}else if(2===this._numClicks){var g=M.getPreviousWord(this._downObject,this._downOffset.start)+1,m=M.getNextWord(this._downObject,this._downOffset.end);this.setSelectionObjects(this._downObject,g,this._downObject,m),this._downOffset={start:g,end:m}}else if(3===this._numClicks){var v=this._downObject.getDisplayLengthWithoutPrefix();this.setSelectionObjects(this._downObject,0,this._downObject,v),this._downOffset={start:0,end:v}}l=!0}}this._dblClickTimeout=setTimeout(this.checkDoubleClick.bind(this),0)}else I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::handleMouseDown - Skip");else I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::handleMouseDown - Skip header");this.setValid(l&&this.checkValid()),this.isValid()&&this._updateSelection(),this._downObject&&delete this._downObject.forceIsSelected,I.default.preventAndStop(e)}}}},{key:"setDownIndex",value:function(){this._downIndex=this.getStartIndex(),this._downObject=this.getStartObject(),this._downOffset={start:this.getStartOffset(),end:this.getEndOffset()}}},{key:"getMousePos",value:function(){return this.mousePos}},{key:"handleMouseMoveDocument",value:function(e){this.mousePos.x=e.pageX,this.mousePos.y=e.pageY}},{key:"handleMouseMove",value:function(e){var t=this;if(this.mouseHandlers.forEach((function(t){return t.move(e)})),this._dblClickTimeout&&(clearTimeout(this._dblClickTimeout),this._dblClickTimeout=void 0),e.target!==document.documentElement&&e.target.parentElement&&!I.default.isDraggingImage){var n=I.default.getPaneForElement(e.target);if(this._isValid&&this._isMouseDown&&n===this.getPane()&&n.supportSel&&n.isWriteable&&!a(162).default.isDragging)return this.isSelecting=!0,n.scrollFromMousePosition(e.pageX,e.pageY,!1),this._updateFromMouse(e),this._updateSelection(),I.default.preventDefault(e),I.default.timeoutOnce("selUpdating",(function(){return t.isSelecting=!1}),100),!1}}},{key:"handleMouseUp",value:function(e){this.mouseHandlers.forEach((function(t){return t.up(e)}));var t=I.default.isAttachedToDoc(e.target)&&I.default.getPaneForElement(e.target);t&&I.default.getElementParent(e.target);this._isMouseDown=!1,t&&t.supportSel&&!H.some((function(t){return I.default.isArray(t)?I.default.findParent(e.target,t[0]):I.default.hasClass(e.target,t)}))&&(I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::handleMouseDown - handleMouseUp"),I.default.cancelRepeatScrolls())}},{key:"focusPaneAndRestoreSelection",value:function(e){this.setFocusedPane(e),this.restoreSavedSelection(e),this.updateCaret()}},{key:"setFocusedPane",value:function(e){if(!e||!I.default.focusedPane||I.default.focusedPane.id!==e.id){var t=I.default.focusedPane;t&&!t.isUnloaded()&&(t.setFocused(!1),t.isEditable&&this.isValid()&&(this._savedPaneSels[t.id]=this.save())),C.default.PaneUpdateBatcher.beginUpdateItems(),this.reset(),O.a.reset(t),I.default.focusedPane=e,I.default.focusedItem=e?e.getItem():void 0,g()(b()(n.prototype),"setFocusedPane",this).call(this,e),e&&e.setFocused(!0),C.default.PaneUpdateBatcher.commitUpdateItems()}}},{key:"restoreSavedSelection",value:function(e){if(e){var t=this._savedPaneSels[e.id];t?(t.pane=e,e.isLoaded?this.restore(t):setTimeout(this.restore,0,t),this._savedPaneSels[e.id]=void 0):this.reset()}}},{key:"_updateWith",value:function(e,t){var a="start"===e?t.getStartElement():t.getEndElement();try{I.default.PAssert(120,a,"Trying to select in invalid container")}catch(l){I.default.reportError(l)}if(a){var n=I.default.getElementParent(a),r=I.default.findChild(n,"itemInPaneText"),i=I.default.getPaneObjectForElement(n),o=t.getSelectOffsetsInElement(r),s="start"===e?o.start:o.end;try{I.default.PAssert(121,i.item,"Should not be updating ReactCells without VMLIs")}catch(l){I.default.reportError(l)}if(I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::_updateWith["+e+"] - ",s,i.index),this._dblClickOffsets&&i.index===this._dblClickOffsets.index)if("start"===e)s=Math.min(s,this._dblClickOffsets.start);else if("end"===e)s=Math.max(s,this._dblClickOffsets.end);else try{I.default.PAssert(122,!1,"Invalid toUpdate value")}catch(l){I.default.reportError(l)}this._downOffset.start!==this._downOffset.end&&(s="start"===e?M.getPreviousWord(i,s)+1:M.getNextWord(i,s-1));try{I.default.PAssert(123,!isNaN(s),"Selection offsets should not be undefined")}catch(l){I.default.reportError(l)}return{paneObject:i,offsetsValue:s}}}},{key:"_updateFromMouse",value:function(e){var t=e.target;if(t&&!C.default.DragDrop.isDragging&&!this.isMultiselecting){var a=I.default.focusedPane;if(!I.default.getElementParent(t)&&e.clientY<a.contentTop()){if(I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::_updateFromMouse - outOfPane"),t=I.default.elementFromPoint(e.clientX,a.contentTop()+1),I.default.getElementParent(t)){var n=I.default.getPaneObjectForElement(t).item;try{I.default.PAssert(124,n,"If it is an LI it should be an item",t)}catch(D){I.default.reportError(D)}this.setSelectionIndices(0,0,void 0,void 0)}}else{var r,i,o,s=I.default.getElementParent(t);if(s){if(t=s.getElementsByClassName("itemInPaneText")[0],(o=j.default.getCursorSelectionRange(e))&&o.getStartElement()){var l=I.default.getPaneObjectForElement(e.target);try{I.default.PAssert(125,l,"Must be able to find a valid reactCell for the start element")}catch(D){I.default.reportError(D)}if(l){if((r=l.index)<0)try{I.default.PAssert(127,r>=0,"Dead cell error",I.default.getElementPath(o.getStartElement()),I.default.getElementPath(t))}catch(D){I.default.reportError(D)}var u="itemInPane";if(I.default.findParent(o.getStartContainer(),u)&&I.default.findParent(o.getEndContainer(),u))i=o.getSelectOffsetsInElement(t).start;else r<=this._downIndex?this.setSelectionIndices(r,0,void 0,void 0):this.setSelectionIndices(void 0,void 0,r,0)}}}else if(a.hasNonVMLIs){var c=I.default.getPaneObjectForElement(t);if(c){var d=c.index;if(d>=0)if(!a.itemAtIndex(d))if(d<this._downIndex){var h=a.indexOfNextVMLI(d);h>=0&&this.setSelectionIndices(h,0,void 0,void 0)}else{var f=a.indexOfPrevVMLI(d);if(f>=0){var p=a.objectAtIndex(f);this.setSelectionIndices(void 0,void 0,f,p.getDisplayLengthWithoutPrefix())}}}}else if(I.default.hasClass(t,"paneContent")){I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::_updateFromMouse - paneContent");var g=a.getLastObject();this.setSelectionIndices(void 0,void 0,a.numItems()-1,g?-1:0)}if(!isNaN(r)&&!isNaN(i)&&o){var m;if(r<this._downIndex||r===this._downIndex&&i<this._downOffset.start){m="end";var v=this._updateWith("start",o),y=v.paneObject,k=v.offsetsValue;this.setSelectionObjects(y,k,void 0,void 0)}else if(r>this._downIndex||r===this._downIndex&&i>=this._downOffset.start){m="start";var _=this._updateWith("end",o),b=_.paneObject,w=_.offsetsValue;this.setSelectionObjects(void 0,void 0,b,w),i===this._downOffset.start&&(this._isDirty=!0)}if(void 0!==m){if(!e.shiftKey){I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::_updateFromMouse - RunAfterUpdates");var S=this._dblClickOffsets?this._dblClickOffsets[m]:"start"===m?this._downOffset.start:this._downOffset.end;"start"===m?this.setSelectionObjects(this._downObject,S,void 0,void 0):this.setSelectionObjects(void 0,void 0,this._downObject,S)}this.setValid(!0)}}}}}},{key:"setSelectionFromNativeRange",value:function(e){var t=this._updateWith("start",e),a=t.paneObject,n=t.offsetsValue,r=this._updateWith("end",e),i=r.paneObject,o=r.offsetsValue;this.setSelectionObjects(a,n,i,o),this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex()))}},{key:"_updateSelection",value:function(e){if(this._isDirty&&!this.isMultiselecting){var t=this.getPane(),a=this.getStartIndex(),n=this.getEndIndex(),r=this.getStartObject(),i=this.getEndObject(),o=r;if(this.originalStartIndex=a,this.originalEndIndex=n,this.setValid(!isNaN(a)&&!isNaN(n)),a===n&&void 0!==a)try{I.default.PAssert(128,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(y){I.default.reportError(y)}else{for(var s=0,l=0,u=Number.MAX_SAFE_INTEGER,c=a;c<=n;++c){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var d=t.itemAtIndex(c);d&&(u=Math.min(u,d.levelsDeep.get()))}for(var h=a;h>=0;h--){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var f=t.objectAtIndex(h);if(f.item&&(o=f,f.item.levelsDeep.get()<=u))break}var p=this.setSelectionObjects(o,void 0,i,void 0,u);void 0!==o&&(r=o),void 0!==p&&(i=p)}this.updateCaret(),this.updateSelectedMap(),this._isDirty=!1;var g=this.isValid();if(r===i||!g){if(r!==this._previousSelectedObject||g!==this._previousIsValid){var m,v=g?r.item:void 0;A.a.fireEvent("selectedIndexChanged",[null===(m=r)||void 0===m?void 0:m.index,t,v])}this._previousSelectedObject=r,this._previousIsValid=g}r===i&&this.getStartOffset()===this.getEndOffset()&&(this.lastSingleSelection=this.save())}}},{key:"updateCaret",value:function(){if(this.isValid()){var e=this.getPane();if(!e||!e.isWriteable)return;e.hiddenInput&&this.updateHiddenInput()}}},{key:"updateCaretAndCaretItem",value:function(){this.isValid()&&1===Object.keys(this._selectedMap).length&&(this.updateCaret(),this.notifyItemChanged(this.getStartItem()))}},{key:"updateHiddenInput",value:function(){var e=this.getPane();if(e&&e.isEditable&&e.hiddenInput&&!B.a.isInSelectionChange)if(this.isValid()&&this.getStartItem()===this.getEndItem()){this.setArrowSelectInverted(!1);var t=this.getStartObject(),a=this.getStartOffset(),n=this.getEndOffset();a===n&&this.setDownIndex(),!this.isKeyboardOpen&&this.isSelectedFully(t)||!E.a.isAndroid&&this.isComposing||(this.isKeyboardOpen||e.scrollIndexIntoView(t.index,E.a.supportSmoothScrollWithKeyboard()?"smooth":"auto"),I.default.timeoutIf(!this.isKeyboardOpen&&E.a.app&&E.a.isiOS,0,(function(){B.a.updateFromPaneObject(t,a,n)})))}else B.a.blur(e)}},{key:"wasSelectedBeforeThisMouseEvent",value:function(e){var t=this.selectedBeforeThisMouseEvent;if(t&&void 0!==t.selectedMap[e.id])return!0}},{key:"isSelected",value:function(e){return!!this._selectedMap[e.id]}},{key:"isSelectedFully",value:function(e){var t,a,n=e.id;if(e.pane!==this.getPane())return!1;var r=this._selectedMap[n];return!!r&&(r.full||0===r.start&&r.end>0&&r.end===(null===(t=(a=e).getDisplayLengthWithoutPrefix)||void 0===t?void 0:t.call(a)))}},{key:"getSelection",value:function(e){return this._selectedMap[e.id]}},{key:"selectObjects",value:function(e,t,a,n,r){try{I.default.PAssert(129,e&&a,"Must be selecting a start object and an end object")}catch(d){I.default.reportError(d)}var i=!1,o=e.pane;if(o&&o.isWriteable){var s,l,u=e.item,c=a.item;if(!u||!c||this.isValid()&&e.id===(null===(s=this.getStartObject())||void 0===s?void 0:s.id)&&a.id===(null===(l=this.getEndObject())||void 0===l?void 0:l.id)&&t===this.getStartOffset()&&n===this.getEndOffset())0;else{I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::selectObjects -",t,n),t=Math.min(t,e.getDisplayLengthWithoutPrefix()),n=Math.min(n,a.getDisplayLengthWithoutPrefix()),this.setSelectionObjects(e,t,a,n);try{I.default.PAssert(130,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(d){I.default.reportError(d)}!isNaN(this.getStartOffset())&&this.getStartOffset()>=0&&!isNaN(this.getEndOffset())&&this.getEndOffset()<=this.getEndTotal()&&this._updateSelection(r),i=!0}}else r&&r.fromInput||this.updateHiddenInput();return i}},{key:"selectObject",value:function(e,t,a,n){return void 0===a&&(a=t),this.selectObjects(e,t,e,a,n)}},{key:"selectIndices",value:function(e,t,a,n,r){try{I.default.PAssert(131,e>=0,"Must supply a valid start index")}catch(d){I.default.reportError(d)}try{I.default.PAssert(132,a>=0,"Must supply a valid end index")}catch(d){I.default.reportError(d)}try{I.default.PAssert(133,a>e||a===e&&(n>=t||-1===n),"Must not pass reversed selection")}catch(d){I.default.reportError(d)}if(!(e<0||a<0)){var i,o,s,l,u=this.getPane(),c=!1;if(u&&u.isWriteable){s=u.objectAtIndex(e),l=u.objectAtIndex(a),i=u.itemAtIndex(e),o=u.itemAtIndex(a);try{I.default.PAssert(134,i,"Trying to select invalid start index")}catch(d){I.default.reportError(d)}try{I.default.PAssert(135,o,"Trying to select invalid end index")}catch(d){I.default.reportError(d)}}if(!i||!o||this.isValid()&&e===this.getStartIndex()&&t===this.getStartOffset()&&a===this.getEndIndex()&&n===this.getEndOffset()&&i===this.getStartItem()&&o===this.getEndItem())r&&r.fromInput||this.updateHiddenInput();else{I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::selectIndices -",t,n),t=Math.min(t,s.getDisplayLengthWithoutPrefix()),n=Math.min(n,l.getDisplayLengthWithoutPrefix()),this.setSelectionIndices(e,t,a,n);try{I.default.PAssert(136,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(d){I.default.reportError(d)}!isNaN(this.getStartOffset())&&this.getStartOffset()>=0&&!isNaN(this.getEndOffset())&&this.getEndOffset()<=this.getEndTotal()&&this._updateSelection(r),c=!0}return c}}},{key:"selectItem",value:function(e,t,a){try{I.default.PAssert(137,I.default.isNumber(t),"Must pass a valid start offset")}catch(n){I.default.reportError(n)}try{I.default.PAssert(138,I.default.isNumber(a)||void 0===a,"Must pass a valid end offset")}catch(n){I.default.reportError(n)}return void 0===a&&(a=t),this.selectItems(e,t,e,a)}},{key:"selectItems",value:function(e,t,a,n){try{I.default.PAssert(139,I.default.isVMLI(e),"Should only be passing VMLIs to start this fn")}catch(s){I.default.reportError(s)}try{I.default.PAssert(140,I.default.isVMLI(a),"Should only be passing VMLIs to end this fn")}catch(s){I.default.reportError(s)}var r=this.getPane();if(r){var i=r.indexOfItem(e);try{I.default.PAssert(141,i>=0,"Must be able to find the start item in the pane")}catch(s){I.default.reportError(s)}var o=r.indexOfItem(a);try{I.default.PAssert(142,o>=0,"Must be able to find the end item in the pane")}catch(s){I.default.reportError(s)}return this.selectIndices(i,t,o,n)}}},{key:"save",value:function(){if(this._isValid){var e=this.getPane();if(!e.isDestroyed()&&!e.isUnloaded()){try{I.default.PAssert(143,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(a){I.default.reportError(a)}try{I.default.PAssert(144,!isNaN(this.getEndIndex()),"End index must be valid")}catch(a){I.default.reportError(a)}var t={pane:e,selectedMap:I.default.clone(this._selectedMap)};return this._savedSelection=t,t}}}},{key:"getSavedSelection",value:function(){return this._savedSelection}},{key:"restore",value:function(e){var t=this,a=!1,n=null===e||void 0===e?void 0:e.pane;if(e&&!n.isDestroyed()){try{I.default.PAssert(145,n,"Must have a valid pane to restore selection to")}catch(o){I.default.reportError(o)}var r=I.default.focusedPane;I.default.focusedPane=n,I.default.focusedItem=n.getItem(),r&&!r.isUnloaded()&&r!==n&&r.setFocused(!1),n.setFocused(!0),this.pane.set(n)}if(e&&!I.default.isEmpty(e.selectedMap)){var i={};Object.values(e.selectedMap).forEach((function(e){t.updatePaneObjectFromSelectedMap(e);var a=e.paneObject;a||(a=n.findItem(a.item)),a&&(i[a.id]=Object.assign({},e,{paneObject:a,total:a.getDisplayLengthWithoutPrefix()}))})),I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log("Sel::restore",i,this._selectedMap),this._setSelectedMap(i),this.isValid()&&this._updateSelection(),I.default.isEmpty(this._selectedMap)?this.reset():(this._isDirty=!0,this._updateSelection(),a=!0)}else this.reset();return this._savedSelection=void 0,a}},{key:"scrollStartIntoView",value:function(e){if(this._isValid){try{I.default.PAssert(146,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(t){I.default.reportError(t)}try{I.default.PAssert(147,!isNaN(this.getEndIndex()),"End index must be valid")}catch(t){I.default.reportError(t)}I.default.focusedPane.scrollIndexIntoView(this.getStartIndex(),e?"auto":"smooth")}}},{key:"scrollEndIntoView",value:function(){if(this._isValid){try{I.default.PAssert(148,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(e){I.default.reportError(e)}try{I.default.PAssert(149,!isNaN(this.getEndIndex()),"End index must be valid")}catch(e){I.default.reportError(e)}I.default.focusedPane.scrollIndexIntoView(this.getEndIndex(),"smooth")}}},{key:"onWindowBlur",value:function(){this.isWindowFocused.set(!1)}},{key:"onWindowFocus",value:function(){this.isWindowFocused.set(!0)}},{key:"isMultiselected",value:function(){return this.getStartIndex()!==this.getEndIndex()}},{key:"isInMobileMultiselect",value:function(){return!this.isKeyboardOpen&&this.hasFullSelection()}},{key:"isSingleSelect",value:function(){var e=Object.values(this._selectedMap);return(null===e||void 0===e?void 0:e.length)>0&&1===e.length&&!e[0].full}},{key:"hasFullSelection",value:function(){var e=Object.values(this._selectedMap);return(null===e||void 0===e?void 0:e.length)>0&&(e.length>1||e[0].full)}},{key:"getSelectedObjects",value:function(){var e=this;if(!this._isValid)return[];var t=[];return Object.values(this._selectedMap).forEach((function(a){e.updatePaneObjectFromSelectedMap(a);var n=a.paneObject,r=n.item;r&&!r.isNote()&&t.push(n)})),t}},{key:"getSelectedItems",value:function(e,t){var a=this;if(!this._isValid)return[];var n=[],r=this.getPane(),i=this.getStartIndex(),o=this.getStartOffset(),s=this.getEndOffset(),l=this.getEndTotal();return Object.values(this._selectedMap).forEach((function(u){a.updatePaneObjectFromSelectedMap(u);var c=u.paneObject,d=c.item,h=c.index;if(d&&(e||!d.isNote())){var f=h>i||0===o&&s===l,p=f&&r.isPaneObjectCollapsed(c);n.push(d),t&&p?d.forEachChildRecursive((function(e){return n.push(e)}),f):f&&d.hasNote()&&n.push(d.getNote())}})),n}},{key:"getStartElement",value:function(){var e=this.getStartIndex();if(this._isValid&&!isNaN(e))return this.getPane().elementAtIndex(e)}},{key:"getEndElement",value:function(){var e=this.getEndIndex();if(this._isValid&&!isNaN(e))return this.getPane().elementAtIndex(e)}},{key:"fireKeyEvent",value:function(e,t,a){this.fireKeyEventInternal(e,"keydown",t),this.fireKeyEventInternal(e,"keypress",a||t),this.fireKeyEventInternal(e,"keyup",t)}},{key:"fireKeyEventInternal",value:function(e,t,a){try{I.default.PAssert(150,void 0!==a,"Must pass in valid key data to type")}catch(r){I.default.reportError(r)}if(e||(e=this.getStartElement()),document.createEvent&&e){var n=document.createEvent("Event");n.normCode=a.normCode,n.shiftKey=!!a.shiftKey,n.altKey=!!a.altKey,n.ctrlKey=!!a.ctrlKey,n.metaKey=!!a.metaKey,n.synthetic=!0,n.initEvent(t,!0,!0),e.dispatchEvent(n)}else if(e)try{I.default.PAssert(151,!1,"Unable to fire key event")}catch(r){I.default.reportError(r)}else try{I.default.PAssert(152,!1,"No element available to fire key event on")}catch(r){I.default.reportError(r)}}},{key:"fireClickEvent",value:function(e,t){this.fireClickEventInternal(e,"mousedown",t),this.fireClickEventInternal(e,"mouseup",t),this.fireClickEventInternal(e,"mouseclick",t)}},{key:"fireClickEventInternal",value:function(e,t,a,n){try{I.default.PAssert(153,void 0!==a,"Must pass in a valid button to click with")}catch(o){I.default.reportError(o)}if(e||(e=j.default.getSelectionNode()),document.createEvent&&e){var r=document.createEvent("Event");if(r.button=a,r.synthetic=!0,n)for(var i in n)n.hasOwnProperty(i)&&(r[i]=n[i]);r.initEvent(t,!0,!0),e.dispatchEvent(r)}else if(e)try{I.default.PAssert(154,!1,"Unable to fire click event")}catch(o){I.default.reportError(o)}else try{I.default.PAssert(155,!1,"No element available to fire click event on")}catch(o){I.default.reportError(o)}}},{key:"fireMouseUp",value:function(e,t){this.fireClickEventInternal(e,"mouseclick",t)}},{key:"confirmDangerousSelection",value:function(e){var t=this,a=this.isMultiselectDangerous();if(a){var n=this.save();C.default.menus.confirm(a,(function(a){t.restore(n),a&&e()}))}else e()}},{key:"isMultiselectDangerous",value:function(){var e=this.pane.get(),t=this.getSelectedItems(!0,!0).length;return t>(e.isViewOutline()||e.isViewProject()?6:1)&&"Are you sure you want to delete ".concat(t," items?")}},{key:"onPressEnter",value:function(){this.isValid()&&this.selectIndex(this.getStartIndex(),this.getStartOffset())}},{key:"setModifiersDown",value:function(e,t,a,n){this.modifiersDown={ctrlKey:e,metaKey:t,altKey:a,shiftKey:n}}},{key:"addMouseHandler",value:function(e){var t=this,a=e.move,n=e.up,r={move:a,up:function(e){n(e),t.mouseHandlers.remove(r)}};this.mouseHandlers.push(r)}},{key:"selectUpDown",value:function(e,t,a){var n,r,o,s=0,l=this.pane.get(),u=this.isArrowSelectInverted()||"up"===e&&this.getStartIndex()===this.getEndIndex(),c=u?this.originalStartIndex:this._downIndex,d=u?this._downIndex:this.originalEndIndex,h=u?c:d,f={fromArrows:!0},p=0,g=l.itemAtIndex(h);o=Number.MAX_SAFE_INTEGER;for(var m=c;m<=d;++m){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var v=l.itemAtIndex(m);v&&("up"===e&&u||v!==g)&&(o=Math.min(o,v.levelsDeep.get()))}o===Number.MAX_SAFE_INTEGER&&(o=g.levelsDeep.get());var y=function(e){var r=l.itemAtIndex(e);if(r.levelsDeep.get()<=o&&(!t||r.isPrefixHeader())&&(n=e,p++,!a||p>5))return!0};if("down"===e){for(var k=0,_=l.numItems(),b=h+1;b<_;b++){if(k++>5e3&&__infLoop&&__infLoop(k))throw new RangeError;if(y(b))break}if(n){var w=l.indexOfLastItem();r=u?[Math.min(n,d),0,Math.max(n,d),-1,f]:[Math.min(c,n),0,Math.min(Math.max(n,c),w),-1,f]}}else if("up"===e){for(var S=0,D=h-1;D>=0;D--){if(S++>5e3&&__infLoop&&__infLoop(S))throw new RangeError;if(y(D))break}void 0!==n&&(r=u?[Math.max(0,Math.min(n,d)),0,Math.max(n,d),-1,f]:[Math.min(c,n),0,Math.max(c,n),-1,f])}return r&&(this.selectIndices.apply(this,i()(r)),this.setArrowSelectInverted(n<this._downIndex)),u?this.getStartIndex():this.getEndIndex()}},{key:"adjustSelectionBelow",value:function(e,t,a,n){for(var r=0,i=this.getPane(),o=i.numItems(),s=t,l=t.index+1;l<o;l++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=i.objectAtIndex(l),c=null===u||void 0===u?void 0:u.item;if(c){if(c.levelsDeep.get()<=a||u.block!==t.block)break;n?(e[u.id]={paneObject:u,full:!0,total:u.getDisplayLengthWithoutPrefix()},s=u):delete e[u.id]}}return s}},{key:"multiselect",value:function(e){var t,a=e,n=a.item,r=a.id,i=null===(t=n.levelsDeep)||void 0===t?void 0:t.get(),o=!this.isSelectedFully(a);this.isMultiselecting=!0;var s,l,u=Object.assign({},this._selectedMap),c=void 0!==i;if(o)Object.values(u).forEach((function(e){e.full||delete u[e.paneObject.id]})),u[r]={full:!0,paneObject:a,total:null===(s=(l=a).getDisplayLengthWithoutPrefix)||void 0===s?void 0:s.call(l)},c&&this.adjustSelectionBelow(u,a,i,!0);else if(delete u[r],c){this.adjustSelectionBelow(u,a,i,!1);var d=a.parentObject;d&&this.isSelected(d)&&(delete u[d.id],this.adjustSelectionBelow(u,d,i-1,!1))}this._setSelectedMap(u),this.setValid(this.checkValid()),this.updateCaret(),this.updateSelectedMap()}},{key:"updateSelectedMap",value:function(){var e=this;I.default.shouldLog(P.a.LogLevels.Selection)&&I.default.log(this._selectedMap);var t=this.save(),a=this.getPane();if(a){var n={};Object.values(this._previousSelectedMap).concat(Object.values(this._selectedMap)).forEach((function(t){var a=t.paneObject;n[a.id]||(n[a.id]=!0),e.notifyItemChanged(a.item)}))}this._previousSelectedMap=I.default.clone(this._selectedMap),A.a.fireEvent("selectionChanged",[t,a]),this.selectedMapObs.set(this._selectedMap)}},{key:"objectAtIndex",value:function(e){var t;return null===(t=this.getPane())||void 0===t?void 0:t.objectAtIndex(e)}},{key:"updatePaneObjectFromSelectedMap",value:function(e){var t=e.paneObject.pane.findPaneObject(e.paneObject.id);return t&&(e.paneObject=t,e.total=t.getDisplayLengthWithoutPrefix()),e}},{key:"_setSelectedMap",value:function(e){this._selectedMap=e}},{key:"forEach",value:function(e,t){var a=0;try{I.default.PAssert(156,!t||!t.restoreSelection,"restoreSelection is no longer a valid option")}catch(o){I.default.reportError(o)}x.a.beginAction();var n=this.getSelectedObjects(),r=n.map((function(e){return e.item}));C.default.PaneUpdateBatcher.beginUpdateItems();for(var i=0;i<n.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!1===e(n[i].item,i,n.length,n[i],r))break}C.default.PaneUpdateBatcher.commitUpdateItems(),x.a.endAction()}},{key:"notifyItemChanged",value:function(e){var t;this.isSingleSelect()||null===(t=e.itemChanged)||void 0===t||t.notify()}},{key:"insertTextAtSelection",value:function(e){var t=this.getStartObject(),a=this.getStartObject(),n=this.getStartOffsetWithPrefix(),r=this.getStartOffset(),i=this.getEndOffsetWithPrefix();if(t===a){var o=t.item,s=o.elsNew,l=t.getDisplayText(!0,!0),u=l[r-1];" "!==u&&r>0&&(e=" "+e),console.log(u,l);var c=s.spliceText(e,n,i-n,t);o.setText(c,P.a.ChangeType.Local),this.selectObject(t,r+e.length)}}},{key:"onTouchUp",value:function(e,t){L.onEvent("SelOnTouchUp",e,t)}},{key:"disableMouseDown",value:function(e){var t=this;this._isMouseDownDisabled=!0,I.default.timeoutOnce("disableMouseDown",(function(){return t._isMouseDownDisabled=!1}),e)}}]),n}(N),S()(n.prototype,"onScroll",[D.a],Object.getOwnPropertyDescriptor(n.prototype,"onScroll"),n.prototype),S()(n.prototype,"handleRightMouseDown",[D.a],Object.getOwnPropertyDescriptor(n.prototype,"handleRightMouseDown"),n.prototype),S()(n.prototype,"handleMouseDown",[D.a],Object.getOwnPropertyDescriptor(n.prototype,"handleMouseDown"),n.prototype),S()(n.prototype,"handleMouseMoveDocument",[D.a],Object.getOwnPropertyDescriptor(n.prototype,"handleMouseMoveDocument"),n.prototype),S()(n.prototype,"handleMouseMove",[D.a],Object.getOwnPropertyDescriptor(n.prototype,"handleMouseMove"),n.prototype),S()(n.prototype,"handleMouseUp",[D.a],Object.getOwnPropertyDescriptor(n.prototype,"handleMouseUp"),n.prototype),S()(n.prototype,"restore",[D.a],Object.getOwnPropertyDescriptor(n.prototype,"restore"),n.prototype),S()(n.prototype,"onWindowBlur",[D.a],Object.getOwnPropertyDescriptor(n.prototype,"onWindowBlur"),n.prototype),S()(n.prototype,"onWindowFocus",[D.a],Object.getOwnPropertyDescriptor(n.prototype,"onWindowFocus"),n.prototype),n);t.a=new W},,,function(e,t,a){"use strict";var n,r=a(7),i=a.n(r),o=a(8),s=a.n(o),l=a(60),u=a.n(l),c=a(20),d=a.n(c),h=a(21),f=a.n(h),p=a(13),g=a.n(p),m=a(10),v=a.n(m),y=a(0),k=a(26),_=a(62),b=a(2),w=a(15),S=function(){function e(){i()(this,e),this.onResize=new _.a,this.onForeground=new _.a,this.windowSize=new w.a({width:0,height:0})}return s()(e,[{key:"windowWidth",value:function(){return this.windowSize.get().width}},{key:"windowHeight",value:function(){return this.windowSize.get().height}}]),e}(),D=a(11);function P(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var I=(n=function(e){d()(n,e);var t=P(n);function n(){var e;return i()(this,n),e=t.call(this),k.a.binder(u()(e),"normalizeKeys","getKeyCode"),e.blockedReason=new w.a,e.supportsMultiplePanes=new w.a(!1),e.versionRequired=[],e.versionAvailable=[],e.versionRequired[b.a.AppPlatform.Electron]=1,e.versionAvailable[b.a.AppPlatform.Electron]=7,e.versionCurrent=20,e.versionMessages={19:"We just released a big update with changes to selection and indenting, and many other changes. See the blog post for more details.",20:"New search options: normal search and global search. See the Hotkey help or the blog post for more details."},e.appSubVersion=void 0,e.setDeployEnvironments(),e.appPlatform=void 0,e.bodyClass=void 0,e.b=document.documentElement,e.orientation=b.a.Orientation.Portrait,e.isNativeFullscreen=new w.a(!1),e.onResize=new _.a,e.appState=void 0,e.isHosted=!1,e.hostedBy=void 0,e.initStorageQuota={quota:NaN,usage:NaN},e.isNearStorageQuota=!1,e.pageVisibilityHidden=void 0,e.pageVisibilityChange=void 0,e._allowNativeNotifications=!0,e.isDevURL="localhost"===window.location.hostname||"dev.moo.do"===window.location.hostname||"beta.moo.do"===window.location.hostname,e.isBeta="beta.moo.do"===window.location.hostname,e._features={},e.init(),e.app&&(e.customRedirectState={app:!0,appv:e.appv,webview:e.getAppState("webview")}),window.addEventListener("resize",e._onResize),e._onResize(),e}return s()(n,[{key:"_onResize",value:function(){var e=this,t=this.windowSize.get(),a=document.body.clientWidth,n=document.body.clientHeight;t.width===a&&t.height===n||this.windowSize.set({width:a,height:n}),this.isNativeApp()&&this.appv<4&&setTimeout((function(){e.screenTop!==window.screenTop&&(e.screenTop=window.screenTop,e.isNativeFullscreen.set(0===e.screenTop))}),100)}},{key:"getDeployVar",value:function(e){return this.deployEnvironment[e]}},{key:"setDeployEnvironments",value:function(){this.deployEnvironment={},"dev.moo.do"===window.location.hostname?(this.deployEnvironment[b.a.DeployVariable.Environment]="dev",this.deployEnvironment[b.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[b.a.DeployVariable.APIHost]="//api-dev.moo.do"):"beta.moo.do"===window.location.hostname?(this.deployEnvironment[b.a.DeployVariable.Environment]="beta",this.deployEnvironment[b.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[b.a.DeployVariable.APIHost]="//api-beta.moo.do"):"localhost"===window.location.hostname?(this.deployEnvironment[b.a.DeployVariable.Environment]="local",this.deployEnvironment[b.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[b.a.DeployVariable.APIHost]="//api-dev.moo.do"):(this.deployEnvironment[b.a.DeployVariable.Environment]=this.isMobile?"mobile":"web",this.deployEnvironment[b.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[b.a.DeployVariable.APIHost]="//api-old.moo.do")}},{key:"getLocaleInfo",value:function(e){try{e.lang=navigator.language||navigator.userLanguage}catch(t){e.lang="EXCEPTION"}}},{key:"getPlatformInfo",value:function(e){e.os=this.OSName,e.browser=this.browser,e.majorVersion=this.majorVersion,e.minorVersion=this.minorVersion,e.appVersionRequired=this.versionRequired[this.appPlatform],e.app=this.app,e.appPlatform=this.appPlatform,e.standalone=this.standalone,e.packagedApp=this.packagedApp,e.isTouch=this.touch,e.isTouchDevice=this.isTouchDevice,e.usePointerEvents=this.usePointerEvents,e.appState=this.appState,e.isHosted=this.isHosted,e.hostedBy=this.hostedBy,e.embed=this.embed,e.bodyClass=this.b.className,e.rawUA=navigator.userAgent,e.referrer=document.referrer,e.devicePixelRatio=window.devicePixelRatio,e.pageVisibilityChange=!!this.pageVisibilityChange,e.appSubVersion=this.appSubVersion,e.initStorageQuota=this.initStorageQuota,e.isNearStorageQuota=this.isNearStorageQuota,this.getLocaleInfo(e)}},{key:"getUserPlatformConfig",value:function(){return(this.platformBrowser&&this.platformOS?this.platformOS+""+this.platformBrowser:navigator.userAgent)+(this.isBeta?"b":"")}},{key:"getAppDownloadURL",value:function(){return window.location.origin+"/download/"}},{key:"getChromeExtensionURL",value:function(){return"https://chrome.google.com/webstore/detail/moodo/dfphnckjoinkfflhfbnjoiggfflnekcb"}},{key:"getGmailAddonURL",value:function(){return"https://gsuite.google.com/marketplace/app/moodo/597847337936"}},{key:"getPrivacyPolicyURL",value:function(){return"https://www.moo.do/privacy/"}},{key:"supportsNativeApp",value:function(){switch(this.OSName){case"Windows":case"MacOS":return!0;default:return!1}}},{key:"isNativeApp",value:function(){return this.appPlatform===b.a.AppPlatform.Electron}},{key:"supportLocalFiles",value:function(){return this.isNativeApp()&&this.appv>=3}},{key:"isNativeMac",value:function(){return this.isNativeApp()&&this.mac}},{key:"canDownloadNativeApp",value:function(){return this.supportsNativeApp()&&!this.isNativeApp()}},{key:"init",value:function(){var e=this;this.initAppState(),this.initHostState(),this.initFeatures();var t,n,r=navigator.userAgent,i="";((k.a.getURLParam("rn")||window.ReactNativeWebView)&&(this.isRNApp=!0,this.isMobile=!0,this.app=!0),this.OSName="Unknown OS",this.app&&(i+=" app"),r.includes("Win")?(this.platformOS=b.a.PlatformOS.Windows,this.OSName="Windows",this.windows=!0):r.includes("iPhone")?(this.platformOS=b.a.PlatformOS.iPhone,this.OSName="iPhone"):r.includes("iPod")?(this.platformOS=b.a.PlatformOS.iPod,this.OSName="iPod"):r.includes("Mac")?(this.platformOS=b.a.PlatformOS.iPad,this.OSName="iPad"):-1!==r.indexOf("Mac")?(this.platformOS=b.a.PlatformOS.Mac,this.OSName="MacOS",this.mac=!0):-1!==r.indexOf("X11")?-1!==r.indexOf("CrOS")?(this.platformOS=b.a.PlatformOS.ChromeOS,this.OSName="ChromeOS",this.chromeOS=!0):(this.platformOS=b.a.PlatformOS.Linux,this.OSName="Linux",this.linux=!0):-1!==r.indexOf("Linux")&&(this.platformOS=b.a.PlatformOS.Linux,this.OSName="Linux",this.linux=!0,r.indexOf("Android")&&(this.isMobile=!0,this.isAndroid=!0)),this.majorVersion=1e3,this.minorVersion=1e3,-1!==r.indexOf("MSIE")||-1!==r.indexOf("Trident"))&&(this.platformBrowser=b.a.PlatformBrowser.IE,this.browser="Trident",this.ie=!0,(null!==("Microsoft Internet Explorer"===navigator.appName?new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")).exec(r)||null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(r))&&(this.majorVersion=parseFloat(RegExp.$1)));if(this.app||-1===r.indexOf("Edge/")&&-1===r.indexOf("Edg/")?-1!==r.indexOf("Chrome")||-1!==r.indexOf("CriOS")?(this.platformBrowser=b.a.PlatformBrowser.Chrome,this.browser="Chrome",this.isChrome=!0,null!==new RegExp("Chrome/([0-9]{1,}).").exec(r)&&(this.majorVersion=parseFloat(RegExp.$1))):-1!==r.indexOf("Firefox")?(this.platformBrowser=b.a.PlatformBrowser.Firefox,this.browser="Firefox",this.isFirefox=!0,null!==new RegExp("Firefox/([0-9]{1,}).").exec(r)&&(this.majorVersion=parseFloat(RegExp.$1))):-1!==r.indexOf("Safari")||"iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName?(this.platformBrowser=b.a.PlatformBrowser.Safari,this.browser="Safari",this.safari=!0,null!==new RegExp("Version/([0-9]{1,}).([0-9]{1,}).").exec(r)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2)),"iPad"!==this.OSName&&"iPhone"!==this.OSName&&"iPod"!==this.OSName||(this.isMobile=!0,this.isiOS=!0)):-1!==r.indexOf("Opera")?(this.platformBrowser=b.a.PlatformBrowser.Opera,this.browser="Opera"):-1!==r.indexOf("Edge")&&(this.ieEdge=!0,this.platformBrowser=b.a.PlatformBrowser.Edge):(this.ieEdge=!0,this.platformBrowser=b.a.PlatformBrowser.Edge,this.browser="Edge",null!==/Edg(?:e)*\/([0-9]{1,})\./i.exec(r)&&(this.majorVersion=parseFloat(RegExp.$1))),r.indexOf(b.a.ProductName)>=0){if(this.platformBrowser=b.a.PlatformBrowser.Electron,this.app=!0,this.appPlatform=b.a.AppPlatform.Electron,i+=" electron",null!==new RegExp("Moo\\.do/([^\\s]+)\\s").exec(navigator.userAgent)){var o,s=function(e,t){for(var a=0,n=e.split("."),r=t.split("."),i=0;i<3;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=+n[i],s=+r[i];if(o>s)return 1;if(s>o)return-1;if(!isNaN(o)&&isNaN(s))return 1;if(isNaN(o)&&!isNaN(s))return-1}return 0},l=RegExp.$1;(o=s(l,"1.7.2")>=0?7:s(l,"1.6.17")>=0?6:s(l,"1.6.0")>=0?5:s(l,"1.4.2")>=0?4:s(l,"1.2.1")>=0?3:s(l,"1.1.0")>=0?2:1)<4&&setTimeout((function(){Promise.resolve().then(a.bind(null,4)).then((function(t){t.default.toasts.pushMessage({text:"A new version is available with important fixes. Future versions will update themselves, but please download this manually.",hold:!0,holdOnAction:!0,actionText:"DOWNLOAD",action:function(){t.default.openUrl(e.getAppDownloadURL())}})}))}),2e3),this.appv=o}this.mac&&(i+=" electronMac"),this.appState||(this.appState={}),this.appState.appType||(this.appState.appType="electron"),this._enableFeature(b.a.Feature.OAuth)}if(this.isTouchDevice=!(!("ontouchstart"in window)&&!navigator.msMaxTouchPoints),this.usePointerEvents=!!window.navigator.msPointerEnabled,this.isMobile&&(i+=" moweb"),this.usePointerEvents?(this.downEvent="MSPointerDown",this.moveEvent="MSPointerMove",this.upEvent="MSPointerUp"):(this.downEvent="mousedown",this.moveEvent="mousemove",this.upEvent="mouseup"),k.a.hasURLParam("touch","false")?this.touch=!1:k.a.hasURLParam("touch","true")&&(this.touch=!0),this.mac){i+=" mac";(function(){var e=document.createElement("div");e.style.visibility="hidden",e.style.width="100px",document.body.appendChild(e);var t=e.offsetWidth;e.style.overflow="scroll";var a=document.createElement("div");a.style.width="100%",e.appendChild(a);var n=a.offsetWidth;return e.parentNode.removeChild(e),t-n})()>0&&(i+=" showScrollbars")}if(this.windows&&(i+=" windows",this.ie&&(i+=" ie")),"Firefox"===this.browser&&(i+=" firefox"),this.safari&&(i+=" safari"),this.embed===b.a.EmbedApps.Mailbird&&(this.platformBrowser=b.a.PlatformBrowser.Mailbird,i+=" mailbird",this.isMailbirdSidebar()&&(i+=" mailbirdSidebar")),this.demo&&(i+=" demoMode"),this.isChrome&&this.app&&(this.isPackagedApp=!0),this.cmdChar=this.mac?"\u2318":"ctrl",this.priModKey=this.mac?"\u2318":"Ctrl",this.secModKeyForce=this.mac?"\u2303":"Alt",this.secModKey=this.app?this.priModKey:this.secModKeyForce,this.noErrorStacks="iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName,this.standalone=!!navigator.standalone||window.navigator.userAgent.indexOf("FluidApp")>=0,i&&i.length>0&&(this.bodyClass=i,this.b.className+=i),this.URL=window.URL||window.webkitURL,this.supportBlobURLIFrame=!1,this.transition=this.addPrefix("transition"),this.animation=this.addPrefix("animation"),this.transform=this.addPrefix("transform"),this.transformOrigin=this.addPrefix("transformOrigin","transform-origin"),this.userSelect=this.addPrefix("userSelect","user-select"),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){return window.setTimeout(e,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame||function(e){clearTimeout(e)},this.ie&&(document.documentElement.addEventListener("MSHoldVisual",(function(e){e.preventDefault()}),!1),document.documentElement.addEventListener("contextmenu",(function(e){e.preventDefault()}),!1)),document.documentElement.addEventListener("keydown",this.normalizeKeys,!0),document.documentElement.addEventListener("keypress",this.normalizeKeys,!0),document.documentElement.addEventListener("keyup",this.normalizeKeys,!0),"undefined"!==typeof document.hidden?(t="hidden",n="visibilitychange"):["moz","ms","webkit"].forEach((function(e){if("undefined"!==document[e+"Hidden"])return t=e+"Hidden",n=e+"visibilitychange",!1})),void 0!==t&&(this.pageVisibilityHidden=t,this.pageVisibilityChange=n),this.supportsEstimatedStorage()){this.estimateAvailableStorage((function(t){e.initStorageQuota=t,t.usage/t.quota>.9&&(e.isNearStorageQuota=!0)}),(function(){}))}}},{key:"updateBodyClass",value:function(){this.bodyClass&&(document.body.className+=this.bodyClass)}},{key:"supportsNotifications",value:function(){return this.supportsNativeNotifications()||this.supportsHTML5Notifications()}},{key:"supportsNativeNotifications",value:function(){var e=!1;return this._allowNativeNotifications&&(this.app||this.app&&this.appPlatform!==b.a.AppPlatform.Electron&&this.isChrome||this.embed===b.a.EmbedApps.Mailbird)&&(e=!0),e}},{key:"supportsHTML5Notifications",value:function(){return"Notification"in window}},{key:"usesHTML5Notifications",value:function(){return!this.supportsNativeNotifications()&&this.supportsHTML5Notifications()}},{key:"hasNotificationPermission",value:function(){return!this.usesHTML5Notifications()||"granted"===Notification.permission}},{key:"disallowNativeNotifications",value:function(){this._allowNativeNotifications=!1}},{key:"supportsPersistedStorage",value:function(){var e=!1;return"storage"in navigator&&"persist"in navigator.storage&&(e=!0),e}},{key:"requestStoragePersistence",value:function(e,t){navigator.storage.persisted().then((function(a){a?e():navigator.storage.persist().then(e,t)}))}},{key:"isStoragePersisted",value:function(e){this.supportsPersistedStorage()?navigator.storage.persisted().then(e):setTimeout(e,0,!1)}},{key:"supportsNativePromises",value:function(){return!!window.Promise}},{key:"supportsEstimatedStorage",value:function(){var e=!1;return("storage"in navigator&&"estimate"in navigator.storage||"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage)&&(e=!0),e&&this.supportsNativePromises()}},{key:"estimateAvailableStorage",value:function(e,t){this.supportsEstimatedStorage()?this._estimateAvailableStorage().then(e,t):setTimeout(t,0)}},{key:"_estimateAvailableStorage",value:function(){return"storage"in navigator&&"estimate"in navigator.storage?navigator.storage.estimate():"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage?new Promise((function(e,t){navigator.webkitTemporaryStorage.queryUsageAndQuota((function(t,a){e({usage:t,quota:a})}),t)})):Promise.resolve({usage:NaN,quota:NaN})}},{key:"supportsWebworkers",value:function(){var e=!1;return window.Worker&&(e=!0),e}},{key:"supportsNativeDownload",value:function(){return this.isNativeApp()&&this.appv>=2}},{key:"supportsIDBWebworkers",value:function(){var e=!1;if(this.supportsWebworkers())switch(this.browser){case"Firefox":e=this.majorVersion>=37;break;case"Chrome":e=this.majorVersion>=24}return e}},{key:"supportsPassiveListeners",value:function(){if(void 0===this._supportsPassiveListeners){var e=!1;try{var t=Object.defineProperty({},"passive",{get:function(){e=!0}});window.addEventListener("test",null,t)}catch(a){}this._supportsPassiveListeners=e}return this._supportsPassiveListeners}},{key:"addPassiveListener",value:function(e,t,a){this.supportsPassiveListeners()?e.addEventListener(t,a,{passive:!0}):e.addEventListener(t,a)}},{key:"isMobro",value:function(){var e,t=null;try{new ActiveXObject("")}catch(a){e=a.name}try{t=!!new ActiveXObject("htmlfile")}catch(a){t=!1}return!(t="ReferenceError"===e||!1!==t)}},{key:"normalizeKeys",value:function(e){var t=e;return void 0!==t.normCode&&(e.synthetic||t instanceof KeyboardEvent)||(t.normCode=this.getKeyCode(e)),t}},{key:"getKeyCode",value:function(e){var t;return 46===(t=null===e.keyCode||0===e.keyCode?null!==e.charCode?e.charCode:e.which:e.keyCode)&&"keypress"===e.type&&(t=190),t}},{key:"initAppState",value:function(){var e=location.hash.substring(1);if(e)for(var t,a=0,n=/([^&=]+)=([^&]*)/g;null!==(t=n.exec(e));){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if("state"===decodeURIComponent(t[1])){var r=decodeURIComponent(t[2]);if(r){var i=function(t){try{e=JSON.parse(t)}catch(a){}};i(r),e||i(r.replace(/\\"/g,'"')),e&&(this.app=!0===e.app,this.appv=e.appv,this.debugApp=e.debug,this.live=e.live,this.offline=e.offline,this.test=e.test,this.embed=e.embed,this.appState=e)}break}}this.live=this.live||k.a.hasURLParam("live","true"),this.test=!1,this.offline=this.offline||k.a.hasURLParam("offline","true")||!1,this.demo=k.a.hasURLParam("demo","true")||k.a.hasURLParam("template")||!1,this.app=this.app||!1}},{key:"getAppState",value:function(e){return this.appState?this.appState[e]:void 0}},{key:"_enableFeature",value:function(e){this._features[e]=!0}},{key:"_disableFeature",value:function(e){this._features[e]=!1}},{key:"initFeatures",value:function(){this._enableFeature(b.a.Feature.ClonePane)}},{key:"isMailbirdSidebar",value:function(){return this.embed===b.a.EmbedApps.Mailbird&&"true"===this.getAppState("sidebar")}},{key:"initHostState",value:function(){try{this.isHosted=window.self!==window.top}catch(e){this.isHosted=!0}this.isHosted&&(this.hostedBy=document.referrer)}},{key:"addPrefix",value:function(e,t){var a="",n=["ms","webkit","moz","o"],r=this.b.style;if(t||(t=e),"string"===typeof r[e])a="";else for(var i=0,o=0;o<n.length;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if("string"===typeof r["-"+n[o]+"-"+t]){a=n[o];break}}var s=a.length>0?e.charAt(0).toUpperCase()+e.slice(1):e;if(a){var l=a.length>0?a.charAt(0).toUpperCase()+a.slice(1):e;return{prop:"-"+a+"-"+t,style:a+s,react:l+s}}return{prop:e,style:s,react:s}}},{key:"blockClient",value:function(){switch(this.browser){case"Firefox":if(this.majorVersion<16)return{platform:"Firefox",browser:this.browser,update:!0};break;case"Chrome":if(this.majorVersion<26)return{platform:"Chrome",browser:this.browser,update:!0};break;case"Native Android":if(this.majorVersion<4)return{platform:"Native Android",browser:"NativeAndroid",update:!0};break;case"Opera":return{platform:this.browser,browser:this.browser,update:!1};case"Trident":return{platform:"Internet Explorer",browser:this.browser,update:!1};case"Safari":if(6===this.majorVersion&&this.minorVersion<1||this.majorVersion<6)return{platform:"Safari",browser:this.browser,update:!0};break;case"Edge":if(!y.default.isDemoMode()&&this.windows&&this.majorVersion<70)return{platform:this.browser,browser:this.browser,update:!1}}if(this.app){if(this.appv<this.versionRequired[this.appPlatform]){a(0).default.log("App Version out of date.");var e={version:this.versionRequired[this.appPlatform]};return a(0).default.nativeBridge.sendToApp("updateRequired"),e}if(this.appv>this.versionAvailable[this.appPlatform])return a(0).default.log("App is newer than the javascript, forcing an app cache update: "+this.appv+" vs. "+this.versionAvailable[this.appPlatform]),{cacheUpdate:!0}}}},{key:"actionVerb",value:function(){return this.touch?"tap":"click"}},{key:"actionVerbCaps",value:function(){return this.touch?"Tap":"Click"}},{key:"updateOrientation",value:function(){return this.orientation=90===Math.abs(window.orientation)?b.a.Orientation.Landscape:b.a.Orientation.Portrait,this.orientation}},{key:"isPageVisible",value:function(){return!this.pageVisibilityHidden||!document[this.pageVisibilityHidden]}},{key:"getUpdateMessages",value:function(e){for(var t=0,a=[],n=(e||0)+1;n<=this.versionCurrent;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.versionMessages[n];r&&a.push(r)}return a}},{key:"isFeatureEnabled",value:function(e){return this._features[e]}},{key:"recordAppSubVersion",value:function(e){this.appSubVersion=e}},{key:"getPlatformName",value:function(){return this.mac?"Mac":this.windows?"Windows":"Chrome"}},{key:"getPlatformIcon",value:function(){return this.mac?"FaApple":this.windows?"FaWindows":this.linux?"FaLinux":"FaChrome"}},{key:"getActualWindowWidth",value:function(){return document.body&&document.body.clientWidth||0}},{key:"getActualWindowHeight",value:function(){return document.body&&document.body.clientHeight||0}},{key:"hasBetaFeatures",value:function(){return this.isDevURL}},{key:"isPriModKey",value:function(e){return this.mac&&e.metaKey||!this.mac&&e.ctrlKey}},{key:"isSecModKey",value:function(e){return this.mac&&e.ctrlKey||!this.mac&&e.altKey}},{key:"supportSmoothScrollWithKeyboard",value:function(){return!this.isiOS||this.app}}]),n}(S),v()(n.prototype,"_onResize",[D.a],Object.getOwnPropertyDescriptor(n.prototype,"_onResize"),n.prototype),n);t.a=new I},,,,,,function(e,t,a){"use strict";a(53);var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(133),l=function(){function e(t,a,n){r()(this,e),this._value=t,this._listeners=a?[new s.a(this,a)]:void 0,this._shouldFreeze=n}return o()(e,[{key:"ignoreLoopingListenersError",value:function(){0}},{key:"get",value:function(){return this._value}},{key:"countProperties",value:function(){return Object.keys(this._value).length}},{key:"set",value:function(e,t){var a=this._value;return this._value=e,!1!==t&&this.notify(e,a,t),e}},{key:"hasValue",value:function(){return void 0!==this._value}},{key:"onHasValue",value:function(e){if(this.hasValue())e(this._value);else var t,a=this.listen((function(n,r){void 0===n||t||(t=!0,e(n,r),setTimeout((function(){a.dispose()}),0))}))}},{key:"onValue",value:function(e,t){if(this._value===e)t();else var a,n=this.listen((function(r,i){r!==e||a||(a=!0,t(),setTimeout((function(){n.dispose()}),0))}))}},{key:"hasListeners",value:function(){return this._listeners&&this._listeners.length>0}},{key:"listen",value:function(e){this._listeners||(this._listeners=[]);var t=new s.a(this,e);return this._listeners.push(t),t}},{key:"unlistenListener",value:function(e){this._listeners&&this._listeners.remove(e)}},{key:"unlisten",value:function(e){if(this._listeners){var t=this._listeners.findIndex((function(t){return t.cb===e}));t>=0&&this._listeners.removeAt(t)}}},{key:"notify",value:function(e,t,a){0===arguments.length&&(e=this._value,t=this._value,a=!0);var n=this._listeners;if(n&&n.length>0&&(e!==t||!0===a)){var r=0;0;for(var i=0;i<n.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=n[i];!1===(0===arguments.length?o.cb(this._value,void 0,a):o.cb(e,t,a))&&(n.splice(i,1),i--)}0}}}]),e}();t.a=l},,function(e,t,a){"use strict";a.d(t,"b",(function(){return S})),a.d(t,"a",(function(){return D}));var n=a(51),r=a.n(n),i=a(7),o=a.n(i),s=a(8),l=a.n(s),u=a(20),c=a.n(u),d=a(21),h=a.n(d),f=a(13),p=a.n(f),g=a(2),m=a(0),v=a(3),y=a.n(v),k=a(4);function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=p()(e);if(t){var r=p()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return h()(this,a)}}var b=function(e,t){m.default.reportError(e,t,void 0,"React Component Error: "),k.default.toasts.pushMessage(g.a.MessageID.ReactError)},w=function(e){c()(a,e);var t=_(a);function a(e){var n;return o()(this,a),(n=t.call(this,e)).state={error:null},n}return l()(a,[{key:"componentDidCatch",value:function(e,t){try{this.props.onError&&this.props.onError(),b(e,t)}catch(a){}this.setState({error:e})}},{key:"render",value:function(){var e=this.props.children;return null!==this.state.error?null:e||null}}]),a}(v.Component);function S(e,t){var a=function(a,n){return y.a.createElement(w,null,y.a.createElement(e,r()({},a,{onError:t})))};return y.a.memo(a)}function D(e,t){var a=function(a,n){return y.a.createElement(w,null,y.a.createElement(e,r()({},a,{ref:n,onError:t})))};return a=y.a.forwardRef(a),y.a.memo(a)}},function(e,t,a){"use strict";var n,r=a(5),i=a.n(r),o=a(12),s=a.n(o),l=a(7),u=a.n(l),c=a(8),d=a.n(c),h=a(10),f=a.n(h),p=a(35),g=a(11),m=a(38),v=a.n(m),y=a(20),k=a.n(y),_=a(21),b=a.n(_),w=a(13),S=a.n(w),D=a(2),P=a(23),I=a(46),E=a(0),C=a(4),x=a(26),A=a(55),T=a(70),M=a(123),L=a(25),O=a(101),R=a(37),F=a(59),N=a(99),B=a(15);function j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=S()(e);if(t){var r=S()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return b()(this,a)}}var U,H=new(n=function(e){k()(a,e);var t=j(a);function a(){var e;return u()(this,a),(e=t.call(this,!0)).dataCache={settings:{},items:{},documents:{},boards:{},contacts:[],localStorage:{},user:{}},e._demoId=1,e.demoError=new B.a,e}return d()(a,[{key:"init",value:function(e,t){var a={displayName:"Demo User",activeUser:"demoemail@moo.do",userId:"demouid"},n={};Object.keys(a).forEach((function(e){return n[C.default.settings.getSettingAbbrev(e)]={v:a[e]}})),C.default.settings.load(n,!1,!1);this.loadDemoContacts(["Jay","Grant","Ramada","Canyon Ranch","Jim Joseph","Miller Harris","Bob Johnson","Bill Wilson","Emily Edwards","Jane Johnson","Mike Thomas","Joe Lewis","Steve","Melissa","Mikey","Bart","Dad","Mom","James Rhodes","Neptures","Pepper","President Ellis","Contacts","Jane"]);var r=function(t){e(t),ie.isLoaded.onValue(!0,(function(){C.default.PaneManager.loadInitialState(),A.a.ensureSelected()}))},i=x.a.getURLParam("template");if(i)this.loadCloudTemplate(i,r);else{var o,s=null!==(o=x.a.getURLParam("data"))&&void 0!==o?o:"demo-basic";this.loadDemoTemplate(s,r)}}},{key:"loadCloudTemplate",value:function(){var e=s()(i.a.mark((function e(t,a){var n,r,o;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return p.a.initializeFirebase(),e.next=3,I.a.database().ref("templates/".concat(t)).once("value");case 3:if(n=e.sent.val())try{r=JSON.parse(n.v),o=Object.assign(n.p,r),this.loadDemoData(o,a)}catch(s){0,this.demoError.set("Error loading template: "+JSON.stringify(s))}else this.demoError.set("Error loading template. A template with this id does not exist.");case 5:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"loadDemoTemplate",value:function(e,t){var a=this;E.default.XHR({type:"GET",url:"".concat(window.location.protocol,"//").concat(window.location.host,"/data/").concat(e.toLowerCase(),".json")}).then(function(){var e=s()(i.a.mark((function e(n){var r;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(200!==n.status){e.next=5;break}return e.next=3,n.json();case 3:r=e.sent,a.loadDemoData(r,t);case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}())}},{key:"loadDemoData",value:function(e,t){var a=this;if(e){var n=e.documents,r=e.boards,i=e.dateBasis,o=+L.a.getToday()-i,s=n.map((function(e){var t=e.doc,n=e.items.map((function(e){var t=R.a.itemIn(e);if(t.date){var n=F.a.fromData(t.date);n&&!n.isRepeatDate()&&(n.getDate().addMilliseconds(o),t.date=n.toData())}return t.dateCompleted&&(t.dateCompleted+=o),t.dateCreated&&(t.dateCreated+=o),t.dateModified&&(t.dateModified+=o),a.dataCache.items[t.id]=t,t}));O.a.createItemHierarchy(n,P.a.getItemsMap());var r=a.getItemData(t.root),i={id:t.id,text:t.text,acl:v()({},p.a.getUid(),{e:p.a.getAccountEmail(),t:p.a.getAccountName(),r:D.a.DocumentAccessRoles.Admin}),backing:a,dateModified:Date.now(),rootData:r},s=N.a.fromData(i,a);return s.createVMLIs(),s})),l=E.default.isDemoMode()&&x.a.getURLParam("panes");if(l&&s[0]){var u={id:ie.generateID(),name:"My Board",index:"0",panes:this.loadDemoPanesFromHash(l,s[0].id)};this.dataCache.boards=v()({},u.id,u)}else this.dataCache.boards=r;t(s)}}},{key:"loadDemoPanesFromHash",value:function(e,t){for(var a=0,n=e.split(","),r=[],i=0;i<n.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=n[i].split(":");if("help"===o[0])C.default.intro.showHelp();else{var s=o[0],l={id:ie.generateID(),document:t};if("1"===s||"Outline"===s?(s=D.a.PaneMode.Task,l.viewState={viewMode:"Outline"}):"2"!==s&&"Calendar"!==s||(s=D.a.PaneMode.Task,l.viewState={viewMode:"Calendar_Week"}),l.type=s,o.length>1){if(o[1]){for(var u=0,c={text:o[1]},d=o[1].split(" "),h=0;h<d.length;h++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var f=!1,p="-"===d[h][0],g=d[h].replace("-","");if(g.indexOf("//")>=0)f=!0,c.complete=p?-1:1;else if(g.indexOf("*")>=0)f=!0,c.starred=p?-1:1;else if(g.indexOf("!")>=0){f=!0;var m=void 0;3===g.length?m=D.a.VMLIFlag.P0:2===g.length?m=D.a.VMLIFlag.P1:1===g.length&&(m=D.a.VMLIFlag.P2),c.priority=m}f&&(c.text=c.text.replace(d[h],""))}l.search=c}o[2]&&(l.item=o[2])}r.push(l)}}return r}},{key:"loadDemoContacts",value:function(e){var t=0,a=e.map((function(e){return{id:"contact_"+t++,name:e,isDemo:!0,emails:[{address:"test-"+e.split(" ")[0].toLowerCase()+"@moo.do",primary:!0}],phoneNumbers:[{number:"(555) 123-4567",type:"mobile"}]}}));T.a.loadContacts(a)}},{key:"getItemData",value:function(e){return this.dataCache.items[e]}},{key:"saveItem",value:function(e,t,a,n,r){var i=this.dataCache.items[t.id];if(i)Object.assign(i,a);else{var o=t.getFullSaveData(),s=t.getItems().map((function(e){return e.getFullSaveData()}));i=Object.assign(o,{items:s})}return this.dataCache.items[t.id]=i,Promise.resolve()}},{key:"deleteItem",value:function(e,t,a){var n=t.parent();this.saveItem(e,n,void 0,D.a.ChangeType.Local,D.a.SaveFlag.Prop),delete this.dataCache.items[t.id]}},{key:"addItem",value:function(e,t){this.saveItem(e,t.parent(),void 0,D.a.ChangeType.Local,D.a.SaveFlag.Prop),this.saveItem(e,t,void 0,D.a.ChangeType.Local,D.a.SaveFlag.Prop)}},{key:"moveItem",value:function(e,t){var a=e.getDocumentOwner();this.saveItem(a,e,void 0,D.a.ChangeType.Local,D.a.SaveFlag.Prop)}},{key:"setNote",value:function(e,t,a,n,r){this.saveItem(e,t,void 0,D.a.ChangeType.Local,D.a.SaveFlag.Prop),a?this.saveItem(e,a,void 0,D.a.ChangeType.Local,D.a.SaveFlag.Prop):n&&delete this.dataCache.items[n.id]}},{key:"addDocument",value:function(e){var t=e.getRootItem();return this.documents[e.id]=e,this.saveItem(e,t,void 0,D.a.ChangeType.Local,D.a.SaveFlag.Prop)}},{key:"saveDocument",value:function(e){}},{key:"moveItemDocument",value:function(e,t){}},{key:"deleteDocument",value:function(e){}},{key:"undeleteDocument",value:function(e){}},{key:"unlistenDocument",value:function(e){}},{key:"getSetting",value:function(e){return""}},{key:"setSetting",value:function(e,t){}},{key:"saveBoard",value:function(e){}},{key:"deleteBoard",value:function(e){}},{key:"getBoards",value:function(){return this.dataCache.boards}},{key:"clearAllData",value:function(){var e=s()(i.a.mark((function e(){return i.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"generateId",value:function(){return"id_"+this._demoId++}}]),a}(M.b),f()(n.prototype,"generateId",[g.a],Object.getOwnPropertyDescriptor(n.prototype,"generateId"),n.prototype),n),V=a(113),W=a(27),z=a(114);function q(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=S()(e);if(t){var r=S()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return b()(this,a)}}var G,K,Y=new(U=function(e){k()(a,e);var t=q(a);function a(){var e;return u()(this,a),(e=t.call(this,!0)).dataCache={},e.dirtyDocs={},W.a.listen("onUnload",e.writeDocuments),e}return d()(a,[{key:"init",value:function(){var e=s()(i.a.mark((function e(t,a){var n,r=this;return i.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:this.cbOnDocumentsChanged=a,n=window.___electronAllDocs,C.default.ElectronBridge.listenToDocChanges(this.onFileChanged),C.default.crypto.onLoad((function(){C.default.crypto.onUpdated.listen(r.reload);var e=function(){var e=s()(i.a.mark((function e(a){var n;return i.a.wrap((function(e){for(var o=0,l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!a){e.next=7;break}return e.next=3,Promise.all(a.map(function(){var e=s()(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(var n=0,i=0,o=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,r.parseJSON(t);case 2:if(!(a=e.sent)){e.next=6;break}return a.items&&a.items.forEach((function(e){r.dataCache[e.id]=e})),e.abrupt("return",r.createDoc(a,a.id));case 6:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:n=e.sent.filter((function(e){return void 0!==e})),t(n),e.next=8;break;case 7:t([]);case 8:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}();n?n.value?e(n.value):(C.default.toasts.pushMessage({text:"Error loading local files. Please check that the directory is correct in the settings.",actionText:"SETTINGS",action:function(){return C.default.menus.openSettings("Desktop")},hold:!0}),t([])):C.default.ElectronBridge.getAllDocs(e)}));case 4:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"createDoc",value:function(e,t){if(!ie.getDocumentById(e.id)){var a=N.a.create(e);return a.createVMLIs(),this.documents[a.id]=a,a}C.default.toasts.pushMessage("Detected duplicate document data in local document:<br/>".concat(t,".json"))}},{key:"parseJSON",value:function(){var e=s()(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,a=JSON.parse(t),e.abrupt("return",this.parseJSONObject(a));case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}}}),e,this,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()},{key:"parseJSONObject",value:function(){var e=s()(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(e.prev=0,!(t.moodoVer&&t.doc&&t.doc.root&&t.doc.id)){e.next=10;break}return e.next=4,z.a.parseJSON(t);case 4:if(!(a=e.sent)){e.next=9;break}return a.id=t.doc.id,a.backing=this,e.abrupt("return",a);case 9:console.log("No data for",t);case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(0);case 14:case"end":return e.stop()}}}),e,this,[[0,12]])})));return function(t){return e.apply(this,arguments)}}()},{key:"reload",value:function(){var e=this,t={};Object.keys(this.documents).forEach((function(e){return t[e]=!0})),C.default.ElectronBridge.getAllDocs(function(){var a=s()(i.a.mark((function a(n,r){return i.a.wrap((function(a){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(a.prev=a.next){case 0:return r=r||[],a.next=3,Promise.all(r.map(function(){var a=s()(i.a.mark((function a(n){var r,o;return i.a.wrap((function(a){for(var i=0,s=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(a.prev=a.next){case 0:return a.prev=0,r=JSON.parse(n),a.next=4,e.onFileChanged(D.a.CrudActions.Modified,r);case 4:(o=a.sent)&&delete t[o.id],a.next=10;break;case 8:a.prev=8,a.t0=a.catch(0);case 10:case"end":return a.stop()}}}),a,null,[[0,8]])})));return function(e){return a.apply(this,arguments)}}()));case 3:Object.keys(t).forEach((function(t){return e.onFileChanged(D.a.CrudActions.Removed,t)})),e.cbOnDocumentsChanged({documents:e.documents,documentsEncrypted:{},documentsDeleted:{}});case 5:case"end":return a.stop()}}}),a)})));return function(e,t){return a.apply(this,arguments)}}())}},{key:"onFileChanged",value:function(){var e=s()(i.a.mark((function e(t,a){var n,r,o,s,l,u=this;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(t!==D.a.CrudActions.Removed||"string"!==typeof a){e.next=6;break}n=a,(r=this.documents[n])&&(r.delete(!0),delete this.documents[n]),e.next=14;break;case 6:return e.next=8,this.parseJSONObject(a);case 8:if(!(o=e.sent)){e.next=14;break}return(s=this.documents[o.id])?(l=o.items,s.text.set(o.text),this.checkFileItems(s,l)):(s=this.createDoc(o,a.id),this.cbOnDocumentsChanged({documents:this.documents,documentsEncrypted:{},documentsDeleted:{}})),s&&o.items&&o.items.forEach((function(e){u.dataCache[e.id]=e})),e.abrupt("return",s);case 14:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"checkFileItems",value:function(e,t){var a=0,n=this,r={};e.getAllItems().forEach((function(e){return r[e.id]=!0}));for(var i=function(i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=t[i];if(!o.isRoot){var s=n.getItemData(t[i].id),l=!1,u={id:o.id};s?Object.keys(o).forEach((function(e){s[e]!==o[e]&&("id"!==e&&(l=!0),u[e]=o[e])})):(u=o,l=!0),l&&V.a.onRemoteChange(e,s,o.id,u)}delete r[o.id]},o=0;o<t.length;o++)i(o);Object.keys(r).forEach((function(t){var a=n.getItemData(t),r={id:t,isDeleted:!0};V.a.onRemoteChange(e,a,t,r)}))}},{key:"writeDocuments",value:function(){var e=this;Object.keys(this.dirtyDocs).forEach((function(t){var a=e.dirtyDocs[t];delete e.dirtyDocs[t],a.dateModified.set(Date.now()),a.toJSON({exportArchived:!0,includeNotes:!0,encrypt:C.default.settings.encryptLocalFiles.get()}).then((function(e){C.default.ElectronBridge.saveDoc("".concat(a.id,".json"),e,(function(e){e&&(console.log(e),C.default.toasts.pushMessage("Error saving ".concat(a.text.get(),". Please check that the destination file is writeable.")))}))}))}))}},{key:"setDocNeedsWrite",value:function(e){this.dirtyDocs[e.id]=e,clearTimeout(this.timeoutWrite),this.timeoutWrite=setTimeout(this.writeDocuments,1e3)}},{key:"getItemData",value:function(e){return this.dataCache[e]}},{key:"saveItem",value:function(e,t,a,n,r){var i=new Date;t.dateModified=i,this.dataCache[t.id]=t.getFullSaveData(),E.default.isLocalChange(n)&&!E.default.isUndoRedoChange(n)&&this.setDocNeedsWrite(e)}},{key:"deleteItem",value:function(e,t,a){delete this.dataCache[t.id],E.default.isLocalChange(a)&&!E.default.isUndoRedoChange(a)&&this.setDocNeedsWrite(e)}},{key:"addItem",value:function(e,t){var a=this;t.forEachChildRecursive((function(t){a.saveItem(e,t,void 0,D.a.ChangeType.Local,D.a.SaveFlag.Prop)}),!0,!0)}},{key:"moveItem",value:function(e,t){var a=this,n=e.getDocumentOwner(),r=t.getDocumentOwner();n===r?this.saveItem(e.getDocumentOwner(),e,void 0,D.a.ChangeType.Local,D.a.SaveFlag.Prop):(e.forEachChildRecursive((function(e){a.saveItem(n,e,void 0,D.a.ChangeType.Local,D.a.SaveFlag.Prop)}),!0,!0),this.setDocNeedsWrite(r))}},{key:"moveItemDocument",value:function(e,t){this.saveItem(e.getDocumentOwner(),e,void 0,D.a.ChangeType.Local,D.a.SaveFlag.Prop);var a=ie.getDocumentById(t);t&&this.setDocNeedsWrite(a)}},{key:"setNote",value:function(e,t,a,n,r){this.saveItem(e,t,void 0,D.a.ChangeType.Local,D.a.SaveFlag.Prop),a&&this.saveItem(e,a,void 0,D.a.ChangeType.Local,D.a.SaveFlag.Prop)}},{key:"addDocument",value:function(){var e=s()(i.a.mark((function e(t){var a;return i.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:a=t.getRootItem(),this.documents[t.id]=t,this.saveItem(t,a,void 0,D.a.ChangeType.Local,D.a.SaveFlag.Prop);case 3:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"saveDocument",value:function(e){this.setDocNeedsWrite(e)}},{key:"deleteDocument",value:function(e,t){C.default.ElectronBridge.deleteDoc("".concat(e.id,".json"))}},{key:"undeleteDocument",value:function(e,t){}},{key:"renameDocument",value:function(e,t){this.setDocNeedsWrite(e)}},{key:"unlistenDocument",value:function(e){}},{key:"getSetting",value:function(e){return""}},{key:"setSetting",value:function(e,t){0}},{key:"saveBoard",value:function(e){0}},{key:"deleteBoard",value:function(e){0}},{key:"getBoards",value:function(){return[]}},{key:"clearAllData",value:function(){return Promise.resolve()}},{key:"generateId",value:function(){return E.default.generateTempId()}},{key:"numDocuments",value:function(){return Object.keys(this.documents).length}}]),a}(M.a),f()(U.prototype,"reload",[g.a],Object.getOwnPropertyDescriptor(U.prototype,"reload"),U.prototype),f()(U.prototype,"onFileChanged",[g.a],Object.getOwnPropertyDescriptor(U.prototype,"onFileChanged"),U.prototype),f()(U.prototype,"writeDocuments",[g.a],Object.getOwnPropertyDescriptor(U.prototype,"writeDocuments"),U.prototype),U),X=a(9),Q=a(48),J=a(34),Z=a(124),$=a(90),ee=10*D.a.MSPerMinute,te=new(G=function(){function e(){u()(this,e)}return d()(e,[{key:"init",value:function(){C.default.settings.backupFrequency.listen(this.onTimeChanged),E.default.isBoolean(C.default.settings.needsBackup.get())&&C.default.settings.needsBackup.set({})}},{key:"docNeedsBackup",value:function(e){var t=C.default.settings.needsBackup.get();return t&&t[e.id]&&Date.now()-t[e.id]>ee}},{key:"setNeedsBackup",value:function(e,t){var a=Date.now();if(t){if(!e.isLocalOnly()||C.default.settings.backupLocal.get()){var n=C.default.settings.needsBackup.get();n&&n[e.id]||C.default.settings.needsBackup.set(Object.assign(v()({},e.id,a),n))}}else{var r=E.default.clone(C.default.settings.needsBackup.get());delete r[e.id],C.default.settings.needsBackup.set(r)}}},{key:"onTimeChanged",value:function(){this.needsBackupDrive={},J.a.onLoaded(this.checkBackupDrive)}},{key:"onDataSaved",value:function(e){this.setNeedsBackup(e,!0)}},{key:"checkBackup",value:function(){this.checkBackupAuto()}},{key:"checkBackupAutoDoc",value:function(e){0}},{key:"checkBackupAuto",value:function(){ie.getDocumentsArray().forEach(this.checkBackupAutoDoc)}},{key:"checkBackupDriveDoc",value:function(e){}},{key:"checkBackupDrive",value:function(){0}},{key:"backupDrive",value:function(){var e=s()(i.a.mark((function e(){return i.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(ie.getDocumentsArray().map(this.backupDocumentDrive)));case 1:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backupAuto",value:function(){var e=s()(i.a.mark((function e(){return i.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all(ie.getDocumentsArray().map(this.backupDocumentAuto)));case 1:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backupAll",value:function(){var e=s()(i.a.mark((function e(){return i.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.backupAuto(),this.backupDrive()]));case 1:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backupDocumentAll",value:function(){var e=s()(i.a.mark((function e(t){return i.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.all([this.backupDocumentAuto(t),this.backupDocumentDrive(t)]));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"backupDocumentStorage",value:function(){var e=s()(i.a.mark((function e(t){var a,n,r;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:e.next=22;break;case 5:return r=e.sent,e.prev=6,e.next=9,C.default.cloudStorage.uploadString(n,r);case 9:if(!e.sent){e.next=17;break}return t.addBackup(a),e.next=14,$.a.getAPIForDocument(t);case 14:e.sent.addBackup(a),this.setNeedsBackup(t,!1);case 17:e.next=22;break;case 19:e.prev=19,e.t0=e.catch(6),E.default.reportError(e.t0);case 22:case"end":return e.stop()}}}),e,this,[[6,19]])})));return function(t){return e.apply(this,arguments)}}()},{key:"backupDocumentAuto",value:function(){var e=s()(i.a.mark((function e(t){return i.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.backupDocumentStorage(t));case 2:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"backupDocumentDrive",value:function(){var e=s()(i.a.mark((function e(t){var a,n,r,o;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:e.next=11;break;case 5:return n=e.sent,r=new Blob([n],{type:"application/json"}),o=(new Date).toString("yy/MM/dd h:mm tt"),r.name=t.text.get()+" "+o,e.abrupt("return",new Promise((function(e){new Z.a(r,a,{named:D.a.DriveFolder.Backup},{docId:t.id},(function(){}),(function(){var a=C.default.settings.backupsDrive.get();a&&E.default.isObject(a)||(a={}),C.default.settings.backupsDrive.set(Object.assign({},a,v()({},t.id,Date.now()))),e()}),(function(t){E.default.reportError(t,"Backup error"),e()})).upload()})));case 10:delete this.needsBackupDrive[t.id];case 11:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"downloadBackup",value:function(){var e=s()(i.a.mark((function e(t,a){var n,r;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return n=this.getCloudBackupFilename(t,a),e.next=3,C.default.cloudStorage.getString(n);case 3:if(!(r=e.sent)){e.next=12;break}return e.prev=5,e.abrupt("return",JSON.parse(r));case 9:e.prev=9,e.t0=e.catch(5),E.default.reportError(e.t0);case 12:case"end":return e.stop()}}}),e,this,[[5,9]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getCloudBackupFilename",value:function(e,t){return"users/".concat(p.a.getUid(),"/documents/").concat(e.id,"/").concat(t,".json")}},{key:"isDriveBackupAuthorized",value:function(){return J.a.getDefaultAccountID()&&J.a.isAuthorizedForScopes(J.a.getDefaultAccountID(),[D.a.GScope.Drive])}},{key:"authorize",value:function(e){J.a.getDefaultAccountID()?J.a.authAccount(J.a.getDefaultAccountID(),[D.a.GScope.Drive],(function(t){e(t)})):e(void 0)}},{key:"enable",value:function(){var e=this;this.authorize((function(t){t&&(C.default.settings.backupFrequency.set(D.a.DefaultBackupFrequency),e.backupDrive())}))}},{key:"getLastBackup",value:function(){return ie.getDocumentsArray().reduce((function(e,t){return Math.max(e,t.getLastBackup())}),0)}}]),e}(),f()(G.prototype,"onTimeChanged",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"onTimeChanged"),G.prototype),f()(G.prototype,"checkBackup",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"checkBackup"),G.prototype),f()(G.prototype,"checkBackupAutoDoc",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"checkBackupAutoDoc"),G.prototype),f()(G.prototype,"checkBackupAuto",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"checkBackupAuto"),G.prototype),f()(G.prototype,"checkBackupDriveDoc",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"checkBackupDriveDoc"),G.prototype),f()(G.prototype,"checkBackupDrive",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"checkBackupDrive"),G.prototype),f()(G.prototype,"backupDocumentStorage",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"backupDocumentStorage"),G.prototype),f()(G.prototype,"backupDocumentAuto",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"backupDocumentAuto"),G.prototype),f()(G.prototype,"backupDocumentDrive",[g.a],Object.getOwnPropertyDescriptor(G.prototype,"backupDocumentDrive"),G.prototype),G),ae=a(42),ne=a(119),re=(K=function(){function e(){u()(this,e),this.isLoaded=new B.a(!1),this._isRemoteEnabled=!E.default.isDemoMode(),this._documentsById={},this._itemCache={},this.documentsArray=new ae.a,this.documentsEncryptedArray=new ae.a,this.documentsDeletedArray=new ae.a,this._sources=[],this.settingProvider=E.default.isDemoMode()?H:$.a,this._idProvider=this.settingProvider.generateId,this.loadState=$.a.loadState,this.onlineStatus=new B.a(p.a.isOnline()?"Connecting":"Offline"),this.isLoadedLocal=new B.a(!1),this.isLoadedRemote=new B.a(!1),this.loadProgress=new B.a,E.default.isDemoMode()?this._sources=[H]:(this._sources.push($.a),X.a.supportLocalFiles()&&this._sources.push(Y))}return d()(e,[{key:"init",value:function(){this._emptyDocument=this.createEmptyDocument("Empty",H),window.__clearLocalData=this.clearLocalData}},{key:"loadLocal",value:function(e){var t=this;this._cbOnLoad=e,this._sourcesWaiting=this._sources.length,this._sources.forEach((function(e){return e.init(t.onSourceLoaded,t.onSourceDocumentsChanged)})),this._isRemoteEnabled&&te.init(),E.default.registerEvent("ItemCreated","ItemAction","Create"),E.default.registerEvent("ItemCompleted","ItemAction","Complete"),this.isLoadedLocal.set(!0)}},{key:"onSourceLoaded",value:function(e){var t=this;C.default.crypto.onLoad((function(){if(t._sourcesWaiting--,e.forEach((function(e){e.canDecrypt()&&(t._documentsById[e.id]=e,t.documentsArray.includes(e)||t.documentsArray.push(e,!1))})),0===t._sourcesWaiting){var a=t.documentsArray.get().filter((function(e){return void 0===e.index}));a.length>0&&((a=a.sort((function(e,t){return t.dateModified.get()-e.dateModified.get()}))).forEach((function(e,t){return e.setIndex(t+"")})),t.documentsArray.set(a,!1)),t.documentsArray.sort(R.a.compareItemIndex),void 0!==C.default.settings.lastSync.get()&&C.default.PaneManager.loadInitialState(),t.isLoaded.set(!0),setTimeout((function(){return C.default.timeline.updateNotifications()}),1e3),t._cbOnLoad&&t._cbOnLoad(e)}}))}},{key:"onSourceDocumentsChanged",value:function(e){var t=this,a=e.documents,n=e.documentsEncrypted,r=e.documentsDeleted,i=this.documentsArray.get();Object.keys(a).forEach((function(e){var n=a[e];t._documentsById[n.id]&&i.includes(n)?n.canDecrypt()||i.remove(n):n.canDecrypt()&&(t._documentsById[n.id]=n,i.push(n))})),(i=i.filter((function(e){return e.canDecrypt()}))).sort(R.a.compareItemIndex),this.documentsArray.set(i),n&&this.documentsEncryptedArray.set(E.default.objectToArray(n)),r&&this.documentsDeletedArray.set(E.default.objectToArray(r)),this.isLoadedRemote.set(!0)}},{key:"getDefaultBacking",value:function(){return this._sources[0]}},{key:"getDocumentById",value:function(e){return this._documentsById[e]}},{key:"getDefaultDocument",value:function(){var e=this.documentsArray.get().find((function(e){return!e.isDeleted.get()}));return e||this.addEmptyDocument("My First Document",this.getDefaultBacking())}},{key:"getDocumentsArray",value:function(e){var t=this.documentsArray.get();return e||(t=t.filter((function(e){return!e.isDeleted.get()}))),t}},{key:"getDeletedDocuments",value:function(){return this.documentsArray.get().filter((function(e){return e.isDeleted.get()}))}},{key:"hasDocuments",value:function(){return this.getDocumentsArray().length>0}},{key:"runOnAllDocuments",value:function(e){this.getDocumentsArray().forEach((function(t){return e(t)}))}},{key:"parseAll",value:function(e){this.runOnAllDocuments((function(t){t.parseAll(e)}))}},{key:"runOnAllDocumentRoots",value:function(e){this.getDocumentsArray().forEach((function(t){return e(t.getRootItem())}))}},{key:"getItemDataLocal",value:function(e,t){return e.getBacking().getItemData(t)}},{key:"getDocumentBacking",value:function(e){return e.getBacking()}},{key:"getItemBacking",value:function(e){var t=e.getDocumentOwner();try{E.default.PAssert(69,t,"Item document must exist")}catch(a){E.default.reportError(a)}return t.getBacking()}},{key:"_getPreviousState",value:function(e,t){try{E.default.PAssert(70,e.getDocumentOwner(),"Missing document owner",e.getRawText())}catch(r){E.default.reportError(r)}var a=e.getDocumentOwner().getBacking().getItemData(e.id),n={};return a&&Object.keys(t).forEach((function(e){n[e]=a[e]})),n}},{key:"saveItem",value:function(e,t,a,n,r){var i=e.parent()||e.isRoot;try{E.default.PAssert(71,i,"Item must have parent unless root")}catch(s){E.default.reportError(s)}if(i&&(e.index||e.isNote()||(this.updateItemIndex(e),t.index=e.index),t.id=e.id,E.default.isLocalChange(a)&&Q.a.pushModified(e,t,this._getPreviousState(e,t)),e.shouldSave())){var o=e.getDocumentOwner();o.getBacking().saveItem(o,e,E.default.clone(t),a,n),E.default.isDemoMode()||te.onDataSaved(o)}}},{key:"updateItemIndex",value:function(e){var t=e.parent();if(!e.isNote())if(t&&t.items.length()>1){var a=t.items.get(),n=a.indexOf(e),r=!e.isNote()&&n>0?a[n-1]:null,i=!e.isNote()&&n<a.length-1?a[n+1]:null;0,e.index=Object(ne.a)(r?r.index:null,i?i.index:null)}else e.index="0"}},{key:"addItem",value:function(e,t,a){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!n){this.updateItemIndex(t),Q.a.pushAdded(e,t);var r=t.getDocumentOwner();r.getBacking().addItem(r,t)}}},{key:"deleteItem",value:function(e,t,a){if(E.default.isLocalChange(a)){Q.a.pushRemoved(e,t);var n=t.getDocumentOwner();n.getBacking().deleteItem(n,t,a)}}},{key:"moveItem",value:function(e,t,a,n){if(this.updateItemIndex(e),E.default.isLocalChange(n)){var r=e.getDocumentOwner(),i={parent:e.parent().id,index:e.index},o={parent:t.id,index:a};Q.a.pushModified(e,i,o),r.getBacking().moveItem(e,t)}}},{key:"moveItemDocument",value:function(e,t,a){E.default.isLocalChange(a)&&e.getDocumentOwner().getBacking().moveItemDocument(e,t)}},{key:"setNote",value:function(e,t,a,n){var r=e.getDocumentOwner();r.getBacking().setNote(r,e,t,a,n)}},{key:"generateID",value:function(){return this._idProvider()}},{key:"getEmptyDocument",value:function(){return this._emptyDocument}},{key:"addDocument",value:function(e){e.createVMLIs();var t=e.getBacking().addDocument(e);this._documentsById[e.id]=e;var a=this.documentsArray.get()[0];if(a){var n=Object(ne.a)(null,a.index);e.setIndex(n)}else e.setIndex("0");return this.documentsArray.splice(0,0,e,!1),t}},{key:"createEmptyDocument",value:function(e,t){t=t||this.getDefaultBacking();var a={id:this.generateID(),isRoot:!0,text:"Root",items:[{id:this.generateID(),text:""}]},n=N.a.create({text:e,rootData:a,backing:t});return n.createVMLIs(),n}},{key:"addEmptyDocument",value:function(e,t){var a=this.createEmptyDocument(e,t);return this.addDocument(a),a}},{key:"saveDocument",value:function(e){e.getBacking().saveDocument(e)}},{key:"renameDocument",value:function(e,t){e.setText(t),this.saveDocument(e)}},{key:"removeDocument",value:function(e){this.documentsArray.remove(e)}},{key:"moveDocument",value:function(e,t){var a=this.documentsArray.get(),n=a.map((function(e){return e.id})),r=a.indexOf(e);E.default.arrayMove(a,t,r);var i=a.map((function(e){return e.id}));if(!n.equals(i)){var o=this.documentsArray.get(),s=a.indexOf(e),l=s>=1&&o[s-1],u=s<o.length-1&&o[s+1],c=Object(ne.a)(null===l||void 0===l?void 0:l.index,null===u||void 0===u?void 0:u.index);e.setIndex(c),this.documentsArray.notify()}}},{key:"setSetting",value:function(e,t,a,n){a?this.settingProvider.setSetting(e,t,n):P.a.setSetting(e,{v:t})}},{key:"saveBoard",value:function(e,t){this.settingProvider.saveBoard(e,t)}},{key:"deleteBoard",value:function(e){return this.settingProvider.deleteBoard(e)}},{key:"getBoards",value:function(){return this.settingProvider.getBoards()}},{key:"setItem",value:function(e){this._itemCache[e.id]=e}},{key:"getItem",value:function(e){return this._itemCache[e]}},{key:"clearItem",value:function(e){delete this._itemCache[e]}},{key:"createVMLI",value:function(e,t){return C.default.itemStoreManager.getDefaultItemStore().createItemRaw(e,t)}},{key:"createTempVMLI",value:function(e,t){return t.noSave=!0,t.canDestroy=!0,t.isTemp=!0,e.id||(e.id=this.generateID()),C.default.itemStoreManager.getTempItemStore().createItemRaw(e,t)}},{key:"destroyTempVMLI",value:function(e){C.default.itemStoreManager.getTempItemStore().destroyItem(e)}},{key:"clearLocalData",value:function(){var e=s()(i.a.mark((function e(){return i.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return A.a.clear(),e.next=3,P.a.clearAllData();case 3:setTimeout((function(){E.default.reload()}),0);case 4:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"hasPendingRemoteUpdates",value:function(){return Object.keys($.a.itemsPending).length>0}},{key:"isConnected",value:function(){return"Online"===this.onlineStatus.get()}},{key:"onConnectedPromise",value:function(){var e=s()(i.a.mark((function e(){var t=this;return i.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.isConnected()?Promise.resolve():new Promise((function(e){t.onlineStatus.onValue("Online",(function(){return e()}))})));case 1:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"__clearAllData",value:function(){confirm("Are you sure you want to clear everything?")&&(A.a.clear(),Promise.all(this._sources.map((function(e){return e.clearAllData()}))).then((function(){E.default.reload()})))}},{key:"getBackingRemote",value:function(){return E.default.isDemoMode()?H:$.a}},{key:"getBackingLocal",value:function(){return X.a.supportLocalFiles()?Y:void 0}},{key:"onlineText",value:function(){var e=this.onlineStatus.get();return E.default.isDemoMode()?"DEMO":e}},{key:"setLoadProgress",value:function(e){this.loadProgress.set(e)}}]),e}(),f()(K.prototype,"onSourceLoaded",[g.a],Object.getOwnPropertyDescriptor(K.prototype,"onSourceLoaded"),K.prototype),f()(K.prototype,"onSourceDocumentsChanged",[g.a],Object.getOwnPropertyDescriptor(K.prototype,"onSourceDocumentsChanged"),K.prototype),f()(K.prototype,"clearLocalData",[g.a],Object.getOwnPropertyDescriptor(K.prototype,"clearLocalData"),K.prototype),f()(K.prototype,"__clearAllData",[g.a],Object.getOwnPropertyDescriptor(K.prototype,"__clearAllData"),K.prototype),K),ie=t.a=new re},,,,function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(3),r=a(64),i=a(54);function o(){var e=Array.from(arguments),t=Object(n.useRef)();t.current=e;var a=Object(n.useRef)(),o=a.current,l=Object(r.a)(),u=Object(n.useRef)([]),c=Object(n.useCallback)((function(){i.a.handleChange((function(){u.current.length&&l()}))}),[]);return o!==e&&s(e,a,u,c),Object(n.useEffect)((function(){return function(){var e;null===(e=u.current)||void 0===e||e.forEach((function(e){return null===e||void 0===e?void 0:e.dispose()})),u.current=[],a.current=[]}}),[]),e.map((function(e){var t,a;return null===e||void 0===e||null===(t=(a=e).get)||void 0===t?void 0:t.call(a)}))}var s=function(e,t,a,n){for(var r=0,i=a.current,o=t.current,s=Math.max(e.length,o?o.length:0),l=0;l<s;l++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=e[l];!u||o&&u===o[l]||((null===o||void 0===o?void 0:o[l])&&i[l]&&(i[l].dispose(),i[l]=void 0),u&&(i[l]=u.listen(n)))}a.current=i,t.current=e}},function(e,t,a){"use strict";var n,r=a(5),i=a.n(r),o=a(12),s=a.n(o),l=a(38),u=a.n(l),c=a(7),d=a.n(c),h=a(8),f=a.n(h),p=a(24),g=a.n(p),m=a(20),v=a.n(m),y=a(21),k=a.n(y),_=a(13),b=a.n(_),w=a(0),S=a(10),D=a.n(S),P=a(4),I=a(35),E=a(11),C=a(2),x=a(9),A=a(37),T=a(99),M=a(70),L=(n=function(){function e(){d()(this,e),this.documentsPreloaded=[],this.dataCache={settings:{},items:{},documents:{},boards:{},contacts:[],localStorage:{},user:{},pluginsNew:{}}}return f()(e,[{key:"init",value:function(e,t){this._backing=e,this.cbOnLoad=t,this.onDataReady()}},{key:"transformFieldsDocument",value:function(e){var t=w.default.clone(e);return w.default.isVMLI(t.parent)&&(t.parent=t.parent.id),delete t.items,delete t.archivedItems,delete t.deletedItems,t=A.a.documentOut(t,{forLocal:!0})}},{key:"transformFieldsItem",value:function(e){var t=w.default.clone(e);return w.default.isVMLI(t.parent)&&(t.parent=t.parent.id),delete t.items,delete t.noteItem,delete t.archivedItems,delete t.deletedItems,A.a.itemOut(t)}},{key:"getItemData",value:function(e,t){return this.dataCache.items[e]}},{key:"getDocumentData",value:function(e){return this.dataCache.documents[e]}},{key:"getSetting",value:function(e){return this.dataCache.settings[e]}},{key:"getBoards",value:function(){return this.dataCache.boards}},{key:"getBoard",value:function(e){return this.dataCache.boards[e]}},{key:"getContacts",value:function(){return this.dataCache.contacts}},{key:"saveDocument",value:function(e,t){var a=e.getSaveInfo();t&&(a=Object.assign(a,t)),w.default.deepEqual(this.dataCache.documents[e.id],a,!0,["rootData"])||(this.dataCache.documents[e.id]=a,this._saveDocumentDataToDB(A.a.documentOut(a,{forLocal:!0})))}},{key:"setSetting",value:function(e,t){this.dataCache.settings[e]=t}},{key:"saveSettings",value:function(e){Object.assign(this.dataCache.settings,e)}},{key:"saveBoard",value:function(e){this.dataCache.boards[e.id]=Object.assign(this.dataCache.boards[e.id]||{},e)}},{key:"saveContacts",value:function(e,t){this.dataCache.contacts=e}},{key:"clearContacts",value:function(){this.dataCache.contacts=[]}},{key:"cacheItem",value:function(e){this.dataCache.items[e.id]=e}},{key:"saveItem",value:function(e,t,a){t||delete e.dateModified;var n=this.dataCache.items[e.id];if(n)e.docId=e.docId||n.docId,e.docId||a&&(e.docId=a.getDocumentOwner().id),Object.assign(n,e);else if(a){var r=a.getFullSaveData(),i=a.getItems().map((function(e){return e.getFullSaveData()}));n=Object.assign(r,{items:i})}else 0;try{w.default.PAssert(72,n.id,"Saved item must have id")}catch(l){w.default.reportError(l)}try{w.default.PAssert(73,n.isDeleted||n.isRoot||n.parent,"Saved item must have parent or be root")}catch(l){w.default.reportError(l)}try{w.default.PAssert(74,n.docId,"Saved item must have docId")}catch(l){w.default.reportError(l)}if((!n.docId||!n.isRoot&&!n.parent)&&a){var o=a.getItems().map((function(e){return e.getFullSaveData()}));n=Object.assign(a.getFullSaveData(),{items:o},e);try{w.default.PAssert(75,n.isRoot||n.parent,"Saved item had root or parent overridden")}catch(l){w.default.reportError(l)}try{w.default.PAssert(76,n.docId,"Saved item had docId overridden")}catch(l){w.default.reportError(l)}}this.dataCache.items[n.id]=n;var s=this.transformFieldsItem(n);this._saveItemDataToDB(s)}},{key:"deleteItem",value:function(e){var t=this.dataCache.items[e.id];if(t){this.dataCache.items[t.id].isDeleted=!0,t.isDeleted=!0;var a=this.transformFieldsItem(t);this._saveItemDataToDB(a)}else{0,e.isDeleted=!0;var n=this.transformFieldsItem(e);this._saveItemDataToDB(n)}}},{key:"deleteBoard",value:function(e){delete this.dataCache.boards[e]}},{key:"deleteDocument",value:function(e){var t=this;e.getAllItems().forEach((function(e){delete t.dataCache.items[e.id]})),delete this.dataCache.documents[e.id]}},{key:"deleteSettings",value:function(e){var t=this;Object.keys(e).forEach((function(e){delete t.dataCache.settings[e]}))}},{key:"clearAllData",value:function(){var e=s()(i.a.mark((function e(){return i.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"ensureMirror",value:function(){var e=s()(i.a.mark((function e(t,a){var n,r,o,s,l,u,c,d,h,f,p=0,g=arguments;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:n=g.length>2&&void 0!==g[2]&&g[2],r=[],o=[],s=!this.TEST_DOC_ID,l=t.length>0&&!!t[0].id,u=0;case 7:if(!(u<t.length)){e.next=17;break}if(!(p++>5e3&&__infLoop&&__infLoop(p))){e.next=10;break}throw new RangeError;case 10:if(c=l?t[u]:t[u].value,d=l?"load":t[u].type,h=this.dataCache.items[c.id],"Removed"===d)o.push(c.id);else if(!h||!this.areObjectsEqual(c,h)){n&&!s&&console.log("THIS IS BAD, document mismatch"),f=Object.assign(h||{},c),a&&delete f.pendingSync;try{w.default.PAssert(77,f.id,"Saved item must have id")}catch(m){w.default.reportError(m)}try{w.default.PAssert(78,f.isDeleted||f.isRoot||f.parent,"Saved item must have parent or be root")}catch(m){w.default.reportError(m)}try{w.default.PAssert(79,f.docId,"Saved item must have docId")}catch(m){w.default.reportError(m)}void 0!==f.text&&f.date&&!f.text.includes(C.a.CharDate)&&delete f.date,this.dataCache.items[c.id]=f,r.push(f)}case 14:u++,e.next=7;break;case 17:return e.abrupt("return",this.bulkSave(r,o));case 18:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"areObjectsEqual",value:function(e,t){return delete(t=Object.assign({},t)).items,delete t.archivedItems,delete t.deletedItems,delete(e=Object.assign({},e)).items,delete e.archivedItems,delete e.deletedItems,e.parent===t.parent&&(delete e.parent,delete t.parent,w.default.deepEqual(e,t))}},{key:"onDataReady",value:function(){this.dataCache.settings&&P.default.settings.load(this.dataCache.settings,!1,!1),this.dataCache.contacts&&M.a.loadContacts(),this.fireLocalLoaded()}},{key:"fireLocalLoaded",value:function(){var e=this;I.a.onActiveUser((function(){try{w.default.PAssert(80,e.dataCache.documents,"Must be documents in cache at this point")}catch(i){w.default.reportError(i)}if(e.dataCache.documents){var t=w.default.objectValues(e.dataCache.documents),a=w.default.filterWithNonMatches(t,e.checkDocHasRoot);a.fail.length>0&&(console.log("Failed docs",a.fail),a.fail.forEach((function(t){delete e.dataCache.documents[t.id]})));var n=a.match.map((function(t){var a=e.dataCache.items[t.root];t.rootData=a;var n=T.a.fromData(t,e._backing);return n.createVMLIs(),n}));if(e.cbOnLoad){var r={documentsPending:e.dataCache.documentsPending,itemsPending:e.dataCache.itemsPending,settingsPending:e.dataCache.settingsPending,boardsPending:e.dataCache.boardsPending,isPreload:e.isPreload};e.cbOnLoad(n,r)}e.isPreload?e.documentsPreloaded=n:e.cbOnLoad=void 0}}))}},{key:"checkDocHasRoot",value:function(e){return!!this.dataCache.items[e.root]}},{key:"getLegacyLocalStorage",value:function(e){return this.dataCache.localStorage[e]}},{key:"setLegacyLocalStorage",value:function(e,t){this.dataCache.localStorage[e]=t}},{key:"deleteLegacyLocalStorage",value:function(e){delete this.dataCache.localStorage[e]}},{key:"getValue",value:function(e){return this.dataCache.localStorage[e]}},{key:"setValue",value:function(e,t){this.dataCache.localStorage[e]=t}},{key:"deleteValue",value:function(e){delete this.dataCache.localStorage[e]}},{key:"onPreload",value:function(e,t){if(e&&e.error){try{w.default.PAssert(81,"OpenFailedError"===e.error.name,"Unknown error in Dexie",e.error)}catch(a){w.default.reportError(a)}x.a.blockedReason&&x.a.blockedReason.set("Moo.do cannot run because it is unable to access data storage in your browser. This could be because you are in Private mode, you have disabled history, or your hard drive is full. Please try Moo.do in a normal browsing session or download the app.")}else{try{["Gmail","GmailMessages","plugins"].forEach((function(t){e[t]&&"string"===typeof e[t]&&(e[t]=JSON.parse(e[t]))}))}catch(n){}this.dataCache=e}t()}},{key:"saveEncryptionKey",value:function(e,t){}},{key:"bulkSave",value:function(){var e=s()(i.a.mark((function e(t,a){var n,r=this;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return a&&a.length>0&&a.forEach((function(e){delete r.dataCache.items[e]})),t.forEach((function(e){r.dataCache.items[e.id]=e})),n=t.map(this.transformFieldsItem),e.abrupt("return",this._bulkSaveItems(n,a));case 5:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getItemsMap",value:function(){return this.dataCache.items}},{key:"getAllPluginsNew",value:function(){return this.dataCache.pluginsNew}},{key:"savePluginNew",value:function(e){this.dataCache.pluginsNew[e.id]=e}},{key:"getPluginNew",value:function(e){return this.dataCache.pluginsNew[e]}},{key:"deletePluginNew",value:function(e){delete this.dataCache.pluginsNew[e]}},{key:"savePluginUsage",value:function(e,t){this.dataCache.plugins[e]||(this.dataCache.plugins[e]={}),this.dataCache.plugins[e][t.id]=t}},{key:"getPluginTableUsage",value:function(e){return this.dataCache.plugins[e]}},{key:"getPluginUsage",value:function(e,t){if(this.dataCache.plugins[e])return this.dataCache.plugins[e][t]}},{key:"deletePluginUsage",value:function(e,t){this.dataCache.plugins[e]&&delete this.dataCache.plugins[e][t]}},{key:"getTableData",value:function(e){return this.dataCache[e]}},{key:"getTableValue",value:function(e,t){var a=this.getTableData(e);if(a){var n=a[t];if(void 0!==n)return n}}},{key:"setTableValue",value:function(e,t,a){var n=this.getTableData(e);n&&(n[t]=a),this.tablePut(e,a)}},{key:"ensureTableLoaded",value:function(){var e=s()(i.a.mark((function e(t,a){return i.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return a(),e.abrupt("return",!0);case 2:case"end":return e.stop()}}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"beginBatch",value:function(){}},{key:"commitBatch",value:function(){}}]),e}(),D()(n.prototype,"checkDocHasRoot",[E.a],Object.getOwnPropertyDescriptor(n.prototype,"checkDocHasRoot"),n.prototype),n),O=a(101);function R(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function F(e){for(var t=0,a=1;a<arguments.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=null!=arguments[a]?arguments[a]:{};a%2?R(Object(n),!0).forEach((function(t){u()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=b()(e);if(t){var r=b()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return k()(this,a)}}var B=function(e){v()(a,e);var t=N(a);function a(){var e;return d()(this,a),(e=t.call(this)).TEST_DOC_ID="",e.canWrite=!w.default.isDemoMode(),e.clearOldDatabases(),e}return f()(a,[{key:"clearOldDatabases",value:function(){window.indexedDB&&(this.deleteDatabase("Drive"),this.deleteDatabase("GCalendar"),this.deleteDatabase("Gmail"),this.deleteDatabase("Gmail_RawCache"),this.deleteDatabase("QuickAdd"))}},{key:"deleteDatabase",value:function(e){this.canWrite&&window.indexedDB.deleteDatabase(e)}},{key:"preload",value:function(e){var t=this;if(this.canWrite){this.db=O.a.createDB();var a=window.__preload;a?a.data?this.onPreload(a.data,e):a.worker.onmessage=function(a){t.onPreload(a.data,e)}:O.a.load(this.db,(function(a){t.onPreload(a,e)}))}}},{key:"_saveItemDataToDB",value:function(e){this.canWrite&&this.db.items.put(e)}},{key:"_deleteItemData",value:function(e){this.canWrite&&this.db.items.delete(e)}},{key:"_saveDocumentDataToDB",value:function(e){this.canWrite&&this.db.documents.put(e)}},{key:"setSetting",value:function(e,t){g()(b()(a.prototype),"setSetting",this).call(this,e,t),this.canWrite&&(null!=t&&void 0!==t?this.db.settings.put(F({id:e},t)):this.db.settings.delete(e))}},{key:"deleteSettings",value:function(e){var t=this;g()(b()(a.prototype),"deleteSettings",this).call(this,e),this.canWrite&&Object.keys(e).forEach((function(e){return t.db.settings.delete(e)}))}},{key:"saveSettings",value:function(e){g()(b()(a.prototype),"saveSettings",this).call(this,e);var t=Object.keys(e).map((function(t){return F({id:t},e[t])}));this.canWrite&&this.db.settings.bulkPut(t)}},{key:"saveBoard",value:function(e){if(g()(b()(a.prototype),"saveBoard",this).call(this,e),this.canWrite){var t=A.a.boardOut(e);this.db.boards.put(t)}}},{key:"deleteBoard",value:function(e){g()(b()(a.prototype),"deleteBoard",this).call(this,e),this.canWrite&&this.db.boards.delete(e)}},{key:"deleteDocument",value:function(e){var t=this;g()(b()(a.prototype),"deleteDocument",this).call(this,e),this.canWrite&&(e.getAllItems().forEach((function(e){t.db.items.delete(e.id)})),this.db.documents.delete(e.id))}},{key:"saveContacts",value:function(e,t){if(g()(b()(a.prototype),"saveContacts",this).call(this,e,t),this.canWrite){var n=t.map((function(e){return A.a.contactOut(e)}));this.db.contacts.bulkPut(n)}}},{key:"clearContacts",value:function(){g()(b()(a.prototype),"clearContacts",this).call(this),this.canWrite&&this.db.contacts.clear()}},{key:"_bulkSaveItems",value:function(){var e=s()(i.a.mark((function e(t,a){var n;return i.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(n=[],a&&a.length>0&&n.push(this.db.items.bulkDelete(a)),t.length>0&&this.canWrite&&n.push(this.db.items.bulkPut(t)),!(n.length>0)){e.next=5;break}return e.abrupt("return",Promise.all(n));case 5:return e.abrupt("return",Promise.resolve());case 6:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getLegacyLocalStorage",value:function(e){var t=g()(b()(a.prototype),"getLegacyLocalStorage",this).call(this,e);return t||(t=localStorage.getItem(e))&&g()(b()(a.prototype),"setLegacyLocalStorage",this).call(this,e,t),t}},{key:"setLegacyLocalStorage",value:function(e,t){g()(b()(a.prototype),"setLegacyLocalStorage",this).call(this,e,t),w.default.isString(t)||(t=JSON.stringify(t)),localStorage.setItem(e,t)}},{key:"deleteLegacyLocalStorage",value:function(e){g()(b()(a.prototype),"deleteLegacyLocalStorage",this).call(this,e),localStorage.removeItem(e)}},{key:"setValue",value:function(e,t){if(this.canWrite){var n=this.getValue(e);n===t||w.default.deepEqual(n,t)||(g()(b()(a.prototype),"setValue",this).call(this,e,t),this.db.localStorage.put({id:e,value:t}))}}},{key:"clearAllData",value:function(){var e=s()(i.a.mark((function e(){return i.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.canWrite){e.next=3;break}return this.canWrite=!1,e.abrupt("return",Promise.all(this.db.tables.map((function(e){return e.clear()}))));case 3:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"deletePluginUsage",value:function(e,t){g()(b()(a.prototype),"deletePluginUsage",this).call(this,e,t),this.canWrite&&this.db.plugins.delete(t)}},{key:"savePluginUsage",value:function(e,t){g()(b()(a.prototype),"savePluginUsage",this).call(this,e,t),this.canWrite&&this.db.plugins.put(t)}},{key:"savePluginNew",value:function(e){g()(b()(a.prototype),"savePluginNew",this).call(this,e),this.canWrite&&this.db.pluginsNew.put(e)}},{key:"deletePluginNew",value:function(e){g()(b()(a.prototype),"deletePluginNew",this).call(this,e),this.canWrite&&this.db.pluginsNew.delete(e)}},{key:"tablePut",value:function(e,t){if(this.canWrite)return this.db[e].put(t)}},{key:"tableClear",value:function(e){if(this.canWrite)return this.db[e].clear()}},{key:"tableFilter",value:function(e,t){if(this.canWrite)return this.db[e].filter(t).toArray()}},{key:"tableGet",value:function(e,t){if(this.canWrite)return this.db[e].get(t)}},{key:"tableDelete",value:function(e,t){if(this.canWrite)return this.db[e].delete(t)}}]),a}(L);t.a=new B},,function(e,t,a){"use strict";var n,r=a(7),i=a.n(r),o=a(8),s=a.n(o),l=a(10),u=a.n(l),c=a(11),d=a(129),h=a.n(d),f=a(2),p=(a(50),a(0)),g=a(30),m=a(4),v=a(59),y=a(27),k=a(15),_=/(Mo|Di|Mi|Do|Fr|Sa|So), \d/,b={Mo:"Mon",Di:"Tue",Mi:"Wed",Do:"Thu",Fr:"Fri",Sa:"Sat",So:"Sun"},w=(n=function(){function e(){i()(this,e),this.todayObs=new k.a(this.today),this.resetToday(),y.a.listen("beforeDateChanged",this.resetToday)}return s()(e,[{key:"parseDate",value:function(e){return new Date(e)}},{key:"parseText",value:function(e){var t,a=(e=e.toLowerCase()).substring(e.indexOf("every")),n=e.includes("every")&&g.b.parseText(a,void 0);if(n){try{p.default.PAssert(364,!(n.options.interval<0),"Interval set to negative",e)}catch(w){p.default.reportError(w)}var r=n.options,i=n.fromDate,o=n.duration;i||(i=new Date,i=this.toUTCDate(i));var s=Object.assign({dtstart:i},r);delete s.interval;var l=new g.b(s).after(i,!0);if(l){l=this.UTCtoLocal(l);var u=r.byhour?r.byhour[0]:0,c=r.byminute?r.byminute[0]:0;l.setHours(u),l.setMinutes(c),l.setSeconds(0),l.setMilliseconds(0),l=new Date(this.toUTCDate(l).getTime()),r.dtstart=l,r.until&&(r.until=new Date(l.getTime()+r.until.getTime()-i.getTime())),t=v.a.fromRRuleOptions(r,o?o*f.a.MSPerMinute:void 0)}}else{var d=e.replace(/\./g,"/"),y=h.a.parse(d,void 0,{forwardDate:!0})[0];if(y){var k=m.default.International.parseDate(y.text,m.default.settings.dateFormat.get());if(k){var _,b=e.substring(y.index+y.text.length).trim().match(g.f.tokens.duration);b&&(_=Math.round(+b[1]*("h"===b[2][0]?f.a.MSPerHour:f.a.MSPerMinute))),t=new v.a(k,{duration:_})}}}return t}},{key:"toUTCDate",value:function(e){return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()))}},{key:"UTCtoLocal",value:function(e){return new Date(e.getTime()+e.getTimezoneOffset()*f.a.MSPerMinute)}},{key:"toHumanText",value:function(e,t){if(!e)return"";var a=+this.clearTime(e)-this.todayTime,n="";return t||(a<0&&a>=-864e5?n="Yesterday":this.isToday(e)?n="Today":a>0&&a<1728e5&&(n="Tomorrow")),n||(n=this.getHumanText(e)),e.hasTimeOfDay()&&(n+=" "+this.getTimeText(e)),n}},{key:"resetToday",value:function(){this.today=Date.today(),this.todayTime=this.today.getTime(),this.datesCleared={},this.humanText={},this.timeText={},this.todayObs.set(this.today)}},{key:"getToday",value:function(){return this.today}},{key:"getTodayTime",value:function(){return this.todayTime}},{key:"isToday",value:function(e){try{p.default.PAssert(365,e&&p.default.isDateValid(e),"Date is invalid",e)}catch(a){p.default.reportError(a)}var t=+e;return t>=this.todayTime&&t<this.todayTime+f.a.MSPerDay}},{key:"_clearTime",value:function(e){return this.datesCleared[e]=new Date(e),this.datesCleared[e].setHours(0,0,0,0),this.datesCleared[e]}},{key:"clearTime",value:function(e){var t=+e;return this.datesCleared[t]||this._clearTime(t)}},{key:"clearTimeClone",value:function(e){return this.clearTime(e).clone()}},{key:"getTodayPlusDays",value:function(e){return this.getDatePlusDays(this.getToday(),e)}},{key:"getDatePlusDays",value:function(e,t){var a=+e+t*f.a.MSPerDay;return this.datesCleared[a]||(this.datesCleared[a]=new Date(a))}},{key:"getDatePlusMS",value:function(e,t){return new Date(+e+t)}},{key:"getTodayPlusMS",value:function(e){return this.getDatePlusMS(this.getToday(),e)}},{key:"isSameDay",value:function(e,t){return+this.clearTime(e)===+this.clearTime(t)}},{key:"getHumanText",value:function(e){var t=+e;return this.humanText[t]||(this.humanText[t]=e.toString(m.default.International.getFormat(e.getFullYear()!==this.today.getFullYear()?f.a.DFormat.MonthDayYear:f.a.DFormat.MonthDay))),this.humanText[t]}},{key:"getTimeText",value:function(e){var t=+e;return this.timeText[t]||(this.timeText[t]=e.toString("h:mmtt").toLowerCase())}},{key:"getNextRoundTime",value:function(e){var t=(null===e||void 0===e?void 0:e.clone())||new Date;return t.setHours(t.getHours()+1,0,0,0),t}},{key:"parseInternationalDate",value:function(e){if(e){var t=e.match(_);if(t){var a=t[1],n=b[a];n&&(e=e.replace(a,n).replace("-","/"))}}return h.a.parseDate(e)}},{key:"testGetNext",value:function(e,t,a){}},{key:"testOnDate",value:function(e,t,a){}}]),e}(),u()(n.prototype,"resetToday",[c.a],Object.getOwnPropertyDescriptor(n.prototype,"resetToday"),n.prototype),u()(n.prototype,"_clearTime",[c.a],Object.getOwnPropertyDescriptor(n.prototype,"_clearTime"),n.prototype),n);t.a=new w},function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(20),l=a.n(s),u=a(21),c=a.n(u),d=a(13),h=a.n(d),f=function(){function e(){r()(this,e),this.storage={getItem:function(){console.log("refactor this")},setItem:function(){console.log("refactor this")}}}return o()(e,[{key:"extendPrototype",value:function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e.prototype[a]=t[a])}},{key:"extendClass",value:function(e,t,a){for(var n=0,r=Object.getOwnPropertyNames(t.prototype),i=0;i<r.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=r[i];a&&e[o]||(e.prototype[o]=t.prototype[o])}}},{key:"defineBase",value:function(e){e.prototype.constructor=e}},{key:"extend",value:function(e,t,a,n){if(t)for(var r in t)if(t.hasOwnProperty(r)&&(!n||!e[r])){var i=t[r],o=a&&i&&i.bind?i.bind(e):i;e[r]=o}return e}},{key:"inherit",value:function(e,t){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._super=e.prototype}},{key:"binder",value:function(e){var t=0;for(var a=0;a<(arguments.length<=1?0:arguments.length-1);a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=a+1<1||arguments.length<=a+1?void 0:arguments[a+1];e[n]=e[n].bind(e)}}},{key:"forceBind",value:function(e,t){var a=t[e].bind(t);return t[e]=a,a}}]),e}();function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=h()(e);if(t){var r=h()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return c()(this,a)}}var g=a(2).a.URLPart;function m(e,t){e===g.Search?window.location.search=t:e===g.Hash&&(window.location.hash=t)}function v(e){return e===g.Search?window.location.search:e===g.Hash?window.location.hash:void 0}function y(e){return"state"===e?g.Search:g.Hash}var k=function(e){l()(n,e);var t=p(n);function n(){return r()(this,n),t.call(this)}return o()(n,[{key:"hasURLParam",value:function(e,t){var a=e+"=";return t&&(a+=t),v(y(e)).indexOf(a)>=0}},{key:"getURLParam",value:function(e,t){var n=t||y(e);if(n===g.Search){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var r=new RegExp('[\\?&]" + key + "=([^&#]*)').exec(window.location.href);return null===r?void 0:decodeURIComponent(r[1].replace(/\+/g," "))}if(n!==g.Hash)a(0).default.log("Invalid URL part");else for(var i,o=0,s=v(g.Hash).substring(1),l=/([^&=]+)=([^&]*)/g;i=l.exec(s);){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(decodeURIComponent(i[1])===e)return decodeURIComponent(i[2])}}},{key:"insertURLParam",value:function(e,t,a){var n=0;e=encodeURIComponent(e),t=encodeURIComponent(t);var r,i=y(e),o=v(i).substr(1).split("&");for(r=o.length-1;r>=0;r--){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=o[r].split("=");if(s[0]==e){s[1]=t,o[r]=s.join("=");break}}r<0&&(o[o.length]=[e,t].join("=")),m(i,o.join("&")),i!==g.Hash||a||window.location.reload()}},{key:"removeURLParam",value:function(e,t){for(var a=0,n=y(e=encodeURIComponent(e)),r=v(n).substr(1).split("&"),i=r.length-1;i>=0;i--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(r[i].split("=")[0]==e){r.splice(i,1),m(n,r.join("&")),n!==g.Hash||t||window.location.reload();break}}}}]),n}(f);t.a=new k},function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(20),o=a.n(i),s=a(21),l=a.n(s),u=a(13),c=a.n(u);function d(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=c()(e);if(t){var r=c()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return l()(this,a)}}var h=function(e){o()(a,e);var t=d(a);function a(){return r()(this,a),t.apply(this,arguments)}return a}(a(93).a);t.a=new h},,function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(20),l=a.n(s),u=a(21),c=a.n(u),d=a(13),h=a.n(d),f=a(0),p=a(2),g=a(4),m=a(3),v=a.n(m),y=a(97),k=a(45),_=a(146),b=a(79);function w(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=h()(e);if(t){var r=h()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return c()(this,a)}}var S=function(e){f.default.preventAndStop(e)},D=function(e){l()(a,e);var t=w(a);function a(){return r()(this,a),t.apply(this,arguments)}return o()(a,[{key:"init",value:function(){this.createObservables({isLoading:!1})}},{key:"getElement",value:function(){return y.findDOMNode(this)}},{key:"onClick",value:function(e){this.isLoading.get()||!1===this.props.enabled||(this.props.onClick||this.props.onMouseDown)(e,this.onButtonClickCallback)&&this.isLoading.set(!0)}},{key:"onMouseDown",value:function(e){if(!1!==this.props.enabled&&e.button===p.a.ButtonCode.Left&&this.props.onHold){var t={target:e.target,preventDefault:e.preventDefault};this._holdTimeout=setTimeout(this.onHold,150,t)}}},{key:"onMouseUp",value:function(e){this._clearHoldTimeout(),this.props.onMouseUp&&this.props.onMouseUp(e)}},{key:"onHold",value:function(e){this._clearHoldTimeout(),this.props.onHold(e)}},{key:"_clearHoldTimeout",value:function(){this._holdTimeout&&(clearTimeout(this._holdTimeout),this._holdTimeout=0)}},{key:"onKeyDown",value:function(e){e.keyCode===p.a.KeyCode.Enter&&this.onClick(e)}},{key:"focus",value:function(){this.getElement().focus()}},{key:"onButtonClickCallback",value:function(){this.isLoading.set(!1)}},{key:"removeRipple",value:function(){this.ripples.removeAt(0)}},{key:"render",value:function(){var e,t,a,n=this.state,r=this.props,i=!1===r.enabled,o=0===(null===(e=r.color)||void 0===e?void 0:e.indexOf("#"));r.color&&!o?a=r.color:r.primary?a=r.raised?"c-button-raised-primary":"c-button-primary":r.heavy?r.raised||(a="c-button-heavy"):a=r.cancel?r.raised?"c-button-raised-cancel":"c-button-cancel":r.raised?"c-button-raised":"c-button";var s={display:r.display,lineHeight:r.height?"auto"===r.height?null:r.height+"px":"36px",height:r.height,width:r.width,minWidth:r.width,textAlign:null!==(t=r.textAlign)&&void 0!==t?t:"center",margin:r.margin,paddingLeft:r.paddingLeft,paddingTop:r.paddingTop,paddingRight:r.paddingRight,paddingBottom:r.paddingBottom,fontWeight:r.fontWeight,fontSize:r.fontSize,color:r.color};void 0===r.margin&&(s.marginLeft=r.marginLeft,s.marginTop=r.marginTop,s.marginRight=r.marginRight,s.marginBottom=r.marginBottom),s=f.default.extend(s,this.props.style),r.raised&&!r.children&&r.icon&&!1!==r.round&&(s.borderRadius="50%");var l,u={fontSize:r.fontSize};if(r.icon){var c={height:r.height,fontSize:r.iconSize,color:r.color},d=f.default.classNames("fancyButtonIcon",r.icon,{"c-button":!!r.color});r.children?0!==r.padding&&(u.paddingLeft="6px",u.paddingRight=0,s.paddingLeft="16px",s.paddingRight="16px"):(s.width=r.width||36,s.height=r.height||36,s.maxWidth=r.width||36,s.maxHeight=r.height||36,s.textAlign="center"),l=v.a.createElement("i",{className:d,style:c})}isNaN(r.padding)||(u.padding="0 "+r.padding+"px"),r.paddingText&&(u.paddingLeft=r.paddingText);var h=r.children&&v.a.Children.count(r.children)>0,p=f.default.classNames("fancyButtonText align-middle"),m=h&&v.a.createElement("div",{className:p,style:u},r.children),y=f.default.classNames("fancyButton",a,{raised:r.raised},{loading:n.isLoading},{primary:r.primary},{cancel:r.cancel},{hasText:h},{hasIcon:!!r.icon||!!r.iconComponent},{disabled:i},{selected:r.selected},r.className),k=n.isLoading&&v.a.createElement(b.a,{center:!0,color:"#fff",size:6}),w=r.tooltipHotkey,D=w?f.default.isString(w)?w:g.default.hotkeys.printHotkeyByName(w.name,w.group):void 0;return v.a.createElement(_.a,{className:y,style:s,enabled:r.enabled,onPointerDown:r.preventDefaultOnMobileDown?S:void 0,onMouseEnter:r.onMouseEnter,onMouseLeave:r.onMouseLeave,onMouseDown:r.onMouseDown&&this.onClick||r.onHold&&this.onMouseDown||void 0,onMouseUp:r.onHold||r.onMouseUp?this.onMouseUp:void 0,onClick:r.onClick?this.onClick:void 0,onDoubleClick:r.onDoubleClick,onRightClick:r.onRightClick,onKeyDown:this.onKeyDown,id:r.id,center:r.center||(!!r.icon||!!r.iconComponent)&&!h,ripple:r.ripple,tabIndex:r.tabIndex,"data-tooltip":!i&&r.tooltip?r.tooltip:null,"data-tooltiphotkey":i?null:D},l,r.iconComponent&&v.a.createElement(r.iconComponent,{size:r.iconSize,style:{height:s.lineHeight}}),m,k)}}]),a}(k.a);t.a=D},,function(e,t,a){"use strict";var n,r=a(7),i=a.n(r),o=a(8),s=a.n(o),l=a(20),u=a.n(l),c=a(21),d=a.n(c),h=a(13),f=a.n(h),p=a(10),g=a.n(p),m=a(11),v=a(2),y=a(0),k=a(4),_=a(93),b=a(15),w=a(42);function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=f()(e);if(t){var r=f()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return d()(this,a)}}var D=(n=function(e){u()(a,e);var t=S(a);function a(){var e;return i()(this,a),(e=t.call(this)).selected={},e.numSelected=new b.a(0),e._queueRemoveEditables=[],e}return s()(a,[{key:"_selectedObjForPane",value:function(e){try{y.default.PAssert(411,e,"Multiselect should always pass in a pane")}catch(a){y.default.reportError(a)}e=e||y.default.focusedPane;var t=this.selected[e.id];return t||(t=this.selected[e.id]={arr:new w.a,isInverted:!1}),t}},{key:"getSelectedForPaneObs",value:function(e){return this._selectedObjForPane(e).arr}},{key:"_selectedForPane",value:function(e){return this._selectedObjForPane(e).arr.get()}},{key:"onChanged",value:function(e){this.numSelected.set(this.numSelectedInPane(e))}},{key:"isInverted",value:function(e){return this._selectedObjForPane(e).isInverted}},{key:"setInverted",value:function(e,t){this._selectedObjForPane(t).isInverted=e}},{key:"isSelected",value:function(e,t){return this._selectedForPane(t).indexOf(e)>=0}},{key:"hasSelection",value:function(e){return this._selectedForPane(e).length>0}},{key:"getSelected",value:function(e){return this._selectedForPane(e)}},{key:"getSelectedItems",value:function(e,t){return this.getSelectedObjects(e,t).map((function(e){return e.item}))}},{key:"getSelectedObjects",value:function(e,t){for(var a=0,n=this._selectedForPane(e),r=[],i=0;i<n.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=n[i];if(e.numItems()>o)if(e.usesVMLIs){var s=e.objectAtIndex(o),l=s.item;!l||!t&&l.isNote()||r.push(s)}else{var u=e.itemsSimple.get()[o];u.item&&r.push(u)}}return r}},{key:"numSelectedInPane",value:function(e){for(var t=0,a=0,n=this._selectedForPane(e),r=0;r<n.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=e.itemAtIndex(n[r]);!i||i.isNote&&i.isNote()||a++}return a}},{key:"getFirstSelectedIndex",value:function(e){var t=0;e=e||y.default.focusedPane;for(var a=this._selectedForPane(e),n=Number.MAX_VALUE,r=!1,i=0;i<a.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=a[i];o<n&&(n=o,r=!0)}return r?n:-1}},{key:"getFirstSelectedItem",value:function(e){e=e||y.default.focusedPane;var t=this.getFirstSelectedIndex(e);if(t>=0)return e.itemAtIndex(t)}},{key:"getLastSelectedIndex",value:function(e){var t=0;e=e||y.default.focusedPane;for(var a=this._selectedForPane(e),n=-1,r=0;r<a.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=a[r];i>n&&(n=i)}return n}},{key:"getLastSelectedItem",value:function(e){e=e||y.default.focusedPane;var t=this.getLastSelectedIndex(e);if(t>=0)return e.itemAtIndex(t)}},{key:"_resetPaneID",value:function(e){var t=k.default.PaneManager,a=!0;if(t.isPaneActive(e)){var n=t.getPaneById(e);n.canResetMultiselect()?(this.setSelected([],n),this.selected[e].isInverted=!1):a=!1}else delete this.selected[e];return a}},{key:"reset",value:function(e){var t=!0;if(e)e.canResetMultiselect()?this._resetPaneID(e.id):t=!1;else for(var a in this.selected)this.selected.hasOwnProperty(a)&&(t=t&&this._resetPaneID(a));t&&this.fireEvent("reset",[e])}},{key:"setSelected",value:function(e,t,a){var n=0;t=t||y.default.focusedPane;var r=this._selectedForPane(t),i=y.default.arrayDiff(r,e);this.setInverted(!1,t),this.getSelectedForPaneObs(t).set(e);for(var o=0;o<i.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=i[o];if(s<t.numItems()){var l=t.itemAtIndex(s);if(l)l.itemChanged.notify()}}}},{key:"toggleSelected",value:function(e,t,a){t=t||y.default.focusedPane;var n=this.getSelectedForPaneObs(t),r=n.indexOf(e);r>=0&&!0!==a?n.remove(e):r<0&&!1!==a&&n.push(e);var i=t.itemAtIndex(e);i&&i.itemChanged.notify()}},{key:"addSelected",value:function(e,t){this.toggleSelected(e,t,!0)}},{key:"removeSelected",value:function(e,t){this.toggleSelected(e,t,!1)}},{key:"selectInOrder",value:function(e,t,a){var n=0;a=a||y.default.focusedPane;for(var r=[],i=e;i<=t;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r.push(i)}this.setSelected(r,a)}},{key:"forEach",value:function(e,t){var a=0;k.default.PaneUpdateBatcher.beginUpdateItems(),e=e||y.default.focusedPane;for(var n,r=this.getSelectedObjects(e),i=r.map((function(e){return e.item})),o=0;o<r.length&&!1!==n;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=r[o];n=t(s.item,o,r.length,s,i)}k.default.PaneUpdateBatcher.commitUpdateItems()}},{key:"map",value:function(e,t){var a=this.getSelectedItems(e);return a.map((function(e,n){return t(e,n,a.length)}))}},{key:"setSelectedNew",value:function(e,t){this.setInverted(!1,t),this.getSelectedForPaneObs(t).set(e)}},{key:"onClick",value:function(e,t,a){if(a.shiftKey){var n=this.getFirstSelectedIndex(t),r=this.getLastSelectedIndex(t);e<n?n=e:e>r&&(r=e),this.selectInOrder(n,r,t)}else this.setSelectedNew([e],t)}},{key:"onKeyDown",value:function(e,t){var a,n=Math.max(this.getFirstSelectedIndex(e),0),r=Math.max(this.getLastSelectedIndex(e),0);t.keyCode===v.a.KeyCode.ArrowUp?a=Math.max(0,n-1):t.keyCode===v.a.KeyCode.ArrowDown&&(a=Math.min(r+1,e.numItems()-1)),t.shiftKey?(this.isInverted(e)&&1===this.numSelectedInPane(e)&&this.setInverted(!1,e),this.isInverted(e)?(a=this.getFirstSelectedIndex(e),this.removeSelected(a,e)):a>=0&&a<e.numItems()&&(this.addSelected(a,e),e.scrollIndexIntoView(a))):a>=0&&this.setSelectedNew([a],e)}}]),a}(_.a),g()(n.prototype,"reset",[m.a],Object.getOwnPropertyDescriptor(n.prototype,"reset"),n.prototype),n);t.a=new D},function(e,t,a){"use strict";var n=a(49);a.d(t,"b",(function(){return n.a}));var r=a(74);a.d(t,"a",(function(){return r.a}));var i=a(143);a.d(t,"c",(function(){return i.a}))},function(e,t,a){"use strict";a.r(t);var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(0),l=a(9),u=function(){function e(t){r()(this,e),this._range=t,this._range||(this._range=a(33).default.getSelectionRangeNative())}return o()(e,[{key:"isValid",value:function(){return!!this._range}},{key:"getNativeRange",value:function(){return this._range}},{key:"getStartContainer",value:function(){return this._range.startContainer}},{key:"getEndContainer",value:function(){return this._range.endContainer}},{key:"getStartElement",value:function(){return s.default.getElementParent(this.getStartContainer())}},{key:"getEndElement",value:function(){return s.default.getElementParent(this.getEndContainer())}},{key:"getSelectOffsetsInElement",value:function(e){return a(33).default.getSelectOffsetsInElement(e,this._range)}},{key:"getStartOffset",value:function(){return this._range.startOffset}},{key:"getEndOffset",value:function(){return this._range.endOffset}},{key:"getBoundingClientRect",value:function(){return this._range.getBoundingClientRect()}}]),e}(),c=a(2),d=function(){function e(){r()(this,e)}return o()(e,[{key:"createFakeRange",value:function(e,t,a,n){try{var r=this.createSelectionRange();return r.setStart(e,t),r.setEnd(a,n),new u(r)}catch(i){s.default.reportError(i)}}},{key:"createSelectionRange",value:function(){return document.createRange()}},{key:"setSelection",value:function(e,t,a,n){if("TEXTAREA"===e.nodeName){try{s.default.PAssert(383,e===a,"Cannot multiselect textareas")}catch(i){s.default.reportError(i)}e.focus(),e.selectionStart=t,e.selectionEnd=n}else{var r=this.createSelectionRange();this.setSelectionValues(r,e,t,a,n),this.setSelectionRange(r)}}},{key:"setSelectionRange",value:function(e){var t=window.getSelection();s.default.shouldLog(c.a.LogLevels.Selection)&&s.default.log("Set Selection to Range",e),t.removeAllRanges(),e instanceof u&&(e=e.getNativeRange()),t.addRange(e)}},{key:"insertNode",value:function(e){var t=this.getSelectionRangeNative();t&&t.insertNode(e)}},{key:"selectAfterNode",value:function(e){var t=document.createRange();t.setStartAfter(e),this.setSelectionRange(t)}},{key:"setSelectionRangeToWhatItAlreadyIs",value:function(){var e=this.getSelectionRangeNative();s.default.shouldLog(c.a.LogLevels.Selection)&&s.default.log("Set Selection to Same",e),e&&this.setSelectionRange(e)}},{key:"hasValidSelection",value:function(){return this.getSelectionRange(!0).isValid()}},{key:"getSelectionRange",value:function(e){var t;return e&&(t=this.getSelectionRangeNative()),new u(t)}},{key:"getSelectionRangeNative",value:function(){var e,t=window.getSelection();return t.rangeCount>0&&(e=t.getRangeAt(0)),e}},{key:"getSelectionNode",value:function(){var e=window.getSelection().anchorNode;if(e)return e.nodeType===Node.TEXT_NODE?e.parentNode:e}},{key:"getSelectedText",value:function(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!==document.selection.type?document.selection.createRange().text:void 0}},{key:"clearSelection",value:function(){var e=window.getSelection();s.default.shouldLog(c.a.LogLevels.Selection)&&s.default.log("Clear Selection"),e.removeAllRanges()}},{key:"getCursorSelectionRange",value:function(e){var t,a=e.target,n=s.default.ensureDOMNode(e.target);if(n){var r=s.default.getElementParent(a),i=0,o=s.default.getPaneObjectForElement(a);try{s.default.PAssert(384,r,"getCursorSelectionRange must only be called when hovered item is item",n)}catch(h){s.default.reportError(h)}o&&(n=s.default.findChild(r,"itemInPaneText"),i=0);var l=n.getBoundingClientRect(),c=s.default.clamp(e.clientY,l.top+9,l.bottom-9),d=s.default.clamp(e.clientX,l.left+i,l.right-1);t=this._getCursorSelectionRange(d,c)}return t?new u(t):void 0}},{key:"_safari_caretRangeFromPoint",value:function(e,t,a){var n=0;var r=function(a){var n=a.getClientRects()[0];return n&&t>=n.top&&t<=n.bottom?Math.abs(e-(n.left+n.width/2)):1e5},i=function e(t,a,n){var r=0,i=[];for(t=t.firstChild;t;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;3==t.nodeType&&i.push(t),1==t.nodeType&&(i=i.concat(e(t,a,n))),t=t.nextSibling}return i}(document.elementFromPoint(e,t),e,t);if(!i.length)return null;var o=i[0],s=document.createRange();s.setStart(o,0),s.setEnd(o,1);for(var l={range:void 0,distance:1e5},u=0;u<i.length;u++){var c=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var d=(o=i[u]).nodeValue,h=0;h<=d.length;h++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;(s=document.createRange()).setStart(o,h),s.setEnd(o,h);var f=r(s);f<l.distance&&(l={range:s,distance:f})}}return l.range}},{key:"_getCursorSelectionRange",value:function(e,t){var a;if(l.a.safari)a=this._safari_caretRangeFromPoint(e,t);else if(document.caretRangeFromPoint)a=document.caretRangeFromPoint(e,t);else if(document.caretPositionFromPoint){var n=document.caretPositionFromPoint(e,t);n&&((a=document.createRange()).setStart(n.offsetNode,n.offset),a.setEnd(n.offsetNode,n.offset))}else if(document.body.createTextRange){var r=this.getSelectionRangeNative(),i=document.body.createTextRange();try{i.moveToPoint(e,t),i.select(),a=this.getSelectionRangeNative(),this.setSelectionRange(r)}catch(o){}}else try{s.default.PAssert(385,!1,"Unable to get selection range at cursor")}catch(u){s.default.reportError(u)}return a}},{key:"_getPreviousComponentNode",value:function(e){var t=e.previousSibling;return t&&!this._isComponentNode(t)&&1===t.childNodes.length&&this._isComponentNode(t.childNodes[0])&&(t=t.childNodes[0]),t}},{key:"_ensureSelectionInElement",value:function(e,t){try{s.default.PAssert(386,e,"Must have a valid element")}catch(r){s.default.reportError(r)}try{s.default.PAssert(387,t,"Must have a valid range")}catch(r){s.default.reportError(r)}if(s.default.isAncestor(t.startContainer,e)||t.setStart(e,0),s.default.isAncestor(t.endContainer,e)||t.setEnd(e,0),s.default.findParent(t.startContainer,"itemIgnoreText",2)){var a=this._getPreviousComponentNode(t.startContainer);a&&t.setStart(a,a.textContent.length)}if(s.default.findParent(t.endContainer,"itemIgnoreText",2)){var n=this._getPreviousComponentNode(t.endContainer);n&&t.setEnd(n,n.textContent.length)}}},{key:"getSelectOffsetsInElement",value:function(e,t){var a={start:0,end:0,total:0};if("TEXTAREA"===e.nodeName){a.start=e.selectionStart,a.end=e.selectionEnd,a.total=e.value.length;var n=e.value.indexOf("\n");n>=0&&a.start>n&&(a.start--,a.end--,a.total--)}else if(e){try{s.default.PAssert(388,t,"Must provide a valid range")}catch(m){s.default.reportError(m)}if(t){this._ensureSelectionInElement(e,t);var r=this._getComponentNodeInfo(t.startContainer,t.startOffset),i=r.node,o=r.offset,l=this._getComponentNodeInfo(t.endContainer,t.endOffset),u=l.node,d=l.offset;!i||i.textContent!==c.a.TextSpace&&0!==i.textContent.length||(o=0),!u||u.textContent!==c.a.TextSpace&&0!==u.textContent.length||(d=0);var h=0,f=this._getComponentNodesIn(e);if(f.length>0)for(var p=0,g=0;g<f.length;++g){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;f[g]===i&&(a.start=h+o),f[g]===u&&(a.end=h+d),h+=this._getComponentNodeLength(f[g]),void 0===u&&(g===d-1?a.end=h:0===g&&0===d&&(a.end=0)),void 0===i&&(g===o-1?a.start=h:0===g&&0===o&&(a.start=0))}else a.start=0,a.end=0;a.total=h,isNaN(a.end)&&(a.end=h),a.start>a.total&&(a.start=a.total),a.end>a.total&&(a.end=a.total)}}try{s.default.PAssert(389,!isNaN(a.start)&&!isNaN(a.end),"Must have valid start and end",a)}catch(m){s.default.reportError(m)}return a}},{key:"getSelectOffsetsForMouseEvent",value:function(e){var t=s.default.getElementParent(e.target),a=this.getCursorSelectionRange(e);return a&&a.getSelectOffsetsInElement(t)}},{key:"getOffsetChildElement",value:function(e,t){try{s.default.PAssert(390,e,"Must supply a valid element")}catch(l){s.default.reportError(l)}if("TEXTAREA"===e.nodeName)return{element:e,offset:t};if(this._isComponentNode(e)){try{s.default.PAssert(392,this._isComponentSelectable(e),"Component must be selectable")}catch(l){s.default.reportError(l)}return{element:e,offset:t}}for(var a=0,n=0,r=this._getComponentNodesIn(e),i=0;i<r.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this._getComponentNodeLength(r[i]);if(n+o>=t)return{element:r[i],offset:t-n};n+=o}try{s.default.PAssert(391,0===t,"Unable to find offset child element")}catch(l){s.default.reportError(l)}return{element:e,offset:t}}},{key:"getChildNodeOffset",value:function(e,t){var a=0;try{s.default.PAssert(393,e,"Must supply a valid child element")}catch(l){s.default.reportError(l)}for(var n=0,r=this._getComponentNodesIn(s.default.getElementParent(e),t),i=this._getComponentNodesIn(e,t),o=0;o<r.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(r[o]===i[0])break;n+=this._getComponentNodeLength(r[o])}return n}},{key:"_getComponentNodeLength",value:function(e){try{s.default.PAssert(394,this._isComponentNode(e),"Supplied node must be a valid component")}catch(t){s.default.reportError(t)}return s.default.hasClass(e,"mdImageWrapper")||1===e.length&&e.textContent===c.a.TextSpace?0:"svg"===e.nodeName?1:e.textContent.replace(c.a.TextSpace,"").length}},{key:"_getComponentNodesIn",value:function(e,t){if(this._isComponentNode(e,t))return[e];var a=[];return this._getComponentNodes(a,e,t),a}},{key:"_isComponentNode",value:function(e,t){var a=!1;return!e||s.default.findParent(e,"itemIgnoreText",2)||t&&s.default.findParent(e,"prefixNew",2)||(e.nodeType===Node.TEXT_NODE||"svg"===e.nodeName||s.default.hasClass(e,"mdImageWrapper"))&&(a=!0),a}},{key:"_isComponentSelectable",value:function(e){try{s.default.PAssert(395,!e||this._isComponentNode(e),"Must either be an invalid node (not-selectable) or a component")}catch(a){s.default.reportError(a)}var t=!1;return e&&e.nodeType===Node.TEXT_NODE&&(t=!0),t}},{key:"_getComponentNodes",value:function(e,t,a){if(t)if(this._isComponentNode(t,a))e.push(t);else if(!s.default.hasClass(t,"itemTime")&&t.childNodes)for(var n=0,r=0;r<t.childNodes.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=t.childNodes[r];this._getComponentNodes(e,i,a)}}},{key:"_getComponentNodeInfo",value:function(e,t){if(this._isComponentNode(e))return{node:e,offset:t};var a,n=e.firstChild;return n&&(n.nodeType===Node.TEXT_NODE&&1===t&&(t=n.textContent.length),a=this._getComponentNodeInfo(n,t)),a||{node:e,offset:t}}},{key:"setSelectionValues",value:function(e,t,a,n,r){try{s.default.PAssert(396,e,"Range must be supplied")}catch(i){s.default.reportError(i)}try{s.default.PAssert(397,this._isComponentNode(t),"Must be selecting a valid component")}catch(i){s.default.reportError(i)}try{s.default.PAssert(398,this._isComponentNode(n),"Must be selecting a valid component")}catch(i){s.default.reportError(i)}try{s.default.PAssert(399,t!==n||a<=r,"Select elements must be different, or selection must start before it ends")}catch(i){s.default.reportError(i)}if(t.nodeType===Node.TEXT_NODE)e.setStart(t,a);else{try{s.default.PAssert(400,s.default.hasClass(t,"plugin"),"Only other valid component is plugin")}catch(i){s.default.reportError(i)}try{s.default.PAssert(401,0===a||1===a,"Must eiter be selecting before or after the plugin")}catch(i){s.default.reportError(i)}0===a?this._selectBeforeComponent(e,t,"setStart"):1===a&&this._selectAfterComponent(e,t,"setStart")}if(n.nodeType===Node.TEXT_NODE)e.setEnd(n,r);else{try{s.default.PAssert(402,s.default.hasClass(n,"plugin"),"Only other valid component is plugin")}catch(i){s.default.reportError(i)}try{s.default.PAssert(403,0===r||1===r,"Must eiter be selecting before or after the plugin")}catch(i){s.default.reportError(i)}0===r?this._selectBeforeComponent(e,n,"setEnd"):1===r&&this._selectAfterComponent(e,n,"setEnd")}s.default.shouldLog(c.a.LogLevels.Selection)&&s.default.log("Set Selection: ["+a+","+r+"] - [",t+","+n+"]")}},{key:"_selectBeforeComponent",value:function(e,t,a){var n=this._getPrevComponent(t);if(this._isComponentSelectable(n))e[a](n,this._getComponentNodeLength(n));else{var r=document.createTextNode("");t.parentNode.insertBefore(r,t),e[a](r,0)}}},{key:"_selectAfterComponent",value:function(e,t,a){var n=this._getNextComponent(t);if(this._isComponentSelectable(n))e[a](n,0);else{var r=document.createTextNode("");t.parentNode.insertBefore(r,void 0),e[a](r,0)}}},{key:"_getPrevComponent",value:function(e){try{s.default.PAssert(404,e,"Must supply a valid node")}catch(a){s.default.reportError(a)}try{s.default.PAssert(405,this._isComponentNode(e),"Supplied node must be a valid component itself")}catch(a){s.default.reportError(a)}var t=e.previousSibling;try{s.default.PAssert(406,!t||this._isComponentNode(t),"Siblings must always be valid components")}catch(a){s.default.reportError(a)}return t}},{key:"_getNextComponent",value:function(e){try{s.default.PAssert(407,e,"Must supply a valid node")}catch(a){s.default.reportError(a)}try{s.default.PAssert(408,this._isComponentNode(e),"Supplied node must be a valid component itself")}catch(a){s.default.reportError(a)}var t=e.nextSibling;try{s.default.PAssert(409,!t||this._isComponentNode(t),"Siblings must always be valid components")}catch(a){s.default.reportError(a)}return t}},{key:"createRange",value:function(e,t,a){var n;if(isNaN(a)&&(a=t),isNaN(t))(n=this.createSelectionRange()).selectNodeContents(e);else{var r=this.getOffsetChildElement(e,t),i=t!==a?this.getOffsetChildElement(e,a):r;r&&(n=this.createFakeRange(r.element,r.offset,i.element,i.offset)._range)}return n}},{key:"selectElement",value:function(e,t,a){var n=this.createRange(e,t,a);return n&&this.setSelectionRange(n),n}},{key:"getSelectionInElement",value:function(e){var t=this.getSelectionRangeNative();if(t&&s.default.isAncestor(t.startContainer,e)&&s.default.isAncestor(t.endContainer,e))return this.getSelectOffsetsInElement(e,t)}},{key:"deleteRangeContents",value:function(){var e=this.getSelectionRangeNative();e&&e.deleteContents()}}]),e}();t.default=new d},function(e,t,a){"use strict";var n,r,i=a(5),o=a.n(i),s=a(16),l=a.n(s),u=a(12),c=a.n(u),d=a(7),h=a.n(d),f=a(8),p=a.n(f),g=a(24),m=a.n(g),v=a(20),y=a.n(v),k=a(21),_=a.n(k),b=a(13),w=a.n(b),S=a(10),D=a.n(S),P=a(11),I=a(2),E=a(0),C=a(9),x=a(4),A=a(38),T=a.n(A),M=a(35),L=a(15),O=a(87),R=a(62),F=a(76),N=a(18),B=(n=function(){function e(){h()(this,e),this.isLoaded=new L.a(!1),this.isGapiLoaded=new L.a(!1),this._handlersOnLoaded=[],this.authTokens={},this.erroredAuthTokens=new O.a,this.onAccountsUpdated=new R.a,this.onAuthTokensUpdated=new R.a,this._serverTokens=new L.a,this._refreshPromises={}}return p()(e,[{key:"init",value:function(){var e=this;E.default.isDemoMode()?this._init():x.default.settings.onLoadedRemote((function(){M.a.onAuthed((function(){N.a.onlineStatus.onValue("Online",(function(){e._init()}))}))}))}},{key:"_onLoaded",value:function(){var e,t=this,a=null===(e=M.a.getGoogleProvider())||void 0===e?void 0:e.email;a?this.defaultAccount=a:(x.default.settings.syncAccounts.listen((function(e){t.defaultAccount=Object.keys(e)[0]})),this.defaultAccount=Object.keys(x.default.settings.syncAccounts.get())[0]),this.isLoaded.get()||(x.default.settings.syncAccountRefreshParts.listen((function(){t._serverTokens.onHasValue((function(){setTimeout(t.updateAllServerTokens,2e3)}))})),this.isLoaded.set(!0),this._runOnSyncHandlers())}},{key:"updateAllServerTokens",value:function(){var e=c()(o.a.mark((function e(){var t,a=this;return o.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return t=this._serverTokens.get(),e.next=3,Promise.all(Object.keys(t).map((function(e){return x.default.settings.syncAccounts.getProperty(e)?a.refreshAuthServerToken(e,t[e]):C.a.app&&t[e]?a.refreshAuthToken(e,t[e].scopes):void 0})));case 3:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWithTokens",value:function(){var e=c()(o.a.mark((function e(t){var a,n,r=this;return o.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:a=!!this._serverTokens.get(),x.default.settings.syncAccounts.get()||(n={},Object.keys(t).forEach((function(e){var a,r=t[e];n[e]=(a={},T()(a,I.a.PluginID.Gmail,r.scopes.includes(I.a.GScope.GmailModify)),T()(a,I.a.PluginID.GCalendar,r.scopes.includes(I.a.GScope.Calendar)||r.scopes.includes(I.a.GScope.CalendarRO)),a)})),x.default.settings.syncAccounts.set(n)),this._serverTokens.set(t),x.default.settings.onLoadedRemote((function(){a?setTimeout(r.updateAllServerTokens,2e3):r.updateAllServerTokens()}));case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAuthServerToken",value:function(){var e=c()(o.a.mark((function e(t,a){var n,r,i,s;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:0,!1;try{E.default.PAssert(423,t,"Trying to get account auth token for undefined")}catch(l){E.default.reportError(l)}if(!t){e.next=34;break}if(this._refreshPromises[t]){e.next=12;break}n=x.default.settings.syncAccountRefreshParts.getProperty(t);try{E.default.PAssert(424,n,"Missing refresh part for account: "+t,(function(){return Object.keys(x.default.settings.syncAccountRefreshParts.get())}))}catch(l){E.default.reportError(l)}if(n){e.next=9;break}return e.abrupt("return",void 0);case 9:0,this._refreshPromises[t]=F.a.getAccessToken(t,n),!0;case 12:return e.prev=12,e.next=15,this._refreshPromises[t];case 15:if(r=e.sent,delete this._refreshPromises[t],!r.value){e.next=27;break}return i=r.value,(s=this.convertScopeToScopes(i)).email=s.email||t,this.authTokens[t]=s,e.abrupt("return",i);case 27:if(console.log(r.error),r.error&&r.error.includes("invalid_grant"))this.redoAuth(t,a.scopes);else{try{E.default.PAssert(425,!1,"Error refreshing token",r.error)}catch(l){E.default.reportError(l)}0}case 29:e.next=34;break;case 31:e.prev=31,e.t0=e.catch(12),delete this._refreshPromises[t];case 34:case"end":return e.stop()}}}),e,this,[[12,31]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"authAccount",value:function(e,t,a){var n=this,r=function(){var r=c()(o.a.mark((function r(i){return o.a.wrap((function(r){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(r.prev=r.next){case 0:i?a(i):n.doAuthForAccount(e,t,a);case 1:case"end":return r.stop()}}}),r)})));return function(e){return r.apply(this,arguments)}}();this.authTokens[e]?this.getAccountAuthToken(e,t,r,!0):r()}},{key:"authAccountPrimary",value:function(){var e=c()(o.a.mark((function e(t,a){var n;return o.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:(n=this.getDefaultAccountID())?this.doAuthForAccount(n,t,a):a(void 0);case 2:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"removeAccount",value:function(e){delete this.authTokens[e],this.onAccountsUpdated.notify()}},{key:"redoAuth",value:function(){var e=c()(o.a.mark((function e(t,a){var n=this;return o.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.erroredAuthTokens.getProperty(t)){e.next=2;break}return e.abrupt("return");case 2:this.erroredAuthTokens.setProperty(t,!0),a.remove(I.a.GScope.GmailCompose),a.remove(I.a.GScope.GmailModify),a.remove(I.a.GScope.DriveFull),a.remove(I.a.GScope.DriveMetadataRO),a.remove(I.a.GScope.DriveInstall),a.remove(I.a.GScope.DriveAppData),a=a.filter((function(e){return!!e})),E.default.log("redoAuth",a);try{E.default.PAssert(426,!1,"redoAuth")}catch(i){E.default.reportError(i)}return e.abrupt("return",new Promise((function(e){x.default.settings.useServerAuth.get()?x.default.toasts.pushMessage({id:"redoAuth_"+t,text:"Error authorizing for: ".concat(t,". Please reauthorize this account to keep syncing its data with Google. If you have been seeing a lot of reauthorization messages, this should fix it for good."),actionText:"REAUTHORIZE",action:function(){n.doAuthForAccount(t,a,(function(){e(),x.default.toasts.clearMessageByID("redoAuth_"+t)}))}}):x.default.toasts.pushMessage({id:"redoAuth_"+t,text:"Error authorizing for: ".concat(t,". This can be caused by a connection error or signing out of Gmail. If retrying does not close this message, you may need to reauthorize."),actionText:"RETRY",holdOnAction:!0,action:function(){n.refreshAuthToken(t,a)},action2:{text:"REAUTHORIZE",action:function(){n.doAuthForAccount(t,a,(function(){e()}))}}})})));case 13:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getAccountAuthToken",value:function(e,t,a,n){var r=this;try{E.default.PAssert(427,e,"Trying to get account auth token for undefined")}catch(i){E.default.reportError(i)}e?this.onLoaded(c()(o.a.mark((function i(){var s;return o.a.wrap((function(i){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(i.prev=i.next){case 0:if((s=r.authTokens[e])&&!(s.expires_at<Date.now()+1e4)){i.next=8;break}return i.next=5,r.refreshAuthToken(e,t);case 5:s=i.sent,i.next=22;break;case 8:if(r._verifyScopes(t,s)){i.next=17;break}if(s=void 0,!n){i.next=15;break}return a(void 0),i.abrupt("return");case 15:i.next=22;break;case 17:if(s.expires_at&&!(s.expires_at-Date.now()<I.a.MinimumTokenExpireTimeMS)){i.next=22;break}return E.default.logQuiet("Token needs refresh",s.expires_at,s.expires_at-Date.now()),i.next=21,r.refreshAuthToken(e,t);case 21:s=i.sent;case 22:a(s);case 23:case"end":return i.stop()}}}),i)})))):a(void 0)}},{key:"isAuthorizedForScopes",value:function(e,t){var a=this.authTokens&&this.authTokens[e];return!!a&&this._verifyScopes(t,a)}},{key:"notifyUnauthorizedRequest",value:function(e){}},{key:"_verifyScopes",value:function(e,t){var a=0;if(!t||!t.scopes)return!1;for(var n=t.scopes,r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=e[r];if(!n.includes(i)&&(i!==I.a.GScope.Drive&&i!==I.a.GScope.DriveMetadataRO||!n.includes(I.a.GScope.DriveFull)))return!1}return!0}},{key:"onLoaded",value:function(e){this.isLoaded.get()?e():this._handlersOnLoaded.push(e)}},{key:"_runOnSyncHandlers",value:function(){this._handlersOnLoaded.forEach((function(e){return e()})),this._handlersOnLoaded=[]}},{key:"getDefaultAuthToken",value:function(e,t){var a=this.getDefaultAccountID();a?this.getAccountAuthToken(a,e,(function(e){e&&t(e)})):t(void 0)}},{key:"hasError",value:function(){return!1}},{key:"getError",value:function(e){return""}},{key:"accountHasError",value:function(e){return!!this.erroredAuthTokens.getProperty(e)}},{key:"getGoogleUserInfo",value:function(e){this.getDefaultAuthToken(["profile"],(function(t){t?fetch("https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token=".concat(t.access_token)).then((function(t){200===t.status&&t.json().then((function(t){return e(t)}))})):e(void 0)}))}},{key:"isEmailAuthed",value:function(e){var t=e.toLowerCase();return Object.keys(this.authTokens).some((function(e){return e.toLowerCase()===t}))}},{key:"_saveAuthToken",value:function(e,t){this.authTokens[e]=t,this.erroredAuthTokens.deleteProperty(e),this.onAuthTokensUpdated.notify()}},{key:"getDefaultAccountID",value:function(){return this.defaultAccount}},{key:"convertScopeToScopes",value:function(e){var t,a=null===(t=e.scope)||void 0===t?void 0:t.split(" ");return e.scopes=null===a||void 0===a?void 0:a.map((function(e){return I.a.GScopeArray[e]})),e}},{key:"convertScopesToScope",value:function(e){return e.map((function(e){return I.a.GScopeArray.indexOf(e)})).join(" ")}}]),e}(),D()(n.prototype,"updateAllServerTokens",[P.a],Object.getOwnPropertyDescriptor(n.prototype,"updateAllServerTokens"),n.prototype),D()(n.prototype,"refreshAuthServerToken",[P.a],Object.getOwnPropertyDescriptor(n.prototype,"refreshAuthServerToken"),n.prototype),n),j=a(32);function U(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=w()(e);if(t){var r=w()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return _()(this,a)}}var H=(r=function(e){y()(a,e);var t=U(a);function a(){var e;return h()(this,a),(e=t.call(this)).retryAttempt=0,e}return p()(a,[{key:"_init",value:function(){var e=c()(o.a.mark((function e(){var t,a=this;return o.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(x.default.settings.syncAccounts.listen(this.refreshAllSyncAccounts),x.default.settings.syncAccounts.get(),!C.a.app){e.next=9;break}if(!(t=x.default.settings.refreshTokensRN.get())){e.next=7;break}return e.next=7,Promise.all(Object.entries(t).map((function(e){var t=l()(e,2),n=t[0],r=t[1];a.refreshAuthToken(n,r.scopes)})));case 7:e.next=12;break;case 9:return e.next=12,this.refreshAllSyncAccounts();case 12:this._onLoaded();case 13:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshAuthToken",value:function(){var e=c()(o.a.mark((function e(t,a){var n,r,i,s,l=this;return o.a.wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(n=this._serverTokens.get()[t],!this._serverTokens.get()[t]){e.next=6;break}return e.next=4,this.refreshAuthServerToken(t,n);case 4:e.next=20;break;case 6:if(!C.a.app){e.next=11;break}return e.next=9,E.default.runSingletonPromise("refreshAuthToken"+t,c()(o.a.mark((function e(){var n,r,i,s;return o.a.wrap((function(e){for(var o=0,u=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(!(r=null===(n=x.default.settings.refreshTokensRN.get())||void 0===n?void 0:n[t])){e.next=7;break}return i=r.refreshToken,e.next=5,j.a.refreshAuthGoogleAccount({refreshToken:i,email:t,scopes:a});case 5:s=e.sent,l._saveAuthToken(t,s);case 7:case"end":return e.stop()}}}),e)}))));case 9:e.next=20;break;case 11:return e.next=13,this.refreshAllSyncAccounts();case 13:if(this.authTokens[t]){e.next=20;break}if(!(r=x.default.settings.syncAccounts.get())[t]){e.next=20;break}return i=Object.keys(r[t]),s=i&&x.default.pluginManager.getAllPluginScopes(i,!1),e.next=20,this.redoAuth(t,s||a);case 20:return e.abrupt("return",this.authTokens[t]);case 21:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"doAuthForAccountLegacy",value:function(e,t,a){var n=this;this.gapiAuthorizePrompt(e,t,(function(e){n.onAccountsUpdated.notify(),a&&a(e)}))}},{key:"doAuthForAccountServer",value:function(){var e=c()(o.a.mark((function e(t,a,n){var r,i,s,l,u=this;return o.a.wrap((function(e){for(var d=0;;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(e.prev=e.next){case 0:if(!C.a.app){e.next=13;break}return e.next=3,j.a.authGoogleAccount({email:t,scopes:a});case 3:r=e.sent,i=r.authToken,s=r.refreshToken,(l=E.default.clone(x.default.settings.refreshTokensRN.get())||{})[t]={refreshToken:s,scopes:a},x.default.settings.refreshTokensRN.set(l),this._saveAuthToken(t,i),n&&n(i),e.next=16;break;case 13:return e.next=15,this.ensureGapiClient();case 15:window.gapi.auth2.authorize({client_id:I.a.ClientID,scope:a.join(" "),response_type:"id_token code",access_type:"offline",prompt:"consent",login_hint:t},function(){var e=c()(o.a.mark((function e(r){var i,s,l;return o.a.wrap((function(e){for(var o=0,c=0;;){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!r.error&&E.default.isString(r.code)){e.next=5;break}t&&"popup_closed_by_user"!==r.error&&u.redoAuth(t,a),n&&n(void 0),e.next=19;break;case 5:if(!(i=E.default.decodeIDToken(r.id_token))||i.toLowerCase()===i.toLowerCase()){e.next=11;break}x.default.toasts.pushMessage("Reauthorized with the wrong account. Expected ".concat(i," but got ").concat(i,".")),n&&n(void 0),e.next=19;break;case 11:return e.next=13,F.a.onAuthCode({code:r.code,email:i});case 13:s=e.sent,x.default.settings.syncAccountRefreshParts.setProperty(i,s.value.refresh_part),l=u.convertScopeToScopes(s.value),n&&n(l);case 19:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}());case 16:case"end":return e.stop()}}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"doAuthForAccount",value:function(e,t,a){C.a.app||x.default.settings.useServerAuth.get()?this.doAuthForAccountServer(e,t,a):this.doAuthForAccountLegacy(e,t,a)}},{key:"authAccountAnonymous",value:function(){var e=c()(o.a.mark((function e(){return o.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){var t=[I.a.GScope.Profile,I.a.GScope.UserInfoEmail,I.a.GScope.Email,I.a.GScope.UserInfoProfile];window.gapi.auth2.authorize({client_id:I.a.ClientID,scope:t.join(" "),response_type:"id_token"},(function(t){e(t)}))})));case 1:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"authAccountTemp",value:function(){var e=c()(o.a.mark((function e(t){return o.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",E.default.promisify((function(e){var a=[I.a.GScope.Profile,I.a.GScope.UserInfoEmail,I.a.GScope.Email,I.a.GScope.UserInfoProfile];window.gapi.auth2.authorize({client_id:I.a.ClientID,scope:a.join(" "),response_type:"id_token",login_hint:t},(function(t){e(t)}))})));case 1:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"promisifyAuthorize",value:function(){var e=c()(o.a.mark((function e(t){var a=this;return o.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",E.default.promisify((function(e){window.gapi.auth2.authorize({client_id:I.a.ClientID,scope:"profile",response_type:"id_token permission",prompt:"none",authuser:""+t,include_granted_scopes:!0},(function(t){if(t.id_token&&t.access_token){var n=E.default.decodeIDToken(t.id_token),r={email:n,access_token:t.access_token,scopes:t.scope.split(" "),expires_at:t.expires_at};a._saveAuthToken(n,r),e(r)}else E.default.logQuiet("authorize: "+JSON.stringify(t)),e(void 0)}))})));case 1:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAllSyncAccounts",value:function(){var e=c()(o.a.mark((function e(){var t,a,n,r=this;return o.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return E.default.logQuiet("refreshing all sync accounts"),e.next=3,this.ensureGapiClient();case 3:if(t=x.default.settings.syncAccounts.get(),a={},!((n=Object.keys(t).filter((function(e){return!E.default.isEmpty(t[e])&&!r._serverTokens.get()[e]})).map((function(e){return e.toLowerCase()}))).length>0)){e.next=10;break}return n.forEach((function(e){a[e]=!1})),e.next=10,E.default.runSingletonPromise("refreshAllSyncAccounts",c()(o.a.mark((function e(){var t,i,s,l=0;return o.a.wrap((function(e){for(var u=0,d=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(e.prev=e.next){case 0:t=0;case 1:if(!(t<20)){e.next=15;break}if(!(l++>5e3&&__infLoop&&__infLoop(l))){e.next=4;break}throw new RangeError;case 4:return e.next=6,r.promisifyAuthorize(t);case 6:if((i=e.sent)&&(s=i.email.toLowerCase(),!1===a[s]&&(a[s]=!0,x.default.toasts.clearMessageByID("redoAuth_"+s))),!n.every((function(e){return!0===a[e]}))){e.next=12;break}return r.retryAttempt=0,E.default.logQuiet("all refreshed"),e.abrupt("break",15);case 12:t++,e.next=1;break;case 15:if(!n.some((function(e){return!a[e]}))){e.next=19;break}return E.default.logQuiet("Accounts failed, trying the legacy way"),e.next=19,Promise.all(n.map(function(){var e=c()(o.a.mark((function e(t){var n,i,s;return o.a.wrap((function(e){for(var o=0,l=0,u=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(a[t]){e.next=6;break}return E.default.logQuiet("Trying the legacy way: ",t),n=x.default.settings.syncAccounts.get(),i=Object.keys(n[t]),s=i&&x.default.pluginManager.getAllPluginScopes(i,!1),e.abrupt("return",r.gapiAuthorizeImmediateLegacy(t,s));case 6:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 19:n.some((function(e){return!a[e]}))&&(E.default.logQuiet("Accounts still failed, need redoAuth"),r.retryAttempt++,r.retryAttempt>5?Promise.all(n.map(function(){var e=c()(o.a.mark((function e(t){var n,i,s;return o.a.wrap((function(e){for(var o=0,l=0,u=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:if(a[t]){e.next=5;break}return n=x.default.settings.syncAccounts.get(),i=Object.keys(n[t]),s=i&&x.default.pluginManager.getAllPluginScopes(i,!1),e.abrupt("return",r.redoAuth(t,s));case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}())):setTimeout((function(){r.refreshAllSyncAccounts()}),5e3));case 20:case"end":return e.stop()}}}),e)}))));case 10:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"gapiAuthorizeImmediateLegacy",value:function(){var e=c()(o.a.mark((function e(t,a){var n=this;return o.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.ensureGapiClient();case 2:return e.next=4,N.a.onConnectedPromise();case 4:return e.abrupt("return",new Promise((function(e){var r=!1,i=function(){n._doAuthorization(t,a,"none",(function(t){r||(r=!0,e(t))}))};i(),setTimeout((function(){r||i()}),2e3)})));case 5:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"_doAuthorization",value:function(e,t,a,n){var r=this;try{window.gapi.auth2.authorize({client_id:I.a.ClientID,scope:t.join(" "),response_type:"id_token permission",prompt:a,login_hint:e,authuser:e?-1:void 0,include_granted_scopes:!0},(function(i){var o;if(!E.default.isString(i.access_token)||i.error)E.default.logQuiet("immediate failed",e,i),"access_denied"===i.error_subtype&&"consent"===a&&r.redoAuth(e,t);else{var s=E.default.decodeIDToken(i.id_token)||e;o={access_token:i.access_token,email:s,scopes:i.scope.split(" "),expires_at:i.expires_at},E.default.logQuiet("token",e,o),r._saveAuthToken(e,o)}n(o)}))}catch(i){"Cookies are not enabled in current environment."===i.error&&x.default.menus.openModal(I.a.Modals.ErrorCookies)}}},{key:"gapiAuthorizePrompt",value:function(e,t,a){this._doAuthorization(e,t,"consent",a)}},{key:"ensureGapiBase",value:function(){var e=c()(o.a.mark((function e(){return o.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:if(window.gapi||this.isGapiLoaded.get()){e.next=3;break}return e.next=3,E.default.runSingletonPromise("gapiScript",(function(){return new Promise((function(e){var t=!1,a=0;!function n(){if(!t||navigator.onLine){var r=document.getElementById("gapiScript");r&&r.remove(),E.default.addScript("https://apis.google.com/js/api.js","gapiScript",(function(){e()}),(function(){t=!0,++a<3&&setTimeout(n,2e3)}))}else setTimeout(n,2e3)}()}))}));case 3:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ensureGapiClient",value:function(){var e=c()(o.a.mark((function e(){return o.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.ensureGapiLib("client");case 2:this.isGapiLoaded.get()||this.isGapiLoaded.set(!0);case 3:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"ensureGapiLib",value:function(){var e=c()(o.a.mark((function e(t){return o.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.ensureGapiBase();case 2:if(!window.gapi||window.gapi[t]){e.next=5;break}return e.next=5,E.default.runSingletonPromise("ensureGapiLib"+t,(function(){return new Promise((function(e){window.gapi.load(t,{callback:function(){e()},onerror:function(){return!1},timeout:2e4,ontimeout:function(){return!1}})}))}));case 5:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"authAccount",value:function(e,t,n,r){var i=!x.default.settings.useServerAuth.get()||this._serverTokens.get()[e];!r&&i?m()(w()(a.prototype),"authAccount",this).call(this,e,t,n):this.doAuthForAccount(e,t,n)}}]),a}(B),D()(r.prototype,"refreshAuthToken",[P.a],Object.getOwnPropertyDescriptor(r.prototype,"refreshAuthToken"),r.prototype),D()(r.prototype,"refreshAllSyncAccounts",[P.a],Object.getOwnPropertyDescriptor(r.prototype,"refreshAllSyncAccounts"),r.prototype),r);t.a=new H},function(e,t,a){"use strict";var n,r,i=a(5),o=a.n(i),s=a(12),l=a.n(s),u=a(7),c=a.n(u),d=a(8),h=a.n(d),f=a(20),p=a.n(f),g=a(21),m=a.n(g),v=a(13),y=a.n(v),k=a(10),_=a.n(k),b=a(34),w=a(11),S=a(2),D=a(46),P=a(0),I=a(9),E=a(4),C=a(32),x=a(15);function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=y()(e);if(t){var r=y()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return m()(this,a)}}var T=(r=function(e){p()(a,e);var t=A(a);function a(){return c()(this,a),t.call(this)}return h()(a,[{key:"init",value:function(){var e=this;this.initializeFirebase(),window.firebase=D.a,D.a.auth().onAuthStateChanged((function(t){if(t&&E.default.settings.activeUser.get())e.onSignInWithUser(t);else{var a=!!E.default.settings.activeUser.get();E.default.settings.userId.set(void 0),E.default.settings.activeUser.set(void 0),E.default.settings.displayName.set(void 0),a&&setTimeout((function(){P.default.reload()}),100)}})),this._isOnline=navigator.onLine,window.addEventListener("online",(function(){e._isOnline=navigator.onLine}))}},{key:"initializeFirebase",value:function(){var e={clientId:S.a.ClientID,apiKey:S.a.APIKey,authDomain:S.a.APIBaseURL,databaseURL:"https://".concat(S.a.FirebaseProjectID,".firebaseio.com"),projectId:S.a.FirebaseProjectID,storageBucket:"".concat(S.a.FirebaseProjectID,".appspot.com"),messagingSenderId:S.a.FirebaseAppID,scopes:S.a.ScopesDefault};D.a.initializeApp(e)}},{key:"onSignInResult",value:function(e,t){var a=e.user;E.default.billingManager.updateUserProfile(t);try{P.default.PAssert(193,a,"Somehow signed in without a valid user")}catch(n){P.default.reportError(n)}a&&this.onSignInWithUser(a)}},{key:"onSignInFailure",value:function(e){var t,a=e.code,n=e.message;if("auth/popup-closed-by-user"===a)t="Error signing in. Please try again.";else if("auth/network-request-failed"===a)t="Connection error. Please try again.";else if("auth/web-storage-unsupported"===a){try{P.default.PAssert(194,!1,"Still getting web-storage-unsupported error")}catch(r){P.default.reportError(r)}t="There may be a configuration problem in your browser. Please contact support@moo.do and we can help you."}else if("auth/user-not-found"===a)t="An account with this email was not found.";else if("auth/invalid-email"===a)t="Invalid email address.";else if("auth/email-already-in-use"===a)t="This email address is already in use. You may have previously signed in with Google for this account.";else if("auth/wrong-password"===a)t="The password is incorrect, or you may have previously signed in with Google. Please try again.";else if(a&&"authentication_failed"!==a&&"authentication_error"!==a){try{P.default.PAssert(195,!1,"Error on signin",a,n)}catch(r){P.default.reportError(r)}t="Unexpected sign in error: ".concat(a,". Please try again.")}t&&E.default.setup.popupClosedError.set({message:t})}},{key:"_getUid",value:function(){return D.a.auth().getUid()}},{key:"getUserSync",value:function(){return this.user.get()}},{key:"signOut",value:function(){var e=l()(o.a.mark((function e(){return o.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return P.default.log("signOut called"),E.default.settings.activeUser.set(void 0),e.abrupt("return",D.a.auth().signOut());case 3:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"isOnline",value:function(){return navigator.onLine}},{key:"reauthenticateGoogle",value:function(){var e=l()(o.a.mark((function e(){var t,a,n,r,i,s,l,u,c;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return a=null===(t=this.getGoogleProvider())||void 0===t?void 0:t.email,e.next=4,C.a.authGoogleAccount({email:a,scopes:["profile","email"]});case 4:r=e.sent,(i=r.authToken)&&(n=i.idToken),e.next=21;break;case 9:return e.next=11,b.a.authAccountTemp(a);case 11:if(e.t1=s=e.sent,e.t0=null===e.t1,e.t0){e.next=15;break}e.t0=void 0===s;case 15:if(!e.t0){e.next=19;break}e.t2=void 0,e.next=20;break;case 19:e.t2=s.id_token;case 20:n=e.t2;case 21:if(!n){e.next=26;break}return l=D.a.auth().currentUser,u=D.a.auth.GoogleAuthProvider.credential(n),c=l.reauthenticateWithCredential(u),e.abrupt("return",c);case 26:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"reauthenticateApple",value:function(){var e=l()(o.a.mark((function e(){var t,a,n,r,i,s;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return a=null===(t=this.getAppleProvider())||void 0===t?void 0:t.email,n=D.a.auth().currentUser,e.next=5,this.createAppleCredential();case 5:if(r=e.sent,i=r.credential,s=r.profile.email,a!==s||!i){e.next=10;break}return e.abrupt("return",n.reauthenticateWithCredential(i));case 10:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"linkWithEmail",value:function(e,t){var a=D.a.auth.EmailAuthProvider.credential(e,t);return D.a.auth().currentUser.linkWithCredential(a)}},{key:"linkWithGoogle",value:function(){var e=l()(o.a.mark((function e(){var t,a,n,r,i,s,l,u,c;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!I.a.app){e.next=15;break}return e.next=3,C.a.signInWithGoogle();case 3:if(e.t1=a=e.sent,e.t0=null===e.t1,e.t0){e.next=7;break}e.t0=void 0===a;case 7:if(!e.t0){e.next=11;break}e.t2=void 0,e.next=12;break;case 11:e.t2=a.idToken;case 12:t=e.t2,e.next=27;break;case 15:return e.next=17,b.a.authAccountAnonymous();case 17:if(e.t4=n=e.sent,e.t3=null===e.t4,e.t3){e.next=21;break}e.t3=void 0===n;case 21:if(!e.t3){e.next=25;break}e.t5=void 0,e.next=26;break;case 25:e.t5=n.id_token;case 26:t=e.t5;case 27:if(e.prev=27,!t){e.next=38;break}return i=D.a.auth.GoogleAuthProvider.credential(t),e.next=32,D.a.auth().currentUser.linkWithCredential(i);case 32:return s=e.sent,(l=null===(r=this.getGoogleProvider())||void 0===r?void 0:r.email)&&(E.default.settings.syncAccounts.setProperty(l,{}),u=this.createProfileFromGoogle(s),E.default.billingManager.updateUserProfile(u)),e.abrupt("return",s);case 38:E.default.menus.alert({text:"Signin error. Please try again."});case 39:e.next=45;break;case 41:if(e.prev=41,e.t6=e.catch(27),"auth/credential-already-in-use"===e.t6.code)c="This Google account is already in use.";else try{P.default.PAssert(196,e.t6)}catch(d){P.default.reportError(d)}c&&E.default.menus.alert({text:c});case 45:case"end":return e.stop()}}}),e,this,[[27,41]])})));return function(){return e.apply(this,arguments)}}()},{key:"linkWithApple",value:function(){var e=l()(o.a.mark((function e(){var t,a,n,r,i;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.createAppleCredential();case 2:if(t=e.sent,a=t.credential,n=t.profile,!a){e.next=10;break}return r=D.a.auth().currentUser,(i=r.linkWithCredential(a))&&E.default.billingManager.updateUserProfile(n),e.abrupt("return",i);case 10:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"unlinkEmail",value:function(){var e=l()(o.a.mark((function e(){return o.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",D.a.auth().currentUser.unlink("password"));case 1:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"unlinkGoogle",value:function(){var e=l()(o.a.mark((function e(){return o.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",D.a.auth().currentUser.unlink("google.com"));case 1:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"unlinkApple",value:function(){var e=l()(o.a.mark((function e(){return o.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",D.a.auth().currentUser.unlink("apple.com"));case 1:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"signInWithGoogle",value:function(){var e=l()(o.a.mark((function e(){var t,a,n,r,i,s,l;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!I.a.app){e.next=23;break}return e.next=3,C.a.signInWithGoogle();case 3:if(!(a=e.sent).error){e.next=8;break}this.onSignInFailure(a.error),e.next=21;break;case 8:if(n=a.idToken,r=a.accessToken,!(i=D.a.auth.GoogleAuthProvider.credential(n,r))){e.next=21;break}return e.prev=11,e.next=14,D.a.auth().signInWithCredential(i);case 14:t=e.sent,e.next=21;break;case 17:e.prev=17,e.t0=e.catch(11),this.onSignInFailure(e.t0);try{P.default.PAssert(197,"auth/network-request-failed"===e.t0.code,"Other error code: "+e.t0.code,e.t0)}catch(u){P.default.reportError(u)}case 21:e.next=36;break;case 23:return(s=new D.a.auth.GoogleAuthProvider).addScope("email"),s.addScope("profile"),s.setCustomParameters({prompt:"consent"}),e.prev=27,e.next=30,D.a.auth().signInWithPopup(s);case 30:t=e.sent,e.next=36;break;case 33:e.prev=33,e.t1=e.catch(27),this.onSignInFailure(e.t1);case 36:return t?(E.default.PaneManager.setupInitialTimeout(),l=this.createProfileFromGoogle(t),this.onSignInResult(t,l)):this.onSignInFailure({code:""}),e.abrupt("return",t);case 38:case"end":return e.stop()}}}),e,this,[[11,17],[27,33]])})));return function(){return e.apply(this,arguments)}}()},{key:"createProfileFromGoogle",value:function(e){var t,a=e.user,n=(null===(t=e.additionalUserInfo)||void 0===t?void 0:t.profile)||{},r=n.family_name,i=n.given_name,o=n.name,s=n.picture,l=a.email,u=a.displayName,c=a.photoURL;if(!r&&!i){var d,h,f=null!==(d=null===(h=a.displayName)||void 0===h?void 0:h.split(" "))&&void 0!==d?d:"";2===f.length?(i=f[0],r=f[1]):i=f[0]}return o||(o=u),{email:l,lname:r,fname:i,displayName:o,picture:s||c}}},{key:"createAppleCredential",value:function(){var e=l()(o.a.mark((function e(){var t,a,n,r,i,s,l,u;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,C.a.signInWithApple();case 2:if(!(t=e.sent).error){e.next=7;break}return e.abrupt("return",{error:t.error});case 7:return a=t.identityToken,n=t.nonce,r=t.fname,i=t.lname,s=t.email,l=t.displayName,u=new D.a.auth.OAuthProvider("apple.com"),e.abrupt("return",{credential:u.credential({idToken:a,rawNonce:n}),profile:{email:s,fname:r,lname:i,displayName:l}});case 10:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"signInWithApple",value:function(){var e=l()(o.a.mark((function e(){var t,a,n,r,i;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=3,this.createAppleCredential();case 3:if(t=e.sent,a=t.error,n=t.credential,r=t.profile,!a){e.next=11;break}this.onSignInFailure(a),e.next=24;break;case 11:if(!n){e.next=24;break}return e.prev=12,e.next=15,D.a.auth().signInWithCredential(n);case 15:if(!(i=e.sent)){e.next=19;break}return i?(E.default.PaneManager.setupInitialTimeout(),this.onSignInResult(i,r)):this.onSignInFailure({code:""}),e.abrupt("return",i);case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(12);try{P.default.PAssert(198,"auth/network-request-failed"===e.t0.code,"Other error code: "+e.t0.code,e.t0)}catch(s){P.default.reportError(s)}case 24:case"end":return e.stop()}}}),e,this,[[12,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"signInWithEmail",value:function(){var e=l()(o.a.mark((function e(t,a){var n;return o.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,D.a.auth().signInWithEmailAndPassword(t,a);case 3:return(n=e.sent)?(E.default.PaneManager.setupInitialTimeout(),this.onSignInResult(n,{email:t})):this.onSignInFailure({code:""}),e.abrupt("return",n);case 8:e.prev=8,e.t0=e.catch(0),this.onSignInFailure(e.t0);case 11:case"end":return e.stop()}}}),e,this,[[0,8]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"createUserWithEmailAndPassword",value:function(){var e=l()(o.a.mark((function e(t,a){var n;return o.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,D.a.auth().createUserWithEmailAndPassword(t,a);case 3:return(n=e.sent)?(E.default.PaneManager.setupInitialTimeout(),this.onSignInResult(n,{email:t})):this.onSignInFailure({code:""}),e.abrupt("return",n);case 8:e.prev=8,e.t0=e.catch(0),this.onSignInFailure(e.t0);case 11:case"end":return e.stop()}}}),e,this,[[0,8]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"sendResetEmail",value:function(){var e=l()(o.a.mark((function e(t){return o.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,D.a.auth().sendPasswordResetEmail(t);case 3:return e.abrupt("return",!0);case 6:e.prev=6,e.t0=e.catch(0),console.log(e.t0),this.onSignInFailure(e.t0);case 10:case"end":return e.stop()}}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()}]),a}((n=function(){function e(){c()(this,e),this.user=new x.a,this.onAuthedCallbacks=[]}return h()(e,[{key:"onSignInWithUser",value:function(e){var t=this;this.user.set(e),E.default.settings.onLoaded((function(){E.default.settings.userId.set(e.uid),E.default.settings.activeUser.set(e.email),e.displayName&&E.default.settings.displayName.set(e.displayName);try{P.default.PAssert(377,e.uid===t._getUid())}catch(a){P.default.reportError(a)}t.runAuthedCallbacks()}))}},{key:"runAuthedCallbacks",value:function(){this.onAuthedCallbacks.length>0&&(this.onAuthedCallbacks.forEach((function(e){return e()})),this.onAuthedCallbacks=[])}},{key:"getUserSync",value:function(){return this.user.get()}},{key:"getUser",value:function(){var e=l()(o.a.mark((function e(){var t=this;return o.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.user.get()){e.next=4;break}return e.abrupt("return",Promise.resolve(this.user.get()));case 4:return e.abrupt("return",new Promise((function(e){t.onAuthedCallbacks.push((function(){e(t.user.get())}))})));case 5:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"onAuthed",value:function(e){this.user.get()?e():this.onAuthedCallbacks.push(e)}},{key:"onActiveUser",value:function(e){E.default.settings.activeUser.onHasValue(e)}},{key:"getAccountName",value:function(){return E.default.settings.displayName.get()||""}},{key:"getAccountEmail",value:function(){return E.default.settings.activeUser.get()}},{key:"getUid",value:function(){return E.default.settings.userId.get()}},{key:"getEncryptionUid",value:function(){return E.default.settings.userId.get()}},{key:"getCurrentUser",value:function(){return P.default.isDemoMode()?null:D.a.auth().currentUser}},{key:"getEmailProvider",value:function(){var e=this.getCurrentUser();return null===e||void 0===e?void 0:e.providerData.find((function(e){return"password"===e.providerId}))}},{key:"getGoogleProvider",value:function(){var e=this.getCurrentUser();return null===e||void 0===e?void 0:e.providerData.find((function(e){return"google.com"===e.providerId}))}},{key:"getAppleProvider",value:function(){var e=this.getCurrentUser();return null===e||void 0===e?void 0:e.providerData.find((function(e){return"apple.com"===e.providerId}))}}]),e}(),_()(n.prototype,"getUser",[w.a],Object.getOwnPropertyDescriptor(n.prototype,"getUser"),n.prototype),n)),_()(r.prototype,"linkWithEmail",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"linkWithEmail"),r.prototype),_()(r.prototype,"linkWithGoogle",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"linkWithGoogle"),r.prototype),_()(r.prototype,"linkWithApple",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"linkWithApple"),r.prototype),_()(r.prototype,"unlinkEmail",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"unlinkEmail"),r.prototype),_()(r.prototype,"unlinkGoogle",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"unlinkGoogle"),r.prototype),_()(r.prototype,"unlinkApple",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"unlinkApple"),r.prototype),r);t.a=new T},,function(e,t,a){"use strict";var n=function(e){var t={};return Object.keys(e).forEach((function(a){t[e[a]]=a})),t},r=function(e){return"string"===typeof e},i={billingID:"b",displayName:"n",gid:"g",earlyAdopter:"x",email:"e",fname:"f",lname:"l",inviteCode:"i",invoiceAddress:"a",invoiceCompany:"c",invoiceEmail:"d",joinDate:"j",monthlyInvoice:"m",nextBillingDate:"o",planID:"h",picture:"p",premiumCode:"k",premiumSignupDate:"q",premiumEndDate:"r",premiumStatus:"s",subscriptionID:"v",trialDuration:"u",trialExtended:"w",trialStart:"t",isUnsubscribed:"y",appleIAPPlan:"z",appleIAPTransactionId:"aa"},o=n(i),s={items:!0},l={dateCreated:"c",dateCompleted:"e",dateModified:"d",date:"b",flags:"f",id:"id",index:"i",isArchived:"r",isDeleted:"x",note:"n",parent:"p",pendingSync:"m",text:"t",docId:"o",isRoot:"q",itemLinks:"l",regexpFlags:"g",oldDocId:"h"},u=n(l),c={id:"id",accountID:"a",text:"t",emails:"e",phoneNumbers:"p"},d=n(c),h={id:"id",data:"a",cmpData:"b",dateCreated:"c",dateModified:"d",dateCompleted:"f",plugin:"l",docId:"o",parent:"p",notInDoc:"e",itemId:"i",isComplete:"x",isRead:"r",origin:"g"},f=n(h),p={service:"s",accountID:"a",subject:"t",plaintext:"p",date:"d",contacts:"c",snippet:"n",labels:"l",numMessages:"m",hasAttachment:"h"},g=n(p),m={validateInFields:function(e,t){return!(t&&(!e.id||"undefined"===e.id))&&(Object.keys(e).forEach((function(e){if(e.length<2||"undefined"===e)return!1})),!0)},validateOutFields:function(e,t){return!(t&&(!e.id||"undefined"===e.id))&&(Object.keys(e).forEach((function(e){if(e.length>2||"undefined"===e)return!1})),!0)},itemFieldMapIn:u,itemFieldMapOut:l,documentIn:function(e){return{id:e.id,acl:e.a,dateModified:e.p.d,text:e.p.t,encryptionSentinel:e.p.s,root:e.r,version:e.v,pendingSync:e.m,backups:e.c,isDeleted:e.p.x,itemsPlaintext:e.z}},documentOut:function(e,t){var a={id:e.id,p:{t:e.text}};return e.isDeleted&&(a.p.x=e.isDeleted),e.dateModified&&(a.p.d=e.dateModified),e.encryptionSentinel&&(a.p.s=e.encryptionSentinel),t&&t.onlyUpdate||(a.a=e.acl,a.r=e.root,a.v=e.version),t&&t.forLocal&&e.pendingSync&&(a.m=e.pendingSync),a},documentInFlat:function(e,t){return{id:e.id,acl:e.a,dateModified:e.d,text:e.t,encryptionSentinel:e.s,root:e.r,version:e.v,pendingSync:e.m,backups:e.c,isDeleted:e.x}},documentOutFlat:function(e,t){var a={id:e.id,d:e.dateModified,t:e.text,x:e.isDeleted};return e.encryptionSentinel&&(a.s=e.encryptionSentinel),t||(a.a=e.acl,a.r=e.root,a.v=e.version),e.pendingSync&&(a.m=e.pendingSync),a},userIn:function(e){var t={};return Object.keys(e).forEach((function(a){o[a]&&"undefined"!==o[a]&&(t[o[a]]=e[a])})),t},userOut:function(e){var t={};return Object.keys(e).forEach((function(a){i[a]&&void 0!==i[a]&&"undefined"!==i[a]&&(t[i[a]]=e[a])})),t},itemIn:function(e){var t={};return Object.keys(e).forEach((function(a){u[a]&&"undefined"!==u[a]&&(t[u[a]]=e[a])})),t},itemOut:function(e){var t={};return Object.keys(e).forEach((function(a){void 0!==e[a]&&!s[a]&&l[a]&&"undefined"!==l[a]&&(t[l[a]]=e[a])})),t},decryptItem:function(e,t,a){return e.text?t.decryptText(a,e.text,e.id).then((function(t){return e.text=t,e})):Promise.resolve(e)},encryptItem:function(e,t,a){return e.text?t.encryptText(a,e.text,e.id).then((function(t){return e.text=t,e})):Promise.resolve(e)},encryptItemOut:function(e,t,a){return m.encryptItem(e,t,a).then((function(e){return m.itemOut(e)}))},decryptItemIn:function(e,t,a){return e=m.itemIn(e),m.decryptItem(e,t,a)},boardIn:function(e){var t=Object.assign({},e);return r(e.panes)&&(t.panes=JSON.parse(e.panes)),r(e.defaultPanes)&&(t.defaultPanes=JSON.parse(e.defaultPanes)),t},boardOut:function(e){var t=Object.assign({},e);return e.panes&&(t.panes=JSON.stringify(e.panes)),e.defaultPanes&&(t.defaultPanes=JSON.stringify(e.defaultPanes)),t},compareItemIndex:function(e,t){var a=0,n=null!==e.index?e.index:0,r=null!==t.index?t.index:0;if(void 0===n||void 0===r)return 0;"number"===typeof n&&(n=""+n),"number"===typeof r&&(r=""+r);for(var i=n.split(","),o=r.split(","),s=0;s<i.length;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(void 0===o[s])return 1;var l=+i[s],u=+o[s];if(l!==u)return l-u}return-1},_baseIn:function(e,t,a){if(e[a]){var n={};return Object.keys(e).forEach((function(a){t[a]&&"undefined"!==t[a]&&(n[t[a]]=e[a])})),n}return e},_baseOut:function(e,t){var a={};return Object.keys(e).forEach((function(n){t[n]&&void 0!==t[n]&&"undefined"!==t[n]&&(a[t[n]]=e[n])})),a},contactIn:function(e){return m._baseIn(e,d,"t")},contactOut:function(e){return m._baseOut(e,c)},pluginIn:function(e){return m._baseIn(e,f,"a")},pluginOut:function(e){return m._baseOut(e,h)},emailMetaDataIn:function(e){var t,a=m._baseIn(e,g,"a");return a.contacts=(null===(t=e.c)||void 0===t?void 0:t.map((function(e){return{text:e.t,email:e.e}})))||[],a},emailMetaDataOut:function(e){var t=m._baseOut(e,p);return t.c=e.contacts.map((function(e){return m.removeNullUndefined({t:e.text,e:e.email})})),t},removeNullUndefined:function(e){var t={};return Object.keys(e).forEach((function(a){null!==e[a]&&void 0!==e[a]&&(t[a]=e[a])})),t}};t.a=m},,,function(e,t,a){"use strict";var n,r,i=a(7),o=a.n(i),s=a(8),l=a.n(s),u=a(0),c=a(10),d=a.n(c),h=a(11),f=a(2),p=(n=function(){function e(t,a){o()(this,e),this._batchConstructor=t,this._batchParams=a,this._batchedRequests={},this._successCB=u.default.emptyFn,this._failureCB=u.default.emptyFn,this._context=void 0,this._hasRun=!1,this._batchID=u.default.generateTempId()}return l()(e,[{key:"add",value:function(e,t,a){try{u.default.PAssert(1322,e,"Must provide a valid request to add to batch")}catch(r){u.default.reportError(r)}try{u.default.PAssert(1323,t,"Must supply a valid group ID when adding to a batch")}catch(r){u.default.reportError(r)}try{u.default.PAssert(1324,!this._hasRun,"Should never add new requests to a batch that has already run")}catch(r){u.default.reportError(r)}var n=this._ensureGroup(t);return this._addRequestToGroup(t,a,e),n}},{key:"then",value:function(e,t,a){this._successCB=e||u.default.newEmptyFn(),this._failureCB=t||u.default.newEmptyFn(),this._context=a,this._run()}},{key:"execute",value:function(e){this._successCB=e,this._failureCB=e,this._run()}},{key:"getBatchID",value:function(){return this._batchID}},{key:"_ensureGroup",value:function(e){var t=!1;return this._batchedRequests[e]||(this._batchedRequests[e]={size:0,batch:this._createBatchInternal()},t=!0),t}},{key:"_addRequestToGroup",value:function(e,t,a){var n=this._getGroupBatch(e),r=this._getGroupSize(e);try{u.default.PAssert(1325,r<=f.a.MaxBatchSize,"Too many requests for a single batch")}catch(i){u.default.reportError(i)}t?n.add(a,{id:t}):n.add(a)}},{key:"_getGroupBatch",value:function(e){try{u.default.PAssert(1326,this._batchedRequests[e],"Must ensure before querying")}catch(t){u.default.reportError(t)}return this._batchedRequests[e].batch}},{key:"_getGroupSize",value:function(e){try{u.default.PAssert(1327,this._batchedRequests[e],"Must ensure before querying")}catch(t){u.default.reportError(t)}return this._batchedRequests[e].size}},{key:"_run",value:function(){try{u.default.PAssert(1328,!this._hasRun,"Should never run a batch twice")}catch(t){u.default.reportError(t)}for(var e in this._hasRun=!0,this._batchedRequests){this._getGroupBatch(e).then(this._handleSuccess,this._handleFailure)}}},{key:"_createBatchInternal",value:function(){return new this._batchConstructor(this._batchParams)}},{key:"_handleSuccess",value:function(e){try{u.default.PAssert(1329,this._hasRun,"Must run batch before success")}catch(t){u.default.reportError(t)}this._successCB.call(this._context,e)}},{key:"_handleFailure",value:function(e){try{u.default.PAssert(1330,this._hasRun,"Must run batch before failure")}catch(t){u.default.reportError(t)}this._failureCB.call(this._context,e)}}]),e}(),d()(n.prototype,"_handleSuccess",[h.a],Object.getOwnPropertyDescriptor(n.prototype,"_handleSuccess"),n.prototype),d()(n.prototype,"_handleFailure",[h.a],Object.getOwnPropertyDescriptor(n.prototype,"_handleFailure"),n.prototype),n),g=a(5),m=a.n(g),v=a(12),y=a.n(v),k=a(34),_=function(){function e(t){var a=t.path,n=t.type,r=t.data,i=t.headers,s=t.accountID,l=t.scopes;o()(this,e),this.numRetries=0,this.path=a,this.type=n,this.data=r,this.headers=i,this.accountID=s,this.scopes=l}return l()(e,[{key:"setInBatch",value:function(e){this.idInBatch=e}},{key:"getAuthorizationHeader",value:function(){var e=y()(m.a.mark((function e(){var t=this;return m.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(this.accessToken){e.next=4;break}return e.next=3,new Promise((function(e){return k.a.getAccountAuthToken(t.accountID,t.scopes,(function(t){return e(null===t||void 0===t?void 0:t.access_token)}))}));case 3:this.accessToken=e.sent;case 4:return e.abrupt("return",this.accessToken?"Bearer "+this.accessToken:void 0);case 5:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"then",value:function(){var e=y()(m.a.mark((function e(t,a){var n=this;return m.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.idInBatch){e.next=5;break}this.onFullfilled=t,this.onRejected=a,e.next=13;break;case 5:if(this.headers||(this.headers={}),this.headers["Content-Type"]||(this.headers["Content-Type"]="application/json"),this.headers.Authorization){e.next=11;break}return e.next=10,this.getAuthorizationHeader();case 10:this.headers.Authorization=e.sent;case 11:this.data&&u.default.isObject(this.data)&&(this.data=JSON.stringify(this.data)),u.default.XHR({url:"https://www.googleapis.com".concat(this.path),type:this.type,data:this.data,headers:this.headers}).then(function(){var e=y()(m.a.mark((function e(r){var i,o,s,l,u;return m.a.wrap((function(e){for(var c=0,d=0;;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:if(!r.text){e.next=5;break}return e.next=3,r.text();case 3:i=e.sent;try{(i&&"{"===i[0]||"["===i[0])&&(o=JSON.parse(i))}catch(h){}case 5:r.error?a(r.error):(null===(s=o)||void 0===s||null===(l=s.error)||void 0===l||null===(u=l.message)||void 0===u?void 0:u.startsWith("Request had invalid authentication credentials."))&&n.numRetries<5?n.retry(t,a):t({body:i,status:r.status,result:o,headers:n.headers});case 6:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}(),a);case 13:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"retry",value:function(e,t){var a=this;this.numRetries++,this.headers.Authorization=void 0,this.accessToken=void 0,setTimeout((function(){a.then(e,t)}),5e3)}},{key:"resolve",value:function(e){this.onFullfilled(e)}},{key:"reject",value:function(e){this.onRejected(e)}}]),e}(),b="MOOBOUNDARY",w=(r=function(){function e(t){var a=t.accountID,n=t.scopes;o()(this,e),this.requests={},this.accountID=a,this.scopes=n}return l()(e,[{key:"add",value:function(e,t){var a=t.id;this.requests[a]=e,e.setInBatch(a)}},{key:"then",value:function(){var e=y()(m.a.mark((function e(t,a){var n,r,i,o,s=this;return m.a.wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:return this.onFulfilled=t,this.onRejected=a,n=this.requests[Object.keys(this.requests)[0]],this.requests,r="",e.next=7,n.getAuthorizationHeader();case 7:i=e.sent,Object.keys(this.requests).forEach((function(e){var t=s.requests[e],a="--".concat(b,"\n");a+="Content-Type: application/http\n",a+="Content-ID: <".concat(t.idInBatch,">\n");var n=t.type+" "+t.path+"\n";"GET"!==t.type&&(t.headers&&(t.headers["Content-Type"]||(t.headers["Content-Type"]="application/json"),n+=Object.keys(t.headers).map((function(e){if("Authorization"!==e)return"".concat(e,": ").concat(t.headers[e],"\n")})).filter((function(e){return!!e})).join("")+"\n"),t.data&&(n+=JSON.stringify(t.data))),r+=a+="\n"+n+"\n",o||(o=t.path.split("/").slice(1,3).join("/"))})),r+="--".concat(b,"--");try{u.default.PAssert(1321,o&&"v"===o[o.length-2],"batch root does not have a version")}catch(c){u.default.reportError(c)}new _({path:"/batch/".concat(o),type:"POST",data:r,headers:{Authorization:i,"Content-Type":'multipart/mixed; boundary="MOOBOUNDARY"'},accountID:this.accountID,scopes:this.scopes}).then(this._handleSuccess,this._handleFail);case 13:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"_handlePart",value:function(e){var t,a;try{var n=e.substring(e.indexOf("{"),e.lastIndexOf("}")+1);t=e.match(/Content-ID: <response-([^>]+)>/)[1],a=e.match(/204 No Content/)?{status:204}:JSON.parse(n),e.includes('WWW-Authenticate: Bearer realm="https://accounts.google.com/", error=invalid_token')&&(a.isInvalidToken=!0),this.requests[t].resolve({result:a})}catch(r){t&&this.requests[t].reject({errors:[{message:e}]})}}},{key:"_handleSuccess",value:function(){var e=y()(m.a.mark((function e(t){var a,n,r;return m.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:a=t.body.trim(),n=a.substr(0,a.indexOf("\r\n")),(r=a.split(n)).shift(),r.pop(),r.forEach(this._handlePart),this.onFulfilled();case 5:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_handleFail",value:function(e){this.onRejected(e)}}]),e}(),d()(r.prototype,"_handlePart",[h.a],Object.getOwnPropertyDescriptor(r.prototype,"_handlePart"),r.prototype),d()(r.prototype,"_handleSuccess",[h.a],Object.getOwnPropertyDescriptor(r.prototype,"_handleSuccess"),r.prototype),d()(r.prototype,"_handleFail",[h.a],Object.getOwnPropertyDescriptor(r.prototype,"_handleFail"),r.prototype),r),S=function(){function e(){o()(this,e),this._data={gapi:{client:{drive:{files:{get:{path:"/drive/v2/files/{fileId}",method:"GET",packedFn:["gapi","client","drive","files","get"]},export:{path:"/drive/v2/files/{fileId}/export",method:"GET",packedFn:["gapi","client","drive","files","export"]},list:{path:"/drive/v2/files",method:"GET",packedFn:["gapi","client","drive","files","list"]},trash:{path:"/drive/v2/files/{fileId}/trash",method:"POST",packedFn:["gapi","client","drive","files","trash"]},untrash:{path:"/drive/v2/files/{fileId}/untrash",method:"POST",packedFn:["gapi","client","drive","files","untrash"]},insert:{path:"/drive/v2/files",method:"POST",packedFn:["gapi","client","drive","files","insert"]},patch:{path:"/drive/v2/files/{fileId}",method:"PATCH",packedFn:["gapi","client","drive","files","patch"]}},permissions:{list:{path:"/drive/v2/files/{fileId}/permissions",method:"GET",packedFn:["gapi","client","drive","permissions","list"]},insert:{path:"/drive/v2/files/{fileId}/permissions",method:"POST",packedFn:["gapi","client","drive","permissions","insert"]},delete:{path:"/drive/v2/files/{fileId}/permissions/{permissionId}",method:"DELETE",packedFn:["gapi","client","drive","permissions","delete"]}},properties:{insert:{path:"/drive/v2/files/{fileId}/properties",method:"POST",packedFn:["gapi","client","drive","properties","insert"]},update:{path:"/drive/v2/files/{fileId}/properties/{propertyKey}",method:"PUT",packedFn:["gapi","client","drive","properties","update"]}},parents:{insert:{path:"/drive/v2/files/{fileId}/parents",method:"POST",packedFn:["gapi","client","drive","parents","insert"]},delete:{path:"/drive/v2/files/{fileId}/parents/{parentId}",method:"DELETE",packedFn:["gapi","client","drive","parents","delete"]}},changes:{list:{path:"/drive/v2/changes",method:"GET",packedFn:["gapi","client","drive","changes","list"]}},children:{list:{path:"/drive/v2/files/{folderId}/children",method:"GET",packedFn:["gapi","client","drive","children","list"]},delete:{path:"/drive/v2/files/{folderId}/children/{childId}",method:"DELETE",packedFn:["gapi","client","drive","children","delete"]}},realtime:{get:{path:"/drive/v2/files/{fileId}/realtime",method:"GET",packedFn:["gapi","client","drive","realtime","get"]}}},gmail:{users:{threads:{list:{path:"/gmail/v1/users/{userId}/threads",method:"GET",packedFn:["gapi","client","gmail","users","threads","list"]},get:{path:"/gmail/v1/users/{userId}/threads/{id}",method:"GET",packedFn:["gapi","client","gmail","users","threads","get"]},modify:{path:"/gmail/v1/users/{userId}/threads/{id}/modify",method:"POST",packedFn:["gapi","client","gmail","users","threads","modify"]},trash:{path:"/gmail/v1/users/{userId}/threads/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","threads","trash"]},untrash:{path:"/gmail/v1/users/{userId}/threads/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","threads","untrash"]}},labels:{list:{path:"/gmail/v1/users/{userId}/labels",method:"GET",packedFn:["gapi","client","gmail","users","labels","list"]},create:{path:"/gmail/v1/users/{userId}/labels",method:"POST",packedFn:["gapi","client","gmail","users","labels","create"]}},history:{list:{path:"/gmail/v1/users/{userId}/history",method:"GET",packedFn:["gapi","client","gmail","users","history","list"]}},messages:{get:{path:"/gmail/v1/users/{userId}/messages/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","get"]},send:{path:"/gmail/v1/users/{userId}/messages/send",method:"POST",packedFn:["gapi","client","gmail","users","messages","send"]},trash:{path:"/gmail/v1/users/{userId}/messages/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","messages","trash"]},untrash:{path:"/gmail/v1/users/{userId}/messages/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","messages","untrash"]},attachments:{get:{path:"/gmail/v1/users/{userId}/messages/{messageId}/attachments/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","attachments","get"]}}},drafts:{create:{path:"/gmail/v1/users/{userId}/drafts",method:"POST",packedFn:["gapi","client","gmail","users","drafts","create"]},update:{path:"/gmail/v1/users/{userId}/drafts/{id}",method:"PUT",packedFn:["gapi","client","gmail","users","drafts","update"]},send:{path:"/gmail/v1/users/{userId}/drafts/send",method:"POST",packedFn:["gapi","client","gmail","users","drafts","send"]},delete:{path:"/gmail/v1/users/{userId}/drafts/delete",method:"DELETE",packedFn:["gapi","client","gmail","users","drafts","delete"]},list:{path:"/gmail/v1/users/{userId}/drafts",method:"GET",packedFn:["gapi","client","gmail","users","drafts","list"]}},settings:{sendAs:{list:{path:"/gmail/v1/users/{userId}/settings/sendAs",method:"GET",packedFn:["gapi","client","gmail","users","settings","sendAs","list"]}}}}},calendar:{settings:{list:{path:"/calendar/v3/users/{userId}/settings",method:"GET",packedFn:["gapi","client","calendar","settings","list"]}},events:{get:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"GET",packedFn:["gapi","client","calendar","events","get"]},list:{path:"/calendar/v3/calendars/{calendarId}/events",method:"GET",packedFn:["gapi","client","calendar","events","list"]},patch:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"PATCH",packedFn:["gapi","client","calendar","events","patch"]},insert:{path:"/calendar/v3/calendars/{calendarId}/events",method:"POST",packedFn:["gapi","client","calendar","events","insert"]},move:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}/move",method:"POST",packedFn:["gapi","client","calendar","events","move"]},delete:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"DELETE",packedFn:["gapi","client","calendar","events","delete"]}},calendars:{insert:{path:"/calendar/v3/calendars",method:"POST",packedFn:["gapi","client","calendar","calendars","insert"]}},calendarList:{list:{path:"/calendar/v3/users/{userId}/calendarList",method:"GET",packedFn:["gapi","client","calendar","calendarList","list"]}}}}}}}return l()(e,[{key:"fns",value:function(e){return this._data.gapi.client[e]}},{key:"_constructPath",value:function(e,t){var a=u.default.clone(t);return Object.keys(t).forEach((function(n){var r=new RegExp("\\{"+n+"\\}"),i=e.replace(r,encodeURIComponent(t[n]));i!==e&&delete a[n],e=i})),delete a.resource,delete a.timeoutMS,delete a.forceNoDupe,{path:e,fields:a}}},{key:"_constructHeaders",value:function(e,t,a){try{u.default.PAssert(1037,t||a,"Must have either accountID or token")}catch(r){u.default.reportError(r)}var n={};return a&&(n.Authorization="Bearer "+a),e&&Object.keys(e).forEach((function(t){n[t]=e[t]})),n}},{key:"canConstruct",value:function(e){var t=!1;return u.default.isFunction(e)||(t=!!u.default.unpackFn(e,this._data)),t}},{key:"createRequest",value:function(e,t,a,n,r){var i,o=u.default.unpackFn(t,this._data);try{u.default.PAssert(1038,o,"Function should always be unpackable")}catch(d){u.default.reportError(d)}if(o){var s=this._constructPath(o.path,a),l=this._constructHeaders(o.headers,e,n),c={path:s.path,type:o.method||"GET",params:s.fields,data:a.resource,headers:l,accountID:e,scopes:r};i=this._sendRequest(c)}return i}},{key:"getAPIForRequest",value:function(e){try{u.default.PAssert(1039,u.default.isDemoMode(),"Must only reverse the path in demo mode")}catch(t){u.default.reportError(t)}return u.default.unpackFn(e.__packedFn)}},{key:"_sendRequest",value:function(e){var t=e.path,a=e.type,n=e.data,r=e.headers,i=e.params,o=e.accountID,s=e.scopes,l=Object.keys(i).filter((function(e){return void 0!==i[e]})).map((function(e){return"".concat(e,"=").concat(escape(i[e]))}));return l.length>0&&(t+="?"+l.join("&")),new _({accountID:o,scopes:s,path:t,type:a,data:n,headers:r})}},{key:"createBatch",value:function(e){return new p(w,e)}}]),e}();t.a=new S},function(e,t,a){"use strict";a.r(t),a.d(t,"ClassNameTopBarTitle",(function(){return d})),a.d(t,"TopBar",(function(){return h})),a.d(t,"TopBarIconButton",(function(){return f})),a.d(t,"TopBarTextButton",(function(){return p})),a.d(t,"SettingsHeading",(function(){return g})),a.d(t,"SettingsRow",(function(){return v}));var n=a(2),r=a(0),i=a(3),o=a.n(i),s=a(92),l=a(72),u=a(57),c=n.a.Mobile.TopBarHeight,d="text-15 pl-1",h=function(e){var t=e.children,a={boxShadow:Object(s.a)().paneShadow(),height:c,minHeight:c};return o.a.createElement("div",{className:"flex items-center c-background z-1",style:a},t)},f=function(e){var t=e.icon,a=e.className,n=e.disabled,r=e.onPress;return o.a.createElement(u.a,{className:a,icon:t,iconSize:24,width:c,height:c,disabled:n,onPress:r})},p=function(e){var t=e.text,a=e.className,n=e.mode,i=e.onPress;return o.a.createElement(u.a,{className:r.default.classNames("px-3",a),text:t,mode:n,height:c,onPress:i})},g=function(e){var t=e.text;return o.a.createElement("div",{className:"pt-6 pb-2 pl-4 c-foreground-light text-12"},t)},m={height:48},v=function(e){var t=e.text,a=e.children,n=e.last,i=e.icon,s=e.iconSize,u=e.onPress;return o.a.createElement("div",{className:r.default.classNames("flex c-background c-foreground pl-4 pr-2 items-center c-border border-t",{"border-b":n}),style:m,onClick:u},o.a.createElement("div",{className:"flex items-center flex-1"},i&&o.a.createElement(l.a,{name:i,size:s||18,className:t?"mr-2":void 0}),t),a)}},function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(24),l=a.n(s),u=a(20),c=a.n(u),d=a(21),h=a.n(d),f=a(13),p=a.n(f),g=a(0);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=p()(e);if(t){var r=p()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return h()(this,a)}}var v=function(e){c()(a,e);var t=m(a);function a(e,n,i){var o;return r()(this,a),(o=t.call(this,e,n,i))._value=e||[],o.version=0,o}return o()(a,[{key:"notify",value:function(e,t,n){0===arguments.length&&this.version++,l()(p()(a.prototype),"notify",this).apply(this,arguments)}},{key:"length",value:function(){return this._value.length}},{key:"set",value:function(e,t){try{g.default.PAssert(211,e&&g.default.isArray(e),"Value set on an Observable array must be an array",e)}catch(a){g.default.reportError(a)}return this._value=e,this.version++,!1!==t&&this.notify(this._value),e}},{key:"clear",value:function(e){this.set([],e)}},{key:"pop",value:function(e){this.version++;var t=this._value.pop();return!1!==e&&this.notify(this._value),t}},{key:"remove",value:function(e,t){var a;if(g.default.isFunction(e))for(var n=0,r=0;r<this._value.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e(this._value[r])&&(void 0===a&&(a=r),this._value.splice(r,1),r--)}else a=this._value.remove(e);return this.version++,a>=0&&!1!==t&&this.notify(this._value),a}},{key:"removeAt",value:function(e,t){var a=this._value.removeAt(e);return this.version++,!1!==t&&this.notify(this._value),a}},{key:"push",value:function(e,t){var a=this._value.push(e);return this.version++,!1!==t&&this.notify(this._value),a}},{key:"pushArray",value:function(e,t){var a=this._value.pushArray(e);return this.version++,!1!==t&&this.notify(this._value),a}},{key:"insertSorted",value:function(e,t,a){var n=this._value.insertSorted(e,t);return this.version++,!1!==a&&this.notify(this._value),n}},{key:"sort",value:function(e,t){return this._value.sort(e),this.version++,!1!==t&&this.notify(this._value),this}},{key:"splice",value:function(e,t,a,n){var r;return r=a?this._value.splice(e,t,a):this._value.splice(e,t),this.version++,!1!==n&&this.notify(this._value),r}},{key:"indexOf",value:function(e){return this._value.indexOf(e)}},{key:"indexOfWithProperty",value:function(e,t){return this._value.indexOfWithProperty(e,t)}},{key:"includes",value:function(e){return this._value.includes(e)}},{key:"some",value:function(e){return this._value.some(e)}},{key:"forEach",value:function(e){return this._value.forEach(e)}},{key:"map",value:function(e){return this._value.map(e)}},{key:"find",value:function(e){return this._value.find(e)}},{key:"findIndex",value:function(e){return this._value.findIndex(e)}},{key:"hasValue",value:function(){return this._value.length>0}}]),a}(a(15).a);t.a=v},,,function(e,t,a){"use strict";a.d(t,"b",(function(){return T})),a.d(t,"a",(function(){return M}));var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(60),l=a.n(s),u=a(20),c=a.n(u),d=a(21),h=a.n(d),f=a(13),p=a.n(f),g=a(53),m=a.n(g),v=a(2),y=a(0),k=a(3),_=a(4),b=a(26),w=a(27),S=a(15),D=a(42),P=a(62);function I(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=p()(e);if(t){var r=p()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return h()(this,a)}}var E=0;function C(e,t){return e===t?0!==e||1/e===1/t:e!==e&&t!==t}var x=function(e,t,a){var n=0;if(C(e,t))return!0;if("object"!==m()(e)||null===e||"object"!==m()(t)||null===t)return!1;var r,i=Object.keys(e),o=Object.keys(t);if(i.length!==o.length)return!1;for(var s=0;s<i.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r=void 0,!hasOwnProperty.call(t,i[s]))return!1;if(a&&!1===(r=a(i[s],e[i[s]],t[i[s]])))return!1;if(void 0===r&&!C(e[i[s]],t[i[s]]))return!1}return!0},A={constructor:!0,render:!0,componentDidMount:!0,componentWillReceiveProps:!0,UNSAFE_componentWillReceiveProps:!0,shouldComponentUpdate:!0,componentWillUpdate:!0,componentDidUpdate:!0,componentWillUnmount:!0},T=function(){return k.useMemo((function(){return"m_"+E++}),[])},M=function(e){c()(a,e);var t=I(a);function a(e){var n;r()(this,a),n=t.call(this,e);var i=Object.getPrototypeOf(l()(n)),o=Object.getOwnPropertyNames(i).concat(Object.getOwnPropertyNames(i.__proto__)),s=[l()(n)].concat(y.default.arrayDifference(o,A));return b.a.binder.apply(b.a,s),n.state=n.getInitialState(),n}return o()(a,[{key:"shouldComponentUpdate",value:function(e,t){return!x(this.props,e,this.arePropsEqual)||!x(this.state,t,this.areStatesEqual)}},{key:"getInitialState",value:function(){this.init&&this.init();var e=this.getState?this.getState(this.props):{};this._observables&&(e=y.default.extend(e,this._observables));var t=null;return e&&(this.setupListeners(e),t=this.transformState(e)),t}},{key:"createObservables",value:function(e){try{y.default.PAssert(530,!this._listeners,"You have to run createObservables in init()")}catch(n){y.default.reportError(n)}for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];y.default.isArray(a)?e[t]=new D.a(a):e[t]=new S.a(a);try{y.default.PAssert(531,!this.hasOwnProperty(t),"Must not multi-define observable properties")}catch(n){y.default.reportError(n)}this[t]=e[t]}try{y.default.PAssert(532,!this.hasOwnProperty("_observables"),"Must not define an _observables property and use createObservables")}catch(n){y.default.reportError(n)}this._observables=e}},{key:"_addListener",value:function(e){try{y.default.PAssert(533,e&&e.target,"Must add a valid listener")}catch(t){y.default.reportError(t)}this._ensureListeners();try{y.default.PAssert(534,!this._hasListener(e.target),"Must not double register the same observable/trigger")}catch(t){y.default.reportError(t)}this._listeners.push(e)}},{key:"refreshListeners",value:function(e){this.disposeListeners();var t=this.getState?this.getState(e||this.props):{};this._observables&&(t=y.default.extend(t,this._observables)),t&&this.setupListeners(t)}},{key:"_ensureListeners",value:function(){this._listeners||(this._listeners=[],this._permanentListeners=[])}},{key:"setupListeners",value:function(e){for(var t in this._ensureListeners(),e||(e=this.getState?this.getState(this.props):{}),e)if(e.hasOwnProperty(t)){var a=e[t];a instanceof S.a&&this._addListener(a.listen(this.onListener))}}},{key:"disposeListeners",value:function(e){if(this._listeners){for(var t=0,a=0;a<this._listeners.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._listeners[a].dispose()}if(this._listeners=[],e)for(var n=0,r=0;r<this._permanentListeners.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this._permanentListeners[r].dispose()}}e&&this.disposeDispatcherListeners()}},{key:"disposeDispatcherListeners",value:function(){if(this._dispatcherListeners){for(var e=0,t=0;t<this._dispatcherListeners.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._dispatcherListeners[t],n=a[0],r=a.slice(1);n.unlisten.apply(n,r)}this._dispatcherListeners=[]}}},{key:"listenTo",value:function(e,t){try{y.default.PAssert(535,e&&(e instanceof P.a||e instanceof S.a),"Can only listen to an Observable or a Trigger object")}catch(n){y.default.reportError(n)}if(e instanceof P.a||e instanceof S.a){var a=e.listen(this.onListener);!1!==t?this._addListener(a):this._permanentListeners.push(a)}}},{key:"listenToDispatcher",value:function(e,t){this._dispatcherListeners||(this._dispatcherListeners=[]);var a,n=Array.prototype.slice.call(arguments);y.default.isString(n[0])?a=w.a:(a=n[0],n.splice(0,1)),n.push(this.onListener),a.listen.apply(a,n);var r=[a].concat(n);this._dispatcherListeners.push(r)}},{key:"_hasListener",value:function(e){var t=0;try{y.default.PAssert(536,e,"Must have a valid target")}catch(r){y.default.reportError(r)}for(var a=!1,n=0;n<this._listeners.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this._listeners[n].target===e){a=!0;break}}return a}},{key:"_getState",value:function(e){var t=this.getState?this.getState(e||this.props):{};return this._observables&&(t=y.default.extend(t,this._observables)),this.transformState(t)}},{key:"transformState",value:function(e){for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];a&&a instanceof S.a&&(e[t]=a.get(),a instanceof D.a&&(e[t+"_arrVer"]=a.version))}return e}},{key:"onListener",value:function(){this.updateState()}},{key:"updateState",value:function(e){var t=this.state,a=this._getState(e);if(this.onBeforeChanged){var n=this.onBeforeChanged(a,t);void 0!==n&&(a=n)}!1!==a&&(this.setState(a),this.onAfterChanged&&this.onAfterChanged(a,t))}},{key:"componentWillUnmount",value:function(){this.disposeListeners(!0),this.__hotkeys&&(_.default.hotkeys.popStack(this.__hotkeys),this.__hotkeys=void 0),this.onUnmount&&this.onUnmount(this.state),this._isMounted=!1}},{key:"getChildByKey",value:function(e){return y.default.getReactChildByKey(this.props.children,e)}},{key:"componentDidMount",value:function(){this._isMounted=!0,this.getHotkeys?this.__hotkeys=_.default.hotkeys.pushStack(this.getHotkeys()):this.onEscapeKey&&(this.__hotkeys=_.default.hotkeys.pushStackEscape(this.onEscapeKey)),this.onMount&&this.onMount()}},{key:"getUniqueID",value:function(){return this.props["data-moo-id"]?this.props["data-moo-id"]:(this.__id||(this.__id="m_"+E++),this.__id)}},{key:"componentDidCatch",value:function(e,t){this.onComponentError&&this.onComponentError(e,t),y.default.reportError(e,t,void 0,"React Component Error: "),_.default.toasts.pushMessage(v.a.MessageID.ReactError)}}]),a}(k.Component)},function(e,t,a){"use strict";var n=a(176);a(271),a(307),a(275);t.a=n.a},,function(e,t,a){"use strict";var n,r=a(7),i=a.n(r),o=a(8),s=a.n(o),l=a(24),u=a.n(l),c=a(20),d=a.n(c),h=a(21),f=a.n(h),p=a(13),g=a.n(p),m=a(0),v=a(2),y=a(10),k=a.n(y),_=a(11),b=a(4),w=a(26),S=a(18),D=a(113),P=a(27),I=(n=function(){function e(){i()(this,e),this.undoStack=[],this.redoStack=[],this.isUndoing=!1,this._deleteSelection=void 0,this._batch=[],this.__numInBatch=0,this._batchPrevSel=void 0,this._groupTextChanges=!1,this._needsSelection=!1,w.a.binder(this,"_onSelectionChanged"),P.a.listen("selectionChanged",this._onSelectionChanged)}return s()(e,[{key:"_getLastState",value:function(){return this.undoStack[this.undoStack.length-1]}},{key:"_getLastAction",value:function(){var e=this.undoStack[this.undoStack.length-1];if(e&&1===e.actions.length)return e.actions[0]}},{key:"pushModified",value:function(e,t,a){if(!this.isUndoing){var n=Object.keys(t).filter((function(e){return"id"!==e&&"regexpFlags"!==e})).length;if(n>0){var r=!1;if("text"in t){var i=this._getLastAction(),o=this._getLastState();this._needsSelection=!0,this._groupTextChanges&&o&&i&&i.changes.text&&i.itemId===e.id&&(i.changes.text=t.text,r=1===n)}r||this._doPush(e,{itemId:e.id,type:"Modified",changes:t,prevState:a}),this.clearDeleteSelection()}}}},{key:"pushAdded",value:function(e,t){try{m.default.PAssert(356,void 0!==t.index,"Item should have index when adding")}catch(a){m.default.reportError(a)}this.isUndoing||(this._doPush(t,{itemId:t.id,type:"Added",changes:{parent:e.id,index:t.index}}),this.clearDeleteSelection())}},{key:"pushRemoved",value:function(e,t){try{m.default.PAssert(357,void 0!==t.index,"Item should have index when removing")}catch(a){m.default.reportError(a)}this.isUndoing||(this._doPush(t,{itemId:t.id,type:"Removed",changes:{parent:e.id,index:t.index}},this._deleteSelection),this.clearDeleteSelection())}},{key:"clearDeleteSelection",value:function(){this.__numInBatch<=0&&(this._deleteSelection=void 0)}},{key:"_doAction",value:function(e){if(!this.isUndoing)try{var t=e?this.redoStack:this.undoStack,a=e?this.undoStack:this.redoStack,n=t.pop();if(n){var r=n.actions;try{m.default.PAssert(358,r.length>0,"Undo state should have some actions")}catch(i){m.default.reportError(i)}r.length>0&&(this.isUndoing=!0,b.default.PaneUpdateBatcher.beginUpdateItems(),m.default.focusedPane.clearPreventUpdate(),r.forEach((function(t){var a=t.type,n=a===v.a.CrudActions.Added||a===v.a.CrudActions.Removed||e?t.changes:t.prevState;Object.keys(n).forEach((function(e){void 0===n[e]&&(n[e]=null)})),e?a===v.a.CrudActions.Added?n.isDeleted=!1:a===v.a.CrudActions.Removed&&(n.isDeleted=!0):a===v.a.CrudActions.Added?(a=v.a.CrudActions.Removed,n.isDeleted=!0):a!==v.a.CrudActions.Removed&&null!==n.isDeleted||(a=v.a.CrudActions.Added,n.isDeleted=!1);var r=S.a.getItem(t.itemId);if(r){var i=r.getDocumentOwner(),o=S.a.getItemDataLocal(i,t.itemId);D.a.onRemoteChange(i,o,t.itemId,n),S.a.saveItem(r,n,v.a.ChangeType.Local,v.a.SaveFlag.All)}})),b.default.PaneUpdateBatcher.commitUpdateItems(),this.restoreSelFromState(e,n),a.push(n))}}finally{this.isUndoing=!1}}},{key:"restoreSelFromState",value:function(e,t){}},{key:"undo",value:function(){this._doAction(!1)}},{key:"redo",value:function(){this._doAction(!0)}},{key:"_onSelectionChanged",value:function(e){var t=this._getLastState();t&&this._needsSelection?(this._needsSelection=!1,t.selection=e,this._groupTextChanges=!0):this._groupTextChanges=!1}},{key:"saveDeleteSelection",value:function(){}},{key:"saveSelection",value:function(){}},{key:"beginAction",value:function(){this.__numInBatch++,m.default.timeoutOnce("batch_beginAction",this.onActionTimeout,0)}},{key:"endAction",value:function(e){this.__numInBatch--;try{m.default.PAssert(359,this.__numInBatch>=0,"Undo batch somehow went negative")}catch(t){m.default.reportError(t)}(this.__numInBatch<=0||e)&&(this.__numInBatch=0,this._batch.length>0&&(this.undoStack.push({selection:this.saveSelection(),prevSel:this._batchPrevSel,actions:this._batch}),this._batch=[]),this._batchPrevSel=void 0,this._deleteSelection=void 0)}},{key:"onActionTimeout",value:function(){this.__numInBatch>0&&this.endAction(!0)}},{key:"clearGroupTextChanges",value:function(){this._needsSelection=!1,this._groupTextChanges=!1}}]),e}(),k()(n.prototype,"onActionTimeout",[_.a],Object.getOwnPropertyDescriptor(n.prototype,"onActionTimeout"),n.prototype),n),E=a(6);function C(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var x=function(e){d()(a,e);var t=C(a);function a(){return i()(this,a),t.apply(this,arguments)}return s()(a,[{key:"_doPush",value:function(e,t,a){if(this.redoStack=[],t.itemId=e.id,this.__numInBatch>0){var n=this._batch.indexOfWithProperty("itemId",e.id);if(n>=0){var r=this._batch[n];r.type===v.a.CrudActions.Modified&&"Removed"===t.type?t.changes.text=r.prevState.text:(Object.assign(t.changes,r.changes,t.changes),Object.assign(t.prevState,r.prevState,t.prevState),t.type=r.type),this._batch[n]=t}else this._batch.push(t)}else{var i=a||this._batchPrevSel||E.a.getSavedSelection()||this.saveSelection();this.undoStack.push({selection:i,prevSel:i,actions:[t]})}}},{key:"beginAction",value:function(){u()(g()(a.prototype),"beginAction",this).call(this),this._batchPrevSel||(this._batchPrevSel=E.a.isValid()?this.saveSelection():void 0)}},{key:"restoreSelFromState",value:function(e,t){}},{key:"saveSelection",value:function(){}},{key:"saveDeleteSelection",value:function(){0}},{key:"pushRemoved",value:function(e,t){if(!this.isUndoing)try{m.default.PAssert(212,this._deleteSelection,"Must have saved delete selection before deleting")}catch(n){m.default.reportError(n)}u()(g()(a.prototype),"pushRemoved",this).call(this,e,t)}}]),a}(I);t.a=new x},function(e,t,a){"use strict";var n,r=a(5),i=a.n(r),o=a(12),s=a.n(o),l=a(7),u=a.n(l),c=a(8),d=a.n(c),h=a(10),f=a.n(h),p=a(11),g=a(0),m=a(9),v=a(3),y=a(97),k=a(6),_=a(48),b=a(56),w=a(15),S=a(42),D=a(83),P=a(143),I=a(74),E=(n=function(){function e(){var t=this;u()(this,e),this.viewportHeights={portrait:0,landscape:0},this.menusStack=new S.a,this.keyboardHeightMax=new w.a(0),this.keyboardHeight=new w.a(0,(function(e){t.keyboardHeightMax.set(Math.max(t.keyboardHeightMax.get(),e))})),this.portaledToolbar=new w.a,this.isKeyboardOpen=new D.a([this.keyboardHeight],(function(e){return e>0})),this.isHoldDown=new w.a,this.codePushStatus=new w.a,this.touchEventListeners={},document.addEventListener("touchstart",(function(e){if(!g.default.findParent(e.target,"bypassPaneObjectTouch",2)){var a=g.default.getPaneObjectForElement(e.target);if(a){var n,r=a.id,i=e.touches[0].clientX,o=e.touches[0].clientY,s={x:i,y:o,clientX:i,clientY:o,diffX:0,diffY:0,distanceX:0,distanceY:0};if(!1!==(null===(n=t.touchEventListeners[r])||void 0===n?void 0:n.onTouchStart(s,e))&&!e.defaultPrevented)var l=P.a.onTouchMoveEnd({ev:e,onMove:function(e,a){var n;null===(n=t.touchEventListeners[r])||void 0===n||n.onTouchMove(e,a,l)},onUp:function(e,a){var n;null===(n=t.touchEventListeners[r])||void 0===n||n.onTouchEnd(e,a,l)},active:!0})}}}),{passive:!1}),I.a.onShake(s()(i.a.mark((function e(){return i.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,t.confirm("Undo typing?");case 2:e.sent&&_.a.undo();case 4:case"end":return e.stop()}}}),e)})))),I.a.onCodePushStatus((function(e){t.codePushStatus.set(e)}))}return d()(e,[{key:"init",value:function(){var e=this;I.a.onKeyboardChange(this.onKeyboardChange),I.a.isNativeApp()||(window.visualViewport?(window.visualViewport.addEventListener("resize",this.onViewportResize),this.onViewportResize()):m.a.isiOS&&document.addEventListener("selectionchange",(function(){var t,a=!!(null===(t=window.getSelection())||void 0===t?void 0:t.focusNode);k.a.isKeyboardOpen=a,e.setKeyboardHeight(a?260:0),m.a.majorVersion<=12&&a&&(document.body.scrollTop=0)})))}},{key:"onViewportResize",value:function(){var e;if(m.a.isiOS&&window.visualViewport){var t=window.visualViewport,a=t.height,n=t.offsetTop,r=window.innerHeight-a+n;r>200?(k.a.isKeyboardOpen=!0,e=r):(k.a.isKeyboardOpen=!1,e=0)}else if(m.a.isAndroid){var i=screen,o=i.width<i.height?"portrait":"landscape",s=window.innerHeight,l=Math.max(s,this.viewportHeights[o]);this.viewportHeights[o]=l,e=l-s>200?1:0}k.a.isKeyboardOpen=e>0,k.a.isKeyboardOpen||k.a.reset(),this.setKeyboardHeight(e)}},{key:"onKeyboardChange",value:function(e){var t=e.isOpen,a=e.height;t||k.a.reset(),k.a.isKeyboardOpen=t,this.setKeyboardHeight(t?a:0)}},{key:"setKeyboardHeight",value:function(e){this.keyboardHeight.set(e),b.a.hide()}},{key:"openMenu",value:function(e){this.menusStack.some((function(t){return t.type===e.type}))||this.menusStack.push(e)}},{key:"closeMenu",value:function(e){this.menusStack.remove((function(t){return t.type===e}))}},{key:"isMenuOpen",value:function(e){return e?this.menusStack.find((function(t){return t.type===e})):this.menusStack.length()>0}},{key:"openActionSheet",value:function(e){this.openMenu(Object.assign({type:"ActionSheet"},e))}},{key:"KeyboardToolbarPortal",value:function(e){var t=this,a=e.children,n=Object(v.useMemo)((function(){return document.createElement("div")}),[]);return Object(v.useEffect)((function(){return t.portaledToolbar.set(n),function(){t.portaledToolbar.set(void 0)}}),[]),Object(y.createPortal)(a,n)}},{key:"setTouchEventListeners",value:function(e,t){this.touchEventListeners[e]=t}},{key:"confirm",value:function(){var e=s()(i.a.mark((function e(t){var a=this;return i.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){a.openMenu({type:"Confirm",text:t,onClosed:function(t){return e(t)}})})));case 1:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"alert",value:function(){var e=s()(i.a.mark((function e(t){var a=this;return i.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){a.openMenu({type:"Alert",text:t,onClosed:function(t){return e(t)}})})));case 1:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getMaxKeyboardHeight",value:function(){return this.keyboardHeightMax.get()||(m.a.isiOS?300:340)}}]),e}(),f()(n.prototype,"onViewportResize",[p.a],Object.getOwnPropertyDescriptor(n.prototype,"onViewportResize"),n.prototype),f()(n.prototype,"onKeyboardChange",[p.a],Object.getOwnPropertyDescriptor(n.prototype,"onKeyboardChange"),n.prototype),f()(n.prototype,"KeyboardToolbarPortal",[p.a],Object.getOwnPropertyDescriptor(n.prototype,"KeyboardToolbarPortal"),n.prototype),n);t.a=new E},,,,,function(e,t,a){"use strict";var n,r=a(7),i=a.n(r),o=a(8),s=a.n(o),l=a(10),u=a.n(l),c=a(11),d=a(0),h=(n=function(){function e(){i()(this,e),this._numInBatch=0,this.batch=[]}return s()(e,[{key:"isBatching",value:function(){return this._numInBatch>0}},{key:"beginBatch",value:function(){this._numInBatch++,d.default.timeoutOnce("batch_beginAction",this.onActionTimeout,0)}},{key:"handleChange",value:function(e){this._numInBatch>0?this.batch.includes(e)||this.batch.push(e):e()}},{key:"endBatch",value:function(e){this._numInBatch--,(this._numInBatch<=0||e)&&(this._numInBatch=0,this.batch.forEach((function(e){return e()})),this.batch=[])}},{key:"onActionTimeout",value:function(){this.batch.length>0&&this.endBatch(!0)}}]),e}(),u()(n.prototype,"onActionTimeout",[c.a],Object.getOwnPropertyDescriptor(n.prototype,"onActionTimeout"),n.prototype),n);t.a=new h},function(e,t,a){"use strict";var n,r=a(5),i=a.n(r),o=a(12),s=a.n(o),l=a(7),u=a.n(l),c=a(8),d=a.n(c),h=a(10),f=a.n(h),p=a(26),g=a(11),m=a(2),v=a(0),y=a(4),k=a(15),_=function(){function e(t){u()(this,e),t.panes&&(t.panes=v.default.arrayUniques(t.panes,"id")),this.id=t.id,this.name=new k.a(t.name),this.panes=t.panes||[],this.index=t.index,this.defaultPanes=t.defaultPanes,this.parent=new k.a(t.parent)}return d()(e,[{key:"getSaveInfo",value:function(){var e={id:this.id,name:this.name.get(),index:this.index,parent:this.parent.get()||null};return this.panes&&(e.panes=this.panes.map(v.default.cloneWithoutUndefineds)),this.defaultPanes&&(e.defaultPanes=this.defaultPanes.map(v.default.cloneWithoutUndefineds)),e}}]),e}(),b=a(18),w=a(42),S=a(119),D=function(){function e(t){u()(this,e),this.id=t.id,this.name=new k.a(t.name),this.index=t.index,this.isCollapsed=new k.a(t.isCollapsed)}return d()(e,[{key:"getSaveInfo",value:function(){return{id:this.id,name:this.name.get(),index:this.index,isCollapsed:this.isCollapsed.get(),isFolder:!0}}}]),e}(),P=a(37),I=a(83),E=a(9),C="Mobile",x=1,A=(n=function(){function e(){var t=this;u()(this,e),this._isSaving=!1,this._isAdding=!1,this._localState=void 0,this._boards=new w.a,this.boardsSorted=new I.a([this._boards],(function(e){return e.filter((function(e){return e instanceof D||!e.parent||!t.getById(e.parent.get())})).reduce((function(t,a){return t.concat(a instanceof D?[a].concat(e.filter((function(e){return!a.isCollapsed.get()&&e instanceof _&&e.parent.get()===a.id}))):a)}),[])})),this.selected=new k.a,this.selectedFolder=new k.a,this.selectedHash=p.a.getURLParam("board")}return d()(e,[{key:"init",value:function(){this.load()}},{key:"setIsAdding",value:function(e){this._isAdding=e}},{key:"isAdding",value:function(){return this._isAdding}},{key:"addFolder",value:function(e,t){var a=new D({id:this.getNextID(),name:e,index:""+this._boards.length()});return this._boards.push(a),this.moveTo(this._boards.length()-1,t),a}},{key:"addToFolder",value:function(e,t){e.parent.set(t.id),this.saveBoard(e),this._boards.notify()}},{key:"removeFromFolder",value:function(e){e.parent.set(void 0),this.saveBoard(e),this._boards.notify()}},{key:"add",value:function(e){this.setIsAdding(!0);var t=new _({id:this.getNextID(),name:this.getNextName(),panes:e||[],index:""+this._boards.length()});return this._boards.push(t),this.saveBoard(t),t}},{key:"removeBoard",value:function(e){this._boards.length()>1&&(this._boards.remove(e),this.selected.get()===e&&this.selectFirstBoard(),b.a.deleteBoard(e.id),this._localState&&delete this._localState[e.id])}},{key:"length",value:function(){return this._boards.length()}},{key:"ensureSelected",value:function(){this.selected.get()||this.selectFirstBoard(!0),y.default.PaneManager.updateDisplayPanes()}},{key:"selectFirstBoard",value:function(e){var t=this.getBoards();this.selectBoard(t[0],e)}},{key:"selectBoard",value:function(e,t){if(e){var a;this.selected.set(e,t),e.parent.get()&&(a=this.getById(e.parent.get())),this.selectedFolder.set(a);var n=E.a.isNativeApp();this.selectedHash||n?(p.a.insertURLParam("board",e.id,!0),n&&y.default.ElectronBridge.selectBoard(e.id)):y.default.settings.selectedBoard.set(e.id)}}},{key:"_findMatchingLocalPane",value:function(e,t){var a;if(t)for(var n=0,r=0;r<t.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(t[r].id===e){a=t[r];break}}return a}},{key:"_generateUsablePaneState",value:function(e,t){for(var a=0,n=[],r=0;r<e.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=e[r],o=this._findMatchingLocalPane(i.id,t)||i;n.push(v.default.cloneWithoutUndefineds({id:i.id,name:i.name,item:i.item,document:i.document||b.a.getDefaultDocument().id,type:i.type,showarch:i.showarch,search:i.search,viewState:i.viewState||(i.viewMode?{viewMode:i.viewMode}:void 0),displayLocalItems:i.displayLocalItems,displayCalendars:i.displayCalendars,blocksCollapsed:i.blocksCollapsed,documentSortMode:i.documentSortMode,itemState:i.itemState,isOverviewVisible:i.isOverviewVisible,widthManual:i.widthManual,widthManualExpanded:i.widthManualExpanded,scrollIndex:o?o.scrollIndex:0,isExpanded:!!o&&o.isExpanded,selectedItem:o?o.selectedItem:void 0}))}return n}},{key:"hasLoadedPaneState",value:function(){return!!this._localState}},{key:"getPaneState",value:function(){var e=this.get();return e?this._generateUsablePaneState(e.panes||[],this._localState[e.id]):[]}},{key:"_generateSyncPaneState",value:function(e){for(var t=0,a=[],n=0;n<e.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[n];a.push({id:r.id,name:r.name,item:r.item,type:r.type,document:r.document,showarch:r.showarch,search:r.search,viewState:r.viewState,itemState:r.itemState,isOverviewVisible:r.isOverviewVisible,displayCalendars:r.displayCalendars,displayLocalItems:r.displayLocalItems,widthManual:r.widthManual,widthManualExpanded:r.widthManualExpanded,blocksCollapsed:r.blocksCollapsed,documentSortMode:r.documentSortMode})}return a}},{key:"_generateLocalPaneState",value:function(e){for(var t=0,a=[],n=0;n<e.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[n];a.push({id:r.id,scrollIndex:r.scrollIndex,isExpanded:r.isExpanded,selectedItem:r.selectedItem})}return a}},{key:"savePaneState",value:function(e,t){if(this._boards.length()>0)try{this._saveSyncState(e),this._saveLocalState(e),this.saveBoard(this.get(),t)}catch(a){v.default.reportError(a,{numBoards:this._boards.length()})}}},{key:"_saveLocalState",value:function(e){var t=this.get().id;try{v.default.PAssert(199,t,"Must have a valid board ID")}catch(n){v.default.reportError(n)}var a=this._generateLocalPaneState(e);v.default.deepEqual(a,this._localState[t])||(this._localState=v.default.clone(this._localState),this._localState[t]=a)}},{key:"_saveSyncState",value:function(e){var t=this.get();try{v.default.PAssert(200,t,"Selected board does not exist")}catch(a){v.default.reportError(a)}t&&(t.panes=this._generateSyncPaneState(e))}},{key:"renameBoard",value:function(e,t){if(e.name.get()!==t){for(var a=0,n=!1,r=0;r<this._boards.length();r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=this._boards.get()[r];if(i!==e&&i.name.get()===t)return n=!0,!1}n||(e.name.set(t),this.saveBoard(e),this.selected.notify())}return!0}},{key:"saveBoardDefault",value:function(e){e.defaultPanes=v.default.clone(e.panes),this.saveBoard(e)}},{key:"restoreBoardDefault",value:function(e){e.panes=v.default.clone(e.defaultPanes),this.selected.notify()}},{key:"get",value:function(){return this.selected.get()}},{key:"createDefaultState",value:function(){if(0===this._boards.length()){var e=b.a.getDefaultDocument(),t=[];if(e){var a=e.getRootItem();t=[new _({id:b.a.generateID(),name:"Tasks",index:"0",panes:[{id:y.default.PaneManager.getNextPaneID(),document:e.id,item:a.id,type:m.a.PaneMode.Task,viewState:{viewMode:"Outline"},isOverviewVisible:!0}]}),new _({id:b.a.generateID(),name:"Today",index:"1",panes:[{id:y.default.PaneManager.getNextPaneID(),document:e.id,item:a.id,type:m.a.PaneMode.Task,viewState:{viewMode:"Agenda_Today"},isOverviewVisible:!0}]}),new _({id:b.a.generateID(),name:"Calendar",index:"2",panes:[{id:y.default.PaneManager.getNextPaneID(),document:e.id,item:a.id,type:m.a.PaneMode.Task,viewState:{viewMode:"Calendar_Week"}}]})],y.default.pluginManager.isEnabled(m.a.PluginID.Gmail)&&t.splice(2,0,new _({id:b.a.generateID(),name:"Email",index:"1,0",panes:[{id:y.default.PaneManager.getNextPaneID(),type:m.a.PaneMode.Gmail,isOverviewVisible:!0,isExpanded:!0}]}))}return this._boards.set(t),this.saveAll(),this.selectFirstBoard(!0),t}}},{key:"getNextName",value:function(){var e,t,a=0,n=this._boards.get(),r=1;do{var i=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e=!1,t="Board "+r,r++;for(var o=0;o<n.length;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(n[o].name.get()===t){e=!0;break}}}while(e);return t}},{key:"getNextID",value:function(){return 1e3*Math.floor(Math.random())+"I"+Date.now()+"Z"+ ++x}},{key:"load",value:function(){var e,t,a=b.a.getBoards(),n=Object.keys(a).map((function(e){var t=a[e];return t.isFolder?new D(t):new _(t)}));n.sort(P.a.compareItemIndex);try{e=y.default.settings.localPaneState.get()||{}}catch(i){e={}}if(this._localState=e,v.default.isDemoMode()||n.find((function(e){return e.id===C}))||n.push(this.createDefaultMobileState(n)),n&&n.length>0)if(this._boards.set(n),t=C,v.default.isNumber(t))this.selectBoardAtIndex(t,!0);else{var r=this.getById(t);r instanceof _?this.selectBoard(r,!0):this.selectBoardAtIndex(0,!0)}}},{key:"setBoards",value:function(e){this._boards.set(e),this.ensureSelected()}},{key:"saveAll",value:function(){var e=this;this.trackPaneState()&&this._boards.forEach((function(t){e.saveBoard(t)}))}},{key:"saveBoard",value:function(e,t){if(this.trackPaneState()&&e){var a=e.getSaveInfo();b.a.saveBoard(a,t),y.default.settings.localPaneState.set(v.default.cloneWithoutUndefineds(this._localState))}}},{key:"trackPaneState",value:function(){return!v.default.isDemoMode()}},{key:"onSettingChanged",value:function(){this._isSaving||this.load()}},{key:"moveTo",value:function(e,t){if(e!==t){var a=this.boardsSorted.get(),n=a[e];a.splice(e,1);var r=a[t-1],i=a[t];if(n instanceof D){if(r instanceof _&&r.parent.get()===n.id)return}else{var o=r?r instanceof D?r.isCollapsed.get()?null:r.id:r.parent.get():null;n.parent.set(o)}var s=Object(S.a)(null===r||void 0===r?void 0:r.index,null===i||void 0===i?void 0:i.index);n.index=s,this._boards.sort(P.a.compareItemIndex),this.saveBoard(n)}}},{key:"cloneBoard",value:function(e,t){var a;(e=e||this.get(),t)?a=[t.getSaveInfoForClone()]:a=e.panes;try{v.default.PAssert(201,a,"Must have valid panes to clone a board")}catch(r){v.default.reportError(r)}var n=this.add(a);return this.selectBoard(n),n}},{key:"getById",value:function(e){return this._boards.get().find((function(t){return t.id===e}))}},{key:"onRemoteUpdate",value:function(e,t){var a=t.id,n=t.name,r=t.panes,i=t.parent,o=t.index,s=t.defaultPanes,l=this.getById(a),u=this.get();if(e===m.a.CrudActions.Removed)l&&this.removeBoard(l);else if(l)if(l instanceof _){var c,d=(null===(c=l.panes)||void 0===c?void 0:c.map((function(e){return v.default.removeNullUndefined(e)})))||[],h=l.index!==o||l.parent.get()!=i||!d.equals(r,!0);try{h&&(l.name.set(n),l.index=o,l.panes=r,l.parent.set(i),l.defaultPanes=s,this._boards.sort(P.a.compareItemIndex),u&&(this.selectBoard(u,l===u),y.default.PaneManager.onRemoteUpdate(r)))}catch(f){v.default.reportError(f,l.name)}}else l.name.set(n),l.index=o,this._boards.sort(P.a.compareItemIndex);else this._boards.insertSorted(new _({id:a,name:n,panes:r,index:o,defaultPanes:s}),P.a.compareItemIndex),this.selectBoard(u)}},{key:"ensureUniqueIndices",value:function(){for(var e=0,t=this._boards.get(),a=1;a<t.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=t[a-1],r=t[a],i=t[a+1];r.index&&r.index!==n.index||(r.index=Object(S.a)(null===n||void 0===n?void 0:n.index,null===i||void 0===i?void 0:i.index),this.saveBoard(r))}}},{key:"hotkeyPrevBoard",value:function(){var e=this.getSelectedIndex()-1;e<0&&(e=this.length()-1),this.selectBoardAtIndex(e)}},{key:"hotkeyNextBoard",value:function(){var e=this.getSelectedIndex()+1;e>=this.length()&&(e=0),this.selectBoardAtIndex(e)}},{key:"getSelectedIndex",value:function(){return this.getBoards().indexOf(this.get())}},{key:"getBoards",value:function(){return this._boards.get().filter((function(e){return e instanceof _}))}},{key:"selectBoardAtIndex",value:function(e,t){var a=this.boardsSorted.get().filter((function(e){return e instanceof _}));e>=0&&e<a.length&&this.selectBoard(a[e],t)}},{key:"clear",value:function(){this._boards.clear()}},{key:"setFolderCollapsed",value:function(e,t){e.isCollapsed.set(t),this.saveBoard(e),this._boards.notify()}},{key:"getFolders",value:function(){return this._boards.get().filter((function(e){return e instanceof D}))}},{key:"getBoardFolderAsTemplate",value:function(){var e=s()(i.a.mark((function e(t){var a,n,r,o,s,l;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return a=this._boards.get().filter((function(e){return e instanceof _&&e.parent.get()===t.id})),n=v.default.arrayUniques(v.default.arrayFlat(a.map((function(e){return e.panes.map((function(e){return e.type===m.a.PaneMode.Task&&e.document}))}))).filter((function(e){return!!e}))),r=n.map((function(e){return b.a.getDocumentById(e)})),e.next=5,Promise.all(r.map((function(e){return e.toJSONObject({includeNotes:!0})})));case 5:return o=e.sent,s={},a.forEach((function(e){return s[e.id]=e.getSaveInfo()})),l={version:1,dateBasis:Date.now(),documents:o,boards:s},e.abrupt("return",l);case 10:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createDefaultMobileState",value:function(e){var t=b.a.getDefaultDocument(),a=t.getRootItem(),n=new _({id:C,name:C,index:""+e.length,panes:[{id:"Inbox",type:m.a.PaneMode.Inbox},{id:"Outline",document:t.id,item:a.id,type:m.a.PaneMode.Task,viewState:{viewMode:"Outline"}},{id:"Agenda",document:t.id,item:a.id,type:m.a.PaneMode.Task,viewState:{viewMode:"Agenda_All"}}]});return this.saveBoard(n),n}}]),e}(),f()(n.prototype,"saveAll",[g.a],Object.getOwnPropertyDescriptor(n.prototype,"saveAll"),n.prototype),f()(n.prototype,"saveBoard",[g.a],Object.getOwnPropertyDescriptor(n.prototype,"saveBoard"),n.prototype),f()(n.prototype,"hotkeyPrevBoard",[g.a],Object.getOwnPropertyDescriptor(n.prototype,"hotkeyPrevBoard"),n.prototype),f()(n.prototype,"hotkeyNextBoard",[g.a],Object.getOwnPropertyDescriptor(n.prototype,"hotkeyNextBoard"),n.prototype),f()(n.prototype,"selectBoardAtIndex",[g.a],Object.getOwnPropertyDescriptor(n.prototype,"selectBoardAtIndex"),n.prototype),n);t.a=new A},function(e,t,a){"use strict";var n,r,i=a(7),o=a.n(i),s=a(8),l=a.n(s),u=a(10),c=a.n(u),d=a(11),h=a(2),f=a(0),p=a(6),g=a(4),m=new(function(){function e(){o()(this,e),this.accountID=void 0}return l()(e,[{key:"setAccountID",value:function(e){this.accountID=e}},{key:"findMatchLike",value:function(e,t){for(var a=0,n=t.max,r=g.default.pluginManager.getPluginGmail(),i=r.getLabels(this.accountID,e,n),o=[],s=0;s<i.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i[s].isSystemLabel()||o.insertSorted(i[s],r.labelSortFn)}return o.map((function(e){return{id:e.getLabelID(),type:"gmailLabel",text:e.getName()}}))}},{key:"findMatchExact",value:function(e){}},{key:"getRNList",value:function(){}}]),e}()),v=a(117),y=a(70),k=a(18),_=a(42),b=new(n=function(){function e(){o()(this,e)}return l()(e,[{key:"tagComparator",value:function(e,t){return e.localeCompare(t)}},{key:"tagComparatorNumber",value:function(e,t){var a=e.count,n=t.count;return a===n?e.text.localeCompare(t.text):n-a}},{key:"findMatchExact",value:function(e){}},{key:"findMatchLike",value:function(e,t){var a=t.max,n=t.root,r={},i=[],o=e.toLowerCase(),s={each:function(e){if(!e.isComplete()){var t=e.getTagsLower();if(t)for(var a=0,n=0;n<t.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=t[n];if(!o||s.startsWith(o)){if(!r[s]){var l={id:s,type:"tag",text:s,count:0};r[s]=l,i.push(l)}r[s].count++}}}}};return n?s.item=n:s.itemStore=g.default.itemStoreManager.getDefaultItemStore(),f.default.searchVMLIs(s),i.sort(this.tagComparatorNumber),i.length>a&&(i=i.slice(0,a)),i}},{key:"printStats",value:function(e){var t=0;f.default.log("--- Tag stats ---",e);for(var a=this.findMatchLike("",{max:100}),n=0;n<a.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;console.log(a[n].text,a[n].count)}}},{key:"getAll",value:function(){return this.findMatchLike("",{})}},{key:"getRNList",value:function(e){var t=[];return this.findMatchLike(e,{}).forEach((function(e){t.push({text:e.text,rightText:e.count})})),t.sort(this.tagComparatorNumber),t}}]),e}(),c()(n.prototype,"tagComparatorNumber",[d.a],Object.getOwnPropertyDescriptor(n.prototype,"tagComparatorNumber"),n.prototype),c()(n.prototype,"getRNList",[d.a],Object.getOwnPropertyDescriptor(n.prototype,"getRNList"),n.prototype),n),w=a(27),S=(r=function(){function e(){var t=this;o()(this,e),this.matches=new _.a,this._isShowing=!1,this._isTempDisabled=!1,this._showNoMatches=!1,this._searchInfo=void 0,this.owner=void 0,this.elementInput=void 0,this.text=void 0,this._prefixes=[h.a.ContactPrefix,h.a.TagPrefix,h.a.PrefixItemAutocomplete,h.a.InlinePrefix.ItemLink],this._prefixMap={},this._prefixMap[h.a.ContactPrefix]=y.a,this._prefixMap[h.a.TagPrefix]=b,this._prefixMap[h.a.PrefixItemAutocomplete]=v.a,this._prefixMap[h.a.InlinePrefix.ItemLink]=v.a,w.a.listen("selectedIndexChanged",(function(){t.matches.clear()})),this.supportedModes=null}return l()(e,[{key:"isShowing",value:function(){return this._isShowing}},{key:"getText",value:function(){return this.text}},{key:"getProviderForPrefix",value:function(e){return this._prefixMap[e]}},{key:"_checkPrefixes",value:function(e,t){for(var a=0,n=e.startsWith("-")?1:0,r=this._prefixes,i=0;i<r.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=r[i];if((o!==h.a.PrefixItemAutocomplete||t.canAutocompleteItems)&&(o!==h.a.InlinePrefix.ItemLink||t.canAutocompleteLinkedItems)&&e.substr(n,o.length)===o)return{length:n+o.length,prefix:o}}}},{key:"_findClosestWithPrefix",value:function(e,t,a,n,r){for(var i,o=0,s=e.split(/ /),l=0,u=-1,c=-1,d=-1,p=0,g=0;g<s.length&&l<=t;++g){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var m=s[g],v=m.replace(/[*_]+$/,"");s[u]===i&&(p=0);var y=this._checkPrefixes(v,r);y?(u=g,d=(c=l)+m.length,p=y.length,i=y.prefix):p&&i!==h.a.TagPrefix&&(d+=m.length+1),l+=m.length+1}if(p&&t>=c&&t<=d){var k=e.substr(c+p,d-c-p);return f.default.shouldLog(h.a.LogLevels.Autocomplete)&&f.default.log("closest is",i,"--",k),{mode:a,text:e,prefix:i,searchText:k,start:c+p,end:d,paneObject:n}}}},{key:"_findClosestDelimited",value:function(e,t,a,n){var r,i=0;r="item"===a?[e]:e.split(",");for(var o=!1,s=0,l=-1,u=-1,c=0;c<r.length&&s<=t;++c){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var d=r[c];l=s+this._numStartSpaces(d),u=s+d.length-this._numEndSpaces(d),l<t&&t<=u&&d.length>0?(o=!0,f.default.shouldLog(h.a.LogLevels.Autocomplete)&&f.default.log("phrase",d,d.length),f.default.shouldLog(h.a.LogLevels.Autocomplete)&&f.default.log("start char",l,e[l]),f.default.shouldLog(h.a.LogLevels.Autocomplete)&&f.default.log("end char",u,e[u])):o=!1,s+=d.length+1}if(o||this._showNoMatches){var p=e.substr(l,u-l+1);return f.default.shouldLog(h.a.LogLevels.Autocomplete)&&f.default.log("closest is",p),{mode:a,text:e,searchText:p,start:l,end:u,paneObject:n}}}},{key:"_findClosestVMLIElement",value:function(e,t,a,n,r){for(var i,o,s,l=0,u=0,c=!1,d=t.elements,h=0;h<d.length&&!1===c;h++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var f=d[h].getStyledText(void 0);if(i=u+this._numStartSpaces(f),o=u+f.length-1-this._numEndSpaces(f),i<a&&a<=o+1&&f.length>0){c=h,s=f.trim();break}u+=f.length}if(!1!==c)return{mode:n,text:e,prefix:"",searchText:s,start:i,end:o,el:d[c],paneObject:r}}},{key:"_numStartSpaces",value:function(e){for(var t=0,a=0,n=0;n<e.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[n])break;a++}return a}},{key:"_numEndSpaces",value:function(e){for(var t=0,a=0,n=e.length-1;n>=0;n--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "!==e[n])break;a++}return a}},{key:"insertMatch",value:function(e){var t=this._searchInfo,a=t.start,n=t.end,r=t.paneObject,i=t.text;if(r){var o=r.item,s=a+e.length;return{text:o.elsNew.spliceText(e,a,n-a,r),offset:s}}return{text:i.substr(0,a)+(e+" ")+i.substr(n),offset:a+e.length+1}}},{key:"onSelectedFromPane",value:function(e){var t=e.owner.item;if(this._searchInfo.prefix===h.a.InlinePrefix.ItemLink){var a=p.a.getStartOffsetWithPrefix(),n=e.owner.getDisplayText(!0).prevIndexOf("[",a)-1,r=a-n,i=t.elsNew.spliceText("[[".concat(e.item.id,"]]"),n,r,e.owner);t.setText(i,h.a.ChangeType.Local);var o=t.elsNew.findElement(e.owner,(function(t){return t.props.itemLink===e.item.id}));o&&p.a.selectObject(e.owner,o.offset+o.length)}else t.setText(e.value,h.a.ChangeType.Local),p.a.selectObject(e.owner,e.offset)}},{key:"prefixForMode",value:function(e){return"contact"===e&&h.a.ContactPrefix||"tag"===e&&h.a.TagPrefix||void 0}},{key:"updateFromPane",value:function(e){var t=e.owner,a=e.index,n=e.start,r=e.element,i=e.forceShow;if(r&&!t.item.isPrefixCodeBlock()){var o=t.getDisplayText()||"";!i&&n<=1&&("#"===o||"+"===o)||this.update({mode:"all",text:o,pane:t.pane,item:t.item,offset:n,owner:t,paneObject:t,fromPane:!0,indexInPane:a,elementDisplay:r,position:void 0,onSelected:this.onSelectedFromPane,canAutocompleteLinkedItems:!0})}}},{key:"update",value:function(e){var t=e.text,a=e.offset,n=e.mode,r=e.paneObject,i=e.item,o=a+(i?i.getPrefixLength():0);if(e.owner===this.owner&&e.elementInput===this.elementInput||(this._isTempDisabled=!1),e.showNoMatches&&(this._showNoMatches=!0),this.text=t,"/"===(i&&i.getParsedTextWithoutPrefix()))g.default.menus.openContextMenu({componentName:"ReactContextMenuSlashHelp",paneObject:r,element:e.elementDisplay});else if(this._isTempDisabled)this.matches.set([]),this._showNoMatches||this.hide();else{this.owner=e.owner,this.elementInput=e.elementInput;var s=null,l=null;this._searchInfo="all"===n?this._findClosestWithPrefix(t,o,n,r,e):this._findClosestDelimited(t,o,n,r);if(this._searchInfo){if(this.text=this._searchInfo.searchText,"all"===n)l=this.getProviderForPrefix(this._searchInfo.prefix);else switch(n){case"move":case"item":l=v.a;break;case"email":s=(l=this._prefixMap[h.a.ContactPrefix]).findEmailsLike(this._searchInfo.searchText.trim(),100);break;case"contact":l=this._prefixMap[h.a.ContactPrefix];break;case"tag":l=this._prefixMap[h.a.TagPrefix];break;case"gmailLabel":var u=g.default.pluginManager.getPluginGmail().getAccountIDFromItem(i);(l=m).setAccountID(u);break;default:try{f.default.PAssert(465,!1,"Unknown autocomplete mode: ",n)}catch(p){f.default.reportError(p)}}if(null===s){var c,d=e.pane;c=d&&d.type===h.a.PaneMode.Task?d.getRootItem():i||k.a.getDefaultDocument().getRootItem(),s=l.findMatchLike(this._searchInfo.searchText,{max:100,root:c,owner:i,allDocs:!!r})}1===s.length&&l.findMatchExact(this._searchInfo.searchText,s)&&(s=[])}this._searchInfo&&0!==s.length||!i||i.getRawText().includes(h.a.CharDate)||t[o-1]!==h.a.PrefixDate||!(o<2||" "===t[o-2]||t[o-2]===h.a.AttachChar)||t[o]&&" "!==t[o]&&t[o]!==h.a.AttachChar||g.default.menus.openDate(Object.assign({paneObject:r,item:i,textOffset:o,element:e.elementDisplay,selectAfter:!0,onClosed:function(){var t=e.owner&&e.owner.onDatePickerClosed;t&&t()}},e)),s=s||[],e.supportSearchItemAutocomplete&&"all"===n&&0===s.length&&e.parsedEls&&(this._searchInfo=this._findClosestVMLIElement(t,e.parsedEls,o,n,r)),this.matches.set(s),!this._isShowing&&s.length>0&&!this._isTempDisabled&&!e.noShow?this.show(e):0===s.length&&(this._showNoMatches||this.hide(),this._isTempDisabled=!1)}}},{key:"clearDisabled",value:function(){this._isTempDisabled=!1}},{key:"onClosed",value:function(){this._isShowing=!1,this._owner=null,this.matches.clear()}},{key:"show",value:function(e){this._isShowing=!0,this._showNoMatches=!!e._showNoMatches,this._owner=e.owner,e.componentName="ReactAutocomplete",e.onClosed=this.onClosed,g.default.menus.openContextMenu(e)}},{key:"showPopup",value:function(e){this._isShowing=!0,this._showNoMatches=!0;var t=e;t.componentName="ReactAutocomplete",t.onClosed=this.onClosed,g.default.menus.openContextMenu(t)}},{key:"hide",value:function(){this._isShowing&&(this._isShowing=!1,g.default.menus.closeContextMenu("ReactAutocomplete")),this.matches.length&&this.matches.clear()}},{key:"getTextFromMatch",value:function(e){return e.text}},{key:"onSelectedMatch",value:function(e){var t=this.insertMatch(e.text),a={value:t.text,offset:t.offset,owner:this.owner,item:e.item};this.owner.onAutocompleteSelected?this.owner.onAutocompleteSelected(a):this.onSelectedFromPane(a),this.onClosed()}}]),e}(),c()(r.prototype,"onSelectedFromPane",[d.a],Object.getOwnPropertyDescriptor(r.prototype,"onSelectedFromPane"),r.prototype),c()(r.prototype,"onClosed",[d.a],Object.getOwnPropertyDescriptor(r.prototype,"onClosed"),r.prototype),r);t.a=new S},function(e,t,a){"use strict";var n=a(16),r=a.n(n),i=a(2),o=a(28),s=a(0),l=a(9),u=a(3),c=a.n(u);var d=a(17),h=a(72),f=a(147),p=0;t.a=Object(d.b)((function(e){var t=e.mode,a=e.className,n=e.align,d=e.color,g=e.width,m=e.height,v=e.icon,y=e.iconSize,k=e.text,_=e.disabled,b=e.padding,w=e.notRounded,S=e.fontSize,D=e.fontWeight,P=e.style,I=e.onPress,E=e.displayBlock,C=e.primary,x=Object(u.useState)(1),A=r()(x,2),T=A[0],M=A[1],L=function(){var e=Object(u.useRef)(!1),t=Object(u.useCallback)((function(){return e.current}),[]);return Object(u.useEffect)((function(){return e.current=!0,function(){e.current=!1}})),t}(),O=Object(u.useRef)();D=D||"bold",n=n||"center";var R=l.a.isiOS&&l.a.majorVersion<=12,F=Object(u.useCallback)((function(e){p=Date.now(),M(v&&!k?1.2:1.06),s.default.preventAndStop(e)}),[v,k]),N=Object(u.useCallback)((function(e){R||(I(e),s.default.preventAndStop(e))}),[R,I]),B=Object(u.useCallback)((function(e){if(s.default.preventAndStop(e),L()){var t=Date.now();t-p<100?setTimeout((function(){return M(1)}),100-(t-p)):M(1)}}),[]),j=s.default.classNames("cursor-pointer box-border mobutton pointer-events-auto select-none",{"flex items-center":v},{center:"center"===n},{"origin-left":"left"===n},{rounded:!w},{"c-bg-gray-200":"contained"===t&&!C},{"border c-border":"outlined"===t},{"items-center text-center justify-center":v&&"center"===n},{ib:!v&&!E},{"px-4":void 0===g&&void 0===b&&"center"===n},{"px-4":void 0===g&&void 0===b&&"left"===n},{"py-3":void 0===m&&void 0===b},{"opacity-50 filter-grayscale":_},{"c-button-raised-primary c-white":C&&"contained"===t},b,d||"c-foreground-light",a),U=Object.assign({width:g,height:m,lineHeight:m+"px",touchAction:"manipulation"},P),H={fontSize:y},V={fontSize:S},W=s.default.classNames({"font-bold":"bold"===D});return R&&Object(f.a)(O,{onTouchStart:Object(u.useCallback)((function(e){s.default.preventAndStop(e),I(e)}),[])}),c.a.createElement(o.b.div,{className:j,style:U,onPointerDown:F,onClick:N,onPointerUp:B,onTouchStart:function(e){return s.default.preventAndStop(e)},animate:{scale:T},transition:i.a.TransitionSpringFastest,ref:O},v&&c.a.createElement(h.a,{name:v,size:y,className:k?"mr-2":"",style:H}),k&&c.a.createElement("div",{className:W,style:V},k))}))},function(e,t,a){"use strict";var n=a(84),r=a.n(n),i=a(7),o=a.n(i),s=a(8),l=a.n(s),u=a(2),c=a(0),d=a(88),h=a(9),f=a(6),p=a(4),g=a(48),m=a(56),v=[u.a.KeyCode.Tab,u.a.KeyCode.Backspace,u.a.KeyCode.Delete],y=[u.a.KeyCode.ArrowUp,u.a.KeyCode.ArrowDown,u.a.KeyCode.ArrowLeft,u.a.KeyCode.ArrowRight,u.a.KeyCode.Home,u.a.KeyCode.End,u.a.KeyCode.A,u.a.KeyCode.E,u.a.KeyCode.F,u.a.KeyCode.B,u.a.KeyCode.PageUp,u.a.KeyCode.PageDown],k=function(){function e(){o()(this,e)}return l()(e,[{key:"getNavigationAction",value:function(e){var t=h.a.mac,a=e.ctrlKey&&!e.altKey&&!e.metaKey,n=e.altKey&&!e.ctrlKey&&!e.metaKey,r=e.metaKey&&!e.ctrlKey&&!e.altKey,i=!e.ctrlKey&&!e.altKey&&!e.metaKey,o=e.normCode,s=u.a.KeyCode;if(o===s.ArrowLeft){if(a&&!h.a.mac||n&&h.a.mac)return"LeftWord";if(r&&t)return"StartLine";if(i)return"Left"}if(o===s.ArrowRight){if(a&&!h.a.mac||n&&h.a.mac)return"RightWord";if(r&&t)return"EndLine";if(i)return"Right"}if(o===s.ArrowUp){if(t&&r)return"Top";if(t&&a)return"PageUp";if(t&&n)return"StartLine";if(!t&&a)return"PrevHeader";if(i)return"Up"}if(o===s.ArrowDown){if(t&&r)return"Bottom";if(t&&a)return"PageDown";if(t&&n)return"EndLine";if(!t&&a)return"NextHeader";if(i)return"Down"}if(o===s.A&&a&&t)return"StartLine";if(o===s.E&&a&&t)return"EndLine";if(o===s.B&&a&&t)return"Left";if(o===s.F&&a&&t)return"Right";if(o===s.Home&&!t){if(a)return"Top";if(i)return"StartLine"}if(o===s.End&&!t){if(a)return"Bottom";if(i)return"EndLine"}return o===s.PageUp&&i?"PageUp":o===s.PageDown&&i?"PageDown":o===s.A&&r&&t||o===s.A&&a&&!t?"All":"None"}},{key:"updateAutocomplete",value:function(){if(!c.default.isDemoRunning&&f.a.isValid()){var e=f.a.getStartIndex(),t=f.a.getStartObject(),a=f.a.getStartOffset();f.a.isValid()&&t===f.a.getEndObject()&&a===f.a.getEndOffset()?m.a.updateFromPane({owner:t,index:e,start:a,element:f.a.getStartElement()}):m.a.hide()}}},{key:"keyup",value:function(e){if(e.normCode===u.a.KeyCode.Space&&g.a.clearGroupTextChanges(),c.default.preventAndStop(e),this.isTyping=!1,e.handled)return!0}},{key:"handleSelectAll",value:function(e){var t=e.indexOfFirstItem(),a=e.indexOfLastItem();return f.a.selectIndices(t,0,a,-1),!1}},{key:"handleSelectAllItem",value:function(){if(c.default.focusedPane&&c.default.focusedPane.isWriteable)return f.a.selectIndex(f.a.getStartIndex(),0,-1),!1}},{key:"_move",value:function(e){try{c.default.PAssert(224,e===u.a.Direction.Up||e===u.a.Direction.Down,"Must move in a direction")}catch(p){c.default.reportError(p)}var t,a,n=c.default.focusedPane,r=f.a.getStartIndex(),i=f.a.getEndIndex(),o=f.a.getStartItem(),s=f.a.getEndItem(),l=!1;if((o.parent()===s.parent()&&(l=!0),!l)&&!n.getNextItem(f.a.getEndIndex(),!0))for(var d=0;s;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;if(o.parent()===s.parent()){l=!0;break}s=s.parent()}if(l&&(e===u.a.Direction.Up?(t=n.getPreviousItem(r,!0),a=s.getIndex()+1):(t=n.getNextItem(i,!0),a=o.getIndex()),t)){n.setIgnoreRestoreScroll();var h=f.a.save();f.a.reset(),t.moveTo({parent:t.parent(),index:a},u.a.ChangeType.Local),f.a.restore(h),e===u.a.Direction.Up?f.a.scrollStartIntoView():f.a.scrollEndIntoView()}}},{key:"moveUp",value:function(){!c.default.focusedPane.isViewAgenda()&&f.a.isValid()&&this._move(u.a.Direction.Up)}},{key:"moveDown",value:function(){!c.default.focusedPane.isViewAgenda()&&f.a.isValid()&&this._move(u.a.Direction.Down)}},{key:"handleArrows",value:function(e){var t=c.default.focusedPane;if(!f.a.isValid())return!0;var a=this.getNavigationAction(e);this.lastNavigationAction=a;var n,i,o,s=f.a.getStartIndex(),l=f.a.getEndIndex(),u=f.a.getStartOffset(),d=f.a.getEndOffset(),h=f.a.getStartTotal(),p=f.a.getEndTotal(),g=t.indexOfLastItem(),m=s===l&&(0!==u||d!==p),v={fromArrows:!0},y=f.a.lastSingleSelection;if(e.shiftKey)if("Top"===a)i=[0,0,y?null===(o=f.a.getEndSelectionOfMap(y.selectedMap))||void 0===o?void 0:o.paneObject.index:l,-1,v];else if("Bottom"===a){var k;i=[y?null===(k=f.a.getStartSelectionOfMap(y.selectedMap))||void 0===k?void 0:k.paneObject.index:s,0,g,-1,v]}else(m||"Up"!==a&&"Left"!==a&&"LeftWord"!==a)&&"PageUp"!==a&&"PrevHeader"!==a?(m||"Down"!==a&&"Right"!==a&&"RightWord"!==a)&&"PageDown"!==a&&"NextHeader"!==a?m||("Left"===a||"LeftWord"===a||"StartLine"===a?i=[s,0,s,h]:"Right"!==a&&"RightWord"!==a&&"EndLine"!==a||(i=[l,0,l,p])):s===l?s+1<=g&&(i=[s,0,s+1,-1]):n=f.a.selectUpDown("down","NextHeader"===a,"PageDown"===a):n=f.a.selectUpDown("up","PrevHeader"===a,"PageUp"===a);else if("All"===a){var _=f.a.getStartItem();i=s!==l||!(null===_||void 0===_?void 0:_.isPrefixCodeBlock())||0===u&&d===p?[0,0,g,-1]:[s,0,s,-1]}else if("Top"===a)i=[0,0,0,0];else if("Bottom"===a)i=[g,-1,g,-1];else if(s!==l){if("Left"===a||"LeftWord"===a||"StartLine"===a)i=[s,0,s,0];else if("Right"===a||"RightWord"===a||"EndLine"===a)i=[l,-1,l,-1];else if("Up"===a||"PageUp"===a||"PrevHeader"===a){var b="PrevHeader"===a&&this.getPrevHeader(t,s)||"PageUp"===a&&this.getPageUp(t,s)||"Up"===a&&this.getPrevVMLI(t,s);i=[b,0,b,0]}else if("Down"===a||"PageDown"===a||"NextHeader"===a){var w="NextHeader"===a&&this.getNextHeader(t,l)||"PageDown"===a&&this.getPageDown(t,l)||"Down"===a&&this.getNextVMLI(t,l);i=[w,-1,w,-1]}}else if("PageUp"===a){var S=this.getPageUp(t,l);i=[S,0,S,0]}else if("PageDown"===a){var D=this.getPageDown(t,l);i=[D,-1,D,-1]}else if("PrevHeader"===a){var P=this.getPrevHeader(t,l);i=[P,0,P,0]}else if("NextHeader"===a){var I=this.getNextHeader(t,l);i=[I,-1,I,-1]}if(n)t.listManager.scrollToIndex(n,"auto","auto");else{if(!(i&&i[0]>=0&&i[2]>=0))return!0;t.listManager.scrollToIndex(i[0],"auto","auto"),f.a.selectIndices.apply(f.a,r()(i)),e.shiftKey||f.a.setDownIndex()}}},{key:"keydown",value:function(e){this.isTyping=!0;var t=!0;return this.lastNavigationAction=void 0,e.normCode===u.a.KeyCode.Escape?f.a.onPressEnter():v.indexOf(e.normCode)>=0||h.a.mac&&e.ctrlKey&&e.normCode===u.a.KeyCode.D?t=this.keypress(e,!0):y.indexOf(e.normCode)>=0?t=this.handleArrows(e):h.a.mac&&e.metaKey||!h.a.mac&&e.ctrlKey&&!e.altKey?e.normCode!==u.a.KeyCode.Y&&e.normCode!==u.a.KeyCode.Z||(t=this.keypress(e,!0)):h.a.mac&&e.ctrlKey&&e.normCode===u.a.KeyCode.H&&c.default.preventDefault(e),t&&this.keyWantsScrollIntoView(e,!0)&&f.a.scrollStartIntoView(),t}},{key:"checkKeypressSpecialCases",value:function(e,t){var a;return e.ctrlKey&&e.altKey&&t?a=!0:e.metaKey&&e.normCode===u.a.KeyCode.Tilde&&(a=!1),a}},{key:"keypress",value:function(e,t,a){var n=this,r=[u.a.KeyCode.Enter,u.a.KeyCode.D];c.default.stopPropagation(e);var i=!0,o=c.default.focusedPane,s=e.normCode>=32||r.indexOf(e.normCode)>=0;if(!(0===e.which)&&(t||s)){if(h.a.mac&&e.metaKey||!h.a.mac&&e.ctrlKey)switch(String.fromCharCode(e.normCode)){case"c":case"C":return e.handled=!0,!0;case"v":case"V":return e.handled=!0,!0;case"x":case"X":return e.handled=!0,!0;case"Y":case"y":case"Z":case"z":try{c.default.PAssert(225,!1,"Should not be handled undo/redo hotkeys here")}catch(m){c.default.reportError(m)}return e.handled=!0,!0;case"r":case"R":case"a":case"A":case"t":case"T":return e.handled=!0,!0}var l=f.a.getStartItem();g.a.saveDeleteSelection(),g.a.beginAction();var d=[u.a.KeyCode.Tab,u.a.KeyCode.Enter,u.a.KeyCode.Backspace,u.a.KeyCode.Delete,u.a.KeyCode.D];f.a.getStartIndex()!==f.a.getEndIndex()&&e.normCode!==u.a.KeyCode.Tab&&((e.metaKey||e.ctrlKey||e.altKey)&&!d.includes(e.normCode)||(o.isViewOutline()||o.isViewProject()?!a&&f.a.isMultiselectDangerous()?(o.isViewFlatList()?p.default.toasts.pushMessage(u.a.MessageID.FlatSearchMultiSelect):f.a.confirmDangerousSelection((function(){n.keypress(e,t,!0)})),i=!1):o.isEditable?p.default.menus.isContextMenuOpen()||p.default.menus.isModalOpen()||(i=i&&this.handleMultiselect(e)):i=!1:(p.default.toasts.pushMessage({text:"Editing multiple items from this view is not currently supported. Please edit them individually.",actionText:"OKAY"}),i=!1))),i&&d.indexOf(e.normCode)>=0&&(p.default.PaneUpdateBatcher.beginUpdateItems(),e.normCode===u.a.KeyCode.Backspace?i=!!(l&&l.allowTextEditing()&&o.isEditable)&&(i&&this.handleBackspace(e)):(e.normCode===u.a.KeyCode.Delete||h.a.mac&&e.ctrlKey&&e.normCode===u.a.KeyCode.D)&&(i=!!(l&&l.allowTextEditing()&&o.isEditable)&&(i&&this.handleDelete())),p.default.PaneUpdateBatcher.commitUpdateItems()),g.a.endAction()}return this.keyWantsScrollIntoView(e,t)&&f.a.scrollStartIntoView(),i}},{key:"handleMultiselect",value:function(e,t){var a=c.default.focusedPane,n=a.indexOfNextVMLI(f.a.getStartIndex()-1),r=a.indexOfPrevVMLI(f.a.getEndIndex()+1),i=f.a.getStartOffset(),o=f.a.getStartOffsetWithPrefix(),s=f.a.getEndOffset(),l=f.a.getEndOffsetWithPrefix();f.a.selectIndices(n,i,r,s);var d=!0,h=f.a.getStartObject(),g=f.a.getStartItem(),m=f.a.getEndObject(),v=f.a.getEndItem(),y=function(){if(a.hasNonVMLIs){var e=a.closestIndexOfObject(h);try{c.default.PAssert(226,e>=0,"Could not find item to select")}catch(t){c.default.reportError(t)}e>=0&&f.a.selectIndex(e,i)}else f.a.selectIndex(n,i)};if(n!==r||!(f.a.getStartOffset()>0||f.a.getEndOffset()<f.a.getEndTotal())){var k,_=f.a.getSelectedItems(!1,!0),b=null===(k=_.find((function(e){return e.checkDeleteProblem()})))||void 0===k?void 0:k.checkDeleteProblem();e.normCode!==u.a.KeyCode.Backspace&&e.normCode!==u.a.KeyCode.Delete&&e.normCode!==u.a.KeyCode.Enter||(d=!1);var w=function(){var e=0;p.default.PaneUpdateBatcher.beginUpdateItems();var n=g.parent(),r=a.createVMLI({text:""},{parent:n,changeType:u.a.ChangeType.AllLocal,isEditable:!0});n.insertItem(r,g.getIndex());for(var i=0;i<_.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=_[i];try{c.default.PAssert(227,o,"Item must exist")}catch(s){c.default.reportError(s)}o.isDeleted()||o.parent().deleteChild(o,void 0,void 0,u.a.ChangeType.Local)}p.default.PaneUpdateBatcher.commitUpdateItems(),y(),t&&t()};return b?p.default.menus.confirm("One of the selected items is ".concat(b,". Are you sure you want to delete?"),(function(e){e&&w()})):w(),d}var S=g.elsNew.split(h,o),D=v.elsNew.split(m,l),P=S[0].getRawText(h.showMarkdown())+(D[1]?D[1].getRawText(m.showMarkdown()):"");g.setText(P,u.a.ChangeType.Local),y(),t&&t()}},{key:"handleTab",value:function(e,t){var a,n=f.a.getPane(),r=f.a.getStartIndex(),i=f.a.getStartObject(),o=f.a.getEndObject(),s=f.a.getStartOffset(),l=f.a.getEndOffset(),d=!t,h=f.a.getStartItem(),m=f.a.getEndItem(),v=d?0:1;if(n.isViewFlatList())p.default.toasts.pushMessage(u.a.MessageID.FlatSearchTab);else{if(i.levelsDeepNew()<v)return!1;if(d&&n.isViewAutoBlocks()&&i.levelsDeepNew()===v){var y=n.prevPaneObjectAtSameLevel(r);if(!y||y.block!==i.block||y.item.parent()!==h.parent())return!1}h&&h.isNote()&&(h=h.parent()),m&&m.isNote()&&(m=m.parent()),f.a.scrollStartIntoView();var k=f.a.getSelectedObjects(),_={},b=[];k.forEach((function(e){var t=e.item;if(t){var a=null===t||void 0===t?void 0:t.parent();_[a.id]||b.push(e),_[t.id]=t}}));var w=[],S=h.parent(),D=d?null===(a=n.prevPaneObjectAtSameLevel(i.index))||void 0===a?void 0:a.item:h.parent().parent();if(D){var P,I;p.default.PaneUpdateBatcher.beginUpdateItems(),g.a.beginAction();var E=D.getChildIndex(S);b.forEach((function(t,a){var r=t.item;try{c.default.PAssert(228,r,"Must always be tabbing/untabbing valid items")}catch(f){c.default.reportError(f)}var o=a===b.length-1,s=r.getIndex();if(d){if(s>0&&!t.isBlockHeader&&D&&(w.push({item:r,parent:D,index:void 0}),D.isCollapsed(n)&&D.setCollapsed(!1,n),p.default.onIntroAction("Indent"),!e&&o&&!n.isPaneObjectCollapsed(t))){var l=r.getItems(),u=D.numItems()+1;l.forEach((function(e){_[e.id]||w.push({item:e,parent:D,index:u++})}))}}else if(r.parent()!==c.default.focusedItem&&!(n.isViewProject()&&i.block.id!==n.blockNoKey&&r.parent().parent()===c.default.focusedItem)){if(!e)n.getSiblingsAfterPaneObject(t).forEach((function(e,t){_[e.id]||w.splice(t,0,{item:e.item,parent:r,index:void 0})}));var h=E+1;w.splice(0,0,{item:r,parent:D,index:h})}})),w.forEach((function(e){var t=e.item,a=e.parent,n=e.index;t.moveTo({parent:a,index:n},u.a.ChangeType.Local)})),S.itemChanged.notify(),D.itemChanged.notify(),n.setIgnoreRestoreScroll(),g.a.endAction(),p.default.PaneUpdateBatcher.commitUpdateItems(!1,!1);var C=null===(P=n.findPaneObject(i.id))||void 0===P?void 0:P.index,x=i===o?C:null===(I=n.findPaneObject(o.id))||void 0===I?void 0:I.index;C>=0&&x>=0?f.a.selectIndices(C,s,x,l):requestAnimationFrame((function(){return f.a.updateCaret()})),requestAnimationFrame((function(){f.a.updateCaret()}))}}}},{key:"handleEnter",value:function(e){var t=c.default.focusedPane,a=f.a.getStartItem(),n=f.a.getStartObject(),r=f.a.getStartIndex(),i=f.a.getStartOffset(),o=f.a.getStartOffsetWithPrefix(),s=f.a.getStartTotal(),l=f.a.getEndOffset(),h=f.a.getEndTotal();if(!a){try{c.default.PAssert(229,!1,"Invalid item in handleEnter")}catch(B){c.default.reportError(B)}return!1}var g=a.parent();if(!g){try{c.default.PAssert(230,!1,"Invalid parent in handleEnter")}catch(B){c.default.reportError(B)}return!1}var m,v,y=a.getParsedText(),k=a.getMooDate(),_=g.getItems().indexOf(a),b=!1,w=g,S=0;if(t.clearPreventUpdate(),t.setIgnoreRestoreScroll(),a.isNote()){if(e)return c.default.preventDefault(e),!1}else if(t.isViewProject()&&t.isItemTopLevel(n)&&a.hasChildren()&&0===a.getChild(0).getParsedTextWithoutPrefix().length)v=r+1;else if(a.shouldCopyPrefix()&&y===a.getPrefix())a.setText("",u.a.ChangeType.Local),v=r;else if(a.getPrefix()&&0===i&&l===h)a.setText(a.getPrefix(),u.a.ChangeType.Local),v=r;else{if(a.isPrefixCodeBlock())return!0;var D,P,I=!0,E=!1,C={text:""},x=n.block;t.setIgnoreRestoreScroll(),p.default.PaneUpdateBatcher.beginUpdateItems(),t.isViewTag()&&y.indexOf(n.block.text)>=0&&(D=n.block.text,P=y[a.getPrefixLength()]===u.a.TagPrefix?0:-1);var A=l;if(d.a.animateNext(),!t.isViewAgenda()||0!==n.levelsDeepNew()||a.hasVisibleChildren(t)&&!a.isCollapsed(t))if(a.hasAttachmentType(u.a.PluginType.Calendar));else if(0===A&&""!==y)_--,I=!1;else if(i>=s)(b=!a.isCollapsed(t)&&(a.getVisibleChildren(t).length>0||a.isPrefixHeader()&&!t.isViewFlatList()))&&(w=a);else if(0===i&&l===h)a.setText(a.getPrefix(),u.a.ChangeType.Local);else{var T=a.elsNew.split(n,o),M=n.showMarkdown(),L=T[0].getRawText(M),O=T[1].getRawText(M);D&&L.indexOf(D)<0&&(0===P?L=D+" "+L:L+=" "+D),C.text=O,k&&O.includes(u.a.CharDate)&&(C.date=k),a.setText(L,u.a.ChangeType.Local),E=!0,(b=!a.isCollapsed(t)&&(a.numItems()>0||a.isHeader()))&&(w=a)}else x.isStarred?C.isStarred=!0:x.isImportant?C.priority=a.getPriority():x.isDate&&x.date&&a.getMooDate()?(C.date=a.getMooDate().toData(),C.text=" "+u.a.CharDate):C.text=" "+x.id,a.shouldSave()||(_=-1);!b&&D&&C.text.indexOf(D)<0&&(0===P?C.text=D+" "+C.text:C.text+=" "+D);var R=p.default.settings.defaultItemPrefix.get();if(b||!a.shouldCopyPrefix()&&!E?(!b||b&&R&&(a.isPrefixHeader()||a.shouldCopyPrefix()&&a.prefix===R))&&(C.text=(R&&R+" ")+C.text):C.text=a.getPrefix()+C.text,m=t.createVMLI(C,{parent:w,changeType:u.a.ChangeType.AllLocal,isEditable:!0}),E&&m.copyProperties(a),m.parseText("",u.a.ChangeType.Local|u.a.ChangeType.All),b)a.insertItem(m,0);else{try{c.default.PAssert(231,!m.isNote(),"Should never be inserting a note here")}catch(B){c.default.reportError(B)}w.insertItem(m,_+1)}p.default.PaneUpdateBatcher.commitUpdateItems();var F=I?m:a;try{c.default.PAssert(232,F,"Expected another item to exist")}catch(B){c.default.reportError(B)}var N=t.closestIndexOfObject(n);v=I?t.indexOfItem(m,x):N,S=0}return v>=0&&f.a.selectIndex(v,S,S),e&&c.default.preventDefault(e),!1}},{key:"handleBackspace",value:function(e){var t=f.a.getStartItem(),a=f.a.getStartIndex(),n=f.a.getStartOffset(),r=f.a.getEndOffset(),i=f.a.getStartObject(),o=c.default.focusedPane,s=n===r;if(!t){try{c.default.PAssert(233,!1,"Invalid item in handleBackspace")}catch(P){c.default.reportError(P)}return!1}var l=t.parent();try{c.default.PAssert(234,l,"Must always have a valid parent for an item")}catch(P){c.default.reportError(P)}h.a.ie&&c.default.preventAndStop(e);var m=t.getParsedText(),v=t.hasAttachmentType(u.a.PluginType.Calendar);if(0===n&&0===r||""===m){if(i.isBlockHeader&&t.hasChildren());else if(t.isNote()&&""!==m);else if(v);else if(s&&t.hasPrefix())i.isBlockHeader&&t.hasChildren()||(t.setText(m.substr(t.getPrefixLength()),u.a.ChangeType.Local),f.a.selectIndex(a,0),this.updateAutocomplete());else if(f.a.getStartIndex()>0){var y=c.default.focusedPane.indexOfPrevVMLI(f.a.getStartIndex(),!0),k=y>=0&&c.default.focusedPane.objectAtIndex(y);if(k&&k.item.allowTextEditing()){var _=!0;(o.isViewAgenda()||o.isViewFlatList())&&0!==m.length&&(_=!1),_&&this.confirmDelete(t,(function(){o.setIgnoreRestoreScroll(),d.a.animateNext(),p.default.PaneUpdateBatcher.beginUpdateItems(),g.a.saveDeleteSelection();var e=k.item,a=e.isFullscreen(),n=k.getDisplayLengthWithoutPrefix(),r=a?0:y,i=o.objectAtIndex(r),s=a?0:n;if(f.a.selectIndex(r,s),m.length>0&&""!==m){0===n&&e.copyProperties(t),e.setText(e.elsNew.combineWith(t.elsNew),u.a.ChangeType.Local);var c=t.getMooDate();c&&!e.getMooDate()&&e.setMooDate(c,u.a.ChangeType.Local,!0),t.hasNote()&&(e.hasNote()||e.moveNote(t,u.a.ChangeType.Local))}l.deleteChild(t,e,0,u.a.ChangeType.Local),p.default.PaneUpdateBatcher.commitUpdateItems(),r=i.index,f.a.selectIndex(r,s)}))}}}else{if(!(n>0)||e.metaKey||t.elsNew.isElementAtOffsetEditable(i,n-1))return!0;var b=i.showMarkdown(),w=t.elsNew.elementAtOffset(i,n-1);if(w){var S=n-w.getStyledText(t,{showMarkdown:b}).length,D=t.elsNew.removeElement(w).getRawText(b);t.setText(D,u.a.ChangeType.Local),f.a.selectIndex(a,S)}}return!1}},{key:"handleDelete",value:function(){var e=f.a.getStartItem(),t=c.default.focusedPane;if(!e)return!1;var a=e.parent(),n=f.a.getStartObject(),r=e.getParsedText(),i=f.a.getStartIndex(),o=f.a.getStartOffset(),s=f.a.getEndOffset(),l=f.a.getEndTotal(),d=!0;if(""===r)if(t.isViewOutline()){if(e.isNote())a.setNote(void 0,u.a.ChangeType.Local),f.a.selectItem(a,-1);else if(i<t.numItems()-1){var h=i;this.confirmDelete(e,(function(){t.setIgnoreRestoreScroll(),g.a.saveDeleteSelection(),t.numItems()>1&&(e.hasChildren()?a.replaceChild(e,e.getFirstChild(),u.a.ChangeType.Local):a.deleteChild(e,a,h,u.a.ChangeType.Local)),f.a.selectIndex(h,0)}))}}else d=!1;else if(o===f.a.getStartTotal()&&s===l)if(t.isViewOutline())if(e.isNote())d=!1;else{var p=t.indexOfNextVMLI(i,!0),m=p>=0&&t.itemAtIndex(p);m&&d&&this.confirmDelete(m,(function(){t.setIgnoreRestoreScroll();var a=m.hasNote()&&m.getNote();e.setText(e.elsNew.combineWith(m.elsNew,(function(e){return!e.props.prefixType})),u.a.ChangeType.Local);var n=m.getMooDate();if(n&&!e.getMooDate()&&e.setMooDate(n,u.a.ChangeType.Local,!0),a){var r=e.hasNote()&&e.getNote();if(r){var i=r.getRawText()+"\n\n--- merged note ---\n\n"+a.getRawText();r.setText(i,u.a.ChangeType.Local)}else a.setParent(e),e.setNote(a,u.a.ChangeType.Local)}g.a.saveDeleteSelection(),m.parent().deleteChild(m,e,0,u.a.ChangeType.Local),f.a.selectIndex(f.a.getEndIndex(),s)}))}else d=!1;else{if(!(o<l-1)||e.elsNew.isElementAtOffsetEditable(n,o))return!0;var v=e.elsNew.elementAtOffset(n,o);if(v){var y=e.elsNew.removeElement(v).getRawText(n.showMarkdown());e.setText(y,u.a.ChangeType.Local),console.log(e.elsNew),f.a.selectIndex(i,o)}}return!1}},{key:"keyWantsScrollIntoView",value:function(e,t){switch(e.normCode){case u.a.KeyCode.LeftMeta:case u.a.KeyCode.ContextMenu:case u.a.KeyCode.Alt:case u.a.KeyCode.Shift:case u.a.KeyCode.Ctrl:case u.a.KeyCode.ArrowLeft:case u.a.KeyCode.ArrowRight:case u.a.KeyCode.ArrowUp:case u.a.KeyCode.ArrowDown:return!1}return!(h.a.mac&&e.metaKey&&(t&&e.normCode===u.a.KeyCode.Tilde||!t&&"`"===String.fromCharCode(e.normCode)))&&((!(h.a.mac&&e.metaKey||!h.a.mac&&e.ctrlKey)||e.normCode!==u.a.KeyCode.Z&&e.normCode!==u.a.KeyCode.Y)&&!(e.normCode>=u.a.KeyCode.F1&&e.normCode<=u.a.KeyCode.F12))}},{key:"compoundOperation",value:function(e){p.default.PaneUpdateBatcher.beginUpdateItems(),e(),p.default.PaneUpdateBatcher.commitUpdateItems()}},{key:"confirmDelete",value:function(e,t){var a=e.checkDeleteProblem();a?p.default.menus.confirm("This item is ".concat(a,". Are you sure you want to delete it?"),(function(e){e&&t()})):t()}},{key:"getPageUp",value:function(e,t){for(var a=0,n=0;n<5&&t>0;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e.indexOfPrevVMLI(t);r>=0&&(t=r)}return t}},{key:"getPageDown",value:function(e,t){for(var a=0,n=e.items.length(),r=0;r<5&&t<n;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=e.indexOfNextVMLI(t);i>=0&&(t=i)}return t}},{key:"getPrevVMLI",value:function(e,t){var a=e.indexOfPrevVMLI(t);return a>=0?a:t}},{key:"getPrevHeader",value:function(e,t){var a=e.indexOfPrevHeader(t);return a>=0?a:t}},{key:"getNextVMLI",value:function(e,t){var a=e.indexOfNextVMLI(t);return a>=0?a:t}},{key:"getNextHeader",value:function(e,t){var a=e.indexOfNextHeader(t);return a>=0?a:t}}]),e}();t.a=new k},function(e,t,a){"use strict";var n=a(16),r=a.n(n),i=a(53),o=a.n(i),s=a(7),l=a.n(s),u=a(8),c=a.n(u),d=a(2),h=a(0),f=a(30),p=a(25),g=1e5,m={notify:"n",duration:"d",gcalId:"c",gcalCalendar:"b",completes:"x",repeatComplete:"r"},v=h.default.invertObject(m),y={freq:"f",byweekday:"w",byday:"b",byhour:"h",bymonth:"m",bymonthday:"t",byyearday:"y",byweekno:"n",byminute:"o",bysecond:"s",dtstart:"d",until:"u",interval:"i",count:"c"},k=h.default.invertObject(y),_=Object.keys(m),b=d.a.CalendarDayViewNumDaysPad,w=function(){function e(t,a){if(l()(this,e),t instanceof Date)this.date=t,this.dateCleared=p.a.clearTime(t);else{this.rruleset=t;try{h.default.PAssert(360,this.rruleset._rrule[0],"MooDate missing rrule in constructor",(function(){return o()(t)}))}catch(n){h.default.reportError(n)}}a&&this.copyOptionsFrom(a,!0)}return c()(e,[{key:"getNext",value:function(e,t,a){var n=this;if(this.date)return this.date;var r=this.rruleset._rrule[0];try{h.default.PAssert(361,r,(function(){return"MooDate missing rrule: "+n.toData()}))}catch(l){h.default.reportError(l)}if(r){e||(e=new Date(0));var i=this.rruleset._rrule[0].options,o=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()));i.dtstart&&i.dtstart>o?(o=i.dtstart,a&&(o=p.a.getDatePlusMS(o,d.a.MSPerMinute))):(t||!(i.freq<f.a.DAILY)&&(i.freq!==f.a.DAILY||i.byhour&&0!==i.byhour[0])||(e=p.a.getToday()),o=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes())));var s=this.rruleset.after(o,!0);return s&&(s=p.a.UTCtoLocal(s)),s}}},{key:"getStart",value:function(){if(this.date)return this.date;var e,t,a=this.rruleset._rrule[0].options,n=p.a.UTCtoLocal(a.dtstart);return(null===(e=a.byhour)||void 0===e?void 0:e[0])&&n.setHours(a.byhour[0]),(null===(t=a.byminute)||void 0===t?void 0:t[0])&&n.setMinutes(a.byminute[0]),n}},{key:"getEnd",value:function(e){var t=this.getDuration()||(e?0:d.a.DefaultEventDuration);if(this.date)return new Date(this.date.getTime()+t);var a=this.rruleset._rrule[0].options;if(a.until){var n,r,i=p.a.UTCtoLocal(a.until);return(null===(n=a.byhour)||void 0===n?void 0:n[0])&&i.setHours(a.byhour[0]),(null===(r=a.byminute)||void 0===r?void 0:r[0])&&i.setMinutes(a.byminute[0]),i.addMilliseconds(t),i}return new Date(this.getStart().getTime()+t)}},{key:"isOnDate",value:function(e){if(this.date){if(this.duration){var t=this.date.clone().addMilliseconds(this.duration);return e>=this.dateCleared&&e<=t}return+e===+this.dateCleared}return this._nextDates||this._generateDates(),!0===this._nextDatesMap[+e]}},{key:"getDate",value:function(){return this.date}},{key:"getFirstDate",value:function(){return this._nextDates||this._generateDates(),this._nextDates[0]}},{key:"_generateDates",value:function(){var e=this;if(!this.date&&!this._nextDates){var t=Date.now()+b*d.a.MSPerDay,a=this.rruleset.all((function(e,a){return a<b&&+e<t}));this._nextDates=a.map((function(e){return p.a.clearTime(p.a.UTCtoLocal(e))})),this._nextDatesMap={},this._nextDates.forEach((function(t){return e._nextDatesMap[+t]=!0}))}}},{key:"getAllDates",value:function(){return this.date?[this.date]:(this._nextDates||this._generateDates(),this._nextDates)}},{key:"isSingleDate",value:function(){return!!this.date}},{key:"isRange",value:function(){if(this.date)return!1;var e=this.rruleset._rrule[0].options;return 3===e.freq&&1===e.interval&&e.until}},{key:"hasTime",value:function(){var e;return null===(e=this.date||this.getFirstDate())||void 0===e?void 0:e.hasTimeOfDay()}},{key:"setDate",value:function(e){if(this.date&&!e.hasTimeOfDay()){var t=this.date.getTimeOfDay();this.date=p.a.clearTime(e).clone().addMilliseconds(t)}else this.date=e;this.dateCleared=p.a.clearTime(this.date),this.rruleset=void 0,this._nextDates=void 0}},{key:"setDuration",value:function(e){this.duration=e}},{key:"getDuration",value:function(){return this.duration}},{key:"setUntil",value:function(e){if(this.rruleset){var t=p.a.toUTCDate(e),a=this.rruleset._rrule[0];a.options.until=t,a.origOptions.until=t,this._nextDates=void 0}}},{key:"hasUntil",value:function(){var e;return!!(null===(e=this.rruleset)||void 0===e?void 0:e._rrule[0].options.until)}},{key:"setHours",value:function(e){var t=Math.floor(e),a=Math.round(60*(e-t));if(this.date)this.date.setHours(t),this.date.setMinutes(a);else{var n=this.rruleset._rrule[0];n.options.byhour=[t],n.origOptions.byhour=[t],n.options.byminute=[a],n.origOptions.byminute=[a],this._nextDates=void 0}}},{key:"clearTime",value:function(){if(this.date)this.date.setHours(0,0,0,0);else{var e=this.rruleset._rrule[0];e.options.byhour=[0],delete e.origOptions.byhour,e.options.byminute=[0],delete e.origOptions.byminute,this._nextDates=void 0}this.duration=0}},{key:"toText",value:function(e){var t,a=this;if(this.date)t=p.a.toHumanText(this.date);else{var n=this.rruleset._rrule[0];try{h.default.PAssert(362,n,"MooDate has no rrule",(function(){return a.toData()}))}catch(o){h.default.reportError(o)}if(n)if(e){var r=this.getNext();t=p.a.toHumanText(r)}else t=n.toText()}if(t&&!e&&this.duration){var i=Math.round(this.duration/d.a.MSPerMinute);t+=" "+(i>=60?h.default.round(i/60,2)+"hr":Math.round(i)+"m")}return t||""}},{key:"getGCalId",value:function(){return this.gcalId}},{key:"getGCalCalendar",value:function(){return this.gcalCalendar}},{key:"setGCalId",value:function(e){this.gcalId=e}},{key:"setGCalCalendar",value:function(e){this.gcalCalendar=e}},{key:"setGCalIdAndCalendar",value:function(e,t){this.gcalId=e,this.gcalCalendar=t}},{key:"removeGCal",value:function(){this.gcalId=void 0,this.gcalCalendar=void 0}},{key:"clone",value:function(){return e.fromData(this.toData())}},{key:"isRepeatDate",value:function(){return!!this.rruleset}},{key:"getTime",value:function(){if(this.date)return this.date.getTimeOfDay();var e=this.getNext();return e||(e=this.rruleset&&this.rruleset.before(new Date))&&(e=p.a.UTCtoLocal(e)),e?e.getTimeOfDay():void 0}},{key:"copyOptionsFrom",value:function(e,t){(!0===t||t.includes("notify"))&&(this.notify=e.notify),(!0===t||t.includes("duration"))&&(this.duration=e.duration),(!0===t||t.includes("gcalId"))&&(this.gcalId=e.gcalId),(!0===t||t.includes("gcalCalendar"))&&(this.gcalCalendar=e.gcalCalendar),(!0===t||t.includes("repeatComplete"))&&(this.repeatComplete=!!e.repeatComplete),!0===t&&(this.completes=e.completes)}},{key:"copyFrom",value:function(e,t){e.rruleset?(this.rruleset=e.rruleset,this.date=void 0):e.date&&(this.date=e.date,this.dateCleared=p.a.clearTime(e.date),this.rruleset=void 0),this.copyOptionsFrom(e,t),this._nextDates=void 0}},{key:"complete",value:function(){if(this.isRepeatDate()){var e=new Date;this.completes?this.completes.push(e):this.completes=[e];var t,a=this.rruleset._rrule[0];if(this.repeatComplete){var n=this.getTime(),r=e.addSeconds(1);0===n&&(r=p.a.clearTime(r));var i=p.a.toUTCDate(r);a.origOptions.dtstart=i,a.options.dtstart=i,a=this.rruleset._rrule[0]=f.b.fromString(this.rruleset.toString());var o=p.a.getTodayPlusDays(1);e=this.getNext(o,!0,!0)}return(t=this.getNext(new Date(0),!0,!0))&&(t=p.a.toUTCDate(t),a.origOptions.dtstart=t,a.options.dtstart=t,this._nextDates=void 0),!!t}}},{key:"setRepeatOnComplete",value:function(e){this.repeatComplete=e}},{key:"toICal",value:function(){if(this.isRepeatDate())return this.rruleset.toString()}},{key:"setRRuleOptions",value:function(e){var t=new f.c;t.rrule(new f.b(e)),this.rruleset=t,this.date=void 0,this._nextDates=void 0}},{key:"updateRRuleOptions",value:function(t){var a,n=null===(a=this.rruleset)||void 0===a?void 0:a._rrule[0];n?(n.options=Object.assign(n.options,t),n.origOptions=Object.assign(n.origOptions,t),this.date=void 0,this.rruleset.options=Object.assign(this.rruleset.options,t),this.rruleset.origOptions=Object.assign(this.rruleset.origOptions,t),this.rruleset=e.fromData(this.toData()).rruleset,this._nextDates=void 0):this.setRRuleOptions(t)}},{key:"setRange",value:function(t,a,n){var r=e.getOptionsFromRange(t,a,n);r instanceof Date?this.setDate(t):this.setRRuleOptions(r)}},{key:"getRRuleOptions",value:function(){if(this.rruleset)return this.rruleset._rrule[0].options}},{key:"getRepeatFrequency",value:function(){if(this.rruleset){var e=this.rruleset._rrule[0].options,t=this.freqToText(e.freq);if(t)return e.interval+t}}},{key:"freqToText",value:function(e){switch(e){case 0:return"y";case 1:return"m";case 2:return"w";case 3:return"d";case 4:return"h"}}},{key:"toData",value:function(){var e=this,t=[],a=[];if(_.forEach((function(t){var n=e[t];n&&("completes"===t?n=n.filter((function(e){return!isNaN(+e)})).map((function(e){return+e})).join(","):"duration"===t&&(n=Math.round(n/g)),a.push("".concat(m[t],":").concat(n)))})),a.length&&t.push(a.join(";")),this.date){var n=+this.date;if(!a.length)return""+n;t.push(n)}else t.push(this.rruleset._rrule.map((function(e){var t=e.origOptions;return Object.keys(t).map((function(e){var a=t[e];if(!h.default.isNullOrUndefined(a))return e=e.toLowerCase(),a instanceof Date?a=Math.round(+a/g):h.default.isArray(a)&&a[0]&&a[0]instanceof f.d?a=a.map((function(e){return e.weekday+(e.n&&e.n>0?"-"+e.n:"")})).join(","):h.default.isNumber(a)&&(a=Math.round(a)),"".concat(y[e],":").concat(a)})).filter((function(e){return!!e})).join(";")})).join("\n"));return t.join("\\")}}],[{key:"fromData",value:function(t){if(t&&"NaN"!==t){var a,n,i=+t;if(!h.default.isNumber(i)){var o=t.split("\\");if(o.length>1)a={},o[0].split(";").forEach((function(e){var t=e.split(":"),n=r()(t,2),i=n[0],o=n[1];"completes"===v[i]?o=o.split(",").map((function(e){return new Date(e)})):"duration"===v[i]&&(o*=g),a[v[i]]=o})),t=o[1]}if(t&&"NaN"!==t){if(i=+t,h.default.isNumber(i))n=new Date(i);else try{n=new f.c,t.split("n").forEach((function(e){var a={};if(e.split(";").forEach((function(e){var t,n=e.split(":"),i=r()(n,2),o=i[0],s=i[1],l=k[o];if(o===y.byweekday)s=s.split(",").map((function(e){var t=e.split("-"),a=r()(t,2),n=a[0],i=a[1],o=""!==n&&h.default.isNumber(+n)?+n:void 0,s=""!==i&&h.default.isNumber(+i)&&+i>0?+i:void 0;return new f.d(o,s)}));else if((null===(t=s)||void 0===t?void 0:t.indexOf(","))>0)s=s.split(",").map((function(e){return+e}));else if(h.default.isNumber(+s)){var u=s.indexOf(".");u>0&&(s=s.substr(0,u)),"dtstart"===l||"until"===l||s.length>6?s=new Date(+s*g):(s=+s,"interval"===l&&s<0&&(s=Math.abs(s)))}l&&(a[l]=s)})),a&&!h.default.isEmpty(a)){n.rrule(new f.b(a));try{h.default.PAssert(363,n._rrule[0],"RRuleSet created with no rrule",t)}catch(i){h.default.reportError(i)}}n._rrule[0]}))}catch(s){h.default.reportError(s,"Error parsing date string: "+t)}return new e(n,a)}}}},{key:"fromRRuleOptions",value:function(t,a){var n=new f.c;return n.rrule(new f.b(t)),new e(n,{duration:a})}},{key:"getOptionsFromRange",value:function(e,t,a){var n,r,i;if(void 0!==a&&(r=60*(a-(n=Math.floor(a))),e.setHours(n),e.setMinutes(r)),e=e.clone(),t=t.clone(),!e.equals(t)){r&&(e.setHours(r),t.setHours(r));var o={freq:f.a.DAILY,dtstart:p.a.toUTCDate(e),until:p.a.toUTCDate(t)};n&&(o.byhour=n?[n]:void 0),r&&(o.byminute=r?[r]:void 0),i=o}return i}},{key:"fromRange",value:function(t,a,n){var r,i=e.getOptionsFromRange(t,a,n);return i?(r=new f.c).rrule(new f.b(i)):r=t,new e(r)}},{key:"now",value:function(){return new e(new Date)}}]),e}();t.a=w},,function(e,t,a){"use strict";var n,r=a(38),i=a.n(r),o=a(7),s=a.n(o),l=a(8),u=a.n(l),c=a(10),d=a.n(c),h=a(11),f=a(0),p=a(4),g=a(27),m=(n=function(){function e(){s()(this,e),this._batchTimeout=void 0,this.itemsBatchingUpdates={}}return u()(e,[{key:"beginBatch",value:function(e){f.default.isEmpty(this.itemsBatchingUpdates)&&(this._batchTimeout=setTimeout(this._runUpdates,500)),this.itemsBatchingUpdates[e.id]||(this.itemsBatchingUpdates[e.id]={item:e})}},{key:"commitBatch",value:function(e){var t=this.itemsBatchingUpdates[e.id];t&&(this._runUpdate(e,t),delete this.itemsBatchingUpdates[e.id])}},{key:"itemItemsChanged",value:function(e){this.updateItem(e,"Items")}},{key:"itemTextChanged",value:function(e){this.updateItem(e,"Text")}},{key:"itemDateChanged",value:function(e){this.updateItem(e,"Date")}},{key:"itemRepeatDateCompleted",value:function(e){this.updateItem(e,"RepeatDateCompleted")}},{key:"itemPriorityChanged",value:function(e){this.updateItem(e,"Priority")}},{key:"itemTagsChanged",value:function(e,t){this.updateItem(e,"Tags",t)}},{key:"itemModifiedChanged",value:function(e){this.updateItem(e,"Modified")}},{key:"itemFontChanged",value:function(e){this.updateItem(e,"Font")}},{key:"itemHeaderChanged",value:function(e){this.updateItem(e,"Header")}},{key:"itemSearchChanged",value:function(e){this.updateItem(e,"Search")}},{key:"itemCompleteChanged",value:function(e){this.updateItem(e,"Complete")}},{key:"itemIndentChanged",value:function(e){this.updateItem(e,"Indent")}},{key:"updateItem",value:function(e,t,a){if(a=a||!0,this.itemsBatchingUpdates[e.id]){var n=this.itemsBatchingUpdates[e.id];n||(n=this.itemsBatchingUpdates[e.id]={item:e}),n[t]=a,this._batchTimeout&&clearTimeout(this._batchTimeout),this._batchTimeout=setTimeout(this._runUpdates,500)}else this._runUpdate(e,i()({item:e},t,a))}},{key:"_runUpdate",value:function(e,t){g.a.fireEvent("clearMeasureCacheItem",[e.id]),!e.isDestroyed()&&e.getItemStore()&&e.getItemStore().onItemChanged(e,t)}},{key:"_runUpdates",value:function(){var e=this;f.default.batchRenderUpdates((function(){for(var t in p.default.PaneUpdateBatcher.beginUpdateItems(),e.itemsBatchingUpdates)if(e.itemsBatchingUpdates.hasOwnProperty(t)){var a=e.itemsBatchingUpdates[t];e._runUpdate(a.item,a)}e.itemsBatchingUpdates={},p.default.PaneUpdateBatcher.commitUpdateItems()}))}}]),e}(),d()(n.prototype,"_runUpdate",[h.a],Object.getOwnPropertyDescriptor(n.prototype,"_runUpdate"),n.prototype),d()(n.prototype,"_runUpdates",[h.a],Object.getOwnPropertyDescriptor(n.prototype,"_runUpdates"),n.prototype),n);t.a=new m},function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(133),l=function(){function e(t){r()(this,e),this._listeners=[],this._enabled=!0,t&&this.listen(t)}return o()(e,[{key:"listen",value:function(e){var t=new s.a(this,e);return this._addListener(t),t}},{key:"_addListener",value:function(e){this._listeners.push(e)}},{key:"_hasListener",value:function(e){return this._listeners.indexOf(e)>=0}},{key:"unlisten",value:function(e){var t=this._listeners.findIndex((function(t){return t.cb===e}));t>=0&&this._listeners.removeAt(t)}},{key:"unlistenListener",value:function(e){this._listeners.remove(e)}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1}},{key:"notify",value:function(){if(this._enabled)for(var e=0,t=0;t<this._listeners.length;++t){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;arguments.length>0?this._listeners[t].cb(arguments.length<=0?void 0:arguments[0]):this._listeners[t].cb()}}}]),e}();t.a=l},function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(20),l=a.n(s),u=a(21),c=a.n(u),d=a(13),h=a.n(d),f=a(28),p=a(2),g=a(0),m=a(9),v=a(3),y=a(4),k=a(33),_=a(56),b=a(70),w=a(75);function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=h()(e);if(t){var r=h()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return c()(this,a)}}var D=function(e){l()(a,e);var t=S(a);function a(e){var n;return r()(this,a),(n=t.call(this,e)).__isInput=!0,n}return o()(a,[{key:"init",value:function(){var e=this.props,t={isFocused:e.focused,isComposing:!1,value:e.value||"",tokens:e.tokens||[],validationError:void 0,item:e.item?{item:e.item,text:e.item.getStyledTextAsOneLine()}:void 0};this.isInput=!!e.type,this.isInput||(this.html=this.parseHTML(t.value||p.a.TextSpace)),e.buttonText&&(t.isLoading=!1),this.createObservables(t)}},{key:"onMount",value:function(){this.updateHTML(this.state.value,!1),this.props.focused&&(this.focus(),this.props.selectAll?this.selectAll():this.selectEnd())}},{key:"onUnmount",value:function(){this.isFocused.get()&&this.onBlur()}},{key:"componentWillReceiveProps",value:function(e){this.state.item!==e.item&&e.item&&this.item.set(e.item?{item:e.item,text:e.item.getStyledTextAsOneLine()}:void 0),this.props.value===e.value||e.value===this.state.value||e.noUpdateValueWhileFocused&&this.state.isFocused||(this.setValue(e.value,this.isFocused.get()),this.forceUpdate()),this.props.tokens!==e.tokens&&e.tokens!==this.state.tokens&&this.tokens.set(e.tokens)}},{key:"componentDidUpdate",value:function(e){var t=this._isDirty;if(this._isDirty=void 0,t&&this._dirtyCallbacks){for(var a=0,n=0;n<this._dirtyCallbacks.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._dirtyCallbacks[n]()}this._dirtyCallbacks=void 0}this.props.autocompleteItem!==e.autocompleteItem&&this.updateAutocomplete()}},{key:"clearValue",value:function(){this.setValue("")}},{key:"clearTokens",value:function(){this.tokens.clear()}},{key:"isButtonEnabled",value:function(){return void 0!==this.props.buttonEnabled?this.props.buttonEnabled:this.state.value||this.state.tokens.length>0}},{key:"getValue",value:function(){return this.value.get()}},{key:"getTokens",value:function(){var e=this.getValue().trim(),t=this.tokens.get();return e?t.concat([{text:e,email:e,type:"contact"}]):t}},{key:"getItem",value:function(){return this.state.item}},{key:"parseHTML",value:function(e){var t;if(this.props.parse){var a=w.a.parseTextNew(void 0,e,b.a.getContacts(),!0);this.parsedEls=a.elsNew;var n=e.match(/(^#|[\(\s]#)([^\s\),#]+)/g);n&&(n=n.map((function(e){return e.trim().slice(1)}))),this.tags=a.tags=n,this.contacts=a.contacts,this.props.onParsed&&this.props.onParsed(a),t=y.default.ElementRenderer.renderNew(a.elsNew.elements,void 0,void 0,{convertSpaces:!0,noFormat:!0,showMarkdown:!0})}else t=e&&g.default.escape(e).replace(/ /g,"&nbsp;");return t}},{key:"addDirtyCallback",value:function(e){this._dirtyCallbacks||(this._dirtyCallbacks=[]),this._dirtyCallbacks.push(e)}},{key:"focus",value:function(){this._isDirty?this.addDirtyCallback(this.focus):this.refs.input.focus()}},{key:"blur",value:function(){this.refs.input.blur()}},{key:"select",value:function(){k.default.selectElement(this.refs.input)}},{key:"selectEnd",value:function(e){if(!e&&this._isDirty)this.addDirtyCallback(this.selectEnd);else{var t=this.refs.input.textContent;t.length>0&&t!==p.a.TextSpace&&k.default.selectElement(this.refs.input,t.length)}}},{key:"selectAll",value:function(e){if(!e&&this._isDirty)this.addDirtyCallback(this.selectAll);else{var t=this.refs.input.textContent;t.length>0&&t!==p.a.TextSpace&&k.default.selectElement(this.refs.input,0,t.length)}}},{key:"handleCut",value:function(e){var t=this.getSelectionOffsets();if(t.start===t.end){var a=m.a.ie?"Text":"text/plain",n=e&&e.clipboardData?e.clipboardData:window.clipboardData,r=this.getValue();n.setData(a,r),this.clearValue(),this.onInput(),g.default.preventDefault(e),g.default.stopPropagation(e)}}},{key:"_getHotkeys",value:function(e){var t=[y.default.hotkeys.create(p.a.KeyCode.L,!0,p.a.Primary.No,p.a.Shift.Either,this.selectAll)];return m.a.app&&t.push(y.default.hotkeys.create(p.a.KeyCode.L,!0,p.a.Primary.Yes,p.a.Shift.Either,this.selectAll)),e&&t.push(y.default.hotkeys.create(p.a.KeyCode.Escape,!0,p.a.Primary.Either,p.a.Shift.Either,this.handleEscapeKey)),t}},{key:"onFocus",value:function(e){this.props.autocompleteMode&&_.a.clearDisabled(),this.props.autocompleteOnClick&&this.updateAutocomplete(),this.isFocused.set(!0),this.___hotkeys=y.default.hotkeys.pushStack(this._getHotkeys(!!this.props.onEscape||this.props.blurOnEscape)),this.refs.input.addEventListener("cut",this.handleCut,!0),this.props.onFocus&&this.props.onFocus(e)}},{key:"onBlur",value:function(e){this.isButtonMouseDown?this.refs.input.focus():(this.isFocused.set(!1),this.___hotkeys&&(y.default.hotkeys.popStack(this.___hotkeys),this.___hotkeys=void 0),this.refs.input.removeEventListener("cut",this.handleCut,!0),this.props.onBlur&&this.props.onBlur(e))}},{key:"getSelectionOffset",value:function(){return this.getSelectionOffsets().end}},{key:"getSelectionOffsets",value:function(){var e=k.default.getSelectionRangeNative(),t={start:0,end:0};return e&&(t=k.default.getSelectOffsetsInElement(this.refs.input,e)),t}},{key:"_setSelectionOffset",value:function(e){var t,a;if(e>0){var n=k.default.getOffsetChildElement(this.refs.input,e);n&&(t=n.element,a=n.offset)}else t=this.refs.input,a=0;if(t){var r=k.default.createFakeRange(t,a,t,a);try{g.default.PAssert(544,r,"Range should be valid when setting selection offset")}catch(i){g.default.reportError(i)}r&&k.default.setSelectionRange(r)}}},{key:"setSelectionOffset",value:function(e){this._setSelectionOffset(e)}},{key:"updateAutocomplete",value:function(e){var t=this.props,a=this.refs.input,n=t.autocompleteMode;if(e=t.autocompleteItem||e||this.item.get(),n){var r=k.default.getSelectionInElement(a);(t.autocompleteOnClick||r&&r.start===r.end)&&_.a.update({mode:n,canAutocompleteItems:t.canAutocompleteItems,text:this.value.get(),offset:r?r.start:0,owner:this,item:e,pane:this.props.pane,parsedEls:this.parsedEls,positionOffset:t.positionOffset,elementDisplay:t.autocompleteElementDisplay||this.refs.wrapper,elementInput:a,supportSearchItemAutocomplete:t.supportSearchItemAutocomplete,noShow:t.noShowAutocomplete,showNoMatches:t.autocompleteOnClick,canAutocompleteLinkedItems:!1})}}},{key:"setValue",value:function(e,t,a){this._isDirty=!0;try{g.default.PAssert(545,void 0!==e,"Should not set FancyInput value to undefined")}catch(n){g.default.reportError(n)}e=e||"",this.updateHTML(e,t,a),this.value.set(e)}},{key:"updateHTML",value:function(e,t,a){var n=a;t&&void 0===n&&(n=this.getSelectionOffset());var r=this.parseHTML(e||p.a.TextSpace);r!==this.refs.input.innerHTML&&(this.refs.input.innerHTML=r),t&&(n>e.length&&(n=e.length),this.setSelectionOffset(n))}},{key:"addToken",value:function(e){this.tokens.push(e);var t=this.refs.inner;t.scrollWidth>t.clientWidth&&(t.scrollLeft=t.scrollWidth-t.clientWidth)}},{key:"updateTokens",value:function(e){for(var t=0,a=g.default.parseTokensFromText(this.value.get()),n="",r=0;r<a.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=a[r];"contact"===i.type?this.addToken(i):n+=i.text}this.setValue(n,!0)}},{key:"onChange",value:function(){var e,t,a=this.refs.input.value;(this.value.set(a),"password"!==this.props.type)&&(null===(e=(t=this.props).onChange)||void 0===e||e.call(t,a,this.item.get()))}},{key:"onInput",value:function(){if(!this.isComposing.get()){var e=this.refs.input.textContent.replace(/\u00a0/g," ").replace(new RegExp(p.a.TextSpace,"g"),"").replace(/\n/g,""),t=this.props.validator;this.setValue(e,!0),this.updateAutocomplete(),!t||t(e)?(this.validationError.set(!1),this.props.onChange&&this.props.onChange(e,this.item.get())):this.validationError.set(!0)}}},{key:"handleEscapeKey",value:function(){this.props.onEscape?this.props.onEscape():this.isInput||this.select(),this.__hotkeyEscape&&(y.default.hotkeys.popStack(this.handleEscapeKey),this.__hotkeyEscape=void 0),this.props.blurOnEscape&&this.refs.input.blur()}},{key:"onMouseDown",value:function(e){e.stopPropagation(),this.props.onMouseDown&&this.props.onMouseDown(e)}},{key:"onKeyDown",value:function(e){var t=this.props;this.isInput||(t.autocompleteMode&&_.a.isShowing()||t.buttonText&&(e.keyCode!==p.a.KeyCode.Enter||t.onEnter||this.onButtonClick()),e.keyCode===p.a.KeyCode.Backspace&&(!this.state.value&&this.state.tokens.length>0&&this.removeToken(this.tokens.length()-1),0===this.refs.input.textContent.length&&(this.refs.input.textContent=p.a.TextSpace)),e.keyCode===p.a.KeyCode.Tab&&_.a.isShowing()&&_.a.hide()),e.keyCode===p.a.KeyCode.Enter&&(t.onEnter&&t.onEnter(e),e.preventDefault()),t.onKeyDown&&t.onKeyDown(e)}},{key:"onKeyUp",value:function(e){var t=this.props;!this.isInput&&t.autocompleteMode&&(e.keyCode!==p.a.KeyCode.ArrowLeft&&e.keyCode!==p.a.KeyCode.ArrowRight||this.updateAutocomplete()),"email"===t.autocompleteMode&&(e.keyCode===p.a.KeyCode.Comma?this.updateTokens(!1):e.keyCode===p.a.KeyCode.Enter&&this.updateTokens(!0)),t.onKeyUp&&t.onKeyUp(e)}},{key:"onCompositionStart",value:function(){this.isComposing.set(!0)}},{key:"onCompositionEnd",value:function(e){this.isComposing.set(!1),this.onInput()}},{key:"onAutocompleteSelected",value:function(e){var t=this.props;e.item&&t.isSearch?t.onAutocompleteSelected(e):(e.item&&this.item.set({item:e.item,text:e.item.getStyledTextAsOneLine()}),void 0!==e.value&&(this.setValue(e.value,!0,e.offset),t.onChange&&t.onChange(e.value,this.item.get())),e.token&&(this.addToken(e.token),this.setValue("",!0)),t.onAutocompleteSelected&&t.onAutocompleteSelected(e))}},{key:"onButtonMouseDown",value:function(){this.isButtonMouseDown=!0}},{key:"onButtonMouseUp",value:function(){this.isButtonMouseDown=!1}},{key:"onButtonClick",value:function(){var e=this.state;if(this.isButtonEnabled()){if(this.props.onButtonClick)this.props.onButtonClick(e.value,this.onButtonClickCallback)&&this.isLoading.set(!0);_.a.isShowing()&&_.a.hide()}}},{key:"onButtonClickCallback",value:function(){this.value.set(""),this.isLoading.set(!1)}},{key:"removeToken",value:function(e){var t=this.props,a=this.tokens.get()[e];this.tokens.removeAt(e),t.onChange&&t.onChange(this.getValue(),this.item.get()),t.onTokenRemoved&&t.onTokenRemoved(a)}},{key:"removeItem",value:function(){this.item.set(void 0),this.props.onChange&&this.props.onChange(this.getValue(),this.item.get())}},{key:"render",value:function(){var e,t,a=this.state,n=this.props,r=n.margin||{},i=n.padding||{};isNaN(i.left)&&(i.left=8),isNaN(i.right)&&(i.right=8);var o,s=!1!==n.border,l=s?2:0,u=g.default.classNames("fancyInput",{disabled:n.disabled},{focused:a.isFocused},{hasFloatingText:!!n.floatingText},{hasButton:!!n.buttonText},{hasBorder:s},this.props.className),c=n.height||40,d=(c-40)/2,h=g.default.extend({width:n.width,maxWidth:n.maxWidth,height:c,display:n.display,fontSize:n.fontSize},n.style);if(n.floatingText)i.bottom=5+Math.min(d,2),i.top=c-16-i.bottom;else{var y=(c-l-16)/2;i.top=y,i.bottom=y}if(n.floatingText){var k={marginBottom:5+d,marginLeft:i.left,marginRight:i.right};a.isFocused||a.value?a.isFocused?k.color=g.default.colorBlue:k.color="#ccc":k.color="#aaa";var _=g.default.classNames("placeholder c-foreground-super-faded z-1","noSelect",{floating:a.isFocused||a.value||a.tokens.length>0});e=v.createElement("div",{className:_,style:k},n.floatingText)}else if(n.placeholder&&!a.value&&!a.isComposing&&0===a.tokens.length&&!a.item){var b={paddingTop:i.top,marginLeft:i.left,marginRight:i.right};e=v.createElement("div",{className:"placeholder c-foreground-very-faded noSelect",style:b},n.placeholder)}if(!1!==n.underline){var w={};a.isFocused&&!a.item?w[m.a.transform.react]="":w[m.a.transform.react]="scale(0,1)",t=v.createElement(f.b.div,{className:"focusUnderline",initial:{scaleX:0,scaleY:1},animate:{scaleX:a.isFocused&&!a.item?1:0},transition:p.a.TransitionSpring7})}if(n.buttonText){var S=g.default.classNames("fancyInputButton c-button-raised-primary",{loading:a.isLoading},{disabled:!this.isButtonEnabled()}),D={width:n.buttonWidth,lineHeight:c+"px"};o=v.createElement("span",{className:S,style:D,onMouseDown:this.onButtonMouseDown,onClick:this.onButtonClick,onMouseUp:this.onButtonMouseUp},n.buttonText)}var P,I={paddingLeft:i.left,paddingRight:i.right,marginLeft:r.left,marginRight:r.right},E={ref:"input",className:"fancyInputInput",style:Object.assign({paddingTop:i.top,paddingBottom:i.bottom},n.inputStyle),onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onMouseDown:this.onMouseDown,autoComplete:"false",tabIndex:n.tabIndex,disabled:a.isLoading};this.isInput?(E.type=n.type,E.placeholder=n.placeholder,E.onChange=this.onChange,E.autoComplete=n.autoComplete,E.value=a.value,P=v.createElement("input",E)):(E.onInput=this.onInput,E.contentEditable=n.readonly||a.item?null:"true",E.onCompositionStart=this.onCompositionStart,E.onCompositionEnd=this.onCompositionEnd,P=v.createElement("div",E));var C=[];if(a.tokens)for(var x=0,A=0;A<a.tokens.length;A++){if(x++>5e3&&__infLoop&&__infLoop(x))throw new RangeError;var T=a.tokens[A],M={marginTop:i.top-4,paddingLeft:n.padding&&!isNaN(n.padding.left)?n.padding.left:8};C.push(v.createElement("div",{key:"token"+A,className:"token c-button-raised c-border",style:M},v.createElement("span",{dangerouslySetInnerHTML:{__html:T.text}}),v.createElement("i",{className:"icon-close c-button",onClick:this.removeToken.bind(this,A)})))}if(a.item){var L={lineHeight:c+"px",marginTop:0,paddingLeft:n.padding&&!isNaN(n.padding.left)?n.padding.left:8};C.push(v.createElement("div",{key:"tokenItem",className:"token flexbox",style:L},v.createElement("span",{className:"f1",dangerouslySetInnerHTML:{__html:a.item.text}}),v.createElement("i",{className:"icon-close c-button",onClick:this.removeItem})))}var O=g.default.classNames("fancyInputWrap c-foreground font-normal",a.validationError?"c-border-red":"c-border-heavy",n.backgroundTheme,{"c-background":!n.backgroundTheme},{hasTokens:C.length>0},{hasItem:a.item});return v.createElement("div",{className:u,id:this.props.id,style:h,onClick:this.props.onClick},v.createElement("div",{className:"fancyInputContent"},v.createElement("div",{className:O,ref:"wrapper"},e,v.createElement("div",{className:"fancyInputInner",style:I,ref:"inner"},C,v.createElement("div",{className:"fancyInputInner2"},P)),t),o))}}]),a}(a(45).a);t.a=D},function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(16),r=a.n(n),i=a(3);function o(){var e=Object(i.useReducer)((function(e){return e+1}),0);return r()(e,2)[1]}},function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(3);function r(e){var t=Object(n.useRef)(),a=t.current;return t.current=e,a}},function(e,t,a){"use strict";var n=a(16),r=a.n(n),i=a(4),o=a(0),s=a(3),l=a.n(s),u=a(17),c=a(72),d=a(79);t.a=Object(u.b)((function(e){var t=e.mode,a=e.className,n=e.color,u=e.width,h=e.height,f=e.icon,p=e.iconSize,g=e.iconPadding,m=e.size,v=e.text,y=e.disabled,k=e.tooltip,_=e.tooltipHotkey,b=e.selected,w=e.align,S=e.style,D=e.styleText,P=e.padding,I=e.primary,E=e.iconSrc,C=(e.newStyle,e.showLoader),x=(e.hoverBG,e.onClick),A=e.onMouseDown;w=w||"center";var T=C?Object(s.useState)(!1):[!1],M=r()(T,2),L=M[0],O=M[1],R=o.default.classNames("relative flex items-center cursor-pointer rounded text-center box-border truncate select-none",{mobutton:!0},{"font-bold text-12 inline-flex c-shadow-lighter":!1},{"justify-center":"center"===w},{"justify-end":"right"===w},{"c-bg-gray-300 c-bg-gray-300-hover":"contained"===t&&!I},{"c-button-hover":!1},{"border c-border-heavy":"outlined"===t},{"c-button-selected":b},(void 0===u||P)&&(P||"px-2"),{"py-2":void 0===h},{"c-button-raised-primary c-white":I&&"contained"===t},y?"c-foreground-very-faded":n||"c-foreground-light",a),F=Object.assign({fontSize:m,width:u,height:h,lineHeight:h+"px"},S),N=_?o.default.isString(_)?_:i.default.hotkeys.printHotkeyByName(_.name,_.group):void 0,B=o.default.classNames((f||E)&&v&&(g||"pr-2"),{invisible:L}),j=o.default.classNames("truncate",{invisible:L});return l.a.createElement("div",{className:R,style:F,onClick:function(e){if(!L){var t=x(e);C&&t&&"function"===typeof t.then&&(O(!0),t.then((function(){O(!1)})))}},onMouseDown:A,"data-tooltip":k,"data-tooltiphotkey":N},f&&l.a.createElement(c.a,{name:f,size:p,className:B}),E&&l.a.createElement("img",{src:E,width:p,height:p,className:B}),v&&l.a.createElement("div",{className:j,style:D},v),L&&l.a.createElement(d.a,{center:!0,size:6,color:I?"#fff":void 0}))}))},function(e,t,a){"use strict";var n=a(5),r=a.n(n),i=a(12),o=a.n(i),s=a(38),l=a.n(s),u=a(7),c=a.n(u),d=a(8),h=a.n(d),f=a(10),p=a.n(f),g=a(0),m=a(2),v=a(4),y=a(11),k=a(23),_=a(37),b=a(16),w=a.n(b),S=a(20),D=a.n(S),P=a(21),I=a.n(P),E=a(13),C=a.n(E),x=a(18),A=a(25),T=a(15),M=a(42),L=a(54),O=a(87),R=a(81),F=function e(t){c()(this,e),this.id=t},N=function(){function e(t,a){var n;c()(this,e);var r,i=t.isRead,o=t.data,s=t.isComplete,l=o.subject,u=o.date,d=o.snippet,h=o.accountID,f=o.service,p=o.contacts,m=o.numMessages,v=o.labels,y=o.hasAttachment;if(this.plugin=a,this.pluginData=t,this.id=t.id,this.text=this.subject=l||"",this.accountID=h,this.service=f,this.subjectLower=null===(n=this.subject)||void 0===n?void 0:n.toLowerCase(),this.isRead=new T.a(i),this.numMessages=new T.a(m),a.isOldEmail(o)&&o.messages){var k=o.messages,_=(k=k||[])[k.length-1],b=_.snippet,w=_.date;if(r=w,this.participants=o.participants||a.getParticipants(k)||[],this.isComplete=s,this.snippet=null===b||void 0===b?void 0:b.replace(/[\r\n]/g,""),w)try{this.date=g.default.isNumber(w)?new Date(w):this.plugin.parseDate(w)}catch(D){try{g.default.PAssert(1033,!1,"Error parsing dateString",w)}catch(P){g.default.reportError(P)}}this.labels=g.default.arrayUniques2(g.default.arrayFlat(k.map((function(e){return e.labelIds})).filter((function(e){return!!e}))))||[],this.numMessages.set(k.length)}else this.participants=p||[],this.snippet=d,this.date=g.default.isString(u)?this.plugin.parseDate(u):u,this.labels=v||[],this.hasAttachment=y;if(!g.default.isArray(this.participants)){try{g.default.PAssert(1034,!1,"No valid participants",this.participants)}catch(P){g.default.reportError(P)}this.participants=[]}var S=g.default.isDateValid(this.date);try{g.default.PAssert(1035,S,(function(){var e;return"Date is invalid: ".concat(u,", ").concat(r,", ").concat(a.isOldEmail(o),", ").concat(a.isOldEmail(o)&&(null===(e=o.messages)||void 0===e?void 0:e.length))}))}catch(P){g.default.reportError(P)}S||(this.date=new Date),this.isStarred=new T.a(this.labels.includes("starred"))}return h()(e,[{key:"updateFromData",value:function(e,t){this.hiddenBeforeRefresh=!1,this.text=this.subject=e.subject,this.date=this.plugin.parseDate(e.date),this.labels="g"!==t&&this.labels?this.updateLabels(this.labels,e.labels):e.labels,this.isRead.set(e.read),this.isStarred.set(e.labels.includes("starred"))}},{key:"updateLabels",value:function(e,t){var a=g.default.arrayUnion(e,t);return(t.includes("archive")||t.includes("deleted"))&&a.remove("inbox"),t.includes("inbox")&&a.remove("archive"),a}},{key:"setRead",value:function(e,t){if(this.isRead.get()!==e){this.isRead.set(e);var a={isRead:e};this.plugin.isItemSaved(this.id)&&g.default.isLocalChange(t)&&this.plugin.saveData(this.id,a),he.onMetadataChanged(this,a)}}},{key:"archive",value:function(){this.plugin.sendAction(this.accountID,this.service,"archive",this.id),this.labels.remove("inbox")}},{key:"delete",value:function(){this.plugin.sendAction(this.accountID,this.service,"delete",this.id),this.labels.push("trash")}}]),e}(),B=a(84),j=a.n(B),U=a(60),H=a.n(U),V=a(24),W=a.n(V),z=(a(9),a(56)),q=a(75),G=a(31);function K(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=C()(e);if(t){var r=C()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return I()(this,a)}}var Y,X=function(e){D()(a,e);var t=K(a);function a(e,n,r){var i;return c()(this,a),r=Object.assign({title:n,contextMenuMode:n,dropEffect:function(){return m.a.DropEffect.Copy},isWriteable:!1,isDropTarget:!1,overrideCopyBehavior:!1,canAddItem:!1,supportCollapsing:!0,supportCompleting:!1,supportCheckbox:!1,supportOffline:!1,supportPerformArchive:!1,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportClickOverviewScroll:!1,supportClone:!1,supportDates:!1,supportSel:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,searchFilters:[],supportsDocuments:!1,usesVMLIs:!1},r),(i=t.call(this,e,r)).isSimplePane=!0,i.allItemsSimple=[],i.itemsSimple=new M.a,i.titles=new T.a,i}return h()(a,[{key:"usesItemStore",value:function(){return!1}},{key:"simpleObjectAtIndex",value:function(e){return this.itemsSimple.get()[e]}},{key:"onMetadataChanged",value:function(e,t){}}]),a}(a(107).a),Q=a(83);function J(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=C()(e);if(t){var r=C()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return I()(this,a)}}var Z,$="All Accounts",ee="Saved",te=(Y=function(e){D()(a,e);var t=J(a);function a(e){var n,r;c()(this,a),(r=t.call(this,e,"Email",{maxWidthFlex:m.a.ExpandedPaneWidth,maxWidth:m.a.ExpandedPaneWidth+200,maxWidthSingle:m.a.ExpandedPaneWidth,widthBiggerInSingle:!1,supportDataRefresh:"Emails",searchFilters:[{name:"unread",initialValue:1,icon:"icon-drafts",tooltip:"unread emails",matchFnBoolean:function(e){return!e.isRead.get()}}]})).type=m.a.PaneMode.Inbox,r.paneClass="paneInbox",r.pluginNew=he.getPluginNew("Email");var i=(null===(n=e.item)||void 0===n?void 0:n.split(":"))||[],o=w()(i,3),s=o[0],l=o[1],u=o[2];r._zoomedItem=new T.a({accountID:s||$,label:l||"inbox",service:u||"g"},r.onZoomedItemChanged),r.zoomedItem=new Q.a([r._zoomedItem],(function(e){return{accountID:ee,label:"inbox"}})),r.onZoomedItemChanged(r.zoomedItem.get()),G.a.getSelectedForPaneObs(H()(r)).listen(r.onMultiselectChanged);var d=0;return window.addEventListener("focus",(function(){var e=Date.now();e-d>m.a.MSPerMinute&&(d=e,r._refreshPaneData())})),r}return h()(a,[{key:"init",value:function(){W()(C()(a.prototype),"init",this).call(this),this.updateItemsImmediate(),this.pluginNew.items.listen(this.onPluginItemsChange),this.updateLabel()}},{key:"destroy",value:function(){this.pluginNew.items.unlisten(this.onPluginItemsChange),W()(C()(a.prototype),"destroy",this).call(this)}},{key:"onPluginItemsChange",value:function(){this.updateItemsImmediate()}},{key:"updateItemsImmediate",value:function(e,t,a,n){var r=this,i=G.a.getSelectedObjects(this);this.checkChildren();var o=this.pluginNew.items.get(),s=[],l=0;o.forEach((function(e){r.isItemInView(e)&&r.search.isMatchedSimple(e.id)&&s.push({id:e.id,index:l++,item:e,pane:r,type:"item"})})),this.allItemsSimple=o,this.itemsSimple.set(s);var u=G.a.getSelectedObjects(this);if(i&&u&&!u.map((function(e){return e.id})).equals(i.map((function(e){return e.id})))){var c=i.find((function(e){return s.find((function(t){return e.id===t.id}))}));if(c){var d=s.find((function(e){return c.id===e.id}));d&&G.a.setSelectedNew([d.index],this)}else u.length>0&&v.default.EmailPreview.isOpenOnPane(this)&&this.openEmail(u[0].index)}}},{key:"isItemInView",value:function(e){var t=this.zoomedItem.get(),a=t.accountID,n=t.label,r=this.pluginNew.isItemSaved(e.id),i=e.labels.includes("trash"),o=e.labels.includes("spam");return!e.hiddenBeforeRefresh&&((a===ee||a===$)&&r&&!e.isComplete||(a===$||e.accountID===a)&&(i&&"trash"===n||!i&&!o&&("all"===n||e.labels.includes(n))))}},{key:"createVMLIsToDrop",value:function(e,t){var a=this,n=t.targetItem||t.targetPane.getItem();return e.items.map((function(e){return a.createVMLIFromItem(e.id,n)}))}},{key:"createVMLIFromItem",value:function(e,t){return x.a.createVMLI({text:this.pluginNew.getEmbedString(e)},{parent:t,documentOwner:t.getDocumentOwner(),changeType:m.a.ChangeType.Local})}},{key:"numItems",value:function(){return this.itemsSimple.length()}},{key:"checkChildren",value:function(){var e=this;this.pluginNew.items.get().forEach((function(t){return t&&e.search.checkItemSimple(t,[t.subjectLower].concat(j()(t.participants.map((function(e){return e.text+e.email})))))}))}},{key:"autocompleteCopy",value:function(){var e=this,t=G.a.getFirstSelectedIndex(this);z.a.showPopup({pane:this,mode:"move",text:"Select item to move to",elementDisplay:this.listManager.getElementByIndex(t),documentSelector:!0,onSelected:function(t){var a=t.item;G.a.forEach(e,(function(t){var n=e.createVMLIFromItem(t.id,a);a.insertItem(n),e.onMoveToDocument(t)}))}})}},{key:"autocompleteCreateTask",value:function(){var e=this,t=G.a.getFirstSelectedIndex(this);v.default.menus.openItemEditor({element:this.listManager.getElementByIndex(t),pane:this,selectIndex:0,addOnSave:!0,selectDocument:!0,side:"bottom",positionOffset:{left:10},beginSave:function(){v.default.PaneUpdateBatcher.beginUpdateItems()},endSave:function(t){Date.now();G.a.forEach(e,(function(a){var n=e.createVMLIFromItem(a.id,t);t.insertItem(n),e.onMoveToDocument(a)})),v.default.PaneUpdateBatcher.commitUpdateItems()}})}},{key:"doMultiselectAction",value:function(){var e=o()(r.a.mark((function e(t){var a,n,i,o,s,l,u,c=this;return r.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if("MarkRead"!==t){e.next=4;break}a=function(e){e.setRead(!0,m.a.ChangeType.Local),c.pluginNew.sendAction(e.accountID,e.service,"read",e.id)},e.next=38;break;case 4:if("MarkUnread"!==t){e.next=8;break}a=function(e){e.setRead(!1,m.a.ChangeType.Local),c.pluginNew.sendAction(e.accountID,e.service,"unread",e.id)},e.next=38;break;case 8:if("OpenInGmail"!==t){e.next=12;break}a=function(e){c.openInGmail(e)},e.next=38;break;case 12:if("CopyToItem"!==t){e.next=16;break}this.autocompleteCopy(),e.next=38;break;case 16:if("CopyToNewItem"!==t){e.next=20;break}this.autocompleteCreateTask(),e.next=38;break;case 20:if("Star"!==t){e.next=24;break}a=function(e){void 0===i&&(i=!e.isStarred.get()),e.isStarred.set(i),c.pluginNew.sendAction(e.accountID,e.service,i?"star":"unstar",e.id)},e.next=38;break;case 24:if("Archive"!==t){e.next=29;break}a=function(e){e.archive()},n=!0,e.next=38;break;case 29:if("Delete"!==t){e.next=38;break}if(s=(null===(o=this.zoomedItem.get())||void 0===o?void 0:o.accountID)===ee,l=!0,!s){e.next=37;break}return u=G.a.numSelectedInPane(this),e.next=36,v.default.menus.confirm("Are you sure you want to unsave ".concat(u>1?"these emails":"this email","?"));case 36:l=e.sent;case 37:l&&(a=function(e){s?e.plugin.deleteItem(e.id):e.delete()},n=!0);case 38:a&&G.a.forEach(this,a),n&&this.updateItems();case 40:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onHotkey",value:function(e,t){if(G.a.hasSelection(this)){if("Up"===e||"Down"===e)G.a.onKeyDown(this,t);else if("Open"===e){var a=G.a.getSelected(this);1===a.length&&this.openEmail(a[0])}else this.doMultiselectAction(e);g.default.preventAndStop(t)}}},{key:"openInGmail",value:function(e){var t="https://mail.google.com/mail/u/".concat(e.pluginData.data.accountID,"#inbox/").concat(e.id);v.default.openUrl(t)}},{key:"openEmail",value:function(e,t){var a=this.itemsSimple.get()[e];if(a){var n=q.a.parseSinglePlugin(this.pluginNew.getEmbedString(a.id),m.a.ChangeType.ItemLoad).attachments;if(n){var r=v.default.pluginManager.getAttachment(n[0],!0);r&&(t&&v.default.EmailPreview.isOpenOnPane(a.pane)&&v.default.EmailPreview.isOpenOnThread(r)?v.default.EmailPreview.close():(v.default.EmailPreview.open(void 0,r,this),a.item.setRead(!0,m.a.ChangeType.Local)))}}}},{key:"onMultiselectChanged",value:function(e){1===e.length?v.default.EmailPreview.isOpen()&&this.openEmail(e[0]):v.default.EmailPreview.reset()}},{key:"onDoubleClick",value:function(e){this.openEmail(e,!0)}},{key:"onMetadataChanged",value:function(e,t){var a=t.isComplete,n=t.isRead;(void 0!==a&&this.search.isFilteredOn("complete")||void 0!==n&&this.search.isFilteredOn("unread"))&&this.updateItems(!0)}},{key:"getMobileIcon",value:function(){return"MdInbox"}},{key:"getSwipeMenuItems",value:function(e){var t=this.pluginNew.getById(e.id);return{left:[{icon:"delete",text:"Remove from Saved",backgroundColor:"#a30",onActivated:function(){t.plugin.deleteItem(t.id)}}],right:[{icon:"delete",backgroundColor:"#a30",onActivated:function(){t.plugin.deleteItem(t.id)}}]}}},{key:"getSaveInfo",value:function(){var e=W()(C()(a.prototype),"getSaveInfo",this).call(this),t=this._zoomedItem.get(),n=t.accountID,r=t.label;return e.item=n+":"+r,e}},{key:"onRemoteUpdate",value:function(e){var t;W()(C()(a.prototype),"onRemoteUpdate",this).call(this,e);var n=this.zoomedItem.get(),r=n.accountID,i=n.label,o=n.service,s=(null===(t=e.item)||void 0===t?void 0:t.split(":"))||[],l=w()(s,3),u=l[0],c=l[1],d=l[2];r===u&&i===c&&o===d||this.setAccountIDAndLabel(u,d,c,!0)}},{key:"setAccountIDAndLabel",value:function(e,t,a,n){var r={accountID:e,service:t,label:a};this._zoomedItem.set(r),this.updateLabel(),this.updateItemsImmediate(),n||this.saveState()}},{key:"updateLabel",value:function(){var e=this.zoomedItem.get(),t=e.accountID,a=e.label,n=e.service;"inbox"===a&&"g"===n||this.pluginNew.loadLabel(t,n,a)}},{key:"onEndReached",value:function(){var e=this,t=this.zoomedItem.get(),a=t.accountID,n=t.label,r=t.service;a!==ee&&(a===$?v.default.settings.emailViewAccounts.forEach((function(t){e.pluginNew.loadNextPage(t.e,t.s,n)})):this.pluginNew.loadNextPage(a,r,n))}},{key:"onZoomedItemChanged",value:function(e){e.accountID,e.label}},{key:"onMoveToDocument",value:function(e){v.default.settings.archiveEmailsOnOrganize.get()&&(e.archive(),this.updateItems())}},{key:"notifyDropFrom",value:function(e){var t=e.getAttachmentByType(m.a.PluginType.Email);if(t){var a=this.pluginNew.getById(t.id);a&&this.onMoveToDocument(a)}}},{key:"_refreshPaneData",value:function(){var e=this.zoomedItem.get(),t=e.accountID,a=e.label,n=e.service;t===$?this.pluginNew.refreshAccounts():t!==ee&&this.pluginNew.refreshAccount(t,n,a)}},{key:"_applyDropOnBlockItem",value:function(e,t,n,r){var i=e.item||n.getItem();i&&i.insertItem(t,0),t.moveTo({parent:e.item||n.getItem(),index:0},m.a.ChangeType.Local),W()(C()(a.prototype),"_applyDropOnBlockItem",this).call(this,e,t,n,r)}}]),a}(X),p()(Y.prototype,"onPluginItemsChange",[y.a],Object.getOwnPropertyDescriptor(Y.prototype,"onPluginItemsChange"),Y.prototype),p()(Y.prototype,"onMultiselectChanged",[y.a],Object.getOwnPropertyDescriptor(Y.prototype,"onMultiselectChanged"),Y.prototype),p()(Y.prototype,"onZoomedItemChanged",[y.a],Object.getOwnPropertyDescriptor(Y.prototype,"onZoomedItemChanged"),Y.prototype),p()(Y.prototype,"_refreshPaneData",[y.a],Object.getOwnPropertyDescriptor(Y.prototype,"_refreshPaneData"),Y.prototype),Y);function ae(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=C()(e);if(t){var r=C()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return I()(this,a)}}var ne,re=["subject","accountID","snippet"],ie=["text","email"],oe=["inbox","starred","all","sent","trash"],se=["inbox","archive","sent","deleted"],le={inbox:"Inbox",starred:"Starred",all:"All Mail",sent:"Sent",trash:"Trash",archive:"Archive",deleted:"Deleted"},ue={star:"star",unstar:"unstar",archive:"archive",delete:"delete",unread:"mark_as_unread",read:"drafts",refresh:"refresh","open-page":""},ce=(Z=function(e){D()(a,e);var t=ae(a);function a(){var e;return c()(this,a),(e=t.call(this,"Email")).items=new M.a,e.savedItemsMap={},e.itemsHiddenViews={},e.apiPromises=[],e.pagesLoaded={},e.hiddenWebviews={},e.isFirstLoaded=new T.a,e.isLoadingMore=new T.a,e.accountsComposing=new O.a,e.accountsNeedSignin=new O.a,R.a.registerPaneType(void 0,m.a.PaneMode.Inbox,"Inbox",te,"inbox",0),e.updateItems(),e}return h()(a,[{key:"initWithAPI",value:function(e){this.api=e,this.apiPromises.forEach((function(e){return e()}))}},{key:"awaitAPI",value:function(){var e=o()(r.a.mark((function e(){var t=this;return r.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:if(this.api){e.next=2;break}return e.abrupt("return",new Promise((function(e){t.apiPromises.push(e)})));case 2:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"updateItems",value:function(){var e=this,t=k.a.getTableData("pluginsNew"),a=Object.keys(t).map((function(a){var n=t[a],r=e.savedItemsMap[a];if(!r)try{r=e.savedItemsMap[a]=new N(n,e)}catch(i){g.default.reportError(i)}return r})).filter((function(e){return!!e}));a.pushOnlyUniques(Object.values(this.itemsHiddenViews),g.default.comparatorById),a=a.sort(this.sortByDate),this.items.set(a,!0)}},{key:"sortByDate",value:function(e,t){return!e.date||!t.date||isNaN(t.date.getTime())||isNaN(e.date.getTime())?0:t.date.compareTo(e.date)}},{key:"getById",value:function(e){return this.savedItemsMap[e]||this.itemsHiddenViews[e]}},{key:"isItemSaved",value:function(e){return!!this.savedItemsMap[e]}},{key:"getDataById",value:function(e){return k.a.getPluginNew(e)}},{key:"onUpdate",value:function(){var e=o()(r.a.mark((function e(t){var a,n,i,s,l,u,c,d,h,f,p,y,b,w,S,D,P,I,E,C,A,T,M,L,O;return r.a.wrap((function(e){for(var R=0;;){if(R++>5e3&&__infLoop&&__infLoop(R))throw new RangeError;switch(e.prev=e.next){case 0:if(e.prev=0,a=t.id,k.a.getPluginNew(a),n=t.data,i=!1,this.isOldEmail(n)?(i=!0,c=null===(s=n.messages)||void 0===s?void 0:s[n.messages.length-1],d={accountID:n.accountID,service:n.service,subject:n.subject,contacts:n.messages?this.getParticipants(n.messages):[],date:new Date(n.date||(null===c||void 0===c?void 0:c.date)),numMessages:n.numMessages||(null===(l=n.messages)||void 0===l?void 0:l.length),plaintext:n.plaintext,snippet:null===(u=n.snippet||(null===c||void 0===c?void 0:c.snippet))||void 0===u?void 0:u.trim()},n=d):n.a&&(n=_.a.emailMetaDataIn(n)),!n){e.next=36;break}if(h=g.default.cloneDeep(n),f=g.default.cloneDeep(n),p=v.default.crypto.getKeyInfo(v.default.settings.getBestUserEncryption()),y=p.key,g.default.isString(n.date)&&(n.date=this.parseDate(n.date)),!n.plaintext){e.next=23;break}return e.next=15,Promise.all(re.map(function(){var e=o()(r.a.mark((function e(t){return r.a.wrap((function(e){for(var r=0,i=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!n[t]){e.next=4;break}return e.next=3,v.default.crypto.encryptText(y,n[t],a);case 3:f[t]=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 15:if(!f.contacts){e.next=18;break}return e.next=18,Promise.all(f.contacts.map(function(){var e=o()(r.a.mark((function e(t){return r.a.wrap((function(e){for(var n=0,i=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,Promise.all(ie.map(function(){var e=o()(r.a.mark((function e(n){return r.a.wrap((function(e){for(var r=0,i=0,o=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!t[n]){e.next=4;break}return e.next=3,v.default.crypto.encryptText(y,t[n],a);case 3:t[n]=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 18:delete h.plaintext,delete f.plaintext,i=!0,e.next=28;break;case 23:return e.next=25,Promise.all(re.map(function(){var e=o()(r.a.mark((function e(t){return r.a.wrap((function(e){for(var r=0,i=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:if(!n[t]){e.next=4;break}return e.next=3,v.default.crypto.decryptText(y,n[t],a);case 3:h[t]=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 25:if(!h.contacts){e.next=28;break}return e.next=28,Promise.all(h.contacts.map(function(){var e=o()(r.a.mark((function e(t){return r.a.wrap((function(e){for(var n=0,i=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,Promise.all(ie.map(function(){var e=o()(r.a.mark((function e(n){return r.a.wrap((function(e){for(var r=0,i=0,o=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!t[n]){e.next=4;break}return e.next=3,v.default.crypto.decryptText(y,t[n],a);case 3:t[n]=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 2:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 28:b=t.notInDoc,delete t.notInDoc,delete t.cmpData,t.data=h,k.a.savePluginNew(t),b&&(w=t.docId,S=t.parent,P=(D=n).accountID,I=D.subject,(E=x.a.getDocumentById(w))&&(C=E.getRootItem(),A={id:t.itemId,text:this.getAttachmentEmbedStringForID(a,P,I,"g"),dateCreated:t.dateCreated,dateModified:t.dateCreated,parent:S},T=x.a.createVMLI(A,{documentOwner:E,parent:C,changeType:m.a.ChangeType.Local}),C.insertItem(T,0),i=!0)),i&&(t.notInDoc=null,M=_.a.emailMetaDataOut(f)||f,L=Object.assign({},t,{data:M}),O=_.a.pluginOut(L),this.api.user.setPlugin(a,O)),this.updateItems();case 36:e.next=41;break;case 38:e.prev=38,e.t0=e.catch(0),console.log(e.t0);case 41:case"end":return e.stop()}}}),e,this,[[0,38]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isOldEmail",value:function(e){return!(!e.id&&!e.messages)}},{key:"translateLocalData",value:function(e,t){if(this.isOldEmail(t)){t.messages.forEach((function(e){e.labelIds||(e.labelIds=[])}));var a=t.messages[0];return Object.assign({id:e||t.threadId,to:a.to,from:a.from,snippet:a.snippet,labelIds:[]},t)}var n;return Object.assign({id:e,to:t.accountID,from:null===(n=t.contacts)||void 0===n?void 0:n[0],snippet:t.snippet,labelIds:[]},t)}},{key:"getEmbedString",value:function(e){var t=this.getById(e),a=t.pluginData.data,n=a.accountID,r=a.subject,i=a.service;if(t&&n)return this.getAttachmentEmbedStringForID(e,n,r,i)}},{key:"getAttachmentEmbedStringForID",value:function(e,t,a,n){return"".concat(m.a.EmbedAttachChar,"p:").concat(m.a.PluginID.Email,",id:").concat(e,",a:").concat(t,",s:").concat(n,",t:").concat(encodeURIComponent(a)).concat(m.a.EmbedAttachChar)}},{key:"reEncrypt",value:function(){var e=o()(r.a.mark((function e(t,a,n){var i;return r.a.wrap((function(e){for(var s=0;;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;switch(e.prev=e.next){case 0:return i=k.a.getAllPluginsNew(),e.next=3,Promise.all(Object.keys(i).map(function(){var e=o()(r.a.mark((function e(s){var l;return r.a.wrap((function(e){for(var u=0,c=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(e.prev=e.next){case 0:return l=i[s].data,e.next=3,Promise.all(re.map(function(){var e=o()(r.a.mark((function e(i){return r.a.wrap((function(e){for(var r=0,o=0,u=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:if(!l[i]||g.default.isNumber(l[i])){e.next=4;break}return e.next=3,v.default.crypto.encryptText(n.key,l[i],s);case 3:a["".concat(t).concat(s,"/a/").concat(i)]=e.sent;case 4:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"getParticipants",value:function(e){return g.default.arrayUniques2(e.map((function(e){return e.from}))).filter((function(e){return!!e})).map((function(e){return g.default.parseEmailAddresses(e)[0]}))}},{key:"saveData",value:function(){var e=o()(r.a.mark((function e(t,a){var n,i,o;return r.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.awaitAPI();case 2:(n=this.getDataById(t))&&(i=Object.assign({},n,a),k.a.savePluginNew(i),o=_.a.pluginOut(a),this.api.user.setPlugin(t,o));case 4:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"deleteItem",value:function(){var e=o()(r.a.mark((function e(t){return r.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.awaitAPI();case 2:this.getDataById(t)&&(k.a.deletePluginNew(t),this.api.user.removePlugin(t),this.updateItems());case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"addItemsFromViews",value:function(e,t,a){var n=this;a.forEach((function(a){var r,i=n.itemsHiddenViews[a.id]||n.savedItemsMap[a.id];i?i.updateFromData(a,t):(i=new N({id:a.id,plugin:"Email",cmpData:"",data:Object.assign(a,{accountID:e,service:t,date:n.parseDate(a.date),contacts:null===(r=a.contacts)||void 0===r?void 0:r.map((function(e){return{text:e.name,email:e.emailAddress}})),snippet:a.snippet,labels:a.labels}),isRead:a.read},n),n.itemsHiddenViews[a.id]=i)})),L.a.beginBatch(),this.isFirstLoaded.set(!0),this.isLoadingMore.set(!1),this.updateItems(),L.a.endBatch()}},{key:"setHiddenWebview",value:function(e,t,a){this.hiddenWebviews[t+":"+e]=a}},{key:"setResolver",value:function(e){this.resolverWebview=e}},{key:"sendAction",value:function(e,t,a,n){var r=this.hiddenWebviews[t+":"+e];if(r)if("refresh"===a){if("inbox"===n)return r.sendAction(ue[a]);this.loadLabel(e,t,n)}else{var i=n,o=this.getById(i);if(o)return r.sendAction(ue[a],i,o.subject,o.date.toString("yyyy/MM/dd"),o.date.clone().addDays(1).toString("yyyy/MM/dd"))}}},{key:"loadLabel",value:function(e,t,a,n){var r,i=this;this.isFirstLoaded.get()?(this.isLoadingMore.set(!0),null===(r=this.hiddenWebviews[t+":"+e])||void 0===r||r.openPage(a,n),g.default.timeoutOnce("email_loadNextPage",(function(){i.isLoadingMore.set(!1)}),5e3)):this.isFirstLoaded.onHasValue((function(){setTimeout((function(){i.loadLabel(e,t,a,n)}),0)}))}},{key:"loadNextPage",value:function(e,t,a){var n=this.pagesLoaded[e];n||(n=this.pagesLoaded[e]={}),n[a]=(n[a]||1)+1,this.loadLabel(e,t,a,n[a])}},{key:"resolveThreadHash",value:function(){var e=o()(r.a.mark((function e(t,a){return r.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.resolverWebview.resolve(t,a));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getLabels",value:function(e){return"g"===e.s?oe:se}},{key:"getLabelName",value:function(e){return le[e]||e}},{key:"composeEmail",value:function(){var e=o()(r.a.mark((function e(t){var a,n,i;return r.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(1!==(a=v.default.settings.emailViewAccounts.get()).length){e.next=6;break}i=a[0],n=i.s+":"+i.e,e.next=9;break;case 6:return e.next=8,v.default.menus.openContextMenuList("Select account",g.default.element("newEmailButtonView"),a.map((function(e){return{id:e.s+":"+e.e,value:e.e}})),!1,void 0,t);case 8:n=e.sent;case 9:n&&this.accountsComposing.setProperty(n,!0);case 10:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"refreshAccounts",value:function(){var e=o()(r.a.mark((function e(){var t=this;return r.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:v.default.settings.emailViewAccounts.forEach((function(e){return t.refreshAccount(e.e,e.s,"inbox")}));case 1:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"refreshAccount",value:function(){var e=o()(r.a.mark((function e(t,a,n){var i=this;return r.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:Object.entries(this.itemsHiddenViews).forEach((function(e){var a=w()(e,2),n=a[0],r=a[1];r.accountID===t&&"g"==r.service&&(i.itemsHiddenViews[n].hiddenBeforeRefresh=!0)})),this.sendAction(t,a,"refresh",n);case 2:case"end":return e.stop()}}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"setAccountNeedsSignin",value:function(e){var t=this,a=e.e,n=e.s,r=e.b;this.accountsNeedSignin.setProperty(n+":"+a,!0),v.default.toasts.pushMessage("g"===n?m.a.MessageID.GmailViewsNeedSignin:{text:"Moo.do is not signed into your Outlook account: ".concat(a,". Please sign in to continue syncing your emails."),action:function(){v.default.menus.openModal(m.a.Modals.OutlookAuth,{business:r,account:e,callback:function(e){var a=e.accountID;a&&t.setAccountFixed(a,"o")}})},actionText:"SIGN IN"})}},{key:"setAccountFixed",value:function(e,t){var a;v.default.settings.addEmailViewAccount(e,t),this.accountsNeedSignin.deleteProperty(t+":"+e),null===(a=this.hiddenWebviews[t+":"+e])||void 0===a||a.reload()}},{key:"getURLForOutlookAccount",value:function(e){return"https://outlook.".concat(e.b?"office":"live",".com")}},{key:"getAccount",value:function(e,t){return v.default.settings.emailViewAccounts.find((function(a){return a.e===e&&a.s===t}))}},{key:"parseDate",value:function(e){try{var t=A.a.parseInternationalDate(e);return+t>Date.now()&&t.setFullYear(t.getFullYear()-1),t}catch(a){return new Date}}}]),a}(F),p()(Z.prototype,"refreshAccounts",[y.a],Object.getOwnPropertyDescriptor(Z.prototype,"refreshAccounts"),Z.prototype),Z),de=(ne=function(){function e(){c()(this,e)}return h()(e,[{key:"init",value:function(){this.pluginNew_Email=new ce,this.loadedRemote=new T.a}},{key:"initWithAPI",value:function(e,t){var a=this;this.pluginNew_Email.initWithAPI(e),t&&Object.keys(t).forEach((function(e){return a.onPluginsUpdate({type:"Added",value:l()({},e,t[e])})})),e.user.onPluginUpdate(this.onPluginsUpdate)}},{key:"onPluginsUpdate",value:function(e){var t=this,a=e.type,n=e.value,r=Object.keys(n)[0];if("Removed"===a)k.a.deletePluginNew(r);else{var i=n[r],o=Object.assign({id:r},_.a.pluginIn(i));this.onPluginUpdate(o)}g.default.timeoutOnce("PluginManagerNew_loadedRemote",(function(){return t.loadedRemote.set(!0)}),1e3)}},{key:"onPluginUpdate",value:function(){var e=o()(r.a.mark((function e(t){return r.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:this.getPluginNew(t.plugin).onUpdate(t);case 2:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPluginNew",value:function(e){return this.pluginNew_Email}},{key:"getPluginDataTranslated",value:function(e){var t=this.getPluginInfo(e);if(t){var a=t.plugin,n=t.data;return a.translateLocalData(e,n)}}},{key:"getPluginData",value:function(e){return k.a.getPluginNew(e)}},{key:"getPluginInfo",value:function(e){var t=this.getPluginData(e);if(t){var a=this.getPluginNew(t.plugin);if(a)return{plugin:a,data:t.data}}}},{key:"reEncrypt",value:function(){var e=o()(r.a.mark((function e(t,a,n){return r.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.pluginNew_Email.reEncrypt(t,a,n));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"onMetadataChanged",value:function(e,t){v.default.PaneManager.runForEachPane((function(a){return a.onMetadataChanged(e,t)}),m.a.PaneMode.Inbox)}}]),e}(),p()(ne.prototype,"onPluginsUpdate",[y.a],Object.getOwnPropertyDescriptor(ne.prototype,"onPluginsUpdate"),ne.prototype),ne),he=t.a=new de},,function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(4),l=a(6),u=function(){function e(t){var a=this;r()(this,e),Object.keys(t).forEach((function(e){return a[e]=t[e]}))}return o()(e,[{key:"showMarkdown",value:function(e){return s.default.settings.showMarkdown.get()&&(this.forceIsSelected||e||l.a.isSelected(this))}},{key:"getDisplayText",value:function(e,t){return this.item.getDisplayText({showMarkdown:this.showMarkdown(e),noPrefix:t})}},{key:"getDisplayLength",value:function(e,t){return this.getDisplayText(e,t).length}},{key:"getDisplayTextWithoutPrefix",value:function(){return this.item.getDisplayText({showMarkdown:this.showMarkdown(),noPrefix:!0})}},{key:"getDisplayLengthWithoutPrefix",value:function(){return this.getDisplayTextWithoutPrefix().length}},{key:"levelsDeepNew",value:function(){return this.item?this.overview?this.item.levelsDeep.get()-1:this.pane.itemLevelsDeep(this.item,this.levelsDeepRoot):0}},{key:"getPrevious",value:function(){return this.pane.objectAtIndex(this.index-1)}}]),e}();t.a=u},function(e,t,a){"use strict";var n,r=a(5),i=a.n(r),o=a(12),s=a.n(o),l=a(7),u=a.n(l),c=a(8),d=a.n(c),h=a(10),f=a.n(h),p=a(34),g=a(11),m=a(2),v=a(23),y=a(0),k=a(4),_=a(18),b=a(42),w=/^(?:\+?1[-. ]?)?(?:\(?([0-9]{3})\)?[-. ]?)?([0-9]{3})[-. ]?([0-9]{4})$/,S=function(){function e(t){var a=0,n=0;u()(this,e);try{y.default.PAssert(463,y.default.isObject(t),"Should always supply a valid object to init a contact")}catch(s){y.default.reportError(s)}this.id=t.id,this.type="contact",this.text=t.text||"",this.phoneNumbers=t.phoneNumbers||[],this.emails=t.emails||[];for(var r=0;r<this.phoneNumbers.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=this.phoneNumbers[r];i.link=this.formatPhone(i.number),i.type=i.type?i.type[0].toLowerCase():""}for(var o=0;o<this.emails.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this.emails[o].link="mailto:"+this.emails[o].address}}return d()(e,[{key:"formatPhone",value:function(e){if(w.test(e)){var t=e.match(w),a="";return t[1]&&(a+="+1-"+t[1]+"-"),"tel:"+(a+=t[2]+"-"+t[3])}var n=e.replace(/\D+/g,"");try{y.default.PAssert(464,n&&""!==n,"Invalid phone number format: "+e)}catch(r){y.default.reportError(r)}return e.startsWith("+")&&(n="+"+n),"tel:"+n}}]),e}(),D=(n=function(){function e(){u()(this,e),this._contactCache={},this._contacts=new b.a,this._contactsByID={},this._contactsByName={},this.areContactsLoaded=!1}return d()(e,[{key:"init",value:function(){var e=this;k.default.settings.syncAccounts.listen((function(){return e.refreshContacts()}))}},{key:"loadContacts",value:function(e){if(!this.areContactsLoaded){var t=e||v.a.getContacts();try{y.default.PAssert(215,0===this._contacts.get().length,"Should only load contacts once")}catch(o){y.default.reportError(o)}if(this.areContactsLoaded=!0,t){for(var a=0,n=[],r=0;r<t.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=t[r];i.name&&(i.text=i.name,t[r].text=i.name,delete t[r].name),i.text&&(this._contactsByName[y.default.escape(i.text)]=i,n.push(i));try{y.default.PAssert(216,i.id,"Each contact must have a valid id")}catch(o){y.default.reportError(o)}}this._contacts.set(n)}else this.clearContacts()}}},{key:"updateContact",value:function(e){try{y.default.PAssert(217,e.id,"Incoming contacts must have a valid id")}catch(r){y.default.reportError(r)}try{y.default.PAssert(218,e.text,"All contacts are expected to have a text")}catch(r){y.default.reportError(r)}var t,a=y.default.escape(e.text),n=this._contactsByName[a];return e.emails&&e.emails.length&&(e.emails.forEach((function(e){return e.address=e.address.toLowerCase()})),e.emails=y.default.arrayUniques(e.emails,"address")),n?(e.emails&&!y.default.deepEqual(e.emails,n.emails)&&(n.emails=y.default.arrayUnionByKey(n.emails||[],e.emails,"address"),t=!0),e.phoneNumbers&&!y.default.deepEqual(e.phoneNumbers,n.phoneNumbers)&&(n.phoneNumbers=y.default.arrayUnionByKey(n.phoneNumbers||[],e.phoneNumbers,"number"),t=!0)):(this._contacts.push(e),e.text&&(this._contactsByName[a]=e),t=!0),this._contactCache[e.id]&&(this._contactCache[e.id]=new S(e)),t}},{key:"clearContacts",value:function(){this._contactCache={},this._contacts.clear(),this._contactsByName={}}},{key:"numContacts",value:function(){return this._contacts.get().length}},{key:"getContacts",value:function(){return this._contactsByName}},{key:"getAll",value:function(){return this._contacts.get()}},{key:"contactComparator",value:function(e,t){return e.text&&t.text?e.text.localeCompare(t.text):e.text&&!t.text?1:!e.text&&t.text?-1:void 0}},{key:"getRNList",value:function(e){var t=[];return this.findMatchLike(e,{}).forEach((function(e){var a=e.text.split(" "),n=a.map((function(e){return e[0]})).slice(0,Math.min(2,a.length)).join(""),r=e.emails;t.push({text:e.text,iconText:n,subText:r.length?r[0].address:void 0})})),t.sort(this.contactComparator),t}},{key:"emailComparator",value:function(e,t){return e.address.toLowerCase()===t.address.toLowerCase()}},{key:"emailComparatorSort",value:function(e,t){return e.address&&t.address?e.address.toLowerCase().localeCompare(t.address.toLowerCase()):e.address&&!t.address?1:!e.address&&t.address?-1:void 0}},{key:"phoneComparator",value:function(e,t){return e===t||e.number===t.number}},{key:"ensureCacheObject",value:function(e){try{y.default.PAssert(219,e,"Must have valid data to store in cache")}catch(a){y.default.reportError(a)}if(this._contactCache[e.id])return this._contactCache[e.id];var t=new S(e);return this._contactCache[e.id]=t,t}},{key:"findMatchExact",value:function(e){var t=this._contactsByName[y.default.escape(e)];if(t)return this.ensureCacheObject(t)}},{key:"findMatchLike",value:function(e,t){var a=0,n=t.max;try{y.default.PAssert(220,void 0!==e,"Must provide a valid contact part")}catch(f){y.default.reportError(f)}for(var r=e.toUpperCase(),i=[],o=this._contacts.get(),s=0;s<o.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=o[s],u=!1;if(l.text.toUpperCase().indexOf(r)>=0&&(u=!0),!u&&l.emails)for(var c=0,d=0;!u&&d<l.emails.length;++d){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(l.emails[d].address.toUpperCase().indexOf(r)>=0){u=!0;break}}if(!u&&l.phoneNumbers){var h=0;for(d=0;!u&&d<l.phoneNumbers.length;++d){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(l.phoneNumbers[d].number.indexOf(r)>=0){u=!0;break}}}if(u&&(i.push(this.ensureCacheObject(l)),i.length>=n))break}return i.sort(this.contactComparator),i}},{key:"findContactByEmail",value:function(e){for(var t=0,a=0;a<this._contacts.get().length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this._contacts.get()[a];if(n.emails)for(var r=0,i=0;i<n.emails.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(n.emails[i].address===e)return n}}}},{key:"findEmailsLike",value:function(e,t){var a=0;try{y.default.PAssert(221,void 0!==e,"Must provide a valid email part")}catch(d){y.default.reportError(d)}t=t||20;for(var n=[],r=e.toUpperCase(),i=0;i<this._contacts.get().length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this._contacts.get()[i];if(o&&o.emails){var s=0,l=!1;o.text&&o.text.toUpperCase().indexOf(r)>=0&&(l=!0);for(var u=0;u<o.emails.length;++u){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var c=o.emails[u].address;(l||c.toUpperCase().indexOf(r)>=0)&&n.push({id:o.id,type:"contact",text:o.text,email:c})}}if(n.length>=t)break}return n.sort(this.emailComparatorSort),n}},{key:"save",value:function(e){v.a.saveContacts(this._contacts.get(),e)}},{key:"handleRemoteContactLoad",value:function(e,t){for(var a=0,n=(this.numContacts(),[]),r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=e[r],o={id:i.resourceName.replace("people/",""),accountID:t,text:""};if(i.names&&i.names.length>0){var s=i.names[0].displayName;o.text=s,"'"===o.text[0]&&(o.text=o.text.substr(1))}if(!o.text&&i.organizations){for(var l=0,u=0;u<i.organizations.length;u++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var c=i.organizations[u];c.metadata&&c.metadata.primary&&(o.text=c.name)}o.text||(o.text=i.organizations[0].name)}if(i.emailAddresses){var d=0;o.emails=[];for(var h=0;h<i.emailAddresses.length;h++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var f=i.emailAddresses[h],p=f.metadata&&f.metadata.primary,g={address:f.value};p&&(g.isPrimary=p),f.type&&(g.type=f.type),o.emails.push(g),!o.text&&g.isPrimary&&(o.text=g.address)}!o.text&&o.emails.length>0&&(o.text=o.emails[0].address)}if(i.phoneNumbers){var v=0;o.phoneNumbers=[];for(var k=0;k<i.phoneNumbers.length;k++){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;var _=i.phoneNumbers[k],b=_.metadata&&_.metadata.primary,w={number:_.value};b&&(w.isPrimary=b),_.type&&(w.type=_.type),o.phoneNumbers.push(w)}}o.text?this.updateContact(o)&&n.indexOfWithProperty("id",o.id)<0&&n.push(o):y.default.shouldLog(m.a.LogLevels.Data)&&y.default.log("Contact entry with no name or email address",i)}return n.length&&this.save(n),n}},{key:"syncContactInfo",value:function(){var e=s()(i.a.mark((function e(t){var a=this;return i.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e){p.a.getAccountAuthToken(t,[m.a.GScope.Contacts],(function(n){var r,o=[],l=n&&n.access_token,u=function(){var n=s()(i.a.mark((function n(s){var l,u;return i.a.wrap((function(n){for(var i=0,c=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;switch(n.prev=n.next){case 0:return n.next=2,s.json();case 2:if((l=n.sent)&&l.connections){try{y.default.PAssert(222,y.default.isArray(l.connections),"Connections are not array")}catch(d){y.default.reportError(d)}y.default.isArray(l.connections)&&o.pushArray(l.connections),l.nextPageToken?r(l.nextPageToken):(u=a.handleRemoteContactLoad(o,t),e(u))}case 4:case"end":return n.stop()}}}),n)})));return function(e){return n.apply(this,arguments)}}();r=function(){var e=s()(i.a.mark((function e(t){var a,n;return i.a.wrap((function(e){for(var r=0,i=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return a="https://people.googleapis.com/v1/people/me/connections?personFields=names,emailAddresses,phoneNumbers,organizations&access_token=".concat(l)+(t?"&pageToken=".concat(t):""),e.next=3,y.default.XHR({type:"GET",url:a});case 3:n=e.sent,u(n);case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}(),l&&r()}))})));case 1:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isEnabled",value:function(){return this.getSyncAccounts().length>0}},{key:"getSyncAccounts",value:function(){var e=k.default.settings.syncAccounts.get();return Object.keys(e).filter((function(t){return!!e[t][m.a.PluginID.Contacts]}))}},{key:"refreshContacts",value:function(e){var t=this;p.a.onLoaded(s()(i.a.mark((function a(){var n,r,o;return i.a.wrap((function(a){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(a.prev=a.next){case 0:if(!((n=t.getSyncAccounts()).length>0)){a.next=10;break}return a.next=4,Promise.all(n.map(t.syncContactInfo));case 4:r=a.sent,(o=r.flat()).length>0&&(k.default.PaneUpdateBatcher.beginUpdateItems(),_.a.parseAll(m.a.ChangeType.Auto),k.default.PaneUpdateBatcher.updateAllItems(!1,!0),k.default.PaneUpdateBatcher.commitUpdateItems()),e&&e(o),a.next=11;break;case 10:e&&e([]);case 11:case"end":return a.stop()}}}),a)}))))}}]),e}(),f()(n.prototype,"getRNList",[g.a],Object.getOwnPropertyDescriptor(n.prototype,"getRNList"),n.prototype),f()(n.prototype,"syncContactInfo",[g.a],Object.getOwnPropertyDescriptor(n.prototype,"syncContactInfo"),n.prototype),f()(n.prototype,"refreshContacts",[g.a],Object.getOwnPropertyDescriptor(n.prototype,"refreshContacts"),n.prototype),n);t.a=new D},function(e,t,a){"use strict";var n=a(16),r=a.n(n),i=a(105),o=a(2),s=a(28),l=a(0),u=a(9),c=a(3),d=a.n(c);var h=a(65),f=a(17),p=a(22),g=a(49),m=a(147),v=a(128),y=a(148);t.a=Object(f.b)((function(e){var t=e.type,a=e.className,n=e.classNameContent,f=e.classNameContentFullscreen,k=e.styleContent,_=e.spring,b=e.fullscreen,w=e.stayFullscreenOnceFullscreened,S=e.title,D=e.noBackdrop,P=e.topBar,I=e.ignoreAndroidBack,E=e.keyboardToolbarHeight,C=e.onFullscreenChange,x=e.children,A=Object(p.a)(u.a.windowSize,g.a.keyboardHeight),T=r()(A,2),M=T[0],L=T[1],O=M.height,R=Object(s.d)(),F=Object(s.d)(),N=Object(c.useRef)(),B=Object(c.useRef)(),j=Object(i.a)(N),U=Object(h.a)(null===j||void 0===j?void 0:j.height),H=Object(h.a)(D),V=g.a.isMenuOpen(t),W=Object(c.useRef)(O),z=Object(h.a)(b);(j.height>=M.height||L>0)&&(b=!0),w&&(b=function(e){var t=Object(c.useRef)(e);return t.current||(t.current=e),t.current}(b)),Object(c.useEffect)((function(){b!==z&&(null===C||void 0===C||C(b))}),[b,z,C]),b&&(j.height=M.height);var q=function(){if(g.a.isMenuOpen(t)){var e=M.height-j.height;e!==W.current&&(W.current=e,R.start({y:e,transition:_||o.a.TransitionSpring}),F.start({opacity:.5,transition:_||o.a.TransitionSpring}))}};(null===j||void 0===j?void 0:j.height)!==U&&g.a.isMenuOpen(t)&&q(),!D!==!H&&F.start({opacity:D?0:.5,transition:o.a.TransitionSpring});var G=function(){g.a.closeMenu(t)};I||Object(v.a)(G);var K=l.default.classNames("fancySheet absolute inset-0 c-background z-0 c-shadow-popup will-change-transform",{"rounded-t-xlg":!b},a);n=l.default.classNames("flex flex-col max-h-full",n,b&&f);var Y={height:M.height};u.a.isiOS&&u.a.majorVersion<=12&&Object(m.a)(B,{onTouchMove:Object(c.useCallback)((function(e){l.default.preventDefault(e)}),[])});var X=l.default.classNames("absolute inset-0 z-0 bg-black will-change-opacity",{"pointer-events-none":D});return d.a.createElement("div",{ref:B},d.a.createElement(s.b.div,{className:X,onPan:function(e,t){var a=t.offset.y-j.height;W.current=M.height-j.height+t.offset.y,R.set({y:W.current}),F.set({opacity:l.default.clamp(-a/j.height*.5,0,.7)})},onPanEnd:function(e,t){Math.abs(t.offset.y)<5||t.velocity.y>50?G():q()},animate:F,initial:{opacity:0},exit:{opacity:0,transition:o.a.TransitionSpringFast}}),d.a.createElement(s.b.div,{className:K,style:Y,animate:R,initial:{y:O},exit:{y:O,transition:o.a.TransitionSpringFast}},d.a.createElement("div",{ref:N,className:n,style:k},(b||!V&&z)&&P,S&&d.a.createElement("div",{className:"pt-3 pb-3 font-bold border-b center text-16 c-border"},S),x,d.a.createElement(y.a,{keyboardToolbarHeight:E}))))}))},function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var n=a(0),r=a(3),i=a(98),o=a(82),s=a(47),l={FaApple:i.a,FaChrome:i.b,FaCircle:i.c,FaExclamation:i.d,FaHashtag:i.f,FaFile:i.e,FaLinux:i.g,FaMinus:i.h,FaRegStickyNote:i.i,FaWindows:i.j,IoIosArrowBack:o.a,IoIosArrowDown:o.b,IoIosArrowForward:o.c,IoIosArrowUp:o.d,IoIosCalendar:o.e,IoIosCheckboxOutline:o.f,IoIosRepeat:o.g,IoLogoGoogle:o.h,IoMdArrowDropleft:o.i,IoMdArrowDropright:o.j,IoMdCalendar:o.k,IoMdTrash:o.m,MdAccessTime:s.a,MdAdd:s.b,MdArchive:s.c,MdArrowBack:s.d,MdArrowForward:s.e,MdAttachFile:s.f,MdCheck:s.g,MdCheckBoxOutlineBlank:s.h,MdClose:s.i,MdContentPaste:s.k,MdEdit:s.m,MdEmail:s.n,MdFormatListBulleted:s.o,MdInbox:s.p,MdKeyboardBackspace:s.r,MdLoop:s.u,MdMenu:s.v,MdMoreHoriz:s.w,MdMoreVert:s.x,MdOpenInNew:s.y,MdPerson:s.z,MdReorder:s.A,MdSettings:s.B,MdStar:s.C,MdToday:s.E,MdUndo:s.F,MdWarning:s.G},u=function(e){var t=e.name,a=e.size,i=e.color,o=e.className,s=e.style,u=t;return n.default.isString(t)&&((u=l[t])||(u="i",o=(o||"")+" "+t)),Object(r.createElement)(u,{size:a,className:o,color:i,style:s})}},function(e,t,a){"use strict";var n,r=a(7),i=a.n(r),o=a(8),s=a.n(o),l=a(10),u=a.n(l),c=a(35),d=a(11),h=a(2),f=a(0),p=a(9),g=a(4),m=a(26),v=a(70),y=a(15),k=a(42),_=(n=function(){function e(){i()(this,e),this.pluginsAvailable=[h.a.PluginID.Contacts,h.a.PluginID.Drive,h.a.PluginID.GCalendar,h.a.PluginID.Gmail],this.pluginsAvailableNew=[h.a.PluginID.Contacts,h.a.PluginID.Drive,h.a.PluginID.GCalendar],this._pluginEnabledObservables={},this._pluginOptionObservables={},this.isRefreshingContacts=new y.a(!1),this.GCalendarsAvailable=new k.a,this.GCalendarSyncErrors=new k.a(void 0),this.GCalendarAddFailure=new y.a(!1),this.GCalendarListFailure=new y.a(!1),this.GCalendarListLoading=new y.a(!1),this.GmailNumSyncd=new y.a(0),this.GmailCacheSize=new y.a(0),this.GmailSyncAccounts=new k.a,this.isSaveEnabled=new y.a(!1),this.hasRefreshed=!1,m.a.forceBind("calendarComparator",this)}return s()(e,[{key:"init",value:function(){var e=g.default.pluginManager.getPluginGCalendar().getImportCalendarList();e&&this.GCalendarsAvailable.set(e)}},{key:"checkRefresh",value:function(){this.hasRefreshed||this.refreshPluginStatus()}},{key:"refreshPluginStatus",value:function(e){var t=0;this.hasRefreshed=!0;for(var a=0;a<this.pluginsAvailable.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this.pluginsAvailable[a],r=void 0;r=n===h.a.PluginID.Contacts?v.a.isEnabled():g.default.pluginManager.isAuthorized(n),this.updatePluginStatus(n,r)}e&&e!==h.a.PluginID.GCalendar||(this.updatePluginOptionStatus(h.a.PluginID.GCalendar,h.a.PluginSettingsID.GCalendar.ImportCalendars,!0),this.updatePluginOptionStatus(h.a.PluginID.GCalendar,h.a.PluginSettingsID.GCalendar.ExportCalendar))}},{key:"refresh",value:function(e){this.refreshPluginStatus(),e&&e!==h.a.PluginID.GCalendar||(this.GCalendarAddFailure.set(!1),this.GCalendarListFailure.set(!1),this.updateCalendarList()),e&&e!==h.a.PluginID.Gmail||this.updateGmailInfo()}},{key:"calendarComparator",value:function(e,t){return e.summary.localeCompare(t.summary)}},{key:"updateGmailInfo",value:function(){var e=g.default.pluginManager.getPluginGmail();this.GmailNumSyncd.set(e.getSyncdMessageCount()),this.GmailSyncAccounts.set(e.getSyncAccounts())}},{key:"updateCalendarList",value:function(){var e=this;if(g.default.pluginManager.isAuthorized(h.a.PluginID.GCalendar)){var t=g.default.pluginManager.getPluginGCalendar();this.GCalendarListLoading.set(!0),t.getFullCalendarList((function(t){e.GCalendarListLoading.set(!1,!1),t?(t.sort(e.calendarComparator),e.GCalendarsAvailable.set(t),e.GCalendarListFailure.set(!1)):e.GCalendarListFailure.set(!0)}))}}},{key:"getEnabledPlugins",value:function(){this.checkRefresh();var e=this._pluginEnabledObservables;return Object.keys(e).filter((function(t){return e[t].get()}))}},{key:"getPluginEnabledObservable",value:function(e){return this.checkRefresh(),this._pluginEnabledObservables[e]}},{key:"isPluginEnabled",value:function(e){return this.checkRefresh(),this._pluginEnabledObservables[e].get()}},{key:"getPluginOptionObservable",value:function(e,t){return this.checkRefresh(),this._pluginOptionObservables[e][t]}},{key:"getPluginOptions",value:function(e){return this.checkRefresh(),this._pluginOptionObservables[e]}},{key:"isPluginAnOption",value:function(e){return e===h.a.PluginID.Mailbird?p.a.embed===h.a.EmbedApps.Mailbird:this.pluginsAvailable.indexOf(e)>=0}},{key:"updatePluginStatus",value:function(e,t,a){this._pluginEnabledObservables[e]?this._pluginEnabledObservables[e].set(t,a):this._pluginEnabledObservables[e]=new y.a(t)}},{key:"updatePluginOptionStatus",value:function(e,t,a){var n=g.default.pluginManager.getSetting(e,t);this._pluginOptionObservables[e]||(this._pluginOptionObservables[e]={}),this._pluginOptionObservables[e][t]?this._pluginOptionObservables[e][t].set(n||a&&[]):this._pluginOptionObservables[e][t]=a?new k.a(n):new y.a(n)}},{key:"onFailedAuthenticate",value:function(e){g.default.toasts.pushMessage({text:"We failed to successfully authenticate you for "+e+", please try again.",actionText:"OKAY"})}},{key:"_wasPluginAuthorized",value:function(e,t){var a;if(e===h.a.PluginID.Contacts)t.indexOf(h.a.GScope.Contacts)>=0&&(a=!0);else{var n=g.default.pluginManager.getPlugin(e),r=c.a.getUserSync();r&&(a=n.verifyAuthorization(r.email))}try{f.default.PAssert(112,a,"Should always be successful at authorizing plugins")}catch(i){f.default.reportError(i)}return a}},{key:"_enablePlugin",value:function(e){var t=this,a=this.getPluginEnabledObservable(e),n=g.default.pluginManager.getPlugin(e);g.default.pluginManager.authorizePlugin(e,!0,(function(r){r?(a.set(!0),g.default.pluginManager.onPluginAuthorized(n,!0),t.refresh(e),f.default.sendEvent(e,"PluginEnabled")):(t.onFailedAuthenticate(e),f.default.sendEvent(e,"PluginEnableFailed"))}))}},{key:"enablePlugin",value:function(e){e!==h.a.PluginID.Contacts&&this._enablePlugin(e)}},{key:"disablePlugin",value:function(e){var t=this.getPluginEnabledObservable(e);e===h.a.PluginID.Contacts?(f.default.sendEvent("Settings","DisableContacts"),v.a.clearContacts(),t.set(!1)):g.default.pluginManager.deauthorizePlugin(e,(function(){t.set(!1),f.default.sendEvent(e,"PluginDisabled")}))}},{key:"togglePlugin",value:function(e){!this._pluginEnabledObservables[e].get()?this.enablePlugin(e):this.disablePlugin(e)}},{key:"togglePluginOption",value:function(e,t){var a=this,n=this._pluginOptionObservables[e][t],r=!n.get();g.default.pluginManager.setSetting(e,t,r),r?g.default.pluginManager.authorizePlugin(e,!0,(function(i){i?(g.default.pluginManager.onAuthorizedSetting(e,t,r),n.set(!0),f.default.sendEvent(e,"OptionEnabled_"+t)):(a.onFailedAuthenticate(t),g.default.pluginManager.setSetting(e,t,!r),f.default.sendEvent(e,"OptionEnableFailed_"+t))})):(n.set(!1),f.default.sendEvent(e,"OptionDisabled_"+t))}},{key:"setPluginOption",value:function(e,t,a,n,r){var i=this,o=this._pluginOptionObservables[e][t],s=o.get();g.default.pluginManager.setSetting(e,t,a),a&&n?g.default.pluginManager.authorizePlugin(e,!0,(function(n){n?(g.default.pluginManager.onAuthorizedSetting(e,t,a),o.set(a),f.default.sendEvent(e,"OptionSet_"+t+"_"+a),r&&r(!0)):(i.onFailedAuthenticate(t),g.default.pluginManager.setSetting(e,t,s),f.default.sendEvent(e,"OptionEnableFailed_"+t+"_"+a),r&&r(!1))})):(o.set(a),f.default.sendEvent(e,"OptionSet_"+t+"_"+a),r&&r(!0))}},{key:"isNotificationsEnabled",value:function(){return!g.default.settings.disableNotifications.get()}},{key:"toggleNotifications",value:function(){var e=g.default.settings.disableNotifications.get();g.default.settings.disableNotifications.set(!e),e?g.default.timeline.updateNotifications():g.default.timeline.clearNotifications()}},{key:"onTapRefreshContacts",value:function(e,t){var a=this,n=!1;return this.isRefreshingContacts.get()||(this.isRefreshingContacts.set(!0),n=!0,v.a.refreshContacts((function(){a.isRefreshingContacts.set(!1),t&&t()})),f.default.sendEvent("Menu","RefreshContacts")),n}},{key:"addCalendar",value:function(e,t){var a=this,n=g.default.pluginManager.getPluginGCalendar();this.GCalendarListLoading.set(!0),n.createCalendar(e,t,(function(e){a.GCalendarListLoading.set(!1),e?a.updateCalendarList():a.GCalendarAddFailure.set(!0)}))}},{key:"notifySyncError",value:function(e){this.GCalendarSyncErrors.set(e||[])}},{key:"updatePluginsEnabled",value:function(){var e=this,t=f.default.clone(g.default.settings.syncAccounts.get()||{});[h.a.PluginID.Contacts].forEach((function(a){var n=Object.keys(t).some((function(e){return t[e][a]}));n!==e.isPluginEnabled(a)&&(n?(console.log("Enabling",a),e.enablePlugin(a)):(console.log("Disabling",a),e.disablePlugin(a)))}))}}]),e}(),u()(n.prototype,"onTapRefreshContacts",[d.a],Object.getOwnPropertyDescriptor(n.prototype,"onTapRefreshContacts"),n.prototype),n);t.a=new _},function(e,t,a){"use strict";var n,r=a(5),i=a.n(r),o=a(12),s=a.n(o),l=a(7),u=a.n(l),c=a(8),d=a.n(c),h=a(10),f=a.n(h),p=a(11),g=a(2),m=a(0),v=a(130);var y=(n=function(){function e(){var t=this;u()(this,e),this.nextID=0,this.callbacks={},this.listeners={},this.pendingMessages={},v.b.forEach((function(e){t[e]=t.sendMessage.bind(t,e)})),v.c.forEach((function(e){t[e]=t.addNativeListener.bind(t,e),t.pendingMessages[e]=[]})),this.isNativeApp()&&(window.ReactNativeWebViewHandler=this.onMessage,this.onAppInfo((function(e){var a=e.version,n=e.codePushVersion,r=e.featureVersion;t.appVersion=a+(n?" - ".concat(n):""),t.featureVersion=r})),this.initialize({clientId:g.a.ClientID,redirectUrl:"".concat(g.a.ClientIDReversed,":/oauth2redirect/google")}))}return d()(e,[{key:"isNativeApp",value:function(){return!!window.ReactNativeWebView}},{key:"addNativeListener",value:function(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t),this.pendingMessages[e].forEach((function(e){return t(e)}))}},{key:"onMessage",value:function(e,t){var a,n,r=t.v;m.default.isNumber(e)?(null===(a=(n=this.callbacks)[e])||void 0===a||a.call(n,r),delete this.callbacks[e]):this.listeners[e]&&this.pendingMessages[e]&&(this.listeners[e].forEach((function(e){return e(r)})),this.pendingMessages[e].push(r))}},{key:"sendMessage",value:function(){var e=s()(i.a.mark((function e(t){var a,n,r,o=0,s=this,l=arguments;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:a=l.length,n=new Array(a>1?a-1:0),r=1;case 1:if(!(r<a)){e.next=8;break}if(!(o++>5e3&&__infLoop&&__infLoop(o))){e.next=4;break}throw new RangeError;case 4:n[r-1]=l[r];case 5:r++,e.next=1;break;case 8:if(!this.isNativeApp()){e.next=11;break}return e.abrupt("return",new Promise((function(e){var a=s.nextID++;s.callbacks[a]=e,ReactNativeWebView.postMessage(JSON.stringify({fn:t,num:a,args:n}))})));case 11:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAppVersion",value:function(){return this.appVersion}}]),e}(),f()(n.prototype,"addNativeListener",[p.a],Object.getOwnPropertyDescriptor(n.prototype,"addNativeListener"),n.prototype),f()(n.prototype,"onMessage",[p.a],Object.getOwnPropertyDescriptor(n.prototype,"onMessage"),n.prototype),n);t.a=new y},function(e,t,a){"use strict";var n,r=a(7),i=a.n(r),o=a(8),s=a.n(o),l=a(10),u=a.n(l),c=a(11),d=a(2),h=a(0),f=a(4),p=a(70),g=a(78),m=a(110),v=/(^|[\(\[\s-])(!?)(?:(?:(?:(https?|ftp|evernote|onenote|bear):\/\/)([^\s/$.?#'",]*[^\s'",]*))|((?:\w+\.)+(?:[a-zA-Z]{2,})+[\w/#?=&]*))(?=[ \.,'"\)\]]|$)/gi,y=", . ? ! ) ( : ; [ ] ' \" _".split(" "),k=", . ? ! ; :".split(" "),_=0,b=window.__PARSE_STATS={total:0,parseText:0,parseNote:0,parseSinglePlugin:0},w=/(^#|[\(\s-]#)([^\s\[\]\(\)*#\'\"\uFEFE]+)/g,S=/(?:(?:\u2001|\u2003)(p:[^\u2001\u2003]+)(?:\u2001|\u2003))/gi,D=d.a.Regexp.Prefix,P=/^(\#+|\^|\-|\*|\[(?: ?\])?|\]|[0-9]+\.) (```[A-Za-z]*|\\`\\`\\`|\#+|\^|\-|\*|\[(?: ?\])?|\]|[0-9]+\.) /gi,I=d.a.Regexp.MDLink,E=/^(-{3,})$/g,C=/^(={3,})$/g,x=/\b([^<>\s]+@[^<>\s]+\.[^<>\s]+)\b/gi,A=d.a.Regexp.Interlink,T=/\\([\*_~`])/g,M=d.a.Regexp.DataImage,L=/file:\/\/\/(\S)*/,O=[{regexp:/(^|[^\\])(\*\*\*)(.+?)\2/g},{regexp:/(^|[^\\])(\*\*)(.+?)\2/g},{regexp:/(^|[^\\])(\*)(.+?)\2/g},{isStrike:!0,regexp:/(^|[^\\])(~~)(.+?)\2/g},{isCode:!0,regexp:/(^|[^\\])(`)([^`]+?)\2/g},{isUnderline:!0,regexp:/(^|[^\\])(__)(.+?)\2/g}],R=(n=function(){function e(){i()(this,e)}return s()(e,[{key:"isFlagSet",value:function(e,t){return(e&t)===t}},{key:"trimPunc",value:function(e){return e.replace(/[:,\.\'\"\)\]\*_]*$/g,"")}},{key:"insertElNew",value:function(e,t,a,n){return e.insert(t,a,n)}},{key:"_notifyParse",value:function(e){b.total++,b[e]++}},{key:"runParseSinglePlugin",value:function(e,t){return this.parseSinglePlugin(e.getRawText(),t)}},{key:"parseSinglePlugin",value:function(e,t){if(this._notifyParse("parseSinglePlugin"),!e||0===e.length)return{parsedText:void 0,els:void 0};try{h.default.PAssert(412,!_,"We do not support recursive calls to parse")}catch(o){h.default.reportError(o)}var a,n;if(_++,"\u2001"===e[0]||"\u2003"===e[0]){var r=!h.default.isFlagSet(t,d.a.ChangeType.ItemLoad),i=f.default.pluginManager.parseAttachmentEmbedString(e.slice(1,-1),r);n=[i],e=d.a.AttachChar,r&&(a=[new g.a(d.a.AttachChar,i.displayElement.attrs)])}else a=[new g.a(e)];return _--,{parsedText:e,attachments:n,elsNew:a}}},{key:"parseNoteNew",value:function(e){return this._notifyParse("parseNote"),{elsNew:new m.a(e.getRawText())}}},{key:"runParseTextNew",value:function(e,t){return this.parseTextNew(e,e.getRawText(),p.a.getContacts(),void 0,t)}},{key:"whiteoutText",value:function(e,t,a){return e=e.substr(0,t)+" ".repeat(a)+e.substr(t+a)}},{key:"insertLink",value:function(e,t,a,n,r,i,o){if(n){var s=!!h.default.parseEvernoteLink(n),l=h.default.isOneNoteLink(n),u=h.default.isBearLink(n),c=h.default.isFileLink(n),d={text:i,href:n,appLink:(s?"evernote":l&&"onenote")||u&&"bear"||c&&"file"||void 0,isImage:r||h.default.isUrlImage(n),showImage:r,imageSize:o&&+o.replace(/\s|=|x/g,"")};return this.insertElNew(e,t,a,{link:d})}}},{key:"parseTextNew",value:function(e,t,a,n,r){e||(e={}),this._notifyParse("parseText");try{h.default.PAssert(413,!_,"We do not support recursive calls to parse")}catch(Me){h.default.reportError(Me)}_++;var i,o,s,l,u,c,p,g=t,b=t,P=0,R=0,F=r||!e.regexpFlags?d.a.RegexpFlags.All:e.regexpFlags,N=new m.a(t);if(t&&t.length>0&&(!n&&F>0&&(F&d.a.RegexpFlags.Prefix)===d.a.RegexpFlags.Prefix&&(D.lastIndex=0,null!==(i=D.exec(t))&&(c=i[1],P=i[0].length,c&&(p=0===c.indexOf("#")||0===c.indexOf("^")?"header":"["===c||"[]"===c||"[ ]"===c||"]"===c?"task":"*"===c||"-"===c?"bullet":c.startsWith("```")?"code":"numList",this.insertElNew(N,0,P,{prefixType:p}),b=(t=this.whiteoutText(t,i.index,P)).substr(P),R|=d.a.RegexpFlags.Prefix))),"code"!==p)){if(F>0&&(F&d.a.RegexpFlags.DataImage)===d.a.RegexpFlags.DataImage)for(var B=0;null!==(i=M.exec(t));){if(B++>5e3&&__infLoop&&__infLoop(B))throw new RangeError;this.insertLink(N,i.index,i[0].length,i[1],!0,void 0,i[2]),t=this.whiteoutText(t,i.index,i[0].length),R|=d.a.RegexpFlags.DataImage}if(F>0&&(F&d.a.RegexpFlags.Plugin)===d.a.RegexpFlags.Plugin){var j=0;for(S.lastIndex=0;null!==(i=S.exec(t));){if(j++>5e3&&__infLoop&&__infLoop(j))throw new RangeError;var U=f.default.pluginManager.parseAttachmentEmbedString(i[1],!0);this.insertElNew(N,i.index,i[0].length,{plugin:U}),t=this.whiteoutText(t,i.index,i[0].length),l?l.push(U):l=[U],R|=d.a.RegexpFlags.Plugin}}if(F>0&&(F&d.a.RegexpFlags.Date)===d.a.RegexpFlags.Date){var H=t.indexOf(d.a.CharDate);if(H>=0&&e){var V={p:d.a.PluginID.Date,id:e.id,itemID:e.id};V.displayElement=f.default.pluginManager.createDisplayElement(V,!0),this.insertElNew(N,H,1,{date:V}),l?l.push(V):l=[V],R|=d.a.RegexpFlags.Date}}if(F>0&&(F&d.a.RegexpFlags.MDLink)===d.a.RegexpFlags.MDLink){var W=0;for(I.lastIndex=0;null!==(i=I.exec(t));){if(W++>5e3&&__infLoop&&__infLoop(W))throw new RangeError;var z="!"===i[1],q=i[2],G=i[3];G&&(z?this.insertLink(N,i.index,i[0].length,G,!0,q,i[4]):this.insertLink(N,i.index,i[0].length,G,!1,q),t=this.whiteoutText(t,i.index,i[0].length),R|=d.a.RegexpFlags.MDLink)}}if(!e||F>0&&(F&d.a.RegexpFlags.WebUrl)===d.a.RegexpFlags.WebUrl){var K=0;for(v.lastIndex=0;null!==(i=v.exec(t));){if(K++>5e3&&__infLoop&&__infLoop(K))throw new RangeError;var Y=i[4]||i[5];if(!Y)break;var X=i[1].length,Q=(i[3]||"http")+"://"+Y,J="!"===i[2],Z=i.index+X,$=i[0].length-X;this.insertLink(N,Z,$,Q,J)&&(t=this.whiteoutText(t,Z,$)),R|=d.a.RegexpFlags.WebUrl}}if(!e||F>0&&(F&d.a.RegexpFlags.FileUrl)===d.a.RegexpFlags.FileUrl){var ee=0;for(L.lastIndex=0;null!==(i=L.exec(t));){if(ee++>5e3&&__infLoop&&__infLoop(ee))throw new RangeError;var te=i[0];this.insertLink(N,i.index,i[0].length,te,!1)&&(t=this.whiteoutText(t,i.index,i[0].length)),R|=d.a.RegexpFlags.FileUrl}}if(F>0&&(F&d.a.RegexpFlags.MarkdownEscaped)===d.a.RegexpFlags.MarkdownEscaped)for(var ae=0;null!==(i=T.exec(t));){if(ae++>5e3&&__infLoop&&__infLoop(ae))throw new RangeError;this.insertElNew(N,i.index,2,{escaped:i[1]}),R|=d.a.RegexpFlags.MarkdownEscaped}if(F>0&&(F&d.a.RegexpFlags.Markdown)===d.a.RegexpFlags.Markdown)for(var ne=0,re=0;re<O.length;re++){var ie=0;if(ne++>5e3&&__infLoop&&__infLoop(ne))throw new RangeError;var oe=O[re].regexp;for(oe.lastIndex=0;null!==(i=oe.exec(t));){if(ie++>5e3&&__infLoop&&__infLoop(ie))throw new RangeError;if(!this.isInTag(i)){var se=O[re],le=se.isUnderline,ue=se.isStrike,ce=se.isCode,de=i[1].length,he=i[2].length,fe=i[3],pe={};le?pe.underline=!0:ue?pe.strike=!0:ce?pe.code=!0:(he>=2&&(pe.bold=!0),2!==he&&(pe.italic=!0));var ge=i.index+de;this.insertElNew(N,ge,he,Object.assign({formatting:!0},pe)),this.insertElNew(N,ge+he,fe.length,pe),this.insertElNew(N,ge+he+fe.length,he,Object.assign({formatting:!0},pe)),t=this.whiteoutText(t,ge+he+fe.length,he),t=this.whiteoutText(t,ge,he),oe.lastIndex=0,R|=d.a.RegexpFlags.Markdown}}}if(F>0&&(F&d.a.RegexpFlags.HR)===d.a.RegexpFlags.HR&&(E.lastIndex=0,null!==(i=E.exec(b))&&(this.insertElNew(N,i.index+P,i[0].length,{hr:!0}),R|=d.a.RegexpFlags.HR),C.lastIndex=0,null!==(i=C.exec(b))&&(this.insertElNew(N,i.index+P,i[0].length,{hr:!0,hrHeavy:!0}),R|=d.a.RegexpFlags.HR)),!l&&F>0&&(F&d.a.RegexpFlags.Email)===d.a.RegexpFlags.Email){var me=0;for(x.lastIndex=0;null!==(i=x.exec(t));){if(me++>5e3&&__infLoop&&__infLoop(me))throw new RangeError;this.insertElNew(N,i.index,i[0].length,{email:!0}),R|=d.a.RegexpFlags.Email}}if(F>0&&(F&d.a.RegexpFlags.Contact)===d.a.RegexpFlags.Contact&&a&&Object.keys(a).length>0){var ve=t.split(d.a.ContactPrefix);if(ve.length>1){var ye=0,ke=ve[0].length;ve=ve.slice(1);for(var _e=0;_e<ve.length;_e++){if(ye++>5e3&&__infLoop&&__infLoop(ye))throw new RangeError;var be=ve[_e],we=void 0;if(" "!==be[0]&&!y.includes(be[0]))for(var Se=0,De=0;De<be.length;De++){if(Se++>5e3&&__infLoop&&__infLoop(Se))throw new RangeError;var Pe=be.substr(0,De+1);a[Pe]&&(we=Pe)}we&&(s?s.push(we):s=[we],this.insertElNew(N,ke,we.length+1,{contact:!0}),R|=d.a.RegexpFlags.Contact),ke+=be.length+d.a.ContactPrefix.length}}}if(F>0&&(F&d.a.RegexpFlags.Tag)===d.a.RegexpFlags.Tag){var Ie=0;for(w.lastIndex=0;null!==(i=w.exec(t));){var Ee=0;if(Ie++>5e3&&__infLoop&&__infLoop(Ie))throw new RangeError;for(var Ce=i.index+i[1].length-1,xe=i[2].length+1,Ae=i[2];k.indexOf(Ae.charAt(Ae.length-1))>=0;){if(Ee++>5e3&&__infLoop&&__infLoop(Ee))throw new RangeError;xe--,Ae=Ae.substr(0,Ae.length-1)}Ae&&(o?o.push(Ae):o=[Ae]),this.insertElNew(N,Ce,xe,{tag:!0}),R|=d.a.RegexpFlags.Tag}}if(F>0&&(F&d.a.RegexpFlags.ItemLink)===d.a.RegexpFlags.ItemLink){var Te=0;for(A.lastIndex=0;null!==(i=A.exec(t));){if(Te++>5e3&&__infLoop&&__infLoop(Te))throw new RangeError;u||(u=[]),u.push(i[1]),this.insertElNew(N,i.index,i[0].length,{itemLink:i[1]}),R|=d.a.RegexpFlags.ItemLink}}l&&(S.lastIndex=0,g=g.replace(S,d.a.AttachChar))}return _--,{tags:o,attachments:l,contacts:s,prefix:c,prefixType:p,elsNew:N,parsedText:g,itemLinks:u,regexpFlags:R}}},{key:"isInTag",value:function(e){for(var t=0,a=e.index;a>=0;a--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(" "===e.input[a])return!1;if("#"===e.input[a])return!0}return!1}},{key:"checkMultiplePrefixes",value:function(e){P.lastIndex=0;var t=P.exec(e);return t&&(e=t[2]+" "+e.substr(t[0].length)),e=e.replace(/^\\`\\`\\` /,"``` ")}}]),e}(),u()(n.prototype,"runParseSinglePlugin",[c.a],Object.getOwnPropertyDescriptor(n.prototype,"runParseSinglePlugin"),n.prototype),u()(n.prototype,"runParseTextNew",[c.a],Object.getOwnPropertyDescriptor(n.prototype,"runParseTextNew"),n.prototype),n);t.a=new R},function(e,t,a){"use strict";var n=a(5),r=a.n(n),i=a(12),o=a.n(i),s=a(7),l=a.n(s),u=a(8),c=a.n(u),d=a(0),h=a(2),f=a(35),p=(a(26),a(37)),g=function(){function e(){l()(this,e),this.url=h.a.CloudFunctionsURL}return c()(e,[{key:"run",value:function(){var e=o()(r.a.mark((function e(t){var a,n,i,o,s,l,u,c,d,f=arguments;return r.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return a=f.length>1&&void 0!==f[1]?f[1]:{},n=a.query,i=a.body,o=a.retry,e.next=3,this.createURL(t,n,o);case 3:if(!(s=e.sent)){e.next=25;break}return l=i?{method:"POST",body:JSON.stringify(i)}:void 0,e.next=8,fetch(s,l);case 8:if(200!==(u=e.sent).status){e.next=16;break}return e.next=12,u.json();case 12:return c=e.sent,e.abrupt("return",{value:c,errorCode:void 0,error:void 0});case 16:return e.next=18,u.json();case 18:if(d=e.sent,o||"Unauthorized idToken"!==d.message){e.next=22;break}return console.log("Retrying becaus of invalid idToken"),e.abrupt("return",this.run(t,{query:n,body:i,retry:!0}));case 22:return e.abrupt("return",{value:void 0,errorCode:d.errorCode||d.status||u.status,error:d.message,braintreeError:d.braintreeError,braintreeErrorCode:d.braintreeErrorCode});case 23:e.next=26;break;case 25:return e.abrupt("return",{value:void 0,errorCode:h.a.PrivateAPIErrorCodes.MissingIDToken,error:"User does not have a valid id_token"});case 26:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createURL",value:function(){var e=o()(r.a.mark((function e(t){var a,n,i,o,s,l,u,c=arguments;return r.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return a=c.length>1&&void 0!==c[1]?c[1]:{},n=c.length>2?c[2]:void 0,e.next=4,f.a.getUser();case 4:return i=e.sent,e.next=7,i.getIdToken(!!n);case 7:o=e.sent;try{d.default.PAssert(236,o,"User does not have a valid id_token")}catch(h){d.default.reportError(h)}if(!o){e.next=15;break}for(u in a.id_token=o,s=this.url+t+"?",l=[],a)a.hasOwnProperty(u)&&a[u]&&l.push(u+"="+encodeURIComponent(a[u]));return e.abrupt("return",s+l.join("&"));case 15:return e.abrupt("return",void 0);case 16:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendFeedback",value:function(e){return this.run("user/sendFeedback",{body:e})}},{key:"setUserProperties",value:function(e){var t=p.a.userOut(e);return this.run("user/setUserProperties",{body:t})}},{key:"shareDocument",value:function(e){return this.run("sharing/shareDocument",{body:e})}},{key:"listTransactions",value:function(){return this.run("billing/listTransactions")}},{key:"getBillingToken",value:function(){return this.run("billing/getBillingToken")}},{key:"updateOrPurchasePlan",value:function(e){return this.run("billing/updateOrPurchasePlan",{body:e})}},{key:"startTrial",value:function(){return this.run("billing/startTrial")}},{key:"cancelPremium",value:function(){return this.run("billing/cancelPremium")}},{key:"updatePremiumStatus",value:function(){return this.run("billing/updatePremiumStatus")}},{key:"deleteAccount",value:function(){return this.run("user/deleteAccount")}},{key:"acceptInvite",value:function(e){return this.run("sharing/acceptInvite",{body:{token:e}})}},{key:"todoistImport",value:function(e){return this.run("oauth/todoist",{body:{code:e}})}},{key:"getTemplateProperties",value:function(){var e=o()(r.a.mark((function e(t){var a;return r.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.run("templates/getProps",{query:{folderID:t}});case 2:return(a=e.sent).value&&(a.value.id=t),e.abrupt("return",a);case 5:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"createTemplate",value:function(e,t,a,n){return this.run("templates/create",{body:{name:t,folderID:e,value:n,created:a}})}},{key:"updateIAP",value:function(){var e=o()(r.a.mark((function e(t){return r.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.run("billing/updateIAP",{body:t}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAccessToken",value:function(e,t){return this.run("auth/getAccessToken",{query:{email:e,refresh_part:t}})}},{key:"onAuthCode",value:function(e){return this.run("auth/onAuthCode",{body:e})}},{key:"saveRefreshToken",value:function(e){return this.run("auth/saveRefreshToken",{body:e})}}]),e}();t.a=new g},,function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(2),l=a(0),u=a(4),c=a(18),d=function(){function e(t,a){r()(this,e),this.text=t,this.props=a||{}}return o()(e,[{key:"getText",value:function(){return this.text}},{key:"setText",value:function(e,t){var a=this.props;if(a.link)if(e){s.a.Regexp.MDLink.lastIndex=0;var n=s.a.Regexp.MDLink.exec(e);n?(a.link.text=n[2],a.link.href=n[3],a.link.showImage=a.link.isImage&&"!"===n[1]):void 0===a.link.text?a.link.href=e:t?delete a.link:a.link.text=e}else delete a.link;this.text=e}},{key:"setPropsText",value:function(e,t){var a=t||this.props;return a.link&&a.link.text&&(a.link.text=e),a}},{key:"canWrap",value:function(){var e=this.props;return!(e.date||this.isImage()||e.plugin||e.hr||e.itemLink||e.link&&e.link.appLink)}},{key:"mergeProps",value:function(e){this.props=Object.assign({},this.props,e)}},{key:"isBold",value:function(){var e=this.props;return!!(e.bold||e.contact||e.date||e.tag)}},{key:"isEditable",value:function(){var e=this.props;return!(e.plugin||e.date||e.itemLink||e.escaped||this.isImage())}},{key:"isImage",value:function(){var e=this.props;return e.link&&e.link.showImage&&e.link.isImage||e.plugin&&"Drive"===e.plugin.p&&!!e.plugin.showInline&&"false"!==e.plugin.showInline}},{key:"isEditableAtStart",value:function(){return!this.props.link}},{key:"isEditableAtEnd",value:function(){return!this.props.link}},{key:"getRawText",value:function(e){var t=this.props,a=this.text;if(t.formatting&&!e)return"";if(t.link){var n=t.link.text,r=t.link,i=r.href,o=r.imageSize,l=r.showImage,c=o?" =".concat(o,"x"):"";if(o&&!n)return n=i,"![](".concat(i).concat(c,")");if(n)return(l?"!":"")+(n!==i||o?"[".concat(n,"](").concat(i).concat(c,")"):i)}if(t.itemLink&&a)return"[[".concat(t.itemLink,"]]");if(a&&t.date)return s.a.CharDate;if(a&&t.plugin){var d=u.default.pluginManager.getPlugin(t.plugin.p),h=d.getAttachment(t.plugin.id);return d.getAttachmentEmbedString(h)}return a}},{key:"getStyledText",value:function(e){var t,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.props,r=n.plugin||n.date;if(r){var i=u.default.pluginManager.getPlugin(r.p);if(i&&(null===r||void 0===r?void 0:r.id)){try{l.default.PAssert(528,r.id,"If a plugin is specified, must have the ID for that plugin as well")}catch(g){l.default.reportError(g)}var o=i.getAttachment(r.id);if(t=i.getDisplayText(o,e),this.props.date&&e.isRepeatDate()){var s=e.getMooDate().getRepeatFrequency();t+="\u27f3"+(s||"")}}else{try{l.default.PAssert(529,!1,"Plugin ".concat(null===r||void 0===r?void 0:r.p," failed to load ").concat(r.id))}catch(g){l.default.reportError(g)}t="Plugin ".concat(null===r||void 0===r?void 0:r.p," failed to load ").concat(r.id)}}else{var d=this.text;if(n.itemLink)if(a.linkedItemDepth>1)d="";else{var h,f,p=c.a.getItem(n.itemLink);if(p)f=p.getDisplayText({showMarkdown:!1,noPrefix:!0,linkedItemDepth:(a.linkedItemDepth||0)+1})||"(Linked item has no text)";else;d=null!==(h=f)&&void 0!==h?h:"(Deleted item)"}else!n.prefixType||a&&a.noPrefix?a&&a.showMarkdown||(n.formatting?d="":n.escaped?d=n.escaped:(n.link&&(d=n.link.text||n.link.href),"string"===typeof n.underline&&(d=n.underline),"string"===typeof n.bold&&(d=n.bold),"string"===typeof n.italic&&(d=n.italic),"string"===typeof n.strike&&(d=n.strike),"string"===typeof n.code&&(d=n.code))):"numList"===n.prefixType&&(d=e.numListNumber()+". ");t=d}return t}},{key:"getFixedWidth",value:function(e){return this.props.prefixType?s.a.PrefixWidth:this.props.hr?e.pane.maxWidthOfPaneObject(e):void 0}},{key:"getClassNames",value:function(e,t){var a=this.props,n="";if(a.prefixType&&(n+=" itemPrefix prefix"+a.prefixType.capitalize(),"task"===a.prefixType&&(n+=" icon-square-o")),a.link){n+=" mdSpan link c-link pressable"+(t?"":" cursor-pointer");var r=a.link.appLink;r&&(n+=" appLink inlineBordered heightLineHeight "+r)}return a.itemLink&&(n+=" itemLink inlineBordered heightLineHeight pressable"),a.email&&(n+=" email c-contact pressable"),a.contact&&(n+=" contact c-contact pressable"),a.tag&&(n+=" tag c-tag pressable"),a.hr&&(n+=" mdHR "+(a.hrHeavy?"heavy c-border-ultra-heavy":"c-border-heavy")),e||(a.formatting&&(n+=" mdFormat"),a.underline&&(n+=" mdUnderline"),a.bold&&(n+=" mdBold"),a.italic&&(n+=" mdItalic"),a.strike&&(n+=" mdStrike"),a.code&&(n+=" mdCode")),n}},{key:"getStyle",value:function(){}},{key:"hasFormat",value:function(){var e=this.props;return e.bold||e.underline||e.italic||e.strike||e.formatting||e.code}},{key:"getFormats",value:function(){var e=this.props;return{bold:e.bold,italic:e.italic,underline:e.underline,strike:e.strike,code:e.code}}},{key:"isFormatEqualTo",value:function(e){var t=this.props,a=e.props;return!t.bold===!a.bold&&!t.italic===!a.italic&&!t.underline===!a.underline&&!t.strike===!a.strike&&!t.code===!a.code}},{key:"padSpaces",value:function(e,t,a){return(t?" ":"")+e+(a?"":" ")}},{key:"getHTML",value:function(e,t,a,n){var r=this.props,i=this.text;if(r.prefixType||r.formatting)return"";if(r.link)return r.link.isImage&&r.link.showImage?'<img src="'.concat(r.link.href,'"></img>'):'<a href="'.concat(r.link.href,'">').concat(r.link.text||r.link.href,"</a>");if(r.date&&e.getMooDate())return this.padSpaces(e.getMooDate().toText(),t,a);if(r.plugin){var o=u.default.pluginManager.getPlugin(r.plugin.p),s=o.getAttachment(r.plugin.id),l=o.getURLForAttachment(s),d=o.getAttachmentTitleString(s);return this.padSpaces('<a href="'.concat(l,'">').concat(d,"</a>"),t,a)}if(r.itemLink){var h=c.a.getItem(r.itemLink);h&&(i=h.getStyledTextAsOneLine()),n&&(i="[[".concat(r.itemLink," ").concat(i,"]]"))}return"string"===typeof r.underline&&(i=r.underline),"string"===typeof r.bold&&(i=r.bold),"string"===typeof r.italic&&(i=r.italic),"string"===typeof r.strike&&(i=r.strike),"string"===typeof r.code&&(i=r.code),r.escaped&&(i=r.escaped),r.bold&&(i="<b>".concat(i,"</b>")),r.italic&&(i="<i>".concat(i,"</i>")),r.underline&&(i="<u>".concat(i,"</u>")),r.strike&&(i="<s>".concat(i,"</s>")),r.code&&(i='<span class="mdCode">'.concat(i,"</span>")),i}},{key:"getPlaintext",value:function(e,t){var a=this.props,n=this.text;if(a.prefixType)return"";if(a.link)return a.link.text||a.link.href;if(a.itemLink)if(t>1)n="";else{var r=c.a.getItem(a.itemLink);r&&(n=r.getPlaintext(void 0,(t||0)+1))}if(a.escaped)return a.escaped;if(a.date&&e.getMooDate())return e.getMooDate().toText();if(a.plugin){var i=u.default.pluginManager.getPlugin(a.plugin.p),o=i.getAttachment(a.plugin.id);return i.getAttachmentTitleString(o)}return n}},{key:"split",value:function(t,a){var n,r,i=this.getStyledText(t.item,{showMarkdown:t.showMarkdown()});if(a>0){var o=i.slice(0,a);n=new e(o,this.setPropsText(o,l.default.cloneDeep(this.props)))}if(a<i.length){var s=i.slice(a);r=new e(s,this.setPropsText(s,l.default.cloneDeep(this.props)))}return[n,r]}},{key:"hasMobileExtraLength",value:function(){var e=this.props;if(e.plugin){var t=e.plugin.p;if(t===s.a.PluginID.Gmail||t===s.a.PluginID.Drive)return!0}return e.itemLink||e.link&&e.link.appLink}},{key:"getMobileRenderedText",value:function(e){return this.hasMobileExtraLength()?"".concat(s.a.RNSpace).concat(s.a.RNSpace).concat(s.a.RNSpace).concat(e).concat(s.a.RNSpace):e}},{key:"getMobileRenderedTextExtraLength",value:function(){return this.hasMobileExtraLength()?4:0}}]),e}();t.a=d},function(e,t,a){"use strict";var n=a(0),r=a(3),i=a.n(r),o=a(17),s=a(28),l={start:{transition:{staggerChildren:.2}},end:{transition:{staggerChildren:.2}}},u={start:{y:"50%"},end:{y:"150%"}},c={duration:.5,yoyo:1/0,ease:"easeInOut"},d=Object(o.b)((function(e){var t=e.color,a=e.size,n={width:4*(a=a||8),height:3*a,display:"flex",justifyContent:"space-around"},r={display:"block",width:a,height:a,backgroundColor:t||"#777",borderRadius:"50%"};return i.a.createElement(s.b.div,{style:n,variants:l,initial:"start",animate:"end"},i.a.createElement(s.b.span,{style:r,variants:u,transition:c}),i.a.createElement(s.b.span,{style:r,variants:u,transition:c}),i.a.createElement(s.b.span,{style:r,variants:u,transition:c}))}));t.a=Object(o.b)((function(e){var t=e.className,a=e.style,r=e.size,o=e.left,s=e.top,l=e.center,u=e.inline,c=e.color,h=e.children;a=Object.assign({},a),(s||o)&&(a.position="absolute",a.left=o||"50%",a.top=s||"50%");var f=n.default.classNames("fancyLoader c-foreground-light flex flex-col items-center justify-center",t,{"absolute inset-0":l},{"relative inline":u}),p=n.default.classNames("fancyLoaderText",{"pt-4":!u}),g={color:c};return i.a.createElement("div",{className:f,style:a},i.a.createElement(d,{color:c,size:r}),h&&i.a.createElement("div",{className:p,style:g},h))}))},function(e,t,a){"use strict";var n=a(5),r=a.n(n),i=a(12),o=a.n(i),s=a(7),l=a.n(s),u=a(8),c=a.n(u),d=a(0),h=1e5,f=function(){function e(){l()(this,e)}return c()(e,[{key:"ensurePolyfill",value:function(){var e=o()(r.a.mark((function e(t,n){var i,o,s;return r.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:e.next=5;break;case 5:if(window.TextEncoder&&window.TextDecoder){e.next=12;break}return window.TextEncoder=window.TextDecoder=null,e.next=9,a.e(3).then(a.t.bind(null,311,7));case 9:s=e.sent,window.TextEncoder=s.TextEncoder,window.TextDecoder=s.TextDecoder;case 12:i=window.TextEncoder,o=window.TextDecoder;case 14:this.textEncoder=new i,this.textDecoder=new o,n();case 17:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"ab2str",value:function(e){var t="";try{var a=new Uint8Array(e);if(a.length>h){var n,r,i,o=0;for(n=0,r=a.length;n<r;n+=h){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;i=a.slice(n,n+h),t+=String.fromCharCode.apply(null,i)}}else t=String.fromCharCode.apply(null,a)}catch(s){d.default.reportError(s)}return t}},{key:"str2ab",value:function(e){for(var t=0,a=new ArrayBuffer(e.length),n=new Uint8Array(a),r=0,i=e.length;r<i;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n[r]=e.charCodeAt(r)}return n}},{key:"unicode2ab",value:function(e){return this.textEncoder.encode(e)}},{key:"ab2unicode",value:function(e){return this.textDecoder.decode(e)}}]),e}();t.a=new f},function(e,t,a){"use strict";var n,r=a(7),i=a.n(r),o=a(8),s=a.n(o),l=a(0),u=a(2),c=a(4),d=a(60),h=a.n(d),f=a(24),p=a.n(f),g=a(20),m=a.n(g),v=a(21),y=a.n(v),k=a(13),_=a.n(k),b=a(9),w=a(6),S=a(26),D=a(18),P=a(27),I=a(15),E=a(69),C=a(10),x=a.n(C),A=a(11),T=a(25),M=(n=function(){function e(t){for(var a in i()(this,e),t)t.hasOwnProperty(a)&&(this[a]=t[a]);this.id=t.id,this.text=t.name,this.search=this.pane.search,this.items=[],this.numInstancesOfItem={};try{l.default.PAssert(1246,this.id,"Added an agenda block without an id")}catch(n){l.default.reportError(n)}}return s()(e,[{key:"shouldShowTime",value:function(){return!this.isOverdue&&this.isDate}},{key:"heightOfHeader",value:function(){return 32}},{key:"heightOfSpaceBetween",value:function(){return 16}},{key:"heightOfAddButton",value:function(){return this.heightOfHeader()+this.heightOfSpaceBetween()}},{key:"numItems",value:function(){return this.items.length}},{key:"getLastItem",value:function(){var e=this.items[this.items.length-1];return e&&e.isNote()&&(e=e.parent()),e}},{key:"comparePriority",value:function(e,t){var a=e.getPriority(),n=t.getPriority();return a>n?-1:a<n?1:0}},{key:"compareDate",value:function(e,t){try{l.default.PAssert(1247,this.date,"This block does not have a date",this.text)}catch(h){l.default.reportError(h)}var a=this.pane,n=e.getNextDate()||e.getDate(a),r=t.getNextDate()||t.getDate(a);if(e.isComplete()&&!t.isComplete())return-1;if(!e.isComplete()&&t.isComplete())return 1;if(e.isComplete()&&t.isComplete())return e.dateCompleted>t.dateCompleted?1:-1;if(n&&!r)return-1;if(!n&&r)return 1;if(!n&&!r)return 0;if(e.getDuration(a)>0){var i=e.getDisplayDateWithDuration(this.date);i&&(n=i)}if(t.getDuration(a)>0){var o=t.getDisplayDateWithDuration(this.date);o&&(r=o)}var s=T.a.clearTime(n),u=T.a.clearTime(r);if(+s!==+u)return s<u?-1:1;if(n.hasTimeOfDay()&&r.hasTimeOfDay()){var c=n.getTimeOfDay(),d=r.getTimeOfDay();return c===d?0:c<d?-1:1}return n.hasTimeOfDay()?1:r.hasTimeOfDay()?-1:0}},{key:"compareOrder",value:function(e,t){return e.index-t.index}},{key:"compareItemsAgenda",value:function(e,t){var a=e.item,n=t.item;l.default.DAssert(a,"Must have a valid left item to compare"),l.default.DAssert(n,"Must have a valid right item to compare"),l.default.DAssert(!a||a.parent(),"Must have a valid left parent item"),l.default.DAssert(!n||n.parent(),"Must have a valid right parent item"),a.isNote()&&(a=a.parent()),n.isNote()&&(n=n.parent());var r=this.isStarred||this.isImportant?0:this.compareDate(a,n);if(0===r){var i=this.isStarred?0:this.comparePriority(a,n);return 0===i?this.compareOrder(e,t):i}return r}},{key:"compareItemsCreated",value:function(e,t){return this.pane.compareDate(e.item.dateCreated,t.item.dateCreated)}},{key:"compareItemsCompleted",value:function(e,t){return this.pane.compareDate(e.item.dateCompleted,t.item.dateCompleted)}},{key:"compareItemsModified",value:function(e,t){return this.pane.compareDate(e.item.dateModified,t.item.dateModified)}},{key:"addItem",value:function(e){try{l.default.PAssert(1248,e&&l.default.isVMLI(e),"Must be adding a valid item: "+l.default.getObjectInfo(e))}catch(t){l.default.reportError(t)}this.items.indexOf(e)<0&&this.items.push(e)}},{key:"toggleCollapsed",value:function(){this.pane.setBlockCollapsed(this,!this.isCollapsed())}},{key:"isCollapsed",value:function(){return this.pane.isBlockCollapsed(this)}},{key:"getItemID",value:function(e){var t=this.numInstancesOfItem[e.id]||0;return this.numInstancesOfItem[e.id]=t+1,e.id+"_"+this.id+(t?"_"+t:"")}},{key:"sort",value:function(e){var t;if(this.pane.isViewAgenda()){var a=this.pane.getSortModeBlocks();"Date"===a?t=this.compareItemsAgenda:"Created"===a?t=this.compareItemsCreated:"Completed"===a?t=this.compareItemsCompleted:"Modified"===a&&(t=this.compareItemsModified)}else this.pane.isViewCalendarMonth()?t=this.compareItemsAgenda:this.sortMode&&"None"!==this.sortMode&&(t=this.pane.getItemComparator());if(t){var n=e.map((function(e,t){return{item:e,index:t}}));return n.sort(t),n.map((function(e){return e.item}))}return e}},{key:"_getAllItemsSorted",value:function(e,t,a){var n=this;t.isHidden(this.pane)||e.push(t),a&&!t.isCollapsed(this.pane)&&t.getItems().forEach((function(t){return n._getAllItemsSorted(e,t,!0)}))}},{key:"getAllItemsSorted",value:function(e){var t=this,a=[];return this.items.forEach((function(n){return t._getAllItemsSorted(a,n,e)})),a=this.sort(a)}}]),e}(),x()(n.prototype,"compareItemsAgenda",[A.a],Object.getOwnPropertyDescriptor(n.prototype,"compareItemsAgenda"),n.prototype),x()(n.prototype,"compareItemsCreated",[A.a],Object.getOwnPropertyDescriptor(n.prototype,"compareItemsCreated"),n.prototype),x()(n.prototype,"compareItemsCompleted",[A.a],Object.getOwnPropertyDescriptor(n.prototype,"compareItemsCompleted"),n.prototype),x()(n.prototype,"compareItemsModified",[A.a],Object.getOwnPropertyDescriptor(n.prototype,"compareItemsModified"),n.prototype),x()(n.prototype,"toggleCollapsed",[A.a],Object.getOwnPropertyDescriptor(n.prototype,"toggleCollapsed"),n.prototype),n),L=a(107),O=a(54),R=a(87);function F(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=_()(e);if(t){var r=_()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return y()(this,a)}}var N={Groups_Project:{Default:"None",Available:["None","Alphabetical","NumItems","Date","Priority","Created","Modified","Completed"]}};N.Groups_Tag=N.Groups_Contact={Default:"Alphabetical",Available:["Alphabetical","NumItems"]},N.Agenda_Today=N.Agenda_Week=N.Agenda_Month=N.Agenda_All={Default:"Date",Available:["Date","Created","Completed","Modified"]};var B=function(e){m()(a,e);var t=F(a);function a(e){var n;i()(this,a),e.document||(e.document=D.a.getDefaultDocument());(n=t.call(this,e,{isWriteable:!0,hasNonVMLIs:!0,supportCollapsing:!0,supportCompleting:!0,supportIndent:!1,supportOffline:!0,supportMenuIcon:!0,supportViewMenu:!0,supportMultiselect:!1,supportClickOverviewScroll:!1,isDraggable:!0,overviewTracksScroll:!1,overviewCanTrackScroll:!0,combineOverdue:!0,supportHistory:!0,searchFilters:["project","task","starred","complete","priority","showOnlyMatches","showOnlyAgendaDates","showOnlyMatchingTags","showChildProjects"]})).type=u.a.PaneMode.Task,n.paneClass="paneTask",S.a.binder(h()(n),"getDayWidth","updateAllDay","scrollToToday","setViewMode","compareBlockDate","compareBlockName","compareBlockItemPriority","compareBlockItemCreated","compareBlockItemModified","compareBlockItemCompleted","compareItemDate","compareItemName","_itemSearchComparator","onScroll","addFnProject","addFnTag","addFnDate","onGCalendarActiveChanged","onGmailActiveChanged","onCalendarCustomDaysChanged","switchToOutline","onViewStateChanged","getItemComparator","onDayWeekStartChanged","_onSelectionChanged","setGroupMode","setSortBlocks","setSortItems"),n.dragHoveredBlock=new I.a;var r=e.viewState||{};return r.viewMode=r.viewMode||"Outline",r.sortModeBlocks=r.sortModeBlocks||{mode:"None"},r.sortModeItems=r.sortModeItems||{mode:"None"},l.default.isString(r.sortModeBlocks)&&(r.sortModeBlocks={mode:r.sortModeBlocks}),l.default.isString(r.sortModeItems)&&(r.sortModeItems={mode:r.sortModeItems}),n.viewState=new R.a(r,n.onViewStateChanged),n.item.get()||n.item.set(n.getDefaultDisplayItem()),n._allPaneItems=[],n._isViewHelper={},n.topBoxHeight.set(0,!1),n.blocksCollapsed=e.blocksCollapsed||{},n.dropEffect=function(e){var t=u.a.DropEffect.Move;return n.isCalendarItem(e)&&(t=u.a.DropEffect.Copy),t},n.displayLocalItems=new I.a(void 0===e.displayLocalItems||e.displayLocalItems),n.displayCalendars=new I.a(e.displayCalendars||{}),n.numAllDay=new I.a(0),n.setupViewState(),n.initBlocks(),n}return s()(a,[{key:"initBlocks",value:function(){this.blocks=[],this.blockImportant=void 0,this.blockStarred=void 0,this.days={},this.datesByItem={},this.starredItems={},this.priorityItems={},this.blocksByKey={},this.preventUpdateItemsForItem=void 0;var e=c.default.pluginManager.getPlugin(u.a.PluginID.GCalendar);e.isActive()&&this.useItemStore(e.getDefaultItemStore());var t=c.default.pluginManager.getPlugin(u.a.PluginID.Gmail);t.isActive()&&this.useItemStore(t.getDefaultItemStore()),c.default.pluginManager.listen("pluginActiveChanged",u.a.PluginID.GCalendar,this.onGCalendarActiveChanged),c.default.pluginManager.listen("pluginActiveChanged",u.a.PluginID.Gmail,this.onGmailActiveChanged),P.a.listen("selectionChanged",this._onSelectionChanged),c.default.settings.dayWeekStart.listen(this.onDayWeekStartChanged),c.default.settings.calendarCustomDays.listen(this.onCalendarCustomDaysChanged),c.default.pluginManager.getPluginGCalendar().onCalendarsSynced.listen(this.updateItems)}},{key:"destroy",value:function(){c.default.pluginManager.unlisten("pluginActiveChanged",u.a.PluginID.GCalendar,this.onGCalendarActiveChanged),c.default.pluginManager.unlisten("pluginActiveChanged",u.a.PluginID.Gmail,this.onGmailActiveChanged),P.a.unlisten("selectionChanged",this._onSelectionChanged),c.default.settings.dayWeekStart.unlisten(this.onDayWeekStartChanged),c.default.settings.calendarCustomDays.unlisten(this.onCalendarCustomDaysChanged),c.default.pluginManager.getPluginGCalendar().onCalendarsSynced.unlisten(this.updateItems),p()(_()(a.prototype),"destroy",this).call(this)}},{key:"getPaneIcon",value:function(){return this.isViewAgenda()?"today":"format_list_bulleted"}},{key:"keydown",value:function(e){return w.a.isValid()&&w.a.getStartIndex()===w.a.getEndIndex()&&(this.preventUpdateItemsForItem=w.a.getStartObject(),this.search.stickMatch(w.a.getStartItem())),p()(_()(a.prototype),"keydown",this).call(this,e)}},{key:"handleLeftSideTap",value:function(e,t){return this.clearPreventUpdate(),p()(_()(a.prototype),"handleLeftSideTap",this).call(this,e,t)}},{key:"clearPreventUpdate",value:function(e){var t=this,a=this.preventUpdateItemsForItem;if(a&&c.default.DragDrop.isDragging){P.a.listen("endDrag",(function e(){P.a.unlisten("endDrag",e),t.clearPreventUpdate()}))}else{var n,r=e;if(a)r=r||(null===(n=this.search)||void 0===n?void 0:n.unstickMatch(a.item)),this.preventUpdateItemsForItem=void 0;r&&(this.setItemsDirty(),c.default.PaneUpdateBatcher.updateAllItems())}}},{key:"_onSelectionChanged",value:function(e){w.a.getPane()===this&&this.preventUpdateItemsForItem?w.a.isValid()?w.a.getStartObject().id!==this.preventUpdateItemsForItem.id&&(c.default.PaneUpdateBatcher.beginUpdateItems(),this.clearPreventUpdate(),c.default.PaneUpdateBatcher.updateAllItems(),e&&this.restoreSelection(e),c.default.PaneUpdateBatcher.commitUpdateItems()):(this.clearPreventUpdate(),this.updateItems()):this.clearPreventUpdate()}},{key:"isCalendarItem",value:function(e){return e.belongsToItemStore(c.default.pluginManager.getPlugin(u.a.PluginID.GCalendar).getDefaultItemStore())}},{key:"isEmailItem",value:function(e){return e.belongsToItemStore(c.default.pluginManager.getPlugin(u.a.PluginID.Gmail).getDefaultItemStore())}},{key:"_itemSearchComparator",value:function(e){var t=this,a=this.search.isMatched(e)||e.isNote()&&this.search.isMatched(e.parent()),n=!1,r=!1;if(this.isCalendarItem(e)){var i=e.getAttachmentByPlugin(u.a.PluginID.GCalendar);i&&("cancelled"===i.getField("status")?r=!0:i.forEachItem(void 0,(function(e){e.belongsToItemStore(i.getPlugin().getDefaultItemStore())||e.getDocumentOwner()!==t.getDocument()||(n=!0)})))}else if(this.isEmailItem(e)){var o=e.getAttachmentByPlugin(u.a.PluginID.Gmail);if(o){var s=c.default.pluginManager.getPluginGmail();if(s.isItemArchived(e))a=!1;else s.getAttachmentPriority(o)!==u.a.VMLIFlag.None&&(a=!0)}}return a&&!n&&!r}},{key:"getItemSearchParams",value:function(){return{itemStoreFilter:this.search.itemStoreFilter,item:this.getItem(),comparator:this._itemSearchComparator,noCollapsed:this.isViewOutline(),includeNotes:!0,pane:this}}},{key:"_setItems",value:function(){this.updateBlockItems()}},{key:"getIndexOfToday",value:function(){var e;if(this.isViewCalendarMonth()){var t=this.getWeekStart(new Date);e=this.items.get().findIndex((function(e){return e.date.equals(t)}))}else if(this.isViewCalendarHoriz())e=u.a.CalendarDayViewNumDaysPad;else if(this.isViewAgenda())for(var a=0,n=this.items.get(),r=0;r<n.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=n[r];if((i.isOverdue||i.isToday)&&"blockHeader"===i.type){e=r;break}}return e}},{key:"_getDateInMiddle",value:function(){var e=T.a.getToday(),t=this.getViewMode();return"Calendar_Month"===t?e=this.getMonthStart(e):"Calendar_Week"===t&&(e=this.getWeekStart(e)),e}},{key:"scrollToTop",value:function(e){this.isViewDates()?this.scrollToToday(e):p()(_()(a.prototype),"scrollToTop",this).call(this,e)}},{key:"onDayWeekStartChanged",value:function(){this.dateInMiddle=this._getDateInMiddle(),this.updateItemsImmediate(),this.scrollToToday()}},{key:"scrollToToday",value:function(e){if(this.isViewDates()){var t=this.getIndexOfToday();this.scrollIndexToTop(t,e)}}},{key:"weekCount",value:function(e,t,a){var n=new Date(e,t,1),r=a?new Date(e,t,a):new Date(e,t+1,0),i=n.getDay()+r.getDate();return Math.ceil(i/7)}},{key:"scrollJump",value:function(e,t){var a,n=this.getViewMode(),r=this.listManager.getScrollIndex(),i=this.objectAtIndex(r),o=r;if("Calendar_Month"===n){var s=i.date;if(e<0){var l=s.clone().addMonths(-1);a=this.weekCount(s.getFullYear(),s.getMonth(),s.getDate())-1,o-=this.weekCount(l.getFullYear(),l.getMonth())+a}else o+=this.weekCount(s.getFullYear(),s.getMonth())-(a=this.weekCount(s.getFullYear(),s.getMonth(),s.getDate())-1)}else if("Calendar_Custom"===n){o+=c.default.settings.calendarCustomDays.get()*e}else if("Calendar_Week"===n){var u=i.date.getDay(),d=c.default.settings.dayWeekStart.get();o+=e<0?u>d?-u+d:-7:7-u+d}else"Calendar_Day"===n&&(o+=e);this.setIgnoreRestoreScroll(),o>=0&&o<this.items.get().length&&this.scrollIndexToTop(o,t)}},{key:"compareDate",value:function(e,t){return e||t?e?t?e.compareTo(t):-1:1:0}},{key:"compareText",value:function(e,t){return e.localeCompare(t)}},{key:"comparePriority",value:function(e,t){var a=e.getPriority(this),n=t.getPriority(this);return n>a?1:n<a?-1:0}},{key:"compareBlockBase",value:function(e,t,a){try{l.default.PAssert(915,e,"Comparator was invalid")}catch(s){l.default.reportError(s)}var n,r=this.getSortOrderBlocks()||1;if(e&&(n=this.compareNoKey(t,a)*r||e(t,a)),0===n||void 0===n){var i=N[this.getViewMode()].Default,o=this._getBlockSortComparator(i);if(o!==e)return o(t,a)}return n*r}},{key:"compareBlockPriority",value:function(e,t){return t.priority-e.priority}},{key:"compareNoKey",value:function(e,t){return e.id===this.blockNoKey?1:t.id===this.blockNoKey?-1:void 0}},{key:"compareNone",value:function(e,t){return e.originalIndex-t.originalIndex}},{key:"compareBlockDate",value:function(e,t){return this.compareDate(e.date,t.date)}},{key:"compareBlockName",value:function(e,t){return this.compareText(e.name,t.name)}},{key:"compareBlockNumItems",value:function(e,t){return t.items.length-e.items.length}},{key:"compareBlockItemPriority",value:function(e,t){return this.comparePriority(e.item,t.item)}},{key:"compareBlockItemCreated",value:function(e,t){return this.compareDate(e.item.dateCreated,t.item.dateCreated)}},{key:"compareBlockItemModified",value:function(e,t){return this.compareDate(e.item.dateModified,t.item.dateModified)}},{key:"compareBlockItemCompleted",value:function(e,t){return this.compareDate(e.item.dateCompleted,t.item.dateCompleted)}},{key:"_getBlockSortComparator",value:function(e){return"Alphabetical"===e&&this.compareBlockName||"Date"===e&&this.compareBlockDate||"NumItems"===e&&this.compareBlockNumItems||"Priority"===e&&this.compareBlockItemPriority||"Created"===e&&this.compareBlockItemCreated||"Modified"===e&&this.compareBlockItemModified||"None"===e&&this.compareNone}},{key:"getBlockComparator",value:function(){var e=this.getSortModeBlocks();return this.compareBlockBase.bind(this,this._getBlockSortComparator(e))}},{key:"compareItemBase",value:function(e,t,a){try{l.default.PAssert(916,e,"Comparator was invalid")}catch(i){l.default.reportError(i)}var n,r=this.getSortOrderItems();return e&&(n=e(t,a)*r),0===n||void 0===n?this.compareItemNone(t,a):n}},{key:"compareItemNone",value:function(e,t){return e.index-t.index}},{key:"compareItemDate",value:function(e,t){return this.compareDate(e.item.getNextDate(),t.item.getNextDate())}},{key:"compareItemName",value:function(e,t){return this.compareText(e.item.getSearchText(this),t.item.getSearchText(this))}},{key:"compareItemNumItems",value:function(e,t){return t.item.numItems()-e.item.numItems()}},{key:"_getItemSortComparator",value:function(e){return"Alphabetical"===e&&this.compareItemName||"Date"===e&&this.compareItemDate||"NumItems"===e&&this.compareItemNumItems||"Priority"===e&&this.compareBlockItemPriority||"Created"===e&&this.compareBlockItemCreated||"Modified"===e&&this.compareBlockItemModified||"Completed"===e&&this.compareBlockItemCompleted||"None"===e&&this.compareItemNone}},{key:"getItemComparator",value:function(){var e,t=this.getSortModeBlocks();if("Date"===t)e=this.compareItemDate;else if("Created"===t)e=this.compareBlockItemCreated;else if("Modified"===t)e=this.compareBlockItemModified;else if("Completed"===t)e=this.compareBlockItemCompleted;else{var a=this.getSortModeItems();e=this._getItemSortComparator(a)}return this.compareItemBase.bind(this,e)}},{key:"getItemsOnDate",value:function(e){var t=0,a=[];for(var n=0;n<this._itemsWithDates.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._itemsWithDates[n];r.getMooDate().isOnDate(e)&&a.push(r)}return a}},{key:"findIndexOfNextBlock",value:function(){for(var e=0,t=new Date,a=this.items.get(),n=0;n<a.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=a[n];if("blockHeader"===r.type){var i=r.block;if(i.isOverdue||i.isNow||i.isToday||i.isStarred||i.isImportant||i.date>=t)return n}}return-1}},{key:"_keyHelper",value:function(e,t){var a=e["get"+t](this);if(a){if("Priority"===t)a=[a];else if(a=a.map((function(e){return{value:e,lower:e.toLowerCase()}})),this.search.showOnlyMatchingTags()){var n=this.search["get"+t]();n&&n.length>0&&(n=n.map(l.default.toLowerCase),a=a.filter((function(e){for(var t=0,a=0;a<n.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e.lower===n[a])return!0}})))}return a}if(this.search.isMatched(e,{isYes:!0})){var r=!0,i=e.parent();if(this.getBlock(this.blockNoKey)&&!this.isViewFlatList())for(var o=0;void 0!==i&&i!==this.getItem();){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(this.itemsInBlocks[i.id]){r=!1;break}i=i.parent()}if(r)return[this.blockNoKey]}}},{key:"_getKeysForItem",value:function(e){var t=this.getViewMode();if(this.isViewAgenda()||this.isViewCalendar()){var a=!0;if(this.isViewAgenda()&&e.hasAttachmentType(u.a.PluginType.Calendar)&&+e.getDate()<T.a.getTodayTime()){var n=e.getAttachmentByType(u.a.PluginType.Calendar),r=n.getPlugin();r.shouldDisplayOverdueInAgenda()&&r.hasWritePermissionForAttach(n)||(a=!1)}if(a){var i=this._getDatesForItem(e);if(this.isViewAgenda()&&"Date"===this.getSortModeBlocks()&&!this.search.showOnlyAgendaDates()){var o=[];if(!e.isComplete()){if(e.isStarred(this)){var s="starred";c.default.timeline.getDateForKey(s)&&o.push(s)}if(e.isImportant(this)){var l="important";c.default.timeline.getDateForKey(l)&&o.push(l)}}var d=e.getTagsLower();if(d)for(var h=0,f=0;d&&f<d.length;f++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var p="#"+d[f];c.default.timeline.getDateForKey(p)&&o.push(p)}o.length>0&&(i=i?i.concat(o):o)}return i}}else if("Groups_Project"===t){var g=this.getItem(),m=e.parent();if(m===g&&!e.isPrefixHeader())return[this.blockNoKey];if(m&&m.isPrefixHeader()&&m!==g&&(this.search.showChildProjects()||m.parent()===g))return[m.id]}else{if("Groups_Tag"===t)return this._keyHelper(e,"Tags");if("Groups_Contact"===t)return this._keyHelper(e,"Contacts");if("Groups_Priority"===t)return this._keyHelper(e,"Priority")}}},{key:"isOkOnAgenda",value:function(e){return!!this._getKeysForItem(e)||this.search.showHierarchy()&&e.parent()&&this.isOkOnAgenda(e.parent())}},{key:"_getDatesForItem",value:function(e){var t,a=this,n=this.getSortModeBlocks();if(this.isViewCalendar()||"Date"===n){var r=e.getMooDate();if(e.isComplete()&&this.isViewAgenda())+e.dateCompleted>=T.a.getTodayTime()&&(t=e.dateCompleted);else if(r){var i=r.getAllDates().filter((function(e){return a.isDateWithinRange(e)}));return i.length>10&&r.isRepeatDate()&&!r.isRange()&&(i=i.slice(0,10)),i}}else if("Created"===n||"Completed"===n||"Modified"===n){var o="Created"===n&&e.dateCreated||"Completed"===n&&e.dateCompleted||"Modified"===n&&e.dateModified;o&&(!this.startDate||o>=this.startDate)&&(t=o)}if(t&&this.isDateWithinRange(t))return[t]}},{key:"isDateWithinRange",value:function(e){return e&&(!this.endDate||+e<+this.endDate)&&this.search.isDateInRange(e)}},{key:"_getKeyForDate",value:function(e){var t=T.a.getToday();if(!(this.combineOverdue&&e<t)){var a=u.a.DFormat.MonthDayYearLong,n=c.default.International.getFormat(a);return e.toString(n)}return"overdue".toLowerCase()}},{key:"updateBlockItems",value:function(){var e,t=this.getViewMode();if(this.isViewOutline())this.updateOutline(this._allPaneItems,this.supportsSortItems()&&this.getItemComparator());else if(this.isViewCalendar()){var a=0;this._itemsWithDates=[];for(var n=0;n<this._allPaneItems.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this._allPaneItems[n];if(r.getMooDate()){var i=r.getAttachmentByType(u.a.PluginType.Calendar),o=i&&i.getField("calendarID");(o?!1!==this.displayCalendars.get()[o]:this.displayLocalItems.get())&&this._itemsWithDates.push(r)}}"Calendar_Month"===t?this.updateCalendarMonth():this.isViewCalendarHoriz()&&(this.updateCalendarWeek(),e=!0)}else this.updateBlocks(),this.updatePaneObjects();e&&this.updateAllDay()}},{key:"updateBlocks",value:function(){var e,t=0;this.blocks=[],this.blocksByKey={},this.itemsInBlocks={},this.isViewAgenda()&&this.getBlock(T.a.getToday());for(var a=0;a<this._allPaneItems.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this._allPaneItems[a],r=!n.isNote();if(r)if(n.getMooDate()){var i=n.getAttachmentByType(u.a.PluginType.Calendar),o=i&&i.getField("calendarID");r=o?!1!==this.displayCalendars.get()[o]:this.displayLocalItems.get()}r&&this.addToBlock(this._allPaneItems[a])}this.isViewAgenda()?e=this.compareBlockDate:this.isViewPriority()?e=this.compareBlockBase.bind(this,this.compareBlockPriority):this.supportsSortBlocks()&&(e=this.getBlockComparator()),e&&this.blocks.sort(e)}},{key:"addItemToPaneObjects",value:function(e,t,a,n,r,i){var o=new E.a({type:"blockItem",item:a,id:t.getItemID(a)+(i?"_"+i.id:""),pane:this,block:t,parentObject:i,index:e.length,levelsDeepRoot:r,sizeInPane:a.sizeInPane});if(this.addPaneObject(e,o),n&&!a.isCollapsed(this)){var s=a.getVisibleChildren(this);if(s)for(var l=0,u=0;u<s.length;u++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;this.addItemToPaneObjects(e,t,s[u],n,r,o)}}return o}},{key:"updatePaneObjects",value:function(){for(var e,t,a,n=0,r=[],i=this.search.showHierarchy(),o=this.isViewAutoBlocks(),s=0;s<this.blocks.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=this.blocks[s],u=this.isBlockCollapsed(l)&&(s===this.blocks.length-1||!this.isBlockCollapsed(this.blocks[s+1]));if(l.item?(t=l.item).isNote()||(a=new E.a({type:"blockItem",item:t,id:t.id+"_"+l.id,pane:this,block:l,index:r.length,sizePad:u?l.heightOfSpaceBetween():l.isCollapsed()?0:4,sizeInPane:t.sizeInPane,levelsDeepRoot:t,isBlockHeader:!0,blockPrevious:this.blocks[s-1]}),this.addPaneObject(r,a)):this.isViewProjectNoBlocks()||this.addPaneObject(r,new E.a({type:"blockHeader",block:l,id:l.id,pane:this,index:r.length,isToday:l.isToday,isOverdue:l.isOverdue,isFirstCollapsed:e&&l.isCollapsed()&&!e.isCollapsed(),sizePad:u?l.heightOfSpaceBetween():this.isViewProject()||this.isViewAgenda()&&l.isDate?4:0,sizeInPane:l.heightOfHeader,blockPrevious:this.blocks[s-1]})),!this.isBlockCollapsed(l)){for(var c=0,d=!1,h=l.getAllItemsSorted(!i&&!o),f=0;f<h.length;f++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;t=h[f],a=this.addItemToPaneObjects(r,l,t,i,t),!d&&this.isViewAgenda()&&this.shouldShowTime(a)&&!t.getTime()&&(a.showAllDay=!0,d=!0)}this.isViewDateMetadata()&&!l.isToday||this.addPaneObject(r,new E.a({type:"blockAddItem",id:l.id+"_add",pane:this,block:l,index:r.length,sizeInPane:l.noAddButton?l.heightOfSpaceBetween():l.heightOfAddButton(),blockPrevious:this.blocks[s-1]}))}e=l}if(this.isViewProject()&&!this.isViewProjectNoBlocks()){var p=this.getBlock("newProject");p.isNewProject=!0,this.addPaneObject(r,new E.a({type:"blockHeader",block:p,id:p.id,pane:this,index:r.length,sizeInPane:p.heightOfHeader,blockPrevious:this.blocks[this.blocks.length-1]}))}this.items.set(r)}},{key:"addToBlock",value:function(e){this.isViewProject()&&e.isPrefixHeader()&&(this.search.showChildProjects()||e.parent()===this.getItem())&&this.getBlock(e.id,e);var t=this._getKeysForItem(e);if(t)for(var a=0,n=0;n<t.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=this.getBlock(t[n],e);r&&(r.addItem(e),this.itemsInBlocks[e.id]=!0)}}},{key:"_addFnBase",value:function(e,t,a,n,r){e=c.default.settings.getDefaultItemText(n)+e,this.clearPreventUpdate(),c.default.PaneUpdateBatcher.beginUpdateItems();var i={text:e};r&&(i=l.default.extend(i,r));var o=this.createVMLI(i,{parent:a,changeType:u.a.ChangeType.AllLocal,isEditable:!0});a.insertItem(o),c.default.PaneUpdateBatcher.commitUpdateItems();var s=this.indexOfItem(o,t);s>=0&&w.a.selectIndex(s,0)}},{key:"addFnProject",value:function(e){return this._addFnBase("",e,e.id===this.blockNoKey?this.getItem():D.a.getItem(e.id))}},{key:"addFnTag",value:function(e){return this._addFnBase(e.id===this.blockNoKey?"":" "+e.text,e,this.getItem())}},{key:"addFnDate",value:function(e){var t,a="";return this.isViewDateMetadata()||(e.isDate?(a=" "+u.a.CharDate,t={date:e.date}):e.isStarred?t={isStarred:!0}:e.isImportant?t={priority:u.a.VMLIFlag.P2}:a=" "+e.id),this._addFnBase(a,e,this.getItem(),void 0,t)}},{key:"addFnContact",value:function(e){return this._addFnBase(e.id===this.blockNoKey?"":" "+e.text,e,this.getItem())}},{key:"addFnPriority",value:function(e){return this._addFnBase("",e,this.getItem(),void 0,{priority:e.priority})}},{key:"getDateForSoftDate",value:function(e){var t=c.default.timeline.getDateForKey(e.toLowerCase());if(!isNaN(t)){var a=100*Math.round(t/100),n=Math.round(a/100),r=Math.round(t-a);return T.a.getTodayPlusMS(n*u.a.MSPerDay+r*u.a.MSPerMinute)}}},{key:"getBlock",value:function(e,t){var a,n,r=this.isViewDates(),i=this.isViewAgenda(),o=e;if(r&&!l.default.isString(e))a=e,o=e=this._getKeyForDate(a),"overdue"===e&&(!t.isComplete()&&c.default.timeline.getDateForKey(e)||(e=void 0),a=void 0);else if(l.default.isObject(e)){try{l.default.PAssert(917,e.value&&e.lower,"If key is object it should have this form")}catch(p){l.default.reportError(p)}o=e.lower,e=e.value}if(e){var s,d=this.isViewAutoBlocks()?void 0:D.a.getItem(e),h=this.getViewMode();if(!(n=this.blocksByKey[o]))if(void 0!==(s=d?d.getStyledTextAsOneLine(!0):this.isViewPriority()?e===u.a.VMLIFlag.P0?"High Priority":e===u.a.VMLIFlag.P1?"Medium Priority":e===u.a.VMLIFlag.P2?"Low Priority":"(No priority)":e)){var f={pane:this,id:e,name:s,sortMode:this.supportsSortItems()&&this.getSortModeItems(),addFn:this.isViewProject()&&this.addFnProject.bind(this)||this.isViewTag()&&this.addFnTag.bind(this)||this.isViewContact()&&this.addFnContact.bind(this)||this.isViewPriority()&&this.addFnPriority.bind(this)||i&&this.addFnDate};this.isViewTag()?(f.name=e===this.blockNoKey?"(No tag)":"#"+f.name,f.isTag=!0):this.isViewContact()?(f.name=e===this.blockNoKey?"(No contact)":"+"+f.name,f.isContact=!0):this.isViewPriority()&&(f.isPriority=!0,f.priority=e),"Groups_Project"===h&&(f.name=e===this.blockNoKey?"(No project)":f.name,f.item=d,f.isEditable=!0,f.date=d&&d.getDate(this)),e===this.blockNoKey&&(f.isNoKey=!0),r&&(a?(f.date=T.a.clearTime(a),f.isDate=!0,f.date.equals(T.a.getToday())&&(f.isToday=!0)):(f.date=this.getDateForSoftDate(e),f.name=f.name.capitalize(),"now"===e?f.isNow=!0:"starred"===e?f.isStarred=!0:"important"===e?f.isImportant=!0:"overdue"===e&&(f.isOverdue=!0,f.noAddButton=!0))),n=new M(f),this.blocksByKey[o]=n,n.originalIndex=this.blocks.length,this.blocks.push(n)}}return n}},{key:"closestIndexOfObject",value:function(e){return this.isViewAutoBlocks()?this.indexOfItem(e.item,e.block,e.index):e.index}},{key:"onGCalendarActiveChanged",value:function(e,t){var a=e.getDefaultItemStore();t?this.useItemStore(a):this.stopUsingItemStore(a)}},{key:"onGmailActiveChanged",value:function(e,t){var a=e.getDefaultItemStore();t?this.useItemStore(a):this.stopUsingItemStore(a)}},{key:"_refreshPaneData",value:function(e){var t=c.default.pluginManager.getPluginGCalendar();t.isActive()&&t.forceRemoteEventSync(e)}},{key:"viewModeIcon",value:function(){var e=this.getViewMode();return u.a.TaskViewModeIcon[e]}},{key:"viewModeColor",value:function(){return u.a.Colors.Brand}},{key:"isViewDates",value:function(){return this._isViewHelper.dates}},{key:"isViewDateMetadata",value:function(){return this._isViewHelper.dateMetadata}},{key:"isViewAgenda",value:function(){return this._isViewHelper.agenda}},{key:"isViewCalendar",value:function(){return this._isViewHelper.calendar}},{key:"isViewCalendarHoriz",value:function(){return this._isViewHelper.calendarHoriz}},{key:"isViewCalendarMonth",value:function(){return this._isViewHelper.calendarMonth}},{key:"isViewProject",value:function(){return this._isViewHelper.project}},{key:"isViewProjectNoBlocks",value:function(){return this._isViewHelper.project&&(0===this.blocks.length||1===this.blocks.length&&this.blocks[0].id===this.blockNoKey)}},{key:"isViewOutline",value:function(){return this._isViewHelper.outline}},{key:"isViewFlatList",value:function(){return this._isViewHelper.flatList}},{key:"isViewTag",value:function(){return this._isViewHelper.tag}},{key:"isViewContact",value:function(){return this._isViewHelper.contact}},{key:"isViewPriority",value:function(){return this._isViewHelper.priority}},{key:"isViewAutoBlocks",value:function(){return this._isViewHelper.autoBlocks}},{key:"isViewText",value:function(){return this._isViewHelper.text}},{key:"isViewItems",value:function(){return this._isViewHelper.items}},{key:"isViewArchived",value:function(){return this._isViewHelper&&this._isViewHelper.archived}},{key:"isViewDeleted",value:function(){return this._isViewHelper&&this._isViewHelper.deleted}},{key:"canScrollToItem",value:function(){return!this.isViewCalendar()&&this.isViewItems()}},{key:"isViewPremiumBlocked",value:function(){return!c.default.billingManager.hasPremiumFeatures()&&u.a.TaskViewModesPremium[this.getViewMode()]}},{key:"shouldShowAddBox",value:function(){return!1}},{key:"supportsGrouping",value:function(){return this._isViewHelper.supportGrouping}},{key:"isCalFilterActive",value:function(){var e=this.displayCalendars.get(),t=!this.displayLocalItems.get();for(var a in e)if(e.hasOwnProperty(a)&&!1===e[a]){t=!0;break}return t}},{key:"becomeReal",value:function(){p()(_()(a.prototype),"becomeReal",this).call(this),this.onViewStateChanged()}},{key:"onViewStateChanged",value:function(e,t){var a=this;this.isFakePane?this.setupViewStateMinor():(this.setIgnoreRestoreScroll(void 0,(function(){a.listManager.saveScrollOfTop()})),this.setupViewState(),this.listManager.clearCache(),this.updateItemsImmediate(!0,void 0,void 0,!0),c.default.PaneManager.updatePaneStateForPane(this),e&&t&&e.viewMode!==t.viewMode&&this.isViewCalendar()&&this.scrollToToday("auto"))}},{key:"setupViewStateMinor",value:function(){var e=this.getViewMode(),t=this.getSortModeBlocks(),a={agenda:"Agenda_Today"===e||"Agenda_Week"===e||"Agenda_Month"===e||"Agenda_All"===e,calendar:"Calendar_Day"===e||"Calendar_Week"===e||"Calendar_Month"===e||"Calendar_Custom"===e,calendarHoriz:"Calendar_Day"===e||"Calendar_Week"===e||"Calendar_Custom"===e,calendarMonth:"Calendar_Month"===e,project:"Groups_Project"===e,outline:"Outline"===e||"List_Flat"===e||"Archived"===e||"Deleted"===e,flatList:"List_Flat"===e||!this.search.showHierarchy(),tag:"Groups_Tag"===e,contact:"Groups_Contact"===e,priority:"Groups_Priority"===e,archived:"Archived"===e,deleted:"Deleted"===e,items:"Archived"!==e&&"Deleted"!==e,dateMetadata:"Created"===t||"Modified"===t||"Completed"===t};a.supportGrouping=!a.calendar,a.dates=a.agenda||a.calendar,a.autoBlocks=a.agenda||a.tag||a.contact||a.priority,a.text=!a.calendar,this._isViewHelper=a,this.supportsSortBlocks()&&(this.supportsSortBlocksMode(t)||this.setSortModeBlocks(N[e].Default,1,!1),"Completed"===(t=this.getSortModeBlocks())&&0===this.search.getFilterValue("completeOption")&&this.search.setFilter("completeOption",1)),this.search.setFilterEnabled("showOnlyAgendaDates",this.isViewAgenda()),this.search.setFilterEnabled("showOnlyMatchingTags",this.isViewTag()||this.isViewContact()),this.search.setFilterEnabled("showChildProjects",this.isViewProject()),(this.isViewTag()||this.isViewContact())&&this.search.setFilterTooltip("showOnlyMatchingTags","Show only matching "+(this.isViewTag()?"Tag":"Contact")+" blocks")}},{key:"setupViewState",value:function(){this.setupViewStateMinor(),this.isViewCalendar()&&(this.viewState.setProperty("viewMode","Agenda_All"),this.setupViewStateMinor());var e,t=this.getViewMode(),a=this.getSortModeBlocks(),n=this.isViewOutline(),r=this.isViewCalendar(),i=r?0:(this.isViewAgenda()||this.isViewProject()?48:u.a.TopBoxHeight)||!1,o=this.isViewItems();if(this.canAddItem=o,this.supportCompleting=o,this.supportCheckbox=o,this.supportPerformArchive=o,this.supportIndent=o,this.supportClone=o,this.contextMenuMode=(this.isViewArchived()?"Archived":this.isViewDeleted()&&"Deleted")||"Normal",this.isEditable=o,this.isDraggable=o,this.isDropTarget=o,this.scrollToStartOnSearch=!r,this.search.setFilterEnabled("complete",o),this.blockNoKey="__block_nokey_"+t,this.supportIndent=n,this.supportMultiselect=n,this.overviewTracksScroll=n,this.supportSearchFlat=!r,this.supportCheckbox=!r,this.topBoxHeight.set(i,!1),this.paneClass=this.getPaneClass(),this.paneEmptyMessage=(this.isViewArchived()?"No archived items":this.isViewDeleted()&&"No deleted items")||this.isViewAgenda()&&"Nothing on the agenda"||this.isViewOutline()&&"Write some things here to get started"||"",this.collapsedFieldName=u.a.PerPaneStateField.Collapsed+(this.viewState?t:""),this.isViewPremiumBlocked()?this.toast.set({text:new I.a("The "+u.a.TaskViewModeText[t]+" view is a Premium feature"),actionText:"GO TO OUTLINE",doAction:this.switchToOutline,noClose:!0}):this.toast.set(void 0),(this.isViewCalendar()||this.isViewAgenda())&&(e=u.a.ItemStoreFilter.Dates,(this.isViewCalendar()||"Date"===this.getSortModeBlocks())&&(e|=u.a.ItemStoreFilter.Priority)),this.search.itemStoreFilter=e,this.search.onlyMatchDates=this.isViewDates(),this.shouldUpdateOnTextChanged=this.isViewAgenda()||this.isViewTag(),this.combineOverdue=this.isViewAgenda()&&"Date"===a,this.showScrollbars.set(!this.isViewCalendar()),this.isViewAgenda()){var s,l;if("Agenda_All"!==t)"Agenda_Today"===t?l=1:"Agenda_Week"===t?l=7:"Agenda_Month"===t&&(l=30),s=T.a.getTodayPlusDays("Date"===a?l:-(l-1));"Date"===a?this.endDate=s:(this.startDate=s,this.endDate=T.a.getTodayPlusDays(1))}var d=c.default.pluginManager.getPluginGCalendar();this.supportDataRefresh=this.isViewDates()&&d.isOn()&&"Calendars",this.isEditable=this.supportSel=o&&!this.isViewCalendar(),this.orientation.set(this.isViewCalendarHoriz()?"horizontal":"vertical"),"Calendar_Week"===t||"Calendar_Month"===t?(this.minWidthFlex=700,this.maxWidthFlex=1200,this.maxWidthSingle=1600,this.minWidth=600,this.maxWidth=1600):(this.minWidth=b.a.windowWidth(),this.minWidthFlex=this.minWidth,this.maxWidth=this.minWidth,this.maxWidthFlex=this.minWidth),this.dateInMiddle=this._getDateInMiddle(),c.default.PaneManager.updatePaneRects()}},{key:"getPaneClass",value:function(){return"paneTask "+(this.isViewCalendar()&&"paneCalendar c-background"+(this.isViewCalendarMonth()?" calendarMonthView c-bg-app":"")||this.isViewAgenda()&&"paneAgenda"||this.isViewProject()&&"paneProject"||this.isViewTag()&&"paneTag"||this.isViewContact()&&"paneContact"||this.isViewPriority()&&"panePriority"||this.isViewOutline()&&"paneOutline"||"")}},{key:"onScroll",value:function(){this.isViewCalendarHoriz()&&(clearTimeout(this._timeoutUpdateAllDay),this._timeoutUpdateAllDay=setTimeout(this.updateAllDay,50))}},{key:"_handleDragOverPane",value:function(e,t,a,n,r,i,o){if(e&&n&&("blockHeader"===n.type||n.isBlockHeader)&&(this.isViewAgenda()&&e.supportDates||this.isViewAutoBlocks())){var s=n.block;return this.isViewAgenda()&&s.isOverdue&&(s=void 0),this.dragHoveredBlock.set(s),c.default.DragDrop.setBlockTarget(s),{block:s,targetPane:this}}if(!n||"blockItem"===n.type)return this.dragHoveredBlock.set(void 0),this.isViewCalendar()||c.default.DragDrop.setBlockTarget(void 0),this._handleDragOverTasks(t,a,n,r,i,o)}},{key:"_handleDragOverTasks",value:function(e,t,a,n,r,i){var o,s,c,d,h,f,p=!1,g=u.a.DragDropPosition.Below,m=!1,v=0;if(a){o=a.item,f=a.index,o.isNote()&&(f--,a=this.objectAtIndex(f),t=this.elementAtIndex(f),o=o.parent()),o.hasNote()&&(v=o.getNote().sizeInPane(this,f+1));var y=t.getBoundingClientRect(),k=y.height+v,_=this.isViewFlatList()||this.isViewAgenda()||this.isViewAutoBlocks(),b=o.hasText(),w=b?.38:.5;g=_?u.a.DragDropPosition.On:r<=y.top+k*w&&(!this.isViewProject()||0!==a.levelsDeepNew())?u.a.DragDropPosition.Above:r<y.top+k*(1-w)&&(_||b)&&o!==i?u.a.DragDropPosition.On:u.a.DragDropPosition.Below,c=t,p=!0}else if(0===this.numItems()||l.default.hasClass(e,"paneFooter"))o=this.getItem(),m=!0,d=!0;else if(this.isViewFlatList()||!l.default.findParent(e,"paneScroller")||this.isViewProject())if(this.isViewFlatList())o=this.getItem(),m=!0,d=!0;else{var S=this&&this.indexOfFirstItem();if(this&&S>=0)if((h=this.elementAtIndex(S))&&r<h.getBoundingClientRect().top)o=this.getFirstItem(),a=this.getFirstObject(),c=h,g=this.isViewProject()&&0===a.levelsDeepNew()?u.a.DragDropPosition.On:u.a.DragDropPosition.Above,p=!0}else{var D=this.indexOfLastItem();if(!p&&D>=0)if(r>=(h=this.elementAtIndex(D)).getBoundingClientRect().bottom)o=this.getLastItem(),a=this.getLastObject(),c=h,g=u.a.DragDropPosition.Below,p=!0}if(p){l.default.hasClass(c,"itemInPane")&&(c=l.default.findChild(c,"itemInPaneText"));var P,I=c.getBoundingClientRect(),E=g!==u.a.DragDropPosition.Below?I.top:I.top+I.height+v,C=g===u.a.DragDropPosition.On?I.height:void 0;if(E>this.contentTop())g===u.a.DragDropPosition.Below&&f+1<this.numItems()&&o.hasChildren()&&((P=this.objectAtIndex(f+1)).item||(P=void 0)),P=P||a,s={left:I.left,top:E,width:I.right-I.left,height:C}}return this.scrollFromMousePosition(n,r,"horizontal"===this.orientation.get()),{position:g,targetElement:c,targetItem:o,targetPane:this,linePosition:s,overview:!1,dropOnPane:m,atEnd:d}}},{key:"handleDragDrop",value:function(e,t,n,r){var i=this,o=c.default.DragDrop.blockTarget;if(!o)return p()(_()(a.prototype),"handleDragDrop",this).call(this,e,t,n,r);if(!o.date||!e.some((function(e){return e.isRepeatDate()}))){var s=function(){l.applyDropOnBlock(o,e,i,t.dataTransfer.block),i.revertDrag()},l=t.dataTransfer.pane,u=this.getDocument();return this!==l&&this.isViewCalendar()&&!l.isSimplePane&&u!==l.getDocument()?(c.default.menus.confirm("You are dropping onto the calendar of a different document. Do you want to move this item to ".concat(u.text.get(),"?"),(function(a){a&&(i._handleDragDrop(e,t.dataTransfer,{targetPane:i,targetItem:i.getRootItem(),dropOnPane:!0},t,r),s())})),!0):(s(),!0)}c.default.toasts.pushMessage("Moo.do does not yet support moving repeat dates")}},{key:"revertDrag",value:function(){p()(_()(a.prototype),"revertDrag",this).call(this),this.dragHoveredBlock.get()&&this.dragHoveredBlock.set(null)}},{key:"getSaveInfo",value:function(){var e=p()(_()(a.prototype),"getSaveInfo",this).call(this);return e.viewState=this.viewState.get(),e.displayCalendars=this.displayCalendars.get(),e.displayLocalItems=this.displayLocalItems.get(),e.blocksCollapsed=this.blocksCollapsed,e}},{key:"isBlockCollapsed",value:function(e){return e.item?e.item.isCollapsed(this):this.blocksCollapsed[e.id]}},{key:"setBlockCollapsed",value:function(e,t){w.a.reset(),this.blocksCollapsed[e.id]=t,this.updateCollapsedObs(),this.updateBlockItems(),c.default.PaneManager.savePaneState()}},{key:"addProject",value:function(e,t,a){return this.addItem({index:e,prefix:u.a.Prefix.Header,text:t,toRoot:a})}},{key:"onTapAddItem",value:function(){var e=this;if(this.isOverviewVisible())p()(_()(a.prototype),"onTapAddItem",this).call(this);else{var t;1===this.search.getFilterValue("project")?t=u.a.Prefix.Header:1===this.search.getFilterValue("task")&&(t=u.a.Prefix.Task);var n=function(){e.addItem({index:0,prefix:t})};b.a.app?(this.scrollIndexToTop(0,"smooth"),setTimeout(n,this.listManager.getScrollOffset()>300?200:0)):n()}}},{key:"addItem",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=t.index,n=t.prefix,r=t.text,i=t.toRoot;a=a||0,r=r||"",void 0===n&&(n=c.default.settings.getDefaultItemText()),c.default.PaneUpdateBatcher.beginUpdateItems(),w.a.reset(),this.setIgnoreRestoreScroll();var o=i?this.getRootItem():this.getItem(),s={text:(n?n+" ":"")+r};this.isViewAgenda()&&(s.text=" "+u.a.CharDate,s.date=(new Date).clearTime()),1===this.search.getFilterValue("complete")&&(s.isComplete=!0),1===this.search.getFilterValue("starred")&&(s.isStarred=!0);var d=this.search.getFilterValue("priority");d&&(s.priority=d);var h=o.addItemAtIndex(s,a,this);if(this.isViewProject()&&n===u.a.Prefix.Header){var f=c.default.settings.getDefaultItemText();h.addItemAtIndex({text:f},a,this)}if(w.a.setFocusedPane(this),a>=0);c.default.PaneUpdateBatcher.commitUpdateItems();var p=this.indexOfItem(h);return p>=0&&(this.scrollIndexIntoView(p),w.a.selectIndex(p,0),b.a.isiOS&&!b.a.app&&(requestAnimationFrame((function(){e.scrollIndexIntoView(p)})),setTimeout((function(){w.a.selectIndex(p,0),e.scrollIndexIntoView(p)}),100))),l.default.sendEvent("Menu","AddItemButton"),h}},{key:"setDisplayLocal",value:function(e){this.displayLocalItems.set(e),this.updateItems()}},{key:"setDisplayCalendar",value:function(e,t){var a=l.default.clone(this.displayCalendars.get());a[e.id]=t,this.displayCalendars.set(a),this.updateItems()}},{key:"getCollapsedDefault",value:function(e,t){return t?e!==this.getRootItem():this.isViewOutline()?void 0:this.isViewProject()?!this.isItemTopLevel({item:e,isBlockHeader:e.isPrefixHeader()}):e.hasChildren()}},{key:"getWidthExtra",value:function(){if(this.isViewCalendar()&&!this.isViewCalendarMonth())return-u.a.CalendarTimesWidth}},{key:"getMonthStart",value:function(e){return T.a.getDatePlusDays(T.a.clearTime(e),1-e.getDate())}},{key:"getWeekStart",value:function(e){var t=T.a.clearTimeClone(e).previous();return 1===c.default.settings.dayWeekStart.get()?t.monday():t.sunday()}},{key:"doesWeekCrossMonth",value:function(e){if(e.clone().addDays(6).getDate()<e.getDate())return!0}},{key:"updateCalendarMonth",value:function(){var e,t,a,n=0,r=0,i=[],o=this.dateInMiddle,s=this.getWeekStart(o),l=u.a.CalendarMonthViewNumWeeksPad;for(a=0;a<=l;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var c=-l-1+a;e=s.clone().addWeeks(c),(t=this.doesWeekCrossMonth(e))&&i.push(this.updateCalendarMonthWeek(i.length,e,!0,!1)),i.push(this.updateCalendarMonthWeek(i.length,e,!1,t))}for(l=2*u.a.CalendarMonthViewNumWeeksPad+1,a=0;i.length<l;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e=s.clone().addWeeks(a),(t=this.doesWeekCrossMonth(e))&&i.length<l&&i.push(this.updateCalendarMonthWeek(i.length,e,!0,!1)),i.push(this.updateCalendarMonthWeek(i.length,e,!1,t))}this.items.set(i)}},{key:"updateCalendarMonthWeek",value:function(e,t,a,n){for(var r,i,o=0,s=[],l=1===t.getDate(),u=0;u<7;u++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var c=t.clone().addDays(u);r&&c.getDate()<r.getDate()&&(l=!0),!l&&n||l&&a||(s[u]={date:c,items:this.getItemsOnDate(c)},i||(i=c)),r=c}return new E.a({type:"calendarWeek",id:"week_"+t+(a?"_end":""),pane:this,date:i,dates:s,sizeInPane:this.heightWeek(),index:e})}},{key:"heightWeek",value:function(){return u.a.CalendarMonthViewWeekHeight}},{key:"updateCalendarWeek",value:function(){for(var e=0,t=[],a=u.a.CalendarDayViewNumDaysPad,n=this.dateInMiddle,r=this.getViewMode(),i=-a;i<a;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=n.clone().addDays(i),s=this.getItemsOnDate(o);t.push(new E.a({type:"calendarDay",id:r+"_day_"+(i+a),pane:this,date:o,items:s,sizeInPane:this.getDayWidth}))}this.items.set(t)}},{key:"getDatePlacementOnDate",value:function(e,t){var a=e.getHours()+e.getMinutes()/60,n=t?t/u.a.MSPerHour:1;if(n=Math.round(10*Math.min(n,24-e.getHours()))/10,a>0||n<24)return{time:a,duration:n}}},{key:"getItemPlacementOnDate",value:function(e,t){var a=!e.getDate(),n=e.getNextDate(t),r=e.getDuration()&&n&&e.getEndDate();if(n&&n.hasTimeOfDay()){if(a||T.a.isSameDay(n,t))return this.getDatePlacementOnDate(n,e.getDuration());if(r&&!T.a.isSameDay(n,t)&&T.a.isSameDay(r,t))return{time:0,duration:r.getHours()+r.getMinutes()/60};if(r&&!T.a.isSameDay(n,t)&&!T.a.isSameDay(r,t))return{time:0,duration:u.a.MSPerDay}}return!1}},{key:"numCalendarDaysInView",value:function(){var e=this.getViewMode();return("Calendar_Week"===e?7:"Calendar_Day"===e&&1)||"Calendar_Custom"===e&&c.default.settings.calendarCustomDays.get()||0}},{key:"updateAllDay",value:function(){if(!this._destroyed){for(var e=0,t=this.indexOfTop(),a=this.numCalendarDaysInView(),n=1,r=t;r<t+a;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=this.items.get()[r];if(i){for(var o=0,s=0,l=i.items||[],u=0;u<l.length;u++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var c=l[u];this.getItemPlacementOnDate(c,i.date)||s++}s>n&&(n=s)}}this.numAllDay.set(n)}}},{key:"getContentHeight",value:function(){return 1224+this.getHeightAllDay()+2}},{key:"getHeightAllDay",value:function(){return Math.min(u.a.CalendarDayViewMaxAllDayHeight,26*this.numAllDay.get())+1}},{key:"getDayViewY",value:function(){return 409}},{key:"getDayWidth",value:function(){var e=this.getWidth(),t=this.getViewMode(),a=("Calendar_Day"===t?1:"Calendar_Week"===t&&7)||"Calendar_Custom"===t&&c.default.settings.calendarCustomDays.get();return Math.max(e/a,40)}},{key:"extraPaddingForPaneObject",value:function(e){return this.isViewAgenda(),0}},{key:"shouldShowTime",value:function(e){var t="blockItem"===e.type&&e.item;return t&&!t.isNote()&&0===e.levelsDeepNew()&&e.block&&e.block.shouldShowTime()}},{key:"isItemTopLevel",value:function(e){var t=e.item,n=!0;if(this.isViewProject()){if(e)return e.isBlockHeader;n=t.isPrefixHeader()}return this.isViewProject()&&this.search.showChildProjects()||(n=p()(_()(a.prototype),"isItemTopLevel",this).call(this,e)),n}},{key:"calculateHasCollapsed",value:function(e){if(!e&&this.isViewAutoBlocks()){for(var t=0,a=0;this.blocks&&a<this.blocks.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.isBlockCollapsed(this.blocks[a]))return!0}return!1}}},{key:"toggleCollapseAll",value:function(){var e=!this.hasCollapsed();if(this.blocksCollapsed["__block_nokey_"+this.getViewMode()]=e,this.isViewAutoBlocks()){for(var t=0,n=0;n<this.blocks.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.blocksCollapsed[this.blocks[n].id]=e}e||(e=void 0),this.updateCollapsedObs()}p()(_()(a.prototype),"collapseAll",this).call(this,this.item.get(),e,void 0)}},{key:"getSupportedSortBlocksModes",value:function(){return N[this.getViewMode()].Available}},{key:"supportsSortBlocks",value:function(e){return e=e||this.getViewMode(),a.viewModeSupportsSortBlocks(e)}},{key:"supportsSortBlocksMode",value:function(e,t){return t=t||this.getViewMode(),a.viewModeSupportsSortBlocksMode(e,t)}},{key:"supportsSortItems",value:function(e){return e=e||this.getViewMode(),a.viewModeSupportsSortItems(e)||this.isViewFlatList()}},{key:"getSortModeBlocks",value:function(){if(this.supportsSortBlocks())return this.viewState.get().sortModeBlocks.mode}},{key:"getSortOrderBlocks",value:function(){if(this.supportsSortBlocks())return this.viewState.get().sortModeBlocks.order||1}},{key:"isSortedBlocks",value:function(){var e=this.getSortModeBlocks();return e&&"None"!==e}},{key:"setSortModeBlocks",value:function(e,t,a){this.setViewProp("sortModeBlocks",{mode:e,order:t},a)}},{key:"getSortModeItems",value:function(){if(this.supportsSortItems())return this.viewState.get().sortModeItems.mode}},{key:"getSortOrderItems",value:function(){if(this.supportsSortItems())return this.viewState.get().sortModeItems.order||1}},{key:"setSortModeItems",value:function(e,t,a){this.setViewProp("sortModeItems",{mode:e,order:t},a)}},{key:"isSortedItems",value:function(){var e=this.getSortModeItems();return e&&"None"!==e}},{key:"getViewMode",value:function(){return this.viewState.get().viewMode}},{key:"setViewMode",value:function(e){this.setViewProp("viewMode",e)}},{key:"setViewProp",value:function(e,t,a){var n=this.viewState.get();if(n[e]!==t){var r=l.default.clone(n);r[e]=t,this.viewState.set(r,!1!==a)}}},{key:"createVMLI",value:function(e,t){var n=this.search.getTags();if(!this.isViewTag()&&n)for(var r=0,i=0;i<n.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=n[i],s="#"+o;if(e.text.indexOf(s)<0){for(var l=0,u=!1,c=t&&t.parent;c;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var d=c.getTags();if(d&&d.indexOf(o)>=0){u=!0;break}c=c.parent()}u||(e.text+=" "+s)}}return p()(_()(a.prototype),"createVMLI",this).call(this,e,t)}},{key:"getItemDisplayTime",value:function(e){var t=this.getSortModeBlocks(),a=e.item;return"Date"===t?a.getTime()||(e.showAllDay?"All day":""):"Created"===t?a._formatDateTime(a.dateCreated):"Completed"===t?a.dateCompleted?a._formatDateTime(a.dateCompleted):"no time":"Modified"===t?a.dateModified?a._formatDateTime(a.dateModified):"no time":void 0}},{key:"onCalendarCustomDaysChanged",value:function(){"Calendar_Custom"===this.getViewMode()&&this.onViewStateChanged()}},{key:"switchToOutline",value:function(){this.setViewMode("Outline")}},{key:"shouldRenderPrefix",value:function(e){return!(this.isViewProject()&&e.isBlockHeader)}},{key:"bottomListMessage",value:function(){var e;if(!(this.numItems()>0)){var t=this.search.numUnmatchedItems();t&&(e=this.isSearched()?t+" items hidden by search / filters. Click the search box above to clear your search / filters, or click to add new items.":t+" completed items hidden by filter. Click the search box above and click the checkbox filter to show completed items.")}return{text:e,clickable:!1}}},{key:"needsUpdateForDate",value:function(){return this.isViewDates()}},{key:"needsUpdateForRepeatDateCompleted",value:function(){return!1}},{key:"needsUpdateForPriority",value:function(){return this.isViewPriority()||this.isViewAgenda()}},{key:"needsUpdateForModified",value:function(){return"Modified"===this.getSortModeBlocks()||"Modified"===this.getSortModeItems()}},{key:"_anyTagHasKey",value:function(e){return e&&e.some((function(e){return c.default.timeline.getDateForKey("#"+e)}))}},{key:"needsUpdateForTags",value:function(e){return this.isViewAgenda()&&this._anyTagHasKey(e)}},{key:"handleItemChanged",value:function(e,t){var n=!1;return(t.Tags&&this.isViewTag()||t.Text&&this.isViewContact())&&(n=!0),p()(_()(a.prototype),"handleItemChanged",this).call(this,e,t,n)}},{key:"setDocument",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.zoomItem,r=t.forLoad;p()(_()(a.prototype),"setDocument",this).call(this,e,{zoomItem:n,forLoad:r,noUpdateItems:!0}),this.onViewStateChanged()}},{key:"getItem",value:function(e){var t=this.getDocument();return e||this.isViewItems()?p()(_()(a.prototype),"getItem",this).call(this):this.isViewArchived()?t.getRootArchivedItem():this.isViewDeleted()?t.getRootDeletedItem():void 0}},{key:"getRootItem",value:function(){var e=this.getDocument();return this.isViewArchived()?e.getRootArchivedItem():this.isViewDeleted()?e.getRootDeletedItem():p()(_()(a.prototype),"getRootItem",this).call(this)}},{key:"handleRightSideTap",value:function(e){this.isViewArchived()?(e.unArchive(u.a.ChangeType.Local),w.a.reset()):this.isViewDeleted()?(e.unDelete(u.a.ChangeType.Local),w.a.reset()):p()(_()(a.prototype),"handleRightSideTap",this).call(this,e)}},{key:"getNewViewMode",value:function(){return this.isViewCalendar()?"Calendar":this.isViewArchived()?"Archived":this.isViewDeleted()?"Deleted":this.isViewAgenda()?"Agenda":this.search.showHierarchy()?"Outline":"List"}},{key:"getNewViewGroup",value:function(){if(!this.isViewCalendar()){var e=this.getViewMode(),t=("Groups_Project"===e?"Project":"Groups_Tag"===e&&"Tag")||"Groups_Contact"===e&&"Contact"||"Groups_Priority"===e&&"Priority"||this.isViewAgenda()&&"Agenda"||"None";if("Agenda"===t){var a=this.getSortModeBlocks();"Created"===a?t="Created":"Modified"===a?t="Modified":"Completed"===a?t="Completed":this.search.showOnlyAgendaDates()&&(t="Date")}return t}}},{key:"setGroupMode",value:function(e){var t="Created"===e||"Modified"===e||"Completed"===e,a=("None"===e?"Outline":"Project"===e&&"Groups_Project")||"Tag"===e&&"Groups_Tag"||"Contact"===e&&"Groups_Contact"||"Priority"===e&&"Groups_Priority"||("Agenda"===e||"Date"===e||t)&&"Agenda_All",n=t?e:"None";O.a.beginBatch(),this.setViewMode(a),"Date"===e!==this.search.showOnlyAgendaDates()&&this.search.setFilter("showOnlyAgendaDates","Date"===e),this.setSortModeBlocks(n,1),O.a.endBatch()}},{key:"setSortBlocks",value:function(e){var t=this.getSortOrderBlocks();this.getSortModeBlocks()===e&&(t=-this.getSortOrderBlocks()),this.setSortModeBlocks(e,t)}},{key:"setSortItems",value:function(e){var t=this.getSortOrderItems();this.getSortModeItems()===e&&t>0&&(t=-this.getSortOrderItems()),this.setSortModeItems(e,t)}},{key:"getSortModeBlocksText",value:function(){return u.a.TaskSortModeText[this.getSortModeBlocks()]}},{key:"getSortModeItemsText",value:function(){return u.a.TaskSortModeText[this.getSortModeItems()]}},{key:"scrollToMiddle",value:function(e){var t=this.indexOfItem(e);if(t<0&&e.isDescendantOf(this.item.get())&&this.search.isMatched(e)){var a=0;c.default.PaneUpdateBatcher.beginUpdateItems();for(var n=e.parent();n&&n!==this.item.get();){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n.isCollapsed(this)&&(this.setIgnoreRestoreScroll(),n.setCollapsed(!1,this)),n=n.parent()}c.default.PaneUpdateBatcher.commitUpdateItems(),t=this.indexOfItem(e)}t>=0&&this.scrollIndexToMiddle(t,"smooth")}},{key:"updateCollapsedObs",value:function(e){this.isViewAutoBlocks()&&(e=this.calculateHasCollapsed()),e=e||this.blocksCollapsed["__block_nokey_"+this.getViewMode()],p()(_()(a.prototype),"updateCollapsedObs",this).call(this,e)}},{key:"canCollapse",value:function(){return!(this.isViewFlatList()&&"None"===this.getNewViewGroup())}},{key:"updateItemsImmediate",value:function(e,t,n,r){if(this.document.get()&&!this.document.get().isDeleted.get())return p()(_()(a.prototype),"updateItemsImmediate",this).call(this,e,t,n,r)}},{key:"updateHeadersOverride",value:function(){var e=this,t=[];return D.a.getDocumentsArray().forEach((function(a){var n=a.getRootItem();if(t.push(n),!n.isCollapsed(e,!0)){var r={item:a.getRootItem(),noCollapsed:!0,collapseAfterDepth:1,headers:!0,overview:!0,pane:e,each:function(e){e.isComplete()||t.push(e)}};l.default.searchVMLIs(r)}})),t}},{key:"zoomIn",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};e.getDocumentOwner()?p()(_()(a.prototype),"zoomIn",this).call(this,e,t):c.default.toasts.pushMessage("Cannot zoom into calendar events.")}},{key:"canZoomToItem",value:function(e){return e.getDocumentOwner()?p()(_()(a.prototype),"canZoomToItem",this).call(this,e):(c.default.toasts.pushMessage("Cannot zoom into calendar events."),!1)}},{key:"getMobileIcon",value:function(){return this.isViewCalendar()?"IoIosCalendar":this.isViewArchived()?"MdArchive":this.isViewDeleted()?"IoMdTrash":this.isViewAgenda()?"MdToday":this.search.showHierarchy()?"MdFormatListBulleted":"MdReorder"}}],[{key:"viewModeSupportsSortBlocks",value:function(e){return!!N[e]}},{key:"viewModeSupportsSortBlocksMode",value:function(e,t){return N[t]&&N[t].Available.indexOf(e)>=0}},{key:"viewModeSupportsSortItems",value:function(e){return"Groups_Project"===e||"Groups_Tag"===e||"Groups_Contact"===e||"Groups_Priority"===e}}]),a}(L.a),j=a(42),U=function(){function e(){i()(this,e),this._inactivePaneTypes={},this.activePaneTypes=new j.a,this._registeredTypes={},this.numInactivePanes=new I.a(0),this.registerPaneType(void 0,u.a.PaneMode.Task,"Task",B,"icon-align-left",99)}return s()(e,[{key:"paneSortCompare",value:function(e,t){return e.priority<t.priority?1:-1}},{key:"registerPaneType",value:function(e,t,a,n,r,i){this._registeredTypes[t]={plugin:e,constructor:n};var o={type:t,name:a,icon:r,text:a,priority:i,tooltip:"Add "+a+" Pane"};!e||e.isActive()?this.activePaneTypes.insertSorted(o,this.paneSortCompare):(this._inactivePaneTypes[t]=o,this.numInactivePanes.set(this.numInactivePanes.get()+1))}},{key:"activatePaneType",value:function(e){var t=this._inactivePaneTypes[e];try{l.default.PAssert(491,t,"Must have previously registered pane type")}catch(a){l.default.reportError(a)}this._inactivePaneTypes[e]=void 0,this.activePaneTypes.insertSorted(t,this.paneSortCompare),this.numInactivePanes.set(this.numInactivePanes.get()-1)}},{key:"deactivatePaneType",value:function(e){var t=this.activePaneTypes.get().find((function(t){return t.type===e}));this.activePaneTypes.remove((function(t){return t.type===e}));try{l.default.PAssert(492,t,"Must have previously activated pane type")}catch(a){l.default.reportError(a)}c.default.PaneManager.removePanesByType(e),this._inactivePaneTypes[e]=t,this.numInactivePanes.set(this.numInactivePanes.get()+1)}},{key:"canCreatePane",value:function(e){var t=this._registeredTypes[e],a=t.plugin;return a&&!t.plugin.isActive()?"the ".concat(a.name," plugin is not active."):!a||!t.plugin.isPluginBlocked()||"the ".concat(a.name," pane is a premium feature.")}},{key:"createPane",value:function(e,t){(t=t||{}).id||(t.id=c.default.PaneManager.getNextPaneID()),"PaneTimeline"===e?(e=u.a.PaneMode.Task,t.viewState={viewMode:"Agenda_All"}):"PaneOutline"===e?(e=u.a.PaneMode.Task,t.viewState={viewMode:"Outline"}):"PaneArchived"===e&&(e="PaneTask",t.viewState={viewMode:"Archived"});var a=this._registeredTypes[e];if(a){if(!a.plugin||a.plugin.isActive()&&!a.plugin.isPluginBlocked())try{c.default.PaneUpdateBatcher.beginUpdateItems();var n=a.constructor.getPluginID();if(n)c.default.pluginManager.getPlugin(n).onPaneActivated();var r=new a.constructor(t);return c.default.PaneUpdateBatcher.commitUpdateItems(),r}catch(i){return void l.default.reportError(i)}}else try{l.default.PAssert(493,!1,"Invalid pane type requested")}catch(o){l.default.reportError(o)}}},{key:"isPaneTypeActive",value:function(e){var t=!!this._registeredTypes[e],a=!!this._inactivePaneTypes[e];return t&&!a}},{key:"getRegisteredPanes",value:function(){return this.activePaneTypes.get()}},{key:"_getTaskView",value:function(e,t,a,n){for(var r=0,i=[],o=0;o<a.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=a[o],l=u.a.TaskViewModeText[s];"Calendar_Custom"===s&&(l=l.replace("#",c.default.settings.calendarCustomDays.get())),i.push({text:l,type:u.a.PaneMode.Task,viewMode:s,icon:u.a.TaskViewModeIcon[s],premium:!!u.a.TaskViewModesPremium[s],canZoom:!0})}e.push({text:t,viewModes:i,border:!n})}},{key:"getAvailablePanes",value:function(e){var t=this.activePaneTypes.get(),a=this.numInactivePanes.get(),n=[];if(this._getTaskView(n,"List",["Outline","List_Flat","Archived","Deleted"]),this._getTaskView(n,"Grouped by",["Groups_Project","Groups_Tag","Groups_Contact","Groups_Priority"]),this._getTaskView(n,"Agenda",["Agenda_Today","Agenda_Week","Agenda_Month","Agenda_All"]),this._getTaskView(n,"Calendar",["Calendar_Day","Calendar_Custom","Calendar_Week","Calendar_Month"],e),!e){for(var r=0,i=0;i<t.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=t[i];if(o.type!==u.a.PaneMode.Task){var s=o.type===u.a.PaneMode.Gmail;n.push({text:o.text,type:o.type,icon:o.icon,canZoom:s,border:!0})}}n[n.length-1].border=!1,a>0&&n.push({enableMore:!0})}return n}}]),e}();t.a=new U},,function(e,t,a){"use strict";var n,r=a(84),i=a.n(r),o=a(7),s=a.n(o),l=a(8),u=a.n(l),c=a(20),d=a.n(c),h=a(21),f=a.n(h),p=a(13),g=a.n(p),m=a(10),v=a.n(m),y=a(11);function k(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=g()(e);if(t){var r=g()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return f()(this,a)}}var _=(n=function(e){d()(a,e);var t=k(a);function a(e,n,r){var o,l,u=0;s()(this,a),l=t.call(this,void 0,r);for(var c=0;c<e.length;c++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;e[c].listen(l.onChanged)}return l._observables=e,l.checkFn=n,l._value=(o=l).checkFn.apply(o,i()(l._observables.map((function(e){return e.get()})))),l}return u()(a,[{key:"onChanged",value:function(e,t,a){var n=this._value,r=this.checkFn.apply(this,i()(this._observables.map((function(e){return e.get()}))));(r!==n||a)&&this.set(r,a)}}]),a}(a(15).a),v()(n.prototype,"onChanged",[y.a],Object.getOwnPropertyDescriptor(n.prototype,"onChanged"),n.prototype),n);t.a=_},,function(e,t,a){"use strict";var n=a(5),r=a.n(n),i=a(12),o=a.n(i),s=a(7),l=a.n(s),u=a(8),c=a.n(u),d=a(20),h=a.n(d),f=a(21),p=a.n(f),g=a(13),m=a.n(g),v=a(0),y=/^<(.*)>$/,k=/^[^:]+(?=:)/,_=0,b={Default:{bannedTags:["style","script","source","track","iframe","frame","frameset","button","input","audio","video","math","svg","link","comment","base","object","embed"],allowedAttributes:["abbr","accept","acceptcharset","accesskey","align","alt","async","autocomplete","axis","background","border","bordercolor","bgcolor","cellpadding","cellspacing","char","charoff","charset","checked","cid","class","classid","classname","color","colspan","cols","content","contextmenu","controls","coords","data","datetime","defer","dir","disabled","download","draggable","enctype","form","formaction","formenctype","formmethod","formnovalidate","formtarget","frame","frameborder","headers","height","hidden","high","href","hreflang","htmlfor","httpequiv","icon","itemscope","itemtype","itemid","itemprop","itemref","label","lang","list","loop","low","manifest","marginheight","marginwidth","max","maxlength","media","mediagroup","method","min","multiple","muted","name","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","radiogroup","readonly","rel","required","role","rowspan","rows","rules","sandbox","scope","scoped","scrolling","seamless","selected","shape","size","sizes","sortable","sorted","span","spellcheck","src","srcdoc","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","valign","value","width","wmode"],allowedTagAttributes:{A:["href","name"],IMG:["src","alt"],FONT:["face"],HTML:["xmlns"],BODY:["text","link","alink","vlink"],META:["http-equiv"],VAR:["id"]}}},w=function(){function e(t,a){l()(this,e),this._reportError=t,this._assert=a}return c()(e,[{key:"update",value:function(e){var t,a=e.decoded,n=e.resources,r=e.options,i=e.mimeType;return this._assert(n,"Must supply a valid resource lib"),this._assert(r,"Must supply a valid options obj"),"text/plain"===i?t=this._parsePlain(a):"text/html"===i?t=this._parseHTML(a,n,r):this._reportError(new Error("Unknown email mimeType"),"Unknown email mimeType: "+i),t?t.parsed=this._escapeHTMLEntities(t.parsed):t={parsed:void 0,missingResourceData:!0},t}},{key:"getAttachmentLinks",value:function(e){var t=e.decoded,a=e.options,n=[],r=this._createDoc(t);if(r){var i=this._findLinkElements(r),o=this._findQuoteElements(r);try{n=this._findSpecialLinks(i,o,a).attachments}catch(s){this._reportError(s)}}return n}},{key:"generatePlaintext",value:function(e){var t=e.decoded;return this._createDoc(t).body.textContent}},{key:"replaceSignature",value:function(e){var t,a=e.decoded,n=e.newSignature,r=this._createDoc(a),i=this._findActiveSignature(r);if(i){var o=!!i.innerHTML;if(i.innerHTML=n||"",n)o||(i.parentNode.insertBefore(r.createElement("br"),i),i.parentNode.insertBefore(r.createElement("br"),i),i.parentNode.insertBefore(r.createTextNode("--"),i),i.parentNode.insertBefore(r.createElement("br"),i));else{var s=i.previousSibling;if(s&&"BR"===s.nodeName){var l=s.previousSibling;if(l&&3===l.nodeType&&"--"===l.textContent){var u=l.previousSibling;if(u){var c=u.previousSibling;"BR"===u.nodeName&&(u.parentElement.removeChild(u),c&&"BR"===c.nodeName&&c.parentElement.removeChild(c))}s.parentElement.removeChild(s),l.parentElement.removeChild(l)}}}t=r.body.outerHTML}else t=a;return t}},{key:"combineParts",value:function(e){var t=e.partList;this._assert(this._isArray(t)&&t.length>0,"Must always supply a valid part list with contents");var a=this._createDoc("<head></head><body></body>");if(this._assert(a,"Must always be able to create a valid document for first part in list"),a)for(var n=0,r=0;r<t.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=this._ensurePartDoc(t[r]);if(i)try{this._mergeDocs(i,a)}catch(o){this._reportError(o)}}return a?a.body.outerHTML:" "}},{key:"removeElementsByAttribute",value:function(e){var t=e.decoded,a=e.attr,n=e.value;this._assert(this.isString(t),"Must pass in a valid decoded HTML email string"),this._assert(this.isString(a),"Must provide a valid item ID");var r=!1;try{var i=this._createDoc(t);i&&(r=this._removeElementsByAttribute(i,a,n))}catch(o){this._reportError(o)}return r?i.body.outerHTML:t}},{key:"sanitizeContent",value:function(e){var t,a=e.decoded;if(a){var n=this._createDoc(a);try{var r=n.body;this._traverseNode(r,(function(e){e.nodeType===Node.TEXT_NODE?e.textContent=new Array(e.textContent.length+1).join("#"):"A"===e.nodeName&&e.removeAttribute("href")})),t=r.outerHTML}catch(i){this._reportError(i),t="<<SANITIZED>>"}}else t="<<NO HTML CONTENT>>";return t}},{key:"getComposeBody",value:function(e){var t=e.decoded,a=e.resources,n=!1;try{var r=this._createDoc(t);if(r){n=this._removeElementsByAttribute(r,"moodoAttach","true");var i=this._updateResourceImages(r,a);n=n||i.didUpdate}}catch(o){this._reportError(o)}return n?r.body.outerHTML:t}},{key:"parseResourceID",value:function(e){var t;y.lastIndex=0;var a=y.exec(e);return a&&a[1]&&(t=a[1]),t}},{key:"_escapeHTMLEntities",value:function(e){return e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,(function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"})).replace(/[\x01-\t\x0B\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,(function(e){return"&#x"+e.charCodeAt(0).toString(16).toUpperCase()+";"}))}},{key:"_ensurePartDoc",value:function(e){var t;switch(e.mimeType){case"text/plain":t=this._createDoc(this._parsePlain(e.decoded).parsed);break;case"text/html":t=this._createDoc(e.decoded);break;default:this._assert(!1,"Unknown display part mimeType: "+e.mimeType)}return t}},{key:"_hasClass",value:function(e,t){return e.classList.contains(t)}},{key:"_mergeDocs",value:function(e,t){var a=e.body,n=t.body;if(a){var r=t.importNode(a,!0),i=t.createElement("div");try{for(var o=0,s=0;s<r.attributes.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l=r.attributes[s];i.setAttribute(l.name,l.value)}}catch(c){this._reportError(c)}try{for(var u=0;r.childNodes&&r.childNodes.length>0;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;i.appendChild(r.firstChild)}}catch(c){this._reportError(c)}try{n.appendChild(i)}catch(c){this._reportError(c)}}}},{key:"_removeElementById",value:function(e,t){var a=!1,n=e.getElementById(t);return n&&(n.parentNode.removeChild(n),a=!0),a}},{key:"_removeElementsByAttribute",value:function(e,t,a){var n,r=0,i=!1;n=void 0!==a&&null!==a?e.querySelectorAll("["+t+'="'+a+'"]'):e.querySelectorAll("["+t+"]");for(var o=0;o<n.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=n[o];s.parentNode.removeChild(s),i=!0}return i}},{key:"_createFragment",value:function(){return{lines:[],isQuote:!1}}},{key:"_createPlainFragments",value:function(e){var t=0,a=[],n=e.split("\n"),r=this._createFragment();a.push(r);for(var i=0;i<n.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=n[i].trim(),s=new RegExp(/^>+/).test(o);r.lines.length>0&&s!==r.isQuote&&""!==o&&(r=this._createFragment(),a.push(r)),r.lines.push(o),r.isQuote=r.isQuote||s}return a}},{key:"_getFragmentText",value:function(e){var t,a,n=0,r="";if(e.isQuote){var i=this._generatePlaceholderID();t='<div id="'+i+'" place="true"></div><p quote="collapsed" group="'+i+'">',a="</p>"}else t="",a="";for(var o=0;o<e.lines.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;r+=e.lines[o]+"\n"}return t+r+a}},{key:"_joinPlainFragments",value:function(e){for(var t=0,a="",n=0;n<e.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[n];a+=this._getFragmentText(r)}return a}},{key:"_parsePlain",value:function(e){var t,a=this._escapeHTMLEntities(e),n=this._createPlainFragments(a);try{t=this._joinPlainFragments(n);t=t.replace(/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gm,'<a mlink="true" href="$1">$1</a>')}catch(r){this._reportError(r),t="There was an error loading this message."}return{parsed:'<html><head></head><body style="white-space: pre-wrap;">'+t+"</body><html>"}}},{key:"_parseHTML",value:function(e,t,a){var n={parsed:void 0},r=this._createDoc(e),i=this._findQuoteElements(r);if(i=this._cleanupDocQuotes(r,i),this._isFullQuote(r,i)||this._collapseAndMarkQuotes(r,i,!!a.collapseQuotes),a.createLinksFromText)try{this._createLinksFromText(r)}catch(d){this._reportError(d)}var o=this._findLinkElements(r);this._markLinks(o);try{n.specialLinks=this._findSpecialLinks(o,i,a)}catch(d){this._reportError(d)}try{n.parsedMetadata=this._parseMetadata(r)}catch(d){this._reportError(d)}try{var s=this._updateResourceImages(r,t);n.missingResourceData=s.missingData}catch(d){this._reportError(d)}if(this._trimTrailingWhitespace(r),this._trimQuoteWhitespace(i),n.parsed=r.body.outerHTML,r.head.childElementCount>0)for(var l=0,u=r.head.getElementsByTagName("style"),c=0;c<u.length;c++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;u[c]&&(n.parsed="<style>".concat(u[c].innerText,"</style>")+n.parsed)}return n}},{key:"_traverseNode",value:function(e,t){if(!1!==t(e)&&e.childNodes)for(var a=0,n=e.childNodes.length-1;n>=0;n--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;this._traverseNode(e.childNodes[n],t)}}},{key:"_sanitizeInputDoc",value:function(e,t){var a=this,n=b[t],r=e.body;r&&this._traverseNode(r,(function(e){if(e.nodeType===Node.COMMENT_NODE)a._assert(!e.childNodes||0===e.childNodes.length,"A comment node should never have children"),e.parentNode.removeChild(e);else if(e.nodeType===Node.TEXT_NODE);else if(n.bannedTags.indexOf(e.tagName.toLowerCase())>=0)e.parentNode.removeChild(e);else if(e.attributes.length>0){for(var t=0,r=n.allowedTagAttributes[e.tagName],i=e.attributes.length-1;i>=0;i--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=e.attributes[i].name;if(n.allowedAttributes.indexOf(o)<0&&(!r||r.indexOf(o)<0))e.removeAttribute(o);else{var s=e.getAttribute(o);s&&s.startsWith("javascript:")&&(console.log("Remove Inline JS: ",e.tagName,o),e.removeAttribute(o))}}var l=e.getAttribute("height");l&&l.indexOf("%")>=0&&e.removeAttribute("height")}}))}},{key:"_createDoc",value:function(e){var t,a=new DOMParser;try{if(t=a.parseFromString(e,"text/html")){var n=this._parseJSONLD(t);this._sanitizeInputDoc(t,"Default"),n&&n.length>0&&this._reportMetadata(t,n)}}catch(r){this._reportError(r);try{t=a.parseFromString("Error parsing email message","text/html")}catch(i){this._reportError(i)}}return t}},{key:"_updateResourceImages",value:function(e,t){for(var a=0,n={missingData:!1,didUpdate:!1},r=this._findImageElements(e),i=0;i<r.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=r[i],s=o.src;if(s.startsWith("cid:")){var l=s.substr(4);if(l){o.setAttribute("cid",l);var u=t[l];if(u&&u.data){var c="data:"+u.mimeType+";base64,"+u.data;o.src=c,n.didUpdate=!0}else o.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",n.didUpdate=!0,u||(n.missingData=!0)}else o.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",n.didUpdate=!0}}return n}},{key:"_findImageElements",value:function(e){return e.querySelectorAll("img")}},{key:"_findLinkElements",value:function(e){return Array.prototype.slice.call(e.querySelectorAll("a"))}},{key:"_sanitizeLink",value:function(e){if(e&&e.hasAttribute("href")){e.setAttribute("mlink","true");var t=e.getAttribute("href");if(t.startsWith("file:"))e.setAttribute("href","");else k.exec(t)||e.setAttribute("href","https://"+t)}}},{key:"_createLinksFromText",value:function(e){var t=e.body;this._traverseNode(t,(function(t){var a=!0;if(t.nodeType===Node.TEXT_NODE){var n=t.textContent;if(n.indexOf("http")>=0||n.indexOf("www.")>=0){var r=/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gm,i=t.textContent.replace(r,'<a href="$1">$1</a>'),o=e.createElement("div");o.innerHTML=i;var s=o.childNodes?o.childNodes.length:0;if(s>1||1===s&&"A"===o.childNodes[0].nodeName){for(var l=0;o.firstChild;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;t.parentNode.insertBefore(o.firstChild,t)}t.parentNode.removeChild(t)}}}else"A"===t.tagName&&(a=!1);return a}))}},{key:"_markLinks",value:function(e){for(var t=0,a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._sanitizeLink(e[a])}}},{key:"_isAttachmentURL",value:function(e){return!!/^https:\/\/drive.google.com\/file\/d\/.*\/view/g.exec(e)}},{key:"_findSpecialLinks",value:function(e,t,a){for(var n=0,r={unsubscribe:[],twitter:[],attachments:[]},i=0;i<e.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=e[i];o.href&&this._isAttachmentURL(o.href)&&(a.ignoreQuotedAttachments&&this._isInsideQuote(o,t)||r.attachments.push({href:o.href,cid:o.id,name:o.innerText,type:"application/octet-stream"}))}return r}},{key:"_parseMetadata",value:function(e){var t=this._parseMicrodata(e);return t&&t.length>0&&this._reportMetadata(e,t),t}},{key:"_reportMetadata",value:function(e,t){}},{key:"_parseJSONLD",value:function(e){for(var t=0,a=[],n=e.getElementsByTagName("script"),r=0;r<n.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=n[r];if("application/ld+json"===i.getAttribute("type")){var o=i.textContent.trim();if(o)try{var s=JSON.parse(o);a.push(s)}catch(l){this._reportError(new Error("Invalid JSONLD Schema String"),o)}}}return a}},{key:"_parseMicrodata",value:function(e){var t=this,a=e.querySelectorAll("[itemscope]");return Array.prototype.map.call(a,(function(e){if(!e.hasAttribute("itemprop"))return t._parseMicrodataScope(e)})).filter((function(e){return!!e}))}},{key:"_parseMicrodataScope",value:function(e){var t={type:e.getAttribute("itemtype"),properties:{}};return this._recurseMicrodataScope(t,e),t}},{key:"_recurseMicrodataScope",value:function(e,t){for(var a=0,n=t.children,r=0;r<n.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=n[r];if(i.hasAttribute("itemprop")){var o,s=i.getAttribute("itemprop");if(i.hasAttribute("itemscope"))o=this._parseMicrodataScope(i);else switch(i.tagName.toLowerCase()){case"a":case"area":case"link":o=i.getAttribute("href");break;case"meta":o=i.getAttribute("content");break;case"img":o=i.getAttribute("src");break;case"data":case"meter":o=i.getAttribute("value");break;case"time":o=i.getAttribute("datetime");break;default:o=i.hasAttribute("content")?i.getAttribute("content"):i.textContent}s&&o&&(e.properties[s]=o)}else this._recurseMicrodataScope(e,i)}}},{key:"_cleanupDocQuotes",value:function(e,t){var a=this;return t.filter((function(e){var t=!1;"BLOCKQUOTE"===e.nodeName&&"cite"===e.getAttribute("type")&&(a.parseResourceID(e.innerText)&&e&&e.parentNode&&(e.parentNode.removeChild(e),t=!0));return!t}))}},{key:"_generatePlaceholderID",value:function(){return"~T"+Date.now()+ ++_}},{key:"_createQuotePlaceholder",value:function(e){var t=e.createElement("div");return t.id=this._generatePlaceholderID(),t.setAttribute("place","true"),t}},{key:"_findFirstSiblingQuote",value:function(e,t){for(var a=0,n=e;n.previousElementSibling&&t.indexOf(n.previousElementSibling)>=0;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n=n.previousElementSibling}return n}},{key:"_markAdjacentQuotes",value:function(e,t,a,n){for(var r=0;e&&a.indexOf(e)>=0;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e.setAttribute("quote",n),e.setAttribute("group",t),e=e.nextElementSibling}}},{key:"_collapseAndMarkQuotes",value:function(e,t,a){for(var n=0,r=0;r<t.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=t[r];if(!i.getAttribute("quote")){var o=this._findFirstSiblingQuote(i,t),s=this._createQuotePlaceholder(e),l=0===r&&a?"collapsed":"uncollapsed";this._markAdjacentQuotes(o,s.id,t,l),o.parentNode.insertBefore(s,i)}}}},{key:"_removeQuote",value:function(e){e&&e.parentNode&&e.parentNode.removeChild(e)}},{key:"_isFullQuote",value:function(e,t){for(var a=0,n=!0,r=e.body,i=0;r.children&&i<r.children.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=r.children[i];if(o&&""!==o.textContent.trim()&&t.indexOf(o)<0&&t.indexOf(o.firstElementChild)<0){n=!1;break}}return n}},{key:"_findQuoteElements",value:function(e){var t=this._findGmailQuotes(e),a=this._findOffice365Quotes(e),n=this._findBlockquoteQuotes(e),r=[];return this.pushOnlyUniques(r,t),this.pushOnlyUniques(r,a),this.pushOnlyUniques(r,n),r=this._cleanupGmail(r),r=this._removeEmptyQuotes(r)}},{key:"_cleanupGmail",value:function(e){var t=this;return e.filter((function(a){var n=!1;if("BLOCKQUOTE"===a.nodeName&&t._hasClass(a,"gmail_quote"))for(var r=0,i=0;i<e.length;++i){var o=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var s=a.parentElement;s;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(t._hasClass(s,"gmail_quote")){"DIV"===s.nodeName&&(n=!0);break}s=s.parentElement}}return!n}))}},{key:"_removeEmptyQuotes",value:function(e){return e}},{key:"_findGmailQuotes",value:function(e){return Array.prototype.slice.call(e.querySelectorAll(".gmail_quote"))}},{key:"_findOffice365Quotes",value:function(e){var t=Array.prototype.slice.call(e.querySelectorAll("#divRplyFwdMsg, #OLK_SRC_BODY_SECTION")),a=e.getElementById('3D"divRplyFwdMsg"');return a&&t.push(a),t=t.map((function(e){return e.previousElementSibling&&"HR"===e.previousElementSibling.nodeName?e.parentElement:e}))}},{key:"_findBlockquoteQuotes",value:function(e){return Array.prototype.slice.call(e.querySelectorAll("blockquote"))}},{key:"_findGmailSignatures",value:function(e){return Array.prototype.slice.call(e.querySelectorAll(".gmail_signature"))}},{key:"_findActiveSignature",value:function(e){for(var t,a=0,n=this._findGmailSignatures(e),r=this._findQuoteElements(e),i=n.length-1;i>=0&&!t;i--){var o=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var s=n[i],l=!0,u=0;u<r.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(this._isAncestor(s,r[u])){l=!1;break}}l&&(t=s)}return t}},{key:"_isAncestor",value:function(e,t){for(var a=0;e&&e!==t;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;e=e.parentElement}return!!e}},{key:"_trimTrailingWhitespace",value:function(e){for(var t=0,a=e.body.childNodes,n=[],r=a.length-1;r>=0;r--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=a[r],o=a[r-1];if(!i||"BR"!==i.nodeName||!o||"BR"!==o.nodeName)break;n.push(i)}this._removeElements(n)}},{key:"_trimQuoteWhitespace",value:function(e){for(var t=0,a=[],n=0;n<e.length;++n){var r=0;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;for(var i=e[n].previousElementSibling;i;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;"BR"===i.nodeName&&i.previousElementSibling&&"BR"===i.previousElementSibling.nodeName&&a.push(i),i=i.previousElementSibling}}this._removeElements(a)}},{key:"_removeElements",value:function(e){for(var t=0,a=0;a<e.length;++a){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e[a];try{n.parentNode&&n.parentNode.removeChild(n)}catch(r){}}}},{key:"_isInsideQuote",value:function(e,t){for(var a=0;e.parentNode;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t.indexOf(e.parentNode)>=0)return!0;e=e.parentNode}return!1}},{key:"_isArray",value:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{key:"isString",value:function(e){return"string"===typeof e}},{key:"pushOnlyUniques",value:function(e,t,a){var n=0;if(!t)return e;for(var r=0,i=t.length;r<i;++r){var o=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var s=!0,l=0,u=e.length;l<u;++l){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(a&&a(t[r],e[l])||!a&&t[r]===e[l]){s=!1;break}}s&&e.push(t[r])}return e}}]),e}();function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=m()(e);if(t){var r=m()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return p()(this,a)}}var D=function(e){h()(a,e);var t=S(a);function a(){var e;return l()(this,a),(e=t.call(this)).helper=new w(v.default.reportError,v.default.Assert),e}return c()(a,[{key:"update",value:function(){var e=o()(r.a.mark((function e(t,a,n,i){return r.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.update({decoded:t,resources:a,options:n,mimeType:i}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,a,n,r){return e.apply(this,arguments)}}()},{key:"getAttachmentLinks",value:function(){var e=o()(r.a.mark((function e(t,a){return r.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.getAttachmentLinks({decoded:t,options:a}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"generatePlaintext",value:function(){var e=o()(r.a.mark((function e(t){return r.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.generatePlaintext({decoded:t}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"replaceSignature",value:function(){var e=o()(r.a.mark((function e(t,a){return r.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.replaceSignature({decoded:t,newSignature:a}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"combineParts",value:function(){var e=o()(r.a.mark((function e(t){return r.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.combineParts({partList:t}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"removeElementsByAttribute",value:function(){var e=o()(r.a.mark((function e(t,a,n){return r.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.removeElementsByAttribute({decoded:t,attr:a,value:n}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"sanitizeContent",value:function(){var e=o()(r.a.mark((function e(t){return r.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.sanitizeContent({decoded:t}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getComposeBody",value:function(){var e=o()(r.a.mark((function e(t,a){return r.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.helper.getComposeBody({decoded:t,resources:a}));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()}]),a}(function(){function e(){l()(this,e)}return c()(e,[{key:"sanitizePlaintext",value:function(e){return e?/^\s*$/.test(e)?"":"<<NonHTML-Sanitized: "+e.length+">>":"<<NO CONTENT>>"}}]),e}());t.a=new D},,function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(24),l=a.n(s),u=a(20),c=a.n(u),d=a(21),h=a.n(d),f=a(13),p=a.n(f),g=a(0);function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=p()(e);if(t){var r=p()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return h()(this,a)}}var v=function(e){c()(a,e);var t=m(a);function a(e,n){var i;return r()(this,a),(i=t.call(this,e||{},n)).version=0,i}return o()(a,[{key:"getProperty",value:function(e){return this._value[e]}},{key:"setProperty",value:function(e,t,a){if(g.default.isString(this._value)){try{g.default.PAssert(468,!1,"ObservableObject is string",e)}catch(r){g.default.reportError(r)}this._value={}}var n=!1;this._value[e]!==t&&(this._value[e]=t,this.version++,n=!0),(a||!1!==a&&n)&&this.notify(this._value)}},{key:"deleteProperty",value:function(e,t){delete this._value[e],this.version++,!1!==t&&this.notify(this._value)}},{key:"hasValue",value:function(){return Object.keys(this._value).length>0}},{key:"set",value:function(e,t){return void 0!==e&&null!==e||(e={}),l()(p()(a.prototype),"set",this).call(this,e,t)}},{key:"clear",value:function(e){return this.set({},e)}},{key:"isEmpty",value:function(){return 0===Object.keys(this._value).length}}]),a}(a(15).a);t.a=v},function(e,t,a){"use strict";var n,r=a(7),i=a.n(r),o=a(8),s=a.n(o),l=a(10),u=a.n(l),c=a(11),d=a(62),h=(n=function(){function e(){i()(this,e),this.onDisableChanged=new d.a,this.state={except:{}}}return s()(e,[{key:"animateNext",value:function(e){this.state.disable||(this.state.enable=!0,this.state.except[e]=!0,this.prepTimeout())}},{key:"shouldAnimate",value:function(e){return this.state&&this.state.disable?null:this.state&&(!e||!this.state.except[e])}},{key:"disable",value:function(e){this.state.disable||(this.state.disable=!0,this.state.enable=!1,this.prepTimeout(),e&&this.onDisableChanged.notify())}},{key:"prepTimeout",value:function(){clearTimeout(this.timeout),this.timeout=setTimeout(this._onTimeout,1e3)}},{key:"_onTimeout",value:function(){var e=this.state.disable;this.state.disable=void 0,this.state.enable=!1,this.state.except={},this.timeout=void 0,e&&this.onDisableChanged.notify()}}]),e}(),u()(n.prototype,"_onTimeout",[c.a],Object.getOwnPropertyDescriptor(n.prototype,"_onTimeout"),n.prototype),n);t.a=new h},function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(2),l=a(0),u=a(9),c=a(4),d=a(32),h=a(33),f=function(){function e(){r()(this,e)}return o()(e,[{key:"resetSavedSelection",value:function(){this.savedCaretPosition=void 0,this.savedSelectionMinMax=void 0}},{key:"getCaretPosition",value:function(){if(!this.savedCaretPosition){var e=this.savedRange,t=e||h.default.getSelectionRangeNative();if(t){var a=t.getBoundingClientRect(),n=l.default.findParent(t.endContainer,"hiddenInputItem")||l.default.findParent(t.endContainer,"itemInPaneText");if(n){var r,i=n.getBoundingClientRect(),o=a.right-i.left-(+(null===(r=n.style.paddingLeft)||void 0===r?void 0:r.replace("px",""))||0),s=a.top-i.top;if(0===a.left){var u,c=+(null===(u=n.style.paddingTop)||void 0===u?void 0:u.replace("px",""));this.savedCaretPosition={left:0,top:l.default.isNumber(c)?c:0,height:0}}else this.savedCaretPosition={left:o,top:s,height:a.height,fromSavedRange:!!e}}}}return this.savedCaretPosition}},{key:"getSelectionMinMax",value:function(e,t){if(!this.savedSelectionMinMax){var a=h.default.getSelectionRangeNative();if(a){var n,r=l.default.findParent(a.endContainer,"hiddenInputItem")||l.default.findParent(a.endContainer,"itemInPaneText"),i=r.getBoundingClientRect(),o=i.left+(+(null===(n=r.style.paddingLeft)||void 0===n?void 0:n.replace("px",""))||0),s=Array.from(a.getClientRects()).filter((function(e){return e.width>0})),u=s[0],c=s[s.length-1],d=new Set(s.map((function(e){return e.top}))).size;this.savedSelectionMinMax={numLines:d,min:{x:u.left-o+e,y:u.top-i.top+t},max:{x:c.right-o+e,y:c.top-i.top+t}}}}return this.savedSelectionMinMax}},{key:"updateFromPaneObject",value:function(e,t,a,n){var r=this,i=e.pane,o=i.listManager.getElementByID(e.id),f=[],p={},g=i.hiddenInput;if(this.resetSavedSelection(),l.default.clearTimeoutOnce("updateFromPaneObject"+i.id),g){var m,v;if(o){var y=l.default.findParent(o,"paneContent");m=(v=o.getBoundingClientRect()).top-y.getBoundingClientRect().top+y.scrollTop}else if(!n||n<3)return void l.default.timeoutOnce("updateFromPaneObject"+i.id,(function(){return r.updateFromPaneObject(e,t,a,(n||0)+1)}),60);var k=f.length;f.push(e);var _=p[e.id]=i.getPaddingForPaneObject(e),b=e.getDisplayLengthWithoutPrefix();t>b&&(t=b),a>b&&(a=b);try{var w=f.map((function(e,t){var a=e.item,n=e.pane,r=c.default.DisplaySettings.fontSizeForItem(e);var i=c.default.DisplaySettings.lineHeightForItem(e),o=a.isPrefixCodeBlock(),l=p[e.id]-_-(o?0:s.a.TextPaddingLeft)+(c.default.settings.alignIndentToPrefix.get()&&a.hasPrefix()?s.a.PrefixWidth:0),u=e.getDisplayLengthWithoutPrefix()>0?c.default.ElementRenderer.renderNew(a.elsNew.elements,a,n,{noPrefix:!0,forHiddenInput:!0,showMarkdown:e.showMarkdown(!0),fontSize:r}):"",d=["position: relative","font-size: ".concat(r,"px"),"margin-left: ".concat(l,"px"),"line-height: ".concat(i,"px"),"padding-top: ".concat(c.default.DisplaySettings.paddingForItemTop(e),"px"),"padding-bottom: ".concat(2,"px"),"padding-left: ".concat(o?0:s.a.TextPaddingLeft,"px"),"margin-right: ".concat(c.default.DisplaySettings.paddingForItemRight(e),"px"),"z-index: 0",!u&&"height: ".concat(i,"px")].filter((function(e){return!!e})).join(";"),h=e.item.isStarred()?"":"c-background";return'<div data-index="'.concat(e.index,'" class="hiddenInputItem ').concat(s.a.ItemClass," ").concat(h," ").concat(a.styleProps(n,!0)," ").concat("",'" style="').concat(d,'">').concat(u,"</div>")})).join("");g.style.display="",g.style.paddingLeft=_+"px",void 0!==m&&(g.style.top=m+"px"),g.innerHTML!==w&&(g.innerHTML=w);var S=u.a.windowHeight()-d.b.getMaxKeyboardHeight()-120;v&&v.bottom>S&&i.addScrollDelta(v.bottom-S,u.a.supportSmoothScrollWithKeyboard()?"smooth":"auto");var D=g.children[k];g.focus();var P=h.default.selectElement(D,t,a);this.setSavedRange(P)}catch(I){l.default.reportError(I)}}}},{key:"setSavedRange",value:function(e){this.savedRange=e}},{key:"blur",value:function(e){var t=e.hiddenInput;t.blur(),t.innerHTML="",t.style.display="none"}}]),e}();t.a=new f},function(e,t,a){"use strict";var n,r,i=a(16),o=a.n(i),s=a(5),l=a.n(s),u=a(12),c=a.n(u),d=a(7),h=a.n(d),f=a(8),p=a.n(f),g=a(20),m=a.n(g),v=a(21),y=a.n(v),k=a(13),_=a.n(k),b=a(10),w=a.n(b),S=a(35),D=a(34),P=a(11),I=a(2),E=a(23),C=a(46),x=a(0),A=a(4),T=a(26),M=a(55),L=a(76),O=a(18),R=a(123),F=a(113),N=a(101),B=a(37),j=a(99),U=a(15),H=(n=function(){function e(t){var a=t.path,n=t.orderBy,r=t.startAt,i=t.extraModifiedPath,o=t.encryptedFields;h()(this,e),this.path=a,this.session=C.a.database(),this.orderBy=n,this.startAt=r,this.extraModifiedPath=i,this.encryptedFields=o,this.updatesSent={},this.reqNum=0,this._batch=[]}return p()(e,[{key:"_getUpdateVals",value:function(e){var t=this;var a={},n=Object.assign({},e);return delete n.id,x.default.isObject(n)?Object.keys(n).forEach((function(r){a["".concat(t.path,"/").concat(e.id,"/").concat(r)]=n[r]})):a["".concat(this.path,"/").concat(e.id)]=n,this.extraModifiedPath&&(a[this.extraModifiedPath]=C.a.database.ServerValue.TIMESTAMP),a}},{key:"update",value:function(){var e=c()(l.a.mark((function e(t,a){var n,r,i=this;return l.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(n=this._getUpdateVals(t),!a){e.next=5;break}return e.abrupt("return",new Promise((function(e){i._batch.push({item:t,resolve:e}),x.default.timeoutOnce("FirebasePathUpdate_"+i.path,i._runUpdates,200)})));case 5:return r=this.setSent(t.id,n),e.prev=6,e.next=9,this.session.ref().update(n);case 9:delete this.updatesSent[t.id][r],e.next=15;break;case 12:e.prev=12,e.t0=e.catch(6),x.default.reportError(e.t0);case 15:return e.abrupt("return",x.default.isEmpty(this.updatesSent[t.id]));case 16:case"end":return e.stop()}}}),e,this,[[6,12]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"_runUpdates",value:function(){var e=c()(l.a.mark((function e(){var t,a,n,r,i,o,s,u,c=0,d=this;return l.a.wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:t=this._batch,a={},n=0;case 3:if(!(n<t.length)){e.next=13;break}if(!(c++>5e3&&__infLoop&&__infLoop(c))){e.next=6;break}throw new RangeError;case 6:r=t[n],i=r.item,o=r.remove,s=void 0,o?(a["".concat(this.path,"/").concat(i.id)]=null,s=this.setSent(i.id,{type:I.a.CrudActions.Removed,id:i})):(u=this._getUpdateVals(i),Object.assign(a,u),s=this.setSent(i.id,u)),t[n].sent=s;case 10:n++,e.next=3;break;case 13:return this._batch=[],e.prev=14,e.next=17,this.session.ref().update(a);case 17:(function(){for(var e=0,a=0,n=0;n<t.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t[n],i=r.item,o=r.sent,s=r.resolve,l=i.id;delete d.updatesSent[l][o],s(x.default.isEmpty(d.updatesSent[l]))}})(),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(14),x.default.reportError(e.t0);case 24:case"end":return e.stop()}}}),e,this,[[14,21]])})));return function(){return e.apply(this,arguments)}}()},{key:"getPathForItem",value:function(e){return"".concat(this.path,"/").concat(e.id,"/")}},{key:"remove",value:function(e,t){var a=this;if(t)return new Promise((function(t){a._batch.push({item:e,remove:!0,resolve:t}),x.default.timeoutOnce("FirebasePathUpdate_"+a.path,a._runUpdates,200)}));var n=this.setSent(e.id,{type:I.a.CrudActions.Removed,id:e});return this.session.ref("".concat(this.path,"/").concat(e.id)).remove().then((function(){return delete a.updatesSent[e.id][n],x.default.isEmpty(a.updatesSent[e.id])}))}},{key:"toChangeInternal",value:function(e,t,a){return t.id=e,{type:a,value:t}}},{key:"isChangeRemote",value:function(e){var t=e.key,a=(e.val(),this.updatesSent[t]);return!(a&&!x.default.isEmpty(a))}},{key:"onUpdate",value:function(e){var t=this;this.cbOnUpdate=e;var a=!1,n=this.session.ref(this.path);this.orderBy&&this.startAt&&(n=n.orderByChild(this.orderBy).startAt(this.startAt)),n.on("value",(function(n){if(!a){a=!0;var r=n.val(),i=Object.keys(r||{}).map((function(e){return t.toChangeInternal(e,r[e],"load")}));e(i,!0)}}),(function(e){console.log("Firebase error",e)})),n.on("child_added",(function(n){if(a){var r=[t.toChangeInternal(n.key,n.val(),"Added")];e(r,t.isChangeRemote(n))}}),(function(e){console.log("Firebase error",e)})),n.on("child_changed",(function(n){if(a){var r=[t.toChangeInternal(n.key,n.val(),"Modified")];e(r,t.isChangeRemote(n))}}),(function(e){console.log("Firebase error",e)})),n.on("child_removed",(function(n){if(a){var r=[t.toChangeInternal(n.key,n.val(),"Removed")];e(r,t.isChangeRemote(n))}}),(function(e){console.log("Firebase error",e)}))}},{key:"setSent",value:function(e,t){var a=this.reqNum++;return this.updatesSent[e]||(this.updatesSent[e]={}),this.updatesSent[e][a]=t,a}}]),e}(),w()(n.prototype,"_runUpdates",[P.a],Object.getOwnPropertyDescriptor(n.prototype,"_runUpdates"),n.prototype),n),V=new(r=function(){function e(){h()(this,e)}return p()(e,[{key:"init",value:function(){return this.session||(this.database=this.session=C.a.database()),this.serverTime=C.a.database.ServerValue.TIMESTAMP,this}},{key:"create",value:function(e){return new H(e)}},{key:"onOnlineChange",value:function(e){this.session.ref(".info/connected").on("value",(function(t){e(!0===t.val())}))}},{key:"generateId",value:function(){return C.a.database().ref().push().key}}]),e}(),w()(r.prototype,"onOnlineChange",[P.a],Object.getOwnPropertyDescriptor(r.prototype,"onOnlineChange"),r.prototype),w()(r.prototype,"generateId",[P.a],Object.getOwnPropertyDescriptor(r.prototype,"generateId"),r.prototype),r),W=a(38),z=a.n(W),q=a(53),G=a.n(q),K=function(){function e(t,a,n){h()(this,e),this.dateModifieds=a,this.path=t,this.session=C.a.database(),this.dataCache={},this.isLoaded=!1,this.isLoadedSubpath={},this.ignoreLocalChange=!1,this.cbsOnUpdate={},this.updatesSent={},this.reqNum=0,this.encryptedFields=n}return p()(e,[{key:"toChangeInternal",value:function(e,t,a){var n=e.ref.path.slice(2),r=e.val(),i={},o=this.dataCache,s="Removed"===t;if("object"===G()(r)){0;var l=n.slice(1),u={},c=u;l.forEach((function(e,t){t===l.length-1?c[e]=r:(c[e]={},c=c[e])})),i=u,n.forEach((function(e,a){a===n.length-1?"Removed"===t?delete o[e]:o[e]!==r&&(s=!0,o[e]=r):(o[e]||(o[e]={}),o=o[e])}))}else{var d=e.key;o[a]||(o[a]={}),o=o[a],"Removed"!==t?o[d]!==r&&(s=!0,o[d]=r):o&&delete o[d],i[d]=r}if(s)return{type:t,value:i}}},{key:"set",value:function(){var e=c()(l.a.mark((function e(t,a){var n,r,i,o,s,u,c,d=0;return l.a.wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:n=t.split("/"),r=this.dataCache,i=n[n.length-1],o="".concat(this.path,"/").concat(t),s=0;case 3:if(!(s<n.length-1)){e.next=16;break}if(!(d++>5e3&&__infLoop&&__infLoop(d))){e.next=6;break}throw new RangeError;case 6:if(r){e.next=8;break}return e.abrupt("return",Promise.resolve(!1));case 8:if(n[s]){e.next=11;break}return e.abrupt("continue",13);case 11:r[n[s]]||(r[n[s]]={}),r=r[n[s]];case 13:s++,e.next=3;break;case 16:return r[i]=a,u=this.session.ref(o),c=this.setSent(t,a),e.prev=20,e.next=23,u.update(a);case 23:return delete this.updatesSent[t][c],e.abrupt("return",x.default.isEmpty(this.updatesSent[t]));case 27:e.prev=27,e.t0=e.catch(20),x.default.reportError(e.t0);case 30:return e.abrupt("return",!1);case 31:case"end":return e.stop()}}}),e,this,[[20,27]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"remove",value:function(){var e=c()(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return a=this.setSent(t,{type:I.a.CrudActions.Removed,id:t}),e.prev=1,e.next=4,this.session.ref("".concat(this.path,"/").concat(t)).remove();case 4:return delete this.updatesSent[t][a],e.abrupt("return",x.default.isEmpty(this.updatesSent[t]));case 8:e.prev=8,e.t0=e.catch(1),x.default.reportError(e.t0);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}}),e,this,[[1,8]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isChangeRemote",value:function(e){var t=this.updatesSent[e];return!(t&&!x.default.isEmpty(t))}},{key:"sendChangeCB",value:function(e,t,a){var n=e.ref.path;x.default.isString(n)&&(n=n.split("/"));var r=n.slice(2).join("/"),i=this.isChangeRemote(r);i&&a(t,i)}},{key:"onLoad",value:function(e,t){var a=this;this.session.ref(this.path).on("value",(function(t){if(!a.isLoaded){a.isLoaded=!0;var n=t.val()||{};a.dataCache=n,e(n)}}),(function(e){x.default.log("Firebase error",e),t?t(e):x.default.reportError(e,"Missing cbError handler: "+a.path)}))}},{key:"onLoadSubpath",value:function(e,t){var a=this,n=this.path+"/"+e;this.isLoadedSubpath[e]=!1;var r=this.session.ref(n);if(this.dateModifieds[e]){var i=this.dateModifieds[e];r=r.orderByChild("d").startAt(i)}r.on("value",(function(n){if(!a.isLoadedSubpath[e]){a.isLoadedSubpath[e]=!0,a.isLoaded=!0;var r=n.val()||{};a.dataCache[e]=r,t(r)}}),(function(e){x.default.log("Firebase error",e),x.default.reportError(e,"Missing cbError handler: "+a.path)}))}},{key:"onUpdate",value:function(e,t,a){var n=this;this.cbsOnUpdate[e]=t;var r=this.path+"/"+e,i=this.session.ref(r);if(this.dateModifieds[e]){var o=this.dateModifieds[e];i=i.orderByChild("d").startAt(o)}i.on("child_added",(function(a){if(n.isLoaded&&!1!==n.isLoadedSubpath[e]){var r=n.toChangeInternal(a,"Added",e);r&&n.sendChangeCB(a,r,t)}}),(function(e){console.log("Firebase error",e),a&&a(e)})),i.on("child_changed",(function(a){if(n.isLoaded&&!1!==n.isLoadedSubpath[e]){var r=n.toChangeInternal(a,"Modified",e);r&&n.sendChangeCB(a,r,t)}}),(function(e){console.log("Firebase error",e),a&&a(e)})),i.on("child_removed",(function(a){if(n.isLoaded&&!1!==n.isLoadedSubpath[e]){var r=n.toChangeInternal(a,"Removed",e);r&&n.sendChangeCB(a,r,t)}}),(function(e){console.log("Firebase error",e),a&&a(e)}))}},{key:"offUpdate",value:function(e,t){var a=this.path+"/"+e;this.session.ref(a).off("child_added",t),this.session.ref(a).off("child_changed",t),this.session.ref(a).off("child_removed",t)}},{key:"setSent",value:function(e,t){var a=this.reqNum++;return this.updatesSent[e]||(this.updatesSent[e]={}),this.updatesSent[e][a]=t,a}}]),e}(),Y={a:"AuthToken",b:"Board",p:"Property",s:"Setting",l:"Plugin"},X=function(){function e(t,a){var n=this;h()(this,e),this.dateModifieds=a,this.uid=t,this.session=C.a.database(),this.treeApi=new K("users/".concat(t),a,{"s/aE/v":!0}),Object.keys(Y).forEach((function(e){var t=Y[e];n["on"+t+"Update"]=n.treeApi.onUpdate.bind(n.treeApi,e),n["set"+t]=function(t,a){return n.treeApi.set(e+"/"+t,a)},n["remove"+t]=function(t){return n.treeApi.remove(e+"/"+t)}}))}return p()(e,[{key:"onLoad",value:function(){var e=c()(l.a.mark((function e(t){var a,n,r=this;return l.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return a={},e.next=3,Promise.all(Object.keys(Y).map((function(e){return new Promise((function(t){return r.treeApi.onLoadSubpath(e,(function(n){a[e]=n,t()}))}))})));case 3:n={properties:a.p,settings:a.s,authTokens:a.a,boards:a.b,plugins:a.l},t(n);case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getPathForSettings",value:function(){return"users/".concat(this.uid,"/s/")}},{key:"deleteFully",value:function(){var e,t=(e={},z()(e,"/users/".concat(this.uid,"/a"),null),z()(e,"/users/".concat(this.uid,"/b"),null),z()(e,"/users/".concat(this.uid,"/s"),null),z()(e,"/users/".concat(this.uid,"/l"),null),e);return this.session.ref().update(t)}}]),e}();var Q=function(e,t,a){return Object.assign(a,z()({},e,t))},J={identity:function(e){return e},true:function(e){return!0},index:function(e,t){return t}},Z=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:J.identity,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:J.true,a=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,r=arguments.length>4?arguments[4]:void 0;return Q(e(n,r),t(n,r),a)},$=function(e,t,a){return Z(void 0,void 0,e,t,a)},ee=function(e,t){var a={id:e.id},n=function(n){void 0===t[n]?a[n]=null:e[n]!==t[n]&&(a[n]=t[n])};return Object.keys(e).forEach(n),Object.keys(t).forEach(n),a},te=function(e,t,a){return"Removed"===e||"Added"===e?{type:e,value:a}:{type:e,value:t?ee(t,a):a}},ae=function(e,t){return{type:t,value:e}},ne=function(e,t){return function(t){return[t].map((a=e,function(e){return te(e.type,a[e.value.id],e.value)}))[0];var a}},re=function(e,t){var a,n=t.value;return e=(a="id",function(e,t,n){return Z(function(e){return function(t){return function(e,t){return t?t[e]:void 0}(e,t)}}(a),J.identity,e,t,n)})(e,n),"Removed"===t.type&&delete e[n.id],e},ie=function(e){return e.changes.map((function(e){return e.value}))},oe=function(e){var t=e.changes,a=e.prevStore;return t.map(ne(a))},se=function(e){return e._store={},e},le=function(e){var t=e.changes,a=(e.type,e.prevStore,e.api);return a._store=t.reduce(re,a._store),a},ue=function(e){var t=e.item,a=e.api,n=e.changeType,r=Object.assign({},a._store),i=ae(t,n);le({changes:[i],prevStore:r,api:a})},ce=function(e){return function(t,a){return ue({item:a,api:t,changeType:e})}},de={load:function(e){var t=e.changes,a=e.api,n=e.prevStore;return le({api:a,type:"update",changes:t,prevStore:n})},normalizeChanges:oe,addItem:ce("Added"),removeItem:ce("Removed"),modifyItem:ce("Modified")},he={load:function(e){var t=e.changes,a=e.api,n=e.prevStore;return le({changes:t,api:se(a),prevStore:n})},normalizeChanges:ie},fe=a(84),pe=a.n(fe);function ge(e,t){var a;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(a=function(e,t){if(!e)return;if("string"===typeof e)return me(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);"Object"===a&&e.constructor&&(a=e.constructor.name);if("Map"===a||"Set"===a)return Array.from(e);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return me(e,t)}(e))||t&&e&&"number"===typeof e.length){a&&(e=a);var n=0,r=function(){};return{s:r,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){a=e[Symbol.iterator]()},n:function(){var e=a.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==a.return||a.return()}finally{if(s)throw i}}}}function me(e,t){var a=0;(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;r[n]=e[n]}return r}var ve,ye,ke=function(e,t,a){return e.push(t),a},_e=function(e,t,a){var n=e.indexOf(t);return n>-1&&e.splice(n,1),a},be=function(e,t,a){var n,r=ge(e);try{var i=0,o=function(){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var e=n.value;setTimeout((function(){return e.apply(void 0,pe()(t))}),0)};for(r.s();!(n=r.n()).done;)o()}catch(s){r.e(s)}finally{r.f()}return a},we=function(e){return function(t,a){return function(e,t,a){var n=Object.assign({},a._store),r=a._loadingState,i="load"===r?a._loader:a._updater,o="load"===r;if(o||(e=e.filter((function(e){var t=e.value;return"Removed"===e.type||!n[t.id]||t.d!==n[t.id].d}))),o&&(a._loadingState="update","load"===r&&a._earlyEdits.length&&(a._earlyEdits.forEach((function(e){be(a._callbacks.update,[e])})),a._earlyEdits=[])),"update"===a._loadingState){if(o||e.length>0){a=i.load({api:a,changes:e,prevStore:n});var s=i.normalizeChanges({api:a,changes:e,prevStore:n});be(a._callbacks[r],[{responses:s},t]),be(a._callbacks["".concat(r,"Debug")],[{responses:s,changes:e,api:a},t])}}else a._earlyEdits.push({changes:e,api:a});return a}(t,a,e)}},Se=function(e){var t=e.id,a=e.store;return a[t]?Object.assign({},a[t]):void 0},De=[],Pe=function(e){var t=e.db,a=e.config,n=e.ignore,r=void 0===n?De:n,i=e.backend,o=e.path,s=e.orderBy,l=e.startAt,u=e.extraModifiedPath,c=e.encryptedFields,d={_config:a,_database:t,_store:{},_callbacks:{update:[],load:[],updateDebug:[],loadDebug:[]},_ignore:r.reduce($,{}),_loadingState:"load",_earlyEdits:[],_backend:i.create({db:t,path:o,orderBy:s,startAt:l,extraModifiedPath:u,encryptedFields:c}),_loader:he,_updater:de};return d._backend.onUpdate(we(d)),d.get=function(e){return Se({id:e,store:d._store})},d.getFromRemote=function(e){return d._backend.getFromRemote(e)},d.update=function(e,t){return function(e,t){var a,n=e.item,r=e.backend,i=e.api,o=(a=i._ignore,function(e){return function(e,t){if(!e)return e;var a={};for(var n in e)n in t||(a[n]=e[n]);return a}(e,a)})(n);return i._updater.modifyItem(i,o),r.update(o,t)}({item:e,backend:d._backend,api:d},t)},d.getPathForItem=function(e){return function(e){var t=e.item;return e.backend.getPathForItem(t)}({item:e,backend:d._backend,api:d})},d.remove=function(e,t){return function(e,t){var a=e.item,n=e.backend,r=e.api;return r._updater.removeItem(r,a),console.log("remove",a),n.remove(a,t)}({item:e,backend:d._backend,api:d},t)},d.onLoad=function(e){return ke(d._callbacks.load,e)},d.offLoad=function(e){return _e(d._callbacks.load,e)},d.onUpdate=function(e){return ke(d._callbacks.update,e)},d.offUpdate=function(e){return _e(d._callbacks.update,e)},d.onLoadDebug=function(e){return ke(d._callbacks.loadDebug,e)},d.offLoadDebug=function(e){return _e(d._callbacks.loadDebug,e)},d.onUpdateDebug=function(e){return ke(d._callbacks.updateDebug,e)},d.offUpdateDebug=function(e){return _e(d._callbacks.updateDebug,e)},d.setSent=function(e,t){return d._backend.setSent(e,t)},d},Ie=(ve=function(){function e(t,a,n){h()(this,e),this.docID=t,this.uid=a,this.userDocuments=n,this.treeApi=new K("documents/".concat(t),{},{"p/s":!0}),this.cbs=[],this.cbsAcl=[]}return p()(e,[{key:"onLoad",value:function(e,t){this.treeApi.onLoad((function(t){e(t)}),t)}},{key:"onUpdate",value:function(e,t){this.cbs.push(e),this.treeApi.onUpdate("p",e,t)}},{key:"offUpdate",value:function(e){this.cbs.remove(e),this.treeApi.offUpdate("p",e)}},{key:"onAclUpdate",value:function(e,t){this.cbsAcl.push(e),this.treeApi.onUpdate("a",e,t)}},{key:"offAclUpdate",value:function(e){this.cbs.remove(e),this.treeApi.offUpdate("p",e)}},{key:"onAPIItemsUpdate",value:function(e,t){this.cbs.push(e),this.treeApi.onUpdate("z",e,t)}},{key:"offAPIItemsUpdate",value:function(e){this.cbs.remove(e),this.treeApi.offUpdate("z",e)}},{key:"deleteAPIItems",value:function(e,t){var a={};return t.forEach((function(t){return a["/documents/".concat(e,"/z/").concat(t)]=null})),V.database.ref().update(a)}},{key:"create",value:function(e,t){var a,n=Object.assign({},e),r={t:n.p.t};n.p.d&&(r.d=n.p.d),delete n.id;var i=(a={},z()(a,"/documents/".concat(this.docID),n),z()(a,"/userdocuments/".concat(this.uid,"/").concat(this.docID),r),a);if(t)for(var o=0,s=0;s<t.length;s++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var l=t[s],u=l.id;delete l.id,i["/items/".concat(this.docID,"/").concat(u)]=l}return this.userDocuments.setSent(this.docID,r),V.database.ref().update(i)}},{key:"unlisten",value:function(){this.cbs.forEach(this.offUpdate),V.database.ref("/items/".concat(this.docID)).off(),V.database.ref("/userdocuments/".concat(this.uid,"/").concat(this.docID)).off(),V.database.ref("/documents/".concat(this.docID,"/a")).off(),V.database.ref("/documents/".concat(this.docID)).off()}},{key:"deleteFully",value:function(){var e;this.unlisten();var t=(e={},z()(e,"/items/".concat(this.docID),null),z()(e,"/userdocuments/".concat(this.uid,"/").concat(this.docID),null),z()(e,"/documents/".concat(this.docID),null),e);return V.database.ref().update(t)}},{key:"update",value:function(e,t){var a=Object.assign({},e);delete a.id;var n={};t?n["/documents/".concat(this.docID,"/p")]=a.p:n["/documents/".concat(this.docID)]=a,a.p.d&&(n["/userdocuments/".concat(this.uid,"/").concat(this.docID,"/d")]=a.p.d),a.p.t&&(n["/userdocuments/".concat(this.uid,"/").concat(this.docID,"/t")]=a.p.t),V.database.ref().update(n)}},{key:"addBackup",value:function(e){V.database.ref("/documents/".concat(this.docID,"/c")).update(z()({},e,""))}}]),e}(),w()(ve.prototype,"offUpdate",[P.a],Object.getOwnPropertyDescriptor(ve.prototype,"offUpdate"),ve.prototype),w()(ve.prototype,"offAclUpdate",[P.a],Object.getOwnPropertyDescriptor(ve.prototype,"offAclUpdate"),ve.prototype),w()(ve.prototype,"offAPIItemsUpdate",[P.a],Object.getOwnPropertyDescriptor(ve.prototype,"offAPIItemsUpdate"),ve.prototype),ve),Ee=function(){function e(t,a){h()(this,e),this.uid=t,this.docs={},this.documentsWaiting={},this.db={firebase:C.a,session:C.a.database()},V.init(),this.onOnlineChange=V.onOnlineChange,this.serverTime=V.serverTime,this.generateId=V.generateId,this.user=new X(t,a),this.userDocuments=Pe({db:this.db,backend:V,path:"userdocuments/".concat(t),encryptedFields:{s:!0}})}return p()(e,[{key:"loadDocuments",value:function(e){this.userDocuments.onLoad((function(t){var a=t.responses;e(a)}))}},{key:"onDocumentsUpdate",value:function(e){this.userDocuments.onUpdate(e)}},{key:"createDocumentAPI",value:function(e,t,a){var n=this;if(!(e in this.docs)){try{x.default.PAssert(355,!t||!isNaN(t)&&t<Date.now(),"Date modified is not number: "+t)}catch(s){x.default.reportError(s)}var r,i=a||new Ie(e,this.uid,this.userDocuments),o=t&&!isNaN(t)?t+1:void 0;this.docs[e]={info:i,items:function(){return r||(r=Pe({db:n.db,backend:V,path:"items/".concat(e),orderBy:"d",startAt:o,extraModifiedPath:"documents/".concat(e,"/p/d"),encryptedFields:{t:!0}})),r}}}return this.docs[e]}},{key:"getDocumentAPI",value:function(){var e=c()(l.a.mark((function e(t){var a,n=this;return l.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.docs[t]){e.next=4;break}return e.abrupt("return",this.docs[t]);case 4:return this.documentsWaiting[t]||(this.documentsWaiting[t]=[]),a=new Promise((function(e){n.documentsWaiting[t].push(e)})),e.abrupt("return",a);case 7:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onDocumentAPILoaded",value:function(){var e=this;Object.keys(this.documentsWaiting).forEach((function(t){var a=e.documentsWaiting[t];a&&a.forEach((function(a){return a(e.docs[t])}))}))}},{key:"addDocument",value:function(e,t){var a=this,n=e.id,r=this.docs[n];if(!r){var i=new Ie(n,this.uid,this.userDocuments);return i.create(e,t).then((function(){return a.createDocumentAPI(n,void 0,i)}))}return Promise.resolve(r)}},{key:"forgetDocument",value:function(e){this.docs[e];return delete this.docs[e],!0}},{key:"commitBatch",value:function(e){return this.db.session.ref().update(e)}}]),e}(),Ce=a(54),xe=a(67);function Ae(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=_()(e);if(t){var r=_()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return y()(this,a)}}var Te=(ye=function(e){m()(a,e);var t=Ae(a);function a(){var e;return h()(this,a),(e=t.call(this,!1)).documentsEncrypted={},e.documentsDeleted={},e._isLoaded=!1,e.loadState=new U.a(I.a.LoadState.Connecting),e}return p()(a,[{key:"init",value:function(e,t){if(this._seenLocal={},this._coalescedChanges={},this._itemsChangedQueue=[],this._isLoaded=!1,this.cbOnLoad=e,this.cbOnDocumentsChanged=t,this.savedDocInfo={},E.a.init(this,this.onLoadLocal),T.a.hasURLParam("invite")){var a=T.a.getURLParam("invite");S.a.onAuthed(c()(l.a.mark((function e(){return l.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,L.a.acceptInvite(a);case 2:e.sent.error||T.a.removeURLParam("invite");case 4:case"end":return e.stop()}}}),e)}))))}}},{key:"onLoadLocal",value:function(e,t){var a=this,n=t.documentsPending,r=t.itemsPending,i=t.settingsPending,o=t.boardsPending,s=t.isPreload;e||(e=[]),e.forEach((function(e){return a.documents[e.id]=e})),this.documentsPending=n,this.itemsPending=r,this.settingsPending=i,this.boardsPending=o,this.cbOnLoad&&this.cbOnLoad(e),s||(this.cbOnLoad=void 0,A.default.settings.userId.onHasValue((function(){a.createStore()})))}},{key:"notifyDocumentsChanged",value:function(){this.cbOnDocumentsChanged({documents:this.documents,documentsEncrypted:this.documentsEncrypted,documentsDeleted:this.documentsDeleted})}},{key:"onLoadRemoteDocuments",value:function(){this._isLoaded=!0,this.notifyDocumentsChanged(),A.default.PaneManager.loadInitialState(),M.a.ensureSelected(),A.default.settings.lastSync.set(Date.now()),this.api.onDocumentAPILoaded()}},{key:"createStore",value:function(){var e=this,t=0,a=E.a.getAllPluginsNew();a&&(t=x.default.max(Object.keys(a).map((function(e){return a[e].dateModified+1}))));var n,r,i=new Ee(S.a.getUid(),{l:t});this.api=i;var o=function(){var t=c()(l.a.mark((function t(){return l.a.wrap((function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:return A.default.settings.lastSync.get()||O.a.setLoadProgress("Downloading and decrypting documents..."),Object.keys(e.documents).forEach((function(t){!e.documentsPending[t]&&r.indexOfWithProperty("id",t)<0&&(e.documentsPending[t]=!0)})),t.prev=2,t.next=5,Promise.all(Object.keys(e.documentsPending).map((function(t){var a=e.documents[t];if(a&&!a.isDeleted.get()&&(!r||r.indexOfWithProperty("id",a.id)<0))return e.addDocument(a,!1)})));case 5:return e.documentsPending={},E.a.beginBatch(),t.next=9,Promise.all(r.map((function(t){return e.loadDocumentData(B.a.documentInFlat(t))})));case 9:O.a.setLoadProgress(void 0),e.onLoadRemoteDocuments(),e.loadState.set(I.a.LoadState.Connected),E.a.commitBatch(),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(2),x.default.reportError(t.t0);case 18:case"end":return t.stop()}}}),t,null,[[2,15]])})));return function(){return t.apply(this,arguments)}}(),s=function(){n&&r&&o()};i.user.onLoad((function(t){var a=A.default.settings.getSettingAbbrev("userEncryptionSentinel"),r=t.settings,o=!1;t.properties?(e.userProperties=B.a.userIn(t.properties),A.default.billingManager.loadUserProperties(e.userProperties)):(o=!0,A.default.billingManager.loadUserProperties({})),t.boards&&!x.default.isEmpty(t.boards)||(o=!0),o&&e.onFirstSync(t),e.checkUserEncryption(r&&r[a]&&r[a].v,(function(){A.default.settings.lastSync.get()||O.a.setLoadProgress("Downloading documents..."),e.loadState.set(I.a.LoadState.LoadingDocs),r&&e.onSettingsChange("Modified",r,!0,!0),e.settingsPending&&Object.keys(e.settingsPending).forEach((function(t){var a=A.default.settings.getSettingInfoFromAbbrev(t),n=A.default.settings.getRemoteSaveValue(a.key,A.default.crypto.getKeyInfo(A.default.settings.getBestUserEncryption()));void 0!==n&&e._setSettingRemote(t,n)}));var a=t.boards;a&&e.onBoardsChange("Modified",a,!0),e.boardsPending&&Object.keys(e.boardsPending).forEach((function(t){var a=M.a.getById(t);try{x.default.PAssert(202,a,"Pending board that does not exist")}catch(n){x.default.reportError(n)}a&&e._saveBoardRemote(a.getSaveInfo())})),xe.a.initWithAPI(i,t.plugins),n=!0;var o=t.authTokens;e.onAuthTokensChange("Added",o,!0),s(),setTimeout((function(){A.default.settings.userEncryptionSentinel.listen((function(t){t?e.checkUserEncryption(t):A.default.settings.removeEncryptionKey(I.a.EncryptionKeys.UserPassword)}))}),0)}))})),i.user.onPropertyUpdate((function(e,t){var a=e.type,n=e.value;if(t){"Removed"===a&&Object.keys(n).forEach((function(e){return n[e]=null}));var r=B.a.userIn(n);A.default.billingManager.loadUserProperties(r)}})),i.user.onSettingUpdate((function(t,a){var n=t.type,r=t.value;e.onSettingsChange(n,r,a,!1)})),i.user.onBoardUpdate((function(t,a){var n=t.type,r=t.value;e.onBoardsChange(n,r,a)})),i.user.onAuthTokenUpdate((function(t,a){var n=t.type,r=t.value;e.onAuthTokensChange(n,r,a)})),i.loadDocuments((function(e){r=e,s()})),i.onDocumentsUpdate((function(t,a){var n=t.responses;E.a.beginBatch(),Promise.all(n.map((function(t){var a=t.type,n=t.value;if("Removed"!==a)return e.loadDocumentData(B.a.documentInFlat(n));e.documents[n.id]&&(e.documents[n.id].delete(!0),delete e.documents[n.id])}))).then((function(){E.a.commitBatch(),e.notifyDocumentsChanged()})).catch((function(e){return x.default.reportError(e)}))})),i.onOnlineChange((function(t){e.updateOnlineStatus(t)})),this._isLoaded||(this._isLoaded=!0),this._runCoalescedChanges()}},{key:"onFirstSync",value:function(){var e=c()(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:!(a=S.a.getGoogleProvider())||A.default.settings.syncAccounts.get()&&!x.default.isEmpty(A.default.settings.syncAccounts.get())||A.default.settings.syncAccounts.setProperty(a.email,{}),t.boards&&!x.default.isEmpty(t.boards)||M.a.createDefaultState(),A.default.intro.showHelp(),A.default.billingManager.setJoinDate(Date.now());case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadSingleDocument",value:function(){var e=c()(l.a.mark((function e(t,a){var n;return l.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.loadDocumentData(t,a);case 3:return n=e.sent,this.notifyDocumentsChanged(),e.abrupt("return",n);case 8:e.prev=8,e.t0=e.catch(0),x.default.reportError(e.t0);case 11:case"end":return e.stop()}}}),e,this,[[0,8]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"loadDocumentData",value:function(){var e=c()(l.a.mark((function e(t,a){var n,r,i,o,s,u,d,h,f,p,g=this;return l.a.wrap((function(e){for(var m=0;;){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;switch(e.prev=e.next){case 0:if(!(r=this.documents[t.id])){e.next=6;break}n=r.dateModified.get(),e.next=9;break;case 6:if(!t.encryptionSentinel||A.default.crypto.canDecryptSentinel(t.encryptionSentinel)){e.next=9;break}return this.documentsEncrypted[t.id]=t,e.abrupt("return",void 0);case 9:return e.prev=9,i=this.api.createDocumentAPI(t.id,n),e.next=13,new Promise((function(e){c()(l.a.mark((function n(){var o,s,u,c;return l.a.wrap((function(n){for(var l=0,d=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;switch(n.prev=n.next){case 0:if(!g.savedDocInfo[t.id]){n.next=5;break}Object.assign(g.savedDocInfo[t.id].docProps,t),e(g.savedDocInfo[t.id]),n.next=15;break;case 5:if(s=i.info,!a){n.next=10;break}n.t0=t,n.next=13;break;case 10:return n.next=12,new Promise((function(e){s.onLoad((function(a){a.id=t.id;var n=B.a.documentIn(a);e(n)}),(function(t){e(null)}))}));case 12:n.t0=n.sent;case 13:u=n.t0,!a&&u.isDeleted?(g.documentsDeleted[t.id]={info:u,api:i},e(void 0)):(s.onUpdate(g.onDocInfoChange.bind(g,t),x.default.reportError),s.onAclUpdate(g.onDocAclChange.bind(g,t),x.default.reportError),s.onAPIItemsUpdate(g.onDocAPIItemsChange.bind(g,r),x.default.reportError),(c=i.items()).onLoad((function(a){var n=a.responses;if(o=n,null===u)e(void 0);else if(u&&o){var r={docProps:u,docItemsEncrypted:o};g.savedDocInfo[t.id]=r,e(r)}})),c.onUpdate(g.onItemsChange.bind(g,t)));case 15:case"end":return n.stop()}}}),n)})))()}));case 13:if(!(o=e.sent)){e.next=33;break}if(s=o.docProps,u=o.docItemsEncrypted,d=this.getEncryptionForDocument(s)){e.next=21;break}return t.encryptionSentinel=s.encryptionSentinel,this.documentsEncrypted[t.id]=t,e.abrupt("return",Promise.resolve(void 0));case 21:return h=n||0,e.next=24,Promise.all(u.map((function(e){return g.decryptItemIn(e,A.default.crypto,d)}))).then((function(e){return e.forEach((function(e){e.docId=s.id,h=Math.max(h,e.dateModified)})),N.a.createItemHierarchy(e,E.a.getItemsMap()),r&&e.length>0&&g.resolveItemConflicts(r,e),e}));case 24:return f=e.sent,r&&Object.keys(this.itemsPending).forEach((function(e){var t=E.a.getItemData(e),a=O.a.getItem(e),n=g.itemsPending[e];if(t&&t.docId===r.id){try{x.default.PAssert(203,a||t.isArchived||t.isDeleted,"Pending update that has no parent")}catch(s){x.default.reportError(s)}if(a||t.isArchived||t.isDeleted){var i=Object.keys(n);if(i.length>0){var o={id:e};i.forEach((function(e){o[e]=t[e]})),g._saveItemRemote(r,o,a)}}}})),f.length>0&&E.a.ensureMirror(f,!0,!1),s.dateModified=h,r?this.documentsPending[r.id]?(this._saveDocumentRemote(r),delete this.documentsPending[r.id]):r.onRemoteUpdate(s):s.root&&((p=x.default.clone(s)).backing=this,p.rootData=this.getItemData(s.root),p.rootData&&(delete p.pendingSync,(r=j.a.fromData(p,this)).createVMLIs())),r&&(this.documents[r.id]=r,delete this.documentsEncrypted[r.id],delete this.documentsDeleted[r.id],E.a.saveDocument(r)),r||console.log("Failed to find root item"),e.abrupt("return",r);case 33:e.next=40;break;case 35:e.prev=35,e.t0=e.catch(9),console.log(e.t0),x.default.reportError(e.t0);case 40:case"end":return e.stop()}}}),e,this,[[9,35]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getItemData",value:function(e){var t=this._coalescedChanges[e],a=E.a.getItemData(e,!0);return t&&"Removed"!==t.type&&(a=Object.assign({},a,t.info)),a}},{key:"getItemSaveData",value:function(e){return e.getFullSaveData()}},{key:"importItem",value:function(e,t){var a=this;e.getDocumentOwner(),e.parent();t.push(e),e.hasNote()&&this.importItem(e.getNote(),t),e.getItems().forEach((function(e,n){e.index=""+n,a.importItem(e,t)})),this._seenLocal[e.id]=!0}},{key:"onSettingsChange",value:function(e,t,a,n){var r=this,i=t;Object.keys(t).forEach((function(n){var o=t[n];a&&r.settingsPending[n]?(i===t&&(i=x.default.clone(t)),delete i[n],t[n]={v:A.default.settings.getValueFromAbbrev(n)}):delete r.settingsPending[n],o.v&&(o.v="Removed"===e?void 0:r.decodeValue(o.v))})),"Removed"===e&&E.a.deleteSettings(i),A.default.settings.load(t,n,a)}},{key:"onBoardsChange",value:function(e,t,a){var n=this;Object.keys(t).forEach((function(r){if(!a||!n.boardsPending[r]){t[r].id=r;var i=B.a.boardIn(t[r]);"Removed"===e?E.a.deleteBoard(r):E.a.saveBoard(i),a&&M.a.onRemoteUpdate(e,i)}})),M.a.ensureUniqueIndices()}},{key:"onAuthTokensChange",value:function(e,t,a){var n={};t&&"Removed"!==e&&Object.keys(t).forEach((function(e){var a=e.replace(/,/g,"."),r=t[e],i=r.s?r.s.split(" "):void 0,o={email:a,scopes:i?i.map((function(e){return I.a.GScopeArray[e]})):void 0};try{x.default.PAssert(205,"Have an auth token without scopes")}catch(s){x.default.reportError(s)}n[a]=o})),D.a.loadWithTokens(n)}},{key:"onDocAclChange",value:function(e,t,a){var n=t.type,r=t.value,i=this.documents[e.id];i&&("Removed"===n&&Object.keys(r).forEach((function(e){r[e]=void 0})),i.onAclUpdate(r)&&E.a.saveDocument(i))}},{key:"onDocInfoChange",value:function(e,t,a){var n=t.type,r=t.value,i=this.documents[e.id];if(i&&("Removed"===n&&Object.keys(r).forEach((function(e){r[e]=null})),r)){var o={text:r.t,encryptionSentinel:r.s,isDeleted:r.x};i&&(i.onRemoteUpdate(o),o.encryptionSentinel&&!i.canDecrypt()&&(this.documentsEncrypted[i.id]=i.getSaveInfo(),delete this.documents[i.id],delete this.savedDocInfo[i.id],this.notifyDocumentsChanged(),A.default.PaneManager.runForEachPane((function(e){e.document.get()===i&&e.setDocument(O.a.getDefaultDocument())}))),E.a.saveDocument(i))}}},{key:"onDocAPIItemsChange",value:function(e,t){var a=t.type,n=t.value;"Removed"!==a&&e.onRemoteUpdate({itemsPlaintext:n})}},{key:"deleteDocAPIItems",value:function(){var e=c()(l.a.mark((function e(t,a){return l.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.getAPIForDocument(t);case 2:e.sent.deleteAPIItems(t.id,a);case 4:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"_processItemsChange",value:function(){var e=c()(l.a.mark((function e(){var t,a,n,r,i,o,s,u,d,h,f,p,g,m,v,y,k=this;return l.a.wrap((function(e){for(var _=0;;){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;switch(e.prev=e.next){case 0:if(this._isProcessingItemsChanged||this._pauseProcessingItemsChanged||!(this._itemsChangedQueue.length>0)){e.next=34;break}if(this._isProcessingItemsChanged=!0,t=this._itemsChangedQueue[0],a=t.docInfo,n=t.responses,r=t.isRemote,this._itemsChangedQueue.splice(0,1),i=[],o=this.documents[a.id],e.prev=6,!o){e.next=27;break}return s=0,e.next=11,Promise.all(n.map(function(){var e=c()(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(var n=0,r=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(!t.value.t){e.next=6;break}return e.next=3,k.decryptItemIn(t.value,A.default.crypto,o.getBestEncryption());case 3:e.t0=e.sent,e.next=7;break;case 6:e.t0=B.a.itemIn(t.value);case 7:return a=e.t0,e.abrupt("return",{type:t.type,value:a});case 9:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 11:u=e.sent,r&&A.default.PaneUpdateBatcher.beginUpdateItems(),d=o.dateModified.get()||0,h=0;case 15:if(!(h<u.length)){e.next=25;break}if(!(s++>5e3&&__infLoop&&__infLoop(s))){e.next=18;break}throw new RangeError;case 18:f=u[h],p=f.type,g=f.value,m=g,d=Math.max(d,g.dateModified),r?(v=O.a.getItem(m.id),("Removed"!==p||!v||v.getDocumentOwner().id===a.id&&v.getDocumentOwner()===O.a.getItem(g.parent).getDocumentOwner())&&(this.handleRemoteItemChange(this.documents[a.id],g.id,g),"Removed"===p?E.a.deleteItem(g):(m.docId=a.id,v&&(m.regexpFlags=v.regexpFlags),i.push(m)))):(y=O.a.getItem(g.id))&&y.setDateModified(new Date(g.dateModified));case 22:h++,e.next=15;break;case 25:r&&(A.default.PaneUpdateBatcher.commitUpdateItems(),i.length>0&&E.a.ensureMirror(i,!0)),o&&(this._updateDocModified(o,d),E.a.saveDocument(o));case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(6),x.default.reportError(e.t0);case 32:this._isProcessingItemsChanged=!1,this._itemsChangedQueue.length>0&&this._processItemsChange();case 34:case"end":return e.stop()}}}),e,this,[[6,29]])})));return function(){return e.apply(this,arguments)}}()},{key:"onItemsChange",value:function(e,t,a){var n=t.responses;(n=n.filter((function(e){var t=e.value,a=Object.keys(t).length;return void 0!==t.id&&a--,a>0}))).length>0&&(this._itemsChangedQueue.push({docInfo:e,responses:n,isRemote:a}),this._processItemsChange())}},{key:"convertItemUndefineds",value:function(e,t){var a=this.getItemData(e.id);return Object.keys(t).forEach((function(e){void 0===t[e]&&(void 0===a[e]?delete t[e]:t[e]=null)})),t}},{key:"_coalesceChange",value:function(e,t,a,n){var r=this._coalescedChanges[t],i=!r;n.id||(n.id=t),r&&("Modified"===r.type?r.info=Object.assign(r.info,n):r.type),i&&(r=this._coalescedChanges[t]={id:t,time:Date.now(),doc:e,type:a,info:n}),this.isCoalescing?this.needsCoalesceAfterFinish=!0:this._timeoutCoalesce||(this._timeoutCoalesce=setTimeout(this._runCoalescedChanges,0))}},{key:"_runCoalescedChanges",value:function(){var e=c()(l.a.mark((function e(){return l.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return this._timeoutCoalesce=void 0,this.needsCoalesceAfterFinish=!1,this.isCoalescing=!0,e.prev=3,e.next=6,this._runCoalescedChangesInside();case 6:e.next=11;break;case 8:e.prev=8,e.t0=e.catch(3),x.default.reportError(e.t0);case 11:this.isCoalescing=!1,this.needsCoalesceAfterFinish&&!this._timeoutCoalesce&&(this._timeoutCoalesce=setTimeout(this._runCoalescedChanges,0));case 13:case"end":return e.stop()}}}),e,this,[[3,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"_runCoalescedChangesInside",value:function(){var e=c()(l.a.mark((function e(){var t,a,n,r,i,o,s=this;return l.a.wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:if(!this._isLoaded){e.next=18;break}if(t=x.default.objectValues(this._coalescedChanges),this._coalescedChanges={},!(t.length>0)){e.next=18;break}if(a=t.sort((function(e,t){return e.time-t.time})),n=[],Ce.a.beginBatch(),a.forEach((function(e){var t=e.id,a=e.doc,r=e.info,i=O.a.getItem(t);"Added"===e.type?s.importItem(i,n):"Modified"===e.type?x.default.isEmpty(r)||s._saveItem(a,i,r):"Removed"===e.type&&s._saveItem(a,i,r)})),r=[],i=[],o={},n.map((function(e){if(!o[e.id]){o[e.id]=!0;var t=e.getFullSaveData(),a=s._prepDataSaveLocal(e,t),n=a.localChanges,l=a.remoteChanges;r.push(n),i.push({item:e,itemData:l})}})),Ce.a.endBatch(),this.checkItemsPending(),!(r.length>0)){e.next=17;break}return e.next=17,E.a.ensureMirror(r,!1);case 17:i.forEach((function(e){var t=e.item,a=e.itemData;s._saveItemRemote(t._documentOwner,a,t)}));case 18:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"saveItem",value:function(e,t,a,n,r){x.default.isLocalChange(n)?x.default.isUndoRedoChange(n)||this._coalesceChange(e,t.id,"Modified",a):E.a.saveItem(a,!1,t)}},{key:"addItem",value:function(e,t){var a=this.getItemSaveData(t);this._coalesceChange(e,t.id,"Added",a)}},{key:"deleteItem",value:function(e,t,a){this._coalesceChange(e,t.id,"Modified",{id:t.id,isDeleted:!0})}},{key:"setNote",value:function(e,t,a,n,r){if(x.default.isLocalChange(r))if(a){var i=this.getItemSaveData(a);this._coalesceChange(e,a.id,"Modified",i)}else n&&this._coalesceChange(e,n.id,"Modified",{id:n.id,isDeleted:!0})}},{key:"moveItem",value:function(e,t){var a=e.parent(),n=e.index,r=e.getDocumentOwner(),i=t.getDocumentOwner(),o={id:e.id,parent:a.id,index:n};r!==i&&(o.docId=r.id,o.oldDocId=i.id),this._coalesceChange(r,e.id,"Modified",o)}},{key:"moveItemDocument",value:function(e,t){var a=e.getDocumentOwner();try{x.default.PAssert(206,a.id!==t,"Trying to move document to the same document")}catch(r){x.default.reportError(r)}if(a.id!==t){var n={id:e.id,docId:a.id,oldDocId:t};this._coalesceChange(a,e.id,"Modified",n)}}},{key:"_prepDataSaveLocal",value:function(e,t){t.parent&&x.default.isVMLI(t.parent)&&(t.parent=t.parent.id);var a=x.default.extend({id:e.id},t),n=E.a.getItemData(e.id)||{},r=n.pendingSync||{};Object.keys(t).forEach((function(e){"id"!==e&&"dateModified"!==e&&void 0===r[e]&&(r[e]=n[e])}));var i=Object.assign({pendingSync:r},a);return this.itemsPending[e.id]=Object.assign(this.itemsPending[e.id]||{},r),{localChanges:i,remoteChanges:a}}},{key:"_saveItem",value:function(e,t,a){var n=this._prepDataSaveLocal(t,a),r=n.localChanges,i=n.remoteChanges;E.a.saveItem(r,!1,t),this._saveItemRemote(e,this.convertItemUndefineds(t,i),t),this.checkItemsPending()}},{key:"_saveItemRemote",value:function(){var e=c()(l.a.mark((function e(t,a,n){var r,i,o,s,u,c;return l.a.wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.api){e.next=29;break}return r=a.docId,(i=a.oldDocId)&&n&&(a=Object.assign(n.getFullSaveData(),{oldDocId:i})),this.ensureSafetyOfItemData(a),e.next=8,this.encryptItemForSaveRemote(t,a);case 8:if(o=e.sent,!B.a.validateOutFields(o,!0)){e.next=28;break}return e.next=13,this.getAPIForDocumentItems(t);case 13:if(s=e.sent,!r||!i){e.next=18;break}return e.next=17,this.getAPIForDocumentItems({id:i});case 17:u=e.sent;case 18:return e.next=20,s.update(o,!0);case 20:if(c=e.sent,!u){e.next=24;break}return e.next=24,u.remove({id:a.id},!0);case 24:return c&&(delete this.itemsPending[a.id],this.checkItemsPending(),E.a.saveItem({id:a.id,docId:t.id,pendingSync:void 0},!0)),e.abrupt("return",c);case 28:0;case 29:case"end":return e.stop()}}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"ensureSafetyOfItemData",value:function(e){e&&e.hasOwnProperty("parent")&&(void 0===e.parent||null===e.parent)&&(x.default.reportError(new Error("BAD ERROR: Saving null or undefined parent to item"),x.default.removeNullUndefined(Object.assign({},e,{text:void 0}))),delete e.parent)}},{key:"generateId",value:function(){return C.a.database().ref().push().key}},{key:"addDocument",value:function(){var e=c()(l.a.mark((function e(t,a){var n,r,i,o,s=this;return l.a.wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:(n=t.getRootItem())||t.createVMLIs();try{x.default.PAssert(207,n,"Trying to add a document without a root item")}catch(u){x.default.reportError(u)}if(!n){e.next=11;break}if(r=t.getSaveInfo(),i=this.getItemSaveDataRecursive(n),!1!==a&&(this.documents[t.id]=t,E.a.saveDocument(t,{pendingSync:Date.now()}),E.a.ensureMirror(i,!0)),this.documentsPending&&(this.documentsPending[t.id]=t),!this.api){e.next=11;break}return o=B.a.documentOut(r),e.abrupt("return",Promise.all(i.map((function(e){return s.encryptItemForSaveRemote(t,e)}))).then((function(e){s.api.addDocument(o,e).then((function(e){var a=e.items();a.onLoad(x.default.emptyFn),a.onUpdate(s.onItemsChange.bind(s,r)),e.info.onLoad(x.default.emptyFn,x.default.reportError),e.info.onUpdate(s.onDocInfoChange.bind(s,r),x.default.reportError),e.info.onAclUpdate(s.onDocAclChange.bind(s,r),x.default.reportError),e.info.onAPIItemsUpdate(s.onDocAPIItemsChange.bind(s,t),x.default.reportError)}))})).catch((function(e){return x.default.reportError(e)})));case 11:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"encryptItemForSaveRemote",value:function(){var e=c()(l.a.mark((function e(t,a){return l.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return a.dateModified=this.api.serverTime,delete a.pendingSync,delete a.docId,delete a.oldDocId,delete a.regexpFlags,delete a.noteItem,e.abrupt("return",B.a.encryptItemOut(a,A.default.crypto,t.getBestEncryption()));case 8:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"saveDocument",value:function(e,t){t?E.a.saveDocument(e):(this.documentsPending[e.id]=!0,E.a.saveDocument(e,{pendingSync:Date.now()}),this._saveDocumentRemote(e))}},{key:"_saveDocumentRemote",value:function(){var e=c()(l.a.mark((function e(t){var a,n;return l.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(delete(a=t.getSaveInfo()).dateModified,n=B.a.documentOut(a,{onlyUpdate:!0}),!B.a.validateOutFields(n,!0)){e.next=10;break}return e.next=6,this.getAPIForDocument(t);case 6:e.sent.update(n,!0),e.next=11;break;case 10:0;case 11:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getItemSaveDataRecursive",value:function(e,t){var a=this,n=!t;return t||(t=[]),t.push(e),e.hasNote()&&t.push(e.getNote()),e.hasChildren()&&e.getItems().forEach((function(e){a.getItemSaveDataRecursive(e,t)})),n&&(t=t.map((function(e){return a.getItemSaveData(e)}))),t}},{key:"encodeValue",value:function(e){return x.default.isObject(e)||x.default.isArray(e)?JSON.stringify(e):e}},{key:"decodeValue",value:function(e){if(e&&e.length>1&&("{"===e[0]||"["===e[0]))try{e=JSON.parse(e)}catch(t){0}return e}},{key:"getSetting",value:function(e){return E.a.getSetting(e)}},{key:"setSetting",value:function(e,t,a){var n=Date.now();E.a.setSetting(e,{pendingSync:n,v:t}),this._setSettingRemote(e,a)}},{key:"_setSettingRemote",value:function(e,t){var a=this;if(this.api){var n;if(void 0===t||null===t)n=this.api.user.removeSetting(e);else{t=this.encodeValue(t),this.settingsPending[e]=!0;var r={v:t,d:this.api.serverTime};n=this.api.user.setSetting(e,r)}n.then((function(t){if(t){delete a.settingsPending[e];var n=E.a.getSetting(e);delete n.pendingSync,E.a.setSetting(e,n)}}))}}},{key:"encryptSettings",value:function(e,t,a){var n=this;return Promise.all(A.default.settings.getEncryptedSettings().map(function(){var r=c()(l.a.mark((function r(i){var s,u,c,d,h,f;return l.a.wrap((function(r){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(r.prev=r.next){case 0:return s=o()(i,3),u=s[0],c=s[1],d=s[2],r.next=3,A.default.settings.getEncryptedValue(u,d,a);case 3:h=r.sent,h=n.encodeValue(h),f={v:h,d:n.api.serverTime},t["users/".concat(e,"/s/").concat(c)]=f;case 7:case"end":return r.stop()}}}),r)})));return function(e){return r.apply(this,arguments)}}()))}},{key:"saveBoard",value:function(e,t){var a=Date.now(),n=Object.assign({pendingSync:a},e);E.a.saveBoard(n),t||this._saveBoardRemote(e)}},{key:"_saveBoardRemote",value:function(e){var t=this;if(this.api){var a=x.default.clone(e);delete a.id,delete a.pendingSync,this.boardsPending[e.id]=!0;var n=B.a.boardOut(a);n.d=this.api.serverTime,this.api.user.setBoard(e.id,n).then((function(a){if(a){delete t.boardsPending[e.id];var n=E.a.getBoard(e.id);delete n.pendingSync,E.a.saveBoard(n)}}))}}},{key:"deleteBoard",value:function(e){E.a.deleteBoard(e),this.api&&this.api.user.removeBoard(e)}},{key:"getBoards",value:function(){return E.a.getBoards()}},{key:"deleteAuthToken",value:function(e){this.api&&(e=e.replace(/\./g,","),this.api.user.removeAuthToken(e))}},{key:"getAPIForDocument",value:function(){var e=c()(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.api.getDocumentAPI(t.id);case 2:return a=e.sent,e.abrupt("return",a.info);case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAPIForDocumentItems",value:function(){var e=c()(l.a.mark((function e(t){var a;return l.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.api.getDocumentAPI(t.id);case 2:return a=e.sent,e.abrupt("return",a.items());case 4:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAPIForItem",value:function(e){return this.getAPIForDocumentItems(e.getDocumentOwner())}},{key:"clearAllData",value:function(){var e=c()(l.a.mark((function e(){var t=this;return l.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,E.a.clearAllData();case 3:return e.next=5,Promise.all(Object.keys(this.documents).map(function(){var e=c()(l.a.mark((function e(a){return l.a.wrap((function(e){for(var n=0,r=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(!t.documents[a].isAdmin()){e.next=6;break}return e.next=4,t.getAPIForDocument({id:a});case 4:e.sent.deleteFully();case 6:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return e.abrupt("return",this.api.user.deleteFully());case 8:e.prev=8,e.t0=e.catch(0),x.default.reportError(e.t0);case 11:case"end":return e.stop()}}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"deleteDocument",value:function(e,t){e.isDeleted.set(!0),O.a.documentsArray.notify(),this.saveDocument(e,t),this.notifyDocumentsChanged()}},{key:"undeleteDocument",value:function(e,t){e.isDeleted.set(!1),O.a.documentsArray.notify(),this.saveDocument(e,t)}},{key:"unlistenDocument",value:function(){var e=c()(l.a.mark((function e(t){return l.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.getAPIForDocument(t);case 2:e.sent.unlisten(),this.api.forgetDocument(t.id),delete this.documents[t.id];case 6:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateOnlineStatus",value:function(e){var t=O.a.onlineStatus,a=t.get();e||"Connecting"!==a?(x.default.clearTimeoutOnce("initialOffline"),t.set(e?"Online":"Offline")):S.a.isOnline()?x.default.timeoutOnce("initialOffline",(function(){return t.set("Offline")}),2e3):t.set("Offline")}},{key:"resolveItemConflicts",value:function(e,t){var a=this;A.default.PaneUpdateBatcher.beginUpdateItems();var n=e.dateModified.get()||0;t.forEach((function(t){var r=a.itemsPending[t.id],i=O.a.getItem(t.id),o=a.getItemData(t.id);r&&i&&(Object.keys(r).forEach((function(n){var s=o[n],l=t[n];if(l===r[n]||l===s)s===l&&delete r[n],delete t[n];else if("text"!==n||t.isDeleted)delete t[n];else{var u="Sync Conflict: ".concat(l,"  ;  ").concat(s);r[n]=t.text,a.handleRemoteItemChange(e,i.id,{text:u}),E.a.saveItem({id:i.id,text:u,docId:e.id},!0,i),delete t[n]}})),t.isDeleted&&(t.isDeleted=!1,r.isDeleted=!0,a.handleRemoteItemChange(e,t.id,t),i||(i=O.a.getItem(t.id)),i&&E.a.saveItem({id:i.id,isDeleted:!1,docId:e.id},!0,i))),n=Math.max(n,t.dateModified);var s=t.id;x.default.isEmpty(t)||a.handleRemoteItemChange(e,s,t)})),this._updateDocModified(e,n),A.default.PaneUpdateBatcher.commitUpdateItems()}},{key:"handleRemoteItemChange",value:function(e,t,a){var n,r,i=this.getItemData(t);i?(r={id:t,docId:e.id},Object.keys(a).forEach((function(e){i[e]!==a[e]&&("dateModified"!==e&&"id"!==e&&(n=!0),r[e]=a[e])})),Object.keys(i).forEach((function(e){"items"!==e&&e in a&&void 0!==i[e]&&void 0===a[e]&&(r[e]=void 0,n=!0)})),n&&i.isDeleted&&!r.isDeleted&&(r.text||r.flags||r)&&(r.isDeleted=!1,E.a.saveItem({id:t,isDeleted:!1,docId:e.id},!0))):(n=!0,r=a),n&&F.a.onRemoteChange(e,i,t,r)}},{key:"getEncryptionForDocument",value:function(e){return e.encryptionSentinel?A.default.crypto.getKeyBySentinel(e.encryptionSentinel):e.acl&&Object.keys(e.acl).length>1?A.default.crypto.getGlobalKey():A.default.crypto.getKey(A.default.settings.getBestUserEncryption())}},{key:"_getItemWithText",value:function(e){return{id:e.id,text:e.getRawText()}}},{key:"checkUserEncryption",value:function(e,t){var a=this;if(e){var n=function(){var n;a.loadState.set(I.a.LoadState.NeedPassword),a._pauseProcessingItemsChanged=!0,A.default.menus.promptComplex({title:"Enter password",text:"Please enter your encryption password to unlock your data.",noCancel:!0,fields:[{type:"password"}],validate:function(){var t=c()(l.a.mark((function t(a){var r,i,s;return l.a.wrap((function(t){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(t.prev=t.next){case 0:if(r=o()(a,1),!(i=r[0])){t.next=19;break}return t.prev=2,t.next=5,A.default.crypto.setKey({name:I.a.EncryptionKeys.UserPassword,password:i,sentinelSalt:S.a.getEncryptionUid()});case 5:if(s=t.sent,e!==s.sentinel){t.next=10;break}n=s.key,t.next=12;break;case 10:return A.default.crypto.removeKey(I.a.EncryptionKeys.UserPassword),t.abrupt("return","The password was invalid. Please try again.");case 12:t.next=17;break;case 14:t.prev=14,t.t0=t.catch(2),console.log(t.t0);case 17:t.next=20;break;case 19:return t.abrupt("return","You must enter a password");case 20:case"end":return t.stop()}}}),t,null,[[2,14]])})));return function(e){return t.apply(this,arguments)}}(),callback:function(){var e=c()(l.a.mark((function e(){return l.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(!n){e.next=6;break}return e.next=3,A.default.settings.addEncryptionKey(I.a.EncryptionKeys.UserPassword,n);case 3:t&&t(),a._pauseProcessingItemsChanged=!1,a._processItemsChange();case 6:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}()})},r=A.default.settings.getEncryptionKey(I.a.EncryptionKeys.UserPassword);r?A.default.crypto.decryptText(r,e,S.a.getEncryptionUid()).then((function(e){e===I.a.EncryptionSentinel?t&&t():n()})):n()}else t&&t()}},{key:"_encryptDocumentItems",value:function(){var e=c()(l.a.mark((function e(t,a,n){var r;return l.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,this.getAPIForDocumentItems(a);case 2:return r=e.sent,e.abrupt("return",Promise.all(a.getAllItems().map((function(e){var a={id:e.id,text:e.getRawText()};return new Promise((function(e){B.a.encryptItemOut(a,A.default.crypto,n.key).then((function(a){if(B.a.validateOutFields(a,!0)){var n=r.getPathForItem(a);t[n+"t"]=a.t,e()}}))}))}))));case 4:case"end":return e.stop()}}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"updateDocumentEncryption",value:function(e,t){var a,n=this,r={};return t&&t!==A.default.crypto.getKeyInfo(I.a.EncryptionKeys.Global)?(a=Object.assign({},A.default.settings.encryptionKeys.get()))[e.id]=t.key:t=A.default.crypto.getKeyInfo(I.a.EncryptionKeys.Global),r["documents/".concat(e.id,"/p/s")]=t.sentinel,r["userdocuments/".concat(S.a.getUid(),"/").concat(e.id,"/s")]=t.sentinel,this._encryptDocumentItems(r,e,t).then((function(){return n.api.commitBatch(r).then((function(){a&&(e.encryptionSentinel.set(t.sentinel),A.default.settings.setEncryptionKeys(x.default.clone(a)))})).catch((function(e){return x.default.reportError(e)}))})).catch((function(e){return x.default.reportError(e)}))}},{key:"updateUserEncryption",value:function(){var e=c()(l.a.mark((function e(t){var a,n,r,i,o,s,u,c=this;return l.a.wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:if(!this.api){e.next=34;break}return a={},r=x.default.clone(A.default.settings.encryptionKeys.get()),i=Object.assign({},A.default.settings.encryptionKeys.get()),t!==A.default.crypto.getGlobalKeyInfo()?(n=t.sentinel,i[t.name]=t.key):(n=null,delete i[I.a.EncryptionKeys.UserPassword]),o=A.default.settings.getSettingAbbrev("userEncryptionSentinel"),a[this.api.user.getPathForSettings()+o]={v:n,d:this.api.serverTime},s=Object.keys(this.documents).filter((function(e){return!c.documents[e].encryptionSentinel.get()&&!c.documents[e].isShared()})),e.prev=8,e.next=11,Promise.all(s.map((function(e){return c._encryptDocumentItems(a,c.documents[e],t)})));case 11:return u=S.a.getUid(),e.next=14,xe.a.reEncrypt("users/".concat(u,"/l/"),a,t);case 14:return e.next=16,this.encryptSettings(u,a,t);case 16:return e.next=18,A.default.settings.setEncryptionKeys(i);case 18:return e.prev=18,console.log("commiting batch",a),e.next=22,this.api.commitBatch(a);case 22:null===n&&A.default.crypto.removeKey(I.a.EncryptionKeys.UserPassword),e.next=29;break;case 25:e.prev=25,e.t0=e.catch(18),A.default.settings.setEncryptionKeys(r),x.default.reportError(e.t0);case 29:e.next=34;break;case 31:e.prev=31,e.t1=e.catch(8),x.default.reportError(e.t1);case 34:case"end":return e.stop()}}}),e,this,[[8,31],[18,25]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_checkItemsPendingTimeout",value:function(){var e=this,t={};Object.keys(this.itemsPending).forEach((function(e){var a=E.a.getItemData(e).docId;a&&(t[a]=!0)})),Object.keys(this.documents).forEach((function(a){e.documents[a].isSyncing.set(!!t[a])}))}},{key:"checkItemsPending",value:function(){x.default.timeoutOnce("checkItemsPending",this._checkItemsPendingTimeout,100)}},{key:"decryptItemIn",value:function(e,t,a){return B.a.decryptItemIn(e,t,a)}},{key:"_updateDocModified",value:function(e,t){e.updateModified(t)&&E.a.saveDocument(e)}},{key:"commitBatch",value:function(e){return this.api.commitBatch(e)}}]),a}(R.b),w()(ye.prototype,"onLoadLocal",[P.a],Object.getOwnPropertyDescriptor(ye.prototype,"onLoadLocal"),ye.prototype),w()(ye.prototype,"onLoadRemoteDocuments",[P.a],Object.getOwnPropertyDescriptor(ye.prototype,"onLoadRemoteDocuments"),ye.prototype),w()(ye.prototype,"_runCoalescedChanges",[P.a],Object.getOwnPropertyDescriptor(ye.prototype,"_runCoalescedChanges"),ye.prototype),w()(ye.prototype,"clearAllData",[P.a],Object.getOwnPropertyDescriptor(ye.prototype,"clearAllData"),ye.prototype),w()(ye.prototype,"_checkItemsPendingTimeout",[P.a],Object.getOwnPropertyDescriptor(ye.prototype,"_checkItemsPendingTimeout"),ye.prototype),ye);t.a=new Te},function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(20),l=a.n(s),u=a(21),c=a.n(u),d=a(13),h=a.n(d),f=a(2),p=a(0),g=a(9),m=a(3),v=a.n(m),y=a(4),k=a(29),_=a(146);function b(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=h()(e);if(t){var r=h()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return c()(this,a)}}var w=function(e){l()(a,e);var t=b(a);function a(){return r()(this,a),t.apply(this,arguments)}return o()(a,[{key:"init",value:function(){this.movement=0,this.createObservables({isHovered:!1})}},{key:"getElement",value:function(){var e=this.refs.element;return e.getElement?e.getElement():e}},{key:"closeMenu",value:function(){!1!==this.props.canClose&&y.default.menus.closeContextMenu()}},{key:"onClick",value:function(e){var t=this,a=this.props;a.hasButtons||this.didClickJustFire||!a.onClick||(!1!==a.clickCloses&&this.closeMenu(),a.onClick(e),this.didClickJustFire=!0,setTimeout((function(){t.didClickJustFire=!1}),300))}},{key:"onClickIcon",value:function(e){var t=this.props;t.onClickIcon?(this.closeMenu(),t.onClickIcon(e)):this.onClick(e)}},{key:"onMouseDown",value:function(e){var t=this.props;this.didMouseDown=!0,(t.onClickIcon||p.default.hasClass(e.target,"fancyContextMenuIcon"))&&e.preventDefault()}},{key:"onMouseMove",value:function(e){this.movement+=Math.abs(e.movementX)+Math.abs(e.movementY)}},{key:"onMouseUp",value:function(e){var t=this.props;(this.movement>4||this.didMouseDown)&&(!isNaN(e.button)&&e.button!==f.a.ButtonCode.Left||g.a.mac&&e.ctrlKey||t.onClickIcon&&p.default.hasClass(e.target,"fancyContextMenuIcon")||this.onClick(e))}},{key:"onMouseEnter",value:function(e){this.isHovered.set(!0),this.props.onMouseEnter&&this.props.onMouseEnter(e)}},{key:"onMouseLeave",value:function(){this.isHovered.set(!1)}},{key:"openSubmenu",value:function(){y.default.menus.openContextMenu({fn:this.props.renderSubmenu,element:this.getElement(),onSide:!0})}},{key:"closeSubmenu",value:function(){y.default.menus.closeContextMenu(this.props.renderSubmenu)}},{key:"render",value:function(){var e,t,a=this.props,n=this.state,r=a.onClick||a.hoverEffects||a.renderSubmenu,i=p.default.classNames("fancyContextMenuItem",{flexbox:!a.customLayout},{"c-foreground":!a.faded},{"c-foreground-very-faded":a.faded},{"c-popup-item":r&&!1!==a.hoverEffects},{"selected c-bg-dark":a.active||a.selected||!1!==a.hoverEffects&&n.isHovered},{disabled:a.disabled},{hasIcon:!!a.icon},{hasContent:!!a.children},{bold:a.bold},{hasHotkey:a.hotkey},{"flex-center":a.center},{hasButtons:a.hasButtons},this.props.className);if(a.icon){var o=p.default.isString(a.icon);if(a.onClickIcon||!o)e=v.a.createElement(k.a,{className:"fancyContextMenuIcon",icon:o&&a.icon,iconComponent:!o&&a.icon,tooltip:a.iconTooltip,width:36,height:a.height||28,onClick:this.onClickIcon});else{var s=a.iconColor,l=null===s||void 0===s?void 0:s.startsWith("#"),u=p.default.classNames("fancyContextMenuIcon",{"c-foreground-faded":!s},!l&&s,a.icon),c={fontSize:a.iconSize,height:a.height,lineHeight:a.height&&a.height+"px",color:l&&s};e=v.a.createElement("span",{className:u,style:c,onClick:this.onClickIcon,"data-tooltip":a.iconTooltip})}}var d=a.hotkey;if(d){var h=p.default.classNames("fancyContextMenuHotkey c-foreground-faded",{centered:a.hotkeyCentered}),f=p.default.isString(d)?d:y.default.hotkeys.printHotkeyByName(d.name,d.group);t=v.a.createElement("span",{className:h},f)}var g=Object.assign({height:a.height,lineHeight:a.height&&a.height+"px",cursor:r?"pointer":""},a.style),m={id:a.id,className:i,"data-tooltip":a.tooltip,onMouseMove:a.onMouseMove,style:g,ref:"element"};return r&&(m.onMouseDown=a.renderSubmenu?this.openSubmenu:a.onClick?this.onMouseDown:void 0,m.onMouseUp=a.onClick&&!a.noMouseUp?this.onMouseUp:void 0,m.onMouseMove=a.onClick&&!a.noMouseUp?this.onMouseMove:void 0,m.onClick=a.onClick&&a.noMouseUp?this.onMouseUp:void 0,m.onMouseEnter=!1!==a.hoverEffects?this.onMouseEnter:void 0,m.onMouseLeave=!1!==a.hoverEffects?this.onMouseLeave:void 0),v.a.createElement(a.onClick?_.a:"div",m,e,t?v.a.createElement("span",{className:"f1"},a.children):a.children,t)}}]),a}(a(45).a);t.a=w},function(e,t,a){"use strict";a.d(t,"a",(function(){return d})),a.d(t,"b",(function(){return h}));var n,r=a(16),i=a.n(r),o=a(4),s=a(22),l=a(83),u={theme:"light",paneShadow:function(e){return"0 0 3px rgba(0,0,0,".concat(e?0:.4,")")}},c={theme:"dark",paneShadow:function(e){return"0 0 6px rgba(0,0,0,".concat(e?0:.9,")")}};function d(){var e=Object(s.a)(o.default.DisplaySettings.systemColorTheme,o.default.DisplaySettings.getThemeObs()),t=i()(e,2);t[0],t[1];return"dark"===o.default.DisplaySettings.getColorTheme()?c:u}var h=function(){return n||(n=new l.a([o.default.DisplaySettings.systemColorTheme,o.default.DisplaySettings.getThemeObs()],(function(){return"dark"===o.default.DisplaySettings.getColorTheme()?c:u}))),n}},function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(0),l=function(){function e(){r()(this,e)}return o()(e,[{key:"_ensureListeners",value:function(){return this._listeners||(this._listeners={}),this._listeners}},{key:"clearListeners",value:function(){this._listeners=void 0}},{key:"listen",value:function(){for(var e=0,t=0,a=0,n=this._ensureListeners(),r=arguments.length,i=new Array(r),o=0;o<r;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;i[o]=arguments[o]}for(var l=0;l<i.length-1;++l){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{s.default.PAssert(340,"callbacks"!==i[l],"Invalid event name/grouping")}catch(c){s.default.reportError(c)}try{s.default.PAssert(341,s.default.isString(i[l])||s.default.isFunction(i[l]),"Only accept string or functions for listen")}catch(c){s.default.reportError(c)}n[i[l]]||(n[i[l]]={callbacks:[]}),n=n[i[l]]}var u=i[i.length-1];try{s.default.PAssert(342,s.default.isFunction(u),"Listeners must always be valid functions")}catch(c){s.default.reportError(c)}try{s.default.PAssert(343,n.callbacks.indexOf(u)<0,"Should never listen with the same function twice")}catch(c){s.default.reportError(c)}n.callbacks.push(u)}},{key:"isListening",value:function(){for(var e=0,t=0,a=0,n=this._ensureListeners(),r=arguments.length,i=new Array(r),o=0;o<r;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;i[o]=arguments[o]}var l=i[i.length-1];try{s.default.PAssert(344,s.default.isFunction(l),"Listeners must always be valid functions")}catch(c){s.default.reportError(c)}for(var u=0;u<i.length-1;++u){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;n[i[u]]&&(n=n[i[u]])}return n&&n.callbacks&&n.callbacks.indexOf(l)>=0}},{key:"unlisten",value:function(){for(var e=0,t=0,a=0,n=this._ensureListeners(),r=arguments.length,i=new Array(r),o=0;o<r;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;i[o]=arguments[o]}var l=i[i.length-1];try{s.default.PAssert(345,s.default.isFunction(l),"Listeners must always be valid functions")}catch(c){s.default.reportError(c)}for(var u=0;u<i.length-1;++u){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{s.default.PAssert(346,"callbacks"!==i[u],"Invalid event name/grouping")}catch(c){s.default.reportError(c)}try{s.default.PAssert(347,s.default.isString(i[u]),"Only accept string for unlisten")}catch(c){s.default.reportError(c)}try{s.default.PAssert(348,n[i[u]],"Cannot unlisten something that has never been listened")}catch(c){s.default.reportError(c)}n[i[u]]&&(n=n[i[u]])}try{s.default.PAssert(349,n&&n.callbacks&&n.callbacks.indexOf(l)>=0,"Cannot unlisten something that has never been listened")}catch(c){s.default.reportError(c)}n.callbacks&&n.callbacks.remove(l)}},{key:"fireEvent",value:function(){for(var e=0,t=0,a=0,n=!0,r=this._ensureListeners(),i=arguments.length,o=new Array(i),l=0;l<i;l++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;o[l]=arguments[l]}var u=o[o.length-1];try{s.default.PAssert(350,void 0===u||s.default.isArray(u),"Last argument to fireEvent must be an array")}catch(f){s.default.reportError(f)}for(var c=0;c<o.length-1;++c){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{s.default.PAssert(351,"callbacks"!==o[c],"Invalid event name/grouping")}catch(f){s.default.reportError(f)}try{s.default.PAssert(352,s.default.isString(o[c])||s.default.isArray(o[c]),"Only accept strings for firing event")}catch(f){s.default.reportError(f)}if(!r[o[c]])break;var d=0;r=r[o[c]];for(var h=0;h<r.callbacks.length;++h){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;try{n=r.callbacks[h].apply(this,u)&&n}catch(p){s.default.reportError(p)}}}return n}}]),e}();t.a=l},function(e,t,a){"use strict";var n=a(2),r=a(28),i=a(0),o=a(9),s=a(3),l=a.n(s),u=a(65),c=a(17),d=a(64),h=a(116);function f(e){var t=e.uniqueID,a=e.refScroller,n=e.refInside,r=e.items,o=e.allItems,l=e.defaultItemSize,c=e.initialScrollIndex,f=e.orientation,p=e.header,g=e.overscan,m=e.containerSize,v=Object(s.useRef)({}),y=Object(s.useRef)(o),k=Object(u.a)(r),_=Object(s.useRef)(),b=Object(s.useRef)(),w=Object(s.useRef)(),S=Object(s.useRef)(),D=Object(s.useRef)(),P=Object(s.useRef)(!1),I=!1,E=Object(s.useRef)({}),C=Object(d.a)(),x=Object(s.useCallback)((function(e){var t=a.current,n=P.current;if(t){var r=m||("vertical"===f?S.current.height:S.current.width),o=t.scrollHeight-t.clientHeight;if(void 0===e&&(e=i.default.clamp(Math.max("vertical"===f?t.scrollTop:t.scrollLeft,0),0,o)),n||e!==b.current){var s,u,c,d,h=0;b.current=e,P.current=!1;for(var p=0,k=0,_=Math.min(e+r,t.scrollHeight),D=Math.min(e+r+g,t.scrollHeight),I=e-g,C=y.current.length,x=0;x<C;x++){var A;if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var T=y.current[x],M=null!==(A=v.current[T.id])&&void 0!==A?A:l;void 0===s&&p+M>=e&&(s=x),void 0===u&&p+M>=I&&(u=x,k=p),void 0===c&&p>_&&(c=x-1),void 0===d&&p>D&&(d=x-1),p+=M}if(void 0===c&&(c=C-1),void 0===d&&(d=C-1),!n&&s<E.current.min){for(var L=0,O={},R=Math.max(E.current.min-1,s),F=s;F<=R;F++){if(L++>5e3&&__infLoop&&__infLoop(L))throw new RangeError;O[y.current[F].id]=!0}w.current=O}else w.current=void 0;var N=E.current;if(n||!N||N.min!==s||N.max!==c)return{min:s,max:c,minOverscan:u,maxOverscan:d,marginTop:k,totalSize:p,scrollOffset:b}}}}),[m,l,f,g,a]);k&&k!==r&&(y.current=o,P.current=!0,I=!0,E.current=x());var A=Object(s.useCallback)((function(e){for(var t=0,a=y.current.length,n=0,r=0;r<a;r++){var i;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=y.current[r];if(o.id===e)return n;n+=null!==(i=v.current[o.id])&&void 0!==i?i:l}return-1}),[l]),T=Object(s.useCallback)((function(e){var t=0,a=0;p&&e++;for(var n=0;n<e;n++){var r;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=y.current[n];a+=null!==(r=v.current[null===i||void 0===i?void 0:i.id])&&void 0!==r?r:l}return a}),[l,p]),M=function(){_.current=void 0},L=Object(s.useCallback)((function(){if(void 0!==_.current){var e,n=_.current,r=n.align,o=n.index,s=n.behavior,u=n.offset,c=E.current,d=c.min,h=c.max,g=0===o?0:T(o),m=y.current[o+(p?1:0)],k=null!==(e=v.current[null===m||void 0===m?void 0:m.id])&&void 0!==e?e:l;"auto"===r&&(r=function(e,t,a){return(e<=t?"start":e>=a&&"end")||void 0}(o,d,h)),r&&("end"===r?g-=S.current.height-k-100:"center"===r&&(g=Math.max(g-(S.current.height/2-k),0,0)),g>=0&&(u&&(g-=u),g=Math.max(g,0),i.default.scrollElementTo(a.current,{top:"vertical"===f?g:void 0,left:"horizontal"===f?g:void 0,behavior:s})),i.default.timeoutOnce("clearScrollingTo"+t,M,300))}}),[l,p,T,f,a,t]),O=Object(s.useCallback)((function(e){_.current=e,L()}),[L]);return Object(s.useEffect)((function(){var e=!0;S.current={width:a.current.offsetWidth,height:a.current.offsetHeight};new h.a((function(o){if(o[0].target===n.current){var s=function(){for(var e=0,r=n.current.children,o=r.length,s=!1,u=0,c=0;c<o;c++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var d=r[c],h=d.getAttribute("data-id"),p="vertical"===f?d.offsetHeight:d.offsetWidth;if(p!==v.current[h]){var g,m=w.current;m&&m[h]&&(u+=p-(null!==(g=v.current[h])&&void 0!==g?g:l)),s=!0,v.current[h]=p}}return u>0&&(a.current.scrollTop+=u),s&&_.current&&(i.default.timeoutOnce("clearScrollingTo"+t,M,300),i.default.timeoutOnce("adjustScrolling"+t,L,60)),s}(),u=a.current.offsetWidth,c=a.current.offsetHeight;P.current=!0,u!==S.current.width||c!==S.current.height?(i.default.animationFrameOnce("useItemsInView"+t,r),S.current={width:u,height:c}):(e||s&&(!D.current||Date.now()-D.current>300))&&(e=!1,i.default.animationFrameOnce("useItemsInView"+t,r))}})).observe(n.current);var r=function(e){P.current||(D.current=Date.now());var t=x(e);t&&(E.current=t,C())};if(a.current.addEventListener("scroll",(function(){a.current&&(("vertical"===f?a.current.scrollTop:a.current.scrollLeft)!==b.current&&i.default.animationFrameOnce("useItemsInView"+t,r))})),c){var o=c*l;requestAnimationFrame((function(){"vertical"===f?a.current.scrollTop=o:a.current.scrollLeft=o})),P.current=!0,r(o)}else P.current=!0,r(0)}),[l,f,t]),Object.assign({offsetById:A,offsetByIndex:T,scrollToIndex:O,didItemsChange:I,scrollOffset:b},E.current)}var p="____ReactVirtualList____header",g="____ReactVirtualList____footer",m=0,v=Object(c.b)((function(e){var t=e.item,a=e.rendered,i=e.shouldAnimate,o=t.id,s=!0===i||i(t);return l.a.createElement(r.b.div,{"data-id":o,className:"relative will-change-transform",layout:"position",animateTranslateX:!1,animateScale:!1,transition:s?n.a.TransitionSpringFastest:n.a.TransitionImmediate},a)}));t.a=Object(c.a)(Object(s.forwardRef)((function(e,t){var a=e.className,n=e.style,r=e.items,c=e.header,d=e.footer,h=e.floating,y=e.containerSize,k=e.renderItem,_=e.onRangeChanged,b=e.defaultItemSize,w=e.initialScrollIndex,S=e.shouldAnimate,D=e.onEndReached,P=e.orientation,I=e.overscan,E=e.shouldMemoize,C=e.pinIDs,x=e.children;var A=Object(s.useRef)(),T=Object(s.useRef)(),M=Object(s.useMemo)((function(){return m++}),[]),L=Object(u.a)(S),O=Object(s.useRef)({});P||(P="vertical"),!r&&x&&(r=l.a.Children.map(x,(function(e,t){return{id:t}})));var R=r;c&&(R=[{id:p}].concat(r)),d&&(R=R.concat({id:g}));var F=f({uniqueID:M,refScroller:A,refInside:T,items:r,allItems:R,defaultItemSize:b,initialScrollIndex:w,orientation:P,containerSize:y,header:!!c,overscan:I||0}),N=F.min,B=F.max,j=F.minOverscan,U=F.maxOverscan,H=F.marginTop,V=F.totalSize,W=F.scrollToIndex,z=F.didItemsChange,q=(F.scrollOffset,F.offsetById),G=F.offsetByIndex;E&&(z||L!==S)&&(O.current={});var K=Object(u.a)({min:N,max:B}),Y=Object(s.useRef)({min:N,max:B,allItems:R});Y.current={min:N,max:B,allItems:R};var X=Object(s.useCallback)((function(){for(var e=0,t={},a=Y.current.min;a<=Y.current.max;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=R[a];n&&(t[n.id]=!0)}Object.keys(O.current).forEach((function(e){t[e]||delete O.current[e]}))}),[R]);if(_&&(!K||K.min!==N||K.max!==B)){var Q=Math.max(0,N-(c?1:0)),J=Math.max(B-(c?1:0));i.default.animationFrameOnce("onRangeChanged"+M,(function(){return _({startIndex:Q,endIndex:J})})),E&&i.default.timeoutOnce("cullRendered"+M,X,2e3)}D&&K&&K.max!==B&&B===R.length-1&&i.default.animationFrameOnce("onEndReached"+M,(function(){return D(B)})),Object(s.useImperativeHandle)(t,(function(){return{scrollTo:function(e,t){return i.default.scrollElementTo(A.current,{top:e,behavior:t})},scrollToIndex:W,offsetById:q,offsetByIndex:G,getScrollOffset:function(){return A.current.scrollTop}}}));var Z,$,ee=[];if(void 0!==j&&void 0!==U){for(var te=0,ae=function(e,t){var a=t-(c?1:0),n=E&&O.current[e.id];if(!n){var i=e.id===p&&c||e.id===g&&d||(null===k||void 0===k?void 0:k(e,a,r))||x[a];n=S?l.a.createElement(v,{key:e.id,item:e,rendered:i,shouldAnimate:S}):l.a.createElement("div",{key:e.id,"data-id":e.id,className:"relative"},i),E&&(O.current[e.id]=n)}ee.push(n)},ne=null===C||void 0===C?void 0:C.slice(),re=j;re<=U;re++){if(te++>5e3&&__infLoop&&__infLoop(te))throw new RangeError;var ie=R[re];ie&&(ae(ie,re),ne&&ne.includes(ie.id)&&ne.remove(ie.id))}(null===ne||void 0===ne?void 0:ne.length)>0&&ne.forEach((function(e,t){var a=R.find((function(t){return t.id===e}));a&&ee.push(ae(a,U+1+t))})),Z={marginTop:H},$={width:"horizontal"===P?V:1,height:"vertical"===P?V:1,zIndex:-1,top:0}}var oe=i.default.classNames("overflow-y-auto h-full relative",{"overflow-y-mobile":o.a.isMobile},a);return l.a.createElement("div",{className:oe,style:n,ref:A},l.a.createElement("div",{className:"pointer-events-auto",style:Z,ref:T},ee),l.a.createElement("div",{className:"absolute ",style:$}),h)})))},,function(e,t,a){"use strict";var n;a.d(t,"a",(function(){return n})),function(e){e[e.SingleFile=1]="SingleFile",e[e.FolderStruct=2]="FolderStruct",e[e.SubFolder=3]="SubFolder",e[e.Search=4]="Search",e[e.DataPage=5]="DataPage",e[e.ChangeList=6]="ChangeList",e[e.SingleFolder=7]="SingleFolder"}(n||(n={}))},,,function(e,t,a){"use strict";var n,r=a(5),i=a.n(r),o=a(12),s=a.n(o),l=a(38),u=a.n(l),c=a(7),d=a.n(c),h=a(8),f=a.n(h),p=a(10),g=a.n(p),m=a(35),v=a(11),y=a(2),k=a(0),_=a(4),b=a(18),w=a(90),S=a(37),D=a(112),P=a(61),I=a(15),E=a(76),C=(n=function(){function e(t){var a=t.id,n=t.text,r=t.dateModified,i=t.rootData,o=t.acl,s=t.backing,l=t.encryptionSentinel,u=t.backups,c=t.isDeleted;d()(this,e);try{k.default.PAssert(208,a,"Document must have id")}catch(h){k.default.reportError(h)}try{k.default.PAssert(209,o,"Document must have acl")}catch(h){k.default.reportError(h)}try{k.default.PAssert(210,i&&i.isRoot,"Document must have root item set to root")}catch(h){k.default.reportError(h)}i&&!i.isRoot&&(i.isRoot=!0),this.id=a,this.text=new I.a(n),this._root=i,this._backing=s,this._isLocalOnly=s.isLocalOnly,this.isSyncing=new I.a(!1),this.acl=new I.a(o),this.dateModified=new I.a(r),this.encryptionSentinel=new I.a(l),this.isDecrypted=this.canDecrypt(),this.backups=new I.a(u),this.isDeleted=new I.a(c),i.archivedItems&&(this._archivedItemsData=i.archivedItems,delete i.archivedItems),i.deletedItems&&(this._deletedItemsData=i.deletedItems,delete i.deletedItems),this._index=_.default.settings.documentIndices.getProperty(a)}return f()(e,[{key:"createVMLIs",value:function(){if(!this._rootItem&&!this.isDeleted.get()){var e=_.default.itemStoreManager.getDefaultItemStore();this._rootItem=e.createItemRaw(this._root,{documentOwner:this,changeType:y.a.ChangeType.Auto,isRoot:!0}),e.addItemToRoot(this._rootItem)}}},{key:"_ensureRootItem",value:function(e,t){e||(this["_root".concat(t,"Item")]=_.default.itemStoreManager.getDefaultItemStore().createItemRaw({id:void 0,text:"".concat(t," Root"),docId:this.id},{documentOwner:this,changeType:y.a.ChangeType.Auto,isRoot:!0}))}},{key:"ensureRootArchivedItem",value:function(){this._ensureRootItem(this._rootArchivedItem,"Archived")}},{key:"ensureRootDeletedItem",value:function(){this._ensureRootItem(this._rootDeletedItem,"Deleted")}},{key:"_ensureHelper",value:function(e,t,a,n){if(e(),this[t]){var r=this[t];delete this[t];var i=this[a];P.a.beginBatch(i),r.forEach(n),P.a.commitBatch(i)}}},{key:"ensureArchivedItems",value:function(){this._ensureHelper(this.ensureRootArchivedItem,"_archivedItemsData","_rootArchivedItem",this.createArchivedVMLI)}},{key:"ensureDeletedItems",value:function(){this._ensureHelper(this.ensureRootDeletedItem,"_deletedItemsData","_rootDeletedItem",this.createDeletedVMLI)}},{key:"_createVMLI",value:function(e,t,a){t.isNote||!t.text&&!("Deleted"===a?t.deletedItems:t.archivedItems)||e.items.push(_.default.itemStoreManager.getDefaultItemStore().createItemRaw(t,{parent:e,documentOwner:this,changeType:y.a.ChangeType.Auto}))}},{key:"createArchivedVMLI",value:function(e){this._createVMLI(this._rootArchivedItem,e,"Archived")}},{key:"createDeletedVMLI",value:function(e){this._createVMLI(this._rootDeletedItem,e,"Deleted")}},{key:"_archiveDeleteHelper",value:function(e,t,a,n,r,i,o){var s=e.parent();o||s[a]()||(s.items.remove(e),n(),this[r].items.push(e));i(e,!0,t)}},{key:"archiveItem",value:function(e,t,a){this._archiveDeleteHelper(e,t,"isArchived",this.ensureRootArchivedItem,"_rootArchivedItem",this.propagateArchive,a)}},{key:"_unActionHelper",value:function(e,t,a,n,r){var i=e.parent(),o=i&&!i[a]()&&i!==n?i:this._rootItem;i&&i!==o&&i.items.indexOf(e)>=0&&i.items.remove(e),n&&n.items.remove(e),e.setParent(o),o.items.includes(e)||e.isNote()||o.items.insertSorted(e,S.a.compareItemIndex),r(e,!1,t)}},{key:"_propagateHelper",value:function(e,t,a,n,r,i){var o=this;e[n](t,a);var s=u()({id:e.id},r,t);b.a.saveItem(e,s,a,y.a.SaveFlag.All),i&&e.items.get()&&e.items.forEach((function(e){return o._propagateHelper(e,t,a,n,r,i)}))}},{key:"unArchiveItem",value:function(e,t){this._unActionHelper(e,t,"isArchived",this._rootArchivedItem,this.propagateArchive)}},{key:"propagateArchive",value:function(e,t,a){this._propagateHelper(e,t,a,"setArchived","isArchived",!0)}},{key:"deleteItem",value:function(e,t,a){this._archiveDeleteHelper(e,t,"isDeleted",this.ensureRootDeletedItem,"_rootDeletedItem",this.propagateDelete,a)}},{key:"unDeleteItem",value:function(e,t){this._unActionHelper(e,t,"isDeleted",this._rootDeletedItem,this.propagateDelete)}},{key:"propagateDelete",value:function(e,t,a){this._propagateHelper(e,t,a,"setDeleted","isDeleted",!t)}},{key:"getRootData",value:function(){return this._root}},{key:"getRootItem",value:function(){return this._rootItem}},{key:"getRootArchivedItem",value:function(){return this.ensureArchivedItems(),this._rootArchivedItem}},{key:"getRootDeletedItem",value:function(){return this.ensureDeletedItems(),this._rootDeletedItem}},{key:"getBacking",value:function(){return this._backing}},{key:"getSaveInfo",value:function(e,t){var a={id:this.id,version:1,root:this._root.id,text:this.text.get(),dateModified:this.dateModified.get()||Date.now(),isDeleted:this.isDeleted.get()};return e||(a.acl=this.acl.get()),t||(a.encryptionSentinel=this.encryptionSentinel.get()),a}},{key:"setText",value:function(e,t){var a=this.text.get();this.text.set(e,t),this._isLocalOnly&&this.getBacking().renameDocument(this,a)}},{key:"setIndex",value:function(e){this._index=e,_.default.settings.documentIndices.setProperty(this.id,e)}},{key:"onRemoteUpdate",value:function(e){e.date,void 0!==e.backups&&this.backups.set(e.backups),void 0!==e.text&&this.setText(e.text),void 0!==e.isDeleted&&(e.isDeleted&&!this.isDeleted.get()?this.delete(!0):!e.isDeleted&&this.isDeleted.get()&&this.undelete(!0)),void 0!==e.acl&&this.acl.set(k.default.clone(e.acl)),void 0!==e.encryptionSentinel&&this.encryptionSentinel.set(e.encryptionSentinel),e.itemsPlaintext&&this.processPlaintextItems(e.itemsPlaintext)}},{key:"processPlaintextItems",value:function(e){var t=this;_.default.PaneUpdateBatcher.beginUpdateItems();var a=Object.keys(e);a.forEach((function(a){e[a].id=a;var n=S.a.itemIn(e[a]);if(!b.a.getItem(a)){var r=b.a.createVMLI(n,{documentOwner:t,parent:t._rootItem,changeType:y.a.ChangeType.Local});t._rootItem.insertItem(r,0)}})),_.default.PaneUpdateBatcher.commitUpdateItems(),this._backing.deleteDocAPIItems(this,a)}},{key:"getBestEncryptionInfo",value:function(){var e=_.default.crypto.getGlobalKeyInfo();return this.encryptionSentinel.get()?e.sentinel===this.encryptionSentinel.get()?e:_.default.crypto.getKeyInfo(this.id):this.isShared()?e:_.default.crypto.getKeyInfo(_.default.settings.getBestUserEncryption())}},{key:"getBestEncryption",value:function(){return this.getBestEncryptionInfo().key}},{key:"toJSONObject",value:function(){var e=s()(i.a.mark((function e(){var t,a,n,r,o,s=arguments;return i.a.wrap((function(e){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:{},a=this.getBestEncryptionInfo(),t.encryptionKey=a.key,e.next=5,D.a.getItemsData(this.getRootItem(),t);case 5:if(n=e.sent,!t.exportArchived){e.next=11;break}return e.next=9,D.a.getItemsData(this.getRootArchivedItem(),t);case 9:r=e.sent,n=n.concat(r);case 11:return o={moodoVer:_.default.settings.localDataVersion.get(),doc:this.getSaveInfo(!0,!t.encrypt),items:n},t.encrypt&&(o.sentinel=a.sentinel),e.abrupt("return",o);case 14:case"end":return e.stop()}}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toJSON",value:function(){var e=s()(i.a.mark((function e(t){return i.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.t0=JSON,e.next=3,this.toJSONObject(t);case 3:return e.t1=e.sent,e.abrupt("return",e.t0.stringify.call(e.t0,e.t1));case 5:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"generateExport",value:function(e,t,a){return D.a.generateExport(this.getAllItems(t),e,void 0,void 0,void 0,void 0,a)}},{key:"toHTML",value:function(e,t,a){return this.generateExport({html:!0},{includeArchived:e,includeNotes:t,noSelf:!0},a).html}},{key:"toPlaintext",value:function(e,t,a){return this.generateExport({plain:!0},{includeArchived:e,includeNotes:t,noSelf:!0},a).plain}},{key:"toOPML",value:function(e,t,a){return D.a.generateOPML(this.getAllItems({includeArchived:e,includeNotes:t,noSelf:!0}),a)}},{key:"delete",value:function(e){var t=this;this.isDeleted.set(!0),this.getBacking().deleteDocument(this,e);var a=_.default.itemStoreManager.getDefaultItemStore();a.removeItemFromRoot(this._rootItem),this.getAllItems().forEach((function(e){return a.removeItemFromStore(e.id)})),delete this._rootItem,_.default.PaneManager.runForEachPane((function(e){if(e.document.get()===t){var a=b.a.getDefaultDocument();e.setDocument(a)}}))}},{key:"undelete",value:function(e){this.isDeleted.set(!1),this.createVMLIs(),this.getBacking().undeleteDocument(this,e)}},{key:"getAllItems",value:function(e){var t=[],a=this._rootItem;return this._getAllItems(t,a,e||{}),e&&e.includeArchived&&this._getAllItems(t,this.getRootArchivedItem(),e||{}),t}},{key:"_getAllItems",value:function(e,t,a){if(t){var n=0;a&&a.noSelf||e.push(t),delete a.noSelf,a&&!1===a.includeNotes||!t.hasNote()||e.push(t.getNote());for(var r=t.items.get(),i=0;i<r.length;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this._getAllItems(e,r[i],a)}}}},{key:"updateModified",value:function(e){var t=e>this.dateModified.get();if(t){this.dateModified.set(e);var a=_.default.settings.lastSync;(!a.get()||e>a.get())&&a.set(e)}return t}},{key:"isShared",value:function(){return Object.keys(this.acl.get()).length>1}},{key:"isAdmin",value:function(){if(this._isLocalOnly)return!0;var e=this.acl.get()[m.a.getUid()];return e&&e.r===y.a.DocumentAccessRoles.Admin}},{key:"getCollaborators",value:function(){var e=this.acl.get();return Object.keys(e).filter((function(e){return e!==m.a.getEncryptionUid()})).map((function(t){return{uid:t,name:e[t].t,email:e[t].e,role:e[t].r}}))}},{key:"shareWithUser",value:function(e,t){return E.a.shareDocument({docID:this.id,docName:this.text.get(),encryptionSentinel:this.encryptionSentinel.get(),emails:e,accessRole:t})}},{key:"onAclUpdate",value:function(e){var t=k.default.clone(this.acl.get());if(Object.keys(e).forEach((function(a){e[a]?t[a]=e[a]:delete t[a]})),!k.default.deepEqual(t,this.acl.get()))return this.acl.set(t),!0}},{key:"canDecrypt",value:function(){var e=this.encryptionSentinel.get();return this.isDecrypted=!e||_.default.crypto.canDecryptSentinel(e),this.isDecrypted}},{key:"addBackup",value:function(e){this.backups.get()?this.backups.get()[e]="":this.backups.set(u()({},e,""))}},{key:"getLastBackup",value:function(){var e=this.backups.get();if(e){var t=Object.keys(e).sort();return+t[t.length-1]}return 0}},{key:"getLastBackupDrive",value:function(){var e=_.default.settings.backupsDrive.get();return e&&e[this.id]||0}},{key:"isLocalOnly",value:function(){return this._isLocalOnly}},{key:"parseAll",value:function(e){k.default.parseSubtree(this.getRootItem(),e)}},{key:"index",get:function(){return this._index}}],[{key:"create",value:function(t){var a=t.id,n=t.text,r=t.rootData,i=t.backing;return new e({id:a||b.a.generateID(),rootData:r,text:n,acl:u()({},m.a.getUid(),{r:y.a.DocumentAccessRoles.Admin,e:m.a.getAccountEmail(),t:m.a.getAccountName()}),dateModified:Date.now(),backing:i||w.a,encryptionSentinel:void 0})}},{key:"fromData",value:function(t,a){var n={};return Object.keys(t.acl).forEach((function(e){var a=t.acl[e];n[e]=k.default.isNumber(a)?{r:a,t:m.a.getAccountName(),e:m.a.getAccountEmail()}:a})),new e({id:t.id,rootData:t.rootData,text:t.text,acl:n,dateModified:t.dateModified,backing:a,encryptionSentinel:t.encryptionSentinel,isDeleted:t.isDeleted})}}]),e}(),g()(n.prototype,"ensureRootArchivedItem",[v.a],Object.getOwnPropertyDescriptor(n.prototype,"ensureRootArchivedItem"),n.prototype),g()(n.prototype,"ensureRootDeletedItem",[v.a],Object.getOwnPropertyDescriptor(n.prototype,"ensureRootDeletedItem"),n.prototype),g()(n.prototype,"createArchivedVMLI",[v.a],Object.getOwnPropertyDescriptor(n.prototype,"createArchivedVMLI"),n.prototype),g()(n.prototype,"createDeletedVMLI",[v.a],Object.getOwnPropertyDescriptor(n.prototype,"createDeletedVMLI"),n.prototype),g()(n.prototype,"propagateArchive",[v.a],Object.getOwnPropertyDescriptor(n.prototype,"propagateArchive"),n.prototype),g()(n.prototype,"propagateDelete",[v.a],Object.getOwnPropertyDescriptor(n.prototype,"propagateDelete"),n.prototype),n);t.a=C},,function(e,t,a){"use strict";var n=a(37),r=a(7),i=a.n(r),o=a(8),s=a.n(o),l=a(20),u=a.n(l),c=a(21),d=a.n(c),h=a(13),f=a.n(h);function p(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=f()(e);if(t){var r=f()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return d()(this,a)}}var g=function(e){u()(a,e);var t=p(a);function a(){var e;i()(this,a),(e=t.call(this,"moodonew")).version(1).stores({documents:"id",items:"id",settings:"id",boards:"id",localStorage:"id",contacts:"id"});var n={};["plugins","gmail","drive","gcal"].forEach((function(e){return n[e]="id"})),e.version(2).stores(n),e.tableNames=["documents","items","settings","boards","localStorage","contacts","plugins","Drive","GCalendar","Gmail"];var r={GmailMessages:"id",gmail:null,drive:null,gcal:null};return e.tableNames.forEach((function(e){return r[e]="id"})),r.Gmail="id,date",e.version(3).stores(r),r.pluginsNew="id",e.tableNames.push("pluginsNew"),e.version(4).stores(r),e}return s()(a,[{key:"beginBatch",value:function(){}},{key:"commitBatch",value:function(){}},{key:"getAsArray",value:function(e){return this[e].toArray()}}]),a}(a(177).a),m=function(e,t,a){var n=function(e,t,a){for(var n=0,r=0,i=e.length-1;r<=i;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=r+i>>1,s=a(e[o],t);if(s<0)r=o+1;else{if(!(s>0))return o;i=o-1}}return r}(e,t,a);return e.splice.apply(e,[n,0,t]),n},v=function(e,t){var a=0,r={},i={},o=function(e){r[e.id]||(r[e.id]=e,e.isRoot&&(i[e.docId]=e))};e.length>0&&(e.forEach(o),t&&Object.keys(t).forEach((function(e){o(t[e])})));for(var s=0;s<e.length;s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var l=e[s],u=l.parent,c=r[u],d=!1;if(l.isArchived||l.isDeleted){var h=l.isDeleted,f=(h?"deleted":"archived")+"Items";if(!c||c.isRoot||(h?!c.isDeleted:!c.isArchived)){var p=i[l.docId];p&&(p[f]||(p[f]=[]),p[f].push(l)),d=!0}}d||(!c&&l.isRoot,l.note&&(l.noteItem=r[l.note]),c&&(32===(32&l.flags)?c.note=l.id:void 0!==l.text&&(c.items||(c.items=[]),void 0===l.index&&(l.index=""+c.items.length),m(c.items,l,n.a.compareItemIndex))))}return r},y=function(e){for(var t=0,a=0;a<e.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e[a]=n.a.itemIn(e[a])}return v(e)},k=function(){return new g};t.a={load:function(e,t){e||(e=k());var a=e.tableNames,r={},i=a.length;a.forEach((function(e){return r[e]=void 0}));var o=function(e,a){if(a||(a=[]),r[e]=a,"documents"===e){for(var o=0,s=a,l={},u={},c=0;c<s.length;c++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var d=n.a.documentIn(s[c]);l[s[c].id]=d,d.pendingSync&&(u[d.id]=!0)}r.documentsPending=u,r.documents=l}else if("items"===e){var h=function(e){var t={};return e=y(e),Object.keys(e).forEach((function(a){var n=e[a],r=n.items;if(n.pendingSync&&(t[n.id]=n.pendingSync),r&&(Number.NEGATIVE_INFINITY,r.find((function(e){32!==(32&e.flags)&&e.index}))))for(var i=0,o=0;o<r.length;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=r[o];s.pendingSync={index:s.index},s.index=o,t[s.id]=!0}})),{items:e,itemsPending:t}}(a),f=h.items,p=h.itemsPending;r.items=f,r.itemsPending=p}else if("settings"===e||"boards"===e){var g=function(e){var t={},a={};return e.forEach((function(e){t[e.id]=e,e.pendingSync&&(a[e.id]=e.pendingSync)})),{values:t,pending:a}}(a),m=g.values,v=g.pending;r[e]=m,r[e+"Pending"]=v,"boards"===e&&Object.keys(m).forEach((function(e){m[e]=n.a.boardIn(m[e])}))}else if("plugins"===e){var k={};a.forEach((function(e){k[e.plugin]||(k[e.plugin]={}),k[e.plugin][e.id]=e})),r[e]=k}else if("localStorage"===e){var _={};a.forEach((function(e){void 0!==e.value?_[e.id]=e.value:Object.keys(e).forEach((function(t){return _[t]=e[t]}))})),r[e]=_}else if("contacts"===e)r[e]=a.map((function(e){return n.a.contactIn(e)}));else if("GCalendar"===e||"Gmail"===e||"GmailMessages"===e||"pluginsNew"===e){var b={};a.forEach((function(e){return b[e.id]=e})),r[e]=b}0===--i&&t(r)},s=!1;for(var l in e.beginBatch(),r)e.getAsArray(l).then(o.bind(e[l],l)).catch((function(e){s||(s=!0,console.log(e),t({error:{name:e.name,message:e.message}}))}));e.commitBatch()},transformItems:y,createItemHierarchy:v,createDB:k}},function(e,t,a){"use strict";var n=a(16),r=a.n(n),i=a(7),o=a.n(i),s=a(8),l=a.n(s),u=a(2),c=a(0),d=a(25),h=/([^\+]+)\+(\d+)/,f=u.a.MatchState,p=function(){function e(){o()(this,e)}return l()(e,[{key:"checkItemTextSearchArr",value:function(e,t,a){for(var n=0,r=[],i=0;i<a.length;i++){var o=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var s=a[i],l=0;l<s.length;l++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=s[l],d=u.text;try{c.default.PAssert(1198,d,"Each value in the search array should be valid at this point")}catch(p){c.default.reportError(p)}if(!u.isNegated){var h=this.checkItemText(e,t,u);r[i]=h?f.Yes:f.No}if(r[i]===f.No)break}}return this.orMatchStates(r)}},{key:"getSearchArr",value:function(e){var t,a=0,n=0,i=e.toLowerCase().trim(),o=/(-*)["\u201c\u201d]([^"\u201c\u201d]*)["\u201c\u201d]|[^\s"\u201c\u201d]+/gi,s=[],l=0;do{if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;null!=(t=o.exec(i))&&s.push(t[2]?(t[1]?t[1]:"")+(t[2]?t[2]:""):t[0]),l++}while(null!=t&&l<1e3);for(var h=[],f=[],p=0,g=0;g<s.length;++g){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var m=s[g],v=m.length>1&&m.startsWith("-"),y=v?m.substr(1):m;if(y&&"and"!==y&&"$"!==y)if(g>0&&("or"===y||"|"===y||"||"===y))p++;else{h[p]||(h[p]=[]);var k={text:y,isNegated:v};if(y.startsWith(u.a.SearchDates.Before)||y.startsWith(u.a.SearchDates.After)||y.startsWith(u.a.SearchDates.Date)||y.startsWith(u.a.SearchDates.Between)){y.endsWith(":")&&(y+=s[++g]);var _=y.split(":"),b=r()(_,2),w=b[0],S=b[1],D=void 0,P=void 0;if(S){if("date"!==w||"overdue"!==S&&"any"!==S&&"none"!==S)if("between"===w){var I=S.split(","),E=r()(I,2),C=E[0],x=E[1];C&&x&&(D=this.dateFromSearchText(C),P=this.dateFromSearchText(x))}else D=this.dateFromSearchText(S);else D=S;D&&(k.dateInfo={prefix:w,dateText:S,date:D,date2:P,dateCleared:D&&!c.default.isString(D)&&d.a.clearTime(D),dateCleared2:P&&d.a.clearTime(P)})}}h[p].push(k),v||f.push(y)}}return{searchArr:h,searchWords:f}}},{key:"checkItemText",value:function(e,t,a,n){var r=!0,i=a.text;if(a.dateInfo)r=this._matchItemDate(e,a);else if(i.length>0){r=!1;var o=i===u.a.SearchFilterTexts.Pri0,s=i===u.a.SearchFilterTexts.Pri1,l=i===u.a.SearchFilterTexts.Pri2;if(c.default.isPrefixTask(i))r=e.isPrefixTask();else if(i===u.a.SearchFilterTexts.Star)r=e.isStarred(n);else if(o||s||l){r=e.getPriority(n)===(o&&u.a.VMLIFlag.P0||s&&u.a.VMLIFlag.P1||l&&u.a.VMLIFlag.P2)}else r=i===u.a.Prefix.Bullet?e.isPrefixBullet():i===u.a.Prefix.Header||i===u.a.Prefix.Header2?e.isPrefixHeader():i===u.a.InlinePrefix.ItemLink?e.hasItemLinks():r||(null===t||void 0===t?void 0:t.indexOf(i))>=0}return r}},{key:"dateFromSearchText",value:function(e){var t=e.match(h);return t?Date.parse(t[1]).addDays(+t[2]):Date.parse(e)}},{key:"_matchItemDate",value:function(e,t){var a=e.getNextDate(),n=t.dateInfo,r=n.prefix,i=n.date,o=n.date2,s=n.dateCleared;n.dateCleared2;if(a){var l=e.getMooDate();if("any"===i)return!0;if("none"===i)return!1;if("overdue"===i&&(i=d.a.getToday(),r="before"),l.isRepeatDate()){if("before"===r)return l.getFirstDate()<i;if("date"===r)return l.isOnDate(i);if("after"===r)return!!l.getNext(i);if("between"===r)return!!l.getNext(i)&&l.getFirstDate()<o;0}return!i||"before"===r&&a<i||"date"===r&&+d.a.clearTime(a)===+s||"after"===r&&a>=i||"between"===r&&a>=i&&a<=o}if("none"===i)return!0}},{key:"orMatchStates",value:function(e){for(var t,a=0,n=0;n<e.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t===f.Unknown&&e[n]===f.Negated)t=f.Negated;else if(t!==f.Yes&&e[n]===f.No)t=f.No;else if(e[n]===f.Yes||e[n]===f.Unknown){t=f.Yes;break}}return t}}]),e}();t.a=new p},,,function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(3),r=a(116),i=a(64);function o(e){var t=Object(n.useRef)({width:0,height:0}),a=Object(i.a)(),o=Object(n.useCallback)((function(){if(e.current){var n=t.current,r=(i=e.current)?{width:i.offsetWidth,height:i.offsetHeight}:{width:0,height:0};!r||r.width===n.width&&r.height===n.height||(t.current=r,a())}var i}),[e,a]);return Object(n.useLayoutEffect)((function(){var t=e.current;if(t){o();var a=new r.a(o);return a.observe(t),function(){a.disconnect(t),a=null}}}),[e.current]),t.current}},function(e,t,a){"use strict";var n=a(52),r=a.n(n),i=a(7),o=a.n(i),s=a(8),l=a.n(s),u=a(20),c=a.n(u),d=a(21),h=a.n(d),f=a(13),p=a.n(f),g=a(2),m=a(28),v=a(0),y=a(9),k=a(3),_=a.n(k),b=a(4),w=a(150),S=a(116),D=a(45),P=a(126);function I(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=p()(e);if(t){var r=p()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return h()(this,a)}}var E=function(e){c()(a,e);var t=I(a);function a(){return o()(this,a),t.apply(this,arguments)}return l()(a,[{key:"init",value:function(){var e=this.props;this.refMenu=Object(k.createRef)(),e.supportArrows&&(this.selectedIndex=b.default.hotkeys.registerArrowsMode("FancyContextMenu",!0,this.getNumItems,this.onArrowsModeSelect,this.onArrowsModeKey),e.fromHotkey&&this.selectedIndex.set(0,!1),e.onSelectedIndexChanged&&this.selectedIndex.listen(e.onSelectedIndexChanged))}},{key:"close",value:function(){try{v.default.PAssert(1194,this.props.name,"Cannot call close on a menu without a name")}catch(e){v.default.reportError(e)}b.default.menus.closeContextMenu(this.props.name)}},{key:"getHotkeys",value:function(){var e=this.props,t=[b.default.hotkeys.createEscape(this.onEscapeKey)];return e.hotkeys&&(t=t.concat(e.hotkeys)),t}},{key:"getRefAtIndex",value:function(e){return this.refs["el_"+e]}},{key:"onMount",value:function(){var e=this;if(y.a.windowSize.listen(this.onResize),this.props.noBackdrop&&document.addEventListener("mousedown",this.onMouseDownNoBackdrop,!0),this.updateState(),S.a){this.resizeObserver=new S.a((function(t){e.updateState()}));try{this.resizeObserver.observe(this.refMenu.current)}catch(t){}}}},{key:"onUnmount",value:function(){y.a.windowSize.unlisten(this.onResize),this.props.supportArrows&&b.default.hotkeys.exitArrowsMode("FancyContextMenu"),this.props.noBackdrop&&document.removeEventListener("mousedown",this.onMouseDownNoBackdrop,!0),this.resizeObserver&&this.resizeObserver.unobserve(this.refMenu.current)}},{key:"onResize",value:function(){var e=this;setTimeout((function(){return e._isMounted&&e.updateState()}),200)}},{key:"getState",value:function(){var e=this.updatePosition();return e.left<=8&&0===e.top&&this._lastPos&&(e=this._lastPos),this._lastPos=e,{windowSize:y.a.windowSize,selectedIndex:this.selectedIndex,left:e.left,top:e.top,right:e.right,bottom:e.bottom,maxHeight:e.maxHeight}}},{key:"getElement",value:function(){return this.refMenu.current}},{key:"onMouseDownNoBackdrop",value:function(e){v.default.findParent(e.target,"fancyContextMenu")||b.default.menus.closeContextMenu()}},{key:"getNumItems",value:function(){return this.numItems}},{key:"onArrowsModeSelect",value:function(e){if(e>=0)if(this.props.onEnterKey)this.props.onEnterKey();else{var t=this.refs["el_"+e];t&&t.onClick&&t.onClick()}}},{key:"onArrowsModeKey",value:function(e,t){var a=this.props;a.onKeyPress&&a.onKeyPress(e,t)&&a.supportArrows&&b.default.hotkeys.exitArrowsMode("FancyContextMenu")}},{key:"onEscapeKey",value:function(){this.props.onEscape&&this.props.onEscape(),b.default.menus.closeTopContextMenu()}},{key:"onChildMouseEnter",value:function(e,t){this.selectedIndex.set(e)}},{key:"updatePosition",value:function(){var e=this.props,t=y.a.windowSize.get(),a=t.width,n=t.height;try{v.default.PAssert(1195,e.element,"Context menu needs an element to open on",e.id)}catch(b){v.default.reportError(b)}if(e.element){var r,i,o,s,l=e.element.getBoundingClientRect(),u=e.pos,c=this.refMenu.current,d=null!==(r=null===u||void 0===u?void 0:u.left)&&void 0!==r?r:l.left,h=null!==(i=null===u||void 0===u?void 0:u.top)&&void 0!==i?i:l.bottom;e.onSide&&(h=l.top-4,(d=l.right)>y.a.windowWidth()-200&&(d=void 0,o=l.left));var f=e.positionOffset;f&&(!isNaN(d)&&f.left&&(d+=f.left),!isNaN(o)&&f.right&&(o+=f.right),!isNaN(h)&&f.top&&(h+=f.top),!isNaN(s)&&f.bottom&&(s+=f.bottom));var p={left:d,top:h,right:o,bottom:s};if(c){var g=d+c.clientWidth,m=h+c.clientHeight,k=a-8,_=n-8;"shrink"===this.props.overflowHeight&&s>n-8&&(p.maxHeight=Math.min(Math.max(n-h,260),500),m=Math.min(m,p.maxHeight+h)),g>k&&(p.left+=k-g),m>_&&(p.top+=_-m),(d<8||d+p.left<8)&&g<a&&(p.left+=8-d)}return p}return{left:0,top:0,maxHeight:400}}},{key:"remapChildren",value:function(e,t){var a=this;return _.a.Children.map(e,(function(e){if(e&&"hr"!==e.type){if("leftcol"===e.key){var n=e.props,i=n.children,o=r()(n,["children"]);return _.a.createElement("div",o,a.remapChildren(i,t))}if("scroller"===e.key){return _.a.createElement(w.a,{style:{maxHeight:400}},a.remapChildren(e.props.children,t))}if(!e.props||e.props.onClick||e.props.customLayout){var s=e.props.onMouseEnter?function(n){a.onChildMouseEnter(t.index,n),e.props.onMouseEnter(n)}:a.onChildMouseEnter.bind(a,t.index);return _.a.cloneElement(e,{onMouseEnter:s,ref:"el_"+t.index,selected:a.state.selectedIndex===t.index++})}return e}return e}))}},{key:"render",value:function(){var e,t=this.state,a=this.props,n=v.default.classNames("fancyContextMenu popup c-shadow-popup will-change-transform",a.className,a.background,{fancyContextMenuMaximized:a.isMaximized},{"c-border-light":a.border},{f1:a.isMaximized},{"c-bg-menu":!a.background},{loading:a.loading},{openFromBottom:a.openFromBottom});a.isMaximized||(e={left:t.left,top:t.top,right:t.right,bottom:isNaN(a.bottom)?t.bottom:a.bottom,width:a.width,height:a.height,minWidth:a.minWidth,maxHeight:t.maxHeight||a.maxHeight,maxWidth:a.maxWidth,border:a.border?"1px solid":void 0,padding:a.padding||void 0},e=v.default.extend(e,this.props.style));var r=this.props.children;if(a.supportArrows){var i={index:0};r=this.remapChildren(this.props.children,i),this.numItems=i.index}var o=_.a.createElement(m.b.div,{className:n,id:a.id,style:e,ref:this.refMenu,initial:{scaleX:.95,scaleY:.8},animate:{scaleX:1,scaleY:1},layout:void 0!==a.isMaximized||void 0,transition:g.a.TransitionSpringFastest,tabIndex:-1},r);return a.focusTrap?_.a.createElement(P.a,null,o):o}}]),a}(D.a);t.a=E},function(e,t,a){"use strict";var n,r=a(38),i=a.n(r),o=a(7),s=a.n(o),l=a(8),u=a.n(l),c=a(10),d=a.n(c),h=a(11),f=a(2),p=a(0),g=a(88),m=a(108),v=a(9),y=a(6),k=a(4),_=a(32),b=a(48),w=a(26),S=a(20),D=a.n(S),P=a(21),I=a.n(P),E=a(13),C=a.n(E),x=a(33),A=a(56),T=a(75),M=a(58),L=a(89),O=a(16),R=a.n(O),F=a(27),N=a(78),B=a(110),j=new(n=function(){function e(){s()(this,e),F.a.listen("selectionChanged",this.onSelectionChange),document.addEventListener("keydown",this.onKeyDown)}return u()(e,[{key:"onKeyDown",value:function(e){if(y.a.isValid()){var t;if(!k.default.settings.showMarkdown.get()&&(v.a.mac&&e.metaKey||!v.a.mac&&e.ctrlKey))if(e.normCode===f.a.KeyCode.B?t="bold":e.normCode===f.a.KeyCode.I?t="italic":e.normCode===f.a.KeyCode.U?t="underline":e.normCode===f.a.KeyCode.X&&e.shiftKey&&(t="strike"),t){var a=y.a.getStartObject(),n=y.a.getEndObject(),r=y.a.getStartOffset(),i=y.a.getEndOffset();if(this.formatHint||(this.formatHint={}),this.formatHint[t]=!0,a===n&&r===i&&a.item.getParsedText().length>0){var o=a.item.elsNew.elementAtOffset(a,r-1);o&&o.props[t]&&(this.formatHint[t]=!1)}}e.normCode===f.a.KeyCode.Enter?(k.default.onIntroAction("AddItem"),k.default.onIntroAction("Import")):e.normCode===f.a.KeyCode.Slash&&y.a.isValid()&&0===y.a.getStartOffset()&&0===y.a.getStartTotal()&&y.a.getStartIndex()===y.a.getEndIndex()&&k.default.onIntroAction("SlashHelp")}}},{key:"onSelectionChange",value:function(){this.formatHint=void 0}},{key:"getSelection",value:function(e,t,a){for(var n,r,i,o,s,l,u,c,d,h=0,f=e.item.elsNew.elements,p=e.showMarkdown(),g=0,m=0;m<f.length;m++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var v=f[m],y=v.getStyledText(e.item,{showMarkdown:p}).length,k=m===f.length-1;if(y&&!v.props.prefixType){if(d=v,i=g,l=m,!u&&(k||t>=g&&t<=g+y)&&(u=v,n=g,o=m),!c&&u&&(k||a>=g&&a<=g+y)){c=v,r=g,s=m;break}g+=y}}return u||(u=c=d,n=r=i,o=s=l),{startElement:u,startOffset:n,startIndex:o,endElement:c,endOffset:r,endIndex:s}}},{key:"setOffsetsBeforeInput",value:function(e){this.offsetsBeforeInput=e}},{key:"onInput",value:function(e,t,a,n,r,i){var o=i.data;if("insertReplacementText"===i.inputType){var s,l;o=null===(s=i.dataTransfer)||void 0===s?void 0:s.getData("text/plain");var u=null===(l=this.offsetsBeforeInput)||void 0===l?void 0:l.start;void 0!==u&&(n=u)}var c=0;n=Math.min(a,n);var d=e.getDisplayTextWithoutPrefix();a===n&&a===r&&t.length<d.length&&(r+=d.length-t.length);var h=this.getSelection(e,n,r),g=h.startElement,m=h.startOffset,v=h.startIndex,y=h.endElement,_=h.endOffset,b=h.endIndex,w=e.item,S=e.showMarkdown();if(g&&y){for(var D=0,P=e.item.elsNew,I=P.elements,E=v,C=d.substr(r),x=w.getPrefixLength();E<=b;){if(D++>5e3&&__infLoop&&__infLoop(D))throw new RangeError;var A=I[E],T=E===v?n-m:-1,M=E===b?r-_:-1,L=A.getStyledText(e.item,{showMarkdown:S}),O=T>=0?L.substr(0,T):"",F=M>=0?L.substr(M):"",j=A.isEditable();if(E>v&&E<b)A.setText("",S);else{var U=O+F;if(!j&&U||A.setText(U,S),E===b){var H=e.getDisplayTextWithoutPrefix(),V=t.lastIndexOf(C)-H.lastIndexOf(C);if(0===V&&o)t.substr(O.length-o.length,o.length)===o&&(O=O.substr(0,O.length-o.length)+o);var W=t.substr(n,V);if(S||A.props.tag||(W=W.replace(f.a.Regexp.MDFormat,(function(e){return c++,"\\"+e}))),p.default.isEmpty(this.formatHint))j&&(O||A.isEditableAtStart())&&(F||A.isEditableAtEnd())?A.setText(O+W+F,S):I.splice(E+(O.length>0?1:0),0,new N.a(W,this.formatHint));else{var z=P.split(e,a+x-1),q=R()(z,2),G=q[0],K=q[1],Y=new N.a(W,this.formatHint);P=new B.a((G?G.elements:[]).concat(Y).concat(K?K.elements:[]))}W.includes(f.a.TagPrefix)&&k.default.onIntroAction("Tag")}}E++}return{newText:P.getRawText(e.showMarkdown()),selOffset:c}}return S||(t=t.replace(f.a.Regexp.MDFormat,(function(e){return"\\"+e}))),p.default.isEmpty(this.formatHint)||(t=new B.a([new N.a(t,this.formatHint)]).getRawText()),{newText:t=w.getPrefix()+t,selOffset:0}}}]),e}(),d()(n.prototype,"onKeyDown",[h.a],Object.getOwnPropertyDescriptor(n.prototype,"onKeyDown"),n.prototype),d()(n.prototype,"onSelectionChange",[h.a],Object.getOwnPropertyDescriptor(n.prototype,"onSelectionChange"),n.prototype),n);function U(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=C()(e);if(t){var r=C()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return I()(this,a)}}var H,V,W=a(18),z=a(31),q=a(15),G=a(42),K=a(69),Y=function(){function e(t,a,n){s()(this,e),this.pane=t,this.isVisible=new q.a(a),this.dragHoverItem=void 0}return u()(e,[{key:"destroy",value:function(){this.pane=void 0}},{key:"setVisibility",value:function(e){e&&y.a.reset(),e!==this.isVisible.get()&&(this.isVisible.set(e),F.a.fireEvent("panesChanged",[]),k.default.PaneManager.updatePaneStateForPane(this.pane))}},{key:"toggle",value:function(){this.isVisible.get()?this.setVisibility(!1):this.setVisibility(!0),k.default.onIntroAction("Overview")}},{key:"updateDragHoverItem",value:function(e){var t=this.dragHoverItem;this.dragHoverItem=e,p.default.batchRenderUpdates((function(){t&&t.itemChanged.notify(),e&&t!==e&&e.itemChanged.notify()}))}},{key:"isItemDragHovered",value:function(e){return e===this.dragHoverItem}},{key:"getMinItemSize",value:function(){return k.default.DisplaySettings.itemLineHeight()+2*k.default.DisplaySettings.itemPadding()}}]),e}(),X=a(70),Q=a(62),J=a(25),Z=a(102),$=f.a.MatchState,ee=(H=function(){function e(t,a,n){var r=0;s()(this,e),this.callback=n,this.pane=t,this.searchArr=[],this.matches={},this.previousSearch="",this._stickyMatches={},this._stickyMatchesAwaitingClear=[],this.itemStoreFilter=void 0,this.UI=void 0,this.isFocused=new q.a,this._destroyed=!1;var i={priority:{name:"priority",matchFn:this._matchFnPriority},starred:{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred items",matchFnBoolean:this._matchFnStarred},project:{name:"project",initialValue:1,icon:"icon-project",tooltip:"projects",matchFnBoolean:this._matchFnProject},task:{name:"task",initialValue:1,icon:"prefixTask",tooltip:"tasks",matchFnBoolean:this._matchFnTask},complete:{name:"complete",text:"Completed Items",initialValue:-1,defaultValue:-1,icon:"icon-check",tooltip:"completed items",matchFn:this._matchFnComplete},showOnlyMatches:{name:"showOnlyMatches",initialValue:1,icon:"icon-reorder",tooltip:"Flat mode: Show only matching items",canBeNegated:!1,isOption:!0,hideInView:!0},showOnlyAgendaDates:{name:"showOnlyAgendaDates",initialValue:1,icon:"icon-at",tooltip:"Show only dates on the Agenda",canBeNegated:!1,isOption:!0,hideInView:!0},showOnlyMatchingTags:{name:"showOnlyMatchingTags",initialValue:1,icon:"icon-short_text",tooltip:"Show only matching tag blocks",canBeNegated:!1,isOption:!0},showChildProjects:{name:"showChildProjects",initialValue:1,icon:"icon-project_half",tooltip:"Show all projects from anywhere in the hierarchy",canBeNegated:!1,isOption:!0}};if(a){!1===a.showHierarchy&&(a.showOnlyMatches=1);var o=a.completeOption;!isNaN(o)&&isNaN(a.complete)&&(a.complete=o<0?1:o-1),0===a.showOnlyTopLevelProjects&&(a.showChildProjects=1)}for(var l=[],u=0;u<t.searchFilters.length;u++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var c=t.searchFilters[u];p.default.isString(c)?l.push(i[c]):l.push(c)}if(this.setupFilters(l,a),this.value=a&&a.text||"",this.onChanged=new Q.a(n),this._updateSearchArr(),this.value){var d=T.a.parseTextNew(void 0,this.value,X.a.getContacts(),!0);d&&this.onParsed(d)}}return u()(e,[{key:"destroy",value:function(){this._destroyed=!0,this.onChanged.unlisten(this.callback),this.pane=void 0,this.UI=void 0}},{key:"setFilterTooltip",value:function(e,t){this.getFilter(e).tooltip=t}},{key:"getFilterTooltip",value:function(e){var t=e.value.get();return t?e.isOption?"<b>Click</b> to clear this option":(t>0?"Showing only":"Hiding")+" "+e.tooltip+".\n<b>Click</b> to clear this "+(e.isOption?"option":"filter."):e.isOption?e.tooltip:"<b>Click</b> to "+(e.initialValue>0?"show only ":"hide ")+e.tooltip+(t!==-e.initialValue?".\n<b>"+v.a.priModKey+" + click</b> to "+(e.initialValue<0?"show only ":"hide ")+e.tooltip+".":"")}},{key:"setupFilters",value:function(e,t){for(var a=0,n=[],r=0;r<e.length;r++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=e[r],o=i.name,s=t?t[o]:void 0,l=i;l.value=new q.a(isNaN(s)?i.defaultValue||0:s),l.enabled=new q.a(void 0===i.enabled||i.enabled);try{p.default.PAssert(1339,!this.hasOwnProperty("filter_"+o),"Should not double define filter properties")}catch(u){p.default.reportError(u)}this["filter_"+o]=l,n.push(l)}this.filters=n}},{key:"setFilterEnabled",value:function(e,t){var a=this.filters.indexOfWithProperty("name",e);a>=0&&this.filters[a].enabled.set(t)}},{key:"getValue",value:function(){return this.value}},{key:"isFiltered",value:function(){for(var e=0,t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(this.filters[t].value.get())return!0}return!1}},{key:"isFilteredOn",value:function(e){return 0!==this.getFilterValue(e)}},{key:"getRemoteValue",value:function(){for(var e=0,t=this.value,a=0;a<this.filters.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this.filters[a];if(n.remoteStringFn&&n.enabled.get()){var r=n.remoteStringFn(n.value.get());r&&(t+=" "+r)}}return t.trim()}},{key:"getState",value:function(){for(var e=0,t={text:this.getValue(),showHierarchy:this.showHierarchy()},a=0;a<this.filters.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this.filters[a];t[n.name]=n.value.get()}return t}},{key:"focus",value:function(){this.UI.focus()}},{key:"blur",value:function(){this.UI.blur()}},{key:"onParsed",value:function(e){this.tags=e.tags,this.contacts=e.contacts}},{key:"setValue",value:function(e,t){this.updatingValue=this.value!==e,this.updatingValue&&this.pane.clearPerPaneStateSearch(),this.updateHistory(t),this.value=e,this._updateSearchArr(),this.pane.scrollToStartOnSearch&&this.pane.scrollToIndex(0,"start"),this.totalNumItems>5e3?p.default.timeoutOnce("searchDebounce",this.update,150,!0):this.update(!0),e&&k.default.onIntroAction("Search"),this.updatingValue=!1}},{key:"addToValue",value:function(e){var t=this,a=this.getSelectionOffset(),n=this.value;n.length>0&&"-"!==n[n.length-1]&&"!"!==n[n.length-1]&&(e=" "+e),n+=e,this.setValue(n),y.a.isKeyboardOpen&&requestAnimationFrame((function(){t.setSelectionOffset(a+e.length)}))}},{key:"toggleText",value:function(e,t){var a=this.value.trim(),n="\\B(-*)("+p.default.escapeRegExp(e.toLowerCase())+")\\b",r=a.toLowerCase().match(n);r?a=(a.substr(0,r.index)+a.substr(r.index+r[0].length)).replace(/  +/g," "):a+=" "+(t?"-":"")+e,a=a.trim(),this.setValue(a)}},{key:"getSelectionOffset",value:function(){return this.UI.getSelectionOffset()}},{key:"setSelectionOffset",value:function(e){this.UI.setSelectionOffset(e)}},{key:"getSearchBox",value:function(){return this.UI.refSearchBox}},{key:"isSearched",value:function(){var e=0;if(this.value.length>0)return!0;for(var t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.filters[t];if(a.enabled.get()&&a.value.get())return!0}}},{key:"reset",value:function(){this.setValue("")}},{key:"resetFilters",value:function(){for(var e=0,t=0;t<this.filters.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.filters[t];a.isOption||a.value.set(a.defaultValue)}this.update(!0,!0)}},{key:"numUnmatchedItems",value:function(){var e=this,t=0,a={item:this.pane.getItem(),pane:this.pane,each:function(a){var n=a.id,r=e.matches[n];r!==$.No&&r!==$.Negated||t++}};return p.default.searchVMLIs(a),t}},{key:"isMatchStateMatch",value:function(e){return void 0===e||e===$.Yes||e===$.ChildYes||e===$.Unknown}},{key:"isMatchedHeader",value:function(e){return this.isMatched(e,{isHeaderSearch:!0})}},{key:"isMatchedSimple",value:function(e){return this.isMatchStateMatch(this.matches[e])}},{key:"isMatched",value:function(e,t){if(e.isRoot)return!0;if(this.pane.supportLocalSearch){var a=this.matches[e.id];return((null===t||void 0===t?void 0:t.forceCheck)||!(null===t||void 0===t?void 0:t.noCheck)&&void 0===a&&e.hasText()&&!this.pane.isSettingTextFromInput&&((null===t||void 0===t?void 0:t.isHeaderSearch)||this.pane!==p.default.focusedPane))&&(a=this.checkItem(e)),(null===t||void 0===t?void 0:t.isYes)?a===$.Yes:this.isMatchStateMatch(a)}return!0}},{key:"handleItemChanged",value:function(e){if(k.default.PaneManager.isPaneActive(this.pane.id)){var t,a=this.isMatched(e,{noCheck:!0});if(e.parent()?(this.checkItem(e),t=this.isMatched(e)):t=!1,!t&&a&&(this.isMatchStuck(e)||this.stickMatchAfterSearch(e,!0)),t!=a)return!0}}},{key:"handleItemTextChanged",value:function(e){if(this.getValue()||this.isFiltered())return this.handleItemChanged(e)}},{key:"_updateSearchArr",value:function(){var e=Z.a.getSearchArr(this.value),t=e.searchArr,a=e.searchWords;this.searchArr=t,this.searchWords=a}},{key:"toggleFilterDefault",value:function(e){var t=this["filter_"+e],a=t.value.get();a=a?0:t.initialValue,this.setFilter(e,a)}},{key:"toggleFilter",value:function(e,t){var a=t?-1:1,n=this["filter_"+e].value.get();n=n===a?0:a,this.setFilter(e,n)}},{key:"getFilter",value:function(e){return this["filter_"+e]}},{key:"getFilterObs",value:function(e){var t=this["filter_"+e];return t?t.value:void 0}},{key:"getFilterValue",value:function(e){var t=this["filter_"+e];return t?t.value.get():void 0}},{key:"setFilter",value:function(e,t,a){this.updateHistory(),"showOnlyMatches"===e&&this.clearListCache(),this["filter_"+e].value.set(t,a),this.pane.scrollToIndex(0,"start"),this.update(!0,!0),k.default.onIntroAction("Search")}},{key:"update",value:function(e,t,a,n){var r=this;this.isRunningSearch=!0,k.default.PaneUpdateBatcher.beginUpdateItems(),(e||t)&&this.clearStickyMatches(),this.pane.supportLocalSearch&&(this.prevMatches=this.matches,this.matches={},this.isAnimatingSearch=a&&!e&&p.default.focusedPane===this.pane,this.checkChildren(),this.prevMatches={}),this.isUpdatingSearch=!0,this.pane.isLoaded&&e&&this.onChanged.notify(t),k.default.PaneUpdateBatcher.commitUpdateItems(),setTimeout((function(){r.isUpdatingSearch=!1}),0),this.isRunningSearch=!1}},{key:"clearStickyMatches",value:function(){this._stickyMatchesAwaitingClear=[],this._stickyMatches={},clearTimeout(this._timeoutHideNonMatches)}},{key:"_isMatchStateOk",value:function(e){return e===$.Yes||e===$.Unknown||e===$.ChildYes}},{key:"_matchFilter",value:function(e,t){if(e)return t?e>0?$.Unknown:$.Negated:e>0?$.No:$.Unknown}},{key:"_matchFilters",value:function(e){for(var t=0,a=$.Unknown,n=0;n<this.filters.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.filters[n];if((r.matchFn||r.matchFnBoolean)&&r.enabled.get()){var i=r.value.get();if(0!==i){var o=r.matchFnBoolean?this._matchFilter(i,r.matchFnBoolean(e)):r.matchFn(i,e);o===$.Unknown||o!==$.Negated&&!this._isMatchStateOk(a)||(a=o)}}}return a===$.Yes&&(a=$.Unknown),a}},{key:"_matchFnComplete",value:function(e,t){return"Completed"===this.pane.getSortModeBlocks()&&(e=1),this._matchFilter(e,t.isComplete())}},{key:"_matchFnStarred",value:function(e){return e.isStarred()}},{key:"_matchFnProject",value:function(e){return e.isPrefixHeader()}},{key:"_matchFnTask",value:function(e){return e.isPrefixTask()}},{key:"_matchFnPriority",value:function(e,t){var a=t.getPriority();return e>0?a>=e?$.Yes:$.No:$.Unknown}},{key:"_matchFnEmail",value:function(e,t,a){var n=t.getAttachments(),r=n&&n[0],i=r&&r.getPlugin()===k.default.pluginManager.getPluginGmail();return this._matchFilter(e,i)}},{key:"isDateInRange",value:function(e){for(var t=0,a=!0,n=0;n<this.searchArr.length;n++){var r=0;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;for(var i=this.searchArr[n],o=void 0,s=0;s<i.length;s++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=i[s],u=l.dateInfo,c=l.isNegated;if(u){var d=u.prefix,h=u.date,f=u.date2;"overdue"===h&&(d="before",h=J.a.getToday()),"any"===h?o=!0:"none"===h?o=!1:"before"===d?o=e<h:"date"===d?o=J.a.isSameDay(e,h):"after"===d?o=e>=h:"between"===d&&(o=e>=h&&e<=f),c&&(o=!o),o||(a=!1)}}if(o)return!0}return a}},{key:"checkItem",value:function(e,t){var a,n,r=this,i=t?t.root:this.pane.getRootItem(),o=t?t.showHierarchy:this.showHierarchy(),s=this.matches,l=e.isNote(),u=e.parent();if(e.isDestroyed())return a=$.No;try{p.default.PAssert(1340,u||e.isRootItem(),"Item parent does not exist while being searched",e===i)}catch(v){p.default.reportError(v)}if(this._stickyMatches[e.id])a=this._stickyMatches[e.id].matchState;else if(e.isRootItem())a=$.Yes;else if(u)if(s[u.id]===$.Negated)a=$.Negated;else{var c=e.getSearchText(this.pane),d=(a=this._matchFilters(e))===$.Negated;if(this.isMatchStateMatch(a)&&this.searchArr.length){var h=this._checkMatchTextImpl((function(t){return Z.a.checkItemText(e,c,t,r.pane)}),o,e,i);if(d=h.hasNegated,(a=h.matchState)===$.Yes&&this.updatingValue&&this.getValue()){var g=0;for(n=u;n;){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;n.isCollapsed(this.pane,!1,!0)&&this.pane.setPerPaneState(n.id,f.a.PerPaneStateField.CollapsedSearch,!1),n=n.parent()}}}if(a===$.Unknown&&(a=$.Yes),!d&&this.pane.shouldSearchMatchParents&&u!==i&&o&&(s[u.id]===$.Yes||this._stickyMatches[u.id]))return s[e.id]=$.Yes,s[e.id];a===$.No&&l&&(a=s[u.id])}else a=$.No;if(this.isMatchStateMatch(a)&&this.onlyMatchDates&&!this.pane.isOkOnAgenda(e)&&(a=$.No),a===$.Yes){if(o){var m=0;for(n=u;n&&!n.isRootItem()&&s[n.id]!==$.Negated&&s[n.id]!==$.Yes;){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;s[n.id]=$.ChildYes,n.hasNote()&&(s[n.getNote().id]=$.Yes),n=n.parent()}}l&&(s[u.id]=$.Yes)}return s[e.id]=a,s[e.id]}},{key:"setMatchState",value:function(e,t){this.matches[e]=t}},{key:"_checkMatchTextImpl",value:function(e,t,a,n){var r;var i=[],o=0;if(this.searchArr.length){for(var s=0,l=0;l<this.searchArr.length;l++){var u=0;if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;for(var c=this.searchArr[l],d=0;d<c.length;d++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var h=c[d];if(h.isNegated){var f=h;try{p.default.PAssert(1341,f,"Each value in the search array should be valid at this point")}catch(D){p.default.reportError(D)}if(e(h)){i[l]=$.Negated,o++;break}}}}if(o===this.searchArr.length&&(r=$.Negated),this.isMatchStateMatch(r)){for(var g=0,m=0;m<this.searchArr.length;m++){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;if(i[m]!==$.Negated)for(var v=0,y=this.searchArr[m],k=0;k<y.length;k++){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;var _=y[k],b=_.text;try{p.default.PAssert(1342,b,"Each value in the search array should be valid at this point")}catch(D){p.default.reportError(D)}if(!_.isNegated)if(e(_))i[m]=$.Yes;else if(t)for(var w=0,S=a;S;){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;if(!(S=S.parent())||S===n){i[m]=$.No;break}if(Z.a.checkItemText(S,S.getSearchText(),_,this.pane))break}else i[m]=$.No;if(i[m]===$.No)break}}r=Z.a.orMatchStates(i)}}return{hasNegated:o>0,matchState:r}}},{key:"checkItemSimple",value:function(e,t){var a=this,n=this._matchFilters(e);if(this.isMatchStateMatch(n)){var r=t.filter((function(e){return!!e})).map((function(e){return a._checkMatchTextImpl((function(t){return null===e||void 0===e?void 0:e.includes(t.text)})).matchState}));n=Z.a.orMatchStates(r)}this.matches[e.id]=n}},{key:"checkChildrenParams",value:function(e,t){var a=this.checkItem(e,t);return this.totalNumItems++,a!==$.Negated}},{key:"checkChildren",value:function(){var e=this;if(this.pane.usesVMLIs){this.totalNumItems=0;var t={item:void 0,includeNotes:!0,comparator:this.checkChildrenParams,comparatorOptions:{root:this.pane.getRootItem(),showHierarchy:this.showHierarchy()}};this.itemStoreFilter&&(t.itemStoreFilter=this.itemStoreFilter),this.pane.getItemStore()!==k.default.itemStoreManager.getDefaultItemStore()?t.itemStore=this.pane.getItemStore():t.item=this.pane.getItem(),p.default.searchVMLIs(t),this.isAnimatingSearch&&Object.keys(this.matches).forEach((function(t){var a=e.prevMatches[t];if(void 0!==a&&e.isMatchStateMatch(a)&&!e.isMatchStateMatch(e.matches[t])){var n=W.a.getItem(t);n&&!e.isMatchStuck(n)&&e.stickMatchAfterSearch(n,a)}}))}else this.pane.checkChildren()}},{key:"setIsMatch",value:function(e,t){this.matches[e]=t?$.Yes:$.No}},{key:"_getMatchedItem",value:function(e){return this._stickyMatches[e.id]||e}},{key:"getItemDate",value:function(e){var t=this._stickyMatches[e.id];return t&&t.date}},{key:"getItemDuration",value:function(e){var t=this._stickyMatches[e.id];return t&&t.duration}},{key:"getItemTagsLower",value:function(e){var t=this._stickyMatches[e.id];return t&&t.tagsLower}},{key:"getItemContacts",value:function(e){var t=this._stickyMatches[e.id];return t&&t.contacts}},{key:"getItemSearchText",value:function(e){var t=this._stickyMatches[e.id];return t&&t.searchText}},{key:"getItemPrefix",value:function(e){var t=this._stickyMatches[e.id];return t&&t.prefix}},{key:"getItemPriority",value:function(e){var t=this._stickyMatches[e.id];return t&&t.priority}},{key:"getItemStarred",value:function(e){var t=this._stickyMatches[e.id];return t&&t.isStarred}},{key:"stickMatch",value:function(e,t){if(!this._stickyMatches[e.id]){var a=e.getStickySearchInfo();a.matchState=this.matches[e.id],t&&(a.isHiding=!0),p.default.isInCompleteAction()&&(a.wasCompleted=!0),this.matches[e.id]=$.ChildYes,this._stickyMatches[e.id]=a,e.itemChanged.notify()}}},{key:"isMatchStuck",value:function(e){return!!this._stickyMatches[e.id]}},{key:"unstickMatch",value:function(e){var t=this._stickyMatches[e.id];if(t){var a=e.getStickySearchInfo();return delete this._stickyMatches[e.id],!p.default.deepEqual(t,a)}return!1}},{key:"unstickAllMatches",value:function(){this._stickyMatches={}}},{key:"isMatchStuckHiding",value:function(e){var t=this._stickyMatches[e.id];return t&&t.isHiding}},{key:"stickMatchAfterSearch",value:function(e,t){this.stickMatch(e,!0),t&&(this._timeoutHideNonMatches&&clearTimeout(this._timeoutHideNonMatches),this._stickyMatchesAwaitingClear.push(e),this._timeoutHideNonMatches=setTimeout(this.hideNonMatches,1500))}},{key:"hideNonMatches",value:function(){var e=this;if(!this._destroyed){var t=this.pane,a=this._stickyMatchesAwaitingClear,n=a.length,r=0;if(n>0){for(var i=0,o=0;o<n;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=a[o],l=this._stickyMatches[s.id];l&&l.wasCompleted&&r++,this.unstickMatch(s)}var u=n+(n>1?" items":" item"),c={hold:!1};this.pane===p.default.focusedPane&&(r!==n?(c.text=u+" hidden because "+(n>1?"they do":"it does")+" not match search",c.actionText="UNHIDE",c.action=function(){if(t&&t.setIgnoreRestoreScroll){var r=0,i=y.a.save();t.setIgnoreRestoreScroll();for(var o=0;o<n;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=a[o];e.stickMatch(s),e._stickyMatchesAwaitingClear.push(s)}e.pane.updateItemsImmediate(!0,void 0,void 0,!0),y.a.restore(i)}}):(c.text=u+" completed",c.actionText="UNDO",c.action=function(){var r=0,i=y.a.save();t.setIgnoreRestoreScroll();for(var o=0;o<n;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;a[o].setComplete(!1,f.a.ChangeType.Local)}e.pane.updateItemsImmediate(!0,void 0,void 0,!0),y.a.restore(i)}),k.default.toasts.pushMessage(c));var d=y.a.save();this._stickyMatchesAwaitingClear=[],t.setIgnoreRestoreScroll(),t.updateItemsImmediate(!0,void 0,void 0,!0),d&&d.pane===this.pane&&y.a.restore(d)}}}},{key:"showHierarchy",value:function(){return this.pane.type!==f.a.PaneMode.Task||1!==this.getFilterValue("showOnlyMatches")}},{key:"setShowHierarchy",value:function(e){this.pane.supportSearchFlat&&this.setFilter("showOnlyMatches",e?0:1)}},{key:"showOnlyAgendaDates",value:function(){return this.pane.type===f.a.PaneMode.Task&&this.getFilterValue("showOnlyAgendaDates")}},{key:"showOnlyMatchingTags",value:function(){return this.pane.type===f.a.PaneMode.Task&&this.getFilterValue("showOnlyMatchingTags")}},{key:"showChildProjects",value:function(){return this.pane.type===f.a.PaneMode.Task&&this.getFilterValue("showChildProjects")}},{key:"clearListCache",value:function(){this.pane.listManager.clearCache()}},{key:"getTags",value:function(){return this.tags}},{key:"getContacts",value:function(){return this.contacts}},{key:"getSearchWords",value:function(){return this.searchWords}},{key:"shouldHighlightSearch",value:function(){return this.isFocused.get()&&this.getValue()}},{key:"isSearchingDate",value:function(){return this.searchArr.some((function(e){return e.some((function(e){return!!e.dateInfo}))}))}},{key:"onRemoteUpdate",value:function(e,t){var a=!1;this.filters.forEach((function(t){e[t.name]!==t.value.get()&&(a=!0,t.value.set(e[t.name]))})),e.text!==this.getValue()&&(this.setValue(e.text,t),a=!1),a&&this.update(!0,!0)}},{key:"updateHistory",value:function(e){var t=this;e?p.default.clearTimeoutOnce("searchDebounceHistory"):(this._previousStateForHistory||(this._previousStateForHistory=this.getState()),p.default.timeoutOnce("searchDebounceHistory",(function(){var e;null===(e=t.pane)||void 0===e||e.pushHistory({search:t._previousStateForHistory}),t._previousStateForHistory=void 0}),1e3))}},{key:"updateAutocomplete",value:function(){this.UI.updateAutocomplete()}}]),e}(),d()(H.prototype,"isMatchedHeader",[h.a],Object.getOwnPropertyDescriptor(H.prototype,"isMatchedHeader"),H.prototype),d()(H.prototype,"isMatchedSimple",[h.a],Object.getOwnPropertyDescriptor(H.prototype,"isMatchedSimple"),H.prototype),d()(H.prototype,"isMatched",[h.a],Object.getOwnPropertyDescriptor(H.prototype,"isMatched"),H.prototype),d()(H.prototype,"handleItemTextChanged",[h.a],Object.getOwnPropertyDescriptor(H.prototype,"handleItemTextChanged"),H.prototype),d()(H.prototype,"update",[h.a],Object.getOwnPropertyDescriptor(H.prototype,"update"),H.prototype),d()(H.prototype,"_matchFnComplete",[h.a],Object.getOwnPropertyDescriptor(H.prototype,"_matchFnComplete"),H.prototype),d()(H.prototype,"_matchFnStarred",[h.a],Object.getOwnPropertyDescriptor(H.prototype,"_matchFnStarred"),H.prototype),d()(H.prototype,"_matchFnProject",[h.a],Object.getOwnPropertyDescriptor(H.prototype,"_matchFnProject"),H.prototype),d()(H.prototype,"_matchFnTask",[h.a],Object.getOwnPropertyDescriptor(H.prototype,"_matchFnTask"),H.prototype),d()(H.prototype,"_matchFnPriority",[h.a],Object.getOwnPropertyDescriptor(H.prototype,"_matchFnPriority"),H.prototype),d()(H.prototype,"_matchFnEmail",[h.a],Object.getOwnPropertyDescriptor(H.prototype,"_matchFnEmail"),H.prototype),d()(H.prototype,"checkChildrenParams",[h.a],Object.getOwnPropertyDescriptor(H.prototype,"checkChildrenParams"),H.prototype),d()(H.prototype,"hideNonMatches",[h.a],Object.getOwnPropertyDescriptor(H.prototype,"hideNonMatches"),H.prototype),H),te=a(54),ae=a(83),ne=a(87),re=0,ie=["collapser","itemParents","itemCheckbox","agendaTime","itemMenuIcon","vertLines","itemTime"],oe=(V=function(){function e(t){var a=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};s()(this,e),this.__ISPANE=!0,w.a.binder(this,"getItems","getHeaders","updateItems","getWidth","getHeight","onShowArchivedChanged","zoomInOnSwipe","collapseOnSwipe","deleteOnSwipe","completeOnSwipe","onClickRefreshData","onClickRefreshDataForce","getSwipeMenuItems","getMinItemSize","toggleCollapseAll","onTapClosePane"),this.title=n.title,this._createProps(n,{contextMenuMode:"Normal",paneEmptyMessage:"Start typing to get started",paneEmptySearchMessage:"No search results",titleContextMenuHeader:"Zoom to item",searchFilters:[],dropEffect:function(){return f.a.DropEffect.Move},isWriteable:!0,isEditable:!1,isDraggable:!0,isDropTarget:!0,hasNonVMLIs:!1,canAddItem:!0,overrideCopyBehavior:!0,supportMenuIcon:!1,supportCollapsing:!0,supportCompleting:!0,supportCheckbox:!1,supportIndent:!0,supportOffline:!0,supportPerformArchive:!0,supportDataRefresh:!1,supportReportError:!1,supportCompose:!1,supportPagination:!1,supportVertLines:!0,supportStarClick:!1,supportSearchItemAutocomplete:!0,supportSearchListenTextChanges:!0,supportSearchFlat:!0,supportLocalSearch:!0,supportClone:!0,supportDates:!0,supportMultiselect:!0,supportDeferredItemLoad:!1,supportCellTransition:!0,supportViewMenu:!1,supportHistory:!1,supportSel:!0,shouldSearchMatchParents:!0,shouldUpdateOnTextChanged:!0,noOverviewStyle:!1,supportClickOverviewScroll:!0,overviewTracksScroll:!0,overviewHasPaneItems:!0,overviewPadLevels:0,minWidth:f.a.StdPaneWidthMin,minWidthFlex:f.a.StdPaneWidthMin,maxWidth:f.a.PaneWidthMax,maxWidthFlex:f.a.StdPaneWidthMax,maxWidthSingle:f.a.StdPaneWidthMax,widthBiggerInSingle:!0,collapsedFieldName:f.a.PerPaneStateField.Collapsed,supportsDocuments:!0,overviewCanTrackScroll:!1,usesVMLIs:!0,scrollToStartOnSearch:!0,_topBoxHeight:36}),this.blockNoKey="",this.history=new G.a,this._cachedMaxWidths={},this.topBoxHeight=new q.a(this._topBoxHeight),this.rect=new q.a(t.rect),this.isExpanded=new q.a(!1);try{p.default.PAssert(1203,void 0!==t.id,"Must supply a valid pane id")}catch(l){p.default.reportError(l)}if(this.id=t.id,this.uniquePaneID=re++,this.isFakePane=t.isFakePane,this.plugin=t.plugin,t.document&&p.default.isString(t.document)&&(t.document=W.a.getDocumentById(t.document)),this.documentSortMode=new q.a(t.documentSortMode||"Modified",this.saveState),!t.item&&this.usesVMLIs)if(this.supportDeferredItemLoad&&t.deferredItemID){var r;t.item=this.getDeferredItem(t.deferredItemID)||(null===(r=t.document)||void 0===r?void 0:r.getRootItem()),this.deferredItemState={itemID:t.deferredItemID,search:t.search,offset:0}}else{var i;if(this.supportsDocuments)t.item=null===(i=t.document)||void 0===i?void 0:i.getRootItem();else t.item=this.getDefaultDisplayItem();t.search=t.search||""}this.name=new q.a(t.name),this.item=new q.a(t.item),this.items=new G.a,this.headersArr=[],this.headerPaneObjects=new G.a,this.paneObjects={},this.paneObjectsByItem={},this.paddingTop=new q.a,this.searchingPaneObjects=new ne.a({text:""}),this.isSearchingGlobal=new q.a,this.document=new ae.a([this.item],(function(){var e,t;return null===(e=a.item.get())||void 0===e||null===(t=e.getDocumentOwner)||void 0===t?void 0:t.call(e)})),this.isDefaultPane=t.isDefaultPane,this.initialScrollIndex=t.scrollIndex,this.itemsDirtyState=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.reloading=!1,this.onDestroyed=new Q.a,this.showArchived=new q.a(!1),this.onItemPreloadUpdated=new Q.a,this._panePadding=0,this.paneTopText=new q.a,this.toast=new q.a,this.isInitialized=!1,this.isLoaded=!1,this._didInitialScroll=!1,this.isLoading=new q.a(!1),this.isFocused=new q.a(!1),this.widthManual=t.widthManual,this.widthManualExpanded=t.widthManualExpanded,this.isReady=new q.a(!this.plugin||this.plugin.isReady()),this.isActive=new q.a(!0),this.hasBeenActive=this.isActive.get(),this.hasCollapsedObs=new q.a;var o={pane:this};this.listManager=new m.a(o),this.isLoadingNewPage=new q.a(!1),this.orientation=new q.a("vertical"),this.showScrollbars=new q.a(!0),this._perPaneState={},this._destroyed=!1,this._numItemComputes=0,this._numHeaderComputes=0,this._numItemSets=0,this.isAnimatingOffset=!1,this._ignoreRestoreScroll=!1,this._activeItemStores={},this.showArchived.listen(this.onShowArchivedChanged),W.a.documentsArray.listen(this.onDocumentsChanged),this.search=new ee(this,t.search,this.onSearchChanged.bind(this)),this.overview=new Y(this,t.isOverviewVisible,t.isOverviewShowingContents),this.constructorExtra&&this.constructorExtra()}return u()(e,[{key:"_createProps",value:function(e,t){var a=this;Object.keys(t).forEach((function(n){a[n]=void 0!==e[n]?e[n]:t[n]}))}},{key:"init",value:function(){if(!this.__DIDINIT&&this.usesVMLIs){var e=this.getItem(!0);e&&this.setItem(e,!1,!1),this.plugin&&this.plugin.notifyPaneCreated(),this.history.push(this.getSaveInfo())}this.__DIDINIT=!0}},{key:"isDestroyed",value:function(){return this._destroyed}},{key:"getStats",value:function(){return{numItemComputes:this._numItemComputes,numHeaderComputes:this._numHeaderComputes,numItemSets:this._numItemSets}}},{key:"becomeReal",value:function(){}},{key:"activate",value:function(){try{p.default.PAssert(1204,!1,"Activating panes should only ever happen on mobile devices")}catch(e){p.default.reportError(e)}this.isActive.get()||(this.isActive.set(!0),this.hasBeenActive=!0,this.updateItemsImmediate(!0,!1))}},{key:"deactivate",value:function(){try{p.default.PAssert(1205,!1,"Deactivating panes should only ever happen on mobile devices")}catch(e){p.default.reportError(e)}this.isActive.set(!1)}},{key:"unload",value:function(){this._isUnloaded=!0}},{key:"isUnloaded",value:function(){return this._isUnloaded}},{key:"destroy",value:function(){this._destroyed=!0,this.plugin&&this.plugin.notifyPaneDestroyed(),this.showArchived.unlisten(this.onShowArchivedChanged),W.a.documentsArray.unlisten(this.onDocumentsChanged),this.search.destroy(),this.search=void 0,this.overview.destroy(),this.overview=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.hiddenInput=void 0,this.onUnload();try{p.default.PAssert(1206,p.default.focusedPane!==this,"Globally focused pane should never be the one destroyed")}catch(e){p.default.reportError(e)}try{p.default.PAssert(1207,y.a.getPane()!==this,"Selection focused pane should never be the one destroyed")}catch(e){p.default.reportError(e)}try{p.default.PAssert(1208,!k.default.PaneManager.isPaneActive(this.id),"Pane manager has reference to pane in map to destroyed pane")}catch(e){p.default.reportError(e)}this.onDestroyed.notify()}},{key:"notifyPluginLoaded",value:function(){try{p.default.PAssert(1209,!1,"Plugin load notification not supported by pane type: ",this.type)}catch(e){p.default.reportError(e)}}},{key:"getContextMenuMode",value:function(){return this.contextMenuMode}},{key:"isItemDraggable",value:function(){return this.isDraggable}},{key:"isOkOnAgenda",value:function(e){return!1}},{key:"getItemStore",value:function(){return this.getRootItem().getItemStore()}},{key:"usesItemStore",value:function(e,t){return!(this.supportsDocuments&&this.getRootItem()&&e===this.getItemStore()&&t&&t.getDocumentOwner()!==this.getDocument())&&(e===this.getItemStore()||!!this._activeItemStores[e.id])}},{key:"useItemStore",value:function(e){try{p.default.PAssert(1210,!this._activeItemStores[e.id],"Should never use the same store twice")}catch(t){p.default.reportError(t)}this._activeItemStores[e.id]=e}},{key:"stopUsingItemStore",value:function(e){try{p.default.PAssert(1211,this._activeItemStores[e.id],"Must be using item store to stop using it")}catch(t){p.default.reportError(t)}delete this._activeItemStores[e.id]}},{key:"getOverview",value:function(){return this.overview}},{key:"isOverviewVisible",value:function(){var e;return null===(e=this.overview)||void 0===e?void 0:e.isVisible.get()}},{key:"numItems",value:function(){return this.getItems().length}},{key:"numHeaders",value:function(){return this.headersArr.length}},{key:"getItems",value:function(){return k.default.PaneUpdateBatcher.flushItemsUpdate(this),this.items.get()}},{key:"getHeaders",value:function(){return this.headerPaneObjects.get()}},{key:"itemAtIndex",value:function(e){var t;return null===(t=this.objectAtIndex(e))||void 0===t?void 0:t.item}},{key:"objectAtIndex",value:function(e){return this.getItems()[e]}},{key:"objectAtIndexWithoutFlushing",value:function(e){return this.items.get()[e]}},{key:"indexOfItem",value:function(e,t,a){var n,r;return null!==(n=null===(r=this.findItem(e,t,a))||void 0===r?void 0:r.index)&&void 0!==n?n:-1}},{key:"findItem",value:function(e,t,a){var n=0;for(var r,i=this.getItems(),o=this.isViewAutoBlocks(),s=0;s<i.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=i[s];if(o){if(l.item===e)return l}else l.item===e&&(r||(r=[]),r.push(l))}if(r){if(a){for(var u,c,d=0,h=0;h<r.length;h++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var f=Math.abs(r[h].index-a);(isNaN(c)||f<u)&&(c=h,u=f)}return r[c]}return r[0]}}},{key:"indexOfTop",value:function(){return this.listManager.indexOfTop()}},{key:"elementAtIndex",value:function(e){return this.listManager.getElementByIndex(e)}},{key:"addScrollListener",value:function(e){this.listManager.addScrollListener(e)}},{key:"removeScrollListener",value:function(e){this.listManager.removeScrollListener(e)}},{key:"scrollIndexIntoView",value:function(e,t){this.scrollToIndex(e,"auto",t)}},{key:"scrollItemIntoView",value:function(e,t){this.scrollToItem(e,"auto",t)}},{key:"scrollIndexToTop",value:function(e,t,a){this.scrollToIndex(e,"start",t,a)}},{key:"scrollItemToTop",value:function(e,t){this.scrollToItem(e,"start",t)}},{key:"scrollIndexToMiddle",value:function(e,t){this.scrollToIndex(e,"center",t)}},{key:"scrollItemToMiddle",value:function(e,t){this.scrollToItem(e,"center",t)}},{key:"scrollToItem",value:function(e,t,a){var n=this.indexOfItem(e);this.scrollToIndex(n,t,a)}},{key:"scrollToIndex",value:function(e,t,a,n){this.listManager.scrollToIndex(e,t,a,n)}},{key:"addScrollDelta",value:function(e,t){var a=this.listManager.getScrollOffset()+Math.floor(e);return a>0&&a<this.mobileHeadingScrollThreshold&&(a=this.mobileHeadingScrollThreshold),this.listManager.scrollToOffset(a,t)}},{key:"closestIndexOfObject",value:function(e){return e.index}},{key:"handleStatusClick",value:function(){}},{key:"_getLoadingMessage",value:function(){return"Loading..."}},{key:"getStatusMessage",value:function(e){var t;return e||(this.isLoading.get()?t=this._getLoadingMessage():0===this.numItems()?t=this.isSearched()&&this._allPaneItems.length>0?this.paneEmptySearchMessage:this.paneEmptyMessage:this.isReady.get()||(t=this._getNotReadyStatus())),t}},{key:"_getNotReadyStatus",value:function(){return"Pane data is only available while online."}},{key:"getSaveInfoForClone",value:function(){var e=this.getSaveInfo();for(var t in delete e.id,e)e.hasOwnProperty(t)&&p.default.isObject(e[t])&&(e[t]=p.default.clone(e[t]));return e}},{key:"getSaveInfo",value:function(){var e,t=this.document.get(),a=this.listManager.getScrollIndex();return a<0&&(a=this.initialScrollIndex),{id:this.id,name:this.name.get(),item:null===(e=this.item.get())||void 0===e?void 0:e.id,document:t?t.id:void 0,type:this.type,showarch:this.showArchived.get(),search:this.search.getState(),scrollIndex:a,itemState:this.getSaveInfoItemState(),isOverviewVisible:this.overview.isVisible.get(),isExpanded:this.isExpanded.get(),widthManual:this.widthManual,widthManualExpanded:this.widthManualExpanded,documentSortMode:this.documentSortMode.get()}}},{key:"getSaveInfoItemState",value:function(){var e=this._perPaneState,t={};for(var a in e)if(e.hasOwnProperty(a)){var n=W.a.getItem(a);if(n){var r=e[a];for(var i in r)if(r.hasOwnProperty(i)&&i.startsWith(f.a.PerPaneStateField.Collapsed)){var o=r[i];if(void 0!==o){var s=i.replace(f.a.PerPaneStateField.Collapsed,"");if("Search"===s||o!==this.getCollapsedDefault(n,"Overview"===s,s)||!o&&n.isDemandLoad()){var l=(r[i]?"":"un")+i;t[l]||(t[l]=[]),t[l].push(a)}}}}else delete e[a]}return t}},{key:"saveState",value:function(e){k.default.PaneManager.updatePaneStateForPane(this,e)}},{key:"getPerPaneState",value:function(e,t){var a=this._perPaneState[e];if(a)return a[t]}},{key:"setPerPaneState",value:function(e,t,a){this._perPaneState[e]||(this._perPaneState[e]={}),this._perPaneState[e][t]=a}},{key:"clearPerPaneStateSearch",value:function(){var e=this._perPaneState;for(var t in e)e.hasOwnProperty(t)&&(e[t][f.a.PerPaneStateField.CollapsedSearch]=void 0)}},{key:"deletePerPaneState",value:function(e){this._perPaneState[e]=void 0}},{key:"isSearched",value:function(){try{p.default.PAssert(1214,this.search,"Pane must be initialized: ",this._destroyed)}catch(e){p.default.reportError(e)}return!!this.search&&this.search.isSearched()}},{key:"isSearchedText",value:function(){try{p.default.PAssert(1215,this.search,"Pane must be initialized: ",this._destroyed)}catch(e){p.default.reportError(e)}return!!this.search&&this.search.getValue()}},{key:"onSearchChanged",value:function(e){var t=y.a.isValid();if(t&&y.a.reset(),this.updateItems(),t&&this.numItems()>0){var a=this.indexOfFirstItem();a>=0&&y.a.selectIndex(a,0)}this.saveState()}},{key:"refreshSearchResults",value:function(){this.updateItems(!0)}},{key:"_applyItemStateArr",value:function(e,t,a){if(e)for(var n=0,r=0;r<e.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var i=e[r];this.setPerPaneState(i,t,a)}}},{key:"applyItemState",value:function(e){var t=this;e&&(this._perPaneState={},Object.keys(e).forEach((function(a){var n=a.startsWith("un"+f.a.PerPaneStateField.Collapsed)?a.slice(2):a;if(n.startsWith(f.a.PerPaneStateField.Collapsed)){var r=e[a];t._applyItemStateArr(r,n,!a.startsWith("un"))}})))}},{key:"requestDemandLoadData",value:function(e){try{p.default.PAssert(1216,!1,"SubClass must override - by default demand load is not supported")}catch(t){p.default.reportError(t)}}},{key:"requestDataPage",value:function(e){try{p.default.PAssert(1217,!1,"SubClass must override - by default data pagination is not supported")}catch(t){p.default.reportError(t)}}},{key:"getDefaultDisplayItem",value:function(e){return this.getRootItem()}},{key:"getRootItem",value:function(){var e;return null===(e=this.document.get())||void 0===e?void 0:e.getRootItem()}},{key:"setRootItem",value:function(e,t){try{p.default.PAssert(1218,void 0===e.parent(),"Root should never have a parent")}catch(a){p.default.reportError(a)}try{p.default.PAssert(1219,this.getItem()!==e,"Should not be setting root to the same value")}catch(a){p.default.reportError(a)}this.setItem(e,t)}},{key:"scrollFromMousePosition",value:function(e,t,a){a?this.getWidth():this.getHeight();var n=a?this.getWidth():this.getHeight(),r=n-60,i=a?e-this.paneContent.getBoundingClientRect().left:t-this.contentTop(),o=0;i<60?o=Math.round(p.default.computeScrollSpeed(0,60,i,20,-1)):i>n||i>r&&(o=Math.round(p.default.computeScrollSpeed(r,n,i,20,1))),0!==o?p.default.repeatScrollPane(o,this):p.default.cancelRepeatScroll("pane")}},{key:"getContentElement",value:function(){return this.paneContent}},{key:"getPaneIcon",value:function(){return"icon-align-left"}},{key:"itemHasChildren",value:function(){return this.getItem().numItems()>0}},{key:"getItem",value:function(e){return this.item.get()}},{key:"allowZoom",value:function(e){return!0}},{key:"performOverviewAction",value:function(e){}},{key:"setItem",value:function(e,t,a,n){this._numItemSets++,g.a.disable();var r=this.getItem();this.item.set(e,!1),a||this.updateItemsImmediate(!0,!1,!0),te.a.beginBatch(),r&&r.parent()&&r._updateStylePadding(r.parent().levelsDeep.get(),!0),!n&&r&&r.id!==e.id&&this.pushHistory({item:r.id}),t&&(e.itemChanged.notify(),r&&e!==r&&r.itemChanged.notify(),this.item.notify(e,r)),y.a.reset(),te.a.endBatch()}},{key:"getItemSearchParams",value:function(){var e=this;return{item:this.getItem(),comparator:function(t){return e.search.isMatched(t)},noCollapsed:!0,includeNotes:!0,pane:this}}},{key:"getHeaderSearchParams",value:function(){return{item:this.getRootItem(),comparator:this.search.isMatchedHeader,noCollapsed:!0,collapseAfterDepth:1,headers:!0,overview:!0,pane:this}}},{key:"setItemsDirty",value:function(){this._setDirtyState(!1,!1)}},{key:"isItemsDirty",value:function(){return!!this.itemsDirtyState}},{key:"isItemsHeightDirty",value:function(){return this.itemsHeightDirty}},{key:"_setDirtyState",value:function(e,t){this.itemsDirtyState?(this.itemsDirtyState.updateSearch=e||this.itemsDirtyState.updateSearch,this.itemsDirtyState.forceNotify=t||this.itemsDirtyState.forceNotify):this.itemsDirtyState={updateSearch:e,forceNotify:t}}},{key:"updateItems",value:function(e,t){this._setDirtyState(e,t),k.default.PaneUpdateBatcher.updateAllItems()}},{key:"updateItemsImmediate",value:function(e,t,a,n){var r=this;if(!this.isFakePane&&this.isActive.get()){this.itemsDirtyState&&(e=e||this.itemsDirtyState.updateSearch,t=t||this.itemsDirtyState.forceNotify,this.itemsDirtyState=void 0),p.default.shouldLog(f.a.LogLevels.React)&&p.default.log("update items"),this.search.isRunningSearch||this.search.update(void 0,void 0,!n);var i=this.getItem(),o=[],s=!1,l=this.getItemSearchParams();0,l.each=function(e){e.isNote()&&e.parent()===i||(o.push(e),s=s||e.isCollapsed(r))},this.runItemSearch(l),this._numItemComputes++,this.setItems(o,t),this.updateHeaders(t||a),this.updateCollapsedObs(s),this.isInitialized||(this.isInitialized=!0),this.itemsHeightDirty=!1,F.a.fireEvent("itemsUpdated",[this])}}},{key:"updateCollapsedObs",value:function(e){this.hasCollapsedObs.set(e)}},{key:"updateItemHeights",value:function(){this.itemsHeightDirty=!1,this.plugin||this.listManager.onListChanged()}},{key:"runItemSearch",value:function(e){p.default.searchVMLIs(e)}},{key:"updateOutline",value:function(e,t){var a,n=0,r=[],i={};if(t){var o=0,s=0,l=[];for(a=0;a<e.length;a++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;e[a].isNote()||l.push({item:e[a],index:l.length})}for(l.sort(t),e=[],a=0;a<l.length;a++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var u=l[a].item;e.push(u)}}for(a=0;a<e.length;a++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var c=e[a];if(!c.isNote()){var d=new K.a({type:"blockItem",item:c,id:c.id,pane:this,index:r.length,parentObject:i[c.parent().id],sizeInPane:c.sizeInPane});i[c.id]=d,this.addPaneObject(r,d)}}this.items.set(r)}},{key:"_setItems",value:function(e,t){this.updateOutline(e)}},{key:"setItems",value:function(e,t){this._allPaneItems=e,this.paneObjects={},this.paneObjectsByItem={},this._setItems(e,t),y.a.getPane()===this&&y.a.checkValid()}},{key:"updateHeaders",value:function(e){var t=[];if(this.updateHeadersOverride)t=this.updateHeadersOverride();else{var a=this.getHeaderSearchParams();a.each=function(e){t.push(e)},p.default.searchVMLIs(a)}this._numHeaderComputes++,this.setHeaders(t,e)}},{key:"setHeaders",value:function(e,t){var a=this;this.headersArr=e;var n=e.map((function(e,t){return new K.a({type:"blockItem",item:e,id:e.id,pane:a,overview:!0,index:t,sizeInPane:f.a.OverviewItemHeightDesktop})}));this.headerPaneObjects.set(n)}},{key:"clearItems",value:function(e){this.items.set([],e)}},{key:"onLoad",value:function(){this.isLoaded=!0,this.onLoadExtra&&this.onLoadExtra(),this.isFakePane&&(this.isFakePane=!1,this.becomeReal())}},{key:"onUnload",value:function(){this.onUnloadExtra&&this.onUnloadExtra()}},{key:"getSize",value:function(){return{width:this.getWidth(),height:this.getHeight()}}},{key:"getWidth",value:function(){var e,t=this._cachedWidth;if(t=null!==(e=t)&&void 0!==e?e:this.rect.get().width,this.getWidthExtra){var a=this.getWidthExtra();void 0!==a&&(t+=a)}return t}},{key:"getHeight",value:function(){return this.rect.get().height-this.headerHeight()}},{key:"getItemHeight",value:function(){}},{key:"getLeft",value:function(){return this.rect.get().left}},{key:"toggleOverviewVisibility",value:function(){this.overview.toggle()}},{key:"notifyDropFrom",value:function(e,t){}},{key:"dropEffectCopyBehavior",value:function(e,t){return e.clone(t,f.a.ChangeType.Local)}},{key:"_isNodeTextParent",value:function(e){return ie.every((function(t){return!e.classList.contains(t)}))}},{key:"convertElementToText",value:function(e){var t="";if("TEXTAREA"===e.nodeName)t+=e.value;else if(e.nodeType===Node.TEXT_NODE)t+=e.nodeValue;else if(this._isNodeTextParent(e))for(var a=0,n=0;n<e.childNodes.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t+=this.convertElementToText(e.childNodes[n])}return t}},{key:"addItemToPane",value:function(e,t){var a=this.getItem();e.text||(e.text=""),this.setIgnoreRestoreScroll();var n=a.addItemAtIndex(e,t,this);return z.a.setSelected([t],this),n}},{key:"archiveItem",value:function(e,t){return t.archiveSelf(f.a.ChangeType.Local)}},{key:"archiveSelected",value:function(e){var t=this,a=0,n=this.indexOfPrevVMLI(y.a.getStartIndex(),!0);if(this.applyToSelection((function(e){t.archiveItem(!0,e),a++})),a>0){if(n<0&&this.numItems()>0&&(n=this.indexOfFirstItem()),n>=0){var r=this.itemAtIndex(n).getParsedText().length;y.a.selectIndex(n,r)}var i=a>1?" items.":" item.";k.default.toasts.pushMessage({text:"Archived "+a+i,action:f.a.MessageAction.Undo,hold:!1,timeout:8e3})}}},{key:"deleteSelected",value:function(e,t){var a=this;y.a.confirmDangerousSelection((function(){var t=a.indexOfPrevVMLI(y.a.getStartIndex(),!0),n=0;b.a.saveDeleteSelection();var r,i=[];a.applyToSelection((function(t){e&&!e(t)||t.isDeleted()||(n+=t.numChildrenRecursive()+1,i.push(t),r||(r=t.checkDeleteProblem()))}));var o=function(){if(b.a.beginAction(),k.default.PaneUpdateBatcher.beginUpdateItems(),i.forEach((function(e){e.deleteSelf(f.a.ChangeType.Local)})),k.default.PaneUpdateBatcher.commitUpdateItems(),b.a.endAction(),t<0&&a.numItems()>0&&(t=a.indexOfFirstItem()),t>=0){var e=a.itemAtIndex(t);if(e){var r=e.getParsedText().length;y.a.selectIndex(t,r)}else y.a.reset()}var o=n>1?" items.":" item.";k.default.toasts.pushMessage({text:"Deleted "+n+o,action:f.a.MessageAction.Undo,timeout:f.a.ToastTimeoutDefault})};r?k.default.menus.confirm("One of the selected items is ".concat(r,". Are you sure you want to delete?"),(function(e){e&&o()})):o()}))}},{key:"handleLeftSideTap",value:function(e,t){var a=e.item;if(this.supportCollapsing)if(v.a.mac&&t.metaKey||!v.a.mac&&t.ctrlKey)this.zoomIn(a);else if(a.isCollapsible()||e.isBlockHeader){var n=y.a.save(),r=!this.isPaneObjectCollapsed(e);t.shiftKey?this.collapseAll(a,r,!0):this.setPaneObjectCollapsed(r,e),n&&this.restoreSelectionAfterCollapse(n,r)}}},{key:"handleRightSideTap",value:function(e){this.supportCompleting&&(p.default.beginCompleteAction(),e.setComplete(!e.isComplete(),f.a.ChangeType.Local),p.default.endCompleteAction())}},{key:"onClickTitle",value:function(e){var t=this.getItem();return this.zoomOut(e),p.default.sendEvent("Menu","Title"),t!==this.getItem()}},{key:"isZoomed",value:function(){return this.getItem()!==this.getRootItem()}},{key:"onDoubleClickTitle",value:function(){this.toggleCollapseAll()}},{key:"addItem",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.index,e.prefix,e.text,e.toRoot}},{key:"onClose",value:function(){}},{key:"onTapAddItem",value:function(){this.addItem()}},{key:"onTapOverviewButton",value:function(){this.toggleOverviewVisibility(),this.isOverviewVisible()?p.default.sendEvent("Menu","OpenOverview"):p.default.sendEvent("Menu","CloseOverview")}},{key:"onTapClosePane",value:function(){var e=k.default.PaneManager.removePane(this);if(e){try{p.default.PAssert(1221,e===this.id,"Pane IDs must match")}catch(t){p.default.reportError(t)}p.default.sendEvent("Menu","ClosePane"),k.default.tooltip.hideTip(),this.onClose()}}},{key:"onClickArchiveCompleted",value:function(e){this.archiveCompleted(),p.default.preventAndStop(e),p.default.sendEvent("Menu","ArchiveCompleted")}},{key:"onClickRefreshData",value:function(e,t){try{p.default.PAssert(1222,this.supportDataRefresh,"How did this pane try to perform a data refresh if it is not supported",this.type)}catch(a){p.default.reportError(a)}this.refreshPaneData(t),p.default.sendEvent("Menu","PaneDataRefresh"),p.default.preventAndStop(e)}},{key:"onClickRefreshDataForce",value:function(e){this.onClickRefreshData(e,!0)}},{key:"onClickReportError",value:function(e){try{p.default.PAssert(1223,this.supportReportError,"Pane does not support error reporting")}catch(t){p.default.reportError(t)}this.reportPaneError(),p.default.sendEvent("Menu","PaneReportError"),p.default.preventAndStop(e)}},{key:"refreshPaneData",value:function(e){W.a.isConnected()||k.default.toasts.pushMessage({text:"Your connection appears to be offline. Data will refresh when you go online."}),this._refreshPaneData(e)}},{key:"_refreshPaneData",value:function(e){}},{key:"reportPaneError",value:function(){}},{key:"getItemsToArchive",value:function(){var e=[];return p.default.searchVMLIs({item:this.getItem(),pane:this,each:function(t){t.isComplete()&&!t.isNote()&&e.push(t)}}),e}},{key:"archiveCompleted",value:function(){var e,t,a,n=0;if(y.a.isValid()){var r=0;for(t=y.a.getEndIndex();t<this.items.length();){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if((a=this.itemAtIndex(t))&&!this.itemAtIndex(t).hasCompletedAncestor()){e=this.objectAtIndex(t);break}t++}}var i=this.getItemsToArchive();for(k.default.PaneUpdateBatcher.beginUpdateItems(),t=i.length-1;t>=0;t--){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;a=i[t],p.default.shouldLog(f.a.LogLevels.Data)&&p.default.log("Archive Item: ",a.getParsedText()),a.archiveSelf(f.a.ChangeType.Local)}if(k.default.PaneUpdateBatcher.commitUpdateItems(),i.length>0){var o=i.length>1?" items.":" item.";k.default.toasts.pushMessage({text:"Archived "+(i.length+o),action:f.a.MessageAction.Undo,hold:!1,timeout:8e3})}else k.default.toasts.pushMessage({text:"No completed items to archive"});if(e){var s=e.index;if(s>=0){a=this.itemAtIndex(s);try{p.default.PAssert(1224,a,"Could not restore selection to item")}catch(u){p.default.reportError(u)}if(a){var l=a.getParsedTextWithoutPrefix().length;y.a.selectIndex(s,l)}}}else y.a.reset()}},{key:"bottomListMessage",value:function(){}},{key:"isSearchingRemote",value:function(){return!1}},{key:"getTitleList",value:function(){return this.usesVMLIs?this.getItem().parents().concat(this.getItem()):[]}},{key:"itemTitle",value:function(){return this.getItem().parent()?this.getItem().getParsedText():this.titleOfFirstItem()}},{key:"titleOfFirstItem",value:function(){return this.getDocument().text.get()}},{key:"onShowArchivedChanged",value:function(){this.showArchived.get()&&F.a.fireEvent("showArchived",[]),this.updateItems()}},{key:"onDocumentsChanged",value:function(){this.supportsDocuments&&this.updateHeaders(!1)}},{key:"indexOfFirstItem",value:function(){return this.indexOfNextVMLI(-1)}},{key:"indexOfLastItem",value:function(){return this.indexOfPrevVMLI(this.numItems(),!1)}},{key:"getFirstItem",value:function(){var e=this.indexOfFirstItem();if(e>=0){var t=this.getItems()[e];return t?t.item:void 0}}},{key:"getFirstObject",value:function(){return this.objectAtIndex(this.indexOfFirstItem())}},{key:"getLastItem",value:function(){return this.itemAtIndex(this.indexOfLastItem())}},{key:"getLastObject",value:function(){return this.objectAtIndex(this.indexOfLastItem())}},{key:"setFocused",value:function(e){this.isFocused.set(e)}},{key:"findPaneObject",value:function(e){return k.default.PaneUpdateBatcher.flushItemsUpdate(this),this.paneObjects[e]}},{key:"headerHeight",value:function(){return 68}},{key:"handleUndo",value:function(){var e;(null===(e=this.search)||void 0===e?void 0:e.isFocused.get())||b.a.undo()}},{key:"handleRedo",value:function(){var e;(null===(e=this.search)||void 0===e?void 0:e.isFocused.get())||b.a.redo()}},{key:"contentTop",value:function(){return f.a.Mobile.TopBarHeight}},{key:"restoreSelection",value:function(e){y.a.restore(e)}},{key:"restoreSelectionAfterCollapse",value:function(e,t){if(e){var a,n=y.a.getStartSelectionOfMap(e.selectedMap),r=n.start,i=n.paneObject,o=y.a.getEndSelectionOfMap(e.selectedMap),s=o.end,l=o.paneObject;if(i&&l)y.a.selectObjects(i,r,l,s);else if(i)y.a.selectObject(i,r),a=!0;else if(l)y.a.selectObject(l,s),i=l,a=!0;else if(t)for(var u=0,c=i.parentObject;c;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var d=this.findPaneObject(c.id);if(d){y.a.selectObject(d,-1),i=y.a.getStartObject(),a=!0;break}c=c.parentObject}else y.a.reset();i&&a&&p.default.focusedPane.scrollIndexToMiddle(i.index)}}},{key:"setCollapsedRecursive",value:function(e,t,a,n){var r=0,i=e.numChildren(),o=e.getItems();a&&(this.canCollapse()||this.search.isMatched(e))&&e.setCollapsed(t,this,n,!1);for(var s=0;s<i;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var l=o[s];(l.isCollapsed(this)||l.hasChildren()&&(this.isViewFlatList()||this.search.isMatched(l)))&&this.setCollapsedRecursive(l,t,!0,n)}}},{key:"collapseAll",value:function(e,t,a){try{p.default.PAssert(1225,this.supportCollapsing,"Should not be collapsing all")}catch(i){p.default.reportError(i)}var n=e||this.item.get(),r=y.a.save();this.setIgnoreRestoreScroll(),k.default.PaneUpdateBatcher.beginUpdateItems(),void 0!==t&&this.setCollapsedRecursive(n,t,!!a),this.saveState(),this.updateItems(),k.default.PaneUpdateBatcher.commitUpdateItems(),this.restoreSelectionAfterCollapse(r,t)}},{key:"toggleCollapseAll",value:function(){if(this.supportCollapsing){var e=!this.hasCollapsed();this.collapseAll(this.item.get(),e)}}},{key:"hasCollapsed",value:function(){return this.hasCollapsedObs.get()}},{key:"onOverviewToggled",value:function(e){}},{key:"getPaddingForPaneObject",value:function(e){var t,a=e.overview;t=!a&&this.isViewFlatList()?k.default.DisplaySettings.itemIndentStart():k.default.DisplaySettings.getPaddingForLevel(e.levelsDeepNew(),a);var n=this.getWidth();return void 0===this.extraPaddingForPaneObject||a||(t+=this.extraPaddingForPaneObject(e)),t=Math.min(t,n-f.a.SPThresholdRight-8),k.default.settings.alignIndentToPrefix.get()&&(t-=f.a.PrefixWidth),t}},{key:"maxWidthOfPaneObject",value:function(e){var t=e.item,a=e.pane;var n=1e4*(t.hasPrefix()?1:0)+1e5*(t.isNote()?1:0)+e.levelsDeepNew();if(void 0===this._cachedMaxWidths[n]){var r,i=this.getPaddingForPaneObject(e);r=a.listManager?this.getWidth()-i-f.a.ItemPaddingRightVirtuoso:this.getWidth()-i-f.a.SPThresholdRight-(t.hasPrefix()?this.shouldRenderPrefix(e)?f.a.PrefixWidth:5:0),this._cachedMaxWidths[n]=Math.floor(Math.max(f.a.MinItemWidth,r))}return this._cachedMaxWidths[n]}},{key:"prevPaneObjectAtSameLevel",value:function(e){var t=0;try{p.default.PAssert(1226,e>=0,"Must supply a valid selection index: "+e)}catch(o){p.default.reportError(o)}try{p.default.PAssert(1227,e<this.numItems()+1,"Must supply a valid selection index: "+e)}catch(o){p.default.reportError(o)}for(var a=this.objectAtIndex(e),n=e-1;n>=0;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.objectAtIndex(n),i=this.itemAtIndex(n);if(i&&a.item!==i&&!i.isNote()&&r.levelsDeepNew()===a.levelsDeepNew())return r;n--}}},{key:"getSiblingsAfterPaneObject",value:function(e){for(var t=0,a=e.index,n=e.item,r=this.numItems(),i=[],o=a+1;o<r;o++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s=this.objectAtIndex(o),l=s.item;if(!l||n===l||l.parent()!==n.parent())break;i.push(s)}return i}},{key:"getChildrenOfPaneObject",value:function(e){for(var t=0,a=e.item,n=e.index,r=this.numItems(),i=[],o=n+1;o<r;o++){var s;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var l=this.objectAtIndex(o);if(!(null===l||void 0===l||null===(s=l.item)||void 0===s?void 0:s.isDescendantOf(a)))break;i.push(l)}return i}},{key:"indexOfPrevVMLI",value:function(e,t){var a=0;try{p.default.PAssert(1228,e>=0,"Must supply a valid selection index: "+e)}catch(o){p.default.reportError(o)}try{p.default.PAssert(1229,e<this.numItems()+1,"Must supply a valid selection index: "+e)}catch(o){p.default.reportError(o)}for(var n=t?this.itemAtIndex(e):void 0,r=e-1;r>=0;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=this.itemAtIndex(r);if(i&&n!==i)return r;r--}return-1}},{key:"indexOfNextVMLI",value:function(e,t){var a=0;try{p.default.PAssert(1230,e>=-1,"Must supply a valid selection index: "+e)}catch(o){p.default.reportError(o)}try{p.default.PAssert(1231,e<this.numItems(),"Must supply a valid selection index: "+e)}catch(o){p.default.reportError(o)}for(var n=t?this.itemAtIndex(e):void 0,r=e+1;r<this.numItems();){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=this.itemAtIndex(r);if(i&&n!==i)return r;r++}return-1}},{key:"indexOfPrevHeader",value:function(e){var t=0;try{p.default.PAssert(1232,e>=-1,"Must supply a valid selection index: "+e)}catch(r){p.default.reportError(r)}try{p.default.PAssert(1233,e<this.numItems(),"Must supply a valid selection index: "+e)}catch(r){p.default.reportError(r)}for(var a=e-1;a>=0;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this.itemAtIndex(a);if(null===n||void 0===n?void 0:n.isPrefixHeader())return a;a--}return-1}},{key:"indexOfNextHeader",value:function(e){var t=0;try{p.default.PAssert(1234,e>=-1,"Must supply a valid selection index: "+e)}catch(r){p.default.reportError(r)}try{p.default.PAssert(1235,e<this.numItems(),"Must supply a valid selection index: "+e)}catch(r){p.default.reportError(r)}for(var a=e+1;a<this.numItems();){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this.itemAtIndex(a);if(null===n||void 0===n?void 0:n.isPrefixHeader())return a;a++}return this.numItems()-1}},{key:"findNextSiblingItem",value:function(e){var t=this.findPaneObject(e.id);if(t){for(var a,n=0,r=t.index,i=t.item,o=this.numItems(),s=r+1;s<o;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=(a=this.objectAtIndex(s)).item;if(l&&!l.isDescendantOf(i))break}return a}}},{key:"_getPrevNextItem",value:function(e,t,a){var n=a?this.indexOfNextVMLI:this.indexOfPrevVMLI,r=n.call(this,e);if(t)for(var i=0,o=this.itemAtIndex(e);r>=0;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=this.itemAtIndex(r);if(o.parent()===s.parent())return s;if(o.parent()===s||s.parent()===o.parent().parent()){r=-1;break}r=n.call(this,r)}else if(r>=0)return this.itemAtIndex(r)}},{key:"getPreviousItem",value:function(e,t){return this._getPrevNextItem(e,t,!1)}},{key:"getNextItem",value:function(e,t){return this._getPrevNextItem(e,t,!0)}},{key:"getFirstSelectedItem",value:function(){var e;return this.applyToSelection((function(t){return e=t,!1})),e}},{key:"getFirstSelectedIndex",value:function(){return y.a.getStartIndex()}},{key:"applyToSelection",value:function(e,t){y.a.forEach(e,t)}},{key:"applyFnToSelection",value:function(e,t){var a=y.a.save(),n=t&&t.toggle,r=!t||void 0===t.value||t.value,i=t&&void 0!==t.value2?t.value2:void 0;if(this.applyToSelection((function(t){n&&t[n]()!==r&&(n=void 0),n||t[e](r,i)})),n){var o=!(!t||void 0===t.emptyValue)&&t.emptyValue;this.applyToSelection((function(t){t[e](o,i)}))}a&&!t.noRestoreSel&&this.restoreSelection(a)}},{key:"applyPriorityToSelection",value:function(e,t){t?this.applyFnToSelection("setPriority",{toggle:"getPriority",value:e,value2:f.a.ChangeType.Local,emptyValue:f.a.VMLIFlag.None}):this.applyFnToSelection("setPriority",{value:e,value2:f.a.ChangeType.Local})}},{key:"autocompleteTag",value:function(){this._autocompletePopup({mode:"tag",text:"Add tag",buttonText:"Add"},(function(e,t){var a=t.value.trim(),n=e.getParsedText()+" "+f.a.TagPrefix+a;e.setText(n,f.a.ChangeType.Local)}))}},{key:"autocompleteMove",value:function(e,t){var a=this;(e=e||{}).mode="move",e.text="Select item to move to",e.documentSelector=!this.supportsDocuments,e.buttonText="MOVE",this._autocompletePopup(e,(function(e,t,n){var r;t.subItemText?(r=a.createVMLI({text:t.subItemText},{parent:t.item,changeType:f.a.ChangeType.AllLocal}),t.item.insertItem(r,0)):t.item===e||t.item.isDescendantOf(e)||(r=t.item),r&&!n.includes(e.parent())&&a.moveItem(e,r)}),(function(){t&&t(),y.a.updateCaret()}))}},{key:"autocompleteSchedule",value:function(e){var t=e.item,a=e.element;e.onClose;k.default.menus.openDate({element:a||y.a.getStartElement(),pane:this,onSelect:function(e){var a=k.default.pluginManager.getPlugin(f.a.PluginID.Gmail);p.default.isDateValid(e)?a.scheduleEmail(t,e):k.default.toasts.pushMessage({text:"Unable to read date. Please try a different option.",action:f.a.MessageAction.Okay})}})}},{key:"autocompleteLabel",value:function(e,t){var a,n=this,r=k.default.pluginManager.getPlugin(f.a.PluginID.Gmail),i=function(e){var t=e.getAttachmentByPlugin(r.id),n=t.getPlugin().getDisplayTags(t);a=a?p.default.arrayIntersection(a,n):n};(e=e||{}).item?i(e.item):this.applyToSelection(i),e.tokens=(a||[]).map((function(e){return{text:e}})),e.mode="gmailLabel",e.text="Select a label",e.buttonText="LABEL",e.allowCustom=!0,e.allowEmpty=!0,e.onTokenRemoved=function(a){var i=a.text;r.beginAction();var o=function(e){var t=e.getAttachmentByPlugin(r.id);if(t)if(r.attachmentHasLabel(t,i))r.performAction(f.a.PluginAction.Gmail.RemoveLabel,!1,t,i);else try{p.default.PAssert(1236,!1,"Tried to remove a tag from an attachment without a tag")}catch(a){p.default.reportError(a)}else k.default.toasts.pushMessage(f.a.MessageID.ReselectEmail)};e.item?o(e.item):n.applyToSelection(o),r.endAction(),t&&t(a)},this._autocompletePopup(e,(function(e,t){var a=t.value.trim();try{p.default.PAssert(1237,e.hasPluginAttachment(r.id),"Must have valid plugin attachment")}catch(o){p.default.reportError(o)}var n=e.getAttachmentByPlugin(r.id);if(n){if(a){var i=r.createLabelString(a);i?r.attachmentHasLabel(n,i)||r.performAction(f.a.PluginAction.Gmail.AddLabel,!1,n,i):k.default.toasts.pushMessage({text:"Cannot create a label with a reserved named.",action:f.a.MessageAction.Okay})}}else k.default.toasts.pushMessage(f.a.MessageID.ReselectEmail)}))}},{key:"_autocompletePopup",value:function(e,t,a){var n=this;if(!e.elementDisplay){var r=y.a.getSelectedObjects().find((function(e){return!!n.elementAtIndex(e.index)}));r&&(e.elementDisplay=this.elementAtIndex(r.index))}var i=e.item,o=e;o.pane=this,o.item||(o.item=this.getRootItem()),o.onSelected=function(e){i?t(i,e,[i]):n.applyToSelection((function(a,n,r,i,o){t(a,e,o)})),a&&a(e)},A.a.showPopup(o)}},{key:"moveItem",value:function(e,t){if(k.default.PaneUpdateBatcher.beginUpdateItems(),t.belongsToSameItemStore(e))e.moveTo({parent:t,index:0},f.a.ChangeType.Local);else{var a=this.dropEffectCopyBehavior(e,t);a.setParent(t),t.insertItem(a)}k.default.PaneUpdateBatcher.commitUpdateItems()}},{key:"setPropDefault",value:function(e,t){void 0===this[e]&&(this[e]=t)}},{key:"setExpanded",value:function(e,t){var a=this,n=this.isExpanded.get()!==e;p.default.batchRenderUpdates((function(){a.isExpanded.set(e),n&&!1!==t&&(F.a.fireEvent("panesChanged",[]),a.saveState(),k.default.PaneManager.ensurePaneInView(a))}))}},{key:"modifyTextOnDropBasedOnSearch",value:function(e,t,a,n,r,i){var o=0;if(!a||!a.search)return e;var s,l,u=a.search,c=this.search,d=t[i](),h=u[i](),f=c[i](),p=[],g=[];for(s=0;f&&s<f.length;s++){var m=0;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;l=f[s];for(var v=n,y=!d||d.indexOf(l)<0;y&&v;){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;var k=v[i]();k&&k.indexOf(l)>=0&&(y=!1),v=v.parent()}y&&p.push(r+l)}if(p.length){var _=0;for(s=0;d&&h&&s<h.length;s++){if(_++>5e3&&__infLoop&&__infLoop(_))throw new RangeError;l=h[s],d.indexOf(l)>=0&&f.indexOf(l)<0&&g.push(r+l)}var b=p.join(" ");if(g.length>0){var w=0;for(s=0;s<g.length;s++){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;l=g[s],e=0===s?e.replace(l,b):e.replace(l,"")}}else e=e+" "+b;e=e.replace(/  +/g," ")}return e}},{key:"canAcceptDragOver",value:function(e,t,a,n){return this.isDropTarget}},{key:"handleDragOver",value:function(e,t,a,n,r){var i,o=p.default.getElementParent(t),s=o&&p.default.getItemForElement(o),l=(o||p.default.findParent(t,"blockHeader"))&&p.default.getPaneObjectForElement(t);if(p.default.hasClass(t,"overviewBottomPad"))i={overview:!0,atEnd:!0,targetItem:s=this.headersArr[this.headersArr.length-1],targetElement:t,targetPane:this,position:f.a.DragDropPosition.Below},k.default.DragDrop.dragInfo=i,this.overview.updateDragHoverItem(s);else if(o&&p.default.hasClass(o,"overviewItem")){var u,c=o.getBoundingClientRect(),d=c.height,h=this.type!==f.a.PaneMode.Task,g=null===r||void 0===r?void 0:r.isRoot;g?s.isRoot&&(u=f.a.DragDropPosition.Above):u=h&&g?f.a.DragDropPosition.On:!(n<=c.top+.3*d)||s&&s.isRoot?n>c.top+.7*d?f.a.DragDropPosition.Below:f.a.DragDropPosition.On:f.a.DragDropPosition.Above,void 0!==u?(i={overview:!0,targetItem:s,targetElement:o,targetPane:this,position:u},k.default.DragDrop.dragInfo=i,this.overview.updateDragHoverItem(s)):this.overview.updateDragHoverItem(null)}else this.overview.updateDragHoverItem(null),i=this._handleDragOverPane(e,t,o,l,a,n,r);return i}},{key:"_handleDragOverPane",value:function(e,t,a,n,r,i,o){}},{key:"handleDragDrop",value:function(e,t,a,n){var r;return(null===a||void 0===a?void 0:a.targetItem)&&(null===e||void 0===e?void 0:e.every((function(e){return e!==a.targetItem})))&&(r=this._handleDragDrop(e,t.dataTransfer,a,t,n)),this.revertDrag(),r}},{key:"_handleDragDrop",value:function(e,t,a,n,r){var o=this,s=n.ctrlKey,l=n.altKey,u=t.pane,c=a.overview,d=a.targetItem,h=a.dropOnPane,m=a.atEnd,y=a.position,_=!0,w=!1,S=i()({},d.id,this.indexOfItem(d)),D=d.parent();if(e.forEach((function(e){for(var t=0;D&&_;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;D===e&&(_=!1,k.default.toasts.pushMessage({text:"Cannot drop an item into its own children",action:f.a.MessageAction.Okay})),D=D.parent()}S[e.id]=o.indexOfItem(e)})),_){var P,I=-1;if(!e.every((function(e){return e.isRoot}))){if(h)P=d,I=m?d.numItems():0;else if(y===f.a.DragDropPosition.Above)P=d.parent(),I=d.getIndex();else if(y===f.a.DragDropPosition.On){P=d;var E=v.a.mac&&s||!v.a.mac&&l;I=E?0:d.numItems()}else{var C=!1;if(!c){var x=this.indexOfItem(d),A=this.getNextItem(x);A&&A.parent()===d&&!A.isNote()&&(P=d,I=0,C=!0)}C||(P=d.parent(),I=d.getIndex()+1)}try{p.default.PAssert(1238,P,"Trying to move without a target")}catch(M){p.default.reportError(M)}try{p.default.PAssert(1239,!isNaN(I),"Trying to move without a target index")}catch(M){p.default.reportError(M)}}w=!0,g.a.disable(),b.a.beginAction(),k.default.PaneUpdateBatcher.beginUpdateItems();var T=[];e.forEach((function(e){if(e.isRoot){if(d.isRoot){var a=d.getDocumentOwner(),n=W.a.documentsArray.indexOf(a)+(y>0?1:0);W.a.moveDocument(e.getDocumentOwner(),n)}}else if(t.dropEffect===f.a.DropEffect.Move){var i=e.parent();if(i)if(i.belongsToSameItemStore(P)){var s=e.isCollapsed(u),l=e.parent()===P&&S[d.id]>S[e.id];e.moveTo({parent:P,index:I},f.a.ChangeType.Local),o.search.stickMatch(e);var c=e.getRawText();c=o.modifyTextOnDropBasedOnSearch(c,e,u,P,f.a.TagPrefix,"getTags"),(c=o.modifyTextOnDropBasedOnSearch(c,e,u,P,f.a.ContactPrefix,"getContacts"))!==e.getRawText()&&e.setText(c,f.a.ChangeType.Local),T.push({item:e,isCollapsed:s}),l&&I--}else{var h=e.getIndex();e=e.clone(P,f.a.ChangeType.Local),o.search.stickMatch(e),P.insertItem(e,I),i.removeChildAtIndex(h,f.a.ChangeType.Local)}else e=e.clone(P,f.a.ChangeType.Local),o.search.stickMatch(e),P.insertItem(e,I)}else r||(e=t.pane?t.pane.dropEffectCopyBehavior(e,P):e.clone(P,f.a.ChangeType.Local)),e?(e.setParent(P),o.search.stickMatch(e),P.insertItem(e,I)):w=!1;w&&(t.pane&&t.pane.notifyDropFrom(e,o),I++)})),T.forEach((function(e){var t=e.item,a=e.isCollapsed;t.setCollapsed(a,o)})),w&&k.default.onIntroAction("Drag"),k.default.PaneUpdateBatcher.commitUpdateItems(),b.a.endAction()}return w}},{key:"revertDrag",value:function(){this.overview&&this.overview.updateDragHoverItem(null)}},{key:"isItemHeader",value:function(e,t){return t?e.hasHeaderChildren():e.hasVisibleChildren(this)}},{key:"openNoteContextMenuByPaneObject",value:function(e,t){var a,n=e.index,r=e.item;if(r.isNote()?a=r:(r.hasNote()||r.createNote(),a=r.getNote()),this.elementAtIndex(n)){var i=y.a.save();this.openNoteContextMenu(a,void 0,(function(){return y.a.restore(i)}),t)}}},{key:"openNoteContextMenu",value:function(e,t,a,n){_.b.openMenu({type:"Note",item:e.parent(),note:e,pane:this,startFullscreen:n||y.a.isKeyboardOpen,onClosed:a})}},{key:"closeNoteContextMenu",value:function(){k.default.menus.isContextMenuOpen()&&k.default.menus.closeContextMenu()}},{key:"canResetMultiselect",value:function(){return!0}},{key:"replaceTextOnDropOnBlock",value:function(e,t,a,n){var r=t.isNoKey?"":t.name,i=null===a||void 0===a?void 0:a.name,o=new RegExp(r+"\\b"),s=e.getRawText();if(""===r||!s.match(o)){if(i){var l=new RegExp(i+"\\b");s=s.replace(l,r)}else s+=" "+r;e.setText(s,f.a.ChangeType.Local)}}},{key:"applyDropOnBlock",value:function(e,t,a,n){var r=this;t.forEach((function(t){return r._applyDropOnBlockItem(e,t,a,n)}))}},{key:"_applyDropOnBlockItem",value:function(e,t,a,n){var r,i=e;if(y.a.setFocusedPane(a),i.isStarred||i.isImportant)i.isStarred?t.setStarred(!0,f.a.ChangeType.Local):i.isImportant&&(r=f.a.VMLIFlag.P0),r&&t.setPriority(r,f.a.ChangeType.Local);else if(e.isTag)this.replaceTextOnDropOnBlock(t,e,n&&n.isTag?n:void 0,"#");else if(e.isContact)this.replaceTextOnDropOnBlock(t,e,n&&n.isContact?n:void 0,"+");else if(e.isPriority)t.setPriority(e.priority,f.a.ChangeType.Local);else{var o=k.default.pluginManager.getPluginGCalendar(),s=!0;if(t.hasAttachmentType(f.a.PluginType.Calendar)){var l=t.getAttachmentByType(f.a.PluginType.Calendar);l&&l.getField("recurringEventId")&&t.getCalendarParsedText()===l.getField("summary")?(k.default.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"}),s=!1):o.isEnabled()?o.hasWritePermissionForAttach(l)||(k.default.toasts.pushMessage({text:"This event is on a read-only calendar",actionText:"OKAY"}),s=!1):(k.default.toasts.pushMessage({text:"Cannot modify this event if the calendar plugin is disabled. Please enable the Google Calendar plugin.",action:f.a.MessageAction.OpenSettings}),s=!1)}if(s)if(t.setDate(e.date,e.duration||f.a.DefaultEventDuration,f.a.ChangeType.Local),p.default.isDateValid(i.date)&&o&&a!==this&&!t.hasAttachmentType(f.a.PluginType.Calendar))if(o.getDefaultExportCalendarID()){var u=k.default.pluginManager,c=f.a.PluginSettingsID.GCalendar.SyncDraggedEvents,d=function(){u.getSetting(f.a.PluginID.GCalendar,c)&&o.createEventForItem(t)};k.default.settings.shouldShowHelp("syncNewEvents")?k.default.menus.confirm("Add events to Google Calendar when dropping onto the Calendar pane?",(function(e){k.default.settings.closeHelp("syncNewEvents"),u.setSetting(f.a.PluginID.GCalendar,c,e),d()})):d()}}if(a.isEditable){var h=a.indexOfItem(t,e);h>=0&&y.a.selectIndex(h,t.getParsedText().length)}}},{key:"setIgnoreRestoreScroll",value:function(e,t){var a=this;this._ignoreRestoreScroll=!0,this._ignoreRestoreScrollTimeout&&clearTimeout(this._ignoreRestoreScrollTimeout),this._ignoreRestoreScrollTimeout=setTimeout((function(){a._ignoreRestoreScroll=!1,t&&t()}),e||100)}},{key:"isIgnoringRestoreScroll",value:function(){return this._ignoreRestoreScroll}},{key:"zoomInOnSwipe",value:function(e){var t=this,a=this.item.get();this.zoomIn(e),k.default.toasts.pushMessage({text:"<b>Zoomed in to: </b>"+e.getParsedText(),action:function(){t.zoomIn(a)},hold:!1,actionText:"UNDO"})}},{key:"collapseOnSwipe",value:function(e){this.supportCollapsing&&e.isCollapsible()&&e.toggleCollapsed(this)}},{key:"deleteOnSwipe",value:function(e){var t;(e.deleteSelf(f.a.ChangeType.Local),e.hasAttachmentType(f.a.PluginType.Email))?t=e.getAttachmentByType(f.a.PluginType.Email).getField("subject"):t=e.getParsedTextWithoutPrefix();k.default.toasts.pushMessage({text:"<b>Deleted:</b>"+t,action:function(){b.a.undo()},hold:!1,actionText:"UNDO"})}},{key:"completeOnSwipe",value:function(e){this.supportCompleting&&(p.default.beginCompleteAction(),e.setComplete(!e.isComplete(),f.a.ChangeType.Local),p.default.endCompleteAction())}},{key:"getSwipeMenuItems",value:function(e){var t=e.item;return{left:[{icon:"check",text:t.isComplete()?"Uncomplete":"Complete",backgroundColor:"#0c0",onActivated:this.completeOnSwipe.bind(this,t)}],right:[{icon:t.isCollapsed(this)?"angle-right":"angle-down",backgroundColor:"#777",onActivated:this.collapseOnSwipe.bind(this,t)},{icon:"zoom-in",backgroundColor:"#09d",onActivated:this.zoomInOnSwipe.bind(this,t)},{icon:"delete",backgroundColor:"#a30",onActivated:this.deleteOnSwipe.bind(this,t)}]}}},{key:"_openSelectedInMode",value:function(e){var t=y.a.getStartItem();t&&this.openEmailByItem(t,e)}},{key:"replySelected",value:function(){this._openSelectedInMode(f.a.EmailResponseMode.Reply)}},{key:"replyAllSelected",value:function(){this._openSelectedInMode(f.a.EmailResponseMode.ReplyAll)}},{key:"forwardSelected",value:function(){this._openSelectedInMode(f.a.EmailResponseMode.Forward)}},{key:"openEmailByItem",value:function(e,t){if(e){var a=e.getAttachmentByPlugin(f.a.PluginID.Gmail);(a&&a!==k.default.EmailPreview.getThreadAttach()||!k.default.EmailPreview.isOpenOnPane(this)||t)&&a.getPlugin().openEmailByItem(e,this,t)}}},{key:"markItemRead",value:function(e,t){var a=k.default.pluginManager.getPluginGmail(),n=t.getAttachmentByPlugin(a.id),r=e?f.a.PluginAction.Gmail.MarkRead:f.a.PluginAction.Gmail.MarkUnread;try{p.default.PAssert(1241,n,"Must be able to get a valid attachment")}catch(i){p.default.reportError(i)}(e&&a.isItemUnread(t)||!e&&!a.isItemUnread(t))&&a.performAction(r,!1,n)}},{key:"markReadSelected",value:function(e){var t=k.default.pluginManager.getPluginGmail();t.beginAction(),this.applyToSelection(this.markItemRead.bind(this,e)),t.endAction()}},{key:"toggleStarSelected",value:function(){var e,t=k.default.pluginManager.getPluginGmail();t.beginAction(),this.applyToSelection((function(a){var n=a.getAttachmentByPlugin(t.id);try{p.default.PAssert(1242,n,"Must be able to get a valid attachment")}catch(i){p.default.reportError(i)}var r=t.isItemStarred(a);void 0===e&&(e=r?f.a.PluginAction.Gmail.Unstar:f.a.PluginAction.Gmail.Star),(r&&e===f.a.PluginAction.Gmail.Unstar||!r&&e===f.a.PluginAction.Gmail.Star)&&t.performAction(e,!1,n)})),t.endAction()}},{key:"selectIndex",value:function(e,t){y.a.selectIndex(e,t||0)}},{key:"onAdded",value:function(){this.isEditable&&this.isWriteable&&setTimeout(this.selectFirstItem.bind(this),0)}},{key:"selectFirstItem",value:function(){this.isWriteable&&0===this.numItems()&&this.canAddItem&&this.addItem();var e=this.indexOfFirstItem();e>=0&&y.a.selectIndex(e,0)}},{key:"isOverviewVisibleInPane",value:function(e){var t=this.item.get();return e===t||e.isDescendantOf(t)}},{key:"getContentWidth",value:function(){return this.getWidth()}},{key:"getContentHeight",value:function(){return this.getHeight()}},{key:"getMinItemSize",value:function(){return Math.ceil(k.default.DisplaySettings.itemLineHeight()+2*k.default.DisplaySettings.itemPadding()+(k.default.DisplaySettings.noteLineHeight()+k.default.DisplaySettings.itemPadding()))/2}},{key:"onZoom",value:function(){}},{key:"widthOfDrag",value:function(e){}},{key:"getSubItems",value:function(e,t){var a=[],n={item:e,comparator:this.search.isMatched,pane:this,each:function(e){t&&e.isComplete()||a.push(e)}};return this.runItemSearch(n),a}},{key:"isItemInPane",value:function(e){return this.indexOfItem(e)>=0}},{key:"isItemTopLevel",value:function(e){return e.item.levelsDeep.get()-this.item.get().levelsDeep.get()===1}},{key:"getCollapsedDefault",value:function(e,t,a){return!1}},{key:"isViewProject",value:function(){return!1}},{key:"isViewDates",value:function(){return!1}},{key:"isViewAgenda",value:function(){return!1}},{key:"isViewCalendar",value:function(){return!1}},{key:"isViewOutline",value:function(){return!1}},{key:"isViewText",value:function(){return!0}},{key:"isViewFlatList",value:function(){return!1}},{key:"shouldShowAddBox",value:function(){return!1}},{key:"isViewAutoBlocks",value:function(){return!1}},{key:"isViewTag",value:function(){return!1}},{key:"canScrollToItem",value:function(){return!1}},{key:"getSortModeBlocks",value:function(){}},{key:"getSortModeItems",value:function(){}},{key:"isCalFilterActive",value:function(){return!1}},{key:"isViewItems",value:function(){return!1}},{key:"isViewArchived",value:function(){return!1}},{key:"isViewDeleted",value:function(){return!1}},{key:"viewModeIcon",value:function(){return""}},{key:"viewModeColor",value:function(){return""}},{key:"createVMLI",value:function(e,t){t.documentOwner=this.getDocument();var a=W.a.createVMLI(e,t);return this.search.stickMatch(a),a}},{key:"createTempVMLI",value:function(e,t){t.documentOwner=this.getDocument();var a=W.a.createVMLI(e,t);return this.search.stickMatch(a),a}},{key:"selectNearestItem",value:function(e){k.default.PaneUpdateBatcher.flushItemsUpdate(this);var t=this.findNextSiblingItem(e);t&&y.a.selectObject(t,0)}},{key:"supportsSortBlocks",value:function(){return!1}},{key:"supportsSortBlocksMode",value:function(e,t){return!1}},{key:"supportsSortItems",value:function(){return!1}},{key:"getViewMode",value:function(){return""}},{key:"scrollToTop",value:function(e){this.initialScrollIndex=0,this.listManager.scrollToOffset(0,e)}},{key:"setName",value:function(e){this.name.set(e),k.default.PaneManager.savePaneState()}},{key:"setWidthManual",value:function(e,t){isNaN(e)?this.widthManual=this.widthManualExpanded=e:t?(e=p.default.clamp(e,f.a.EmailPreviewSizeMin,f.a.EmailPreviewSizeMax),this.widthManualExpanded=e):(e=p.default.clamp(e,this.minWidth,this.maxWidth),this.widthManual=e),this.saveState(),k.default.PaneManager.updatePaneRects(!isNaN(e))}},{key:"isPaneObjectCollapsed",value:function(e){return(p.default.isVMLI(e)?e:e.item).isCollapsed(this,e.overview)}},{key:"setPaneObjectCollapsed",value:function(e,t,a){return(p.default.isVMLI(t)?t:t.item).setCollapsed(e,this,t.overview,a)}},{key:"setItemCollapsed",value:function(e,t,a,n){return t.setCollapsed(e,this,a,n)}},{key:"setItemUnCollapsedToRoot",value:function(e,t,a,n){var r=this;e.setCollapsed(!1,this,a,n),e.parents(t).forEach((function(e){return e.setCollapsed(!1,r,a,n)}))}},{key:"shouldRenderPrefix",value:function(e){return!0}},{key:"needsUpdateForDate",value:function(){return!1}},{key:"needsUpdateForTags",value:function(e){return!1}},{key:"needsUpdateForPriority",value:function(){return!1}},{key:"needsUpdateForModified",value:function(){return!1}},{key:"needsSearchUpdateForPriority",value:function(){return this.search.getFilterValue("filter")}},{key:"handleItemChanged",value:function(e,t,a){var n=this.listManager;if(a=a||!1,t.Complete&&(a=!0),(t.Items||t.Indent)&&(k.default.DisplaySettings.boldHeaders()&&n.clearItemInfoForItem(e),a=!0),t.Text&&(n.handleItemTextChanged(e)&&(this.itemsHeightDirty=!0),this.supportSearchListenTextChanges)){var r=this.search.handleItemTextChanged(e);a=a||r}if(t.Header&&this.isViewProject()&&(a=!0),t.Search||t.Date&&this.search.isSearchingDate()){var i=this.search.handleItemChanged(e);a=a||i}if(t.Priority){var o=this.search.handleItemChanged(e);o||(o=this.needsUpdateForPriority()),a=a||o}if(t.Modified&&(a=a||this.needsUpdateForModified()),(t.Date||t.RepeatDateCompleted)&&(a=a||this.needsUpdateForDate()),t.Tags&&(a=a||this.needsUpdateForTags(t.Tags)),this.onItemPreloadUpdated.notify(e),a)return(t.RepeatDateCompleted||t.Complete||!this.preventUpdateItemsForItem||this.preventUpdateItemsForItem.item!==e)&&this.setItemsDirty(),!0}},{key:"addPaneObject",value:function(e,t){var a=t.item;e.push(t),a&&(this.paneObjects[t.id]=t,this.paneObjectsByItem[a.id]?this.paneObjectsByItem[a.id].push(t):this.paneObjectsByItem[a.id]=[t])}},{key:"getPaneObjectsForItem",value:function(e){return this.paneObjectsByItem[e.id]}},{key:"_zoom",value:function(e,t,a,n){try{p.default.PAssert(1243,e,"Must supply a valid item to zoom to")}catch(i){p.default.reportError(i)}if(e){t||(this.scrollToTop("auto"),this.initialScrollIndex=0);var r=this.item.get();if(r&&r.id===e.id)return;y.a.reset(),this.setItem(e,!0,a,n),p.default.focusedItem=e,t||this.saveState()}}},{key:"zoomIn",value:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{p.default.PAssert(1244,e,"Must supply a valid item to zoom to")}catch(l){p.default.reportError(l)}if(e){var n=a.forLoad,r=a.showToast,i=(a.noSel,a.noUpdateItems),o=a.fromUndo,s=this.item.get();this._zoom(e,n,i,o),e.isDemandLoad()&&e.notifyDemandLoadUpdate(!0,this),n||p.default.sendEvent("Menu","ZoomIn"),this.isLoaded&&this.onZoom(),n||k.default.onIntroAction("Zoom"),r&&k.default.toasts.pushMessage({text:"Zoomed into "+e.getParsedTextWithoutPrefix(),actionText:"UNDO",hold:!1,action:function(){t.zoomIn(s)}})}}},{key:"zoomOut",value:function(e,t){try{p.default.PAssert(1245,e,"Must supply a valid item to zoom to")}catch(a){p.default.reportError(a)}y.a.save()||y.a.getPreviousSelection();this._zoom(e,!1),p.default.sendEvent("Menu","ZoomOut")}},{key:"getDocument",value:function(){return this.document.get()}},{key:"setDocument",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.forLoad,n=t.noUpdateItems,r=t.zoomItem,i=e!==this.document.get();i&&(this.setIgnoreRestoreScroll(1e3),this.zoomIn(null!==r&&void 0!==r?r:null===e||void 0===e?void 0:e.getRootItem(),{forLoad:a,noUpdateItems:n}))}},{key:"openItemEditor",value:function(e){e.pane=this,k.default.menus.openItemEditor(e)}},{key:"clearPreventUpdate",value:function(e){}},{key:"getVisibleChildren",value:function(e){for(var t=0,a=e.item,n=this.getItems(),r=[],i=e.index;i<n.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=n[i],s=o.item;s&&s.isDescendantOf(a)&&r.push(o)}return r}},{key:"isItemBold",value:function(e){return e.isPrefixHeader()||e.isHeader()&&k.default.DisplaySettings.boldHeaders()}},{key:"onRemoteUpdate",value:function(e){if(this.usesVMLIs&&e.item!==this.getItem().id){var t=W.a.getItem(e.item);t&&this.zoomIn(t)}void 0!==e.documentSortMode&&this.documentSortMode.set(e.documentSortMode),this.name.set(e.name),this.widthManual=e.widthManual,this.widthManualExpanded=e.widthManualExpanded,v.a.supportsMultiplePanes.get()&&this.overview.setVisibility(e.isOverviewVisible),void 0!==e.search&&this.search.onRemoteUpdate(e.search)}},{key:"goBack",value:function(){var e=this.history.get(),t=e[e.length-1];if(t){if(t.item&&t.item!==this.getItem().id){var a=W.a.getItem(t.item);a&&this.zoomIn(a,{fromUndo:!0})}var n;if(void 0!==t.search)this.search.onRemoteUpdate(t.search,!0),null===(n=this.onViewStateChanged)||void 0===n||n.call(this);this.history.splice(e.length-1,1)}}},{key:"_setRect",value:function(e){this._cachedWidth=e.width,this._cachedMaxWidths={},this.rect.set(e)}},{key:"canCollapse",value:function(){return this.supportCollapsing}},{key:"getDeferredItem",value:function(e){}},{key:"pushHistory",value:function(e){var t=this.history.get();t.length>10&&t.splice(0,1),t.push(e),this.history.set(t)}},{key:"itemLevelsDeep",value:function(e,t){return e.levelsDeep.get()-(t?t.levelsDeep.get():this.item.get().levelsDeep.get()+1)}},{key:"canZoomToItem",value:function(e){return e.canZoom()}},{key:"createVMLIsToDrop",value:function(e,t){return e.items.map((function(e){return e.item}))}},{key:"onDoubleClick",value:function(e,t){}},{key:"searchPaneObjects",value:function(e){var t=this,a=e.toLowerCase().split(" ");return this.items.get().filter((function(e){return a.every((function(a){var n;return null===(n=e.item)||void 0===n?void 0:n.getSearchText(t).includes(a)}))}))}},{key:"isPopupOpen",value:function(){return this.searchingPaneObjects.get().isSearching||this.isSearchingGlobal.get()}},{key:"getMobileIcon",value:function(){}}],[{key:"getPluginID",value:function(){}}]),e}(),d()(V.prototype,"saveState",[h.a],Object.getOwnPropertyDescriptor(V.prototype,"saveState"),V.prototype),d()(V.prototype,"onTapOverviewButton",[h.a],Object.getOwnPropertyDescriptor(V.prototype,"onTapOverviewButton"),V.prototype),d()(V.prototype,"onClickReportError",[h.a],Object.getOwnPropertyDescriptor(V.prototype,"onClickReportError"),V.prototype),d()(V.prototype,"archiveCompleted",[h.a],Object.getOwnPropertyDescriptor(V.prototype,"archiveCompleted"),V.prototype),d()(V.prototype,"onDocumentsChanged",[h.a],Object.getOwnPropertyDescriptor(V.prototype,"onDocumentsChanged"),V.prototype),V);w.a.extendClass(oe,function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:se,t=function(e){D()(a,e);var t=U(a);function a(){return s()(this,a),t.apply(this,arguments)}return u()(a,[{key:"constructorExtra",value:function(){w.a.binder(this,"compositionStart","compositionEnd","onInput","onInputSetText")}},{key:"compositionStart",value:function(){v.a.isAndroid||(y.a.isComposing=!0,this.compositionOffset=y.a.getStartOffset())}},{key:"compositionEnd",value:function(e){v.a.isAndroid||(y.a.isComposing=!1,this.onInput(e),this.compositionOffset=void 0)}},{key:"onBeforeInput",value:function(e){var t=x.default.getSelectionRangeNative(),a=x.default.getSelectOffsetsInElement(e.target,t);j.setOffsetsBeforeInput(a)}},{key:"onInput",value:function(e){if(y.a.isValid()){for(var t,a,n,r=0,i=y.a.getStartObject(),o=e.target.children,s=x.default.getSelectionRangeNative(),l=0;l<o.length;l++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=o[l],c=+u.getAttribute("data-index");if(c===i.index||"BR"===u.nodeName&&n+1===i.index)if(t){var d=x.default.getSelectOffsetsInElement(u,s);a={start:a.total+1,end:a.total+1,total:a.total+d.total+1},t.append("\n"),t.append(u)}else t=u,a=x.default.getSelectOffsetsInElement(t,s);n=c}if(t){var h=y.a.getStartItem(),p=this.convertElementToText(t).replace(f.a.TextSpaceRegexp,""),g=void 0!==this.compositionOffset?this.compositionOffset:y.a.getStartOffset(),m=y.a.getEndOffset(),k=h.isPrefixCodeBlock();v.a.isAndroid&&e.data&&a.start!==g+1&&(g=a.start-e.data.length,m=a.end);var _=i.getDisplayLengthWithoutPrefix(),b=!1;if(!k){var w=p.split(f.a.Chars.CarriageReturn);w.length>1&&(p=w[0],b=!0)}var S=j.onInput(i,p,a.start,g,m,e),D=S.newText,P=S.selOffset,I=a.end+P;this.onInputSetText(i,h,D,I,_,e),b&&M.a.handleEnter()}}}},{key:"onInputSetText",value:function(e,t,a,n,r,i){a=a.replace(f.a.TextSpaceRegexp,"");var o=T.a.checkMultiplePrefixes(a);o!==a&&(n-=a.length-o.length,a=o);var s=a.length===t.getRawText().length-1;this.isSettingTextFromInput=!0;var l=e.getDisplayLengthWithoutPrefix();t.setText(a,f.a.ChangeType.Local);var u=e.getDisplayLengthWithoutPrefix();"insertText"===i.inputType&&u<l&&(n=Math.max(0,n+u-l)),u!==r&&(n=t.elsNew.adjustOffsetAroundUneditables(e,n,u>r?-1:1)),"insertCompositionText"===i.inputType?L.a.savedRange=void 0:y.a.selectObject(e,n,n,{fromInput:!0}),this.isSettingTextFromInput=!1,s&&!A.a.isShowing()||M.a.updateAutocomplete()}},{key:"keydown",value:function(e){if(e.handled)return!0;if(e.normCode===f.a.KeyCode.Escape&&this.searchingPaneObjects.get().isSearching)return this.searchingPaneObjects.setProperty("isSearching",!1),!0;if(k.default.tooltip.hideTip(),this.isWriteable&&0===this.numItems()&&this.canAddItem&&!p.default.hasClass(this.paneContent,"loading")&&f.a.KeyCodesModifiers.indexOf(e.normCode)<0&&f.a.KeyCodesArrows.indexOf(e.normCode)<0&&this.addItem(),y.a.isValid())if(e.normCode===f.a.KeyCode.ContextMenu&&v.a.windows)k.default.menus.openItemContextMenu(y.a.getStartObject());else{0!==this.numItems()||p.default.hasClass(this.paneContent,"loading")||this.addItem();try{M.a.keydown(e)||p.default.preventAndStop(e)}catch(t){p.default.reportError(t,e)}}}},{key:"keypress",value:function(e){if(y.a.isValid())try{M.a.keypress(e)||(p.default.preventDefault(e),p.default.stopPropagation(e))}catch(t){p.default.reportError(t,e)}}},{key:"keyup",value:function(e){if(p.default.notifyActivity(),y.a.isValid())try{M.a.keyup(e)||(p.default.preventDefault(e),p.default.stopPropagation(e))}catch(t){p.default.reportError(t,e)}}},{key:"setRect",value:function(e){p.default.deepEqual(e,this.rect.get())||(g.a.disable(!0),this._setRect(e))}}]),a}(e);return t}(oe),!0);var se=t.a=oe},function(e,t,a){"use strict";a.d(t,"b",(function(){return m})),a.d(t,"a",(function(){return v}));var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(20),l=a.n(s),u=a(21),c=a.n(u),d=a(13),h=a.n(d),f=a(0),p=a(3);function g(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=h()(e);if(t){var r=h()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return c()(this,a)}}function m(e,t,a){var n=e.pane;Object(p.useEffect)((function(){var r=e.index,i=e.id,o=t.current;a&&(o=f.default.findChild(o,a));try{f.default.PAssert(1343,o,"Mounting element that does not eixt")}catch(s){f.default.reportError(s)}return o&&n.listManager.setElement(r,i,o),function(){return n.listManager.clearThisElement(r,i)}}),[e.index])}var v=function(e){l()(a,e);var t=g(a);function a(e){var n;return r()(this,a),(n=t.call(this,e)).elementsByID={},n.elementsByIndex={},n.scrollListeners=[],n}return o()(a,[{key:"getElementByID",value:function(e){return this.elementsByID[e]}},{key:"getElementByIndex",value:function(e){var t;return null===(t=this.elementsByIndex[e])||void 0===t?void 0:t.element}},{key:"setElement",value:function(e,t,a){this.elementsByID[t]=a,this.elementsByIndex[e]={paneObjectId:t,element:a}}},{key:"clearThisElement",value:function(e,t){var a;this.elementsByID[t]=void 0,(null===(a=this.elementsByIndex[e])||void 0===a?void 0:a.paneObjectId)===t&&(this.elementsByIndex[e]=void 0)}},{key:"setVirtualList",value:function(e){this._virtualList=e}},{key:"setScrollRange",value:function(e){var t=this;this.lastIndexScrolledTo=void 0,this.scrollRange=e,this.pane.saveState(!0),this.scrollListeners.forEach((function(a){return a(t.pane,e)}))}},{key:"getScrollOffset",value:function(){return this._virtualList.getScrollOffset()}},{key:"getScrollIndex",value:function(){var e,t,a;return null!==(e=null!==(t=this.lastIndexScrolledTo)&&void 0!==t?t:null===(a=this.scrollRange)||void 0===a?void 0:a.startIndex)&&void 0!==e?e:-1}},{key:"getScrollEndIndex",value:function(){var e,t;return null!==(e=null===(t=this.scrollRange)||void 0===t?void 0:t.endIndex)&&void 0!==e?e:-1}},{key:"scrollToOffset",value:function(e,t){this._virtualList.scrollTo(e,t)}},{key:"scrollToIndex",value:function(e,t,a,n){var r;if("start"===t&&(this.lastIndexScrolledTo=e),e!==(null===(r=this.scrollRange)||void 0===r?void 0:r.startIndex)&&t&&this._virtualList)return this._virtualList.scrollToIndex({index:e,align:t,behavior:a,offset:n}),!0}},{key:"addScrollListener",value:function(e){this.scrollListeners.push(e)}},{key:"removeScrollListener",value:function(e){this.scrollListeners.remove(e)}},{key:"indexOfTop",value:function(){var e;return(null===(e=this.scrollRange)||void 0===e?void 0:e.startIndex)||0}},{key:"offsetOfIndex",value:function(e){return this._virtualList.offsetByIndex(e)}}]),a}(function(){function e(t){var a=t.pane;r()(this,e),this.pane=a}return o()(e,[{key:"onListChanged",value:function(){}},{key:"isIndexInView",value:function(e){return!1}},{key:"clearItemInfoForItem",value:function(e){}},{key:"handleItemTextChanged",value:function(e){return!1}},{key:"clearCache",value:function(){}},{key:"saveScrollOfTop",value:function(){}}]),e}())},function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=function(){function e(t){r()(this,e),this._limit=t,this._offset=0,this._buffer=[]}return o()(e,[{key:"get",value:function(e){return this._buffer[e]}},{key:"push",value:function(e){this._buffer[this._offset]=e,this._offset=(this._limit+this._offset+1)%this._limit}},{key:"peek",value:function(){var e=(this._limit+this._offset-1)%this._limit;return this._buffer[e]}},{key:"pop",value:function(){var e=(this._limit+this._offset-1)%this._limit,t=this._buffer[e];return t&&(this._buffer[e]=void 0,this._offset=e),t}},{key:"hasData",value:function(){return!!this.peek()}},{key:"reset",value:function(){this._offset=0,this._buffer=[]}},{key:"buffer",value:function(){return this._buffer}},{key:"limit",value:function(e){this._limit=e}},{key:"ordered",value:function(){return this._buffer.slice(this._offset).concat(this._buffer.slice(0,this._offset))}},{key:"entries",value:function(){for(var e=0,t=this.ordered(),a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;console.log("---- Entry ["+a+"] ----"),console.log(t[a])}}}]),e}();t.a=s},function(e,t,a){"use strict";var n=a(16),r=a.n(n),i=a(7),o=a.n(i),s=a(8),l=a.n(s),u=a(2),c=a(0),d=a(78),h=function(){function e(t){o()(this,e),this.elements="string"===typeof t?[new d.a(t)]:t}return l()(e,[{key:"insert",value:function(e,t,a,n){for(var r,i=0,o=t,s=0,l=0;l<this.elements.length;++l){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var u=this.elements[l],c=n?u.getStyledText(n.item,{showMarkdown:n.showMarkdown()}):u.getText();if(s<e+t&&e<s+c.length){var h=0,f=Math.max(e-s,0),p=Math.min(o,c.length),g=f+o,m=c.length-g;if(f>0){var v=c.substr(0,f);this.elements.splice(l,0,new d.a(v,u.props)),h++}var y=c.substr(f,p);if((r=new d.a(y,u.props)).mergeProps(a),this.elements.splice(l+h,1,r),h++,m>0){var k=c.substr(g,m);this.elements.splice(l+h,0,new d.a(k,u.props));break}l+=h-1,o-=p}s+=c.length}return r}},{key:"insertEl",value:function(e,t,a){var n=this.split(t,a),i=r()(n,2),o=i[0],s=i[1];this.elements=o.elements.concat(e).concat(s?s.elements:[])}},{key:"getDisplayText",value:function(e,t){return this.elements.map((function(a){var n,r;return t.noPrefix&&a.props.prefixType||t.noDates&&a.props.date||t.noDataImages&&(null===(n=a.props.link)||void 0===n||null===(r=n.href)||void 0===r?void 0:r.startsWith("data:image"))?"":a.getStyledText(e,t)})).join("")}},{key:"getRawText",value:function(e){var t=!1,a=!1,n=!1,r=!1,i=!1,o="";return e?this.elements.map((function(t){return t.getRawText(e)})).join(""):(this.elements.forEach((function(e){var s=e.props,l=e.getRawText();!s.formatting&&l&&(!!s.bold!==t&&(o+=u.a.Markdown.bold),!!s.italic!==a&&(o+=u.a.Markdown.italic),!!s.underline!==n&&(o+=u.a.Markdown.underline),!!s.strike!==r&&(o+=u.a.Markdown.strike),!!s.code!==i&&(o+=u.a.Markdown.code),o+=l,t=!!s.bold,a=!!s.italic,n=!!s.underline,r=!!s.strike,i=!!s.code)})),t&&(o+=u.a.Markdown.bold),a&&(o+=u.a.Markdown.italic),n&&(o+=u.a.Markdown.underline),r&&(o+=u.a.Markdown.strike),i&&(o+=u.a.Markdown.code),o)}},{key:"getHTML",value:function(e,t,a){var n=this,r=this.elements.map((function(r,i){return r.props.prefixType&&!1===t?"":r.getHTML(e,i>0,i===n.elements.length-1,a)})).join("");return this.elements[0]&&"header"===this.elements[0].props.prefixType&&(r='<b style="font-size: 1.5em">'.concat(r,"</b>")),r}},{key:"getPlaintext",value:function(e,t,a){return this.elements.map((function(n){return n.props.prefixType&&!1===t?"":n.getPlaintext(e,a)})).join("")}},{key:"displayRangeHasFormat",value:function(e,t,a,n){for(var r=0,i=0,o=0;i<n&&o<this.elements.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=this.elements[o],l=s.getStyledText(t.item,{showMarkdown:t.showMarkdown()});if(i<n&&a<i+l.length)if(!s.props[e])return!1;i+=l.length}return!0}},{key:"_elementInfoAtOffset",value:function(e,t,a){for(var n=0,r=0,i=0;r<=t&&i<this.elements.length;++i){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=this.elements[i];if(!o.props.prefixType||"raw"===a){var s="raw"===a?o.getRawText(!0):o.getStyledText(e.item,{showMarkdown:e.showMarkdown()});if(r<=t&&(t<r+s.length||t===r+s.length&&i===this.elements.length-1))return{offset:r,text:s,length:s.length,el:o,index:i};r+=s.length}}try{c.default.PAssert(527,0===t,"Did not find element at offset ".concat(t))}catch(l){c.default.reportError(l)}return{}}},{key:"elementInfoAtOffset",value:function(e,t){return this._elementInfoAtOffset(e,t,"styled")}},{key:"elementAtOffset",value:function(e,t){var a;return null===(a=this._elementInfoAtOffset(e,t,"styled"))||void 0===a?void 0:a.el}},{key:"removeElement",value:function(e){return this.elements.remove(e),this}},{key:"removeElementAtOffset",value:function(e,t){var a=this.elementAtOffset(e,t);return this.elements.remove(a),this}},{key:"isElementAtOffsetEditable",value:function(e,t){var a=this.elementInfoAtOffset(e,t).el;return a&&a.isEditable()}},{key:"adjustOffsetAroundUneditables",value:function(e,t,a){var n=this.elementInfoAtOffset(e,t),r=n.el,i=n.offset,o=n.length;if(r&&!r.isEditable()){if(!a)return t-i<i+o-t?i:i+o;if(t!==i&&t!==i+o)return a>0?i+o:i}return t}},{key:"spliceText",value:function(e,t,a,n){var r,i=this.split(n,t);a>0?r=this.split(n,t+a)[1]:r=i[1];var o=r?r.getRawText(n.showMarkdown()):"";return(i[0]?i[0].getRawText(n.showMarkdown()):"")+e+o}},{key:"split",value:function(t,a){for(var n=0,i=0,o=0;i<=a&&o<this.elements.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=this.elements[o],l=s.getStyledText(t.item,{showMarkdown:t.showMarkdown()});if(i<=a&&a<i+l.length){var u=a-i,c=s.split(t,u),d=r()(c,2),h=d[0],f=d[1];return[new e(this.elements.slice(0,o).concat(h||[])),new e((f?[f]:[]).concat(this.elements.slice(o+1)))]}i+=l.length}return[this]}},{key:"combineWith",value:function(t,a){var n=t.elements;return a&&(n=n.filter(a)),new e(this.elements.concat(n)).getRawText()}},{key:"findElement",value:function(e,t){for(var a=0,n=0,r=0;r<this.elements.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=this.elements[r];if(!i.props.prefixType){var o=i.getStyledText(e.item,{showMarkdown:e.showMarkdown()});if(t(i))return{offset:n,text:o,length:o.length,el:i};n+=o.length}}}},{key:"numFormattingCharsBeforeOffset",value:function(e,t){for(var a=0,n=0,r=0,i=0;n<=t&&i<this.elements.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this.elements[i],s=o.getStyledText(e.item);o.props.formatting&&(r+=o.getText().length),n+=s.length}return r}},{key:"withoutPrefix",value:function(){return this.elements[0].props.prefixType?new e(this.elements.slice(1)):this}}]),e}();t.a=h},function(e,t,a){"use strict";var n=a(0),r=a(3),i=a.n(r),o=a(4),s=a(2),l=a(25),u={renderPlain:function(e){if(e.isLoaded()){var t=e.getField("subject");return t&&""!==t||(t="(no subject)"),t}var a=e.getInlineData();return(null===a||void 0===a?void 0:a.subject)||(null===a||void 0===a?void 0:a.text)||"Loading..."},renderPaneJSX:function(e){var t,a=e.item,r=e.pane,c=a.getAttachmentByPlugin(s.a.PluginID.Gmail),d=u.renderPlain(c),h=c.getPlugin(),f=h.getDisplayTags(c,r),p=h.getDisplayParticipants(c),g=c.getField("count"),m=c.hasField("snippet")&&c.getField("snippet"),v=n.default.classNames("paneGmailItemContent flex flex-col justify-center border-b c-border-light"),y=c.getField("date");return t=l.a.isToday(y)?o.default.International.getFormat(s.a.DFormat.ShortTime):y.getYear()!==(new Date).getYear()?o.default.International.getFormat(s.a.DFormat.MonthDayYearShort):o.default.International.getFormat(s.a.DFormat.MonthDay),i.a.createElement("div",{className:v},i.a.createElement("div",{className:"flex flex-row justify-between line1"},i.a.createElement("div",{className:"from"},p),i.a.createElement("div",{className:"emailDate c-foreground-faded"},y.toString(t))),i.a.createElement("div",{className:"flex flex-row justify-between line2"},i.a.createElement("div",{className:"subject c-foreground"},d),i.a.createElement("div",{className:"flex items-center"},c.getField("hasAttachments")&&i.a.createElement("div",{className:"attach icon-attach_file"}),g>1&&i.a.createElement("div",{className:"count"},g))),i.a.createElement("div",{className:"flex flex-row justify-between line3"},m&&i.a.createElement("div",{className:"snippet c-foreground-faded"},c.getField("snippet")),(null===f||void 0===f?void 0:f.length)>0&&i.a.createElement("div",{className:"tags"},f.map((function(e){return i.a.createElement("span",{key:e,className:"emailLabel c-tag"},e)})))))},renderStyled:function(e,t,a,n){var r="";if(e&&e.isLoaded()){var i=e.getField("count"),c=e.getPlugin(),d=u.renderPlain(e);n&&n.highlightSearch&&(d=o.default.ElementRenderer.replaceTextWithSearch(d,t)),d='<span class="subject c-foreground">'+d+"</span>";var h=c.getDisplayTags(e,t);r+='<span class="line1"><span class="from">'+c.getDisplayParticipants(e)+"</span>";var f,p=e.getField("date");if(f=l.a.isToday(p)?o.default.International.getFormat(s.a.DFormat.ShortTime):p.getYear()!==(new Date).getYear()?o.default.International.getFormat(s.a.DFormat.MonthDayYearShort):o.default.International.getFormat(s.a.DFormat.MonthDay),r+='<span class="emailDate c-foreground-faded">'+p.toString(f)+"</span></span>",r+='<span class="line2">'+d,(e.getField("hasAttachments")||i>1)&&(r+='<span class="line2Right">',e.getField("hasAttachments")&&(r+='<span class="attach icon-attach_file"></span>'),i>1&&(r+='<span class="count">'+i+"</span>"),r+="</span>"),r+="</span>",e.hasField("snippet")||h.length){if(r+='<span class="line3">',e.hasField("snippet")&&(r+='<span class="snippet c-foreground-faded">'+e.getField("snippet")+"</span>"),h.length){var g=0;r+='<span class="tags">';for(var m=0;m<h.length;++m){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;r+='<span class="emailLabel c-tag">'+h[m]+"</span>"}r+="</span>"}r+="</span>"}}else{var v;r=(null===(v=e.getInlineData())||void 0===v?void 0:v.subject)||"Loading..."}return r}};t.a=u},function(e,t,a){"use strict";var n=a(5),r=a.n(n),i=a(12),o=a.n(i),s=a(7),l=a.n(s),u=a(8),c=a.n(u),d=a(35),h=a(2),f=a(0),p=a(4),g=a(18),m=a(37),v=function(){function e(){l()(this,e)}return c()(e,[{key:"_addItemToArray",value:function(e,t,a){var n=t.getFullSaveData();if(!a&&n.note&&delete n.note,e.push(n),t.hasChildren())for(var r=0,i=t.getItems(),o=0;o<i.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=i[o];this._addItemToArray(e,s,a)}a&&t.hasNote()&&e.push(t.getNote().getFullSaveData())}},{key:"getBestEncryptionOut",value:function(){var e=p.default.settings.encryptionKeys.get();return e&&e[h.a.EncryptionKeys.UserPassword]?h.a.EncryptionKeys.UserPassword:h.a.EncryptionKeys.Global}},{key:"getItemsData",value:function(){var e=o()(r.a.mark((function e(t,a){var n,i,o,s;return r.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(n=a.includeNotes,i=a.encrypt,o=a.encryptionKey,s=[],this._addItemToArray(s,t,n),!i){e.next=8;break}try{f.default.PAssert(353,o,"getItemsData missing encryptionKey")}catch(l){f.default.reportError(l)}return e.abrupt("return",Promise.all(s.map((function(e){return m.a.encryptItemOut(e,p.default.crypto,o)}))));case 8:return e.abrupt("return",Promise.resolve(s.map((function(e){return m.a.itemOut(e)}))));case 9:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"toDropHtml",value:function(e){var t="";if(!e.isArchived()&&(t+="<li>"+f.default.escape(e.getParsedText())+"</li>",e.hasChildren())){var a=0;t+="<ul>";for(var n=0;n<e.numChildren();++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t+=this.toDropHtml(e.getChild(n))}t+="</ul>"}return t}},{key:"generateOPML",value:function(e,t){var a,n=this,r=0,i='<?xml version="1.0"?><opml version="2.0"><head><ownerEmail>'.concat(d.a.getAccountEmail(),"</ownerEmail></head><body>"),o=0,s=function(){i+="</outline>",o--};for(e.forEach((function(e,r){if(!e.isNote()){if(a)for(var l=0,u=e.levelsDeep.get()-a.levelsDeep.get(),c=Math.min(o,-u),d=0;d<c;d++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;s()}var h=n.printLI(e,{opml:!0},void 0,void 0,void 0,void 0,!1,t);i+=h.opml,e.hasChildren()&&o++,a=e}}));o>0;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;s()}return i+="</body></opml>"}},{key:"generateExport",value:function(e,t,a,n,r,i,o){var s,l,u,c=this,d=0,h=1,f=t.html,p=t.moodo,g=t.plain;f&&(s="<ul>"),p&&(l="<ul>"),g&&(u="");var m=function(){f&&(s+="</li>"),p&&(l+="</li>")},v=function(){f&&(s+="<ul>"),p&&(l+="<ul>"),h++},y=function(){f&&(s+="</ul>"),p&&(l+="</ul>"),h--};for(e.forEach((function(d,k){var _,b;(e.length>1||void 0!==a&&a!==n)&&(r===i&&a===n||(_=0===k?a:0,b=i.item===d&&(d.hasNote()&&k===e.length-2||!d.isNote()&&k===e.length-1)?n:void 0));var w=e.length>1||a===d.getPrefixLength()&&n===r.getDisplayLength(),S=c.printLI(d,t,_,r,b,i,w,o);g&&(u+=(u?"\r\n":"")+"\t".repeat(Math.max(0,h-1))+S.plain),f&&(s+=S.html),p&&(l+=S.moodo);var D=e[k+1];if(D){var P=D.levelsDeep.get()-d.levelsDeep.get();if(D&&(D.parent()===d&&P>0||D.isNote()))v();else{var I=Math.min(h,-P);if(0===I&&h>0)m();else{var E=0;m();for(var C=0;C<I;C++){if(E++>5e3&&__infLoop&&__infLoop(E))throw new RangeError;y(),m()}h<=0&&v()}}}}));h>0;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;m(),y()}return{html:s,moodo:l,plain:u}}},{key:"printLI",value:function(e,t,a,n,r,i,o,s){var l,u,c=t.html,d=t.moodo,f=t.plain,p=t.opml,g=e.elsNew,m=s||o?e.getPrefixForExport():"",v=s||o&&!e.isPrefixCodeBlock()?e.getPrefixForExport():"",y=[],k=e.getPriority();void 0!==r&&(g=g.split(i,r)[0]),void 0!==a&&0!==a&&(g=g.split(n,a)[1]);var _,b=(g=g.withoutPrefix()).getRawText();if(e.isNote()&&y.push("note"),k&&(k===h.a.VMLIFlag.P0?y.push("high"):k===h.a.VMLIFlag.P1?y.push("medium"):k===h.a.VMLIFlag.P2&&y.push("low")),e.isComplete()&&y.push("complete"),e.isStarred()&&y.push("starred"),b.includes(h.a.CharDate)){var w=e.getMooDate();w&&(_=w.toData())}return(null===(l=e.getItemsLinkedTo())||void 0===l?void 0:l.length)>0&&(u=e.id),{html:c?this.generateHTML(v+g.getHTML(e,s),y,_,u):"",plain:f?v+g.getPlaintext(e,s):"",moodo:d?this.generateHTML(m+b,y,_,u):"",opml:p&&!e.isNote()?this.generateOPMLItem(e,m+g.getHTML(e,s,!0),y,_,u):""}}},{key:"generateHTML",value:function(e,t,a,n){return"<li"+(t.length>0?' class="'+t.join(" ")+'"':"")+(a?' data-date="'.concat(a,'"'):"")+(n?' id="'.concat(n,'"'):"")+">"+e}},{key:"generateOPMLItem",value:function(e,t,a,n,r){return"<outline"+(r?' id="'.concat(r,'"'):"")+(e.hasNote()?' _note="'.concat(f.default.escape(e.getNote().getRawText()),'"'):"")+(a.length>0?" "+a.map((function(e){return"".concat(e,'="true"')})).join(" "):"")+(n?' date="'.concat(n,'"'):"")+' text="'.concat(f.default.escape(t),'"')+(e.hasChildren()?">":" />")}},{key:"rewriteItemIDs",value:function(e,t){for(var a=0,n={},r=0;r<e.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=e[r],o=i.id;o&&(i.id=g.a.generateID(),n[o]=i.id)}Object.keys(n).length>0&&function(){for(var a=0,r=function(e,a){var r=f.default.isVMLI(e)?e.getRawText():e.text,i=r.replace(h.a.Regexp.InterlinkWithText,(function(e,a){var r=(t||!g.a.getItem(a)||g.a.getItem(a).isDeleted())&&n[a];return r?"[[".concat(r,"]]"):e}));i!==r&&(f.default.isVMLI(e)?e.setText(i,a):e.text=i)},i=0;i<e.length;++i){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=e[i];if(r(o,h.a.ChangeType.Remote),f.default.isVMLI(o)){var s=o.getItemsLinkedTo();s&&s.forEach((function(t){e.includes(t)||r(t,h.a.ChangeType.Local)}))}}}()}}]),e}();t.a=new v},function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(2),l=a(18),u=function(){function e(){r()(this,e),this._itemsWithoutParent=[]}return o()(e,[{key:"onRemoteChange",value:function(e,t,a,n,r){var i=l.a.getItem(a),o=s.a.ChangeType.Remote;n.parent||t&&(n.parent=t.parent);var u=l.a.getItem(n.parent);if(u)if(i){if(32===(32&n.flags))!!(i.isDeleted()||n.isDeleted?void 0:i)!==u.hasNote()&&u.setNote(i.isDeleted()||n.isDeleted?void 0:i,o);i.onChangeRemote(n,o)}else if(!t||!t.isDeleted){var c=Object.assign({},t,n);(i=l.a.createVMLI(c,{parent:u,changeType:o,documentOwner:e})).onChangeRemoteParentOrIndex({id:c.id,parent:c.parent,index:c.index,flags:c.flags})}r||(u||this._itemsWithoutParent.push({doc:e,localValue:t,itemId:a,value:n}),this.tryMissingItems())}},{key:"tryMissingItems",value:function(){for(var e=0,t=0;t<this._itemsWithoutParent.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(l.a.getItem(this._itemsWithoutParent[t].value.parent)){var a=this._itemsWithoutParent[t],n=a.doc,r=a.localValue,i=a.itemId,o=a.value;this.onRemoteChange(n,r,i,o,!0),this._itemsWithoutParent.splice(t,1),t--}}}}]),e}();t.a=new u},function(e,t,a){"use strict";var n=a(38),r=a.n(n),i=a(5),o=a.n(i),s=a(12),l=a.n(s),u=a(7),c=a.n(u),d=a(8),h=a.n(d),f=a(2),p=a(0),g=a(4),m=a(18),v=a(101),y=a(37),k=a(78),_=a(110),b={"#text":!0,SPAN:!0},w={DIV:!0,LI:!0,IMG:!0,UL:!0,OL:!0,P:!0},S={UL:!0,OL:!0},D=function(){function e(){c()(this,e)}return h()(e,[{key:"_setSectionValue",value:function(e,t,a){e.hasOwnProperty(t)||(e[t]=a)}},{key:"_parseSection",value:function(e,t){for(var a=0,n={},r=t;r<e.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=e[r];if(i){var o=i.indexOf(":"),s=[i.substr(0,o),i.substr(o+1)],l=s[0].split(";");switch(l[0]){case"BEGIN":var u=this._parseSection(e,r+1);r+=u.size,n[s[1]]=u.section;break;case"END":return{section:n,size:r-t+1};default:if(l.length>1){for(var c=0,d={value:s[1]},h=1;h<l.length;++h){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var f=l[h].split("=");try{p.default.PAssert(337,!d.hasOwnProperty(f[0]),"Should never overwrite line values")}catch(g){p.default.reportError(g)}d[f[0]]=f[1]}this._setSectionValue(n,l[0],d)}else this._setSectionValue(n,l[0],s[1]);break;case void 0:case null:try{p.default.PAssert(338,!1,"Invalid ICS format: "+i)}catch(g){p.default.reportError(g)}}}}return n}},{key:"parseICS",value:function(e){for(var t=0,a=e.split("\n"),n=[],r=0;r<a.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=a[r];i.startsWith(" ")?n[n.length-1]+=i.trim():n.push(i.trim())}return this._parseSection(n,0)}},{key:"parseHead",value:function(e){for(var t=0,a={},n=0;n<e.childElementCount;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e.children[n],i=r.nodeName;if(r.firstChild){var o=r.firstChild.textContent;a[i]=o}}return a}},{key:"parseOPML",value:function(e){var t=p.default.loadXML(e);return this._parseOPMLData(t)}},{key:"_parseOPMLData",value:function(e){var t=this,a={items:[]};return function e(n,r,i){var o,s,l=!0;switch(n.nodeName){case"#document":case"body":case"opml":break;case"head":l=!1;var u=t.parseHead(n);a.text=null===u||void 0===u?void 0:u.title;break;case"outline":var c=n.attributes,d=c.text,h=d?d.value:"",f=c.complete||c._complete,g=!(!f||"true"!==f.value),m=c.note||c._note||c.Notes,v=t.convertHTMLFormatting(h);s={id:null===(o=c.id)||void 0===o?void 0:o.value,text:v,isComplete:g,items:[],index:""+i};try{t.parseClassName(Array.from(n.attributes).map((function(e){return e.localName})),s)}catch(_){}if(m){var y=p.default.unescape(m.value);s.items=[{text:y,isNote:!0}]}r.items.push(s);break;default:p.default.log("Unknown OPML Node: ",n)}if(l){var k=0;for(i=0;i<n.childElementCount;++i){if(k++>5e3&&__infLoop&&__infLoop(k))throw new RangeError;e(n.children[i],s||a,i)}}return s}(e,a,0),a}},{key:"parseJSON",value:function(){var e=l()(o.a.mark((function e(t,a){var n,r,i,s;return o.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(void 0===t.moodoVer||void 0===t.moodoRoot&&void 0===t.items){e.next=26;break}if(e.prev=1,!t.doc){e.next=19;break}if(r={},!t.sentinel){e.next=15;break}if(!(s=g.default.crypto.getKeyBySentinel(t.sentinel))){e.next=12;break}return e.next=9,Promise.all(t.items.map((function(e){return y.a.decryptItemIn(e,g.default.crypto,s)})));case 9:i=e.sent,e.next=13;break;case 12:return e.abrupt("return",null);case 13:e.next=16;break;case 15:i=t.items.map(y.a.itemIn);case 16:a&&(i.forEach((function(e){var t=r[e.id];t||(t=m.a.generateID(),r[e.id]=t),e.id=t})),i.forEach((function(e){if(e.text=e.text.replace(f.a.Regexp.Interlink,(function(e,t){var a=r[t];return a?"[[".concat(a,"]]"):e})),e.parent){e.parent=r[e.parent];try{p.default.PAssert(339,e.parent,"Imported item has no parent")}catch(t){p.default.reportError(t)}}}))),v.a.createItemHierarchy(i),n={rootData:i[0],root:i[0],text:t.doc.text,items:i};case 19:return a&&n&&(n.root.id=m.a.generateID()),e.abrupt("return",n);case 23:e.prev=23,e.t0=e.catch(1),p.default.reportError(e.t0);case 26:return e.abrupt("return",!1);case 27:case"end":return e.stop()}}}),e,null,[[1,23]])})));return function(t,a){return e.apply(this,arguments)}}()},{key:"_findLineParent",value:function(e,t,a){for(var n,r=0,i=Math.min(e.length-1,t-1);i>=0;--i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=e[i];if(o&&o.indentLevel===a-1){n=o;break}}return n}},{key:"convertCodeBlocks",value:function(e){var t=[];e.items.forEach((function(e,a){var n;if(null===(n=e.text)||void 0===n?void 0:n.startsWith("```")){var r=t[0];!r||r.end?t.splice(0,0,{start:a}):r.end=a}})),t.forEach((function(t){var a=t.start,n=t.end;if(void 0!==a&&n){var r=e.items[a].text.replace("```","").trim(),i=e.items.slice(a+1,n).map((function(e){return e.text})).join("\n");e.items[a].text=f.a.Prefix.CodeBlock+(r||"")+" "+i,e.items.splice(a+1,n-a)}}))}},{key:"parseText",value:function(e){for(var t=0,a={items:[]},n=[],r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._parseTextLine(e[r]);if(i){n.push(i);var o=this._findLineParent(n,r,i.indentLevel)||a;i.parent=o,o.items.push(i)}}return this.convertCodeBlocks(a),a}},{key:"_parseTextLine",value:function(e){if(e&&e.length>0)return{indentLevel:Math.floor(e.search(/\S|$/)/4),text:p.default.trimString(e),items:[]}}},{key:"parseClassName",value:function(e,t){if(e)return e.indexOf("high")>=0?t.priority=f.a.VMLIFlag.P0:e.indexOf("medium")>=0?t.priority=f.a.VMLIFlag.P1:e.indexOf("low")>=0&&(t.priority=f.a.VMLIFlag.P2),e.indexOf("complete")>=0&&(t.isComplete=!0),e.indexOf("starred")>=0&&(t.isStarred=!0),e.indexOf("note")>=0&&(t.isNote=!0),t}},{key:"parseForTab",value:function(e){return(null===e||void 0===e?void 0:e.indexOf("Apple-tab-span"))>=0}},{key:"traverseDOMNew",value:function(e){var t,a,n=this.parseDOM(e),r=this.parsedDOMToItemData(n).itemData;return r.text||1!==(null===(t=r.items)||void 0===t?void 0:t.length)||r.items[0].text||1!==(null===(a=r.items[0].items)||void 0===a?void 0:a.length)||(r=r.items[0]),r.text?{items:[r]}:r}},{key:"parseDOM",value:function(e){var t,a,n=this;if("META"!==e.nodeName){if("#text"===e.nodeName)return{nodeNames:[e.nodeName],text:e.textContent};if("LI"===e.nodeName&&e.classList.contains("note"))return{nodeNames:["#text"],text:e.innerHTML,className:"note"};if("BR"===e.nodeName||0===e.childNodes.length&&(null===(t=e.classList)||void 0===t?void 0:t.contains("c-mrkdwn__br")))return{nodeNames:["BR"],linebreak:!0};if(null===(a=e.childNodes)||void 0===a?void 0:a.length){for(var r=0,i=[],o=function(t){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var a=n.parseDOM(e.childNodes[t]);a&&(!(null===a||void 0===a?void 0:a.items)||a.text||n.isNodeList(a)?i.push(a):(a.items.forEach((function(e){return n.combineNodeAttrs(e,a)})),i.pushArray(a.items)))},s=0;s<e.childNodes.length;s++)o(s);if(i.length>0){var l;if(1!==(null===i||void 0===i?void 0:i.length)||S[e.nodeName]){l={nodeNames:[e.nodeName]};var u={},c=[],d=!0;i.forEach((function(e,t){if(!p.default.isWhiteSpace(e.text)||!n.isOnlyText(e)||!d&&!n.isNodeBlock(u)){if(d||e.linebreak)!e.items||e.text||e.linebreak||e.inlineElements||e.img||!n.isNodeBlock(e)||!n.isNodeBlock(l)?(u=e,c.push(e)):(c.pushArray(e.items),u=e.items[e.items.length-1]);else if(n.isNodeBlock(e)||!d&&(n.isNodeBlock(i[t-1])||u.linebreak))!e.items||u.items||e.text||e.img?(u=e,c.push(e)):p.default.isWhiteSpace(u.text)&&!u.inlineElements?(c.pushArray(e.items),u=e.items[e.items.length-1]):(u.items=e.items,n.combineNodeAttrs(u,e));else if(u.items)u.items.push(e);else{if(!u.inlineElements||u.className||!p.default.deepEqual(u.nodeNames,["SPAN"])){var a=p.default.clone(u);Object.keys(u).forEach((function(e){return delete u[e]})),u.nodeNames=["SPAN"],u.inlineElements=[a]}u.inlineElements.push(e)}d=!1}})),l.items=c}else l=i[0],this.combineNodeAttrs(l,{nodeNames:[e.nodeName]});var h=e.getAttribute("id");h&&(l.id=h);var f=e.getAttribute("data-date");return f&&(l.date=f),"A"===e.nodeName&&(l.href=e.getAttribute("href")),e.className&&(l.className=this.combineClassNames(l,e)),l}}else if("IMG"===e.nodeName){var g=e;return{nodeNames:["IMG"],img:g.src||g.srcset&&g.srcset[0]}}return"LI"===e.nodeName||"DIV"===e.nodeName||"P"===e.nodeName?{nodeNames:[e.nodeName],text:e.textContent}:void 0}}},{key:"combineClassNames",value:function(e,t){return[e.className,t.className].filter((function(e){return e})).join(" ")}},{key:"parseNodeNamesToVMLIElementProps",value:function(e){var t={};return e.forEach((function(e){"B"===e?t.bold=!0:"I"===e?t.italic=!0:"U"===e&&(t.underline=!0)})),p.default.isEmpty(t)?void 0:t}},{key:"parsedDOMToItemData",value:function(e,t){var a=this,n=[],i={};e.date&&(i.date=e.date),e.id&&(i.id=e.id),t&&n.push(new k.a("1. "));var o=this.parseForTab(e.className)?1:0;if(o||(this.parseClassName(e.className,i),this.parseNodeToElements(n,e)),e.inlineElements){var s=[];e.inlineElements.forEach((function(e){a.parseForTab(e.className)?o++:a.parseInlineElement(s,e)})),n.pushArray(s)}var l=new _.a(n).getRawText();if((l||""===l&&!e.items)&&(i.text=l),e.items){i.items=[];var u=r()({},o,i);e.items.forEach((function(t,n){var r=a.parsedDOMToItemData(t,e.nodeNames.includes("OL")),s=r.itemData,l=r.indent;if(s.items||s.text&&!p.default.isWhiteSpace(s.text)||a.isNodeBlock(t)&&!t.linebreak){var c=l>o?a.getItemAtIndent(u,l-1,o):s.isNote?u[o]:i;c.items?s.isNote?c.items.splice(0,0,s):c.items.push(s):c.items=[s],u[l]=s}})),this.convertCodeBlocks(i)}return{itemData:i,indent:o}}},{key:"parseNodeToElements",value:function(e,t,a){var n,r;return t.img?(r=t.text||t.img,n={link:{isImage:!0,showImage:!0,href:t.img,text:r}}):t.href?(r=t.text||!t.inlineElements&&t.href||"",t.inlineElements&&(r+=this.inlineElementsToText(t),t.inlineElements=void 0),n={link:{href:t.href,text:r}}):(r=t.text,n=this.parseNodeNamesToVMLIElementProps(t.nodeNames),a&&(n=Object.assign(n||{},a))),r&&e.push(new k.a(r,n)),n}},{key:"inlineElementsToText",value:function(e){var t=this;return e.inlineElements.map((function(e){return e.text||t.inlineElementsToText(e)})).join("")}},{key:"parseInlineElement",value:function(e,t,a){var n=this,r=this.parseNodeToElements(e,t,a);t.inlineElements&&t.inlineElements.forEach((function(t){return n.parseInlineElement(e,t,r||a)}))}},{key:"getItemAtIndent",value:function(e,t,a){for(var n=0;t>=0;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var r=e[t];if(r)return r;t--}return e[a]}},{key:"isOnlyText",value:function(e){var t;return null===(t=e.nodeNames)||void 0===t?void 0:t.every((function(e){return"#text"===e}))}},{key:"isNodeText",value:function(e){var t;return null===(t=e.nodeNames)||void 0===t?void 0:t.some((function(e){return b[e]}))}},{key:"isNodeBlock",value:function(e){var t;return null===(t=e.nodeNames)||void 0===t?void 0:t.some((function(e){return w[e]}))}},{key:"isNodeList",value:function(e){var t;return null===(t=e.nodeNames)||void 0===t?void 0:t.some((function(e){return S[e]}))}},{key:"combineNodeAttrs",value:function(e,t){var a;(e.nodeNames=p.default.arrayUnion(e.nodeNames,t.nodeNames).filter((function(e){return"#text"!==e})),e.className=this.combineClassNames(e,t),e.nodeNames.includes("A"))&&(e.href=null!==(a=e.href)&&void 0!==a?a:t.href);return e}},{key:"convertHTMLFormatting",value:function(e){return e.includes("<")?e.replace(/<b>|<\/b>/g,"**").replace(/<i>|<\/i>/g,"*").replace(/<u>|<\/u>/g,"__"):e}}]),e}();t.a=new D},function(e,t,a){"use strict";var n,r=a(7),i=a.n(r),o=a(8),s=a.n(o),l=a(10),u=a.n(l),c=a(6),d=a(11),h=a(4),f=a(2),p=a(42),g=a(15),m=(n=function(){function e(){i()(this,e)}return s()(e,[{key:"init",value:function(){this.panesInView=new p.a,this.previewOpenOnPane=new g.a,h.default.PaneManager.displayPanes.listen(this.onPanesChange)}},{key:"onPanesChange",value:function(e){if(e.length>0)if(0===this.panesInView.length()){var t,a,n=h.default.settings.panesInViewMobile.get();if(n&&(a=n.filter((function(e){return h.default.PaneManager.hasPaneById(e)})).map((function(e){return{type:"pane",pane:h.default.PaneManager.getPaneById(e)}}))),(null===(t=a)||void 0===t?void 0:t.length)>0)c.a.setFocusedPane(a[0].pane),this.panesInView.set(a);else{var r=e.find((function(e){return"pane"===e.type&&e.pane.type===f.a.PaneMode.Task}));this.setPanesInView([r])}}else{var i=e.find((function(e){return"emailPreview"===e.type}));this.previewOpenOnPane.set(null===i||void 0===i?void 0:i.pane)}}},{key:"setPanesInView",value:function(e){this.panesInView.set(e),c.a.setFocusedPane(e[0].pane),h.default.settings.panesInViewMobile.set(e.map((function(e){return e.pane.id})))}}]),e}(),u()(n.prototype,"onPanesChange",[d.a],Object.getOwnPropertyDescriptor(n.prototype,"onPanesChange"),n.prototype),n);t.a=new m},function(e,t,a){"use strict";var n=a(181),r=window.ResizeObserver||n.a;t.a=r},function(e,t,a){"use strict";var n,r=a(7),i=a.n(r),o=a(8),s=a.n(o),l=a(10),u=a.n(l),c=a(11),d=a(0),h=a(18),f=a(102),p=(n=function(){function e(){i()(this,e)}return s()(e,[{key:"findMatchLike",value:function(e,t){var a=t.max,n=t.root,r=t.owner,i=t.allDocs,o=[],s=0,l=f.a.getSearchArr(e).searchArr,u=function(e){var t=[];return d.default.searchVMLIs({item:e.getRootItem(),comparator:function(e){return e!==r&&!e.isComplete()&&!e.isDisplayComplete()},each:function(e){var n=!1;if(l.length>0){var r=e.getSearchText();n=f.a.checkItemTextSearchArr(e,r,l)}else n=e.isPrefixHeader();var i=e.elsNew.elements[0].props.link;if((n=n&&(!i||!i.showImage))&&(t.push({id:e.id,type:"item",text:e.getParsedText(),item:e}),s++),s>=a)return!1}}),t},c=n.getDocumentOwner();if(i){var p=function(e){var t=u(e);t.length&&(o.push({id:e.id,type:"header",text:e.text.get()}),o.pushArray(t))};p(c),h.a.getDocumentsArray().forEach((function(e){return e!==c&&p(e)}))}else o=u(c);return o}},{key:"findMatchExact",value:function(e,t){}},{key:"getRNList",value:function(e,t){var a=t.max,n=t.root,r=[];return this.findMatchLike(e,{max:a,root:n}).forEach((function(e){r.push({type:"item",text:e.text,extraInfo:e.item})})),r}}]),e}(),u()(n.prototype,"getRNList",[c.a],Object.getOwnPropertyDescriptor(n.prototype,"getRNList"),n.prototype),n);t.a=new p},,function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));a(16);var n=a(0),r=function(e,t){return"string"===typeof e&&(e=e.split(",")),e[e.length-1]=""+(+e[e.length-1]+t),e.join(",")},i=function(e,t){"number"===typeof e&&(e=""+e),"number"===typeof t&&(t=""+t);var a="0";if("string"===typeof e&&"string"===typeof t)a=function(e,t){var a=e.split(","),n=t.split(","),i=a.length,o=n.length;return i<o?+a[i-1]+1<+n[i-1]?r(a,1):r(n,-1):i>o||+a[i-1]+1<+n[o-1]?r(a,1):(a.push("0"),a.join(","))}(e,t);else if("string"===typeof e){var i=+e.split(",")[0];try{n.default.PAssert(213,!isNaN(i),"Index is not valid string",e)}catch(s){n.default.reportError(s)}a=""+Math.floor(i+1)}else if("string"===typeof t){var o=+t.split(",")[0];try{n.default.PAssert(214,!isNaN(o),"Index is not valid string",t)}catch(s){n.default.reportError(s)}a=""+Math.ceil(o-1)}return a}},function(e,t,a){"use strict";var n=a(5),r=a.n(n),i=a(12),o=a.n(i),s=a(7),l=a.n(s),u=a(8),c=a.n(u),d=a(2),h=a(0),f=a(4),p=a(40),g=a(96),m=function(){function e(){l()(this,e),this.FOLDER_MIMETYPE="application/vnd.google-apps.folder",this.promisesGetting={},this.folders={root:{type:"root",title:"_Moo.do Files (Do not delete)",id:void 0,prop:"MooDoDefaultRoot"},attach:{type:"attach",title:"Shared Attachments",id:void 0,prop:"MooDoDefaultAttach",parent:"root"},backup:{type:"backup",title:"Moo.do Backups",id:void 0,prop:"MooDoDefaultBackup",parent:"root"}}}return c()(e,[{key:"createFolderStructure",value:function(){var e=o()(r.a.mark((function e(t,a){var n,i,o;return r.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:n=a.type;try{h.default.PAssert(539,!h.default.isDemoMode(),"Should not be creating "+n+"folder in demo mode")}catch(s){h.default.reportError(s)}try{h.default.PAssert(540,void 0===a.id,"Must not already have a "+n+"folder")}catch(s){h.default.reportError(s)}if(!a.parent){e.next=7;break}if(this.folders[a.parent].id){e.next=7;break}return e.next=7,this.getFolder(t,this.folders[a.parent]);case 7:return i=p.a.fns("drive").files.insert.packedFn,o={resource:{mimeType:this.FOLDER_MIMETYPE,title:a.title,writersCanShare:!1,folderColorRgb:"#FF7537",properties:[{key:a.prop,value:"TRUE",visibility:"PRIVATE"}]}},a.parent&&(o.resource.parents=[{id:this.folders[a.parent].id}]),e.abrupt("return",new Promise((function(e){f.default.remoteAPI().runRemoteSingleRequest(t,i,o,(function(t){h.default.shouldLog(d.a.LogLevels.Folders)&&h.default.log("Successfully created "+n+" folder",t),e(t.id)}),(function(t){h.default.shouldLog(d.a.LogLevels.Folders)&&h.default.log("Error creating "+n+" folder",t),e(void 0)}),void 0,g.a.SingleFolder)})));case 11:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getSetting",value:function(e,t){return f.default.settings.driveFolders.getProperty(e+"-"+t)}},{key:"setSetting",value:function(e,t,a){t=e+"-"+t,f.default.settings.driveFolders.setProperty(t,a)}},{key:"getFolderByType",value:function(){var e=o()(r.a.mark((function e(t,a){return r.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.abrupt("return",this.getFolder(t,this.folders[a]));case 1:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getFolder",value:function(){var e=o()(r.a.mark((function e(t,a){var n,i,s,l=this;return r.a.wrap((function(e){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(e.prev=e.next){case 0:n="string"===typeof a?this.folders[a]:a;try{h.default.PAssert(541,n,"Trying to get invalid folder")}catch(c){h.default.reportError(c)}try{h.default.PAssert(542,!h.default.isDemoMode(),"Should not be creating file structure in demo mode")}catch(c){h.default.reportError(c)}if(n){e.next=5;break}return e.abrupt("return",void 0);case 5:if(!n.id){e.next=9;break}return e.abrupt("return",n.id);case 9:if(i=t+JSON.stringify(a),!this.promisesGetting[i]){e.next=17;break}return e.next=13,this.promisesGetting[i];case 13:return s=e.sent,e.abrupt("return",s);case 17:this.promisesGetting[i]=new Promise(function(){var e=o()(r.a.mark((function e(a){var s,u,p,g,m,v,y,k,_;return r.a.wrap((function(e){for(var b=0,w=0;;){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;switch(e.prev=e.next){case 0:if(!n.parent){e.next=3;break}return e.next=3,l.getFolderByType(t,n.parent);case 3:s=l.getSetting(t,n.type),u=function(e){delete l.promisesGetting[i],a(e)},p=function(){var e=o()(r.a.mark((function e(){var a;return r.a.wrap((function(e){for(var r=0,i=0,o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=3,l.createFolderStructure(t,n);case 3:(a=e.sent)?(n.id=a,l.setSetting(t,n.type,a),u(a)):u(void 0);case 5:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}(),s?(g=function(e){e?(n.id=s,u(s)):p()},m=function(e){l.setSetting(t,n.type,void 0),e&&e.error&&404===e.error.code?p():u(void 0)},f.default.remoteAPI().driveFilesGet(t,s,g,m)):(v="properties has {key='"+n.prop+"' and value='TRUE' and visibility='PRIVATE'} and 'me' in owners and trashed=false",y={getAllPages:!0},k=function(e){if(e.length>0){try{h.default.PAssert(543,1===e.length,"Must have a single root folder present")}catch(c){h.default.reportError(c)}h.default.shouldLog(d.a.LogLevels.Folders)&&h.default.log("Successfully found root folder",e),n.id=e[0].id,l.setSetting(t,n.type,n.id),u(n.id)}else p()},_=function(e){h.default.shouldLog(d.a.LogLevels.Folders)&&h.default.log("Error getting root folder",e),u(void 0)},f.default.remoteAPI().driveFilesList(t,v,k,_,y));case 7:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}());case 18:case"end":return e.stop()}}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"copyFileToFolder",value:function(e,t,a,n){f.default.remoteAPI().driveParentsInsert(e,t,a,(function(e){h.default.shouldLog(d.a.LogLevels.Folders)&&h.default.log("Error sharing file ",e),n(!0,e)}),(function(e){h.default.shouldLog(d.a.LogLevels.Folders)&&h.default.log("Successfully shared file ",e),n(!1,e)}))}},{key:"getRootFolder",value:function(e){return this.getFolderByType(e,d.a.DriveFolder.Root)}},{key:"getDocumentFolder",value:function(e,t){var a={type:t,title:t,id:void 0,parent:d.a.DriveFolder.Root,prop:t};return this.getFolder(e,a)}}]),e}();t.a=new m},,,function(e,t,a){"use strict";a.d(t,"a",(function(){return p})),a.d(t,"b",(function(){return g}));var n=a(20),r=a.n(n),i=a(21),o=a.n(i),s=a(13),l=a.n(s),u=a(7),c=a.n(u),d=a(8),h=a.n(d);function f(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=l()(e);if(t){var r=l()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return o()(this,a)}}var p=function(){function e(t){c()(this,e),this.isLocalOnly=t,this.documents={}}return h()(e,[{key:"renameDocument",value:function(e,t){}},{key:"deleteDocAPIItems",value:function(e,t){}}]),e}(),g=function(e){r()(a,e);var t=f(a);function a(){return c()(this,a),t.apply(this,arguments)}return a}(p)},function(e,t,a){"use strict";var n=a(5),r=a.n(n),i=a(12),o=a.n(i),s=a(7),l=a.n(s),u=a(8),c=a.n(u),d=a(0),h=a(2),f=a(120),p=a(34),g=function(){function e(t,a,n,r,i,o,s){l()(this,e),this.file=t,this.properties=r,this.contentType=t.type,this.accountID=a,this.folder=n,this.onComplete=o||d.default.emptyFn,this.onError=s||d.default.emptyFn,this.onProgress=i||d.default.emptyFn,this._callbacks=[],this.offset=0,this._isDone=!1,this._isRunning=!1,this._hasStarted=!1,this._isCanceled=!1,this._hasError=!1;this.url=this._buildURL(void 0,{uploadType:"resumable"}),this._percent=0}return c()(e,[{key:"upload",value:function(){var e=this;this._hasStarted=!0,d.default.isDemoMode()?setTimeout((function(){e.onComplete()}),2e3):p.a.getAccountAuthToken(this.accountID,[h.a.GScope.Drive],function(){var t=o()(r.a.mark((function t(a){var n,i,o,s,l,u;return r.a.wrap((function(t){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(t.prev=t.next){case 0:if(!a){t.next=26;break}if(n={Authorization:"Bearer "+a.access_token,"Content-Type":"application/json","X-Upload-Content-Length":e.file.size,"X-Upload-Content-Type":e.contentType},!e.folder.named){t.next=8;break}return t.next=5,f.a.getFolder(e.accountID,e.folder.named);case 5:t.t0=t.sent,t.next=9;break;case 8:t.t0=e.folder.id;case 9:i=t.t0,o={title:e.file.name,mimeType:e.contentType,parents:i?[{id:i}]:[]},e.properties&&(o.properties=Object.keys(e.properties).map((function(t){return{key:t,value:e.properties[t],visibility:"PRIVATE"}})));try{s=JSON.stringify(o)}catch(c){d.default.reportError(c)}if(!s){t.next=25;break}return t.prev=14,t.next=17,d.default.XHR({url:e.url,type:"POST",headers:n,data:s,autoRetry:!0});case 17:(l=t.sent).status<h.a.HTTPStatusCode.BadRequest?(u=l.getResponseHeader("Location"),e.url=u,e._runUpload()):e._onError(l),t.next=23;break;case 21:t.prev=21,t.t1=t.catch(14);case 23:t.next=26;break;case 25:e._onError();case 26:case"end":return t.stop()}}}),t,null,[[14,21]])})));return function(e){return t.apply(this,arguments)}}())}},{key:"_runUpload",value:function(){var e=this;try{d.default.PAssert(366,this.url,"Must have a valid remote URL to run upload")}catch(r){d.default.reportError(r)}this._isRunning=!0;var t=Math.min(this.offset+1048576,this.file.size),a=this.file.slice(this.offset,t),n={"Content-Type":this.contentType,"Content-Range":"bytes "+this.offset+"-"+(t-1)+"/"+this.file.size,"X-Upload-Content-Type":this.contentType};d.default.XHR({url:this.url,type:"PUT",headers:n,data:a,autoRetry:!0}).then((function(t){if(t.status===h.a.HTTPStatusCode.Success||t.status===h.a.HTTPStatusCode.Created)e.isCanceled()||e._onComplete(t);else if(t.status===h.a.HTTPStatusCode.PermRedirect){var a=e._extractRange(t.getResponseHeader("Range"));e.offset=a,e._onProgress(e.offset/e.file.size),e.isCanceled()||e._runUpload()}else e._onError(t)}))}},{key:"resume",value:function(){var e=this;try{d.default.PAssert(367,!this.isDone(),"Should not resume a completed upload")}catch(a){d.default.reportError(a)}try{d.default.PAssert(368,this._hasStarted,"Must have started an upload to resume it")}catch(a){d.default.reportError(a)}try{d.default.PAssert(369,this.url,"Must have a valid remote URL to resume upload")}catch(a){d.default.reportError(a)}if(this._hasError=!1,this._isCanceled=!1,this._isRunning)0;else if(this._isRunning=!0,this._hasStarted&&this.url){var t={"Content-Range":"bytes */"+this.file.size,"X-Upload-Content-Type":this.contentType};d.default.XHR({url:this.url,type:"PUT",headers:t,autoRetry:!0}).then((function(t){if(t.status===h.a.HTTPStatusCode.PermRedirect){var a=e._extractRange(t.getResponseHeader("Range"));e.offset=a,e._onProgress(e.offset/e.file.size),e._runUpload()}else e._onError(t)}))}else this.upload()}},{key:"cancel",value:function(){try{d.default.PAssert(370,!this._isDone,"Cannot cancel an upload that is already complete")}catch(e){d.default.reportError(e)}this._isCanceled=!0,this._isRunning=!1}},{key:"_onError",value:function(e){this._hasError=!0,this._isRunning=!1,this.onError()}},{key:"_onComplete",value:function(e){var t=0;try{d.default.PAssert(371,!this._isDone,"Should not call the complete CB twice")}catch(r){d.default.reportError(r)}try{d.default.PAssert(372,!this._isCanceled,"Should not be able to complete a canceled upload")}catch(r){d.default.reportError(r)}this._isDone=!0,this._isRunning=!1;var a={};if(e&&e.response)try{a=JSON.parse(e.response)}catch(i){d.default.reportError(i)}this._onProgress(1),this.onComplete(a);for(var n=0;n<this._callbacks.length;++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{this._callbacks[n](a)}catch(i){d.default.reportError(i)}}this._callbacks=[]}},{key:"_onProgress",value:function(e){try{d.default.PAssert(373,!this._hasError,"Should not make forward progress when an error has occurred")}catch(t){d.default.reportError(t)}this._percent=e,this.onProgress(e)}},{key:"_extractRange",value:function(e){return d.default.parseInt(e.match(/\d+/g).pop())+1}},{key:"_buildQueryString",value:function(e){return e=e||{},Object.keys(e).map((function(t){return encodeURIComponent(t)+"="+encodeURIComponent(e[t])})).join("&")}},{key:"_buildURL",value:function(e,t){var a="https://www.googleapis.com/upload/drive/v2/files/";e&&(a+=e);var n=this._buildQueryString(t);return n&&(a+="?"+n),a}},{key:"notifyOnComplete",value:function(e){try{d.default.PAssert(374,this._callbacks.indexOf(e)<0,"Should not include fn twice")}catch(t){d.default.reportError(t)}try{d.default.PAssert(375,!this.isDone(),"Should not notify on complete after done")}catch(t){d.default.reportError(t)}try{d.default.PAssert(376,!this.hasError(),"Should not notify on complete after error")}catch(t){d.default.reportError(t)}this._callbacks.push(e)}},{key:"isCanceled",value:function(){return this._isCanceled}},{key:"isDone",value:function(){return this._isDone}},{key:"isRunning",value:function(){return this._isRunning}},{key:"hasError",value:function(){return this._hasError}},{key:"getPercent",value:function(){return this._percent}}]),e}();t.a=g},function(e,t,a){"use strict";var n=a(51),r=a.n(n),i=a(52),o=a.n(i),s=a(7),l=a.n(s),u=a(8),c=a.n(u),d=a(20),h=a.n(d),f=a(21),p=a.n(f),g=a(13),m=a.n(g),v=a(0),y=a(3),k=a.n(y);function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=m()(e);if(t){var r=m()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return p()(this,a)}}var b=function(e){h()(a,e);var t=_(a);function a(){return l()(this,a),t.apply(this,arguments)}return c()(a,[{key:"getElement",value:function(){return this.refs.element}},{key:"onMouseDown",value:function(e){this.lastX=e.clientX,this.lastY=e.clientY,this.moveX=0,this.moveY=0,this.isDown=!0,this.startSrc=e.target,this.props.onMouseDown&&this.props.onMouseDown(e),this.props.globalEvents&&v.default.onMouseMoveUp(this.onMouseMove,this.onMouseUp)}},{key:"onMouseMove",value:function(e){if(this.isDown){this.moveX+=Math.abs(e.clientX-this.lastX),this.moveY+=Math.abs(e.clientY-this.lastY),this.lastX=e.clientX,this.lastY=e.clientY;var t={startSrc:this.startSrc,target:e.target,clientX:e.clientX,clientY:e.clientY,eventX:e.clientX,eventY:e.clientY,preventDefault:v.default.emptyFn,stopPropagation:v.default.emptyFn,stopImmediatePropagation:v.default.emptyFn};this.props.onMouseMove&&this.props.onMouseMove(t)}}},{key:"onClick",value:function(e){this.moveX<v.default.ClickThreshold&&this.moveY<v.default.ClickThreshold&&this.props.onClick&&this.props.onClick(e)}},{key:"onMouseUp",value:function(e){this.isDown=!1,this.props.onMouseUp&&this.props.onMouseUp(e)}},{key:"onTapStart",value:function(e){this.onMouseDown(e),e.stopPropagation()}},{key:"onTapClick",value:function(e){this.props.onClick&&(this.props.onClick(e),e.stopPropagation())}},{key:"onTapMove",value:function(e){this.props.onMouseMove&&this.props.onMouseMove(e),e.stopPropagation()}},{key:"onTapEnd",value:function(e){this.onMouseUp(e),e.stopPropagation()}},{key:"render",value:function(){var e=this.props,t=(e.onClick,e.globalEvents),a=o()(e,["onClick","globalEvents"]);return k.a.createElement("div",r()({},a,{onMouseDown:this.onMouseDown,onMouseMove:t?void 0:this.onMouseMove,onClick:this.onClick,onMouseUp:t?void 0:this.onMouseUp,ref:"element"}),this.props.children)}}]),a}(a(45).a);t.a=b},function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(178),r=a.n(n),i=a(3),o=a.n(i),s={fallbackFocus:document.body,clickOutsideDeactivates:!0};function l(e){var t=e.children;return o.a.createElement(r.a,{focusTrapOptions:s},t)}},function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(3);function r(e){var t=Object(n.useRef)();return t.current=e,t}},function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(3),r=a(32),i=[];function o(e){Object(n.useEffect)((function(){return i.push(e),function(){i.remove(e)}}),[])}r.a.onBackButton((function(){var e=i[i.length-1];null===e||void 0===e||e()}))},,function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return i})),a.d(t,"a",(function(){return n}));var n,r=["initialize","authGoogleAccount","closeKeyboard","openURL","refreshAuthGoogleAccount","setColorTheme","setNotifications","signInWithApple","signInWithGoogle","setUseBeta","setPref","checkForUpdates","restartApp","notifyLoaded","requestIAPSubscription","getIAPSubscriptions","endIAPConnection","openGmail","openEmail"],i=["onAppInfo","onAppearanceChange","onBackButton","onKeyboardChange","onShake","onThemeCb","onCodePushStatus","onAppStateChange","onIAPUpdated"];!function(e){e[e.UP_TO_DATE=0]="UP_TO_DATE",e[e.UPDATE_INSTALLED=1]="UPDATE_INSTALLED",e[e.UPDATE_IGNORED=2]="UPDATE_IGNORED",e[e.UNKNOWN_ERROR=3]="UNKNOWN_ERROR",e[e.SYNC_IN_PROGRESS=4]="SYNC_IN_PROGRESS",e[e.CHECKING_FOR_UPDATE=5]="CHECKING_FOR_UPDATE",e[e.AWAITING_USER_ACTION=6]="AWAITING_USER_ACTION",e[e.DOWNLOADING_PACKAGE=7]="DOWNLOADING_PACKAGE",e[e.INSTALLING_UPDATE=8]="INSTALLING_UPDATE"}(n||(n={}))},,,function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=function(){function e(t,a){r()(this,e),this.__isListener=!0,this.target=t,this.cb=a,this._disposed=!1}return o()(e,[{key:"dispose",value:function(){this._disposed=!0,this.target.unlistenListener(this)}},{key:"isDisposed",value:function(){return this._disposed}}]),e}();t.a=s},function(e,t,a){"use strict";var n=a(3),r=a.n(n),i=a(0),o=a(2),s=a(4),l={renderPlain:function(e){return e.hasField("title")?e.getField("title"):"Loading..."},renderPaneJSX:function(e){var t=e.item,a=e.pane,n=t.getAttachmentByPlugin(o.a.PluginID.Drive);if(!n)return r.a.createElement("div",null);var s,l=n.getPlugin();n.isLoaded()?(s=n.getField("title"),n.hasField("isDeleted")&&n.getField("isDeleted")&&(s+="  (Deleted)")):(n.hasField("title")&&(s=n.getField("title")+"  (Loading...)"),n.isLocalOnlyAttachment()&&(s="Failed upload"),s="Loading...");var u=t.elsNew.findElement(e,(function(e){return!!e.props.plugin})),c=i.default.classNames("paneDriveItem",null===u||void 0===u?void 0:u.el.props.plugin.displayElement.attrs.cls.join(" "),l.getCssClass(n,a));return r.a.createElement("div",{className:c},r.a.createElement("span",{className:"truncate ib"},s))},renderStyled:function(e,t,a,n){if(e.isLoaded()){var r=e.getField("title");return n&&n.highlightSearch&&(r=s.default.ElementRenderer.replaceTextWithSearch(r,t)),e.hasField("isDeleted")&&e.getField("isDeleted")?r+"  (Deleted)":r}return e.hasField("title")?e.getField("title")+"  (Loading...)":e.isLocalOnlyAttachment()?"Failed upload":"Loading..."}};t.a=l},function(e,t,a){"use strict";a.d(t,"a",(function(){return i}));var n=a(3),r=a(65);function i(e,t){var a,i=Object(n.useRef)(),o=Object(r.a)(e);o&&e!==o&&(null===(a=i.current)||void 0===a||a.dispose(),i.current=void 0);e&&!i.current&&(i.current=e.listen(t)),Object(n.useEffect)((function(){return function(){var e;null===(e=i.current)||void 0===e||e.dispose(),i.current=void 0}}),[])}},,,function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(16),r=a.n(n),i=a(3);function o(){var e=Object(i.useState)(!1),t=r()(e,2),a=t[0],n=t[1],o=Object(i.useRef)(null);return Object(i.useEffect)((function(){var e=function(e){return n(!0)},t=function(e){for(var t=0,a=e.toElement,r=!1;a&&!r;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;a===o.current&&(r=!0),a=a.parentElement}r||n(!1)},a=o.current;if(a)return a.addEventListener("mouseover",e),a.addEventListener("mouseout",t),function(){a.removeEventListener("mouseover",e),a.removeEventListener("mouseout",t)}}),[o.current]),[o,a]}},,,,,function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(8),o=a.n(i);var s=function(){function e(){r()(this,e)}return o()(e,[{key:"onTouchMoveEnd",value:function(e){var t=e.ev,a=e.onMove,n=e.onUp,r=e.onPress,i=e.active,o=0,s=0,l=0,u=0,c=t.touches[0].clientX,d=t.touches[0].clientY,h=function(e){try{var t=e.touches[0].clientX,n=e.touches[0].clientY,r=t-c,i=t-d;o+=Math.abs(t-(l||t)),s+=Math.abs(n-(u||n)),null===a||void 0===a||a({x:t,y:n,clientX:t,clientY:n,diffX:r,diffY:i,distanceX:o,distanceY:s},e),l=t,u=n}catch(h){console.log(h)}},f=function(){document.removeEventListener("touchmove",h),document.removeEventListener("touchend",p)},p=function(e){var t={x:l,y:u,clientX:l,clientY:u,diffX:l-c,diffY:u-d,distanceX:o,distanceY:s};e.clientX=l,e.clientY=u,null===n||void 0===n||n(t,e),o<2&&s<2&&(null===r||void 0===r||r(t,e)),f()};return document.addEventListener("touchmove",h,i?{passive:!1}:{passive:!0}),document.addEventListener("touchend",p,i?{passive:!1}:{passive:!0}),f}}]),e}();t.a=new s},,function(e,t,a){"use strict";var n,r=a(7),i=a.n(r),o=a(8),s=a.n(o),l=a(10),u=a.n(l),c=a(11),d=a(2),h=a(144),f=a(0),p=a(9),g=a(6),m=a(4),v=a(48),y=a(75),k=a(58),_=a(112),b=a(59),w=a(114),S=a(32),D=d.a.Regexp.Prefix,P=(n=function(){function e(){i()(this,e)}return s()(e,[{key:"init",value:function(){try{f.default.PAssert(108,"complete"===document.readyState||"interactive"===document.readyState,"Setting up copy/paste too early")}catch(e){f.default.reportError(e)}document.body.addEventListener("paste",this.handlepaste,!1),document.body.addEventListener("cut",this.handlecut,!1),document.body.addEventListener("copy",this.handlecopy,!1)}},{key:"parseTextForPrefix",value:function(e){var t,a;return D.lastIndex=0,null!==(t=D.exec(e))&&(a=t[1],e=e.substr(t[0].length)),{prefix:a,text:e}}},{key:"insertToNote",value:function(e,t,a){try{f.default.PAssert(109,e,"Must have a valid start item")}catch(i){f.default.reportError(i)}try{f.default.PAssert(110,t,"Must have a valid end item")}catch(i){f.default.reportError(i)}var n,r=e.getParsedText();n=t===e?r.substring(0,g.a.getStartOffset())+a+r.substring(g.a.getEndOffset()):r.substring(0,g.a.getStartOffset())+a,e.setText(n,d.a.ChangeType.Local)}},{key:"insert",value:function(e,t,a){var n=this;if(!g.a.isValid())return!1;var r,i,o,s,l,u="",c=f.default.focusedPane,S=p.a.ie?"Text":"text/plain";if(a===d.a.DataSource.Plugin)o={items:[{text:e}]};else if(e&&e.getData){f.default.preventAndStop(t);var D=e.getData(S),P=D.startsWith("<?xml ");if(s=D.startsWith("<?opml ")||D.startsWith("<opml ")||P&&D.indexOf("<opml ")>=0)o=w.a.parseOPML(D);else if(P)m.default.toasts.pushMessage({text:"##BR_NAME__ currently does not support pasting XML. Please contact support@moo.do.",action:d.a.MessageAction.Contact,hold:!0});else{if(!(u=p.a.ie?void 0:e.getData("moodo/html")||e.getData("text/html"))){u=e.getData(S);var I=f.default.parseEvernoteLink(u),E=f.default.isBearLink(u);if(I||E){var C=g.a.save(),x="Enter title of "+(I?"Evernote":E&&"Bear")+" document";return void m.default.menus.prompt({title:x,cb:function(e){e&&(u="["+e+"]("+u+")"),g.a.restore(C),n.insert(u,t,d.a.DataSource.Plugin)}})}f.default.isUrlImage(u)&&m.default.settings.showImagesInline.get()&&(u="!"+u),u=u.replace(/\n/g,"<br>")}if(u){if(f.default.shouldLog(d.a.LogLevels.Input)&&f.default.log(u),!u)return void(f.default.shouldLog(d.a.LogLevels.Input)&&f.default.log("Paste buffer is empty"));var A=document.createElement("div"),T=u.replace(/[\r]|<head(.|\s)*?\/head>|<script(.|\s)*?\/script>|<style(.|\s)*?\/style>|style="(.|\s)*?"/g,"").replace(/\u2022/g,"");0;var M;if((M=/<body(.|\s)*?\/body>/g.exec(T))&&(T=M[0]),A.innerHTML=T,g.a.isValid()&&g.a.getStartItem().isNote())this.insertToNote(g.a.getStartItem(),g.a.getEndItem(),A.innerText);else{var L=A.children[0];2===A.children.length&&"A"===L.nodeName&&f.default.isOneNoteLink(L.href)&&(A.innerHTML=L.outerHTML),o=w.a.traverseDOMNew(A),m.default.settings.showDebugInfo.get()&&m.default.toasts.pushMessage({text:"Pasted with the new paste system. If it doesn't look right, please save this and send it to Moo.do support.",actionText:"SAVE",timeout:1e4,action:function(){var e=new Blob([T],{type:"text/plain;charset=utf-8"});Object(h.saveAs)(e,"Moo.do paste failure.txt")}})}}else{if(e&&e.items&&e.items.length>0)return m.default.pluginManager.handleDropEvent(t,(function(e){var t=g.a.save(),a=g.a.getStartItem(),n=a.parent(),r=c.createVMLI({text:e},{parent:n,changeType:d.a.ChangeType.AllLocal});n.insertItem(r,a.getIndex()),g.a.restore(t)})),!1;f.default.shouldLog(d.a.LogLevels.Input)&&f.default.log("Paste buffer is empty");try{f.default.PAssert(111,!1,"Paste with unexpected data type",e.types)}catch(R){f.default.reportError(R)}}}if(!o||!o.items||0===o.items.length)return!1}if(o){l=!0;var O=function(){var e;m.default.PaneUpdateBatcher.beginUpdateItems(),v.a.beginAction();var t=g.a.getStartObject(),a=g.a.getEndObject(),u=g.a.getStartItem(),h=u.isPrefixCodeBlock(),p=g.a.getStartItem().parent(),k=g.a.getStartItem().getIndex(),w=g.a.getStartOffsetWithPrefix(),S=g.a.getEndOffsetWithPrefix();if(r=u,t===a&&h&&(o.items.length>1||(null===(e=o.items[0].items)||void 0===e?void 0:e.length)>0)?(o.items[0].text=f.default.mapRecursive(o.items,"items",(function(e,t){return" ".repeat(2*t)+e.text})).join("\n"),o.items[0].items=[],o.items=o.items.slice(0,1)):f.default.mapRecursive(o.items,"items",(function(e){e.text.startsWith(d.a.Prefix.CodeBlock)||(e.text=e.text.replace(/[\n\t]/g," "))})),1!==o.items.length||o.items[0].items&&0!==o.items[0].items.length)if(c.isViewAgenda())m.default.toasts.pushMessage({text:"Pasting multiple items into the agenda is not supported. Please try pasting into an Outline pane.",actionText:"OKAY"}),l=!1;else{var D=0;if(f.default.shouldLog(d.a.LogLevels.Timing)&&console.time("paste"),c.clearPreventUpdate(),g.a.getStartOffset()>0&&k++,o&&o.items){var P=0;_.a.rewriteItemIDs(o.items,s);for(var I=0;I<o.items.length;++I){if(P++>5e3&&__infLoop&&__infLoop(P))throw new RangeError;var E=o.items[I],C=void 0;E.isNote?p.getNote()||(C=c.createVMLI({text:E.text,isNote:!0},{parent:p,changeType:d.a.ChangeType.AllLocal}),p.setNote(C,d.a.ChangeType.Local)):(0===I&&0===u.getRawText().length&&0===u.numChildren()&&u.deleteSelf(d.a.ChangeType.Local),C=c.createVMLI(E,{parent:p,changeType:d.a.ChangeType.AllLocal}),p.insertItem(C,k++,!1),r=C)}}for(;r.hasChildren();){if(D++>5e3&&__infLoop&&__infLoop(D))throw new RangeError;r=r.getLastChild()}i=-1}else{var x=t.showMarkdown(),A=o.items[0],T=A.text,M=w>0?n.parseTextForPrefix(T).text:T,L="",O="";if(!g.a.isSelectedFully(g.a.getStartObject())){var R=u.elsNew.split(t,w),F=u.elsNew.split(t,S);L=R[0].getRawText(x),O=F[1]?F[1].getRawText(x):""}h||(!L.length||L.endsWith(" ")||M.startsWith(" ")||(M=" "+M),!O.length||M.endsWith(" ")||O.startsWith(" ")||(M+=" "));var N=L+M+O;if(A.date)try{u.setMooDate(b.a.fromData(A.date),d.a.ChangeType.Local,!0)}catch(j){f.default.reportError(j,"Error parsing MooDate in paste")}L||O||(A.isStarred&&u.setStarred(!0,d.a.ChangeType.Local),A.priority&&u.setPriority(A.priority,d.a.ChangeType.Local)),u.setText(N,d.a.ChangeType.Local);var B=y.a.parseTextNew(u,M).elsNew.getDisplayText(u,{showMarkdown:x}).length;i=g.a.getStartOffset()+B}v.a.endAction(),m.default.PaneUpdateBatcher.commitUpdateItems(),f.default.shouldLog(d.a.LogLevels.Timing)&&console.timeEnd("paste")};g.a.getStartIndex()!==g.a.getEndIndex()?k.a.handleMultiselect({normCode:d.a.KeyCode.Backspace,preventDefault:f.default.emptyFn},O):O()}return l&&r&&(g.a.selectItem(r,i),f.default.focusedPane.scrollItemIntoView(r)),!1}},{key:"handlepaste",value:function(e){var t=e&&e.clipboardData?e.clipboardData:e.synthetic?e.data:window.clipboardData;if(g.a.isValid()&&!m.default.menus.isContextMenuOpen()&&!m.default.menus.isModalOpen()&&!S.b.isMenuOpen()){v.a.saveDeleteSelection(),v.a.beginAction();var a=this.insert(t,e,d.a.DataSource.Paste);return v.a.endAction(),a}}},{key:"handlecut",value:function(e){var t=!0;if(g.a.isValid()&&!m.default.menus.isContextMenuOpen()&&!m.default.menus.isModalOpen()){var a=g.a.getStartIndex(),n=g.a.getStartItem(),r=a===g.a.getEndIndex()&&g.a.getStartOffset()===g.a.getEndOffset();m.default.PaneUpdateBatcher.beginUpdateItems(),r&&g.a.selectIndices(a,0,a,n.getParsedText().length),!this.handlecopy(e)&&(r?f.default.focusedPane.deleteSelected():k.a.handleMultiselect({normCode:d.a.KeyCode.Backspace,preventDefault:f.default.emptyFn}),t=!1),m.default.PaneUpdateBatcher.commitUpdateItems()}return t}},{key:"handlecopy",value:function(e){var t=g.a.getPane();if(!g.a.isValid()||m.default.menus.isContextMenuOpen()||m.default.menus.isModalOpen())return!0;if(!t.overrideCopyBehavior)return!0;var a=e&&e.clipboardData?e.clipboardData:window.clipboardData;if(a){var n=!p.a.ie,r=g.a.getStartObject(),i=g.a.getEndObject(),o=g.a.getStartOffsetWithPrefix(),s=g.a.getEndOffsetWithPrefix(),l=g.a.getEndTotalWithPrefix(),u=r!==i||o===s||0===o&&s===l,c=g.a.getSelectedItems(u,!0),d=_.a.generateExport(c,{html:!0,moodo:!0,plain:!0},o,s,r,i),h=d.html,v=d.moodo,y=d.plain;return n&&h&&a.setData("text/html",h),n&&v&&a.setData("moodo/html",v),a.setData(p.a.ie?"Text":"text/plain",y),f.default.preventAndStop(e),!1}}}]),e}(),u()(n.prototype,"handlepaste",[c.a],Object.getOwnPropertyDescriptor(n.prototype,"handlepaste"),n.prototype),u()(n.prototype,"handlecut",[c.a],Object.getOwnPropertyDescriptor(n.prototype,"handlecut"),n.prototype),u()(n.prototype,"handlecopy",[c.a],Object.getOwnPropertyDescriptor(n.prototype,"handlecopy"),n.prototype),n);t.a=new P},function(e,t,a){"use strict";var n=a(51),r=a.n(n),i=a(52),o=a.n(i),s=a(7),l=a.n(s),u=a(8),c=a.n(u),d=a(20),h=a.n(d),f=a(21),p=a.n(f),g=a(13),m=a.n(g),v=a(0),y=a(3),k=a.n(y),_=a(97),b=a.n(_),w=a(45);function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=m()(e);if(t){var r=m()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return p()(this,a)}}var D=function(e){h()(a,e);var t=S(a);function a(){return l()(this,a),t.apply(this,arguments)}return c()(a,[{key:"init",value:function(){this.createObservables({ripples:[]}),this.rippleNum=0}},{key:"getElement",value:function(){return b.a.findDOMNode(this)}},{key:"onMouseDown",value:function(e){var t=this.props;if(!1!==t.enabled){if(this.props.onMouseDown&&this.props.onMouseDown(e),this.props.children&&!e.defaultPrevented&&!1!==t.ripple){var a,n,r=this.refs.element,i=r.offsetWidth,o=r.offsetHeight,s=Math.min(i,o);if(this.props.center)a="50%",n="50%";else{var l=v.default.offset(r);a=e.clientX-l.left,n=e.clientY-l.top}var u={id:this.rippleNum++,left:a,top:n,width:s,height:s};this.ripples.push(u),setTimeout(this.removeRipple,1e3)}e.stopPropagation()}}},{key:"onRightClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.onRightClick(e)}},{key:"removeRipple",value:function(){this.ripples.removeAt(0)}},{key:"render",value:function(){for(var e=0,t=this.state,a=this.props,n=a.center,i=a.onClick,s=(a.enabled,a.ripple,a.onRightClick),l=a.rippleColor,u=a.className,c=a.children,d=o()(a,["center","onClick","enabled","ripple","onRightClick","rippleColor","className","children"]),h=[],f=0;f<t.ripples.length;f++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var p=t.ripples[f],g={left:p.left,top:p.top,width:p.width,height:p.height,marginLeft:-p.width/2,marginTop:-p.height/2},m=v.default.classNames("fancyRipple",l||"defaultColor");h.push(k.a.createElement("div",{key:"ripple_"+p.id,className:m,style:g}))}var y=v.default.classNames(u,"fancyRippler",{rippleCenter:n});return k.a.createElement("div",r()({},d,{className:y,onMouseDown:this.onMouseDown,onClick:i,onContextMenu:s?this.onRightClick:void 0,ref:"element"}),c,h.length>0&&k.a.createElement("div",{className:"fancyRipples"},h))}}]),a}(w.a);t.a=D},function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(16),r=a.n(n),i=a(3);function o(e,t){Object(i.useEffect)((function(){Object.entries(t).forEach((function(t){var a=r()(t,2),n=a[0],i=a[1],o=n.replace("on","").toLowerCase();e.current.addEventListener(o,i,{passive:!1})}))}),Object.values(t))}},function(e,t,a){"use strict";var n=a(16),r=a.n(n),i=a(3),o=a.n(i),s=a(17),l=a(22),u=a(32);t.a=Object(s.b)((function(e){var t=e.keyboardToolbarHeight,a=Object(l.a)(u.b.keyboardHeight),n=r()(a,1)[0],i=n?n+(t||0):0;return o.a.createElement("div",{style:{height:i,minHeight:i,maxHeight:i}})}))},function(e,t,a){"use strict";var n=a(0),r=a(3),i=a.n(r),o=a(4),s=a(17),l=/"/g;t.a=Object(s.b)((function(e){var t=e.item,a=e.className,r=e.numberOfLines,s=e.highlightSearchText,u=o.default.ElementRenderer.renderToJSX(t,void 0,{highlightSearch:null===s||void 0===s?void 0:s.replace(l,"")}),c=n.default.classNames("itemNotInPane itemNew whitespace-pre-wrap-break-words",{"overflow-hidden ellipsis":1===r},{"line-clamp":r>1},a),d={lineClamp:r,WebkitLineClamp:r};return i.a.createElement("div",{className:c,style:d},u)}))},function(e,t,a){"use strict";var n=a(51),r=a.n(n),i=a(52),o=a.n(i),s=a(7),l=a.n(s),u=a(8),c=a.n(u),d=a(20),h=a.n(d),f=a(21),p=a.n(f),g=a(13),m=a.n(g),v=a(0),y=a(2),k=a(9),_=a(3),b=a.n(_),w=a(45);function S(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=m()(e);if(t){var r=m()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return p()(this,a)}}var D=function(e){h()(a,e);var t=S(a);function a(){return l()(this,a),t.apply(this,arguments)}return c()(a,[{key:"init",value:function(){var e=this.props;this.thumbExtraHeight=0;try{v.default.PAssert(1338,!(e.noOwnScroll&&e.onScroll),"FancyScroller can not have onScroll prop if it does not own its own scroll")}catch(a){v.default.reportError(a)}var t={isVisible:!1,isDragging:!1,thumbTop:0,thumbHeight:0};this.props.trackHasScrolled&&(t.hasScrolled=!1),this.createObservables(t)}},{key:"onMount",value:function(){this.refs.thumb&&v.default.setupClick(this.refs.thumb,this,{onStart:this.onTapThumbStart,onMove:this.onTapThumbMove,onEnd:this.onTapThumbEnd})}},{key:"onUnmount",value:function(){this.timeoutShow&&(clearTimeout(this.timeoutShow),this.timeoutShow=void 0),this.timeoutHide&&(clearTimeout(this.timeoutHide),this.timeoutHide=void 0)}},{key:"getScrollSize",value:function(){var e=this.props.orientation!==y.a.Orientation.Horizontal?"Height":"Width";return this.props.getScrollSize?this.props.getScrollSize():this.refs.scroller["scroll"+e]}},{key:"getClientHeight",value:function(){var e=this.props.orientation!==y.a.Orientation.Horizontal?"Height":"Width";return this.props.getClientHeight?this.props.getClientHeight():this.refs.scroller["client"+e]}},{key:"getScrollTop",value:function(){var e=this.props.orientation!==y.a.Orientation.Horizontal?"Top":"Left";return this.props.getScrollTop?this.props.getScrollTop():this.refs.scroller["scroll"+e]}},{key:"calculateThumb",value:function(){this.props;var e,t=this.getScrollSize(),a=this.getClientHeight(),n=this.getScrollTop(),r=this.props.thumbHeight;(r||(t===a?r=a:(r=a/t*a,this.thumbExtraHeight=r<30?30-r:0,r=Math.floor(Math.max(r,30)))),t===a)?e=0:e=n/(t-a)*(a-r);e=Math.floor(e);var i=r!==this.thumbHeight.get()||e!==this.thumbTop.get();this.thumbHeight.set(r,!1),this.thumbTop.set(e,i)}},{key:"onScroll",value:function(e){this.handleScroll(),this.props.onScroll&&this.props.onScroll(e)}},{key:"handleScroll",value:function(){this.isMouseDown||(this.calculateThumb(),this.isVisible.set(!0),this.hideTimeout()),this.props.trackHasScrolled&&this.hasScrolled.set(this.getScrollTop()>0)}},{key:"onMouseMove",value:function(e){this.timeoutHide&&(clearTimeout(this.timeoutHide),this.timeoutHide=void 0)}},{key:"onMouseEnter",value:function(e){var t=this.refs.scroller;t.scrollHeight>t.clientHeight&&(this.timeoutShow&&clearTimeout(this.timeoutShow),this.timeoutShow=setTimeout(this.showScrollbar,100))}},{key:"onMouseLeave",value:function(e){this.timeoutShow&&(clearTimeout(this.timeoutShow),this.timeoutShow=void 0),this.isMouseDown||this.hideTimeout()}},{key:"onTapThumbStart",value:function(e){e.button===y.a.ButtonCode.Left&&(this.isMouseDown=!0,this.lastY=this.props.orientation===y.a.Orientation.Horizontal?e.clientX:e.clientY,v.default.disableMouseMove=!0,this.isDragging.set(!0)),e.stopPropagation()}},{key:"onTapThumbMove",value:function(e){if(this.isMouseDown){var t=this.refs.scroller,a=this.props.orientation===y.a.Orientation.Horizontal,n=a?e.clientX:e.clientY,r=a?"Left":"Top",i=a?"Width":"Height",o=n-this.lastY;this.lastY=n;var s=v.default.clamp(this.thumbTop.get()+o,0,t["client"+i]-this.thumbHeight.get());this.thumbTop.set(s);var l=s/(t["client"+i]-this.thumbExtraHeight)*t["scroll"+i];t["scroll"+r]=l,v.default.preventDefault(e)}}},{key:"onTapThumbEnd",value:function(e){this.isMouseDown&&e.button===y.a.ButtonCode.Left&&(this.isMouseDown=!1,v.default.disableMouseMove=!1,this.isDragging.set(!1),this.hideTimeout())}},{key:"hideTimeout",value:function(){this.timeoutHide&&clearTimeout(this.timeoutHide),this.timeoutHide=setTimeout(this.hideScrollbar,500)}},{key:"hideScrollbar",value:function(){this.isVisible.set(!1),this.timeoutHide=void 0}},{key:"showScrollbar",value:function(){this.calculateThumb(),this.isVisible.set(!0),this.timeoutShow=void 0}},{key:"getElement",value:function(){return this.refs.element}},{key:"getScrollElement",value:function(){return this.refs.scroller}},{key:"scrollTo",value:function(e,t,a){v.default.scrollTo(e,t,a,this.refs.scroller)}},{key:"scrollToBottom",value:function(){var e=this.getClientHeight();this.scrollTo(0,e)}},{key:"render",value:function(){var e=this.state,t=this.props,a=(t.getScrollSize,t.getClientHeight,t.getScrollTop,t.noOwnScroll),n=t.showScrollbars,i=(t.trackHasScrolled,t.scrollable),s=(t.orientation,t.tinyMode),l=(t.onScroll,o()(t,["getScrollSize","getClientHeight","getScrollTop","noOwnScroll","showScrollbars","trackHasScrolled","scrollable","orientation","tinyMode","onScroll"])),u=t.orientation===y.a.Orientation.Horizontal,c=!1!==i&&!v.default.noScrollbars,d=v.default.classNames("fancyScroller flexbox",t.className,{"flexvert horizontal":u},{vertical:!u},{trackHasScrolled:t.trackHasScrolled},{scrolled:e.hasScrolled},{tinyMode:s}),h=v.default.classNames("fancyScrollbar",{"visible c-border":e.isVisible},{dragging:e.isDragging}),f=v.default.classNames("fancyScrollbarThumb c-bg-scrollthumb",{dragging:e.isDragging}),p={};u?(p.width=e.thumbHeight,p[k.a.transform.react]="translate3d("+e.thumbTop+"px,0,0)"):(p.height=e.thumbHeight,p[k.a.transform.react]="translate3d(0,"+e.thumbTop+"px,0)");var g=v.default.classNames("fancyScrollContent",{hideScrollbar:void 0!==t.showScrollbars},{scrollable:c}),m={};return m[t.orientation===y.a.Orientation.Horizontal?"overflowX":"overflowY"]="auto",b.a.createElement("div",r()({},l,{className:d,ref:"element"}),b.a.createElement("div",{className:g,style:m,ref:"scroller",onScroll:a?void 0:this.onScroll,"data-moo-id":this.getUniqueID()},t.children),!k.a.isFirefox&&c&&n&&b.a.createElement("div",{className:h,ref:"scrollbar",onMouseMove:this.onMouseMove,onMouseEnter:this.props.tinyMode?void 0:this.onMouseEnter,onMouseLeave:this.props.tinyMode?void 0:this.onMouseLeave},b.a.createElement("div",{className:f,style:p,ref:"thumb"})))}}]),a}(w.a);t.a=D},,function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(16),r=a.n(n),i=a(3),o=a(15),s=a(22);function l(e,t,a){var n=Object(i.useMemo)((function(){return new o.a(e)}),[]);if(t){var l=Object(s.a)(n),u=r()(l,1)[0];return e!==u&&(null===a||void 0===a||a(e)),[n,u]}return[n]}},function(e,t,a){"use strict";var n=a(5),r=a.n(n),i=a(12),o=a.n(i),s=a(16),l=a.n(s),u=a(2),c=a(0),d=a(9),h=a(3),f=a.n(h),p=a(47),g=a(6),m=a(4),v=a(29),y=a(18),k=a(90),_=a(64),b=a(45),w=a(17),S=a(22),D=a(106),P=a(91),I=a(38),E=a.n(I),C=a(77),x=a.n(C),A=Object(w.b)((function(e){var t,a,n=e.className,r=e.paneObject,i=e.component,o=e.onClick,s=e.isSelected,u=e.iconComponent,d=e.paddingLeft,p=Object(h.useState)(!1),g=l()(p,2),y=g[0],k=g[1],_=Object(h.useRef)(),b=r.item,w=r.pane,D=Object(S.a)(w.item,null===b||void 0===b?void 0:b.itemChanged),P=l()(D,1)[0];void 0===d&&(d=b?w.getPaddingForPaneObject(r):28);var I=b&&w.isPaneObjectCollapsed(r),C=b&&w.isItemHeader(b,!0),A=b&&w.getOverview().isItemDragHovered(b);s=null!==(t=s)&&void 0!==t?t:b&&b===P;var T,M=A?null===(a=m.default.DragDrop.dragInfo)||void 0===a?void 0:a.position:void 0,L={paddingLeft:d+(b&&!C?28:0),fontSize:15},O=c.default.classNames("overviewItem paneItemElement relative whitespace-nowrap cursor-pointer flex transition-colors duration-300 borderBox truncate",n,x.a.outer,E()({},"c-bg-lighter",y||s&&!A&&0!==M),{"c-overview-hover":!A},E()({},x.a.outerRadius,!A||0===M),{"c-background-item-selected":0===M},{"borderBox c-border-blue":A},E()({},x.a.border+" "+x.a.borderTop,-1===M),E()({},x.a.border+" "+x.a.borderBottom,1===M)),R=c.default.classNames(x.a.collapser);return T="hr"===r.type?f.a.createElement("div",{className:"c-border-heavy w-full my-1 "+x.a.hr}):"button"===r.type?f.a.createElement("div",{className:"flexbox f1 truncate items-center "+x.a.div,onClick:o},u&&f.a.createElement(u,{className:x.a.iconComponent}),f.a.createElement("span",{className:"truncate align-middle"},r.text)):f.a.createElement(i,{paneObject:r,onMouseDown:function(e){_.current=!1,b&&b.checkDragOnStart(e,!0)},onMouseLeave:function(){_.current=!0},setMenuOpen:k,didMouseLeave:_}),f.a.createElement("div",{style:L,className:O},C&&f.a.createElement(v.a,{className:R,icon:I?"icon-angle-right":"icon-angle-down",tooltip:I?"Uncollapse":"Collapse",iconSize:14,width:28,height:28,onClick:function(){w.setPaneObjectCollapsed(!w.isPaneObjectCollapsed(r),r)}}),T)})),T=Object(w.b)((function(e){var t=e.paneObject,a=e.isSelected,n=e.onMouseDown,r=e.onMouseLeave,i=(e.setMenuOpen,e.didMouseLeave),o=t.item,s=t.pane;Object(S.a)(o.itemChanged);var l=o.getUnstyledText(),u=c.default.classNames("ib f1 font-medium truncate pr-2",x.a.div,{"c-foreground-light":!a});return f.a.createElement("div",{className:u,dangerouslySetInnerHTML:{__html:l},onClick:function(){i.current||s.zoomIn(o)},onMouseDown:n,onMouseLeave:r,onContextMenu:function(e){c.default.preventAndStop(e)}})})),M=Object(w.b)((function(e){var t=e.paneObject,a=e.isSelected,n=e.onMouseDown,r=e.onMouseLeave,i=(e.setMenuOpen,e.didMouseLeave),o=t.item,s=t.pane;Object(S.a)(o.itemChanged);var l=o.getStyledTextAsOneLine(!1,!1,!0),u=c.default.classNames("ib f1 font-medium truncate",x.a.div,{"c-foreground-light":!a}),d=m.default.pluginManager.getPluginGmail().getIconInfoForLabel(o),h=d.icon,g=d.color,v=d.size,y=c.default.classNames(x.a.icon,"icon-"+h,{"c-foreground-light":!g}),k={color:g,fontSize:v};return"star"!==h&&"drafts"!==h||(k.textShadow="0 0 1px black"),f.a.createElement(f.a.Fragment,null,f.a.createElement("div",{className:x.a.iconWrap+" text-center"},h&&f.a.createElement("i",{className:y,style:k}),!h&&f.a.createElement(p.s,{className:y,style:k})),f.a.createElement("div",{className:u,dangerouslySetInnerHTML:{__html:l},onClick:function(){i.current||s.zoomIn(o)},onMouseDown:n,onMouseLeave:r,onContextMenu:function(e){c.default.preventAndStop(e)}}))})),L=Object(w.b)((function(e){var t=e.paneObject,a=e.isSelected,n=e.onMouseDown,r=e.onMouseLeave,i=e.setMenuOpen,o=e.didMouseLeave,s=t.item,d=t.pane,h=s.getDocumentOwner(),p=s===h.getRootItem(),g=Object(S.a)(p&&h.isSyncing,s.flags,p&&h.dateModified,p&&h.text,s.itemChanged),v=(l()(g,1)[0],p&&h.isLocalOnly(),s.getStyledTextAsOneLine(!1,!1,!0)),k=function(){o.current||(s.getDocumentOwner()!==d.getDocument()?(m.default.onIntroAction("ChangeDoc"),d.setDocument(s.getDocumentOwner(),{zoomItem:s})):d.zoomIn(s))},_=c.default.classNames("ib f1 truncate",x.a.div,{"c-foreground font-bold":p},{"c-foreground-medium font-normal":!a&&!p});return f.a.createElement(f.a.Fragment,null,f.a.createElement("div",{className:_,dangerouslySetInnerHTML:{__html:v},onClick:k,onMouseDown:n,onMouseLeave:r,onContextMenu:p?function(e){!function(e){i(!0),m.default.menus.openContextMenu({fn:function(e){var t=e.element,a=s.getDocumentOwner(),n=a.isAdmin(),r=a.isLocalOnly(),i=a.isDeleted.get();return f.a.createElement(D.a,{key:"contextMenuDocument",id:"contextMenuDocument",element:t},f.a.createElement(P.a,{onClick:function(){d.setCollapsedRecursive(a.getRootItem(),!0,!1,!0)}},"Collapse all items"),f.a.createElement(P.a,{onClick:function(){d.setCollapsedRecursive(a.getRootItem(),!1,!1,!0)}},"Expand all items"),f.a.createElement("hr",null),n&&f.a.createElement(f.a.Fragment,null,f.a.createElement(P.a,{onClick:function(){m.default.menus.prompt({title:"Rename document",value:a.text.get(),cb:function(e){e&&(y.a.renameDocument(a,e),s.itemChanged.notify())}})}},"Rename"),!r&&f.a.createElement(P.a,{onClick:function(){m.default.menus.openModal(u.a.Modals.ShareDoc,{doc:a})}},"Share"),!r&&f.a.createElement(P.a,{onClick:function(){m.default.menus.openModal(u.a.Modals.Backups,{doc:a})}},"Revision History"),f.a.createElement("hr",null),i?f.a.createElement(P.a,{onClick:function(){a.undelete()}},"Undelete"):f.a.createElement(P.a,{onClick:function(){y.a.getDocumentsArray().length>1?m.default.menus.confirm("Are you sure you want to delete ".concat(a.text.get(),"?"),(function(e){e&&a.delete()})):m.default.menus.alert({text:"Deleting the last document is not supported.",actionText:"OKAY"})}},"Delete")),!n&&f.a.createElement("div",{style:{padding:"12px 16px"}},"Please request Admin privelege on this document to modify it."))},element:e.target,onClosed:function(){console.log("closed"),i(!1)}})}(e),c.default.preventAndStop(e)}:void 0}),!1,!1)})),O=a(94),R=function(e){return function(t){m.default.menus.openContextMenu({element:t.target,fn:function(t){var a=t.element;return f.a.createElement(D.a,{key:"contextMenuDocument",id:"contextMenuDocument",element:a},e.map((function(e){return f.a.createElement(P.a,{key:e.text,onClick:e.cb},e.text)})))}})}},F=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=t.noPadTop,n=t.isCollapsed,r=t.setCollapsed,i=t.options;return f.a.createElement("div",{className:c.default.classNames("flexbox text-xs font-bold c-foreground-very-faded",{"pt-2":!a,"pl-4":!r}),style:{lineHeight:"28px"}},r&&f.a.createElement(v.a,{className:"",icon:n?"icon-angle-right":"icon-angle-down",tooltip:n?"Uncollapse":"Collapse",iconSize:14,width:28,height:28,onClick:function(){return null===r||void 0===r?void 0:r(!n)}}),f.a.createElement("div",{className:"cursor-pointer f1",onClick:function(){return null===r||void 0===r?void 0:r(!n)}},e),i&&f.a.createElement(v.a,{icon:"icon-more_horiz",width:28,height:28,iconSize:16,onClick:R(i),tooltip:"More options"}))},N=Object(w.b)((function(e){var t,a=e.pane,n=e.itemComponent,i=Object(h.useState)(!0),s=l()(i,2),c=s[0],d=s[1],g=Object(S.a)(y.a.documentsDeletedArray),v=l()(g,1)[0],b=Object(_.a)(),w=function(e){return function(){m.default.menus.confirm("Would you like to undelete ".concat(e.text.get(),"?"),(function(t){t&&(e.undelete(),a.setDocument(e,{zoomItem:e.getRootItem()}),b())}))}},D=function(e){return function(){m.default.menus.confirm("Would you like to undelete ".concat(e.info.text,"?"),function(){var t=o()(r.a.mark((function t(n){var i,o;return r.a.wrap((function(t){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(t.prev=t.next){case 0:if(!n){t.next=7;break}return i=m.default.toasts.pushMessage({text:"Downloading and restoring ".concat(e.info.text,"..."),hold:!0,noClose:!0}),t.next=4,k.a.loadSingleDocument(e.info,!0);case 4:(o=t.sent)&&(o.undelete(),a.setDocument(o,{zoomItem:o.getRootItem()}),b()),m.default.toasts.clearMessage(i);case 7:case"end":return t.stop()}}}),t)})));return function(e){return t.apply(this,arguments)}}())}};if(a.type===u.a.PaneMode.Task){var P=y.a.getDeletedDocuments(),I=P.length+v.length;t=I>0&&f.a.createElement(f.a.Fragment,null,F("TRASH (".concat(I,")"),{noPadTop:!0,isCollapsed:c,setCollapsed:d}),!c&&P.map((function(e){return f.a.createElement(A,{key:e.id,className:"font-medium",paneObject:{pane:a,type:"button",text:e.text.get()},component:n,iconComponent:p.l,onClick:w(e)})})),!c&&v.map((function(e){return f.a.createElement(A,{key:e.info.id,className:"font-medium",paneObject:{pane:a,type:"button",text:e.info.text},component:n,iconComponent:p.l,onClick:D(e)})})),f.a.createElement("div",{style:{height:36}}))}return f.a.createElement(f.a.Fragment,null,f.a.createElement("div",{className:"overviewBottomPad",style:{height:t?28:50}}),t)}));t.a=Object(w.b)((function(e){var t,a=e.pane,n=e.className,i=Object(b.b)(),s=Object(h.useRef)(),v=Object(S.a)(a.document,a.headerPaneObjects,y.a.documentsEncryptedArray,a.item,a.viewState,m.default.settings.syncAccounts,y.a.documentsArray),_=l()(v,3),w=(_[0],_[1]),D=_[2],P=a.type,I=(d.a.isNativeApp(),P===u.a.PaneMode.Task&&L||P===u.a.PaneMode.Gmail&&M||P===u.a.PaneMode.Drive&&T);if(P===u.a.PaneMode.Gmail){var E=Object(S.a)(a._overviewAccount),C=l()(E,1);t=C[0]}Object(h.useEffect)((function(){var e=a.item.get(),t=w.find((function(t){return t.item===e}));t&&s.current.scrollToIndex({index:t.index,align:"start",behavior:"auto",offset:30})}),[]);var x,R=function(e){return function(){a.zoomIn(a.getDefaultDisplayItem(e))}},B=a.type;if(B===u.a.PaneMode.Task)x=f.a.createElement(f.a.Fragment,null,!1,D.length>0&&f.a.createElement(f.a.Fragment,null,F("ENCRYPTED DOCUMENTS"),D.map((function(e){return f.a.createElement(A,{key:e.id,className:"font-medium",paneObject:{pane:a,type:"button",text:e.text},component:I,iconComponent:p.t,onClick:(t=e,function(){var e;m.default.menus.promptComplex({title:"Enter password",text:"Please enter the password for this document: ".concat(t.text),fields:[{type:"password"}],validate:function(){var a=o()(r.a.mark((function a(n){var i,o,s;return r.a.wrap((function(a){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(a.prev=a.next){case 0:if(i=l()(n,1),!(o=i[0])){a.next=19;break}return a.prev=2,a.next=5,m.default.crypto.addKey({name:t.id,password:o,sentinelSalt:t.id});case 5:if(s=a.sent,t.encryptionSentinel!==s.sentinel){a.next=10;break}e=s.key,a.next=12;break;case 10:return m.default.crypto.removeKey(t.id),a.abrupt("return","The password was invalid. Please try again.");case 12:a.next=17;break;case 14:a.prev=14,a.t0=a.catch(2),console.log(a.t0);case 17:a.next=20;break;case 19:return a.abrupt("return","You must enter a password");case 20:case"end":return a.stop()}}}),a,null,[[2,14]])})));return function(e){return a.apply(this,arguments)}}(),callback:function(){e&&(m.default.settings.addEncryptionKey(t.id,e),k.a.loadSingleDocument(t).then((function(e){e&&a.setDocument(e)})))}})})});var t}))),F("DOCUMENTS",!1));else if(B===u.a.PaneMode.Drive)x=F("FOLDERS");else if(B===u.a.PaneMode.Gmail){var j=m.default.pluginManager.getPluginGmail().getSyncAccounts();x=f.a.createElement(f.a.Fragment,null,j.length>1&&f.a.createElement(f.a.Fragment,null,F("ACCOUNTS"),j.map((function(e){return f.a.createElement(A,{key:e,paneObject:{pane:a,type:"button",text:e},isSelected:e===t,component:I,onClick:R(e)})}))),F("LABELS"))}else if(B===u.a.PaneMode.Inbox){x=f.a.createElement(f.a.Fragment,null,f.a.createElement("div",{className:"mx-4 mt-6 leading-snug c-foreground-faded"},"Full Gmail support for the mobile app is coming soon."))}var U=c.default.classNames(n,"paneOverviewScroller scroller f1"),H=Object(h.useCallback)((function(e){return f.a.createElement(A,{paneObject:e,component:I})}),[I]),V=Object(h.useMemo)((function(){return f.a.createElement(N,{pane:a,itemComponent:I})}),[I,a]),W=c.default.classNames("paneOverviewOutside h-full f1 flexbox flexvert fontPane select-none");return f.a.createElement("div",{className:W,"data-moo-id":i,"data-pane-id":a.id,onMouseDownCapture:function(){g.a.setFocusedPane(a)}},x,f.a.createElement(O.a,{className:U,items:w,footer:V,renderItem:H,defaultItemSize:28,overscan:u.a.ListOverscan,shouldMemoize:!0,ref:s}))}))},function(e,t,a){"use strict";var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(20),l=a.n(s),u=a(21),c=a.n(u),d=a(13),h=a.n(d),f=a(0),p=a(2),g=a(4),m=a(9),v=a(3),y=a.n(v),k=a(45),_=a(33),b=a(29),w=a(16),S=a.n(w),D=a(6),P=a(106);function I(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=h()(e);if(t){var r=h()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return c()(this,a)}}var E=["#4D4D4D","#999999","#CCCCCC","#FFFFFF","#F44E3B","#FE9200","#FCDC00","#A4DD00","#68CCCA","#73D8FF","#AEA1FF","#FDA1FF","#333333","#808080","#BBBBBB","#EEEEEE","#D33115","#E27300","#FCC400","#22AA66","#16A5A5","#0099DD","#7B64FF","#FA28FF","#000000","#666666","#AAAAAA","#DDDDDD","#AA3300","#C45100","#FB9E00","#194D33","#0C797D","#0062B1","#653294","#AB149E"],C={hex3:/^(#)([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^(#)([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/},x=function(e){l()(a,e);var t=I(a);function a(){return r()(this,a),t.apply(this,arguments)}return o()(a,[{key:"init",value:function(){this.createObservables({color:this.props.color,value:this.props.color,isValid:!0}),D.a.reset()}},{key:"parseColor",value:function(e){var t;return(t=C.hex3.exec(e))?"#"+t[2]+t[2]+t[3]+t[3]+t[4]+t[4]:(t=C.hex6.exec(e))?e:void 0}},{key:"onClickColor",value:function(e){this.color.set(e),this.value.set(e),this.props.onChange(e)}},{key:"onChangeInputColor",value:function(e){var t=e.target.value.toUpperCase();0!==t.indexOf("#")&&(t="#"+t);var a=this.parseColor(t);a&&(this.color.set(a),this.props.onChange(a)),t.length<8&&this.value.set(t),this.isValid.set(!!this.parseColor(this.value.get()))}},{key:"onChangeInputComponent",value:function(){var e=this.refs,t=+e.r.value,a=+e.g.value,n=+e.b.value;if(t>=0&&t<=255&&a>=0&&a<=255&&n>=0&&n<=255){var r="#"+f.default.rgbToHex(t,a,n);this.value.set(r),this.color.set(r),this.props.onChange(r)}}},{key:"render",value:function(){for(var e=0,t=this.state,a=this.state.color,n=f.default.hexToRgb(a),r=[],i=0;i<E.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=E[i],s=f.default.classNames("fancyColor",{selected:o===a},{isWhite:"#FFFFFF"===o.toUpperCase()}),l={background:o};r.push(y.a.createElement("div",{key:o,className:s,style:l,onClick:this.onClickColor.bind(this,o)}))}var u=f.default.classNames("fancyColorInputColor",{invalid:!t.isValid});return y.a.createElement(P.a,{id:"fancyColorPicker",element:this.props.element,positionOffset:{left:-120,top:4},focusTrap:!0},y.a.createElement("div",{className:"fancyColors"},r),y.a.createElement("div",{className:"fancyColorText"},y.a.createElement("div",{key:a,className:"fancyColor",style:{background:a}}),y.a.createElement("input",{type:"text",className:u,value:t.value,onChange:this.onChangeInputColor}),y.a.createElement("span",null,"R"),y.a.createElement("input",{type:"text",ref:"r",className:"fancyColorInputComponent",value:n.r,onChange:this.onChangeInputComponent}),y.a.createElement("span",null,"G"),y.a.createElement("input",{type:"text",ref:"g",className:"fancyColorInputComponent",value:n.g,onChange:this.onChangeInputComponent}),y.a.createElement("span",null,"B"),y.a.createElement("input",{type:"text",ref:"b",className:"fancyColorInputComponent",value:n.b,onChange:this.onChangeInputComponent})))}}]),a}(k.a),A=a(17),T=a(22),M=Object(A.b)((function(e){var t,a,n=e.color,r=e.colorObservable,i=e.onChange,o=e.style;if(r){var s=Object(T.a)(r),l=S()(s,1);t=l[0],a=r.set.bind(r)}else{var u=Object(v.useState)(n),c=S()(u,2);t=c[0],a=c[1],Object(v.useEffect)((function(){a(n)}),[n])}var d=function(e){a(e),i&&i(e)},h=f.default.extend({background:t,border:"1px solid #666"},o),p=f.default.classNames("fancyColor",{isWhite:"#FFFFFF"===t.toUpperCase()});return y.a.createElement("div",{className:p,style:h,onClick:function(e){g.default.menus.openContextMenu({fn:function(e){return y.a.createElement(x,{key:"fancyColorPicker",color:t,onChange:d,element:e.element})},element:e.target})}})})),L=a(32);function O(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=h()(e);if(t){var r=h()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return c()(this,a)}}var R=p.a.KeyboardToolbarButtonHeight,F=/(^|\s|&nbsp;|<div>|<span>|<p>)((?:(?:((https?|ftps?):\/\/)|www)[^"<\s]+)(?![^<>]*>|[^"]*?<\/a))/gi,N=[p.a.KeyCode.ArrowLeft,p.a.KeyCode.ArrowRight,p.a.KeyCode.ArrowUp,p.a.KeyCode.ArrowDown,p.a.KeyCode.Enter,p.a.KeyCode.Escape,p.a.KeyCode.PageUp,p.a.KeyCode.PageDown],B=function(e){l()(a,e);var t=O(a);function a(){return r()(this,a),t.apply(this,arguments)}return o()(a,[{key:"init",value:function(){this.refDiv=y.a.createRef(),this.createObservables({isFocused:this.props.focused||!1})}},{key:"onMount",value:function(){var e=this,t=this.props;if(t.value){var a=this.replaceHTMLLinks(t.value.replace(/\r?\n/g,"<br>"));this.setValue(a)}t.focused&&requestAnimationFrame((function(){e.refDiv.current&&e.refDiv.current.focus()}))}},{key:"onUnmount",value:function(){this.isFocused.get()&&this.onBlur()}},{key:"focus",value:function(){var e=this;f.default.isDemoRunning||(this.refDiv.current.focus(),requestAnimationFrame((function(){e.refDiv.current.focus()})))}},{key:"blur",value:function(){this.refDiv.current.blur()}},{key:"setValue",value:function(e){this.refDiv.current.innerHTML=e}},{key:"getValue",value:function(){return this.refDiv.current.textContent.length>0?this.refDiv.current.innerHTML:""}},{key:"getTextValue",value:function(){return this.refDiv.current.textContent}},{key:"getElement",value:function(){return this.refDiv.current}},{key:"insertCharAtIndex",value:function(e,t){var a=this.refDiv.current,n=a.innerHTML;n=n.substr(0,t)+e+n.substr(t,n.length),a.innerHTML=n,_.default.selectElement(a,t+1),this.props.onChange&&this.props.onChange()}},{key:"onFocus",value:function(e){this.isFocused.set(!0),this.props.onFocus&&this.props.onFocus(e)}},{key:"onBlur",value:function(e){this.isFocused.set(!1),this.props.onBlur&&this.props.onBlur(e)}},{key:"hasFocus",value:function(){return this.isFocused.get()}},{key:"onEscapeKey",value:function(){this.props.onEscape&&this.props.onEscape()}},{key:"onDrop",value:function(e){this.props.onDrop&&this.props.onDrop(e.dataTransfer)}},{key:"onDragEnter",value:function(){this.props.onDrop&&f.default.addClass(this.refDiv.current,"dragTarget")}},{key:"onDragLeave",value:function(){this.props.onDrop&&f.default.removeClass(this.refDiv.current,"dragTarget")}},{key:"onKeyDown",value:function(e){if(m.a.mac&&e.metaKey||!m.a.mac&&e.ctrlKey)e.keyCode===p.a.KeyCode.U?this.onClickToolbarButton("underline"):e.keyCode===p.a.KeyCode.K?this.insertLink({target:this.refs.link.getElement()}):e.keyCode===p.a.KeyCode.H?(this.makeHeading(),f.default.preventDefault(e)):e.keyCode===p.a.KeyCode.V&&(this.__pasteWithShift=e.shiftKey);else if(!N.includes(e.keyCode)){var t=_.default.getSelectionRangeNative();if(t){var a=t.startContainer,n=a.parentElement;"A"===n.nodeName&&n.textContent===n.getAttribute("href")&&t.startOffset===t.endOffset&&t.startOffset===n.textContent.length&&(n.replaceWith(a),_.default.selectAfterNode(a))}}this.props.onKeyDown&&this.props.onKeyDown(e)}},{key:"insertNode",value:function(e){this.focus(),_.default.deleteRangeContents(),_.default.insertNode(e),_.default.selectAfterNode(e)}},{key:"insertLink",value:function(e){var t=_.default.getSelectedText(),a=e.target;this.savedSel=_.default.getSelectionRange(),g.default.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:a,onClosed:this.onInsertLinkClosed,onInsertLink:this.onInsertLink,text:t})}},{key:"onInsertLinkClosed",value:function(){this.savedSel&&(this.focus(),_.default.setSelectionRange(this.savedSel))}},{key:"onInsertLink",value:function(e){var t=document.createElement("a");t.href=e.href,t.textContent=e.text,this.insertNode(t)}},{key:"makeHeading",value:function(e){for(var t,a,n=0,r=window.getSelection(),i=r.rangeCount;i--;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var o=r.getRangeAt(i),s=o.startContainer,l=o.startContainer.parentElement,u=_.default.getSelectOffsetsInElement(this.refDiv.current,o);if("H2"===l.nodeName)a=void 0,l.parentElement.replaceChild(s,l),_.default.selectElement(s,0,s.textContent.length);else if(u){if(!e&&u.start===u.end)return _.default.selectElement(s,0,s.textContent.length),this.makeHeading(!0);(a=document.createElement("h2")).appendChild(o.extractContents()),o.insertNode(a),t=a.textContent.length}}a&&t&&_.default.selectElement(a,0,t)}},{key:"onClickToolbarButton",value:function(e,t){f.default.isString(e)?"heading"===e?this.makeHeading():document.execCommand(e):e(t),f.default.preventAndStop(t)}},{key:"onClick",value:function(e){"A"===e.target.nodeName?g.default.openUrl(e.target.href):this.props.onClick&&this.props.onClick(e)}},{key:"onPaste",value:function(e){if(this.__pasteWithShift){var t=document.queryCommandSupported("insertText"),a=document.queryCommandSupported("paste");if(t||a){e.preventDefault();var n="";e.clipboardData||e.originalEvent.clipboardData?n=(e.originalEvent||e).clipboardData.getData("text/plain"):window.clipboardData&&(n=window.clipboardData.getData("Text")),n=n.trim();var r=t?"insertText":"paste";document.execCommand(r,!1,n)}}}},{key:"replaceHTMLLinks",value:function(e){return e.replace(F,(function(e,t,a){return t+'<a href="'+a+'">'+a+"</a>"}))}},{key:"onSetColor",value:function(e){document.execCommand("forecolor",!1,e)}},{key:"onChange",value:function(e){var t=e.target.innerHTML,a=this.replaceHTMLLinks(t);if(t!==a){var n=_.default.getSelectionRangeNative(),r={start:0,end:0};n&&(r=_.default.getSelectOffsetsInElement(e.target,n)),e.target.innerHTML=a,_.default.selectElement(e.target,r.start,r.end)}this.props.onChange&&this.props.onChange(e)}},{key:"renderToolbarButton",value:function(e,t,a,n,r,i){var o=m.a.priModKey;return r&&(r="Escape"===r?r:o+" + "+r),y.a.createElement(b.a,{className:"button_"+n,icon:e,width:R,height:R,iconSize:t,onClick:this.onClickToolbarButton.bind(this,a),tooltip:n,tooltipHotkey:r,ref:i,preventDefaultOnMobileDown:!0})}},{key:"render",value:function(){var e,t=this.props,a=f.default.classNames("fancyContenteditableWrapper flexbox flexvert",t.className),n=f.default.classNames("fancyContenteditable f1 c-background",{richText:t.richText}),r={height:this.props.height,marginBottom:p.a.KeyboardToolbarButtonHeight},i=!!t.spellCheck||null;return t.richText&&(e=y.a.createElement("div",{className:"flex select-none fancyContenteditableToolbar c-bg-faded c-border-light"},this.renderToolbarButton("icon-format_bold",19,"bold","Bold","B"),this.renderToolbarButton("icon-format_italic",19,"italic","Italic","I"),this.renderToolbarButton("icon-format_underlined",18,"underline","Underline","U"),this.renderToolbarButton("icon-header",14,"heading","Heading","H","H1"),y.a.createElement("div",{className:"divider c-bg-autocomplete-highlight"}),this.renderToolbarButton("icon-numlist",14,"insertOrderedList","Numbered list","L"),this.renderToolbarButton("icon-bullet",26,"insertUnorderedList","Bulleted list","Option + L"),y.a.createElement("div",{className:"divider c-bg-autocomplete-highlight"}),y.a.createElement(M,{color:"#000000",onChange:this.onSetColor,style:{marginTop:11,verticalAlign:"top"}}),this.renderToolbarButton("icon-link",18,this.insertLink,"Link","K","link"),y.a.createElement("div",{className:"f1"}),t.onMaximize&&this.renderToolbarButton(t.isMaximized?"icon-filter_none":"icon-check_box_outline_blank",14,(function(){return t.onMaximize(!t.isMaximized)}),t.isMaximized?"Restore":"Maximize"),t.onClickClose&&this.renderToolbarButton("icon-close",18,t.onClickClose,"Close","Escape")),e=y.a.createElement(L.b.KeyboardToolbarPortal,null,e)),y.a.createElement("div",{className:a,style:r},e,y.a.createElement("div",{contentEditable:!1!==t.editable,className:n,style:this.props.style,ref:this.refDiv,spellCheck:i,onInput:this.onChange,onClick:this.onClick,onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onKeyUp:t.onKeyUp,onKeyPress:t.onKeyPress,onDrop:this.onDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onPaste:this.onPaste,tabIndex:t.tabIndex}))}}]),a}(k.a);t.a=B},,,function(e,t,a){"use strict";a.r(t);var n=a(16),r=a.n(n),i=a(5),o=a.n(i),s=a(12),l=a.n(s),u=a(2),c=a(28),d=a(0),h=a(3),f=a.n(h),p=a(6),g=a(4),m=a(64),v=a(127),y=a(17),k=a(54),_=a(49),b={},w=Object(y.a)(Object(h.forwardRef)((function(e,t){var a=e.paneObject,n=e.className,r=e.state,i=e.children,s=e.style,p=e.setAnimated,g=Object(c.d)(),v=Object(m.a)(),y=Object(h.useCallback)(function(){var e=l()(o.a.mark((function e(t){return o.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return 0===t||r.scrollListener||(a.pane.addScrollListener(k),r.scrollListener=k),r.positionPrevious=t,r.isOpen=0!==t,e.next=5,g.start({x:t,transition:u.a.TransitionSpring});case 5:0!==t||r.isOpen||(r.direction=!1,delete b[a.id],p(!1));case 6:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),k=Object(h.useCallback)((function(){r.scrollListener&&(a.pane.removeScrollListener(k),r.scrollListener=void 0),y(0)}),[]);r.close=k,Object(h.useImperativeHandle)(t,(function(){return{updateOnMove:function(e,t){t&&(r.isOpen=!0,v()),g.stop(),g.set({x:e})},updateOnUp:function(e){y(e)}}}));var _,w=r.direction;if(!1!==w&&r.swipeMenu){var S=d.default.classNames("absFull flex pointer-events-none",w>0?"justify-start":"justify-end"),D=r.swipeMenu[w>0?"left":"right"];_=f.a.createElement("div",{className:S,style:{backgroundColor:D[0].backgroundColor,zIndex:2}},D.map((function(e){return f.a.createElement("div",{key:e.icon,className:"flex items-center justify-center pointer-events-auto bypassPaneObjectTouch mobutton",onClick:(t=e.onActivated,function(){k(),t()}),style:{backgroundColor:e.backgroundColor,width:!e.text&&50,height:"100%"}},f.a.createElement("div",{className:d.default.classNames("icon-"+e.icon,e.text&&"pl-3"),style:{fontSize:18,color:"white"}}),e.text&&f.a.createElement("div",{className:"pl-3 c-foreground-white"},e.text));var t})))}return f.a.createElement(f.a.Fragment,null,_,f.a.createElement(c.b.div,{className:n+" pointer-events-none inset-x-0",animate:g,style:Object.assign({position:"absolute",top:0,zIndex:3},s)},i))})));t.default=Object(y.a)(Object(h.forwardRef)((function(e,t){var a=e.paneObject,n=e.className,i=e.supportMultiselect,o=e.onPress,s=e.children,l=e.style,u=Object(h.useRef)(),c=Object(h.useState)(!1),m=r()(c,2),y=m[0],S=m[1],D=Object(h.useMemo)((function(){return{direction:!1,isOpen:!1,didHold:!1,swipeMenu:void 0,timeoutReset:void 0,positionPrevious:0,close:void 0,scrollListener:void 0}}),[]),P=Object(v.a)({children:s,style:l,className:n}),I=Object(h.useMemo)((function(){return{onTouchStart:function(e,t){if(_.a.isKeyboardOpen.get()||_.a.isMenuOpen())return!1;clearTimeout(D.timeoutReset),Object.keys(b).forEach((function(e){var t,n;e!==a.id&&(null===(t=(n=b[e]).close)||void 0===t||t.call(n))})),D.direction=!1,D.didHold=!1,D.isOpen&&d.default.preventDefault(t),D.timeoutHold=setTimeout((function(){D.direction||D.isOpen||(D.didHold=!0,k.a.beginBatch(),!1!==i&&p.a.multiselect(a),_.a.isHoldDown.set(!0),k.a.endBatch())}),400)},onTouchMove:function(e,n,r){var i=e.x,o=e.y,s=e.diffX,l=e.distanceX,c=e.distanceY,h=(s+=D.positionPrevious)>0?1:-1,m=h!==D.direction;if(D.didHold){if(!p.a.isMultiselected()){var v=t.current,y=P.current,k=f.a.createElement("div",{className:y.className,style:y.style,key:0},y.children),w=d.default.offset(v),I={pane:a.pane,width:400,items:[{id:a.item.id,item:a.item,element:k}],positionOffset:{x:i-w.left,y:o-w.top},mousePositionStart:{x:i,y:o}};g.default.DragDrop.checkDragMoveNew(I,e)&&_.a.isHoldDown.set(!1)}}else D.direction||D.didHold||p.a.isInMobileMultiselect()||(l>3&&c<3?(D.direction=h,D.swipeMenu=a.pane.getSwipeMenuItems(a),b[a.id]=D,S(!0)):c>=3&&(clearTimeout(D.timeoutHold),r()));D.direction&&(D.direction=h,clearTimeout(D.timeoutHold),u.current&&u.current.updateOnMove(s,m)),(D.direction||D.didHold)&&d.default.preventDefault(n)},onTouchEnd:function(e,t){var n=e.clientX,r=e.clientY,i=e.diffX,s=e.distanceX,l=e.distanceY;if(clearTimeout(D.timeoutHold),D.direction)if(((i+=D.positionPrevious)>0?1:-1)>0||i>-100){var c;null===(c=D.close)||void 0===c||c.call(D),i>100&&setTimeout((function(){D.swipeMenu.left[0].onActivated()}),300)}else{var h,f=-50*D.swipeMenu.right.length;null===(h=u.current)||void 0===h||h.updateOnUp(f)}else D.didHold?(g.default.DragDrop.dragging.get()?(g.default.DragDrop.checkDragEndNew({clientX:n,clientY:r,dataTransfer:{pane:a.pane}}),p.a.reset(),d.default.cancelRepeatScrolls()):_.a.isHoldDown.set(!1),d.default.preventAndStop(t)):!D.didHold&&s<3&&l<3&&(D.isOpen?D.close():p.a.hasFullSelection()?(d.default.preventAndStop(t),p.a.multiselect(a)):null===o||void 0===o||o(t))}}}),[a,P,D]);return function(e,t){Object(h.useEffect)((function(){return _.a.setTouchEventListeners(e,t),function(){_.a.setTouchEventListeners(e,void 0)}}),[])}(a.id,I),Object(h.useEffect)((function(){return function(){clearTimeout(D.timeoutHold)}}),[]),n=(n||"")+" c-background swiper",f.a.createElement("div",{ref:t},f.a.createElement("div",{style:l,className:n},s),y&&f.a.createElement(w,{paneObject:a,className:n,style:l,state:D,setAnimated:S,ref:u},s))})))},,function(e,t,a){"use strict";var n=a(51),r=a.n(n),i=a(52),o=a.n(i),s=a(0),l=a(3),u=a.n(l),c=a(4),d=(a(31),a(17));t.a=Object(d.a)(Object(l.forwardRef)((function(e,t){var a,n,i=e.pane,l=e.className,d=e.onMouseDown,h=e.dragOptions,f=e.multiselectIndex,p=e.onClick,g=e.onDoubleClick,m=o()(e,["pane","className","onMouseDown","dragOptions","multiselectIndex","onClick","onDoubleClick"]);void 0!==f&&(a=function(e){i.onDoubleClick(f,e),p&&p(e)},n=function(e){i.onDoubleClick(f,e),g&&g(e)});var v={onTouchStart:function(e){var t=e.clientX||e.touches[0].clientX,a=e.clientY||e.touches[0].clientY,n=s.default.findParent(e.target,"draggable"),r=u.a.createElement("div",Object.assign({className:l,key:0},m)),i=s.default.offset(n),o=Object.assign(h,{items:[{id:h.id,element:r,item:h.item}],positionOffset:{x:t-i.left,y:a-i.top},mousePositionStart:{x:t,y:a}});c.default.DragDrop.checkDragStartNew(e,o,h.onDrop),d&&d(e)}};return u.a.createElement("div",r()({},m,{className:s.default.classNames(l,"draggable")},v,{onClick:a||p,onDoubleClick:n||g,ref:t}))})))},function(e,t,a){"use strict";a.r(t);var n=a(16),r=a.n(n),i=a(3),o=a.n(i),s=a(56),l=a(65),u=a(17),c=a(22),d=a(69),h=a(2),f=a(9),p=a(6),g=a(94),m=a(32),v=Object(u.b)((function(e){var t=e.inPane,a=e.owner,n=e.offset,s=e.children,l=Object(c.a)(m.b.keyboardHeight,f.a.windowSize),u=r()(l,2),v=u[0],y=u[1],k=Object(i.useMemo)((function(){return a instanceof d.a?a.pane.listManager.offsetOfIndex(a.index)+30:p.a.pane.get().search.isFocused.get()?2*h.a.Mobile.TopBarHeight:void 0}),[a]);if(void 0!==k){var _=k+(n||0),b=(t?y.height-3*h.a.Mobile.TopBarHeight:y.height-_)-v-16,w={top:_,maxHeight:b},S={maxHeight:b};return o.a.createElement("div",{className:"absolute inset-x-0 ml-4 mr-4 rounded c-shadow-popup c-background z-3",style:w},o.a.createElement(g.a,{defaultItemSize:34,style:S,shouldMemoize:!0,containerSize:b},s))}return null}));t.default=Object(u.b)((function(e){var t=e.inPane,a=Object(c.a)(s.a.matches),n=r()(a,1)[0],u=s.a.owner,h=n.length>0&&u instanceof d.a===t,f=Object(l.a)(h);Object(i.useEffect)((function(){if(h&&!f&&u instanceof d.a){var e=u,t=e.pane,a=e.index;t.scrollIndexToTop(a,"smooth")}}),[u,h,f]);var p=function(e){return function(){s.a.onSelectedMatch(e)}};return h?o.a.createElement(v,{inPane:t,owner:u},n.map((function(e){return o.a.createElement("div",{key:e.text,className:"px-2 py-2",onClick:p(e)},e.text)}))):null}))},function(e,t,a){"use strict";a.r(t);var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(24),l=a.n(s),u=a(20),c=a.n(u),d=a(21),h=a.n(d),f=a(13),p=a.n(f),g=a(2),m=a(4),v=a(0),y=a(6),k=a(9);function _(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=p()(e);if(t){var r=p()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return h()(this,a)}}var b=function(e){c()(a,e);var t=_(a);function a(){return r()(this,a),t.apply(this,arguments)}return o()(a,[{key:"getAppInfo",value:function(e){l()(p()(a.prototype),"getAppInfo",this).call(this,e);var t=window;e.user={name:m.default.settings.displayName.get(),email:m.default.settings.activeUser.get()},e.gapiTimeout=t.gapiTimeout,e.sessionID=t.__SESSION_ID,e.appCacheUpdated=v.default.wasAppCacheUpdated,e.realtimeLoadStatus=this.computeRealtimeLoadStatus(),this.getRunningState(e),this.getAppStats(e),this.getPremiumInfo(e);try{e.cacheState=m.default.cacheManager.getInfo()}catch(n){e.cacheState="ERROR"}}},{key:"getRunningState",value:function(e){var t,a=window;try{m.default.PaneManager.hasLoadedPaneState()&&(t=m.default.PaneManager.getPaneState()).forEach((function(e){return delete e.itemState}))}catch(n){v.default.log("Failed to get paneState")}e.isDebug=!1,e.isDemo=v.default.isDemoMode(),e.localWrites=v.default.shouldWriteLocal(),e.authUserLoggedIn=v.default.authUserLoggedIn,e.isReconnected=v.default.isReconnected,e.url=v.default.sanitizeURL(window.location.href),e.paneState=t?v.default.sanitizePaneState(t):"Missing Pane State",e.checkpoints=a.__checkpoints,e.gapiLoadError=a.gapiLoadError,e.gapiTimeout=a.gapiTimeout,e.gapiClientLoadError=a.gapiClientLoadError,e.gapiClientTimeout=a.gapiClientTimeout,e.DOMReadyState=document.readyState,e.htmlVersion=document&&document.body?document.body.getAttribute("ver"):"UNKNOWN",e.windowWidth=window.innerWidth,e.windowHeight=window.innerHeight,e.eventStream=v.default.getEventStream(),e.criticalErrorReported=v.default.criticalErrorReported(),v.default.getLoadedScripts(e);try{e.nativesel=v.default.parseExtra(window.getSelection())}catch(n){e.nativesel="Error: "+n.message}try{e.customsel=y.a.dumpState()}catch(n){e.customsel="Error: "+n.message}try{e.errorPlatformInfo=JSON.stringify(v.default.errorPlatformInfo)}catch(n){e.errorPlatformInfo="Error: "+n.message}try{e.validScreens=JSON.stringify(a.Screens)}catch(n){e.validScreens="Error: "+n.message}e.lastActivity=v.default.lastActivity}},{key:"getPremiumInfo",value:function(e){if(m.default.billingManager){var t={premiumStatus:m.default.billingManager.getPremiumStatus(),billingIdentifier:m.default.billingManager.getBillingIdentifier(),lastSignupError:m.default.billingManager._lastSignupError};e.premiumInfo=t}else e.premiumInfo="Billing Manager Not Loaded"}},{key:"computeRealtimeLoadStatus",value:function(){return{gapi:!!window.gapi,auth:!(!window.gapi||!window.gapi.auth),client:!(!window.gapi||!window.gapi.client),drive:!(!window.gapi||!window.gapi.drive),realtime:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime),load:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime&&v.default.isFunction(window.gapi.drive.realtime.load))}}},{key:"getAppStats",value:function(e){var t=window;if(e.numPanes=t.__TOTAL_PANES,e.numItems=v.default.totalItems,e.numArchivedItems=v.default.totalArchivedItems,e.numArchiveParents=v.default.totalArchivedParents,e.parseTextCalls=t.__PARSE_STATS,e.notificationUpdatesFull=v.default.__FULL_NOTIFICATION_UPDATES,e.notificationUpdatesSingle=v.default.__SINGLE_NOTIFICATION_UPDATES,e.XHRStats=v.default.getXHRStats(),m.default.pluginManager){try{e.pluginStats=m.default.pluginManager.getStats()}catch(a){e.pluginStats="Error: "+a.message}try{e.pluginState=m.default.pluginManager.getState()}catch(a){e.pluginState="Error: "+a.message}}if(m.default.recurringTaskManager)try{e.taskStats=m.default.recurringTaskManager.getStats()}catch(a){e.taskStats="Error: "+a.message}g.a.DETAILED_STATS}}]),a}(function(){function e(){r()(this,e)}return o()(e,[{key:"getAppInfo",value:function(e){var t=v.default.getToolbox(),a=Date.now();e.user={name:t.settings.displayName.get(),email:t.settings.activeUser.get()},e.sessionStart=v.default.SESSION_BEGIN,e.reportTime=a,e.runningTime=a-v.default.SESSION_BEGIN,k.a.getPlatformInfo(e),e.jsVersion=g.a.jsVersion}}]),e}());t.default=new b},function(e,t,a){"use strict";a.r(t);var n=a(7),r=a.n(n),i=a(8),o=a.n(i),s=a(60),l=a.n(s),u=a(24),c=a.n(u),d=a(20),h=a.n(d),f=a(21),p=a.n(f),g=a(13),m=a.n(g),v=a(2),y=a(0),k=a(9),_=a(6),b=a(145),w=a(4),S=a(26),D=a(27),P=a(15),I=a(42),E=function(){function e(){r()(this,e),this.activePane=void 0,this.startPane=void 0,this.previousEventTarget=void 0,this.previousDropTarget=void 0,this.previousHighlightElement=void 0,this.previousAbove=void 0,this.dataTransfer=void 0,this.startInfo=void 0,this.startDragItem=void 0,this.externalData=void 0,this.isDragging=!1,this.isDraggingDelayed=!1,this.dragItem=void 0,this.draggingObjects=new I.a,this.position=void 0,this.transform=new P.a({left:0,top:0}),this.isExternalDrag=new P.a(!1),this.linePosition=new P.a,this.isDraggingPane=new P.a(!1),this.draggingToOutline=new P.a,this.dragTargetHovered=new P.a,S.a.binder(this,"handleEscapeKey")}return o()(e,[{key:"stop",value:function(){var e=0,t=this;this.__hotkeyEscape&&(w.default.hotkeys.popStack(this.__hotkeyEscape),this.__hotkeyEscape=void 0);for(var a=this.draggingObjects.get(),n=function(e){return e.draggedInPane.set(void 0)},r=0;r<a.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a[r].item.forEachChildRecursive(n,!0,!0)}this.draggingObjects.clear(),this.isExternalDrag.set(!1),this.isDragging=!1,requestAnimationFrame((function(){return t.isDraggingDelayed=!1})),this.dragItem=void 0,this.position=void 0,this.externalData=void 0}},{key:"finish",value:function(){this.blockTarget=void 0,D.a.fireEvent("endDrag",[])}},{key:"start",value:function(e,t,a,n,r,i,o,s){var l=0;this.isDragging&&(this.stop(),this.finish()),this.__hotkeyEscape=w.default.hotkeys.pushStackEscape(this.handleEscapeKey),this.isDragging=!0,this.isDraggingDelayed=!0,this.activePane=r,this.dragInfo=null,this.startPane=r,this.startInfo=i,this.dataTransfer=o,this.dragItem=e,this.startDragitem=e,this.fromOverview=s,this.externalData=void 0,this.position={left:a,top:n},this.transform.set({left:0,top:0}),this.draggingObjects.set(t),_.a.reset();for(var u=function(e){return e.draggedInPane.set(y.default.focusedPane)},c=0;c<t.length;++c){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;t[c].item.forEachChildRecursive(u,!0,!0)}}},{key:"startExternal",value:function(e){this.isDragging=!0,this.isDraggingDelayed=!0,this.activePane=e,this.startPane=e,this.draggingObjects.clear(),this.isExternalDrag.set(!0)}},{key:"setExternalData",value:function(e){this.externalData=e}},{key:"setTransform",value:function(e,t){this.transform.set({left:e,top:t})}},{key:"handleDragOver",value:function(e){var t=e.item,a=e.dataTransfer,n=e.clientX,r=e.clientY,i=y.default.elementFromPoint(n,r),o=y.default.getPaneForElement(i);if(this.activePane&&o!==this.activePane&&this.revertDrag(),y.default.vmMain.checkDragForScroll({clientX:n}),o){this.isDragging||this.startExternal(o),this.activePane=o;var s=!!y.default.findParent(i,"paneOverviewScroller");o.canAcceptDragOver(a.pane,i,s,t)?this.dragInfo=o.handleDragOver(a.pane,i,n,r,t):this.revertDrag()}return this.linePosition.set(this.dragInfo&&this.dragInfo.linePosition),this.dragInfo&&this.dragInfo.targetElement||y.default.cancelRepeatScroll("pane"),!1}},{key:"revertDrag",value:function(){this.dragInfo=null,this.activePane.revertDrag(),y.default.cancelRepeatScroll("pane")}},{key:"handleDropItems",value:function(e,t,a){var n,r=t.dataTransfer,i=t.altKey,o=t.ctrlKey,s=this.activePane;return this.isDropping=!0,y.default.cancelRepeatScrolls(),this.dragInfo&&s&&(w.default.PaneUpdateBatcher.beginUpdateItems(),this.startInfo&&0===this.startInfo.items[0].index&&this.startPane.setIgnoreRestoreScroll(),s.handleDragDrop(e,{dataTransfer:r,altKey:i,ctrlKey:o},this.dragInfo,a),w.default.PaneUpdateBatcher.commitUpdateItems(),n=e),this.isDropping=!1,n}},{key:"handleDrop",value:function(e){var t=this,a=e.target,n=e.dataTransfer,r=e.fromDropBucket,i=e.ctrlKey,o=e.altKey,s=e.clipboardData,l=this.activePane;if(l&&(y.default.elementInPane(a)||r)){var u=n.itemsDragging;if(this.isDragging=!1,requestAnimationFrame((function(){return t.isDraggingDelayed=!1})),u)return this.handleDropItems(u,{dataTransfer:n,ctrlKey:i,altKey:o}),!0;w.default.pluginManager.handleDropEvent({target:a,clipboardData:s,dataTransfer:n},(function(e,a){var r=l.createVMLI({text:e},{changeType:v.a.ChangeType.AllLocal,noParentOkay:!0});return!!(r=t.handleDropItems([r],{ctrlKey:i,altKey:o,dataTransfer:n},a))}))}this.stop(),y.default.cancelRepeatScrolls()}},{key:"handleDragLeave",value:function(e){e.clientX||e.clientY||(this.isDragging=!1,this.isDraggingDelayed=!1)}},{key:"setBlockTarget",value:function(e){this.blockTarget=e}},{key:"stopDraggingToOutline",value:function(){this.draggingToOutline.get();this.dragTargetHovered.set(void 0),this.draggingToOutline.set(void 0)}},{key:"handleEscapeKey",value:function(){this.escapedDragging=!0,this.dragItem.dragEnd(),this.revertDrag()}}]),e}(),C=a(54),x=a(32);function A(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=m()(e);if(t){var r=m()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return p()(this,a)}}var T=function(e){h()(a,e);var t=A(a);function a(){var e;return r()(this,a),(e=t.call(this)).dragging=new P.a,e.draggingPosition=new P.a,e.dropSucceeded=new P.a,window.addEventListener("dragover",e.handleDragOver.bind(l()(e))),window.addEventListener("dragleave",e.handleDragLeave.bind(l()(e))),window.addEventListener("drop",e.handleDropExternal.bind(l()(e))),e}return o()(a,[{key:"handleDropExternal",value:function(e){if(y.default.preventAndStop(e),!c()(m()(a.prototype),"handleDrop",this).call(this,e)){var t,n,r=this.activePane,i=null===(t=e.dataTransfer)||void 0===t?void 0:t.getData("text/html"),o=null===(n=e.dataTransfer)||void 0===n?void 0:n.getData(k.a.ie?"Text":"text/plain");if(i||o){_.a.setFocusedPane(r);var s=r.createVMLI({text:""},{changeType:v.a.ChangeType.AllLocal,noParentOkay:!0});return this.handleDropItems([s],e,!0),requestAnimationFrame((function(){_.a.selectItem(s,0);b.a.insert({getData:function(e){return"text/html"===e&&i||"text/plain"===e&&o||void 0}},e,v.a.DataSource.Drop)})),!0}if(this.externalData){var l=this.externalData;this.externalData=void 0;var u=l.split(":"),d=(u.removeAt(0),"["+u.removeAt(0)+"]("+u.join(":")+")"),h=r.createVMLI({text:d},{changeType:v.a.ChangeType.AllLocal,noParentOkay:!0});return h=this.handleDropItems([h],e,!0),!0}}}},{key:"checkDragMoveNew",value:function(e,t){var a;return C.a.beginBatch(),!this.dragging.get()&&y.default.distance(t.distanceX,t.distanceY)>1&&(this.dragging.set(e),a=!0),this.dragging.get()&&(this.draggingPosition.set({x:t.clientX,y:t.clientY}),this.handleDragOverNew(t)),C.a.endBatch(),a}},{key:"checkDragEndNew",value:function(e,t){var a,n=this,r=y.default.elementFromPoint(e.clientX,e.clientY),i=y.default.findParent(r,"fab"),o=y.default.findParent(r,"fancySheet");!i&&!o&&this.dragInfo&&this.dragging.get()&&e.clientY<k.a.windowSize.get().height-v.a.Mobile.BottomBarHeight&&(a=this.handleDragDropNew(e)),this.dropSucceeded.set(a);var s=function(){C.a.beginBatch(),n.dragInfo=void 0,n.dragging.set(void 0),n.draggingPosition.set(void 0),n.linePosition.set(void 0),a&&t&&t(),y.default.cancelRepeatScroll("pane"),C.a.endBatch()};a?requestAnimationFrame(s):s()}},{key:"checkDragStartNew",value:function(e,t,a){var n=this;x.c.onTouchMoveEnd({ev:e,onMove:function(e){n.checkDragMoveNew(t,e)},onUp:function(e,t){n.checkDragEndNew(e,a),_.a.disableMouseDown(300)}})}},{key:"cancelDragScoll",value:function(){y.default.cancelRepeatScroll("pane"),this.linePosition.set(void 0)}},{key:"handleDragOverNew",value:function(e){var t=e.clientX,a=e.clientY;y.default.vmMain.checkDragForScroll({clientX:t});var n=y.default.elementFromPoint(t,a),r=y.default.getPaneForElement(n),i=this.dragging.get().pane;if(r)if(y.default.findParent(n,"fab")||y.default.findParent(n,"fancySheet"))this.cancelDragScoll();else{var o=!!y.default.findParent(n,"paneOverviewScroller");r.canAcceptDragOver(i,n,o)?this.dragInfo=r.handleDragOver(i,n,t,a):this.dragInfo=void 0,this.linePosition.set(this.dragInfo&&this.dragInfo.linePosition)}else this.cancelDragScoll()}},{key:"handleDragDropNew",value:function(e){var t=this.dragging.get().pane,a=this.dragInfo.targetPane,n=t.createVMLIsToDrop(this.dragging.get(),this.dragInfo);if(n){var r={ctrlKey:e.ctrlKey,altKey:e.altKey,dataTransfer:{pane:t,dropEffect:t.dropEffect(n[0])}};return a.handleDragDrop(n,r,this.dragInfo,"PaneGmail"!==t.type)}return a.revertDrag(),!1}}]),a}(E);t.default=T},,,,,,,,,,function(e,t,a){"use strict";a.r(t);a(279);var n,r=a(2),i=a(0),o=a(9),s=a(3),l=a.n(s),u=a(97),c=a.n(u),d=a(4),h=(a(26),a(7)),f=a.n(h),p=a(8),g=a.n(p),m=a(10),v=a.n(m),y=a(11),k=a(23),_=(a(6),a(145)),b=a(27),w=a(15),S=a(73),D=(n=function(){function e(){f()(this,e),this.isLoaded=!1,this.isRendered=new w.a(!1),this.isInit=!1,this.help=void 0,this.failedInitialDocLoad=new w.a(!1),this.loadedImages={},i.default.vmMain=this,Rollbar.configure({payload:{environment:o.a.getDeployVar(r.a.DeployVariable.Environment),person:{id:d.default.settings.getUserIdentifier()},client:{javascript:{source_map_enabled:!0,code_version:r.a.jsVersion,guess_uncaught_frames:!0}}},maxItems:r.a.__MAX_ERRORS_REPORTED,checkIgnore:i.default.rollbarIgnoreFn}),i.default.element("outerWrapper").addEventListener("mousemove",this.mousemove),i.default.isDemoMode()||(this.setupPageVisibility(),i.default.checkLowActivity()),d.default.PaneManager.onResize(),this.checkLastCodeVersion(),this.init()}return g()(e,[{key:"loadPlugins",value:function(){}},{key:"init",value:function(){try{i.default.PAssert(2,!this.isInit,"Should never double init VMMain, may cause severe issues")}catch(e){i.default.reportError(e)}this.isInit=!0,_.a.init(),S.a.init(),this.loadPlugins(),d.default.intro.init(),b.a.fireEvent("VMMainLoaded",[]),o.a.demo||(window.onbeforeunload=this.onUnload),o.a.demo&&i.default.enableMinMode(),a(303).default()}},{key:"loadData",value:function(){if(i.default.shouldLog(r.a.LogLevels.Timing))var e=performance.now();i.default.shouldLog(r.a.LogLevels.Profile)&&console.profile("Load Local Data"),i.default.checkpoint(r.a.Checkpoint.LocalDocLoad),i.default.shouldLog(r.a.LogLevels.Profile)&&console.profileEnd(),i.default.isLoaded=!0,i.default.isDemoMode()&&setTimeout((function(){window.parent.postMessage("loaded","*")}),0),this.afterLoaded(),i.default.shouldLog(r.a.LogLevels.Profile)&&console.profile("Apply Bindings"),this.isRendered.set(!0),i.default.shouldLog(r.a.LogLevels.Profile)&&console.profileEnd(),o.a.app&&d.default.nativeBridge.sendToApp("localLoaded"),i.default.shouldLog(r.a.LogLevels.Timing)&&(i.default.log("DONE LOCALLY",performance.now()),setTimeout((function(){var t=performance.now();i.default.log("time react:",t-e,t)}),0))}},{key:"afterLoaded",value:function(){o.a.app&&(document.onreadystatechange=function(){d.default.nativeBridge.sendToApp("loaded")},document.onreadystatechange())}},{key:"redoLastMouseMove",value:function(){var e=this.prevMove,t={target:document.elementFromPoint(e.clientX,e.clientY),clientX:e.clientX,clientY:e.clientY};this.mousemove(t,!0)}},{key:"mousemove",value:function(e,t){if(i.default.notifyActivity(),!(i.default.disableMouseMove&&!e.target||d.default.PaneManager.isResizingPane||!t&&this.prevMove&&e.clientX===this.prevMove.clientX&&e.clientY===this.prevMove.clientY||d.default.DragDrop.isDragging)){var a=i.default.ensureDOMNode(e.target);if(a)this.prevMove&&this.prevMove.target===a||(this.prevMove&&this.prevMove.target&&b.a.fireEvent("mouseout",[{target:this.prevMove.target}]),a&&b.a.fireEvent("mouseover",[{clientX:e.clientX,clientY:e.clientY,target:a}])),this.prevMove={clientX:e.clientX,clientY:e.clientY,target:a};else try{i.default.PAssert(3,!a,"Target should be defined",i.default.getElementPath(e.target))}catch(n){i.default.reportError(n)}}}},{key:"setupPageVisibility",value:function(){var e=this;o.a.pageVisibilityChange&&document.addEventListener(o.a.pageVisibilityChange,(function(){o.a.isPageVisible()?(e.updateTimeout&&(clearTimeout(e.updateTimeout),e.updateTimeout=void 0),i.default.whenLowImpactEnd()):e.updateTimeout=setTimeout((function(){i.default.whenLowImpactBegin()}),5e3)}))}},{key:"checkLastCodeVersion",value:function(){if(i.default.shouldWriteLocal()){var e="versionDesktop",t=+k.a.getValue("versionDesktop"),a=o.a.versionCurrent;if(isNaN(t)&&(t=+k.a.getLegacyLocalStorage(e),isNaN(t)||(k.a.deleteLegacyLocalStorage(e),k.a.setValue(e,a))),!i.default.isDemoMode()&&t>0&&a>t)for(var n=0,r=o.a.getUpdateMessages(t),s=0;s<r.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=r[s];i.default.isString(l)&&d.default.toasts.pushUpdateMessage({text:l,action1Text:"BLOG",action1Click:function(){return d.default.openUrl("https://www.moo.do/blog/updates")}})}t!==a&&k.a.setValue(e,a)}}},{key:"getScrollOffset",value:function(){return this.panesContainer.scrollLeft}},{key:"setScrollOffset",value:function(e,t){i.default.scrollTo(e,0,t,this.panesContainer)}},{key:"onUnload",value:function(){i.default.log("Unloading the page");try{var e=i.default.getAggregateEvents();for(var t in e)if(e.hasOwnProperty(t)){var a=e[t];i.default.sendEvent(a.category,a.action,a.count),a.count=0}if(b.a.fireEvent("onUnload",[]),!d.default.setup.isLoggingOut.get())i.default.hasPageDataBeenCleared()?d.default.pluginManager&&d.default.pluginManager.onShutdown():self&&d.default.pluginManager&&d.default.pluginManager.onShutdown(),i.default.UIAction("PageUnload")}catch(n){i.default.reportError(n)}}},{key:"checkDragForScroll",value:function(e){var t=e.clientX,a=document.getElementById("panes");if(a){var n=a.scrollLeft,r=a.clientWidth,o=r-80,s=0;t<80&&n>0?s=i.default.computeScrollSpeed(0,80,t,4,-1):t>=o&&n<a.scrollWidth-a.clientWidth&&(s=i.default.computeScrollSpeed(o,r,t,4)),0!==s?i.default.repeatScroll("panes",s,void 0,!0):i.default.cancelRepeatScroll("panes")}}}]),e}(),v()(n.prototype,"mousemove",[y.a],Object.getOwnPropertyDescriptor(n.prototype,"mousemove"),n.prototype),v()(n.prototype,"onUnload",[y.a],Object.getOwnPropertyDescriptor(n.prototype,"onUnload"),n.prototype),n),P=a(18),I=a(35),E=a(80),C=a(297).default,x=(t.default=function(){E.a.ensurePolyfill(void 0,x)},function(){try{if(!o.a.blockedReason.get()){var e=function(){o.a.updateOrientation()};i.default.checkpoint(r.a.Checkpoint.RequireLoaded),i.default.isDemoMode()||I.a.init(),d.default.init(),P.a.init(),window.__ERRORINMAINHEADER&&i.default.reportError(window.__ERRORINMAINHEADER);try{i.default.PAssert(0,-1===navigator.userAgent.indexOf("Electron")||o.a.appPlatform===r.a.AppPlatform.Electron,"Electron app missing app platform set")}catch(s){i.default.reportError(s)}i.default.checkpoint(r.a.Checkpoint.PageLoad);try{i.default.PAssert(1,"loading"!==document.readyState,"Should only be calling mainjs after document is loaded"+document.readyState)}catch(s){i.default.reportError(s)}if("loading"===document.readyState){var t="ERROR: MainJS running before document load! "+document.readyState;i.default.shouldLog(r.a.LogLevels.Error)&&i.default.log(t),i.default.reportError(new Error(t))}0,i.default.isDemoMode()||o.a.offline||(!function(e,t,a,n,r,i,o){e.GoogleAnalyticsObject=r,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,i=t.createElement(a),o=t.getElementsByTagName(a)[0],i.async=1,i.src="//www.google-analytics.com/analytics.js",o.parentNode.insertBefore(i,o)}(window,document,"script",0,"ga"),ga("create","UA-37740918-2",{cookieDomain:"auto"}),ga("send","pageview")),o.a.updateBodyClass();var a=function(e){document.documentElement.addEventListener(e,(function(e){i.default.reportEvent(e)}),!0)};0,a("keydown"),a("keyup"),a("keypress"),a("MSPointerDown"),a("MSPointerUp"),a("MSPointerHover"),a("MSPointerCancel"),a("mousedown"),a("mouseup"),a("touchstart"),a("touchend"),d.default.AppCache.init(),e(),i.default.shouldLog(r.a.LogLevels.Timing)&&i.default.log("Running main.js: ",Date.now()),window.onblur=function(){i.default.hasFocus=!1},window.onfocus=function(){i.default.hasFocus=!0},new D,window.addEventListener("orientationchange",e),window.addEventListener("dragstart",(function(e){return e.preventDefault(),!1})),window.addEventListener("dragover",(function(e){return e.preventDefault(),!1}));var n=!1;P.a.loadLocal((function(e){n||(n=!0,i.default.checkpoint(r.a.Checkpoint.InitializeMain),function(){try{i.default.checkpoint(r.a.Checkpoint.OnInitializedData),i.default.vmMain.loadData(),i.default.shouldLog(r.a.LogLevels.Timing)&&i.default.log("Data done loading: ",Date.now()),i.default.isDemoMode()||i.default.setupDateRollover()}catch(e){i.default.reportError(e)}}())})),!i.default.isDemoMode()&&o.a.app&&d.default.nativeBridge.sendToApp("loaded")}c.a.render(l.a.createElement(C,{main:i.default.vmMain}),document.getElementById("outerWrapper"))}catch(u){console.log(u),i.default.handleCriticalError(),i.default.reportError(u,"Critical Error")}})},function(e,t,a){"use strict";a.r(t);var n=a(16),r=a.n(n),i=a(28),o=a(2),s=a(0),l=a(3),u=a.n(l),c=a(17),d=a(22),h=a(6),f=a(57),p=a(4),g=[];document.addEventListener("touchmove",(function(e){if(p.default.DragDrop.dragging.get()){var t=e.touches[0],a=t.clientX,n=t.clientY,r=document.elementFromPoint(a,n),i=r&&g.find((function(e){return s.default.isAncestor(r,e.el)}));g.forEach((function(e){var t=e===i;e.isHovered!==t&&(e.isHovered=t,e.setHovered(t))}))}})),document.addEventListener("touchend",(function(){p.default.DragDrop.dragging.get()&&g.forEach((function(e){var t;e.isHovered&&(e.setHovered(!1),null===(t=e.onUp)||void 0===t||t.call(e))}))}),{capture:!0});t.default=Object(c.b)((function(e){var t=e.role,a=e.text,n=e.onPress,c=e.onUp;Object(d.a)(h.a.selectedMapObs);var p=h.a.isInMobileMultiselect(),k=function(e){var t=Object(l.useState)(!1),a=r()(t,2),n=a[0],i=a[1],o=Object(l.useRef)(null);return Object(l.useEffect)((function(){var t=o.current;if(t){var a={el:t,setHovered:i,onUp:e};return g.push(a),function(){g.remove(a)}}}),[o.current]),[o,n]}(c),_=r()(k,2),b=_[0],w=_[1],S="add"===t?"MdAdd":"MdContentPaste",D="add"===t?v:y,P={scale:"add"!==t?w?1.2:1:void 0};return!("add"===t&&p)&&u.a.createElement(i.b.div,{className:"absolute fab",ref:b,style:D,animate:P,transition:o.a.TransitionSpring},u.a.createElement(f.a,{icon:S,iconSize:24,className:s.default.classNames("flex items-center justify-center rounded-full fab c-button-raised-primary c-shadow-popup",t),onPress:n,style:m,text:a}))}));var m={minWidth:56,height:56},v={right:16,bottom:16},y={left:16,bottom:16+o.a.Mobile.BottomBarHeight}},,,,,,,,,,function(e,t,a){"use strict";a.r(t);a(184);var n=a(23),r=a(9);function i(){document.removeEventListener("DOMContentLoaded",i,!1),window.removeEventListener("load",i,!1),r.a.demo?a(172).default():n.a.preload((function(){a(172).default()}))}window.__isLoaded=!0,Date.Config={__DEV__:!0,DisableCache:!0},"complete"===document.readyState||"interactive"===document.readyState?i():(document.addEventListener("DOMContentLoaded",i,!1),window.addEventListener("load",i,!1))},function(e,t,a){"http:"===window.location.protocol&&(window.location.hash.indexOf("state=")<0||window.location.hash.indexOf("app")<0&&window.location.hash.indexOf("appv")<0)&&(window.location=window.location.href.replace(/^http:/,"https:"));try{window.__checkpoints|=1,window.__SESSION_ID=Math.round(1e4*Math.random())+"|"+Date.now(),window.console||(window.console={log:function(){},error:function(){}});window.log=window.console.log.bind(window.console),window.__log=window.console.log.bind(window.console),window.__warn=window.console.warn.bind(window.console),window.__error=window.console.error.bind(window.console),window.performance&&window.performance.now?(window.log.start=window.performance.now(),window.log.now=function(){return window.performance.now()-window.log.start}):(window.log.start=Date.now(),window.performance={now:function(){return Date.now()-window.log.start}},window.log.now=window.performance.now),window.console.timeStamp||(Object.defineProperty?Object.defineProperty(window.console,"timeStamp",{value:function(){}}):window.console.timeStamp=function(){}),window.console.time||(Object.defineProperty?Object.defineProperty(console,"time",{value:function(){}}):window.console.time=function(){}),window.console.timeEnd||(Object.defineProperty?Object.defineProperty(window.console,"timeEnd",{value:function(){}}):window.console.timeEnd=function(){}),window.console.trace||(Object.defineProperty?Object.defineProperty(window.console,"trace",{value:function(){}}):window.console.trace=function(){})}catch(n){console.log("Error in main header",n),window.__ERRORINMAINHEADER=n}},,,,,,,,,,,,,function(e,a,n){!function(){var e=Date,t=Date.CultureStrings?Date.CultureStrings.lang:null,a={},n={getFromKey:function(e,t){var a;return a=Date.CultureStrings&&Date.CultureStrings[t]&&Date.CultureStrings[t][e]?Date.CultureStrings[t][e]:n.buildFromDefault(e),"/"===e.charAt(0)&&(a=n.buildFromRegex(e,t)),a},getFromObjectValues:function(e,t){var a,r={};for(a in e)e.hasOwnProperty(a)&&(r[a]=n.getFromKey(e[a],t));return r},getFromObjectKeys:function(e,t){var a,r={};for(a in e)e.hasOwnProperty(a)&&(r[n.getFromKey(a,t)]=e[a]);return r},getFromArray:function(e,t){for(var a=[],r=0;r<e.length;r++)r in e&&(a[r]=n.getFromKey(e[r],t));return a},buildFromDefault:function(e){var t,a,n,r;switch(e){case"name":t="en-US";break;case"englishName":case"nativeName":t="English (United States)";break;case"twoDigitYearMax":t=2049;break;case"firstDayOfWeek":t=0;break;default:t=e,(a=(n=e.split("_")).length)>1&&"/"!==e.charAt(0)&&("initial"!==(r=n[a-1].toLowerCase())&&"abbr"!==r||(t=n[0]))}return t},buildFromRegex:function(e,t){return Date.CultureStrings&&Date.CultureStrings[t]&&Date.CultureStrings[t][e]?new RegExp(Date.CultureStrings[t][e],"i"):new RegExp(e.replace(new RegExp("/","g"),""),"i")}},r=function(e,r){var i=r||t;return a[e]=e,"object"===typeof e?e instanceof Array?n.getFromArray(e,i):n.getFromObjectKeys(e,i):n.getFromKey(e,i)},i={buildFromMethodHash:function(e){var t;for(t in e)e.hasOwnProperty(t)&&(e[t]=i[e[t]]());return e},timeZoneDST:function(){return r({CHADT:"+1345",NZDT:"+1300",AEDT:"+1100",ACDT:"+1030",AZST:"+0500",IRDT:"+0430",EEST:"+0300",CEST:"+0200",BST:"+0100",PMDT:"-0200",ADT:"-0300",NDT:"-0230",EDT:"-0400",CDT:"-0500",MDT:"-0600",PDT:"-0700",AKDT:"-0800",HADT:"-0900"})},timeZoneStandard:function(){return r({LINT:"+1400",TOT:"+1300",CHAST:"+1245",NZST:"+1200",NFT:"+1130",SBT:"+1100",AEST:"+1000",ACST:"+0930",JST:"+0900",CWST:"+0845",CT:"+0800",ICT:"+0700",MMT:"+0630",BST:"+0600",NPT:"+0545",IST:"+0530",PKT:"+0500",AFT:"+0430",MSK:"+0400",IRST:"+0330",FET:"+0300",EET:"+0200",CET:"+0100",GMT:"+0000",UTC:"+0000",CVT:"-0100",GST:"-0200",BRT:"-0300",NST:"-0330",AST:"-0400",EST:"-0500",CST:"-0600",MST:"-0700",PST:"-0800",AKST:"-0900",MIT:"-0930",HST:"-1000",SST:"-1100",BIT:"-1200"})},timeZones:function(e){var t;for(t in e.timezones=[],e.abbreviatedTimeZoneStandard)e.abbreviatedTimeZoneStandard.hasOwnProperty(t)&&e.timezones.push({name:t,offset:e.abbreviatedTimeZoneStandard[t]});for(t in e.abbreviatedTimeZoneDST)e.abbreviatedTimeZoneDST.hasOwnProperty(t)&&e.timezones.push({name:t,offset:e.abbreviatedTimeZoneDST[t],dst:!0});return e.timezones},days:function(){return r(["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"])},dayAbbr:function(){return r(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"])},dayShortNames:function(){return r(["Su","Mo","Tu","We","Th","Fr","Sa"])},dayFirstLetters:function(){return r(["S_Sun_Initial","M_Mon_Initial","T_Tues_Initial","W_Wed_Initial","T_Thu_Initial","F_Fri_Initial","S_Sat_Initial"])},months:function(){return r(["January","February","March","April","May","June","July","August","September","October","November","December"])},monthAbbr:function(){return r(["Jan_Abbr","Feb_Abbr","Mar_Abbr","Apr_Abbr","May_Abbr","Jun_Abbr","Jul_Abbr","Aug_Abbr","Sep_Abbr","Oct_Abbr","Nov_Abbr","Dec_Abbr"])},formatPatterns:function(){return n.getFromObjectValues({shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss",monthDay:"MMMM dd",monthDayShortTime:"MM/dd",monthDayYear:"MM/dd/yy",yearMonth:"MMMM, yyyy"},Date.i18n.currentLanguage())},regex:function(){return n.getFromObjectValues({thisMorning:"/(this )(morn(ing)?)\\b/",thisEvening:"/(this )(even(ing)?)\\b/",jan:"/jan(uary)?/",feb:"/feb(ruary)?/",mar:"/mar(ch)?/",apr:"/apr(il)?/",may:"/may/",jun:"/jun(e)?/",jul:"/jul(y)?/",aug:"/aug(ust)?/",sep:"/sep(t(ember)?)?/",oct:"/oct(ober)?/",nov:"/nov(ember)?/",dec:"/dec(ember)?/",sun:"/^sun(day)?/",mon:"/^mon(day)?/",tue:"/^tue(s(day)?)?/",wed:"/^wed(nesday)?/",thu:"/^thu(rsday)?/",fri:"/^fri(day)?/",sat:"/^sat(urday)?/",future:"/^next/",past:"/^last|past|prev(ious)?/",yesterday:"/^yesterday/",today:"/^today/",tomorrow:"/^tom(orrow)?/",soon:"/^soon/",later:"/^later/",someday:"/^someday/",now:"/^now/",shortMeridian:"/^(a|p)/",longMeridian:"/^(a\\.?m?\\.?|p\\.?m?\\.?)/",timezone:"/^((e(s|d)t|c(e?s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\\s*(\\+|\\-)\\s*\\d\\d\\d\\d?)|gmt|utc)/",ordinalSuffix:"/^\\s*(st|nd|rd|th)/",timeContext:"/^\\s*(\\:|a(?!u|p)|p)/"},Date.i18n.currentLanguage())}},o=function(){var e=n.getFromObjectValues({name:"name",englishName:"englishName",nativeName:"nativeName",amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:"firstDayOfWeek",twoDigitYearMax:"twoDigitYearMax",dateElementOrder:"mdy"},Date.i18n.currentLanguage());return function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])}(e,i.buildFromMethodHash({dayNames:"days",abbreviatedDayNames:"dayAbbr",shortestDayNames:"dayShortNames",firstLetterDayNames:"dayFirstLetters",monthNames:"months",abbreviatedMonthNames:"monthAbbr",formatPatterns:"formatPatterns",regexPatterns:"regex",abbreviatedTimeZoneDST:"timeZoneDST",abbreviatedTimeZoneStandard:"timeZoneStandard"})),i.timeZones(e),e};e.i18n={__:function(e,t){return r(e,t)},currentLanguage:function(){return t||"en-US"},setLanguage:function(a,n,r){if(n||"en-US"===a||Date.CultureStrings&&Date.CultureStrings[a])t=a,Date.CultureStrings=Date.CultureStrings||{},Date.CultureStrings.lang=a,Date.CultureInfo=new o;else if(!Date.CultureStrings||!Date.CultureStrings[a])return!1;e.Parsing.Normalizer.buildReplaceData(),e.Grammar&&e.Grammar.buildGrammarFormats(),r&&r()},getLoggedKeys:function(){return a},updateCultureInfo:function(){Date.CultureInfo=new o}},e.i18n.updateCultureInfo()}(),function(){var e=Date,t=e.prototype,a=function(e,t){return t||(t=2),("000"+e).slice(-1*t)};"undefined"!==typeof window&&"undefined"!==typeof window.console&&"undefined"!==typeof window.console.log?e.console=console:e.console={log:function(){},error:function(){}},e.Config=e.Config||{},e.initOverloads=function(){e.now?e._now||(e._now=e.now):e._now=function(){return(new Date).getTime()},e.now=function(t){return t?e.present():e._now()},t.toISOString||(t.toISOString=function(){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}),void 0===t._toString&&(t._toString=t.toString)},e.initOverloads(),e.today=function(){return(new Date).clearTime()},e.present=function(){return new Date},e.compare=function(e,t){if(isNaN(e)||isNaN(t))throw new Error(e+" - "+t);if(e instanceof Date&&t instanceof Date)return e<t?-1:e>t?1:0;throw new TypeError(e+" - "+t)},e.equals=function(e,t){return 0===e.compareTo(t)},e.getDayName=function(e){return Date.CultureInfo.dayNames[e]},e.getDayNumberFromName=function(e){for(var t=Date.CultureInfo.dayNames,a=Date.CultureInfo.abbreviatedDayNames,n=Date.CultureInfo.shortestDayNames,r=e.toLowerCase(),i=0;i<t.length;i++)if(t[i].toLowerCase()===r||a[i].toLowerCase()===r||n[i].toLowerCase()===r)return i;return-1},e.getMonthNumberFromName=function(e){for(var t=Date.CultureInfo.monthNames,a=Date.CultureInfo.abbreviatedMonthNames,n=e.toLowerCase(),r=0;r<t.length;r++)if(t[r].toLowerCase()===n||a[r].toLowerCase()===n)return r;return-1},e.getMonthName=function(e){return Date.CultureInfo.monthNames[e]},e.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0},e.getDaysInMonth=function(t,a){return!a&&e.validateMonth(t)&&(a=t,t=Date.today().getFullYear()),[31,e.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][a]},t.getDaysInMonth=function(){return e.getDaysInMonth(this.getFullYear(),this.getMonth())},e.getTimezoneAbbreviation=function(e,t){var a,n=t?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard;for(a in n)if(n.hasOwnProperty(a)&&n[a]===e)return a;return null},e.getTimezoneOffset=function(e,t){var a,n=[],r=Date.CultureInfo.timezones;for(e||(e=(new Date).getTimezone()),a=0;a<r.length;a++)r[a].name===e.toUpperCase()&&n.push(a);if(!r[n[0]])return null;if(1===n.length||!t)return r[n[0]].offset;for(a=0;a<n.length;a++)if(r[n[a]].dst)return r[n[a]].offset},e.getQuarter=function(e){e=e||new Date;return[1,2,3,4][Math.floor(e.getMonth()/3)]},e.getDaysLeftInQuarter=function(e){e=e||new Date;var t=new Date(e);return t.setMonth(t.getMonth()+3-t.getMonth()%3,0),Math.floor((t-e)/864e5)},t.ensureTimeOfDay=function(){0===this.getMilliseconds()&&this.setTime(this.getTime()+1)};var n=function(e,t,a,n){if(n=n||"Object","undefined"===typeof e)return!1;if("number"!==typeof e)throw new TypeError(e+" is not a Number.");return!(e<t||e>a)};e.validateMillisecond=function(e){return n(e,0,999,"millisecond")},e.validateSecond=function(e){return n(e,0,59,"second")},e.validateMinute=function(e){return n(e,0,59,"minute")},e.validateHour=function(e){return n(e,0,23,"hour")},e.validateDay=function(t,a,r){return void 0!==a&&null!==a&&void 0!==r&&null!==r&&n(t,1,e.getDaysInMonth(a,r),"day")},e.validateWeek=function(e){return n(e,0,53,"week")},e.validateMonth=function(e){return n(e,0,11,"month")},e.validateYear=function(e){return n(e,-271822,275760,"year")},e.validateTimezone=function(e){return 1==={ACDT:1,ACST:1,ACT:1,ADT:1,AEDT:1,AEST:1,AFT:1,AKDT:1,AKST:1,AMST:1,AMT:1,ART:1,AST:1,AWDT:1,AWST:1,AZOST:1,AZT:1,BDT:1,BIOT:1,BIT:1,BOT:1,BRT:1,BST:1,BTT:1,CAT:1,CCT:1,CDT:1,CEDT:1,CEST:1,CET:1,CHADT:1,CHAST:1,CHOT:1,ChST:1,CHUT:1,CIST:1,CIT:1,CKT:1,CLST:1,CLT:1,COST:1,COT:1,CST:1,CT:1,CVT:1,CWST:1,CXT:1,DAVT:1,DDUT:1,DFT:1,EASST:1,EAST:1,EAT:1,ECT:1,EDT:1,EEDT:1,EEST:1,EET:1,EGST:1,EGT:1,EIT:1,EST:1,FET:1,FJT:1,FKST:1,FKT:1,FNT:1,GALT:1,GAMT:1,GET:1,GFT:1,GILT:1,GIT:1,GMT:1,GST:1,GYT:1,HADT:1,HAEC:1,HAST:1,HKT:1,HMT:1,HOVT:1,HST:1,ICT:1,IDT:1,IOT:1,IRDT:1,IRKT:1,IRST:1,IST:1,JST:1,KGT:1,KOST:1,KRAT:1,KST:1,LHST:1,LINT:1,MAGT:1,MART:1,MAWT:1,MDT:1,MET:1,MEST:1,MHT:1,MIST:1,MIT:1,MMT:1,MSK:1,MST:1,MUT:1,MVT:1,MYT:1,NCT:1,NDT:1,NFT:1,NPT:1,NST:1,NT:1,NUT:1,NZDT:1,NZST:1,OMST:1,ORAT:1,PDT:1,PET:1,PETT:1,PGT:1,PHOT:1,PHT:1,PKT:1,PMDT:1,PMST:1,PONT:1,PST:1,PYST:1,PYT:1,RET:1,ROTT:1,SAKT:1,SAMT:1,SAST:1,SBT:1,SCT:1,SGT:1,SLST:1,SRT:1,SST:1,SYOT:1,TAHT:1,THA:1,TFT:1,TJT:1,TKT:1,TLT:1,TMT:1,TOT:1,TVT:1,UCT:1,ULAT:1,UTC:1,UYST:1,UYT:1,UZT:1,VET:1,VLAT:1,VOLT:1,VOST:1,VUT:1,WAKT:1,WAST:1,WAT:1,WEDT:1,WEST:1,WET:1,WST:1,YAKT:1,YEKT:1,Z:1}[e]},e.validateTimezoneOffset=function(e){return e>-841&&e<721},e.validateSetExplicitTime=function(e){return!0}}(),function(){var e=Date,t=e.prototype,a=function(e,t){return t||(t=2),("000"+e).slice(-1*t)},n=function(t){var a,n,r={},i=this;for(a in n=function(a,n,r){if("day"===a){var o=void 0!==t.month?t.month:i.getMonth(),s=void 0!==t.year?t.year:i.getFullYear();return e[n](r,s,o)}return e[n](r)},t)if(hasOwnProperty.call(t,a)){var o="validate"+a.charAt(0).toUpperCase()+a.slice(1);e[o]&&null!==t[a]&&n(a,o,t[a])&&(r[a]=t[a])}return r};t.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},t.setTimeToNow=function(){var e=new Date;return this.setHours(e.getHours()),this.setMinutes(e.getMinutes()),this.setSeconds(e.getSeconds()),this.setMilliseconds(e.getMilliseconds()),this},t.clone=function(){return new Date(this.getTime())},t.compareTo=function(e){return Date.compare(this,e)},t.equals=function(e){if(!e)return!1;var t=this.clone(),a=e.clone();return t.setMilliseconds(0),a.setMilliseconds(0),Date.equals(t,a)},t.between=function(e,t){return this.getTime()>=e.getTime()&&this.getTime()<=t.getTime()},t.isAfter=function(e){return 1===this.compareTo(e||new Date)},t.isBefore=function(e){return-1===this.compareTo(e||new Date)},t.isToday=t.isSameDay=function(e){return this.clone().clearTime().equals((e||new Date).clone().clearTime())},t.addMilliseconds=function(e){return e?(this.setTime(this.getTime()+1*e),this):this},t.addSeconds=function(e){return e?this.addMilliseconds(1e3*e):this},t.addMinutes=function(e){return e?this.addMilliseconds(6e4*e):this},t.addHours=function(e){return e?this.addMilliseconds(36e5*e):this},t.addDays=function(e){return e?(this.setDate(this.getDate()+1*e),this):this},t.addWeekdays=function(e){if(!e)return this;var t=this.getDay(),a=Math.ceil(Math.abs(e)/7);if(0!==t&&6!==t||e>0&&(this.next().monday(),this.addDays(-1),t=this.getDay()),e<0){for(;e<0;)this.addDays(-1),0!==(t=this.getDay())&&6!==t&&e++;return this}return(e>5||6-t<=e)&&(e+=2*a),this.addDays(e)},t.addWeeks=function(e){return e?this.addDays(7*e):this},t.addMonths=function(t){if(!t)return this;var a=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+1*t),this.setDate(Math.min(a,e.getDaysInMonth(this.getFullYear(),this.getMonth()))),this},t.addQuarters=function(e){return e?this.addMonths(3*e):this},t.addYears=function(e){return e?this.addMonths(12*e):this},t.add=function(e){if("number"===typeof e)return this._orient=e,this;var t=e;return t.day&&t.day-this.getDate()!==0&&this.setDate(t.day),t.milliseconds&&this.addMilliseconds(t.milliseconds),t.seconds&&this.addSeconds(t.seconds),t.minutes&&this.addMinutes(t.minutes),t.hours&&this.addHours(t.hours),t.weeks&&this.addWeeks(t.weeks),t.months&&this.addMonths(t.months),t.years&&this.addYears(t.years),t.days&&this.addDays(t.days),t.setExplicitTime&&this.ensureTimeOfDay(),this},t.getWeek=function(e){var t,a=new Date(this.valueOf());e?(a.addMinutes(a.getTimezoneOffset()),t=a.clone()):t=this;var n=(t.getDay()+6)%7;a.setDate(a.getDate()-n+3);var r=a.valueOf();return a.setMonth(0,1),4!==a.getDay()&&a.setMonth(0,1+(4-a.getDay()+7)%7),1+Math.ceil((r-a)/6048e5)},t.getISOWeek=function(){return a(this.getWeek(!0))},t.setWeek=function(e){return e-this.getWeek()===0?1!==this.getDay()?this.moveToDayOfWeek(1,this.getDay()>1?-1:1):this:this.moveToDayOfWeek(1,this.getDay()>1?-1:1).addWeeks(e-this.getWeek())},t.setQuarter=function(e){var t=Math.abs(3*(e-1)+1);return this.setMonth(t,1)},t.getQuarter=function(){return Date.getQuarter(this)},t.getDaysLeftInQuarter=function(){return Date.getDaysLeftInQuarter(this)},t.moveToNthOccurrence=function(e,t){if("Weekday"===e){if(t>0)this.moveToFirstDayOfMonth(),this.is().weekday()&&(t-=1);else{if(!(t<0))return this;this.moveToLastDayOfMonth(),this.is().weekday()&&(t+=1)}return this.addWeekdays(t)}var a=0;if(t>0)a=t-1;else if(-1===t)return this.moveToLastDayOfMonth(),this.getDay()!==e&&this.moveToDayOfWeek(e,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(e,1).addWeeks(a)};var r=function(e,t,a){return function(n,r){var i=(n-this[e]()+a*(r||1))%a;return this[t](i)}};t.moveToDayOfWeek=r("getDay","addDays",7),t.moveToMonth=r("getMonth","addMonths",12),t.getOrdinate=function(){var e=this.getDate();return i(e)},t.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1},t.getTimezone=function(){return e.getTimezoneAbbreviation(this.getUTCOffset(),this.isDaylightSavingTime())},t.setTimezoneOffset=function(e){var t=this.getTimezoneOffset(),a=-6*Number(e)/10;return a||0===a?this.addMinutes(t-a):this},t.setTimezone=function(t){return this.setTimezoneOffset(e.getTimezoneOffset(t))},t.hasDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset()},t.isDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==this.getTimezoneOffset()},t.getUTCOffset=function(e){var t,a=-10*(e||this.getTimezoneOffset())/6;return a<0?(t=(a-1e4).toString()).charAt(0)+t.substr(2):"+"+(t=(a+1e4).toString()).substr(1)},t.getElapsed=function(e){return(e||new Date)-this},t.set=function(e){var t;for(t in e=n.call(this,e))if(hasOwnProperty.call(e,t)){var a,r,i=t.charAt(0).toUpperCase()+t.slice(1);"week"!==t&&"month"!==t&&"timezone"!==t&&"timezoneOffset"!==t&&(i+="s"),a="add"+i,r="get"+i,"month"===t?a+="s":"year"===t&&(r="getFullYear"),"day"!==t&&"timezone"!==t&&"timezoneOffset"!==t&&"week"!==t&&"hour"!==t&&"setExplicitTime"!==t?this[a](e[t]-this[r]()):"timezone"===t||"timezoneOffset"===t||"week"===t||"hour"===t?this["set"+i](e[t]):"setExplicitTime"===t&&this.ensureTimeOfDay()}return e.day&&this.addDays(e.day-this.getDate()),this},t.moveToFirstDayOfMonth=function(){return this.set({day:1})},t.moveToLastDayOfMonth=function(){return this.set({day:e.getDaysInMonth(this.getFullYear(),this.getMonth())})};var i=function(e){switch(1*e){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},o=function(e){var t=Date.CultureInfo.formatPatterns;switch(e){case"d":return this.toString(t.shortDate);case"D":return this.toString(t.longDate);case"F":return this.toString(t.fullDateTime);case"m":return this.toString(t.monthDay);case"r":case"R":return this.clone().addMinutes(this.getTimezoneOffset()).toString(t.rfc1123)+" GMT";case"s":return this.toString(t.sortableDateTime);case"t":return this.toString(t.shortTime);case"T":return this.toString(t.longTime);case"u":return this.clone().addMinutes(this.getTimezoneOffset()).toString(t.universalSortableDateTime);case"y":return this.toString(t.yearMonth);default:return!1}};t.toString=function(t,n){if(!n&&t&&1===t.length){var r=o.call(this,t);if(r)return r}var s,l=(s=this,function(t){if("\\"===t.charAt(0))return t.replace("\\","");switch(t){case"hh":return a(s.getHours()<13?0===s.getHours()?12:s.getHours():s.getHours()-12);case"h":return s.getHours()<13?0===s.getHours()?12:s.getHours():s.getHours()-12;case"HH":return a(s.getHours());case"H":return s.getHours();case"mm":return a(s.getMinutes());case"m":return s.getMinutes();case"ss":return a(s.getSeconds());case"s":return s.getSeconds();case"yyyy":return a(s.getFullYear(),4);case"yy":return a(s.getFullYear());case"y":return s.getFullYear();case"E":case"dddd":return Date.CultureInfo.dayNames[s.getDay()];case"ddd":return Date.CultureInfo.abbreviatedDayNames[s.getDay()];case"dd":return a(s.getDate());case"d":return s.getDate();case"MMMM":return Date.CultureInfo.monthNames[s.getMonth()];case"MMM":return Date.CultureInfo.abbreviatedMonthNames[s.getMonth()];case"MM":return a(s.getMonth()+1);case"M":return s.getMonth()+1;case"t":return s.getHours()<12?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case"tt":return s.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case"S":return i(s.getDate());case"W":return s.getWeek();case"WW":return s.getISOWeek();case"Q":return"Q"+s.getQuarter();case"q":return String(s.getQuarter());case"z":return s.getTimezone();case"Z":case"X":return Date.getTimezoneOffset(s.getTimezone());case"ZZ":return-60*s.getTimezoneOffset();case"u":return s.getDay();case"L":return e.isLeapYear(s.getFullYear())?1:0;case"B":return"@"+(s.getUTCSeconds()+60*s.getUTCMinutes()+3600*(s.getUTCHours()+1))/86.4;default:return t}});return t?t.replace(/((\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S|q|Q|WW?W?W?)(?![^\[]*\]))/g,l).replace(/\[|\]/g,""):this._toString()}}(),function(){var e=Date,t=e.prototype,a=Number.prototype;t._orient=1,t._nth=null,t._is=!1,t._same=!1,t._isSecond=!1,a._dateElement="days",t.next=function(){return this._move=!0,this._orient=1,this},e.next=function(){return e.today().next()},t.last=t.prev=t.previous=function(){return this._move=!0,this._orient=-1,this},e.last=e.prev=e.previous=function(){return e.today().last()},t.is=function(){return this._is=!0,this},t.same=function(){return this._same=!0,this._isSecond=!1,this},t.today=function(){return this.same().day()},t.weekday=function(){return this._nth?u("Weekday").call(this):this._move?this.addWeekdays(this._orient):!!this._is&&(this._is=!1,!this.is().sat()&&!this.is().sun())},t.weekend=function(){return!!this._is&&(this._is=!1,this.is().sat()||this.is().sun())},t.at=function(t){return"string"===typeof t?e.parse(this.toString("d")+" "+t):this.set(t)},a.fromNow=a.after=function(e){var t={};return t[this._dateElement]=this,(e?e.clone():new Date).add(t)},a.ago=a.before=function(e){var t={};return t["s"!==this._dateElement[this._dateElement.length-1]?this._dateElement+"s":this._dateElement]=-1*this,(e?e.clone():new Date).add(t)};var n,r="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),i="january february march april may june july august september october november december".split(/\s/),o=[],s=[],l="final first second third fourth fifth".split(/\s/);t.toObject=function(){for(var e={},t=0;t<o.length;t++)this["get"+s[t]]&&(e[o[t].toLowerCase()]=this["get"+s[t]]());return e},e.fromObject=function(e){return e.week=null,Date.today().set(e)};var u=function(t){return function(){if(this._is)return this._is=!1,this.getDay()===t;if(this._move&&(this._move=null),null!==this._nth){this._isSecond&&this.addSeconds(-1*this._orient),this._isSecond=!1;var a=this._nth;this._nth=null;var n=this.clone().moveToLastDayOfMonth();if(this.moveToNthOccurrence(t,a),this>n)throw new RangeError(e.getDayName(t)+" does not occur "+a+" times in the month of "+e.getMonthName(n.getMonth())+" "+n.getFullYear()+".");return this}return this.moveToDayOfWeek(t,this._orient)}},c=function(a,n,r){for(var i=0;i<a.length;i++)e[a[i].toUpperCase()]=e[a[i].toUpperCase().substring(0,3)]=i,e[a[i]]=e[a[i].substring(0,3)]=n(i),t[a[i]]=t[a[i].substring(0,3)]=r(i)};c(r,(function(t){return function(){var a=e.today(),n=t-a.getDay();return(0===t&&1===Date.CultureInfo.firstDayOfWeek&&0!==a.getDay()||n<0)&&(n+=7),a.addDays(n)}}),u),c(i,(function(t){return function(){return e.today().set({month:t,day:1})}}),(function(e){return function(){return this._is?(this._is=!1,this.getMonth()===e):this.moveToMonth(e,this._orient)}}));for(var d=function(e){return function(){if(this._isSecond)return this._isSecond=!1,this;if(this._same){this._same=this._is=!1;var t=this.toObject(),a=(arguments[0]||new Date).toObject(),n="",r=e.toLowerCase();r="s"===r[r.length-1]?r.substring(0,r.length-1):r;for(var i=o.length-1;i>-1;i--){if(t[n=o[i].toLowerCase()]!==a[n])return!1;if(r===n)break}return!0}return"s"!==e.substring(e.length-1)&&(e+="s"),this._move&&(this._move=null),this["add"+e](this._orient)}},h=function(e){return function(){return this._dateElement=e,this}},f=0;f<o.length;f++)"weekday"!==(n=o[f].toLowerCase())&&(t[n]=t[n+"s"]=d(o[f]),a[n]=a[n+"s"]=h(n+"s"));t._ss=d("Second");for(var p=function(e){return function(t){return this._same?this._ss(arguments[0]):t||0===t?this.moveToNthOccurrence(t,e):(this._nth=e,2!==e||void 0!==t&&null!==t?this:(this._isSecond=!0,this.addSeconds(this._orient)))}},g=0;g<l.length;g++)t[l[g]]=p(0===g?-1:g)}(),function(){"use strict";Date.Parsing={Exception:function(e){this.message="Parse error at '"+e.substring(0,10)+" ...'"}};var e=Date.Parsing,t={standard:[0,31,59,90,120,151,181,212,243,273,304,334],leap:[0,31,60,91,121,152,182,213,244,274,305,335]};e.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0};var a={multiReplace:function(e,t){var a;for(a in t){var n;if(Object.prototype.hasOwnProperty.call(t,a))"function"===typeof t[a]||(n=t[a]instanceof RegExp?t[a]:new RegExp(t[a],"g")),e=e.replace(n,a)}return e},getDayOfYearFromWeek:function(e){var t,a;return e.weekDay=e.weekDay||0===e.weekDay?e.weekDay:1,a=(0===(t=new Date(e.year,0,4)).getDay()?7:t.getDay())+3,e.dayOfYear=7*e.week+(0===e.weekDay?7:e.weekDay)-a,e},getDayOfYear:function(e,t){e.dayOfYear||(e=a.getDayOfYearFromWeek(e));for(var n=0;n<=t.length;n++){if(e.dayOfYear<t[n]||n===t.length){e.day=e.day?e.day:e.dayOfYear-t[n-1];break}e.month=n}return e},adjustForTimeZone:function(e,t){var a;return"Z"===e.zone.toUpperCase()||0===e.zone_hours&&0===e.zone_minutes?a=-t.getTimezoneOffset():(a=60*e.zone_hours+(e.zone_minutes||0),"+"===e.zone_sign&&(a*=-1),a-=t.getTimezoneOffset()),t.setMinutes(t.getMinutes()+a),t},setDefaults:function(e){return e.year=e.year||Date.today().getFullYear(),e.hours=e.hours||0,e.minutes=e.minutes||0,e.seconds=e.seconds||0,e.milliseconds=e.milliseconds||0,(e.month||!e.week&&!e.dayOfYear)&&(e.month=e.month||0,e.day=e.day||1),e},dataNum:function(e,t,a,n){var r=1*e;return t?n?e?1*t(e):e:e?t(r):e:a?e&&"undefined"!==typeof e?r:e:e?r:e},timeDataProcess:function(e){var t={};for(var n in e.data)e.data.hasOwnProperty(n)&&(t[n]=e.ignore[n]?e.data[n]:a.dataNum(e.data[n],e.mods[n],e.explict[n],e.postProcess[n]));return e.data.secmins&&(e.data.secmins=60*e.data.secmins.replace(",","."),t.minutes?t.seconds||(t.seconds=e.data.secmins):t.minutes=e.data.secmins,delete e.secmins),t},buildTimeObjectFromData:function(e){return a.timeDataProcess({data:{year:e[1],month:e[5],day:e[7],week:e[8],dayOfYear:e[10],hours:e[15],zone_hours:e[23],zone_minutes:e[24],zone:e[21],zone_sign:e[22],weekDay:e[9],minutes:e[16],seconds:e[19],milliseconds:e[20],secmins:e[18]},mods:{month:function(e){return e-1},weekDay:function(e){return 7===(e=Math.abs(e))?0:e},minutes:function(e){return e.replace(":","")},seconds:function(e){return Math.floor(1*e.replace(":","").replace(",","."))},milliseconds:function(e){return 1e3*e.replace(",",".")}},postProcess:{minutes:!0,seconds:!0,milliseconds:!0},explict:{zone_hours:!0,zone_minutes:!0},ignore:{zone:!0,zone_sign:!0,secmins:!0}})},addToHash:function(e,t,a){a=a;for(var n=(t=t).length,r=0;r<n;r++)e[t[r]]=a[r];return e},combineRegex:function(e,t){return new RegExp("(("+e.source+")\\s("+t.source+"))")},getDateNthString:function(e,t,a){return e?Date.today().addDays(a).toString("d"):t?Date.today().last()[a]().toString("d"):void 0},buildRegexData:function(e){for(var t=[],a=e.length,n=0;n<a;n++)Array.isArray(e[n])?t.push(this.combineRegex(e[n][0],e[n][1])):t.push(e[n]);return t}};e.processTimeObject=function(n){var r,i;return a.setDefaults(n),i=e.isLeapYear(n.year)?t.leap:t.standard,n.month||!n.week&&!n.dayOfYear?n.dayOfYear=i[n.month]+n.day:a.getDayOfYear(n,i),r=new Date(n.year,n.month,n.day,n.hours,n.minutes,n.seconds,n.milliseconds),n.zone&&a.adjustForTimeZone(n,r),r},e.Numeric={isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},regex:/\b([0-1]?[0-9])([0-3]?[0-9])([0-2]?[0-9]?[0-9][0-9])\b/i,parse:function(t){var a,n,r={},i=Date.CultureInfo.dateElementOrder.split("");if(!this.isNumeric(t)||"+"===t[0]&&"-"===t[0])return null;if(t.length<5&&t.indexOf(".")<0&&t.indexOf("/")<0)return r.year=t,e.processTimeObject(r);if(!(a=t.match(this.regex))||!a.length)return null;for(n=0;n<i.length;n++)switch(i[n]){case"d":r.day=a[n+1];break;case"m":r.month=a[n+1]-1;break;case"y":r.year=a[n+1]}return e.processTimeObject(r)}},e.Normalizer={regexData:function(){var e=Date.CultureInfo.regexPatterns;return a.buildRegexData([e.tomorrow,e.yesterday,[e.past,e.mon],[e.past,e.tue],[e.past,e.wed],[e.past,e.thu],[e.past,e.fri],[e.past,e.sat],[e.past,e.sun]])},basicReplaceHash:function(){var e=Date.CultureInfo.regexPatterns;return{January:e.jan,February:e.feb,March:e.mar,April:e.apr,May:e.may,June:e.jun,July:e.jul,August:e.aug,September:e.sep,October:e.oct,November:e.nov,December:e.dec,"":/\bat\b/gi," ":/\s{2,}/,"9am":e.thisMorning,"7pm":e.thisEvening}},keys:function(){return[a.getDateNthString(!0,!1,1),a.getDateNthString(!0,!1,-1),a.getDateNthString(!1,!0,"monday"),a.getDateNthString(!1,!0,"tuesday"),a.getDateNthString(!1,!0,"wednesday"),a.getDateNthString(!1,!0,"thursday"),a.getDateNthString(!1,!0,"friday"),a.getDateNthString(!1,!0,"saturday"),a.getDateNthString(!1,!0,"sunday")]},buildRegexFunctions:function(){var e=Date.CultureInfo.regexPatterns,t=Date.i18n.__,a=new RegExp("(\\b\\d\\d?("+t("AM")+"|"+t("PM")+")? )("+e.tomorrow.source.slice(1)+")","i"),n=new RegExp(e.today.source+"(?!\\s*([+-]))\\b");this.replaceFuncs=[[n,function(e){return e.length>1?Date.today().toString("d"):e}],[a,function(e,t){return Date.today().addDays(1).toString("d")+" "+t}]]},buildReplaceData:function(){this.buildRegexFunctions(),this.replaceHash=a.addToHash(this.basicReplaceHash(),this.keys(),this.regexData())},stringReplaceFuncs:function(e){for(var t=0;t<this.replaceFuncs.length;t++)e=e.replace(this.replaceFuncs[t][0],this.replaceFuncs[t][1]);return e},parse:function(t){t=this.stringReplaceFuncs(t),t=a.multiReplace(t,this.replaceHash);try{var n=t.split(/([\s\-\.\,\/\x27]+)/);3===n.length&&e.Numeric.isNumeric(n[0])&&e.Numeric.isNumeric(n[2])&&n[2].length>=4&&"d"===Date.CultureInfo.dateElementOrder[0]&&(t="1/"+n[0]+"/"+n[2])}catch(r){}return t}},e.Normalizer.buildReplaceData()}(),function(){for(var e=Date.Parsing,t=e.Operators={rtoken:function(t){return function(a){var n=a.match(t);if(n)return[n[0],a.substring(n[0].length)];throw new e.Exception(a)}},token:function(){return function(e){return t.rtoken(new RegExp("^\\s*"+e+"\\s*"))(e)}},stoken:function(e){return t.rtoken(new RegExp("^"+e))},until:function(e){return function(t){for(var a=[],n=null;t.length;){try{n=e.call(this,t)}catch(r){a.push(n[0]),t=n[1];continue}break}return[a,t]}},many:function(e){return function(t){for(var a=[],n=null;t.length;){try{n=e.call(this,t)}catch(r){return[a,t]}a.push(n[0]),t=n[1]}return[a,t]}},optional:function(e){return function(t){var a=null;try{a=e.call(this,t)}catch(n){return[null,t]}return[a[0],a[1]]}},not:function(t){return function(a){try{t.call(this,a)}catch(n){return[null,a]}throw new e.Exception(a)}},ignore:function(e){return e?function(t){return[null,e.call(this,t)[1]]}:null},product:function(){for(var e=arguments[0],a=Array.prototype.slice.call(arguments,1),n=[],r=0;r<e.length;r++)n.push(t.each(e[r],a));return n},cache:function(t){var a={},n=0,r=[],i=Date.Config.CACHE_MAX||500,o=null;return function(s){!function(){if(n===i)for(var e=0;e<10;e++){var t=r.shift();t&&(delete a[t],n--)}}();try{o=a[s]=a[s]||t.call(this,s)}catch(l){o=a[s]=l}if(n++,r.push(s),o instanceof e.Exception)throw o;return o}},any:function(){var t=arguments;return function(a){for(var n=null,r=0;r<t.length;r++)if(null!=t[r]){try{n=t[r].call(this,a)}catch(i){n=null}if(n)return n}throw new e.Exception(a)}},each:function(){var t=arguments;return function(a){for(var n=[],r=null,i=0;i<t.length;i++)if(null!=t[i]){try{r=t[i].call(this,a)}catch(o){throw new e.Exception(a)}n.push(r[0]),a=r[1]}return[n,a]}},all:function(){var e=arguments,t=t;return t.each(t.optional(e))},sequence:function(a,n,r){return n=n||t.rtoken(/^\s*/),r=r||null,1===a.length?a[0]:function(t){for(var i=null,o=null,s=[],l=0;l<a.length;l++){try{i=a[l].call(this,t)}catch(u){break}s.push(i[0]);try{o=n.call(this,i[1])}catch(c){o=null;break}t=o[1]}if(!i)throw new e.Exception(t);if(o)throw new e.Exception(o[1]);if(r)try{i=r.call(this,i[1])}catch(d){throw new e.Exception(i[1])}return[s,i?i[1]:t]}},between:function(e,a,n){n=n||e;var i=t.each(t.ignore(e),a,t.ignore(n));return function(e){var t=i.call(this,e);return[[t[0][0],r[0][2]],t[1]]}},list:function(e,a,n){return a=a||t.rtoken(/^\s*/),n=n||null,e instanceof Array?t.each(t.product(e.slice(0,-1),t.ignore(a)),e.slice(-1),t.ignore(n)):t.each(t.many(t.each(e,t.ignore(a))),px,t.ignore(n))},set:function(a,n,r){return n=n||t.rtoken(/^\s*/),r=r||null,function(i){for(var o=null,s=null,l=null,u=null,c=[[],i],d=!1,h=0;h<a.length;h++){l=null,s=null,o=null,d=1===a.length;try{o=a[h].call(this,i)}catch(g){continue}if(u=[[o[0]],o[1]],o[1].length>0&&!d)try{l=n.call(this,o[1])}catch(m){d=!0}else d=!0;if(d||0!==l[1].length||(d=!0),!d){for(var f=[],p=0;p<a.length;p++)h!==p&&f.push(a[p]);(s=t.set(f,n).call(this,l[1]))[0].length>0&&(u[0]=u[0].concat(s[0]),u[1]=s[1])}if(u[1].length<c[1].length&&(c=u),0===c[1].length)break}if(0===c[0].length)return c;if(r){try{l=r.call(this,c[1])}catch(v){throw new e.Exception(c[1])}c[1]=l[1]}return c}},forward:function(e,t){return function(a){return e[t].call(this,a)}},replace:function(e,t){return function(a){var n=e.call(this,a);return[t,n[1]]}},process:function(e,t){return function(a){var n=e.call(this,a);return[t.call(this,n[0]),n[1]]}},min:function(t,a){return function(n){var r=a.call(this,n);if(r[0].length<t)throw new e.Exception(n);return r}}},a=function(e){return function(){var t,a,n=null,r=[];return arguments.length>1?n=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(n=arguments[0]),n?(t=n.shift()).length>0?(n.unshift(t[a]),r.push(e.apply(null,n)),n.shift(),r):void 0:e.apply(null,arguments)}},n="optional not ignore cache".split(/\s/),i=0;i<n.length;i++)t[n[i]]=a(t[n[i]]);for(var o=function(e){return function(){return arguments[0]instanceof Array?e.apply(null,arguments[0]):e.apply(null,arguments)}},s="each any all".split(/\s/),l=0;l<s.length;l++)t[s[l]]=o(t[s[l]])}(),function(){var e=Date,t=function(e){for(var a=[],n=0;n<e.length;n++)e[n]instanceof Array?a=a.concat(t(e[n])):e[n]&&a.push(e[n]);return a},a=function(){if(this.meridian&&(this.hour||0===this.hour)){if("a"===this.meridian&&this.hour>11&&Date.Config.strict24hr)throw"Invalid hour and meridian combination";if("p"===this.meridian&&this.hour<12&&Date.Config.strict24hr)throw"Invalid hour and meridian combination";"p"===this.meridian&&this.hour<12?this.hour=this.hour+12:"a"===this.meridian&&12===this.hour&&(this.hour=0)}else this.meridian||!this.hour&&0!==this.hour||this.hour<8&&(this.hour=this.hour+12)},n=function(){var e=new Date;!this.hour&&!this.minute||this.month||this.year||this.day||(this.day=e.getDate()),this.year||(this.year=e.getFullYear(),this.month<e.getMonth()&&this.year++),this.month||0===this.month||(this.month=e.getMonth()),this.day||(this.day=1),this.hour||(this.hour=0),this.minute||(this.minute=0),this.second||(this.second=0),this.millisecond||(this.millisecond=0)},r={getToday:function(){return this.now||-1!=="hour minute second".indexOf(this.unit)?new Date:e.today()},setDaysFromWeekday:function(t,a){var n;return a=a||1,this.unit="day",n=e.getDayNumberFromName(this.weekday)-t.getDay(),this.days=n?n+7*a:7*a,this},setMonthsFromMonth:function(e,t){var a;return t=t||1,this.unit="month",a=this.month-e.getMonth(),this.months=a?(a+12*t)%12:12*t,this.month=null,this},setDMYFromWeekday:function(){var e=Date[this.weekday]();return this.day=e.getDate(),this.month||(this.month=e.getMonth()),this.year=e.getFullYear(),this},setUnitValue:function(e){!this.value&&this.operator&&null!==this.operator&&this[this.unit+"s"]&&null!==this[this.unit+"s"]?this[this.unit+"s"]=this[this.unit+"s"]+("add"===this.operator?1:-1)+(this.value||0)*e:null!=this[this.unit+"s"]&&null==this.operator||(this.value||(this.value=1),this[this.unit+"s"]=this.value*e)},generateDateFromWeeks:function(){var e=void 0!==this.weekday?this.weekday:"today",t=Date[e]().addWeeks(this.weeks);return this.now&&t.setTimeToNow(),t}};e.Translator={hour:function(e){return function(){this.hour=Number(e),this.setExplicitTime=!0}},minute:function(e){return function(){this.minute=Number(e),this.setExplicitTime=!0}},second:function(e){return function(){this.second=Number(e),this.setExplicitTime=!0}},secondAndMillisecond:function(e){return function(){var t=e.match(/^([0-5][0-9])\.([0-9]{1,3})/);this.second=Number(t[1]),this.millisecond=Number(t[2]),this.setExplicitTime=!0}},meridian:function(e){return function(){this.meridian=e.slice(0,1).toLowerCase(),this.setExplicitTime=!0}},timezone:function(e){return function(){var t=e.replace(/[^\d\+\-]/g,"");t.length?this.timezoneOffset=Number(t):this.timezone=e.toLowerCase()}},day:function(e){var t=e[0];return function(){if(this.day=Number(t.match(/\d+/)[0]),this.day<1)throw"invalid day"}},month:function(e){return function(){if(this.month=3===e.length?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(e)/4:Number(e)-1,this.month<0)throw"invalid month"}},year:function(e){return function(){var t=Number(e);this.year=e.length>2?t:t+(t+2e3<Date.CultureInfo.twoDigitYearMax?2e3:1900)}},rday:function(e){return function(){switch(e){case"yesterday":this.days=-1;break;case"someday":this.days=14;break;case"later":this.days=5;break;case"soon":this.days=2;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(t){var r;t=t instanceof Array?t:[t];for(var i=0;i<t.length;i++)t[i]&&t[i].call(this);if(n.call(this),a.call(this),this.day>e.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");return r=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond),this.setExplicitTime&&r.ensureTimeOfDay(),this.year<100&&r.setFullYear(this.year),this.timezone?r.set({timezone:this.timezone}):this.timezoneOffset&&r.set({timezoneOffset:this.timezoneOffset}),r},finish:function(n){var i,o,s,l;if(0===(n=n instanceof Array?t(n):[n]).length)return null;for(var u=0;u<n.length;u++)"function"===typeof n[u]&&n[u].call(this);if(this.now&&!this.unit&&!this.operator)return new Date;if(i=r.getToday.call(this),givenYear=!!this.year,o=!!(this.days&&null!==this.days||this.orient||this.operator),s="past"===this.orient||"subtract"===this.operator?-1:1,this.month&&"week"===this.unit&&(this.value=this.month+1,delete this.month,delete this.day),!this.month&&0!==this.month||-1==="year day hour minute second".indexOf(this.unit)||(this.value||(this.value=this.month+1),this.month=null,o=!0),o||!this.weekday||this.day||this.days||r.setDMYFromWeekday.call(this),o&&this.weekday&&"month"!==this.unit&&"week"!==this.unit&&r.setDaysFromWeekday.call(this,i,s),!this.weekday||"week"===this.unit||this.day||this.days||(l=Date[this.weekday](),this.day=l.getDate(),l.getMonth()!==i.getMonth()&&(this.month=l.getMonth())),this.month&&"day"===this.unit&&this.operator&&(this.value||(this.value=this.month+1),this.month=null),null==this.value||null==this.month||null==this.year||this.day||(this.day=1*this.value),this.month&&!this.day&&this.value&&(i.set({day:1*this.value}),o||(this.day=1*this.value)),this.month||!this.value||"month"!==this.unit||this.now||(this.month=this.value,o=!0),o&&(this.month||0===this.month)&&"year"!==this.unit&&r.setMonthsFromMonth.call(this,i,s),this.unit||(this.unit="day"),r.setUnitValue.call(this,s),a.call(this),!this.month&&0!==this.month||this.day||(this.day=1),!this.orient&&!this.operator&&"week"===this.unit&&this.value&&!this.day&&!this.month)return Date.today().setWeek(this.value);if("week"===this.unit&&this.weeks&&!this.day&&!this.month)return r.generateDateFromWeeks.call(this);if(o&&this.timezone&&this.day&&this.days&&(this.day=this.days),!givenYear&&this.month<i.getMonth()&&(this.year=i.getFullYear()+1),o&&(this.hour||this.minute||this.second)&&(this.hours=this.hour,this.minutes=this.minute,this.seconds=this.second),o?i.add(this):i.set(this),this.timezone){this.timezone=this.timezone.toUpperCase();var c=e.getTimezoneOffset(this.timezone);i.hasDaylightSavingTime()&&e.getTimezoneAbbreviation(c,i.isDaylightSavingTime())!==this.timezone&&(i.isDaylightSavingTime()?i.addHours(-1):i.addHours(1)),i.setTimezoneOffset(c)}return i}}}(),function(){var e=Date;e.Grammar={};var t,a=e.Parsing.Operators,n=e.Grammar,r=e.Translator;t=function(){return a.each(a.any.apply(null,arguments),a.not(n.ctoken2("timeContext")))},n.datePartDelimiter=a.rtoken(/^([\s\-\.\,\/\x27]+)/),n.timePartDelimiter=a.stoken(":"),n.whiteSpace=a.rtoken(/^\s*/),n.generalDelimiter=a.rtoken(/^(([\s\,]|at|@|on)+)/);var i={};n.ctoken=function(e){var t=i[e];if(!t){for(var n=Date.CultureInfo.regexPatterns,r=e.split(/\s+/),o=[],s=0;s<r.length;s++)o.push(a.replace(a.rtoken(n[r[s]]),r[s]));t=i[e]=a.any.apply(null,o)}return t},n.ctoken2=function(e){return a.rtoken(Date.CultureInfo.regexPatterns[e])};var o=function(e,t,r,i){n[e]=i?a.cache(a.process(a.each(a.rtoken(t),a.optional(n.ctoken2(i))),r)):a.cache(a.process(a.rtoken(t),r))},s=function(e,t){return a.cache(a.process(n.ctoken2(e),t))},l={},u=function(e){return l[e]=l[e]||n.format(e)[0],l[e]};n.allformats=function(e){var t=[];if(e instanceof Array)for(var a=0;a<e.length;a++)t.push(u(e[a]));else t.push(u(e));return t},n.formats=function(e){if(e instanceof Array){for(var t=[],n=0;n<e.length;n++)t.push(u(e[n]));return a.any.apply(null,t)}return u(e)};var c=function(){var e,t=["h","hh","H","HH","m","mm","s","ss","ss.s","z","zz"],i=[/^(0[0-9]|1[0-2]|[1-9])/,/^(0[0-9]|1[0-2])/,/^([0-1][0-9]|2[0-3]|[0-9])/,/^([0-1][0-9]|2[0-3])/,/^([0-5][0-9]|[0-9])/,/^[0-5][0-9]/,/^([0-5][0-9]|[0-9])/,/^[0-5][0-9]/,/^[0-5][0-9]\.[0-9]{1,3}/,/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/,/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/],l=[r.hour,r.hour,r.hour,r.hour,r.minute,r.minute,r.second,r.second,r.secondAndMillisecond,r.timezone,r.timezone];for(e=0;e<t.length;e++)o(t[e],i[e],l[e]);n.hms=a.cache(a.sequence([n.H,n.m,n.s],n.timePartDelimiter)),n.t=s("shortMeridian",r.meridian),n.tt=s("longMeridian",r.meridian),n.zzz=s("timezone",r.timezone),n.timeSuffix=a.each(a.ignore(n.whiteSpace),a.set([n.tt,n.zzz])),n.time=a.each(a.optional(a.ignore(a.stoken("T"))),n.hms,n.timeSuffix)},d=function(){o("d",/^([0-2]\d|3[0-1]|\d)/,r.day,"ordinalSuffix"),o("dd",/^([0-2]\d|3[0-1])/,r.day,"ordinalSuffix"),n.rday=a.cache(a.process(n.ctoken("yesterday tomorrow soon later someday today now"),r.rday)),n.ddd=n.dddd=a.cache(a.process(n.ctoken("sun mon tue wed thu fri sat"),(function(e){return function(){this.weekday=e}}))),o("M",/^(1[0-2]|0\d|\d)/,r.month),o("MM",/^(1[0-2]|0\d)/,r.month),n.MMM=n.MMMM=a.cache(a.process(n.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),r.month)),o("y",/^(\d+)/,r.year),o("yy",/^(\d\d)/,r.year),o("yyy",/^(\d\d?\d?\d?)/,r.year),o("yyyy",/^(\d\d\d\d)/,r.year),n.day=t(n.d,n.dd),n.month=t(n.M,n.MMM),n.year=t(n.yyyy,n.yy);var e=function(){return a.set(arguments,n.datePartDelimiter)};n.mdy=e(n.ddd,n.month,n.day,n.year),n.ymd=e(n.ddd,n.year,n.month,n.day),n.dmy=e(n.ddd,n.day,n.month,n.year),n.date=function(e){return(n[Date.CultureInfo.dateElementOrder]||n.mdy).call(this,e)}},h=function(){n.orientation=a.process(n.ctoken("past future"),(function(e){return function(){this.orient=e}})),n.operator=a.process(n.ctoken("add subtract"),(function(e){return function(){this.operator=e}}))};n.buildGrammarFormats=function(){i={},c(),d(),h(),n.value=a.process(a.rtoken(/^([-+]?\d+)?(st|nd|rd|th)?/),(function(e){return function(){this.value=e.replace(/\D/g,"")}})),n.expression=a.set([n.rday,n.time,n.value,n.orientation,n.ddd,n.MMM]),n.format=a.process(a.many(a.any(a.process(a.rtoken(/^(dd?d?d?(?!e)|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),(function(t){if(n[t])return n[t];throw e.Parsing.Exception(t)})),a.process(a.rtoken(/^[^dMyhHmstz]+/),(function(e){return a.ignore(a.stoken(e))})))),(function(e){return a.process(a.each.apply(null,e),r.finishExact)})),n._start=a.process(a.set([n.date,n.expression,n.time],n.generalDelimiter,n.whiteSpace),r.finish)},n.buildGrammarFormats(),n._formats=n.formats(["M-d H","ddd H"]),n.start=function(e){try{var t=n._formats.call({},e);if(0===t[1].length)return t}catch(a){}return n._start.call({},e)}}(),function(){var e=Date,t=function(e){var t=e.match(/\b(\d+)(?:st|nd|rd|th)\b/);return e=t&&2===t.length?e.replace(t[0],t[1]):e},a=function(t){var a=null;try{a=e.Grammar.start.call({},t.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(n){return null}return 0===a[1].length?a[0]:null};e._parse||(e._parse=e.parse),e.parse=function(n){var r;return n?n instanceof Date?n.clone():(n.length>=4&&"0"!==n.charAt(0)&&"+"!==n.charAt(0)&&"-"!==n.charAt(0)&&(r=e.Parsing.Numeric.parse(n)),r instanceof Date&&!isNaN(r.getTime())?r:(n=e.Parsing.Normalizer.parse(t(n)),r=a(n))):null},Date.getParseFunction=function(e){var t=Date.Grammar.allformats(e);return function(e){for(var a=null,n=0;n<t.length;n++){try{a=t[n].call({},e)}catch(r){continue}if(0===a[1].length)return a[0]}return null}},e.parseExact=function(t,a){return e.getParseFunction(a)(t)}}(),function(){var e=Date,a=e.prototype,n=function(e,t){return t||(t=2),("000"+e).slice(-1*t)},r={substitutes:function(e){switch(e){case"d":case"%d":return"dd";case"D":case"%a":return"ddd";case"j":case"l":case"%A":return"dddd";case"S":return"S";case"F":case"%B":return"MMMM";case"m":case"%m":return"MM";case"M":case"%b":case"%h":return"MMM";case"n":return"M";case"Y":case"%Y":return"yyyy";case"y":case"%y":return"yy";case"g":case"%I":return"h";case"G":return"H";case"h":return"hh";case"H":case"%H":return"HH";case"i":case"%M":return"mm";case"s":case"%S":return"ss";case"%r":return"hh:mm tt";case"%R":return"H:mm";case"%T":return"H:mm:ss";case"%X":return"t";case"%x":case"%e":return"d";case"%D":return"MM/dd/yy";case"%n":return"\\n";case"%t":return"\\t";case"e":case"T":case"%z":case"%Z":return"z";case"Z":return"ZZ";case"N":case"w":case"%w":return"u";case"W":case"%V":return"W"}},interpreted:function(a,r){var i;switch(a){case"%u":return r.getDay()+1;case"z":return r.getOrdinalNumber();case"%j":return n(r.getOrdinalNumber(),3);case"%U":var o=r.clone().set({month:0,day:1}).addDays(-1).moveToDayOfWeek(0),s=r.clone().addDays(1).moveToDayOfWeek(0,-1);return s<o?"00":n((s.getOrdinalNumber()-o.getOrdinalNumber())/7+1);case"%W":return n(r.getWeek());case"t":return e.getDaysInMonth(r.getFullYear(),r.getMonth());case"o":case"%G":return r.setWeek(r.getISOWeek()).toString("yyyy");case"%g":return r._format("%G").slice(-2);case"a":case"%p":return t("tt").toLowerCase();case"A":return t("tt").toUpperCase();case"u":return n(r.getMilliseconds(),3);case"I":return r.isDaylightSavingTime()?1:0;case"O":return r.getUTCOffset();case"P":return(i=r.getUTCOffset()).substring(0,i.length-2)+":"+i.substring(i.length-2);case"B":var l=new Date;return Math.floor((3600*l.getHours()+60*l.getMinutes()+l.getSeconds()+60*(l.getTimezoneOffset()+60))/86.4);case"c":return r.toISOString().replace(/\"/g,"");case"U":return e.strtotime("now");case"%c":return t("d")+" "+t("t");case"%C":return Math.floor(r.getFullYear()/100+1)}},shouldOverrideDefaults:function(e){switch(e){case"%e":return!0;default:return!1}},parse:function(e,t){var a,n=t||new Date;return(a=r.substitutes(e))?a:(a=r.interpreted(e,n))||e}};e.normalizeFormat=function(e,t){return e.replace(/(%|\\)?.|%%/g,(function(e){return r.parse(e,t)}))},e.strftime=function(e,t){return Date.parse(t)._format(e)},e.strtotime=function(t){var a=e.parse(t);return Math.round(e.UTC(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate(),a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds())/1e3)};a._format=function(t){var a,n=(a=this,function(t){var n,i;return"\\"===t.charAt(0)||"%%"===t.substring(0,2)?t.replace("\\","").replace("%%","%"):(i=r.shouldOverrideDefaults(t),(n=e.normalizeFormat(t,a))?a.toString(n,i):void 0)});return t?t.replace(/(%|\\)?.|%%/g,n):this._toString()},a.format||(a.format=a._format)}(),function(){"use strict";var e=function(e){return function(){return this[e]}},t=function(e){return function(t){return this[e]=t,this}},a=function(e,t,n,r,i){if(1===arguments.length&&"number"===typeof e){var o=e<0?-1:1,s=Math.abs(e);this.setDays(Math.floor(s/864e5)*o),s%=864e5,this.setHours(Math.floor(s/36e5)*o),s%=36e5,this.setMinutes(Math.floor(s/6e4)*o),s%=6e4,this.setSeconds(Math.floor(s/1e3)*o),s%=1e3,this.setMilliseconds(s*o)}else this.set(e,t,n,r,i);return this.getTotalMilliseconds=function(){return 864e5*this.getDays()+36e5*this.getHours()+6e4*this.getMinutes()+1e3*this.getSeconds()},this.compareTo=function(e){var t,a=new Date(1970,1,1,this.getHours(),this.getMinutes(),this.getSeconds());return a<(t=null===e?new Date(1970,1,1,0,0,0):new Date(1970,1,1,e.getHours(),e.getMinutes(),e.getSeconds()))?-1:a>t?1:0},this.equals=function(e){return 0===this.compareTo(e)},this.add=function(e){return null===e?this:this.addSeconds(e.getTotalMilliseconds()/1e3)},this.subtract=function(e){return null===e?this:this.addSeconds(-e.getTotalMilliseconds()/1e3)},this.addDays=function(e){return new a(this.getTotalMilliseconds()+864e5*e)},this.addHours=function(e){return new a(this.getTotalMilliseconds()+36e5*e)},this.addMinutes=function(e){return new a(this.getTotalMilliseconds()+6e4*e)},this.addSeconds=function(e){return new a(this.getTotalMilliseconds()+1e3*e)},this.addMilliseconds=function(e){return new a(this.getTotalMilliseconds()+e)},this.get12HourHour=function(){return this.getHours()>12?this.getHours()-12:0===this.getHours()?12:this.getHours()},this.getDesignator=function(){return this.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator},this.toString=function(e){this._toString=function(){return null!==this.getDays()&&this.getDays()>0?this.getDays()+"."+this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds()):this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds())},this.p=function(e){return e.toString().length<2?"0"+e:e};var t=this;return e?e.replace(/dd?|HH?|hh?|mm?|ss?|tt?/g,(function(e){switch(e){case"d":return t.getDays();case"dd":return t.p(t.getDays());case"H":return t.getHours();case"HH":return t.p(t.getHours());case"h":return t.get12HourHour();case"hh":return t.p(t.get12HourHour());case"m":return t.getMinutes();case"mm":return t.p(t.getMinutes());case"s":return t.getSeconds();case"ss":return t.p(t.getSeconds());case"t":return(t.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator).substring(0,1);case"tt":return t.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator}})):this._toString()},this};!function(a,n){for(var r=0;r<n.length;r++){var i=n[r],o=i.slice(0,1).toUpperCase()+i.slice(1);a.prototype[i]=0,a.prototype["get"+o]=e(i),a.prototype["set"+o]=t(i)}}(a,["years","months","days","hours","minutes","seconds","milliseconds"].slice(2)),a.prototype.set=function(e,t,a,n,r){this.setDays(e||this.getDays()),this.setHours(t||this.getHours()),this.setMinutes(a||this.getMinutes()),this.setSeconds(n||this.getSeconds()),this.setMilliseconds(r||this.getMilliseconds())},Date.prototype.getTimeOfDay=function(){return this.getMilliseconds()+1e3*this.getSeconds()+6e4*this.getMinutes()+36e5*this.getHours()},Date.prototype.hasTimeOfDay=function(){return 0!==this.getHours()||0!==this.getMinutes()||0!==this.getSeconds()||0!==this.getMilliseconds()},Date.prototype.isRepeatDate=function(){return!1},Date.TimeSpan=a,"undefined"!==typeof window&&(window.TimeSpan=a)}(),function(){"use strict";var e=function(e){return function(){return this[e]}},t=function(e){return function(t){return this[e]=t,this}},a=function(e,t,a,n){function r(){t.addMonths(-e),n.months++,12===n.months&&(n.years++,n.months=0)}if(1===e)for(;t>a;)r();else for(;t<a;)r();n.months--,n.months*=e,n.years*=e},n=function(e,t,a){var n=!1===(t.isDaylightSavingTime()===a.isDaylightSavingTime());n&&1===e?t.addHours(-1):n&&t.addHours(1)},r=function(e,t,r,i,o,s,l){if(7===arguments.length)this.set(e,t,r,i,o,s,l);else if(2===arguments.length&&arguments[0]instanceof Date&&arguments[1]instanceof Date){var u=arguments[0].clone(),c=arguments[1].clone(),d=u>c?1:-1;this.dates={start:arguments[0].clone(),end:arguments[1].clone()},a(d,u,c,this),n(d,u,c);var h=c-u;if(0!==h){var f=new TimeSpan(h);this.set(this.years,this.months,f.getDays(),f.getHours(),f.getMinutes(),f.getSeconds(),f.getMilliseconds())}}return this};!function(a,n){for(var r=0;r<n.length;r++){var i=n[r],o=i.slice(0,1).toUpperCase()+i.slice(1);a.prototype[i]=0,a.prototype["get"+o]=e(i),a.prototype["set"+o]=t(i)}}(r,["years","months","days","hours","minutes","seconds","milliseconds"]),r.prototype.set=function(e,t,a,n,r,i,o){this.setYears(e||this.getYears()),this.setMonths(t||this.getMonths()),this.setDays(a||this.getDays()),this.setHours(n||this.getHours()),this.setMinutes(r||this.getMinutes()),this.setSeconds(i||this.getSeconds()),this.setMilliseconds(o||this.getMilliseconds())},Date.TimePeriod=r,"undefined"!==typeof window&&(window.TimePeriod=r)}()},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){Object.values=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))};Object.entries=Object.entries||function(e){return Object.keys(e).map((function(t){return[t,e[t]]}))}},,,,function(e,t,a){"use strict";a.r(t);var n=a(51),r=a.n(n),i=a(52),o=a.n(i),s=a(3),l=a.n(s),u=a(4),c=a(17),d=a(71),h=a(57);t.default=Object(c.b)((function(e){var t=e.type,a=e.href,n=o()(e,["type","href"]);return l.a.createElement(d.a,r()({type:t},n),l.a.createElement("div",{className:"flex items-center px-4 py-3 overflow-hidden"},l.a.createElement("div",{className:"flex-1 pr-4 overflow-hidden break-words whitespace-pre-wrap"},a),l.a.createElement(h.a,{text:"OPEN",color:"c-button-primary",onPress:function(){u.default.openUrl(a)}})))}))},,,,,,,,,,function(e,t,a){"use strict";a.r(t);var n=a(51),r=a.n(n),i=a(5),o=a.n(i),s=a(12),l=a.n(s),u=a(16),c=a.n(u),d=a(52),h=a.n(d),f=a(0),p=a(3),g=a.n(p),m=a(63),v=a(32),y=a(17),k=a(71),_=a(57);t.default=Object(y.b)((function(e){var t=e.type,a=e.title,n=e.text,i=e.fields,s=e.noCancel,u=e.validate,d=e.callback,y=h()(e,["type","title","text","fields","noCancel","validate","callback"]),b=Object(p.useRef)(!1),w=[];i.forEach((function(e,t){w[t]=Object(p.useRef)()}));var S=Object(p.useState)(),D=c()(S,2),P=D[0],I=D[1];Object(p.useEffect)((function(){return function(){E([])}}),[]);var E=function(e){b.current||(b.current=!0,null===d||void 0===d||d(e),v.b.closeMenu(t))},C=function(){var e=l()(o.a.mark((function e(){var t,a;return o.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return t=w.map((function(e){return e.current.getValue()})),e.next=3,null===u||void 0===u?void 0:u(t);case 3:(a=e.sent)?I(a):E(t);case 5:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}(),x=f.default.classNames("p-4 c-foreground",{"absolute inset-0 flex flex-col items-center justify-center":s});return g.a.createElement(k.a,r()({classNameContent:x,type:t,fullscreen:s},y),g.a.createElement("div",{style:{maxWidth:460}},a&&g.a.createElement("div",{className:"pb-6 font-bold text-18"},a),n&&g.a.createElement("div",{className:"pb-4"},n),i.map((function(e,t){return g.a.createElement(m.a,{key:t,focused:0===t,ref:w[t],type:e.type,placeholder:e.placeholder,value:e.value,className:"mb-4",onEnter:t===i.length-1&&C})})),P&&g.a.createElement("div",{className:"mt-2 error"},P),g.a.createElement("div",{className:"flex justify-center"},g.a.createElement(_.a,{color:"c-button-primary",text:"OK",onPress:C}),!s&&g.a.createElement(_.a,{text:"CANCEL",onPress:function(){return E([])},className:"ml-6"}))))}))},function(e,t,a){"use strict";a.r(t);var n=a(3),r=a.n(n),i=a(17),o=a(71),s=a(57),l=a(49);t.default=Object(i.b)((function(e){var t=e.type,a=e.text,i=e.onClosed,u=Object(n.useRef)(!1),c=function(e){return function(){u.current=e,l.a.closeMenu(t)}};return Object(n.useEffect)((function(){return function(){i(u.current)}})),r.a.createElement(o.a,{type:t,title:"Confirm"},r.a.createElement("div",{className:"p-4"},a,r.a.createElement("div",{className:"flex justify-center pt-4"},r.a.createElement(s.a,{mode:"contained",text:"NO",padding:"px-6 py-3",className:"mr-6",onPress:c(!1)}),r.a.createElement(s.a,{mode:"contained",text:"YES",padding:"px-6 py-3",primary:!0,onPress:c(!0)}))))}))},function(e,t,a){"use strict";a.r(t);var n=a(16),r=a.n(n),i=a(0),o=a(2),s=a(3),l=a.n(s),u=a(4),c=a(159),d=a(149),h=a(17),f=a(22),p=a(71),g=a(57),m=a(49);t.default=Object(h.b)((function(e){var t=e.type,a=Object(f.a)(u.default.dropBucket.items,u.default.DragDrop.dragging),n=r()(a,2),s=n[0],h=n[1],y=function(e){return function(){u.default.dropBucket.hasItemEntry(e.item)&&(u.default.dropBucket.removeItemEntry(e.item.id),u.default.dropBucket.hasItems()||m.a.closeMenu(t))}},k="flex-1 py-4 pr-1",_=s.map((function(e){return l.a.createElement("div",{key:e.id,style:v,className:"flex items-center dropBucket"},l.a.createElement(c.a,{className:"flex-1",pane:e.pane,dragOptions:{id:e.id,item:e.item,pane:e.pane,onDrop:y(e)}},i.default.isVMLI(e.item)?l.a.createElement(d.a,{item:e.item,numberOfLines:4,className:k}):l.a.createElement("div",{className:k},e.item.text)),l.a.createElement(g.a,{icon:"MdClose",iconSize:24,width:o.a.Mobile.TopBarHeight,height:o.a.Mobile.TopBarHeight,onPress:y(e)}))}));return l.a.createElement(p.a,{type:t,noBackdrop:(null===h||void 0===h?void 0:h.items.length)>0,title:"Clipboard"},l.a.createElement("div",{className:"pb-8 pl-4"},_))}));var v={minHeight:48}},function(e,t,a){"use strict";a.r(t);var n=a(3),r=a.n(n),i=a(17),o=a(71);t.default=Object(i.b)((function(e){var t=e.type,a=e.text,i=e.onClosed,s=Object(n.useRef)(!1);return Object(n.useEffect)((function(){return function(){i(s.current)}})),r.a.createElement(o.a,{type:t,title:"Alert"},r.a.createElement("div",{className:"p-4"},a))}))},function(e,t,a){"use strict";a.r(t);var n=a(16),r=a.n(n),i=a(0),o=a(3),s=a.n(o),l=a(4),u=a(79),c=a(2),d=a(28),h=a(32),f=a(17),p=a(135),g=a(22),m=Object(f.b)((function(){var e=l.default.DragDrop,t=Object(g.a)(e.dragging,e.dropSucceeded,l.default.dropBucket.items),n=r()(t,3),i=n[0],u=(n[1],n[2]),f=!!(null===i||void 0===i?void 0:i.items),m=Object(d.d)(),v=Object(d.d)();Object(p.a)(e.draggingPosition,(function(t){if(t){var a=t.x,n=t.y,r=e.dragging.get().positionOffset;v.set({x:a-r.x,y:n-r.y})}})),Object(p.a)(e.linePosition,(function(e){if(e){var t=e.left,a=e.top,n=e.width,r=e.height;m.set({x:t,y:a,width:n,height:r||4,borderWidth:r?3:0,backgroundColor:r?null:c.a.ColorBrand,opacity:1})}else m.set({opacity:0})}));var y=Object(o.useMemo)((function(){return null===i||void 0===i?void 0:i.items.map((function(e){return e.element}))}),[null===i||void 0===i?void 0:i.items]),k=null,_=null,b=null,w=Object(o.useCallback)((function(){var t=e.dragging.get(),a=t.pane,n=t.items;null===n||void 0===n||n.forEach((function(e){l.default.dropBucket.addItemEntry(e.item,a)}))}),[]),S=Object(o.useCallback)((function(){h.b.openMenu({type:"DropBucket"})}),[]);if(f||u.length>0){var D=a(173).default;b=s.a.createElement(D,{role:"dropBucket",onPress:S,onUp:w,text:f?"Clipboard":u.length?u.length:void 0})}if(f){var P=i.width,I=(i.positionOffset,{width:P}),E={transition:{duration:0}};k=s.a.createElement(d.b.div,{key:"dragging",className:"fixed z-10 opacity-75 pointer-events-none select-none dragging fontPane c-background c-shadow-popup",style:I,exit:E,animate:v},y),_=s.a.createElement(d.b.div,{key:"dragLine",id:"dragLine",animate:m})}return s.a.createElement(s.a.Fragment,null,s.a.createElement(d.a,null,k),b,_)})),v=a(5),y=a.n(v),k=a(12),_=a.n(k),b=a(51),w=a.n(b),S=a(52),D=a.n(S),P=a(35),I=a(9),E=a(66),C=a(63),x=a(92),A=a(148),T=function(e){var t=e.className,a=D()(e,["className"]);return s.a.createElement(E.a,w()({iconSize:18,className:i.default.classNames("mx-auto c-shadow-medium pl-4",t),iconPadding:"pr-4",mode:"contained",width:210,height:40,styleText:{width:140,textAlign:"left"},align:"left"},a))},M=function(e){var t=e.className,a=D()(e,["className"]);return s.a.createElement(E.a,w()({iconSize:18,className:i.default.classNames("mx-auto shadow-lg",t),mode:"contained",width:180,height:40},a))},L=Object(f.b)((function(){var e,t=Object(o.useRef)(),a=Object(o.useRef)(),n=Object(o.useRef)(),u=l.default.setup,c=Object(g.a)(u.popupClosedError,u.loggedOutByAuthFailure),d=r()(c,2),h=d[0],f=d[1],p=Object(x.a)().theme,m=Object(o.useState)(!1),v=r()(m,2),k=v[0],b=v[1],w=Object(o.useState)(!1),S=r()(w,2),D=S[0],L=S[1],R=Object(o.useState)(),F=r()(R,2),N=F[0],B=F[1],j=Object(o.useState)(!1),U=r()(j,2),H=U[0],V=U[1],W=I.a.isiOS&&I.a.app&&I.a.majorVersion>=13,z=function(){var e=_()(y.a.mark((function e(){var n,r;return y.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(n=t.current.getValue(),r=a.current.getValue(),n&&i.default.isEmail(n)){e.next=6;break}B("Invalid email address."),e.next=14;break;case 6:if(r){e.next=10;break}B("Invalid password."),e.next=14;break;case 10:return V("email"),e.next=13,P.a.signInWithEmail(n,r);case 13:V(!1);case 14:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}(),q=function(){var e=_()(y.a.mark((function e(){var a;return y.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if((a=t.current.getValue())&&i.default.isEmail(a)){e.next=5;break}B("Invalid email address."),e.next=14;break;case 5:return B(""),e.next=8,l.default.menus.confirm("Would you like to receive an email to reset your password?");case 8:if(!e.sent){e.next=14;break}return e.next=12,P.a.sendResetEmail(a);case 12:e.sent&&l.default.menus.alert({text:"Password reset email sent."});case 14:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}(),G=function(){var e=_()(y.a.mark((function e(){return y.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return V("google"),e.next=3,P.a.signInWithGoogle();case 3:V(!1);case 4:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=_()(y.a.mark((function e(){return y.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:return V("apple"),e.next=3,P.a.signInWithApple();case 3:V(!1);case 4:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}(),Y=h?s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"popupClosedError red center"},h.message),h.message2&&s.a.createElement("div",{className:"popupClosedError"},h.message2),h.learnMore&&s.a.createElement("div",{className:"popupClosedError"},s.a.createElement("a",{target:"_blank",href:h.learnMore},"Learn more"))):N&&s.a.createElement("div",{className:"popupClosedError red center"},N);e=k?s.a.createElement("div",{className:"pt-2 pb-8"},s.a.createElement("div",{className:"flex items-center pb-6 font-medium text-20"},s.a.createElement(E.a,{icon:"IoIosArrowBack",onClick:function(){return b(!1)}}),D?"Sign up with email":"Sign in with email"),s.a.createElement("div",{className:"px-4"},s.a.createElement(C.a,{floatingText:"Email address",height:48,fontSize:15,focused:!0,type:"email",autoComplete:"username",ref:t}),s.a.createElement(C.a,{floatingText:"Password",height:48,type:"password",className:"mt-2",fontSize:15,onEnter:z,ref:a}),D&&s.a.createElement(C.a,{floatingText:"Confirm Password",height:48,type:"password",className:"mt-2",fontSize:15,onEnter:z,ref:n}),s.a.createElement("div",{className:"px-2 py-6 text-right cursor-pointer",onClick:q},s.a.createElement("a",{className:"font-medium link c-blue"},"Forgot Your Password?")),Y,s.a.createElement(M,{text:H?"Signing in...":D?"Sign up":"Login",className:"mx-auto mt-4 mb-6 font-bold",primary:!0,onClick:D?function(){var e=t.current.getValue(),r=a.current.getValue(),o=n.current.getValue();e&&i.default.isEmail(e)?r?r.length<5?B("Please use a longer password."):o&&r===o?(B(""),P.a.createUserWithEmailAndPassword(e,r)):B("Passwords do not match."):B("Invalid password."):B("Invalid email address.")}:z}),s.a.createElement("div",{className:"textInLine c-background"},s.a.createElement("div",null,"or")),s.a.createElement(M,{text:D?"Login":"Sign up",className:"mx-auto mt-6 font-bold",onClick:D?function(){return L(!1)}:function(){return L(!0)}}),s.a.createElement(A.a,null))):s.a.createElement("div",{className:"px-4 py-8"},s.a.createElement("div",{id:"setupLogo",className:p}),s.a.createElement(T,{iconSrc:"/img/google.svg",text:"google"===H?"Signing in...":"Sign in with Google",className:"mx-auto mt-4 font-bold c-bg-white",style:{color:"light"===p?"#555":"#000"},onClick:G}),W&&s.a.createElement(T,{icon:"FaApple",text:"apple"===H?"Signing in...":"Sign in with Apple",className:"mx-auto mt-6 font-bold",style:{backgroundColor:"light"===p?"#000":"#fff",color:"light"===p?"#fff":"#000"},onClick:K}),s.a.createElement(T,{icon:"MdEmail",text:"Sign in with email",className:"mx-auto mt-6 font-bold",primary:!0,onClick:function(){return b(!0)}}),Y,f&&s.a.createElement("div",{className:"popupClosedError"},"Logged out due to an error connecting to Google. If you are using a privacy plugin such as Ghostery or Privacy Badger, please disable them or download the app below."),u.showDownload&&s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"py-8 textInLine c-background"},s.a.createElement("div",null,"or")),s.a.createElement("div",{id:"setupDownloadArea"},s.a.createElement(T,{icon:I.a.getPlatformIcon(),text:"Download App",className:"mx-auto font-bold",color:"c-foreground-white",style:{backgroundColor:"#2a2a2a"},onClick:function(){return l.default.openUrl(I.a.getAppDownloadURL())}}))),!(I.a.isiOS&&I.a.app)&&s.a.createElement("div",{className:"mt-8 text-sm c-foreground center"},"Learn more at ",s.a.createElement("a",{href:"https://www.moo.do",className:"cursor-pointer link c-blue-dark",onClick:function(e){i.default.preventAndStop(e),l.default.openUrl("https://www.moo.do")}},s.a.createElement("b",null,"https://moo.do"))));var X=i.default.classNames("absolute inset-0 z-0 flexbox flexvert c-bg-app",{"px-3":!0});return s.a.createElement("div",{className:X,style:O.setupWrapper},s.a.createElement("div",{className:"max-w-full mx-auto",style:O.setupInner},s.a.createElement("div",{className:"rounded-lg c-background c-foreground c-shadow-medium"},e)))})),O={setupWrapper:{WebkitAppRegion:"drag"},setupInner:{width:380}},R=a(29),F=Object(f.b)((function(e){var t=e.toast,a=e.paneToast;t||(t=a);var n=Object(g.a)(t.text),o=r()(n,1)[0],l=!!t.actionText,u=i.default.classNames("toast c-darkPopup noSelect rounded",{hasAction:l},{big:t.isBig});return s.a.createElement("div",{className:u,style:undefined,onClick:t.onTapIgnore},!t.noClose&&s.a.createElement(R.a,{width:40,height:40,icon:"icon-close",className:"messageClose",onClick:t.onTapIgnore&&t.onTapIgnore}),s.a.createElement("span",{className:"messageText f1",dangerouslySetInnerHTML:{__html:o}}),s.a.createElement(R.a,{primary:!0,className:"messageAction noShrink",onClick:t.doAction},t.actionText),t.action2&&s.a.createElement(R.a,{primary:!0,className:"messageAction noShrink",onClick:t.action2.action},t.action2.text))})),N=Object(f.b)((function(){var e=Object(g.a)(l.default.toasts.queue),t=r()(e,1)[0];return s.a.createElement("div",{id:"toasts",className:"absolute inset-x-0 bottom-0 mb-4 pointer-events-none"},t.map((function(e){return s.a.createElement(F,{key:e.id,toast:e})})))})),B=a(27),j=a(182),U=a(25),H=a(65),V=a(7),W=a.n(V),z=a(8),q=a.n(z),G=a(20),K=a.n(G),Y=a(21),X=a.n(Y),Q=a(13),J=a.n(Q),Z=a(125),$=a(33),ee=a(56),te=a(70),ae=a(45);function ne(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=J()(e);if(t){var r=J()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return X()(this,a)}}var re=function(e){K()(a,e);var t=ne(a);function a(){return W()(this,a),t.apply(this,arguments)}return q()(a,[{key:"init",value:function(){var e=this.props,t=e.item;e.renderLikePane&&(this.styleProps=t.styleProps(e.pane)),this.refElement=Object(o.createRef)(),this.refEditable=Object(o.createRef)()}},{key:"onMount",value:function(){var e=this.props,t=e.item;this.listenTo(t.itemChanged);try{i.default.PAssert(1352,e.pane||!e.renderLikePane&&!e.padded,"Should not use these props if no pane")}catch(a){i.default.reportError(a)}if(this.props.editable){this._needsSelect=isNaN(e.selectIndex)?t.getParsedText().length:e.selectIndex;try{$.default.selectElement(this.getEditable(),this._needsSelect)}catch(n){i.default.reportError(n,{needsSelect:this._needsSelect,selectIndex:e.selectIndex,length:t.getParsedText().length})}}}},{key:"getEditable",value:function(){return this.refEditable.current}},{key:"getElement",value:function(){return this.refElement.current.getElement()}},{key:"getState",value:function(){var e=this.props,t=e.pane,a=e.item,n={flags:a.flags,renderLikePane:e.renderLikePane,styleProps:this.styleProps,priorityProps:e.showPriority&&a.getPriorityProps(),isComplete:a.isComplete(),hasPrefix:a.hasPrefix(),date:a.getMooDate(),lines:[a.getStyledTextAsOneLine()]};return e.allowDrag&&(n.draggedInPane=a.draggedInPane,n.isBeingDragged=a.draggedInPane.get()===t),n}},{key:"focus",value:function(){var e=this.props.item.getParsedText().length;$.default.selectElement(this.getEditable(),e)}},{key:"onKeyDown",value:function(e){var t=this.props,a=t.item;e.keyCode===c.a.KeyCode.Backspace&&this.state.hasPrefix&&""===a.getParsedTextWithoutPrefix()&&a.setText("",!1!==t.shouldSave?c.a.ChangeType.Local:c.a.ChangeType.Auto),t.onKeyDown&&t.onKeyDown(e)}},{key:"onKeyPress",value:function(e){var t=this.props;if(t.onKeyPress&&(t.onKeyPress(e),!e.defaultPrevented)){var a=this.props.item,n=$.default.getSelectionRangeNative(),r=$.default.getSelectOffsetsInElement(e.target,n);if(this._needsSelect=void 0,r.start!==r.end){var i=a.getParsedText(),o=i.substr(0,r.start)+i.substr(r.end);a.setText(o,!1!==t.shouldSave?c.a.ChangeType.Local:c.a.ChangeType.Auto),this._needsSelect=r.start}}}},{key:"componentDidUpdate",value:function(){if(!isNaN(this._needsSelect)){var e,t=this.getEditable(),a=t.innerHTML;(a.indexOf("<br")>=0||a.indexOf("></span>")>0||""===a)&&(t.innerHTML=this.getRenderedHtml());var n=null===(e=window.getSelection())||void 0===e?void 0:e.focusNode;n&&i.default.isAncestor(n,this.getEditable())&&$.default.selectElement(t,Math.min(t.textContent.length,this._needsSelect)),this._needsSelect=void 0}}},{key:"convertElementToText",value:function(e){var t="";if(e.nodeType===Node.TEXT_NODE)t+=e.nodeValue;else if(e.classList.contains("plugin"))t+=c.a.AttachChar;else for(var a=0,n=0;n<e.childNodes.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t+=this.convertElementToText(e.childNodes[n])}return t}},{key:"stopResizing",value:function(){this.isResizing=!1}},{key:"onInput",value:function(e){e.target.innerHTML.indexOf("<br")>=0&&(e.target.innerHTML=e.target.innerHTML.replace("<br/>","").replace("<br>",""));var t=this.props.item,a=this.convertElementToText(e.target).replace(new RegExp(c.a.TextSpace,"g"),""),n=$.default.getSelectionRangeNative();if(n){var r=$.default.getSelectOffsetsInElement(e.target,n);this._needsSelect=r.start}t.setText(a,c.a.ChangeType.Local),this.updateAutocomplete(),e.preventDefault()}},{key:"updateAutocomplete",value:function(){var e=this.getEditable(),t=this.props.autocompleteMode;if(t){var a=$.default.getSelectionInElement(e);if(a&&a.start===a.end){this.selectionBeforeDate=i.default.clone(a);var n=this.props.item,r=n.getPrefixLength();a.start-=r,a.end-=r,a.total-=r,ee.a.update({mode:t,text:this.convertElementToText(e).replace(new RegExp(c.a.TextSpace,"g"),""),offset:a.start,paneObject:this.props.paneObject,item:n,owner:this,pane:this.props.pane,positionOffset:this.props.positionOffset,elementDisplay:e,elementInput:e,onDatePickerClosed:this.onDatePickerClosed,supportSearchItemAutocomplete:this.props.supportSearchItemAutocomplete})}}}},{key:"onDatePickerClosed",value:function(){var e=this.getEditable();if(this.props.item.getRawText().includes(c.a.CharDate)){var t=this.props.item.getParsedText();t.length>0&&t!==c.a.TextSpace&&requestAnimationFrame((function(){e.focus(),$.default.selectElement(e,e.textContent.length)}))}else if(this.selectionBeforeDate){var a=this.selectionBeforeDate,n=a.start,r=a.end;$.default.selectElement(e,n,r)}}},{key:"onAutocompleteSelected",value:function(e){var t=this;void 0!==e.value&&(this.props.item.setText(e.value,c.a.ChangeType.Local),requestAnimationFrame((function(){$.default.selectElement(t.getEditable(),e.offset)})))}},{key:"onClick",value:function(e){if(!this.isResizing){var t=this.props,a=t.item,n=t.pane,r=t.editOnClick,o=t.editable,s=t.inItemDetails;if(l.default.menus.isContextMenuOpen("ReactContextMenuContactDetails")&&l.default.menus.closeContextMenu("ReactContextMenuContactDetails"),r)e.preventDefault(),e.stopPropagation(),l.default.menus.isContextMenuOpen()&&l.default.menus.closeContextMenu(),l.default.menus.openContextMenu({componentName:"ReactItemDetailsPopup",element:e.target,item:a,pane:n});else{var u=!0;if((o||s)&&n){var d=a.elsNew.elements.find((function(e){return e.props.plugin}));d&&(u=!l.default.pluginManager.handleTapClick(d,{item:a,pane:n},e)),u&&i.default.findParent(e.target,"inlineDate",2)&&l.default.menus.openDate({element:e.target,item:a,pane:n})}if(u&&!s&&i.default.hasClass(e.target,"contact")){var h=e.target.textContent,f=te.a.findMatchExact(h[0]===c.a.ContactPrefix?h.substr(1):h);f&&l.default.menus.openContextMenu({componentName:"ReactContextMenuContactDetails",element:e.target,contact:f})}}}}},{key:"onMouseDownResize",value:function(e,t){t.button===c.a.ButtonCode.Left&&(this.isResizing=this.props.onItemResizeStart(this.props.item,this,e)),i.default.preventDefault(t)}},{key:"onMouseDown",value:function(e){if(e.button===c.a.ButtonCode.Left){var t=this.props,a=t.item;this.isResizing=!1,t.allowDrag&&a.checkDragOnStart(e)}}},{key:"onMouseMove",value:function(e){!this.isResizing&&this.props.allowDrag&&this.props.item.checkDragOnMove(e,!1)}},{key:"onMouseUp",value:function(e){!this.isResizing&&this.props.allowDrag&&this.props.item.checkDragOnEnd(e)}},{key:"onClickDate",value:function(){l.default.menus.openDate({element:this.getEditable(),item:this.props.item,pane:this.props.pane})}},{key:"onRightClick",value:function(e){var t=this.props;t.pane&&!1!==t.allowDrag&&(l.default.menus.openContextMenu({componentName:"ReactContextMenuItem",key:"contextMenuItem"+this.props.item.id,element:e.target,item:this.props.item,pane:this.props.pane,pos:{left:e.clientX,top:e.clientY},paneObject:this.props.paneObject}),e.preventDefault(),e.stopPropagation())}},{key:"getRenderedHtml",value:function(){for(var e,t=0,a=this.props,n=a.item,r=this.state.lines,i=n.getParsedTextWithoutPrefix().length>0,o="",s=0;s<r.length;++s){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(a.renderLikePane){var u=l.default.DisplaySettings.itemPadding();e="padding-top: "+(0===s?u+"px":0)+"; padding-bottom: "+(s===r.length-1?(a.noNotes?u:l.default.DisplaySettings.paddingForItemBottom())+"px":0)+";"}else e="padding-top: 2px; padding-bottom: 2px";o+='<span class="line'.concat(s===r.length-1?" last":"",'" style="').concat(e,'">').concat(r[s]||c.a.TextSpace).concat(i?"":c.a.TextSpace,"</span>")}return o}},{key:"render",value:function(){var e=this.props,t=e.item,a=this.state,n=e.editable&&l.default.pluginManager.allowTextEditing(t),r=i.default.classNames("reactItemWrapper flexbox",e.className,e.coloredInCalendar&&"colored"),o=i.default.classNames("item itemNotInPane f1",a.styleProps,a.priorityProps,{hasPrefix:a.hasPrefix},{"itemBeingDragged c-bg-light":a.isBeingDragged},{autoSelect:n},{complete:a.isComplete},{"c-bg-dark":a.isComplete&&e.coloredInCalendar}),u={};a.renderLikePane&&e.padding&&(u.paddingLeft=e.padding);var d,h=this.getRenderedHtml();if(e.style&&(u=i.default.extend(e.style,u)),e.coloredInCalendar&&!a.isBeingDragged){if(!a.isComplete){var f,p=t.getCalendarColor();(null===(f=p)||void 0===f?void 0:f.startsWith("#"))&&(p="rgba(".concat(i.default.hexToRgbStr(p),",0.75)")),u.backgroundColor=p}var g=t.getCalendarDisplayProps();if(g)for(var m in g.style)if(g.hasOwnProperty(m)){try{i.default.PAssert(1353,!u[m],"Calendar display prop overwriting default styling")}catch(b){i.default.reportError(b)}u[m]=g.style[m]}}if(this.state.date&&e.inItemDetails&&!this.props.item.getRawText().includes(c.a.CharDate)){var v=this.state.date,y=v.isRepeatDate(),k=v.toText(!0),_=i.default.classNames("itemTime c-date pointer");d=s.a.createElement("div",{className:_,onClick:this.onClickDate},v.getGCalId()&&s.a.createElement("i",{className:"icon-calendar"}),y&&s.a.createElement("i",{className:"icon-spinner"}),k)}return s.a.createElement(Z.a,{"data-moo-id":this.getUniqueID(),className:r,ref:this.refElement},s.a.createElement("span",{className:o,style:u,contentEditable:n,onClick:e.editOnClick||n||e.inItemDetails?this.onClick:void 0,onKeyDown:n?this.onKeyDown:void 0,onKeyPress:n?this.onKeyPress:void 0,onInput:n?this.onInput:void 0,onMouseDown:n?void 0:this.onMouseDown,onMouseMove:n?void 0:this.onMouseMove,onMouseUp:n?void 0:this.onMouseUp,onContextMenu:this.onRightClick,tabIndex:e.tabIndex,dangerouslySetInnerHTML:{__html:h},ref:this.refEditable}),d,e.resizable&&s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"absolute inset-x-0 top-0 h-2 pointer-events-auto cursor-row-resize",onMouseDown:this.onMouseDownResize.bind(this,!1)}),s.a.createElement("div",{className:"absolute inset-x-0 bottom-0 h-2 pointer-events-auto cursor-row-resize",onMouseDown:this.onMouseDownResize.bind(this,!0)})))}}]),a}(ae.a),ie=a(59),oe=function(e,t){var a=Object(o.useRef)();Object(o.useEffect)((function(){a.current=e}),[e]),Object(o.useEffect)((function(){if(null!==t){var e=setInterval((function(){return a.current.apply(a,arguments)}),t);return function(){return clearInterval(e)}}}),[t])};var se=Object(f.b)((function(e){var t=e.blockHeight,a=function(){var e=new Date,t=Object(o.useState)(e),a=r()(t,2),n=a[0],i=a[1],s=1e3*(60-e.getSeconds());return oe((function(){i(new Date)}),s),n}(),n={top:Math.floor((a.getHours()+a.getMinutes()/60)*t)};return s.a.createElement("div",{className:"calendarDayTimeLineWrap absolute w-full inset-x-0 pointer-events-none",style:n},s.a.createElement("div",{className:"calendarDayTimeLineTime absolute w-20 text-right font-bold"},s.a.createElement("div",{className:"relative inline-block",style:{paddingLeft:"0.4rem",paddingTop:"0.125rem",paddingBottom:"0.125rem",marginTop:"-0.125rem"}},s.a.createElement("div",{className:"c-background opacity-75 absFull rounded"}),s.a.createElement("div",{className:"relative"},l.default.International.formatDate(a,c.a.DFormat.ShortTime)))),s.a.createElement("div",{className:"calendarDayTimeCircle absolute"}),s.a.createElement("div",{className:"calendarDayTimeLine"}))}));function le(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=J()(e);if(t){var r=J()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return X()(this,a)}}var ue=function(e){K()(a,e);var t=le(a);function a(){return W()(this,a),t.apply(this,arguments)}return q()(a,[{key:"init",value:function(){this.createObservables({hoveredTime:void 0,hoveredDuration:void 0,resizingPlacement:void 0}),this.listenToDispatcher("dateChanged"),this.listenToDispatcher("endDrag")}},{key:"arePropsEqual",value:function(e,t,a){return"items"===e?t===a||t&&a&&t.length===a.length:"date"===e?t===a||t&&a&&t.equals(a):void 0}},{key:"areStatesEqual",value:function(e,t,a){if("items"===e){var n=0;if(!t||!a||t.length!==a.length)return!1;for(var r=0;r<t.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(!t[r].date||!a[r].date||!t[r].date.equals(a[r].date)||t[r].item!==a[r].item||t[r].duration!==a[r].duration)return!1}return!0}}},{key:"componentWillReceiveProps",value:function(e){(!e.date.equals(this.props.date)||e.items!==this.props.items&&(e.items.length>0||this.props.items.length>0))&&this.updateState(e)}},{key:"getState",value:function(e){var t={isToday:U.a.isToday(e.date),numAllDay:e.pane.numAllDay};if(t.heightHeader=e.pane.getHeightAllDay(),e.items){var a=0;t.items=[];for(var n=0;n<e.items.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e.items[n];if(!r.isNote()){var i=r.getNextDate(this.props.date);if(i){var o=i.clone();t.items.push({date:o,duration:r.getDuration(),item:r})}}}}return t}},{key:"onMount",value:function(){this.state.isToday&&this.runTimeTimer()}},{key:"onUnmount",value:function(){clearTimeout(this.timeTimeout)}},{key:"componentDidUpdate",value:function(e){this.props.date.equals(e.date)||(this.hoveredDuration.set(void 0,!1),this.hoveredTime.set(void 0))}},{key:"onBeforeChanged",value:function(e,t){return e.isToday?this.runTimeTimer():t.isToday&&!e.isToday&&clearTimeout(this.timeTimeout),void 0===t.hoveredTime||l.default.DragDrop.isDragging||this.resizing||(this.hoveredTime.set(void 0,!1),this.hoveredDuration.set(void 0,!1),e.hoveredTime=void 0,e.hoveredDuration=void 0),e}},{key:"runTimeTimer",value:function(){clearTimeout(this.timeTimeout),this.timeTimeout=setTimeout(this.updateState,3e5)}},{key:"resetHovered",value:function(){this.resizing&&(this.resizing.component&&this.resizing.component.stopResizing(),this.resizing=void 0,this.resizingPlacement.set(void 0),l.default.DesktopUI.cursor.set(void 0)),this.mouseDownAtTime=void 0,this.hoveredDuration.set(void 0,!1),this.hoveredTime.set(void 0)}},{key:"onMouseUp",value:function(e){if(document.removeEventListener("mouseup",this.onMouseUp),this.resizing&&this.resizing.placeholder)this.addTime(this.hoveredTime.get(),this.hoveredDuration.get(),e);else{if(this.resizing&&this.state.resizingPlacement){var t=Object.assign({isDate:!0},this.state.resizingPlacement);l.default.PaneUpdateBatcher.beginUpdateItems();var a=this.props.pane;a.applyDropOnBlock(t,[this.resizing.item],a),l.default.PaneUpdateBatcher.commitUpdateItems()}this.resetHovered()}}},{key:"onMouseLeave",value:function(){this.resizing||this.resetHovered()}},{key:"getTimeFromMouseEvent",value:function(e){var t=e.clientY;return l.default.DragDrop.isDragging&&l.default.DragDrop.startPane&&l.default.DragDrop.startPane.isViewDates()&&l.default.DragDrop.startInfo&&(t+=12-(l.default.DragDrop.startInfo.y-l.default.DragDrop.position.top)),t-=i.default.findParent(e.target,"calendarDayTimes").getBoundingClientRect().top,Math.floor(t/(c.a.CalendarDayViewBlockHeight+1)*4)/4}},{key:"onMouseDown",value:function(e){document.addEventListener("mouseup",this.onMouseUp),i.default.hasClass(e.target,"calendarDayTimes")&&(this.mouseDownAtTime=this.getTimeFromMouseEvent(e)),e.preventDefault()}},{key:"onMouseMove",value:function(e){if(void 0!==this.mouseDownAtTime&&(this.resizing={placeholder:!0,pivot:this.mouseDownAtTime},this.mouseDownAtTime=void 0),l.default.DragDrop.isDragging||l.default.DragDrop.dragging.get()){var t=this.getTimeFromMouseEvent(e);if(!isNaN(t)){var a=1,n=l.default.DragDrop.dragItem;n&&n.getDuration()&&(a=n.getDuration()/c.a.MSPerHour),this.hoveredDuration.set(a,!1),this.hoveredTime.set(t);var r=this.props.date.clone();r.setHours(Math.floor(t)),r.setMinutes(60*(t-Math.floor(t))),0===t&&r.setMilliseconds(1),l.default.DragDrop.setBlockTarget({pane:this.props.pane,date:r,dateTime:r,duration:1!==a?a*c.a.MSPerHour:null,isDate:!0})}}else if(this.resizing){var i=this.getTimeFromMouseEvent(e);if(!isNaN(i)){var o=this.resizing,s=o.pivot,u=i>=s?s:i,d=Math.floor(4*(i>=s?i-s+.5:s-i))/4;if(!isNaN(u)&&d>=.25)if(o.item){var h=this.props.date.clone();h.setHours(Math.floor(u)),h.setMinutes(Math.round(60*(u-Math.floor(u)))),0===u&&h.setMilliseconds(1),this.resizingPlacement.set({date:h,duration:d*c.a.MSPerHour})}else o.placeholder&&(d===this.hoveredDuration.get()&&u===this.hoveredTime.get()||(this.hoveredDuration.set(d,!1),this.hoveredTime.set(u,!0)))}}}},{key:"onMouseEnterAllDay",value:function(){if(l.default.DragDrop.isDragging){var e=this.props.date;this.hoveredDuration.set(1,!1),this.hoveredTime.set(-1),l.default.DragDrop.setBlockTarget({pane:this.props.pane,date:e,isDate:!0,allDay:!0})}}},{key:"onDoubleClickTimes",value:function(e){var t=this.getTimeFromMouseEvent(e);this.addTime(t,1,e)}},{key:"addTime",value:function(e,t,a){var n=this.props,r=n.pane,i=n.date.clone(),o=r.item.get();e&&(i=i.addHours(e));var s=new ie.a(i,{duration:t*c.a.MSPerHour});r.openItemEditor({element:a.target,text:" "+c.a.CharDate,parent:o,selectIndex:0,mooDate:s,pos:{left:a.clientX,top:a.clientY},addOnSave:!0,onClosed:this.resetHovered})}},{key:"onItemResizeStart",value:function(e,t,a){if(e.hasTime()){var n=e.getTimeOfDay(),r=e.getDuration()/c.a.MSPerHour||1,o=i.default.round(n/c.a.MSPerHour,4),s=a?o:o+r;return this.resizing={item:e,component:t,pivot:s},l.default.DesktopUI.cursor.set("row-resize"),!0}}},{key:"addToDay",value:function(e,t,a,n){e.push({t:t,dur:a,item:n,top:t,bottom:t+a,obj:n})}},{key:"packItems",value:function(e){var t=0;e=e.sort((function(e,t){return e.top<t.top?-1:e.top>t.top?1:e.bottom<t.bottom?-1:e.bottom>t.bottom?1:0}));for(var a=[],n=[],r=null,i=0;i<e.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=e[i];if(o.isPlaceholder)n=n.concat.apply(n,this.packEvents([[o]]));else{var s=0;null!==r&&o.top>=r&&(this.packEvents(a),n=n.concat.apply(n,a),a=[],r=null);for(var l=!1,u=0;u<a.length;u++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var c=a[u];if(!this.collidesWith(c[c.length-1],o)){c.push(o),l=!0;break}}l||a.push([o]),(null===r||o.bottom>r)&&(r=o.bottom)}}return a.length>0&&(this.packEvents(a),n=n.concat.apply(n,a)),n}},{key:"packEvents",value:function(e){for(var t=0,a=e.length,n=0;n<a;n++){var r=0;if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;for(var i=e[n],o=0;o<i.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=i[o],l=this.expandEvent(s,n,e);s.pos=n/a*100,s.width=100*l/a}}return e}},{key:"collidesWith",value:function(e,t){return e.bottom>t.top&&e.top<t.bottom}},{key:"expandEvent",value:function(e,t,a){for(var n=0,r=1,i=t+1;i<a.length;i++){var o=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var s=a[i],l=0;l<s.length;l++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u=s[l];if(this.collidesWith(e,u))return r}r++}return r}},{key:"renderItems",value:function(){for(var e=0,t=this.props,a=this.state,n=a.resizingPlacement,r=t.pane,o=a.items,l=[],u=a.hoveredTime,d=a.hoveredDuration,h=0;h<o.length;h++){var f;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var p=o[h].item,g=(null===(f=this.resizing)||void 0===f?void 0:f.item)===p&&a.resizingPlacement?r.getDatePlacementOnDate(n.date,n.duration):r.getItemPlacementOnDate(p,t.date);g&&this.addToDay(l,g.time,g.duration,p)}isNaN(u)||isNaN(d)||l.push({t:u,dur:d,top:u,bottom:u+d,isPlaceholder:!0});var m,v=this.packItems(l);if(v.length){var y=0;m=[];for(var k=0;k<v.length;k++){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;var _=v[k],b=_.isPlaceholder,w={height:_.dur*c.a.CalendarDayViewBlockHeight+Math.ceil(_.dur)-1,left:b?0:_.pos+"%",width:b?"95%":_.width+"%",top:Math.floor(_.t*(c.a.CalendarDayViewBlockHeight+1))},S=i.default.classNames("dayTimeBlock abs",{placeholder:b});m.push(s.a.createElement("div",{className:S,key:b?"placeholder":_.item.id,style:w},_.item&&s.a.createElement(re,{className:"itemInCalendar itemInCalendarResizable",item:_.item,pane:r,coloredInCalendar:!0,showPriority:!0,resizable:!0,allowDrag:!0,onItemResizeStart:this.onItemResizeStart,editOnClick:!0})))}}return m}},{key:"renderItemsAllDay",value:function(){for(var e=0,t=this.props,a=this.state,n=a.items,r=t.pane,i=[],o=a.hoveredTime,l={},u=0;u<n.length;u++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var c=n[u].item;t.pane.getItemPlacementOnDate(c,t.date)||i.push(s.a.createElement("div",{className:"dayTimeBlock",key:c.id,style:l},s.a.createElement(re,{className:"itemInCalendar",item:c,pane:r,coloredInCalendar:!0,showPriority:!0,resizable:!0,allowDrag:!0,onItemResizeStart:this.onItemResizeStart,editOnClick:!0})))}return!isNaN(o)&&o<0&&i.push(s.a.createElement("div",{className:"dayTimeBlock placeholder",key:"placeholder"})),i}},{key:"render",value:function(){var e,t=this.props,a=this.state,n=t.date,r=0===n.getDay()||6===n.getDay(),o=this.renderItemsAllDay();a.isToday&&(e=s.a.createElement(se,{blockHeight:c.a.CalendarDayViewBlockHeight+1}));var l,u={width:t.width,left:t.style.left},d={top:a.heightHeader+30+3,height:t.height-a.heightHeader,width:t.width,left:t.style.left},h={height:a.heightHeader,minHeight:a.heightHeader},f=i.default.classNames("allDay c-border-heavy f1 preventScrollPropagate",{"c-bg-faded weekend":r}),p=i.default.classNames("calendarDayTimes c-border-heavy",{"c-bg-faded":r}),g=i.default.classNames("calendarDay",{"weekend c-bg-faded":r},{today:a.isToday},{resizing:!!a.resizingPlacement},t.className),m=t.width<110;return n.getYear()!==U.a.getToday().getYear()&&(l=n.toString(", yyyy")),s.a.createElement("div",{className:g},s.a.createElement("div",{className:"calendarDayHeader c-background c-border-heavy flexbox flexvert",style:u},s.a.createElement("div",{className:"dayTitle"},s.a.createElement("span",null,n.toString(m?"MMM ":"ddd MMM ")),s.a.createElement("span",{className:"dayTitleDay"},n.getDate()),l&&s.a.createElement("span",null,l)),s.a.createElement("ul",{className:f,style:h,onMouseEnter:this.onMouseEnterAllDay,onDoubleClick:this.addTime.bind(this,void 0,void 0),onMouseLeave:this.onMouseLeave},o)),s.a.createElement("div",{className:p,style:d,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onDoubleClick:this.onDoubleClickTimes,onMouseLeave:this.onMouseLeave},s.a.createElement("div",{className:"calendarDayGradient"}),s.a.createElement("div",{className:"calendarDayItems"},this.renderItems()),e))}}]),a}(ae.a),ce=Object(f.a)(Object(o.forwardRef)((function(e,t){var a=0,n=e.pane,l=e.height,u=e.showAllDay,c=Object(o.useRef)(),d=Object(g.a)(n.numAllDay),h=(r()(d,1)[0],n.getHeightAllDay());Object(o.useImperativeHandle)(t,(function(){return{scrollTo:function(e){return i.default.scrollElementTo(c.current,{top:e})}}}));for(var f={height:l},p={height:h+2},m={top:h+30+2},v=[],y=0;y<24;y++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var k=void 0;12===y?k="Noon":(k=0===y?12:y%12,k+=" "+(y>=12?"pm":"am")),v.push(s.a.createElement("div",{key:y,className:"time"},k))}return s.a.createElement("div",{className:"calendarTimes inset-l-0 inset-y-0 c-background",style:f},s.a.createElement("div",{className:"calendarTimesInner hideScrollbar c-border-heavy",style:m,ref:c},v),u&&s.a.createElement("div",{className:"calendarTimesAllDay c-border-heavy",style:p},"All day"))})));function de(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=J()(e);if(t){var r=J()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return X()(this,a)}}var he=function(e){K()(a,e);var t=de(a);function a(){return W()(this,a),t.apply(this,arguments)}return q()(a,[{key:"init",value:function(){B.a.listen("endDrag",this.onDragEnd),this.createObservables({isHovered:!1}),this.listenToDispatcher("dateChanged")}},{key:"arePropsEqual",value:function(e,t,a){return"items"===e?t===a||t&&a&&t.length===a.length:"date"===e?t===a||t&&a&&t.equals(a):void 0}},{key:"areStatesEqual",value:function(e,t,a){if("items"===e){var n=0;if(!t||!a||t.length!==a.length)return!1;for(var r=0;r<t.length;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(t[r].time!==a[r].time||t[r].item!==a[r].item)return!1}return!0}}},{key:"componentWillReceiveProps",value:function(e){e.items!==this.props.items&&this.updateState(e)}},{key:"getState",value:function(e){var t={};if(e.items){for(var a=0,n=[],r=[],o=0;o<e.items.length;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=e.items[o];if(!s.isNote()){var u=s.getNextDate(this.props.date),d=u&&u.hasTimeOfDay()&&u.toString(l.default.International.getFormat(c.a.DFormat.ShortTime));try{i.default.PAssert(1349,u,"itDate should be valid here",this.props.date)}catch(h){i.default.reportError(h)}d?r.push({time:d,item:s}):n.push({item:s})}}r.sort(e.pane.compareItemDate),t.items=n.concat(r)}return t}},{key:"onMouseDown",value:function(e){e.preventDefault()}},{key:"onMouseEnter",value:function(){if(l.default.DragDrop.isDragging||l.default.DragDrop.dragging.get()){var e;this.isHovered.set(!0);var t=null===(e=l.default.DragDrop.dragItem)||void 0===e?void 0:e.getDate(),a=1,n=l.default.DragDrop.dragItem;n&&n.getDuration()&&(a=n.getDuration()/c.a.MSPerHour),l.default.DragDrop.setBlockTarget({pane:this.props.pane,date:this.props.date,dateTime:t&&t.hasTimeOfDay()&&t,duration:1!==a?a*c.a.MSPerHour:null,isDate:!0})}}},{key:"onDragEnd",value:function(){this.isHovered.set(!1)}},{key:"onMouseLeave",value:function(){this.isHovered.set(!1)}},{key:"onDoubleClick",value:function(e){var t=this.props,a=t.pane,n=t.date,r=a.item.get(),i=new ie.a(n,{duration:c.a.DefaultEventDuration});a.openItemEditor({element:e.target,text:" "+c.a.CharDate,parent:r,selectIndex:0,mooDate:i,pos:{top:e.clientY},showCalendarButtons:!0,addOnSave:!0})}},{key:"render",value:function(){var e,t=this.props,a=this.state,n=t.date,r=0===n.getDay()||6===n.getDay(),o=n.getDate(),l=Date.getDaysInMonth(n.getFullYear(),n.getMonth()),u=i.default.classNames("dateBlock c-border",{firstDay:1===n.getDate()},{lastDay:n.getDate()===l},{"weekend c-bg-faded":r},{"c-background":!r},{hoveredInDrag:a.isHovered},{today:U.a.isToday(n)}),d={left:t.left-1,width:t.width+1},h=i.default.classNames("dateBlockDay");if(a.items){for(var f=0,p=0,g=[],m=!1,v=0;v<a.items.length;v++){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;var y=a.items[v];y.time&&y.item.hasAttachmentType(c.a.PluginType.Calendar)&&(m=!0)}for(var k=0;k<a.items.length;k++){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var _=a.items[k],b=_.time,w=_.item,S=m&&b,D=i.default.classNames("dateBlockItem flexbox",{hasCircle:S}),P=null;if(S){var I={background:w.hasAttachmentType(c.a.PluginType.Calendar)&&w.getCalendarColor()};P=s.a.createElement("div",{className:"monthItemColorCircle",style:I})}g.push(s.a.createElement("div",{className:D,key:w.id},P,s.a.createElement(re,{className:"itemInCalendar",item:w,pane:t.pane,coloredInCalendar:!b&&!!w.getCalendarColor(),showPriority:!0,allowDrag:!0,editOnClick:!0}),b&&t.width>100&&s.a.createElement("span",{className:"itemTime"},b)))}e=(t.items||a.isHovered)&&s.a.createElement("div",{className:"dateBlockItems"},g)}return s.a.createElement("div",{className:u,style:d,onMouseDown:this.onMouseDown,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onDoubleClick:this.onDoubleClick},s.a.createElement("div",{className:h},o),e)}}]),a}(ae.a),fe=Object(f.b)((function(e){var t=e.data,a=e.index,n=e.style,r=t[a],o=r.type,l=r.date,u=r.items,c=r.pane,d=c.getContentHeight(),h=c.isViewCalendarMonth()?c.heightWeek():c.getDayWidth();if(Object(g.a)(c.rect),"calendarDay"===o)return s.a.createElement(ue,{component:"div",className:"",date:l,items:u,pane:c,height:d,width:h,style:n});if("calendarWeek"===o){var f=0,p=i.default.classNames("calendarWeek flexbox"),m=c.getWidth()+1,v=Math.floor(m/7),y=m-7*v,k=0,_=0;y>0&&(k=Math.ceil(y/2),_=y-k);for(var b,w=Object.assign({},n,{height:h+1}),S=0;S<r.dates.length;S++){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;var D=r.dates[S];if(D){var P=D.date;1===P.getDate()&&(b=P.toString("MMMM"),P.getYear()!==U.a.getToday().getYear()&&(b+=P.toString(" yyyy")))}}return s.a.createElement("div",{className:p,style:w},r.dates.map((function(e,t){var a=v+(0===t?k:0)+(6===t?_:0);return s.a.createElement(he,{key:e.date.getTime(),pane:c,date:e.date,items:e.items,left:t*v+(t>0?k:0),width:a})})),b&&s.a.createElement("div",{className:"calendarMonthTitle c-bg-app"},b))}})),pe=Object(f.a)((function(e){var t,a=e.className,n=e.pane,u=e.initialScrollIndex,d=Object(g.a)(n.items,n.rect,n.orientation,n.viewState,l.default.settings.dayWeekStart),h=r()(d,5),f=h[0],p=h[1],m=h[2],v=(h[3],h[4]),y=Object(o.useRef)(),k=Object(o.useRef)(),_=Object(o.useRef)(),b=n.isViewCalendarMonth(),w=b?n.heightWeek():n.getDayWidth(),S=Object(H.a)(w),D=Object(x.a)(),P=n.getHeight(),I=p.width;void 0===u&&(u=null!==(t=n.initialScrollIndex)&&void 0!==t?t:n.getIndexOfToday());var E=Object(o.useRef)(u),C=function(e){var t=e.index,a=e.align,n=e.behavior;"center"===a?t-=Math.floor(I/w/2):"end"===a&&(t-=Math.floor(I/w)),i.default.scrollElementTo(_.current,{left:b?void 0:t*w+1,top:b?t*w+1:void 0,behavior:n})},A=function(){var e=y.current.scrollTop;k.current.scrollTo(e)};Object(o.useEffect)((function(){if(n.paneContent=_.current,n.scrollElement=i.default.findChild(_.current,"paneContent"),!b)return y.current&&(y.current.style.position="relative",y.current.style.overflowY="auto",y.current.addEventListener("scroll",A),y.current.scrollTo({top:n.getDayViewY()}),requestAnimationFrame((function(){return y.current.scrollTo({top:n.getDayViewY()})}))),function(){y.current.removeEventListener("scroll",A)}}),[b]),S&&S!==w&&(E.current=n.listManager.getScrollIndex()),Object(o.useEffect)((function(){n.listManager.setVirtualList({scrollToIndex:C,getScrollOffset:function(){return _.current[b?"scrollTop":"scrollLeft"]},scrollTo:function(e,t){return _.current.scrollTo({left:b?e:void 0,top:b?void 0:e,behavior:t})},offsetById:function(e){return 0},offsetByIndex:function(e){return 0}}),C({index:E.current,align:"start"})}),[w,b]),Object(o.useEffect)((function(){n.scrollToToday("auto")}),[]);var T,M=Object(o.useCallback)((function(e){var t=e.visibleStartIndex,a=e.visibleStopIndex;n.listManager.setScrollRange({startIndex:t,endIndex:a}),n.onScroll()}),[]),L=Object(o.useCallback)((function(e,t){var a;return null===(a=t[e])||void 0===a?void 0:a.id}),[]),O={};if(b){P-=30,O.marginTop=30;var R={boxShadow:D.paneShadow()};T=s.a.createElement("div",{className:"calendarMonthDays z-4 inset-t-0 c-background flexbox",key:"overlay",style:R},0===v&&s.a.createElement("div",null,"SUN"),s.a.createElement("div",null,"MON"),s.a.createElement("div",null,"TUE"),s.a.createElement("div",null,"WED"),s.a.createElement("div",null,"THU"),s.a.createElement("div",null,"FRI"),s.a.createElement("div",null,"SAT"),1===v&&s.a.createElement("div",null,"SUN"))}else O.marginLeft=c.a.CalendarTimesWidth,I-=c.a.CalendarTimesWidth,T=s.a.createElement(ce,{pane:n,trackPane:!0,showAllDay:!0,ref:k});return s.a.createElement("div",{className:a+" relative"},s.a.createElement(j.a,{height:P,itemCount:f.length,itemData:f,itemSize:w,layout:m,width:I,className:"calendarList paneContent",innerRef:y,style:O,onItemsRendered:M,outerRef:_,itemKey:L},fe),T)})),ge=a(88),me=a(6),ve=Object(f.b)((function(e){var t=e.className,a=e.initial,n=e.exit,r=e.transition,i=e.children;return s.a.createElement(d.a,null,i&&s.a.createElement(d.b.div,{className:t,animate:{x:0,y:0},initial:a,exit:n,transition:r},i))})),ye=a(117),ke=a(64),_e=a(126),be=a(149),we=a(94),Se=function(e,t){for(var a=0,n=e+1;n<t.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if("item"===t[n].type)return n}},De=function(e){var t=e.className,a=D()(e,["className"]);return s.a.createElement(E.a,w()({mode:"contained",className:i.default.classNames("searchX c-button noShrink",t),width:24,height:24},a))},Pe=Object(f.b)((function(e){var t=e.pane,a=Object(o.useRef)(0),n=Object(o.useRef)(""),u=n.current,h=Object(o.useRef)(),f=Object(o.useRef)(),p=f.current,m=Object(o.useRef)(),v=Object(g.a)(I.a.windowSize,t.isSearchingGlobal),k=r()(v,2),b=k[0].height,w=k[1],S=Object(ke.a)(),D=function(e){n.current=e,S()},P=function(){h.current=me.a.save(),me.a.reset()};w&&p&&!p.isFocused.get()&&(P(),p.focus(),p.selectEnd()),Object(o.useEffect)(P,[]);var x=Object(o.useMemo)((function(){return u?ye.a.findMatchLike(u.trim(),{max:1e3,root:t.getRootItem(),allDocs:!0}):[]}),[u]),A=function(e){a.current=e,S()};Object(o.useEffect)((function(){A(Se(0,x))}),[u]);var T=function(){var e=_()(y.a.mark((function e(a,n,r){var i,o,s,u,d;return y.a.wrap((function(e){for(var h=0;;){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;switch(e.prev=e.next){case 0:if(i=r?a:a.getDocumentOwner().getRootItem(),o=r?void 0:a,"pane"===n?s=l.default.PaneManager.addPaneByButton(c.a.PaneMode.Task,void 0,i):"popup"===n?s=l.default.menus.openModalPaneHighlightingItem({zoomItem:i,highlightItem:o}):(s=t,t.zoomIn(i,{noSel:!0})),u=!0,r){e.next=12;break}if(d=function(){a.highlight(),requestAnimationFrame((function(){s.scrollItemToMiddle(a,"auto")}))},t!==s||t.search.isMatched(a,{forceCheck:!0})){e.next=11;break}return e.next=9,l.default.menus.confirm("Item is currently hidden by filters. Would you like to clear the filters and scroll to the selected item?");case 9:(u=e.sent)&&(t.search.resetFilters(),t.search.setValue(""));case 11:u&&d();case 12:u&&L(a,s);case 13:case"end":return e.stop()}}}),e)})));return function(t,a,n){return e.apply(this,arguments)}}(),M=function(e,t){var a=(I.a.isPriModKey(t)?"pane":I.a.isSecModKey(t)&&"popup")||"scroll";T(e,a,t.shiftKey)},L=function(e,a){if(D(""),t.isSearchingGlobal.set(!1),e){var n=a||t;n.getItem()===e?me.a.selectIndex(0,-1):(n.setItemUnCollapsedToRoot(e,n.getItem()),me.a.selectItem(e,-1))}else h.current&&me.a.restore(h.current)},O=function(){var e=function(e,t){for(var a=0,n=e-1;n>=0;n--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if("item"===t[n].type)return n}}(a.current,x);return void 0!==e?(A(e),e):a.current},R=function(){var e=Se(a.current,x)||x.length-1;return A(e),e},F=Math.abs(i.default.clamp(1e3,100,.7*b)),N=Object(o.useCallback)((function(e,t){if("header"===e.type)return s.a.createElement(d.b.div,{className:"px-3 py-2 font-medium text-white c-bg-popup-title text-11",layout:"position",transition:c.a.TransitionSpringFastestest},e.text);if("item"===e.type){var r=e.item,o=r.parents(),l=t===a.current,u=i.default.classNames("relative flex flexvert justify-center py-3 px-3 borderBox",{"selected c-bg-dark":l}),h=l?2:1,f=i.default.classNames("text-11 pb-1",{"whitespace-pre overflow-hidden ellipsis c-blue-dark":!l},{"whitespace-pre-wrap-break-words line-clamp c-blue":l}),p={lineClamp:h,WebkitLineClamp:h};return s.a.createElement(d.b.div,{className:u,onClick:function(e){M(r,e)},onContextMenu:I.a.mac&&function(e){return i.default.preventAndStop(e),0===e.button&&M(r,{ctrlKey:!0,shiftKey:e.shiftKey}),!1},layout:"position",transition:c.a.TransitionSpringFastestest,onMouseMove:function(){return A(t)}},s.a.createElement("div",{className:f,style:p},o.length>0&&o.map((function(e){return i.default.truncate(e.generateTitleText(),l?50:20)})).join(" > ")),s.a.createElement(be.a,{item:r,numberOfLines:l?4:2,highlightSearchText:n.current}),l&&s.a.createElement("div",{className:"absolute inset-y-0 flex justify-center pr-2 inset-r-0 flexvert"},s.a.createElement(De,{icon:"MdAdd",tooltip:"Open in New Pane",onClick:function(e){T(r,"pane",e.shiftKey),i.default.preventAndStop(e)}}),s.a.createElement(De,{className:"mt-1",icon:"MdOpenInNew",iconSize:16,tooltip:"Open in Popup Pane",onClick:function(e){T(r,"popup",e.shiftKey),i.default.preventAndStop(e)}})))}}),[]);return s.a.createElement(_e.a,null,s.a.createElement("div",{className:"flex my-2 overflow-hidden rounded c-bg-menu c-shadow-popup flexvert",style:{width:446}},s.a.createElement("div",{className:"fixed inset-0",onClick:function(){L()}}),s.a.createElement("div",{className:"flex"},s.a.createElement(C.a,{width:410,backgroundTheme:"c-bg-menu",height:36,border:!1,fontSize:12,padding:{left:16,right:16},placeholder:"Find an item to open",value:u,onChange:D,onKeyDown:function(e){if(e.keyCode===c.a.KeyCode.Escape)L();else if(e.keyCode===c.a.KeyCode.ArrowUp){var t;null===(t=m.current)||void 0===t||t.scrollToIndex({index:O(),align:"auto"}),i.default.preventAndStop(e)}else if(e.keyCode===c.a.KeyCode.ArrowDown){var n;null===(n=m.current)||void 0===n||n.scrollToIndex({index:R(),align:"auto"}),i.default.preventAndStop(e)}else e.keyCode===c.a.KeyCode.Enter&&M(x[a.current].item,e)},focused:!0,underline:!1,ref:f}),s.a.createElement(E.a,{className:"searchX c-button noShrink",width:36,height:36,icon:"MdClose",onClick:function(){return L()}})),u&&s.a.createElement(s.a.Fragment,null,s.a.createElement(we.a,{className:"border-t c-border-heavy",items:x,renderItem:N,defaultItemSize:58,style:{height:F},ref:m}),s.a.createElement("div",{className:"flex px-3 py-2 whitespace-pre border-t text-11 c-border-heavy"},s.a.createElement("div",{className:"pr-1 c-foreground-light"},"ENTER"),s.a.createElement("div",{className:"c-foreground-very-faded"},"Open"),s.a.createElement("div",{className:"pl-5 pr-1 c-foreground-light"},"SHIFT"),s.a.createElement("div",{className:"c-foreground-very-faded"},"+ Zoom In"),s.a.createElement("div",{className:"pl-5 pr-1 c-foreground-light"},I.a.priModKey," ENTER"),s.a.createElement("div",{className:"c-foreground-very-faded"},"New Pane"),s.a.createElement("div",{className:"pl-5 pr-1 c-foreground-light"},I.a.secModKeyForce," ENTER"),s.a.createElement("div",{className:"c-foreground-very-faded"},"Popup")))))})),Ie=a(179),Ee=a(58),Ce=a(89),xe=Object(f.a)(Object(o.forwardRef)((function(e,t){var a=e.pane,n=Object(o.useRef)(),r=Object(o.useRef)(!1);Object(o.useEffect)((function(){a.hiddenInput=n.current}),[]),Object(o.useImperativeHandle)(t,(function(){return{getElement:function(){return n.current}}}));var u=Object(o.useCallback)((function(){if(me.a.getPane()===a){var e;if(Ce.a.resetSavedSelection(),null===(e=getSelection())||void 0===e?void 0:e.focusNode){if(Ce.a.isInSelectionChange=!0,I.a.isiOS&&!r.current&&me.a.isTouchDown()&&(r.current=!0,a.scrollElement.style.overflow="hidden",me.a.onTouchUp((function(){r.current=!1,a.scrollElement.style.overflow=null}),!1)),!me.a.isSelecting&&me.a.isValid()&&!l.default.menus.isContextMenuOpen()&&(!l.default.menus.isModalOpen()||l.default.menus.isModalOpen("modalPane"))){var t=me.a.getStartIndex(),o=me.a.getStartIndex();if(t===o){var s=me.a.getStartOffset(),u=me.a.getEndOffset(),d=me.a.getEndTotal(),h=$.default.getSelectionRangeNative();if(h&&i.default.findParent(h.startContainer,n.current)){var f=i.default.findParent(h.startContainer,"hiddenInputItem"),p=i.default.findParent(h.endContainer,"hiddenInputItem");if(f&&p){var g=$.default.getSelectOffsetsInElement(f,h).start,m=g,v=$.default.getSelectOffsetsInElement(p,h).end,y=+(null===f||void 0===f?void 0:f.getAttribute("data-index")),k=+(null===p||void 0===p?void 0:p.getAttribute("data-index")),_=a.objectAtIndex(y);if(_){var b=_.item;if(b){var w=g,S=v;if(f.textContent===c.a.TextSpace)w=0,S=0;else if(t===y){if(w===S&&(me.a.preferEndLine||"EndLine"===Ee.a.lastNavigationAction||"Down"===Ee.a.lastNavigationAction||"Up"===Ee.a.lastNavigationAction)){var D=h.getBoundingClientRect();if(D.x-f.getBoundingClientRect().x<10&&" "===f.textContent[w-1]){var P,E,C=null===(P=Ce.a.savedRange)||void 0===P?void 0:P.getBoundingClientRect();if("EndLine"===Ee.a.lastNavigationAction||(null===(E=me.a.preferEndLine)||void 0===E?void 0:E.index)===y||me.a.preferEndLine.offset===w||C.x-f.getBoundingClientRect().x>20){var x=$.default.createRange(f,w-1,w-1);x.getBoundingClientRect().x-D.x>10&&(h=x,g--,v--,w--,S--)}}}var A=w-s,T=S-u;A&&(w=b.elsNew.adjustOffsetAroundUneditables(_,w,A>0?1:-1)),T&&(S=b.elsNew.adjustOffsetAroundUneditables(_,S,T>0?1:-1))}y>=0&&(y!==t||s!==w||u!==S)&&(!me.a.modifiersDown.shiftKey||y===t&&k===o?(Ce.a.setSavedRange(h),!me.a.preferEndLine||me.a.preferEndLine.index===y&&me.a.preferEndLine.offset===m||(me.a.preferEndLine=void 0),me.a.selectIndices(y,w,y,S,{fromInput:w===g&&S===v})):y<t&&s>0?me.a.selectIndices(t,0,t,u):k>t&&u<d?me.a.selectIndices(t,s,t,-1):me.a.selectIndices(t,0,t,-1))}}}}}}}else me.a.reset();Ce.a.isInSelectionChange=!1}}),[a]);Object(Ie.a)("selectionchange",u,document);var d={};d={onKeyDown:function(e){me.a.getPane().keydown(I.a.normalizeKeys(e.nativeEvent))},onKeyPress:function(e){me.a.getPane().keypress(I.a.normalizeKeys(e.nativeEvent))},onKeyUp:function(e){me.a.getPane().keyup(I.a.normalizeKeys(e.nativeEvent))}};var h=i.default.classNames("select-text paneHiddenInput whitespace-pre-wrap-break-words",{"z-2":!0},{"z--1":!1});return s.a.createElement("div",w()({contentEditable:!0,className:h,ref:n,suppressContentEditableWarning:!0,onInput:function(e){a.onInput(e.nativeEvent)},onBeforeInput:a.onBeforeInput,onCompositionStart:a.compositionStart,onCompositionEnd:a.compositionEnd},d))}))),Ae=a(47),Te=Object(f.b)((function(e){var t=e.paneObject.block,a=l.default.DisplaySettings.itemPadding(),n=i.default.classNames("c-foreground-ultra-faded c-foreground-hover cursor-pointer"),r={paddingLeft:l.default.DisplaySettings.itemIndentStart(),paddingTop:a,paddingBottom:a};return s.a.createElement("div",{style:r},!t.noAddButton&&s.a.createElement("div",{className:n,onClick:function(){t.addFn(t)}},s.a.createElement(Ae.b,{className:"pr-2"}),"Add item"))})),Me=Object(f.b)((function(e){var t,a,n=e.paneObject,o=n.index,u=n.pane,d=Object(g.a)(u.dragHoveredBlock),h=r()(d,1)[0],f=n.block===h,p=l.default.DisplaySettings.itemPadding(),m=n.block,v=m.isCollapsed(),y=i.default.classNames("blockHeader noItem flexbox items-stretch mb-2 text-xl font-bold",{blockHeaderDate:m.isDate},{"c-tag":u.isViewTag()},{"c-contact":u.isViewContact()},{agendaBlockRed:!v&&m.isOverdue},{dragHovered:f},{"collapsed c-foreground-super-faded":v},{firstBlock:0===o},{"border-b c-border-light pb-3":!m.isNewProject&&!v}),k={fontSize:l.default.DisplaySettings.fontSizeHeaderTopLevel(),paddingLeft:l.default.DisplaySettings.itemIndentStart(),paddingTop:p+(o>0?(null===(t=n.blockPrevious)||void 0===t?void 0:t.isCollapsed())?c.a.PaddingTopBlockHeader/4:c.a.PaddingTopBlockHeader:0)},_=i.default.classNames("blockCollapser c-foreground-super-faded pt-2 cursor-pointer",{"icon-angle-down":!v&&!m.isNewProject},{"icon-angle-right":v&&!m.isNewProject}),b={marginLeft:-26,width:26},w={},S=i.default.classNames("blockHeaderNumItems pl-4 text-xs font-normal",{"c-foreground-very-faded":!v}),D=s.a.createElement("div",{className:S},m.numItems()),P="blockHeaderText f1 flex items-center";if(m.isDate){var I=m.date,E=U.a.getToday(),C=U.a.isToday(I)?"Today":U.a.isSameDay(I,U.a.getTodayPlusDays(1))?"Tomorrow":I.toString("dddd"),x=I.toString("MMMM d"+(I.getYear()!==E.getYear()?", yyyy":""));P=i.default.classNames(P,"blockHeaderDayName flex",{"c-foreground-light":!v});var A=i.default.classNames("font-normal pl-4 text-sm",{"c-foreground-light":!v});a=s.a.createElement("div",{className:"flex items-center"},s.a.createElement("div",{className:"font-bold"},C),s.a.createElement("div",{className:A},x),D)}else if(m.isNewProject)w={marginLeft:-26,width:26},a=s.a.createElement("div",{className:P+" flex c-foreground-very-faded c-foreground-hover",style:w,onClick:function(){var e=u.getItem().numItems(),t=u.addItemToPane({text:c.a.Prefix.Header+" "},e),a=u.indexOfItem(t);me.a.selectIndex(a,0)}},s.a.createElement(Ae.b,{className:"pr-2"}),"New project");else{var T=m.isStarred&&s.a.createElement("i",{className:"pr-2 icon-star"})||m.isImportant&&s.a.createElement("div",{className:"pr-2"},"!");w={paddingTop:l.default.DisplaySettings.itemPadding()},a=s.a.createElement("div",{className:P+" flex",style:w},T,m.text,D)}return s.a.createElement("div",{className:y,style:k},!m.isNewProject&&s.a.createElement("div",{className:_,style:b,onClick:m.toggleCollapsed}),a)}));a(138);var Le=function(e){var t=Object(ke.a)(),a=Object(o.useRef)();a.current||(B.a.listen(e,t),a.current=!0),Object(o.useEffect)((function(){return function(){a.current&&(B.a.unlisten(e,t),a.current=!1)}}),[e])},Oe=a(108),Re=(Object(f.b)((function(e){var t=e.left,a=e.top,n=e.height,i=Object(o.useState)(!0),u=r()(i,2),c=u[0],d=u[1],h=Object(o.useRef)(),f=Object(o.useRef)(),p=Object(o.useRef)(),m=Object(g.a)(l.default.settings.ui.cursorBlink,me.a.isWindowFocused,l.default.menus.contextMenuStack),v=r()(m,3),y=v[0],k=v[1],_=v[2],b=k&&0===_.length,w=Object(H.a)(t),S=Object(H.a)(a),D=Object(H.a)(b),P=function e(t){clearTimeout(f.current),b&&(y||(t=!0),d(t),f.current=setTimeout(e,500,!t))};(t!==w||a!==S||b!==D)&&(c=!0,p.current=requestAnimationFrame((function(){return P(!0)}))),Object(o.useEffect)((function(){return function(){cancelAnimationFrame(p.current),clearTimeout(f.current)}}),[]);var I={};return b&&me.a.isValid()?(I.height=n,I.opacity=c?1:0,I.left=t,I.top=a):(I.left=-1e3,I.top=-1e3),s.a.createElement("div",{className:"caret c-bg-caret",style:I,ref:h})})),a(105)),Fe=a(82),Ne=(Object(f.b)((function(e){var t=e.paneObject,a=Object(g.a)(l.default.settings.showFormattingToolbar,t.pane.rect),n=r()(a,2),u=n[0],d=n[1],h=t.pane,f=me.a.getSelectedItems().length,p=0===u,m=Object(o.useRef)(),v=Object(Re.a)(m),y=function(e){me.a.applyFormatToSelection(e,!0)},k=function(e){me.a.applyPrefixToSelection(e)},_=function(){var e=l.default.settings.showFormattingToolbar.get();e=0===e?1:0,l.default.settings.showFormattingToolbar.set(e)},b=h.getPaddingForPaneObject(t),w=p?24:30,S=p?24:36,D={height:S,marginTop:-S-4,left:Math.min(b,d.width-v.width-4)},P=i.default.classNames("formattingToolbar c-popup c-darkPopup c-shadow-popup absolute z-50",{collapsed:p});return s.a.createElement("div",{className:P,style:D,ref:m},p?s.a.createElement(R.a,{icon:"icon-more_horiz",width:w,height:S,iconSize:14,tooltip:"Show formatting toolbar",onClick:_}):s.a.createElement(s.a.Fragment,null,s.a.createElement(R.a,{icon:"icon-format_bold",width:w,height:S,iconSize:19,onClick:y.bind(this,"bold"),tooltip:"Bold",tooltipHotkey:{name:"Bold"}}),s.a.createElement(R.a,{icon:"icon-format_italic",width:w,height:S,iconSize:19,onClick:y.bind(this,"italic"),tooltip:"Italic",tooltipHotkey:{name:"Italic"}}),s.a.createElement(R.a,{icon:"icon-format_underlined",width:w,height:S,iconSize:18,onClick:y.bind(this,"underline"),tooltip:"Underline",tooltipHotkey:{name:"Underline"}}),s.a.createElement(R.a,{iconComponent:Ae.D,width:w,height:S,iconSize:18,onClick:y.bind(this,"strike"),tooltip:"Strikethrough",tooltipHotkey:{name:"Strike"}}),s.a.createElement(R.a,{iconComponent:Ae.j,width:w,height:S,iconSize:18,onClick:y.bind(this,"code"),tooltip:"Inline Code",tooltipHotkey:{name:"InlineCode"}}),s.a.createElement("div",{className:"divider"}),s.a.createElement(R.a,{icon:"icon-project",width:w,height:S,iconSize:18,onClick:k.bind(this,c.a.Prefix.Header),tooltip:"Project",tooltipHotkey:c.a.Prefix.Header+"&nbsp;&nbsp; Space"}),s.a.createElement(R.a,{icon:"prefixTask",width:w,height:S,iconSize:20,onClick:k.bind(this,c.a.Prefix.Task),tooltip:"Task",tooltipHotkey:c.a.Prefix.Task+"&nbsp;&nbsp; Space"}),s.a.createElement(R.a,{icon:"icon-bullet",width:w,height:S,iconSize:22,onClick:k.bind(this,c.a.Prefix.Bullet),tooltip:"Bulleted list",tooltipHotkey:c.a.Prefix.Bullet+"&nbsp;&nbsp; Space"}),s.a.createElement(R.a,{icon:"icon-numlist",width:w,height:S,iconSize:14,onClick:k.bind(this,c.a.Prefix.NumList),tooltip:"Numbered list",tooltipHotkey:c.a.Prefix.NumList+"&nbsp;&nbsp; Space"}),s.a.createElement(R.a,{iconComponent:Fe.l,width:w,height:S,iconSize:14,onClick:k.bind(this,c.a.Prefix.CodeBlock),tooltip:"CodeBlock",tooltipHotkey:c.a.Prefix.CodeBlock+"&nbsp;&nbsp; Space"}),s.a.createElement("div",{className:"divider"}),s.a.createElement(R.a,{icon:"icon-link",enabled:1===f,width:w,height:S,iconSize:18,onClick:function(){me.a.getStartItem().insertLinkAtSelection()},tooltip:"Create link",tooltipHotkey:{name:"InsertLink"}}),s.a.createElement(R.a,{icon:"icon-sticky-note-o",enabled:1===f,width:w,height:S,iconSize:14,onClick:function(){var e=t.item,a=t.pane;e&&a.openNoteContextMenuByPaneObject(t)},tooltip:"Add note",tooltipHotkey:{name:"EditNote"}}),s.a.createElement("div",{className:"divider"}),s.a.createElement(R.a,{icon:"icon-minus",width:w,height:S,iconSize:10,tooltip:"Hide formatting toolbar",onClick:_})))})),a(157).default),Be=Object(f.b)((function(e){var t,a=e.paneObject,n=a.item,u=a.isBlockHeader,d=a.pane;if(!d||!d.search)return null;var h=d.isPaneObjectCollapsed(a),f=l.default.DisplaySettings.lineHeightForItem(a),p=n.getPrefixLength(),m=d.isItemHeader(n,!1),v=me.a.isMultiselected(),y=l.default.DisplaySettings.paddingForItemTop(a),k=l.default.DisplaySettings.paddingForItemBottom(),_=n.isPrefixCodeBlock(),b=[Object(o.useRef)(),!1],w=r()(b,2),S=w[0],D=w[1],P=Object(o.useState)(!1),E=r()(P,2),C=E[0];E[1];Le("numListChanged");Object(ke.a)();var x=Object(g.a)(n._note,n.isHighlighted,l.default.settings.ui.showVerticalLines,l.default.DisplaySettings.fontSizeObsForItem(a),l.default.DisplaySettings._noteFontSize,l.default.settings.showMarkdown,d.search.isFocused,d.searchingPaneObjects,l.default.settings.showFormattingToolbar,l.default.settings.alignIndentToPrefix,n.levelsDeep,n.flags,d.viewState,l.default.DisplaySettings._itemPadding,l.default.DisplaySettings._itemLineHeight,l.default.DisplaySettings._itemIndentSize,l.default.DisplaySettings._boldHeaders,d.search.onChanged,n.itemChanged),A=r()(x,10),T=A[0],M=A[1],L=A[2],O=A[3],R=A[4],F=A[5],N=A[6],B=A[7],j=A[8],U=A[9],H=B.selectedPaneObject===a.id,V=n.hasPrefix()&&U?c.a.PrefixWidth:0,W=d.getPaddingForPaneObject(a),z=l.default.DisplaySettings.paddingForItemRight(a),q=me.a.getSelection(a),G=!!q,K=l.default.ElementRenderer.renderToJSX(n,a,{noPrefix:!0,showMarkdown:F&&G,highlightSearch:N||B.isSearching}),Y=!(null===(t=K)||void 0===t?void 0:t.length),X=(!_&&me.a.isMultiselected(),q&&(q.full||q.start!==q.end&&!Y)),Q=d.search.isMatchStuckHiding(n),J=null===T||void 0===T?void 0:T.getNotePreviewText(),Z=d.supportVertLines&&L,$=n.shouldShowParents(a,d),ee=y+($?f+y:0);I.a.safari&&Y&&(K=[c.a.TextSpace]),Object(Oe.b)(a,S,"itemInPaneText");var te,ae,ne,re,ie,oe,se,le,ue,ce={paddingLeft:W,paddingRight:z,lineHeight:f+"px",fontSize:O},de={paddingTop:y,minHeight:f+(_?32:0),paddingBottom:T?0:k,marginLeft:_?0:-c.a.TextPaddingLeft+V,paddingLeft:_?0:void 0},he=i.default.classNames(c.a.ItemClass,"relative cursor-hand z-1",n.styleProps(d),{"c-border-light border-b mb-1":u&&!h},{"c-foreground-super-faded":u&&h},{hasSelection:G},{hasSelectionHighlight:X},{itemHighlighted:C||H||M&&d.type!==c.a.PaneMode.Gmail},{stuckMatch:Q}),fe=i.default.classNames("itemInPaneText relative z-1 whitespace-pre-wrap-break-words cursor-text",{"pb-1":u});if($){var pe=n.parents(d.getItem()).map((function(e){return e.generateTitleText()})),ge=pe.map((function(e,t){return s.a.createElement("span",{key:t,className:"truncate-pre",style:{minWidth:30}},(t>0?" > ":"")+e)})),ve={paddingTop:y};te=ge&&s.a.createElement("div",{className:"relative flex overflow-hidden whitespace-pre itemParents c-foreground-very-faded",style:ve,"data-tooltip":pe.join(" > ")},ge)}if(n.hasPrefix()&&!u){var ye=n.isComplete(),_e=n.isPrefixTask(),be=n.isPrefixBullet(),we=n.isPrefixHeader(),Se=n.isPrefixNumList(),De=be?6:_e?12:O,Pe=be?7:_e?2:0,Ie={left:W+V,width:c.a.PrefixWidth,height:c.a.PrefixWidth,top:ee+Pe},Ee=i.default.classNames("prefixNew",{alignIndentToPrefix:U},{"prefixTaskNew cursor-pointer flex items-stretch":_e},{prefixTaskComplete:_e&&ye},{"prefixBulletNew cursor-pointer":be},{"prefixHeaderNew cursor-pointer":we},{prefixNumListNew:Se}),Ce=i.default.classNames({"flex items-center justify-center":_e},{"":be}),xe=Se&&n.elsNew.elements[0].getStyledText(n)||we&&"\u2756"||s.a.createElement("div",{className:Ce,style:{width:De,height:De}});ae=s.a.createElement("div",{className:Ee,style:Ie,onClick:function(e){l.default.DragDrop.isDraggingDelayed||(i.default.preventAndStop(e),be||we||I.a.isPriModKey(e)?d.zoomIn(n,{forLoad:!1,showToast:!0}):_e&&(i.default.beginCompleteAction(),n.setComplete(!ye,c.a.ChangeType.Local),d.selectNearestItem(a),i.default.endCompleteAction()))}},xe)}if((m||u)&&d.supportCollapsing&&d.canCollapse()){var Te=i.default.classNames("collapserNew c-color-hover",{"collapsed icon-angle-right":h},{"icon-angle-down":!h},{absolute:!0}),Me={left:void 0,right:0,width:40,textAlign:"center",lineHeight:f+"px",paddingTop:ee,fontSize:20},Re="<b>Click</b> to "+(h?"expand":"collapse")+" item.<br><b>Shift + Click</b> to "+(h?"expand":"collapse")+" item recursively.<br><b>"+I.a.priModKey+" + Click</b> to zoom in.";ne=s.a.createElement("div",{className:Te,style:Me,"data-tooltip":Re,onClick:function(e){l.default.DragDrop.isDraggingDelayed||(i.default.preventAndStop(e),d.handleLeftSideTap(a,e))}})}if(Y){if(D&&!p&&!ne&&!v){var Fe=i.default.classNames("emptyItemAddButtonNew icon-add c-background c-shadow-light"),Be={left:W};re=s.a.createElement("div",{className:Fe,style:Be,onClick:function(e){l.default.DragDrop.isDraggingDelayed||(i.default.preventAndStop(e),l.default.menus.openContextMenu({componentName:"ReactContextMenuSlashHelp",element:i.default.findParent(e.target,"itemInPane"),positionOffset:{left:e.pageX-10},paneObject:a}))}})}0}if(Z){var je=d.extraPaddingForPaneObject?d.extraPaddingForPaneObject(a):0,Ue=l.default.DisplaySettings.itemIndentStart()+je-(U?13:0),He=W-Ue;if(He>0){var Ve={left:Ue,width:He};ie=s.a.createElement("div",{className:"vertLines",style:Ve})}}if(u){var We=i.default.classNames("itemIgnoreText ns align-text-top inline-block text-xs pl-4",{"c-foreground-faded":!h});oe=s.a.createElement("span",{className:We},a.block.items.length)}if(d.shouldShowTime(a)){var ze,qe=d.getItemDisplayTime(a),Ge=qe;i.default.isArray(qe)&&(Ge=qe[0],ze=qe[1]);var Ke=i.default.classNames("absolute right-0 top-0 pr-2 text-xxs leading-tight"),Ye={paddingTop:y-3};se=s.a.createElement("div",{className:Ke,style:Ye,onClick:function(e){i.default.preventAndStop(e),l.default.menus.openDate({element:e.target,item:n,pane:d,paneObject:a})}},s.a.createElement("div",{className:"c-blue"},Ge),s.a.createElement("div",{className:"c-foreground-very-faded"},ze))}if(void 0!==J){var Xe={fontSize:R,marginLeft:V,paddingBottom:k};le=s.a.createElement("div",{className:"relative font-normal truncate cursor-pointer itemInPaneNote c-foreground-faded z-1",style:Xe},J)}if(d.isViewArchived()||d.isViewDeleted()){ue=s.a.createElement("div",{className:"absolute top-0 right-0 pr-2 c-button",onClick:function(e){i.default.preventAndStop(e),d.handleRightSideTap(n)}},s.a.createElement(Ae.F,{size:16}))}var Qe,Je,Ze=a.getDisplayLengthWithoutPrefix(),$e=Ze>0;if(q&&(me.a.isValid()||q.full)&&me.a.pane.get()===d&&!me.a.isKeyboardOpen){var et=[];try{var tt;d.getWidth();if(q.full||$e&&0===q.start&&q.end===Ze)tt=!0,et.push({left:0,right:0,top:0,bottom:0,width:"auto",height:"auto"});else;if(et.length>0){var at=i.default.classNames("absolute textSelected pointer-events-none",{fullySelected:tt});Je=et.map((function(e,t){return s.a.createElement("div",{key:t,className:at,style:e})}))}}catch(rt){try{i.default.PAssert(1348,!1,"Error rendering selection",rt)}catch(it){i.default.reportError(it)}}}var nt=s.a.createElement(s.a.Fragment,null,te,ae,s.a.createElement("div",{className:fe,style:de},K,oe),ue,le,ie,ne,re,undefined,se,Je,Qe,undefined);return s.a.createElement(Ne,{style:ce,className:he,paneObject:a,ref:S},nt)})),je=36,Ue=Object(f.b)((function(e){var t=e.pane,a=Object(o.useState)(0),n=r()(a,2),i=n[0],l=n[1],u=Object(g.a)(t.searchingPaneObjects),d=r()(u,1)[0],h=d.text,f=d.isSearching,p=Object(o.useRef)(),m=Object(o.useRef)(),v=m.current,y=function(){p.current=me.a.save(),me.a.reset()};f&&v&&!v.isFocused.get()&&(y(),v.focus(),v.selectEnd()),Object(o.useEffect)(y,[]);var k=Object(o.useMemo)((function(){return h?t.searchPaneObjects(h):[]}),[h]);Object(o.useEffect)((function(){_(0,!0)}),[h]);var _=function(e,a){l(e);var n=k[e];a||(p.current=void 0),t.searchingPaneObjects.setProperty("selectedPaneObject",null===n||void 0===n?void 0:n.id),n&&t.scrollToIndex(n.index,"center")},b=function(){if(t.searchingPaneObjects.set({text:""}),p.current)me.a.restore(p.current);else{var e=k[i];e&&me.a.selectObject(e,-1)}},w=function(){return _(i<=0?k.length-1:i-1)},S=function(){return _(i>=k.length-1?0:i+1)};return s.a.createElement(_e.a,null,s.a.createElement("div",{className:"absolute flex items-center mx-2 my-2 overflow-hidden rounded c-bg-menu c-shadow-popup inset-r-0 inset-t-0"},s.a.createElement(C.a,{width:150,backgroundTheme:"c-bg-menu",height:je,border:!1,fontSize:12,padding:{left:16,right:16},placeholder:"Find",value:h,onChange:function(e){t.searchingPaneObjects.setProperty("text",e)},onKeyDown:function(e){e.keyCode===c.a.KeyCode.Escape?b():e.keyCode===c.a.KeyCode.Enter&&(e.shiftKey?w():S())},focused:!0,underline:!1,ref:m}),s.a.createElement("div",{className:"pr-2 text-right text-11 c-foreground-light",style:{minWidth:30}},h?"".concat(k.length?i+1:0,"/").concat(k.length):void 0),s.a.createElement("div",{className:"mx-2 c-bg-darker",style:{height:24,width:1}}),s.a.createElement(E.a,{className:"c-button noShrink",width:je,height:je,icon:"IoIosArrowUp",onClick:w}),s.a.createElement(E.a,{className:"c-button noShrink",width:je,height:je,icon:"IoIosArrowDown",onClick:S}),s.a.createElement(E.a,{className:"searchX c-button noShrink",width:je,height:je,icon:"MdClose",onClick:b})))})),He=Object(f.b)((function(e){var t,a,n=e.pane,u=Object(g.a)(n.paddingTop,n.item.get()._note,l.default.DisplaySettings._noteFontSize,n.item,n.viewState,null===(t=n.item.get()._note.get())||void 0===t?void 0:t.itemChanged),d=r()(u,3),h=d[0],f=d[1],p=d[2],m=Object(o.useRef)(),v=(n.isViewOutline()||n.isViewProjectNoBlocks(),n.isViewAgenda(),{paddingTop:h}),y=null===f||void 0===f?void 0:f.getNotePreviewMultiline();if(y){var k={fontSize:p,textOverflow:"ellipsis",paddingLeft:30,paddingRight:c.a.ItemPaddingRightVirtuoso};a=s.a.createElement("div",{className:"relative pt-1 overflow-hidden font-normal cursor-pointer itemInPaneNote c-foreground-faded z-1",style:k,onClick:function(){l.default.DragDrop.isDraggingDelayed||n.openNoteContextMenu(f,m.current)},ref:m},y.map((function(e){return s.a.createElement("div",{key:e},e)})))}var _=function(e){me.a.isInMobileMultiselect()||(i.default.preventAndStop(e),I.a.app?requestAnimationFrame((function(){me.a.selectIndex(0,0)})):(me.a.selectIndex(0,0),i.default.enforceBodyScroll()))};return s.a.createElement("div",{style:v},a,s.a.createElement("div",{className:"paneTopBox",onClick:_}))})),Ve=Object(f.b)((function(e){var t=e.pane,a=300,n=Object(g.a)(h.b.isKeyboardOpen),o=r()(n,1)[0];a=t.rect.get().height-(o?40:160);return s.a.createElement("div",{className:"paneFooter hide-print",style:{height:a},onMouseDown:function(e){var a=t.indexOfLastItem();a>=0?(e.shiftKey&&me.a.isValid()?me.a.selectIndices(me.a.getStartIndex(),me.a.getStartOffset(),a,-1):me.a.selectIndex(a,-1),i.default.preventAndStop(e)):t.addItem({text:""})}})})),We=Object(f.b)((function(e){var t=e.className,n=e.pane,u=e.initialScrollIndex,d=Object(o.useRef)(),h=Object(g.a)(n.items,l.default.settings.disableAnimations,l.default.DisplaySettings._itemPadding,l.default.DisplaySettings._itemLineHeight,n.searchingPaneObjects,n.isSearchingGlobal,l.default.DragDrop.dragging,l.default.DisplaySettings.isPrinting),f=r()(h,8),p=f[0],m=f[1],v=f[2],y=f[3],k=f[4],_=f[5],b=f[6],w=f[7],S=Object(o.useRef)(),D=Object(o.useRef)(),P=Object(o.useRef)(p),E=P&&i.default.isArrayEqualWithProperty(p,P.current,"id")?P.current:p;void 0===u&&(u=n.initialScrollIndex),Object(o.useEffect)((function(){n.paneContent=d.current,n.scrollElement=i.default.findChild(d.current,"paneContent"),n.listManager.setVirtualList(D.current)}),[]);var C=Object(o.useCallback)((function(e){n.listManager.setScrollRange(e)}),[]),x=Object(o.useCallback)((function(e,t){if(!(t<0||t>=n.items.length())){var a=e.type,r=e.item;if(!(null===r||void 0===r?void 0:r.isNote())){if("blockItem"===a)return s.a.createElement(Be,{paneObject:e});if("blockHeader"===a)return s.a.createElement(Me,{paneObject:e});if("blockAddItem"===a)return s.a.createElement(Te,{paneObject:e})}}}),[]),A=Object(o.useMemo)((function(){return s.a.createElement(He,{pane:n})}),[]),T=Object(o.useMemo)((function(){return s.a.createElement(Ve,{pane:n})}),[]),M=Object(o.useMemo)((function(){var e,t=a(160).default;return e=s.a.createElement(t,{inPane:!0}),s.a.createElement(s.a.Fragment,null,s.a.createElement(xe,{ref:S,pane:n}),e)}),[]),L=Object(o.useCallback)((function(e){if(m)return!1;if(e){var t=e.item;return ge.a.shouldAnimate(null===t||void 0===t?void 0:t.id)}}),[m]),O=y+2*v;return s.a.createElement("div",{className:t,ref:d},s.a.createElement(we.a,{className:"flex1 c-background paneDocumentContent paneContent select-none break-words",items:E,header:A,footer:T,floating:M,renderItem:x,onRangeChanged:C,shouldAnimate:!m&&!I.a.isMobile&&L,initialScrollIndex:u>=0&&u<E.length?u:void 0,defaultItemSize:O,overscan:w?1e8:c.a.ListOverscan,pinIDs:(null===b||void 0===b?void 0:b.pane)===n?b.items.map((function(e){return e.id})):void 0,shouldMemoize:!0,ref:D}),s.a.createElement(ve,{className:"absolute inset-t-0 inset-r-0 z-5",initial:{y:-40},exit:{y:-60},transition:c.a.TransitionSpringMediumer},k.isSearching&&s.a.createElement(Ue,{pane:n})),s.a.createElement(ve,{className:"absolute inset-x-0 flex justify-center inset-t-0 z-5",initial:{y:-40},exit:{y:-60},transition:c.a.TransitionSpringMediumer},_&&s.a.createElement(Pe,{pane:n})))})),ze=Object(f.b)((function(e){var t=e.className,a=e.pane,n=e.initialScrollIndex,u=e.ItemComponent,d=e.defaultItemSize,h=e.header,f=e.onEndReached,p=e.footer,m=Object(g.a)(a.items,l.default.DisplaySettings.isPrinting),v=r()(m,2),y=v[0],k=v[1],_=Object(o.useRef)(),b=Object(o.useRef)(),w=Object(o.useRef)(y),S=w&&i.default.isArrayEqualWithProperty(y,w.current,"id")?w.current:y;Object(o.useEffect)((function(){return a.paneContent=b.current,a.scrollElement=i.default.findChild(b.current,"paneContent"),a.listManager.setVirtualList(_.current),a.onLoad(),function(){return a.onUnload()}}),[]);var D=Object(o.useCallback)((function(e){a.listManager.setScrollRange(e)}),[]),P=Object(o.useCallback)((function(e,t){if(!(t<0||t>=a.items.length()))return"blockItem"===e.type?s.a.createElement(u,{paneObject:e}):void 0}),[]);return s.a.createElement("div",{className:t,ref:b},s.a.createElement(we.a,{className:"flex-1 c-background paneContent select-none break-words",items:S,header:h,footer:p,renderItem:P,onRangeChanged:D,defaultItemSize:d,initialScrollIndex:n>=0&&n<S.length?n:void 0,onEndReached:f,overscan:k?1e8:c.a.ListOverscan,shouldMemoize:!0,ref:_}))})),qe=Object(f.b)((function(e){var t=e.className,a=e.pane,n=e.initialScrollIndex,u=e.ItemComponent,d=(e.itemHeight,e.header),h=e.defaultItemSize,f=e.onEndReached,p=e.footer,m=Object(g.a)(a.itemsSimple,l.default.DisplaySettings.isPrinting),v=r()(m,2),y=v[0],k=v[1],_=Object(o.useRef)(),b=Object(o.useRef)();Object(o.useEffect)((function(){return a.paneContent=b.current,a.scrollElement=i.default.findChild(b.current,"paneContent"),a.listManager.setVirtualList(_.current),a.onLoad(),function(){return a.onUnload()}}),[]);var w=Object(o.useCallback)((function(e){a.listManager.setScrollRange(e)}),[]),S=Object(o.useCallback)((function(e,t){if(!(t<0||t>=a.itemsSimple.length()))return"item"===e.type?s.a.createElement(u,{paneObject:e}):void 0}),[]);return s.a.createElement("div",{className:t,ref:b},s.a.createElement(we.a,{className:"flex-1 c-background paneContent select-none break-words",items:y,header:d,footer:p,defaultItemSize:h,renderItem:S,onRangeChanged:w,initialScrollIndex:n>=0&&n<y.length?n:void 0,onEndReached:f,overscan:k?1e8:c.a.ListOverscan,shouldMemoize:!0,ref:_}))})),Ge=a(111),Ke=a(31),Ye=a(157).default,Xe=Object(f.b)((function(e){var t=e.paneObject,a=t.item,n=(t.index,t.pane);Object(g.a)(a.itemChanged);var u=[Object(o.useRef)()],d=r()(u,2),h=d[0],f=(d[1],a.getAttachmentByPlugin(c.a.PluginID.Gmail)),p=f&&(n.type,c.a.PaneMode.Gmail,f===l.default.EmailPreview.getThreadAttach()&&l.default.EmailPreview.isOpenOnPane(n));if(Object(Oe.b)(t,h),!f)return s.a.createElement("div",null,"Failed to render");var m=null===f||void 0===f?void 0:f.getPlugin(),v=i.default.classNames("paneGmailItem paneItemElement relative",m.getCssClass(f,n),{"c-background-item-selected":p}),y=Ge.a.renderPaneJSX(t);return s.a.createElement(Ye,{className:v,ref:h,paneObject:t,onPress:function(e){l.default.DragDrop.isDraggingDelayed||(m.isEmailOpenByItem(a,n)?l.default.EmailPreview.close():m.openEmailByItem(a,n))},supportMultiselect:!1},y)})),Qe=a(134),Je=Object(f.b)((function(e){var t=e.paneObject,a=t.item,n=(t.index,t.pane),o=n.plugin,u=a.getAttachmentByPlugin(c.a.PluginID.Drive),d=n.isItemHeader(a,!1),h=n.isPaneObjectCollapsed(t),f=l.default.DisplaySettings.lineHeightForItem(t),p=n.getPaddingForPaneObject(t),m=Object(g.a)(l.default.DisplaySettings._itemPadding,l.default.DisplaySettings._fontSize,a.itemChanged),v=r()(m,2),y=v[0],k=v[1];y+=2;var _,b=i.default.classNames("itemNew itemInPane paneItemElement relative"),w={paddingLeft:p,paddingTop:y,paddingBottom:y,paddingRight:30,lineHeight:Math.floor(1.2*f)+"px",fontSize:k};if(d){var S=i.default.classNames("collapserNew c-foreground-super-faded c-color-hover",{"collapsed icon-angle-right":h},{"icon-angle-down":!h}),D={left:-4,width:p,lineHeight:f+"px",paddingTop:y};_=s.a.createElement("div",{className:S,style:D,"data-tooltip":"<b>Click</b> to open in Drive",onClick:function(e){l.default.DragDrop.isDraggingDelayed||(i.default.preventAndStop(e),n.handleLeftSideTap(t,e))}})}return s.a.createElement("div",{className:b,style:w,onClick:function(e){l.default.DragDrop.isDraggingDelayed||o.handleTapClick(a,n,u.id,e)},onMouseDown:function(e){a.checkDragOnStart(e)},onContextMenu:function(e){l.default.menus.openContextMenu({componentName:"ReactContextMenuItem",key:"menu"+a.id+e.clientX+e.clientY,element:e.target,item:a,pane:n,paneObject:t,showExtra:e.ctrlKey||e.altKey||e.metaKey,pos:{left:e.pageX,top:e.pageY}}),i.default.preventAndStop(e)}},_,Qe.a.renderPaneJSX(t))})),Ze=a(72),$e=(a(159),a(157).default),et=Object(f.b)((function(e){var t=e.paneObject,a=t.item,n=t.pane,u=t.index,d=a.subject,h=a.participants,f=a.snippet,p=a.date,m=a.labels,v=a.plugin,y=a.hasAttachment,k=Object(o.useRef)(),_=Object(g.a)(a.isRead,a.isStarred,a.numMessages,n.zoomedItem,Ke.a.getSelectedForPaneObs(n),me.a.selectedMapObs),b=r()(_,5),w=b[0],S=b[1],D=b[2],P=b[3],I=(b[4],!!me.a.getSelection(t));Object(Oe.b)(t,k);Object(o.useCallback)((function(e){Ke.a.isSelected(u,n)||Ke.a.setSelected([u],n),l.default.menus.openContextMenu({componentName:"ReactContextMenuInboxItem",element:n.elementAtIndex(u),pane:n}),i.default.preventAndStop(e)}),[u]),Object(o.useMemo)((function(){return{id:a.id,width:400,pane:n}}),[]);var E,C=i.default.classNames("paneGmailItemContent inboxPane relative flex flex-col justify-center border-b c-border-light",{"c-background-item-selected":I});E=U.a.isToday(p)?l.default.International.getFormat(c.a.DFormat.ShortTime):p.getYear()!==(new Date).getYear()?l.default.International.getFormat(c.a.DFormat.MonthDayYearShort):l.default.International.getFormat(c.a.DFormat.MonthDay);var x=!w&&i.default.classNames("unreadDot",{selected:I}),A=s.a.createElement(s.a.Fragment,null,S&&s.a.createElement("div",{className:"absolute inset-y-0 left-0 flex items-center",style:{paddingLeft:6,color:"#fd2"}},s.a.createElement(Ze.a,{name:"MdStar"})),!S&&!w&&s.a.createElement("div",{className:x}),s.a.createElement("div",{className:"flex flex-row justify-between line1"},s.a.createElement("div",{className:i.default.classNames("from",{"font-bold":!w})},h.map((function(e){return e.text||e.email})).join(", ")),s.a.createElement("div",{className:"emailDate c-foreground-faded"},p.toString(E))),s.a.createElement("div",{className:"flex flex-row justify-between line2"},s.a.createElement("div",{className:i.default.classNames("subject c-foreground",{"font-bold":!w})},d),s.a.createElement("div",{className:"flex items-center"},y&&s.a.createElement(Ze.a,{name:"MdAttachFile",size:16}),D>1&&s.a.createElement("div",{className:"count"},D))),s.a.createElement("div",{className:"flex flex-row items-center justify-between truncate line3"},f&&s.a.createElement("div",{className:"snippet c-foreground-faded"},f),(null===m||void 0===m?void 0:m.length)>0&&s.a.createElement("div",{className:"truncate tags py-0p5",style:{maxWidth:140}},m.filter((function(e){return"starred"!==e&&e!==P.label})).map((function(e,t){return s.a.createElement("span",{key:e,className:i.default.classNames("px-1p5 py-0p5 rounded c-tag",{"c-bg-gray-200":!I,"ml-1":t>0})},v.getLabelName(e))})))));return s.a.createElement($e,{className:C,ref:k,paneObject:t,onPress:function(){n.onDoubleClick(t.index)},supportMultiselect:!1},A)})),tt=Object(f.b)((function(e){var t,n=e.pane,l=(e.isPopup,e.initialScrollIndex),u=(e.startDragging,e.header),d=(e.renderLeftButtons,e.renderRightButtons,e.onEndReached),f=e.footer,p=Object(g.a)(n.toast,n.viewState),m=r()(p,2),v=m[0],y=(m[1],n.type),k=i.default.classNames("pane c-border-pane flex flex-col",n.paneClass);Object(o.useEffect)((function(){return n.onLoad(),B.a.fireEvent("paneAdded",[n]),function(){return n.onUnload()}}),[]);var _,b,w="relative flex flex-col flex1 fontPane overflow-hidden";y===c.a.PaneMode.Task?t=n.isViewCalendar()?s.a.createElement(pe,{className:w,pane:n,initialScrollIndex:l}):s.a.createElement(We,{className:w,pane:n,initialScrollIndex:l}):y===c.a.PaneMode.Gmail?t=s.a.createElement(ze,{className:w,pane:n,initialScrollIndex:l,ItemComponent:Xe,defaultItemSize:80,onEndReached:d,header:u,footer:f}):y===c.a.PaneMode.Drive?t=s.a.createElement(ze,{className:w,pane:n,initialScrollIndex:l,ItemComponent:Je,defaultItemSize:33,header:u,footer:f}):y===c.a.PaneMode.Inbox&&(t=s.a.createElement(qe,{className:w,pane:n,initialScrollIndex:l,ItemComponent:et,defaultItemSize:80,onEndReached:d,header:u,footer:f}));var S=Object(g.a)(h.b.keyboardHeight),D=r()(S,1)[0],P=a(300).default;if(_=s.a.createElement(P,{pane:n}),n.type===c.a.PaneMode.Task){var I=a(173).default,E=Object(o.useCallback)((function(){n.onTapAddItem()}),[]);b=0===D&&s.a.createElement(I,{pane:n,role:"add",onPress:E})}return s.a.createElement("div",{className:k},undefined,_,t,b,v&&s.a.createElement("div",{className:"paneToasts"},s.a.createElement(F,{paneToast:v})))})),at=a(106);function nt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=J()(e);if(t){var r=J()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return X()(this,a)}}var rt=function(e){K()(a,e);var t=nt(a);function a(){return W()(this,a),t.apply(this,arguments)}return q()(a,[{key:"render",value:function(){var e=this.props,t=i.default.classNames("fancyContextMenuItem fancyContextMenuHeader flexbox c-foreground-very-faded",e.className,{"border-b c-border-light":!1!==e.border},{topHeader:e.topHeader}),a=i.default.classNames("fancyContextMenuHotkey c-foreground-faded",{centered:e.hotkeyCentered}),n=Object.assign({padding:isNaN(e.padding)?void 0:e.padding},e.style);return s.a.createElement("div",{className:t,style:n},s.a.createElement("span",{className:"f1"},e.children),e.hotkey&&s.a.createElement("span",{className:a},e.hotkey))}}]),a}(ae.a),it=a(91),ot=Object(f.b)((function(e){var t=e.pane,a=e.isPopup,n=e.initialScrollIndex,i=e.startDragging,u=Object(g.a)(t.viewState,t.item,t.plugin.isLoadingThreads),d=r()(u,3),h=(d[0],d[1]),f=d[2],p=t.getViewMode(),m=function(e){return s.a.createElement(at.a,{key:"contextMenuGmailSort",id:"contextMenuGmailSort",element:e.element},s.a.createElement(rt,null,"Sort by"),s.a.createElement(it.a,{icon:"icon-access_time",onClick:t.setViewMode.bind(t,c.a.GmailViewMode.Date)},c.a.GmailViewMode.Date),s.a.createElement(it.a,{icon:"icon-exclamation",onClick:t.setViewMode.bind(t,c.a.GmailViewMode.Priority)},c.a.GmailViewMode.Priority))},v=function(e){l.default.menus.openContextMenu({fn:m,element:e.target})},y=function(){t.setViewMode(p===c.a.GmailViewMode.Date?c.a.GmailViewMode.Priority:c.a.GmailViewMode.Date),l.default.menus.closeContextMenu()},k=function(){var e,t=l.default.pluginManager.getPluginGmail();h&&(e=t.getAccountIDFromItem(h)),l.default.menus.openComposeEmail(t,{accountID:e})},_=Object(o.useMemo)((function(){return s.a.createElement("div",{style:{height:c.a.Mobile.TopBarHeight}})}),[]),b=Object(o.useMemo)((function(){return s.a.createElement("div",{className:"py-4 text-center c-foreground-light"},"Loading more emails...")}),[]);return s.a.createElement(tt,{pane:t,isPopup:a,initialScrollIndex:n,startDragging:i,renderLeftButtons:function(){return s.a.createElement(R.a,{icon:"icon-mail_outline",iconSize:15,onClick:k,tooltip:"New Email",tooltipHotkey:{name:"EmailCompose",group:"Global"}})},renderRightButtons:function(){return s.a.createElement(R.a,{className:"emailViewButton",tooltip:"Sort Order",icon:p===c.a.GmailViewMode.Date?"icon-access_time":"icon-exclamation",iconSize:14,width:c.a.PaneHeaderButtonWidth,height:c.a.PaneHeaderButtonHeight,onClick:y,onHold:v})},onEndReached:function(e){e>5&&t.onScrollEnd()},header:_,footer:f?b:void 0})})),st=Object(f.b)((function(e){var t=e.pane,a=e.isPopup,n=e.initialScrollIndex,i=e.startDragging,l=Object(g.a)(t.plugin.isLoadingFiles),u=r()(l,1)[0],d=Object(o.useMemo)((function(){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{style:{height:c.a.Mobile.TopBarHeight}}),!1)}),[]),h=Object(o.useMemo)((function(){return s.a.createElement("div",{className:"px-6 py-4 c-foreground-light"},"Loading files...")}),[]);return s.a.createElement(tt,{pane:t,isPopup:a,initialScrollIndex:n,startDragging:i,renderRightButtons:function(){return s.a.createElement(s.a.Fragment,null,s.a.createElement(E.a,{icon:"IoIosArrowForward",iconSize:16,width:c.a.PaneHeaderButtonWidth,height:c.a.PaneHeaderButtonIconHeight,onClick:t.toggleCollapseAll,tooltip:"Collapse all",tooltipHotkey:{name:"CollapseAll",group:"Pane"},disabled:!t.canCollapse()}))},header:d,footer:u?h:void 0})})),lt=Object(f.b)((function(e){var t=e.pane.pluginNew,a=Object(g.a)(t.isFirstLoaded,l.default.settings.emailViewAccounts),n=r()(a,2),i=n[0],o=n[1];return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{style:{height:c.a.Mobile.TopBarHeight}}),!i&&l.default.supportEmailViews()&&o.length>0&&s.a.createElement("div",{className:"flex items-center justify-center py-4 c-foreground-light"},"Loading..."),!1)})),ut=Object(f.b)((function(e){var t=e.pane.pluginNew,a=Object(g.a)(t.isLoadingMore),n=r()(a,1)[0];return n?s.a.createElement("div",{className:"flex items-center justify-center pt-6 pb-12 c-foreground-light"},n&&"Loading more..."):null})),ct=Object(f.b)((function(e){var t=e.pane,a=e.isPopup,n=e.initialScrollIndex,r=e.startDragging,i=Object(o.useMemo)((function(){return s.a.createElement(ut,{pane:t})}),[]),l=Object(o.useMemo)((function(){return s.a.createElement(lt,{pane:t})}),[]);return s.a.createElement(tt,{pane:t,isPopup:a,initialScrollIndex:n,startDragging:r,header:l,footer:i,onEndReached:function(e){e>40&&t.onEndReached()}})}));function dt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=J()(e);if(t){var r=J()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return X()(this,a)}}var ht=function(e){K()(a,e);var t=dt(a);function a(){return W()(this,a),t.apply(this,arguments)}return q()(a,[{key:"render",value:function(){return s.a.createElement(R.a,w()({},this.props,{className:"fancyCalendarDayButton",iconSize:16,padding:0,tooltip:"Jump to Today",icon:"icon-calendar-o",center:!0}),this.props.day)}}]),a}(ae.a),ft=Object(f.b)((function(e){var t=e.pane,a=e.isPopup,n=e.initialScrollIndex,i=e.startDragging,o=Object(g.a)(t.hasCollapsedObs,t.rect,l.default.settings.calendarCustomDays,U.a.todayObs,t.viewState),u=r()(o,4),d=u[0],h=u[1],f=u[2],p=u[3],m=h.width>550,v=t.isViewCalendar(),y=t.getViewMode(),k=c.a.TaskViewModeText[y],_=c.a.PaneHeaderButtonWidth,b=function(){t.scrollJump(-1,"smooth")},w=function(){t.scrollJump(1,"smooth")},S=function(e){return function(){t.setViewMode(e)}},D=c.a.SearchHeight,P=(d?"Expand":"Collapse")+" all items in view",I=t.isViewAgenda()&&["Agenda_Today","Agenda_Week","Agenda_Month","Agenda_All"]||t.isViewCalendar()&&["Calendar_Day","Calendar_Custom","Calendar_Week","Calendar_Month"],C=s.a.createElement(ht,{day:p.getDate(),width:D+(t.isViewAgenda()?8:0),height:D,onClick:function(){t.scrollToToday("smooth")}});return s.a.createElement(tt,{pane:t,isPopup:a,initialScrollIndex:n,startDragging:i,renderRightButtons:function(){return s.a.createElement(s.a.Fragment,null,t.isViewDates()&&s.a.createElement("div",{className:"flex calendarButtons"},t.isViewCalendar()&&s.a.createElement(E.a,{icon:"IoMdArrowDropleft",iconSize:20,width:20,height:D,onClick:b,disabled:!v,tooltip:"Previous "+k}),C,t.isViewCalendar()&&s.a.createElement(E.a,{icon:"IoMdArrowDropright",iconSize:20,width:20,height:D,onClick:w,disabled:!v,tooltip:"Next "+k}),m&&s.a.createElement("div",{className:"flex viewModeButtons"},I.map((function(e){var t=c.a.TaskViewModeText[e];return"Calendar_Custom"===e&&(t=t.replace("#",f)),s.a.createElement(E.a,{text:t,height:D,className:e===y&&"font-semibold",color:e===y?"c-foreground-light":"c-foreground-very-faded",onClick:S(e),size:11,key:e})})))),t.supportCollapsing&&!t.isViewCalendar()&&s.a.createElement(E.a,{icon:d?"IoIosArrowDown":"IoIosArrowForward",iconSize:14,width:_,height:28,onClick:t.toggleCollapseAll,tooltip:P,tooltipHotkey:{name:"CollapseAll",group:"Pane"},disabled:!t.canCollapse()}))}})})),pt=a(54),gt=a(150),mt=a(34),vt=a(154),yt=a(38),kt=a.n(yt);function _t(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=J()(e);if(t){var r=J()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return X()(this,a)}}var bt=function(e){K()(a,e);var t=_t(a);function a(){return W()(this,a),t.apply(this,arguments)}return q()(a,[{key:"render",value:function(){var e=this.props,t={height:e.height},a=kt()({},I.a.transform.react,"scale("+e.percent+", 1)"),n={lineHeight:e.height-2+"px"};return s.a.createElement("div",{className:"fancyProgressBar",style:t},!e.error&&s.a.createElement("div",{className:"fancyProgressInside",style:a}),e.error&&s.a.createElement("div",{className:"fancyProgressError",style:n},e.errorMsg))}}]),a}(ae.a);function wt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=J()(e);if(t){var r=J()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return X()(this,a)}}var St,Dt=function(e){K()(a,e);var t=wt(a);function a(){return W()(this,a),t.apply(this,arguments)}return q()(a,[{key:"init",value:function(){this.createObservables({attachments:[]}),this.onAttachmentUpdate(),this.props.threadAttach.subscribe(this)}},{key:"onUnmount",value:function(){this.props.threadAttach.unsubscribe(this)}},{key:"onAttachmentUpdate",value:function(){var e=this;this.props.threadAttach.getPlugin().getMessageDisplayAttachments(this.props.message).then((function(t){return e.attachments.set(t)}))}},{key:"onAttachmentIDChange",value:function(){}},{key:"isAttachImage",value:function(e){var t=e.mimeType;return"image/png"===t||"image/jpg"===t||"image/jpeg"===t||"image/gif"===t}},{key:"onClickAttach",value:function(e,t){if(e.error)e.uploader&&!e.uploader.isDone()&&e.uploader.resume();else if(!e.uploader||e.uploader.isDone()){var a=this._getURL(e);this.props.editable?l.default.openUrl(a):e.attID?I.a.mac&&t.metaKey||!I.a.mac&&t.ctrlKey||!this.isAttachImage(e)?i.default.downloadFile(a,e.cid):l.default.menus.openLightbox(a,"Download",(function(){i.default.downloadFile(a,e.cid)})):l.default.openUrl(a)}t.stopPropagation()}},{key:"onClickDelete",value:function(e,t){var a=this;i.default.preventAndStop(t),_()(y.a.mark((function t(){var n,r;return y.a.wrap((function(t){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(t.prev=t.next){case 0:return n=a.props.threadAttach.getPlugin(),t.next=3,n.removeAttachFiles(a.props.threadAttach,a.props.message,e);case 3:r=t.sent,a.props.onUpdate&&a.props.onUpdate(r);case 5:case"end":return t.stop()}}}),t)})))()}},{key:"onAttachDragStart",value:function(e){var t=e.target.getAttribute("data-downloadurl");e.stopPropagation(),e.dataTransfer.setData("DownloadURL",t),l.default.DragDrop.setExternalData(t)}},{key:"_getURL",value:function(e){return this.props.editable||!e.attID?l.default.EmailPreview.getPreviewURL(e):l.default.EmailPreview.getAttachmentURL(this.props.threadAttach.getField("accountID"),this.props.message.id,e.attID)}},{key:"_renderAttachment",value:function(e){var t=e.mimeType+":"+e.cid+":"+this._getURL(e),a=e.uploader?i.default.clamp(e.uploader.getPercent(),.05,1):1,n=this.isAttachImage(e)?"Click to open image.\n"+I.a.priModKey+" click to download image.":"Click to download image";return s.a.createElement("div",{key:e.id,className:"messageAttachment flexbox c-button-raised",draggable:!0,"data-downloadurl":t,onClick:this.onClickAttach.bind(this,e),onDragStart:this.onAttachDragStart,"data-tooltip":n},s.a.createElement("div",{className:"attachmentIcon icon-drive-file"}),s.a.createElement("div",{className:"attachmentText"},e.cid),s.a.createElement("div",{className:"f1"}),a<1&&s.a.createElement(bt,{percent:a,height:22,error:e.error,errorMsg:"Click to retry"}),1===a&&e.error&&s.a.createElement("div",null,"ERROR"),s.a.createElement("div",{className:"attachmentSize"},i.default.toFileSize(e.size)),this.props.editable&&s.a.createElement(R.a,{className:"attachmentClose",icon:"icon-close",onClick:this.onClickDelete.bind(this,e),tooltip:"Remove"}))}},{key:"render",value:function(){var e=null,t=this.state.attachments;if(t.length>0){for(var a=0,n=[],r=0;r<t.length;++r){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var i=t[r];n.push(this._renderAttachment(i))}e=s.a.createElement("div",{className:"messageAttachments c-border"},n)}return e}}]),a}(ae.a),Pt=a(10),It=a.n(Pt),Et=a(11),Ct=a(85),xt=(St=function(){function e(t,a,n){W()(this,e),this.plugin=t.getPlugin(),this.threadAttach=t,this.message=a,this._getEmailData=n}return q()(e,[{key:"onMount",value:function(){this._isMounted=!0}},{key:"onUnmount",value:function(){this._isMounted=!1,this.flushUnsavedChanges({updateRemoteDraft:!0,forceFlush:!0})}},{key:"onEmailChanged",value:function(){this.saveDraft({updateRemoteDraft:!0,forceFlush:!1})}},{key:"saveDraft",value:function(e){var t=e.updateRemoteDraft,a=e.forceFlush;clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0,this.needsSaveDraft=t,this.needsForceFlush=a,this._isMounted&&(this._draftUpdateDebounce=setTimeout(this.flushUnsavedChanges.bind(this,{updateRemoteDraft:t,forceFlush:a}),1e3))}},{key:"flushUnsavedChanges",value:function(e){var t=e.updateRemoteDraft,a=e.forceFlush;this._draftUpdateDebounce&&(clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0,this._saveDraftUpdates(this.needsSaveDraft||t,this.needsForceFlush||a),this.needsSaveDraft=!1,this.needsForceFlush=!1)}},{key:"discardDraft",value:function(){this.plugin.discardDraft(this.threadAttach,this.message.id,this.message.draftID,(function(e){try{i.default.PAssert(1350,e,"Should always be able to delete a draft")}catch(t){i.default.reportError(t)}}))}},{key:"getComposeBody",value:function(){var e=_()(y.a.mark((function e(t){var a;return y.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:if(!t||!t.decoded){e.next=4;break}return e.next=3,Ct.a.getComposeBody(t.decoded,t.resources);case 3:a=e.sent;case 4:return e.abrupt("return",a);case 5:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"createTokensFromAddressText",value:function(e){var t=[];if(e)for(var a=0,n=0;n<e.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var r=e[n];r.text?t.push(r):r.email&&t.push({email:r.email,text:r.email})}return{tokens:t}}},{key:"_saveDraftUpdates",value:function(e,t){if(i.default.shouldLog(c.a.LogLevels.Compose)&&i.default.log("Queue Save Draft: ",this.threadAttach.id,this.message.id,this.message.draftID,this._isMounted),this._isMounted){var a=this._getEmailData();this.plugin.updateDraft(this.threadAttach,this.message.id,this.message.draftID,a,e,t,(function(e){console.log("draft updated",e);try{i.default.PAssert(1351,e,"Should always be able to update a draft")}catch(t){i.default.reportError(t)}}))}}},{key:"prepForSend",value:function(e,t){this.flushUnsavedChanges({updateRemoteDraft:!1,forceFlush:!1}),e.to&&e.to.length?e.subject?e.decoded?t():l.default.menus.confirm("There is no email body. Send anyway?",(function(e){e&&t()})):l.default.menus.confirm("There is no email subject. Send anyway?",(function(e){e&&t()})):l.default.menus.alert({text:"Please enter a recipient."})}},{key:"changeFrom",value:function(){var e=_()(y.a.mark((function e(t){var a,n,r,i,o,s;return y.a.wrap((function(e){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(e.prev=e.next){case 0:return a=this.threadAttach,n=this.plugin.getSyncAccount(t),r=this.plugin.getSendingAccountInfo(t),this.flushUnsavedChanges({updateRemoteDraft:!1,forceFlush:!1}),e.next=6,this.plugin.changeMessageAccount(a,this.message.id,this.message.draftID,n,t,r);case 6:return i=e.sent,o=this.plugin.getDraftByID(n,i.threadID,i.messageID),this.threadAttach=o.attach,this.message=o.draftMsg,this.saveDraft({updateRemoteDraft:!0,forceFlush:!1}),e.next=13,this.getComposeBody(this.message);case 13:if(e.t0=e.sent,e.t0){e.next=16;break}e.t0="";case 16:return s=e.t0,e.abrupt("return",{body:s,threadAttach:this.threadAttach,message:this.message});case 18:case"end":return e.stop()}}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),It()(St.prototype,"flushUnsavedChanges",[Et.a],Object.getOwnPropertyDescriptor(St.prototype,"flushUnsavedChanges"),St.prototype),St);function At(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=J()(e);if(t){var r=J()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return X()(this,a)}}var Tt=function(e){K()(a,e);var t=At(a);function a(){return W()(this,a),t.apply(this,arguments)}return q()(a,[{key:"init",value:function(){var e=this.props;this.threadAttach=e.threadAttach,this.message=e.message,this._composeHelper=new xt(this.threadAttach,this.message,this.getEmailData),this._dragEnterCounter=0,this._escapedFromDrag=!1,this.to=this._composeHelper.createTokensFromAddressText(this.message.to),this.cc=this._composeHelper.createTokensFromAddressText(this.message.cc);var t=!!this.message.cc&&this.message.cc.length>0;if(this.createObservables({showSubject:e.showSubject,showCc:t,showBcc:!1,isSending:!1,isDragOver:!1}),this.listenTo(mt.a.onAccountsUpdated),this.message.inReplyTo){var a=this.threadAttach.getData().messages,n=a.indexOfWithProperty("messageID",this.message.inReplyTo);if(n>=0){var r=a[n];try{i.default.PAssert(1344,r.initializedForDisplay,"Message must be ready to display if being replied to")}catch(o){i.default.reportError(o)}r&&r.responseMode&&(this.modeListener=r.responseMode.listen(this.onReplyModeChanged))}}i.default.isDemoMode()&&(i.default.reactEmailCompose=this),this.refBody=s.a.createRef(),this.refContainer=s.a.createRef(),this.refPicker=s.a.createRef(),this.refTo=s.a.createRef(),this.refCc=s.a.createRef(),this.refBcc=s.a.createRef(),this.refSubject=s.a.createRef(),this.refFrom=s.a.createRef(),this.refLink=s.a.createRef()}},{key:"onReplyModeChanged",value:function(){this.to=this._composeHelper.createTokensFromAddressText(this.message.to),this.cc=this._composeHelper.createTokensFromAddressText(this.message.cc),this.cc&&this.cc.tokens&&this.cc.tokens.length>0&&this.showCc.set(!0),this.updateState()}},{key:"_getHotkeys",value:function(){return[l.default.hotkeys.create(c.a.KeyCode.Escape,!0,c.a.Primary.Either,c.a.Shift.Either,this.onEscape),l.default.hotkeys.create(c.a.KeyCode.Enter,!0,c.a.Primary.Yes,c.a.Shift.Either,this.sendEmail),l.default.hotkeys.create(c.a.KeyCode.K,!0,c.a.Primary.Yes,c.a.Shift.No,this.insertLinkHotkey)]}},{key:"getPlugin",value:function(){return this.threadAttach.getPlugin()}},{key:"getState",value:function(){return{attachments:this.getPlugin().getMessageDisplayAttachments(this.message),fromAccounts:this.getSendingAccounts()}}},{key:"onMount",value:function(){var e=this;this._composeHelper.onMount(),_()(y.a.mark((function t(){var a,n;return y.a.wrap((function(t){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(t.prev=t.next){case 0:return t.next=2,e._composeHelper.getComposeBody(e.message);case 2:(a=t.sent)&&e.refBody.current.setValue(a),e.refContainer.current.addEventListener("cdrop",e.onItemDrop),(n=e.refPicker.current).addEventListener("change",(function(){return e.getPlugin().notifyAttachFiles(e.threadAttach,e.message,n.files,e.onAttachUpdated),n.value=null,!1}),!1),e.refContainer.current.addEventListener("paste",(function(t){var a=t&&t.clipboardData?t.clipboardData:t.synthetic?t.data:window.clipboardData;if(a&&a.items&&a.items.length>0){for(var n=0,r=0,i=[],o=0;o<a.items.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;"file"===a.items[o].kind&&i.push(a.items[o].getAsFile())}if(i.length>0)return e.getPlugin().notifyAttachFiles(e.threadAttach,e.message,i,e.onAttachUpdated),!1}}),!1),document.addEventListener("mouseup",e.onMouseUp),document.addEventListener("keydown",e.onKeyDown);case 10:case"end":return t.stop()}}}),t)})))()}},{key:"onUnmount",value:function(){this.modeListener&&(this.modeListener.dispose(),this.modeListener=void 0),this._composeHelper.onUnmount(),document.removeEventListener("mouseup",this.onMouseUp)}},{key:"discard",value:function(){this.close(!1,!0,!0)}},{key:"onEscape",value:function(){var e=this;this.isDragOver.get()||(this.refTo.current.getTokens().length>0||this.refBody.current.getValue()||this.state.attachments.length>0?l.default.menus.confirm("Do you want to discard this draft?",(function(t){t&&e.discard()})):this.discard())}},{key:"onFocus",value:function(){this.__hotkeys||(this.__hotkeys=l.default.hotkeys.pushStack(this._getHotkeys())),me.a.clearSelection()}},{key:"onBlur",value:function(){this.__hotkeys&&(l.default.hotkeys.popStack(this.__hotkeys),this.__hotkeys=void 0)}},{key:"onClickAttach",value:function(){this.refPicker.current.click()}},{key:"onAttachUpdated",value:function(e){this._isMounted&&(this.onDraftChanged(),e&&this._composeHelper.flushUnsavedChanges({updateRemoteDraft:!0,forceFlush:!0}),this.updateState())}},{key:"onDragEnter",value:function(e){e.preventDefault(),this._escapedFromDrag||(this._dragEnterCounter++,this.isDragOver.set(!0))}},{key:"onDragLeave",value:function(){this._dragEnterCounter--,0===this._dragEnterCounter&&this.isDragOver.set(!1)}},{key:"onMouseUp",value:function(){this._escapedFromDrag=!1,this.isDragOver.set(!1)}},{key:"onKeyDown",value:function(e){e.keyCode===c.a.KeyCode.Escape&&this.isDragOver.get()&&(this._escapedFromDrag=!0,this.isDragOver.set(!1))}},{key:"onFileDrop",value:function(e){if(!this._escapedFromDrag){this.isDragOver.set(!1);var t=e.dataTransfer;if(t.files&&t.files.length>0)this.getPlugin().notifyAttachFiles(this.threadAttach,this.message,t.files,this.onAttachUpdated.bind(this)),e.preventDefault(),e.stopPropagation(),l.default.DragDrop.stop(),l.default.DragDrop.finish()}}},{key:"onItemDrop",value:function(e){if(e.item&&e.item.hasAttachmentType(c.a.PluginType.Storage)){var t=e.item.getAttachmentByType(c.a.PluginType.Storage);this.getPlugin().notifyAttachLinkedFile(this.threadAttach,this.message,t,this.onAttachUpdated.bind(this))}}},{key:"close",value:function(e,t,a){try{i.default.PAssert(1345,i.default.isBoolean(e),"Must supply a valid value for sendDraft")}catch(n){i.default.reportError(n)}try{i.default.PAssert(1346,i.default.isBoolean(t),"Must supply a valid value for discardDraft")}catch(n){i.default.reportError(n)}try{i.default.PAssert(1347,i.default.isBoolean(a),"Must supply a valid value for forceFlush")}catch(n){i.default.reportError(n)}i.default.shouldLog(c.a.LogLevels.Compose)&&i.default.log("Compose Close: ",e,t,a),!e&&t?this._composeHelper.discardDraft():this._composeHelper.flushUnsavedChanges({updateRemoteDraft:e,forceFlush:a}),this.props.onClose()}},{key:"openSubject",value:function(){var e=this;this.showSubject.set(!0),setTimeout((function(){e._setFocus(e.refSubject.current),e.refSubject.current.selectEnd()}),0)}},{key:"openCc",value:function(){var e=this;this.showCc.set(!0),setTimeout((function(){e._setFocus(e.refCc.current)}),0)}},{key:"openBcc",value:function(){var e=this;this.showBcc.set(!0),setTimeout((function(){e._setFocus(e.refBcc.current)}),0)}},{key:"focusTo",value:function(){this._setFocus(this.refTo.current)}},{key:"focusBody",value:function(){this._setFocus(this.refBody.current)}},{key:"_setFocus",value:function(e){e.isFocused.get()||e.focus()}},{key:"onClickSend",value:function(){this.sendEmail()}},{key:"sendEmail",value:function(){var e=this;this._composeHelper.prepForSend(this.message,_()(y.a.mark((function t(){return y.a.wrap((function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:return $.default.clearSelection(),e.isSending.set(!0),t.next=4,e.getPlugin().sendEmail(e.threadAttach,e.message);case 4:t.sent?e.close(!1,!1,!0):e.isSending.set(!1);case 6:case"end":return t.stop()}}}),t)}))))}},{key:"onDraftChanged",value:function(){this._composeHelper.saveDraft({updateRemoteDraft:!0,forceFlush:!1})}},{key:"getEmailData",value:function(){this.props;return{id:this.message.id,to:this.refTo.current.getTokens(),cc:this.refCc.current&&this.refCc.current.getTokens(),bcc:this.refBcc.current&&this.refBcc.current.getTokens(),subject:this.refSubject.current&&this.refSubject.current.getValue()||this.message.subject,decoded:this.refBody.current.getValue(),snippet:this.refBody.current.getTextValue()}}},{key:"onChangeFrom",value:function(){var e=this;_()(y.a.mark((function t(){var a,n;return y.a.wrap((function(t){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(t.prev=t.next){case 0:return a=e.refFrom.current.value,t.next=3,e._composeHelper.changeFrom(a);case 3:n=t.sent,e.threadAttach=n.threadAttach,e.message=n.message,e.refBody.current.setValue(n.body);case 7:case"end":return t.stop()}}}),t)})))()}},{key:"getSendingAccounts",value:function(){var e,t=this.getPlugin();return this.message.inReplyTo&&(e=this.threadAttach.getField("accountID")),t.getSendingAccounts(e)}},{key:"insertLinkHotkey",value:function(){this.refBody.current.hasFocus()&&this.insertLink()}},{key:"insertLink",value:function(){var e=$.default.getSelectedText(),t=this.refLink.current.getElement();this.savedSel=$.default.getSelectionRange(),l.default.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:t,onClosed:this.onInsertLinkClosed,onInsertLink:this.onInsertLink,text:e})}},{key:"onInsertLinkClosed",value:function(){this.savedSel&&(this.refBody.current.focus(),$.default.setSelectionRange(this.savedSel))}},{key:"onInsertLink",value:function(e){var t=document.createElement("a");t.href=e.url,t.innerText=e.text,this.refBody.current.insertNode(t)}},{key:"render",value:function(){var e=this.state,t=this.props,a=this.to,n=this.cc,r="(no subject)"===this.message.subject?"":this.message.subject,o=this.state.showCc||this.cc&&this.cc.length>0,l=8+(o?0:28)+(e.showBcc?0:34),d=this.message.from.email,h=e.fromAccounts.slice(0),f=e.fromAccounts.length>1,p=i.default.classNames("emailCompose validDropTarget flexbox flexvert",t.className);h.remove(d),h.unshift(d);var g=i.default.classNames("composeHeader c-border-heavy",{showingFrom:e.fromAccounts.length>1});return s.a.createElement("div",{className:p,style:{},ref:this.refContainer,onFocus:this.onFocus,onBlur:this.onBlur,onDrop:this.onFileDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave},s.a.createElement("div",{className:g},s.a.createElement("div",{className:"composeButtons"},!e.showSubject&&s.a.createElement(R.a,{height:24,padding:6,onClick:this.openSubject},"Subject"),!o&&s.a.createElement(R.a,{height:24,padding:6,onClick:this.openCc},"Cc"),!e.showBcc&&s.a.createElement(R.a,{height:24,padding:6,onClick:this.openBcc},"Bcc")),s.a.createElement(C.a,{className:"toBox",height:50,floatingText:"To",display:"block",ref:this.refTo,tokens:a.tokens,focused:"to"===this.props.focus,autocompleteMode:"email",padding:{right:0},margin:{right:l},onChange:this.onDraftChanged,onEscape:t.onEscape}),o&&s.a.createElement(C.a,{height:50,floatingText:"Cc",display:"block",ref:this.refCc,tokens:n.tokens,autocompleteMode:"email",padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),e.showBcc&&s.a.createElement(C.a,{height:50,floatingText:"Bcc",display:"block",ref:this.refBcc,autocompleteMode:"email",padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),e.showSubject&&s.a.createElement(C.a,{height:50,floatingText:"Subject",display:"block",ref:this.refSubject,value:r,padding:t.paddingInput,onChange:this.onDraftChanged,onEscape:t.onEscape}),f&&s.a.createElement("div",{className:"composeFrom"},s.a.createElement("span",null,"From"),s.a.createElement("select",{ref:this.refFrom,onChange:this.onChangeFrom},h.map((function(e){return s.a.createElement("option",{key:e,value:e},e)}))))),s.a.createElement(vt.a,{className:"emailComposeTextarea c-border-heavy f1",ref:this.refBody,onChange:this.onDraftChanged,spellCheck:!0,onEscape:t.onEscape,editable:!e.isSending,richText:!0}),s.a.createElement(Dt,{onUpdate:this.onAttachUpdated,threadAttach:this.threadAttach,message:this.message,editable:!0}),s.a.createElement("div",{className:"composeFooter"},s.a.createElement(R.a,{className:"discardDraft",icon:"icon-delete",iconSize:20,onClick:this.discard,tooltip:"Discard Draft"}),s.a.createElement(R.a,{className:"attachFile",icon:"icon-attach_file",iconSize:20,marginLeft:8,onClick:this.onClickAttach,tooltip:"Attach File"}),s.a.createElement(R.a,{className:"insertLink",icon:"icon-link",ref:this.refLink,iconSize:20,marginLeft:8,onClick:this.insertLink,tooltip:"Insert Link"}),this.state.isSending?s.a.createElement(u.a,{inline:!0,color:c.a.ColorBrand,style:{height:32,lineHeight:"32px",fontWeight:"bold"}},"Sending..."):s.a.createElement(R.a,{className:"buttonSend",primary:!0,marginLeft:16,onClick:!this.state.isSending&&this.onClickSend},e.isSending?"Sending...":"SEND")),s.a.createElement("input",{type:"file",ref:this.refPicker,className:"hidden",multiple:!0}),e.isDragOver&&s.a.createElement("div",{className:"dropNotice flexbox flex-center"},s.a.createElement("div",{className:"dropBg absFull"}),s.a.createElement("div",{className:"f1 center"},s.a.createElement("div",{className:"icon-attach_file"}),s.a.createElement("div",null,"Drop to attach"))))}}]),a}(ae.a);function Mt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=J()(e);if(t){var r=J()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return X()(this,a)}}var Lt=function(e){K()(a,e);var t=Mt(a);function a(){return W()(this,a),t.apply(this,arguments)}return q()(a,[{key:"init",value:function(){this.refMessage=s.a.createRef(),this.refCompose=s.a.createRef()}},{key:"componentDidUpdate",value:function(){this._updateFocus()}},{key:"onMount",value:function(){this.refMessage.current&&(this.scrollIntoView(),this._updateFocus())}},{key:"getState",value:function(){var e=this.props.inReplyToMessage;return{responseMode:e.responseMode,replytoMessageHeight:e.height}}},{key:"onAfterChanged",value:function(e,t){e.replytoMessageHeight!==t.replytoMessageHeight&&this.scrollIntoView()}},{key:"scrollIntoView",value:function(){var e=this.refMessage.current;if(e){var t=i.default.findParent(e,"fancyScrollContent"),a=e.offsetTop+e.offsetHeight-t.clientHeight+16;i.default.scrollTo(0,a,"smooth",t)}}},{key:"_updateFocus",value:function(){var e=this.state.responseMode;switch(e){case c.a.EmailResponseMode.None:break;case c.a.EmailResponseMode.Reply:case c.a.EmailResponseMode.ReplyAll:this.focusBody();break;case c.a.EmailResponseMode.Forward:case c.a.EmailResponseMode.Compose:this.focusTo();break;default:try{i.default.PAssert(1320,!1,"Unknown response mode for reply box",e)}catch(t){i.default.reportError(t)}}}},{key:"focusTo",value:function(){this.refCompose.current.focusTo()}},{key:"focusBody",value:function(){this.refCompose.current.focusBody()}},{key:"onClose",value:function(){l.default.EmailPreview.setMessageResponseMode(this.props.inReplyToMessage.id,c.a.EmailResponseMode.None)}},{key:"render",value:function(){return this.state.responseMode!==c.a.EmailResponseMode.None?s.a.createElement("div",{className:"emailReplyBox emailBox c-shadow-popup",ref:this.refMessage},s.a.createElement(Tt,{threadAttach:this.props.threadAttach,message:this.props.message,ref:this.refCompose,onClose:this.onClose})):null}}]),a}(ae.a);function Ot(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=J()(e);if(t){var r=J()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return X()(this,a)}}var Rt=function(e){K()(a,e);var t=Ot(a);function a(){return W()(this,a),t.apply(this,arguments)}return q()(a,[{key:"init",value:function(){this._initializedFrame=!1,this.createObservables({hovered:!1}),this.refFrame=s.a.createRef(),this.refMessage=s.a.createRef()}},{key:"onMount",value:function(){this.props.isLastMessage&&this.props.index>0&&(this.needsScrollIntoView=!0),this.checkIsHovered(),this._initializeFrame()}},{key:"_initializeFrame",value:function(){if(!this._initializedFrame){var e=this.refFrame.current;if(e){this._initializedFrame=!0;var t=e.contentWindow.document;I.a.supportBlobURLIFrame||(t.open(),t.write(this.props.message.blob),t.close())}}}},{key:"getState",value:function(){var e=this.props,t=e.message,a=e.threadAttach,n=l.default.pluginManager.getPluginGmail();return{responseMode:t.responseMode,height:t.height,width:t.width,shouldUseNewPlugin:a&&n.shouldUseNewPlugin(l.default.EmailPreview.threadAttach)}}},{key:"onAfterChanged",value:function(e,t){this._initializeFrame(),e.height!==t.height&&e.height>0&&(this.checkIsHovered(),this.needsScrollIntoView&&(this.needsScrollIntoView=!1,this.scrollIntoView()))}},{key:"checkIsHovered",value:function(){var e=me.a.getMousePos(),t=document.elementFromPoint(e.x,e.y);t&&(i.default.findParent(t,"emailMessageWrapper")===this.refMessage.current&&this.hovered.set(!0))}},{key:"scrollIntoView",value:function(){var e=this.refMessage.current,t=i.default.findParent(e,"fancyScrollContent"),a=0;a=e.clientHeight>t.clientHeight?e.offsetTop:t.scrollHeight-t.clientHeight,i.default.scrollTo(0,a,"auto",t)}},{key:"onClickHeader",value:function(){this.props.toggleExpanded()}},{key:"onMouseEnterMessage",value:function(){this.hovered.set(!0)}},{key:"onMouseLeaveMessage",value:function(){this.hovered.set(!1)}},{key:"openResponse",value:function(e){if(this.state.shouldUseNewPlugin){var t=l.default.pluginManager.getPluginGmail().getURLForAttachment(this.props.threadAttach);l.default.openUrl(t)}else l.default.EmailPreview.setMessageResponseMode(this.props.message.id,e)}},{key:"onClickReply",value:function(){this.openResponse("Reply")}},{key:"onClickReplyAll",value:function(){this.openResponse("Reply All")}},{key:"onClickForward",value:function(){this.openResponse("Forward")}},{key:"onClickReport",value:function(){l.default.menus.openModal(c.a.Modals.ReportProblem,{accountID:this.props.threadAttach.getField("accountID"),threadID:this.props.threadAttach.id,msgID:this.props.message.id})}},{key:"_generateParticipantText",value:function(e){return e.text?e.text:e.email}},{key:"isExpanded",value:function(){return this.props.expanded||this.props.isLastMessage||this.state.responseMode!==c.a.EmailResponseMode.None}},{key:"openEmailDetails",value:function(e){var t=this.refs.messageHeaderText;l.default.menus.openContextMenu({componentName:"ReactContextMenuEmailDetails",element:t,message:this.props.message,accountID:this.props.threadAttach.getField("accountID")}),e.stopPropagation()}},{key:"render",value:function(){var e=this.props,t=this.state,a=e.message,n=this.isExpanded(),r={height:t.height},o=l.default.International.formatDate(a.date,c.a.DFormat.MonthDay),u=l.default.International.formatDate(a.date,c.a.DFormat.ShortTime),d=I.a.windowWidth()>1080&&!i.default.isDemoMode();n||t.hovered,d&&t.hovered;var h,f={cursor:n?"pointer":null},p=s.a.createElement("span",{className:"from",onClick:n?this.openEmailDetails:void 0,style:f},this._generateParticipantText(a.from));if(n){var g=(a.to?a.to:[]).concat(a.cc?a.cc:[]).map(this._generateParticipantText).join(", ");h=s.a.createElement("span",{className:"to c-foreground-faded",onClick:this.openEmailDetails,style:{cursor:"pointer"}},s.a.createElement("i",{className:"icon-long-arrow-right"}),s.a.createElement("span",null,g))}else h=s.a.createElement("span",{className:"snippet",dangerouslySetInnerHTML:{__html:a.snippet}});var m,v=s.a.createElement("span",{className:"emailDate c-foreground-faded"},s.a.createElement("div",{className:"emailDateDate"},o),s.a.createElement("div",{className:"emailDateTime"},u)),y=s.a.createElement(Z.a,{className:"messageHeader flexbox",onClick:this.onClickHeader},s.a.createElement("span",{className:"messageHeaderText f1",ref:"messageHeaderText"},p,h),!1,v);m=I.a.supportBlobURLIFrame?s.a.createElement("iframe",{key:"ep_"+this.props.message.id,ref:this.refFrame,sandbox:"allow-scripts allow-same-origin",seamless:!0,id:"emailPreview_"+this.props.message.id,className:"emailPreviewFrame",src:a.blobURL,style:r,scrolling:"no"}):s.a.createElement("iframe",{key:"ep_"+this.props.message.id,ref:this.refFrame,sandbox:"allow-scripts allow-same-origin",seamless:!0,id:"emailPreview_"+this.props.message.id,className:"emailPreviewFrame",style:r});var k=i.default.classNames("emailMessage emailBox c-border",{collapsed:!n},{prevCollapsed:!e.prevExpanded},{nextCollapsed:!e.nextExpanded}),_=i.default.classNames("emailMessageWrapper",{replying:t.responseMode!==c.a.EmailResponseMode.None});return s.a.createElement("div",{className:_,onMouseEnter:this.onMouseEnterMessage,onMouseLeave:this.onMouseLeaveMessage,ref:this.refMessage},s.a.createElement("div",{className:k},y,n&&s.a.createElement("div",{className:"messageContent",style:{}},m,s.a.createElement(Dt,{threadAttach:e.threadAttach,message:e.message,editable:!1}))),!1)}}]),a}(ae.a),Ft=a(67),Nt=a(127);var Bt=function(e,t){return"https://mail.google.com/mail/u/".concat(e,"#all/").concat(t)},jt=Object(f.b)((function(e){var t=e.accountID,a=e.threadID,n=e.needsFixSubject,l=e.isInFront,u=e.pane,c=e.onFixSubject,d=Object(o.useRef)(),h=Object(o.useRef)(),f=Object(o.useRef)(),p=Object(Nt.a)({accountID:t,threadID:a,needsFixSubject:n,onFixSubject:c}),g=Object(o.useState)(!1),m=r()(g,2),v=m[0],k=m[1],b=function(e,t){var a=Object(o.useRef)(),n=Object(o.useCallback)(function(){var n=_()(y.a.mark((function n(r,i){var o,s;return y.a.wrap((function(n){for(var l=0;;){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;switch(n.prev=n.next){case 0:if(a.current=r,o=t.current,!i){n.next=9;break}return n.next=5,Ft.a.getPluginNew("Email").resolveThreadHash(e,r);case 5:s=n.sent,o.executeJavaScript("location.assign('".concat(s,"')")),n.next=10;break;case 9:o.send("open-thread",r);case 10:case"end":return n.stop()}}}),n)})));return function(e,t){return n.apply(this,arguments)}}(),[]);return Object(o.useEffect)((function(){t.current.addEventListener("ipc-message",(function(e){var t=e.channel,r=e.args;"failed-load"===t&&r[0]===a.current&&n(a.current,!0)}))}),[]),{openThread:n}}(t,d).openThread;Object(o.useEffect)((function(){var e=d.current;e.addEventListener("dom-ready",(function(){f.current||(f.current=!0,k(!0))})),e.addEventListener("will-navigate",(function(t){if(t.url.startsWith("https://accounts.google.com/CheckCookie")){var a=Bt(p.current.accountID,p.current.threadID);a&&e.loadURL(a)}})),e.addEventListener("did-navigate",(function(t){var a=t.url,n=Bt(p.current.accountID,p.current.threadID);!a.startsWith("https://mail.google.com")||a.includes("#")&&!a.endsWith("#inbox")?(!function(e,t){e.send("accountID",t),setTimeout((function(){e.send("accountID",t)}),0)}(e,p.current.accountID),p.current.needsFixSubject&&e.send("get-subject",p.current.threadID)):n&&e.loadURL(n)})),e.addEventListener("ipc-message",(function(e){var t=e.channel,a=e.args;if("link-clicked"===t){var n=a[0];n&&i.default.openUrl(n)}else if("onAction"===t){var o=a[0],s=Ft.a.getPluginNew("Email").getById(p.current.threadID);"report"===o?s.labels.pushIfUnique("spam"):"archive"===o?s.labels.remove("inbox"):"delete"===o&&s.labels.pushIfUnique("trash"),u.updateItemsImmediate()}else if("fix-subject"===t){var l=r()(a,2),c=l[0],d=l[1];p.current.onFixSubject(c,d)}}))}),[]),Object(o.useEffect)((function(){var e=d.current;v&&t&&a&&(h.current?b(a):(h.current=!0,e.loadURL(Bt(t,a))),n&&e.send("get-subject",a))}),[v,t,a,b,n]);var w={zIndex:l?1:0};return s.a.createElement("webview",{src:"about:blank",className:"absolute inset-0",style:w,preload:"file:emailpreview.js",ref:d,allowpopups:"on"})}));function Ut(e,t,a){Object(o.useEffect)((function(){var t=function(t){var a;return e[t.normCode]?e[t.normCode](t):null===(a=e.default)||void 0===a?void 0:a.call(e,t)};return window.addEventListener(a,t),function(){window.removeEventListener(a,t)}}),t)}var Ht=Object(f.b)((function(e){var t,a=e.account,n=e.thread,l=e.isInFront,u=e.pane,d=a.e,h=a.n,f=Ft.a.getPluginNew("Email"),p="".concat(f.getURLForOutlookAccount(a),"/mail"),g=Object(o.useRef)(),m=Object(o.useRef)(),v=Object(Nt.a)({accountID:d,thread:n}),y=Object(o.useState)(!1),k=r()(y,2),_=k[0],b=k[1],w=Object(o.useRef)(0);t={},kt()(t,c.a.KeyCode.Alt,(function(e){w.current>=0&&(w.current++,w.current>9&&(m.current&&g.current.send("debugShowEverything"),w.current=void 0))})),kt()(t,"default",(function(e){w.current&&(w.current=0)})),Ut(t,[],"keydown"),Object(o.useEffect)((function(){var e=g.current;e.addEventListener("dom-ready",(function(){m.current||(m.current=!0,b(!0))})),e.addEventListener("did-navigate",(function(t){t.url;!function(e,t){e.send("accountID",t),setTimeout((function(){e.send("accountID",t)}),0)}(e,v.current.accountID)})),e.addEventListener("ipc-message",(function(e){var t=e.channel,a=e.args;if("link-clicked"===t){var n=a[0];n&&i.default.openUrl(n)}else if("onAction"===t){var r=a[0],o=Ft.a.getPluginNew("Email").getById(v.current.thread.id);"Archive"===r?o.labels.remove("inbox"):"Delete"===r&&o.labels.pushIfUnique("trash"),u.updateItemsImmediate()}}))}),[]),Object(o.useEffect)((function(){var e,t=g.current;_&&d&&n&&t.send("openThread",{threadID:n.id,date:null===(e=n.date)||void 0===e?void 0:e.toString("MMM/dd/yy"),subject:n.subject})}),[_,d,n]);var S={zIndex:l?1:0};return s.a.createElement("webview",{src:p,className:"absolute inset-0",style:S,preload:"file:outlookpreview.js",partition:"persist:outlook".concat(h),ref:g})})),Vt=Object(f.b)((function(e){var t=e.accountID,a=e.service,n=e.thread,i=e.pane,u=e.needsFixSubject,c=e.onFixSubject,d=Object(g.a)(l.default.settings.emailViewAccounts),h=r()(d,1)[0],f=Object(o.useRef)({}).current;return t&&(f[a+":"+t]={account:h.find((function(e){return e.s===a&&e.e===t})),service:a,thread:n}),s.a.createElement("div",{className:"relative flex-1"},Object.entries(f).map((function(e){var n=r()(e,2),o=n[0],d=n[1];return d.account?"o"===d.service?s.a.createElement(Ht,{key:o,account:d.account,pane:i,thread:d.thread,isInFront:d.account.e===t&&d.service===a}):s.a.createElement(jt,{key:o,accountID:d.account.e,pane:i,threadID:d.thread.id,isInFront:d.account.e===t&&d.service===a,needsFixSubject:u,onFixSubject:c}):s.a.createElement("div",{className:"absolute inset-0 c-background",style:{zIndex:2}},s.a.createElement("div",{className:"pt-8 mx-auto text-center",style:{maxWidth:400}},s.a.createElement("div",null,"This email is from an account which is not currently setup to sync. Please add it in the Gmail section of the Plugins settings."),s.a.createElement("div",{className:"mt-4"},s.a.createElement(E.a,{text:"ADD ACCOUNT",mode:"contained",primary:!0,onClick:function(){l.default.menus.openSettings("Plugins")},newStyle:!0}))))})))}));function Wt(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=J()(e);if(t){var r=J()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return X()(this,a)}}var zt=function(e){K()(a,e);var t=Wt(a);function a(){return W()(this,a),t.apply(this,arguments)}return q()(a,[{key:"init",value:function(){this.refWebview=Object(o.createRef)(),l.default.onIntroAction("Email"),this.createObservables({expandedMessages:[]}),i.default.isDemoMode()&&(i.default.reactEmailPreview=this)}},{key:"onMount",value:function(){}},{key:"onBeforeChanged",value:function(e,t){if(e.threadAttach!==t.threadAttach){var a=e.messages,n=[];if(a.length>0)for(var r=0,i=this.getLastMessage(e),o=0;o<a.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var s=a[o];(s===i||this.isMessageUnread(s))&&n.push(s.id)}this.expandedMessages.set(n,!1),e.expandedMessages=n}}},{key:"getURL",value:function(e){if(e=e||this.state.threadAttachObs){var t=e.id,a=e.getField("accountID");return"https://mail.google.com/mail/u/".concat(a,"#inbox/").concat(t)}}},{key:"getState",value:function(){var e=l.default.pluginManager.getPluginGmail();return{pane:l.default.EmailPreview.openOnPane,isLoading:l.default.EmailPreview.isLoading,threadAttach:l.default.EmailPreview.threadAttach,threadItem:l.default.EmailPreview.threadItem,messageIDs:l.default.EmailPreview.messageIDs,messages:l.default.EmailPreview.getMessages(),errorMessage:l.default.EmailPreview.errorMessage,messagesLoaded:l.default.EmailPreview.messagesLoaded,shouldUseNewPlugin:l.default.EmailPreview.threadAttach&&e.shouldUseNewPlugin(l.default.EmailPreview.threadAttach),colorTheme:Object(x.b)(),showSidebar:l.default.DesktopUI.showSidebar,threadAttachObs:l.default.EmailPreview.threadAttachObs}}},{key:"getLastMessage",value:function(e){return e=e||this.state,l.default.pluginManager.getPluginGmail().getLastMessage(e.threadAttach)}},{key:"onEscapeKey",value:function(){l.default.EmailPreview.close()}},{key:"isMessageDraft",value:function(e){return e.labelIds.indexOf("DRAFT")>=0}},{key:"isMessageUnread",value:function(e){return e.labelIds.indexOf("UNREAD")>=0}},{key:"onClickClose",value:function(){l.default.EmailPreview.close()}},{key:"onClickArchive",value:function(){this.props.pane.archiveItem(!0,this.state.threadItem)}},{key:"onClickLabel",value:function(e){this.props.pane.autocompleteLabel({elementDisplay:e.target,item:this.state.threadItem})}},{key:"onClickMove",value:function(e){this.props.pane.autocompleteMove({elementDisplay:e.target,item:this.state.threadItem})}},{key:"onClickSchedule",value:function(e){this.props.pane.autocompleteSchedule({element:e.target,item:this.state.threadItem})}},{key:"onClickUnread",value:function(){this.props.pane.markItemRead(!1,this.state.threadItem)}},{key:"onClickDelete",value:function(){var e,t=this.state,a=this.props.pane,n=l.default.pluginManager.getPluginGmail();if(a.type===c.a.PaneMode.Gmail)a.deleteSelected(n.isGmailItem,!0);else if(me.a.getStartItem()===t.threadItem&&(e=a.indexOfPrevVMLI(me.a.getStartIndex(),!0)),t.threadItem.deleteSelf(c.a.ChangeType.Local),l.default.EmailPreview.reset(),e){var r=a.itemAtIndex(e);if(r){var i=r.getParsedText().length;me.a.selectIndex(e,i)}}}},{key:"onClickPrint",value:function(){var e=l.default.pluginManager.getPluginGmail().createPrintURLForThread(this.state.threadAttach);i.default.printPage(e)}},{key:"onClickViewInGmail",value:function(){var e=l.default.pluginManager.getPluginGmail().getURLForAttachment(this.state.threadAttach);l.default.openUrl(e)}},{key:"openResponse",value:function(e){if(this.state.shouldUseNewPlugin)this.onClickViewInGmail();else{var t=this.getLastMessage();l.default.EmailPreview.setMessageResponseMode(t.id,e)}}},{key:"onClickReply",value:function(){this.openResponse("Reply")}},{key:"onClickReplyAll",value:function(){this.openResponse("Reply All")}},{key:"onClickForward",value:function(){this.openResponse("Forward")}},{key:"toggleExpanded",value:function(e){var t=this.state.messages,a=t[e];this.expandedMessages.indexOf(a.id)>=0?!(t.length>1&&e<t.length-1)||t[e+1]&&this.isMessageDraft(t[e+1])||this.expandedMessages.remove(a.id):this.expandedMessages.push(a.id)}},{key:"onClickDown",value:function(){this.props.pane.keyMoveDown()}},{key:"onClickUp",value:function(){this.props.pane.keyMoveUp()}},{key:"renderMessages",value:function(){var e,t,a=this.props.noHeader,n=this.state,r=n.threadAttach,o=n.isLoading,l=n.errorMessage,d=n.messagesLoaded,h=n.shouldUseNewPlugin,f=this.state.messages;if((f=f||[]).length>0){var p=0;t=f[0].subject||"(no subject)";for(var g=[],m=this.expandedMessages.get(),v=this.getLastMessage(),y=0;y<f.length;++y){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var k=f[y],_=void 0;if(this.isMessageDraft(k)){try{i.default.PAssert(1036,y>0,"Should never have a draft as the first message in the list")}catch(M){i.default.reportError(M)}var b=f[y-1];_=s.a.createElement(Lt,{key:b.id+"_draft",threadAttach:r,message:k,inReplyToMessage:b})}else{var w=m.indexOf(k.id)>=0,S=f[y-1],D=f[y+1],P=0===y||m.indexOf(S.id)>=0||this.isMessageDraft(S),E=y>=f.length-2||m.indexOf(D.id)>=0||this.isMessageDraft(D);_=s.a.createElement(Rt,{key:k.id,index:y,threadAttach:r,message:k,toggleExpanded:this.toggleExpanded.bind(this,y),expanded:w,isLastMessage:k===v,prevExpanded:P,nextExpanded:E})}g.push(_)}e=s.a.createElement("div",{className:"emailMessages c-background c-border c-foreground",style:{opacity:d?1:0}},g)}else e=o?s.a.createElement(u.a,{center:!0},"Loading messages..."):l?s.a.createElement("div",{className:"noMessages center"},l):s.a.createElement("div",{className:"noMessages center"},"No conversation selected");var C=36,x=i.default.classNames("emailPreviewTop c-foreground c-background"),A=0+c.a.PaneHeadingHeightSmall,T={height:A,minHeight:A,boxShadow:this.state.colorTheme.paneShadow()};return s.a.createElement(s.a.Fragment,null,!a&&s.a.createElement("div",{className:x,style:T},f.length>0&&s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"emailHeaderRow"},s.a.createElement("div",{className:"emailButtons"},!h&&s.a.createElement(s.a.Fragment,null,s.a.createElement(R.a,{icon:"icon-check",iconSize:17,width:C,height:C,tooltip:"Archive (E)",onClick:this.onClickArchive}),s.a.createElement(R.a,{icon:"icon-unread icon-unread-header",iconSize:15,width:C,height:C,tooltip:"Mark Unread (U)",onClick:this.onClickUnread}),s.a.createElement(R.a,{icon:"icon-tag",iconSize:15,width:C,height:C,tooltip:"Label (L)",onClick:this.onClickLabel}),s.a.createElement(R.a,{icon:"icon-align-left",iconSize:15,width:C,height:C,tooltip:"Add to Outline (M)",onClick:this.onClickMove}),s.a.createElement(R.a,{icon:"icon-calendar",iconSize:15,width:C,height:C,tooltip:"Add to Calendar (C)",onClick:this.onClickSchedule}),s.a.createElement(R.a,{icon:"icon-delete",iconSize:18,width:C,height:C,tooltip:"Delete (Backspace)",onClick:this.onClickDelete})),!I.a.app&&s.a.createElement(R.a,{icon:"icon-print",iconSize:18,width:C,height:C,tooltip:"Print (P)",onClick:this.onClickPrint}),s.a.createElement(R.a,{icon:"icon-gmail",iconSize:15,width:C,height:C,tooltip:"Open in Gmail (G)",onClick:this.onClickViewInGmail}))),s.a.createElement("div",{className:"pt-2 emailHeaderRow emailSubject"},t)),s.a.createElement(R.a,{className:"closeButton",icon:"icon-close",iconSize:18,width:40,height:40,onClick:this.onClickClose,tooltip:"Close"})),s.a.createElement(gt.a,{className:"overflow-hidden emailMessagesScroller f1"},e))}},{key:"renderGmailView",value:function(){var e=c.a.PaneHeadingHeightSmall,t={height:e,minHeight:e},a=this.state.threadAttachObs,n=null===a||void 0===a?void 0:a.id,r=null===a||void 0===a?void 0:a.getField("accountID"),i=(null===a||void 0===a?void 0:a.getField("service"))||"g",o="g"===i&&!((null===a||void 0===a?void 0:a.getField("subject"))||(null===a||void 0===a?void 0:a.getField("text")))&&n,l=Ft.a.getPluginNew("Email").getById(n);return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"flex justify-end emailPreviewTop c-foreground c-background",style:t},s.a.createElement(R.a,{className:"closeButton",icon:"icon-close",iconSize:18,width:40,height:40,onClick:this.onClickClose,tooltip:"Close"})),s.a.createElement(Vt,{pane:this.props.pane,accountID:r,service:i,thread:l||{id:n},needsFixSubject:!!o,onFixSubject:function(e,t){e===o&&(null===a||void 0===a||a.updateInlineField("subject",t))}}))}},{key:"render",value:function(){var e=i.default.classNames("emailPreview c-background c-border overflow-hidden flex flexvert h-full",{noClick:l.default.PaneManager.isResizingPane},{"border-r max-h-full":!1},{"border-t":!1},{transition:!l.default.PaneManager.isResizingPane});return s.a.createElement("div",{className:e},l.default.supportEmailViews()?this.renderGmailView():this.renderMessages())}}]),a}(ae.a),qt=a(153),Gt=function(e){var t=e.name,a=e.pane,n=e.rect,u=e.width,h=e.offset,f=e.Component,p=Object(o.useState)(0),m=r()(p,2),v=m[0],y=m[1],k=Object(g.a)(l.default.settings.disableAnimations),_=r()(k,1)[0],b=n.left+h,w=Object(d.d)(),S=Object(H.a)(b);Object(o.useEffect)((function(){y(1)}),[]),void 0!==S&&S!==b&&(_?w.set({x:b}):w.start({x:b,transition:c.a.TransitionSpringFaster}));var D=Object.assign({width:u,opacity:v}),P=i.default.classNames("paneWrapper paneWrapperMotion absolute inset-0 will-change-transform",{"paneWrapperOverview hide-print":"overview"===t},{paneWrapperPreview:"preview"===t},{"z-1":!0},{"c-border-pane border-t border-b":!1});return s.a.createElement(d.b.div,{key:a.id+t,className:P,style:D,animate:w,initial:{x:b}},s.a.createElement(f,{pane:a}))},Kt=function(e){return e.rect.get().left},Yt=function(e){var t=e.pane,a=e.rect,n=e.Component,u=e.refPane,h=Object(g.a)(l.default.settings.disableAnimations,I.a.supportsMultiplePanes,l.default.DesktopUI.resizingPane),f=r()(h,2),p=f[0],m=f[1],v=Object(o.useState)(!1),y=r()(v,2),k=y[0],_=y[1],b=Object(o.useState)(!1),w=r()(b,2),S=w[0],D=w[1],P=Object(d.d)(),E=Object(o.useRef)(),C=(a.width,Object(H.a)(a.left)),x=Object(o.useRef)();x.current=k||p;var A=Object(o.useCallback)((function(e){x.current?P.set({x:e}):P.start({x:e,transition:c.a.TransitionSpringFaster})}),[]);void 0===C||C===a.left||k||A(a.left);var T=Object(o.useCallback)((function(e){E.current&&clearTimeout(E.current);var a=e.clientX,n=Kt(t);document.body.classList.add("pointer-events-none"),pt.a.beginBatch(),l.default.DragDrop.isDraggingPane.set(!0),_(!0),D(!0),pt.a.endBatch(),A(n);i.default.onMouseMoveUp((function(e){var r=e.clientX-a+n;l.default.PaneManager.dragPaneTo(t,r-Kt(t)),A(r)}),(function(e){pt.a.beginBatch(),l.default.DragDrop.isDraggingPane.set(!1),_(!1),pt.a.endBatch();var a=Kt(t);A(a),document.body.classList.remove("pointer-events-none"),E.current=setTimeout((function(){D(!1)}),300)}))}),[]),M=m&&(a.isFirst||k||t.isOverviewVisible()),L=i.default.classNames("paneWrapperMotion will-change-transform",{"c-shadow-popup":k},{notFirst:!a.isFirst}),O={width:void 0,right:0,zIndex:S?2:0,borderColor:"transparent"},R={borderLeftWidth:M?1:0,borderTopWidth:0},F=i.default.classNames("paneWrapper paneWrapperPane absFull c-border-pane");return s.a.createElement(d.b.div,{className:L,style:O,animate:P,initial:{x:a.left},ref:u},s.a.createElement("div",{className:F,style:R},s.a.createElement(n,{pane:t,startDragging:T})))},Xt=Object(f.b)((function(e){var t,n,u=e.pane,d=e.Component,h=Object(o.useRef)(),f=Object(g.a)(u.rect,I.a.supportsMultiplePanes),p=r()(f,2),m=p[0],v=p[1],y=Object(g.a)(v&&u.overview.isVisible,v&&u.isExpanded),k=r()(y,2),_=k[0],b=k[1];m.left,m.width,m.left,m.width,m.widthExpanded,Object(o.useCallback)((function(e){var t=e.clientX-i.default.offset(h.current).left-m.width-(b?m.widthExpanded:0),a=!1;me.a.reset(),l.default.DesktopUI.resizingPane.set(!0);i.default.onMouseMoveUp((function(e){a||(document.body.classList.add("pointer-events-none"),a=!0);var n=i.default.offset(h.current),r=e.clientX-n.left-t;b&&(r-=m.width),u.setWidthManual(r,b)}),(function(){l.default.PaneManager.updatePaneRects(),l.default.DesktopUI.resizingPane.set(!1),document.body.classList.remove("pointer-events-none")})),i.default.preventDefault(e)}),[u,m,b]),Object(o.useCallback)((function(){u.widthManual&&u.setWidthManual(void 0,b)}),[u,b]);if(v)_&&(t=s.a.createElement(Gt,{key:u.id+"overview",name:"overview",pane:u,rect:m,width:c.a.OverviewWidth,offset:-c.a.OverviewWidth,Component:qt.a})),b&&(n=s.a.createElement(Gt,{key:u.id+"preview",name:"preview",pane:u,rect:m,width:m.widthExpanded,offset:m.width+(m.isFirst?2:1),Component:zt}));else{var w=a(309).default;t=s.a.createElement(w,{key:u.id+"overview",pane:u})}var S=s.a.createElement(Yt,{key:u.id+"pane",name:"pane",pane:u,rect:m,Component:d,refPane:h});return v?[t,S,!1,n]:[S,t,n]}));var Qt=a(18),Jt=a(74),Zt=a(115),$t=Object(f.b)((function(){var e=Object(g.a)(l.default.PaneManager._panes,Zt.a.panesInView,h.b.isKeyboardOpen,Qt.a.onlineStatus),t=r()(e,4),a=t[0],n=t[1],o=t[2],u=t[3],d=function(e){return function(){me.a.setFocusedPane(e),Zt.a.setPanesInView([{type:"pane",pane:e}])}},f=a.map((function(e,t){var r,o,l=n.find((function(t){return t.pane===e})),u=i.default.classNames("flex flex-col items-center justify-center flex-1 text-center mobutton",l?"c-blue":"c-foreground-light",{"ml-auto":0===t},{"mr-auto":t===a.length-1});return s.a.createElement("div",{key:e.id,className:u,style:ea.button,onClick:d(e)},s.a.createElement(Ze.a,{name:e.getMobileIcon(),size:20}),s.a.createElement("div",{className:"pt-1 text-12"},e.name.get()||(null===e||void 0===e||null===(r=(o=e).getNewViewMode)||void 0===r?void 0:r.call(o))||e.title||e.type.replace("Pane","")))})),p={height:c.a.Mobile.BottomBarHeight};return o?null:s.a.createElement("div",{className:"border-t c-background c-border-heavy"},!i.default.isDemoMode()&&"Online"!==u&&s.a.createElement("div",{className:"pt-1 font-bold center text-12"},u.toUpperCase()+("Connecting"===u?"...":"")),s.a.createElement("div",{className:"flex items-stretch overflow-x-auto",style:p},f))})),ea=i.default.createStyles({button:{minWidth:50,maxWidth:100}}),ta=a(57),aa=a(49),na=Object(f.b)((function(e){var t=e.children;return s.a.createElement("div",{ref:function(e){return null===e||void 0===e?void 0:e.appendChild(t)}})})),ra=[0,.42,.58,1],ia=function(e){var t=e.className,a=e.selected,n=e.selectedColor,r=e.noOutline,o=D()(e,["className","selected","selectedColor","noOutline"]),l=i.default.classNames(t,a&&(n||"c-button-raised-primary"));return s.a.createElement(ta.a,w()({},o,{className:l,width:30,height:30,mode:r?void 0:"outlined"}))},oa=function(e){var t=e.selected,a=e.selectedColor,n=D()(e,["selected","selectedColor"]),r=i.default.classNames(t&&(a||"c-button-raised-primary"));return s.a.createElement(ta.a,w()({},n,{className:r,width:30,height:30,notRounded:!0}))},sa=function(e){var t=e.children;return s.a.createElement("div",{className:"flex mr-3 overflow-hidden border rounded c-border"},t)},la=function(){return Ee.a.handleTab(!0,!0)},ua=function(){return Ee.a.handleTab(!0)},ca=Object(f.b)((function(){var e,t,a=Object(g.a)(me.a.pane,aa.a.keyboardHeight,aa.a.portaledToolbar,null===(e=me.a.pane.get())||void 0===e?void 0:e.search.isFocused,aa.a.menusStack,me.a.selectedMapObs),n=r()(a,5),o=n[0],u=n[1],h=n[2],f=n[3],p=n[4],m=u&&me.a.getSelectedObjects(),v=null===m||void 0===m?void 0:m[0];Object(g.a)(null===v||void 0===v||null===(t=v.item)||void 0===t?void 0:t.flags);var y=u>0&&(!!v||f);Object(g.a)(null===v||void 0===v?void 0:v.item.itemChanged);var k,_=i.default.classNames("absolute inset-x-0 c-shadow-popup c-background-toolbar flex flex-wrap will-change-transform select-none");if(u>0&&h)k=s.a.createElement(na,null,h);else if(y&&0===p.length){var b=function(){var e,t;null===(e=document.activeElement)||void 0===e||null===(t=e.blur)||void 0===t||t.call(e),me.a.reset()},w=function(e){f?(o.search.addToValue(e),o.search.updateAutocomplete()):v.item&&(me.a.insertTextAtSelection(e),ee.a.updateFromPane({owner:v,index:v.index,start:me.a.getStartOffset(),element:me.a.getStartElement(),forceShow:!0}))},S=function(){w(c.a.ContactPrefix)},D=function(){w(c.a.TagPrefix)},P=function(e){return function(){var t=v.item;t&&(t.setPrefix(t.prefix===e?null:e),l.default.settings.alignIndentToPrefix.get()&&me.a.updateCaret())}},E=function(e){return function(){var t=v.item;if(t){var a=t.getPriority(),n=e===a?0:e;t.setPriority(n,c.a.ChangeType.Local)}}};if(f)k=s.a.createElement("div",{key:"search",className:"flex flex-1 p-2"},s.a.createElement(ia,{icon:"FaHashtag",iconSize:12,onPress:D,className:"mr-3"}),s.a.createElement(ia,{icon:"MdPerson",onPress:S,className:"mr-3"}),s.a.createElement("div",{className:"flex-1"}),s.a.createElement(ia,{icon:"IoIosArrowDown",iconSize:18,noOutline:!0,onPress:b}));else if(o){var C,x,A,T,M;if(v){var L=v.item;if(L.hasNote())A=!!L.getNote().getNotePreviewText();C=L.isStarred(),x=L.getPriority(),M=(L.isPrefixHeader()?"header":L.isPrefixTask()&&"task")||L.isPrefixBullet()&&"bullet"||L.isPrefixNumList()&&"numlist"||"",T=!!L.getMooDate()}k=s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"flex pt-2 pl-2"},o.type===c.a.PaneMode.Task&&o.isViewOutline()&&s.a.createElement(ia,{icon:"MdArrowBack",onPress:la,className:"mr-3"}),o.type===c.a.PaneMode.Task&&o.isViewOutline()&&s.a.createElement(ia,{icon:"MdArrowForward",onPress:ua,className:"mr-3"}),s.a.createElement(ia,{icon:"FaHashtag",iconSize:12,onPress:D,className:"mr-3"}),s.a.createElement(ia,{icon:"MdPerson",onPress:S,className:"mr-3"}),s.a.createElement(ia,{icon:"IoIosCalendar",onPress:function(){v.item&&aa.a.openMenu({type:"Date",item:me.a.getStartItem(),paneObject:me.a.getStartObject(),fullscreen:!0,focused:!0})},className:"mr-3",selected:T,selectedColor:"c-button-raised-primary"}),s.a.createElement(ia,{icon:"FaRegStickyNote",onPress:function(){v.item&&o.openNoteContextMenuByPaneObject(v,!0)},selected:A,selectedColor:"c-button-raised-primary"})),s.a.createElement("div",{className:"flex p-2 f1"},s.a.createElement(sa,null,s.a.createElement(oa,{icon:"icon-project",onPress:P(c.a.Prefix.Header),selected:"header"===M}),s.a.createElement(oa,{icon:"MdCheck",onPress:P(c.a.Prefix.Task),selected:"task"===M}),s.a.createElement(oa,{icon:"FaCircle",iconSize:8,onPress:P(c.a.Prefix.Bullet),selected:"bullet"===M}),s.a.createElement(oa,{text:"1.",fontSize:12,onPress:P(c.a.Prefix.NumList),selected:"numlist"===M})),s.a.createElement(sa,null,s.a.createElement(oa,{icon:"FaExclamation",iconSize:12,onPress:E(c.a.VMLIFlag.P0),selected:x===c.a.VMLIFlag.P0,selectedColor:"p0Button c-foreground-white",color:"p0ButtonColor"}),s.a.createElement(oa,{icon:"FaExclamation",iconSize:12,onPress:E(c.a.VMLIFlag.P1),selected:x===c.a.VMLIFlag.P1,selectedColor:"p1Button c-foreground-white",color:"p1ButtonColor"}),s.a.createElement(oa,{icon:"FaExclamation",iconSize:12,onPress:E(c.a.VMLIFlag.P2),selected:x===c.a.VMLIFlag.P2,selectedColor:"p2Button c-foreground-white",color:"p2ButtonColor"})),s.a.createElement(ia,{icon:"MdStar",iconSize:18,onPress:function(){var e=v.item;if(e){var t=e.isStarred();e.setStarred(!t,c.a.ChangeType.Local),me.a.updateCaret()}},selected:C}),s.a.createElement("div",{className:"flex-1"}),s.a.createElement(ia,{icon:"IoIosArrowDown",iconSize:18,noOutline:!0,onPress:b})))}}return s.a.createElement(d.a,null,k?s.a.createElement(d.b.div,{className:_,id:"keyboardToolbar",style:{paddingBottom:100,marginBottom:-100},animate:{bottom:u,transition:{ease:ra,duration:I.a.isiOS?.25:0}},initial:{bottom:0},exit:{bottom:-100,transition:{ease:ra,duration:I.a.isiOS?.5:.2}},onMouseDown:i.default.preventAndStop},k):null)})),da={ActionSheet:a(304),Settings:a(298),Contact:a(305),OpenUrl:a(283),Note:a(306),Date:a(299),Prompt:a(293),Confirm:a(294),DropBucket:a(295),Alert:a(296)},ha=Object(f.b)((function(){var e=Object(g.a)(aa.a.menusStack),t=r()(e,1)[0];return s.a.createElement(d.a,null,t.map((function(e){return s.a.createElement(da[e.type].default,Object.assign({key:e.type},e))})))})),fa=a(160),pa=a(41),ga=Object(f.b)((function(){var e=Object(g.a)(me.a.selectedMapObs,h.b.isHoldDown,l.default.DragDrop.dragging),t=r()(e,3),a=t[0],n=t[1],o=t[2],u=Object(x.a)();if(me.a.isInMobileMultiselect()){var d=Object.keys(a).length,f=n&&d<2,p=function(e,t){var a;me.a.forEach((function(n){void 0===a&&(a=!n[e]()),n[t](a,c.a.ChangeType.Local)})),me.a.reset()},m={height:c.a.Mobile.TopBarHeight,boxShadow:u.paneShadow()},v={height:c.a.Mobile.BottomBarHeight,boxShadow:u.paneShadow()},y=!f&&!o,k=i.default.classNames("absolute inset-x-0 flex inset-b-0 c-background",{"justify-end":y},{"justify-center items-center":o});return s.a.createElement("div",{className:"pointer-events-none absFull z-2"},!o&&s.a.createElement("div",{className:"relative flex items-center c-background",style:m},y?s.a.createElement(s.a.Fragment,null,s.a.createElement(pa.TopBarIconButton,{icon:"IoIosArrowBack",className:"absolute",onPress:function(){me.a.reset()}}),s.a.createElement("div",{className:"flex-1 center"},d," selected")):s.a.createElement("div",{className:"flex-1 center"},s.a.createElement("div",{className:"text-13"},s.a.createElement("div",null,"Move to drag or"),s.a.createElement("div",null,"lift to multiselect")))),s.a.createElement("div",{className:k,style:v},y&&s.a.createElement(s.a.Fragment,null,s.a.createElement(pa.TopBarIconButton,{icon:"MdCheck",onPress:function(){p("isComplete","setComplete")}}),s.a.createElement(pa.TopBarIconButton,{icon:"MdStar",onPress:function(){p("isStarred","setStarred")}}),s.a.createElement(pa.TopBarIconButton,{icon:"IoMdTrash",onPress:function(){me.a.forEach((function(e){e.deleteSelf(c.a.ChangeType.Local)})),me.a.reset()}})),o&&s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:""},"Drag here to cancel"))))}return null})),ma=function(e){var t=e.target;t&&t.scrollTop>0&&(t.scrollTop=0)};t.default=Object(f.b)((function(){var e=l.default.PaneManager,t=i.default.vmMain,a=Object(o.useRef)(),n=Object(g.a)(Zt.a.panesInView,e.isLoading,t.isRendered,Qt.a.documentsArray,l.default.settings.activeUser,l.default.setup.isLoggingOut),d=r()(n,6),h=d[0],f=d[1],p=d[2],v=d[3],y=d[4],k=d[5];Object(o.useEffect)((function(){Jt.a.notifyLoaded()}),[]),Object(o.useEffect)((function(){var e=!1,t=[document.body,document.documentElement,a.current];if(t.some((function(e){return!e}))||(e=!0,t.forEach((function(e){return e.addEventListener("scroll",ma)}))),e)return function(){t.forEach((function(e){return e.removeEventListener("scroll",ma)}))}}),[y,p,f,v.length]);var _=function(e){for(var t=0,a=[],n=0;n<(null===e||void 0===e?void 0:e.length);++n){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e[n],o=r.type,l=r.pane;if(l.hasBeenActive&&"pane"===o){var u=l.type,d=u===c.a.PaneMode.Task&&ft||u===c.a.PaneMode.Drive&&st||u===c.a.PaneMode.Gmail&&ot||u===c.a.PaneMode.Inbox&&ct;if(d)a.push(s.a.createElement(Xt,{key:"pane"+l.id,pane:l,Component:d}));else try{i.default.PAssert(223,!1,"Invalid pane mode requested"+u)}catch(h){i.default.reportError(h)}}}return a}(h);return k?s.a.createElement("div",{id:"container"},s.a.createElement(u.a,{center:!0},"Signing out...")):y?p?f&&!i.default.isDemoMode()?s.a.createElement("div",{id:"container"},s.a.createElement("div",{key:"loadingRemote",id:"loadingRemote",className:"c-foreground-light centerVH"},s.a.createElement("div",{className:"loading loading20"}),s.a.createElement("div",{className:"loadingText"},"Loading documents...")),s.a.createElement(ha,null)):0===v.length?s.a.createElement("div",{id:"container"},s.a.createElement(u.a,{center:!0},"Connecting...")):s.a.createElement("div",{id:"container",className:"flex flex-col overflow-hidden select-none absFull fontPane c-foreground",ref:a},s.a.createElement("div",{className:"relative flex-1"},_),s.a.createElement(fa.default,{inPane:!1}),s.a.createElement(m,null),s.a.createElement($t,null),s.a.createElement(ga,null),s.a.createElement(ha,null),s.a.createElement(ca,null),s.a.createElement(N,null)):null:s.a.createElement(L,null)}))},function(e,t,a){"use strict";a.r(t);var n=a(3),r=a.n(n),i=a(17),o=a(16),s=a.n(o),l=a(2),u=a(28),c=a(0),d=a(9),h=a(64),f=a(22),p=a(41),g=a(49),m=a(128),v=a(71),y={opacity:1,transition:{duration:.5}},k=Object(n.createContext)({}),_=function(){return Object(n.useContext)(k)},b=Object(i.b)((function(e){var t=e.title,a=e.children;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"flex items-center justify-center c-foreground",style:{height:l.a.Mobile.TopBarHeight}},t),r.a.createElement("div",{className:"flex-1 overflow-auto pointer-events-auto"},a))})),w=Object(i.b)((function(e){var t=e.type,a=e.className,i=e.initialPage,o=e.pageMap,_=Object(n.useRef)([{page:i}]),w=Object(h.a)(),S=Object(f.a)(d.a.windowSize),D=s()(S,1)[0],P=Object(n.useCallback)((function(){_.current.length>1?(_.current.pop(),w()):g.a.closeMenu(t)}),[]);Object(m.a)(P);var I={height:D.height},E=Object(n.useMemo)((function(){return{goBack:function(){_.current.splice(_.current.length-1,1),w()},navigate:function(e,t){_.current=_.current.concat({page:e,props:t}),w()}}}),[]);return r.a.createElement(v.a,{type:t,spring:l.a.TransitionSpringFast,ignoreAndroidBack:!0},r.a.createElement("div",{style:I,className:c.default.classNames("flex flex-col",a)},r.a.createElement(p.TopBar,null,r.a.createElement(p.TopBarIconButton,{icon:"IoIosArrowBack",onPress:P}),r.a.createElement("div",{className:"font-bold text-15"},"Settings")),r.a.createElement(k.Provider,{value:E},r.a.createElement(u.b.div,{className:"absolute inset-0 pointer-events-none",animate:{x:-(_.current.length-1)*D.width},transition:l.a.TransitionSpring},r.a.createElement(u.a,null,_.current.map((function(e,t){var a=e.page,i=e.props;return r.a.createElement(u.b.div,{key:t,className:"absolute inset-y-0 flex flex-col",style:{left:t*D.width,width:D.width},exit:y},r.a.createElement(b,{title:c.default.addSpacesToCamelCase(a)},Object(n.createElement)(o[a],i)))})))))))})),S=a(5),D=a.n(S),P=a(12),I=a.n(P),E=a(4),C=a(105),x=(a(15),Object(i.b)((function(e){var t,a=e.checked,i=e.checkedObservable,o=e.disabled,d=e.onChange,h=e.getCheckedFromObservable,p=e.getValueFromChecked;var g=Object(n.useRef)(),m=Object(C.a)(g),v=Object(f.a)(i),y=s()(v,1)[0],k=void 0===a?null!==(t=null===h||void 0===h?void 0:h(y))&&void 0!==t?t:y:a;m.width||(m.width=42);var _={backgroundColor:k?l.a.ColorBrand:"#888"},b={x:k?m.width-24:4},w=c.default.classNames("relative flex items-center cursor-pointer c-button-raised-primary c-shadow-thin borderBox",{mobutton:!0});return r.a.createElement(u.b.div,{className:w,style:A,initial:_,animate:_,onClick:function(e){if(!o){var t=!k;d&&!1===d(t)||function(e){var t;null===i||void 0===i||i.set(null!==(t=null===p||void 0===p?void 0:p(e))&&void 0!==t?t:e)}(t),c.default.stopPropagation(e)}},ref:g,transition:{duration:.5}},r.a.createElement(u.b.div,{className:"absolute c-background c-shadow-light",style:T,initial:b,animate:b,transition:l.a.TransitionSpringMedium}))}))),A={borderRadius:16,width:48,height:26},T={borderRadius:50,width:20,height:20},M=a(32),L=function(e){E.default.openUrl(e)},O=Object(i.b)((function(){var e=d.a.isBeta;return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.SettingsHeading,{text:"LINKS"}),r.a.createElement(p.SettingsRow,{text:"Moo.do website",onPress:function(){return L("https://www.moo.do")}}),r.a.createElement(p.SettingsRow,{text:"Moo.do blog",onPress:function(){return L("https://www.moo.do/blog/")}}),r.a.createElement(p.SettingsRow,{text:"Moo.do changelog",onPress:function(){return L("https://www.moo.do/changelog/")},last:!0}),r.a.createElement(p.SettingsHeading,{text:"LEGAL"}),r.a.createElement(p.SettingsRow,{text:"Privacy Policy",onPress:function(){return L("https://www.moo.do/privacy/")}}),r.a.createElement(p.SettingsRow,{text:"Terms of Service",onPress:function(){return L("https://www.moo.do/terms/")},last:!0}),r.a.createElement(p.SettingsHeading,{text:"ADVANCED"}),r.a.createElement(p.SettingsRow,{text:"Use beta version",last:!0},r.a.createElement(x,{checked:e,onChange:function(e){I()(D.a.mark((function t(){return D.a.wrap((function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:return t.next=2,g.a.confirm("Would you like to restart into the ".concat(e?"beta":"stable"," version? You will need to sign in again."));case 2:if(!t.sent){t.next=10;break}if(!d.a.app){t.next=9;break}return t.next=7,M.a.setUseBeta(e);case 7:t.next=10;break;case 9:location.host=e?"beta.moo.do":"www.moo.do";case 10:case"end":return t.stop()}}}),t)})))()}})))})),R=a(34),F=a(63),N=Object(i.b)((function(e){var t,a=e.title,n=e.description,i=e.checkedObservable,o=e.disabled,l=e.onChange,u=e.getCheckedFromObservable,d=e.getValueFromChecked;var h=Object(f.a)(i),p=s()(h,1)[0],g=null!==(t=null===u||void 0===u?void 0:u(p))&&void 0!==t?t:p,m=function(e){var t;return i.set(null!==(t=null===d||void 0===d?void 0:d(e))&&void 0!==t?t:e)},v=c.default.classNames("cursor-pointer py-4",{"px-4":!0}),y=c.default.classNames("flex",{"flex-row-reverse":!0}),k=c.default.classNames("f1","pr-3");return r.a.createElement("div",{className:v,onClick:function(){if(!o){var e=!g;m(e),l&&!1===l(e)&&m(!e)}}},r.a.createElement("div",{className:y},r.a.createElement(x,{checkedObservable:i,getCheckedFromObservable:u,getValueFromChecked:d,disabled:o,onChange:l}),r.a.createElement("div",{className:k},r.a.createElement("div",{className:"font-bold font-big1",style:B},a),n&&r.a.createElement("div",{className:"pt-1 text-xs leading-tight c-foreground-light"},n))))})),B={lineHeight:"18px"},j=a(152),U=a(73),H=a(57),V=Object(i.b)((function(e){var t=e.email,a=Object(f.a)(E.default.settings.syncAccounts),i=s()(a,1)[0],o=_(),u=U.a.pluginsAvailableNew,d=t&&i?i[t]:{},h=Object(n.useRef)(),p=Object(n.useState)(),m=s()(p,2),v=m[0],y=m[1],k=Object(n.useState)(!1),b=s()(k,2),w=b[0],S=b[1],P=d?E.default.pluginManager.getAllPluginScopes(Object.keys(d).filter((function(e){return d[e]})),!1):[],C=!d||t&&!R.a.isAuthorizedForScopes(t,P),x=c.default.mapArrayToObject(u,(function(e){return Object(j.a)(!t||(null===d||void 0===d?void 0:d[e]))[0]})),A=Object(n.useCallback)((function(){S(!0)}),[]),T=function(){var e=I()(D.a.mark((function e(){var a;return D.a.wrap((function(e){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,g.a.confirm("Are you sure you want to delete this account?");case 2:e.sent&&(delete(a=c.default.clone(i||{}))[t],E.default.settings.syncAccounts.set(a),o.goBack());case 4:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,t?r.a.createElement("div",{className:"px-4 pt-6 pb-2 c-foreground-faded"},t):r.a.createElement("div",{className:"px-4 pt-6 pb-2"},r.a.createElement(F.a,{height:44,placeholder:"Enter email address",type:"email",ref:h})),v&&r.a.createElement("div",{className:"px-4 py-2 c-error"},v),r.a.createElement("div",null,u.map((function(e){return r.a.createElement(N,{key:e,title:l.a.PluginNames[e],checkedObservable:x[e],onChange:A})}))),C&&r.a.createElement("div",{className:"px-4 font-medium c-error center text-15"},"Error detected with this account. Please press SAVE to fix it."),r.a.createElement("div",{className:"pt-4 center"},r.a.createElement("div",null,r.a.createElement(H.a,{mode:"contained",color:"c-button-raised-primary c-foreground-white",text:"SAVE",onPress:function(){var e=t||h.current.getValue();if(c.default.isEmail(e)){y("");var a=c.default.clone(i||{}),n=[];a[e]={},u.forEach((function(t){var r=x[t].get();r&&(a[e][t]=r,n.push(t))}));var r=E.default.pluginManager.getAllPluginScopes(n);R.a.authAccount(e,r,(function(e){console.log(e,a),e&&(E.default.settings.syncAccounts.set(a),o.goBack())}))}else y("Please enter a valid email address.")},disabled:t&&!w&&!C})),t&&r.a.createElement("div",{className:"pt-4"},r.a.createElement(H.a,{mode:"contained",color:"c-warning c-foreground-white",text:"DELETE ACCOUNT",onPress:T}))))})),W=a(35),z=a(79),q=Object(i.b)((function(e){var t=e.visible,a=e.text;return r.a.createElement(u.a,null,t&&r.a.createElement(u.b.div,{className:"absolute inset-0 c-bg-black",initial:{opacity:0},animate:{opacity:.75},exit:{opacity:0},transition:{duration:.2}},r.a.createElement(z.a,{center:!0},a)))})),G=a(74),K=Object(i.b)((function(){var e,t=Object(n.useState)(),a=s()(t,2),i=a[0],o=a[1],u=Object(n.useState)(!1),c=s()(u,2),h=c[0],g=c[1],m=E.default.billingManager,v=W.a.getAccountEmail(),y=Object(f.a)(m._premiumStatus,m.daysLeftInTrial),k=s()(y,2),_=k[0],b=k[1],w=d.a.isiOS&&d.a.app,S=w,P="Premium status";switch(_){case l.a.PremiumStatus.Trial:P="Days left in trial",e=b;break;case l.a.PremiumStatus.TrialOver:e="Trial over";break;case l.a.PremiumStatus.Active:e="Premium",S=!1;break;case l.a.PremiumStatus.CanceledPastDue:case l.a.PremiumStatus.CanceledUser:e="Cancelled";break;case l.a.PremiumStatus.PastDue:e="Past Due",S=!1;break;default:e="Free user"}w&&Object(n.useEffect)((function(){if(S)return I()(D.a.mark((function e(){var t;return D.a.wrap((function(e){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(e.prev=e.next){case 0:return e.next=2,G.a.getIAPSubscriptions();case 2:t=e.sent,o(t);case 4:case"end":return e.stop()}}}),e)})))(),function(){return G.a.endIAPConnection()}}),[S]);var C=function(e){return I()(D.a.mark((function t(){return D.a.wrap((function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:return g(!0),E.default.billingManager.appleIAPPurchase.listen((function(e){e&&G.a.finishTransaction(e),g(!1)})),t.next=4,G.a.requestIAPSubscription(e);case 4:case"end":return t.stop()}}}),t)})))};return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.SettingsHeading,{text:"MOO.DO ACCOUNT"}),r.a.createElement(p.SettingsRow,{text:"Account email"},r.a.createElement("div",{className:"pr-2 c-foreground-faded"},v)),r.a.createElement(p.SettingsRow,{text:P,last:!0},r.a.createElement("div",{className:"pr-2 c-foreground-faded"},e)),S&&(i?r.a.createElement(r.a.Fragment,null,r.a.createElement(p.SettingsHeading,{text:"GO PREMIUM"}),r.a.createElement(p.SettingsRow,{text:"Subscribe Monthly for ".concat(i.monthly.localizedPrice),onPress:C("monthly")}),r.a.createElement(p.SettingsRow,{text:"Subscribe Yearly for ".concat(i.yearly.localizedPrice),onPress:C("yearly"),last:!0}),r.a.createElement(p.SettingsHeading,{text:"PREMIUM FEATURES"}),r.a.createElement(p.SettingsRow,{text:"Google Calendar Sync"}),r.a.createElement(p.SettingsRow,{text:"Google Drive Sync"}),r.a.createElement(p.SettingsRow,{text:"Desktop: Unlimited Boards and Folders"}),r.a.createElement(p.SettingsRow,{text:"Desktop: Advanced Display Settings"}),r.a.createElement(p.SettingsRow,{text:"Desktop: Custom Hotkeys"})):r.a.createElement(z.a,{className:"pt-4"},"Loading In App Purchases...")),r.a.createElement(q,{visible:h,text:"Performing In App Purchase..."}))})),Y=a(130),X=a(72),Q=["auto","light","dark"],J={Settings:Object(i.b)((function(){var e=Object(n.useState)(!1),t=s()(e,2),a=t[0],i=t[1],o=Object(f.a)(E.default.settings.syncAccounts,E.default.settings.ui.themeMobile,E.default.settings.activeUser,E.default.AppCache.hasUpdate,g.a.codePushStatus),u=s()(o,5),h=u[0],m=u[1],v=u[2],y=u[3],k=u[4],b=_(),w=G.a.getAppVersion(),S="".concat(l.a.jsVersion," (").concat(new Date(+l.a.jsVersion).toString("MMMM d, h:mm tt"),")"),P=w?"".concat(w," - ").concat(S):S,C=y||k===Y.a.UPDATE_INSTALLED,A=function(){var e=I()(D.a.mark((function e(){return D.a.wrap((function(e){for(var t=0;;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;switch(e.prev=e.next){case 0:if(!E.default.AppCache.hasUpdate.get()){e.next=4;break}c.default.reload(),e.next=12;break;case 4:if(k!==Y.a.UPDATE_INSTALLED){e.next=8;break}G.a.restartApp(),e.next=12;break;case 8:return i(!0),e.next=11,Promise.all([E.default.AppCache.update(),d.a.app&&G.a.checkForUpdates(),c.default.promisify((function(e){return setTimeout(e,2e3)}))]);case 11:i(!1);case 12:case"end":return e.stop()}}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.SettingsHeading,{text:"OPTIONS"}),r.a.createElement(p.SettingsRow,{text:"Notifications",onPress:function(){return E.default.settings.disableNotifications.set(!E.default.settings.disableNotifications.get())}},r.a.createElement(x,{checkedObservable:E.default.settings.disableNotifications,getValueFromChecked:function(e){return!e},getCheckedFromObservable:function(e){return!e}})),r.a.createElement(p.SettingsRow,{text:"Dark mode",last:!0},Q.map((function(e){return r.a.createElement(H.a,{key:e,mode:"outlined",height:40,text:e.capitalize(),className:c.default.classNames("ml-2",e.toLowerCase()===m&&"c-button-raised-primary"),onPress:function(){return E.default.DisplaySettings.changeColorTheme(e)}})}))),!c.default.isDemoMode()&&r.a.createElement(r.a.Fragment,null,r.a.createElement(p.SettingsHeading,{text:"ACCOUNTS"}),Object.keys(h).map((function(e){var t=h[e],a=E.default.pluginManager.getAllPluginScopes(Object.keys(t).filter((function(e){return t[e]})),!1),n=!R.a.isAuthorizedForScopes(e,a);return r.a.createElement(p.SettingsRow,{key:e,text:e,onPress:function(){return b.navigate("EditAccount",{email:e})}},n&&r.a.createElement(X.a,{name:"MdWarning",size:18,color:"red"}))})),r.a.createElement(p.SettingsRow,{text:"Add Account",icon:"MdAdd",last:!0,iconSize:18,onPress:function(){return b.navigate("AddAccount")}})),r.a.createElement(p.SettingsHeading,{text:"Moo.do Account"}),d.a.app&&r.a.createElement(p.SettingsRow,{text:"Linked Signin Accounts",onPress:function(){return b.navigate("SignInAccounts")}}),r.a.createElement(p.SettingsRow,{text:"Moo.do Premium",onPress:function(){return b.navigate("Premium")}}),r.a.createElement(p.SettingsRow,{text:"About Moo.do",last:!0,onPress:function(){return b.navigate("About")}}),r.a.createElement("div",{className:"px-4 py-4 text-13 c-foreground-light"},r.a.createElement("div",null,P),r.a.createElement("div",{className:"pt-4"},v)),r.a.createElement("div",{className:"pb-16 center"},r.a.createElement("div",null,r.a.createElement(H.a,{mode:"contained",color:"c-button-raised-primary",text:C?"UPDATE AND RESTART":a?"CHECKING...":"CHECK FOR UPDATES",onPress:A})),r.a.createElement("div",{className:"pt-4"},r.a.createElement(H.a,{mode:"contained",color:"c-button-raised-primary",text:"SIGN OUT",onPress:function(){E.default.setup.logout()}}))))})),AddAccount:V,EditAccount:V,Premium:K,About:O,SignInAccounts:Object(i.b)((function(){var e,t,a,i=null===(e=W.a.getEmailProvider())||void 0===e?void 0:e.email,o=null===(t=W.a.getGoogleProvider())||void 0===t?void 0:t.email,l=d.a.isiOS?null===(a=W.a.getAppleProvider())||void 0===a?void 0:a.email:void 0,u=Object(n.useState)(!1),h=s()(u,2),f=h[0],g=h[1],m=[i,o,l].filter((function(e){return e})).length>1,v=function(e,t){return function(a){if(a||m)return g(!0),I()(D.a.mark((function n(){return D.a.wrap((function(n){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(n.prev=n.next){case 0:if(!a){n.next=5;break}return n.next=3,e();case 3:n.next=7;break;case 5:return n.next=7,t();case 7:g(!1);case 8:case"end":return n.stop()}}}),n)})))(),!1}},y=v(W.a.linkWithGoogle,W.a.unlinkGoogle),k=v(W.a.linkWithApple,W.a.unlinkApple),_=function(e){if(g(!0),e)E.default.menus.promptComplex({title:"Create account with email signin",text:"After pressing OK you will be asked to sign in with ".concat(l?"Apple":"Google"," again."),fields:[{placeholder:"Email address"},{placeholder:"Password",type:"password"},{placeholder:"Confirm email address",type:"password"}],validate:function(){var e=I()(D.a.mark((function e(t){var a,n,r,i;return D.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(a=s()(t,3),n=a[0],r=a[1],i=a[2],n&&c.default.isEmail(n)){e.next=5;break}return e.abrupt("return","Invalid email address.");case 5:if(r){e.next=9;break}return e.abrupt("return","Invalid password.");case 9:if(!(r.length<5)){e.next=13;break}return e.abrupt("return","Please use a longer password.");case 13:if(i&&r===i){e.next=15;break}return e.abrupt("return","Passwords do not match.");case 15:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}(),callback:function(){var e=I()(D.a.mark((function e(t){var a,n,r,i;return D.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(a=s()(t,2),n=a[0],r=a[1],i=!1,!n||!r){e.next=7;break}return e.next=5,l?W.a.reauthenticateApple():W.a.reauthenticateGoogle();case 5:e.sent&&(i=!0,v((function(){return W.a.linkWithEmail(n,r)}),W.a.unlinkEmail)(!0));case 7:i||g(!1);case 8:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}()});else if(m){v(void 0,W.a.unlinkEmail)(!1)}return!1};return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.SettingsHeading,{text:"Sign in with"}),r.a.createElement(p.SettingsRow,{icon:"MdEmail",text:i||"Email",onPress:function(){return _(!i)}},r.a.createElement(x,{checked:!!i,onChange:_})),r.a.createElement(p.SettingsRow,{icon:"IoLogoGoogle",text:o||"Google",onPress:function(){return y(!o)}},r.a.createElement(x,{checked:!!o,onChange:y})),d.a.isiOS&&r.a.createElement(p.SettingsRow,{icon:"FaApple",text:l||"Apple",onPress:function(){return k(!l)},last:!0},r.a.createElement(x,{checked:!!l,onChange:k})),r.a.createElement(q,{visible:f,text:"Saving..."}))}))};t.default=Object(i.b)((function(e){var t=e.type;return r.a.createElement(w,{type:t,className:"c-bg-light",initialPage:"Settings",pageMap:J})}))},function(e,t,a){"use strict";a.r(t);var n,r=a(51),i=a.n(r),o=a(52),s=a.n(o),l=a(3),u=a.n(l),c=a(32),d=a(17),h=a(5),f=a.n(h),p=a(12),g=a.n(p),m=a(16),v=a.n(m),y=a(2),k=a(0),_=a(30),b=a(4),w=a(25),S=a(64),D=a(59),P=a(152),I=a(66),E=a(22),C=(a(15),Object(d.a)(Object(l.forwardRef)((function(e,t){var a,n,r=e.id,i=e.style,o=e.tabIndex,s=e.className,c=e.checked,d=e.checkedObservable,h=e.initialChecked,f=e.disabled,p=e.onChange,g=e.checkedColor,m=e.size,_=e.radio,b=e.error,w=e.tooltip,S=e.extra,D=e.getCheckedFromObservable,P=e.children,I=Object(l.useRef)(),C=Object(l.useState)(!1),x=v()(C,2),A=x[0],T=x[1];if(d){var M;0;var L=Object(E.a)(d),O=v()(L,1)[0];n=d.set.bind(d),a=null!==(M=null===D||void 0===D?void 0:D(O))&&void 0!==M?M:O}else{var R=Object(l.useState)(!f&&(c||h)),F=v()(R,2);a=F[0],n=F[1],void 0!==c&&Object(l.useEffect)((function(){n(c)}),[c])}Object(l.useImperativeHandle)(t,(function(){return{getValue:function(){return a},setValue:function(e){return n(e)},getExtra:function(){return S},reset:function(){return n(h)}}}));var N=function(){if(!f){T(!0),setTimeout((function(){T(!1)}),300);var e=!a;n(e),p&&!1===p(e)&&n(!e)}},B={background:a&&g,width:m,height:m,lineHeight:m&&m-1+"px",fontSize:m&&m-4+"px"},j=k.default.classNames("fancyCheckbox",{checked:a},{disabled:f},{animate:A},{radio:_},{error:b},s),U=k.default.classNames("fancyCheckboxText"),H=k.default.classNames("fancyCheckboxCheck",{"c-button-raised-primary":a&&!f}),V=u.a.createElement("span",{className:H,style:B,"data-tooltip":w||null});return u.a.createElement("span",{className:j,onClick:N,id:r,style:i,tabIndex:o,onKeyDown:function(e){e.keyCode===y.a.KeyCode.Enter&&N()},ref:I,"data-tooltip":w||null},u.a.createElement("input",{className:"fancyCheckboxInput",type:"checkbox",checked:a||!1,onChange:k.default.emptyFn}),V,P&&u.a.createElement("span",{className:U},P))})))),x=a(63),A=a(9),T=Object(d.b)((function(e){var t=e.onChange,a=s()(e,["onChange"]),n=Object(l.useRef)(),r=Object(l.useCallback)((function(e){return 0===e.length||!!Date.parse(e)}),[]),o=Object(l.useCallback)((function(e){n.current=Date.parse(e),A.a.isiOS||t(n.current)}),[t]),c=Object(l.useCallback)((function(){A.a.isiOS&&t(n.current)}),[t]);return u.a.createElement(x.a,i()({},a,{onChange:o,onBlur:c,validator:r,type:"date",noUpdateValueWhileFocused:!0}))})),M=/^(1[0-2]|0?[1-9])(?:[:.]?([0-5]?[0-9]))?(\u25cf?[AP]M)?$/,L=/^(2[0-3]|[01]?[0-9])(?:[:.]?([0-5]?[0-9]))?$/,O=function(e){var t=+e[1],a=+e[2]||0;return 12===t&&"AM"===e[3]?t=0:12!==t&&"PM"===e[3]&&(t+=12),{hours:t,minutes:a}},R=Object(d.b)((function(e){var t,a=e.onChange,n=e.value,r=s()(e,["onChange","value"]),o=Object(l.useRef)(),c=Object(l.useCallback)((function(e){var t=e.toUpperCase();return 0===e.length||!(!t.match(M)&&!t.match(L))}),[]),d=Object(l.useCallback)((function(e){var t;if(e.length>0){var n=e.toUpperCase(),r=n.match(M)||n.match(L);if(r){var i=O(r),s=i.hours,l=i.minutes;t={hours:s,minutes:l,ms:0===s&&0===l?1:0}}}o.current=t,A.a.isiOS||a(t)}),[a]),h=Object(l.useCallback)((function(){A.a.isiOS&&a(o.current)}),[a]),f=null===(t=n)||void 0===t?void 0:t.toUpperCase().match(M);if(f){var p=O(f),g=p.hours,m=p.minutes;n="".concat(g,":").concat(k.default.pad2(m))}return u.a.createElement(x.a,i()({},r,{value:n,onChange:d,validator:c,noUpdateValueWhileFocused:!0,type:"time",onBlur:h}))})),F=a(72),N=a(41),B=a(180),j=a.n(B),U=(a(291),{weekends:{daysOfWeek:[0,6]},all:{daysOfWeek:[0,1,2,3,4,5,6]}}),H=Object(d.b)((function(e){var t,a=e.refMooDate,r=e.onChange,i=Object(E.a)(b.default.settings.dayWeekStart),o=v()(i,1)[0],s=Object(S.a)(),c=a.current,d=null===c||void 0===c?void 0:c.getStart(),h=null===c||void 0===c?void 0:c.getEnd(),f=(null===c||void 0===c?void 0:c.isRepeatDate())&&!(null===c||void 0===c?void 0:c.isRange()),p=Object.assign({from:d,to:h},U),g=f?null===c||void 0===c?void 0:c.getAllDates():[d,{from:d,to:h}],m=Object(l.useCallback)((function(e){var t=a.current;e.clearTime(),n=e,t?t.setDate(e):t=a.current=new D.a(e),s(),r()}),[]),k=Object(l.useCallback)((function(e,t,i){var o=a.current;if(1===i.buttons&&o){var l;e.clearTime();var u=(null===(l=n)||void 0===l?void 0:l.isBefore(e))?[n,e]:[e,n],c=v()(u,2),d=c[0],h=c[1];if(w.a.isSameDay(d,h))o.setDate(d);else{var f=null===o||void 0===o?void 0:o.getTime(),p=f?f/y.a.MSPerHour:0;o.setRange(d,h,p)}s(),r()}}),[]),_=f?"":"DatePickerRange";return t={all:{padding:12}},u.a.createElement("div",{className:"flex justify-center",style:{lineHeight:"normal"}},u.a.createElement(j.a,{className:_,showOutsideDays:!0,modifiers:p,modifiersStyles:t,selectedDays:g,firstDayOfWeek:o,onDayMouseDown:m,onDayMouseEnter:k}))})),V=[{id:"none",value:"No repeat"},{id:"daily",value:"Daily"},{id:"weekly",value:"Weekly"},{id:"weekdays",value:"Weekdays"},{id:"monthly",value:"Monthly"},{id:"yearly",value:"Yearly"}],W=32,z=Object(d.b)((function(e){var t,n,r,i,o,s,d=e.item,h=e.paneObject,p=e.textOffset,m=e.focused,E=e.onUnmount,A=e.close,M=Object(l.useRef)(null===(t=d.getMooDate())||void 0===t?void 0:t.clone()),L=Object(l.useRef)(),O=Object(l.useRef)(),B=Object(l.useState)(null===(n=M.current)||void 0===n?void 0:n.toText()),j=v()(B,2),U=j[0],z=j[1],q=Object(P.a)(null===(r=M.current)||void 0===r?void 0:r.repeatComplete),G=v()(q,1)[0],K=Object(S.a)(),Y=b.default.pluginManager.getPluginGCalendar(),X=d.hasPluginAttachment(y.a.PluginID.GCalendar),Q=Y.getWriteableCalendarsForItem(d),J=Q.calendars,Z=Q.selected;!k.default.isDemoMode()&&!M.current&&Y.isEnabled()&&Y.getSetting("syncPopup")&&(L.current=Y.getDefaultExportCalendarID()),void 0!==L.current&&(Z=L.current);var $,ee="",te="",ae="",ne="";if(M.current){var re=M.current;o=re.getStart(),s=re.getEnd();var ie,oe=re.getRRuleOptions(),se=oe&&function(e){var t=e.interval,a=e.freq,n=e.byweekday;return a===_.a.DAILY&&1===t?"daily":a===_.a.WEEKLY&&n&&n.length>1?"weekdays":a===_.a.WEEKLY&&1===t?"weekly":a===_.a.MONTHLY&&1===t?"monthly":a===_.a.YEARLY&&1===t?"yearly":"Custom"}(oe);if(se)$=(null===(ie=V.find((function(e){return e.id===se})))||void 0===ie?void 0:ie.value)||"Custom";var le=re.isRange(),ue=re.isRepeatDate()&&!le;ee=o.toString("yyyy-MM-dd")||"",te=o.hasTimeOfDay()?w.a.getTimeText(o):"",ae=le||re.hasUntil()||re.getDuration()&&!ue?s.toString("yyyy-MM-dd"):"",ne=o.hasTimeOfDay()&&s.hasTimeOfDay()?w.a.getTimeText(s):""}Object(l.useEffect)((function(){return m&&setTimeout((function(){O.current.focus()}),150),function(){if(d){var e=M.current,t=h?h.getDisplayText():d.getDisplayText({showMarkdown:!1});if(e&&e.setRepeatOnComplete(G.get()),d.setMooDate(e,y.a.ChangeType.Local,["repeatComplete"].concat((null===e||void 0===e?void 0:e.duration)?["duration"]:[])),void 0===p&&(p=t.length),e&&d.getRawText().indexOf(y.a.CharDate)<0){var a=p,n=0,r="";t[p-1]&&t[p-1]!==y.a.PrefixDate&&" "!==t[a]&&(r=" "),t[p-1]===y.a.PrefixDate&&(a--,n++);var i=h||{item:d,showMarkdown:function(){return b.default.settings.showMarkdown.get()}},o=d.elsNew.spliceText(r+y.a.CharDate+" ",a,n,i);o[p-1]===y.a.PrefixDate&&(o=k.default.stringRemove(o,a-1,1)),d.setText(o,y.a.ChangeType.Local)}if(e){var s=L.current;if(void 0!==s)b.default.pluginManager.getPluginGCalendar().setCalendarForItem(d,s)}}null===E||void 0===E||E()}}),[]);var ce,de=Object(l.useCallback)((function(){var e;z((null===(e=M.current)||void 0===e?void 0:e.toText())||""),K()}),[]),he=Object(l.useCallback)((function(){de()}),[]),fe=Object(l.useCallback)((function(e){M.current=e?w.a.parseText(e):void 0,z(e),K()}),[]),pe=Object(l.useCallback)((function(e){M.current||(M.current=new D.a(e)),M.current.setDate(e),de()}),[]),ge=Object(l.useCallback)((function(e){M.current||(M.current=new D.a(Date.today()));var t=M.current;if(e){var a=e.hours,n=e.minutes;t.setHours(a+n/60),0===t.getDuration()&&t.setDuration(y.a.MSPerHour)}else t.clearTime();de()}),[]),me=Object(l.useCallback)((function(e){M.current||(M.current=new D.a(Date.today()));var t=M.current;if(e)if(t.isSingleDate()){var a=t.getEnd();e.setHours(a.getHours(),a.getMinutes(),0,a.getMilliseconds());var n=+e-+t.getDate();n>0&&t.setDuration(n)}else t.setUntil(e);else t.clearTime(),t.setDuration(0);de()}),[]),ve=Object(l.useCallback)((function(e){M.current||(M.current=new D.a(new Date));var t=M.current;if(e){var a=e.hours,n=e.minutes,r=e.ms,i=t.getStart(),o=(t.isSingleDate()?t.getEnd():t.getStart()).clone();o.setHours(a,n,0,r);var s=+o-+i;t.setDuration(s)}de()}),[]),ye=Object(l.useCallback)(function(){var e=g()(f.a.mark((function e(t){var a,n,r,i;return f.a.wrap((function(e){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(e.prev=e.next){case 0:if(!(a=M.current)){e.next=9;break}return e.next=4,b.default.menus.openContextMenuList("Repeat",t.target,V);case 4:n=e.sent,r=a.getStart(),"daily"===n?i={freq:_.b.DAILY,interval:1}:"weekdays"===n?i={freq:_.b.WEEKLY,interval:1,byweekday:[0,1,2,3,4].map((function(e){return new _.d(e,void 0)}))}:"weekly"===n?i={freq:_.b.WEEKLY,interval:1}:"monthly"===n?i={freq:_.b.MONTHLY,interval:1}:"yearly"===n?i={freq:_.b.YEARLY,interval:1}:"none"===n&&a.setDate(r),i&&(i.byweekday||(i.byweekday=null),i=Object.assign({dtstart:w.a.toUTCDate(r.clearTime())},i),a.updateRRuleOptions(i)),de();case 9:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}(),[]),ke=Object(l.useCallback)(function(){var e=g()(f.a.mark((function e(t){var a,n;return f.a.wrap((function(e){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(e.prev=e.next){case 0:if(a=(Z?[{id:null,value:"Remove from Calendar"}]:[]).concat(J.map((function(e){return{id:e.id,value:e.summary}}))),!$){e.next=5;break}b.default.toasts.pushMessage("Syncing repeat dates with Google Calendar is not currently supported"),e.next=16;break;case 5:return e.next=8,k.default.promisify((function(e){c.b.openActionSheet({title:"Choose an account",items:a.map((function(t){return{text:t.value,onPress:function(){return e(t.id)}}}))})}));case 8:n=e.sent,e.next=14;break;case 11:return e.next=13,b.default.menus.openContextMenuList("Select a calendar",t.target,a);case 13:n=e.sent;case 14:L.current=n,K();case 16:case"end":return e.stop()}}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Z,$,J,K]),_e=Object(l.useCallback)((function(){M.current=void 0,de()}),[]),be=Z?(null===J||void 0===J||null===(i=J.find((function(e){return e.id===Z})))||void 0===i?void 0:i.summary)||Z:"".concat(X?"Remove from":"Add to"," calendar"),we=$||"Repeat",Se=u.a.createElement(x.a,{placeholder:"Type or select a date",className:"flex-1",border:!1,value:U,onChange:fe,focused:!1,height:y.a.Mobile.TopBarHeight,buttonText:void 0,onButtonClick:_e,buttonEnabled:!!U,onEnter:A,ref:O}),De=a(41),Pe=De.TopBar,Ie=De.TopBarIconButton;return ce=u.a.createElement(Pe,null,u.a.createElement(Ie,{icon:"IoIosArrowBack",onPress:function(){c.b.closeMenu("Date")}}),Se,u.a.createElement(N.TopBarTextButton,{text:"Clear",mode:"contained",onPress:_e})),u.a.createElement("div",{className:"flex flex-col"},ce,u.a.createElement("div",null,u.a.createElement("div",{className:"flex items-center px-4 pt-2 border-t c-border"},u.a.createElement("div",{className:"pr-3 c-foreground-light",style:{width:36}},"Starts:"),u.a.createElement(F.a,{name:"MdToday",size:18,className:"c-foreground-light"}),u.a.createElement(T,{placeholder:"Start date",value:ee,height:W,width:140,className:"ml-2",onChange:pe}),u.a.createElement(R,{placeholder:"Start time",border:!0,value:te,height:W,width:120,className:"ml-2",onChange:ge})),u.a.createElement("div",{className:"flex items-center px-4 pt-2"},u.a.createElement("div",{className:"pr-3 c-foreground-light",style:{width:36}},"Ends:"),u.a.createElement(F.a,{name:"IoMdCalendar",size:18,className:"c-foreground-light"}),u.a.createElement(T,{placeholder:"End date",value:ae,height:W,width:140,className:"ml-2",onChange:me}),u.a.createElement(R,{placeholder:"End time",border:!0,value:ne,height:W,width:120,className:"ml-2",onChange:ve})),(null===J||void 0===J?void 0:J.length)>0&&u.a.createElement("div",{className:"flex items-center px-4 pt-2"},u.a.createElement(I.a,{mode:"outlined",padding:"px-3",icon:"IoIosCalendar",iconSize:18,text:be,height:W,align:"left",onMouseDown:ke})),u.a.createElement("div",{className:"flex items-center px-4 pt-2"},(k.default.isDemoMode()||!Z)&&u.a.createElement(I.a,{mode:"outlined",padding:"px-3",icon:"IoIosRepeat",iconSize:18,text:we,height:W,align:"left",onMouseDown:ye,disabled:!M.current}),(!k.default.isDemoMode()||$)&&u.a.createElement(C,{className:"ml-3",checkedObservable:G,disabled:!$},"Repeat from complete")),u.a.createElement(H,{data:U,refMooDate:M,onChange:he})))})),q=a(71);t.default=Object(d.b)((function(e){var t=e.type,a=e.item,n=e.paneObject,r=e.focused,o=s()(e,["type","item","paneObject","focused"]);return u.a.createElement(q.a,i()({type:t},o,{className:"overflow-y-auto",stayFullscreenOnceFullscreened:!0}),u.a.createElement(z,{item:a,paneObject:n,focused:r,close:function(){c.b.closeMenu(t)}}))}))},function(e,t,a){"use strict";a.r(t);var n=a(84),r=a.n(n),i=a(16),o=a.n(i),s=a(2),l=a(28),u=a(0),c=a(3),d=a.n(c),h=a(48),f=a(92),p=a(105),g=a(6),m=a(64);var v=a(7),y=a.n(v),k=a(8),_=a.n(k),b=a(20),w=a.n(b),S=a(21),D=a.n(S),P=a(13),I=a.n(P),E=a(4),C=a(45),x=a(9),A=a(56),T=a(73),M=a(33);function L(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=I()(e);if(t){var r=I()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return D()(this,a)}}var O=function(e){w()(a,e);var t=L(a);function a(){return y()(this,a),t.apply(this,arguments)}return _()(a,[{key:"init",value:function(){var e=this.props.filter;this.firstValue=this.props.filterValue||e.initialValue}},{key:"onMouseDown",value:function(e){u.default.preventAndStop(e)}},{key:"onClickIcon",value:function(e){var t=this.props.filter,a=this.props.filterValue;++a>1&&(a=-1),this.props.search.setFilter(t.name,a,!0)}},{key:"render",value:function(){var e=this.props,t=e.filter,a=e.filterValue,n=this.firstValue===a,r=e.noClick?void 0:this.props.search.getFilterTooltip(t),i=u.default.classNames("searchButton",{"c-border-super-light":e.hasBorder},{"c-button":!a},{selected:!!a},{inSearch:e.inSearch},{"noHover mobutton":!0},t.icon,t.isOption&&(1===a?"yes":-1===a?"only":""),!t.isOption&&((a?this.firstValue>0&&n||this.firstValue<0&&!n:this.firstValue>0)?"yes":"no"));return d.a.createElement("div",{className:i,"data-tooltip":r,onMouseDown:this.onMouseDown,onClick:e.noClick?void 0:this.onClickIcon})}}]),a}(C.a),R=a(63),F=a(29);function N(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=I()(e);if(t){var r=I()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return D()(this,a)}}var B=function(e){w()(a,e);var t=N(a);function a(){return y()(this,a),t.apply(this,arguments)}return _()(a,[{key:"init",value:function(){this.refInput=d.a.createRef(),this.refSearchBox=d.a.createRef()}},{key:"onMount",value:function(){this.props.pane.search.UI=this,this.listenTo(this.props.pane.search.onChanged),this.forceUpdate()}},{key:"getState",value:function(){for(var e=0,t=this.props.pane,a=t.search,n={search:a.value,calendars:T.a.GCalendarsAvailable,displayCalendars:t.displayCalendars,displayLocalItems:t.displayLocalItems},r=0;r<a.filters.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var i=a.filters[r];n[i.name]=i.value,n[i.name+"Enabled"]=i.enabled}return n}},{key:"onChange",value:function(e){this.props.pane.search.setValue(e)}},{key:"onParsed",value:function(e){this.props.pane.search.onParsed(e)}},{key:"setSearch",value:function(e,t){this.props.pane.search.setValue(e),!1!==t&&this.setSelectionOffset(e.length)}},{key:"getSelectionOffset",value:function(){return this.refInput.current.getSelectionOffset()}},{key:"setSelectionOffset",value:function(e){this.refInput.current.setSelectionOffset(e)}},{key:"updateAutocomplete",value:function(){this.refInput.current.updateAutocomplete()}},{key:"onFocus",value:function(){var e=this.props.pane,t=e.search;t&&(this._selectionBeforeBlur=g.a.save(),g.a.reset(),t.isFocused.set(!0),A.a.hide(),u.default.sendEvent("SearchFocus","Desktop"),t.filters.length>0&&!E.default.menus.isContextMenuOpen("ReactContextMenuSearch")&&E.default.menus.openContextMenu({componentName:"ReactContextMenuSearch",key:"search"+e.id,element:this.refSearchBox.current,positionOffset:{top:4},noBackdrop:!0,pane:e,showFilters:this.props.showFilters,onClosed:this.blur}))}},{key:"onBlur",value:function(){var e=this.props.pane.search;e&&e.isFocused.set(!1)}},{key:"focus",value:function(){this.refInput.current.focus(),this.refInput.current.selectEnd()}},{key:"blur",value:function(){this.refInput.current&&this.refInput.current.blur(),E.default.menus.isContextMenuOpen("ReactContextMenuSearch")&&E.default.menus.closeContextMenu("ReactContextMenuSearch")}},{key:"onTapX",value:function(e){var t=this.props.pane;if(this.state.search.length>0){var a=g.a.save();this.setSearch("",!1),a&&t.restoreSelection(a),u.default.preventDefault(e),u.default.sendEvent("Menu","ClearSearch")}else this.focus(),u.default.sendEvent("Menu","FocusSearch")}},{key:"onKeyDown",value:function(e){if(this.saveScrollOfTop(),x.a.mac&&e.ctrlKey&&e.keyCode===s.a.KeyCode.T)return u.default.preventDefault(e),this.blur(),void E.default.hotkeys.hotkeyAddPane();var t=this.props.pane;e.keyCode===s.a.KeyCode.Enter&&(t.search.update(!0,!0),this.setSelectionOffset(this.state.search.length));if(e.keyCode===s.a.KeyCode.Tab||e.keyCode===s.a.KeyCode.Enter){var a=t.indexOfFirstItem();if(a>=0){var n=a,r=this._selectionBeforeBlur;this.blur(),r&&(g.a.restore(r)?(this._selectionBeforeBlur=void 0,n=r.startIndex):r=null),r||(t.selectIndex(a,0),setTimeout((function(){t.selectIndex(a,0)}),0)),n>=0&&u.default.focusedPane.scrollIndexIntoView(n,"smooth")}else t.type===s.a.PaneMode.Task&&t.addItem();e.preventDefault(),e.stopPropagation()}}},{key:"onAutocompleteSelected",value:function(e){if(e.item){var t=this.props.pane.search,a=t.getValue(),n=a.indexOf(s.a.PrefixItemAutocomplete);a=a.substr(0,n),t.setValue(a),this.props.pane.zoomIn(e.item,{forLoad:!1,showToast:!1,noSel:!0}),this.setSelectionOffset(a.length)}this.refInput.current.updateAutocomplete(),this.focus()}},{key:"onClickFilters",value:function(){this.focus()}},{key:"onClickPriority",value:function(){this.props.pane.search.setFilter("priority",0)}},{key:"onClickText",value:function(e){if(e.altKey){var t,a,n;if(u.default.hasClass(e.target,"fancyInputInput")){var r=M.default.getSelectionRange().getNativeRange();if(r){var i=(t=r.cloneRange()).startContainer.nodeValue;if(u.default.isString(i)){for(var o=0,s=0,l=0,c=i.length,d=t.startOffset;d>=0;d--){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(" "===i[d]||160===i.charCodeAt(d)){l=d+1;break}}for(var h=t.endOffset;h<i.length;h++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(" "===i[h]||160===i.charCodeAt(h)){c=h;break}}a=c-l,n=l}}}else(t=M.default.createSelectionRange()).selectNodeContents(e.target),n=t.startOffset,a=t.toString().length;if(t&&!isNaN(n)&&a){t.setEnd(t.startContainer,n),t.setStart(t.startContainer.parentNode,0);var f=t.toString().length,p=this.props.pane.search,g=p.getValue();E.default.PaneUpdateBatcher.beginUpdateItems(),g=(g.substr(0,f)+g.substr(f+a)).replace(/  +/g," ").trim(),p.setValue(g),E.default.PaneUpdateBatcher.commitUpdateItems(),this.setSelectionOffset(f)}}}},{key:"saveScrollOfTop",value:function(){this.props.pane}},{key:"renderSearchButton",value:function(e){var t=this.props.pane;return d.a.createElement(O,{key:e.name,filter:e,filterValue:e.value.get(),search:t.search,inSearch:!0})}},{key:"renderSearchPriority",value:function(){var e=this.props.pane.search.filter_priority.value.get(),t=e===s.a.VMLIFlag.P0?0:e===s.a.VMLIFlag.P1?1:e===s.a.VMLIFlag.P2&&2,a=u.default.classNames("searchPriority searchP"+t+" selected");return d.a.createElement("span",{key:"priority",className:a,onClick:this.onClickPriority})}},{key:"render",value:function(){var e=this.props,t=this.state,a=e.pane,n=(a.search,t.search),r=n.length>0?"icon-close":"",i=s.a.SearchHeight,o=[],l=d.a.createElement(F.a,{className:"searchX c-button noShrink",width:24,height:i,icon:r,onClick:this.onTapX}),u=d.a.createElement("div",{className:"searchInnerWrap",ref:"searchInnerWrap"},d.a.createElement(R.a,{ref:this.refInput,className:"search",id:"search",height:i,value:n,onClick:this.onClickText,onChange:this.onChange,onKeyDown:this.onKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,onParsed:this.onParsed,parse:!0,placeholder:"Filter",autocompleteMode:"all",border:!1,underline:!1,autocompleteElementDisplay:this.refSearchBox.current,padding:{left:0,right:0},onAutocompleteSelected:this.onAutocompleteSelected,supportSearchItemAutocomplete:a.supportSearchItemAutocomplete,canAutocompleteItems:a.type===s.a.PaneMode.Task,isSearch:!0,pane:a}));return d.a.createElement("div",{className:"flex-shrink-0 pr-2 searchWrap",style:{paddingTop:7}},d.a.createElement("div",{className:"searchBox c-bg-gray-200 flexbox hide-print",ref:this.refSearchBox},d.a.createElement("div",{className:"searchBoxInner flexbox"},u,l),o.length>0&&d.a.createElement("div",{className:"box-border searchButtons noShrink"},o)))}}]),a}(C.a);function j(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=I()(e);if(t){var r=I()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return D()(this,a)}}var U=function(e){w()(a,e);var t=j(a);function a(){return y()(this,a),t.apply(this,arguments)}return _()(a,[{key:"init",value:function(){this.DISABLE_LISTENER_ASSERT=!0}},{key:"getState",value:function(e){for(var t=0,a=e.pane,n=a.search,r={hasFilter:!1,showHelp:E.default.settings.shouldShowHelp("searchHelp"),viewState:a.viewState,viewMode:a.getViewMode(),sortModeBlocks:a.supportsSortBlocks()&&a.getSortModeBlocks(),sortModeItems:a.supportsSortItems()&&a.getSortModeItems(),calendars:T.a.GCalendarsAvailable,displayCalendars:a.displayCalendars,displayLocalItems:a.displayLocalItems,closedHelps:E.default.settings.closedHelps},i=0;i<n.filters.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=n.filters[i];r[o.name]=o.value,r[o.name+"Enabled"]=o.enabled,0!==o.value.get()&&(r.hasFilter=!0)}return r}},{key:"onMount",value:function(){this.listenTo(this.props.pane.search.onChanged)}},{key:"componentWillReceiveProps",value:function(e){e.pane!==this.props.pane&&(this.refreshListeners(e),this.updateState(e))}},{key:"onClickSelectCalendars",value:function(e){E.default.menus.openContextMenu({componentName:"ReactContextMenuCalendars",element:e.target,pane:this.props.pane})}},{key:"saveScrollOfTop",value:function(){this.props.pane}},{key:"onToggleButton",value:function(e){this.saveScrollOfTop(),this.props.pane.search.toggleFilter(e)}},{key:"setPriority",value:function(e){this.saveScrollOfTop();var t=this.props.pane.search;t.getFilterValue("priority")===e&&(e=0),t.setFilter("priority",e)}},{key:"onClickCloseHelp",value:function(){E.default.settings.closeHelp("searchHelp")}},{key:"onClickShowHelp",value:function(){E.default.settings.uncloseHelp("searchHelp")}},{key:"renderSearchButton",value:function(e){var t=this.props.pane,a="showOnlyMatches"===e.name&&t.isViewFlatList()?1:e.value.get();return c.createElement(O,{key:e.name,filter:e,filterValue:a,search:t.search,hasBorder:!0})}},{key:"renderSearchPriority",value:function(){var e=this.props.pane.search.filter_priority.value.get(),t=u.default.classNames("searchPriorities c-border-light",{"noScale mobutton":!0},{hasSelected:!!e}),a=u.default.classNames("searchPriority",{"noScale mobutton":!0}),n=u.default.classNames(a,"searchP0",{selected:e===s.a.VMLIFlag.P0}),r=u.default.classNames(a,"searchP1",{selected:e===s.a.VMLIFlag.P1}),i=u.default.classNames(a,"searchP2",{selected:e===s.a.VMLIFlag.P2});return c.createElement("span",{key:"priority",className:t},c.createElement("span",{className:n,"data-tooltip":"Show only high priority",onClick:this.setPriority.bind(this,s.a.VMLIFlag.P0)}),c.createElement("span",{className:r,"data-tooltip":"Show medium priority and higher",onClick:this.setPriority.bind(this,s.a.VMLIFlag.P1)}),c.createElement("span",{className:i,"data-tooltip":"Show low priority and higher",onClick:this.setPriority.bind(this,s.a.VMLIFlag.P2)}))}},{key:"render",value:function(){for(var e=0,t=this.state,a=this.props.pane,n=a.search,r=t.showHelp,i=[],o=[],s=u.default.classNames("filterSection flexbox",{showHelp:r}),l=0;l<n.filters.length;l++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var d=n.filters[l];d.enabled.get()&&(d.isOption?d.hideInView||o.push(this.renderSearchButton(d)):d.icon?i.push(this.renderSearchButton(d)):"priority"===d.name&&i.push(this.renderSearchPriority()))}if(a.isViewDates()){var h=a.isCalFilterActive(),f=u.default.classNames("buttonCalendars searchButton icon-calendar c-border-light c-button",{selected:h});o.push(c.createElement("div",{key:"calendars",className:f,onClick:this.onClickSelectCalendars,"data-tooltip":"Select calendars to display in this pane"}))}return c.createElement("div",{className:s},i.length>0&&c.createElement("div",null,c.createElement("div",{className:"searchFilters c-border-light"},i)),o.length>0&&c.createElement("div",null,c.createElement("div",{className:"searchFilters c-border-light"},o)))}}]),a}(C.a),H=a(17),V=a(22),W=a(41),z=a(57),q=a(49),G=s.a.Mobile.TopBarHeight,K=G;t.default=Object(H.b)((function(e){var t,a=e.pane,n=a.getTitleList(),i=V.a.apply(void 0,[a.item,a.history,q.a.isKeyboardOpen,a.viewState,a.document,null===(t=a.document.get())||void 0===t?void 0:t.text].concat(r()(n.map((function(e){return e.itemChanged}))))),v=o()(i,3),y=v[0],k=v[1],_=v[2],b=Object(f.a)(),w=Object(c.useRef)(),S=n.slice(0,n.length-1),D=n[n.length-1],P=Object(c.useRef)(),I=Object(p.a)(P),E=I.height-K;a.mobileHeadingScrollThreshold=E,Object(c.useEffect)((function(){a.paddingTop.set(E)}),[E]);var C=a.type===s.a.PaneMode.Task&&!a.isViewCalendar(),x=function(e,t,a,n){var r=Object(c.useMemo)((function(){return Object(l.c)(0)}),[]),i=Object(c.useState)("above"),s=o()(i,2),d=s[0],h=s[1],f=Object(m.a)(),p=Object(c.useRef)(!1),v=Object(c.useRef)("above"),y=Object(c.useRef)();y.current={top:t,bottom:a};var k=Object(c.useRef)(e.current),_=Object(c.useCallback)((function(){if(g.a.isTouchDown())u.default.timeoutOnce("useScrollThreshold",_,70);else{var t=y.current,a=t.top,n=t.bottom,i=r.get();if(i<n){p.current=!0;var o=Math.abs(i-a)<Math.abs(i-n)?a:n;u.default.scrollElementTo(e.current,{top:o,behavior:"smooth"}),u.default.timeoutOnce("useScrollThreshold_scrolling",(function(){return p.current=!1}),140)}}}),[]),b=Object(c.useCallback)((function(){var t=e.current;if(t){var a,i=t.scrollTop;a=i<=y.current.top?"above":i>=y.current.bottom?"below":"on",r.set(t.scrollTop),v.current!==a&&(v.current=a,h(a)),n&&!p.current&&u.default.timeoutOnce("useScrollThreshold",_,70)}}),[]);return Object(c.useEffect)((function(){if(e.current)return k.current||(k.current=e.current,b(),e.current.addEventListener("resize",b),e.current.addEventListener("scroll",b,!0)),function(){k.current.removeEventListener("resize",b),k.current.removeEventListener("scroll",b,!0),k.current=void 0}}),[e.current]),{scrollY:r,scrollState:d,forceRender:f}}(w,0,E,!0),A=x.scrollState,T=x.scrollY,M=x.forceRender,L=C?A:"below";Object(c.useEffect)((function(){w.current=C?u.default.findChild(P.current.parentElement.parentElement,"paneDocumentContent"):void 0,M()}),[C,C&&y.id]);var O,R=function(e){return function(){a.onClickTitle(e)}},F=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return C?Object(l.f)(T,[a,E],[e,t]):Object(l.f)(T,[0,1],[t,t])},N=S.length>0,j=N?-2:14,H=F(17,G),Y=F(I.height-G,K+G),X=F(1,16/24),Q=F(1,10/14),J=F(36,j+6),Z=F(36,14),$=F(C?b.paneShadow(!0):0,C?b.paneShadow():0),ee=F(1,0),te=F(0,(_?-K:0)-G),ae=_?F(0,-G,K):Object(l.f)(T,[0,1],[0,0]),ne=Object(l.e)(1),re=function(){a.goBack()};if(C)O=function(e){var t=!C||!e&&"below"===L,n={boxShadow:$,height:!e&&Y,translateY:te},r=u.default.classNames("z-10 c-background overflow-visible pointer-events-auto will-change-transform",{"invisible w-full":e},{"absolute inset-x-0 inset-y-0 inset-t-0 ":!e}),i=u.default.classNames("flex",{"invisible w-full":e},{"absolute inset-x-0 inset-y-0 inset-t-0 ":!e}),o={marginTop:G-6},s=u.default.classNames("c-foreground-faded origin-top-left pr-1 will-change-transform",{truncate:t},{"pb-3":!0}),h={fontSize:e||"below"!==L?14:10,scale:!e&&("on"===L?Q:ne),height:14,translateX:!e&&H,translateY:e?36:Z,marginBottom:-1,paddingRight:t?2*G:36},f=u.default.classNames("font-bold whitespace-pre-wrap-break-words origin-top-left pr-1 cursor-pointer will-change-transform",{"truncate pr-1":t}),p=u.default.classNames({truncate:t}),g={fontSize:e||"below"!==L?24:16,scale:!e&&("on"===L?X:ne),translateX:!e&&H,translateY:e?void 0:J,marginTop:e&&36,paddingRight:t?2*G:36},m={opacity:ee},v=u.default.classNames("flex flex-shrink-0 justify-center items-center will-change-transform",{"absolute inset-x-0":!t});return d.a.createElement(l.b.div,{className:r,style:n,ref:e?P:void 0,onClick:function(){a.scrollToTop("smooth")}},d.a.createElement("div",{className:"flex",style:{marginLeft:G,marginRight:G}},a.supportHistory&&d.a.createElement(W.TopBarIconButton,{icon:"MdArrowBack",disabled:k.length<=1,onPress:re}),d.a.createElement("div",{className:"flex-1"})),d.a.createElement("div",{className:i,style:o},d.a.createElement("div",{className:"truncate f1"},a.usesVMLIs&&N&&d.a.createElement(l.b.div,{className:s,style:h},S.map((function(e,t){return d.a.createElement(c.Fragment,{key:t},t>0&&d.a.createElement("span",{className:"px-2"},">"),d.a.createElement(z.a,{text:e.generateTitleText(a),fontWeight:"normal",className:"c-button",onPress:R(e),color:"c-foreground",padding:"",align:"left"}))}))),a.usesVMLIs?d.a.createElement(l.b.div,{className:f,style:g},d.a.createElement(z.a,{text:D.generateTitleText(a),onPress:function(e){w.current.scrollTop>E?a.scrollToTop("smooth"):a.overview.toggle()},color:"c-foreground",padding:"",align:"left",displayBlock:!0,className:p})):void 0),!t&&d.a.createElement(l.b.div,{className:v,style:m},d.a.createElement(B,{pane:a}),d.a.createElement(U,{pane:a}))))};else{var ie={boxShadow:b.paneShadow(),paddingLeft:s.a.Mobile.TopBarHeight,paddingRight:s.a.Mobile.TopBarHeight},oe={marginTop:-4},se=a.usesVMLIs?D.generateTitleText(a):"Inbox",le=u.default.classNames("flex-1 font-bold truncate pr-2",a.usesVMLIs?"text-14":"text-16");O=function(){return d.a.createElement("div",{className:"flex items-center h-full pointer-events-auto c-background",style:ie},d.a.createElement("div",{className:le},se),d.a.createElement("div",{className:"relative flex",style:oe},d.a.createElement(B,{pane:a}),d.a.createElement(U,{pane:a})))}}var ue={translateY:ae};return d.a.createElement("div",{className:"absolute inset-x-0 pointer-events-none z-3",style:{height:K}},C&&O(!0),O(),d.a.createElement(l.b.div,{className:"absolute inset-x-0 z-10 flex inset-t-0 will-change-transform",style:ue},d.a.createElement(W.TopBarIconButton,{icon:"MdMenu",onPress:function(){a.onTapOverviewButton()}}),d.a.createElement("div",{className:"flex-1"}),d.a.createElement(W.TopBarIconButton,{icon:"MdMoreHoriz",onPress:function(e){q.a.openActionSheet({element:e.target,items:[{text:"Undo",icon:"MdUndo",onPress:function(){h.a.undo()}},{text:"Collapse All Items",icon:"FaMinus",onPress:function(){a.collapseAll(void 0,!0),a.scrollToTop()}},{text:"Expand All Items",icon:"MdAdd",onPress:function(){a.collapseAll(void 0,!1),a.scrollToTop()}},{text:"Archive Completed",icon:"MdArchive",onPress:function(){a.archiveCompleted()}}]})}})))}))},,,function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return m}));var n,r=a(49),i=a(7),o=a.n(i),s=a(8),l=a.n(s),u=a(10),c=a.n(u),d=a(11),h=a(4),f=a(74),p=new(n=function(){function e(){o()(this,e),f.a.onAppearanceChange(this.onAppearanceChange)}return l()(e,[{key:"init",value:function(){}},{key:"onAppearanceChange",value:function(e){console.log(e),h.default.DisplaySettings.setSystemDarkMode("dark"===e)}},{key:"update",value:function(){}}]),e}(),c()(n.prototype,"onAppearanceChange",[d.a],Object.getOwnPropertyDescriptor(n.prototype,"onAppearanceChange"),n.prototype),c()(n.prototype,"update",[d.a],Object.getOwnPropertyDescriptor(n.prototype,"update"),n.prototype),n),g=a(115);function m(){g.a.init(),r.a.init(),p.init()}},function(e,t,a){"use strict";a.r(t);var n=a(51),r=a.n(n),i=a(16),o=a.n(i),s=a(52),l=a.n(s),u=a(3),c=a.n(u),d=a(17),h=a(49),f=a(71),p=a(0),g=a(72),m={height:48,lineHeight:"48px"},v=Object(d.b)((function(e){var t=e.icon,a=e.iconSize,n=e.text,r=e.last,i=e.onPress,o=p.default.classNames("pl-4 flex items-center",{"border-b c-border-light":!r});return c.a.createElement("div",{className:o,style:m,onClick:i},t&&c.a.createElement(g.a,{className:"pr-4",name:t,size:a||18}),""===t&&c.a.createElement("div",{className:"pr-4",style:{width:18}}),n)})),y=a(9),k=a(22);t.default=Object(d.b)((function(e){var t=e.type,a=e.items,n=e.selected,i=e.showCheckboxes,s=e.maxHeight,u=l()(e,["type","items","selected","showCheckboxes","maxHeight"]),d=Object(k.a)(y.a.windowSize),p=o()(d,1)[0],g={maxHeight:s?p.height*s:void 0};return c.a.createElement(f.a,r()({type:t},u,{classNameContent:"flex flex-col",styleContent:g}),c.a.createElement("div",{className:"flex-1 overflow-y-auto"},a.map((function(e,r){var o=e.text,s=e.icon,l=e.onPress;return c.a.createElement(v,{key:o,icon:s||(i?n===o?"MdCheck":"":void 0),text:o,onPress:function(){h.a.closeMenu(t),l()},last:r===a.length-1})}))))}))},function(e,t,a){"use strict";a.r(t);var n=a(51),r=a.n(n),i=a(52),o=a.n(i),s=a(3),l=a.n(s),u=a(9),c=a(4),d=a(17),h=Object(d.b)((function(e){var t=e.contact,a=function(e){return function(t){c.default.menus.closeContextMenu(),c.default.openUrl(e.link,t,!0)}},n=function(e){return function(t){var a=c.default.pluginManager.getPluginGmail();if(a.isActive()&&a.isEnabled()&&!u.a.demo){c.default.menus.closeContextMenu();var n={to:[{text:"",email:e.address}]};c.default.menus.openComposeEmail(a,{initData:n})}else c.default.openUrl(e.link,t,!0)}};return l.a.createElement("div",{className:"contactPreview"},l.a.createElement("div",{className:"contactName c-border"},t.text),t.phoneNumbers&&t.phoneNumbers.map((function(e){return l.a.createElement("div",{className:"contactRow contactPhone",key:e.number},l.a.createElement("i",{className:"contactButton icon-phone c-foreground-super-faded"}),l.a.createElement("span",{className:"contactNumber link",onClick:a(e)},e.number),l.a.createElement("span",{className:"phoneType c-foreground-faded"},e.type))})),t.emails&&t.emails.map((function(e){return l.a.createElement("div",{className:"contactRow contactEmail",key:e.address},l.a.createElement("i",{className:"icon-mail_outline contactButton c-foreground-super-faded"}),l.a.createElement("span",{className:"contactEmail link",onClick:n(e)},e.address))})))})),f=a(71);t.default=Object(d.b)((function(e){var t=e.type,a=e.contact,n=o()(e,["type","contact"]);return l.a.createElement(f.a,r()({type:t},n),l.a.createElement(h,{contact:a}))}))},function(e,t,a){"use strict";a.r(t);var n=a(51),r=a.n(n),i=a(16),o=a.n(i),s=a(52),l=a.n(s),u=a(2),c=a(0),d=a(9),h=a(3),f=a.n(h),p=a(32),g=a(7),m=a.n(g),v=a(8),y=a.n(v),k=a(20),_=a.n(k),b=a(21),w=a.n(b),S=a(13),D=a.n(S),P=a(4),I=a(154);function E(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var a,n=D()(e);if(t){var r=D()(this).constructor;a=Reflect.construct(n,arguments,r)}else a=n.apply(this,arguments);return w()(this,a)}}var C=function(e){_()(a,e);var t=E(a);function a(){return m()(this,a),t.apply(this,arguments)}return y()(a,[{key:"init",value:function(){var e=this.props,t=e.item.hasNote()&&e.item.getNote(),a=t?t.getParsedText():void 0;this.createObservables({hasValue:!!a}),this.refNoteText=f.a.createRef()}},{key:"onUnmount",value:function(){clearTimeout(this._noteUpdateTimeout),this._noteUpdateTimeout=void 0,this._saveNote()}},{key:"getValue",value:function(){return this.refNoteText.current.getValue()}},{key:"_saveNote",value:function(){if(this.props.shouldSave){P.default.PaneUpdateBatcher.beginUpdateItems();var e=this.props.item,t=e.hasNote()&&e.getNote(),a=this.refNoteText.current.getValue();!t&&a&&(t=e.createNote()),t&&(a!==t.getRawText()&&t.setText(a,u.a.ChangeType.Local),a||e.setNote(void 0,u.a.ChangeType.Local)),P.default.PaneUpdateBatcher.commitUpdateItems()}}},{key:"focus",value:function(){this.refNoteText.current.focus()}},{key:"onChange",value:function(){var e=this,t=this.refNoteText.current.getValue().length>0;t!==this.hasValue.get()&&(this.hasValue.set(t),t&&this.props.onValueSet&&requestAnimationFrame((function(){return e.props.onValueSet}))),clearTimeout(this._noteUpdateTimeout),this._noteUpdateTimeout=setTimeout(this._saveNote,8e3)}},{key:"render",value:function(){var e=this.props,t=P.default.DisplaySettings.fontSize(),a=e.item.hasNote()&&e.item.getNote(),n=a?a.getParsedText():void 0,r=a?void 0:"Add note",i=this.state.hasValue?e.heightValue:e.heightEmpty,o=!e.item.canHaveNote();return f.a.createElement(I.a,{ref:this.refNoteText,className:e.className,value:n,placeholder:r,focused:e.focused,onChange:this.onChange,onKeyDown:e.onKeyDown,onKeyPress:e.onKeyPress,selectionStart:e.selectionStart,selectionEnd:e.selectionEnd,fontSize:t,margin:0,height:i,tabIndex:e.tabIndex,richText:!!e.richText,onMaximize:e.richText&&e.onMaximize,isMaximized:e.richText&&e.isMaximized,onClickClose:e.onClickClose,isReadOnly:o,style:e.style})}}]),a}(a(45).a),x=a(17),A=a(41),T=a(71);t.default=Object(x.b)((function(e){var t=e.type,a=e.item,n=e.startFullscreen,i=e.onClosed,s=l()(e,["type","item","startFullscreen","onClosed"]),g=Object(h.useRef)(),m=Object(h.useState)(n),v=o()(m,2),y=v[0],k=v[1];Object(h.useEffect)((function(){return n&&setTimeout((function(){var e;null===(e=g.current)||void 0===e||e.focus()}),150),function(){i()}}),[]);var _=Object(h.useCallback)((function(e){k(e),e&&setTimeout((function(){var e;null===(e=g.current)||void 0===e||e.focus()}),150)}),[]),b=c.default.classNames("flex-1",{"px-2 py-2":!y},{"px-1 py-1":y}),w={height:y?"100%":void 0},S=d.a.isiOS&&d.a.majorVersion<=12?{paddingBottom:100}:void 0,D=Object(h.useMemo)((function(){return f.a.createElement(A.TopBar,null,f.a.createElement(A.TopBarIconButton,{icon:"IoIosArrowBack",onPress:function(){var e,a;null===(e=document.activeElement)||void 0===e||null===(a=e.blur)||void 0===a||a.call(e),p.b.closeMenu(t)}}),f.a.createElement("div",{className:A.ClassNameTopBarTitle},"Edit note"))}),[]);return f.a.createElement(T.a,r()({type:t},s,{spring:u.a.TransitionSpringFaster,classNameContentFullscreen:"h-full",fullscreen:n,stayFullscreenOnceFullscreened:!0,topBar:D,keyboardToolbarHeight:u.a.KeyboardToolbarButtonHeight+8,onFullscreenChange:_}),f.a.createElement("div",{className:"box-border flex flex-col overflow-auto",style:w},f.a.createElement(C,{className:b,richText:!0,shouldSave:!0,item:a,ref:g,style:S})))}))},,,function(e,t,a){"use strict";a.r(t);var n=a(16),r=a.n(n),i=a(2),o=a(28),s=a(0),l=a(3),u=a.n(l),c=a(4),d=a(153),h=a(18),f=a(17),p=a(135),g=a(22),m=a(57),v=a(49),y=a(9),k=a(65),_=a(128),b=Object(f.b)((function(e){var t=e.className,a=e.children,n=e.side,l=e.width,c=e.background,d=e.onClose,h=Object(g.a)(y.a.windowSize),f=r()(h,1)[0],p=Object(o.d)(),m=Object(o.d)(),v=f.width*l,b=Object(k.a)(v),w="left"===n?0:f.width,S=function(){p.start({x:"left"===n?v:-v,transition:i.a.TransitionSpring}),c&&m.start({opacity:.7,transition:i.a.TransitionSpring})};v!==b&&S();var D=function(){null===d||void 0===d||d()};Object(_.a)(D);var P=s.default.classNames("fixed inset-y-0 c-background-toolbar rounded-r box-border",t),I={left:"right"===n?f.width:void 0,right:"left"===n?f.width:void 0,width:f.width,paddingLeft:f.width-v};return u.a.createElement("div",{className:"fixed inset-0 z-0"},c&&u.a.createElement(o.b.div,{className:"absolute inset-0 bg-black",onPan:function(e,t){var a="left"===n?t.offset.x+v:w+t.offset.x-v;p.set({x:a}),c&&m.set({opacity:s.default.clamp(a/v*.7,0,.9)})},onPanEnd:function(e,t){Math.abs(t.offset.x)<5||("left"===n?t.velocity.x<-50:t.velocity.x>50)?D():S()},animate:m,initial:{opacity:0},exit:{opacity:0,transition:i.a.TransitionSpring}}),u.a.createElement(o.b.div,{className:P,style:I,animate:p,initial:{x:w},exit:{x:w,transition:i.a.TransitionSpring}},a))}));t.default=Object(f.b)((function(e){var t=e.pane,a=Object(g.a)(t.overview.isVisible,h.a.onlineStatus,c.default.settings.lastSync),n=r()(a,3),l=n[0],f=n[1],y=n[2],k="Offline"!==f,_=function(){t.overview.setVisibility(!1)};Object(p.a)(t.item,_);var w=y>0?new Date(y).toString(c.default.International.getFormat(i.a.DFormat.LongDayTime)):"Not synced",S=s.default.isDemoMode()?"DEMO MODE":(k?"Last sync: ":"OFFLINE SINCE: ")+w;return u.a.createElement(o.a,null,l&&u.a.createElement(b,{className:"flex flex-col",side:"left",width:.8,background:!0,onClose:_},u.a.createElement("div",{className:"flex-1 overflow-hidden"},u.a.createElement(d.a,{pane:t})),u.a.createElement("div",{className:"pb-1 border-t c-border-heavy"},u.a.createElement("div",{className:"px-4 pt-2 text-12 c-foreground-light"},S),u.a.createElement(m.a,{icon:"MdSettings",text:"Settings",height:48,fontSize:15,iconSize:15,align:"left",onPress:function(){v.a.openMenu({type:"Settings"})}}))))}))}]);
