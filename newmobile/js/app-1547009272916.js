!function(t){function e(e){for(var r,o,u=e[0],s=e[1],h=e[2],c=0,v=[];c<u.length;c++)o=u[c],a[o]&&v.push(a[o][0]),a[o]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r]);for(d&&d(e);v.length;)v.shift()();return n.push.apply(n,h||[]),i()}function i(){for(var t,e=0;e<n.length;e++){for(var i=n[e],r=!0,u=1;u<i.length;u++){var s=i[u];0!==a[s]&&(r=!1)}r&&(n.splice(e--,1),t=o(o.s=i[0]))}return t}var r={},a={1:0},n=[];function o(e){if(r[e])return r[e].exports;var i=r[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.e=function(t){var e=[],i=a[t];if(0!==i)if(i)e.push(i[2]);else{var r=new Promise(function(e,r){i=a[t]=[e,r]});e.push(i[2]=r);var n,u=document.createElement("script");u.charset="utf-8",u.timeout=120,o.nc&&u.setAttribute("nonce",o.nc),u.src=function(t){return o.p+""+({2:"delayedUI"}[t]||t)+"-1547009272916.js"}(t),n=function(e){u.onerror=u.onload=null,clearTimeout(s);var i=a[t];if(0!==i){if(i){var r=e&&("load"===e.type?"missing":e.type),n=e&&e.target&&e.target.src,o=new Error("Loading chunk "+t+" failed.\n("+r+": "+n+")");o.type=r,o.request=n,i[1](o)}a[t]=void 0}};var s=setTimeout(function(){n({type:"timeout",target:u})},12e4);u.onerror=u.onload=n,document.head.appendChild(u)}return Promise.all(e)},o.m=t,o.c=r,o.d=function(t,e,i){o.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},o.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.t=function(t,e){if(1&e&&(t=o(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(o.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)o.d(i,r,function(e){return t[e]}.bind(null,r));return i},o.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return o.d(e,"a",e),e},o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.p="js/",o.oe=function(t){throw console.error(t),t};var u=window.webpackJsonp=window.webpackJsonp||[],s=u.push.bind(u);u.push=e,u=u.slice();for(var h=0;h<u.length;h++)e(u[h]);var d=s;n.push([301,0]),i()}([function(t,e,i){"use strict";i.r(e);var r=i(43),a=i.n(r),n=i(7),o=i.n(n),u=i(8),s=i.n(u),h=i(17),d=i.n(h),c=i(9),v=i.n(c),y=i(18),g=i.n(y),l=i(15),p=i.n(l),m=i(1);function f(t){this.str=(t||"").toString(),this.operatorCurrent="",this.operatorExpecting="",this.node=null,this.escaped=!1,this.list=[],this.operators={'"':'"',"(":")","<":">",",":"",":":";",";":""}}function k(){}f.prototype={tokenize:function(){for(var t,e=0,i=[],r=0,a=this.str.length;r<a;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t=this.str.charAt(r),this.checkChar(t)}return this.list.forEach(function(t){t.value=(t.value||"").toString().trim(),t.value&&i.push(t)}),i},checkChar:function(t){if((t in this.operators||"\\"===t)&&this.escaped)this.escaped=!1;else{if(this.operatorExpecting&&t===this.operatorExpecting)return this.node={type:"operator",value:t},this.list.push(this.node),this.node=null,this.operatorExpecting="",void(this.escaped=!1);if(!this.operatorExpecting&&t in this.operators)return this.node={type:"operator",value:t},this.list.push(this.node),this.node=null,this.operatorExpecting=this.operators[t],void(this.escaped=!1)}this.escaped||"\\"!==t?(this.node||(this.node={type:"text",value:""},this.list.push(this.node)),this.escaped&&"\\"!==t&&(this.node.value+="\\"),this.node.value+=t,this.escaped=!1):this.escaped=!0}},k.prototype={_handleAddress:function(t){var e,i,r,a,n=0,o=!1,u="text",s=[],h={address:[],comment:[],group:[],text:[]};for(r=0,a=t.length;r<a;r++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if("operator"===(e=t[r]).type)switch(e.value){case"<":u="address";break;case"(":u="comment";break;case":":u="group",o=!0;break;default:u="text"}else e.value&&("address"===u&&(e.value=e.value.replace(/^[^<]*<\s*/,"")),h[u].push(e.value))}if(!h.text.length&&h.comment.length&&(h.text=h.comment,h.comment=[]),o)h.text=h.text.join(" "),s.push({name:h.text||i&&i.name,group:h.group.length?this.parse(h.group.join(",")):[]});else{if(!h.address.length&&h.text.length){var d=0;for(r=h.text.length-1;r>=0;r--){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;if(h.text[r].match(/^[^@\s]+@[^@\s]+$/)){h.address=h.text.splice(r,1);break}}var c=function(t){return h.address.length?t:(h.address=[t.trim()]," ")};if(!h.address.length){var v=0;for(r=h.text.length-1;r>=0;r--){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;if(h.text[r]=h.text[r].replace(/\s*\b[^@\s]+@[^\s]+\b\s*/,c).trim(),h.address.length)break}}}if(!h.text.length&&h.comment.length&&(h.text=h.comment,h.comment=[]),h.address.length>1&&(h.text=h.text.concat(h.address.splice(1))),h.text=h.text.join(" "),h.address=h.address.join(" "),!h.address&&o)return[];(i={address:h.address||h.text||"",name:h.text||h.address||""}).address===i.name&&((i.address||"").match(/@/)?i.name="":i.address=""),s.push(i)}return s},parse:function(t){var e=this,i=0,r=new f(t).tokenize(),a=[],n=[],o=[];r.forEach(function(t){"operator"!==t.type||","!==t.value&&";"!==t.value?n.push(t):(n.length&&a.push(n),n=[])}),n.length&&a.push(n),a.forEach(function(t){var i=e._handleAddress(t);i.length&&(o=o.concat(i))});for(var u=[],s=0;s<o.length;++s){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;u.push({type:"contact",text:o[s].name||o[s].address,email:o[s].address})}return u}};var A,S,w=new k,L=i(3),F=i(87),C=function(){if("function"!==typeof Array.prototype.pushArray&&(Array.prototype.pushArray=function(t){try{Z.PAssert(239,Z.isArray(t),"Must only supply array to pushArray")}catch(e){Z.reportError(e)}return this.push.apply(this,t)}),"function"!==typeof Array.prototype.removeArray&&(Array.prototype.removeArray=function(t){try{Z.PAssert(240,Z.isArray(t),"Must only supply array to removeArray")}catch(e){Z.reportError(e)}return this.filter(function(e){return!t||t.indexOf(e)<0})}),"function"!==typeof Array.prototype.removeAt&&(Array.prototype.removeAt=function(t){return this.splice(t,1)[0]}),"function"!==typeof Array.prototype.remove&&(Array.prototype.remove=function(t,e){var i=this.indexOf(t,e);return i>=0&&this.removeAt.call(this,i),i}),"function"!==typeof Array.prototype.equals){var t=function t(e,i,r){return e&&i&&"object"===a()(e)&&"object"===a()(i)?Object.keys(e).length===Object.keys(i).length&&Object.keys(e).reduce(function(a,n){return a&&(r?t(e[n],i[n],r):e[n]===i[n])},!0):e===i};Array.prototype.equals=function(e,i){var r=0;if(!e)return!1;if(this.length!==e.length)return!1;for(var a=0,n=this.length;a<n;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(this[a]instanceof Array&&e[a]instanceof Array){if(!this[a].equals(e[a]))return!1}else if(this[a]!==e[a]&&!t(this[a],e[a],i))return!1}return!0}}"function"!==typeof Array.prototype.indexOfWithProperty&&(Array.prototype.indexOfWithProperty=function(t,e){for(var i=0,r=0;r<this.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(this[r][t]===e)return r}return-1}),"function"!==typeof Array.prototype.findInsertIndex&&(Array.prototype.findInsertIndex=function(t,e){var i=0;try{Z.PAssert(242,void 0!==t&&null!==t,"Require a valid element to insert")}catch(u){Z.reportError(u)}try{Z.PAssert(243,e,"Require a valid comparison function")}catch(u){Z.reportError(u)}for(var r=0,a=this.length-1;r<=a;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=r+a>>1,o=e(this[n],t);if(o<0)r=n+1;else{if(!(o>0))return n;a=n-1}}return r}),"function"!==typeof Array.prototype.findSorted&&(Array.prototype.findSorted=function(t,e){var i=this.findInsertIndex(t,e);if(0===e(this[i],t))return this[i]}),"function"!==typeof Array.prototype.insertSorted&&(Array.prototype.insertSorted=function(t,e){var i=this.findInsertIndex(t,e);return this.splice.apply(this,[i,0,t]),i}),"function"!==typeof Array.prototype.pushOnlyUniques&&(Array.prototype.pushOnlyUniques=function(t,e){var i=0;if(!t)return this;for(var r=0,a=t.length;r<a;++r){var n=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var o=!0,u=0,s=this.length;u<s;++u){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e&&e(t[r],this[u])||!e&&t[r]===this[u]){o=!1;break}}o&&this.push(t[r])}return this}),"function"!==typeof String.prototype.startsWith&&(Object.defineProperty?Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function(t,e){return e=e||0,this.lastIndexOf(t,e)===e}}):String.prototype.startsWith=function(t){return 0===this.lastIndexOf(t,0)}),"function"!==typeof String.prototype.endsWith&&(String.prototype.endsWith=function(t){return-1!==this.indexOf(t,this.length-t.length)}),"function"!==typeof String.prototype.prevIndexOf&&(String.prototype.prevIndexOf=function(t,e){for(var i=0,r=-1,a=e-1;a>=0;--a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(this[a]===t){r=a;break}}return r}),"function"!==typeof String.prototype.capitalize&&(String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)})},I=(i(305),i(16)),P={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"};Promise.resolve().then(i.bind(null,4)).then(function(t){return S=t.default});var N,H,M=(A=function(){function t(){o()(this,t),C(),this.LogLevel=m.a.LogLevels.Error|m.a.LogLevels.Warning,this.noLocalWrites=!1,this.totalItems=0,this.totalArchivedItems=0,this.totalArchivedParents=0,this.totalPanes=0,this.tempIndex=0,this.__FULL_NOTIFICATION_UPDATES=0,this.__SINGLE_NOTIFICATION_UPDATES=0,this.TEMP_PREFIX="~T^",this._itemAnimationMode=void 0,this.fnRegex=/function\s+([^(]*?)\s*\(([^)]*)\)/,this.supportSimpleStack=!0,this.__LOG_BUFFER=new F.a(L.a.isMobile?30:50),this.isLoaded=!1,this.aggregateEvents={},this.anonID=void 0,this.defaultSeed=129831293,this._isInCompleteAction=!1,this.timeouts={}}return s()(t,[{key:"Assert",value:function(){}},{key:"reportError",value:function(t,e,i,r){console.log(t),console.log(e)}},{key:"isFlagSet",value:function(t,e){return(t&e)===e}},{key:"isFunction",value:function(t){return!!(t&&t.constructor&&t.call&&t.apply)}},{key:"isEmpty",value:function(t){for(var e in t)if(t.hasOwnProperty(e))return!1;return!0}},{key:"isArray",value:function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{key:"isString",value:function(t){return"string"===typeof t}},{key:"isObject",value:function(t){return"object"===a()(t)&&null!==t&&!this.isArray(t)}},{key:"isNumber",value:function(t){return"number"===typeof t&&!isNaN(t)}},{key:"isBoolean",value:function(t){return!0===t||!1===t}},{key:"isAnything",value:function(){return!0}},{key:"clone",value:function(t,e){var i;if(this.isArray(t))return this.cloneDeep(t);if(e)for(var r in i={},t)t.hasOwnProperty(r)&&(e&&void 0===t[r]||(i[r]=t[r]));else i=Object.assign({},t);return i}},{key:"cloneWithoutUndefineds",value:function(t){return this.clone(t,!0)}},{key:"cloneDeep",value:function(t){return JSON.parse(JSON.stringify(t))}},{key:"arrayDifference",value:function(t,e){for(var i=0,r=[],a=0;a<t.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e[t[a]]||r.push(t[a])}return r}},{key:"emptyFn",value:function(){}},{key:"newEmptyFn",value:function(){return function(){}}},{key:"weeks",value:function(t){return 6048e5*t}},{key:"days",value:function(t){return 864e5*t}},{key:"hours",value:function(t){return 36e5*t}},{key:"minutes",value:function(t){return 6e4*t}},{key:"seconds",value:function(t){return 1e3*t}},{key:"parseInt",value:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return parseInt(t,10)})},{key:"shouldLog",value:function(t){return this.__DEV__===t}},{key:"shouldWriteLocal",value:function(){return!this.noLocalWrites}},{key:"isLocalWriteReason",value:function(t){return this.noLocalWritesReason===t}},{key:"isValidChangeType",value:function(t){if(void 0!==t&&null!==t){var e=t&~m.a.ChangeType.All;if(this.inMaskOnly(t,m.a.ChangeType.Valid))return(e&m.a.ChangeType.Locations)===m.a.ChangeType.None||this.isOneFlagSet(e,m.a.ChangeType.Local|m.a.ChangeType.Remote|m.a.ChangeType.Auto)}return!1}},{key:"isRemoteChange",value:function(t){try{this.PAssert(112,this.isValidChangeType(t),"Must supply a valid changeType")}catch(i){this.reportError(i)}var e=t&~m.a.ChangeType.All;return this.isValidChangeType(t)&&this.isFlagSet(e,m.a.ChangeType.Remote)}},{key:"isUndoRedoChange",value:function(t){try{this.PAssert(113,this.isValidChangeType(t),"Must supply a valid changeType")}catch(i){this.reportError(i)}var e=t&~m.a.ChangeType.All;return this.isValidChangeType(t)&&this.isFlagSet(e,m.a.ChangeType.UndoRedo)}},{key:"isLocalChange",value:function(t){try{this.PAssert(114,this.isValidChangeType(t),"Must supply a valid changeType")}catch(i){this.reportError(i)}var e=t&~m.a.ChangeType.All;return this.isValidChangeType(t)&&this.isFlagSet(e,m.a.ChangeType.Local)}},{key:"isAutoChange",value:function(t){try{this.PAssert(115,this.isValidChangeType(t),"Must supply a valid changeType")}catch(i){this.reportError(i)}var e=t&~m.a.ChangeType.All;return this.isValidChangeType(t)&&this.isFlagSet(e,m.a.ChangeType.Auto)}},{key:"inMaskOnly",value:function(t,e){return 0===(~e&t)}},{key:"isOneFlagSet",value:function(t,e){var i=t&e;return 0!==i&&0===(i&i-1)}},{key:"isAtLeastOneFlagSet",value:function(t,e){return 0!==(t&e)}},{key:"forEachFlagSet",value:function(t,e){for(var i=0;0!==t;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e(Math.abs(t&-t)),t&=t-1}}},{key:"generateTempId",value:function(){return this.TEMP_PREFIX+Date.now()+ ++this.tempIndex}},{key:"toLowerCase",value:function(t){return t.toLowerCase()}},{key:"numberComparator",value:function(t,e){return t-e}},{key:"insertIntoText",value:function(t,e,i){try{this.PAssert(116,i<=t.length)}catch(r){this.reportError(r)}return t.substr(0,i)+e+t.substr(i,t.length-i)}},{key:"arrayUnion",value:function(t,e){for(var i=0,r=0,a=[],n=0;n<t.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a.indexOf(t[n])<0&&a.push(t[n])}for(n=0;n<e.length;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;a.indexOf(e[n])<0&&a.push(e[n])}return a}},{key:"arrayDiff",value:function(t,e){for(var i=0,r=0,a=[],n=0;n<t.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e.indexOf(t[n])<0&&a.push(t[n])}for(n=0;n<e.length;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;t.indexOf(e[n])<0&&a.push(e[n])}return a}},{key:"arrayIntersection",value:function(t,e){for(var i=0,r=[],a=0;a<t.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e.indexOf(t[a])>=0&&r.push(t[a])}return r}},{key:"arrayUniques",value:function(t,e){t=t||[];var i=[];if(e)for(var r=0,a=0;a<t.length;++a){var n=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var o=!0,u=t[a],s=0;s<i.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e(u,i[s])){o=!1;break}}o&&i.push(u)}else for(var h=0,d=0,c=t.length;d<c;d++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;i.indexOf(t[d])<0&&i.push(t[d])}return i}},{key:"areObjectsEqual",value:function(t,e){return(void 0!==t&&void 0!==e||t===e)&&JSON.stringify(t,Object.keys(t).sort())===JSON.stringify(e,Object.keys(e).sort())}},{key:"extend",value:function(t,e){if(e)for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t}},{key:"classNames",value:function(){for(var t=0,e=0,i=arguments.length,r=new Array(i),n=0;n<i;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r[n]=arguments[n]}for(var o=arguments,u=[],s=0;s<o.length;s++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var h=o[s];if(h)if(this.isString(h)||this.isNumber(h))u.push(h);else if("object"===a()(h))for(var d in h)h.hasOwnProperty(d)&&h[d]&&u.push(d)}return u.join(" ")}},{key:"isPrefixTask",value:function(t){return t&&(t===m.a.Prefix.Task||t===m.a.Prefix.Task2||t===m.a.Prefix.Task3||t===m.a.Prefix.Task4||t===m.a.Prefix.Task5||t===m.a.Prefix.Task6||t===m.a.Prefix.Task7||t===m.a.Prefix.Task8)}},{key:"escape",value:function(t){return String(t).replace(/[&\"<>]/g,function(t){return P[t]})}},{key:"unescape",value:function(t){return String(t).replace(/&lt;|&gt;|&amp;|&quot;/g,function(t){for(var e in P)if(P.hasOwnProperty(e)&&P[e]===t)return e;try{this.PAssert(117,!1,"Should have found a character to replace")}catch(i){this.reportError(i)}return t})}},{key:"escapeRegExp",value:function(t){return t.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}},{key:"stripTagsBasic",value:function(t){return t.replace(/<.*>/g,"")}},{key:"stripFormattingTags",value:function(t){return t.replace(/<\/?[biu]>/g,"")}},{key:"invertObject",value:function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[t[i]]=i);return e}},{key:"filterWithNonMatches",value:function(t,e){for(var i=0,r={match:[],fail:[]},a=0;a<t.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=t[a];e(n)?r.match.push(n):r.fail.push(n)}return r}},{key:"isUrlImage",value:function(t){return(t=t.toLowerCase()).endsWith(".png")||t.endsWith(".jpg")||t.endsWith(".gif")}},{key:"isDateSoft",value:function(t){if(t)switch(t.toUpperCase()){case"NEXT":case"SOON":case"LATER":case"SOMEDAY":case"NOW":return!0}return!1}},{key:"isDateValid",value:function(t){return t&&t instanceof Date&&!isNaN(t.getTime())}},{key:"getItemAnimationMode",value:function(){return this._itemAnimationMode}},{key:"setItemAnimationMode",value:function(t){this._itemAnimationMode=t}},{key:"resetItemAnimationMode",value:function(){this._itemAnimationMode=m.a.ItemAnimationMode.Normal}},{key:"parseEmailAddresses",value:function(t){return w.parse(t)}},{key:"isTempId",value:function(t){return t&&t[0]===this.TEMP_PREFIX[0]&&t[1]===this.TEMP_PREFIX[1]&&t[2]===this.TEMP_PREFIX[2]}},{key:"isLocalItem",value:function(t){try{this.PAssert(118,t.id,"All items should have an ID even if it is a temp one")}catch(e){this.reportError(e)}return this.isTempId(t.id)}},{key:"getCurrentStack",value:function(t){var e;if(this.supportSimpleStack)try{e=JSON.stringify(t)}catch(i){this.log("Error stringifying stack message",i,t)}if(this.supportSimpleStack){var i=new Error(e||t);if(i.stack)return i.stack}this.supportSimpleStack=!1;try{for(var r=0,a=["GenError: "+(e||t)],n=arguments.callee.caller,o=0;n&&o++<75;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u,s=n.toString(),h=this.fnRegex.exec(s);u=h&&3===h.length&&""!==h[1]&&void 0!==h[1]?"at "+h[1]+"("+h[2].replace(/[\r\n]/g,"")+")":h&&3===h.length?"at <anonymous> ("+h[2].replace(/[\r\n]/g,"")+")":"at <anonymous> (<unknown>)",a.push(u),n=n.caller}return a.join("\n")}catch(d){this.log("Error generating stack trace",d)}return""}},{key:"isVMLI",value:function(t){return t&&t.__ISVMLI}},{key:"isPane",value:function(t){return t&&t.__ISPANE}},{key:"log",value:function(){for(var t=0,e=arguments.length,i=new Array(e),r=0;r<e;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i[r]=arguments[r]}try{this.__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," "))}catch(a){try{this.__LOG_BUFFER.push(Date.now()+": Invalid Log Arguments")}catch(n){console.log("Error adding to __LOG_BUFFER: ",arguments)}}console.log.apply(console,arguments)}},{key:"registerEvent",value:function(t,e,i){try{this.PAssert(119,!this.aggregateEvents.hasOwnProperty(t),"Should only register an event once")}catch(a){this.reportError(a)}try{this.PAssert(120,void 0!==t,"Must specify a name for the event")}catch(a){this.reportError(a)}try{this.PAssert(121,void 0!==e,"Must specify a category for the event")}catch(a){this.reportError(a)}try{this.PAssert(122,void 0!==i,"Must specify an action for the event")}catch(a){this.reportError(a)}var r={category:e,action:i,label:this.getAnonUserIdentifier(),count:0};this.aggregateEvents[t]=r}},{key:"aggregateEvent",value:function(t,e){try{this.PAssert(123,this.aggregateEvents.hasOwnProperty(t),"Must register an event before using it")}catch(i){this.reportError(i)}void 0===e&&(e=1),this.aggregateEvents[t]&&(this.aggregateEvents[t].count+=e)}},{key:"UIAction",value:function(t){this.sendEvent("UIAction",t)}},{key:"getAggregateEvents",value:function(){return this.aggregateEvents}},{key:"getAnonUserIdentifier",value:function(){if(!this.anonID){var t=this.getUserIdentifier();this.anonID=t?t[0]+t[1]+t[2]+this.murmurhash3_32_gc(t,17124123):"loggedout"}return this.anonID}},{key:"murmurhash3_32_gc",value:function(t,e){var i,r,a,n,o,u,s,h,d=0;for(i=3&t.length,r=t.length-i,a=e,o=3432918353,u=461845907,h=0;h<r;){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;s=255&t.charCodeAt(h)|(255&t.charCodeAt(++h))<<8|(255&t.charCodeAt(++h))<<16|(255&t.charCodeAt(++h))<<24,++h,a=27492+(65535&(n=5*(65535&(a=(a^=s=(65535&(s=(s=(65535&s)*o+(((s>>>16)*o&65535)<<16)&4294967295)<<15|s>>>17))*u+(((s>>>16)*u&65535)<<16)&4294967295)<<13|a>>>19))+((5*(a>>>16)&65535)<<16)&4294967295))+((58964+(n>>>16)&65535)<<16)}switch(s=0,i){case 3:s^=(255&t.charCodeAt(h+2))<<16;case 2:s^=(255&t.charCodeAt(h+1))<<8;case 1:a^=s=(65535&(s=(s=(65535&(s^=255&t.charCodeAt(h)))*o+(((s>>>16)*o&65535)<<16)&4294967295)<<15|s>>>17))*u+(((s>>>16)*u&65535)<<16)&4294967295}return a^=t.length,a=2246822507*(65535&(a^=a>>>16))+((2246822507*(a>>>16)&65535)<<16)&4294967295,a=3266489909*(65535&(a^=a>>>13))+((3266489909*(a>>>16)&65535)<<16)&4294967295,(a^=a>>>16)>>>0}},{key:"hashString",value:function(t){try{this.PAssert(124,this.isString(t),"Must always be passing a string to hash")}catch(e){this.reportError(e)}return this.murmurhash3_32_gc(t,this.defaultSeed)}},{key:"isDemoMode",value:function(){return!1}},{key:"getUserIdentifier",value:function(){return this.isDemoMode()?"demouser":S?S.settings.activeUser.get():"Missing toolbox"}},{key:"beginCompleteAction",value:function(){this._isInCompleteAction=!0}},{key:"isInCompleteAction",value:function(){return this._isInCompleteAction}},{key:"endCompleteAction",value:function(){this._isInCompleteAction=!1}},{key:"getObjectInfo",value:function(t){try{if(t&&t.constructor)return t.constructor.name}catch(e){this.reportError(e)}return a()(t)}},{key:"hasTimeoutOnce",value:function(t){return!!this.timeouts[t]}},{key:"timeoutOnce",value:function(t,e,i,r,a,n,o,u){var s=this;try{this.PAssert(125,t,"Must supply a valid name")}catch(d){this.reportError(d)}try{this.PAssert(126,this.isFunction(e),"must supply a valid cb fn")}catch(d){this.reportError(d)}try{this.PAssert(127,arguments.length<=8,"Too many args passed in")}catch(d){this.reportError(d)}var h=this.timeouts[t];h&&clearTimeout(h),this.timeouts[t]=setTimeout(function(){delete s.timeouts[t],e(r,a,n,o,u)},i)}},{key:"clearTimeoutOnce",value:function(t){var e=this.timeouts[t];e&&(clearTimeout(e),delete this.timeouts[t])}},{key:"sendEvent",value:function(t,e,i){}},{key:"objectValues",value:function(t){return Object.keys(t).map(function(e){return t[e]})}},{key:"trimRight",value:function(t){for(var e=0,i=t.length-1;i>=0;i--){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(" "!==t[i])break;t=t.substr(0,i)}return t}}]),t}(),p()(A.prototype,"cloneWithoutUndefineds",[I.a],Object.getOwnPropertyDescriptor(A.prototype,"cloneWithoutUndefineds"),A.prototype),A),z=i(19),D=i(10),V=i(71),G=i.n(V),T=i(285);Promise.resolve().then(i.bind(null,4)).then(function(t){return H=t.default});var q,j=["http://a.visadd.com/script/layer","https://gc.kis.v2.scr.kaspersky-labs.com"];!function(t){t[t.None=0]="None",t[t.Item=1]="Item",t[t.Element=2]="Element"}(q||(q={}));var Y=[0,5,15,35,80,170,400,1200],X=[0,408,429,500,502,503,504],Q=/https:\/\/www.evernote.com\/shard\/([a-z0-9.\-]+)\/nl\/([a-z0-9.\-]+)\/([a-z0-9.\-]+)/g,J=(N=function(t){function e(){var t;return o()(this,e),t=d()(this,v()(e).call(this)),window.__infLoop=t.infLoop,t.vmMain=void 0,t.isShowingLogin=new D.a(!1),t.topBarHeight=L.a.android?56:44,t.archivedPadding=34,t.itemTransitionTime=100,t.iOSDragTime=400,t.iOSDragTimeKeyboardOpen=200,t.scrollbarWidth=12,t.hasFocus=!0,t.zoomTime=0,t.demoMode=!1,t.focusedPane=void 0,t.focusedItem=void 0,t.ClickThreshold=5,t.isReconnected=!1,t.isBlocked=!1,t.blockedMessage="",t.authImmediateFailed=!1,t.authUserLoggedIn=!1,t.noLocalWrites=!1,t.noLocalWritesReason=m.a.LocalWriteReason.Enabled,t.isLoadingRemote=!1,t.isSendingEmail=!1,t.isSavingDrafts=!1,t.isKeyboardOpen=!1,t.itemMenuOpenedOn=void 0,t.errorPlatformInfo=void 0,t.nativeBacklog=[],t.elements={},t.SPThresholdLeft=8,t.SPThresholdRight=42,t.MobileSideTapThreshold=40,t.MobileSideTapThresholdKeyboardOpen=15,t.colorBlue="#09d",t.colorLightBlue="#02b1ff",t.colorRed="#d43",t.colorLightRed="#f34433",t.MinItemWidth=50,t.paneTop=L.a.isMobile?t.topBarHeight:L.a.app?20:0,t.activeDisplayMode=m.a.DisplayMode.Default,t.numReported=0,t.isReporting=!1,t.isRollbarConfigured=!1,t.lastErrorsReported={},t.eventStream=new F.a(25),t.currentFindPass=0,t.timeouts={},t.scrollTimeouts={},t.scrollState={speedPane:0,pane:void 0,speedPanes:0,panes:!1},t.keyboardDestination=q.None,t.keyboardOpenedOn=void 0,t.keyboardBlurFn=void 0,t.keyboardStartScrollOffset=0,t.__xhrRequests={},t.downloadToasts=[],t.numLastLoop=-1,t.timeLastLoop=void 0,window.onerror=t.onWindowError,t.wrapAsyncCallbacks(),t.setupLoggers(),t.wrapXHR(),L.a.demo&&t.enableDemoMode(),t}return g()(e,t),s()(e,[{key:"addDevFunctions",value:function(){var t=this,e=arguments,i=window;i.__globals=function(){return t};var r=1;this.shouldLog(m.a.LogLevels.Input)&&(i.__eventBuffer=new F.a(100)),this.tagEvent=function(e,a,n){e.id||(e.id=r++,t.shouldLog(m.a.LogLevels.Input)&&i.__eventBuffer.push(e)),t.shouldLog(m.a.LogLevels.Input)&&(e.activeHandler={owner:a,fn:n},e.handlers?e.handlers.push(e.activeHandler):e.handlers=[e.activeHandler])},this.Assert=function(t){if(!t)try{e.length>1?i.__error.apply(console,Array.prototype.slice.call(e,1)):i.__error("Assert Failure!")}catch(r){i.__error("Problem reporting Assert!")}},this.DAssert=function(e){e||t.log("Debug ONLY assert was hit.")},i.__getXHRStats=this.getXHRStats}},{key:"_dbgCatch",value:function(t){var e=Array.prototype.slice.call(arguments,1);try{if(t)return t.apply(void 0,e)}catch(i){this.reportError(i,e)}}},{key:"fnCatch",value:function(t){try{this.PAssert(2,t,"Must specify a callback")}catch(e){this.reportError(e)}return this._dbgCatch.bind(this,t)}},{key:"getTransitionClass",value:function(t){var e;switch(t){case 50:e="trans05";break;case 100:e="trans1";break;case 200:e="trans2";break;case 300:e="trans3";break;case 400:e="trans4";break;case 500:e="trans5";break;case 1e3:e="trans10";break;default:console.log("ERROR: no time for ",t)}return e}},{key:"setTransformStyle",value:function(t,e,i){try{this.PAssert(3,t,"Must provide a valid element")}catch(r){this.reportError(r)}if(t){try{this.PAssert(4,void 0!==e,"Must supply a valid X offset")}catch(r){this.reportError(r)}try{this.PAssert(5,void 0!==i,"Must supply a valid Y offset")}catch(r){this.reportError(r)}L.a.ie?t.style[L.a.transform.style]="translate("+e+"px, "+i+"px)":t.style[L.a.transform.style]="translate3d("+e+"px, "+i+"px, 0px)"}}},{key:"setTransitionStyle",value:function(t,e,i,r){try{this.PAssert(6,t,"Must provide a valid element")}catch(a){this.reportError(a)}t&&(r=r||"ease",t.style[L.a.transition.style]=e+" "+i+"ms "+r,setTimeout(function(){t.style[L.a.transition.style]=""},i))}},{key:"setTransform",value:function(t,e,i,r,a){r>0?(this.setTransitionStyle(t,L.a.transform.prop,r,a),this.setTransformStyle(t,e,i)):e||i?this.setTransformStyle(t,e,i):t.style[L.a.transform.style]="none"}},{key:"reload",value:function(t){window.location.reload(t)}},{key:"isEmail",value:function(t){var e=!1;t&&(e=!!new RegExp(/\S+@\S+\.\S+/i).exec(t),e&&(e=t.indexOf('"')<0));return e}},{key:"parseTokensFromText",value:function(t){for(var e,i=0,r=[],a=/(?:(?:[\"]([^\"<>]*)[\"]\s))|(?:([^\",<>]*)\s)<([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>,?|(^|[\s,])<?([^<>,\s]+@[^<>,\s]+\.[^<>,\s]+)>?,?/g,n=0;null!==(e=a.exec(t));){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=t.substring(n,e.index),u=e[1]||e[2],s=e[3]||e[5];n=a.lastIndex,o&&o.trim().length>0&&r.push({text:o,type:"text"}),r.push({text:u||s,email:s,type:"contact"})}var h=t.substring(n,t.length);return h&&h.length>0&&r.push({text:h,type:"text"}),r}},{key:"isWhiteSpace",value:function(t){return/^\s*$/.test(t)}},{key:"isRunningScript",value:function(){return this.AScript&&this.AScript.isRunning}},{key:"preventLocalWrites",value:function(t){try{this.PAssert(7,!this.noLocalWrites,"Should only disable local writes once")}catch(e){this.reportError(e)}try{this.PAssert(8,t>=0,"Must provide a valid reason for disabling local writes")}catch(e){this.reportError(e)}this.isDemoMode()||this.shouldLog(m.a.LogLevels.Warning)&&this.log("---- WARNING: Local Writes Disabled ----"),this.noLocalWrites=!0,this.noLocalWritesReason=t}},{key:"enableDemoMode",value:function(){this.demoMode=!0;var t=z.a.getURLParam("dmode");t&&this.enableMinMode(t),this.preventLocalWrites(m.a.LocalWriteReason.DemoMode)}},{key:"isDemoMode",value:function(){return this.demoMode}},{key:"isDisplayModeActive",value:function(t){return(this.activeDisplayMode&t)===t}},{key:"isDemoInIframe",value:function(){return this.isDisplayModeActive(m.a.DisplayMode.InIframe)}},{key:"enableMinMode",value:function(t){try{if(this.addClass(document.body,"minMode"),this.isMinMode=!0,t=this.parseInt(t),L.a.touch||(t&m.a.DisplayMode.InIframe&&this.addClass(document.documentElement,"inIframe"),t&m.a.DisplayMode.Invisible&&this.addClass(document.documentElement,"invisible"),t&m.a.DisplayMode.NoPaneHeaders&&this.addClass(document.body,"noPaneHeaders"),t&m.a.DisplayMode.NoMinPaneSize&&(this.minPaneWidth=0),t&m.a.DisplayMode.NoPaneStyle&&this.addClass(document.body,"noPaneStyle")),t&m.a.DisplayMode.NoPanePadding&&(this.addClass(document.body,"noPanePadding"),this.noPanePadding=!0),t&m.a.DisplayMode.NoScrollbars&&(this.noScrollbars=!0),t&m.a.DisplayMode.NoBackground&&this.addClass(document.documentElement,"noBackground"),t&m.a.DisplayMode.NoInteraction){var e=document.getElementById("outerWrapper"),i=document.createElement("div");i.id="preventInteraction",e.appendChild(i),t&m.a.DisplayMode.PromptStart&&this.setupClick(i,i,function(){var t=H.toasts.getMessageById(m.a.MessageID.PromptScriptStart);t&&(t.doAction(),t.hide())})}t&m.a.DisplayMode.ShowDemoExit&&setTimeout(function(){H.toasts.pushMessage(m.a.MessageID.ExitDemo)},0),t&m.a.DisplayMode.PromptStart&&setTimeout(function(){H.toasts.pushMessage(m.a.MessageID.PromptScriptStart)},0),this.activeDisplayMode=t}catch(r){this.reportError(r)}}},{key:"hasClass",value:function(t,e,i){try{this.PAssert(9,t,"Must pass in a valid element")}catch(o){this.reportError(o)}if(t.classList)for(var r=0,a=Array.prototype.slice.call(arguments,1),n=0;n<a.length;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(t.classList.contains(a[n]))return!0}return!1}},{key:"removeClass",value:function(t,e){try{this.PAssert(10,t,"Must pass in a valid element")}catch(i){this.reportError(i)}t&&t.classList&&t.classList.remove(e)}},{key:"addClass",value:function(t,e){try{this.PAssert(11,t,"Must pass in a valid element")}catch(i){this.reportError(i)}t&&t.classList&&t.classList.add(e)}},{key:"toggleClass",value:function(t,e){try{this.PAssert(12,t,"Must pass in a valid element")}catch(i){this.reportError(i)}t&&t.classList&&t.classList.toggle(e)}},{key:"findChild",value:function(t,e){try{this.PAssert(13,t,"Must pass in a valid element")}catch(o){this.reportError(o)}if(t)for(var i=0,r=0;r<t.childElementCount;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var a=t.children[r];if(this.hasClass(a,e))return a;var n=this.findChild(a,e);if(n)return n}}},{key:"setupClick",value:function(t,e,i){var r=this;try{this.PAssert(14,t,"Expecting an object to bind the click handlers to.")}catch(V){this.reportError(V)}try{this.PAssert(15,e,"Must specify a valid owner for click handlers")}catch(V){this.reportError(V)}this.shouldLog(m.a.LogLevels.Input)&&this.log("SetupClick: "+this.elementToString(t)),e||(e=t);var a,n,o,u,s,h,d,c,v,y,g,l,p,f=this,k=!1;this.isFunction(i)?i={onClick:i}:i&&i.useCapture&&(k=i.useCapture);var A=function(t,r){try{f.PAssert(16,!e.isDestroyed||!e.isDestroyed()||"onMove"===t||"onEnd"===t,"Owner must not be destroyed to handle a click")}catch(V){f.reportError(V)}return i[t].call(e,r)},S=function(t){f.shouldLog(m.a.LogLevels.Input)&&r.log("Move: ",t.id);var e=t.eventX-a,g=t.eventY-n;if(0!==e||0!==g){var l=!s;if(a=t.eventX,n=t.eventY,t.distanceX=o+=Math.abs(e),t.distanceY=u+=Math.abs(g),(s||t.distanceX>r.ClickThreshold||t.distanceY>r.ClickThreshold)&&(s=!0,t.moved=s),i.onMove||i.onFirstMove)if(t.diffX=t.eventX-h,t.diffY=t.eventY-d,t.xThisFrame=e,t.yThisFrame=g,t.startX=h,t.startY=d,t.startClientX=c,t.startClientY=v,t.startSrc=y,l&&i.onFirstMove&&A("onFirstMove",t),i.onMove)A("onMove",t)&&t.stopImmediatePropagation()}},w=function(e){f.shouldLog(m.a.LogLevels.Input)&&f.log("End: ",e.id,f.elementToString(e.target),f.elementToString(t));var r=Date.now();g=g||r;var o=Math.max(0,r-g);l?l++:l=1,e.moved=s,e.timeDelta=o,e.diffX=a-h,e.diffY=n-d,e.startX=h,e.startY=d,e.startSrc=y,y=void 0,o<m.a.DoubleClickTime&&o>0&&i.onDoubleClick&&!s&&A("onDoubleClick",e),isNaN(e.button)||e.button===m.a.ButtonCode.Left?(g=r,!i.onClick||s||L.a.mac&&e.ctrlKey||A("onClick",e),i.onEnd&&A("onEnd",e)):e.button===m.a.ButtonCode.Middle&&i.onMiddleClick&&!s&&A("onMiddleClick",e),setTimeout(function(){g=void 0,l=void 0},m.a.DoubleClickTime)},F=function(e){f.shouldLog(m.a.LogLevels.Input)&&f.log("Start: ",e.id,f.elementToString(e.target),f.elementToString(t)),e.timeStart=Date.now(),y=e.target,e.startSrc=e.target,s=!1,e.startX=h=e.eventX,e.startY=d=e.eventY,e.startClientX=c=e.clientX,e.startClientY=v=e.clientY,a=e.eventX,n=e.eventY,o=0,u=0,(isNaN(e.button)||e.button===m.a.ButtonCode.Left||e.button===m.a.ButtonCode.Right)&&((isNaN(e.button)||e.button===m.a.ButtonCode.Left)&&i.onStart?A("onStart",e):e.button===m.a.ButtonCode.Right&&i.onRightStart&&A("onRightStart",e)),isNaN(e.changeLastY)||(n+=e.changeLastY)},C=this.fnCatch(function(e){if(!e.handled){f.shouldLog(m.a.LogLevels.Input)&&f.log("TouchStart: ",e.id,f.elementToString(e.target),f.elementToString(t)),p=!0;var i=L.a.ie?e:e.touches[0];return e.eventX=i.pageX,e.eventY=i.pageY,e.clientX=i.clientX,e.clientY=i.clientY,F.call(t,e),e.ignore||(document.addEventListener(L.a.touchMoveEvent,I,k),document.addEventListener(L.a.touchEndEvent,P,k),document.addEventListener(L.a.touchCancelEvent,N,k)),!e.returnFalse&&void 0}}),I=this.fnCatch(function(e){var i=L.a.ie?e:e.touches[0];if(e.eventX=i.pageX,e.eventY=i.pageY,e.clientX=i.clientX,e.clientY=i.clientY,S.call(t,e),e.returnFalse)return!1}),P=this.fnCatch(function(e){f.shouldLog(m.a.LogLevels.Input)&&f.log("TouchUp: ",e.id,f.elementToString(e.target),f.elementToString(t)),document.removeEventListener(L.a.touchMoveEvent,I,k),document.removeEventListener(L.a.touchEndEvent,P,k),document.removeEventListener(L.a.touchCancelEvent,N,k);var i=L.a.ie?e:e.changedTouches[0];if(e.eventX=i.pageX,e.eventY=i.pageY,e.clientX=i.clientX,e.clientY=i.clientY,w.call(t,e),e.returnFalse)return!1}),N=this.fnCatch(function(e){if(f.shouldLog(m.a.LogLevels.Input)&&f.log("TouchCancel: ",e.id,f.elementToString(e.target),f.elementToString(t)),document.removeEventListener(L.a.touchMoveEvent,I,k),document.removeEventListener(L.a.touchEndEvent,P,k),document.removeEventListener(L.a.touchCancelEvent,N,k),function(e){f.shouldLog(m.a.LogLevels.Input)&&f.log("Cancel: ",e.id,f.elementToString(e.target),f.elementToString(t)),i.onCancel&&A("onCancel",e)}.call(t,e),e.returnFalse)return!1}),H=this.fnCatch(function(e){if(!e.handled&&!p)return f.shouldLog(m.a.LogLevels.Input)&&f.log("MouseDown: ",e.id,f.elementToString(e.target),f.elementToString(t)),p=!1,e.eventX=e.pageX,e.eventY=e.pageY,F.call(t,e),e.ignore||(e.button===m.a.ButtonCode.Left&&document.addEventListener(L.a.moveEvent,M,k),document.addEventListener(L.a.upEvent,z,k)),!e.returnFalse&&void 0}),M=this.fnCatch(function(e){if(!p)return e.eventX=e.pageX,e.eventY=e.pageY,S.call(t,e),!e.returnFalse&&void 0}),z=this.fnCatch(function(e){if(!e.handled&&!p)return f.shouldLog(m.a.LogLevels.Input)&&f.log("MouseUp: ",e.id,f.elementToString(e.target),f.elementToString(t)),document.removeEventListener(L.a.moveEvent,M,k),document.removeEventListener(L.a.upEvent,z,k),e.button===m.a.ButtonCode.Left&&w.call(t,e),!e.returnFalse&&void 0}),D=this.fnCatch(function(e){e.handled||p||(f.shouldLog(m.a.LogLevels.Input)&&f.log("ContextMenu: ",e.id,f.elementToString(e.target),f.elementToString(t)),i.onRightClick&&A("onRightClick",e))});if(L.a.isTouchDevice&&L.a.isMobileBrowser?t.addEventListener(L.a.touchStartEvent,C,k):t.addEventListener(L.a.downEvent,H,k),L.a.usePointerEvents&&L.a.isMobile){t.addEventListener("mousedown",function(t){return t.preventDefault(),t.stopImmediatePropagation(),!1},k)}return i.onRightClick&&!L.a.isMobile&&t.addEventListener("contextmenu",D,k),this}},{key:"isFunction",value:function(t){return!!(t&&t.constructor&&t.call&&t.apply)}},{key:"isArray",value:function(t){return"[object Array]"===Object.prototype.toString.call(t)}},{key:"isString",value:function(t){return"string"===typeof t}},{key:"isObject",value:function(t){return"object"===a()(t)&&null!==t&&!this.isArray(t)}},{key:"isNumber",value:function(t){return"number"===typeof t&&!isNaN(t)}},{key:"isBoolean",value:function(t){return!0===t||!1===t}},{key:"isAnything",value:function(){return!0}},{key:"isValidColor",value:function(t){return this.isString(t)&&null!==/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/.exec(t)}},{key:"parseBoolean",value:function(t){return!0===t||"true"===t}},{key:"parseDate",value:function(t){var e=new Date(t);return this.isDateValid(e)?e:void 0}},{key:"isDOMNode",value:function(t){return"HTMLElement"in window?t instanceof HTMLElement:t&&t.tagName&&t.nodeType===Node.ELEMENT_NODE}},{key:"isTextNode",value:function(t){return t&&t.nodeType===Node.TEXT_NODE}},{key:"ensureDOMNode",value:function(t){var e;return this.isDOMNode(t)?e=t:this.isTextNode(t)&&(e=t.parentElement),e}},{key:"enumToString",value:function(t,e){for(var i in t)if(t[i]===e)return i;return null}},{key:"elementToString",value:function(t,e){if(t){var i=t.nodeName;return t.id&&(i+="#"+t.id),t.className&&(i+="."+t.className.replace(/ /g,".")),e&&t.innerText&&(i+=":"+t.innerText.length),i}return"UNDEFINED"}},{key:"getElementPath",value:function(t,e){var i=!0,r="";try{for(var a=0;t&&"container"!==t.id&&t!==document.documentElement&&t!==document.body;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;r+=i?this.elementToString(t,e)+" ":this.elementToString(t)+" ",i=!1,t=t.nodeType===Node.TEXT_NODE?t.parentNode:t.parentElement}}catch(n){r+=n.message}return r}},{key:"setDimension",value:function(t,e){window.ga&&!this.isDemoMode()&&ga("set",t,e)}},{key:"sendEvent",value:function(t,e,i){try{this.PAssert(18,void 0===i||this.isNumber(i),"Values must be numeric")}catch(r){this.reportError(r)}if(window.ga&&!this.isDemoMode())try{ga("send","event",t,e,this.getAnonUserIdentifier(),i)}catch(a){this.reportError(a,"Category: "+t+" Action: "+e+" Value: "+i)}}},{key:"sendToGoogle",value:function(t,e){var i="//www.googleadservices.com/pagead/conversion/976910954/?label="+t+"&guid=ON";e&&(i+="&value="+e+"&currency_code=USD"),new Image(1,1).src=i}},{key:"sendToFacebook",value:function(t,e){new Image(1,1).src="//www.facebook.com/tr?id=118704468840748&ev=PageView"}},{key:"reportAdConversion",value:function(t,e){try{this.sendToGoogle(t,e)}catch(i){this.reportError(i)}try{this.sendToFacebook(t,e)}catch(i){this.reportError(i)}}},{key:"pageDataCleared",value:function(){this.isPageDataCleared=!0}},{key:"hasPageDataBeenCleared",value:function(){return this.isPageDataCleared}},{key:"findFirstDiff",value:function(t,e,i,r){var a=0;if(!t)return r?0:e.length;if(!e)return r?t.length:0;for(var n=Math.min(t.length,e.length),o=0;o<n;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(i){if(t.charAt(o).toLowerCase()!==e.charAt(o).toLowerCase())return o}else if(t.charAt(o)!==e.charAt(o))return o}return r?t.length:e.length}},{key:"lerp",value:function(t,e,i){return t+(e-t)*i}},{key:"hashCode",value:function(t){var e,i=0,r=0;if(0===t.length)return r;for(e=0;e<t.length;e++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r=(r<<5)-r+t.charCodeAt(e),r|=0}return r}},{key:"sanitizePaneState",value:function(t){try{for(var e=0,i=JSON.parse(JSON.stringify(t)),r=0;r<i.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;""!==i[r].search&&(i[r].search="HasSearch")}return JSON.stringify(i)}catch(a){return"Failed to sanitize pane state"}}},{key:"sanitizeLocalSettings",value:function(t){try{var e=JSON.parse(t);return delete e.values.Default.paneState,delete e.values.Default.localPaneState,delete e.values.Default.gdocTitle,e}catch(i){return"Failed to parse settings"}}},{key:"sanitizeKey",value:function(t){switch(t){case m.a.KeyCode.Backspace:return"BACKSPACE";case m.a.KeyCode.Delete:return"DELETE";case m.a.KeyCode.Enter:return"ENTER";case m.a.KeyCode.Escape:return"ESCAPE";default:return"CHAR"}}},{key:"sanitizeURL",value:function(t){return t.replace(/&?access_token=[^&]*/g,"")}},{key:"getLoadedScripts",value:function(t){try{for(var e=0,i=document.getElementsByTagName("script"),r=[],a=0;a<i.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=i[a];n.src&&r.push(n.src)}t.loadedScripts=r}catch(o){t.loadedScripts="ERROR: "+o.message}}},{key:"getExtraReportData",value:function(t){t.platformConfig=L.a.getUserPlatformConfig()}},{key:"criticalErrorReported",value:function(){return this.hasCriticalError}},{key:"handleCriticalError",value:function(){var t=this;this.hasCriticalError=!0;try{if(this.isDemoMode())this.reload();else{var e=document.createElement("div");e.id="criticalError",e.textContent="There was a critical error while loading the app, "+L.a.actionVerb()+" to reload.",L.a.isTouchDevice?e.addEventListener(L.a.touchStartEvent,function(){t.reload()},!0):e.addEventListener(L.a.upEvent,function(){t.reload()},!0),this.prependChild(document.body,e);var i=document.getElementById("outerWrapper");try{this.PAssert(19,i,"DOM Element must exist to remove it")}catch(r){this.reportError(r)}i&&i.parentNode.removeChild(i)}}catch(a){this.reportError(a)}}},{key:"safeStringify",value:function(t){try{return JSON.stringify(t)}catch(e){0}}},{key:"reportEvent",value:function(t){if(!this.isDemoMode()){var e=this.parseExtra(t);e&&this.eventStream.push(e)}}},{key:"getEventStream",value:function(){return this.eventStream.ordered()}},{key:"parseExtra",value:function(t){var e;if(t)try{var i;if(t instanceof KeyboardEvent){var r=this.elementToString(t.target);["[INPUT#importPW]","[INPUT#importEmail]","[TEXTAREA#bugDescription.bugDescription editable]"].indexOf(r)<0&&(i={type:t.type,currentTarget:this.elementToString(t.currentTarget),target:r,keyCode:this.sanitizeKey(t.keyCode),normCode:this.sanitizeKey(t.normCode),ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,altKey:t.altKey,tstamp:Date.now()})}else if(t instanceof MouseEvent)i={type:t.type,currentTarget:this.elementToString(t.currentTarget),relatedTarget:this.elementToString(t.relatedTarget),target:this.elementToString(t.target),clientX:t.clientX,clientY:t.clientY,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,altKey:t.altKey,which:t.which,button:t.button,tstamp:Date.now()};else if(window.TouchEvent&&t instanceof TouchEvent){i={type:t.type,currentTarget:this.elementToString(t.currentTarget),relatedTarget:this.elementToString(t.relatedTarget),target:this.elementToString(t.target),tstamp:Date.now()};var a=t.touches[0];a&&(i.clientX=a.clientX,i.clientY=a.clientY)}else if(window.PointerEvent&&t instanceof PointerEvent)i={type:t.type,currentTarget:this.elementToString(t.currentTarget),relatedTarget:this.elementToString(t.relatedTarget),target:this.elementToString(t.target),clientX:t.clientX,clientY:t.clientY,tstamp:Date.now()};else if(t instanceof Event)i={type:t.type,name:t.name,code:t.code,message:t.message,currentTarget:this.elementToString(t.currentTarget),relatedTarget:this.elementToString(t.relatedTarget),target:this.elementToString(t.target),tstamp:Date.now()};else if(t instanceof Selection)if(0===t.rangeCount)i={rangeCount:0};else{var n=t.getRangeAt(0),o=n.startContainer,u=!1,s=n.endContainer,h=!1;o.nodeType===Node.TEXT_NODE&&(o=o.parentNode,u=!0),s.nodeType===Node.TEXT_NODE&&(s=s.parentNode,h=!0),i={rangeCount:t.rangeCount,startContainer:this.getElementPath(o),startWasTextNode:u,startOffset:n.startOffset,endContainer:this.getElementPath(s),endWasTextNode:h,endOffset:n.endOffset}}else i=t;e=i?this.safeStringify(i):void 0}catch(d){this.log("Error parsing extra "+d.message)}return e}},{key:"rollbarIgnoreFn",value:function(t,e,i){return!!(i&&i.body&&i.body.trace&&i.body.trace.frames&&i.body.trace.frames[0]&&j.indexOf(i.body.trace.frames[0].filename)>=0)}},{key:"handleJSError",value:function(t,e,i,r,a){if(!t||!t.startsWith("Firebase Storage: Max retry time"))if(!r&&window.__error&&window.__error("JS Error: "+t,"  Stack: ",e,"  Extra: ",i),t||e){a||(a=m.a.LogLevels.Error);try{var n=this.lastErrorsReported[e];if(!n||n<Date.now()-5e3){var o=this.__LOG_BUFFER.ordered().join("\r\n"),u=H&&H.settings?H.settings.getUserIdentifier():"Toolbox not loaded";this.isRollbarConfigured||("me"!==u&&(this.isRollbarConfigured=!0),Rollbar.configure({payload:{person:{id:u}},maxItems:m.a.__MAX_ERRORS_REPORTED,checkIgnore:this.rollbarIgnoreFn}));var s=this.parseExtra(i);if(this.numReported++,this.numReported<=m.a.__MAX_ERRORS_REPORTED){var h={};if(!this.isReporting){if(this.isReporting=!0,this.vmMain)try{this.vmMain.getAppInfo(h)}catch(v){Rollbar.error(v)}this.isReporting=!1}h.numReported=this.numReported;var d={url:this.sanitizeURL(window.location.href),logs:o,info:h,user:u,extra:s,jsVersion:m.a.__jsVersion,htmlVersion:document&&document.body?document.body.getAttribute("ver"):"UNKNOWN"};if(window.Rollbar){var c={message:t,stack:e};a===m.a.LogLevels.Error?(Rollbar.error(c,d),this.sendEvent("ErrorReport","Error")):a===m.a.LogLevels.Warning?(Rollbar.warning(c,d),this.sendEvent("ErrorReport","Warning")):(Rollbar.error(c,d),this.sendEvent("ErrorReport","Unknown"))}else d.msg=t,d.stack=e}}this.lastErrorsReported[e]=Date.now()}catch(y){this.log("Badness happened reporting errors to server: ",y);try{Rollbar.error({message:t,stack:e}),Rollbar.error(y)}catch(g){this.log("More badness happened reporting errors to rollbar: ",g)}}}else;}},{key:"onWindowError",value:function(t,e,i,r,a){a?(this.log("Reported Global OnError: "+t+" Script: "+e+" Line: "+i+" Column: "+r),this.reportError(a)):(this.log("Unreported Global OnError: "+t+" Script: "+e+" Line: "+i+" Column: "+r),this.reportError(t))}},{key:"reportError",value:function(t,e,i,r){!t||e||t.message||t.stack?t&&t.e&&this.isString(t.e)&&(t={message:t.e,stack:this.getCurrentStack("")}):(e=t,t=void 0),t||(t={message:"Undefined error passed to reporter",stack:this.getCurrentStack("")}),this.handleJSError((r||"")+t.message,t.stack,e,!1,i)}},{key:"checkpoint",value:function(t){window.__checkpoints|=t}},{key:"wrapFn",value:function(t,e){var i=this;return function(){try{return t.apply(this,arguments)}catch(r){r&&"auth/network-request-failed"===r.code||(i.reportError(r),e&&e(r))}}}},{key:"wrapAsyncCallbacks",value:function(){var t=this,e=function(e){var i=window[e];window[e]=function(){var e=Array.prototype.slice.call(arguments),r=e[0];return"function"===typeof r&&(e[0]=t.wrapFn(r)),i.apply?i.apply(this,e):i(e[0],e[1])}};e("setTimeout"),e("setInterval")}},{key:"setupLoggers",value:function(){var t=this,e=arguments;try{window.console.error=function(){try{var i=e[0],r=e[1];2===e.length&&t.isString(i)&&t.isString(r)?t.reportError({message:i,stack:r}):window.__error.apply(window,e)}catch(a){window.__error.apply(window,e),t.reportError(a)}}}catch(i){this.reportError(i),this.log("Unable to override console.error")}}},{key:"packedFnToString",value:function(t){for(var e=0,i="",r=0;r<t.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;i+=t[r]+"."}return i}},{key:"unpackFn",value:function(t,e){try{this.PAssert(20,this.isFunction(t)||this.isArray(t),"Must supply either a valid function or packed function")}catch(n){this.reportError(n)}var i=NaN;if(this.isFunction(t))i=t;else if(t)try{var r=0;i=e||window;for(var a=0;a<t.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;try{this.PAssert(21,this.isString(t[a]),"Packed fns must only contain strings: "+a)}catch(n){this.reportError(n)}try{this.PAssert(22,i,"Must be able to unpack each step in object chain: "+t[a]+" in "+this.packedFnToString(t))}catch(n){this.reportError(n)}if(!i){i=NaN;break}i=i[t[a]]}}catch(o){this.reportError(o),i=NaN}return i}},{key:"mergeObjects",value:function(t,e){var i,r=this;return Array.isArray(e)?(i=(i=[]).concat(t=t||[]),e.forEach(function(e,n){"undefined"===typeof i[n]?i[n]=e:"object"===a()(e)?i[n]=r.mergeObjects(t[n],e):-1===t.indexOf(e)&&i.push(e)})):(i={},t&&"object"===a()(t)&&Object.keys(t).forEach(function(e){i[e]=t[e]}),Object.keys(e).forEach(function(n){"object"===a()(e[n])&&e[n]&&t[n]?i[n]=r.mergeObjects(t[n],e[n]):i[n]=e[n]})),i}},{key:"clamp",value:function(t,e,i){return Math.max(e,Math.min(i,t))}},{key:"pad2",value:function(t){return 1===(t=""+t).length?"0"+t:""+t}},{key:"readyStateCallback",value:function(t,e,i){t.onloadDone=!1,t.onload=function(){t.onloadDone=!0,e&&e()},t.onreadystatechange=function(){"loaded"!==t.readyState||t.onloadDone||(t.onloadDone=!0,e&&e())},i&&(t.onerror=i)}},{key:"createPath",value:function(t){return window.location.protocol+"//"+window.location.host+"/"+t}},{key:"addScript",value:function(t,e,i,r){try{this.PAssert(23,!e||null===document.getElementById(e),"Should never include the same script ID multiple times")}catch(n){this.reportError(n)}var a=document.createElement("script");a.src=t,e&&(a.id=e),i&&this.readyStateCallback(a,i,r);try{this.PAssert(24,"undefined"!==typeof a,"Should always be able to create a valid script object")}catch(n){this.reportError(n)}"undefined"!==typeof a&&document.getElementsByTagName("head")[0].appendChild(a)}},{key:"addScriptHack",value:function(t,e,i,r){window.define||(window.define={}),this.addScript(t,e,function(){window.define.amd={jQuery:!0},i&&i()},function(){window.define.amd={jQuery:!0},r&&r()})}},{key:"addStylesheet",value:function(t,e,i){var r=document.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=t,e&&this.readyStateCallback(r,e,i),"undefined"!==typeof r&&document.getElementsByTagName("head")[0].appendChild(r)}},{key:"makeString",value:function(t){for(var e=0,i="",r=0;r<t.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;i+=" "+this.safeStringify(t[r])}return i}},{key:"DAssert",value:function(t,e){}},{key:"PAssert",value:function(t,e){var i=this;if(!e){var r={isAssert:!0,tag:t};try{var a=Array.prototype.slice.call(arguments,2),n=this.makeString(a.map(function(t){return i.isFunction(t)?t():t}));arguments.length>2?this.log("Assert Failure "+t+": "+n):this.log("Assert Failure "+t),this.reportError(new Error("Assert Failure: "+n),r,m.a.LogLevels.Warning)}catch(o){this.log("Exception in PAssert "+t+": ",o),this.reportError(o,r)}}}},{key:"getElementParent",value:function(t){var e=0;for(0;t;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(this.hasClass(t,"item")||this.hasClass(t,"paneHiddenInput"))return t;t=t.parentNode}}},{key:"isItemValidForPass",value:function(t,e){return!!t&&(e?t.lastFindPass===this.currentFindPass:t.lastFindPass<this.currentFindPass)}},{key:"markItemForPass",value:function(t,e){if(t){var i=this.isItemValidForPass(t,e);try{this.PAssert(26,i,"Item should always be valid")}catch(r){this.reportError(r)}return t.lastFindPass=this.currentFindPass,i}return!1}},{key:"getPreviousItem",value:function(t,e,i){return this.currentFindPass++,this._getPreviousItem(t,e,i)}},{key:"_getPreviousItem",value:function(t,e,i){var r;var a=i&&i.isTest,n=i&&i.ignoreSearch,o=i&&i.sameLevel,u=i&&i.includeNotes;if(this.markItemForPass(t,a)){var s=t.parent();if(s){if(t.isNote())return t.parent();var h=s.getChildIndex(t);if(h>0)for(var d=0;!r;){var c=0;if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;for(var v=!1,y=h-1;y>=0;y--){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var g=s.getChild(y);if(!this.markItemForPass(g,a)){try{this.PAssert(28,!1,"Invalid child found during findPreviousItem")}catch(l){this.reportError(l)}return}if(o||!g.hasChildren()||e&&g.isCollapsed(e,!1)){if(n||!e||!g.isHidden(e,!1)){r=g,v=!0;break}}else if(n||!e||!g.isHidden(e,!1)){s=g,h=g.numChildren(),v=!0;break}}if(o)break;v||(r=s)}else o||(r=t.parent());u&&r&&r.hasNote()&&(r=r.getNote());try{this.PAssert(29,!o||!r||r.parent()===t.parent(),"Previous item must share the same parent")}catch(l){this.reportError(l)}try{this.PAssert(30,a||!r||e&&r.isCollapsed(e,!1)||t===this._getNextItem(r,e,{isTest:!0,ignoreSearch:n,sameLevel:o}),"Previous/Next should always match")}catch(l){this.reportError(l)}return r}}}},{key:"getNextItem",value:function(t,e,i){return this.currentFindPass++,this._getNextItem(t,e,i)}},{key:"_getNextItem",value:function(t,e,i){var r,a=0;var n=i&&i.isTest,o=i&&i.ignoreSearch,u=i&&i.sameLevel,s=i&&i.includeNotes;if(t){if(s&&t.hasNote())return t.getNote();if(t.isNote()&&(t=t.parent()),!u&&t.hasChildren()&&(!e||!t.isCollapsed(e,!1)))for(var h=0,d=t.numChildren(),c=0;c<d;++c){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var v=t.getChild(c);if(!this.markItemForPass(v,n)){try{this.PAssert(32,!1,"Invalid child found during findNextItem A")}catch(f){this.reportError(f)}return}if(o||!e||!v.isHidden(e,!1)){r=v,i&&i.numLevels++;break}}for(var y=t;!r;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!this.markItemForPass(y,n)){try{this.PAssert(33,!1,"Invalid parent found during findNextItem B")}catch(f){this.reportError(f)}break}var g=y.parent();if(!g)break;var l=g.getChildIndex(y);d=g.numChildren();if(!e||!g.isCollapsed(e,!1))for(var p=0,m=l+1;m<d;++m){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;v=g.getChild(m);if(!this.markItemForPass(v,n)){try{this.PAssert(35,!1,"Invalid child found during findNextItem C")}catch(f){this.reportError(f)}return}if(o||!e||!v.isHidden(e,!1)){r=v;break}}if(y=g,i&&!r&&i.numLevels--,u||e&&y===e.getItem())break}try{this.PAssert(36,!u||!r||r.parent()===t.parent(),"Next item must share the same parent")}catch(f){this.reportError(f)}try{this.PAssert(37,n||!r||t===this._getPreviousItem(r,e,{isTest:!0,ignoreSearch:o,sameLevel:u}),"Previous/Next should always match")}catch(f){this.reportError(f)}return r}}},{key:"easeOut",value:function(t,e,i){return-i*t*(t-2)+e}},{key:"scrollTo",value:function(t,e,i,r,a){var n=this;try{this.PAssert(38,void 0!==t||void 0!==e,"Must be scrolling something")}catch(v){this.reportError(v)}try{this.PAssert(39,void 0===t||this.isNumber(t),"Must provide a valid scrollPosX")}catch(v){this.reportError(v)}try{this.PAssert(40,void 0===e||this.isNumber(e),"Must provide a valid scrollPosY")}catch(v){this.reportError(v)}try{this.PAssert(41,this.isNumber(i),"Must provide a valid duration")}catch(v){this.reportError(v)}try{this.PAssert(42,this.isDOMNode(r),"Must provide a valid element to scroll")}catch(v){this.reportError(v)}try{this.PAssert(43,!a||this.isFunction(a),"Must provide a valid scrollDone callback")}catch(v){this.reportError(v)}var o=r.getAttribute("data-moo-id")||r.id;try{this.PAssert(44,o,"Should only scroll elements with ids")}catch(v){this.reportError(v)}if(this.scrollTimeouts[o]&&(cancelAnimationFrame(this.scrollTimeouts[o]),delete this.scrollTimeouts[o]),r)if(i>0){if(void 0!==t)var u=r.scrollLeft,s=t-u;if(void 0!==e)var h=r.scrollTop,d=e-h;var c;if(Math.abs(s)>0||Math.abs(d)>0){0;this.scrollTimeouts[o]=requestAnimationFrame(function v(y){c||(c=y-20);var g=Math.min((y-c)/i,1);if(void 0!==t){var l=n.easeOut(g,u,s);r.scrollLeft=l}if(void 0!==e){var p=n.easeOut(g,h,d);r.scrollTop=p}1===g?(delete n.scrollTimeouts[o],a&&a()):n.scrollTimeouts[o]=requestAnimationFrame(v)})}}else r&&(void 0!==t&&(r.scrollLeft=t),void 0!==e&&(r.scrollTop=e)),a&&a();else this.reportError(new Error("Must specify an element to scroll to"))}},{key:"computeScrollSpeed",value:function(t,e,i,r,a){var n=(e-t-(e-(i=this.clamp(i,t,e))))/(e-t);return a<0&&(n-=1),n*r}},{key:"performScroll",value:function(){if(this.scrollState.pane||this.scrollState.panes){var t;if(this.scrollState.pane){var e=6*this.scrollState.speedPane;t=this.scrollState.pane.addScrollDelta(e)}else{var i=6*this.scrollState.speedPanes,r=this.element("panes"),a=r.scrollLeft;r.scrollLeft+=i,t=a!==r.scrollLeft}t?requestAnimationFrame(this.performScroll):this.cancelRepeatScroll(this.scrollState.pane?"pane":"panes")}}},{key:"repeatScroll",value:function(t,e,i,r){try{this.PAssert(45,r||i&&!this.isString(i),"Must pass a valid pane object to repeatScroll")}catch(a){this.reportError(a)}this.scrollState["speed"+(i?"Pane":"Panes")]=e,(this.scrollState.pane||this.scrollState.panes)&&i===this.scrollState.pane||(this.scrollState.pane=i,this.scrollState.panes=r,requestAnimationFrame(this.performScroll))}},{key:"cancelRepeatScrolls",value:function(){this.scrollState.pane=void 0,this.scrollState.panes=void 0}},{key:"cancelRepeatScroll",value:function(t){this.scrollState[t]=void 0}},{key:"elementInPane",value:function(t){if(t){var e=0;for(t.nodeType===Node.TEXT_NODE&&(t=t.parentNode);t;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(this.hasClass(t,"pane")||this.hasClass(t,"paneOverview"))return!!t;t=t.parentElement}}return!1}},{key:"elementInPaneEdit",value:function(t){var e=!1,i=this.getPaneForElement(t);return i&&this.isAncestor(t,i.getContentElement())&&(e=!0),e}},{key:"elementInNonPaneEdit",value:function(t){var e=!1;if(t&&(t.nodeType===Node.TEXT_NODE&&(t=t.parentNode),!this.elementInPaneEdit(t)))for(var i=0;t;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(this.isKeyboardInputElement(t)){e=!0;break}t=t.parentElement}return e}},{key:"isNonPaneDropTarget",value:function(t){var e=!1;return this.elementInNonPaneEdit(t)?e=!0:this.findParent(t,"validDropTarget")&&(e=!0),e}},{key:"scrollIntoView",value:function(t,e,i){try{this.PAssert(46,this.isDOMNode(t),"Must supply a valid DOM node to scroll into view")}catch(v){this.reportError(v)}try{this.PAssert(47,this.isNumber(e)&&e>=0,"Must supply a valid scroll duration")}catch(v){this.reportError(v)}try{this.PAssert(48,!i||this.isFunction(i),"Callback must be a function")}catch(v){this.reportError(v)}try{this.PAssert(49,!this.getListCellForElement(t),"Use methods on VMPane to scroll VMLIs")}catch(v){this.reportError(v)}var r=!1;if(t){var a=this.findParent(t,"scroller")||this.findParent(t,"fancyScrollContent")||L.a.isMobile&&this.findParent(t,"fancyScroller");try{this.PAssert(50,a,"Every element must be a child of a scroller to be able to scroll it into view")}catch(v){this.reportError(v)}try{this.PAssert(51,!this.hasClass(a,"customScroller"),"Must not be scrolling this way, use methods on VMPane instead")}catch(v){this.reportError(v)}if(a){var n,o=a.getBoundingClientRect(),u=o.bottom,s=t.getBoundingClientRect(),h=Math.min(s.bottom,s.top+80),d=a.scrollTop;if(L.a.isMobile){var c=L.a.orientation===m.a.Orientation.Landscape?this.topBarHeight:120;u=Math.max(o.top+c,u-400)}s.top<o.top?n=d+s.top-o.top:h>u&&s.top>o.top&&(n=d+h-u),void 0!==n&&(this.scrollTo(void 0,n,e,a,i),r=!0)}}return r}},{key:"isKeyboardInputElement",value:function(t){if(t){if("checkbox"===t.type)return!1;if("INPUT"===t.nodeName||"textarea"===t.type||this.findParentAttr(t,"contenteditable","true"))return!0}return!1}},{key:"openKeyboardOnIndex",value:function(t,e,i,r,a){var n=this;this.batchRenderUpdates(function(){n._openKeyboardOnIndex(t,e,i,r,a)})}},{key:"_openKeyboardOnIndex",value:function(t,e,i,r,a){var n=this;try{this.PAssert(52,L.a.isMobile,"Should only be opening keyboard on mobile devices")}catch(h){this.reportError(h)}var o=e.getScrollOffset(),u=!1;if(this.keyboardToolbar.preShow(),!this.isKeyboardOpen){var s=function(){r&&r(),L.a.iosui&&n.keyboardToolbar.show(m.a.KeyboardToolbarMode.Item),n.enforceScroll()};e.addPadding(),L.a.app||L.a.android||L.a.mobileie?u=e.scrollIndexIntoView(i,L.a.keyboardOpenTime,s):(u=e.scrollIndexIntoView(i,L.a.keyboardOpenTime),s()),this.keyboardToolbar.hideTopBarIfLandscape()}return u&&L.a.app&&!L.a.android&&!L.a.ioswk||(r&&r(),this.keyboardToolbar.show(m.a.KeyboardToolbarMode.Item)),this.keyboardOpenedOn=e,this.keyboardBlurFn=a,this.keyboardStartScrollOffset=o,this.keyboardDestination=q.Item,L.a.ios&&this.preventClick(),t&&(this.preventAndStop(t),t.returnFalse=!0),this.enforceScroll(),u}},{key:"addScrollPadding",value:function(t){if(t){var e=this.getItemForElement(t);e&&e.addPadding&&e.addPadding()}}},{key:"openKeyboardOnElement",value:function(t,e,i,r){var a,n,o=this;try{this.PAssert(53,L.a.isMobile,"Should only be opening keyboard on mobile devices")}catch(h){this.reportError(h)}try{this.PAssert(54,this.isDOMNode(e),"Must supply a valid element")}catch(h){this.reportError(h)}if(e){a=this.findParent(e,"scroller");try{this.PAssert(55,!this.hasClass(e,"paneScroller"),"Must never scroll a custom scroller this way")}catch(h){this.reportError(h)}n=a?a.scrollTop:0}var u=!1;if(this.keyboardToolbar.preShow(),!this.isKeyboardOpen){var s=function(){o.keyboardToolbar.show(m.a.KeyboardToolbarMode.Modal),i&&i(),o.enforceScroll()};this.addScrollPadding(a),L.a.app&&!L.a.ioswk||L.a.android||L.a.mobileie?u=this.scrollIntoView(e,L.a.keyboardOpenTime,s):(u=this.scrollIntoView(e,L.a.keyboardOpenTime),s()),this.keyboardToolbar.hideTopBarIfLandscape()}return u&&L.a.app&&!L.a.android||(i&&i(),this.keyboardToolbar.show(m.a.KeyboardToolbarMode.Modal)),this.keyboardOpenedOn=a,this.keyboardBlurFn=r,this.keyboardStartScrollOffset=n,this.keyboardDestination=q.Element,L.a.ios&&this.preventClick(),t.stopImmediatePropagation(),t.returnFalse=!0,this.enforceScroll(),u}},{key:"onCloseKeyboardItem",value:function(){this.shouldLog(m.a.LogLevels.Selection)&&this.log("OnClose Keyboard"),this.isKeyboardOpen&&(this.keyboardOpenedOn.addPadding(),this.keyboardOpenedOn.setScrollOffset(this.keyboardStartScrollOffset,L.a.keyboardOpenTime),this.isKeyboardOpen=!1,this.keyboardBlurFn&&this.keyboardBlurFn())}},{key:"onCloseKeyboardElement",value:function(){if(this.shouldLog(m.a.LogLevels.Selection)&&this.log("OnClose Keyboard"),this.isKeyboardOpen){try{this.PAssert(56,this.keyboardOpenedOn,"Must have a valid scroller")}catch(t){this.reportError(t)}this.scrollTo(void 0,this.keyboardStartScrollOffset,L.a.keyboardOpenTime,this.keyboardOpenedOn),this.isKeyboardOpen=!1,this.keyboardBlurFn&&this.keyboardBlurFn()}}},{key:"onCloseKeyboard",value:function(){this.keyboardDestination===q.Item?this.onCloseKeyboardItem():this.keyboardDestination===q.Element&&this.onCloseKeyboardElement()}},{key:"blurActiveElement",value:function(t){var e=this;this.ignoreSelectionChange=!!t,this.shouldLog(m.a.LogLevels.Selection)&&this.log("Blur Active Element"),document.activeElement&&document.activeElement.blur&&document.activeElement.blur(),setTimeout(function(){e.ignoreSelectionChange=!1},100)}},{key:"trimString",value:function(t){for(var e=0,i=/\s/,r=(t=t.replace(/^\s\s*/,"")).length;i.test(t.charAt(--r));)if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;return t.slice(0,r+1)}},{key:"enforceScroll",value:function(t,e){(t||(L.a.ios||L.a.android)&&(!L.a.app||L.a.ios71))&&(setTimeout(function(){window.scrollTo(0,e||0)},0),requestAnimationFrame(function(){window.scrollTo(0,e||0)}),window.scrollTo(0,e||0),document.body.scrollTop=0)}},{key:"preventAndStop",value:function(t){this.preventDefault(t),this.stopPropagation(t)}},{key:"preventDefault",value:function(t){if(t&&t.preventDefault)t.preventDefault();else try{this.PAssert(57,!1,"Invalid event object: "+t)}catch(e){this.reportError(e)}}},{key:"stopPropagation",value:function(t){if(t&&t.stopPropagation)t.stopPropagation();else try{this.PAssert(58,!1,"Invalid event object: "+t)}catch(e){this.reportError(e)}}},{key:"preventClick",value:function(){var t=this;this.addClass(this.element("outerWrapper"),"noClick"),window.ontouchstart=this.preventDefault,requestAnimationFrame(function(){window.ontouchstart=void 0,t.removeClass(t.element("outerWrapper"),"noClick")})}},{key:"searchVMLIArray",value:function(t,e,i){for(var r=0,a=0;a<e.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=e[a];if(!t.headers||n.showInOverview(t.includeArchived)){if(!t.comparator||t.comparator(n,t))if(t.each)if(!1===t.each(n,t))return!1;this.searchFromVMLI(n,t,i+1)}}}},{key:"searchFromVMLI",value:function(t,e,i){i=i||0;var r,a=e.noCollapsed,n=e.pane,o=e.overview;e.includeNotes&&!e.headers&&t.hasNote()&&(e.comparator&&!e.comparator(t.getNote(),e)||e.each&&(r=e.each(t.getNote(),e))),!1===r||a&&0!==i&&t.isCollapsed(n,o)||(r=this.searchVMLIArray(e,t.items.get(),i))}},{key:"searchVMLIs",value:function(t){var e=this;try{this.PAssert(59,t,"Must supply a valid options param")}catch(i){this.reportError(i)}try{if(t.itemStoreFilter)H.itemStoreManager.runForEachStore(function(i){var r=t.item,a=r&&r.belongsToItemStore(i)?r:i.getRoot();e.searchFromVMLI(a,t)},t.itemStoreFilter);else if(t.item){try{this.PAssert(60,!t.itemStore&&!t.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(i){this.reportError(i)}this.searchFromVMLI(t.item,t)}else if(t.itemStore){try{this.PAssert(61,!t.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(i){this.reportError(i)}this.searchFromVMLI(t.itemStore.getRoot(),t)}else{try{this.PAssert(62,!1,"Must specify a valid search root, using the default root is deprecated")}catch(i){this.reportError(i)}H.itemStoreManager.getDefaultItemStore().getRoot()}}catch(r){this.reportError(r)}}},{key:"getActiveSearch",value:function(){return this.focusedPane.search}},{key:"loadXML",value:function(t){try{var e=window;if("undefined"!==typeof e.DOMParser)return(new e.DOMParser).parseFromString(t,"text/xml");if("undefined"!==typeof e.ActiveXObject&&new e.ActiveXObject("Microsoft.XMLDOM")){var i=new e.ActiveXObject("Microsoft.XMLDOM");return i.async="false",i.loadXML(t),i}try{this.PAssert(63,!1,"No XML parser found")}catch(r){this.reportError(r)}return}catch(a){return void this.reportError(a)}}},{key:"getPluginForElement",value:function(t){return this.findParent(t,"plugin",4)}},{key:"findParentInItem",value:function(t,e){for(var i=0;t&&!this.hasClass(t,"item");){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(this.hasClass(t,e))return t;t=t.parentNode}}},{key:"findParent",value:function(t,e,i){try{this.PAssert(64,t,"Must pass in a valid element")}catch(o){this.reportError(o)}if(i||(i=1e3),t)for(var r=0,a=t,n=0;n<i&&a;++n,a=a.parentNode){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(this.hasClass(a,e))return a}}},{key:"findParentID",value:function(t,e,i){try{this.PAssert(66,t,"Must pass in a valid element")}catch(o){this.reportError(o)}if(i||(i=1e4),t)for(var r=0,a=t,n=0;n<i&&a;++n,a=a.parentNode){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(a.id===e)return a}}},{key:"findParentAttr",value:function(t,e,i){try{this.PAssert(67,t,"Must pass in a valid element")}catch(n){this.reportError(n)}if(t)for(var r=0,a=t;a&&a.getAttribute;a=a.parentNode){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(a.getAttribute(e)===i)return a}}},{key:"isAncestor",value:function(t,e){var i=0;try{this.PAssert(68,t,"Must have a valid element")}catch(r){this.reportError(r)}try{this.PAssert(69,e,"Must have a valid candidate")}catch(r){this.reportError(r)}for(;t&&t!==e;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t=t.parentNode}return!!t}},{key:"prependChild",value:function(t,e){try{this.PAssert(70,t,"Must pass in a valid element")}catch(i){this.reportError(i)}try{this.PAssert(71,e,"Must pass in a valid element")}catch(i){this.reportError(i)}t.insertBefore(e,t.firstChild)}},{key:"getAncestorChain",value:function(t){var e=0;for(var i=t;i;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;i.push(i),i=i.parentNode}return[]}},{key:"isAttachedToDoc",value:function(t){try{this.PAssert(73,t,"Must supply a valid element to check")}catch(e){this.reportError(e)}try{this.PAssert(74,t.ownerDocument,"Checked element must have a valid owner document")}catch(e){this.reportError(e)}return!!t.ownerDocument&&(t.ownerDocument.body.contains(t)||t.ownerDocument.documentElement===t)}},{key:"offset",value:function(t){try{this.PAssert(75,t,"Must pass in a valid element")}catch(n){this.reportError(n)}var e=t.getBoundingClientRect(),i=t.ownerDocument,r=t.ownerDocument.documentElement,a=i.defaultView;return{top:e.top+a.pageYOffset-r.clientTop,left:e.left+a.pageXOffset-r.clientLeft}}},{key:"position",value:function(t){var e=t.offsetParent,i=t.getBoundingClientRect(),r=e.getBoundingClientRect();return{left:i.left-r.left,top:i.top-r.top}}},{key:"height",value:function(t){try{this.PAssert(77,t,"Must pass in a valid element")}catch(r){this.reportError(r)}var e=t.offsetHeight,i=window.getComputedStyle(t);return i?("border-box"!==i.boxSizing&&(e-=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom)),e-=parseFloat(i.borderTopWidth)+parseFloat(i.borderBottomWidth)):this.shouldLog(m.a.LogLevels.Error)&&this.log("GetComputedStyle failed in globals::height"),e}},{key:"width",value:function(t){try{this.PAssert(79,t,"Must pass in a valid element")}catch(r){this.reportError(r)}var e=t.offsetWidth,i=window.getComputedStyle(t);return i?("border-box"!==i.boxSizing&&(e-=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight)),e-=parseFloat(i.borderLeftWidth)+parseFloat(i.borderRightWidth)):this.shouldLog(m.a.LogLevels.Error)&&this.log("GetComputedStyle failed in globals::width"),e}},{key:"generateQueryString",value:function(t){var e="";if("object"===a()(t)){e=Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&").replace(/%20/g,"+")}else{try{this.PAssert(81,"string"===typeof t,"Only Objects or Strings are currently supported")}catch(i){this.reportError(i)}e=t}return e}},{key:"ensureStatsXHR",value:function(t){var e=this.sanitizeURL(t).split("?")[0];return this.__xhrRequests[e]||(this.__xhrRequests[e]={requests:0,successes:0,retries:0,failures:0}),this.__xhrRequests[e]}},{key:"notifyStatsXHRRequest",value:function(t){this.ensureStatsXHR(t).requests++}},{key:"notifyStatsXHRSuccess",value:function(t){this.ensureStatsXHR(t).successes++}},{key:"notifyStatsXHRRetry",value:function(t){this.ensureStatsXHR(t).retries++}},{key:"notifyStatsXHRFailure",value:function(t){this.ensureStatsXHR(t).failures++}},{key:"getXHRStats",value:function(){return this.__xhrRequests}},{key:"XHR",value:function(t){var e=this;try{this.PAssert(82,t.url,"Must specify a valid URL to use")}catch(p){this.reportError(p)}try{this.PAssert(83,t.type,"Must specify a valid request type")}catch(p){this.reportError(p)}var i=this,r=t.url,a=t.type,n=t.cb,o=t.data,u=t.headers,s=t.autoRetry,h=t.timeout,d=Math.min(t.maxRetries||2,6),c=0,v=t.username,y=t.password;this.notifyStatsXHRRequest(r);var g=function(){try{i.PAssert(84,c<d,"Should not be calling retry once retries have been exhausted")}catch(p){i.reportError(p)}c<d?(c++,e.notifyStatsXHRRetry(r),setTimeout(l,1e3*Y[c])):(e.notifyStatsXHRFailure(r),e.reportError(new Error("XHR Failed: "+r)))},l=function(){var t,i=new XMLHttpRequest;(i.timeout=h,i.onreadystatechange=function(){4===i.readyState&&(200!==i.status?c<d?(i.retry=g,s&&X.indexOf(i.status)>=0?i.retry():n(i)):(e.notifyStatsXHRFailure(r),n(i)):(e.notifyStatsXHRSuccess(r),n(i)))},v&&y?i.open(a.toUpperCase(),r,!0,v,y):i.open(a.toUpperCase(),r,!0),u&&Object.keys(u).forEach(function(t){return i.setRequestHeader(t,u[t])}),o)?(i.setRequestHeader("Accept","*/*"),u&&u["Content-Type"]||i.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),t=o instanceof Blob?o:e.generateQueryString(o),i.send(t)):i.send()};l()}},{key:"XHR_PrivateAPI",value:function(t){}},{key:"wrapXHR",value:function(){try{var t=window,e=t.XMLHttpRequest.prototype.open,i=t.XMLHttpRequest.prototype.send,r=this;t.XMLHttpRequest.prototype.open=function(t,i,a,n,o){this.url=i,void 0===a&&(a=!0);try{e.call(this,t,i,a,n,o)}catch(u){throw r.reportError(u),u}},t.XMLHttpRequest.prototype.send=function(t){this.timeout||(this.timeout=r.seconds(70));try{this.url&&!this.url.startsWith("https://nikkomsgchannel")&&i.call(this,t)}catch(e){throw r.reportError(e),e}}}catch(a){this.reportError(a)}}},{key:"element",value:function(t,e){try{this.PAssert(85,t,"Tried to get an element without an id")}catch(i){this.reportError(i)}this.elements[t]&&!e||(this.elements[t]=document.getElementById(t));try{this.PAssert(86,this.elements[t],"Tried to get an element that doesn't exist",t)}catch(i){this.reportError(i)}return this.elements[t]}},{key:"openUrl",value:function(t,e,i){var r=this;try{this.PAssert(87,t,"Must always provide a valid URL to open")}catch(s){this.reportError(s)}if(!t)return!1;var a=this.parseEvernoteLink(t);if(a){H&&H.settings.getUserIdentifier();var n=!!H&&H.settings.openEvernoteApp.get();if(void 0===n)return void H.menus.confirm("Open Evernote links in Evernote app?",function(a){H&&H.settings.openEvernoteApp.set(a),r.openUrl(t,e,i)});n&&(a.viewUrl?t=a.viewUrl:(t="evernote:///view/"+a.userId+"/"+a.shardId+"/"+a.noteGuid+"/"+a.noteGuid+"/",console.log(t)))}if(L.a.standalone){var o=document.createElement("a");o.setAttribute("href",t),o.setAttribute("target","_blank"),o.setAttribute("rel","noopener noreferrer");var u=document.createEvent("HTMLEvents");u.initEvent("click",!0,!0),o.dispatchEvent(u)}else if(L.a.app){L.a.ios&&L.a.appv>=5||L.a.android&&L.a.appv>=5||L.a.isChrome||!t.startsWith("http://")&&!t.startsWith("https://")?t.startsWith("/")&&(t=window.location.host+t):t=t.replace("http://","").replace("https://",""),t.startsWith("callto:")&&(t=t.replace("callto:","tel:")),L.a.ios&&t.startsWith("tel:")?(t.indexOf("://")<0&&(t=t.replace("tel:","tel://")),H.nativeBridge.sendToApp("openURL",t)):L.a.ios&&t.startsWith("mailto:")?open(t):H.nativeBridge.sendToApp("openURL",t),e&&(this.preventAndStop(e),e.returnFalse=!0)}else(i=i||t.startsWith("evernote:///")||t.startsWith("onenote:")||t.startsWith("bear:"))?open(t,"_this"):open(t,"_blank");return!0}},{key:"getLocationOrigin",value:function(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")}},{key:"isSpellcheckEnabled",value:function(){return!1}},{key:"fFalse",value:function(){return!1}},{key:"fTrue",value:function(){return!0}},{key:"round",value:function(t,e){return e=e||2,Number(Math.round(t+"e"+e)+"e-"+e)}},{key:"toFileSize",value:function(t){if(t){var e=Math.log(t)/Math.log(1024)|0;return(t/Math.pow(1024,e)).toFixed(2)+" "+(0===e?"bytes":"KMGTPEZY"[e-1]+"B")}return null}},{key:"saveFile",value:function(t,e){var i=new Blob([t],{type:"text/plain;charset=utf-8"});Object(T.saveAs)(i,e)}},{key:"downloadFile",value:function(t,e){if(L.a.supportsNativeDownload()){try{this.PAssert(89,!this.downloadToasts[t],"Should not double create a download for the same file")}catch(a){this.reportError(a)}this.downloadToasts[t]=H.toasts.pushMessage({text:"Downloading "+e+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0%",hold:!0,actionText:""}),H.nativeBridge.sendToApp("downloadURL",{url:t,name:e})}else if(document.createEvent){var i=document.createElement("a");i.href=t;var r=document.createEvent("MouseEvents");r.initEvent("click",!0,!0),i.dispatchEvent(r)}else window.open(t,"_this")}},{key:"handleNativeDownloadProgress",value:function(t){var e=t.url,i=t.name,r=t.progress,a=this.downloadToasts[e];if(a)if(1===r)a.hide(),delete this.downloadToasts[e];else{var n=isNaN(r)?"...":Math.round(100*r)+"%";a.setText("Downloading "+i+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"+n)}}},{key:"printPage",value:function(t){L.a.app||window.open(t).print()}},{key:"reactNodeForElement",value:function(t){var e=t;if(e.nodeType===Node.TEXT_NODE&&(e=e.parentNode),e=this.getParentWithMooKey(e))for(var i in e)if(i.startsWith("__reactInternalInstance$")){var r=e[i],a=r&&r.return&&r.return.stateNode;if(a&&a.props)return a}}},{key:"getParentWithMooKey",value:function(t){for(var e=0;t&&t!==document;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(t.getAttribute("data-moo-id"))return t;t=t.parentNode}}},{key:"getItemForElement",value:function(t){var e=this.reactNodeForElement(t),i=e&&e.getPaneObject&&e.getPaneObject(),r=i&&(this.isVMLI(i)?i:i.item);try{this.PAssert(90,!r||this.isVMLI(r),"Must always find a valid VMLI for a given element: "+this.elementToString(t))}catch(a){this.reportError(a)}if(r)return r}},{key:"getIndexForElement",value:function(t){var e=-1,i=this.findParent(t,"item");if(i){var r=this.reactNodeForElement(i);r&&(e=r.getIndex())}return e}},{key:"getPaneForElement",value:function(t){var e=this.findParent(t,"pane")||this.findParent(t,"paneOverviewScroller");if(e){var i=this.reactNodeForElement(e);return i&&i.getPane&&i.getPane()}if(this.findParent(t,"mobileUIBottom"))return this.focusedPane}},{key:"getPaneObjectForElement",value:function(t){var e=this.reactNodeForElement(t);if(e&&e.getPaneObject)return e.getPaneObject()}},{key:"getCellForElement",value:function(t){var e=this.reactNodeForElement(t);if(e&&e.getCell)return e.getCell()}},{key:"getListCellForElement",value:function(t){var e=this.reactNodeForElement(t);if(e&&e.getCell)return e}},{key:"encodeMIMEHeader",value:function(t){return"=?UTF-8?B?"+window.btoa(unescape(encodeURIComponent(t)))+"?="}},{key:"utf8_to_b64",value:function(t){var e;try{e=window.btoa(unescape(encodeURIComponent(t))).replace(/\+/g,"-").replace(/\//g,"_")}catch(i){this.reportError(i,t)}return e}},{key:"b64_to_utf8",value:function(t){var e;try{e=decodeURIComponent(escape(window.atob(t.replace(/-/g,"+").replace(/_/g,"/"))))}catch(i){this.reportError(i,t)}return e}},{key:"qp_to_utf8",value:function(t){var e;try{e=t.replace(/[\t\x20]$/gm,"").replace(/=(?:\r\n?|\n|$)/g,"").replace(/=([a-fA-F0-9]{2})/g,function(t,e){var i=parseInt(e,16);return String.fromCharCode(i)})}catch(i){this.reportError(i,t)}return e}},{key:"isHTTPStatusCode",value:function(t,e){return t&&t.error&&t.error.code===e}},{key:"hasGoogleError",value:function(t,e,i){try{this.PAssert(92,t,"Must specify a valid result object")}catch(s){this.reportError(s)}try{this.PAssert(93,e,"Must specify a valid error domain")}catch(s){this.reportError(s)}try{this.PAssert(94,i,"Must specify a valid error reason")}catch(s){this.reportError(s)}var r=!1;if(t&&t.error&&t.errors)for(var a=0,n=t.error.errors,o=0;o<n.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var u=n[o];if(u.domain===e&&u.reason===i){r=!0;break}}return r}},{key:"hasTimeoutOnce",value:function(t){return!!this.timeouts[t]}},{key:"timeoutOnce",value:function(t,e,i,r,a,n,o,u){var s=this;try{this.PAssert(95,t,"Must supply a valid name")}catch(d){this.reportError(d)}try{this.PAssert(96,this.isFunction(e),"must supply a valid cb fn")}catch(d){this.reportError(d)}try{this.PAssert(97,arguments.length<=8,"Too many args passed in")}catch(d){this.reportError(d)}var h=this.timeouts[t];h&&clearTimeout(h),this.timeouts[t]=setTimeout(function(){delete s.timeouts[t],e(r,a,n,o,u)},i)}},{key:"clearTimeoutOnce",value:function(t){var e=this.timeouts[t];e&&(clearTimeout(e),delete this.timeouts[t])}},{key:"animFrameOnce",value:function(t,e){var i=this.timeouts[t];i&&cancelAnimationFrame(i),this.timeouts[t]=requestAnimationFrame(e)}},{key:"elementFromPoint",value:function(t,e){return document.elementFromPoint(t,e)}},{key:"parentTextForItem",value:function(t){for(var e=0,i=t.parents(),r="",a=1;a<i.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a>1&&(r+="  |  "),r+=i[a].generateTitleText()}return r}},{key:"batchRenderUpdates",value:function(t,e,i,r,a,n){return G.a.unstable_batchedUpdates(t,e,i,r,a,n)}},{key:"hexToRgb",value:function(t){return{r:parseInt(t.substr(1,2),16),g:parseInt(t.substr(3,2),16),b:parseInt(t.substr(5,2),16)}}},{key:"hexToRgbStr",value:function(t){return parseInt(t.substr(1,2),16)+","+parseInt(t.substr(3,2),16)+","+parseInt(t.substr(5,2),16)}},{key:"rgbToHex",value:function(t,e,i){return[this.pad2(Math.round(t).toString(16)),this.pad2(Math.round(e).toString(16)),this.pad2(Math.round(i).toString(16))].join("")}},{key:"parseEvernoteLink",value:function(t){return t.startsWith("evernote:///view/")?{viewUrl:t}:(Q.lastIndex=0,null!==(e=Q.exec(t))?{shardId:e[1],userId:e[2],noteGuid:e[3]}:void 0);var e}},{key:"isOneNoteLink",value:function(t){return t.startsWith("onenote:https://")}},{key:"isBearLink",value:function(t){return t.startsWith("bear://x-callback-url/")}},{key:"infLoop",value:function(t){if(!this.timeLastLoop||t<this.numLastLoop)this.timeLastLoop=Date.now();else if(t>this.numLastLoop&&t>3e4&&t%200===0&&Date.now()-this.timeLastLoop>1e4){0;try{this.PAssert(98,!1,"Infinite loop!",t)}catch(e){this.reportError(e)}return H.toasts&&H.toasts.pushMessage(m.a.MessageID.ReactError),!0}this.numLastLoop=t}}]),e}(M),p()(N.prototype,"parseBoolean",[I.a],Object.getOwnPropertyDescriptor(N.prototype,"parseBoolean"),N.prototype),p()(N.prototype,"parseDate",[I.a],Object.getOwnPropertyDescriptor(N.prototype,"parseDate"),N.prototype),p()(N.prototype,"onWindowError",[I.a],Object.getOwnPropertyDescriptor(N.prototype,"onWindowError"),N.prototype),p()(N.prototype,"performScroll",[I.a],Object.getOwnPropertyDescriptor(N.prototype,"performScroll"),N.prototype),p()(N.prototype,"infLoop",[I.a],Object.getOwnPropertyDescriptor(N.prototype,"infLoop"),N.prototype),N),Z=e.default=new J},function(t,e,i){"use strict";var r,a=i(38),n=i.n(a);Date.Config={__DEV__:!0,DisableCache:!0},Error.stackTraceLimit=1/0;var o={Backspace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,LeftArrow:37,UpArrow:38,RightArrow:39,DownArrow:40,Delete:46,D0:48,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D7:55,D8:56,D9:57,Colon:58,LAngle:60,RAngle:62,At:64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,NumPlus:107,Minus:109,F1:112,F4:115,F12:123,Equals:187,Plus:187,Comma:188,Dash:189,Period:190,Slash:191,Tilde:192,LBracket:219,RBracket:221,Apos:222},u={None:0,Note:32,Archived:128,Complete:4096,P2:8192,P1:16384,P0:32768,Starred:65536,HasPageToken:131072,DisplayComplete:262144},s={Calendar:"https://www.googleapis.com/auth/calendar",CalendarRO:"https://www.googleapis.com/auth/calendar.readonly",Contacts:"https://www.googleapis.com/auth/contacts.readonly",Drive:"https://www.googleapis.com/auth/drive.file",DriveMetadataRO:"https://www.googleapis.com/auth/drive.metadata.readonly",DriveFull:"https://www.googleapis.com/auth/drive",DriveReadOnly:"https://www.googleapis.com/auth/drive.readonly",GmailCompose:"https://www.googleapis.com/auth/gmail.compose",GmailModify:"https://www.googleapis.com/auth/gmail.modify",TasksRO:"https://www.googleapis.com/auth/tasks.readonly",UserInfoEmail:"https://www.googleapis.com/auth/userinfo.email",UserInfoProfile:"https://www.googleapis.com/auth/userinfo.profile",DriveAppData:"https://www.googleapis.com/auth/drive.appdata",Plus:"https://www.googleapis.com/auth/plus.me",DriveInstall:"https://www.googleapis.com/auth/drive.install",Email:"email",Profile:"Profile"},h={APIKey:"AIzaSyCgYrT1vXClB5Y9lRl0iOTtM4W4aBvLn50",ClientID:"597847337936-ridipp5ac5bulesmmjici7rtjces027t.apps.googleusercontent.com",CloudFunctionsURL:"https://api-project-597847337936.firebaseapp.com/api/v1/",EmailOpenTime:250,ItemTransitionTime:150,DoubleClickTime:500,EmailPreviewSizeMin:600,EmailPreviewSizeMaxFlex:800,EmailPreviewSizeMax:1200,PremiumMaxBoards:5,PremiumMaxPanes:3,ExpandedPaneWidth:400,HelpWidth:360,StdPaneWidthMin:400,StdPaneWidthMax:900,PaneWidthMax:1400,EmailOpenTimeMobile:150,OverviewWidth:260,OverviewItemHeightDesktop:26,OverviewItemHeightMobile:36,EmailItemHeight:80,RightMenuWidth:100,TrialDuration:14,PaneSpaceSize:0,MSPerMinute:6e4,MSPerHour:36e5,MSPerDay:864e5,DefaultEventDuration:36e5,MaxBatchSize:45,TooltipDelay:400,MobileBottomHeight:50,HorizScrollbarHeight:18,DesktopToolbarHeight:32,PaneHeaderButtonWidth:32,PaneHeaderButtonHeight:36,PaneHeaderRow2ButtonHeight:30,PaneHeaderRow2Height:36,MobileHeaderRow2Height:36,CalendarResizeHandleHeight:8,DesktopMenuWidthDefault:120,DesktopMenuWidthMax:240,DesktopMenuWidthMinBig:66,DesktopMenuWidthSmall:36,RootItemName:"Home",MinEmailScale:.25,SidebarDragHandleSize:16,SearchHeight:22,PaneAddItemBoxHeight:36,DateFormat:{DMY:"dmy",DMYDot:"dmydot",MDY:"mdy",YMD:"ymd",YMDDot:"ymddot"},SettingsSections:{General:"General",Dates:"Dates",Plugins:"Enable Plugins",Account:"Moo.do Account",EarlyAccess:"Send Feedback",Linked:"Email Accounts",Invite:"Invite Friends",GoogleCalendar:"Google Calendar",Contacts:"Contacts",Gmail:"Gmail",Agenda:"Agenda",Backups:"Backups",Security:"Security",Debug:"Debug"},ItemAnimationMode:{None:0,Normal:1,Move:2,Search:3},MatchState:{Unknown:void 0,No:0,Yes:1,Negated:2,ChildYes:3},EmailResponseMode:{None:0,Reply:1,ReplyAll:2,Forward:3,Other:4},PluginType:{Unknown:0,Storage:1,Calendar:2,Email:3},SyncResult:{Success:0,FailureOAuth:1,FailureNoWrite:2,FailureNoRead:3,FailureNetwork:4,FailureUnknown:5},Primary:{No:0,Yes:1,Either:2,Both:3,Never:4,Only:5},Shift:{No:0,Yes:1,Either:2},FavoriteGroup:{EmailRoot:1},DropEffect:{Copy:"copy",Move:"move"},HoveredID:{Plugin:"plugin",Collapser:"collapser",Checkbox:"checkbox",Bullet:"bullet"},TaskViewMode:{Outline:"Outline",List_Flat:"List_Flat",Groups_Project:"Groups_Project",Groups_Tag:"Groups_Tag",Groups_Contact:"Groups_Contact",Groups_Priority:"Groups_Priority",Agenda_Today:"Agenda_Today",Agenda_Week:"Agenda_Week",Agenda_All:"Agenda_All",Calendar_Day:"Calendar_Day",Calendar_Custom:"Calendar_Custom",Calendar_Week:"Calendar_Week",Calendar_Month:"Calendar_Month"},TaskViewModesPremium:{Groups_Tag:!0,Groups_Contact:!0,Groups_Priority:!0},TaskViewModeText:{Outline:"Outline",List_Flat:"Flat List",Groups_Project:"Project",Groups_Tag:"Tag",Groups_Contact:"Contact",Groups_Priority:"Priority",Agenda_Today:"Today",Agenda_Week:"Week",Agenda_All:"All",Calendar_Day:"Day",Calendar_Custom:"# Days",Calendar_Week:"Week",Calendar_Month:"Month"},TaskViewModeTextSimple:{Outline:"Outline",List_Flat:"Flat List",Groups_Project:"Projects",Groups_Tag:"Tags",Groups_Contact:"Contacts",Groups_Priority:"Priorities",Agenda_Today:"Agenda",Agenda_Week:"Agenda",Agenda_All:"Agenda",Calendar_Day:"Calendar",Calendar_Custom:"Calendar",Calendar_Week:"Calendar",Calendar_Month:"Calendar"},TaskViewModeIcon:{Outline:"icon-format_list_bulleted",List_Flat:"icon-reorder",Groups_Project:"icon-project",Groups_Tag:"icon-hash",Groups_Contact:"icon-user",Groups_Priority:"icon-exclamation",Agenda_Today:"icon-today",Agenda_Week:"icon-view-groups",Agenda_All:"icon-format_align_justify",Calendar_Day:"icon-view_carousel",Calendar_Custom:"icon-view_week",Calendar_Week:"icon-cal-week",Calendar_Month:"icon-view_comfy"},TaskSortMode:{None:"None",Alphabetical:"Alphabetical",NumItems:"NumItems",Priority:"Priority",Date:"Date",Created:"Created",Completed:"Completed"},TaskSortModeText:{None:"None",Alphabetical:"A-Z",NumItems:"# Items",Priority:"!!!",Date:"Date",Created:"Created",Completed:"Completed"},DocumentSortMode:{Alphabetical:"Alphabetical",Modified:"Modified"},CalendarMonthViewWeekHeight:150,CalendarMonthViewMonthTitleHeight:50,CalendarMonthViewNumWeeksPad:52,CalendarDayViewNumDaysPad:364,CalendarDayViewMaxAllDayHeight:164,CalendarDayViewBlockHeight:50,CalendarMaxSyncWeeks:52,CalendarMinSyncWeeks:-52,HTTPStatusCode:{Network:0,Success:200,Created:201,PermRedirect:308,BadRequest:400,Unauthorized:401,Forbidden:403,NotFound:404,Timeout:408,Conflict:409,Gone:410,TooMany:429,ServerError:500,BadGateway:502,Unavailable:503,GatewayTimeout:504},PluginAction:{Gmail:{Archive:1,Unarchive:2,Trash:3,Untrash:4,AddLabel:5,RemoveLabel:6,Star:7,Unstar:8,MarkRead:9,MarkUnread:10,SetPriority:11,Move:12,Snooze:13,ScheduleSend:14,DiscardDraft:15}},DFormat:{LongDayTime:0,ShortDayTime:1,ShortTime:2,ShortDate:3,MonthDay:4,MonthDayYear:5,LongStrDate:6,DayYearTime:7,MonthDayYearShort:8,DayMonthDateYear:9,MonthDayLong:10,MonthDayYearLong:11,DayDate:12,NoPadShortDayTime:13,MonthDayShort:14},HelpMode:{None:0,Normal:1,Hotkeys:3},Pricing:{None:-1,EarlyMonthly:0,EarlyYearly:1,RegMonthly:2,RegYearly:3},Analytics:{Dimensions:{PremiumStatus:"dimension1"}},Feature:{ClonePane:"clonePane",OAuth:"oauth"},GmailViewMode:{Date:"Date",Priority:"Priority"},MaxGmailSyncTime:{Premium:30,Free:5},MessageListVisibility:{Hide:"hide",Show:"show"},LabelListVisibility:{Hide:"labelHide",Show:"labelShow",ShowIfUnread:"labelShowIfUnread"},GoogleError:{FailedPrecondition:"failedPrecondition",InsufficientPermissions:"insufficientPermissions",Forbidden:"forbidden",DailyLimitExceeded:"dailyLimitExceeded",UserRateLimitExceeded:"userRateLimitExceeded",RateLimitExceeded:"rateLimitExceeded",SharingRateLimitExceeded:"sharingRateLimitExceeded",QuotaExceeded:"quotaExceeded"},GoogleErrorDomain:{UsageLimits:"usageLimits"},KeyboardToolbarHeight:44,KeyboardToolbarMode:{Item:0,Search:1,Modal:2},DocLoadSkipReason:{None:"None",Already:"Already Loading",Main:"Main Not Loaded",Drive:"Drive Not Loaded",NotAuth:"Not Authorized",LoginState:"Not Logged In"},TopBarMode:{Normal:"Normal",Multiselect:"Selected",Contact:"Contacts",Date:"Date",Tag:"Tag",Note:"Note"},AutocompleteMode:{All:"all",Move:"move",Jump:"jump",Item:"item",Email:"email",Contact:"contact",Tag:"tag",Date:"date",Snooze:"snooze",GmailLabel:"gmailLabel"},ContextMenuMode:{Default:0,Archived:1,Drive:2,Gmail:3},ComponentDisplay:{Desktop:1,Mobile:2,Everywhere:3},RequestPriority:{Low:0,Default:50,UserBlocking:100},Orientation:{Vertical:0,Horizontal:1,Portrait:0,Landscape:1},DragDropPosition:{Above:-1,On:0,Below:1},SetMode:{Toggle:-1,No:0,Yes:1},SelectOption:{Delay:1,DoNothing:2,AllowPrefix:3},DisplayTheme:{Simple:"Classic",OutlineLight:"Light",OutlineHeavy:"Outliner",Markdown:"Markdown",SpacingCompact:"SpacingCompact",SpacingComfortable:"SpacingComfortable",PrefixesFaded:"PrefixesFaded",PrefixesStrong:"PrefixesStrong"},ColorTheme:{Light:"light",Dark:"dark"},LocalWriteReason:{Enabled:-1,DemoMode:1,QuotaError:2,NoLocal:3,NoPermission:4,Generic:5},ConversionID:{Purchase:"ha4uCMXduXUQ6vTp0QM",Signup:"LAulCIvcuXUQ6vTp0QM"},IntroVideoID:"qE14CrQiXwc",Prefix:{Header:"#",Header2:"^",Bullet:"*",Bullet2:"-",Bullet3:"+",Task:"[",Task2:"[]",Task3:"]",Task4:"[ ]",Task5:"(",Task6:"()",Task7:")",Task8:"( )",NumList:"1."},MinimumTokenExpireTimeMS:6e4,MinimumTokenExpireTime:60,ToastTimeoutDefault:5e3,PrefixWidth:20,PaddingAgendaTime:30,HeightAgendaParents:18,LineLeftPad:5,TextSpace:"\ufeff",AttachChar:"\u2000",EmbedAttachChar:"\u2001",CharDate:"\ufefe",PerPaneStateField:{Element:"element",OverviewElement:"oelement",Collapsed:"collapsed",CollapsedOverview:"collapsedOverview",CollapsedSearch:"collapsedSearch"},ItemStoreFilter:{None:0,Dates:1,Contacts:2,Priority:4},NumKeys:[o.D1,o.D2,o.D3,o.D4,o.D5,o.D6,o.D7,o.D8,o.D9,o.D0],ContactPrefix:"+",TagPrefix:"#",PrefixDate:"!",PrefixItemAutocomplete:"$",TextMDHR:"---",DisplaySettings:{bulletOpacity:"bulletOpacity",projectOpacity:"projectOpacity",checkboxOpacity:"checkboxOpacity",checkboxBackgroundOpacity:"checkboxBackgroundOpacity",showVerticalLines:"showVerticalLines",verticalLinesOpacity:"verticalLinesOpacity",boldHeaders:"boldHeaders",itemPadding:"itemPadding",notePadding:"notePadding",itemLineHeight:"itemLineHeight",noteLineHeight:"noteLineHeight",itemIndentSize:"itemIndentSize",fontSize:"fontSize",fontSizeHeader:"fontSizeHeader",fontSizeHeaderTopLevel:"fontSizeHeaderTopLevel",noteFontSize:"noteFontSize",tagColor:"tagColor",dateColor:"dateColor",contactColor:"contactColor",linkColor:"linkColor",underlineP:"underlineP",displaySpacing:"displaySpacing",displayPrefixes:"displayPrefixes",grayscale:"grayscale"},KeyCode:o,KeyCodesModifiers:[o.LeftMeta,o.RightMeta,o.Ctrl,o.Alt,o.Shift],KeyCodesArrows:[o.UpArrow,o.DownArrow,o.LeftArrow,o.RightArrow],PrivateAPIErrorCodes:{Success:0,UnknownFailure:1,Unexpected:2,DatabaseReadError:3,DatabaseWriteError:4,MissingParameter:5,InvalidParameter:6,UnauthorizedUser:7,ErrorSendingEmail:8,AlreadyReferred:9,ErrorContactingRemote:10,BraintreeUnknown:11,InvalidToken:12,InvalidReferralCode:13,NoSignupFound:14,TrialOver:15,RemoteServerError:16,TokenMissing:17,BraintreePaypalBlock:18,BraintreeInvalidCCN:19,AlreadyExists:20,DomainPolicy:21,InvalidCode:22,RejectedEmail:23,AlreadyPremium:24,MissingIDToken:25},SearchDates:{Overdue:"@overdue",Before:"before:",After:"after:",Date:"date:"},Regexp:{Link:/\b((?:(https?|evernote|onenote|bear):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\))+)*\))(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/g,LinkExc:/(!?)\b((?:(https?|evernote|onenote|bear):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\))+)*\))(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/g,MDLink:/(!?)\[([^\[]*)\]\((\S+)(\s=\d{0,3}x)?(?=\))\)/g,Prefix:/^(\#+|\^|\-|\*|\[(?: ?\])?|\]|\((?: ?\))?|\)|\+|[0-9]+\.) /gi},ItemProp:{Date:"date",Items:"items",Tags:"tags",Text:"text",Font:"font",Search:"search"},DefaultBackupFrequency:36e5,DriveFolder:{Root:"root",Attach:"attach",Backup:"backup"},CrudActions:{Added:"added",Modified:"modified",Removed:"removed"},TestDocName:"demo",LocalStoreMode:{Mirror:"mirror"},LogLevels:{Off:0,Error:1,Warning:2,Timing:4,Data:8,Status:16,Search:32,Timeline:64,Input:128,Tracker:256,Profile:512,PageLoad:1024,Toolbar:2048,Picker:4096,Intro:8192,Import:16384,Version:32768,Settings:65536,Selection:131072,Edit:262144,NativeAuth:524288,DateRoll:1048576,DebugDOM:2097152,RepeatDate:4194304,Connection:8388608,Plugin:16777216,Folders:33554432,Verbose:67108864,Account:134217728,React:268435456,Autocomplete:536870912,Compose:1073741824},URLPart:{Search:1,Hash:2},PremiumStatus:{Unknown:0,Never:1,Trial:2,TrialOver:3,Active:4,PastDue:5,CanceledUser:6,CanceledPastDue:7},UninitializedVersion:-1,DETAILED_STATS:!1,DEBUG_DATE:!1,OAuthSchemeType:{Invalid:-1,None:0,Web:1,Native:2,Count:2},RepeatFreq:{Once:0,Daily:1,Weekly:2,Monthly:3,DayOfMonth:4,Yearly:5,EndOfMonthOffset:6,NthMonthInst:7},ChangeType:{None:0,Local:1,Remote:2,Auto:4,Structure:33554432,Text:67108864,Property:134217728,UndoRedo:2097152,PluginLoad:4194304,ItemLoad:8388608,DocLoad:65536,Locations:7,All:234881024,AllLocal:234881025,AllRemote:234881026,Valid:250675207},DataChangeType:{Add:1,Remove:2,Change:3},VMLIFlag:u,VersionType:{Structure:1,Text:2},SearchResultStatus:{Done:1,TooMany:2,None:3,Error:4},PaneMode:{Task:"PaneTask",Archived:"PaneArchived",Drive:"PaneDrive",Gmail:"PaneGmail"},ScrollDuration:{Snap:0,Default:200,Slow:500},LoadState:{Connecting:0,NeedPassword:1,LoadingDocs:2,Connected:3},LoginState:{NONE:0,LOGGED_OUT:1,LOGGED_IN:2},ButtonCode:{None:-1,Left:0,Middle:1,Right:2},Direction:{Up:-1,None:0,Down:1},MessageAction:{Default:0,Reload:1,LoginScreen:2,Demo:3,ResetClient:4,None:5,SyncContacts:6,OpenURL:7,Okay:8,Blog:9,Undo:10,Contact:11,OpenSettings:12,OpenAccountSettings:13,OpenGoogleDrive:14,OpenDisplaySettings:15,StartDemo:16,OpenLinkedSettings:17,OpenGeneralSettings:18,OpenCalendarSettings:19},MessageType:{Info:0,Warning:1,Error:2,Fatal:3,Subtitle:4,Intro:5,RequiredUpdate:6,InfoGray:7},MessageID:{Undefined:0,ConnectionError:1,OfflineUndo:2,FatalError:3,DocChange:4,OfflineWarn:5,OnlineInfo:6,CacheReset:7,RequiredUpdate:8,Updated:9,SyncContacts:10,ExitDemo:11,Reauthorize:12,ShareFailure:13,ThisIsDemo:14,MailbirdClick:15,InviteFailure:16,InviteSuccess:17,PremiumRequired:18,TrialOver:19,TrialEndSoon:20,DisabledFolderDrop:21,WarnLargeFile:22,InviteInvalid:23,NoSharingWarning:24,LostPermission:25,CalendarSync:26,EmailSendFail:28,EmailUpdateFail:29,EmailLabelFail:30,EmailSyncFail:31,DemoPluginClick:33,PromptScriptStart:34,SnoozeOffline:35,NeedDrivePermission:36,NeedGmailPermission:37,LostLinked:38,GmailDisabled:39,LocalWritesDisabled:40,MissingOffline:41,MissingOfflineMobile:42,FlatSearchMultiSelect:43,FlatSearchEnter:44,FlatSearchTab:45,ReadOnlyCalendar:46,CalendarSaveFail:47,QuotaError:48,ReselectEmail:49,ReactError:50,PaneLoadTimeout:51},SaveFlag:{None:0,Prop:1,Text:2,All:3},DateType:{Once:1,Repeat:2},StorageType:{InMemory:1,LocalStorage:2,IndexedDB:3},DataSource:{Paste:1,Drop:2,Plugin:3},PluginID:{Date:"Date",Moodo:"Moodo",Contacts:"Contacts",Drive:"Drive",Mailbird:"Mailbird",Gmail:"Gmail",GCalendar:"GCalendar"},PluginSettingsID:{Date:{IsEnabled:"isEnabled"},Moodo:{IsEnabled:"isEnabled"},Mailbird:{IsEnabled:"isEnabled"},Gmail:{IsEnabled:"isEnabled",ArchiveOnSchedule:"archiveOnSchedule",ArchiveOnOrganize:"archiveOnOrganize",InsertSignatureAboveReplies:"insertSignatureAboveReplies",WriteAccess:"writeAccess",SyncTime:"syncTime",SyncAccounts:"syncAccounts"},Drive:{IsEnabled:"isEnabled",WriteAccess:"writeAccess",LastChangeId:"lastChangeId",DriveRootId:"driveRootId"},GCalendar:{IsEnabled:"isEnabled",WriteAccess:"writeAccess",ImportCalendars:"importCalendars",ExportCalendar:"exportCalendar",WeeksPast:"weeksPast",WeeksFuture:"weeksFuture",DisplayOverdueInAgenda:"displayOverdueInAgenda",SyncNewEvents:"syncNewEvents",SyncDraggedEvents:"syncDraggedEvents",CreateLocalEvents:"createLocalEvents"}},PluginLoad:{None:0,Preview:1,Full:2,Runtime:4,Autocomplete:8,Inline:16},PluginDependency:{DemoMode:"DemoMode",GoogleLogin:"GoogleLogin",PremiumSub:"PremiumSub",EarlyAccess:"EarlyAccess"},PluginRenderTypes:{Generic:0,StyledText:1,UnstyledText:2,Measure:3},PluginRenderers:{Unknown:-1,DriveFile:0,EmailThread:1,CalendarEvent:2},Modals:{ReportBug:"reportBug",ImportData:"importData",ExportData:"exportData",ShareDoc:"shareDoc",MobileSettings:"mobileSettings",Settings:"settings",Confirm:"confirm",Alert:"alert",Options:"options",Billing:"billing",DeleteAccount:"deleteAccount",EmailPreview:"emailPreview",ReportProblem:"reportProblem",EmailCompose:"emailCompose",EmailReply:"emailReply",Invoices:"invoices",Prompt:"prompt",Lightbox:"lightbox",EnterCode:"enterCode",Backups:"backups",ImportMoodo:"importMoodo",ConfirmEncrypt:"confirmEncrypt"},DisplayMode:{Default:0,InIframe:1,NoPaneHeaders:2,Invisible:4,NoScrollbars:8,NoBackground:16,NoPaneTop:32,NoInteraction:64,NoPanePadding:128,NoPaneStyle:256,NoRightClick:512,ShowDemoExit:1024,NoMinPaneSize:2048,PromptStart:4096,FullMin:8191},Checkpoint:{MainRun:1,RequireLoaded:2,PageLoad:4,LocalDocLoad:8,InitData:16,DBLoaded:32,OnInitializedData:64,InitializeMain:128,LoadDefaultFile:256,DocLoadRequested:512,DocLoaded:1024,MaskRequired:2047},PlatformConfig:{DesktopWindows:0,DesktopMac:1,DesktopOther:2,ChromeApp:3,AndroidBrowser:4,AndroidApp:5,iOSBrowser:6,iOSApp:7,WinPhoneBrowser:8,WinPhoneApp:9,MobileOther:10,Unknown:11,EmbedDesktopApp:12,EmbedMobileApp:13,ElectronMac:14,ElectronWindows:15,ElectronUnknown:16},AppPlatform:{iOS:0,Android:1,Embed:2,Electron:3},EmbedApps:{Mailbird:"mailbird"},DeployVariable:{Environment:"Environment",APIHost:"APIHost",APIProtocol:"APIProtocol"},GScope:s,GScopeArray:[s.Calendar,s.CalendarRO,s.Contacts,s.Drive,s.DriveMetadataRO,s.DriveFull,s.DriveReadOnly,s.GmailCompose,s.GmailModify,s.TasksRO,s.UserInfoEmail,s.UserInfoProfile,s.DriveAppData,s.Plus,s.Email,s.Profile,s.DriveInstall],OnlineStatus:{Offline:-1,Connecting:0,Online:1},__jsVersion:"1547009272916",__devServerURL:"##DEV_SERVER_URL##",__MAX_ERRORS_REPORTED:50,inputAccessoryViewID:"inputAccessoryView1",ProductName:"Moo.do",EncryptionSentinel:"MDsentinel",EncryptionKeys:{Global:"Global",UserPassword:"UserPassword"},PCMask:u.P0|u.P1|u.P2|u.Complete,PMask:u.P0|u.P1|u.P2,PriorityClass:(r={},n()(r,u.None," "),n()(r,u.P0," p0"),n()(r,u.P1," p1"),n()(r,u.P2," p2"),r),OverviewPaddingStart:32,OverviewPaddingIncrement:18,MobileItemIndentStart:30,ColorBrand:"#0099dd",DocumentAccessRoles:{Read:0,Write:1,Admin:2}};e.a=h},,function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(17),s=i.n(u),h=i(9),d=i.n(h),c=i(18),v=i.n(c),y=i(37),g=i.n(y),l=i(0),p=i(19),m=i(55),f=i(1),k=i(10),A=function(t){function e(){var t;return a()(this,e),t=s()(this,d()(e).call(this)),p.a.binder(g()(g()(t)),"normalizeKeys","getKeyCode"),t.versionRequired=[],t.versionAvailable=[],t.versionRequired[f.a.AppPlatform.iOS]=4,t.versionAvailable[f.a.AppPlatform.iOS]=6,t.versionRequired[f.a.AppPlatform.Android]=4,t.versionAvailable[f.a.AppPlatform.Android]=5,t.versionRequired[f.a.AppPlatform.Electron]=1,t.versionAvailable[f.a.AppPlatform.Electron]=2,t.versionMobile=3,t.versionDesktop=15,t.versionMobileMessages={3:"The latest version of Moo.do changes how item order is stored. Newly added items may be out of order on old versions, so please restart Moo.do on all of your devices."},t.versionDesktopMessages={15:"The latest version of Moo.do changes how item order is stored. Newly added items may be out of order on old versions, so please restart Moo.do on all of your devices."},t.appSubVersion=void 0,t.setDeployEnvironments(),t.appStoreLinks=[],t.appStoreLinks[f.a.AppPlatform.iOS]="https://itunes.apple.com/us/app/moo.do-organize-your-way/id889830074?ls=1&mt=8",t.appStoreLinks[f.a.AppPlatform.Android]="https://play.google.com/store/apps/details?id=moo.do",t.appStoreLinks[f.a.AppPlatform.Electron]="https://github.com/MooDoApp/MooDoApp.github.io/releases/latest",t.appReviewLinks=[],t.appReviewLinks[f.a.AppPlatform.iOS]=void 0,t.appReviewLinks[f.a.AppPlatform.Android]=void 0,t.appReviewLinks[f.a.AppPlatform.Electron]=void 0,t.appPlatform=void 0,t.appStoreLink=void 0,t.appReviewLink=void 0,t.requireCustomRedirect=!1,t.requireCustomPurchase=!1,t.requireCustomPaypal=!1,t.bodyClass=void 0,t.b=document.documentElement,t.orientation=f.a.Orientation.Portrait,t.onResize=new m.a,t.kbsizePortrait=Math.ceil(t.getActualWindowHeight()/2),t.kbsizeLandscape=void 0,t.kbsize=new k.a(t.kbsizePortrait),t.appState=void 0,t.isHosted=!1,t.hostedBy=void 0,t.initStorageQuota={quota:NaN,usage:NaN},t.isNearStorageQuota=!1,t.pageVisibilityHidden=void 0,t.pageVisibilityChange=void 0,t._allowNativeNotifications=!0,t.isDevURL="localhost"===window.location.hostname||"dev.moo.do"===window.location.hostname||"beta.moo.do"===window.location.hostname,t.isBeta="beta.moo.do"===window.location.hostname,t._features={},t.init(),t._windowWidth=new k.a(t.getActualWindowWidth()),t._windowHeight=new k.a(t.getActualWindowHeight()),t.app&&(t.customRedirectState={app:!0,appv:t.appv,webview:t.getAppState("webview")}),t.app||t.android?t.keyboardOpenTime=200:t.winphone?t.keyboardOpenTime=200:t.mobileie?t.keyboardOpenTime=600:t.keyboardOpenTime=0,t}return v()(e,t),o()(e,[{key:"getDeployVar",value:function(t){return this.deployEnvironment[t]}},{key:"setDeployEnvironments",value:function(){this.deployEnvironment={},"dev.moo.do"===window.location.hostname?(this.deployEnvironment[f.a.DeployVariable.Environment]="dev",this.deployEnvironment[f.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[f.a.DeployVariable.APIHost]="//api-dev.moo.do"):"beta.moo.do"===window.location.hostname?(this.deployEnvironment[f.a.DeployVariable.Environment]="beta",this.deployEnvironment[f.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[f.a.DeployVariable.APIHost]="//api-beta.moo.do"):"localhost"===window.location.hostname?(this.deployEnvironment[f.a.DeployVariable.Environment]="local",this.deployEnvironment[f.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[f.a.DeployVariable.APIHost]="//api-dev.moo.do"):(this.deployEnvironment[f.a.DeployVariable.Environment]=this.isMobile?"mobile":"web",this.deployEnvironment[f.a.DeployVariable.APIProtocol]="https:",this.deployEnvironment[f.a.DeployVariable.APIHost]="//api.moo.do")}},{key:"getKBSize",value:function(){var t=this.kbsize.get();return!t||isNaN(t)||t<100?400:t}},{key:"setKBSize",value:function(t){this.kbsize.set(+t)}},{key:"windowWidth",value:function(){if(!this._windowWidth.get()){try{l.default.PAssert(0,!1,"Window width was not set",this._windowWidth.get(),this._windowHeight.get())}catch(t){l.default.reportError(t)}this._windowWidth.set(this.getActualWindowWidth())}return this._windowWidth.get()}},{key:"windowHeight",value:function(){if(!this._windowHeight.get()){try{l.default.PAssert(1,!1,"Window height was not set",this._windowWidth.get(),this._windowHeight.get())}catch(t){l.default.reportError(t)}this._windowHeight.set(this.getActualWindowHeight())}return this._windowHeight.get()}},{key:"setWindowSize",value:function(t,e){this._windowWidth.set(t),this._windowHeight.set(e)}},{key:"getLocaleInfo",value:function(t){try{t.lang=navigator.language||navigator.userLanguage}catch(e){t.lang="EXCEPTION"}}},{key:"getPlatformInfo",value:function(t){t.os=this.OSName,t.browser=this.browser,t.majorVersion=this.majorVersion,t.minorVersion=this.minorVersion,t.appVersionRequired=this.versionRequired[this.appPlatform],t.app=this.app,t.appPlatform=this.appPlatform,t.standalone=this.standalone,t.packagedApp=this.packagedApp,t.requireCustomRedirect=this.requireCustomRedirect,t.requireCustomPurchase=this.requireCustomPurchase,t.requireCustomPaypal=this.requireCustomPaypal,t.isMobile=this.mobile,t.isMobileBrowser=this.isMobileBrowser,t.isPhone=this.phone,t.isTouch=this.touch,t.isTouchDevice=this.isTouchDevice,t.usePointerEvents=this.usePointerEvents,t.kbsize=this.kbsize.get(),t.appState=this.appState,t.isHosted=this.isHosted,t.hostedBy=this.hostedBy,t.embed=this.embed,t.bodyClass=this.b.className,t.rawUA=navigator.userAgent,t.referrer=document.referrer,t.devicePixelRatio=window.devicePixelRatio,t.pageVisibilityChange=!!this.pageVisibilityChange,t.appSubVersion=this.appSubVersion,t.initStorageQuota=this.initStorageQuota,t.isNearStorageQuota=this.isNearStorageQuota,this.getLocaleInfo(t)}},{key:"getUserPlatformConfig",value:function(){var t=f.a.PlatformConfig.Unknown,e=location.pathname.replace(/\//g,"")+(this.isBeta?",beta":"");if(this.app)switch(this.appPlatform){case f.a.AppPlatform.iOS:t=f.a.PlatformConfig.iOSApp;break;case f.a.AppPlatform.Android:t=f.a.PlatformConfig.AndroidApp;break;case f.a.AppPlatform.Electron:t="Windows"===this.OSName?f.a.PlatformConfig.ElectronWindows:"MacOS"===this.OSName?f.a.PlatformConfig.ElectronMac:f.a.PlatformConfig.ElectronUnknown;break;case f.a.AppPlatform.Embed:t=this.mobile?f.a.PlatformConfig.EmbedMobileApp:f.a.PlatformConfig.EmbedDesktopApp}else switch(this.OSName){case"Windows":t=this.phone?f.a.PlatformConfig.WinPhoneBrowser:f.a.PlatformConfig.DesktopWindows;break;case"iPad":case"iPod":case"iPhone":t=f.a.PlatformConfig.iOSBrowser;break;case"MacOS":t=f.a.PlatformConfig.DesktopMac;break;case"Android":t=f.a.PlatformConfig.AndroidBrowser;break;case"ChromeOS":case"Linux":default:t=this.phone?f.a.PlatformConfig.MobileOther:f.a.PlatformConfig.DesktopOther}return t+=","+e}},{key:"getAppDownloadURL",value:function(){return this.appDownloadUrl||(this.ios?this.appDownloadUrl=this.appStoreLinks[f.a.AppPlatform.iOS]:this.android?this.appDownloadUrl=this.appStoreLinks[f.a.AppPlatform.Android]:this.appDownloadUrl=window.location.origin+"/download/"),this.appDownloadUrl||"https://github.com/MooDoApp/MooDoApp.github.io/releases/latest"}},{key:"supportsNativeApp",value:function(){switch(this.OSName){case"Windows":case"MacOS":return!this.mobile;default:return!1}}},{key:"isNativeApp",value:function(){return this.appPlatform===f.a.AppPlatform.Electron}},{key:"isNativeMac",value:function(){return this.isNativeApp()&&this.mac}},{key:"isNativeMacFullscreen",value:function(){return this.isNativeApp()&&this.mac&&!window.screenTop&&!window.screenY}},{key:"canDownloadNativeApp",value:function(){return this.supportsNativeApp()&&!this.isNativeApp()}},{key:"init",value:function(){var t=this;this.initAppState(),this.initHostState(),this.initFeatures();var e,r,a=navigator.userAgent,n="";if(this.OSName="Unknown OS",this.app&&(n+=" app"),-1!==a.indexOf("Win")?(this.OSName="Windows",this.windows=!0,-1!==a.indexOf("Windows Phone")?(this.phone=!0,this.touch=!0,this.mobile=!0):this.appStoreLink=this.appStoreLinks[f.a.AppPlatform.Electron]):-1!==a.indexOf("iPad")?(this.OSName="iPad",this.ios=!0,this.ipad=!0,this.phone=!0,this.touch=!0,this.mobile=!0,this.appStoreLink=this.appStoreLinks[f.a.AppPlatform.iOS],this.app&&(this.appPlatform=f.a.AppPlatform.iOS)):-1!==a.indexOf("iPhone")?(this.OSName="iPhone",this.ios=!0,this.iphone=!0,this.phone=!0,this.mobile=!0,this.touch=!0,this.appStoreLink=this.appStoreLinks[f.a.AppPlatform.iOS],this.app&&(this.appPlatform=f.a.AppPlatform.iOS)):-1!==a.indexOf("iPod")?(this.OSName="iPod",this.ios=!0,this.ipod=!0,this.phone=!0,this.mobile=!0,this.touch=!0,this.appStoreLink=this.appStoreLinks[f.a.AppPlatform.iOS],this.app&&(this.appPlatform=f.a.AppPlatform.iOS)):-1!==a.indexOf("Mac")?(this.OSName="MacOS",this.mac=!0,this.appStoreLink=this.appStoreLinks[f.a.AppPlatform.Electron]):-1!==a.indexOf("X11")?-1!==a.indexOf("CrOS")?(this.OSName="ChromeOS",this.chromeOS=!0):(this.OSName="UNIX",this.unix=!0):-1!==a.indexOf("Android")?(this.OSName="Android",this.android=!0,this.touch=!0,this.mobile=!0,this.phone=!0,this.appStoreLink=this.appStoreLinks[f.a.AppPlatform.Android],this.app&&(this.appPlatform=f.a.AppPlatform.Android),n+=" android"):-1!==a.indexOf("Linux")&&(this.OSName="Linux",this.linux=!0),this.ios){if(this.ios7=-1!==a.indexOf("OS 7"),this.ios70=-1!==a.indexOf("OS 7_0"),this.ios71=-1!==a.indexOf("OS 7_1"),this.ios10=-1!==a.indexOf("OS 10"),this.ios11=-1!==a.indexOf("OS 11"),this.ios12=-1!==a.indexOf("OS 12"),this.appState)"ioswk"===this.appState.webview?this.ioswk=!0:this.iosui=!0,this.appState.oauth&&this._enableFeature(f.a.Feature.OAuth);this.ios7&&(n+=" ios7")}(this.majorVersion=1e3,this.minorVersion=1e3,-1!==a.indexOf("MSIE")||-1!==a.indexOf("Trident"))?(this.browser="Trident",this.ie=!0,this.winphone=!!a.match(/IEMobile/i),null!==(this.winphone||"Microsoft Internet Explorer"===navigator.appName?new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")).exec(a)?this.majorVersion=parseFloat(RegExp.$1):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(a)&&(this.majorVersion=parseFloat(RegExp.$1))):-1!==a.indexOf("Chrome")||-1!==a.indexOf("CriOS")?(this.browser="Chrome",this.isChrome=!0,null!==new RegExp("Chrome/([0-9]{1,}).").exec(a)&&(this.majorVersion=parseFloat(RegExp.$1)),-1!==a.indexOf("Edge")&&(this.ieEdge=!0),this.app&&this.appPlatform!==f.a.AppPlatform.Android&&(this.requireCustomPaypal=!0)):-1!==a.indexOf("Android")?(this.browser="Native Android",null!==new RegExp("Linux; Android ([0-9]{1,}).([0-9]{1,}).").exec(a)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))):-1!==a.indexOf("Firefox")?(this.browser="Firefox",this.isFirefox=!0,null!==new RegExp("Firefox/([0-9]{1,}).").exec(a)&&(this.majorVersion=parseFloat(RegExp.$1))):-1!==a.indexOf("Safari")||"iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName?(this.browser="Safari",this.safari=!0,null!==(this.mobile?new RegExp("OS ([0-9]{1,})_([0-9]{1,})"):new RegExp("Version/([0-9]{1,}).([0-9]{1,}).")).exec(a)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))):-1!==a.indexOf("Opera")&&(this.browser="Opera");if(a.indexOf("Electron")>=0&&a.indexOf(f.a.ProductName)>=0){if(this.app=!0,this.appPlatform=f.a.AppPlatform.Electron,n+=" electron",null!==new RegExp("Moo\\.do/([^\\s]+)\\s").exec(navigator.userAgent)){var o,u=function(t,e){for(var i=0,r=t.split("."),a=e.split("."),n=0;n<3;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=+r[n],u=+a[n];if(o>u)return 1;if(u>o)return-1;if(!isNaN(o)&&isNaN(u))return 1;if(isNaN(o)&&!isNaN(u))return-1}return 0},s=RegExp.$1;u(s,"1.1.4")<=0&&setTimeout(function(){Promise.resolve().then(i.bind(null,4)).then(function(e){e.default.toasts.pushMessage({text:"A new version is available with important fixes. Future versions will update themselves, but please download this manually.",hold:!0,holdOnAction:!0,actionText:"DOWNLOAD",action:function(){l.default.openUrl(t.getAppDownloadURL())}})})},2e3),o=u(s,"1.1.0")>=0?2:1,this.appv=o}this.mac&&(n+=" electronMac"),this.appState||(this.appState={}),this.appState.appType||(this.appState.appType="electron"),this.appStoreLink=this.appStoreLinks[f.a.AppPlatform.Electron],this.requireCustomPurchase=!0,this._enableFeature(f.a.Feature.OAuth)}if(this.appReviewLink=this.appReviewLinks[this.appPlatform],this.isTouchDevice=!!("ontouchstart"in window||navigator.msMaxTouchPoints),this.isMobileBrowser=this.checkMobileBrowser(),this.usePointerEvents=!!window.navigator.msPointerEnabled,this.useCustomScroller=!!this.iosui,this.isTouchDevice&&this.isMobileBrowser&&(this.usePointerEvents?(this.touchStartEvent="MSPointerDown",this.touchMoveEvent="MSPointerMove",this.touchEndEvent="MSPointerUp",this.touchCancelEvent="MSPointerCancel"):(this.touchStartEvent="touchstart",this.touchMoveEvent="touchmove",this.touchEndEvent="touchend",this.touchCancelEvent="touchcancel")),this.usePointerEvents?(this.downEvent="MSPointerDown",this.moveEvent="MSPointerMove",this.upEvent="MSPointerUp"):(this.downEvent="mousedown",this.moveEvent="mousemove",this.upEvent="mouseup"),p.a.hasURLParam("touch","false")?(this.touch=!1,this.phone=!1,this.mobile=!1,this.ios=!1,this.android=!1):(this.isTouchDevice&&this.isMobileBrowser||p.a.hasURLParam("touch","true"))&&(this.touch=!0,this.phone=!0,this.mobile=!0),this.windows&&(n+=" windows",this.ie&&(n+=" ie",this.demo||(this.mobro=this.isMobro()))),"Firefox"===this.browser&&(n+=" firefox"),this.safari&&(n+=" safari"),this.phone&&(n+=" phone"),this.ipad&&(n+=" ipad"),this.embed===f.a.EmbedApps.Mailbird&&(n+=" mailbird",this.isMailbirdSidebar()&&(n+=" mailbirdSidebar")),this.demo&&(n+=" demoMode"),this.mobileie=this.ie&&this.mobile,this.isChrome&&this.app&&(this.isPackagedApp=!0),this.cmdChar=this.mac?"\u2318":"ctrl",this.priModKey=this.mac?"\u2318":"Ctrl",this.secModKeyForce=this.mac?"\u2303":"Alt",this.secModKey=this.app?this.priModKey:this.secModKeyForce,this.noErrorStacks="iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName,this.standalone=!!navigator.standalone||window.navigator.userAgent.indexOf("FluidApp")>=0,(this.standalone||this.app||this.mobro)&&(this.requireCustomRedirect=!0),n&&n.length>0&&(this.bodyClass=n,this.b.className+=n),this.URL=window.URL||window.webkitURL,this.supportBlobURLIFrame=!(this.ie||this.ieEdge||this.ios10||this.ios11||this.ios12),this.transition=this.addPrefix("transition"),this.animation=this.addPrefix("animation"),this.transform=this.addPrefix("transform"),this.transformOrigin=this.addPrefix("transformOrigin","transform-origin"),this.userSelect=this.addPrefix("userSelect","user-select"),this.isMobile=this.mobile,this.isMobileWeb=this.mobile,window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame||function(t){clearTimeout(t)},this.ie&&(document.documentElement.addEventListener("MSHoldVisual",function(t){t.preventDefault()},!1),document.documentElement.addEventListener("contextmenu",function(t){t.preventDefault()},!1)),document.documentElement.addEventListener("keydown",this.normalizeKeys,!0),document.documentElement.addEventListener("keypress",this.normalizeKeys,!0),document.documentElement.addEventListener("keyup",this.normalizeKeys,!0),"undefined"!==typeof document.hidden?(e="hidden",r="visibilitychange"):["moz","ms","webkit"].forEach(function(t){if("undefined"!==document[t+"Hidden"])return e=t+"Hidden",r=t+"visibilitychange",!1}),void 0!==e&&(this.pageVisibilityHidden=e,this.pageVisibilityChange=r),this.initRedirectString(),this.supportsEstimatedStorage()){this.estimateAvailableStorage(function(t){this.initStorageQuota=t,t.usage/t.quota>.9&&(this.isNearStorageQuota=!0)}.bind(this),function(){})}}},{key:"updateBodyClass",value:function(){this.bodyClass&&(document.body.className+=this.bodyClass)}},{key:"supportsNotifications",value:function(){return this.supportsNativeNotifications()||this.supportsHTML5Notifications()}},{key:"supportsNativeNotifications",value:function(){var t=!1;return this._allowNativeNotifications&&(this.app&&this.appPlatform!==f.a.AppPlatform.Electron?(this.ios||this.android||this.isChrome)&&(t=!0):this.embed===f.a.EmbedApps.Mailbird&&(t=!0)),t}},{key:"supportsHTML5Notifications",value:function(){return"Notification"in window}},{key:"usesHTML5Notifications",value:function(){return!this.supportsNativeNotifications()&&this.supportsHTML5Notifications()}},{key:"hasNotificationPermission",value:function(){return!this.usesHTML5Notifications()||"granted"===Notification.permission}},{key:"disallowNativeNotifications",value:function(){this._allowNativeNotifications=!1}},{key:"supportsPersistedStorage",value:function(){var t=!1;return"storage"in navigator&&"persist"in navigator.storage&&(t=!0),t}},{key:"requestStoragePersistence",value:function(t,e){navigator.storage.persisted().then(function(i){i?t():navigator.storage.persist().then(t,e)})}},{key:"isStoragePersisted",value:function(t){this.supportsPersistedStorage()?navigator.storage.persisted().then(t):setTimeout(t,0,!1)}},{key:"supportsNativePromises",value:function(){return!!window.Promise}},{key:"supportsEstimatedStorage",value:function(){var t=!1;return"storage"in navigator&&"estimate"in navigator.storage?t=!0:"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage&&(t=!0),t&&this.supportsNativePromises()}},{key:"estimateAvailableStorage",value:function(t,e){this.supportsEstimatedStorage()?this._estimateAvailableStorage().then(t,e):setTimeout(e,0)}},{key:"_estimateAvailableStorage",value:function(){return"storage"in navigator&&"estimate"in navigator.storage?navigator.storage.estimate():"webkitTemporaryStorage"in navigator&&"queryUsageAndQuota"in navigator.webkitTemporaryStorage?new Promise(function(t,e){navigator.webkitTemporaryStorage.queryUsageAndQuota(function(e,i){t({usage:e,quota:i})},e)}):Promise.resolve({usage:NaN,quota:NaN})}},{key:"supportsWebworkers",value:function(){var t=!1;return window.Worker&&(t=!0),t}},{key:"supportsNativeDownload",value:function(){return this.isNativeApp()&&this.appv>=2}},{key:"supportsIDBWebworkers",value:function(){var t=!1;if(this.supportsWebworkers())switch(this.browser){case"Firefox":t=this.majorVersion>=37;break;case"Chrome":t=this.majorVersion>=24}return t}},{key:"supportsPassiveListeners",value:function(){if(void 0===this._supportsPassiveListeners){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("test",null,e)}catch(i){}this._supportsPassiveListeners=t}return this._supportsPassiveListeners}},{key:"addPassiveListener",value:function(t,e,i){this.supportsPassiveListeners()?t.addEventListener(e,i,{passive:!0}):t.addEventListener(e,i)}},{key:"isMobro",value:function(){var t,e=null;try{new ActiveXObject("")}catch(i){t=i.name}try{e=!!new ActiveXObject("htmlfile")}catch(i){e=!1}return!(e="ReferenceError"===t||!1!==e)}},{key:"normalizeKeys",value:function(t){void 0!==t.normCode&&(t.synthetic||t instanceof KeyboardEvent)||(t.normCode=this.getKeyCode(t))}},{key:"getKeyCode",value:function(t){var e;return 46===(e=null===t.keyCode||0===t.keyCode?null!==t.charCode?t.charCode:t.which:t.keyCode)&&"keypress"===t.type&&(e=190),e}},{key:"initAppState",value:function(){var t=location.hash.substring(1);if(t)for(var e,i=0,r=/([^&=]+)=([^&]*)/g;null!==(e=r.exec(t));){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if("state"===decodeURIComponent(e[1])){var a=decodeURIComponent(e[2]);if(a){var n=function(e){try{t=JSON.parse(e)}catch(i){}};n(a),t||n(a.replace(/\\"/g,'"')),t&&(this.app=!0===t.app,this.appv=t.appv,this.debugApp=t.debug,this.live=t.live,this.offline=t.offline,this.syncContacts=t.syncContacts,this.test=t.test,this.embed=t.embed,this.appState=t)}break}}this.live=this.live||p.a.hasURLParam("live","true"),this.test=!1,this.offline=this.offline||this.test||p.a.hasURLParam("offline","true")||!1,this.demo=p.a.hasURLParam("demo","true")||!1,this.script=p.a.hasURLParam("script"),this.app=this.app||!1}},{key:"getAppState",value:function(t){return this.appState?this.appState[t]:void 0}},{key:"_enableFeature",value:function(t){this._features[t]=!0}},{key:"_disableFeature",value:function(t){this._features[t]=!1}},{key:"initFeatures",value:function(){this._enableFeature(f.a.Feature.ClonePane)}},{key:"isMailbirdSidebar",value:function(){return this.embed===f.a.EmbedApps.Mailbird&&"true"===this.getAppState("sidebar")}},{key:"checkMobileBrowser",value:function(){var t,e=!1;if(this.android&&this.app)e=!0;else if(!this.embed&&(t=navigator.userAgent||navigator.vendor||window.opera,(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0),!e)){window.matchMedia&&window.matchMedia("(max-device-width: 620px)").matches&&(e=!0)}return e}},{key:"initHostState",value:function(){try{this.isHosted=window.self!==window.top}catch(t){this.isHosted=!0}this.isHosted&&(this.hostedBy=document.referrer)}},{key:"initRedirectString",value:function(){var t,e;t=this.isDevURL||this.app&&this.debugApp||!this.app&&this.standalone?window.location.host:"www.moo.do",e=this.app&&this.appPlatform===f.a.AppPlatform.Electron?"oauthRelay.html":"app/",this.customRedirectString=window.location.protocol+"//"+t+"/"+e}},{key:"addPrefix",value:function(t,e){var i="",r=["ms","webkit","moz","o"],a=this.b.style;if(e||(e=t),"string"===typeof a[t])i="";else for(var n=0,o=0;o<r.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if("string"===typeof a["-"+r[o]+"-"+e]){i=r[o];break}}var u=i.length>0?t.charAt(0).toUpperCase()+t.slice(1):t;if(i){var s=i.length>0?i.charAt(0).toUpperCase()+i.slice(1):t;return{prop:"-"+i+"-"+e,style:i+u,react:s+u}}return{prop:t,style:u,react:u}}},{key:"blockClient",value:function(){if(this.isMobile&&!this.app)return{needsApp:!0};switch(this.browser){case"Firefox":if(this.majorVersion<16)return{platform:"Firefox",browser:this.browser,update:!0};break;case"Chrome":if(this.majorVersion<26)return{platform:"Chrome",browser:this.browser,update:!0};break;case"Native Android":if(this.majorVersion<4)return{platform:"Native Android",browser:"NativeAndroid",update:!0};break;case"Opera":return{platform:this.browser,browser:this.browser,update:!1};case"Trident":if(this.majorVersion<10)return{platform:"Internet Explorer",browser:this.browser,update:!0};break;case"Safari":if(this.mobile&&this.majorVersion<6)return{platform:"Safari",browser:this.browser,update:!0};if(!this.mobile&&(6===this.majorVersion&&this.minorVersion<1||this.majorVersion<6))return{platform:"Safari",browser:this.browser,update:!0}}if(this.app){if(this.appv<this.versionRequired[this.appPlatform]){i(0).default.log("App Version out of date.");var t={version:this.versionRequired[this.appPlatform]};return this.ios?(t.update=!0,t.platform="iOS App"):this.android?(t.update=!0,t.platform="Android App"):i(0).default.nativeBridge.sendToApp("updateRequired"),t}if(this.appv>this.versionAvailable[this.appPlatform])return i(0).default.log("App is newer than the javascript, forcing an app cache update: "+this.appv+" vs. "+this.versionAvailable[this.appPlatform]),{cacheUpdate:!0}}}},{key:"actionVerb",value:function(){return this.touch?"tap":"click"}},{key:"actionVerbCaps",value:function(){return this.touch?"Tap":"Click"}},{key:"updateOrientation",value:function(){return this.orientation=90===Math.abs(window.orientation)?f.a.Orientation.Landscape:f.a.Orientation.Portrait,this.app||this.kbsize.set(this.orientation===f.a.Orientation.Portrait?this.kbsizePortrait:this.kbsizeLandscape),this.orientation}},{key:"isPageVisible",value:function(){return!this.pageVisibilityHidden||!document[this.pageVisibilityHidden]}},{key:"getUpdateMessages",value:function(t){for(var e=0,i=[],r=this.mobile?"versionMobile":"versionDesktop",a=(t||0)+1;a<=this[r];a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this[r+"Messages"][a];n&&i.push(n)}return i}},{key:"isFeatureEnabled",value:function(t){return this._features[t]}},{key:"recordAppSubVersion",value:function(t){this.appSubVersion=t}},{key:"getPlatformName",value:function(){return this.mac?"Mac":this.windows?"Windows":this.iphone?"iPhone":this.ipad?"iPad":this.android?"Android":"Chrome"}},{key:"getPlatformIcon",value:function(){return this.mac||this.iphone||this.ipad?"icon-apple":this.windows?"icon-windows":this.android?"icon-android":"icon-chrome"}},{key:"getActualWindowWidth",value:function(){return document.body&&document.body.clientWidth||this.android&&window.screen&&window.screen.width||0}},{key:"getActualWindowHeight",value:function(){return document.body&&document.body.clientHeight||this.android&&window.screen&&window.screen.height||0}},{key:"hasBetaFeatures",value:function(){return this.isDevURL}},{key:"isPlatformOnline",value:function(){return navigator.onLine}}]),e}(function t(){a()(this,t),this.onResize=new m.a});e.a=new A},function(t,e,i){"use strict";i.r(e);var r,a,n=i(7),o=i.n(n),u=i(8),s=i.n(u),h=i(17),d=i.n(h),c=i(9),v=i.n(c),y=i(24),g=i.n(y),l=i(18),p=i.n(l),m=i(0),f=i(137),k=i(21),A=i(1),S=function(){function t(){o()(this,t),this._localized=[],this._loadedDateFormat=void 0}return s()(t,[{key:"init",value:function(){var t=this,e=An.settings.dateFormat.get()||A.a.DateFormat.MDY;this._loadLocalized(e),An.settings.dateFormat.listen(function(e){t._loadLocalized(e||A.a.DateFormat.MDY),m.default.vmMain.parseAll(A.a.ChangeType.Auto),k.a.fireEvent("clearMeasureCacheAll",[]),An.PaneUpdateBatcher.updateAllItems(!1,!0)})}},{key:"parseDate",value:function(t,e){return Date.parse(this.normalizeDateString(t,e))}},{key:"parseDateDefaultFormat",value:function(t){return Date.parse(this.normalizeDateString(t,this.getCurrentDateFormat()))}},{key:"getFormat",value:function(t){try{m.default.PAssert(259,this._localized[t],"Invalid format request")}catch(e){m.default.reportError(e)}return this._localized[t]}},{key:"getCurrentDateFormat",value:function(){return this._loadedDateFormat||A.a.DateFormat.MDY}},{key:"_loadLocalized",value:function(t){if(this._loadedDateFormat=t,this._localized[A.a.DFormat.LongDayTime]="dddd h:mm tt",this._localized[A.a.DFormat.ShortTime]="h:mm tt",this._localized[A.a.DFormat.MonthDay]="MMM d",this._localized[A.a.DFormat.LongStrDate]="MMMM dd, yyyy",this._localized[A.a.DFormat.DayMonthDateYear]="ddd, MMM dd, yyyy",this._localized[A.a.DFormat.MonthDayLong]="MMMM d",this._localized[A.a.DFormat.MonthDayYearLong]="MMMM d, yyyy",t===A.a.DateFormat.MDY)this._localized[A.a.DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[A.a.DFormat.ShortDate]="MM/dd",this._localized[A.a.DFormat.MonthDayYear]="MM/dd/yy",this._localized[A.a.DFormat.MonthDayYearShort]="M/d/yy",this._localized[A.a.DFormat.DayYearTime]="MM/dd/yy h:mm tt",this._localized[A.a.DFormat.DayDate]="ddd M/d",this._localized[A.a.DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[A.a.DFormat.MonthDayShort]="M/d";else if(t===A.a.DateFormat.DMY)this._localized[A.a.DFormat.ShortDayTime]="dd/MM h:mm tt",this._localized[A.a.DFormat.ShortDate]="dd/MM",this._localized[A.a.DFormat.MonthDayYear]="dd/MM/yy",this._localized[A.a.DFormat.MonthDayYearShort]="d/M/yy",this._localized[A.a.DFormat.DayYearTime]="dd/MM/yy h:mm tt",this._localized[A.a.DFormat.DayDate]="ddd d/M",this._localized[A.a.DFormat.NoPadShortDayTime]="dd/M h:mm tt",this._localized[A.a.DFormat.MonthDayShort]="d/M";else if(t===A.a.DateFormat.DMYDot)this._localized[A.a.DFormat.ShortDayTime]="dd.MM h:mm tt",this._localized[A.a.DFormat.ShortDate]="dd.MM",this._localized[A.a.DFormat.MonthDayYear]="dd.MM.yy",this._localized[A.a.DFormat.MonthDayYearShort]="d.M.yy",this._localized[A.a.DFormat.DayYearTime]="dd.MM.yy h:mm tt",this._localized[A.a.DFormat.DayDate]="ddd d.M",this._localized[A.a.DFormat.NoPadShortDayTime]="dd.M h:mm tt",this._localized[A.a.DFormat.MonthDayShort]="d.M";else if(t===A.a.DateFormat.YMD)this._localized[A.a.DFormat.ShortDayTime]="MM/dd h:mm tt",this._localized[A.a.DFormat.ShortDate]="MM/dd",this._localized[A.a.DFormat.MonthDayYear]="yy/MM/dd",this._localized[A.a.DFormat.MonthDayYearShort]="yy/M/d",this._localized[A.a.DFormat.DayYearTime]="yy/MM/dd h:mm tt",this._localized[A.a.DFormat.DayDate]="ddd M/d",this._localized[A.a.DFormat.NoPadShortDayTime]="M/dd h:mm tt",this._localized[A.a.DFormat.MonthDayShort]="M/d";else if(t===A.a.DateFormat.YMDDot)this._localized[A.a.DFormat.ShortDayTime]="MM.dd h:mm tt",this._localized[A.a.DFormat.ShortDate]="MM.dd",this._localized[A.a.DFormat.MonthDayYear]="yy.MM.dd",this._localized[A.a.DFormat.MonthDayYearShort]="yy.M.d",this._localized[A.a.DFormat.DayYearTime]="yy.MM.dd h:mm tt",this._localized[A.a.DFormat.DayDate]="ddd M.d",this._localized[A.a.DFormat.NoPadShortDayTime]="M.dd h:mm tt",this._localized[A.a.DFormat.MonthDayShort]="M.d";else try{m.default.PAssert(260,!1,"Unsupport date format requested: "+t)}catch(e){m.default.reportError(e)}}},{key:"formatDate",value:function(t,e,i){try{m.default.PAssert(261,m.default.isDateValid(t),"Must provide a valid date to format")}catch(n){m.default.reportError(n)}try{m.default.PAssert(262,e,"Must provide a valid format for the date")}catch(n){m.default.reportError(n)}var r;if(m.default.isDateValid(t)){var a=t.toString(this.getFormat(e));r=i&&i!==this._loadedDateFormat?this.convertDateFormat(a,this._loadedDateFormat,i):a}return r}},{key:"_isParsedDateValid",value:function(t,e,i){var r=!0,a=m.default.parseInt(t),n=m.default.parseInt(e),o=m.default.parseInt(i);return void 0!==t&&a<13?r=!1:n<=0||n>12?r=!1:(o<=0||o>31)&&(r=!1),r}},{key:"_detectDelim",value:function(t){var e="/";return t.indexOf("-")>=0?e="-":t.indexOf(".")>=0&&(e="."),e}},{key:"convertDateFormat",value:function(t,e,i){try{m.default.PAssert(263,e,"Must provide a date format to convert from")}catch(v){m.default.reportError(v)}try{m.default.PAssert(264,i,"Must provide a date format to convert to")}catch(v){m.default.reportError(v)}var r=t;if(e!==i){var a,n,o=0;for(L.lastIndex=0,w.lastIndex=0,a=e===A.a.DateFormat.YMD||e===A.a.DateFormat.YMDDot?L:w;null!==(n=a.exec(r));){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var u,s,h,d,c=this._detectDelim(r);if(e===A.a.DateFormat.DMYDot?e=A.a.DateFormat.DMY:e===A.a.DateFormat.YMDDot&&(e=A.a.DateFormat.YMD),i===A.a.DateFormat.MDY)switch(e){case A.a.DateFormat.DMY:n[4]?(s=n[4],u=(h=n[3])+c+(d=n[2])+c+s):n[2]&&n[3]&&(u=(h=n[3])+c+(d=n[2]));break;case A.a.DateFormat.YMD:n[2]?(s=n[2],u=(h=n[3])+c+(d=n[4])+c+s):n[3]&&n[4]&&(u=(h=n[3])+c+(d=n[4]));break;default:try{m.default.PAssert(265,!1,"Invalid date format requested from MDY: ",e)}catch(v){m.default.reportError(v)}}else if(i===A.a.DateFormat.DMY)switch(e){case A.a.DateFormat.MDY:n[4]?(s=n[4],h=n[2],u=(d=n[3])+c+h+c+s):n[2]&&n[3]&&(h=n[2],u=(d=n[3])+c+h);break;case A.a.DateFormat.YMD:n[2]?(s=n[2],h=n[3],u=(d=n[4])+c+h+c+s):n[3]&&n[4]&&(h=n[3],u=(d=n[4])+c+h);break;default:try{m.default.PAssert(266,!1,"Invalid date format requested from DMY: ",e)}catch(v){m.default.reportError(v)}}else if(i===A.a.DateFormat.YMD)switch(e){case A.a.DateFormat.MDY:n[4]?u=(s=n[4])+c+(h=n[2])+c+(d=n[3]):n[2]&&n[3]&&(u=(h=n[2])+c+(d=n[3]));break;case A.a.DateFormat.DMY:n[4]?u=(s=n[4])+c+(h=n[3])+c+(d=n[2]):n[2]&&n[3]&&(u=(h=n[3])+c+(d=n[2]));break;default:try{m.default.PAssert(267,!1,"Invalid date format requested from YMD: ",e)}catch(v){m.default.reportError(v)}}else try{m.default.PAssert(268,!1,"Invalid date format requested: ",i)}catch(v){m.default.reportError(v)}u&&this._isParsedDateValid(s,h,d)&&(r=r.substr(0,n.index)+n[1]+u+r.substr(n.index+n[0].length))}}return r}},{key:"normalizeDateString",value:function(t,e){var i=t;return this.convertDateFormat(i,e,A.a.DateFormat.MDY)}},{key:"getAppendDateText",value:function(t,e,i){var r,a=Date.today();r=t<a||t.getFullYear()!==a.getFullYear()?this.getFormat(A.a.DFormat.MonthDayYearShort):this.getFormat(A.a.DFormat.MonthDayShort);var n=t.toString(r);if(e instanceof Date)r=0===e.getMinutes()?" htt":" h:mmtt",n+=e.toString(r);else if(m.default.isNumber(e)){var o=Math.floor(e),u=o%12;0===u&&(u=12),n+=" "+u+":"+m.default.pad2(60*(e-o))+(o>11?"pm":"am")}return isNaN(i)||(n+=" "+m.default.round(i,2)+"hr"),n}}]),t}(),w=/([\s]|^)(\d{1,2})[-\/.](\d{1,2})(?:[-\/.](\d{2,4}))?/g,L=/([\s]|^)(?:(\d{2,4})[-\/.])?(\d{1,2})(?:[-\/.](\d{1,2}))/g,F=S,C=i(15),I=i.n(C),P=i(3),N=i(68),H=i(16),M=(r=function(t){function e(){var t;return o()(this,e),(t=d()(this,v()(e).call(this))).styles={},t.stylesheet={},t.Themes={SpacingCompact:{itemLineHeight:18,itemPadding:3,itemIndentSize:20,fontSizeHeader:16,fontSizeHeaderTopLevel:16},SpacingComfortable:{itemLineHeight:18,itemPadding:5,itemIndentSize:30,fontSizeHeader:16,fontSizeHeaderTopLevel:18},PrefixesFaded:{projectOpacity:30,bulletOpacity:30,checkboxOpacity:25,checkboxBackgroundOpacity:0},PrefixesStrong:{projectOpacity:80,bulletOpacity:80,checkboxOpacity:80,checkboxBackgroundOpacity:20}},t.Defaults={Desktop:{noteLineHeight:18,notePadding:0,noteFontSize:12,grayscale:!1,boldHeaders:!1,fontSize:14,showVerticalLines:!0,verticalLinesOpacity:6,Colors:{light:{bulletColor:"#222222",projectColor:"#222222",verticalLinesColor:32,tagColor:"#0099DD",dateColor:"#AA3300",contactColor:"#22AA66",linkColor:"#3333BB",calendarLinesColor:"#E6E6E6"},dark:{bulletColor:"#F6F6F6",projectColor:"#F6F6F6",verticalLinesColor:255,tagColor:"#0099DD",dateColor:"#C9302C",contactColor:"#00AF4A",linkColor:"#539bd8",calendarLinesColor:"#444444"}}}},t.timeoutSettingChanged=void 0,t}return p()(e,t),s()(e,[{key:"init",value:function(){this.updateSettingValues(),P.a.mobile||(An.settings.ui.listen(this.onSettingChanged),this.updateStyles())}},{key:"getSettingValue",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=!e;if(e)if(An.billingManager.hasPremiumFeatures())i=!0;else{var r=An.billingManager.getPremiumStatus();i=r===A.a.PremiumStatus.Unknown||r===A.a.PremiumStatus.Trial||r===A.a.PremiumStatus.Active||r===A.a.PremiumStatus.Never}if(i){var a=An.settings.ui[t].get();return a===this.Defaults.Desktop.Colors.light[t]?this.Defaults.Desktop.Colors[this._colorTheme][t]:a}return this.getThemeValue(t)}},{key:"getThemeValue",value:function(t){var e=this.Themes.SpacingComfortable[t];return void 0===e&&(e=this.Themes.PrefixesFaded[t]),void 0===e&&(e=this.Defaults.Desktop[t]),void 0===e&&(e=this.Defaults.Desktop.Colors[this._colorTheme][t]),e}},{key:"setFromThemeValue",value:function(t,e){An.settings.ui[e].set(this.getThemeValue(e))}},{key:"updateSettingValues",value:function(){this._colorTheme=An.settings.ui.theme.get()||"Light",this._bulletColor=this.Defaults.Desktop.Colors[this._colorTheme].bulletColor,this._projectColor=this.Defaults.Desktop.Colors[this._colorTheme].projectColor,this._verticalLinesColor=this.Defaults.Desktop.Colors[this._colorTheme].verticalLinesColor,this._boldHeaders=this.getSettingValue(A.a.DisplaySettings.boldHeaders),this._showVerticalLines=this.getSettingValue(A.a.DisplaySettings.showVerticalLines),this._fontSize=this.getSettingValue(A.a.DisplaySettings.fontSize,!0),this._fontSizeHeader=this.getSettingValue(A.a.DisplaySettings.fontSizeHeader,!0),this._fontSizeHeaderTopLevel=this.getSettingValue(A.a.DisplaySettings.fontSizeHeaderTopLevel,!0),this._noteFontSize=this.getSettingValue(A.a.DisplaySettings.noteFontSize,!0),this._itemPadding=this.getSettingValue(A.a.DisplaySettings.itemPadding,!0),this._notePadding=this.getSettingValue(A.a.DisplaySettings.notePadding,!0),this._itemLineHeight=this.getSettingValue(A.a.DisplaySettings.itemLineHeight,!0),this._noteLineHeight=this.Defaults.Desktop.noteLineHeight,this._itemIndentSize=this.getSettingValue(A.a.DisplaySettings.itemIndentSize,!0),this._bulletOpacity=this.getSettingValue(A.a.DisplaySettings.bulletOpacity,!0),this._projectOpacity=this.getSettingValue(A.a.DisplaySettings.projectOpacity,!0),this._checkboxOpacity=this.getSettingValue(A.a.DisplaySettings.checkboxOpacity,!0),this._checkboxBackgroundOpacity=this.getSettingValue(A.a.DisplaySettings.checkboxBackgroundOpacity,!0),this._verticalLinesOpacity=this.getSettingValue(A.a.DisplaySettings.verticalLinesOpacity,!0),this._tagColor=this.getSettingValue(A.a.DisplaySettings.tagColor,!0),this._dateColor=this.getSettingValue(A.a.DisplaySettings.dateColor,!0),this._contactColor=this.getSettingValue(A.a.DisplaySettings.contactColor,!0),this._linkColor=this.getSettingValue(A.a.DisplaySettings.linkColor,!0),this._grayscale=this.getSettingValue(A.a.DisplaySettings.grayscale)}},{key:"onSettingChanged",value:function(){this.timeoutSettingChanged||this.isChangingTheme||(this.timeoutSettingChanged=setTimeout(this._updateSettings,0))}},{key:"_updateSettings",value:function(){var t=this._fontSize,e=this._fontSizeHeader,i=this._fontSizeHeaderTopLevel,r=this._noteFontSize;this.timeoutSettingChanged=void 0,this.updateSettingValues();var a=this._fontSize!==t||this._fontSizeHeader!==e||this._fontSizeHeaderTopLevel!==i||this._noteFontSize!==r;this.fireEvent("settingsChanged",[a]),An.PaneManager&&An.PaneManager.clearPaneCaches(),this.updateStyles(),m.default.vmMain&&An.PaneUpdateBatcher.updateAllItems(!1,!0)}},{key:"fontSize",value:function(){return P.a.isMobile?15:this._fontSize}},{key:"fontSizeHeader",value:function(){return this._fontSizeHeader}},{key:"fontSizeHeaderTopLevel",value:function(){return this._fontSizeHeaderTopLevel}},{key:"fontSizeHeaderProjectView",value:function(){return 17}},{key:"noteFontSize",value:function(){return this._noteFontSize}},{key:"itemPadding",value:function(){return this._itemPadding}},{key:"notePadding",value:function(){return this._notePadding}},{key:"itemLineHeight",value:function(){return this._itemLineHeight}},{key:"noteLineHeight",value:function(){return this._noteLineHeight}},{key:"itemIndentSize",value:function(){return this._itemIndentSize}},{key:"itemIndentStart",value:function(){return 45}},{key:"paddingForBlockHeader",value:function(){return 0}},{key:"paddingForItemBottom",value:function(t,e,i){return e.hasNote()?i&&i.isViewProject()&&i.isItemTopLevel(t,e)?this.itemPadding():0:this.itemPadding()}},{key:"paddingForItemTop",value:function(t,e){return e.isNote()?this.notePadding():this.itemPadding()}},{key:"fontSizeForItem",value:function(t,e,i){if(e.isPrefixHeader()){if(i.isItemTopLevel(t,e))return this.fontSizeHeaderTopLevel();if(i.isViewOutline())return this.fontSizeHeader()}else if(e.isNote())return this.noteFontSize();return this.fontSize()}},{key:"lineHeightForItem",value:function(t,e,i){var r=this.itemLineHeight()-this.fontSize();return e.isNote()?this.noteLineHeight():this.fontSizeForItem(t,e,i)+r}},{key:"boldHeaders",value:function(){return!!P.a.phone||this._boldHeaders}},{key:"createSheet",value:function(){var t=document.head||document.getElementsByTagName("head")[0],e=document.createElement("style");e.type="text/css",e.rel="stylesheet",t.appendChild(e),this.sheet=e.sheet}},{key:"changeColorTheme",value:function(t){t!==this._colorTheme&&(this._colorTheme=t,An.settings.ui.theme.set(t),this.updateSettingValues(),this.updateStyles(),this.fireEvent("themeChanged",[]))}},{key:"changeTheme",value:function(t,e){this.isChangingTheme=!0;var i=this.Themes[e];for(var r in i)i.hasOwnProperty(r)&&An.settings.ui[r].set(i[r]);t.set(e),this.isChangingTheme=!1,this._updateSettings()}},{key:"updateStyles",value:function(){var t=0;if(this.sheet){var e=this.sheet.ownerNode;e.parentNode.removeChild(e)}this.createSheet();var i=[];if(this.boldHeaders()&&i.push(".item:not(.overviewItem).pHeader { font-weight: bold; }"),this._showVerticalLines){var r=this.itemIndentSize(),a=this._verticalLinesColor,n="rgba("+a+","+a+","+a+",",o=n+.01*this._verticalLinesOpacity+")",u=n+"0)";i.push(".vertLines { background: repeating-linear-gradient(to right, "+u+" 0, "+o+" 1px, "+u+" 2px, "+u+" "+r+"px) }")}i.push(".item:not(.hasNote) .line.last .itemPrefix:not(.prefixTask):before { bottom: "+this.itemPadding()+"px; }"),i.push(".item:not(.hasNote) .line.last .prefixTask:before { bottom: "+(this.itemPadding()+(this.itemLineHeight()-18)/2)+"px; }"),i.push(".item .prefixTask:before { margin-top: "+(this.itemLineHeight()-14)/2+"px; }");var s="rgba("+m.default.hexToRgbStr(this._bulletColor)+","+.01*this._bulletOpacity+")";i.push(".prefixBullet:before { color: "+s+"; }");var h="rgba("+m.default.hexToRgbStr(this._projectColor)+","+.01*this._projectOpacity+")";i.push(".prefixHeader:before { color: "+h+"; }"),i.push(".collapser { color: "+s+"; }");var d="rgba("+m.default.hexToRgbStr(this._bulletColor)+","+.01*this._checkboxOpacity+")";i.push(".prefixTask { border-color: "+d+"; }");var c="rgba("+m.default.hexToRgbStr(this._bulletColor)+","+.01*this._checkboxBackgroundOpacity+")";i.push(".prefixTask:not(.searchButton) { background-color: "+c+"; }"),i.push(".c-tag { color: "+this._tagColor+";}"),i.push(".c-date { color: "+this._dateColor+";}"),i.push(".c-contact { color: "+this._contactColor+";}"),i.push(".c-link, .fancyContenteditable a    { color: "+this._linkColor+";}"),i.push(".calendarDayTimes { background-image: linear-gradient(to bottom, "+this.Defaults.Desktop.Colors[this._colorTheme].calendarLinesColor+" 1px, transparent 1px) !important; }"),An.settings.ui.underlineP.get()?m.default.addClass(document.body,"underlineTags"):m.default.removeClass(document.body,"underlineTags"),this._grayscale?m.default.addClass(document.body,"grayscale"):m.default.removeClass(document.body,"grayscale"),m.default.removeClass(document.body,"theme-light"),m.default.removeClass(document.body,"theme-dark"),m.default.addClass(document.body,"theme-"+this._colorTheme);for(var v=0;v<i.length;v++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.sheet.insertRule(i[v],0)}}},{key:"tagColor",value:function(){return this._tagColor}},{key:"dateColor",value:function(){return this._dateColor}},{key:"contactColor",value:function(){return this._contactColor}},{key:"noteColor",value:function(){return""}},{key:"isDark",value:function(){return"dark"===this._colorTheme}},{key:"isItemBold",value:function(t){return!1}},{key:"lineItemHeight",value:function(t,e,i,r){return m.default.isNumber(r)&&!e.isNote()||(r=1),this.paddingForItemTop(t,e)+this.paddingForItemBottom(t,e,i)+this.lineHeightForItem(t,e,i)*r}}]),e}(N.a),I()(r.prototype,"onSettingChanged",[H.a],Object.getOwnPropertyDescriptor(r.prototype,"onSettingChanged"),r.prototype),I()(r.prototype,"_updateSettings",[H.a],Object.getOwnPropertyDescriptor(r.prototype,"_updateSettings"),r.prototype),I()(r.prototype,"updateStyles",[H.a],Object.getOwnPropertyDescriptor(r.prototype,"updateStyles"),r.prototype),r),z=i(43),D=i.n(z),V=i(19),G=i(14),T=i(22),q=i(5),j=i(23),Y=i(6),X=i(45),Q=i(51),J=i(56),Z=i(54),B=i(35),$=i(57),U=i(10),R=i(33),E=i(55);function K(){this._favMap={}}K.prototype={_ensureGroup:function(t){var e=[];return this._favMap[t]||(this._favMap[t]=e),e},notifyAdd:function(t,e){var i=this._ensureGroup(e);try{m.default.PAssert(1512,i.indexOf(t)<0,"Should not double add item to group")}catch(r){m.default.reportError(r)}i.push(t)},notifyRemove:function(t,e){var i=this._ensureGroup(e);try{m.default.PAssert(1513,i.indexOf(t)>=0,"Must have been added to group before removing")}catch(r){m.default.reportError(r)}i.remove(t)},getItems:function(t){return this._favMap[t]},hasItems:function(t){var e=this.getItems(t);return e&&e.length>0}};var x,b=new K,O=i(65),W=new Date(9e12),_=(x=function(){function t(e,i){o()(this,t),V.a.binder(this,"sizeInPane","onInsertLink","onTouchHoldTimeout"),"dragScroll"in this&&V.a.binder(this,"dragScroll"),this.__ISVMLI=!0,this.isInitialized=!1;try{m.default.PAssert(1241,i,"Each VMLI must be given a set of additional info")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1242,m.default.isValidChangeType(i.changeType),"Must specify a valid change type when creating a VMLI")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1243,i.store,"Must supply a valid itemStore for each VMLI")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1244,!i.parent||i.parent._store===i.store,"All VMLIs in a tree must share the same owner")}catch(a){m.default.reportError(a)}if(this.__TEMP_InitCalled=!1,this.__TEMP_InitParseCalled=!1,this.__TEMP_ParseCalled=!1,this.__TEMP_SkippedInitParsed=!1,!e.id&&e.data&&e.data.id)e.id=e.data.id;else if(e.id&&e.data)try{m.default.PAssert(1245,e.id===e.data.id,"If passing in a local id and a remote ID, they should match")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1246,void 0===e.v,"We should never be passing in 'v'")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1247,void 0===e.extern,"We should never be passing in 'extern'")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1248,i.store,"Must specify a valid item store this item belongs to")}catch(a){m.default.reportError(a)}this._store=i.store,this._parent=i.parent,this._documentOwner=i.documentOwner,this._rawText=(e.data?"":e.text)||"",this._searchText=e.data?"":e.text?e.text.toLowerCase():"",this._parsedText=void 0,this._notePreviewText=void 0,this.els=void 0,this.id=void 0,this.index=e.index,this._isArchived=e.isArchived||!1,this.items=new R.a([],this.itemsHasMutated),this._note=void 0,this.itemChanged=new E.a,this._demandLoadChildren=e.demandLoadChildren||!1,this._loadedOnDemandData=!this._demandLoadChildren,this._paginationToken=void 0,this._canDestroy=i.canDestroy||!1,this._destroyed=!1,this._date=void 0,this._attachments=void 0,this.draggedInPane=new U.a;var r=e.flags;e.isNote&&(r|=A.a.VMLIFlag.Note),e.isComplete&&(r|=A.a.VMLIFlag.Complete),m.default.isDemoMode()&&(e.isStarred&&(r|=A.a.VMLIFlag.Starred),e.priority&&(r|=e.priority),e.isArchived),this.flags=new U.a(r),this.prefix=void 0,this._favorites=void 0,this.dateCreated=e.dateCreated?new Date(e.dateCreated):new Date,this.dateCompleted=e.dateCompleted?new Date(e.dateCompleted):void 0,this.dateModified=e.dateModified?new Date(e.dateModified):this.dateCreated,this._activeTags=void 0,this.isRoot=e.isRoot||i.isRoot,this._isDeleted=e.isDeleted||!1,this.highlightTimeout=void 0,this._version=A.a.UninitializedVersion,this._versionText=A.a.UninitializedVersion,this._versionRemote=void 0,this._versionRemoteText=void 0,this.lastFindPass=0,this.isEditable=new U.a(i.isEditable||!1),this.levelsDeep=new U.a(this._parent?this._parent.levelsDeep.get()+1:0),this.isHighlighted=new U.a,m.default.totalItems++,e.isArchived&&m.default.totalArchivedItems++,this._needsParse=!1,this.isLoaded=void 0,this.init(e,i),this.isInitialized=!0}return s()(t,[{key:"getReactKey",value:function(){return this._store.id+this.id}},{key:"notifyDemandLoadUpdate",value:function(t,e){t&&!this._loadedOnDemandData&&(e.requestDemandLoadData(this),this.notifyLoadedData())}},{key:"notifyLoadedData",value:function(){this._loadedOnDemandData=!0}},{key:"notifyLoadDataFailed",value:function(t){this.setCollapsed(!1,t,!1),this._loadedOnDemandData=!1}},{key:"isDemandLoad",value:function(){return this._demandLoadChildren}},{key:"isDemandNotYetLoaded",value:function(){return this._demandLoadChildren&&!this._loadedOnDemandData}},{key:"showInOverview",value:function(){return this.numItems()>0||this._demandLoadChildren}},{key:"paginationTokenInUse",value:function(){try{m.default.PAssert(1249,this._paginationToken,"Should always have a valid pagination token when beginning to load a data page")}catch(t){m.default.reportError(t)}return this._paginationToken.isInUse()}},{key:"hasPaginationToken",value:function(){return!!(this.flags.get()&A.a.VMLIFlag.HasPageToken)}},{key:"needsPaginationToken",value:function(){return!this.hasPaginationToken()&&!this._paginationToken}},{key:"setPaginationToken",value:function(t){try{m.default.PAssert(1250,t,"Should never be setting an undefined token - use clear instead")}catch(e){m.default.reportError(e)}try{m.default.PAssert(1251,!this._paginationToken,"Should never be overriding a pagination token - clear then set")}catch(e){m.default.reportError(e)}this._paginationToken=t,this.setFlags(this.flags.get()|A.a.VMLIFlag.HasPageToken)}},{key:"clearPaginationToken",value:function(){this._paginationToken&&this._paginationToken.isInUse()&&this._paginationToken.notifyEndUse(),this._paginationToken=void 0,this.setFlags(this.flags.get()&~A.a.VMLIFlag.HasPageToken)}},{key:"beginDataPageLoad",value:function(){try{m.default.PAssert(1253,this._paginationToken,"Should always have a valid pagination token when beginning to load a data page")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1254,!this._paginationToken.isInUse(),"Token should not already be in use when beginning a page load")}catch(t){m.default.reportError(t)}return this._paginationToken.notifyBeginUse(),this._paginationToken}},{key:"endDataPageLoad",value:function(t){try{m.default.PAssert(1256,this._paginationToken,"Should always have a valid pagination token when done loading a data page")}catch(e){m.default.reportError(e)}try{m.default.PAssert(1257,this._paginationToken.isInUse(),"Token should always be in use when running a request")}catch(e){m.default.reportError(e)}t?this._paginationToken.notifyEndUse():this.setFlags(this.flags.get()&~A.a.VMLIFlag.HasPageToken)}},{key:"notifyPaginationUpdate",value:function(){try{m.default.PAssert(1258,this._paginationToken,"Must have a valid token to get next page of data")}catch(t){m.default.reportError(t)}this._paginationToken&&m.default.focusedPane.requestDataPage(this)}},{key:"canHaveNote",value:function(){var t=this.belongsToItemStore(An.itemStoreManager.getDefaultItemStore()),e=this.belongsToItemStore(An.itemStoreManager.getTempItemStore());return t||e}},{key:"createNote",value:function(){try{m.default.PAssert(1259,!this.isNote(),"Should never create a note on a note item")}catch(e){m.default.reportError(e)}var t;return this.hasNote()?t=this.getNote():(t=this._store.createItemRaw({text:"",isNote:!0},{parent:this,documentOwner:this._documentOwner,changeType:A.a.ChangeType.AllLocal}),this.setNote(t,A.a.ChangeType.Local)),t}},{key:"hasNote",value:function(){return void 0!==this._note}},{key:"getNote",value:function(){try{m.default.PAssert(1260,this.hasNote(),"Must have a note to get one")}catch(t){m.default.reportError(t)}return this._note}},{key:"setNote",value:function(e,i){try{m.default.PAssert(1261,m.default.isValidChangeType(i),"Must supply a valid changeType")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1262,!e||this.belongsToSameItemStore(e),"Note must belong to the same item store")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1263,!this.isNote(),"Should never set a note on a note")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1264,!this._note||!e,"Should never set a note multiple times on a single item")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1265,!e||e.isNote(),"Should only set items that are notes as notes")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1266,!e||!e.isDeleted(),"Should note set a deleted note")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1267,!e||e instanceof t,"Note must be a valid VMLI")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1268,!e||e.parent()===this,"Should always have a valid parent set before setting note on item")}catch(a){m.default.reportError(a)}var r=this._note;this._note=e,this.shouldSave()&&(Y.e.beginAction(),G.a.setNote(this,e,r,i),Y.e.endAction()),k.a.fireEvent("itemNoteSet",[{item:this}]),this.itemsHasMutated()}},{key:"isNote",value:function(t){if(void 0===t)return this._isFlagHelper(A.a.VMLIFlag.Note);if(t!==this._isFlagHelper(A.a.VMLIFlag.Note)){var e=t?this.flags.get()|A.a.VMLIFlag.Note:this.flags.get()&~A.a.VMLIFlag.Note;this.setFlags(e)}}},{key:"addFavorite",value:function(t,e){this._favorites||(this._favorites=[]);try{m.default.PAssert(1269,this._favorites.indexOf(t)>=0,"Must not already be in the favorites group")}catch(r){m.default.reportError(r)}if(this._favorites.push(t),b.notifyAdd(this,t),this.shouldSave()){var i={favorites:this._favorites};G.a.saveItem(this,i,e,A.a.SaveFlag.Prop)}}},{key:"removeFavorite",value:function(t,e){try{m.default.PAssert(1270,this._favorites,"Must always have favorites defined before removing from item")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1271,this._favorites.indexOf(t)>=0,"Must already be in the favorites group")}catch(r){m.default.reportError(r)}if(this._favorites.remove(t),b.notifyRemove(this,t),this.shouldSave()){var i={favorites:this._favorites};G.a.saveItem(this,i,e,A.a.SaveFlag.Prop)}}},{key:"setFavorites",value:function(t,e){for(var i=0,r=0,a=(t||[]).removeArray(this._favorites),n=(this._favorites||[]).removeArray(t),o=0;o<n.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;b.notifyRemove(this,n[o])}for(o=0;o<a.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;b.notifyAdd(this,a[o])}if(this._favorites=t,this.shouldSave()){var u=0,s=[];for(o=0;o<t.length;o++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;s[o]=m.default.clone(t[o])}var h={favorites:s};G.a.saveItem(this,h,e,A.a.SaveFlag.Prop)}}},{key:"getFavorites",value:function(){return this._favorites}},{key:"shouldSave",value:function(){return this._shouldSave}},{key:"canDestroy",value:function(){return this._canDestroy}},{key:"getPadding",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;try{m.default.PAssert(1272,t&&t.getItem(),"Invalid pane")}catch(o){m.default.reportError(o)}if(this.isNote())return this.parent().getPadding(t,e,i);if(isNaN(i)){var r;if(e)r=1;else if(t.isSearchedFlat()){for(var a=0,n=this;n;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t.search.isFlatSearchResult(n)){r=n.levelsDeep.get()-1;break}n=n.parent()}try{m.default.PAssert(1273,!isNaN(r),"Item has no root depth",!!this.parent())}catch(o){m.default.reportError(o)}isNaN(r)&&(r=1)}else r=t.getItem().levelsDeep.get();i=this.levelsDeep.get()-r-(e?t.overviewPadLevels:1)}return this.getPaddingForLevel(i,t,e)}},{key:"getPaddingForLevel",value:function(t,e,i){var r;t=Math.max(t,0),r=i?A.a.OverviewPaddingStart+t*A.a.OverviewPaddingIncrement:An.DisplaySettings.itemIndentStart()+t*An.DisplaySettings.itemIndentSize();try{m.default.PAssert(1274,m.default.isNumber(r),"Must have a valid padding")}catch(a){m.default.reportError(a)}return r}},{key:"_updateStylePadding",value:function(t,e){try{m.default.PAssert(1275,this._parent,"Must have a valid parent to update padding, root should never change")}catch(u){m.default.reportError(u)}var i=t+(this.isNote()?0:1),r=this.levelsDeep.get()!==i;if(r||e){var a=0;r&&this.levelsDeep.set(i);for(var n=this.getItems(),o=0;o<n.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n[o]._updateStylePadding(i,e)}}}},{key:"setFlags",value:function(t){this.flags.set(t)}},{key:"getPriorityProps",value:function(){var t=this.flags.get();return A.a.PriorityClass[t&A.a.PMask]+" "}},{key:"styleProps",value:function(t,e){var i=this.flags.get(),r=this.isHeader()&&!e.isSearchedFlat()?"pHeader ":"";this.isPrefixHeader()?r+="itemHeader ":this.isPrefixTask()?r+="itemTask ":this.isPrefixBullet()?r+="itemBullet ":this.isPrefixNumList()&&(r+="itemNumList "),this.prefix&&(r+="hasPrefix "),e.isItemTopLevel(t,this)&&(r+="topLevel ");var a=!1;if(i&A.a.VMLIFlag.Complete?a=!0:!(i&A.a.VMLIFlag.Note)&&i&A.a.VMLIFlag.DisplayComplete&&(a=!0),a?(r+="pComplete ",e.search.isMatchStuckHiding(this)||(r+="pDisplayComplete c-foreground-super-faded c-before-super-faded ")):i&A.a.PMask?r+=A.a.PriorityClass[i&A.a.PMask]+" ":r+="pNormal ",i&A.a.VMLIFlag.Starred&&!(i&A.a.VMLIFlag.Complete||i&A.a.VMLIFlag.DisplayComplete)&&(r+="pStar c-star "),i&A.a.VMLIFlag.Note){r+="pNote c-foreground-faded ";var n=this.parent().flags.get();(n&A.a.VMLIFlag.Complete||n&A.a.VMLIFlag.DisplayComplete)&&(r+="pComplete c-foreground-super-faded c-before-super-faded "),n&A.a.PMask&&(r+=A.a.PriorityClass[n&A.a.PMask]+" "),n&A.a.VMLIFlag.Starred&&!(n&A.a.VMLIFlag.Complete||n&A.a.VMLIFlag.DisplayComplete)&&(r+="pStar c-star ")}var o=this.getAttachments();if(o)for(var u=0,s=0;s<o.length;++s){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var h=o[s];if(h.isLoaded()){var d=h.getPlugin().getCssClass(h,e);d&&(r+=d)}}return r}},{key:"onAttachmentIDChange",value:function(t,e){if(t.getPlugin().id===A.a.PluginID.GCalendar){var i=this.getMooDate();i&&(i.setGCalId(t.id),this.onMooDateUpdated(A.a.ChangeType.Local))}this.setText(this.getParsedText(),A.a.ChangeType.Local)}},{key:"onAttachmentUpdate",value:function(t,e,i){if(t.getPlugin()===An.pluginManager.getPluginGCalendar()){var r=this.getMooDate();if(r&&!r.getGCalCalendar()&&t.hasField("calendarID")){var a=t.getField("calendarID");if(r.setGCalCalendar(a),this.shouldSave()){var n={date:this._date?this._date.toData():null};G.a.saveItem(this,n,A.a.ChangeType.Local,A.a.SaveFlag.Text)}}}t.fieldsHaveParseEffect(e)&&(k.a.fireEvent("clearMeasureCacheItem",[this.id]),this.parseText(this.getRawText(),i),Z.a.beginBatch(this),Z.a.itemTextChanged(this))}},{key:"setAttachments",value:function(t,e,i){var r=!1;if(!this._attachments&&t&&(this._attachments=[]),this._attachments){for(var a=0,n=0,o=this._attachments,u=0;u<o.length;++u){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t.indexOf(o[u])<0&&(o[u].unsubscribe(this),o[u].notifyItemTextChanged(this,!0),this.shouldSave()&&o[u].markUnused(e),r=!0)}for(u=0;u<t.length;++u){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=t[u];if(o.indexOf(s)<0){if(s.shouldBeDeleted()){var h=s.getEmbedString(),d=this.getRawText().replace(h,"File failed to upload");return void this.setText(d,A.a.ChangeType.Local)}s.subscribe(this),this.shouldSave()&&s.markInUse(e),r=!0}}r&&(this._attachments=t)}r&&!1!==i&&this.itemChanged.notify()}},{key:"getAttachment",value:function(t){try{m.default.PAssert(1276,this._attachments,"Must have valid attachments in order to query")}catch(e){m.default.reportError(e)}if(this._attachments)return this._attachments[t]}},{key:"hasAttachment",value:function(t){if(this._attachments)for(var e=0,i=0;i<this._attachments.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(this._attachments[i].id===t)return!0}return!1}},{key:"hasPluginAttachment",value:function(t){try{m.default.PAssert(1277,t,"Must provide a valid plugin type to query")}catch(r){m.default.reportError(r)}if(this._attachments)for(var e=0,i=0;i<this._attachments.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(this._attachments[i].getPlugin().id===t)return!0}return!1}},{key:"getAttachmentByType",value:function(t){try{m.default.PAssert(1278,t,"Must provide a valid plugin type to query")}catch(a){m.default.reportError(a)}if(this._attachments)for(var e=0,i=0;i<this._attachments.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this._attachments[i];if(r.isType(t))return r}}},{key:"getAttachmentByPlugin",value:function(t){try{m.default.PAssert(1279,t,"Must provide a valid plugin type to query")}catch(a){m.default.reportError(a)}if(this._attachments)for(var e=0,i=0;i<this._attachments.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this._attachments[i];if(r.isPlugin(t))return r}}},{key:"getAttachments",value:function(){if(this._attachments&&this._attachments.length>0)return this._attachments}},{key:"hasAttachments",value:function(){return this._attachments&&this._attachments.length>0}},{key:"getNumAttachments",value:function(){return this._attachments?this._attachments.length:0}},{key:"hasAttachmentType",value:function(t){return An.pluginManager.hasAttachmentType(this,t)}},{key:"copyProperties",value:function(t){this.setStarred(t.isStarred(),A.a.ChangeType.Auto),this.setComplete(t.isComplete(),A.a.ChangeType.Auto),this.setPriority(t.getPriority(),A.a.ChangeType.Auto)}},{key:"moveNote",value:function(t,e){try{m.default.PAssert(1280,t.hasNote(),"Must have a note to move")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1281,!this.hasNote(),"Must not already have a note")}catch(r){m.default.reportError(r)}var i=t.getNote();t.setNote(void 0,e),i&&(i.setParent(this),this.setNote(i,e))}},{key:"parent",value:function(){return this._parent}},{key:"setParent",value:function(t){var e=this._parent;return this._parent=t,t&&t!==e&&this._updateStylePadding(this._parent.levelsDeep.get(),!1),this._parent}},{key:"getParser",value:function(){var t,e=this.getItemStore();return e&&(t=e.getParser()),t}},{key:"requireStoredEls",value:function(){var t=this.getItemStore();return!!t&&t.requireStoredEls()}},{key:"getItemStore",value:function(){try{m.default.PAssert(1282,this._store,"Should never be getting the item store from a destroyed VMLI")}catch(t){m.default.reportError(t)}return this._store}},{key:"belongsToSameItemStore",value:function(t){return this.getItemStore()===t.getItemStore()}},{key:"belongsToItemStore",value:function(t){return this.getItemStore()===t}},{key:"notifyItemPropertyChanged",value:function(t,e){if(this.hasAttachments())for(var i=0,r=this.getAttachments(),a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r[a].notifyItemPropertyChanged(this,t,e)}}},{key:"unArchiveIntoItem",value:function(t,e){this._documentOwner.unArchiveItem(this,t,e)}},{key:"archiveSelf",value:function(t){this._documentOwner.archiveItem(this,t)}},{key:"isArchived",value:function(){return this._isArchived}},{key:"setArchived",value:function(t){this._isArchived=t}},{key:"isHidden",value:function(t){try{m.default.PAssert(1283,t,"Must specify the pane for the item being checked")}catch(e){m.default.reportError(e)}try{m.default.PAssert(1284,!t||t.search,"Pane search obj must exist: ",t.isDestroyed())}catch(e){m.default.reportError(e)}return!(!t||!t.search)&&!t.search.isMatched(this)}},{key:"getRawText",value:function(){return this._rawText}},{key:"getParsedText",value:function(){try{m.default.PAssert(1285,!1===this._needsParse,"Text should be parsed before calling get")}catch(t){m.default.reportError(t)}return void 0!==this._parsedText?this._parsedText:this._rawText}},{key:"getSearchText",value:function(t){if(t){var e=t.search.getItemSearchText(this);if(e)return e}try{m.default.PAssert(1286,void 0!==this._searchText,"Item should always have search text")}catch(i){m.default.reportError(i)}return this._searchText}},{key:"setRawText",value:function(t){void 0!==t&&null!==t||(t="");try{m.default.PAssert(1287,t.indexOf(A.a.AttachChar)<0,"Should never have an AttachChar present in raw text")}catch(e){m.default.reportError(e)}this._rawText=t,this._searchText=this.generateSearchText(),this._parsedText=void 0,this._notePreviewText=void 0,this._needsParse=!0}},{key:"setParsedText",value:function(t){this._parsedText=t,this._needsParse=!1,this._searchText=this.generateSearchText()}},{key:"generateSearchText",value:function(){var t=this.getParsedTextWithoutPrefix().toLowerCase();return this.hasAttachments()?this._generateUsableText(t,"getTitleString").replace(/[\*_]/g,"").toLowerCase():t}},{key:"getPriority",value:function(t){if(t){var e=t.search.getItemPriority(this);if(void 0!==e)return e}return this.flags.get()&A.a.PMask}},{key:"setPriority",value:function(t,e){try{m.default.PAssert(1289,m.default.isValidChangeType(e),"Must supply a valid changetype when completing an item: "+e)}catch(o){m.default.reportError(o)}try{m.default.PAssert(1290,null===t||A.a.PriorityClass[t],"Priority must be defined in globals")}catch(o){m.default.reportError(o)}var i=this.getPriority();if(t!==i){var r=this.flags.get(),a=r&~A.a.PCMask|t;if(r&A.a.VMLIFlag.Complete&&(a&=~A.a.VMLIFlag.Complete),this.setFlags(a),this.shouldSave()){var n={flags:a};G.a.saveItem(this,n,e,A.a.SaveFlag.Text)}this.notifyItemPropertyChanged(e,"priority"),Z.a.itemSearchChanged(this),Y.e.performAction(Y.c.Update,{itemID:this.id,field:"priority",newValue:t,oldValue:i})}}},{key:"isScheduled",value:function(){return!!this._date}},{key:"getDuration",value:function(t,e){if(t){var i=t.search.getItemDuration(this);if(i)return i}if(this._date)return this._date.duration||A.a.DefaultEventDuration}},{key:"setDuration",value:function(t){this._date?this._date.setDuration(t):this._date=new $.a(void 0,{duration:t})}},{key:"getEndDate",value:function(t){if(this._date)return this._date.getEnd()}},{key:"isMultidayEvent",value:function(){var t=!1;if(this.getDate()&&this.getDuration()>0){var e=this.getEndDate();this.getDate().isSameDay(e)||(t=!0)}return t}},{key:"getStickySearchInfo",value:function(){return{prefix:this.getPrefix(),date:this.getDate(),duration:this.getDuration(),tagsLower:this.getTagsLower(),contacts:this.getContacts(),searchText:this.getSearchText(),priority:this.getPriority(),isComplete:this.isComplete(),isStarred:this.isStarred()}}},{key:"onMooDateUpdated",value:function(t){var e=this;if(An.timeline.updateNotifications(this),m.default.isFlagSet(t,A.a.ChangeType.ItemLoad)||Z.a.itemDateChanged(this),this.itemChanged.notify(),this.shouldSave()||this._attachments){var i={date:this._date?this._date.toData():null};m.default.timeoutOnce("setMooDate",function(){e.shouldSave()&&G.a.saveItem(e,i,t,A.a.SaveFlag.Text),e._attachments&&m.default.isLocalChange(t)&&e._attachments.forEach(function(t){t.getPlugin().id===A.a.PluginID.GCalendar&&t.notifyItemDateChanged(e)})},500)}}},{key:"setMooDate",value:function(t,e,i){if(this._date&&t?this._date.copyFrom(t):this._date=t,!1!==i){var r=this.getRawText();this.onMooDateUpdated(e),!t&&r.includes(A.a.CharDate)&&(r=m.default.trimRight(r.replace(new RegExp(A.a.CharDate,"g"),"").replace(/'  '/g," ")),this.setText(r,e)),m.default.isLocalChange(e)&&Y.e.miscAction({type:Y.c.Misc,misc:Y.a.ChangeDate,data:{itemID:this.id,date:this._date}})}}},{key:"setDate",value:function(t,e,i){if(this._date)t!==this._date.getDate()&&(this._date.setDate(t),this._date.setDuration(e),this.onMooDateUpdated(i));else if(this.setMooDate(new $.a(t),i),this.getRawText().indexOf(A.a.CharDate)<0){this.getParsedText();this.setText(this.getParsedText()+" "+A.a.CharDate,A.a.ChangeType.Local)}}},{key:"getMooDate",value:function(){return this._date}},{key:"getNextDate",value:function(t){return this._date?this._date.getNext(t):void 0}},{key:"getDate",value:function(t){if(t){var e=t.search.getItemDate(this);if(e)return e}return this._date?this._date.getDate():void 0}},{key:"allDayDate",value:function(){return!!this._date&&!this._date.getTime()}},{key:"_isFlagHelper",value:function(t,e){if(void 0===e)return!!(this.flags.get()&t);var i=e?this.flags.get()|t:this.flags.get()&~t;this.setFlags(i)}},{key:"isDeleted",value:function(){return this._isDeleted}},{key:"setDeleted",value:function(t,e){var i=0;try{m.default.PAssert(1291,m.default.isValidChangeType(e),"Must supply a valid changetype to delete an item: "+e)}catch(u){m.default.reportError(u)}this._isDeleted=t;for(var r=0;this._favorites&&r<this._favorites.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var a=this._favorites[r];t?b.notifyRemove(this,a):b.notifyAdd(this,a)}if(this._attachments){var n=0,o=this._attachments;for(r=0;r<o.length;++r){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t?(o[r].unsubscribe(this),this.shouldSave()&&o[r].markUnused(e)):(o[r].subscribe(this),this.shouldSave()&&o[r].markInUse(e))}}}},{key:"isImportant",value:function(t){return this.getPriority(t)}},{key:"forceComplete",value:function(t,e){return this.setComplete(t,e,!0)}},{key:"isDisplayComplete",value:function(){return this._isFlagHelper(A.a.VMLIFlag.DisplayComplete)}},{key:"computeDisplayComplete",value:function(){var t=this.parent(),e=t&&!this.isComplete()&&(t.isComplete()||t._isFlagHelper(A.a.VMLIFlag.DisplayComplete));this._isFlagHelper(A.a.VMLIFlag.DisplayComplete,e)}},{key:"propagateDisplayComplete",value:function(){var t=0;this.computeDisplayComplete();for(var e=0;e<this.numItems();e++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.itemAtIndex(e);i.isComplete()||i.propagateDisplayComplete()}}},{key:"isComplete",value:function(){return this._isFlagHelper(A.a.VMLIFlag.Complete)&&(!this.isRepeatDate()||this.dateCompleted&&this.dateCompleted.getTime()===W.getTime())}},{key:"setComplete",value:function(t,e,i){var r=t,a={};try{m.default.PAssert(1292,m.default.isValidChangeType(e),"Must supply a valid changetype when completing an item: "+e)}catch(n){m.default.reportError(n)}t?(this.isRepeatDate()?(this._date.complete(),this.onMooDateUpdated(e),r=!1,An.toasts.pushMessage({text:"Completed. Next occurrence: "+O.a.toHumanText(this._date.getNext()),action:A.a.MessageAction.Undo,hold:!1})):this.dateCompleted||(this.dateCompleted=new Date,a.dateCompleted=this.getDateCompletedTime()),m.default.isLocalChange(e)&&m.default.aggregateEvent("ItemCompleted")):(this.dateCompleted=void 0,a.dateCompleted=null),this._isFlagHelper(A.a.VMLIFlag.Complete,r),m.default.isRemoteChange(e)||(a.flags=this.flags.get(),this.shouldSave()&&G.a.saveItem(this,a,e,A.a.SaveFlag.Text),Y.e.performAction(Y.c.Update,{itemID:this.id,field:"isComplete",newValue:t,oldValue:!t})),this.notifyItemPropertyChanged(e,"isComplete"),this.propagateDisplayComplete(),An.timeline.updateNotifications(this),Z.a.itemSearchChanged(this)}},{key:"setStarred",value:function(t,e){if(void 0!==t){try{m.default.PAssert(1293,m.default.isValidChangeType(e),"Must supply a valid changetype when completing an item: "+e)}catch(n){m.default.reportError(n)}if(t!==this._isFlagHelper(A.a.VMLIFlag.Starred)){var i=this.flags.get();t&&i&A.a.VMLIFlag.Complete&&(i&=~A.a.VMLIFlag.Complete);var r=t?i|A.a.VMLIFlag.Starred:i&~A.a.VMLIFlag.Starred;this.setFlags(r);var a={flags:r};this.shouldSave()&&G.a.saveItem(this,a,e,A.a.SaveFlag.Text),this.notifyItemPropertyChanged(e,"isStarred"),Z.a.itemSearchChanged(this),Y.e.performAction(Y.c.Update,{itemID:this.id,field:"isStarred",newValue:t,oldValue:!t})}}}},{key:"isStarred",value:function(t){if(t){var e=t.search.getItemStarred(this);if(void 0!==e)return e}return this._isFlagHelper(A.a.VMLIFlag.Starred)}},{key:"isHeader",value:function(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)}},{key:"getVisibleChildren",value:function(t){if(!this.isNote()){for(var e=0,i=this.getItems(),r=[],a=0;a<i.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;i[a].isHidden(t)||r.push(i[a])}return r}}},{key:"hasVisibleChildren",value:function(t){if(this.isNote())return!1;for(var e=0,i=this.getItems(),r=0;r<i.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(!i[r].isHidden(t))return!0}return!1}},{key:"hasHeaderChildren",value:function(){if(this.isNote())return!1;for(var t=0,e=this.getItems(),i=0;i<e.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e[i].isHeader())return!0}return!1}},{key:"getCollapsedField",value:function(t,e){return e?A.a.PerPaneStateField.CollapsedOverview:t.collapsedFieldName}},{key:"isCollapsed",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;try{m.default.PAssert(1294,t,"Must specify the pane for the item being checked for collapsed")}catch(a){m.default.reportError(a)}if(!t||!e&&t.isSearchedFlat())return!1;var r=!i&&t.isSearchedText()?t.getPerPaneState(this.id,A.a.PerPaneStateField.CollapsedSearch):void 0;return void 0===r&&void 0===(r=t.getPerPaneState(this.id,this.getCollapsedField(t,e)))&&(r=this.isDemandLoad()?0===this.numItems()||!t.isSearched()&&!e:t.getCollapsedDefault(this,e)),!!r}},{key:"setCollapsed",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0;try{m.default.PAssert(1295,e,"Must specify the pane for the item being checked for collapsed")}catch(n){m.default.reportError(n)}if(!e)return!1;var a=this.isCollapsed(e,i);void 0!==t&&(t&&!this.isCollapsible()||(e.isSearchedText()&&e.setPerPaneState(this.id,A.a.PerPaneStateField.CollapsedSearch,void 0),e.setPerPaneState(this.id,this.getCollapsedField(e,i),t),!1!==r&&An.PaneManager.updatePaneStateForPane(e),Y.e.performAction(Y.c.Update,{itemID:this.id,field:"isCollapsed",pane:e,newValue:t,oldValue:a}),this.isDemandLoad()&&this.notifyDemandLoadUpdate(!t,m.default.focusedPane),t!==a&&e.updateItems())),this.itemChanged.notify()}},{key:"setCollapsedQuiet",value:function(t,e){e.setPerPaneState(this.id,this.getCollapsedField(e,!1),t)}},{key:"toggleCollapsed",value:function(t){try{m.default.PAssert(1296,t,"Must specify the pane that this item is being collapsed in")}catch(e){m.default.reportError(e)}k.a.fireEvent("clearMeasureCacheItem",[this.id]),this.setCollapsed(!this.isCollapsed(t,!1),t,!1)}},{key:"isCollapsible",value:function(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)}},{key:"isDraggable",value:function(){return!this.isNote()}},{key:"setTags",value:function(t,e){var i=this._activeTags&&!t&&this._activeTags||!this._activeTags&&t&&t||m.default.arrayDiff(this._activeTags,t);this._activeTags=t,this._activeTagsLower=t?t.map(function(t){return t.toLowerCase()}):void 0,i&&i.length>0&&!m.default.isFlagSet(e,A.a.ChangeType.ItemLoad)&&Z.a.itemTagsChanged(this,i)}},{key:"getTags",value:function(){return this._activeTags}},{key:"getTagsLower",value:function(t){if(t){var e=t.search.getItemTagsLower(this);if(e)return e}return this._activeTagsLower}},{key:"setContacts",value:function(t,e){var i=!(this._activeContacts&&t&&this._activeContacts.equals(t));this._activeContacts=t,i&&!m.default.isFlagSet(e,A.a.ChangeType.ItemLoad)&&Z.a.itemSearchChanged(this)}},{key:"getContacts",value:function(t){if(t){var e=t.search.getItemContacts(this);if(e)return e}return this._activeContacts}},{key:"hasCompletedAncestor",value:function(){for(var t=0,e=this.parent();e;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(e.isComplete())return!0;e=e.parent()}}},{key:"hasTime",value:function(){return this._date&&!!this._date.getTime()}},{key:"getTimeOfDay",value:function(){return this._date?this._date.getTime():this.dateCompleted?this.dateCompleted.getTimeOfDay():0}},{key:"_formatDateTime",value:function(t){return t.toString(An.International.getFormat(A.a.DFormat.ShortTime))}},{key:"getDisplayDateWithDuration",value:function(t,e){var i=this,r=this.getDate(e);if(r){var a=this.getEndDate(e);r=r.clone().clearTime().equals(r)?r:a.clone().clearTime().equals(r)?a:r}else if(this.isRepeatDate()){var n=this.getMooDate();n&&(r=n.getNext(t))}try{m.default.PAssert(1297,r,"No display date with duration",function(){return i.getMooDate()&&i.getMooDate().toData()})}catch(o){m.default.reportError(o)}return r}},{key:"getTime",value:function(){var t="",e=this.getNextDate();if(this.dateCompleted&&this.isComplete())t=this._formatDateTime(this.dateCompleted);else if(e){var i;if(e.hasTimeOfDay())this.getDuration()>0&&(i=this.getDisplayDateWithDuration()),i?i.equals(e)?t="<div>"+this._formatDateTime(e)+'</div><div class="c-foreground-very-faded">'+this._formatDateTime(this.getEndDate())+"</div>":i.equals(this.getEndDate())&&(t="Ends "+this._formatDateTime(this.getEndDate())):t=this._formatDateTime(e)}return t}},{key:"createDateString",value:function(t){return t.isBefore(Date.today().addWeeks(1))?t.toString(An.International.getFormat(A.a.DFormat.LongDayTime)):t.toString(An.International.getFormat(A.a.DFormat.ShortDayTime))}},{key:"fullTime",value:function(){var t=this.getDate();if(!t)return"";this.createDateString(t)}},{key:"init",value:function(t,e){this._shouldSave=!(e&&e.noSave);try{m.default.PAssert(1298,!this._shouldSave||!this._demandLoadChildren,"Should never be saving results of demand loaded items")}catch(a){m.default.reportError(a)}if(this.id=t.id||G.a.generateID(),t.date){var i=t.date instanceof $.a?t.date.clone():$.a.fromData(t.date);i?this._date=i:m.default.reportError(new Error("Initial invalid date: "+t.date))}t.dateCompleted&&(this.dateCompleted=new Date(t.dateCompleted)),t.favorites&&this.setFavorites(t.favorites,e.changeType),this.computeDisplayComplete(),(t.items&&t.items.length>0||t.note)&&this.updateItems(t.items,t.note,e.changeType),this.__TEMP_InitCalled=!0;try{m.default.PAssert(1299,e,"Missing required properties in extraInfo")}catch(a){m.default.reportError(a)}var r=e?e.changeType:A.a.ChangeType.Auto;try{m.default.PAssert(1300,m.default.isValidChangeType(r),"Must supply a valid changetype to VMLIs")}catch(a){m.default.reportError(a)}(this.__TEMP_InitParseCalled=!0,this.shouldSave()&&!m.default.isAutoChange(e.changeType))?(m.default.isLocalChange(e.changeType)?A.a.SaveFlag.All:A.a.SaveFlag.None,this.getItemStore().trackGlobally()&&G.a.setItem(this)):this.getItemStore().trackGlobally()&&G.a.setItem(this);this.parseText(this.getRawText(),e.changeType|A.a.ChangeType.ItemLoad),m.default.isLocalChange(e.changeType)&&m.default.aggregateEvent("ItemCreated")}},{key:"onLoad",value:function(t){this.isLoaded||(!this.isDemandLoad()||this.isCollapsed(t,!1)||t.isSearched()||this.notifyDemandLoadUpdate(!0,t),this.isLoaded=!0)}},{key:"destroy",value:function(){try{m.default.PAssert(1301,this._canDestroy,"VMLI must be explicitly marked as destroyable")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1302,!this.shouldSave()||m.default.isDemoMode(),"Should never destory a saveable VMLI")}catch(a){m.default.reportError(a)}var t=this.getItemStore();if(this._destroyed=!0,this._attachments){for(var e=0,i=this._attachments,r=0;r<i.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;i[r].unsubscribe(this)}this._attachments=void 0}t.trackGlobally()&&G.a.clearItem(this.id),this.items.unlisten(this.itemsHasMutated),Z.a.itemSearchChanged(this),this._store=void 0,V.a.destroy(this)}},{key:"isDestroyed",value:function(){return this._destroyed}},{key:"isFullscreen",value:function(){return m.default.focusedItem===this}},{key:"findItem",value:function(t){var e=this.getIndexOf(t.id);if(e>=0)return{index:e,arr:this.items,isArchived:!1}}},{key:"updateItems",value:function(e,i,r){var a=!1;if(e&&e.length>0){var n=0;try{m.default.PAssert(1303,!this.hasChildren(),"Update items should only be called from initialize when there are no items already loaded")}catch(l){m.default.reportError(l)}for(var o=0;o<e.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=e[o],s=void 0;if(u instanceof t?s=u:m.default.isString(u)&&(s=G.a.getItem(u)),s){var h=G.a.getItem(s.parent().id);if(h&&h.id!==this.id){var d=h.items.indexOf(s.id);try{m.default.PAssert(1306,-1===d,"Expect that the old parent has been notified")}catch(l){m.default.reportError(l)}var c=s.getIndex();c>-1&&s.parent().removeChildAtIndex(c,r)}s.setParent(this)}else if("object"!==D()(u)){var v=G.a.getItemDataLocal(this._documentOwner,u);try{m.default.PAssert(1304,v,"Referenced item doesn't exist",u)}catch(l){m.default.reportError(l)}v&&(s=this._store.createItemRaw(v,{documentOwner:this._documentOwner,parent:this,changeType:r}))}else{try{m.default.PAssert(1305,u,"Item must exist otherwise we arent creating anything")}catch(l){m.default.reportError(l)}u&&(s=this._store.createItemRaw(u,{documentOwner:this._documentOwner,parent:this,changeType:r}))}try{m.default.PAssert(1307,s,"There must be a model at this point")}catch(l){m.default.reportError(l)}if(s){if(s.isNote()){i=s.id;continue}a=!0,this.items.push(s)}}}if(i){try{m.default.PAssert(1308,!this._note,"Must not already have a valid note set")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1309,m.default.isString(i)||m.default.isObject(i),"Note must be a valid ID")}catch(l){m.default.reportError(l)}var y;if(m.default.isString(i)){if(!(y=G.a.getItem(i))){var g=G.a.getItemDataLocal(this._documentOwner,i);try{m.default.PAssert(1310,g,"Referenced note doesn't exist",i)}catch(l){m.default.reportError(l)}g&&(g=Object.assign({isNote:!0},g),y=this._store.createItemRaw(g,{documentOwner:this._documentOwner,parent:this,changeType:r}))}}else m.default.isObject(i)&&(y=this._store.createItemRaw(i,{documentOwner:this._documentOwner,parent:this,changeType:r}));try{m.default.PAssert(1311,y,"Must have a valid note VM at this point")}catch(l){m.default.reportError(l)}this._note=y,a=!0}a&&this.itemsHasMutated()}},{key:"addItemAtIndex",value:function(t,e,i){try{m.default.PAssert(1312,i,"Must pass pane when adding item at index")}catch(a){m.default.reportError(a)}Y.e.beginAction();var r=i.createVMLI(t,{documentOwner:this._documentOwner,parent:this,changeType:A.a.ChangeType.AllLocal,isEditable:!0});return this.insertItem(r,e),Y.e.performAction(Y.c.Create,{itemID:r.id,parent:this.id,position:isNaN(e)?this.numItems()-1:e,text:t.text}),this.isCollapsed(i,!1)&&this.setCollapsed(!1,i),Y.e.endAction(),r}},{key:"insertItem",value:function(t,e,i){try{m.default.PAssert(1313,!this.isNote(),"Notes cannot use this function")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1314,t,"Must specify a valid item to be inserted")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1315,this!==t,"Should not insert an item into itself")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1316,this.belongsToSameItemStore(t),"Items must belong to the same item store")}catch(r){m.default.reportError(r)}this!==t&&(isNaN(e)||e<0?this.items.push(t):this.items.splice(e,0,t),this.shouldSave()&&G.a.addItem(this,t,e,i))}},{key:"insertSorted",value:function(t,e,i){try{m.default.PAssert(1317,!this.isNote(),"Notes cannot use this function")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1318,t,"Must specify a valid item to be inserted")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1319,e,"Must supply a valid comparator")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1320,this.belongsToSameItemStore(t),"Items must belong to the same item store")}catch(a){m.default.reportError(a)}var r=this.items.insertSorted(t,e,i);this.shouldSave()&&G.a.addItem(this,t,r)}},{key:"moveTo",value:function(e,i){var r=e.parent,a=e.index,n=e.shouldBeArchived;e.noVersion,e.underlying,e.fromTab;try{m.default.PAssert(1321,r instanceof t,"New parent must be a valid VMLI")}catch(c){m.default.reportError(c)}void 0===a&&(a=-1),void 0===n&&(n=!1);var o=this.parent(),u=o.findItem(this),s=this.index;if(u){var h=a;if(o===r){if(u.index===h)return;u.index<h&&h--}An.PaneUpdateBatcher.beginUpdateItems(),u.arr.splice(u.index,1),Z.a.itemSearchChanged(this);var d=r.items;h<0?d.push(this,!1):d.splice(h,0,this,!1),this.setParent(r),d.notify(),this.hasNote()&&this.getNote().itemChanged.notify(),An.PaneUpdateBatcher.commitUpdateItems();try{m.default.PAssert(1322,this.shouldSave(),"Item must be marked as saveable")}catch(c){m.default.reportError(c)}try{m.default.PAssert(1323,o.shouldSave(),"Old parent must be marked as saveable")}catch(c){m.default.reportError(c)}try{m.default.PAssert(1324,this.parent().shouldSave(),"New parent must be marked as saveable")}catch(c){m.default.reportError(c)}this.shouldSave()&&G.a.moveItem(this,o,s,i),o.propagateDisplayComplete(),r.propagateDisplayComplete()}}},{key:"getItemsArrayForSave",value:function(){var t=0;try{m.default.PAssert(1325,!this.isNote(),"Notes cannot use this function")}catch(a){m.default.reportError(a)}for(var e=[],i=this.getItems(),r=0;r<i.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e.push(i[r].id)}return e}},{key:"getDateTime",value:function(){if(this.getDate())return this.getDate().getTime()}},{key:"getDateCompletedTime",value:function(){if(this.dateCompleted)return this.dateCompleted.getTime()}},{key:"isForceCompleted",value:function(){return!(!this.dateCompleted||!this.dateCompleted.equals(W))}},{key:"getMetaTextSaveData",value:function(){this.getDate();return{date:this._date?this._date.toData():void 0,dateCompleted:this.getDateCompletedTime()}}},{key:"_generateNotificationEntry",value:function(t){var e,i=t.toJSON(),r=new Date(t);try{m.default.PAssert(1326,m.default.isDateValid(r),"Must provide a valid alert date: "+t)}catch(a){m.default.reportError(a)}return e=t.hasTimeOfDay()?r.addMinutes(-An.settings.notificationDelay.get()).toJSON():r.addDays(-1).clearTime().addHours(17).toJSON(),{id:this.id,text:this.getParsedTextWithoutPrefix(),date:i,alertDate:e}}},{key:"getNotificationEntry",value:function(){try{m.default.PAssert(1327,this.getNextDate(),"Must have a valid date")}catch(e){m.default.reportError(e)}try{m.default.PAssert(1328,!this.allDayDate(),"All day dates should not be scheduled")}catch(e){m.default.reportError(e)}if(!this.allDayDate())try{var t=this.getNextDate();if(t)return this._generateNotificationEntry(t)}catch(i){return void m.default.reportError(i)}}},{key:"getDebugData",value:function(){return{id:this.id,parent:this._parent?this._parent.id:void 0,items:this.isNote()?void 0:this.getItemsArrayForSave(),text:this.getRawText(),note:this.hasNote()?this.getNote().id:void 0,isNote:this.isNote(),isDeleted:this.isDeleted()}}},{key:"getFullSaveData",value:function(){try{m.default.PAssert(1329,this.shouldSave(),"Item must be marked as saveable")}catch(e){m.default.reportError(e)}var t={id:this.id,index:this.index,text:this.getRawText(),date:this._date?this._date.toData():void 0,dateCreated:this.dateCreated.getTime(),dateModified:this.dateModified.getTime(),dateCompleted:this.getDateCompletedTime(),flags:this.flags.get(),isRoot:this.isRoot,docId:this._documentOwner.id,note:this.hasNote()?this.getNote().id:void 0,isArchived:this.isArchived()||void 0,isDeleted:void 0,parent:this.parent()?this.parent().id:void 0};return Object.keys(t).forEach(function(e){void 0===t[e]&&delete t[e]}),t}},{key:"highlight",value:function(){var t=this;this.highlightTimeout?(this.isHighlighted.set(!1),clearTimeout(this.highlightTimeout),this.highlightTimeout=void 0,setTimeout(function(){t.isHighlighted.set(!0)},0)):this.isHighlighted.set(!0),this.highlightTimeout=setTimeout(function(){t.isHighlighted.set(!1)},2e3)}},{key:"removeChild",value:function(t,e){try{m.default.PAssert(1330,!this.isNote(),"Notes cannot use this function")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1331,!t.isNote(),"Do not use remove child to remove notes from items")}catch(r){m.default.reportError(r)}var i=this.items.remove(t);if(i>=0)this.shouldSave()&&G.a.deleteItem(this,t,i,e,!1);else{try{m.default.PAssert(1332,!1,"Child not found in parent")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1333,this===t.parent(),"Parent of child is not set to this item, should not remove: "+t.parent())}catch(r){m.default.reportError(r)}}return i}},{key:"removeChildAtIndex",value:function(t,e){try{m.default.PAssert(1334,!this.isNote(),"Notes cannot use this function")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1335,!this.itemAtIndex(t).isArchived())}catch(r){m.default.reportError(r)}var i=this.items.removeAt(t);return this.shouldSave()&&G.a.deleteItem(this,i,t,e,!1),i}},{key:"_moveChildrenHelper",value:function(t,e){var i=t.newParent,r=t.index,a=t.isArchived;try{m.default.PAssert(1336,void 0!==i&&void 0!==a,"_moveChildrenHelper is missing parameters")}catch(d){m.default.reportError(d)}var n=this.getItems();if(n.length>0){var o=0,u=i.getItems();!a&&(isNaN(r)||r<0)&&(r=u.length);for(var s=0;n.length>0;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;try{m.default.PAssert(1337,n[s]!==i,"Should never be reparenting to a child")}catch(d){m.default.reportError(d)}var h=n[0].id;n[0].moveTo({parent:i,index:r+s,shouldBeArchived:a,underlying:!0},e),Y.e.performAction(Y.c.Move,{itemID:h,oldParent:this.id,oldPosition:s,newParent:i.id,newPosition:r+s}),s++}}}},{key:"moveChildren",value:function(t,e,i){try{m.default.PAssert(1338,!this.isNote(),"Notes cannot use this function")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1339,this.id!==t.id,"Do not use moveChildren to move a child to the same parent")}catch(a){m.default.reportError(a)}if(t.parent()===this){var r=this.removeChild(t,i);Y.e.performAction(Y.c.Delete,{itemID:t.id,parent:this.id,position:r})}An.PaneUpdateBatcher.beginUpdateItems(),this._moveChildrenHelper({newParent:t,index:e,isArchived:!1},i),this._moveChildrenHelper({newParent:t,index:e,isArchived:!0},i),An.PaneUpdateBatcher.commitUpdateItems()}},{key:"deleteSelf",value:function(t){this.parent().deleteChild(this,void 0,void 0,t),this.setParent(void 0)}},{key:"deleteChild",value:function(t,e,i,r){try{m.default.PAssert(1340,t,"Must provide a valid child to delete")}catch(s){m.default.reportError(s)}try{m.default.PAssert(1341,!this.isNote(),"Notes cannot use this function")}catch(s){m.default.reportError(s)}if(Y.e.beginAction(),An.PaneUpdateBatcher.beginUpdateItems(),t.isNote())this.setNote(void 0,r);else if(t.hasChildren())if(e)t.moveChildren(e,i,r);else for(var a=0,n=t.getItems(),o=n.length-1;o>=0;o--){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t.deleteChild(n[o],void 0,void 0,r)}if(t.hasNote()&&t.setNote(void 0,r),!t.isDeleted()){if(!t.isNote()){var u=this.removeChild(t,r);Y.e.performAction(Y.c.Delete,{itemID:t.id,parent:this.id,position:u})}t.setDeleted(!0,r)}t.notifyItemPropertyChanged(r,"isDeleted"),Z.a.itemItemsChanged(this),An.timeline.updateNotifications(t),An.PaneUpdateBatcher.commitUpdateItems(),Y.e.endAction()}},{key:"replaceChild",value:function(t,e,i){try{m.default.PAssert(1342,!this.isNote(),"Notes cannot use this function")}catch(o){m.default.reportError(o)}try{m.default.PAssert(1343,!t.isNote(),"Old child should not be a note")}catch(o){m.default.reportError(o)}try{m.default.PAssert(1344,!e.isNote(),"New child should not be a note")}catch(o){m.default.reportError(o)}var r=t.getIndex();this.items.removeAt(r),Y.e.performAction(Y.c.Delete,{itemID:t.id,parent:this.id,position:r}),e.moveTo({parent:this,index:r},i),G.a.deleteItem(this,t,r+1,i,!1),t.moveChildren(e,e.numChildren(),i);var a=e.parent().id;if(a!==this.id){var n=e.parent().items.remove(e);Y.e.performAction(Y.c.Move,{itemID:e.id,oldParent:a,oldPosition:n,newParent:this.id,newPosition:r})}}},{key:"getChildren",value:function(){if(!this.isNote())return this.hasNote()?[this.getNote()].concat(this.getItems()):this.getItems()}},{key:"getChild",value:function(t){try{m.default.PAssert(1345,!this.isNote(),"Notes cannot use this function")}catch(e){m.default.reportError(e)}try{m.default.PAssert(1346,t>=0,"Child index is out of range: ",t)}catch(e){m.default.reportError(e)}try{m.default.PAssert(1347,t<this.numItems(),"Child index out of range: ",t,this.numItems())}catch(e){m.default.reportError(e)}return this.itemAtIndex(t)}},{key:"getFirstChild",value:function(){try{m.default.PAssert(1348,!this.isNote(),"Notes cannot use this function")}catch(t){m.default.reportError(t)}return this.hasChildren()?this.itemAtIndex(0):void 0}},{key:"isFirstChild",value:function(){try{m.default.PAssert(1349,!this.isNote(),"Notes cannot use this function")}catch(t){m.default.reportError(t)}return!!this.parent()&&this.parent().getFirstChild()===this}},{key:"getLastChild",value:function(){try{m.default.PAssert(1350,!this.isNote(),"Notes cannot use this function")}catch(t){m.default.reportError(t)}return this.hasChildren()?this.itemAtIndex(this.numItems()-1):void 0}},{key:"isLastChild",value:function(){try{m.default.PAssert(1351,!this.isNote(),"Notes cannot use this function")}catch(t){m.default.reportError(t)}return!!this.parent()&&this.parent().getLastChild()===this}},{key:"isDescendantOf",value:function(t){for(var e=0,i=this.parent();i&&i!==t;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;i=i.parent()}return void 0!==i}},{key:"getChildIndex",value:function(t){try{m.default.PAssert(1352,!this.isNote(),"Notes cannot use this function")}catch(e){m.default.reportError(e)}try{m.default.PAssert(1353,!t.isNote(),"Should not get the index of an item note")}catch(e){m.default.reportError(e)}return this.getIndexOf(t.id)}},{key:"getIndexOf",value:function(t){try{m.default.PAssert(1354,!this.isNote(),"Notes cannot use this function")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1355,m.default.isString(t),function(){return"ID must be a valid string: "+m.default.getObjectInfo(t)})}catch(n){m.default.reportError(n)}var e=-1,i=this.getItems();if(i)for(var r=0,a=0;a<i.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i[a].id===t){e=a;break}}return e}},{key:"getIndex",value:function(){try{m.default.PAssert(1356,!this.isNote(),"Should never be getting a child index of a note")}catch(t){m.default.reportError(t)}return this.parent().getChildIndex(this)}},{key:"indexInItemFromStringIndex",value:function(t){var e={index:t};return this.items.get().findIndex(function(t){return B.a.compareItemIndex(t,e)>0})}},{key:"hasChildren",value:function(){return!this.isNote()&&this.numItems()>0}},{key:"numChildren",value:function(){try{m.default.PAssert(1357,!this.isNote(),"Notes cannot use this function")}catch(t){m.default.reportError(t)}return this.numItems()}},{key:"canZoom",value:function(){return!this.isNote()&&(this.numChildren()>0||this.getParsedText().length>0)}},{key:"parents",value:function(t){for(var e=0,i=[],r=this.parent();r&&r!==t;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;i.splice(0,0,r),r=r.parent()}return i}},{key:"getSiblings",value:function(t){try{m.default.PAssert(1358,!this.isNote(),"Notes cannot use this function")}catch(o){m.default.reportError(o)}t=t||0;var e=[];if(this.parent())for(var i=0,r=this.parent().getItems(),a=t,n=r.length;a<n;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r[a]!==this&&e.push(r[a])}return e}},{key:"nextSibling",value:function(){var t=this.getIndex();return this.parent().getItems()[t+1]}},{key:"isRootItem",value:function(){var t=this.getItemStore();return!!t&&t.isRoot(this)}},{key:"clone",value:function(t,e){var i=0;try{m.default.PAssert(1359,!m.default.isAutoChange(e),"Cloning should always be a user action")}catch(u){m.default.reportError(u)}for(var r=t.getItemStore().createItemRaw({text:this.getRawText(),isComplete:this.isComplete(),date:this._date?this._date.clone():void 0,priority:this.getPriority(),isStarred:this.isStarred(),isNote:this.isNote()},{parent:t,documentOwner:t.getDocumentOwner()||this._documentOwner,changeType:e}),a=0;a<this.numItems();++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=this.itemAtIndex(a).clone(r,e);r.insertItem(n)}if(this.hasNote()){var o=this.getNote().clone(r,e);r.setNote(o,e)}return r}},{key:"getItems",value:function(){return this.items.get()}},{key:"itemAtIndex",value:function(t){return this.items.get()[t]}},{key:"numItems",value:function(){return this.items.length()}},{key:"itemsHasMutated",value:function(){try{m.default.PAssert(1360,!this._destroyed,"Item should not fire mutation events once destroyed: ",this.id)}catch(t){m.default.reportError(t)}!this._destroyed&&this.isInitialized&&Z.a.itemItemsChanged(this)}},{key:"numChildrenRecursive",value:function(){var t=0,e={item:this,each:function(e){t++}};return m.default.searchVMLIs(e),t}},{key:"isOnDate",value:function(t){return!!this._date&&this._date.isOnDate(t)}},{key:"getCalendarColor",value:function(){var t,e=An.pluginManager.getPluginGCalendar();if(this.isComplete())return"#ddd";if(this.hasAttachmentType(A.a.PluginType.Calendar)&&e.isEnabled()&&e.isAvailable()){var i=this.getAttachmentByType(A.a.PluginType.Calendar);t=e.getCalendarBackgroundColor(i.getField("calendarID"))}else t="rgba(0, 153, 221, 0.85)";return t}},{key:"getCalendarDisplayProps",value:function(){var t,e=An.pluginManager.getPluginGCalendar();if(this.hasAttachmentType(A.a.PluginType.Calendar)&&e.isEnabled()&&e.isAvailable()){var i=this.getAttachmentByType(A.a.PluginType.Calendar);t=e.getCalendarDisplayProps(i.getField("calendarID"))}return t}},{key:"allowTextEditing",value:function(){var t=!0;return(P.a.android&&this.hasAttachments()||!An.pluginManager.allowTextEditing(this))&&(t=!1),t}},{key:"getPreviousItem",value:function(){var t=this.parent(),e=t.getChildIndex(this);if(e>0)return t.getChild(e-1)}},{key:"isRepeatDate",value:function(){return this._date&&this._date.isRepeatDate()}},{key:"getEls",value:function(){return this.els}},{key:"getDocumentOwner",value:function(){return this._documentOwner}},{key:"onAttachInlineUpdate",value:function(){this.setText(this.getParsedText(),A.a.ChangeType.Local)}}]),t}(),I()(x.prototype,"itemsHasMutated",[H.a],Object.getOwnPropertyDescriptor(x.prototype,"itemsHasMutated"),x.prototype),x);V.a.extendClass(_,function(){return function(t){function e(){return o()(this,e),d()(this,v()(e).apply(this,arguments))}return p()(e,t),s()(e,[{key:"_runAndGetSaveData",value:function(t,e){if(this.shouldSave())var i=this.getMetaTextSaveData();var r=this.getRawText();if(this.setRawText(this.generateSaveText(t)),this.parseText(r,e),this.shouldSave()){var a=this.getMetaTextSaveData(),n={};for(var o in a)i[o]!==a[o]&&(n[o]=a[o])}return n}},{key:"setText",value:function(t,e){try{m.default.PAssert(1622,m.default.isLocalChange(e)||!t||t.indexOf(A.a.AttachChar)<0,"Should never be setting text with an attach char in it")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1623,this.isNote()||!t||t.indexOf("\n")<0,"Non-notes should never have newlines")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1624,!t||m.default.isRemoteChange(e)||t.indexOf(A.a.TextSpace)<0,"Should never insert text space into item when editing locally")}catch(a){m.default.reportError(a)}e|=A.a.ChangeType.Text;var i=this.isPrefixHeader();!this.isNote()&&t&&t.indexOf("\n")>=0&&(t=t.replace(/\n/g," ")),this.isInitialized&&k.a.fireEvent("clearMeasureCacheItem",[this.id]),Z.a.beginBatch(this);var r=this._runAndGetSaveData(t,e);this.shouldSave()&&(r.text=this.generateSaveText(t),G.a.saveItem(this,r,e,A.a.SaveFlag.Text)),Z.a.itemTextChanged(this),this.isPrefixHeader()!==i&&Z.a.itemFontChanged(this),Z.a.commitBatch(this)}},{key:"metricsInPane",value:function(t,e){var i;try{var r=e>=0&&q.a.isSelected(e,t),a=t.objectAtIndex(e);i=t.getMetricsForPaneObject(a,!1,r)}catch(n){m.default.reportError(n)}return i}},{key:"sizeInPane",value:function(t,e,i){if(i)return P.a.isMobile?A.a.OverviewItemHeightMobile:A.a.OverviewItemHeightDesktop;if(this.isNote()){var r=t.objectAtIndex(e);return An.DisplaySettings.lineItemHeight(r,this,t,1)}var a=t.objectAtIndex(e),n=this.metricsInPane(t,e).height;return this.shouldShowParents(a,t)&&(n+=A.a.HeightAgendaParents),n}},{key:"shouldShowParents",value:function(t,e){return e.type===A.a.PaneMode.Task&&t.item&&!e.isSearchedFlat()&&(e.isViewTag()||e.isViewAgenda()||e.isViewContact()||e.isViewPriority())&&!t.item.isNote()&&0===t.levelsDeep&&t.item.parent()!==e.getItem()}},{key:"generateSaveText",value:function(t,e){return void 0!==t&&null!==t?this._generateUsableText(t,"getEmbedString",e):null}},{key:"generateTitleText",value:function(t){var e="";if(t&&!this.parent())return t.titleOfFirstItem();if(t&&this.els&&this.els.length>0)for(var i=0,r=0;r<this.els.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var a=this.els[r];a.hasClass("mdMarkup")||a.hasClass("itemPrefix")||a.hasClass("inlineDate")||(e+=m.default.unescape(a.getUnstyledText(t)))}else e=this.getParsedTextWithoutPrefix();return(this.hasAttachments()?this._generateUsableText(e,"getTitleString"):e).replace(/[\*_]/g,"").trim()}},{key:"_generateUsableText",value:function(t,e,i){var r=this;try{m.default.PAssert(1625,this.hasAttachments()||t.indexOf(A.a.AttachChar)<0,"Should either have attachments or no embedded attachment chars")}catch(u){m.default.reportError(u)}var a=t;if(this.hasAttachments()&&t.indexOf(A.a.AttachChar)>=0){var n=i||0,o=this.getNumAttachments();a=t.replace(new RegExp(A.a.AttachChar,"g"),function(){if(n<o){var t=r.getAttachment(n);return n++,t.isLoaded()?t[e]():""}try{m.default.PAssert(1626,!1,"Unable to find valid attachment for AttachChar")}catch(u){m.default.reportError(u)}return""});try{m.default.PAssert(1627,a.indexOf(A.a.AttachChar)<0,"Should convert all attachments to their string form")}catch(u){m.default.reportError(u)}}return a}},{key:"splitUsableText",value:function(t,e,i){var r=this;try{m.default.PAssert(1628,this.hasAttachments()||t.indexOf(A.a.AttachChar)<0,"Should either have attachments or no embedded attachment chars")}catch(s){m.default.reportError(s)}var a=t.substring(0,e)+t.substring(i),n=e;if(this.hasAttachments()&&t.indexOf(A.a.AttachChar)>=0){var o=0,u=this.getNumAttachments();a=t.replace(/\u2000/g,function(t,i){if(o<u){var a=r.getAttachment(o);o++;var s=a.getEmbedString();return i<e&&(n+=Math.max(s.length-1,0)),s}return A.a.AttachChar});try{m.default.PAssert(1629,a.indexOf(A.a.AttachChar)<0,"Should convert all attachments to their string form")}catch(s){m.default.reportError(s)}}return{before:a.substring(0,n),after:a.substring(n)}}},{key:"parseText",value:function(t,e,i){try{m.default.PAssert(1630,!this.isDestroyed(),"Must not parse a destroyed VMLI")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1631,m.default.isValidChangeType(e),"Must specify a valid changetype")}catch(u){m.default.reportError(u)}var r;if(this.__TEMP_ParseCalled=!0,this.isNote())r=J.a.parseNote(this);else{var a=this.getParser();try{m.default.PAssert(1632,a,"Must be able to get valid parse function for item")}catch(u){m.default.reportError(u)}if(!a)return;r=a(this,e)}m.default.isFlagSet(e,A.a.ChangeType.Local)&&r.numContacts>0&&Y.e.miscAction({type:Y.c.Misc,misc:Y.a.AddContact,data:[{itemID:this.id}]});var n=this.isPrefixNumList(),o=this.styleText(r,t,e,i);return this.itemChanged.notify(),this.isInitialized&&this.isPrefixNumList()!==n&&k.a.fireEvent("numListChanged",[]),o}},{key:"styleText",value:function(t,e,i,r){try{m.default.PAssert(1633,m.default.isValidChangeType(i),"Must specify a valid changetype")}catch(k){m.default.reportError(k)}var a=!1,n=[];if(t){this.prefix=t.prefix;var o=this.getMooDate();if(o&&""!==t.parsedText){var u=o.getGCalId();if(u){var s=o.getGCalCalendar();t.attachments||(t.attachments=[]),t.attachments.push({p:A.a.PluginID.GCalendar,id:u,calendarID:s})}}if(t.attachments||this.hasAttachments()){for(var h=0,d=[],c=0;t.attachments&&c<t.attachments.length;++c){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var v=t.attachments[c];v.p===A.a.PluginID.Date&&(v.id=this.id);var y=An.pluginManager.getAttachment(v,v.hasInlineData);y&&(d.push(y),m.default.isLocalChange(i)&&!y.getOldID()&&n.push(y))}a=!0,this.setAttachments(d,i,!1)}this.setParsedText(t.parsedText);try{m.default.PAssert(1634,t.els||m.default.isFlagSet(i,A.a.ChangeType.ItemLoad),"Must always return an els list")}catch(k){m.default.reportError(k)}t.els&&(this.els=t.els),this.prefix&&Y.e.miscAction({type:Y.c.Misc,misc:Y.a.SetPrefix,data:{itemID:this.id,prefix:this.prefix}}),(t.tags||this._activeTags)&&this.setTags(t.tags,i),(t.contacts||this._activeContacts)&&this.setContacts(t.contacts,i);var g=this.getRawText();!(e&&o&&e.includes(A.a.CharDate))||g&&g.includes(A.a.CharDate)||this.setMooDate(void 0,i)}if(this.isInitialized){if(n.length>0){var l=0;for(c=0;c<n.length;c++){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;n[c].notifyItemTextChanged(this,!1)}}if(m.default.isLocalChange(i)&&this.isNote()&&this.parent().hasAttachments()){var p=0,f=this.parent().getAttachments();for(c=0;c<f.length;++c){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;f[c].notifyItemNoteChanged(this)}}a&&this.itemChanged.notify()}return!1}},{key:"getCalendarRawText",value:function(){return this.getRawText().replace(/^ +/g,"").replace(/ +$/g,"")}},{key:"getCalendarParsedText",value:function(){return(this.hasAttachmentType(A.a.PluginType.Email)?this.getAttachmentByType(A.a.PluginType.Email).getField("subject"):this.getParsedTextWithoutPrefix().replace(/\u2000/g,"")).trim()}},{key:"getStyledTextAsOneLine",value:function(t,e){var i;return e&&(i='<span class="numChildren c-foreground-super-faded">'+this.numItems()+"</span>"),An.ElementRenderer.render(this.els,{convertSpaces:!1,noPrefix:t,suffix:i,item:this})}},{key:"hasText",value:function(){var t=this.getParsedText();return(t=t.replace(/ /g,"")).length>0}},{key:"setPrefix",value:function(t){var e=this.getRawText(),i=this.getPrefix();i&&(e=e.substr(i.length)),this.prefix=t,e=(t?t+" ":"")+e,this.setText(e,A.a.ChangeType.Local)}},{key:"getPrefix",value:function(){return this.prefix?this.prefix+" ":""}},{key:"getPrefixLength",value:function(){return this.prefix?this.prefix.length+1:0}},{key:"isPrefixHeader",value:function(t){var e;return t&&(e=t.search.getItemPrefix(this)),void 0===e&&(e=this.prefix),e&&(e[0]===A.a.Prefix.Header||e[0]===A.a.Prefix.Header2)}},{key:"isPrefixTask",value:function(){return this.prefix&&m.default.isPrefixTask(this.prefix)}},{key:"isPrefixBullet",value:function(){return this.prefix&&this.prefix===A.a.Prefix.Bullet||this.prefix===A.a.Prefix.Bullet2||this.prefix===A.a.Prefix.Bullet3}},{key:"isPrefixNumList",value:function(){return this.prefix&&+this.prefix[0]>=0&&+this.prefix[0]<10}},{key:"hasPrefix",value:function(){return!!this.prefix}},{key:"numListNumber",value:function(){if(this.isPrefixNumList()){for(var t=0,e=1,i=this.parent(),r=this.getIndex()-1;r>=0;--r,++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=i.getChild(r);if(!a||!a.isPrefixNumList())break}return e}}},{key:"shouldCopyPrefix",value:function(){return this.isPrefixTask()||this.isPrefixBullet()||this.isPrefixNumList()}},{key:"getParsedTextWithoutPrefix",value:function(){var t=this.getPrefix(),e=this.getParsedText();return t?e.substr(t.length):e}},{key:"applyFormatToSelection",value:function(t,e,i,r){var a,n,o,u=0,s=0,h=this.getParsedText(),d=e,c=i,v=!1;for(e===i&&(e=0,i=h.length),e<this.getPrefixLength()&&(e=this.getPrefixLength()),i<this.getPrefixLength()&&(i=this.getPrefixLength()),o=e;o>=Math.max(e-t.length,0);o--){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(h.substr(o,t.length)===t){a=o;break}}for(o=i-t.length;o<=i;o++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(h.substr(o,t.length)===t){n=o;break}}return isNaN(a)||isNaN(n)||r===A.a.SetMode.Yes?r!==A.a.SetMode.No&&(d+=t.length,c+=t.length,h=h.substr(0,e)+t+h.substr(e,i-e)+t+h.substr(i),v=!0):(d-=t.length,c-=t.length,h=h.substr(0,a)+h.substr(a+t.length,n-a-t.length)+h.substr(n+t.length)),this.setText(h,A.a.ChangeType.Local),{didSet:v,selStart:d,selEnd:c}}},{key:"insertLinkAtSelection",value:function(){var t=q.a.getStartIndex();if(q.a.isValid()&&t===q.a.getEndIndex()){var e,i=q.a.getStartOffset(),r=q.a.getEndOffset(),a=this.getRawText();if(i!==r)e=a.substr(i,r-i);else if(i>0&&r<a.length){for(var n,o,u=0,s=this.getEls(),h=0,d=-1,c=0;c<s.length;c++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(s[c].hasClass("mdMarkupStart")&&"["===s[c].getParsedText())d=h;else if(s[c].hasClass("mdMarkupEnd")&&")"===s[c].getParsedText()&&d>=0){var v=h+s[c].getOrigTextLength();if(i>=d&&r<=v){n=d,o=v;break}d=-1}h+=s[c].getOrigTextLength()}n||o||" "===a[i-1]||" "===a[i]||(n=a.prevIndexOf(" ",i)+1,(o=a.indexOf(" ",r))<0&&(o=a.length)),isNaN(n)||isNaN(o)||n===i||o===r||(e=a.substr(n,o-n),q.a.selectIndices(t,n,t,o))}An.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:q.a.getEndElement(),onInsertLink:this.onInsertLink,text:e})}}},{key:"onInsertLink",value:function(t,e){if(q.a.isValid()&&q.a.getStartIndex()===q.a.getEndIndex()){e&&!t.text&&(t.text=t.url);var i=q.a.getStartOffset(),r=q.a.getEndOffset(),a=this.getRawText(),n=a.substr(i,r-i),o=t.url?t.text?(e?"!":"")+"["+t.text+"]("+t.url+")":t.url:t.text,u=r+o.length-n.length;a=a.substr(0,i)+o+a.substr(r),this.setText(a,A.a.ChangeType.Local),q.a.selectIndex(q.a.getStartIndex(),u)}}},{key:"getTextLength",value:function(){return this.getParsedText().length}},{key:"getNotePreviewText",value:function(){var t=this.getParsedText();if(t){var e=(t=t.substr(0,Math.min(t.length,400))).match(/[^\r\n]+/);if(e){for(var i=0,r=(t=e[0]).split(/<\/?(?:div|p|br)[^>]*>\s*/im),a=0;a<r.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(r[a]){var n=document.createElement("div");if(n.innerHTML=r[a],t=m.default.escape(n.textContent||n.innerText))break}}t=t.substr(0,Math.min(t.length,200))}}return t}}]),e}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:it)}(_),!0),V.a.extendClass(_,function(){return function(t){function e(){return o()(this,e),d()(this,v()(e).apply(this,arguments))}return p()(e,t),s()(e,[{key:"dragStart",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=t.pane||m.default.focusedPane;try{m.default.PAssert(1635,!P.a.isMobile||i.isItemDraggable(this),"Should not be able to drag/drop on timeline on mobile")}catch(w){m.default.reportError(w)}try{m.default.PAssert(1636,i.isItemDraggable(this),"Pane must be draggable in order to start a drag")}catch(w){m.default.reportError(w)}try{m.default.PAssert(1637,An.DragDrop.startDragItem,"Should always have a valid item to start dragging from")}catch(w){m.default.reportError(w)}var r=m.default.getElementParent(t.startSrc||t.target);try{m.default.PAssert(1638,r,"Must have a valid target node")}catch(w){m.default.reportError(w)}if(r){var a,n;if(An.DragDrop.startDragItem=void 0,An.DragDrop.dragItem=this,i.isViewCalendar()||e||m.default.findParent(r,"itemNotInPane"))a=[{item:this,levelsDeep:0}];else{var o=m.default.getPaneObjectForElement(r),u=this.levelsDeep.get(),s=o.levelsDeep;if(a=[o],n=o.block,!this.isCollapsed(i)){var h=0,d=this.getVisibleChildren(i),c={},v=[];c[this.id]=o;for(var y=0;y<d.length;y++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var g=d[y],l={item:g,levelsDeep:g.levelsDeep.get()-u+s,index:o.index+y+1,parentObject:c[g.parent().id]};c[g.id]=l,v.push(l)}a=a.concat(v)}}var p=m.default.offset(r),f=p.left,k=p.top;P.a.isMobile?i.addScrollListener(this.dragScroll):An.PaneManager.runForEachPane(function(t){t.addScrollListener(this.dragScroll)}.bind(this));var A={x:t.clientX,y:t.clientY,items:a},S={dropEffect:i.dropEffect(this),item:this,element:r,block:n,pane:i};An.DragDrop.start(this,a,f,k,i,A,S,e),m.default.disableMouseMove=!0}}},{key:"dragMove",value:function(t){try{m.default.PAssert(1639,An.DragDrop.startInfo,"Must have started a drag to be valid")}catch(a){m.default.reportError(a)}if(An.DragDrop.startInfo){if("touchmove"===t.type){if(!t.cancelable)return void this.dragEnd(t);t.returnValue=!1,t.returnFalse=!0,m.default.preventDefault(t),m.default.stopPropagation(t)}var e=t.clientX-An.DragDrop.startInfo.x,i=t.clientY-An.DragDrop.startInfo.y,r=m.default.elementFromPoint(t.clientX,t.clientY);An.DragDrop.setTransform(e,i),r&&An.DragDrop.handleDragOver({item:this,target:r,dataTransfer:An.DragDrop.dataTransfer,diffY:t.diffY,clientX:t.clientX,clientY:t.clientY,preventDefault:m.default.emptyFn,stopPropagation:m.default.emptyFn,stopImmediatePropagation:m.default.emptyFn})}}},{key:"dragScroll",value:function(t){if(An.DragDrop.isDragging&&!isNaN(q.a.mousePos.x)&&!isNaN(q.a.mousePos.y)){var e={clientX:q.a.mousePos.x,clientY:q.a.mousePos.y,preventDefault:m.default.emptyFn,stopPropagation:m.default.emptyFn,diffY:0};this.dragMove(e)}}},{key:"dragEnd",value:function(t){var e=this;m.default.disableMouseMove=!1,An.DragDrop.stop(),t&&t.target!==document.documentElement&&An.DragDrop.handleDrop({target:t.target,clientX:t.clientX,clientY:t.clientY,dataTransfer:An.DragDrop.dataTransfer,fromDropBucket:t.fromDropBucket,ctrlKey:t.ctrlKey,altKey:t.altKey,preventDefault:m.default.emptyFn,stopPropagation:m.default.emptyFn,stopImmediatePropagation:m.default.emptyFn}),An.DragDrop.finish(),An.PaneManager.runForEachPane(function(t){t.getInfiniteList().hasScrollListener(e.dragScroll)&&t.removeScrollListener(e.dragScroll)}),m.default.disableMouseMove=!1}},{key:"onTouchHoldTimeout",value:function(t){this._destroyed||(m.default.isKeyboardOpen?this.isLoupeOpen=!0:m.default.focusedPane&&m.default.focusedPane.isDropTarget&&this.isDraggable()&&m.default.focusedPane.isItemDraggable()&&!m.default.findParent(t.target,"androidInput")&&(this.isEditable.set(!1),An.DragDrop.startDragItem=this,this.dragStart(t),this.dragMove(t)))}},{key:"checkDragOnStart",value:function(t){An.DragDrop.escapedDragging=!1,An.DragDrop.startDragItem=this,m.default.preventDefault(t),m.default.stopPropagation(t)}},{key:"checkDragOnMove",value:function(t,e){if(An.DragDrop.startDragItem&&!An.DragDrop.escapedDragging&&(!P.a.touch||Math.abs(t.distanceY)>m.default.ClickThreshold&&Math.abs(t.distanceX)<m.default.ClickThreshold)){var i=t.pane||m.default.focusedPane;An.DragDrop.startDragItem===this&&this.isDraggable()&&i.isItemDraggable(this)&&this.dragStart(t,e)}An.DragDrop.isDragging&&(this.dragMove(t),m.default.preventDefault(t),m.default.stopPropagation(t))}},{key:"checkDragOnEnd",value:function(t){An.DragDrop.startDragItem=void 0,An.DragDrop.isDragging&&this.dragEnd(t)}},{key:"onStart",value:function(t,e,i){var r=m.default.focusedPane,n=!1;if(P.a.mobile&&(m.default.isKeyboardOpen||this.isEditable.set(!1),!m.default.isKeyboardOpen&&P.a.useCustomScroller&&m.default.preventAndStop(i)),a=r.getScrollOffset(),P.a.isMobile&&(m.default.isKeyboardOpen||this.isEditable.set(!1),!m.default.isKeyboardOpen&&P.a.useCustomScroller&&m.default.preventAndStop(i)),m.default.hasClass(i.target,"paneScroller"))P.a.useCustomScroller&&(n=!0);else if(P.a.isMobile||!m.default.hasClass(i.target,"prefixNumList")&&!m.default.hasClass(i.target,"mdImage"))if(!P.a.isMobile&&m.default.hasClass(i.target,"emptyItemAddButton"))An.menus.openContextMenu({componentName:"ReactContextMenuAddItem",element:i.target,item:this,paneObject:e,pane:r}),n=!0;else if(!P.a.isMobile&&m.default.hasClass(i.target,"link")){var o=i.target.getAttribute("data-href"),u=q.a.isSelected(t,r);u||P.a.mac&&i.metaKey||!P.a.mac&&i.ctrlKey||!m.default.isUrlImage(o)?(P.a.mac&&i.metaKey||!P.a.mac&&i.ctrlKey||P.a.isMobile||m.default.findParent(i.target,"appLink",2)&&!u)&&(m.default.openUrl(o,i),m.default.preventAndStop(i)):(An.menus.openLightbox(o),m.default.preventAndStop(i))}else P.a.isMobile&&!P.a.ie&&"UL"!==i.target.tagName&&r.isItemDraggable()&&!k.a.isListening("touchHoldTimeout",this.onTouchHoldTimeout)&&k.a.listen("touchHoldTimeout",this.onTouchHoldTimeout),!P.a.isMobile&&this.isDraggable()&&r.isItemDraggable()&&(P.a.isMobile&&i.clientX<this.getPadding(r)||!P.a.isMobile&&m.default.hasClass(i.target,"collapser")||!P.a.isMobile&&m.default.hasClass(i.target,"itemMenuIcon")||!P.a.isMobile&&m.default.findParent(i.target,"agendaTime")||!P.a.isMobile&&m.default.hasClass(i.target,"itemEditButton")||!P.a.isMobile&&m.default.hasClass(i.target,"itemPrefix")||m.default.findParent(i.target,"plugin")&&!r.isEditable)?(this.checkDragOnStart(i),m.default.vmMain.updateCursorFromEvent(i)):P.a.isMobile&&i.clientX>r.getWidth()-m.default.SPThresholdRight||!P.a.isMobile&&m.default.hasClass(i.target,"itemCheckbox")||(!P.a.isMobile&&m.default.hasClass(i.target,"blockHeaderNumItems")?n=!0:An.pluginManager.handleTapStart(this,r,i));else n=!0;return n}},{key:"onMove",value:function(t,e){this.checkDragOnMove(t,!1)}},{key:"onClick",value:function(t,e,r){var n=m.default.focusedPane,o=P.a.isMobile&&An.DragDrop.draggingToOutline.get();if(P.a.isMobile)var u=i(44).default;if(P.a.isMobile&&An.DragDrop.isDragging)m.default.preventAndStop(r),P.a.isMobile&&this.isEditable.set(!1);else if(P.a.isMobile&&m.default.hasClass(r.target,"prefixTask"))n.supportCompleting&&(m.default.beginCompleteAction(),this.setComplete(!this.isComplete(),A.a.ChangeType.Local),m.default.endCompleteAction());else if(P.a.isMobile&&u.isInMultiselect()){var s;if(j.a.toggleSelected(t,n),this.isNote()?s=t-1:this.hasNote()&&(s=t+1),!isNaN(s)){var h=j.a.isSelected(t,n);j.a.toggleSelected(s,n,h)}}else if(o)o.pane.moveItem(o.item,this),An.DragDrop.stopDraggingToOutline();else if(m.default.hasClass(r.target,"blockCollapser"))e.block.toggleCollapsed();else if(P.a.isMobile||!m.default.hasClass(r.target,"prefixHeader")&&!m.default.hasClass(r.target,"prefixBullet"))if(!P.a.isMobile&&(m.default.hasClass(r.target,"itemPrefix")||m.default.hasClass(r.target,"collapser")||m.default.hasClass(r.target,"itemMenuIcon"))&&(P.a.mac&&r.metaKey||!P.a.mac&&r.ctrlKey))n.zoomIn(this,!1,!0),m.default.preventAndStop(r);else if(P.a.isMobile&&r.clientX<n.getPaddingForPaneObject(e)||!P.a.isMobile&&m.default.hasClass(r.target,"collapser"))n.handleLeftSideTap(e,r),m.default.preventAndStop(r);else if(!P.a.isMobile&&m.default.hasClass(r.target,"itemMenuIcon"))this.openItemMenu(r),m.default.preventAndStop(r);else if(!P.a.isMobile&&m.default.hasClass(r.target,"itemTime"))An.menus.openContextMenu({componentName:"ReactContextMenuDate",element:r.target,item:this,pane:n}),m.default.preventAndStop(r);else if(!P.a.isMobile||!m.default.hasClass(r.target,"link")||P.a.isMobile&&m.default.isKeyboardOpen)if(!P.a.isMobile&&m.default.hasClass(r.target,"itemCheckbox"))n.handleRightSideTap(this,r),m.default.preventAndStop(r);else if(!P.a.isMobile&&m.default.hasClass(r.target,"prefixTask"))n.supportCompleting&&(m.default.beginCompleteAction(),this.setComplete(!this.isComplete(),A.a.ChangeType.Local),n.selectNearestItem(t),m.default.endCompleteAction()),m.default.preventAndStop(r);else if(!P.a.isMobile&&m.default.hasClass(r.target,"itemAddButton")){var d=An.settings.getDefaultItemText();this.addItemAtIndex({text:d},0,n);var c=n.indexOfNextVMLI(t,!1,!0);q.a.selectIndex(c,0),m.default.preventAndStop(r)}else if(!P.a.isMobile&&m.default.hasClass(r.target,"itemEditButton"))q.a.reset(),An.menus.openContextMenu({componentName:"ReactItemDetailsPopup",element:m.default.findParent(r.target,"item"),item:this,pane:n,selectIndex:0}),m.default.preventAndStop(r);else if("SPAN"===r.target.tagName&&m.default.hasClass(r.target,"itemDataPageLoad"))this.notifyPaginationUpdate();else if(!(m.default.hasClass(r.target,"tag")||m.default.hasClass(r.target,"date")||m.default.hasClass(r.target,"duration"))||P.a.isMobile&&m.default.isKeyboardOpen)if(!m.default.hasClass(r.target,"contact")||P.a.isMobile&&m.default.isKeyboardOpen){if(!P.a.isMobile&&m.default.hasClass(r.target,"email")){if(P.a.mac&&r.metaKey||!P.a.mac&&r.ctrlKey){var v=m.default.vmMain.getDefaultEmailPlugin();if(v.isActive()){q.a.reset();var y={to:[{text:"",email:r.target.textContent}]};An.menus.openComposeEmail(v,void 0,void 0,y)}}}else if(An.pluginManager.handleTapClick(this,n,r))P.a.isMobile?m.default.preventAndStop(r):An.DragDrop.isDragging&&this.dragEnd(r);else if(X.a.hide(),P.a.isMobile){var g=document.activeElement,l=n.getScrollOffset(),p=Math.abs(l-a)>0;if(this.allowTextEditing()){if(n.isWriteable&&!p){var f,k=this;if(P.a.ios&&this.isEditable.set(!0),P.a.isMobile&&this===n.getItem())k=n.getLastItem(),f=k.getParsedText().length;else if(m.default.getElementParent(r.target))if(P.a.isMobile&&r.clientX<this.getPadding(n))f=0;else{var S=T.default.getSelectOffsetsForMouseEvent(r);f=S?S.start:0}else f=k.getParsedText().length;P.a.isMobile&&P.a.android&&this.isEditable.set(!0);try{m.default.PAssert(1640,k,"Click on undefined item should not happen")}catch(z){m.default.reportError(z)}m.default.isKeyboardOpen&&g&&!m.default.findParentID(g,"search")||m.default.openKeyboardOnIndex(r,n,t,function(){n.setFocused(!0),q.a.selectIndex(t,f)},function(){}),q.a.selectIndex(t,f),setTimeout(function(){j.a.setSelected([t],n)},100)}}else m.default.preventDefault(r)}}else{if(P.a.mac&&r.metaKey||!P.a.mac&&r.ctrlKey){q.a.reset();var w=r.target.textContent;r.shiftKey?n.search.setValue(w):n.search.addToValue(w)}else if(!P.a.isMobile||!m.default.isKeyboardOpen){var L=r.target.textContent,F=Q.a.findMatchExact(L[0]===A.a.ContactPrefix?L.substr(1):L);F&&An.menus.openContextMenu({componentName:"ReactContextMenuContactDetails",position:"bottom",element:r.target,contact:F})}P.a.isMobile&&m.default.preventAndStop(r)}else{var C=r.target.textContent,I=P.a.mac&&r.metaKey||!P.a.mac&&r.ctrlKey,N=r.altKey;if((I||N)&&(q.a.reset(),j.a.reset()),I)n.search.toggleText(C,r.shiftKey);else if(N){Y.e.beginAction(),An.PaneUpdateBatcher.beginUpdateItems();var H=this.getRawText();m.default.hasClass(r.target,"date")||m.default.hasClass(r.target,"duration")?this.setMooDate(void 0,A.a.ChangeType.Local):(H=H.replace(new RegExp(C,"g"),"").replace(/  +/g," "),this.setText(H,A.a.ChangeType.Local)),An.PaneUpdateBatcher.commitUpdateItems(),Y.e.endAction()}P.a.isMobile&&m.default.preventAndStop(r)}else{var M=r.target.getAttribute("data-href");m.default.openUrl(M,r),m.default.preventAndStop(r)}else n.zoomIn(this,!1,!0),m.default.preventAndStop(r)}},{key:"onEnd",value:function(t){k.a.isListening("touchHoldTimeout",this.onTouchHoldTimeout)&&k.a.unlisten("touchHoldTimeout",this.onTouchHoldTimeout),this.checkDragOnEnd(t),P.a.mobile&&i(44).default.isInMultiselect()&&(m.default.preventAndStop(t),t.returnFalse=!0),this.isLoupeOpen=!1,m.default.vmMain.updateCursorFromEvent(t)}},{key:"onCancel",value:function(t){An.DragDrop.isDragging&&this.dragEnd(t)}},{key:"openItemMenu",value:function(t){An.menus.openContextMenu({componentName:"ReactContextMenuItem",key:"menu"+this.id+t.clientX+t.clientY,element:t.target,item:this,pane:m.default.focusedPane,pos:{left:t.pageX,top:t.pageY}})}},{key:"onRightClick",value:function(t,e){this.openItemMenu(e),m.default.preventDefault(e),m.default.stopPropagation(e)}},{key:"onDoubleClick",value:function(t,e){var i=m.default.focusedPane;!P.a.isMobile&&An.pluginManager.handleDoubleTap(this,i,e)&&(P.a.isMobile?m.default.preventAndStop(e):An.DragDrop.isDragging&&this.dragEnd(e))}},{key:"onAutocompleteTapped",value:function(t,e,i){try{m.default.PAssert(1641,i,"Must be tracking the current AC tag")}catch(o){m.default.reportError(o)}var r=this.getParsedText(),a=q.a.getStartOffset()-i.length,n=r.substr(0,a)+t+r.substr(q.a.getStartOffset()+1);q.a.getPane().setFocused(!0),this.setText(n,A.a.ChangeType.Local),q.a.selectIndex(q.a.getStartIndex(),a+e)}}]),e}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:it)}(_),!0),V.a.extendClass(_,function(){return function(t){function e(){return o()(this,e),d()(this,v()(e).apply(this,arguments))}return p()(e,t),s()(e,[{key:"onChangeRemote",value:function(t,e,i){var r=this,a=!1,n=this.getRawText();if("isArchived"in e){if(e.isArchived&&!this._isArchived)this.archiveSelf(i);else if(this._isArchived){var o=e.parent?G.a.getItem(e.parent):void 0;o||(o=this.getItemStore().getRoot()),this.unArchiveIntoItem(o,i)}a=!0}Object.keys(e).map(function(t){var o,u=e[t];switch(t){case"text":r.onChangeRemoteText(u,i);break;case"parent":a||r.parent().id===u||(r.onChangeRemoteParentOrIndex(e,i),a=!0);break;case"index":a||r.index===u||(r.onChangeRemoteParentOrIndex(e,i),a=!0);break;case"priority":r.setPriority(u||0,i);break;case"isComplete":r.setComplete(u||!1,i);break;case"isStarred":r.setStarred(u||!1,i);break;case"dateCompleted":r.dateCompleted=u?new Date(u):null,o=!0;break;case"date":r.setMooDate($.a.fromData(u),i);break;case"note":u?r.addRemoteNote(u,i):r.hasNote()&&r.removeRemoteNote(i);break;case"dateModified":r.dateModified=new Date(u);break;case"flags":var s=m.default.isFlagSet(u,A.a.VMLIFlag.Complete);r.isComplete()!==s?r.setComplete(s,i):r.setFlags(u),Z.a.itemSearchChanged(r)}o&&r.parseText(n,i)})}},{key:"onChangeRemoteText",value:function(t,e){this.setText(t,e)}},{key:"onChangeRemoteParentOrIndex",value:function(t,e){var i=this.parent(),r=t.parent?G.a.getItem(t.parent):i;try{m.default.PAssert(1642,r,"Must have a new parent")}catch(a){m.default.reportError(a)}r&&(An.PaneUpdateBatcher.beginUpdateItems(),this.index=t.index,i!==r&&(this.setParent(r),i.items.remove(this),r.items.push(this),i.items.sort(B.a.compareItemIndex)),r.items.sort(B.a.compareItemIndex),Z.a.itemSearchChanged(this),An.PaneUpdateBatcher.commitUpdateItems())}},{key:"addRemoteNote",value:function(t,e){}},{key:"removeRemoteNote",value:function(t){}}]),e}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:it)}(_),!0);var tt,et,it=_,rt=(tt=function(){function t(e,i,r,a,n,u,s,h,d){o()(this,t),this.id=e,this.numItems=0;try{m.default.PAssert(637,m.default.isFunction(h),"Must supply a valid parser")}catch(c){m.default.reportError(c)}this._readonly=!!i,this._isDestructible=!!r,this._enabledFilters=s,this._trackGlobally=!!a,this._requireStoredEls=!!n,this._parser=h,this._owner=d,this._root=void 0,this._data={},this._destroyed=!1}return s()(t,[{key:"getParser",value:function(){return this._parser}},{key:"areFiltersEnabled",value:function(t){return m.default.isAtLeastOneFlagSet(this._enabledFilters,t)}},{key:"getEnabledFilters",value:function(){return this._enabledFilters}},{key:"isOwner",value:function(t){return this._owner===t}},{key:"destroy",value:function(){try{m.default.PAssert(638,this._isDestructible,"Item store must be destructible to destroy")}catch(t){m.default.reportError(t)}this._destroyed=!0,this.clearStore(),this._root.destroy(),this._root=void 0,this._owner=void 0}},{key:"checkDestroyed",value:function(){try{m.default.PAssert(639,!this._destroyed,"Should not be using a destroyed item store")}catch(t){m.default.reportError(t)}}},{key:"trackGlobally",value:function(){return this._trackGlobally}},{key:"requireStoredEls",value:function(){return this._requireStoredEls}},{key:"clearStore",value:function(){if(this._isDestructible){for(var t in An.PaneUpdateBatcher.beginUpdateItems(),this._data)this._root&&t===this._root.id||this._data[t].destroy();An.PaneUpdateBatcher.commitUpdateItems()}this._data={},this._root&&(this._root.items.set([]),this._data[this._root.id]=this._root)}},{key:"createRoot",value:function(t,e){return this.checkDestroyed(),this._root=this.createItem(t,e,void 0,{isRoot:!0},A.a.ChangeType.None),this._root}},{key:"createItem",value:function(t,e,i,r,a,n){try{m.default.PAssert(640,i||r&&r.isRoot,"Must always specify a valid parentID when creating a new item")}catch(d){m.default.reportError(d)}this.checkDestroyed();try{m.default.PAssert(641,!this._data[t],"Should never double-create for the same item, should use update instead")}catch(d){m.default.reportError(d)}var o;if(void 0===a&&(a=A.a.ChangeType.None),i){o=this._data[i];try{m.default.PAssert(642,o,"Parent must be valid if defined")}catch(d){m.default.reportError(d)}}var u={id:t,text:e};if(r)for(var s in r)r.hasOwnProperty(s)&&(u[s]=r[s]);var h=new it(u,{store:this,parent:o,changeType:a,canDestroy:this._isDestructible,noSave:this._readonly,documentOwner:n});return this.numItems++,this._data[h.id]=h,h}},{key:"createItemRaw",value:function(t,e){try{m.default.PAssert(643,e.parent||e&&(e.isRoot||e.noSave||e.noParentOkay),"Must always specify a valid parentID when creating a new item")}catch(r){m.default.reportError(r)}this.checkDestroyed();try{m.default.PAssert(644,!!e.canDestroy===this._isDestructible,"When creating raw items, canDestroy must match")}catch(r){m.default.reportError(r)}try{m.default.PAssert(645,!!e.noSave===this._readonly,"When creating raw items, noSave must match")}catch(r){m.default.reportError(r)}e.store=this;var i=new it(t,e);try{m.default.PAssert(646,!this._data[i.id],"Should not create an item that already exists in this store")}catch(r){m.default.reportError(r)}return this._data[i.id]=i,this.numItems++,i}},{key:"destroyItem",value:function(t){try{m.default.PAssert(647,this._isDestructible,"ItemStore must be destructible to destroy items")}catch(i){m.default.reportError(i)}var e=this._data[t];try{m.default.PAssert(648,e,"Must always destroy a valid item")}catch(i){m.default.reportError(i)}try{m.default.PAssert(649,!e.isDestroyed(),"Should never destroy an item twice")}catch(i){m.default.reportError(i)}e.parent()&&(e.parent().removeChild(e,A.a.ChangeType.Local),e.setParent(void 0)),e.destroy(),delete this._data[t]}},{key:"modifyItemID",value:function(t,e){try{m.default.PAssert(650,t.belongsToItemStore(this),"Item must belong to this item store")}catch(i){m.default.reportError(i)}try{m.default.PAssert(651,t.id!==e,"Must actually be modifying the item ID")}catch(i){m.default.reportError(i)}try{m.default.PAssert(652,this._data[t.id],"Must have a valid item stored under the current ID: "+t.id+" - "+e+" - "+t.isDestroyed())}catch(i){m.default.reportError(i)}try{m.default.PAssert(653,!this._data[e],"Must not be overwriting an existing item"+t.id+" - "+e+" - "+t.isDestroyed())}catch(i){m.default.reportError(i)}delete this._data[t.id],this._data[e]=t}},{key:"manualModifyItemID",value:function(t,e){try{m.default.PAssert(654,!this._data[e],"Must not be overwriting an existing item"+t+" - "+e)}catch(r){m.default.reportError(r)}var i=this._data[t];try{m.default.PAssert(655,i,"Must have valid item to change its ID")}catch(r){m.default.reportError(r)}i&&(delete this._data[t],this._data[e]=i)}},{key:"addItemToRoot",value:function(t){this._root.items.push(t)}},{key:"removeItemFromRoot",value:function(t){this._root.items.remove(t)}},{key:"getItem",value:function(t){return this.checkDestroyed(),this._data[t]}},{key:"hasItem",value:function(t){return this.checkDestroyed(),!!this._data[t]}},{key:"getRoot",value:function(){return this.checkDestroyed(),this._root}},{key:"isRoot",value:function(t){return this.checkDestroyed(),this._root===t}},{key:"getCount",value:function(){return this.checkDestroyed(),Object.keys(this._data).length}},{key:"forEach",value:function(t){for(var e in this.checkDestroyed(),this._data)this._data[e]&&t(this._data[e])}},{key:"_markPaneDirty",value:function(t){t.usesItemStore(this)&&(t===m.default.focusedPane?t.setItemsWillBeDirty():t.setItemsDirty())}},{key:"updateItems",value:function(t){t&&!t.belongsToItemStore(this)||(An.PaneManager.runForEachPane(function(e){e.usesItemStore(this)&&(e.preventUpdateItemsForItem&&e.preventUpdateItemsForItem.item===t?e.setItemsWillBeDirty():e.setItemsDirty())}.bind(this)),An.PaneUpdateBatcher.updateAllItems())}},{key:"onItemChanged",value:function(t,e){var i,r=this;t&&!t.belongsToItemStore(this)||An.PaneManager.runForEachPane(function(a){if(a.usesItemStore(r)){var n=a.handleItemChanged(t,e);i=i||n}}),i&&An.PaneUpdateBatcher.updateAllItems()}}]),t}(),I()(tt.prototype,"_markPaneDirty",[H.a],Object.getOwnPropertyDescriptor(tt.prototype,"_markPaneDirty"),tt.prototype),I()(tt.prototype,"updateItems",[H.a],Object.getOwnPropertyDescriptor(tt.prototype,"updateItems"),tt.prototype),tt),at=function(t){function e(){var t;return o()(this,e),(t=d()(this,v()(e).call(this)))._itemStores={},t._iteratingStores=!1,t.Events={StoreAdded:"StoreAdded",StoreRemoved:"StoreRemoved"},t}return p()(e,t),s()(e,[{key:"init",value:function(){var t=A.a.ItemStoreFilter.Dates|A.a.ItemStoreFilter.Priority;this.registerItemStore("DefaultStore",void 0,{isReadonly:!1,isDestructible:!1,listenToItemStateChanged:!0,enabledFilters:t}).createRoot("Item store root","Item store root"),this._tempItemStore=this.registerItemStore("TempStore",void 0,{isReadonly:!0,isDestructible:!0,trackGlobally:!1,noRegister:!0})}},{key:"registerItemStore",value:function(t,e,i){try{m.default.PAssert(269,!this._itemStores[t],"Should only register a single item store per plugin: ",t)}catch(c){m.default.reportError(c)}try{m.default.PAssert(270,!this._iteratingStores,"Should never add a store while iterating")}catch(c){m.default.reportError(c)}var r=!0,a=!0,n=!0,o=!0,u=!1,s=A.a.ItemStoreFilter.None,h=J.a.runParseText;i&&(void 0!==i.isReadonly&&(r=i.isReadonly),void 0!==i.isDestructible&&(a=i.isDestructible),void 0!==i.enabledFilters&&(s=i.enabledFilters),void 0!==i.parserFn&&(h=i.parserFn),void 0!==i.trackGlobally&&(n=i.trackGlobally),void 0!==i.requireStoredEls&&(o=i.requireStoredEls),void 0!==i.listenToItemStateChanged&&(u=i.listenToItemStateChanged));var d=new rt(t,r,a,n,o,u,s,h,e);return i&&i.noRegister||(this._itemStores[t]=d,this.fireEvent(this.Events.StoreAdded,d.getEnabledFilters(),[d])),d}},{key:"unregisterItemStore",value:function(t){try{m.default.PAssert(271,this._itemStores[t],"Must register an item store before destroying it")}catch(i){m.default.reportError(i)}try{m.default.PAssert(272,!this._iteratingStores,"Should never remove a store while iterating")}catch(i){m.default.reportError(i)}var e=this._itemStores[t];delete this._itemStores[t],e.destroy(),this.fireEvent(this.Events.StoreRemoved,e.getEnabledFilters(),[e])}},{key:"getItemStore",value:function(t){try{m.default.PAssert(273,this._itemStores[t],"Must register an item store before using it")}catch(e){m.default.reportError(e)}return this._itemStores[t]}},{key:"getDefaultItemStore",value:function(){return this._itemStores.DefaultStore}},{key:"getTempItemStore",value:function(){return this._tempItemStore}},{key:"runForEachStore",value:function(t,e){for(var i in e=e||A.a.ItemStoreFilter.None,this._iteratingStores=!0,this._itemStores)if(this._itemStores.hasOwnProperty(i)){var r=this._itemStores[i];if(e===A.a.ItemStoreFilter.None||r.areFiltersEnabled(e))try{t(r)}catch(a){m.default.reportError(a)}}this._iteratingStores=!1}}]),e}(N.a),nt=i(25),ot=i(74),ut=(et=function(){function t(){o()(this,t),this.enableTempPanePosition=!1,this.totalWidth=new U.a(0),this._panesById={},this._panes=new R.a,this.displayPanes=new R.a,this.isLoading=new U.a(!0),this._isInitialStateLoaded=!1,this.animatePaneSwap=!1,this._iteratingPanes=!1,this._savedPaneState=void 0}return s()(t,[{key:"init",value:function(){}},{key:"load",value:function(){An.settings.activeUser.get()&&this.setupInitialTimeout(),this.isLoaded||(this._panes.listen(this.updateDisplayPanes),P.a.onResize.listen(this.onResize),k.a.listen("panesChanged",this.updateDisplayPanes),this.onResize(),this.isLoaded=!0)}},{key:"onPluginGmailToggled",value:function(){this.savePaneState(),this.loadPanesFromState()}},{key:"loadDemoPanes",value:function(t){var e=0;this.load(),An.PaneUpdateBatcher.beginUpdateItems();for(var i=0;i<t.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t[i].split(",");if("help"===r[0])m.default.vmMain.showHelp();else{var a=r[0],n={document:G.a.getDefaultDocument()};if("1"===a||"Outline"===a?(a=A.a.PaneMode.Task,n.viewState={viewMode:A.a.TaskViewMode.Outline}):("2"===a||"Calendar"===a)&&(a=A.a.PaneMode.Task,n.viewState={viewMode:A.a.TaskViewMode.Calendar_Week}),r.length>1){if(r[1]){for(var o=0,u={text:r[1]},s=r[1].split(" "),h=0;h<s.length;h++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var d=!1,c="-"===s[h][0],v=s[h].replace("-","");if(v.indexOf("//")>=0)d=!0,u.complete=c?-1:1;else if(v.indexOf("*")>=0)d=!0,u.starred=c?-1:1;else if(v.indexOf("!")>=0){var y;d=!0,3===v.length?y=A.a.VMLIFlag.P0:2===v.length?y=A.a.VMLIFlag.P1:1===v.length&&(y=A.a.VMLIFlag.P2),u.priority=y}d&&(u.text=u.text.replace(s[h],""))}n.search=u}var g=void 0;r[2]&&(g=G.a.getItem(r[2])),n.item=g}var l=ot.a.createPane(a,n);l&&this.addPaneAtIndex(l)}}var p=this.getPaneAtIndex(0);try{m.default.PAssert(717,p,"Must always have at least one valid pane in demo mode")}catch(f){m.default.reportError(f)}p&&(q.a.setFocusedPane(p),p.zoomIn(p.getItem(),!0)),this.notifyPanes(),An.PaneUpdateBatcher.commitUpdateItems()}},{key:"getStats",value:function(t){var e={};return void 0===t?this.runForEachPane(function(t){e[t.id]=t.getStats()}):e=this.getPaneById(t).getStats(),e}},{key:"setupInitialTimeout",value:function(){0===this._panes.length()&&(clearTimeout(this._initialTimeout),this._initialTimeout=setTimeout(this._timeoutLoadFailed.bind(this),3e4))}},{key:"_timeoutLoadFailed",value:function(){0===this._panes.length()&&0===An.menus.modalStack.length()&&(m.default.reportError(new Error("Pane Load Timeout")),An.toasts.pushMessage(A.a.MessageID.PaneLoadTimeout))}},{key:"notifyPanes",value:function(){this._panes.notify()}},{key:"onResize",value:function(){this.updatePaneRects()}},{key:"getNextPaneID",value:function(){return++m.default.totalPanes+"P"+Date.now()}},{key:"getAllPerPaneState",value:function(t,e){for(var i=0,r=[],a=this.paneCount(),n=0;n<a;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=this.getPaneAtIndex(n);r.push(o.getPerPaneState(t,e))}return r}},{key:"setAllPerPaneState",value:function(t,e,i){for(var r=0,a=this.paneCount(),n=0;n<a;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this.getPaneAtIndex(n).setPerPaneState(t,e,i)}}},{key:"deletePerPaneState",value:function(t,e){var i=this.getPaneById(t);i&&i.deletePerPaneState(e)}},{key:"updatePaneStateForPane",value:function(t){try{m.default.PAssert(718,t,"Must pass in a valid pane to update")}catch(e){m.default.reportError(e)}this.savePaneState()}},{key:"recreatePaneState",value:function(){var t=[];return this.runForEachPane(function(e){t.push(e.getSaveInfo())}),t}},{key:"isPaneActive",value:function(t){return!!this._panesById[t]}},{key:"createPaneAtIndex",value:function(t,e,i,r){try{m.default.PAssert(719,t,"Must supply a valid pane type")}catch(n){m.default.reportError(n)}try{m.default.PAssert(720,!this._iteratingPanes,"Should not change pane array while iterating")}catch(n){m.default.reportError(n)}isNaN(e)&&(e=this.paneCount()),(i=i||{}).id=i.id||this.getNextPaneID(),i.document=i.document||G.a.getDefaultDocument(),m.default.isString(i.item)&&(i.item=G.a.getItem(i.item));var a=ot.a.createPane(t,i);return a?this.addPaneAtIndex(a,e,!1,r):m.default.reportError(new Error("Invalid pane created: "+t+" | "+e)),a}},{key:"addPaneAtIndex",value:function(t,e,i,r){try{m.default.PAssert(721,t,"Must supply a valid pane")}catch(o){m.default.reportError(o)}this._panesById[t.id]&&(t.id=this.getNextPaneID());try{m.default.PAssert(722,!this._panesById[t.id],"Should never add the same pane twice")}catch(o){m.default.reportError(o)}if(this._panesById[t.id]=t,this.enableTempPanePosition&&this._panes.length()>0&&e===this._panes.length()){var a=this._panes.get()[this._panes.length()-1];this.tempPositionForNewPane={pane:a,left:a.rect.get().left+A.a.PaneSpaceSize}}if(isNaN(e)?this._panes.push(t,r):this._panes.splice(e,0,t,r),t.init(),t.isExpanded.listen(this.onResize),this.tempPositionForNewPane&&(this.tempPositionForNewPane=null,setTimeout(this.onResize.bind(this),0)),this.ensurePaneInView(t),!i){var n=this.getPaneState();isNaN(e)?n.push(t.getSaveInfo()):n.splice(e,0,t.getSaveInfo()),this.savePaneState()}}},{key:"unloadPane",value:function(t){t.unload(),t.isExpanded.unlisten(this.onResize),k.a.fireEvent("paneRemoved",[t]);try{m.default.PAssert(723,this._panesById[t.id],"Should never add the same pane twice")}catch(e){m.default.reportError(e)}this._panesById[t.id]=void 0,t.destroy()}},{key:"removePaneAtIndex",value:function(t,e){try{m.default.PAssert(724,!isNaN(t),"Must supply a valid index to remove from")}catch(a){m.default.reportError(a)}try{m.default.PAssert(725,!this._iteratingPanes,"Should not change pane array while iterating")}catch(a){m.default.reportError(a)}var i,r=this._panes.splice(t,1,void 0,e)[0];try{m.default.PAssert(726,r,"Must have removed a valid pane")}catch(a){m.default.reportError(a)}return this.unloadPane(r),this.getPaneState().splice(t,1),this.savePaneState(),i=r.id,this.ensurePaneInView(),i}},{key:"loadPaneFromState",value:function(t){if(t.id&&this.isPaneActive(t.id))return this._panesById[t.id];var e=t.item||t.focus,i=e&&G.a.getItem(e),r=t.document,a=G.a.getDocumentById(r);i&&i.isDeleted()&&(i=void 0);var n,o=t.type||"PaneTask",u=m.default.clone(t);return u.item=i,u.document=a,u.deferredItemID=i?void 0:e,u.offset=t.offset,u.id&&this.isPaneActive(u.id)||(n=ot.a.createPane(o,u))&&(t.id=n.id,t.showarch&&n.showArchived.set(!0),n.applyItemState(t.itemState)),n}},{key:"indexOfPaneType",value:function(t,e){return this._panes.get().findIndex(function(i){return t!==A.a.PaneMode.Task?i.type===t:e===A.a.TaskViewMode.Outline?i.isViewOutline():i.isViewAgenda()})}},{key:"removeFocusedPane",value:function(){return this.removePane(m.default.focusedPane)}},{key:"removePane",value:function(t){var e=this.getPaneIndex(t);return this.removePaneAtIndex(e)}},{key:"clearPanes",value:function(t){try{m.default.PAssert(727,m.default.isDemoMode(),"Should only be clearing panes in demo mode")}catch(e){m.default.reportError(e)}q.a.setFocusedPane(void 0),this.runForEachPane(function(t){t.destroy()}),this._panesById={},this._panes.set([],t)}},{key:"clearPaneCaches",value:function(){this.runForEachPane(function(t){t.getInfiniteList().clearCache()})}},{key:"getPaneAtIndex",value:function(t){return this._panes.get()[t]}},{key:"getPaneIndex",value:function(t){return this._panes.get().indexOf(t)}},{key:"getFocusedPaneIndex",value:function(){return this.getPaneIndex(m.default.focusedPane)}},{key:"getPaneById",value:function(t){try{m.default.PAssert(730,this._panesById[t],"Should never request a pane that is not currently loaded")}catch(e){m.default.reportError(e)}return this._panesById[t]}},{key:"getPanesByType",value:function(t){for(var e=0,i=[],r=this.paneCount(),a=0;a<r;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this.getPaneAtIndex(a);t&&n.type!==t||i.push(n)}return i}},{key:"paneCount",value:function(){return this._panes.get().length}},{key:"runForEachPane",value:function(t,e){var i=0;this._iteratingPanes=!0;for(var r=this.paneCount(),a=0;a<r;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=this.getPaneAtIndex(a);try{m.default.PAssert(731,!n.isDestroyed(),"Should never have a destroyed pane in pane list")}catch(o){m.default.reportError(o)}if(!e||n.type===e)try{t(n)}catch(u){m.default.reportError(u)}}this._iteratingPanes=!1}},{key:"applyFnToPanes",value:function(t,e){var i=0;this._iteratingPanes=!0;for(var r=this.paneCount(),a=0;a<r;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=this.getPaneAtIndex(a);try{m.default.PAssert(732,!n.isDestroyed(),"Should never have a destroyed pane in pane list")}catch(u){m.default.reportError(u)}if(!e||n.type===e){var o=n[t];try{m.default.PAssert(733,o,"Must provide a valid function name for the given pane type")}catch(u){m.default.reportError(u)}try{o.apply(n,Array.prototype.slice.call(arguments,2))}catch(s){m.default.reportError(s)}}}this._iteratingPanes=!1}},{key:"dragPaneTo",value:function(t,e,i){for(var r,a=0,n=this._panes.get(),o=n.indexOf(t),u=-1,s=Number.MAX_VALUE,h=this.paneCount(),d=0;d<h;++d){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var c=this.getPaneAtIndex(d).rect.get(),v=Math.abs(d<=o?c.left-e:c.right-i);v<s&&(s=v,u=d)}if(u>=0){var y=n.indexOf(t);y!==u&&(n.splice(u,0,n.splice(y,1)[0]),this._panes.set(n),this.savePaneState(),r=!0)}return r}},{key:"paneSortFn",value:function(t,e){return t.uniquePaneID-e.uniquePaneID}},{key:"clearLoadTimeout",value:function(){clearTimeout(this._initialTimeout),this._initialTimeout=void 0,An.toasts.clearMessage(A.a.MessageID.PaneLoadTimeout)}},{key:"updateDisplayPanes",value:function(){var t=0;this._initialTimeout&&this.clearLoadTimeout();for(var e=this._panes.get().slice(0).sort(this.paneSortFn),i=[],r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=e[r];a.isOverviewVisible()&&i.push({type:"overview",pane:a}),i.push({type:"pane",pane:a}),a.isExpanded.get()&&i.push({type:"emailPreview",pane:a})}this.updatePaneRects(),this.displayPanes.set(i),this.isLoading.set(!1)}},{key:"hasScrollbar",value:function(){return this.totalWidth.get()>P.a.windowWidth()}},{key:"onBoardChanged",value:function(){this.loadPanesFromState()}},{key:"_addPaneByButton",value:function(t,e,i,r){var a=this.createPaneAtIndex(t,void 0,{viewState:{viewMode:e},item:i});a&&(Y.e.performAction(Y.c.UIAction,{type:Y.d.AddPane,data:{type:t,pane:a}}),m.default.sendEvent("Menu","AddPane_"+t)),q.a.setFocusedPane(a),a.onAdded(r)}},{key:"addPaneByButton",value:function(t,e,i){m.default.vmMain.paneFactory.canCreatePane(t)&&this._addPaneByButton(t,e,i)}},{key:"emailPreviewSize",value:function(t){var e=this._panes.length()>1?A.a.EmailPreviewSizeMaxFlex:A.a.EmailPreviewSizeMax,i=t.widthManual||A.a.ExpandedPaneWidth;return t.getOverview().isVisible.get()&&(i+=A.a.OverviewWidth),Math.max(Math.min(e,P.a.windowWidth()-i),A.a.EmailPreviewSizeMin)}},{key:"onLoadRemote",value:function(){}}]),t}(),I()(et.prototype,"onResize",[H.a],Object.getOwnPropertyDescriptor(et.prototype,"onResize"),et.prototype),I()(et.prototype,"updateDisplayPanes",[H.a],Object.getOwnPropertyDescriptor(et.prototype,"updateDisplayPanes"),et.prototype),et),st=i(44),ht=function(t){function e(){var t;return o()(this,e),(t=d()(this,v()(e).call(this)))._docID=void 0,t._state={selected:"",panes:{}},t.selected=new U.a({type:A.a.PaneMode.Task,viewMode:A.a.TaskViewMode.Outline}),t}return p()(e,t),s()(e,[{key:"init",value:function(){g()(v()(e.prototype),"init",this).call(this),An.settings.panesMobile.listen(this.onSettingChanged.bind(this))}},{key:"loadPanesFromState",value:function(t,e){if(e||0===this._panes.length()&&G.a.hasDocuments()&&(t||An.settings.panesMobile.get())){var i=0;this.load();var r=[];An.pluginManager.isGmailPaneEnabled()&&r.push(this.loadPaneType(A.a.PaneMode.Gmail,"Email")),r.push(this.loadPaneType(A.a.PaneMode.Task,"Tasks",A.a.TaskViewMode.Outline)),r.push(this.loadPaneType(A.a.PaneMode.Task,"Agenda",A.a.TaskViewMode.Agenda_All));for(var a=0;a<r.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=r[a];this._panesById[n.id]=n}this._panes.set(r,!1);try{m.default.PAssert(351,this.selected.get(),"Mobile pane selected should be set")}catch(h){m.default.reportError(h)}var o,u=this.selected.get();if(u&&(o=this.indexOfPaneType(u.type,u.viewMode)),isNaN(o)||!r[o]){var s={type:A.a.PaneMode.Task,viewMode:A.a.TaskViewMode.Outline};this.selected.set(s),o=this.indexOfPaneType(s.type,s.viewMode)}q.a.setFocusedPane(r[o]),this.notifyPanes()}}},{key:"onLoadRemote",value:function(){this.loadPanesFromState(!0)}},{key:"loadPaneType",value:function(t,e,i){var r,a=this.getMobilePaneName(t,i),n=this._state.panes&&this._state.panes[a];if(n)r=An.PaneManager.loadPaneFromState(n);else{var o=G.a.getDefaultDocument();r=ot.a.createPane(t,{name:e,viewState:{viewMode:i},document:o})}return r.init(),r}},{key:"hasLoadedPaneState",value:function(){return this._panes.length()>0}},{key:"getPaneState",value:function(){return 0===this._panes.length()&&this.load(),this._panes.get()}},{key:"savePaneState",value:function(){var t=this.recreatePaneState();if(t[0])for(var e=0,i=0;i<t.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t[i],a=this.getMobilePaneName(r.type,r.viewState.viewMode);this._state.panes||(this._state.panes={}),this._state.panes[a]=r}this.save()}},{key:"migrateFromPaneState",value:function(t){var e={};for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];e[i]=this.createDefaultState(r),r[0]&&(e[i].selected={type:r[0].type,viewMode:A.a.TaskViewMode.Outline})}return e}},{key:"createDefaultState",value:function(t){var e={selected:A.a.PaneMode.Task,panes:{}};if(t)for(var i=0,r=0;r<t.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e.panes[t[r].type]=[t[r]]}return e}},{key:"load",value:function(){g()(v()(e.prototype),"load",this).call(this);var t,i,r=!1,a=An.settings.panesMobile.get();if(t=a,a){if(m.default.isString(a))try{i="A",t=JSON.parse(a),i="AA"}catch(o){i="AB"}}else{i="B",r=!0;var n=nt.a.getLegacyLocalStorage("paneState");if(n){try{n=JSON.parse(n),i="BA"}catch(o){i="BB",m.default.reportError(o),n={}}t=this.migrateFromPaneState(n)}else i="C"}(t=t||this._state)||(t=this.createDefaultState([]),r=!0),t.selected||(t.selected={type:A.a.PaneMode.Task,viewMode:A.a.TaskViewMode.Outline});try{m.default.PAssert(352,t.panes,"Should have panes set by now",i)}catch(u){m.default.reportError(u)}t.panes||(t.panes={}),this._state=t,this.selected.set(t.selected),r&&this.save(),this._isLoaded=!0}},{key:"save",value:function(){this._state.selected=this.selected.get(),An.settings.panesMobile.set(m.default.clone(this._state))}},{key:"onSettingChanged",value:function(){this._isSaving||this.load()}},{key:"getMobilePaneName",value:function(t,e){return t+(t===A.a.PaneMode.Task&&e?"_"+e:"")}},{key:"swapToPane",value:function(t,e,i){try{m.default.PAssert(353,P.a.isMobile,"We only perform pane swapping on mobile")}catch(n){m.default.reportError(n)}try{m.default.PAssert(354,!this._iteratingPanes,"Should not change pane array while iterating")}catch(n){m.default.reportError(n)}st.default.setOverviewVisibility(m.default.focusedPane,!1);var r=this.indexOfPaneType(t,e);r<0&&(this.loadPanesFromState(!1,!0),r=this.indexOfPaneType(t,e));var a=this._panes.get()[r];this.animatePaneSwap=i;try{m.default.PAssert(355,a,"Swapping to undefined pane",t,this._panes.length())}catch(n){m.default.reportError(n)}return q.a.setFocusedPane(a),this.selected.set({type:t,viewMode:e}),this.savePaneState(),a}},{key:"loadInitialState",value:function(){var t=An.pluginManager.getPlugin(A.a.PluginID.Gmail);t.onSettingChanged(t.Settings.IsEnabled,this.onPluginGmailToggled.bind(this)),this.loadPanesFromState()}},{key:"removePanesByType",value:function(t){try{m.default.PAssert(356,t,"Must supply a valid pane type to remove")}catch(e){m.default.reportError(e)}this.loadPanesFromState(!1,!0),m.default.focusedPane&&m.default.focusedPane.type!==t||this.swapToPane(A.a.PaneMode.Task)}},{key:"getPaneTopPadding",value:function(){return m.default.topBarHeight}},{key:"updatePaneRects",value:function(t){var e=0;this.isResizingPane=t;var i,r=this._panes.get(),a=P.a.windowWidth(),n=P.a.windowHeight()-this.getPaneTopPadding();for(i=0;i<r.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o={left:i*a,top:0,width:a,height:n,right:a,bottom:n},u=r[i];m.default.areObjectsEqual(u.rect.get(),o)||u.rect.set(o)}this.selected.notify()}},{key:"ensurePaneInView",value:function(t){}}]),e}(ut),dt=i(98),ct=i(61);function vt(){this.scheduledItems=[],this.notifiedItems={},this.timeoutNextNotification=void 0,V.a.binder(this,"runNotifications")}vt.prototype={scheduleItems:function(t){var e=this;this.scheduledItems=t,P.a.hasNotificationPermission()?this.runNotifications():Notification.requestPermission(function(){e.runNotifications()})},runNotifications:function(){for(var t=0,e=0;e<this.scheduledItems.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.scheduledItems[e];this.notifiedItems[i.id]&&this.notifiedItems[i.id]===i.date||this.runNotification(i)}var r=new Date,a=Math.max(6e4-1e3*r.getSeconds()-r.getMilliseconds(),1e3);m.default.shouldLog(A.a.LogLevels.Timeline)&&m.default.log("Next Notifications in: ",a),clearTimeout(this.timeoutNextNotification),this.timeoutNextNotification=setTimeout(this.runNotifications,a)},runNotification:function(t){var e=new Date,i=new Date(t.alertDate),r=new Date(t.date),a=Math.max(i.getTime()-e.getTime(),0),n=r.getTime()-e.getTime();if(n>=0&&a<=0){try{m.default.PAssert(1240,a<=n,"Alert must always be before actual event")}catch(u){m.default.reportError(u)}var o=Math.ceil((r.getTime()-Date.now())/6e4);new Notification(t.text,{body:"in "+o+" minutes",icon:P.a.isNativeApp()?void 0:"/img/favicon-96x96.png",requireInteraction:!0});this.notifiedItems[t.id]=t.date,m.default.shouldLog(A.a.LogLevels.Timeline)&&m.default.log("Show HTML5 Notification: ",t)}else this.notifiedItems[t.id]=t.date}};var yt,gt=new vt,lt=new(function(){function t(){o()(this,t)}return s()(t,[{key:"asdfasdf",value:function(){}},{key:"setNotifications",value:function(t){P.a.usesHTML5Notifications()?(gt.scheduleItems(t),m.default.shouldLog(A.a.LogLevels.Timeline)&&m.default.log("HTML5 Scheduling Completed: ",t.length)):An.nativeBridge.isEnabled()?An.nativeBridge.sendToApp("scheduledItems",t):An.nativeBridge.hasEmbedBridge()&&An.nativeBridge.sendToEmbed("scheduledItems",t)}}]),t}()),pt=(yt=function(){function t(){o()(this,t),this.notificationItems={},this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0,this.oldSoftDates=["now","next","soon","later","someday"],this.agendaSort=An.settings.agendaSort}return s()(t,[{key:"clearDailyCaches",value:function(){}},{key:"addNotification",value:function(t){try{m.default.PAssert(274,t,"Must provide a valid item to schedule notifications for")}catch(e){m.default.reportError(e)}this.notificationItems[t.id]=t,this.numNotificationItemsChanged++,clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,5e3),m.default.shouldLog(A.a.LogLevels.Timeline)&&m.default.log("Add Notification: ",t)}},{key:"removeNotification",value:function(t){try{m.default.PAssert(275,t,"Must provide a valid item to unschedule notifications for")}catch(e){m.default.reportError(e)}this.notificationItems[t.id]&&(this.notificationItems[t.id]=void 0,this.numNotificationItemsChanged++,clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,5e3),m.default.shouldLog(A.a.LogLevels.Timeline)&&m.default.log("Remove Notification: ",t))}},{key:"clearNotifications",value:function(){for(var t in this.notificationItems)this.notificationItems.hasOwnProperty(t)&&(this.notificationItems[t]=void 0,this.numNotificationItemsChanged++);clearTimeout(this.scheduleTimeout),this.scheduleTimeout=setTimeout(this.setupNotifications,5e3),m.default.shouldLog(A.a.LogLevels.Timeline)&&m.default.log("Clear Notifications")}},{key:"shouldNotify",value:function(t,e){e||(e=new Date);var i=t.getNextDate();return!t.isDestroyed()&&!t.isDeleted()&&!t.isComplete()&&!t.hasCompletedAncestor()&&!t.allDayDate()&&i&&i>e&&+i-Date.now()<864e5}},{key:"updateNotifications",value:function(t){var e=this;if(P.a.supportsNotifications()&&ct.a.isNotificationsEnabled()&&!m.default.isDemoMode()){var i=new Date;t?(m.default.__SINGLE_NOTIFICATION_UPDATES++,this.shouldNotify(t,i)?this.addNotification(t):this.removeNotification(t)):(m.default.__FULL_NOTIFICATION_UPDATES++,this.clearNotifications(),G.a.runOnAllDocumentRoots(function(t){m.default.searchVMLIs({item:t,includeArchived:!1,each:function(t){e.shouldNotify(t,i)&&e.addNotification(t)}})}))}}},{key:"setupNotifications",value:function(){try{m.default.PAssert(276,P.a.supportsNotifications(),"Platform must support notifications")}catch(a){m.default.reportError(a)}var t=[];for(var e in this.notificationItems)if(this.notificationItems.hasOwnProperty(e)){var i=this.notificationItems[e];if(i&&i.getNotificationEntry){var r=i.getNotificationEntry();r&&t.push(r)}else delete this.notificationItems[e]}lt.setNotifications(t),m.default.shouldLog(A.a.LogLevels.Timeline)&&m.default.log("Notifications Scheduled: "+this.numNotificationItemsChanged),this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0,m.default.shouldLog(A.a.LogLevels.Timeline)&&m.default.log("Scheduled Notifications: ",t)}},{key:"getDateForKey",value:function(t){return this.oldSoftDates.indexOf(t)>=0&&(t="#"+t),this.agendaSort.get()[t]}},{key:"saveAgendaSort",value:function(t){this.agendaSort.set(t),An.settings.agendaSort.set(t),An.PaneManager.runForEachPane(function(t){t.isViewAgenda()&&t.setItemsDirty()}),An.PaneUpdateBatcher.updateAllItems()}}]),t}(),I()(yt.prototype,"setupNotifications",[H.a],Object.getOwnPropertyDescriptor(yt.prototype,"setupNotifications"),yt.prototype),yt);function mt(){this._registeredRenderers=[],this._registeredRenderers[A.a.PluginRenderTypes.Generic]={},this._registeredRenderers[A.a.PluginRenderTypes.StyledText]={},this._registeredRenderers[A.a.PluginRenderTypes.UnstyledText]={},this._registeredRenderers[A.a.PluginRenderTypes.Measure]={}}mt.prototype={registerDefaultRenderers:function(){var t=this;this.registerRenderer(A.a.PluginRenderTypes.StyledText,A.a.PluginRenderers.DriveFile,function(t,e,i){if(t.isLoaded()){var r=t.getField("title");return i&&(r=An.ElementRenderer.replaceTextWithSearch(r,e)),t.hasField("isDeleted")&&t.getField("isDeleted")?r+"  (Deleted)":r}return t.hasField("title")?t.getField("title")+"  (Loading...)":t.isLocalOnlyAttachment()?"Failed upload":"Loading..."},["title"]),this.registerRenderer(A.a.PluginRenderTypes.UnstyledText,A.a.PluginRenderers.DriveFile,function(t){return t.hasField("title")?t.getField("title"):"Loading..."},["title"]),this.registerRenderer(A.a.PluginRenderTypes.Measure,A.a.PluginRenderers.DriveFile,function(e,i,r){var a=t.useRenderer(A.a.PluginRenderTypes.StyledText,A.a.PluginRenderers.DriveFile);return An.Measure.measureWord(i,a(e),r,!1)},["title"]),this.registerRenderer(A.a.PluginRenderTypes.StyledText,A.a.PluginRenderers.EmailThread,function(t,e,i){var r="";if(t&&t.isLoaded()){var a=t.getField("count"),n=t.getField("subject");if(n&&""!==n||(n="(no subject)"),i&&(n=An.ElementRenderer.replaceTextWithSearch(n,e)),n='<span class="subject c-foreground'+(a>1?" hasCount":"")+'">'+n+"</span>",e&&e.type===A.a.PaneMode.Gmail){var o=t.getPlugin().getDisplayTags(t,e);r+='<span class="line1"><span class="from">'+t.getPlugin().getDisplayParticipants(t)+"</span>";var u,s=t.getField("date");if(u=s.isToday()?An.International.getFormat(A.a.DFormat.ShortTime):s.getYear()!==(new Date).getYear()?An.International.getFormat(A.a.DFormat.MonthDayYearShort):An.International.getFormat(A.a.DFormat.MonthDay),r+='<span class="emailDate c-foreground-faded">'+s.toString(u)+"</span></span>",r+='<span class="line2">'+n,(t.getField("hasAttachments")||a>1)&&(r+='<span class="line2Right">',t.getField("hasAttachments")&&(r+='<span class="attach icon-attach_file"></span>'),a>1&&(r+='<span class="count">'+a+"</span>"),r+="</span>"),r+="</span>",t.hasField("snippet")||o.length){if(r+='<span class="line3">',t.hasField("snippet")&&(r+='<span class="snippet c-foreground-faded">'+t.getField("snippet")+"</span>"),o.length){var h=0;r+='<span class="tags">';for(var d=0;d<o.length;++d){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;r+='<span class="emailLabel c-tag">'+o[d]+"</span>"}r+="</span>"}r+="</span>"}}else r=n}else r="Loading...";return r},["from","subject","snippet","count","date"]),this.registerRenderer(A.a.PluginRenderTypes.UnstyledText,A.a.PluginRenderers.EmailThread,function(t){if(t.isLoaded()){var e=t.getField("subject");return e&&""!==e||(e="(no subject)")," "+e+" "}return"Loading..."},["from","subject"]),this.registerRenderer(A.a.PluginRenderTypes.Measure,A.a.PluginRenderers.EmailThread,function(t,e,i){var r;return t.isLoaded()?(r=t.getField("subject"))&&""!==r||(r="(no subject)"):r="Loading...",An.Measure.measureWord(e,r,i,!1)},[]),this.registerRenderer(A.a.PluginRenderTypes.StyledText,A.a.PluginRenderers.CalendarEvent,function(t){return""},[]),this.registerRenderer(A.a.PluginRenderTypes.UnstyledText,A.a.PluginRenderers.CalendarEvent,function(t){return""},[]),this.registerRenderer(A.a.PluginRenderTypes.Measure,A.a.PluginRenderers.CalendarEvent,function(e,i,r){var a=t.useRenderer(A.a.PluginRenderTypes.StyledText,A.a.PluginRenderers.CalendarEvent);return An.Measure.measureWord(i,a(e),r,!1)},[]),this.registerRenderer(A.a.PluginRenderTypes.StyledText,A.a.PluginRenderers.Unknown,function(t){return"Unknown Plugin"},[]),this.registerRenderer(A.a.PluginRenderTypes.Measure,A.a.PluginRenderers.Unknown,function(t,e,i){return An.Measure.measureWord(e,"Unknown Plugin",i,!0)},[])},registerRenderer:function(t,e,i,r){try{m.default.PAssert(656,this._registeredRenderers[t],"Invalid renderer type",t,e)}catch(a){m.default.reportError(a)}try{m.default.PAssert(657,!this._registeredRenderers[t][e],"Cannot register a renderer twice",t,e)}catch(a){m.default.reportError(a)}this._registeredRenderers[t][e]={fn:i,fields:r}},useRenderer:function(t,e){try{m.default.PAssert(658,this._registeredRenderers[t],"Invalid renderer type",t,e)}catch(i){m.default.reportError(i)}try{m.default.PAssert(659,this._registeredRenderers[t][e],"Renderer has not been registered yet",t,e)}catch(i){m.default.reportError(i)}return this._registeredRenderers[t][e].fn},ensureRendererFields:function(t,e,i){}};var ft=mt,kt=i(34),At={Unloaded:1,Waiting:2,Requesting:3,LoadedPreview:4,LoadedFull:5,FailedRequest:6,Updating:7},St=function(){function t(e,i,r){o()(this,t),this.id=i,this._oldLocalID=void 0,this._plugin=e,this._loadState=At.Unloaded,this._subscribers=[],this._countInUse=0,this._iteratingSubscribers=!1,this._numRemoteRequests=0,this._inlineData=r,this.load()}return s()(t,[{key:"load",value:function(t){this._loadState=At.Waiting,this._plugin.requestData(this,t)}},{key:"notifyDataRequested",value:function(){try{m.default.PAssert(1514,!this.isLoaded(),"Should not request additional data once loaded")}catch(t){m.default.reportError(t)}this._numRemoteRequests++,this._loadState=At.Requesting}},{key:"notifyDataLoaded",value:function(t,e,i,r){try{m.default.PAssert(1515,e||this._loadState!==At.LoadedFull||m.default.isFlagSet(t,A.a.PluginLoad.Full),"Should not load preview data after full data has been loaded")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1516,!e||this._loadState===At.LoadedPreview||m.default.isFlagSet(t,A.a.PluginLoad.Full),"Incoming update much match previous type")}catch(a){m.default.reportError(a)}this._loadState=m.default.isFlagSet(t,A.a.PluginLoad.Full)?At.LoadedFull:At.LoadedPreview,this.onUpdate(!0,i,r)}},{key:"notifyDataMutated",value:function(t,e){try{m.default.PAssert(1517,t&&m.default.isArray(t),"Must specify valid update fields when mutating attachment state manually")}catch(i){m.default.reportError(i)}this.onUpdate(!0,t,e)}},{key:"notifyDataRequestFailed",value:function(){try{m.default.PAssert(1518,this._loadState===At.FailedRequest||this._loadState===At.Requesting||this._loadState===At.LoadedPreview,"Must be requesting remote data or a preview cache was able to service after the request was sent")}catch(t){m.default.reportError(t)}if(this._loadState===At.FailedRequest)   ;else if(this._loadState===At.Requesting)this._loadState=At.FailedRequest;else if(this._loadState===At.LoadedPreview)try{m.default.PAssert(1519,!1,"Failed remote reuqest but serviced by preview cache, should not have made the request?")}catch(t){m.default.reportError(t)}else try{m.default.PAssert(1520,!1,"Invalid loadstate when remote request failed: ",this._loadState)}catch(t){m.default.reportError(t)}}},{key:"isLoaded",value:function(){return this._loadState===At.LoadedPreview||this._loadState===At.LoadedFull}},{key:"needsRemoteData",value:function(){return this._loadState!==At.LoadedFull}},{key:"getOldID",value:function(){return this._oldLocalID}},{key:"changeID",value:function(t){try{m.default.PAssert(1521,this.id!==t,"Change the ID of an attachment to the same value")}catch(a){m.default.reportError(a)}if(this.id!==t){var e=0,i=this.id;this.id=t,this._oldLocalID=i;try{m.default.PAssert(1522,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(a){m.default.reportError(a)}this._iteratingSubscribers=!0;for(var r=0;r<this._subscribers.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;try{this._subscribers[r].onAttachmentIDChange(this,i)}catch(n){m.default.reportError(n)}}this._iteratingSubscribers=!1,this._oldLocalID=void 0}}},{key:"delayChangeID",value:function(){var t=0;try{m.default.PAssert(1523,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(a){m.default.reportError(a)}this._iteratingSubscribers=!0;for(var e=0;e<this._subscribers.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._subscribers[e];try{var r=i.onAttachmentIDChange.bind(i,this,this.id);setTimeout(r,0)}catch(n){m.default.reportError(n)}}this._iteratingSubscribers=!1}},{key:"isFieldDefined",value:function(t){return this._plugin.isFieldDefined(t)}},{key:"hasField",value:function(t){return this._plugin.hasAttachField(this,t)}},{key:"getField",value:function(t){return this._plugin.getAttachField(this,t)}},{key:"updateField",value:function(t,e,i){return this._plugin.updateAttachField(this,t,e,i)}},{key:"fieldsHaveParseEffect",value:function(t){return this._plugin.fieldsHaveParseEffect(t)}},{key:"isFieldDefault",value:function(t){return this._plugin.isAttachFieldDefault(this,t)}},{key:"fieldNeedsWrite",value:function(t,e){return this._plugin.fieldNeedsWrite(this,t,e)}},{key:"getFieldAsDate",value:function(t){var e=this._plugin.getAttachField(this,t);if(e)return new Date(e).toString(An.International.getFormat(A.a.DFormat.MonthDay));try{m.default.PAssert(1524,!1,"Invalid attachment date field: ",this._plugin.id,t)}catch(i){m.default.reportError(i)}}},{key:"getPlugin",value:function(){return this._plugin}},{key:"getData",value:function(){return this._plugin.getCacheData(this.id)}},{key:"getEmbedString",value:function(){return this._plugin.getAttachmentEmbedString(this)}},{key:"getTitleString",value:function(){return this._plugin.getAttachmentTitleString(this)}},{key:"unload",value:function(){this._loadState=At.Unloaded,this._plugin.releaseAttachment(this)}},{key:"match",value:function(t){return!!this.isLoaded()&&this._plugin.matchAttachment(this,t)}},{key:"markInUse",value:function(t){0===this._countInUse&&this._plugin.notifyAttachmentInUse(this,t),this._countInUse++}},{key:"markUnused",value:function(t){this._countInUse--,0===this._countInUse&&this._plugin.notifyAttachmentUnused(this,t);try{m.default.PAssert(1525,this._countInUse>=0,"Should never have negative users of the attachment")}catch(e){m.default.reportError(e)}}},{key:"isInUse",value:function(){return this._countInUse>0}},{key:"subscribe",value:function(t){try{m.default.PAssert(1526,this._subscribers.indexOf(t)<0,"Must not double subscribe")}catch(e){m.default.reportError(e)}try{m.default.PAssert(1527,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(e){m.default.reportError(e)}try{m.default.PAssert(1528,t.onAttachmentUpdate,"Must specify a valid subscriber callback")}catch(e){m.default.reportError(e)}this._subscribers.push(t)}},{key:"unsubscribe",value:function(t){try{m.default.PAssert(1530,this._subscribers.indexOf(t)>=0,"Subscriber should be active")}catch(e){m.default.reportError(e)}try{m.default.PAssert(1531,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(e){m.default.reportError(e)}this._subscribers.remove(t)}},{key:"forEachItem",value:function(t,e){var i=0;try{m.default.PAssert(1533,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(a){m.default.reportError(a)}this._iteratingSubscribers=!0;for(var r=0;r<this._subscribers.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(m.default.isVMLI(this._subscribers[r])&&(!t||this._subscribers[r].belongsToItemStore(t)))try{e(this._subscribers[r])}catch(n){m.default.reportError(n)}}this._iteratingSubscribers=!1}},{key:"onUpdate",value:function(t,e,i){var r=0;try{m.default.PAssert(1534,!e||m.default.isArray(e),"Must supply a valid value for updateFields:",e)}catch(o){m.default.reportError(o)}if(i=i||A.a.ChangeType.Remote,t&&this.isInUse())try{this._plugin.notifyAttachmentUpdated(this)}catch(u){m.default.reportError(u)}if(t||(i|=A.a.ChangeType.PluginLoad),e)for(var a=0,n=0;n<e.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;try{m.default.PAssert(1535,this._plugin.isFieldDefined(e[n]),"Invalid field supplied to be updated: ",e[n])}catch(o){m.default.reportError(o)}}try{m.default.PAssert(1536,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(o){m.default.reportError(o)}this._iteratingSubscribers=!0;for(n=0;n<this._subscribers.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;try{this._subscribers[n].onAttachmentUpdate(this,e,i)}catch(u){m.default.reportError(u)}}this._iteratingSubscribers=!1}},{key:"notifyItemNoteChanged",value:function(t){this._plugin.notifyItemNoteChanged(this,t)}},{key:"notifyItemTextChanged",value:function(t,e){this._plugin.notifyItemTextChanged(this,t,e)}},{key:"notifyItemDateChanged",value:function(t){this._plugin.notifyItemDateChanged(this,t)}},{key:"notifyItemPropertyChanged",value:function(t,e,i){this._plugin.notifyItemPropertyChanged(this,t,e,i)}},{key:"isLocalOnlyAttachment",value:function(){return m.default.isTempId(this.id)}},{key:"isType",value:function(t){return this._plugin.getType()===t}},{key:"isPlugin",value:function(t){return this._plugin.id===t}},{key:"shouldBeDeleted",value:function(){return this.isFieldDefined("isDeleted")&&this.hasField("isDeleted")&&this.getField("isDeleted")&&this.isLocalOnlyAttachment()}},{key:"hasFatalError",value:function(){return this._loadState===At.FailedRequest&&this._numRemoteRequests>3}},{key:"hasInlineData",value:function(){return!!this._inlineData}},{key:"getInlineData",value:function(){return this._inlineData}},{key:"setInlineData",value:function(t){this._inlineData=t,this._loadState=At.LoadedFull}},{key:"clearInlineData",value:function(){this._inlineData=void 0}}]),t}();function wt(t){this._taskCB=t,this._isRunning=!1,this._disabled=!1,this._workAvailable=!1,this._runCount=0,V.a.forceBind("handleLowImpactBegin",this),V.a.forceBind("_onTaskEndRun",this),k.a.listen("lowImpactBegin",this.handleLowImpactBegin)}wt.prototype={getStats:function(){return{runCount:this._runCount,isRunning:this._isRunning,isDisabled:this._disabled}},disable:function(){this._disabled=!0},enable:function(){this._disabled=!1},handleLowImpactBegin:function(){this._startTaskRun()},requestRun:function(){this._forceRun=!0,this._startTaskRun()},notifyWorkAvailable:function(){this._workAvailable=!0,m.default.vmMain.isLowImpact()&&!this._isRunning&&this._startTaskRun()},_startTaskRun:function(){if(!this._isRunning&&!this._disabled&&this._workAvailable){try{m.default.PAssert(1708,this._forceRun||m.default.vmMain.isLowImpact(),"Must always run a task during a low impact timeframe")}catch(t){m.default.reportError(t)}this._workAvailable=!1,this._isRunning=!0,this._runCount++,this._taskCB(this._onTaskEndRun)}},_onTaskEndRun:function(t){try{m.default.PAssert(1709,this._isRunning,"Must be currently running task to finish")}catch(e){m.default.reportError(e)}this._isRunning=!1,this._forceRun=!1,(t||this._workAvailable)&&(this._workAvailable=!0,m.default.vmMain.isLowImpact()&&this._startTaskRun())}};var Lt=wt;function Ft(t,e,i,r,a,n){try{m.default.PAssert(1703,m.default.isFunction(a),"Must supply a valid entry CB")}catch(o){m.default.reportError(o)}try{m.default.PAssert(1704,m.default.isFunction(n),"Must supply a valid done CB")}catch(o){m.default.reportError(o)}this._nextPageToken=t,this._inUse=!1,this._q=e,this._info=i,this._maxResults=r,this._entryCB=a,this._doneCB=n}var Ct={updateToken:function(t){try{m.default.PAssert(1705,this._nextPageToken!==t,"Should never update token to be same value")}catch(e){m.default.reportError(e)}this._nextPageToken=t},getNextPageToken:function(){return this._nextPageToken},getInfo:function(){return this._info},getQuery:function(){return this._q},getEntryCB:function(){return this._entryCB},getDoneCB:function(){return this._doneCB},getMaxResults:function(){return this._maxResults},hasMorePages:function(){return!!this._nextPageToken},notifyBeginUse:function(){try{m.default.PAssert(1706,!this._inUse,"Should not currently be in use")}catch(t){m.default.reportError(t)}this._inUse=!0},notifyEndUse:function(){try{m.default.PAssert(1707,this._inUse,"Should always be using token when done")}catch(t){m.default.reportError(t)}this._inUse=!1},isInUse:function(){return this._inUse}};V.a.defineBase(Ft),V.a.extend(Ft.prototype,Ct);var It=Ft,Pt=i(27),Nt=[1,5,20,40,80,170],Ht=[A.a.HTTPStatusCode.Network,A.a.HTTPStatusCode.Timeout,A.a.HTTPStatusCode.TooMany,A.a.HTTPStatusCode.ServerError,A.a.HTTPStatusCode.BadGateway,A.a.HTTPStatusCode.Unavailable,A.a.HTTPStatusCode.GatewayTimeout,null],Mt=[A.a.HTTPStatusCode.Forbidden,A.a.HTTPStatusCode.TooMany],zt={};zt[A.a.PluginDependency.DemoMode]={online:!1},zt[A.a.PluginDependency.GoogleLogin]={online:!0},zt[A.a.PluginDependency.PremiumSub]={online:!1},zt[A.a.PluginDependency.EarlyAccess]={online:!1};var Dt=A.a.DETAILED_STATS,Vt=function(){function t(e,i,r,a){var n=this;o()(this,t);try{m.default.PAssert(1378,e,"Must supply a valid id")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1379,r,"Must supply a valid name")}catch(u){m.default.reportError(u)}this.id=e,this.name=r,this.DefaultRequestTimeout=m.default.seconds(15),this.LongWaitThreshold=m.default.seconds(7),this._paneType="Pane"+e,this._acProviderId="AC"+e,this._settingsGroup="plugin"+this.id,this.pluginMargin=12,this.pluginPadding=24,this.isActiveObs=new U.a(!1),this._isReady=!1,this._hasDeactivated=!1,this._propertyDescriptors={},this._propertySets={},this._attachKeys=[],this._attachCache={},this._dataCache={},this._defaultItemStore=void 0,this._activeItemStore={},this._defaultZoomItems={},this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._isRateLimited=!1,this._lastRateLimitTime=void 0,this._numLongWaitRequests=0,this._numSendRequests=0,this._numHandledRequests=0,this._totalRequestSendTime=0,this._totalRequestHandleTime=0,this._requiresOfflineAuth=!1,this._activeAttachments=[],this._numActivePanes=0,this._requestCounter=0,this._unloadedDependencies=this.getDependencies(),this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._loadedInitialData=!1,this._hasLoadedCaches=!1,this._registeredCaches={},this._registeredModals={},this._createdModals={},this._recurringTasks=[],this._lowImpactTasks={},this._batchedResponses={},this.Settings={},V.a.binder(this,"_retryRemoteRequest","_reqSortFn"),An.settings.registerGroup(this._settingsGroup,i),this.registerSetting("IsEnabled","isEnabled","e",!0,a),this.getDataPane()&&ot.a.registerPaneType(this,this._paneType,this.name,this.getDataPane(),this.getPaneIcon(),this.getPanePriority()),Dt&&(this.__Stats={requestData:0,remoteRequests:0,canceledRequests:0,dupedRequests:0,combinedRequests:0,remoteBatches:0,remoteRetries:0,canceledBatches:0,actualRemoteCallsSent:0,cacheWrites:0,cacheUpdates:0,findByField:0,createdAttachments:0},this.__TrackedStats={},this.__ReqStats=[]),this.onSettingChanged(this.Settings.IsEnabled,function(t,e){t&&An.pluginManager.activatePlugin(n)})}return s()(t,[{key:"getType",value:function(){return A.a.PluginType.Unknown}},{key:"sendEvent",value:function(t,e){return m.default.sendEvent(this.id,t,e)}},{key:"getSettingObs",value:function(t){return An.settings[this._settingsGroup][t]}},{key:"getSetting",value:function(t){return An.settings[this._settingsGroup][t].get()}},{key:"setSetting",value:function(t,e,i){return An.settings[this._settingsGroup][t].set(e,i)}},{key:"registerSetting",value:function(t,e,i,r,a){this.Settings[t]=e,An.settings.registerSetting(e,i,this._settingsGroup,r,a)}},{key:"onSettingChanged",value:function(t,e){An.settings[this._settingsGroup][t].listen(e)}},{key:"getCacheStats",value:function(t){var e={},i=Object.keys(this._registeredCaches).length,r=0,a=function(a){e[a.id]=a,i===++r&&t(e)};if(i>0)for(var n in this._registeredCaches){if(this._registeredCaches.hasOwnProperty(n))this._registeredCaches[n].getStats(a)}else t()}},{key:"getCacheState",value:function(){var t={};for(var e in this._registeredCaches)if(this._registeredCaches.hasOwnProperty(e)){var i=this._registeredCaches[e];t[e]=i.getState()}return t}},{key:"registerLocalCache",value:function(t,e,i,r){var a;a=i?this.id:this.id+"_"+t;var n=An.cacheManager.registerLocalCache(a,t,e,r);return this._registeredCaches[a]=n,n}},{key:"registerDeferredTaskType",value:function(t,e,i,r){try{m.default.PAssert(1380,t,"Must specify a valid deferred task type")}catch(a){m.default.reportError(a)}An.deferredTaskManager.registerTaskType(t,e,i,r)}},{key:"scheduleDeferredTask",value:function(t,e,i,r){try{m.default.PAssert(1381,t,"Must supply a valid local ID for deferred task")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1382,e,"Must specify a valid deferred task type")}catch(a){m.default.reportError(a)}An.deferredTaskManager.scheduleTask(t,e,i,!1,void 0,r)}},{key:"cancelDeferredTask",value:function(t,e){An.deferredTaskManager.cancelTask(t,e)}},{key:"createRecurringTask",value:function(t,e){var i,r=this.id+"_"+t,a=An.recurringTaskManager;return this.hasRecurringTask(t)?i=a.getRecurringTask(r):(this._recurringTasks.push(t),i=An.recurringTaskManager.createRecurringTask(r,e)),i}},{key:"getRecurringTask",value:function(t){return An.recurringTaskManager.getRecurringTask(this.id+"_"+t)}},{key:"hasRecurringTask",value:function(t){return An.recurringTaskManager.hasRecurringTask(this.id+"_"+t)}},{key:"cancelRecurringTask",value:function(t){var e=this.id+"_"+t;return this._recurringTasks.remove(t),An.recurringTaskManager.cancelRecurringTask(e)}},{key:"cancelRecurringTasks",value:function(){for(var t=0;this._recurringTasks.length>0;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.cancelRecurringTask(this._recurringTasks[0])}}},{key:"getRecurringStats",value:function(){for(var t=0,e={},i=0;i<this._recurringTasks.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._recurringTasks[i],a=this.getRecurringTask(r);e[r]=a.getStats()}return e}},{key:"registerLowImpactTask",value:function(t,e){try{m.default.PAssert(1383,!this._lowImpactTasks[t],"Must specify different IDs for each task: ",t)}catch(r){m.default.reportError(r)}var i=new Lt(e);return this._lowImpactTasks[t]=i,i}},{key:"getLowImpactStats",value:function(){var t={};for(var e in this._lowImpactTasks)if(this._lowImpactTasks.hasOwnProperty(e)){var i=this._lowImpactTasks[e];t[e]=i.getStats()}return t}},{key:"getTrackedStat",value:function(t){if(Dt)return this.__TrackedStats[t]}},{key:"addTrackedStat",value:function(t){if(Dt){try{m.default.PAssert(1384,!this.__TrackedStats.hasOwnProperty(t),"Should not double define a tracked stat for a plugin")}catch(e){m.default.reportError(e)}this.__TrackedStats[t]=0}}},{key:"reportTrackedStat",value:function(t){if(Dt){try{m.default.PAssert(1385,this.__TrackedStats.hasOwnProperty(t),"Must first register a tracked stat before reporting instantces of it")}catch(e){m.default.reportError(e)}this.__TrackedStats[t]++}}},{key:"getStats",value:function(){return{fnCalls:Dt?this.__Stats:void 0,tracked:Dt?this.__TrackedStats:void 0,remoteReqs:Dt?this.__ReqStats:void 0,numItems:this._defaultItemStore?this._defaultItemStore.getCount():-1,activeAttachments:this._activeAttachments.length,numAttach:this._attachKeys.length,numSendRequests:this._numSendRequests,numHandledRequests:this._numHandledRequests,numLongWaitRequests:this._numLongWaitRequests,avgRequestSendTime:this._numSendRequests>0?this._totalRequestSendTime/this._numSendRequests:0,avgRequestHandleTime:this._numHandledRequests>0?this._totalRequestHandleTime/this._numHandledRequests:0,lowImpact:this.getLowImpactStats(),recurring:this.getRecurringStats()}}},{key:"getState",value:function(){return{isActive:this.isActiveObs.get(),isReady:this._isReady,isRateLimited:this._isRateLimited,hasDeactivated:this._hasDeactivated,numOutstandingReqs:this._numOutstandingReqs,numPendingReqs:this._pendingRequests.length,numActivePanes:this._numActivePanes,unloadedDeps:this._unloadedDependencies,isFirstLoad:this._isFirstLoad,hasRunOfflineLoad:this._hasRunOfflineLoad,loadedInitialData:this._loadedInitialData,hasLoadedCaches:this._hasLoadedCaches,cacheState:this.getCacheState()}}},{key:"isPluginPane",value:function(t){return t.type===this._paneType}},{key:"getPaneType",value:function(){return this._paneType}},{key:"activate",value:function(t){var e=this,i=this.isActiveObs.get();if(!i){if(this.isActiveObs.set(!0),this.useItemStore()){this._defaultItemStore=An.itemStoreManager.registerItemStore(this.id,this,this.itemStoreOptions());var r=this._defaultItemStore.createRoot(this.id+"Root","");setTimeout(function(){e.isActive()&&r.setText(e.useItemStore(),A.a.ChangeType.Auto)},0)}this._hasLoadedCaches||(this.supportUsageCache()&&m.default.shouldWriteLocal()&&this.loadUsageCache(),this._hasLoadedCaches=!0),this.ensurePaneTypeIsActive()}if(this._unloadedDependencies)for(var a in t)t.hasOwnProperty(a)&&this.onDependencyLoaded(a,t[a]);return this._unloadedDependencies||this.onAllDependenciesLoaded(),this._activate&&this._activate(),i||An.pluginManager.fireEvent("pluginActiveChanged",this.id,"activated",[this,!0]),!i}},{key:"deactivate",value:function(){try{m.default.PAssert(1386,this.isActiveObs.get(),"Must be active in order to deactivate pane")}catch(t){m.default.reportError(t)}return this.isActiveObs.set(!1),An.pluginManager.fireEvent("pluginActiveChanged",this.id,"deactivated",[this,!1]),this.getDataPane()&&m.default.vmMain.paneFactory.deactivatePaneType(this._paneType),this.useItemStore()&&(An.itemStoreManager.unregisterItemStore(this.id),this._defaultItemStore=void 0),this.cancelRecurringTasks(),this._loadedInitialData=!1,this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._hasDeactivated=!0,this._deactivate&&this._deactivate(),!0}},{key:"ensurePaneTypeIsActive",value:function(){(!this.hasDependency(A.a.PluginDependency.PremiumSub)||An.billingManager.hasPremiumFeatures())&&this.getDataPane()&&!ot.a.isPaneTypeActive(this._paneType)&&(this.getSetting(this.Settings.IsEnabled)||m.default.isDemoMode())&&ot.a.activatePaneType(this._paneType)}},{key:"isActive",value:function(){return this.isActiveObs.get()}},{key:"isReady",value:function(){return this._isReady}},{key:"isEnabled",value:function(){return m.default.isDemoMode()||this.isAvailable()&&this.getSetting(this.Settings.IsEnabled)}},{key:"isAvailable",value:function(){var t=!1,e=this.hasDependency(A.a.PluginDependency.EarlyAccess),i=this.hasDependency(A.a.PluginDependency.PremiumSub);try{m.default.PAssert(1387,!i||!e,"Must not require both early access and premium sub: "+this.id)}catch(n){m.default.reportError(n)}var r=An.billingManager.hasEarlyAccess(),a=An.billingManager.hasPremiumFeatures();return e&&r?t=!0:i&&a?t=!0:e||i?m.default.isDemoMode()&&(t=!0):t=!0,t}},{key:"hasSettingsError",value:function(){return!1}},{key:"isCurrentlyAuthorized",value:function(t){var e=this.googleScopes();return!e||kt.a.isAuthorizedForScopes(t,e)}},{key:"onAuthorized",value:function(t){this._pendingRequests.length>0&&An.pluginManager.notifyHasPendingRemoteRequest()}},{key:"verifyAuthorization",value:function(t){return!0}},{key:"notifyUnauthorized",value:function(t,e){}},{key:"isOnline",value:function(){return An.pluginManager.isOnline()}},{key:"goOnline",value:function(){}},{key:"goOffline",value:function(){}},{key:"onDocumentShared",value:function(t){}},{key:"onShutdown",value:function(){}},{key:"onDependencyLoaded",value:function(t,e){if(this._unloadedDependencies){var i=this._unloadedDependencies.indexOf(t);if(i>=0&&(m.default.shouldLog(A.a.LogLevels.Plugin)&&m.default.log("Plugin Dependency Loaded: ",this.id,t),this._unloadedDependencies.removeAt(i),t===A.a.PluginDependency.PremiumSub&&this.ensurePaneTypeIsActive()),0===this._unloadedDependencies.length)this._unloadedDependencies=void 0,this.onAllDependenciesLoaded();else if(this.supportOfflineLoad()&&!this._hasRunOfflineLoad){for(var r=0,a=!1,n=0;n<this._unloadedDependencies.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=this._unloadedDependencies[n];zt[o].online||(a=!0)}!a&&this.isActiveObs.get()&&this.offlineLoad()}}}},{key:"onAllDependenciesLoaded",value:function(){var t=this;this.isActiveObs.get()&&setTimeout(function(){m.default.shouldLog(A.a.LogLevels.Plugin)&&m.default.log("Plugin All Dependencies Loaded: ",t.id),t._isReady=!0,t._updateAttachmentStates(),t.offlineLoad(),t.load()},0)}},{key:"areDependenciesLoaded",value:function(){return void 0===this._unloadedDependencies}},{key:"hasDependencyBeenLoaded",value:function(t){var e=!1;return this.hasDependency(t)&&(this.getUnloadedDependencies()?this.getUnloadedDependencies().indexOf(t)<0&&(e=!0):e=!0),e}},{key:"getUnloadedDependencies",value:function(){return this._unloadedDependencies}},{key:"areRemoteAPIsLoaded",value:function(){return!0}},{key:"forceLoad",value:function(){this._loadedInitialData=!1,this.activate({}),this._unloadedDependencies&&(this._unloadedDependencies=void 0,this.onAllDependenciesLoaded())}},{key:"hasDependency",value:function(t){var e=this.getDependencies();return!!e&&e.indexOf(t)>=0}},{key:"migrateOldOfflineCache",value:function(){if(this.supportUsageCache()&&m.default.shouldWriteLocal()){var t="ocache_"+this.id,e=nt.a.getLegacyLocalStorage(t);if(e)try{var i=JSON.parse(e);if(i){var r=0;try{m.default.PAssert(1388,i,"Must provide a valid dataset to load")}catch(h){m.default.reportError(h)}i.props;var a=i.data;try{m.default.PAssert(1389,a,"Load object must contain valid data")}catch(h){m.default.reportError(h)}for(var n=Object.keys(a),o=0;o<n.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=n[o],s=this.createEntryFromLocal(u,a[u]);s.id=u,nt.a.savePluginUsage(this.id,s)}nt.a.deleteLegacyLocalStorage(t)}}catch(d){m.default.reportError(d)}else m.default.shouldLog(A.a.LogLevels.Plugin)&&m.default.log("No offline cache present: ",this.id)}}},{key:"loadUsageCache",value:function(){var t=this;try{m.default.PAssert(1390,m.default.isEmpty(this._dataCache),"Must have no data already loaded")}catch(i){m.default.reportError(i)}if(this.supportUsageCache()&&m.default.shouldWriteLocal()){this.migrateOldOfflineCache();var e=nt.a.getPluginTableUsage(this.id);e&&Object.keys(e).forEach(function(i){return t._dataCache[i]=t.createEntryFromLocal(i,e[i])})}}},{key:"supportOfflineLoad",value:function(){return!1}},{key:"supportUsageCache",value:function(){return!1}},{key:"createEntryFromLocal",value:function(t,e){try{m.default.PAssert(1391,!1,"SubClass must override")}catch(i){m.default.reportError(i)}}},{key:"clearData",value:function(){for(var t=0,e=0;e<this._attachKeys.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._attachCache[this._attachKeys[e]].unload()}this._attachKeys=[],this._attachCache={},this._dataCache={},this.useItemStore()&&(this.getDefaultItemStore().clearStore(),this._activeItemStore={}),this._searchBuckets={},this._activeSearchBucket={},this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._activeAttachments=[]}},{key:"onCacheLimitExceeded",value:function(){for(var t in this._registeredCaches)if(this._registeredCaches.hasOwnProperty(t)){var e=this._registeredCaches[t];e.usesDiskSpace()&&e.clearCache()}}},{key:"changeID",value:function(t,e,i){try{m.default.PAssert(1392,e!==i,"Should never be switching to the same ID")}catch(o){m.default.reportError(o)}if(this._attachCache[i])t.delayChangeID(),this._attachCache[e]=void 0,this._attachKeys.remove(e),this._dataCache[e]=void 0;else{var r=this._attachCache[e];try{m.default.PAssert(1393,t===r,"Attach entries must match")}catch(o){m.default.reportError(o)}r&&(this._attachCache[e]=void 0,this._attachCache[i]=r,this._attachKeys.remove(e),this._attachKeys.push(i));var a=this._dataCache[e];this._dataCache[e]=void 0,a&&(a.id===e&&(a.id=i),this._dataCache[i]=a);var n=t.isLocalOnlyAttachment();t.isInUse()&&n&&(this.deleteAttachmentFromUsageCache(t),t.changeID(i)),t.isInUse()&&n&&this.saveAttachmentToUsageCache(t)}}},{key:"_isFullData",value:function(t){for(var e=0,i=this.getPropertySet(A.a.PluginLoad.Full),r=0;r<i.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(!this.getPropertyDescriptor(i[r]).isOpt&&!t.hasOwnProperty(i[r]))return!1}return!0}},{key:"cacheData",value:function(t,e,i,r,a){try{m.default.PAssert(1394,t,"Must supply a valid key for data")}catch(u){m.default.reportError(u)}Dt&&this.__Stats.cacheWrites++;this._dataCache[t];if(this._dataCache[t]=e,this._attachCache[t]){var n=this._attachCache[t],o=this._getPluginLoadType(e);try{m.default.PAssert(1396,o,"Must contain valid full data")}catch(u){m.default.reportError(u)}n.notifyDataLoaded(o,i,r,a),n.isInUse()&&this.saveAttachmentToUsageCache(n)}}},{key:"getCacheData",value:function(t){return this._dataCache[t]}},{key:"_attachMetadataFields",value:function(){}},{key:"fieldsHaveParseEffect",value:function(t){var e=!1;if(t){var i=this._attachMetadataFields();if(i)for(var r=0,a=0;a<t.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(i.indexOf(t[a])<0){e=!0;break}}else e=!0}else e=!0;return e}},{key:"isFieldDefined",value:function(t){return!!this.getPropertyDescriptor(t)}},{key:"hasAttachField",value:function(t,e){var i=!1,r=this._dataCache[t.id];if(r&&r.hasOwnProperty(e))i=!0;else{var a=this.getPropertyDescriptor(e);try{m.default.PAssert(1398,a,"Must have a valid field descriptor",e)}catch(o){m.default.reportError(o)}if(a&&a.isOpt)i=!0;else{var n=t.getInlineData();n&&n.hasOwnProperty(e)&&(i=!0)}}return i}},{key:"getAttachField",value:function(t,e){var i,r=this._dataCache[t.id];if(r&&r.hasOwnProperty(e))i=r[e];else{var a=this.getPropertyDescriptor(e);try{m.default.PAssert(1399,a,"Must have a valid field descriptor",e)}catch(o){m.default.reportError(o)}var n=t.getInlineData();i=n&&n.hasOwnProperty(e)?n[e]:a?a.defaultValue:void 0}return i}},{key:"updateAttachField",value:function(t,e,i,r){var a=!1;try{m.default.PAssert(1401,this.isFieldDefined(e),"Must be updating a valid attachment field")}catch(u){m.default.reportError(u)}var n=this._dataCache[t.id];try{m.default.PAssert(1402,n,"Invalid field request: ",this.id,e)}catch(u){m.default.reportError(u)}n&&(this.dataFieldNeedsWrite(n,e,i)&&(n[e]=i,this.cacheData(t.id,n,!0,[e])),a=!0);var o=t.getInlineData();if(o&&o.hasOwnProperty(e)&&!r)try{m.default.PAssert(1405,o[e]===i,"Should never change inline field value")}catch(u){m.default.reportError(u)}return a}},{key:"isAttachFieldDefault",value:function(t,e){var i=!1,r=this._dataCache[t.id];try{m.default.PAssert(1406,r,"Invalid field request: ",this.id,e)}catch(n){m.default.reportError(n)}if(r){var a=this.getPropertyDescriptor(e);try{m.default.PAssert(1407,a,"Must have a valid field descriptor",e)}catch(n){m.default.reportError(n)}r.hasOwnProperty(e)?a&&a.isOpt&&a.defaultValue===r[e]&&(i=!0):a&&a.isOpt&&(i=!0)}return i}},{key:"fieldNeedsWrite",value:function(t,e,i){var r=this._dataCache[t.id];try{m.default.PAssert(1408,r,"Invalid field request: ",this.id,e)}catch(a){m.default.reportError(a)}return this.dataFieldNeedsWrite(r,e,i)}},{key:"dataFieldNeedsWrite",value:function(t,e,i){var r=!1;if(t){var a=this.getPropertyDescriptor(e);try{m.default.PAssert(1409,a,"Must have a valid field descriptor",e)}catch(o){m.default.reportError(o)}var n=this.compactCacheField(t,e);t.hasOwnProperty(e)?void 0===i&&n===a.defaultValue||(a&&a.comparator?a.comparator(n,i)||(r=!0):n!==i?r=!0:(m.default.isObject(n)||m.default.isObject(i)||m.default.isArray(n)||m.default.isArray(i))&&(r=!0)):void 0!==i&&(a&&a.isOpt&&a.defaultValue===i||(r=!0))}return r}},{key:"hasCacheData",value:function(t){return!!this._dataCache[t]}},{key:"findCachedItemsByField",value:function(t,e,i){var r=this;Dt&&this.__Stats.findByField++;var a=[];return Object.keys(this._dataCache).some(function(n){var o=r._dataCache[n];if(o[t]===e&&(a.push(o),a.length>=i))return!0}),a}},{key:"findCachedItemsByFn",value:function(t,e){var i=this;try{m.default.PAssert(1410,t,"Must supply a valid match function")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1411,m.default.isFunction(t),"Match function must be a valid function")}catch(a){m.default.reportError(a)}Dt&&this.__Stats.findByFn++;var r=[];return Object.keys(this._dataCache).some(function(a){var n=i._dataCache[a];if(t(n)&&(r.push(n),r.length>=e))return!0}),r}},{key:"notifyAttachmentInUse",value:function(t,e){try{m.default.PAssert(1412,this._activeAttachments.indexOf(t)<0,"Attachment should not already be active")}catch(i){m.default.reportError(i)}this._activeAttachments.push(t),m.default.isLocalChange(e)&&this.supportUsageCache()&&t.isLoaded()&&!t.isLocalOnlyAttachment()&&this.saveAttachmentToUsageCache(t,!0)}},{key:"notifyAttachmentUpdated",value:function(t){this.supportUsageCache()&&t.isLoaded()&&!t.isLocalOnlyAttachment()&&this.saveAttachmentToUsageCache(t)}},{key:"notifyAttachmentUnused",value:function(t,e){try{m.default.PAssert(1413,this._activeAttachments.indexOf(t)>=0,"Attachment should be marked active")}catch(i){m.default.reportError(i)}this._activeAttachments.remove(t),m.default.isLocalChange(e)&&this.supportUsageCache()&&t.isLoaded()&&!t.isLocalOnlyAttachment()&&this.deleteAttachmentFromUsageCache(t)}},{key:"onAuthorizedSetting",value:function(t,e){}},{key:"notifyItemNoteChanged",value:function(t,e){}},{key:"notifyItemDateChanged",value:function(t,e){}},{key:"notifyItemTextChanged",value:function(t,e,i){}},{key:"notifyItemPropertyChanged",value:function(t,e,i,r){}},{key:"getAttachment",value:function(t,e){try{m.default.PAssert(1414,t,"Must provide a valid key")}catch(i){m.default.reportError(i)}return t&&(this._attachCache[t]?e&&!this._attachCache[t].hasInlineData()&&this._attachCache[t].setInlineData(e):(this._attachCache[t]=this._requestAttachment(t,e),this._attachKeys.push(t))),this._attachCache[t]}},{key:"hasAttachment",value:function(t){return!!this._attachCache[t]}},{key:"forEachActiveAttachment",value:function(t){for(var e=0,i=0;i<this._activeAttachments.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t(this._activeAttachments[i])}}},{key:"forEachAttachment",value:function(t){for(var e=0,i=0;i<this._attachKeys.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t(this._attachCache[this._attachKeys[i]])}}},{key:"numActiveAttachments",value:function(){return this._activeAttachments.length}},{key:"getAttachmentEmbedString",value:function(t){for(var e=0,i=A.a.EmbedAttachChar+"p:"+this.id+",id:"+t.id,r=this.getPropertySet(A.a.PluginLoad.Inline),a=0;a<r.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=r[a],o=this.getPropertyDescriptor(n),u=encodeURIComponent(t.getField(n));try{m.default.PAssert(1415,o.isOpt||u&&u.indexOf(":")<0&&u.indexOf(" ")<0,"Property value is invalid: "+n+", "+u)}catch(s){m.default.reportError(s)}void 0!==u&&"undefined"!==u&&(i+=","+n+":"+u)}return i+=A.a.EmbedAttachChar}},{key:"getAttachmentTitleString",value:function(t){return this.getUnstyledText(t)}},{key:"_getTextForItem",value:function(t){try{m.default.PAssert(1416,t,"Must pass in a valid item to get text for")}catch(e){m.default.reportError(e)}return A.a.EmbedAttachChar+"p:"+this.id+",id:"+t.id+A.a.EmbedAttachChar}},{key:"_requestAttachment",value:function(t,e){try{m.default.PAssert(1417,t,"Must provide a valid key")}catch(i){m.default.reportError(i)}return Dt&&this.__Stats.createdAttachments++,new St(this,t,e)}},{key:"releaseAttachment",value:function(t){}},{key:"saveAttachmentToUsageCache",value:function(t,e){this.supportUsageCache()&&m.default.shouldWriteLocal()&&(e&&nt.a.getPluginUsage(this.id,t.id)||nt.a.savePluginUsage(this.id,this.serializeEntry(t.id)))}},{key:"deleteAttachmentFromUsageCache",value:function(t){this.supportUsageCache()&&m.default.shouldWriteLocal()&&nt.a.deletePluginUsage(this.id,t.id)}},{key:"dataHasChanged",value:function(t,e){for(var i=0,r=!t,a=this.getPropertySet(A.a.PluginLoad.Full),n=0;!r&&n<a.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=a[n];this.dataFieldNeedsWrite(t,o,e[o])&&(r=!0)}return r}},{key:"getChangedFields",value:function(t,e){for(var i=0,r=[],a=this.getPropertySet(A.a.PluginLoad.Full),n=0;n<a.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=a[n];this.dataFieldNeedsWrite(t,o,e[o])&&r.push(o)}return r}},{key:"matchAttachment",value:function(t,e){try{m.default.PAssert(1418,!1,"SubClass must override")}catch(i){m.default.reportError(i)}}},{key:"getStyledText",value:function(t,e,i,r){try{m.default.PAssert(1419,!1,"SubClass must override")}catch(a){m.default.reportError(a)}}},{key:"getUnstyledText",value:function(t){try{m.default.PAssert(1420,!1,"SubClass must override")}catch(e){m.default.reportError(e)}return""}},{key:"getBlockedText",value:function(t){return"Blocked"}},{key:"getAttachMeasure",value:function(t,e,i){}},{key:"useRenderer",value:function(t,e){var i,r=An.pluginManager.useRenderer(t,e);switch(t){case A.a.PluginRenderTypes.StyledText:i="getStyledText";break;case A.a.PluginRenderTypes.UnstyledText:i="getUnstyledText";break;case A.a.PluginRenderTypes.Measure:i="getAttachMeasure";break;default:try{m.default.PAssert(1421,!1,"Unknown plugin renderer type")}catch(a){m.default.reportError(a)}}i&&(this[i]=r)}},{key:"_getDisplayText",value:function(t,e,i,r){return this.isPluginBlocked()?this.getBlockedText(t):this.getStyledText(t,e,i,r)}},{key:"createDisplayElement",value:function(t){var e=this.getAttachmentClass(t);try{m.default.PAssert(1422,m.default.isArray(e),"Must have a valid class list")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1423,e.indexOf("plugin")<0,"Should not already have plugin as a class")}catch(n){m.default.reportError(n)}e.push("plugin"),this.isPluginBlocked()&&e.push("blocked");var i=this._getDisplayText(t),r={attrs:{cls:e,plugin:this.id,"plugin-id":t.id},text:i},a=this.getAttachmentTooltip(t);return a&&(r.attrs["data-tooltip"]=a),r}},{key:"measureAttachment",value:function(t,e){try{m.default.PAssert(1424,e&&e.attrs&&e.attrs["plugin-id"],"Must have a valid word style obj with attachment ID")}catch(o){m.default.reportError(o)}var i;if(e.attrs&&!e.attrs.isUnknown){var r=this.getAttachment(e.attrs["plugin-id"]);try{m.default.PAssert(1425,r,"Must have valid attachment to measure: ",e.attrs["plugin-id"])}catch(o){m.default.reportError(o)}if(this.isPluginBlocked())i=An.Measure.measureWord(t,this.getBlockedText(r),e);else if(void 0===(i=this.getAttachMeasure(r,t,e))){var a=this.getWordStyles();i=An.Measure.measureWord(t,this.getUnstyledText(r),Object.assign({},e,a)),a.padding&&(i+=a.padding)}}else i=An.Measure.measureWord(t,"Unknown Plugin",e);if(e.attrs&&e.attrs.cls){var n=e.attrs.cls;i+=this.pluginMargin,n.indexOf("padB")>=0&&(i+=this.pluginMargin)}return i+=this.pluginPadding}},{key:"getAttachmentClass",value:function(t){return[]}},{key:"getAttachmentTooltip",value:function(t){}},{key:"isPluginBlocked",value:function(){var t=!1;return An.billingManager.hasPremiumFeatures()||!this.hasDependency(A.a.PluginDependency.PremiumSub)&&!this.hasDependency(A.a.PluginDependency.EarlyAccess)||(t=!0),t}},{key:"_displayMissingProperties",value:function(t,e,i){var r=0,a=!1,n=this.getPropertySet(i);m.default.log("Displaying Missing Properties: ",t);for(var o=0;o<n.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this.getPropertyDescriptor(n[o]).isOpt||e.hasOwnProperty(n[o])||(m.default.log(" Missing Property: ",n[o]),a=!0)}try{m.default.PAssert(1426,a,"Must be missing props to run this")}catch(u){m.default.reportError(u)}}},{key:"_getPluginLoadType",value:function(t){try{m.default.PAssert(1427,t,"Must be querying loaded data for load state with valid data")}catch(i){m.default.reportError(i)}var e=A.a.PluginLoad.None;return this._isFullData(t)&&(e|=A.a.PluginLoad.Full),e}},{key:"requestData",value:function(t,e){var i=this;Dt&&this.__Stats.requestData++,e=e||A.a.PluginLoad.Full;var r,a=this.getCacheData(t.id);a?(r=this._getPluginLoadType(a),m.default.isFlagSet(r,e)?t.notifyDataLoaded(r,!1,void 0,A.a.ChangeType.Remote):(m.default.forEachFlagSet(e,function(e){i._displayMissingProperties(t.id,a,e)}),!t.isLocalOnlyAttachment()&&this.allowRemoteRequests()&&this._getRemoteAttachmentData(t,e))):t.isLocalOnlyAttachment()||(r=A.a.PluginLoad.None,this.allowRemoteRequests()&&!m.default.isFlagSet(r,e)&&this._getRemoteAttachmentData(t,e))}},{key:"_getRemoteAttachmentData",value:function(t,e){this.getRemoteAttachmentData(t,e)}},{key:"getRemoteAttachmentData",value:function(t,e){try{m.default.PAssert(1428,!1,"SubClass must override")}catch(i){m.default.reportError(i)}}},{key:"_appendDupeRequest",value:function(t,e){try{m.default.PAssert(1429,t,"Must provide a valid queued request")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1430,e,"Must provide a valid duped request")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1431,!t.duped,"Must never use an already duped request as a dupe for another request")}catch(i){m.default.reportError(i)}e.attach&&(t.attach||(t.attach=[]),t.attach.pushOnlyUniques(e.attach)),t.successCB.pushOnlyUniques(e.successCB),t.failureCB.pushOnlyUniques(e.failureCB)}},{key:"_areRequestFnsEqual",value:function(t,e){var i=!1;return t===e?i=!0:m.default.isArray(t)&&m.default.isArray(e)&&(i=t.equals(e)),i}},{key:"_areRequestsEqual",value:function(t,e){try{m.default.PAssert(1432,t,"Must have a valid request A")}catch(n){m.default.reportError(n)}try{m.default.PAssert(1433,e,"Must have a valid request B")}catch(n){m.default.reportError(n)}var i=!0;if(t.accountID!==e.accountID)i=!1;else if(t.forceNoDupe||e.forceNoDupe)i=!1;else if(t.id!==e.id&&this._areRequestFnsEqual(t.requestFn,e.requestFn))if(t.data===e.data)i=!0;else{for(var r in t.data){if(!t.data.hasOwnProperty(r)||!e.data.hasOwnProperty(r)){i=!1;break}if(t.data[r]!==e.data[r]){i=!1;break}}if(i)for(var a in e.data){if(!t.data.hasOwnProperty(a)||!e.data.hasOwnProperty(a)){i=!1;break}if(t.data[a]!==e.data[a]){i=!1;break}}}else i=!1;return i}},{key:"_getDupeRequest",value:function(t){for(var e,i=0,r=0,a=0;!e&&a<this._outstandingRequests.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;!this._outstandingRequests[a].duped&&this._areRequestsEqual(this._outstandingRequests[a],t)&&(e=this._outstandingRequests[a])}for(var n=0;!e&&n<this._pendingRequests.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;!this._pendingRequests[n].duped&&this._areRequestsEqual(this._pendingRequests[n],t)&&(e=this._pendingRequests[n])}return e}},{key:"_combineRequest",value:function(t,e){try{m.default.PAssert(1434,t,"Must provide a valid queued request")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1435,e,"Must provide a valid combine request")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1436,!t.combined,"Must never use an already combined request as a target for another request")}catch(i){m.default.reportError(i)}t.data=m.default.mergeObjects(t.data,e.data),t.successCB.pushOnlyUniques(e.successCB),t.failureCB.pushOnlyUniques(e.failureCB)}},{key:"_areRequestsCombinable",value:function(t,e){try{m.default.PAssert(1437,t,"Must have a valid request A")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1438,e,"Must have a valid request B")}catch(r){m.default.reportError(r)}var i=!1;return t.id!==e.id&&t.combinable&&e.combinable&&t.accountID===e.accountID&&this._areRequestFnsEqual(t.requestFn,e.requestFn)&&t.type===e.type&&(t.attach||e.attach?t.attach&&e.attach&&t.attach.equals(e.attach)&&(i=!0):i=!0),i}},{key:"_getCombineRequest",value:function(t){var e;if(t.combinable)for(var i=0,r=0;!e&&r<this._pendingRequests.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;!this._pendingRequests[r].combined&&this._areRequestsCombinable(this._pendingRequests[r],t)&&(e=this._pendingRequests[r])}return e}},{key:"_handleBatchRequestResponse",value:function(t){this._numOutstandingReqs--;try{m.default.PAssert(1439,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(e){m.default.reportError(e)}}},{key:"_handleRequestResponse",value:function(t,e){if(!e){this._numOutstandingReqs--;try{m.default.PAssert(1440,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(i){m.default.reportError(i)}}}},{key:"_handleRequestTimeout",value:function(t){if(this._pendingRequests.indexOf(t)>=0){var e=0;t.timedOut=!0;for(var i={error:{code:A.a.HTTPStatusCode.Network,message:"Internal request timeout"}},r=0;r<t.failureCB.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;try{t.failureCB[r](i)}catch(a){m.default.reportError(a)}}0,this._pendingRequests.remove(t)}}},{key:"_queueRemoteRequestMulti",value:function(t,e,i,r,a,n,o,u){try{m.default.PAssert(1441,t,"Missing accountID parameter")}catch(h){m.default.reportError(h)}try{m.default.PAssert(1442,!m.default.isArray(t),"Missing accountID paramter")}catch(h){m.default.reportError(h)}try{m.default.PAssert(1443,!m.default.isFunction(t),"Missing accountID parameter")}catch(h){m.default.reportError(h)}try{m.default.PAssert(1444,!u||void 0===u.accountID,"AccountID is specified as a separate param")}catch(h){m.default.reportError(h)}var s=u?m.default.clone(u):{};return s.accountID=t,this._queueRemoteRequest(e,i,r,a,n,o,s)}},{key:"_computeTimeoutMS",value:function(t){var e;return t&&void 0!==t.timeoutMS&&(0===t.timeoutMS?e=this.DefaultRequestTimeout:t.timeoutMS>=1e3&&(e=t.timeoutMS)),e}},{key:"_updateRequestTimeout",value:function(t){t.timeoutMS&&(this._clearRequestTimeout(t),t.timeout=setTimeout(this._handleRequestTimeout.bind(this,t),t.timeoutMS))}},{key:"_clearRequestTimeout",value:function(t){t.timeout&&(clearTimeout(t.timeout),t.timeout=void 0)}},{key:"_queueRemoteRequest",value:function(t,e,i,r,a,n,o){var u=this;o=o||{};try{m.default.PAssert(1445,t&&m.default.isArray(t),"RequestFn must be a valid packed function")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1446,e,"Must provide valid data for the request")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1448,i,"Must supply a callback for request success")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1449,m.default.isFunction(i),"Success callback must be a valid function")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1450,r,"Must supply a callback for request failure")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1451,m.default.isFunction(r),"Failure callback must be a valid function")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1452,n,"Request type must be specified")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1453,o.accountID||o.token,"Must have an accountID")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1454,!o.combinable,"Combinable is not currently a valid option. Do not use.")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1455,!a||!a.isLocalOnlyAttachment(),"Must either specify a valid remote attachment or none at all",a?a.id:"UNDEFINED")}catch(d){m.default.reportError(d)}o.token&&!o.accountID&&(o.accountID="from_token"),Dt&&(this.__ReqStats[n]=this.__ReqStats[n]?this.__ReqStats[n]+1:1);var s={id:++this._requestCounter,plugin:this,attach:a?[a]:void 0,request:void 0,requestFn:t,data:e,successCB:[i],failureCB:[r],type:n,queueTime:Date.now(),sendTimes:[],handleTimes:[],handled:!1,failed:!1,duped:!1,canceled:!1,timedOut:!1,wasBatched:!1,batchID:void 0,batchRequestID:void 0,requestsBehind:this._pendingRequests.length,token:o.token,accountID:o.accountID,combinable:o.combinable,autoRetry:!o||void 0===o.autoRetry||o.autoRetry,timeoutMS:this._computeTimeoutMS(o),forceNoDupe:o.forceNoDupe,priority:o.priority?o.priority:A.a.RequestPriority.Default};s.autoRetry&&(s.numRetries=o&&o.numRetries?o.numRetries:2,s.currentRetries=0),this._updateRequestTimeout(s),m.default.shouldLog(A.a.LogLevels.Plugin)&&m.default.log("Request Queued: ",this.name,n,s.id,s);var h=function(){var t=u._insertPendingRequest(s);s.priority>A.a.RequestPriority.Default&&m.default.log("Insert Index: ",t,u._pendingRequests.length,s),An.pluginManager.notifyHasPendingRemoteRequest()};s.token?h():kt.a.getAccountAuthToken(o.accountID,this.googleScopes(),function(t){t?(s.token=t,h()):console.log("Skipping request because of missing token")})}},{key:"_insertPendingRequest",value:function(t){t.priority++;var e=this._pendingRequests.insertSorted(t,this._reqSortFn);return t.priority--,e}},{key:"_reqSortFn",value:function(t,e){return t.priority===e.priority?0:t.priority<e.priority?-1:1}},{key:"_queuePagedRemoteRequestMulti",value:function(t,e,i,r,a,n,o,u){try{m.default.PAssert(1456,t,"Missing accountID parameter")}catch(h){m.default.reportError(h)}try{m.default.PAssert(1457,!m.default.isArray(t),"Missing accountID paramter")}catch(h){m.default.reportError(h)}try{m.default.PAssert(1458,!m.default.isFunction(t),"Missing accountID parameter")}catch(h){m.default.reportError(h)}try{m.default.PAssert(1459,!u||void 0===u.accountID,"AccountID is specified as a separate param")}catch(h){m.default.reportError(h)}var s=u?m.default.clone(u):{};return s.accountID=t,this._queuePagedRemoteRequest(e,i,r,a,n,o,s)}},{key:"_queuePagedRemoteRequest",value:function(t,e,i,r,a,n,o){var u=this;try{m.default.PAssert(1460,o,"Must supply a valid options param")}catch(g){m.default.reportError(g)}try{m.default.PAssert(1461,!o.getAllPages||!o.maxPages,"Should only define either maxPages or getAllPages: ",o.getAllPages,o.maxPages)}catch(g){m.default.reportError(g)}o.maxPages=o.maxPages||1,o.getAllPages=o.getAllPages||!1,o.maxPageResults=o.maxPageResults||(o.maxResults?o.maxResults:100),o.maxResults=o.maxResults||1/0,o.resultsField=o.resultsField||"items";var s,h=0,d=[],c=m.default.clone(e);c.maxResults=o.maxPageResults;var v=function(t){t[o.resultsField]?d.pushArray(t[o.resultsField]):t.items?d.pushArray(t.items):t.history&&d.pushArray(t.history),t.nextPageToken&&(o.getAllPages||o.maxPages>h)&&d.length<o.maxResults?s(t.nextPageToken):t.nextPageToken||t.nextSyncToken||t.historyId?i(d,e,t):i(d)},y=function(t){r(t,d)};(s=function(e){e&&(c.pageToken=e),h++,u._queueRemoteRequest(t,c,v,y,void 0,n,o)})()}},{key:"_retryRemoteRequest",value:function(t,e){var i=this;m.default.shouldLog(A.a.LogLevels.Plugin)&&m.default.log("Request Re-Queued: ",this.name,t.type,t.id,t),Dt&&this.__Stats.remoteRetries++,t.request=void 0,t.wasBatched=void 0,t.batchID=void 0,t.batchRequestID=void 0,setTimeout(function(){t.currentRetries=t.currentRetries?t.currentRetries+1:1,i._insertPendingRequest(t),An.pluginManager.notifyHasPendingRemoteRequest()},this._getRetryDelay(t,e))}},{key:"getNumOutstandingReqs",value:function(){return this._numOutstandingReqs}},{key:"_pumpRequestQueue",value:function(t,e,i,r){var a=0,n=0;try{m.default.PAssert(1462,this.areRemoteAPIsLoaded(),"Must have loaded remote APIs before pumping the request queue")}catch(P){m.default.reportError(P)}try{m.default.PAssert(1463,!this.hasDependency(A.a.PluginDependency.GoogleLogin)||this.hasDependencyBeenLoaded(A.a.PluginDependency.GoogleLogin),"Must be authorized to make remote requests")}catch(P){m.default.reportError(P)}var o=0,u=0,s=0,h=0,d=0,c=0,v=0;try{m.default.PAssert(1464,this._numOutstandingReqs>=0,"Should never have fewer than zero outstanding requests")}catch(P){m.default.reportError(P)}var y,g=e;try{m.default.PAssert(1465,g>0,"Should never have more than max outstanding requests for a given plugin")}catch(P){m.default.reportError(P)}g>1&&this._pendingRequests.length>1&&(y=this.createBatch());for(var l=[],p=0;g>0&&p<this._pendingRequests.length&&v<A.a.MaxBatchSize;++p){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var f=this._pendingRequests[p];if(f.priority<t)c++;else{m.default.shouldLog(A.a.LogLevels.Plugin)&&m.default.log("Request Pumped: ",this.name,f.type,f.id,f);try{m.default.PAssert(1466,!m.default.isFunction(f),"Should never use a deferred request")}catch(P){m.default.reportError(P)}try{m.default.PAssert(1467,!1===f.handled,"Should never service a request that has already been handled")}catch(P){m.default.reportError(P)}var k=this._getDupeRequest(f);if(k)Dt&&this.__Stats.dupedRequests++,f.duped=!0,l.push(f),s++,this._appendDupeRequest(k,f);else{var S=this._getCombineRequest(f);if(S)Dt&&this.__Stats.combinedRequests++,f.combined=!0,l.push(f),h++,this._combineRequest(S,f);else{var w=!1;if(f.attach)for(var L=0,F=0;F<f.attach.length;++F){if(L++>5e3&&__infLoop&&__infLoop(L))throw new RangeError;f.attach[F].needsRemoteData()&&(f.attach[F].notifyDataRequested(),w=!0)}else w=!0;if(w)if(f.token||this.isCurrentlyAuthorized(f.accountID)){var C=this._runRemoteRequest(y,f,i);if(Dt&&this.__Stats.remoteRequests++,C.isNewRequest||0===v){try{m.default.PAssert(1468,e>o,"Should not be making more requests for plugin than allowed")}catch(P){m.default.reportError(P)}o++,g--,this._numOutstandingReqs++,Dt&&this.__Stats.actualRemoteCallsSent++}C.wasBatched&&v++,l.push(f)}else kt.a.notifyUnauthorizedRequest(f.accountID),d++;else Dt&&this.__Stats.canceledRequests++,f.canceled=!0,u++,l.push(f)}}}}this._pendingRequests=this._pendingRequests.removeArray(l);for(var I=0;I<l.length;++I){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;l[I].canceled||l[I].duped||this._addRequest(this._outstandingRequests,l[I])}try{m.default.PAssert(1469,!y||v+u+s+h+d+c>1,"Batches should always have multiple items in them")}catch(P){m.default.reportError(P)}return y&&(v>0?(Dt&&this.__Stats.remoteBatches++,this.commitBatch(y,r)):Dt&&this.__Stats.canceledBatches++),o}},{key:"_clearRequestQueue",value:function(){m.default.log("Clear Request Queue: ",this.id),this._pendingRequests=[],this._outstandingRequests=[],this._numOutstandingReqs=0}},{key:"_addRequest",value:function(t,e){try{m.default.PAssert(1470,t.indexOf(e)<0,"Should never re-add a request to a queue without removing it first")}catch(i){m.default.reportError(i)}return t.push(e)}},{key:"_removeRequest",value:function(t,e){return t.remove(e)}},{key:"isRateLimited",value:function(){return this._isRateLimited}},{key:"_notifyRateLimitedOver",value:function(){this._isRateLimited=!1}},{key:"_notifyRateLimited",value:function(t){this._isRateLimited=!0,this._lastRateLimitTime=new Date}},{key:"isRateLimitError",value:function(t){var e=!1;return t&&Mt.indexOf(t.status)>=0&&(t.status===A.a.HTTPStatusCode.Forbidden?m.default.hasGoogleError(t,A.a.GoogleErrorDomain.UsageLimits,A.a.GoogleError.UserRateLimitExceeded)?e=!0:m.default.hasGoogleError(t,A.a.GoogleErrorDomain.UsageLimits,A.a.GoogleError.RateLimitExceeded)?e=!0:m.default.hasGoogleError(t,A.a.GoogleErrorDomain.UsageLimits,A.a.GoogleError.QuotaExceeded)&&(e=!0):e=!0),e}},{key:"_getRetryDelay",value:function(t,e){var i=t.currentRetries;return e&&(i=Math.max(2,t.currentRetries)),m.default.seconds(Nt[i])}},{key:"_notifyRequestSuccess",value:function(t,e){var i={cbList:t.successCB,result:e};t.wasBatched?(this._batchedResponses[t.batchID]||(this._batchedResponses[t.batchID]=[]),this._batchedResponses[t.batchID].push(i)):this._handleResponse(i)}},{key:"_notifyRequestFailure",value:function(t,e){var i={cbList:t.failureCB,result:e};t.wasBatched?(this._batchedResponses[t.batchID]||(this._batchedResponses[t.batchID]=[]),this._batchedResponses[t.batchID].push(i)):this._handleResponse(i)}},{key:"_handleResponse",value:function(t){for(var e=0,i=0;i<t.cbList.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;try{t.cbList[i](t.result)}catch(r){m.default.reportError(r)}}}},{key:"_notifyBatchCompleted",value:function(t){var e=this._batchedResponses[t.getBatchID()];if(delete this._batchedResponses[t.getBatchID()],e){var i=0;An.PaneUpdateBatcher.beginUpdateItems();for(var r=0;r<e.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._handleResponse(e[r])}An.PaneUpdateBatcher.commitUpdateItems()}}},{key:"computeBatchGroupID",value:function(t){return t.accountID}},{key:"computeRequestID",value:function(t){return t.id+"-"+Date.now()}},{key:"_setSendTime",value:function(t){var e=Date.now();if(0===t.sendTimes.length){var i=e-t.queueTime;this._numSendRequests++,this._totalRequestSendTime+=i,i>this.LongWaitThreshold&&this._numLongWaitRequests++}t.sendTimes.push(e)}},{key:"_setHandleTime",value:function(t){var e=Date.now();if(0===t.handleTimes.length){var i=e-t.queueTime;this._numHandledRequests++,this._totalRequestHandleTime+=i}t.handleTimes.push(e)}},{key:"_runRemoteRequest",value:function(t,e,i){var r=this,a={wasBatched:!1,isNewRequest:!1};if(Pt.a.canConstruct(e.requestFn))e.request=Pt.a.createRequest(e.accountID,e.requestFn,e.data,e.token);else{var n=m.default.unpackFn(e.requestFn);try{m.default.PAssert(1471,m.default.isFunction(n),"Must specify a valid packed function: ",e.requestFn)}catch(s){m.default.reportError(s)}n&&(e.request=n(e.data))}if(e.request){try{m.default.PAssert(1472,e.request.then,"Remote request must be thenable")}catch(s){m.default.reportError(s)}if(t){var o=this.computeBatchGroupID(e),u=this.computeRequestID(e);a.isNewRequest=t.add(e.request,o,u);try{m.default.PAssert(1473,m.default.isBoolean(a.isNewRequest),"Add must return whether it will create a new remote request for this request")}catch(s){m.default.reportError(s)}a.wasBatched=!0,e.wasBatched=!0,e.batchID=t.getBatchID(),e.batchRequestID=u}else e.wasBatched=!1,e.batchID=void 0,e.batchRequestID=void 0;m.default.shouldLog(A.a.LogLevels.Plugin)&&m.default.log("Request Run: ",this.name,e.type,e.id,e);try{m.default.PAssert(1474,e.token||this.isCurrentlyAuthorized(e.accountID),"Must be currently authorized to make this request")}catch(s){m.default.reportError(s)}this._clearRequestTimeout(e),this._setSendTime(e),e.request.then(function(t){try{m.default.PAssert(1475,!1===e.handled,"Must not handle the same request multiple times")}catch(s){m.default.reportError(s)}m.default.shouldLog(A.a.LogLevels.Plugin)&&m.default.log("Request Success: ",r.name,e.type,e.id,e,t),r._setHandleTime(e),e.handled=!0,r._notifyRateLimitedOver(),r._notifyRequestSuccess(e,t.result),i(e.attach,e.plugin,e.wasBatched),r._removeRequest(r._outstandingRequests,e)},function(t){try{m.default.PAssert(1476,!1===e.handled,"Must not handle the same request multiple times")}catch(s){m.default.reportError(s)}m.default.shouldLog(A.a.LogLevels.Plugin)&&m.default.log("Request Failed: ",r.name,e.type,e.id,e,t),r._setHandleTime(e);var a=r.isRateLimitError(t);if(a&&r._notifyRateLimited(t),(a||Ht.indexOf(t.status)>=0)&&e.autoRetry&&e.currentRetries<e.numRetries)i(e.attach,e.plugin,e.wasBatched),r._removeRequest(r._outstandingRequests,e),r._retryRemoteRequest(e,a);else{if(e.handled=!0,e.failed=!0,e.attach)for(var n=0,o=0;o<e.attach.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e.attach[o].notifyDataRequestFailed()}r._notifyRequestFailure(e,t.result),i(e.attach,e.plugin,e.wasBatched),r._removeRequest(r._outstandingRequests,e)}},this)}return a}},{key:"createPaginationToken",value:function(t,e,i,r,a,n){return new It(t,e,i,r,a,n)}},{key:"updatePaginationToken",value:function(t,e){try{m.default.PAssert(1477,t,"Must specify a valid token to update")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1478,e,"Must update the pagination token with a valid next page token")}catch(i){m.default.reportError(i)}return t.updateToken(e),t}},{key:"createBatch",value:function(t){return Pt.a.createBatch(t)}},{key:"commitBatch",value:function(t,e){var i=this;try{m.default.PAssert(1479,t,"Batch to commit must be specified")}catch(r){m.default.reportError(r)}t.then(function(r){i._notifyBatchCompleted(t),e(i,!0)},function(){i._notifyBatchCompleted(t),e(i,!1)})}},{key:"addModifiedOffline",value:function(t,e){try{m.default.PAssert(1480,t,"Must have a valid cache entry to update")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1481,m.default.isBoolean(e)||m.default.isArray(e),"Incoming fields must be valid")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1482,!1!==e,"Use removeModifiedOffline to clear data instead")}catch(r){m.default.reportError(r)}if(t){var i=t.modifiedOffline||!1;try{m.default.PAssert(1483,m.default.isBoolean(i)||m.default.isArray(i),"Previous fields must be valid")}catch(r){m.default.reportError(r)}!1===i?t.modifiedOffline=e:!0===i||(!0===e?t.modifiedOffline=!0:t.modifiedOffline.pushOnlyUniques(e))}}},{key:"removeModifiedOffline",value:function(t,e){try{m.default.PAssert(1484,t,"Must have a valid cache entry to update")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1485,m.default.isBoolean(e)||m.default.isArray(e),"Incoming fields must be valid")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1486,!0!==e,"Use addModifiedOffline to add data instead")}catch(r){m.default.reportError(r)}if(t){var i=t.modifiedOffline||!1;try{m.default.PAssert(1487,m.default.isBoolean(i)||m.default.isArray(i),"Previous fields must be valid")}catch(r){m.default.reportError(r)}!1===i||(!0===i?!1===e&&(t.modifiedOffline=!1):!1===e?t.modifiedOffline=!1:(t.modifiedOffline=t.modifiedOffline.removeArray(e),0===t.modifiedOffline.length&&(t.modifiedOffline=!1)))}}},{key:"compactCacheField",value:function(t,e){return t[e]}},{key:"_serializeObj",value:function(t,e){var i=0;try{m.default.PAssert(1488,t,"Must specify a valid entry to serialize")}catch(h){m.default.reportError(h)}try{m.default.PAssert(1489,e,"Must provide a valid property list")}catch(h){m.default.reportError(h)}for(var r={},a=0;a<e.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=e[a],o=this.getPropertyDescriptor(n);if(!o.isOpt||o.defaultValue!==t[n]){var u=this.compactCacheField(t,n);void 0!==u&&(r[n]=u)}}var s=this.getBlobData(t);return s&&(r._blob=s),r}},{key:"serializeEntry",value:function(t){var e=this.getPropertySet(A.a.PluginLoad.Full),i=this.getCacheData(t);if(i){var r=this._serializeObj(i,e);return r.id=t,r.plugin=this.id,r}}},{key:"serializeExternalData",value:function(t){try{m.default.PAssert(1490,t,"Must supply valid data to serialize")}catch(r){m.default.reportError(r)}var e=this.getPropertySet(A.a.PluginLoad.Full),i=this._serializeObj(t,e);return i.id=t.id,t.parents&&(i.parents=t.parents),i}},{key:"declareProperty",value:function(t,e,i,r,a){var n=this;try{m.default.PAssert(1491,!this._propertyDescriptors[t],"Should not declare the same property twice")}catch(o){m.default.reportError(o)}e=e||A.a.PluginLoad.Full,i=i||!1,m.default.forEachFlagSet(e,function(e){n._propertySets[e]||(n._propertySets[e]=[]),n._propertySets[e].push(t)}),this._propertyDescriptors[t]={isOpt:i,defaultValue:r,comparator:a}}},{key:"getPropertySet",value:function(t){return this._propertySets[t]||[]}},{key:"getPropertyDescriptor",value:function(t){return this._propertyDescriptors[t]}},{key:"getBlobData",value:function(t){}},{key:"_updateAttachmentStates",value:function(){try{var t=0;An.PaneUpdateBatcher.beginUpdateItems();for(var e=0;e<this._attachKeys.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._attachCache[this._attachKeys[e]];i.isInUse()&&i.onUpdate(!1,void 0,A.a.ChangeType.Auto)}An.PaneUpdateBatcher.commitUpdateItems()}catch(r){m.default.reportError(r)}}},{key:"offlineLoad",value:function(){if(!this._hasRunOfflineLoad&&this.supportOfflineLoad())try{this._offlineLoad&&(this._hasRunOfflineLoad=this._offlineLoad())}catch(t){m.default.reportError(t)}}},{key:"load",value:function(){if(this._isFirstLoad){this._isFirstLoad=!1;try{this._load&&this._load()}catch(t){m.default.reportError(t)}}this._loadedInitialData||!m.default.isDemoMode()&&!this.hasActiveDataPanes()||this.isPluginBlocked()||this.loadInitialData()}},{key:"loadInitialData",value:function(){try{m.default.PAssert(1493,!this._loadedInitialData,"Do not make multiple requests for initial data load")}catch(t){m.default.reportError(t)}try{m.default.PAssert(1494,!this.isPluginBlocked(),"Should not load data for blocked plugins")}catch(t){m.default.reportError(t)}this._loadedInitialData=!0}},{key:"getDataPane",value:function(){}},{key:"getPaneIcon",value:function(){return"icon-question"}},{key:"getPanePriority",value:function(){return 0}},{key:"getDefaultDisplayItem",value:function(t){}},{key:"useItemStore",value:function(){}},{key:"itemStoreOptions",value:function(){}},{key:"getDefaultItemStore",value:function(){try{m.default.PAssert(1495,this.useItemStore(),"Must request an item store")}catch(t){m.default.reportError(t)}return this._defaultItemStore}},{key:"getActiveItemStore",value:function(t){try{m.default.PAssert(1496,t,"Must specify a valid paneID to get the item store for")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1497,this.useItemStore(),"Must request item store usage")}catch(i){m.default.reportError(i)}var e=this._activeItemStore[t];return e||this._defaultItemStore}},{key:"getBucketItemStore",value:function(t){return this._searchBuckets[t]}},{key:"allowRemoteRequests",value:function(){return!1}},{key:"handleDropEvent",value:function(t,e){return!1}},{key:"handleTapClick",value:function(t,e,i,r){return!1}},{key:"handleDoubleTap",value:function(t,e,i,r){return!1}},{key:"notifyPaneCreated",value:function(){this._numActivePanes++,!this.isActive()||this._loadedInitialData||this.isPluginBlocked()||this.areDependenciesLoaded()&&this.loadInitialData()}},{key:"notifyPaneDestroyed",value:function(){this._numActivePanes--;try{m.default.PAssert(1500,this._numActivePanes>=0,"Should never have negative active panes")}catch(t){m.default.reportError(t)}}},{key:"notifyPanesReadyForLoad",value:function(){An.PaneManager.runForEachPane(function(t){t.notifyPluginLoaded()},this.getPaneType())}},{key:"hasActiveDataPanes",value:function(){return this._numActivePanes>0}},{key:"allowTextEditing",value:function(t,e){return!0}},{key:"_createSearchBucket",value:function(t,e){var i;i=m.default.generateTempId();var r=An.itemStoreManager.registerItemStore(i,this,{trackGlobally:!1});return r.createRoot(e||m.default.generateTempId(),"Search Results"),this._searchBuckets[i]=r,i}},{key:"_destroySearchBucket",value:function(t){this._searchBuckets[t].clearStore()}},{key:"swapInSearchBucket",value:function(t,e){try{m.default.PAssert(1501,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(n){m.default.reportError(n)}if(m.default.shouldLog(A.a.LogLevels.Plugin)&&m.default.log("Swap IN search bucket: ",t),An.PaneManager.isPaneActive(e)){var i=An.PaneManager.getPaneById(e),r=this._searchBuckets[t];if(!this._activeSearchBucket[e]||this._activeSearchBucket[e].id!==t){var a=r.getRoot();this._activeSearchBucket[e]||(this._defaultZoomItems[e]=i.getItem()),this._activeItemStore[e]=r,this._activeSearchBucket[e]=r,i.setRootItem(a,!0),i.useItemStore(r)}}}},{key:"swapOutSearchBucket",value:function(t,e){try{m.default.PAssert(1502,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(o){m.default.reportError(o)}var i=this._activeSearchBucket[t].id;m.default.shouldLog(A.a.LogLevels.Plugin)&&m.default.log("Swap OUT search bucket: ",i);var r=An.PaneManager.getPaneById(t),a=this._searchBuckets[i];try{m.default.PAssert(1503,a,"Must have a valid bucket we are swapping from")}catch(o){m.default.reportError(o)}var n=r.getRootItem();try{m.default.PAssert(1504,n===a.getRoot(),"Current root for pane should match bucket root")}catch(o){m.default.reportError(o)}e=e||this._defaultZoomItems[t];try{m.default.PAssert(1505,e,"Must always be able to get a valid default zoom item")}catch(o){m.default.reportError(o)}this._activeItemStore[t]=void 0,this._activeSearchBucket[t]=void 0,this._defaultZoomItems[t]=void 0,r.setItem(e,!0),r.stopUsingItemStore(a),this._destroySearchBucket(i)}},{key:"runSearch",value:function(t,e,i,r,a){try{m.default.PAssert(1506,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(o){m.default.reportError(o)}var n;return r&&(n=this._createSearchBucket(t,i)),this.runRemoteSearch(t,e,n,a)}},{key:"getSearchRoot",value:function(t){var e=this._searchBuckets[t];try{m.default.PAssert(1507,e,"Should always reference a valid search bucket")}catch(i){m.default.reportError(i)}return e.getRoot()}},{key:"isRemoteSearchBucketActive",value:function(t){return!!this._activeSearchBucket[t]}},{key:"clearSearch",value:function(t,e){this._activeSearchBucket[t]&&this.swapOutSearchBucket(t,e)}},{key:"refreshCurrentView",value:function(t){try{m.default.PAssert(1508,!1,"SubClass must override")}catch(e){m.default.reportError(e)}}},{key:"dumpRequestQueue",value:function(t){var e=0,i=0;console.log("---- Outstanding Requests ["+this._numOutstandingReqs+"] ----");for(var r=0;r<this._outstandingRequests.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._outstandingRequests[r];console.log("  ",a.requestFn,":",a.id," - ",a.data)}console.log("---- Pending Requests ["+this._pendingRequests.length+"] ----");for(var n=0;n<this._pendingRequests.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=this._pendingRequests[n];console.log("  ",o.requestFn,":",o.id," - ",o.data)}if(t){var u=0;try{m.default.PAssert(1509,!1,"Must be in __DEV__ mode to display info on handled requests")}catch(d){m.default.reportError(d)}console.log("---- Handled Requests ["+this._handledRequests.length+"] ----");for(var s=0;s<this._handledRequests.length;++s){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var h=this._handledRequests[s];h.failed?console.log(" !",h.requestFn,":",h.id," - ",h.data):console.log("  ",h.requestFn,":",h.id," - ",h.data)}}}},{key:"dumpQueueStats",value:function(){console.log("  Rate Limited: "+this._isRateLimited),console.log("  Long Wait Requests: "+this._numLongWaitRequests),console.log("  Num Requests: ",this._numSendRequests,this._numHandledRequests),console.log("  Num Pending Requests: ",this._pendingRequests.length),console.log("  Avg. Send Time: ",this._totalRequestSendTime/this._numSendRequests),console.log("  Avg. Handle Time: ",this._totalRequestHandleTime/this._numHandledRequests)}},{key:"getCssClass",value:function(t,e){return""}},{key:"getAccounts",value:function(){return An.pluginManager.getPluginGmail().getSyncAccounts()}},{key:"getWordStyles",value:function(){return{}}},{key:"_activate",value:function(){}},{key:"_deactivate",value:function(){}},{key:"_offlineLoad",value:function(){}},{key:"_load",value:function(){}},{key:"runRemoteSearch",value:function(t,e,i,r){}},{key:"googleScopes",value:function(t){return[]}},{key:"getDependencies",value:function(){return[]}}]),t}();V.a.defineBase(Vt);var Gt=Vt,Tt=function(t){function e(){var t;return o()(this,e),(t=d()(this,v()(e).call(this,A.a.PluginID.Date,"t","Date",!0))).pluginMargin=0,t.pluginPadding=8,t.declareProperty("itemID",A.a.PluginLoad.Preview|A.a.PluginLoad.Full|A.a.PluginLoad.Inline,!1),t}return p()(e,t),s()(e,[{key:"getStyledText",value:function(t,e,i,r){return this.getUnstyledText(t,r)}},{key:"getUnstyledText",value:function(t,e){if(e=e||G.a.getItem(t.id)){var i=e.getMooDate();if(i)return i.toText(!0)}return""}},{key:"getAttachMeasure",value:function(t,e,i){}},{key:"getWordStyles",value:function(){return{fontSize:11}}},{key:"getAttachmentEmbedString",value:function(){return A.a.CharDate}},{key:"_getTextForItem",value:function(t){try{m.default.PAssert(862,t,"Must pass in a valid item to get text for")}catch(e){m.default.reportError(e)}return A.a.CharDate}},{key:"getAttachmentClass",value:function(t){return["inlineDate","c-date","c-shadow-thin"]}},{key:"requestData",value:function(t,e){t.notifyDataLoaded(A.a.PluginLoad.Full,!1,void 0,A.a.ChangeType.Remote)}},{key:"handleTapStart",value:function(t,e,i,r){return!0}},{key:"handleTapClick",value:function(t,e,i,r){return r.altKey?t.setMooDate(void 0,A.a.ChangeType.Local):An.menus.openContextMenu({componentName:"ReactContextMenuDate",element:r.target,item:t,pane:e}),!0}}]),e}(Gt);function qt(t){this._cb=t,this._pageToken=void 0,this._validToken=!1}var jt={hasPaginationToken:function(){return this._validToken},needsPaginationToken:function(){return!this.hasPaginationToken()&&!this._pageToken},setPaginationToken:function(t){this._pageToken=t,this._validToken=!0,this._cb&&this._cb(this)},beginDataPageLoad:function(){return this._pageToken.notifyBeginUse(),this._pageToken},endDataPageLoad:function(t){t?this._pageToken.notifyEndUse():this._validToken=!1},notifyPaginationUpdate:function(){m.default.log("Pagination Update")}};V.a.defineBase(qt),V.a.extend(qt.prototype,jt);var Yt=qt;function Xt(t,e,i){this._super.constructor.call(this),this._searchQuery=t,this._invalid=!1,this._hasError=!1,this._remoteRequestCB=i,this._activePageRequest=void 0,this._lastPageRequest=void 0,this._cachedResults=[],this._localPageOffset=0,this._automaticPageRequests=0,this._pageSize=e,V.a.forceBind("onEntry",this)}var Qt={invalidate:function(){this._invalid=!0},isValid:function(){return!this._invalid},hasError:function(){return this._hasError},getNextPage:function(t,e){try{m.default.PAssert(1577,m.default.isFunction(t)&&m.default.isFunction(e)||this._lastPageRequest,"Must provide valid callbacks")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1578,!this._invalid,"Should never request another page from an invalidated search")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1579,this.hasMoreResults(),"Should never request another page if there are no possible results")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1580,!this._activePageRequest,"Should only run a single request at a time")}catch(u){m.default.reportError(u)}if(t||e||!this._lastPageRequest||(t=this._lastPageRequest.entryCB,e=this._lastPageRequest.doneCB),this._activePageRequest)e(!1);else if(this._cachedResults.length>this._localPageOffset+this._pageSize){for(var i=0,r=0;r<this._pageSize;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var a=this._cachedResults[this._localPageOffset+r];try{t(a)}catch(s){m.default.reportError(s)}}this._localPageOffset+=this._pageSize,e(!0)}else if(this.hasPaginationToken()&&this._automaticPageRequests<5)this._activePageRequest={entryCB:t,doneCB:e},this._automaticPageRequests++,this._remoteRequestCB(this);else if(this._localPageOffset<this._cachedResults.length){for(var n=0,o=this._localPageOffset;o<this._cachedResults.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;a=this._cachedResults[o];try{t(a)}catch(s){m.default.reportError(s)}this._localPageOffset++}e(!0)}},onEntry:function(t){this._invalid||this._cachedResults.push(t)},onDone:function(t){this._invalid||this._activePageRequest&&(this._lastPageRequest=this._activePageRequest,this._activePageRequest=void 0,t?this.getNextPage(this._lastPageRequest.entryCB,this._lastPageRequest.doneCB):(this._invalid=!0,this._hasError=!0,this._lastPageRequest.doneCB(t)))},hasResults:function(){return this._cachedResults.length>0},hasMoreResults:function(){return this._cachedResults.length>this._localPageOffset||this.hasPaginationToken()}};V.a.inherit(Yt,Xt),V.a.extend(Xt.prototype,Qt);var Jt,Zt,Bt=Xt,$t=i(86),Ut=function(t){function e(t){var i;o()(this,e);var r={title:"Files",paneEmptyMessage:"Loading Google Drive...",paneEmptySearchMessage:"",titleContextMenuHeader:"Open folder",dropEffect:function(){return A.a.DropEffect.Copy},isWriteable:!1,isDropTarget:!1,overrideCopyBehavior:!1,canAddItem:!1,supportCollapsing:!0,supportCompleting:!1,supportCheckbox:!1,supportOffline:!1,supportPerformArchive:!1,supportDataRefresh:!0,supportPagination:!0,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportClickOverviewScroll:!1,supportClone:!1,supportDates:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,hasMoreButtons:!0,searchFilters:[],supportsDocuments:!1};return t.plugin=An.pluginManager.getPlugin(A.a.PluginID.Drive),(i=d()(this,v()(e).call(this,t,r))).type=i.plugin._paneType,i.paneClass="paneOutline panePlugin paneDrive noComplete",i._isSearchingRemote=new U.a(!1),i._currentSearch=void 0,i.initDrive(),i}return p()(e,t),s()(e,[{key:"initDrive",value:function(){this.search.onChanged.listen(V.a.forceBind("notifySearchChanged",this)),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0}},{key:"destroy",value:function(){this.search.onChanged.unlisten(this.notifySearchChanged),clearTimeout(this._searchTimeout),this._searchTimeout=void 0,g()(v()(e.prototype),"destroy",this).call(this)}},{key:"_getNotReadyStatus",value:function(){var t="Unknown Error: Unable to load pane data.",e=this.plugin.getUnloadedDependencies();return e&&(e.indexOf(A.a.PluginDependency.PremiumSub)>=0?t="Only available to premium subscribers.":e.indexOf(A.a.PluginDependency.GoogleLogin)>=0&&(t="Missing permissions for Google Drive access.")),t}},{key:"getItemStore",value:function(){return this.plugin.getActiveItemStore(this.id)}},{key:"getRootItem",value:function(){var t=this.getItemStore();return t?t.getRoot():void 0}},{key:"bottomListMessage",value:function(){var t;return!this.isSearched()&&this.getItem().hasPaginationToken()&&(t="LOAD MORE"),{text:t,clickable:!0}}},{key:"searchACName",value:function(){}},{key:"getPaneIcon",value:function(){return this.plugin.getPaneIcon()}},{key:"requestDemandLoadData",value:function(t){this.plugin.requestDemandLoadData(this.id,t)}},{key:"requestDataPage",value:function(t){this.plugin.requestDataPage(t)}},{key:"onAfterLoaded",value:function(){g()(v()(e.prototype),"onAfterLoaded",this).call(this)}},{key:"onClose",value:function(){g()(v()(e.prototype),"onClose",this).call(this)}},{key:"_runRemoteSearch",value:function(){if(An.PaneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var t=this.search.getValue();this._lastSearchValue=t,this._lastSearchTime=Date.now(),this.isLoading.set(!0),this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0),this._currentSearch=this.plugin.runSearch(t,this.id,void 0,!1,function(t){switch(this.isLoading.set(!1),t){case A.a.SearchResultStatus.Done:this.paneTopText.set("");break;case A.a.SearchResultStatus.TooMany:this.paneTopText.set("Too many search results! Be more specific.");break;case A.a.SearchResultStatus.None:this.paneTopText.set("There were no search results");break;case A.a.SearchResultStatus.Error:this.paneTopText.set("There was an error running your search, try again.");break;default:try{m.default.PAssert(1596,!1,"Invalid search state: ",t)}catch(e){m.default.reportError(e)}}}.bind(this))}}},{key:"notifySearchChanged",value:function(t){var e=this.search.getValue();if(e!==this._lastSearchValue||Date.now()-this._lastSearchTime>5e3)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,e){var i=t?0:2500;this._searchTimeout=setTimeout(this._runRemoteSearch.bind(this),i)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this.isLoading.set(!1),this.paneTopText.set("")}},{key:"refreshPaneData",value:function(){this.plugin.refreshCurrentView(this.id)}},{key:"notifyDropFrom",value:function(t,e){this.plugin.notifyDropFrom(t,e)}},{key:"notifyDropFromToEdit",value:function(t,e){return this.plugin.notifyDropFromToEdit(t,e)}},{key:"applyDropOnBlock",value:function(t,e){if(t.isDate){var i,r=t.dateTime||t.date;i=m.default.isString(r)?An.International.parseDate(r,A.a.DateFormat.MDY):r;try{m.default.PAssert(1597,m.default.isDateValid(i),"Must provide a valid date when scheduling an email",t.dateTime,t.date)}catch(a){m.default.reportError(a)}m.default.isDateValid(i)&&this.plugin.scheduleFile(e,i)}}},{key:"dropEffectCopyBehavior",value:function(t,i){return g()(v()(e.prototype),"dropEffectCopyBehavior",this).call(this,t,i)}},{key:"isSearchingRemote",value:function(){return this._isSearchingRemote.get()}},{key:"_onRemoteDataLoaded",value:function(){}},{key:"isItemHeader",value:function(t,e){if(e){var i=this.plugin,r=t.getAttachmentByPlugin(i.id),a=r&&i.getCacheData(r.id);return!a||i.isFolder(a)}return t.isHeader()}},{key:"titleOfFirstItem",value:function(){return"Drive Root"}}]),e}($t.a),Rt=i(26),Et=i(101),Kt="application/octet-stream",xt="application/vnd.google-apps.folder",bt="application/vnd.google-apps.spreadsheet",Ot="application/vnd.google-apps.presentation",Wt="application/vnd.google-apps.document",_t="application/vnd.google-apps.drive-sdk.597847337936",te="image/png",ee="image/jpg",ie="image/jpeg",re="image/gif",ae=1,ne=2,oe=3,ue=4,se=5,he=6,de=7,ce="S~SharedWithMe",ve="https://drive.google.com/open?id=",ye="-------314159265358979323846",ge="\r\n--"+ye+"\r\n",le=(Jt=function(t){function e(){var t;return o()(this,e),(t=d()(this,v()(e).call(this,A.a.PluginID.Drive,"d","Files",!1))).displaySharedWithMe=!m.default.isDemoMode(),t._requiresOfflineAuth=!0,t.registerSetting("WriteAccess","writeAccess","w",!0),t.registerSetting("LastChangeId","lastChangeId","i"),t.registerSetting("DriveRootId","driveRootId","d"),t._folderCache=t.registerLocalCache("FolderCache",A.a.StorageType.IndexedDB,!0),t.declareProperty("showInline",A.a.PluginLoad.Preview|A.a.PluginLoad.Full|A.a.PluginLoad.Inline,!0),t.declareProperty("imageWidth",A.a.PluginLoad.Preview|A.a.PluginLoad.Full|A.a.PluginLoad.Inline,!0),t.declareProperty("titleLower",A.a.PluginLoad.Runtime,!1,""),t.declareProperty("dataUrl",A.a.PluginLoad.Preview|A.a.PluginLoad.Runtime,!0),t.declareProperty("pinToTop",A.a.PluginLoad.Runtime,!0,!1),t.declareProperty("title"),t.declareProperty("mimeType"),t.declareProperty("fileSize",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!0),t.declareProperty("alternateLink",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!0),t.declareProperty("webContentLink",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!0),t.declareProperty("isDeleted",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!0,!1),t.declareProperty("modifiedDate",A.a.PluginLoad.Autocomplete,!0),t.declareProperty("parents",A.a.PluginLoad.Autocomplete,!0),t.useRenderer(A.a.PluginRenderTypes.StyledText,A.a.PluginRenderers.DriveFile),t.useRenderer(A.a.PluginRenderTypes.UnstyledText,A.a.PluginRenderers.DriveFile),t.useRenderer(A.a.PluginRenderTypes.Measure,A.a.PluginRenderers.DriveFile),t}return p()(e,t),s()(e,[{key:"getType",value:function(){return A.a.PluginType.Storage}},{key:"getDataPane",value:function(){try{m.default.PAssert(830,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(t){m.default.reportError(t)}return Ut}},{key:"getPaneIcon",value:function(){return"icon-drive-file"}},{key:"getPanePriority",value:function(){return 96}},{key:"useItemStore",value:function(){return"Google Drive"}},{key:"itemStoreOptions",value:function(){return{requireStoredEls:!1,parserFn:J.a.runParseSinglePlugin}}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"onAuthorizedSetting",value:function(t,e){switch(t){case this.Settings.WriteAccess:e&&this._ensureAttachmentsAreShared()}}},{key:"_ensureSpecialFolders",value:function(){var t=this.getDefaultItemStore();if(t){var e=t.getRoot();if(this.displaySharedWithMe&&!t.hasItem(ce)){var i=m.default.generateTempId();this.cacheData(i,{title:"Shared With Me",titleLower:"shared with me",mimeType:xt,pinToTop:!0});var r=this.getAttachment(i),a=t.createItem(ce,this.getAttachmentEmbedString(r),e.id,{demandLoadChildren:!0});e.insertSorted(a,this.sortFn)}}}},{key:"_load",value:function(){this._ensureSpecialFolders(),m.default.isDemoMode()||this.createRecurringTask("ChangeListUpdates",{delay:m.default.minutes(15),minDelay:m.default.minutes(2),runOnCreate:!0,pauseWhileIdle:!0,task:this.performChangeListUpdate.bind(this)})}},{key:"_notifyFailedRequest",value:function(t){t&&t.error&&m.default.reportError(new Error("Failed Drive request: "+t.error.code),t)}},{key:"refreshCurrentView",value:function(){this.hasRecurringTask("ChangeListUpdates")&&this.getRecurringTask("ChangeListUpdates").forceUpdate()}},{key:"loadInitialData",value:function(){var t=this;g()(v()(e.prototype),"loadInitialData",this).call(this),this._ensureSpecialFolders();var i=new Yt(function(){});setTimeout(function(){t._folderCache.onCacheReady(function(){t._folderCache.getMetadata("isSyncd",function(e){e||(m.default.log("Folder cache unsyncd - running folder sync"),t._folderCache.onCacheReady(function(){var e="trashed=false and mimeType contains '"+xt+"'";t._requestRemoteFiles(ne,i,e,999,function(e){t._folderCache.cacheEntry(e.id,t.serializeExternalData(e)),0},function(t){0}),t._folderCache.setMetadata("isSyncd",!0)}))})})},100);var r=!1,a=this.getDefaultItemStore(),n=a.getRoot(),o="trashed=false and 'root' in parents and mimeType != '"+_t+"'";this._requestRemoteFiles(oe,n,o,70,function(e){if(t.hasCacheData(e.id)||t._addRemoteEntry(e),!t._hasSameItem(e.id,n.id,a)){var i=a.createItem(t._createItemID(e.id,a),t._getTextForItem(e),n.id,{demandLoadChildren:e.mimeType===xt});n.insertSorted(i,t.sortFn)}if(!t.getSetting(t.Settings.DriveRootId)&&e.parents)for(var r=0,o=0;o<e.parents.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e.parents[o].isRoot&&t.setSetting(t.Settings.DriveRootId,e.parents[o].id)}},function(){r||(r=!0)})}},{key:"performChangeListUpdate",value:function(){var t=this,e=-1,i=this.getSetting(this.Settings.LastChangeId);this._requestChangeList(i,function(r){try{m.default.PAssert(831,!i||parseInt(r.id)>parseInt(i),"Must have correctly ordered change entry")}catch(a){m.default.reportError(a)}e=r.id;try{!r.fileId||r.file&&r.file.mimeType===_t||t._handleChange(r)}catch(n){m.default.reportError(n)}},function(i){i&&-1!==e&&t.setSetting(t.Settings.LastChangeId,e)})}},{key:"_deleteFile",value:function(t){t.forEachItem(this.getDefaultItemStore(),function(t){t.parent().removeChild(t,A.a.ChangeType.Remote),t.setParent(void 0)}),t.updateField("isDeleted",!0)}},{key:"_handleChange",value:function(t){var e=this;try{m.default.PAssert(832,t&&(t.deleted||t.file),"Must have a valid formed change entry to handle")}catch(f){m.default.reportError(f)}if((t.deleted||t.file.mimeType===xt)&&(t.deleted?this._folderCache.hasEntry(t.fileId,function(i){i&&e._folderCache.removeEntry(t.fileId)}):this._folderCache.cacheEntry(t.fileId,this.serializeExternalData(t.file))),!this.hasCacheData(t.fileId)&&!t.deleted&&t.file){for(var i=0,r=t.file.parents,a=!1,n=0;n<r.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(this.hasCacheData(r[n].id)||r[n].isRoot){a=!0;break}}a&&this._addRemoteEntry(t.file)}var o=this.getCacheData(t.fileId);if(o){t.deleted||this.dataHasChanged(o,t.file)&&this._addRemoteEntry(t.file);var u=this.getDefaultItemStore();if(t.deleted){var s=this.getAttachment(t.fileId);this._deleteFile(s)}else{var h=0,d=[];(s=this.getAttachment(t.fileId)).forEachItem(u,function(i){for(var r=0,a=!1,n=0;n<t.file.parents.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=t.file.parents[n];if(o.isRoot&&i.parent()&&i.parent().isRootItem()||i.parent()&&i.parent().hasAttachment(o.id)){a=!0,d.push(o.id);break}}i.parent()&&e._isSpecialFolder(i.parent().id)&&(a=!0,d.push(i.parent().id)),!a&&i.parent()&&(i.parent().removeChild(i,A.a.ChangeType.Remote),i.setParent(void 0))});for(var c=0;c<t.file.parents.length;++c){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var v=t.file.parents[c];if(d.indexOf(v.id)<0)if(v.isRoot){var y=u.getRoot(),g=u.createItem(this._createItemID(t.fileId,u),this._getTextForItem(t.file),y.id,{demandLoadChildren:t.file.mimeType===xt});y.insertSorted(g,this.sortFn)}else{this.getAttachment(v.id).forEachItem(u,function(i){var r=u.createItem(e._createItemID(t.fileId,u),e._getTextForItem(t.file),i.id,{demandLoadChildren:t.file.mimeType===xt});i.insertSorted(r,e.sortFn)})}}if(this.displaySharedWithMe&&t.file.sharedWithMeDate&&d.indexOf(ce)<0){var l=u.getItem(ce),p=u.createItem(this._createItemID(t.fileId,u),this._getTextForItem(t.file),l.id,{demandLoadChildren:t.file.mimeType===xt});l.insertSorted(p,this.sortFn)}}}}},{key:"_isValidFileID",value:function(t){return t.indexOf("~")<0}},{key:"_createItemID",value:function(t,e){var i=0;try{m.default.PAssert(833,t,"Must provide a fileID")}catch(n){m.default.reportError(n)}try{m.default.PAssert(834,this._isValidFileID(t),"Invalid fileID - "+t)}catch(n){m.default.reportError(n)}try{m.default.PAssert(835,e,"Must provide a valid itemStore")}catch(n){m.default.reportError(n)}for(var r=t,a=0;e.hasItem(r)&&a<50;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r=t+"~"+ ++a}try{m.default.PAssert(836,a<50,"SANITY: Should not have items with 50+ parents")}catch(n){m.default.reportError(n)}return r}},{key:"_hasSameItem",value:function(t,e,i){for(var r=0,a=!1,n=t,o=0;i.hasItem(n)&&o<50;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=i.getItem(n);if(u&&u.parent()&&u.parent().id===e){a=!0;break}n=t+"~"+ ++o}return a}},{key:"_isSpecialFolder",value:function(t){return t.startsWith("S~")}},{key:"requestDemandLoadData",value:function(t,e){var i=this;try{m.default.PAssert(837,1===e.getNumAttachments(),"Should only have a single attachment for Drive Pane VMLIs")}catch(u){m.default.reportError(u)}var r,a=An.PaneManager.getPaneById(t),n=e.getAttachmentByPlugin(this.id);if(this._isSpecialFolder(e.id))switch(e.id){case ce:r="trashed=false and sharedWithMe and mimeType != '"+_t+"'";break;default:try{m.default.PAssert(838,!1,"Invalid special folder ID")}catch(u){m.default.reportError(u)}}r||(r="trashed=false and '"+n.id+"' in parents and mimeType != '"+_t+"'");var o=this.getActiveItemStore(t);this._requestRemoteFiles(oe,e,r,70,function(t){if(i.hasCacheData(t.id)||i._addRemoteEntry(t),!i._hasSameItem(t.id,e.id,o)){var r=o.createItem(i._createItemID(t.id,o),i._getTextForItem(t),e.id,{demandLoadChildren:t.mimeType===xt});e.insertSorted(r,i.sortFn)}},function(t){t||e.hasPaginationToken()||e.notifyLoadDataFailed(a)}),this.sendEvent("RequestDemandLoadData")}},{key:"requestDataPage",value:function(t){this._requestRemoteFiles(se,t)}},{key:"_ensureAncestorChain",value:function(t,e,i,r){var a=this;try{m.default.PAssert(839,i,"Must provide a valid success callback")}catch(g){m.default.reportError(g)}try{m.default.PAssert(840,r,"Must provide a valid error callback")}catch(g){m.default.reportError(g)}if(e.parents&&e.parents.length)for(var n=0,o=e.parents.length,u=0,s=function(){++u===o&&i()},h=function(e){try{m.default.PAssert(841,e,"Must provide valid fileInfo up ancestor chain")}catch(g){m.default.reportError(g)}a.hasCacheData(e.id)||a._addRemoteEntry(e),a._ensureAncestorChain(t,e,s,r)},d=function(t){if(t){var e=a.serializeExternalData(t);a._folderCache.cacheEntry(e.id,e),h(e)}else r({error:"Undefined success result."})},c=function(t,e){if(t)h(t);else{var i=Pt.a.fns("drive").files.get.packedFn,n={fileId:e};a._queueRemoteRequestMulti(Rt.a.getDefaultAccountID(),i,n,d,r,void 0,de)}},v=0;v<e.parents.length;++v){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var y=e.parents[v].id;try{m.default.PAssert(842,y,"Must supply a valid parent ID to query")}catch(g){m.default.reportError(g)}this._folderCache.getEntry(y,c)}else i()}},{key:"_hasAttachmentChild",value:function(t,e){for(var i=0,r=!1,a=0;a<t.numItems();++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(t.itemAtIndex(a).hasAttachment(e)){r=!0;break}}return r}},{key:"_attachAncestorChain",value:function(t,e){var i=this;try{m.default.PAssert(843,e,"Must provide a valid cache entry to create items for")}catch(s){m.default.reportError(s)}if(e.parents&&e.parents.length>0)for(var r=0,a=0;a<e.parents.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=e.parents[a];try{m.default.PAssert(844,n&&n.id,"Must supply a valid parent ID to query")}catch(s){m.default.reportError(s)}if(n.isRoot){var o=t.getRoot();if(!this._hasAttachmentChild(o,e.id)){var u=t.createItem(this._createItemID(e.id,t),this._getTextForItem(e),o.id,{demandLoadChildren:e.mimeType===xt});o.insertSorted(u,this.sortFn)}}else this._folderCache.getEntry(n.id,function(r){i._attachAncestorChain(t,r),i.getAttachment(r.id).forEachItem(t,function(r){if(!i._hasAttachmentChild(r,e.id)){var a=t.createItem(i._createItemID(e.id,t),i._getTextForItem(e),r.id,{demandLoadChildren:e.mimeType===xt});r.insertSorted(a,i.sortFn)}})})}}},{key:"getNextSearchPage",value:function(){this._lastCompletedSearch&&this._lastCompletedSearch.isValid()&&this._lastCompletedSearch.getNextPage()}},{key:"runRemoteSearch",value:function(t,e,i,r){var a=this;try{m.default.PAssert(845,t,"Must provide a valid search")}catch(l){m.default.reportError(l)}try{m.default.PAssert(846,e,"Must provide a valid pane")}catch(l){m.default.reportError(l)}try{m.default.PAssert(847,m.default.isFunction(r),"Must provide a valid search callback")}catch(l){m.default.reportError(l)}var n=!1,o=0,u=0,s=0,h=new Bt(t,10,this.requestDataPage.bind(this)),d=function(){if(o===u&&n){m.default.log("Done Searching! "+o);var t=A.a.SearchResultStatus.Done;if(h.isValid())An.PaneManager.getPaneById(e).search.update(!0),h.isValid()&&h.hasMoreResults()?(m.default.log("Too many search results"),t=A.a.SearchResultStatus.TooMany):h.hasError()||s>0?t=A.a.SearchResultStatus.Error:0===o&&(t=A.a.SearchResultStatus.None),a._lastCompletedSearch=h;r(t)}},c=function(t){o++,a.hasCacheData(t.id)||a._addRemoteEntry(t);var i=a.getActiveItemStore(e);a._ensureAncestorChain(i,t,function(){h.isValid()&&a._attachAncestorChain(i,t),u++,d()},function(t){m.default.reportError(new Error("Error during remote search: "+t)),u++,s++,d()})},v=function(t){n=!0,d()},y=!1,g="trashed=false and (fullText contains '"+t+"')";return this._requestRemoteFiles(ue,h,g,100,h.onEntry,function(t){h.onDone(t),y||(y=!0,h.isValid()&&(h.hasResults()?h.getNextPage(c,v):v()))}),this.sendEvent("RemoteSearch"),h}},{key:"_requestRemoteFiles",value:function(t,e,i,r,a,n){var o,u=this;e&&e.hasPaginationToken()&&!e.paginationTokenInUse()?(i=(o=e.beginDataPageLoad()).getQuery(),r=o.getMaxResults(),a=o.getEntryCB(),n=o.getDoneCB()):e&&e.needsPaginationToken()&&(o=this.createPaginationToken(void 0,i,{},r,a,n),e.setPaginationToken(o),e.beginDataPageLoad()),r=r||70;try{m.default.PAssert(848,a&&m.default.isFunction(a),"Must define a valid entry callback")}catch(v){m.default.reportError(v)}try{m.default.PAssert(849,n&&m.default.isFunction(n),"Must define a valid done callback")}catch(v){m.default.reportError(v)}var s,h,d=Pt.a.fns("drive").files.list.packedFn,c={fields:"items,nextPageToken",maxResults:r,q:i,pageToken:o&&o.hasMorePages()?o.getNextPageToken():void 0};o||!e?(s=function(t){if(t.items){var i=0;An.PaneUpdateBatcher.beginUpdateItems();for(var r=0;r<t.items.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a(t.items[r])}An.PaneUpdateBatcher.commitUpdateItems()}t.nextPageToken&&o&&u.updatePaginationToken(o,t.nextPageToken),e&&o&&e.endDataPageLoad(!!t.nextPageToken),n(!0)},h=function(){o&&e.endDataPageLoad(!!o),n(!1)}):(s=function(){n(!0)},h=function(){n(!1)}),this._queueRemoteRequestMulti(Rt.a.getDefaultAccountID(),d,c,s,h,void 0,t)}},{key:"getRemoteAttachmentData",value:function(t){var e=this,i=Pt.a.fns("drive").files.get.packedFn,r={fileId:t.id};this._queueRemoteRequestMulti(Rt.a.getDefaultAccountID(),i,r,function(i){try{m.default.PAssert(850,!i||i.id===t.id,"If valid result, attachment should match remote file ID")}catch(r){m.default.reportError(r)}i&&(e._addRemoteEntry(i),(i.deleted||i.mimeType===xt)&&(i.deleted?e._folderCache.hasEntry(i.id,function(t){t&&e._folderCache.removeEntry(i.id)}):e._folderCache.cacheEntry(i.id,e.serializeExternalData(i))))},function(i){if(m.default.isHTTPStatusCode(i,A.a.HTTPStatusCode.NotFound)){var r={id:t.id,mimeType:Kt,title:"Unknown",titleLower:"unknown",fileSize:0};e._addRemoteEntry(r),e._deleteFile(t)}else t.notifyDataRequestFailed(),e._notifyFailedRequest(i)},t,ae)}},{key:"_requestChangeList",value:function(t,e,i){var r,a,n,o,u=this;if(t&&t>=0){try{m.default.PAssert(851,e,"Must supply a valid entry CB")}catch(s){m.default.reportError(s)}try{m.default.PAssert(852,i,"Must provide a valid done CB")}catch(s){m.default.reportError(s)}r=Pt.a.fns("drive").changes.list.packedFn,a={includeDeleted:!0,includeSubscribed:!0,maxResults:500,startChangeId:+t+1,fields:"items,nextPageToken"},n=function(r){var a=0,n=t;An.PaneUpdateBatcher.beginUpdateItems();for(var o=0;o<r.items.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var h=r.items[o];try{m.default.PAssert(853,h,"Must have a valid change entry")}catch(s){m.default.reportError(s)}try{m.default.PAssert(854,parseInt(h.id)<1e8,"Must have a valid entry ID")}catch(s){m.default.reportError(s)}try{m.default.PAssert(855,parseInt(h.id)>parseInt(n),"Must be ordered monotonic increasing")}catch(s){m.default.reportError(s)}n=h.id,e(h)}An.PaneUpdateBatcher.commitUpdateItems(),r.nextPageToken?u._requestChangeList(n,e,i):i(!0)},o=function(t){i(!1)}}else r=Pt.a.fns("drive").changes.list.packedFn,a={includeDeleted:!0,includeSubscribed:!0,maxResults:1,startChangeId:1e8},n=function(t){var r=t.largestChangeId;e({id:r}),i(!0)},o=function(t){i(!1)};this._queueRemoteRequestMulti(Rt.a.getDefaultAccountID(),r,a,n,o,void 0,he)}},{key:"_createRemoteEntry",value:function(t){var e={id:t.id,mimeType:t.mimeType,title:t.title,titleLower:t.title.toLowerCase(),alternateLink:t.alternateLink,webContentLink:t.webContentLink,dataUrl:t.dataUrl,fileSize:+t.fileSize,parents:t.parents,modifiedDate:t.modifiedDate?new Date(t.modifiedDate):void 0};if(e.parents)for(var i=0,r=0;r<e.parents.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._updateParentsEntry(e.parents[r])}return this.isFolder(e)&&(e.items=[]),e}},{key:"_addRemoteEntry",value:function(t){var e=this._createRemoteEntry(t);this.cacheData(e.id,e)}},{key:"createEntryFromLocal",value:function(t,e){if(this.isFolder(e)&&(e.items=[]),e.titleLower=e.title.toLowerCase(),e.modifiedDate=e.modifiedDate?new Date(e.modifiedDate):void 0,e.isDeleted=e.isDeleted||m.default.isTempId(t),e.parents)for(var i=0,r=0;r<e.parents.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._updateParentsEntry(e.parents[r])}return e}},{key:"_updateParentsEntry",value:function(t){this._folderCache.getEntry(t.id,function(e){e&&(t.title=e.title)})}},{key:"isFolder",value:function(t){return t.mimeType===xt}},{key:"_getCompStringForItem",value:function(t){return t.hasPluginAttachment(this.id)?t.getAttachmentByPlugin(this.id).getTitleString():t.getParsedText()}},{key:"_isItemPinnedToTop",value:function(t){return!!t.hasPluginAttachment(this.id)&&t.getAttachmentByPlugin(this.id).getField("pinToTop")}},{key:"sortFn",value:function(t,e){return this._isItemPinnedToTop(t)?-1:this._isItemPinnedToTop(e)?1:this._getCompStringForItem(t).localeCompare(this._getCompStringForItem(e))}},{key:"getAttachmentClass",value:function(t){var e=["plugin_drive"];return t.hasField("mimeType")?e.push(this.getMimetypeClass(t)):e.push("plugin_drive_unk"),t.hasField("isDeleted")&&t.getField("isDeleted")&&e.push("fileDeleted"),e}},{key:"getMimetypeClass",value:function(t){var e=t.getField("mimeType");if(this.isMimetypeImage(e))return t.getField("showInline")?"plugin_drive_image_inline":"plugin_drive_image";switch(e){case xt:return"plugin_drive_folder";case bt:return"plugin_drive_sheet";case Ot:return"plugin_drive_slide";case Wt:return"plugin_drive_doc";default:return"plugin_drive_unk"}}},{key:"isMimetypeImage",value:function(t){switch(t){case te:case re:case ee:case ie:return!0}}},{key:"isImage",value:function(t){var e=this.getMimetypeClass(t);return t.hasField("mimeType")&&("plugin_drive_image"===e||"plugin_drive_image_inline"===e)}},{key:"googleScopes",value:function(t){return t||this.getSetting(this.Settings.WriteAccess)?[A.a.GScope.DriveFull]:[A.a.GScope.Drive,A.a.GScope.DriveMetadataRO]}},{key:"getDependencies",value:function(){return[A.a.PluginDependency.PremiumSub,A.a.PluginDependency.GoogleLogin]}},{key:"verifyAuthorization",value:function(t){return kt.a.isAuthorizedForScopes(t,this.googleScopes())}},{key:"handleDropEvent",value:function(t,e){var i=t.dataTransfer?t.dataTransfer.getData("text/uri-list"):void 0,r=m.default.getPaneForElement(t.target);if(i&&i.startsWith(ve)){var a=i.replace(ve,""),n=a.indexOf("&"),o=a.substr(0,n);return m.default.shouldLog(A.a.LogLevels.Plugin)&&m.default.log("Dropped File: ",o),e(this.getAttachment(o).getEmbedString()),!0}if(t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files.length>0){for(var u=0,s=0;s<t.dataTransfer.files.length;++s){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var h=t.dataTransfer.files[s];this.handleDropFile(h,r,t,e)}return Y.e.miscAction({type:Y.c.Misc,misc:Y.a.DriveUpload}),!0}if(t.clipboardData&&t.clipboardData.items&&t.clipboardData.items.length>0){var d=0;for(s=0;s<t.clipboardData.items.length;++s){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var c=t.clipboardData.items[s];(h=c?c.getAsFile():void 0)&&(h.customName="Moo.do Upload "+Date.now(),this.handleDropFile(h,r,t,e))}return Y.e.miscAction({type:Y.c.Misc,misc:Y.a.DriveUpload}),!0}return!1}},{key:"highlightItem",value:function(t){t.highlight()}},{key:"handleDropFile",value:function(t,e,i,r){for(var a=0,n=this,o=t.customName||t.name,u=this.findCachedItemsByField("title",o),s=this.getDefaultItemStore(),h=e.type===A.a.PaneMode.Task&&this.isMimetypeImage(t.type)&&An.settings.showImagesInline.get()?{showInline:!0}:void 0,d=!1,c=0;c<u.length;++c){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var v=u[c];if(v.fileSize===t.size&&!v.isDeleted){var y=this.getAttachment(v.id,h);if(e&&e.isWriteable&&e.plugin!==this)r(this.getAttachmentEmbedString(y),!1);else if(e&&e.plugin===this){var g=this.getDefaultItemStore();y.forEachItem(g,this.highlightItem)}d=!0;break}}if(!d){var l=m.default.generateTempId();this.cacheData(l,{title:o,titleLower:o.toLowerCase(),mimeType:t.type});var p,f,k=this.getAttachment(l,h),S=e&&e.isWriteable&&e.plugin!==this,w=!1;if(e&&e.isWriteable&&e.plugin!==this)w=!0;else if(i&&this.getSetting(this.Settings.WriteAccess)){var L=i.target;(p=m.default.hasClass(L,"paneContent")?e.getItem():m.default.getItemForElement(L))&&!p.isHeader()&&(p=p.parent())}if(p){if(!p.isRootItem()){var F=p.getAttachmentByPlugin(this.id);try{m.default.PAssert(856,F,"Drive items must have valid attachments")}catch(I){m.default.reportError(I)}f=F.id}}else p=s.getRoot(),f=this.getSetting(this.Settings.DriveRootId);var C=e.getDocument();this._upload(t,k,S,C,f,function(){try{m.default.PAssert(857,!s.hasItem(k.id),"When uploading a new file, should never have duplicated items")}catch(I){m.default.reportError(I)}var t=s.createItem(k.id,n.getAttachmentEmbedString(k),p.id);p.insertSorted(t,n.sortFn),w&&r(n.getAttachmentEmbedString(k),!0),C.isShared()&&An.toasts.pushMessage({text:"Note: Sharing files with collaborators is temporarily disabled while we rebuild it for the new backend",timeout:8e3})})}}},{key:"notifyDropFrom",value:function(t,e){var i=this;try{m.default.PAssert(858,t,"Must have a valid item that was dropped")}catch(n){m.default.reportError(n)}try{m.default.PAssert(859,e,"Must have a valid pane the item was dropped on")}catch(n){m.default.reportError(n)}if(!m.default.isDemoMode()){var r=t.getAttachmentByPlugin(this.id),a=e.getDocument();Et.a.getDocumentFolder(a.id,function(t){Et.a.copyFileToFolder(r.id,t,function(t,e){t||i.getSetting(i.Settings.WriteAccess)&&e.code===A.a.HTTPStatusCode.Unauthorized&&i.setSetting(i.Settings.WriteAccess,!1)})}),this.sendEvent("AttachmentDropped")}}},{key:"notifyDropFromToEdit",value:function(t,e){if(!m.default.isDemoMode())if(this.getSetting(this.Settings.WriteAccess)){if(t.getAttachmentByPlugin(this.id)){var i=document.createEvent("Event");i.item=t,i.initEvent("cdrop",!0,!0),e.dispatchEvent(i)}this.sendEvent("AttachmentDroppedEdit")}else An.toasts.pushMessage(A.a.MessageID.NeedDrivePermission)}},{key:"getAttachUrl",value:function(t){var e=this.getCacheData(t.id);if(e)return e.webContentLink&&e.webContentLink.replace("export=download","")||e.dataUrl}},{key:"getAttachDataUrl",value:function(t){var e=this.getCacheData(t.id);return e&&e.dataUrl}},{key:"handleTapStart",value:function(t,e,i,r){return!0}},{key:"handleTapClick",value:function(t,e,i,r){var a=this.getAttachment(i);if(P.a.mac&&r.metaKey||!P.a.mac&&r.ctrlKey||this.isPluginPane)return this.openAttach(a,t,e,!0,r)}},{key:"openAttach",value:function(t,e,i,r,a){var n=this,o=this.getCacheData(t.id);if(o){if(this.isPluginPane(i)&&this.isFolder(o))i.zoomIn(e),this.sendEvent("Tap_FolderZoom");else if(P.a.isMobile){var u=this.createDisplayElement(t).text;m.default.preventDefault(a),m.default.preventClick(),An.menus.openMenuExternalApp(u,function(){o.alternateLink?m.default.openUrl(o.alternateLink,a):o.id?m.default.openUrl(n._createDriveURL(o.id,o.mimeType),a):An.toasts.pushMessage({text:"Your file is still uploading, please try again in a minute.",action:A.a.MessageAction.Okay})}),this.sendEvent("Tap_OpenFileMobile")}else{var s;o.alternateLink?s=o.alternateLink:o.id?s=this._createDriveURL(o.id,o.mimeType):An.toasts.pushMessage({text:"Your file is still uploading, please try again in a minute.",action:A.a.MessageAction.Okay}),s&&(r&&!(P.a.mac&&a.metaKey||!P.a.mac&&a.ctrlKey)&&this.isImage(t)&&!P.a.isMobile?(s="https://drive.google.com/uc?export=view&id="+o.id,An.menus.openLightbox(s)):s&&(m.default.isDemoMode()?An.toasts.pushMessage(A.a.MessageID.DemoPluginClick):(m.default.openUrl(s,a),this.sendEvent("Tap_OpenFileDesktop"))))}return!0}return!1}},{key:"createFolderURL",value:function(t){return"https://drive.google.com/drive/folders/"+t}},{key:"_createDriveURL",value:function(t,e){var i="https://docs.google.com/";switch(e){case xt:return i+"folderview?id="+t+"&usp=drivesdk";case bt:return i+"spreadsheets/d/"+t+"/edit?usp=drivesdk";case Wt:return i+"document/d/"+t+"/edit?usp=drivesdk";case Ot:return i+"presentation/d/"+t+"/edit?usp=drivesdk";default:return i+"file/d/"+t+"/edit?usp=drivesdk"}}},{key:"compactCacheField",value:function(t,e){var i;switch(e){case"alternateLink":t[e]!==this._createDriveURL(t.id,t.mimeType)&&(i=t[e]);break;default:i=t[e]}return i}},{key:"supportUsageCache",value:function(){return!0}},{key:"matchAttachment",value:function(t,e){return t.getField("titleLower").indexOf(e)>=0}},{key:"getBlockedText",value:function(t){return"Go Premium to view Drive files"}},{key:"onDocumentShared",value:function(t){this.getSetting(this.Settings.WriteAccess)?t&&this._ensureAttachmentsAreShared():this.numActiveAttachments()>0&&An.toasts.pushMessage(A.a.MessageID.NoSharingWarning)}},{key:"_ensureAttachmentsAreShared",value:function(){}},{key:"notifyAttachmentUnused",value:function(t,i){g()(v()(e.prototype),"notifyAttachmentUnused",this).call(this,t,i),m.default.isDemoMode()}},{key:"_upload",value:function(t,e,i,r,a,n){var o=this;t.size>20971520?(An.toasts.pushMessage(A.a.MessageID.WarnLargeFile),this.sendEvent("Upload_Large")):this.sendEvent("Upload");var u=this.isMimetypeImage(t.type)&&An.settings.showImagesInline.get();if(u){var s=new FileReader;s.onload=function(t){var i=o.getCacheData(e.id);i.dataUrl=t.target.result,o.cacheData(e.id,i),n(t)},s.readAsDataURL(t)}var h=new FileReader;h.readAsBinaryString(t),h.onload=function(n){var u=t.type||Kt;try{m.default.PAssert(860,r,"Must supply a valid paneDoc if uploading a file")}catch(s){m.default.reportError(s)}o.getDocumentFolder(r,function(r){kt.a.getDefaultAuthToken(o.googleScopes(),function(n){n?function(r,n){var s={title:t.customName||t.name,mimeType:u,parents:a?[{id:a}]:[]};i&&n&&s.parents.push({id:n});var d=btoa(h.result),c=ge+"Content-Type: application/json\r\n\r\n"+JSON.stringify(s)+ge+"Content-Type: "+u+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+d+"\r\n---------314159265358979323846--";window.gapi.client.request({path:"/upload/drive/v2/files",method:"POST",params:{uploadType:"multipart"},headers:{Authorization:r?"Bearer "+r.access_token:void 0,"Content-Type":'multipart/mixed; boundary="'+ye+'"'},body:c}).execute(function(t){o.changeID(e,e.id,t.id);var i=o.getAttachDataUrl(e);i&&(t.dataUrl=i),o._addRemoteEntry(t)})}(n,r):An.toasts.pushMessage({text:"Uploading file failed because of missing authorization. Please check the Drive plugin is enabled.",action:A.a.MessageAction.OpenSettings})})})},u||n()}},{key:"getDocumentFolder",value:function(t,e){return Et.a.getDocumentFolder(t.id,e)}},{key:"scheduleFile",value:function(t,e){Y.e.beginAction();var i=t.getAttachmentByPlugin(this.id);try{m.default.PAssert(861,i,"Must be able to get a valid attachment from item")}catch(s){m.default.reportError(s)}var r=A.a.MSPerHour,a=An.pluginManager.getPluginGCalendar();if(a){var n=a.getDefaultExportCalendarID();if(n&&(m.default.isDemoMode()||a.getSetting(a.Settings.WriteAccess))){var o=i.getField("title"),u=this._createDriveURL(i.id,i.getField("mimeType"));a.createEventForEmail(n,o,u,e,r,function(t,e,i,r){t||e?e||An.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar.",action:A.a.MessageAction.Okay}):An.toasts.pushMessage({text:"There was an error adding the file to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:function(){An.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:A.a.MessageAction.Okay})}})})}else An.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:A.a.MessageAction.OpenCalendarSettings})}else An.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule files.",action:A.a.MessageAction.OpenSettings});Y.e.endAction()}},{key:"findMatchExact",value:function(t){}},{key:"findMatchLike",value:function(t,e){var i=t.toLowerCase(),r=this.findCachedItemsByFn(function(t){return t.titleLower.indexOf(i)>=0},e);return r.sort(function(t,e){return t.modifiedDate&&e.modifiedDate?Date.compare(t.modifiedDate,e.modifiedDate):t.modifiedDate?-1:e.modifiedDate?1:t.titleLower.localeCompare(e.titleLower)}),r}},{key:"getAttachWidth",value:function(t){return t.hasField("imageWidth")&&t.getField("imageWidth")?+t.getField("imageWidth"):void 0}},{key:"setAttachWidth",value:function(t,e,i){e.updateField("imageWidth",i,!0),t.onAttachInlineUpdate()}},{key:"setShowInline",value:function(t,e,i){e.updateField("showInline",i,!0),t.onAttachInlineUpdate()}}]),e}(Gt),I()(Jt.prototype,"sortFn",[H.a],Object.getOwnPropertyDescriptor(Jt.prototype,"sortFn"),Jt.prototype),Jt),pe=i(37),me=i.n(pe),fe="Gmail";function ke(t){var e={subject:t.subject||"",from:t.from||"",id:t.mailMessageId?t.mailMessageId:"mailbird_"+t.id,latestMessageAt:t.latestMessageAt};return t.gmailID&&(e.provider="Gmail",e.threadID=t.gmailID),e}var Ae=new(function(){function t(){o()(this,t)}return s()(t,[{key:"dragOver",value:function(t){var e=m.default.elementFromPoint(t.x,t.y);if(e){var i=void 0!==this._prevX?t.x-this._prevX:0,r=void 0!==this._prevY?t.y-this._prevY:0;this._prevX=t.x,this._prevY=t.y;var a={clientX:t.x,clientY:t.y,diffX:i,diffY:r,target:e,dataTransfer:{}};An.DragDrop.handleDragOver(a)}}},{key:"drop",value:function(t){var e=m.default.elementFromPoint(t.x,t.y);var i={clientX:t.x,clientY:t.y,target:e,dataTransfer:{getData:function(e){if("mailbird/email"===e)return ke(t)}},preventDefault:m.default.emptyFn,stopPropagation:m.default.emptyFn};setTimeout(function(){An.DragDrop.handleDrop(i)},0)}},{key:"dragLeave",value:function(){An.DragDrop.handleDragLeave({target:document.getElementById("container")})}},{key:"reportError",value:function(t){m.default.reportError(new Error(t))}}]),t}()),Se=(Zt=function(t){function e(){var t;if(o()(this,e),(t=d()(this,v()(e).call(this,A.a.PluginID.Mailbird,"b","Mailbird",!0))).declareProperty("subject",A.a.PluginLoad.Preview|A.a.PluginLoad.Full|A.a.PluginLoad.Inline,!1,""),t.declareProperty("from",A.a.PluginLoad.Preview|A.a.PluginLoad.Full|A.a.PluginLoad.Inline,!1,""),t.declareProperty("date",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!0,new Date),t.declareProperty("subjectLower",A.a.PluginLoad.Runtime,!1,""),t.declareProperty("fromLower",A.a.PluginLoad.Runtime,!1,""),t.declareProperty("unread",A.a.PluginLoad.Runtime,!0,!1),t.declareProperty("snippet",A.a.PluginLoad.Runtime,!0,""),t.declareProperty("count",A.a.PluginLoad.Runtime,!0,1),t.declareProperty("latestMessageAt",A.a.PluginLoad.Preview|A.a.PluginLoad.Full|A.a.PluginLoad.Inline,!1),t.declareProperty("provider",A.a.PluginLoad.Preview|A.a.PluginLoad.Full|A.a.PluginLoad.Inline,!0),t.declareProperty("threadID",A.a.PluginLoad.Preview|A.a.PluginLoad.Full|A.a.PluginLoad.Inline,!0),t.declareProperty("hasAttachments",A.a.PluginLoad.Full,!0,!1),t.useRenderer(A.a.PluginRenderTypes.StyledText,A.a.PluginRenderers.EmailThread),t.useRenderer(A.a.PluginRenderTypes.UnstyledText,A.a.PluginRenderers.EmailThread),t.useRenderer(A.a.PluginRenderTypes.Measure,A.a.PluginRenderers.EmailThread),t.isMailbirdEmbed=P.a.embed===A.a.EmbedApps.Mailbird,t.isMailbirdEmbed){t.setSetting(t.Settings.IsEnabled,!0),t._needInlineDataUpdate=[],An.nativeBridge.registerEmbedBridge(me()(me()(t)));var i=An.nativeBridge.registerInboundAPI("mailbird");try{m.default.PAssert(819,i,"Error creating native inbound API for mailbird")}catch(r){m.default.reportError(r)}i&&(i.registerVariable("_prevX"),i.registerVariable("_prevY"),i.registerFunction("dragOver",Ae.dragOver,!0),i.registerFunction("drop",Ae.drop,!0),i.registerFunction("dragLeave",Ae.dragLeave,!0),i.registerFunction("reportError",Ae.reportError,!0)),t._mailbirdOutAPI=An.nativeBridge.registerOutboundAPI("mailbird");try{m.default.PAssert(820,t._mailbirdOutAPI,"Error creating native outbound API for mailbird")}catch(r){m.default.reportError(r)}t._mailbirdOutAPI&&(t._mailbirdOutAPI.requireFunction("selectConversation"),t._mailbirdOutAPI.requireFunction("selectConversationEx",!0),t._mailbirdOutAPI.requireFunction("scheduleNotifications",!0),t._mailbirdOutAPI.requireFunction("getByIdEx",!0),t._canUpdateInlineData=t._mailbirdOutAPI.hasOptionalFunction("getByIdEx"))}return t}return p()(e,t),s()(e,[{key:"getPaneIcon",value:function(){return"icon-envelope"}},{key:"useItemStore",value:function(){return"Mailbird"}},{key:"_addRemoteEntry",value:function(t){var e={id:t.id,provider:t.provider,threadID:t.threadID,subject:t.subject,subjectLower:t.subject.toLowerCase(),from:t.from,fromLower:t.from.toLowerCase(),latestMessageAt:t.latestMessageAt};return this.cacheData(e.id,e),e}},{key:"createEntryFromLocal",value:function(t,e){return e.subjectLower=e.subject.toLowerCase(),e.fromLower=e.from.toLowerCase(),e}},{key:"getAttachmentClass",value:function(t){return["plugin_mailbird"]}},{key:"isPluginBlocked",value:function(){return!1}},{key:"handleEmbedMessage",value:function(t,e){switch(t){case"scheduledItems":if(this._mailbirdOutAPI.hasOptionalFunction("scheduleNotifications"))try{var i=JSON.stringify(e);this._mailbirdOutAPI.call("scheduleNotifications",i)}catch(r){m.default.reportError(r)}break;default:try{m.default.PAssert(821,!1,"Unknown embed message: "+t)}catch(a){m.default.reportError(a)}}}},{key:"handleDropEvent",value:function(t,e){try{m.default.PAssert(822,e,"Must provide a valid callback to the drop event")}catch(n){m.default.reportError(n)}if(t.dataTransfer){var i=t.dataTransfer.getData("mailbird/email");if(i){var r=this._addRemoteEntry(i),a=this.getAttachment(r.id,r);try{m.default.PAssert(823,a.isLoaded(),"Mailbird attachments must always be loaded after creation")}catch(n){m.default.reportError(n)}return e(this.getAttachmentEmbedString(a)),!0}}return!1}},{key:"handleTapStart",value:function(t,e,i,r){return!0}},{key:"handleTapClick",value:function(t,e,i,r){var a=this.getCacheData(i);if(!a){var n=this.getAttachment(i);n&&(a=n.getInlineData())}if(a){if(this.isMailbirdEmbed){var o;if(!a.id.startsWith("mailbird_")&&this._mailbirdOutAPI.hasOptionalFunction("selectConversationEx")){var u=null;if("Gmail"===a.provider){try{m.default.PAssert(824,a.threadID,"Must provide a valid Gmail ID if it is defined as the provider")}catch(h){m.default.reportError(h)}u=parseInt(a.threadID)}var s=a.id;o=this._mailbirdOutAPI.call("selectConversationEx",u,s,+a.latestMessageAt)}else{s=a.id.replace("mailbird_","");o=this._mailbirdOutAPI.call("selectConversation",s)}try{m.default.PAssert(825,void 0!==o,"Must always receive a value back from Mailbird")}catch(h){m.default.reportError(h)}if(!0===o||!1===o)try{m.default.PAssert(826,o,"Must have successfully selected the email conversation in Mailbird: ",a.id,a.provider)}catch(h){m.default.reportError(h)}else{try{m.default.PAssert(827,o&&o.then,"Must have a valid promise object returned")}catch(h){m.default.reportError(h)}o.then(function(t){try{m.default.PAssert(828,t,"Must have successfully selected the email conversation in Mailbird: ",a.id,a.provider)}catch(h){m.default.reportError(h)}},function(t){try{m.default.PAssert(829,!1,"Failed to successfully select the email conversation in Mailbird: ",a.id,a.provider)}catch(h){m.default.reportError(h)}})}}else switch(a.provider){case fe:m.default.openUrl("https://mail.google.com/mail/u/0/#inbox/"+a.threadID);break;default:An.toasts.pushMessage(A.a.MessageID.MailbirdClick)}return!0}return!1}},{key:"getDisplayTags",value:function(t){return[]}},{key:"getDisplayParticipants",value:function(t){return""}},{key:"matchAttachment",value:function(t,e){return t.getField("fromLower").indexOf(e)>=0||t.getField("subjectLower").indexOf(e)>=0}},{key:"findMatchExact",value:function(t){}},{key:"findMatchLike",value:function(t,e){var i=t.toLowerCase();return this.findCachedItemsByFn(function(t){return t.subjectLower.indexOf(i)>=0||t.fromLower.indexOf(i)>=0},e)}},{key:"requestData",value:function(t,e){t.hasField("subject")?(t.notifyDataLoaded(A.a.PluginLoad.Full,!1,void 0,A.a.ChangeType.Remote),t.hasInlineData()||!this.isMailbirdEmbed||this._needInlineDataUpdate.includes(t)||(this._needInlineDataUpdate.push(t),this._timeoutInlineDataUpdate||(this._timeoutInlineDataUpdate=setTimeout(this.processMissingInlineUpdates,1e3))),t.hasField("latestMessageAt")||this.requestMissingData(t)):this.requestMissingData(t)}},{key:"requestMissingData",value:function(t){var e=this;this._canUpdateInlineData&&setTimeout(function(){e._mailbirdOutAPI.call("getByIdEx",t.id).then(function(i){try{var r=ke(JSON.parse(i));e.cacheData(r.id,r),e.fixAttach(t)}catch(a){m.default.reportError(a)}})},1e3)}},{key:"processMissingInlineUpdates",value:function(){var t=this._needInlineDataUpdate;if(t.length>0)for(var e=0,i=0;i<t.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t[i];r.isLoaded()&&this.fixAttach(r)}}},{key:"fixAttach",value:function(t){var e=this;t.forEachItem(An.itemStoreManager.getDefaultItemStore(),function(i){var r=i.getRawText();r=r.replace(e._getTextForItem(t.getData()),e.getAttachmentEmbedString(t)),i.setText(i.getParsedText(),A.a.ChangeType.Local)})}}]),e}(Gt),I()(Zt.prototype,"processMissingInlineUpdates",[H.a],Object.getOwnPropertyDescriptor(Zt.prototype,"processMissingInlineUpdates"),Zt.prototype),Zt);function we(t){this._maxSize=t,this._groups=[],this._groupID=0,this._cursor=-1,this._performingActions=!1,this._actionsPreventUndo=!1,this._aggregateActions=0,this._currentAction=[],this._registeredOwners={},this._registeredActions={}}we.prototype={registerOwner:function(t,e){try{m.default.PAssert(1581,t,"Must supply a valid owner object")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1582,!this._registeredOwners[e],"Must not double define an owner")}catch(i){m.default.reportError(i)}this._registeredOwners[e]=t,this._registeredActions[e]={}},registerAction:function(t,e,i){try{m.default.PAssert(1583,t,"Must provide a valid owner")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1584,e,"Must provide a valid action ID")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1585,this._registeredOwners[t],"Must have already registered a valid owner")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1586,!this._registeredActions[t][e],"Must not double define an action for an owner")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1587,i,"Must pass in a valid undo/redo descriptor")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1588,m.default.isFunction(i.undo),"Must provide a valid undo fn")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1589,m.default.isFunction(i.redo),"Must provide a valid redo fn")}catch(r){m.default.reportError(r)}this._registeredActions[t][e]=i},_getOwner:function(t){try{m.default.PAssert(1590,this._registeredOwners[t.ownerID],"Must have previously registered owner")}catch(e){m.default.reportError(e)}return this._registeredOwners[t.ownerID]},_getActionData:function(t){try{m.default.PAssert(1591,this._registeredOwners[t.ownerID],"Must have previously registered owner")}catch(e){m.default.reportError(e)}try{m.default.PAssert(1592,this._registeredActions[t.ownerID][t.actionID],"Must have previously registered action for owner")}catch(e){m.default.reportError(e)}return this._registeredActions[t.ownerID][t.actionID]},_useNextGroupID:function(){return++this._groupID},_getCurrentGroup:function(){return this._groups[this._cursor]},_createGroup:function(t){return{id:this._useNextGroupID(),events:t||[]}},_pushNewGroup:function(t){var e=this._createGroup(t);this._groups.length>this._cursor+1&&(this._groups=this._groups.slice(0,this._cursor+1)),this._groups.push(e),this._cursor<this._maxSize-1&&this._cursor++,this._groups.length>this._maxSize&&this._trimAction()},_trimAction:function(){this._groups.shift()},isUndoableAction:function(){return!this._actionsPreventUndo},beginAction:function(t){if(0===this._aggregateActions){try{m.default.PAssert(1593,0===this._currentAction.length,"Current actions should be flushed")}catch(e){m.default.reportError(e)}this._actionsPreventUndo=!!t}this._aggregateActions++},runAction:function(t,e,i){var r={ownerID:t,actionID:e},a=this._getOwner(r);return this._getActionData(r).redo.apply(a,i)},performAction:function(t,e,i){try{m.default.PAssert(1594,this._aggregateActions>0,"Must be in a begin/end action block")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1595,i,"Must provide valid data for the action")}catch(r){m.default.reportError(r)}this._currentAction.push({ownerID:t,actionID:e,data:i})},performActions:function(t){if(t&&t.length>0){var e=0;this.beginAction();for(var i=0;i<t.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t[i];this.performAction(r.ownerID,r.actionID,r.data)}this.endAction()}},endAction:function(){1===this._aggregateActions&&(this._currentAction.length>0&&(this._pushNewGroup(this._currentAction),this._currentAction=[]),this._actionsPreventUndo=!1),this._aggregateActions=Math.max(0,this._aggregateActions-1)},undoAction:function(){if(this._cursor>=0)for(var t=0,e=this._groups[this._cursor--],i=e.events.length-1;i>=0;i--){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e.events[i],a=this._getOwner(r);this._getActionData(r).undo.apply(a,r.data.undoParams)}},redoAction:function(){if(this._cursor>=-1&&this._cursor<this._groups.length-1)for(var t=0,e=this._groups[++this._cursor],i=0;i<e.events.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=e.events[i],a=this._getOwner(r);this._getActionData(r).redo.apply(a,r.data.redoParams)}}};var Le=we;function Fe(t,e,i,r,a,n){try{m.default.PAssert(1563,t,"Must specify a valid account ID")}catch(o){m.default.reportError(o)}try{m.default.PAssert(1564,e,"Must specify a valid label ID")}catch(o){m.default.reportError(o)}try{m.default.PAssert(1566,!r||m.default.isDateValid(r),"Must provide a valid oldestSync date")}catch(o){m.default.reportError(o)}try{m.default.PAssert(1567,n,"Must supply a valid label store this label belongs to")}catch(o){m.default.reportError(o)}this._labelStore=n,this._accountID=t,this._labelID=e,this._fullName=i,this._minName=void 0,this._matchName=i?i.toUpperCase():void 0,this._oldestSync=r,this._numUnread=0,this._ancestors=[],this._isDeleted=!(!a||!a.isDeleted),this._labelListVisibility=a&&a.labelListVisibility?a.labelListVisibility:A.a.LabelListVisibility.Show,this._messageListVisibility=a&&a.messageListVisibility?a.messageListVisibility:A.a.MessageListVisibility.Show,this._origLabelID=void 0}var Ce={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},Ie={INBOX:100,UNREAD:99,STARRED:98,IMPORTANT:97,SENT:96,DRAFT:95,"==MOODO_ARCHIVED==":94,"==MOODO_ALLMAIL==":93,TRASH:92,CATEGORY_PERSONAL:80,CATEGORY_SOCIAL:79,CATEGORY_PROMOTIONS:78,CATEGORY_UPDATES:77,CATEGORY_FORUMS:76},Pe={"==MOODO_ARCHIVED==":"Archived","==MOODO_ALLMAIL==":"All Mail"},Ne={CATEGORY_PERSONAL:!0,CATEGORY_SOCIAL:!0,CATEGORY_PROMOTIONS:!0,CATEGORY_UPDATES:!0,CATEGORY_FORUMS:!0},He={DRAFT:!0,CHAT:!0,SENT:!0,SPAM:!0,"==MOODO_ALLMAIL==":!0};Fe.prototype={_getDisplayPriority:function(){return Ie[this.getLabelID()]||-1},displayCompare:function(t){var e=this.isSystemOrSpecialLabel(),i=t.isSystemOrSpecialLabel();return e&&i?this._getDisplayPriority()<t._getDisplayPriority()?1:-1:e?-1:i?1:this.getName().localeCompare(t.getName())},isDropTarget:function(){return!He[this.getLabelID()]},_getStoreLabel:function(t){var e,i=t.toUpperCase();for(var r in this._labelStore){var a=this._labelStore[r].getRawName();if(a&&a.toUpperCase()===i){e=this._labelStore[r];break}}return e},_computeAncestors:function(){try{m.default.PAssert(1568,this._fullName||this.isSystemLabel()||this.isSpecialLabel(),"Must specify a valid fullName to run _computeAncestors")}catch(n){m.default.reportError(n)}if(this._ancestors=[],!this.isSystemLabel()&&!this.isSpecialLabel()&&this._fullName&&this._fullName.indexOf("/")>0){for(var t=0,e=this._fullName.split("/"),i="",r=0;r<e.length-1;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i+=e[r];var a=this._getStoreLabel(i);a&&a!==this&&this._ancestors.push(a),i+="/"}this._computeMinName()}try{m.default.PAssert(1569,this._ancestors.indexOf(this)<0,"Self should never be in the ancestors list")}catch(n){m.default.reportError(n)}},_computeMinName:function(){for(var t=0,e=this.getRawName(),i=0;i<this._ancestors.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._ancestors[i].getMinName()+"/",a=e.indexOf(r);e=e.substr(a+r.length)}this._minName=e},getAccountID:function(){return this._accountID},getLabelID:function(){return this._labelID},getRawName:function(){return this._fullName},getMinName:function(){return this._minName?this._minName:this._fullName},getMatchName:function(){return this._matchName},isMatched:function(t){try{m.default.PAssert(1570,m.default.isString(t),"Must pass in a valid string for label name")}catch(r){m.default.reportError(r)}var e=!1,i=this.getMatchName();return t&&i&&i.indexOf(t.toUpperCase())>=0&&(e=!0),e},isNamed:function(t){try{m.default.PAssert(1571,m.default.isString(t),"Must pass in a valid string for label name")}catch(r){m.default.reportError(r)}var e=!1,i=this.getMatchName();return t&&i&&i===t.toUpperCase()&&(e=!0),e},getName:function(t){var e;if(Ce[this.getLabelID()])e=Ce[this.getLabelID()];else if(Pe[this.getLabelID()])e=Pe[this.getLabelID()];else if(t&&this._minName)e=this.getMinName();else if(this._fullName)e=this._fullName;else{try{m.default.PAssert(1572,!this.isLocalOnly(),"Should not have a local-only label without a name")}catch(i){m.default.reportError(i)}e=this.getLabelID()}return e||""},hasName:function(){return Ce[this.getLabelID()]||Pe[this.getLabelID()]||!!this._fullName},clearOldestSync:function(){this._oldestSync=void 0},getOldestSync:function(){return this._oldestSync},setOldestSync:function(t){try{m.default.PAssert(1573,m.default.isDateValid(t),"Must provide a valid oldestSync date")}catch(e){m.default.reportError(e)}this._oldestSync=t},getMessageListVisibility:function(){return this._messageListVisibility},getLabelListVisibility:function(){return this._labelListVisibility},isLocalOnly:function(){return m.default.isTempId(this.getLabelID())},updateLabelID:function(t){try{m.default.PAssert(1575,this.isLocalOnly(),"Should only ever modify local labels")}catch(e){m.default.reportError(e)}this._origLabelID=this.getLabelID(),this._labelID=t},updateLabelName:function(t){this._fullName=t,this._matchName=t.toUpperCase(),this._computeAncestors()},getSaveData:function(){return{id:this.getLabelID(),name:this._fullName,oldestSync:this.getOldestSync(),messageListvisibility:this.getMessageListVisibility(),labelListVisibility:this.getLabelListVisibility(),isDeleted:this._isDeleted}},getDisplayText:function(t){var e;return this.getName()&&(e=this.getName().startsWith("Moo.do/")?this.getName().substr("Moo.do".length+1):this.getName(t)),e},getOutlineText:function(){var t=this.getDisplayText();return t?t.replace(/ /g,"_"):void 0},matchesText:function(t){return this.getDisplayText().toLowerCase().indexOf(t)>=0},hasAncestors:function(){return!!this._fullName&&this.getAncestors().length>0},getAncestors:function(){return this._computeAncestors(),this._ancestors},getParent:function(){var t=this.getAncestors();return t[t.length-1]},isSystemLabel:function(){return!!Ce[this.getLabelID()]},isSpecialLabel:function(){return!!Pe[this.getLabelID()]},isSystemOrSpecialLabel:function(){return this.isSystemLabel()||this.isSpecialLabel()},isCategoryLabel:function(){return!!Ne[this.getLabelID()]},isArchived:function(){return"Archived"===this.getName()},isStarred:function(){return"Starred"===this.getName()},isInbox:function(){return"Inbox"===this.getName()},isDraft:function(){return"Draft"===this.getName()},isTrash:function(){return"Trash"===this.getName()},isCustom:function(){return!this.isSystemLabel()&&!this.isSpecialLabel()},getUnreadCount:function(){return this._numUnread},shouldDisplayInLabelList:function(){var t=!1;return this._isDeleted||(this.getLabelListVisibility()===A.a.LabelListVisibility.Show?t=!0:this.getLabelListVisibility()===A.a.LabelListVisibility.ShowIfUnread&&this.getUnreadCount()>0&&(t=!0)),t},shouldDisplayInMessageList:function(){return this._messageListVisibility===A.a.MessageListVisibility.Show},delete:function(){try{m.default.PAssert(1576,!this.isSystemOrSpecialLabel(),"Should never delete a special or system label")}catch(t){m.default.reportError(t)}this._isDeleted=!0}};var Me=Fe,ze=i(69);function De(t){this._plugin=t,this._headers=[],this._mimeTree=void 0}var Ve=0;De.prototype={reset:function(){this._headers=[],this._mimeTree=void 0},getMessageText:function(t,e){return t.decoded},updateFromDraft:function(t,e,i,r,a,n){var o,u,s=this;if(this.reset(),this.addHeader("From",this._plugin._formatAddressText(i,r,!0)),this.addHeader("To",this._plugin._createAddressTextFromTokens(e.to,!0)),e.cc&&this.addHeader("Cc",this._plugin._createAddressTextFromTokens(e.cc,!0)),e.bcc&&this.addHeader("Bcc",this._plugin._createAddressTextFromTokens(e.bcc,!0)),this.addHeader("X-Mailer","Moo.do (https://moo.do)"),this.addHeader("Subject",m.default.encodeMIMEHeader(e.subject||"(no subject)")),e.inReplyTo){this.addHeader("In-Reply-To",e.inReplyTo.trim());var h=t.messages.indexOfWithProperty("messageID",e.inReplyTo);try{m.default.PAssert(1537,h>=0,"Must always be able to find the message being replied to")}catch(H){m.default.reportError(H)}o=t.messages[h]}e.references?u=e.references:o&&(u=(m.default.isTempId(o.messageID)?"":o.messageID)+(o.references?" "+o.references:"")),u&&this.addHeader("References",u.trim());var d,c=ze.a.generatePlaintext(this.getMessageText(e,a),{}),v=this._getAttachedResources(e);if(v.length>0&&(d=this.createMimePart("multipart/mixed"),this.addMimePart(d)),c){var y=this.createMimePart("multipart/alternative");this.addMimePart(y,d);var g=this.createMimePart("text/plain",c,"7bit");this.addMimePart(g,y);var l=this._getInlineResources(e);if(l.length>0){var p=0,f=this.createMimePart("multipart/related");this.addMimePart(f,y);var k=this.createMimePart("text/html",this.getMessageText(e,a),"7bit");this.addMimePart(k,f);for(var A=0;A<l.length;++A){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var S=l[A],w=this.createResourcePart(S);w&&this.addMimePart(w,f)}}else{var L=this.createMimePart("text/html",this.getMessageText(e,a),"7bit");this.addMimePart(L,y)}}else{var F=this.createMimePart(e.contentType||"text/html",this.getMessageText(e,a),"7bit");this.addMimePart(F,d)}if(d&&a)for(var C=0,I=0,P=function(){if(++I===v.length){for(var t=0,e=0;e<v.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=v[e],r=s.createResourcePart(i);r&&s.addMimePart(r,d)}n()}},N=0;N<v.length;++N){if(C++>5e3&&__infLoop&&__infLoop(C))throw new RangeError;this._plugin.loadResource(t.id,e.id,v[N].cid,P)}else setTimeout(n,0)},_getInlineResources:function(t){var e=[];return t.resources.forEachResource(function(t){"inline"===t.disposition&&e.push(t)}),e},_getAttachedResources:function(t){var e=[];return t.resources.forEachResource(function(t){"attachment"===t.disposition&&t.id&&e.push(t)}),e},addHeader:function(t,e){try{m.default.PAssert(1538,e.indexOf("\n")<0,"Header should not have a newline: "+t)}catch(r){m.default.reportError(r)}var i=e.trim().replace(/[\r\n]/g,"");this._headers.push(t+": "+i)},_generateBoundary:function(){return"=========3141592653589moodo"+Date.now()+ ++Ve},createMimePart:function(t,e,i,r){try{m.default.PAssert(1539,t,"Must supply a valid content type")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1540,void 0===e||i,"Must supply a valid content encoding")}catch(a){m.default.reportError(a)}return{boundary:this._generateBoundary(),contentType:t,content:e,contentEncoding:i,contentDisposition:r,children:[]}},createResourcePart:function(t){try{m.default.PAssert(1541,t&&t.data,"Must have valid data loaded for resource to embed it in message")}catch(a){m.default.reportError(a)}var e;if(t&&t.data){var i=t.mimeType+'; name="'+t.cid+'"',r=t.disposition+'; filename="'+t.cid+'"';(e=this.createMimePart(i,t.data,t.contentEncoding,r)).contentID=t.cid}return e},addMimePart:function(t,e){try{m.default.PAssert(1542,t,"Must supply a valid mime part")}catch(i){m.default.reportError(i)}if(e)e.children.push(t);else{try{m.default.PAssert(1543,!this._mimeTree,"Must not yet have a valid mime tree root")}catch(i){m.default.reportError(i)}this._mimeTree=t}},_mimePartToBlob:function(t){var e="\r\n",i=[];function r(t,e){if(e){try{m.default.PAssert(1544,e.indexOf("\n")<0,"Header should not have a newline: "+t)}catch(a){m.default.reportError(a)}var r=e.trim().replace(/[\r\n]/g,"");i.push(t+": "+r)}}var a=t.contentType;(t.content||(a+='; boundary="'+t.boundary+'"'),r("MIME-Version","1.0"),r("Content-Type",a),r("Content-Transfer-Encoding",t.contentEncoding),r("Content-Disposition",t.contentDisposition),t.contentID)&&r("Content-ID","<"+t.contentID+">");if(e=i.join("\r\n").trim(),e+="\r\n",t.content)e+="\r\n"+t.content+"\r\n";else if(t.children&&t.children.length>0){for(var n=0,o=0;o<t.children.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;e+="\r\n--"+t.boundary+"\r\n",e+=this._mimePartToBlob(t.children[o])}e+="--"+t.boundary+"--\r\n"}else e+="\r\n(no text)\r\n";return e},generateBlob:function(){var t=this._headers.join("\r\n").trim();return t+="\r\n"+this._mimePartToBlob(this._mimeTree)}};var Ge=De;function Te(){this._lib={}}Te.prototype={add:function(t){try{m.default.PAssert(447,1===arguments.length,"Only expect a single resource to be passed in, not a res,key pair")}catch(e){m.default.reportError(e)}try{m.default.PAssert(448,t.id,"Must specify a valid resource ID")}catch(e){m.default.reportError(e)}try{m.default.PAssert(449,!this._lib[t.id],"Should never have duped resources")}catch(e){m.default.reportError(e)}this._lib[t.id]=t},getByCID:function(t){var e;this._lib;return this.forEachResource(function(i){if(i.cid===t)return e=i,!1}),e},find:function(t){var e;if(this.has(t))e=this.getByCID(t);else{var i=t.split("@");e=this.getByCID(i[0])}return e},has:function(t){return!!this.getByCID(t)},remove:function(t){try{m.default.PAssert(450,this._lib[t.id],"Must only remove resouces that actually exist")}catch(e){m.default.reportError(e)}delete this._lib[t.id]},isEmpty:function(){return m.default.isEmpty(this._lib)},forEachResource:function(t){for(var e in this._lib)try{if(!1===t(this._lib[e]))break}catch(i){m.default.reportError(i)}},clone:function(){var t=new Te;for(var e in this._lib)t.add(m.default.clone(this._lib[e]));return t}};var qe=Te;if(P.a.isMobile)var je=i(44).default;var Ye=function(t){function e(t){var i;o()(this,e);var r={title:"Email",contextMenuMode:A.a.ContextMenuMode.Gmail,paneEmptyMessage:"No emails here",paneEmptySearchMessageDefault:"Press enter to search",paneEmptySearchMessage:"Press enter to search",titleContextMenuHeader:"Open label",dropEffect:function(){return A.a.DropEffect.Copy},isWriteable:!1,overrideCopyBehavior:!1,canAddItem:!1,supportCollapsing:!1,supportCompleting:!0,supportCheckbox:!0,supportOffline:!1,supportPerformArchive:!1,supportDataRefresh:!0,supportReportError:!0,supportCompose:!0,supportPagination:!0,supportVertLines:!1,supportSearchItemAutocomplete:!1,supportSearchListenTextChanges:!1,supportSearchFlat:!1,supportLocalSearch:!1,supportClone:!1,supportDeferredItemLoad:!0,supportCellTransition:!1,useLineCache:!1,shouldSearchMatchParents:!1,noOverviewStyle:!0,supportStarClick:!0,supportClickOverviewScroll:!1,shouldUpdateOnTextChanged:!1,overviewTracksScroll:!1,overviewHasPaneItems:!1,overviewPadLevels:-1,maxWidthFlex:A.a.ExpandedPaneWidth,maxWidth:A.a.ExpandedPaneWidth+200,maxWidthSingle:A.a.ExpandedPaneWidth,widthBiggerInSingle:!1,supportsDocuments:!1,_topBoxHeight:0,searchFilters:[{name:"unread",initialValue:1,icon:"icon-drafts",tooltip:"unread emails",remoteStringFn:function(t){var e;switch(t){case-1:e="-in:trash -is:unread";break;case 1:e="-in:trash is:unread";break;default:e=""}return e},matchFn:function(t,e){var r=i.plugin.isItemUnread(e);if(t)return r&&t>0||!r&&t<0?A.a.MatchState.Yes:A.a.MatchState.No}},{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred emails",remoteStringFn:function(t){var e;switch(t){case-1:e="-is:starred";break;case 1:e="is:starred";break;default:e=""}return e},matchFn:function(t,e){var r=i.plugin.isItemStarred(e);if(t)return r&&t>0||!r&&t<0?A.a.MatchState.Yes:A.a.MatchState.No}},{name:"priority",remoteStringFn:function(t){var e;switch(t){case A.a.VMLIFlag.P0:e="label:Moo.do/Priority High";break;case A.a.VMLIFlag.P1:e="label:Moo.do/Priority Medium";break;case A.a.VMLIFlag.P2:e="label:Moo.do/Priority Low";break;default:e=""}return e},matchFn:function(t,e){return i.plugin.getItemPriority(e)>=t?A.a.MatchState.Yes:A.a.MatchState.No}},{name:"category",remoteStringFn:function(t){return t?"category:"+t:""},matchFn:function(t,e){return t?i.plugin.itemHasLabel(e,t)?A.a.MatchState.Yes:A.a.MatchState.No:A.a.MatchState.Yes}}]};return t.plugin=An.pluginManager.getPlugin(A.a.PluginID.Gmail),(i=d()(this,v()(e).call(this,t,r))).type=i.plugin._paneType,i.paneClass="panePlugin paneGmail",i.isInitializing=!0,i._lines=[{text:"\u2000",start:0,length:1,width:0}],i.dragMarginTop=25,i.blocks=[],i.blocksByKey={},i._focusedTrash=!1,i.shouldCheckHeight=!0,i.maxScrollOffset=0,i.selectedIndex=new U.a(-1,i.onSelectedIndexChanged.bind(me()(me()(i)))),i._isSearchingRemote=new U.a(!1),i._overviewAccount=new U.a,i._currentSearch=void 0,i._ignoreRestoreScroll=!0,i._failedPageRequest=new U.a(!1),i.viewState=new U.a(t.viewState&&t.viewState.viewMode?t.viewState:{viewMode:A.a.GmailViewMode.Date}),i.item.listen(i._onItemChange.bind(me()(me()(i)))),i.viewState.listen(i._onViewStateChange.bind(me()(me()(i)))),V.a.binder(me()(me()(i)),"onScroll","_runRemoteSearch","searchCompare","onTopTextChanged","headerSearchCompare","onMultiselectReset","changeView","openViewMenu","onEmailComposeClosed","onEmailPreviewClosed"),i.initGmail(),i._firstSelectedItem=void 0,!P.a.isMobile&&t.isExpanded&&(An.EmailPreview.startOpenOnLoad(me()(me()(i))),i._firstSelectedItem=t.selectedItem),i.isInitializing=void 0,i}return p()(e,t),s()(e,[{key:"initGmail",value:function(){j.a.listen("reset",this.onMultiselectReset),this.search.isSearched()&&this.onSearchChanged(!0),this._onItemChange(this.getItem()),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0,this.paneTopText.listen(this.onTopTextChanged),k.a.listen("EmailCompose","onClosed",this.onEmailComposeClosed),k.a.listen("EmailPreview","onClosed",this.onEmailPreviewClosed)}},{key:"destroy",value:function(){clearTimeout(this._searchTimeout),this._searchTimeout=void 0,this.paneTopText.unlisten(this.onTopTextChanged),k.a.unlisten("EmailCompose","onClosed",this.onEmailComposeClosed),k.a.unlisten("EmailPreview","onClosed",this.onEmailPreviewClosed),j.a.unlisten("reset",this.onMultiselectReset),g()(v()(e.prototype),"destroy",this).call(this)}},{key:"onLoad",value:function(){g()(v()(e.prototype),"onLoad",this).call(this),this.addScrollListener(this.onScroll)}},{key:"notifyPluginLoaded",value:function(){var t=this.deferredItemState;if(t){var e=this.getItemStore().getItem(t.itemID);e&&this.setItem(e,!0)}}},{key:"getItemStore",value:function(){return this.plugin.getActiveItemStore(this.id)}},{key:"getRootItem",value:function(){var t=this.getItemStore();return t?t.getRoot():void 0}},{key:"getDefaultDisplayItem",value:function(t){return this.plugin.getDefaultDisplayItem(t)}},{key:"searchCompare",value:function(t){var e=!1;return this.plugin.isOnline()?(!this.isSearched()||!this.isLoading.get()&&this.paneTopText.get()||this.isRemoteSearchActive())&&this.plugin.isDisplayItem(t,this._focusedTrash)&&(e=!0):this.search.isMatched(t,!1)&&this.plugin.isDisplayItem(t,this._focusedTrash)&&(e=!0),e}},{key:"runItemSearch",value:function(t){try{m.default.PAssert(1545,t,"Must supply a valid param set for local item search")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1546,t.item,"Gmail pane always expects a valid item when running local item search")}catch(i){m.default.reportError(i)}return t.item.belongsToItemStore(this.plugin.getDefaultItemStore())?this.plugin.runLocalItemSearch(t):g()(v()(e.prototype),"runItemSearch",this).call(this,t)}},{key:"getItemSearchParams",value:function(){var t=this.plugin.getLabelForVMLI(this.getItem());return this._focusedTrash=t&&t.isTrash(),{item:this.getItem(),comparator:this.searchCompare,pane:this}}},{key:"setOverviewAccount",value:function(t){this._overviewAccount.set(t),this.updateHeaders(!0)}},{key:"headerSearchCompare",value:function(t){if(this.plugin.isLabelItem(t)){var e=this.plugin.getLabelForVMLI(t);return!e||e.shouldDisplayInLabelList()}return!!this.plugin.isAccountItem(t)}},{key:"getHeaderSearchParams",value:function(){return{item:this.plugin.getDefaultItemStore().getRoot(),comparator:this.headerSearchCompare,noCollapsed:!0,collapseAfterDepth:this.plugin.numSyncAccounts()>1?1:NaN,overview:!0,pane:this}}},{key:"saveSelection",value:function(){return j.a.getSelectedItems(this)}},{key:"restoreSelection",value:function(t){if(t.length>0){for(var e=0,i=[],r=0;r<t.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.indexOfItem(t[r]);a>=0&&i.push(a)}if(i.length>1)this.selectedIndex.set(i[0],!1),j.a.setSelected(i,this);else if(1===i.length)this.selectIndex(i[0]);else{var n=this.selectedIndex.get();n>=this.numItems()&&(n=this.numItems()-1),this.selectIndex(n,!0)}}}},{key:"_setItems",value:function(t,e){for(var i,r=0,a=this.saveSelection(),n=[],o={},u=this.getViewMode()===A.a.GmailViewMode.Date?this.plugin.threadSortFn:this.plugin.threadSortPriorityFn,s=0;s<t.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var h=t[s],d=this.plugin._getThreadIDFromItem(h);d&&!o[d]&&(n.insertSorted(h,u),this._firstSelectedItem&&h.id===this._firstSelectedItem&&(i=h),o[d]=!0)}if(this.updateOutline(n),this.restoreSelection(a),i&&t.length>0){var c=this.indexOfItem(i);c>=0&&(this.selectIndex(c),requestAnimationFrame(function(){this.setScrollOffset(this.getScrollTop(),A.a.ScrollDuration.Snap)}.bind(this))),this._firstSelectedItem=void 0}}},{key:"setHeaders",value:function(t,e){var i=0;if(!this._overviewAccount.get()){var r=this.plugin.getDescriptorForItem(this.getItem());this._overviewAccount.set(r.accountID)}this._allHeaders=t;for(var a=[],n={},o={},u=0;u<this._allHeaders.length;++u){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s,h=this._allHeaders[u];if(n[s=this.plugin._getAccountIDFromItem(h)]||(n[s]=[]),this.plugin.isAccountItem(h))o[s]=h;else{var d=n[s];this.plugin.isDisplayHeader(h)&&d.insertSorted(h,this.plugin.labelVMLISortFn)}}var c=n[this._overviewAccount.get()];if(c){var v=o[s];try{m.default.PAssert(1547,v,"Must have valid account item")}catch(p){m.default.reportError(p)}if(v){var y=0;for(u=0;u<c.length;++u){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;if(u>0){var g=this.plugin.getLabelForVMLI(c[u-1]),l=this.plugin.getLabelForVMLI(c[u]);(g.isSystemOrSpecialLabel()&&!l.isSystemOrSpecialLabel()||!g.isCategoryLabel()&&l.isCategoryLabel())&&a.push({type:"hr",id:"hr"+s+u,sizeInPane:this.heightOverviewHR})}a.push(c[u])}}}this.headers.set(a)}},{key:"heightOverviewHR",value:function(){return 4}},{key:"getTitleList",value:function(){if(this.getItem().isDescendantOf(this.getRootItem())){var t=this.plugin.getDescriptorForItem(this.getItem()),e=this.plugin.getVMLIForAccount(t.accountID);return e===this.getItem()?[this.getItem(),"Everything"]:this.plugin.numSyncAccounts()>1?[e,this.getItem()]:[this.getItem()]}return[this.getItem()]}},{key:"onClickTitle",value:function(t){this.plugin.isAccountItem(t)?t=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(t)):t===this.getRootItem()?t=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(this.getItem())):this.plugin.isLabelItem(t)||(t=this.plugin.getDefaultDisplayItem(this.plugin.getDefaultAccount())),g()(v()(e.prototype),"onClickTitle",this).call(this,t)}},{key:"onTopTextChanged",value:function(){this.topBoxHeight.set(this.paneTopText.get()?36:0)}},{key:"searchACName",value:function(){}},{key:"getPaneIcon",value:function(){return this.plugin.getPaneIcon()}},{key:"requestDataPage",value:function(t){this.isLoadingNewPage.set(!0),this.plugin.requestDataPage(t,this.onDataPagedIn.bind(this))}},{key:"dropEffectCopyBehavior",value:function(t,e){try{m.default.PAssert(1548,!t.belongsToSameItemStore(e),"Dropping onto a Gmail pane is not supported")}catch(i){m.default.reportError(i)}return this.plugin.createOutlinePaneItem(t,e)}},{key:"refreshPaneData",value:function(){this.plugin.refreshCurrentView()}},{key:"reportPaneError",value:function(){An.menus.openModal(A.a.Modals.ReportBug)}},{key:"_onItemChange",value:function(t){j.a.reset(this),this._clearCurrentSearch();var e=this.plugin.getLabelForVMLI(t);this._focusedTrash=e&&e.isTrash(),t.hasPaginationToken()||this.plugin.handleItemChange(t,function(){this.isLoading.set(!1)}.bind(this)),this.numItems()>0&&this.selectIndex(0)}},{key:"_onViewStateChange",value:function(){j.a.reset(this),this.plugin.handleViewModeChange(this.getItem(),this.getViewMode()),this.updateItemsImmediate(!0,void 0,void 0,!0),An.PaneManager.updatePaneStateForPane(this),this.setScrollOffset(0)}},{key:"getItemLabel",value:function(t){var e=t?this.getActualPaneItem():this.getItem();return this.plugin.getLabelForVMLI(e)}},{key:"onDataPagedIn",value:function(t){t?this._failedPageRequest.set(!1):this._failedPageRequest.set(!0),this.isLoadingNewPage.set(!1)}},{key:"onScroll",value:function(){if(!this.isLoadingNewPage.get()&&!this.isSearched()){var t=this._infiniteList.getMaxScrollOffset();this.getScrollOffset()>=t&&this.requestDataPage(this.getItem())}}},{key:"handleStatusClick",value:function(){}},{key:"_getLoadingMessage",value:function(){var t=this.plugin._getAccountIDFromItem(this.getItem());return kt.a.isAuthorizedForScopes(t,[A.a.GScope.GmailModify])?"Loading...":"Authorizing..."}},{key:"bottomListMessage",value:function(){var t;return this.getItem().hasPaginationToken()&&(t=this._failedPageRequest.get()?"RETRY LOAD":this.isLoadingNewPage.get()||this.getItem().paginationTokenInUse()?"Loading...":"Click to load more emails"),{text:t,clickable:!0}}},{key:"_onRemoteDataLoaded",value:function(){}},{key:"sizeOfItem",value:function(t,i,r){if("blockHeader"===t.type)return 40;if(r)return g()(v()(e.prototype),"sizeOfItem",this).call(this,t,i,r);var a=this.objectAtIndex(i);return r?An.DisplaySettings.lineItemHeight(a,t,this,1):A.a.EmailItemHeight}},{key:"onClickItem",value:function(t,e,i,r){m.default.vmMain.activeInput.get()&&m.default.vmMain.activeInput.get().blur();var a=!0;if(P.a.isMobile&&je.isInMultiselect()||(P.a.mac&&r.metaKey||!P.a.mac&&r.ctrlKey)&&j.a.getSelected(this).length>0)j.a.toggleSelected(t,this),a=!1;else if(r.shiftKey){var n=j.a.getFirstSelectedIndex(this),o=j.a.getLastSelectedIndex(this);t<n?n=t:t>o&&(o=t),j.a.selectInOrder(n,o,this),a=!1}else if(m.default.hasClass(r.target,"emailLabel")){var u=r.target.textContent,s=e.getAttachmentByPlugin(this.plugin.id).getField("accountID"),h=this.plugin._getLabelByName(s,u);try{m.default.PAssert(1549,h,"Must be able to get a valid label if clicking a valid label: ",u)}catch(c){m.default.reportError(c)}if(h){var d=this.plugin.getVMLIForLabel(s,h);this.zoomIn(d),a=!1}}else m.default.hasClass(r.target,"itemCheckbox")||this.selectIndex(t);a&&e.onClick(t,i,r)}},{key:"onRightClickItem",value:function(t,i,r){(j.a.numSelectedInPane(this)<=1||!j.a.isSelected(t,this))&&this.selectIndex(t),g()(v()(e.prototype),"onRightClickItem",this).call(this,t,i,r),r.preventDefault(),r.stopPropagation()}},{key:"handleLeftSideTap",value:function(t,e){var i=t.item;P.a.isMobile?An.pluginManager.handleTapClick(i,this,e):this.toggleStar(i)}},{key:"handleRightSideTap",value:function(t,e){if(t&&t.hasPluginAttachment(this.plugin.id))if(P.a.isMobile)An.pluginManager.handleTapClick(t,this,e);else{var i=this.getItemLabel(!0),r=!i.isArchived();this.archiveItem(r,t),i.isInbox()||i.isArchived()||this.removeItemFromCurrentLabel(t);var a=this.selectedIndex.get();a>=this.numItems()&&(a=this.numItems()-1),this.selectIndex(a,!0),m.default.vmMain.redoLastMouseMove()}}},{key:"onMultiselectReset",value:function(t){this===t&&this.selectedIndex.set(-1)}},{key:"selectIndex",value:function(t,e){var i=this.selectedIndex.get();this.selectedIndex.set(t,e),t>=0?j.a.setSelected([t],this):j.a.reset(this),(e||i!==t)&&this.selectedIndex.notify(),this.isLoading.get()||An.PaneManager.updatePaneStateForPane(this)}},{key:"selectItem",value:function(t,e){if(t){var i=this.indexOfItem(t);i>=0&&this.selectIndex(i,e)}else this.selectIndex(-1,e)}},{key:"onSelectedIndexChanged",value:function(t){if(An.EmailPreview.isOpenOnPane(this))if(t>=0){var e=this.itemAtIndex(t);this.openEmailByItem(e)}else t<0&&An.EmailPreview.reset()}},{key:"_runRemoteSearch",value:function(){if(An.PaneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var t=this.search.getRemoteValue(),e=this.plugin.getDescriptorForItem(this.item.get());if(e.labelID){var i=this.plugin._getLabelByID(e.accountID,e.labelID);i.isSpecialLabel()||i.isInbox()||!i.hasName()||(t+=" label:"+i.getName())}this._lastSearchValue=t,this._lastSearchTime=Date.now(),this.paneEmptySearchMessage="",this.paneTopText.set("Searching..."),this._isSearchingRemote.set(!0),this._clearCurrentSearch();var r="R~"+this.getActualPaneItem().id+"~"+m.default.generateTempId();m.default.log("Gmail Remote Search ItemID: ",r),this._currentSearch=this.plugin.runSearch(t,this.id,r,!0,function(t){if(!this._destroyed&&this._isSearchingRemote.get())switch(this.paneEmptySearchMessage=t===A.a.SearchResultStatus.Done?this.paneEmptySearchMessageDefault:"",this.isLoading.set(!1),t){case A.a.SearchResultStatus.Done:this.paneTopText.set(""),this.setScrollOffset(0);break;case A.a.SearchResultStatus.TooMany:this.paneTopText.set("Too many search results! Be more specific.");break;case A.a.SearchResultStatus.None:this.paneTopText.set("There were no search results");break;case A.a.SearchResultStatus.Error:this.paneTopText.set("There was an error running your search, try again.");break;default:try{m.default.PAssert(1550,!1,"Invalid search state: ",t)}catch(e){m.default.reportError(e)}}}.bind(this))}}},{key:"_clearCurrentSearch",value:function(){this._currentSearch&&(this._currentSearch.invalidate(),this._currentSearch=void 0)}},{key:"onSearchChanged",value:function(t){var e=this.search.getRemoteValue();if(e!==this._lastSearchValue||Date.now()-this._lastSearchTime>5e3)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,e){var i=t?0:2500;this._searchTimeout=setTimeout(this._runRemoteSearch,i)}else this._isSearchingRemote.set(!1),this.plugin.clearSearch(this.id),this._clearCurrentSearch(),this.isLoading.set(!1),this.paneTopText.set("")}},{key:"isSearchingRemote",value:function(){return this._isSearchingRemote.get()}},{key:"isRemoteSearchActive",value:function(){return this.plugin.isRemoteSearchBucketActive(this.id)}},{key:"onEmailComposeClosed",value:function(){var t=this.plugin,e=t.getDefaultAccount(),i=t._getLabelByID(e,Je.DRAFT),r=t.getVMLIForLabel(e,i);this.item.get()===r&&this.selectIndex(-1)}},{key:"onEmailPreviewClosed",value:function(){P.a.isMobile&&this.selectIndex(-1)}},{key:"applyToSelection",value:function(t){var e=this.saveSelection();j.a.applyFnToSelected(t,this),this.restoreSelection(e)}},{key:"_autocompletePopup",value:function(t,e,i){var r=this;if(!t.elementDisplay){var a=j.a.getFirstSelectedIndex(this),n=this.elementAtIndex(a);t.elementDisplay=n}var o=[];j.a.applyFnToSelected(function(t){o.push(t)},this),t.items=o,t.onSelected=function(a){r.plugin.beginAction(),t.item?e(t.item,a):j.a.applyFnToSelected(function(t){e(t,a)},r),i&&i(),r.plugin.endAction()},X.a.showPopup(t)}},{key:"getPaddingForPaneObject",value:function(t,i){return i?g()(v()(e.prototype),"getPaddingForPaneObject",this).call(this,t,i):24}},{key:"getWidth",value:function(){return this.rect.get().width}},{key:"getFirstSelectedItem",value:function(){return j.a.getFirstSelectedItem(this)}},{key:"getFirstSelectedIndex",value:function(){return j.a.getFirstSelectedIndex(this)}},{key:"moveItem",value:function(t,e,i){this.plugin.beginAction(),i||(t=t.clone(e,A.a.ChangeType.Local));var r=t.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1552,r,"Must be able to get a valid attachment")}catch(a){m.default.reportError(a)}this.plugin.performAction(A.a.PluginAction.Gmail.Move,!1,r,t,e),this.plugin.getSetting(this.plugin.Settings.ArchiveOnOrganize)&&this.plugin.performAction(A.a.PluginAction.Gmail.Archive,!1,r),this.plugin.attachmentHasLabel(r,"Moo.do/Handled")||this.plugin.performAction(A.a.PluginAction.Gmail.AddLabel,!1,r,"Moo.do/Handled"),this.plugin.endAction()}},{key:"autocompleteSchedule",value:function(t,i){var r=this,a=this.selectedIndex.get();g()(v()(e.prototype),"autocompleteSchedule",this).call(this,t,function(){a>=r.numItems()&&(a=r.numItems()-1),r.selectIndex(a,!0),i&&i()})}},{key:"autocompleteSnooze",value:function(t,i,r){var a=this,n=this.selectedIndex.get();g()(v()(e.prototype),"autocompleteSnooze",this).call(this,t,i,function(){n>=a.numItems()&&(n=a.numItems()-1),a.selectIndex(n,!0),r&&r()})}},{key:"autocompleteMove",value:function(t,i){var r=this;t=t||{};var a=this.selectedIndex.get();t.positionOffset={left:40},g()(v()(e.prototype),"autocompleteMove",this).call(this,t,function(){a>=r.numItems()&&(a=r.numItems()-1),r.selectIndex(a,!0),i&&i()})}},{key:"autocompleteCreateTask",value:function(){var t=this,e=this.selectedIndex.get();if(!isNaN(e)){var i=this.elementAtIndex(e),r=j.a.getSelectedItems(this);An.menus.openItemEditor({element:i,pane:this,selectIndex:0,addOnSave:!0,side:"bottom",children:r,positionOffset:{left:10},options:[{text:"Archive email",vlue:An.pluginManager.getSetting(A.a.PluginID.Gmail,A.a.PluginSettingsID.Gmail.ArchiveOnOrganize),cb:function(){for(var e=0,i=0;i<r.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=r[i].getAttachmentByPlugin(t.plugin.id);t.plugin.performAction(A.a.PluginAction.Gmail.Archive,!1,a)}}}],beginSave:function(){var e=0;An.PaneUpdateBatcher.beginUpdateItems(),t.plugin.beginAction();for(var i=0;i<r.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=r[i].getAttachmentByPlugin(t.plugin.id);t.plugin.attachmentHasLabel(a,"Moo.do/Handled")||t.plugin.performAction(A.a.PluginAction.Gmail.AddLabel,!1,a,"Moo.do/Handled")}},endSave:function(e){t.plugin.endAction(),An.PaneUpdateBatcher.commitUpdateItems()}})}}},{key:"toggleStarSelected",value:function(){g()(v()(e.prototype),"toggleStarSelected",this).call(this),this.updateItems()}},{key:"toggleStar",value:function(t){var e=t.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1553,e,"Must be able to get a valid attachment")}catch(r){m.default.reportError(r)}var i=e.getPlugin();i.isItemStarred(t)?i.performAction(A.a.PluginAction.Gmail.Unstar,!1,e):i.performAction(A.a.PluginAction.Gmail.Star,!1,e),this.updateItems()}},{key:"_openSelectedInMode",value:function(t){var e=j.a.getFirstSelectedIndex(this);this.selectIndex(e);var i=this.itemAtIndex(e);this.openEmailByItem(i,t)}},{key:"replySelected",value:function(){this._openSelectedInMode(A.a.EmailResponseMode.Reply)}},{key:"replyAllSelected",value:function(){this._openSelectedInMode(A.a.EmailResponseMode.ReplyAll)}},{key:"forwardSelected",value:function(){this._openSelectedInMode(A.a.EmailResponseMode.Forward)}},{key:"archiveSelected",value:function(t){this.plugin.beginAction(),this.applyToSelection(this.archiveItem.bind(this,t)),this.plugin.endAction()}},{key:"archiveItem",value:function(t,e){var i=e.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1554,i,"Must be able to get a valid attachment")}catch(r){m.default.reportError(r)}!t&&this.plugin.isItemArchived(e)?this.plugin.performAction(A.a.PluginAction.Gmail.Unarchive,!1,i):t&&!this.plugin.isItemArchived(e)&&this.plugin.performAction(A.a.PluginAction.Gmail.Archive,!1,i)}},{key:"deleteSelected",value:function(t,e){this.plugin.beginAction(),this.applyToSelection(this._deleteItem.bind(this,e)),this.plugin.endAction()}},{key:"_deleteItem",value:function(t,e){var i=e.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1555,i,"Must be able to get a valid attachment")}catch(a){m.default.reportError(a)}var r=this.plugin.getLabelForVMLI(this.getItem());t&&r&&r.isDraft()&&this.plugin.itemHasDraft(e)?this.plugin.performAction(A.a.PluginAction.Gmail.DiscardDraft,!0,i):!t&&this.plugin.isItemFullTrashed(e)?this.plugin.performAction(A.a.PluginAction.Gmail.Untrash,!1,i):t&&!this.plugin.isItemFullTrashed(e)&&this.plugin.performAction(A.a.PluginAction.Gmail.Trash,!1,i)}},{key:"applyPriorityToSelection",value:function(t,e){var i=t,r=!0;this.plugin.beginAction(),this.applyToSelection(function(a){var n=a.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1556,n,"Must be able to get a valid attachment")}catch(o){m.default.reportError(o)}e&&r&&(this.plugin.getAttachmentPriority(n)===t&&(i=A.a.VMLIFlag.None),r=!1),this.plugin.performAction(A.a.PluginAction.Gmail.SetPriority,!1,n,i),this.updateItems()}.bind(this)),this.plugin.endAction()}},{key:"handleUndo",value:function(){this.plugin.handleUndo()}},{key:"handleRedo",value:function(){this.plugin.handleRedo()}},{key:"keyMoveDown",value:function(t){var e;-1===this.selectedIndex.get()?this.selectIndex(0):t&&t.shiftKey?(j.a.isInverted(this)&&1===j.a.numSelectedInPane(this)&&j.a.setInverted(!1,this),j.a.isInverted(this)?(e=j.a.getFirstSelectedIndex(this),j.a.removeSelected(e,this)):(e=this.indexOfNextVMLI(j.a.getLastSelectedIndex(this)))>=0&&e<this.numItems()&&(j.a.addSelected(e,this),this.scrollIndexIntoView(e,A.a.ScrollDuration.Default))):(e=this.indexOfNextVMLI(j.a.getLastSelectedIndex(this)))>=0&&e<this.numItems()&&(this.selectIndex(e),this.scrollIndexIntoView(e,A.a.ScrollDuration.Default))}},{key:"keyMoveUp",value:function(t){var e;-1===this.selectedIndex.get()?this.selectIndex(0):t&&t.shiftKey?(j.a.isInverted(this)||1!==j.a.numSelectedInPane(this)||j.a.setInverted(!0,this),j.a.isInverted(this)?(e=this.indexOfPrevVMLI(j.a.getFirstSelectedIndex(this)))>=0&&(j.a.addSelected(e,this),this.scrollIndexIntoView(e,A.a.ScrollDuration.Default)):(e=j.a.getLastSelectedIndex(this),j.a.removeSelected(e,this))):(e=this.indexOfPrevVMLI(j.a.getFirstSelectedIndex(this)))>=0&&(this.selectIndex(e),this.scrollIndexIntoView(e,A.a.ScrollDuration.Default))}},{key:"onHotkey",value:function(t,e,i){if(this.selectedIndex.get()>=0&&!An.menus.isContextMenuOpen()&&"Email"===t){var r=this.itemAtIndex(this.selectedIndex.get()),a=!0;if(r){if("Up"===e)this.keyMoveUp(i);else if("Down"===e)this.keyMoveDown(i);else if("Open"===e)An.EmailPreview.isOpenOnPane(this)||this.openEmailByItem(r);else if("Archive"===e){i.shiftKey&&An.EmailPreview.isOpenOnPane(this)&&An.EmailPreview.close();var n=!this.getItemLabel(!0).isArchived();this.archiveSelected(n)}else if("Delete"===e)this.deleteSelected(this.plugin.isGmailItem,!0);else if("Schedule"===e)this.autocompleteSchedule();else if("Snooze"===e)this.autocompleteSnooze();else if("Move"===e)this.autocompleteMove();else if("Task"===e)this.autocompleteCreateTask();else if("Label"===e)this.autocompleteLabel({item:r});else if("MarkRead"===e)this.markReadSelected(!0);else if("MarkUnread"===e)this.markReadSelected(!1);else if("Star"===e)this.toggleStarSelected();else if("Reply"===e)this.replySelected();else if("ReplyAll"===e)this.replyAllSelected();else if("Forward"===e)this.forwardSelected();else if("Priority1"===e)this.applyPriorityToSelection(A.a.VMLIFlag.P0,!0);else if("Priority2"===e)this.applyPriorityToSelection(A.a.VMLIFlag.P1,!0);else if("Priority3"===e)this.applyPriorityToSelection(A.a.VMLIFlag.P2,!0);else if("RemoveFromLabel"===e)this.search.isSearched()||(this.plugin.beginAction(),this.applyToSelection(this.removeItemFromCurrentLabel.bind(this)),this.plugin.endAction());else if("Undo"===e)this.handleUndo();else if("Print"===e){if(1===j.a.numSelectedInPane(this)){var o=j.a.getFirstSelectedItem(this),u=this.plugin.createPrintURLForThread(o.getAttachmentByPlugin(this.plugin.id));m.default.printPage(u)}}else if("OpenInGmail"===e){if(1===j.a.numSelectedInPane(this)){var s=j.a.getFirstSelectedItem(this),h=this.plugin.createURLForThread(s.getAttachmentByPlugin(this.plugin.id));m.default.openUrl(h)}}else a=!1;a&&m.default.preventDefault(i)}}}},{key:"removeItemFromCurrentLabel",value:function(t){var e=this.getItemLabel(!0);try{m.default.PAssert(1557,e,"Must be able to find a valid label for pane")}catch(r){m.default.reportError(r)}var i=t.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1558,i,"Must be able to get a valid attachment")}catch(r){m.default.reportError(r)}e&&(e.isCustom()?this.plugin.performAction(A.a.PluginAction.Gmail.RemoveLabel,!1,i,e.getName()):e.isInbox()?this.plugin.performAction(A.a.PluginAction.Gmail.Archive,!1,i):e.isArchived()?this.plugin.performAction(A.a.PluginAction.Gmail.Unarchive,!1,i):e.isStarred()&&this.plugin.performAction(A.a.PluginAction.Gmail.Unstar,!1,i))}},{key:"canAcceptDragOver",value:function(t,e,i,r){if(t&&this.type===t.type&&(r||t&&this!==t)){var a,n=t.getItemLabel();if(r){var o=m.default.getElementParent(i);a=o&&m.default.getItemForElement(o)}else a=this.getItem();if(a&&this.plugin.isLabelItem(a)&&this.plugin.areItemsFromSameAccount(e,a)){var u=this.plugin.getLabelForVMLI(a);if(u!==n&&u.isDropTarget())return!0}}return!1}},{key:"_handleDragOverPane",value:function(t,e,i,r,a,n,o){return{targetElement:i,targetItem:this.getItem()}}},{key:"_handleDragDrop",value:function(t,e,i,r,a){if(i){var n,o=e.pane,u=o.getItemLabel(),s=i.targetItem,h=this.plugin.getLabelForVMLI(s);if(t.hasPluginAttachment(this.plugin.id)&&this.plugin.areItemsFromSameAccount(t,s)){n=t.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1559,n,"Must be able to get a valid attachment")}catch(d){m.default.reportError(d)}this.plugin.beginAction(),this.plugin.performAction(A.a.PluginAction.Gmail.RemoveLabel,!1,n,u.getName()),this.plugin.attachmentHasLabel(n,h.getName())||this.plugin.performAction(A.a.PluginAction.Gmail.AddLabel,!1,n,h.getName()),o.notifyDropFrom(t,this),this.plugin.endAction()}}}},{key:"notifyDropFrom",value:function(t,e){if(this.selectIndex(-1),e.type===A.a.PaneMode.Task){var i=t.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1560,i,"Must be able to get a valid attachment")}catch(a){m.default.reportError(a)}this.plugin.attachmentHasLabel(i,"Moo.do/Handled")||(this.plugin.beginAction(),this.plugin.getSetting(this.plugin.Settings.ArchiveOnOrganize)&&this.plugin.performAction(A.a.PluginAction.Gmail.RemoveLabel,!1,i,"Inbox"),this.plugin.performAction(A.a.PluginAction.Gmail.AddLabel,!1,i,"Moo.do/Handled"),this.plugin.endAction());var r=this.plugin.getAttachmentPriority(i);r!==A.a.VMLIFlag.None&&t.setPriority(r,A.a.ChangeType.Local),this.plugin.attachmentHasLabelByID(i,"STARRED")&&t.setStarred(!0,A.a.ChangeType.Local)}}},{key:"maxWidthOfPaneObject",value:function(){return P.a.isMobile?this.getWidth()-36:this.getWidth()-56}},{key:"allowZoom",value:function(t){var e=!1;return this.plugin.isLabelItem(t)&&(e=!0),e}},{key:"performOverviewAction",value:function(t){if(this.plugin.isAccountItem(t)){t.setCollapsed(!t.isCollapsed(this,!0),this,!0);var e=t=this.plugin.getDefaultDisplayItem(this.plugin._getAccountIDFromItem(t));this.zoomIn(e),m.default.sendEvent("Menu","OverviewZoom_Gmail")}}},{key:"setItem",value:function(t,i){return this.isLoading.set(!0),this.selectIndex(-1),g()(v()(e.prototype),"setItem",this).call(this,t,i)}},{key:"isItemHeader",value:function(t,e){if(!e)return t.isHeader();for(var i=0,r=this.plugin,a=t.getItems(),n=0;n<a.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(r.isLabelItem(a[n])||r.isAccountItem(a[n]))return!0}}},{key:"getActualPaneItem",value:function(){return this.plugin._defaultZoomItems[this.id]||this.item.get()}},{key:"canResetMultiselect",value:function(){return!An.EmailPreview.isOpenOnPane(this)||0===this.numItems()}},{key:"setExpanded",value:function(t,i){g()(v()(e.prototype),"setExpanded",this).call(this,t,i),t||this===m.default.focusedPane||j.a.reset(this)}},{key:"applyDropOnBlock",value:function(t,e){var i=t,r=e.getAttachmentByPlugin(this.plugin.id);try{m.default.PAssert(1561,r,"Must be able to get a valid attachment")}catch(u){m.default.reportError(u)}if(i.isDate){var a,n=i.dateTime||i.date;a=m.default.isString(n)?An.International.parseDate(n,A.a.DateFormat.MDY):n;try{m.default.PAssert(1562,m.default.isDateValid(a),"Must provide a valid date when scheduling an email",i.dateTime,i.date)}catch(u){m.default.reportError(u)}m.default.isDateValid(a)&&this.plugin.scheduleEmail(e,a)}else{var o;i.isStarred?this.plugin.performAction(A.a.PluginAction.Gmail.Star,!1,r):i.p0||i.isImportant?o=A.a.VMLIFlag.P0:i.p1?o=A.a.VMLIFlag.P1:i.p2&&(o=A.a.VMLIFlag.P2),o&&this.plugin.performAction(A.a.PluginAction.Gmail.SetPriority,!1,r,o)}}},{key:"getSaveInfo",value:function(){var t=g()(v()(e.prototype),"getSaveInfo",this).call(this);if(t.viewState=this.viewState.get(),!P.a.isMobile){var i=j.a.getFirstSelectedItem(this);t.selectedItem=i?i.id:void 0}return t}},{key:"setIgnoreRestoreScroll",value:function(){}},{key:"getSwipeMenuItems",value:function(){var t=this;return{leftOuter:{text:"Add to Outline",icon:"icon-align-left",clor:"#09d",fn:function(e){t.autocompleteMove({item:e,position:"autocomplete"})}},leftInner:{text:"Snooze",icon:"icon-access_time",clor:"#2a6",fn:function(e){t.autocompleteSnooze({item:e,position:"autocomplete"})}},rightInner:{text:"Archive",icon:"icon-check",clor:"#0c0",fn:function(e){var i=t.getItemLabel(!0),r=!i.isArchived();t.archiveItem(r,e),i.isInbox()||i.isArchived()||t.removeItemFromCurrentLabel(e)}},rightOuter:{text:"Delete",icon:"icon-delete",clor:"#a30",fn:function(e){t._deleteItem(!0,e)}}}}},{key:"onTapAddItem",value:function(t){An.menus.openComposeEmail(m.default.vmMain.getDefaultEmailPlugin())}},{key:"isOverviewVisibleInPane",value:function(){return!0}},{key:"getMinItemSize",value:function(){return A.a.EmailItemHeight}},{key:"widthOfDrag",value:function(t){return this.getWidth()}},{key:"getStyledLinesForPaneObject",value:function(t,i){if(i)return g()(v()(e.prototype),"getStyledLinesForPaneObject",this).call(this,t,i);var r=t.item;return r.els||m.default.vmMain.runSingleParse(r,A.a.ChangeType.Auto),J.a.generateStyledLines(r.els,this._lines,this)}},{key:"viewModeIcon",value:function(){return"Date"===this.getViewMode()?"icon-access_time":"icon-exclamation"}},{key:"viewModeColor",value:function(){return"#2a6"}},{key:"openViewMenu",value:function(t){An.menus.openContextMenu({componentName:"ReactContextMenuGmailSort",element:t.target,pane:this,onSelected:this.changeView})}},{key:"changeView",value:function(t){this.viewMode.set(t),this.updateItems(!1,!0)}},{key:"getViewMode",value:function(){return this.viewState.get().viewMode}},{key:"setViewMode",value:function(t){var e=this.viewState.get();e.viewMode!==t&&(e.viewMode=t,this.viewState.set(e,!this.isFakePane))}},{key:"becomeReal",value:function(){this.getItem()&&this.setItem(this.getItem(),!0)}},{key:"setDocument",value:function(){}}]),e}($t.a),Xe=5e3;function Qe(t,e,i){try{m.default.PAssert(1510,m.default.isFunction(t),"Must provide a valid entry callback")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1511,m.default.isFunction(e),"Must provide a valid done callback")}catch(r){m.default.reportError(r)}this._entryCB=t,this._doneCB=e,this._delay=i||Xe,this._flushTimeout=void 0,this._entries=[],V.a.binder(this,"_onEntry","_onDone","_flushEntries","_flushEntriesWatchdog")}Qe.prototype={getEntryCB:function(){return this._onEntry},getDoneCB:function(){return this._onDone},_onEntry:function(t){t&&this._entries.push(t),this._flushTimeout||(this._flushTimeout=setTimeout(this._flushEntriesWatchdog,this._delay))},_onDone:function(t,e){An.PaneUpdateBatcher.beginUpdateItems(),this._flushEntries();try{this._doneCB(t,e)}catch(i){m.default.reportError(i)}An.PaneUpdateBatcher.commitUpdateItems()},_flushEntriesWatchdog:function(){0},_flushEntries:function(){var t=0;this._flushTimeout&&(clearTimeout(this._flushTimeout),this._flushTimeout=void 0),An.PaneUpdateBatcher.beginUpdateItems();for(var e=0;e<this._entries.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;try{this._entryCB(this._entries[e])}catch(i){m.default.reportError(i)}}this._entries=[],An.PaneUpdateBatcher.commitUpdateItems()}};var Je,Ze=Qe,Be=i(119),$e={EnsureLabelVMLI:"EnsureLabelVMLI",CreateLabelVMLI:"CreateLabelVMLI",MergeThread:"MergeThread",SyncdMessage:"SyncdMessage",ErrorSyncdMessage:"ErrorSyncdMessage",UnsyncdMessage:"UnsyncdMessage",OldUnsyncdMessage:"OldUnsyncdMessage",MessagesSyncd:"MessagesSyncd",MessageDataCached:"MessageDataCached"},Ue={Snooze:"snoozemail",SendMail:"sendmail"},Re=1,Ee=2,Ke=3,xe=4,be=5,Oe=6,We=7,_e=8,ti=9,ei=10,ii=11,ri=12,ai=13,ni=14,oi=15,ui=16,si=17,hi=18,di=19,ci=20,vi="historyIDs",yi="labels",gi="sendAs";!function(t){t.INBOX="INBOX",t.SPAM="SPAM",t.TRASH="TRASH",t.UNREAD="UNREAD",t.STARRED="STARRED",t.IMPORTANT="IMPORTANT",t.SENT="SENT",t.DRAFT="DRAFT",t.CHAT="CHAT",t.CATEGORY_PERSONAL="CATEGORY_PERSONAL",t.CATEGORY_SOCIAL="CATEGORY_SOCIAL",t.CATEGORY_PROMOTIONS="CATEGORY_PROMOTIONS",t.CATEGORY_UPDATES="CATEGORY_UPDATES",t.CATEGORY_FORUMS="CATEGORY_FORUMS"}(Je||(Je={}));var li,pi,mi,fi={INBOX:"Inbox",SPAM:"Spam",TRASH:"Trash",UNREAD:"Unread",STARRED:"Starred",IMPORTANT:"Important",SENT:"Sent Mail",DRAFT:"Draft",CHAT:"Chat",CATEGORY_PERSONAL:"Primary",CATEGORY_SOCIAL:"Social",CATEGORY_PROMOTIONS:"Promotions",CATEGORY_UPDATES:"Updates",CATEGORY_FORUMS:"Forums"},ki="==MOODO_ARCHIVED==",Ai="==MOODO_ALLMAIL==",Si={PRI0:"Moo.do/Priority High",PRI1:"Moo.do/Priority Medium",PRI2:"Moo.do/Priority Low"},wi=["id","labelIds","messageID","draftID","decoded","mimeType","contentType","from","replyTo","to","cc","bcc","snippet","subject","date","internalDate","references","inReplyTo","listUnsubscribe","resources","cached","cachedError"],Li="multipart/signed",Fi="multipart/related",Ci="message/partial",Ii="multipart/mixed",Pi="multipart/report",Ni="multipart/parallel",Hi="multipart/alternative",Mi="multipart/digest",zi="multipart/encrypted",Di="multipart/voice-message",Vi="text/calendar",Gi="text/plain",Ti="text/html",qi="text/watch-html",ji="text/x-watch-html",Yi="inline",Xi="attachment",Qi=["application","audio","example","image","message","model","video","text"],Ji=[Hi,Ii,Gi,Ti,Pi],Zi=[Gi,Ti],Bi=[Vi,Di,zi,Ii],$i=["modifiedOffline","pendingSend","isDeleted","dataLoaded"],Ui=/(?:[\"]?([^\"]*)[\"]?\s)?<(.*)>/g,Ri=/\'(.*)\'/g,Ei=function(t){function e(){var t;return o()(this,e),(t=d()(this,v()(e).call(this,A.a.PluginID.Gmail,"g","Email",!1)))._lastSyncTime=void 0,t._requiresOfflineAuth=!0,V.a.binder(me()(me()(t)),"threadSortFn","threadSortPriorityFn","labelSortFn","labelVMLISortFn","sortFn","_fromComparator","_toComparator","_dateComparator","_messagesComparator","_shallowObjComparator","isGmailItem","_flushPendingDraftUpdates","driveMessageContentSync","_cleanupLocalCaches","_handleDeferredSnoozeTask","_cancelDeferredSnoozeTask","_persistRemoteSnoozeTask","_handleDeferredSendMailTask","_cancelDeferredSendMailTask","_persistRemoteSendMailTask"),t._emailCache={},t._labelsByID={},t._labelsByName={},t._priorityLabels={},t._creatingDrafts={},t._pendingDraftUpdates={},t._pendingThreadLoads={},t._loadThreadMutex=0,t._activeDraftUpdates=0,t._accountSettings={},t._pendingSends={},t._draftCache={},t._unsyncdMessages={},t._pendingSyncdMessages={},t._numUnsyncdMessages=0,t._numSyncdMessages=0,t._outstandingContentSync=!1,t._undoStack=new Le(10),t._generateUndoRedo(),t._syncingOfflineChanges=!1,t._draftFlushTimer=void 0,t.registerSetting("WriteAccess","writeAccess","w",!0),t.registerSetting("SyncTime","syncTime","t",!0,A.a.MaxGmailSyncTime.Free),t.registerSetting("SyncAccounts","syncAccounts","s",!0,["me"]),t.registerSetting("ArchiveOnSchedule","archiveOnSchedule","a",!0,!1),t.registerSetting("ArchiveOnOrganize","archiveOnOrganize","o",!0,!1),t.registerSetting("InsertSignatureAboveReplies","insertSignatureAboveReplies","i",!0,!1),t.addTrackedStat($e.EnsureLabelVMLI),t.addTrackedStat($e.CreateLabelVMLI),t.addTrackedStat($e.MergeThread),t.addTrackedStat($e.SyncdMessage),t.addTrackedStat($e.ErrorSyncdMessage),t.addTrackedStat($e.UnsyncdMessage),t.addTrackedStat($e.OldUnsyncdMessage),t.addTrackedStat($e.MessagesSyncd),t.addTrackedStat($e.MessageDataCached),t._threadCache=t.registerLocalCache("GmailThreadCache",A.a.StorageType.IndexedDB,!0,{noInMemoryCache:!0}),t._rawCache=t.registerLocalCache("RawCache",A.a.StorageType.IndexedDB,!1,{noInMemoryCache:!0}),t.registerDeferredTaskType(Ue.Snooze,t._handleDeferredSnoozeTask,t._cancelDeferredSnoozeTask,t._persistRemoteSnoozeTask),t.registerDeferredTaskType(Ue.SendMail,t._handleDeferredSendMailTask,t._cancelDeferredSendMailTask,t._persistRemoteSendMailTask),t._contentSyncTask=t.registerLowImpactTask("ContentSync",t.driveMessageContentSync),t._cacheCleanup=t.registerLowImpactTask("CacheCleanup",t._cleanupLocalCaches),t._lastCacheCleanup=0,m.default.isDemoMode()?t.declareProperty("accountID",A.a.PluginLoad.Preview|A.a.PluginLoad.Full|A.a.PluginLoad.Inline,!0,"me"):t.declareProperty("accountID",A.a.PluginLoad.Preview|A.a.PluginLoad.Full|A.a.PluginLoad.Inline),t.declareProperty("from",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!1,void 0,t._fromComparator),t.declareProperty("to",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!1,void 0,t._toComparator),t.declareProperty("subject",A.a.PluginLoad.Preview|A.a.PluginLoad.Full),t.declareProperty("date",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!0,new Date(0),t._dateComparator),t.declareProperty("lastModifiedDate",A.a.PluginLoad.Full,!0,void 0,t._dateComparator),t.declareProperty("modifiedOffline",A.a.PluginLoad.Full,!0,!1),t.declareProperty("pendingSend",A.a.PluginLoad.Full,!0,!1),t.declareProperty("messages",A.a.PluginLoad.Full,!0,[],t._messagesComparator),t.declareProperty("snippet",A.a.PluginLoad.Full),t.declareProperty("participants",A.a.PluginLoad.Runtime,!0,[]),t.declareProperty("subjectLower",A.a.PluginLoad.Runtime),t.declareProperty("count",A.a.PluginLoad.Runtime),t.declareProperty("dataLoaded",A.a.PluginLoad.Runtime,!0,!1),t.declareProperty("isDeleted",A.a.PluginLoad.Runtime,!0,!1),t.declareProperty("labelIds",A.a.PluginLoad.Runtime,!0,[]),t.declareProperty("hasAttachments",A.a.PluginLoad.Full,!0,!1),t.useRenderer(A.a.PluginRenderTypes.StyledText,A.a.PluginRenderers.EmailThread),t.useRenderer(A.a.PluginRenderTypes.UnstyledText,A.a.PluginRenderers.EmailThread),t.useRenderer(A.a.PluginRenderTypes.Measure,A.a.PluginRenderers.EmailThread),t}return p()(e,t),s()(e,[{key:"getType",value:function(){return A.a.PluginType.Email}},{key:"_attachMetadataFields",value:function(){return $i}},{key:"getDataPane",value:function(){try{m.default.PAssert(864,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(t){m.default.reportError(t)}return Ye}},{key:"getPaneIcon",value:function(){return"icon-mail_outline"}},{key:"getPanePriority",value:function(){return 97}},{key:"useItemStore",value:function(){return"Gmail"}},{key:"itemStoreOptions",value:function(){return{requireStoredEls:!1,enabledFilters:A.a.ItemStoreFilter.Priority,parserFn:J.a.runParseSinglePlugin}}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"ensureAccountEmail",value:function(t){return"me"===t?this.getDefaultAccount():t}},{key:"getDefaultAccount",value:function(){var t,e=An.settings.getUserIdentifier();if(e){try{m.default.PAssert(865,m.default.isDemoMode()||"me"!==e,'Should never return "me" as a valid user')}catch(i){m.default.reportError(i)}t=e}else{try{m.default.PAssert(866,!1,'Unable to get default account name, returning "me"')}catch(i){m.default.reportError(i)}t="me"}return t}},{key:"isSameAccount",value:function(t,e){return"me"===t&&(t=this.getDefaultAccount()),"me"===e&&(e=this.getDefaultAccount()),t===e}},{key:"areItemsFromSameAccount",value:function(t,e){var i=this._getAccountIDFromItem(t),r=this._getAccountIDFromItem(e);return this.isSameAccount(i,r)}},{key:"_handleAccountChanges",value:function(){var t=this,e=0,i=[];An.PaneManager.runForEachPane(function(e){var r=t._getAccountIDFromItem(e.getItem());try{m.default.PAssert(867,r,"Missing Account ID: ",e.id,e.getItem().id)}catch(a){m.default.reportError(a)}t.hasSyncAccount(r)||i.push(e)},this.getPaneType());for(var r=0;r<i.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;An.PaneManager.removePane(i[r])}0===i.length&&An.PaneManager.notifyPanes()}},{key:"addSyncAccount",value:function(t,e){var i=this,r=this.getSetting(this.Settings.SyncAccounts).slice(0);try{m.default.PAssert(868,r.indexOf(t)<0,"Must not double add sync accounts to list")}catch(a){m.default.reportError(a)}r.indexOf(t)<0&&r.push(t),this.setSetting(this.Settings.SyncAccounts,r),this.isActive()&&(this._ensureLabel(t,Je.INBOX,"Inbox",void 0,void 0,A.a.ChangeType.Local),this._ensureLabel(t,Je.UNREAD,"Unread",void 0,void 0,A.a.ChangeType.Local),this._ensureLabel(t,ki,"Archived",void 0,void 0,A.a.ChangeType.Local),this._ensureLabel(t,Ai,"All Mail",void 0,void 0,A.a.ChangeType.Local),this._forceLabelSync(function(){i._forceThreadSync()})),e&&e(!0),this._handleAccountChanges()}},{key:"removeSyncAccount",value:function(t,e){var i=(this.getSetting(this.Settings.SyncAccounts)||[]).slice(0);try{m.default.PAssert(869,i.indexOf(t)>=0,"Must be able to find sync account if removing")}catch(a){m.default.reportError(a)}if(i.remove(t),this.setSetting(this.Settings.SyncAccounts,i),this._clearCachedData(t,e),this.getDefaultItemStore()){var r=this.getVMLIForAccount(t);r&&(r.deleteSelf(A.a.ChangeType.Local),r.getItemStore().destroyItem(r.id))}this._handleAccountChanges()}},{key:"_iterateSendAs",value:function(t){for(var e=0,i=this.getSyncAccounts(),r=!1,a=0;!r&&a<i.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this.getAccountSetting(i[a],"sendAs");if(n)for(var o=0,u=0;u<n.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var s=n[u];if(t(i[a],s)){r=!0;break}}else t(i[a])}}},{key:"getSignature",value:function(t){var e;return this._iterateSendAs(function(i,r){if(r&&r.sendAsEmail===t)return e=r.signature,!0}),e}},{key:"getReplyToAddress",value:function(t){var e;return this._iterateSendAs(function(i,r){if(r&&r.sendAsEmail===t&&r.replyToAddress)return e=r.replyToAddress,!0}),e}},{key:"_computeDisplayName",value:function(t,e){var i;return!e.displayName&&e.isPrimary||(i=e.displayName),i}},{key:"getDisplayName",value:function(t){var e,i=this;return this._iterateSendAs(function(r,a){if(a&&a.sendAsEmail===t)return e=i._computeDisplayName(r,a),!0}),e}},{key:"getDefaultSendingAccount",value:function(t){var e;return this._iterateSendAs(function(i,r){if(i===t&&r&&r.isDefault)return e=r.sendAsEmail,!0}),e||(e=t),e}},{key:"getDefaultFromInfo",value:function(t){var e=this.getDefaultSendingAccount(t);try{m.default.PAssert(870,e,"Must have found a valid account to send from")}catch(i){m.default.reportError(i)}return{text:this.getDisplayName(e),email:e}}},{key:"getSendingAccounts",value:function(t){var e=[];return this._iterateSendAs(function(i,r){t&&t!==i||(r?"pending"!==r.verificationStatus&&e.push(r.sendAsEmail):e.push(i))}),e}},{key:"getSyncAccount",value:function(t){var e;return this._iterateSendAs(function(i,r){if(r){if(r.sendAsEmail===t)return e=i,!0}else if(t===i)return e=i,!0}),e}},{key:"getSendingAccountInfo",value:function(t){var e,i=this;return this._iterateSendAs(function(r,a){if(a){if(a.sendAsEmail===t)return e={text:i._computeDisplayName(r,a),email:t},!0}else if(t===r)return!0}),e}},{key:"getSyncAccounts",value:function(){for(var t=0,e=this.getSetting(this.Settings.SyncAccounts)||["me"],i=[],r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=e[r].toLowerCase();"me"===a?i.push(this.getDefaultAccount()):i.push(a)}try{m.default.PAssert(871,m.default.isDemoMode()||i.indexOf("me")<0,'Must not contain "me" as an account')}catch(n){m.default.reportError(n)}return m.default.arrayUniques(i)}},{key:"numSyncAccounts",value:function(){return this.getSyncAccounts().length}},{key:"hasSyncAccount",value:function(t){return this.getSyncAccounts().indexOf(t)>=0}},{key:"_getSettingsSendAs",value:function(t){for(var e=0,i=this,r=this.getSyncAccounts(),a=r.length,n=0,o={},u=function(e,i,r){e&&(o[i]=r.sendAs),++n===a&&t(o)},s=function(){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var t=r[h];kt.a.getAccountAuthToken(t,i.googleScopes(),function(e){e&&i._requestSettings(t,u)})},h=0;h<r.length;++h)s()}},{key:"_requestSettings",value:function(t,e){var i=this,r=Pt.a.fns("gmail").users.settings.sendAs.list.packedFn,a={userId:t};this._queueRemoteRequestMulti(t,r,a,function(i){e(!0,t,i)},function(r){e(!1,t,r),i._notifyFailedRequest(t,r)},void 0,ci)}},{key:"_fromComparator",value:function(t,e){var i=!1;if(t||e){if(t&&e){try{m.default.PAssert(872,!m.default.isString(t),"Old from must not be a string")}catch(r){m.default.reportError(r)}try{m.default.PAssert(873,!m.default.isString(e),"New from must not be a string")}catch(r){m.default.reportError(r)}t.text===e.text&&t.email===e.email&&(i=!0)}}else i=!0;return i}},{key:"_toComparator",value:function(t,e){var i=!1;if(t||e){if(t&&e){try{m.default.PAssert(874,m.default.isArray(t),"Old to must be an array")}catch(r){m.default.reportError(r)}try{m.default.PAssert(875,m.default.isArray(e),"New to must be an array")}catch(r){m.default.reportError(r)}i=e.equals(t)}}else i=!0;return i}},{key:"_dateComparator",value:function(t,e){var i=!1;if(t||e){if(t&&e){m.default.isString(t)&&(t=this.parseDateHeader(t)),m.default.isString(e)&&(e=this.parseDateHeader(e));try{m.default.PAssert(876,m.default.isDateValid(t),"Must be an old valid date to compare")}catch(r){m.default.reportError(r)}try{m.default.PAssert(877,m.default.isDateValid(e),"Must be a new valid date to compare")}catch(r){m.default.reportError(r)}m.default.isDateValid(t)&&m.default.isDateValid(e)&&(i=t.equals(e))}}else i=!0;return i}},{key:"_messagesComparator",value:function(t,e){var i=!0;if(t&&e)if(t.length===e.length)for(var r=0,a=0;i&&a<e.length;++a){var n=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var o=t[a],u=e[a],s=0;s<wi.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var h=wi[s],d=!0;switch(h){case"from":d=this._fromComparator(o[h],u[h]);break;case"to":d=this._toComparator(o[h],u[h]);break;case"resources":case"listUnsubscribe":d=this._shallowObjComparator(o[h],u[h]);break;case"labelIds":d=u[h].equals(o[h]);break;case"date":case"internalDate":d=this._dateComparator(o[h],u[h]);break;default:d=o[h]===u[h]}d||(i=!1)}0}else i=!1;else i=!1;return i}},{key:"_shallowObjComparator",value:function(t,e){var i=!1;if(t||e){if(t&&e)if(t===e)i=!0;else for(var r in i=!0,t)if(!e.hasOwnProperty(r)){i=!1;break}}else i=!0;return i}},{key:"_offlineLoad",value:function(){var t=this;return Rt.a.onActiveUser(function(){t._threadCache.onCacheReady(function(){m.default.isDemoMode()||t._threadCache.getMetadata(gi,function(e){if(e)for(var i in e)e.hasOwnProperty(i)&&t.setAccountSetting(i,"sendAs",e[i])}),t._threadCache.getMetadata(yi,function(e){m.default.batchRenderUpdates(function(){var i=0,r=t.getSyncAccounts();!m.default.isDemoMode()&&e||(e={}),e.me&&!e[t.getDefaultAccount()]&&(e[t.getDefaultAccount()]=e.me),An.PaneUpdateBatcher.beginUpdateItems();for(var a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=r[a];t._ensureLabel(n,Je.INBOX,"Inbox",void 0,void 0,A.a.ChangeType.Local),t._ensureLabel(n,Je.UNREAD,"Unread",void 0,void 0,A.a.ChangeType.Local),t._ensureLabel(n,ki,"Archived",void 0,void 0,A.a.ChangeType.Local),t._ensureLabel(n,Ai,"All Mail",void 0,void 0,A.a.ChangeType.Local);var o=e[n];if(o){for(var u in o)if(o.hasOwnProperty(u)){var s=o[u];if(!Je[s.id]){var h=s.name||"LocalLabel"+Date.now();t._ensureLabel(n,u,h,s.oldestSync,s,A.a.ChangeType.Local)}}for(var d in Je)if(Je.hasOwnProperty(d)){var c=fi[d];t._ensureLabel(n,d,c,void 0,void 0,A.a.ChangeType.Local)}}t._ensureLabelVMLIsForAccount(n)}var v=t._getMetadataSyncTime(),y=t._getUnreadSyncTime(),g=function(t){return r.indexOf(t.accountID)>=0&&t.date.isAfter(y)},l=function(e,i,r){if(e&&e.length>0){var a=function(){var r=0;An.PaneUpdateBatcher.beginUpdateItems();for(var a=0;a<e.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=e[a];try{m.default.PAssert(878,n,"Must always contain a valid entry when retreiving data from preload")}catch(u){m.default.reportError(u)}if(n&&(!i||g(n))){var o=t.createEntryFromLocal(n.id,n);(t.isPriorityData(o)||n.date.isAfter(v))&&(t.cacheData(o.id,o),t._updateSpecialLabels(o))}}An.PaneUpdateBatcher.commitUpdateItems()};r?a():m.default.batchRenderUpdates(a)}};t._threadCache.requestPreloadData(function(e){m.default.isArray(e)?l(e,!0,!0):t._threadCache.getFilterEntries(g,l)}),An.PaneUpdateBatcher.commitUpdateItems(),t.notifyPanesReadyForLoad()})})})}),!0}},{key:"isPriorityData",value:function(t){var e=!1;return t.labelIds.indexOf(Je.UNREAD)>=0?e=!0:t.labelIds.indexOf(Si.PRI0)>=0?e=!0:t.labelIds.indexOf(Si.PRI1)>=0?e=!0:t.labelIds.indexOf(Si.PRI2)>=0&&(e=!0),e}},{key:"_load",value:function(){m.default.isDemoMode()||this.createRecurringTask("GmailThreadSync",{delay:m.default.minutes(15),minDelay:m.default.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:m.default.minutes(2),task:this.runThreadSync.bind(this)}),this.runSettingsSync(),this.createRecurringTask("GmailLabelSync",{delay:m.default.minutes(30),minDelay:m.default.minutes(15),runOnCreate:!0,pauseWhileIdle:!0,async:!0,task:this.runLabelSync.bind(this)})}},{key:"_notifyFailedRequest",value:function(t,e){try{m.default.PAssert(879,m.default.isString(t),"Must supply a valid accountID string")}catch(s){m.default.reportError(s)}if(e&&e.error)if(e.error.code===A.a.HTTPStatusCode.Unauthorized)An.pluginManager.verifyAuthorization(t);else if(e.error.code===A.a.HTTPStatusCode.BadRequest)for(var i=0,r=e.error.errors,a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r[a].reason===A.a.GoogleError.FailedPrecondition&&(An.toasts.pushMessage(A.a.MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}else if(e.error.code===A.a.HTTPStatusCode.Forbidden)for(var n=0,o=e.error.errors,u=0;u<o.length;++u){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;o[u].reason===A.a.GoogleError.InsufficientPermissions&&(An.toasts.pushMessage(A.a.MessageID.GmailDisabled),this.setSetting(this.Settings.IsEnabled,!1))}else e.error.code>=400&&e.error.code<500&&this._reportErrorCode(e.error.code)&&m.default.reportError(new Error("Failed Gmail request: "+e.error.code),e)}},{key:"_reportErrorCode",value:function(t){var e=!1;return t!==A.a.HTTPStatusCode.NotFound&&(e=!0),e}},{key:"_notifySendFailed",value:function(){An.toasts.pushMessage(A.a.MessageID.EmailSendFail)}},{key:"_createResourceCID",value:function(t,e){var i=0;e||(e="UnnamedFile");for(var r=e,a=1;t.has(r);){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=e.split(".");r=n[0]+"_"+a,n[1]&&(r+="."+n[1]),a++}return r}},{key:"_createResource",value:function(t,e){try{m.default.PAssert(880,t,"Must have valid resources lib to add to")}catch(i){m.default.reportError(i)}return{cid:this._createResourceCID(t,e.name),id:m.default.generateTempId(),attID:void 0,realAttrID:void 0,data:void 0,size:void 0,thumbnail:void 0,uploader:void 0,link:void 0,error:!1,disposition:Xi,parentType:Ii,mimeType:e.type,contentEncoding:void 0}}},{key:"_getLinkedResourceString",value:function(t){return'<a cid="'+t.cid+'" style="background-color:#f3f3f3;border:1px solid #dddddd;padding:8px;width:396px;font-weight:bold;min-height:18px;display:block;border-radius:3px;margin-bottom:8px;" href="'+t.link+'"><img style="vertical-align:top;border:none;margin-right:8px;" src="https://ssl.gstatic.com/docs/doclist/images/icon_10_generic_list.png">'+t.cid+"</a>"}},{key:"_removeAttachContent",value:function(t,e,i){var r,a=ze.a.removeElementsByAttribute(e.decoded,"cid",i.cid);return r=a!==e.decoded,e.decoded=a,r}},{key:"notifyAttachLinkedFile",value:function(t,e,i,r){var a={name:i.getField("title"),type:i.getField("mimeType")},n=this._createResource(e.resources,a);n.size=i.getField("fileSize"),n.link=i.getField("alternateLink"),this._shareAttachment(t,i.id,n,r),e.resources.add(n),t.notifyDataMutated(["hasAttachments"],A.a.ChangeType.Local)}},{key:"notifyAttachFiles",value:function(t,e,i,r){for(var a=0,n=this,o=t.getField("accountID"),u=0;u<i.length;++u){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=i[u],h=this._createResource(e.resources,s);h.size=s.size,h.uploader=new Be.a(s,o,A.a.DriveFolder.Attach,void 0,function(){t.notifyDataMutated(["hasAttachments"],A.a.ChangeType.Local)},function(e,i){e.error=!1,e.link=i.alternateLink,e.thumbnail=i.thumbnailLink,n._shareAttachment(t,i.id,e,r)}.bind(this,h),function(e){e.error=!0,An.toasts.pushMessage({text:"There was an error uploading your attachment.",actionText:"RETRY",action:function(){e.uploader.resume()}}),t.notifyDataMutated(["hasAttachments"],A.a.ChangeType.Local),r&&r(!1)}.bind(this,h)),h.uploader.upload(),e.resources.add(h)}t.notifyDataMutated(["messages"],A.a.ChangeType.Local)}},{key:"_shareAttachment",value:function(t,e,i,r){var a=this;try{m.default.PAssert(881,e,"Must supply a valid fileID to share")}catch(n){m.default.reportError(n)}try{m.default.PAssert(882,i,"Must supply a valid resource object to share")}catch(n){m.default.reportError(n)}m.default.vmMain.remoteAPI().drivePermissionsPublic(e,function(){i.error=!1,t.notifyDataMutated(["messages"],A.a.ChangeType.Local),r&&r(!0)},function(n){i.error=!0,m.default.isHTTPStatusCode(n,A.a.HTTPStatusCode.Forbidden)?An.toasts.pushMessage({text:"Sharing files/attachments in Google Drive is disabled on your domain. Please contact your domain administrator.",actionText:"OKAY",hold:!0}):An.toasts.pushMessage({text:"There was an error sharing your attachment.",actionText:"RETRY",action:function(){a._shareAttachment(t,e,i,r)}}),t.notifyDataMutated(["hasAttachments"],A.a.ChangeType.Local),r&&r(!1)})}},{key:"removeAttachFiles",value:function(t,e,i){try{m.default.PAssert(883,i,"Must always specify a valid resource to remove from the message")}catch(a){m.default.reportError(a)}var r=!1;return i.uploader&&!i.uploader.isDone()&&(i.uploader.cancel(),r=!0),e.resources.has(i.cid)&&e.resources.remove(i),r=this._removeAttachContent(t,e,i)||r,t.notifyDataMutated(["messages"],A.a.ChangeType.Local),r}},{key:"notifyItemPropertyChanged",value:function(t,e,i,r){var a=this.attachmentIsArchived(t);e.belongsToItemStore(this.getDefaultItemStore())&&(e.dateCompleted&&!a&&this.archiveAttachment(t));"priority"===r?this.getAttachmentPriority(t)!==e.getPriority()&&this.setAttachmentPriority(t,e.getPriority()):"isArchived"===r&&(a&&!e.isArchived()?this.unarchiveAttachment(t):!a&&e.isArchived()&&(this.archiveAttachment(t),An.EmailPreview.isOpenOnThread(t)&&An.EmailPreview.reset()))}},{key:"createLabelString",value:function(t){if(!fi[t.toUpperCase()])return t}},{key:"isDisplayTag",value:function(t,e){var i=!1;if(t&&t.shouldDisplayInMessageList()){var r=t.isCustom()||t.getLabelID()===Je.DRAFT,a=e&&!e.isInbox()&&t.isInbox();if(r||a)switch(i=!0,t.getName()){case Si.PRI0:case Si.PRI1:case Si.PRI2:case"Moo.do/Handled":case fi.STARRED:i=!1}}return i}},{key:"isDisplayHeader",value:function(t){var e=!1;this.isLabelItem(t)&&(this._getLabelIDFromItem(t)!==Je.UNREAD&&(e=!0));return e}},{key:"isMessageDraft",value:function(t){return t&&t.labelIds&&t.labelIds.indexOf(Je.DRAFT)>=0}},{key:"getDisplayTags",value:function(t,e,i){var r,a=0,n=t.getField("labelIds"),o=t.getField("accountID"),u=[];e&&(r=e.getItemLabel(!0));for(var s=0;s<n.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var h=this._getLabelByID(o,n[s]);if(this.isDisplayTag(h,r)){var d=i?h.getOutlineText():h.getDisplayText();d&&u.push(d)}}return u}},{key:"_getParticipantDisplayName",value:function(t,e){var i;if(this.isMyAccountID(t.email))i="me";else if(t.text)if(1===e)i=t.text;else{var r=t.text.split(" ");i=r&&r.length>0?r[0]:t.email}else i=t.email;return i}},{key:"getDisplayParticipants",value:function(t){for(var e=0,i=t.getField("participants"),r=[],a=0;a<i.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;r.push(this._getParticipantDisplayName(i[a],i.length))}return r.join(", ")}},{key:"getDefaultDisplayItem",value:function(t){t=t||this.getDefaultAccount();var e=this._getLabelByID(t,Je.INBOX);return this.getVMLIForLabel(t,e)}},{key:"getEmailRootItem",value:function(){return b.getItems(A.a.FavoriteGroup.EmailRoot)[0]}},{key:"hasEmailRootItem",value:function(){return b.hasItems(A.a.FavoriteGroup.EmailRoot)}},{key:"createEmailRootItem",value:function(){try{m.default.PAssert(884,!this.hasEmailRootItem(),"Should not create email root if it already exists")}catch(i){m.default.reportError(i)}var t=An.itemStoreManager.getDefaultItemStore().getRoot(),e=G.a.createVMLI({text:"Email",favorites:[A.a.FavoriteGroup.EmailRoot]},{parent:t,changeType:A.a.ChangeType.AllLocal});return t.insertItem(e,0),An.toasts.pushMessage({text:'A new "Email" item was created at the top of your document for snoozed emails.',action:A.a.MessageAction.Okay,hold:!0}),e}},{key:"ensureEmailItem",value:function(t){var e=0;Y.e.beginAction(),this.hasEmailRootItem()||this.createEmailRootItem();for(var i,r=this.getEmailRootItem(),a=r.getItems(),n=0;n<a.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(a[n].getRawText()===t){i=a[n];break}}return i||(i=G.a.createVMLI({text:t},{parent:r,changeType:A.a.ChangeType.AllLocal}),r.insertItem(i,0)),Y.e.endAction(),i}},{key:"getWaitingItem",value:function(t){t(this.ensureEmailItem("Waiting"))}},{key:"allowTextEditing",value:function(t){var e=!0,i=this.getDefaultItemStore();return t.belongsToItemStore(i)&&(e=!1),e}},{key:"getDraftForMessage",value:function(t,e,i,r){try{m.default.PAssert(885,e,"Must have a valid thread ID")}catch(s){m.default.reportError(s)}try{m.default.PAssert(886,i,"Must have a valid message ID")}catch(s){m.default.reportError(s)}var a,n=this.getAttachment(e),o=n.getField("messages").indexOfWithProperty("id",i);try{m.default.PAssert(887,o>=0,"Must be able to find the requested message")}catch(s){m.default.reportError(s)}var u=n.getField("messages")[o+1];u&&u.labelIds.indexOf(Je.DRAFT)>=0?a=u:(this.createDraft(t,e,i,{from:r}),a=n.getField("messages")[o+1]);try{m.default.PAssert(888,a.labelIds.indexOf(Je.DRAFT)>=0,"Must return a valid draft")}catch(s){m.default.reportError(s)}return a}},{key:"getDraftByID",value:function(t,e,i,r){var a,n;if(e){a=this.getAttachment(e),n=i?this._getMessageFromAttachment(a,i):a.getField("messages")[0];try{m.default.PAssert(889,n.labelIds.indexOf(Je.DRAFT)>=0,"Must be a valid draft")}catch(u){m.default.reportError(u)}}else{var o=this.createDraft(t,void 0,void 0,r);n=(a=this.getAttachment(o.threadID)).getField("messages")[0]}return{attach:a,draftMsg:n}}},{key:"_notifyDraftMessage",value:function(t,e,i){var r=this;try{m.default.PAssert(890,t,"Must supply a valid accountID")}catch(a){m.default.reportError(a)}try{m.default.PAssert(891,e&&!m.default.isTempId(e),"Must supply a valid threadID: ",e)}catch(a){m.default.reportError(a)}try{m.default.PAssert(892,i&&!m.default.isTempId(i),"Must supply a valid messageID: ",i)}catch(a){m.default.reportError(a)}setTimeout(function(){r.hasCacheData(e)&&r._getRemoteDraftID(t,e,i,function(t,i){i&&(m.default.log("DraftID: ",t),r.cacheData(e,r.getCacheData(e),!0,["messages"]))})},0)}},{key:"_notifyLocalDraftDelete",value:function(t,e,i){}},{key:"_getInlineResources",value:function(t){var e=new qe;return t.resources.forEachResource(function(t){t.disposition===Yi&&e.add(m.default.clone(t))}),e}},{key:"createDraft",value:function(t,e,i,r){r=r||{};try{m.default.PAssert(893,!r.body||!r.decoded,"Must not supply both a decoded field and a body")}catch(y){m.default.reportError(y)}this.sendEvent("CreateDraft");var a=m.default.generateTempId(),n=r.from||this.getDefaultFromInfo(t),o=r.body||r.decoded||"";""===o&&(o=this.createSignature(n.email));var u,s,h={id:a,modifiedOffline:!0,labelIds:[Je.DRAFT],messageID:void 0,raw:"",decoded:o,mimeType:Ti,contentType:"text/html;charset=utf-8",from:n,replyTo:this.getReplyToAddress(n.email),to:r.to||[],cc:r.cc||[],bcc:r.bcc||[],snippet:"",subject:r.subject||"",date:new Date,references:void 0,inReplyTo:void 0,resources:new qe};if(e){u=this.getCacheData(e);try{m.default.PAssert(894,i,"When supplying a thread ID, must also supply a valid message ID")}catch(y){m.default.reportError(y)}var d=u.messages.indexOfWithProperty("id",i);try{m.default.PAssert(895,d>=0,"If requesting a reply to a message, it must exist in the thread")}catch(y){m.default.reportError(y)}var c=u.messages[d];if(c&&(h.references=(m.default.isTempId(c.messageID)?"":c.messageID)+(c.references?" "+c.references:""),m.default.isTempId(c.messageID)||(h.inReplyTo=c.messageID),h.resources=this._getInlineResources(c)),u.messages.splice(d+1,0,h),this.hasAttachment(e)){var v=this.getAttachment(e);this._updateAttachmentFromMessages(v,A.a.ChangeType.Local),v.notifyDataMutated(["messages"],A.a.ChangeType.Local)}this.addModifiedOffline(u,["messages"]),s=u}else u={id:a,accountID:t,modifiedOffline:!0,messages:[h],labelIds:[Je.DRAFT],subject:r.subject||"",from:t},s=this.createEntryFromLocal(a,u),this.cacheData(s.id,s);return this.cacheThreadData(s.id,this.serializeExternalData(s)),{threadID:s.id,draftID:a,messageID:i}}},{key:"_updateDraftID",value:function(t,e,i){try{m.default.PAssert(896,i,"Must provide a valid set of draft info")}catch(n){m.default.reportError(n)}try{m.default.PAssert(897,i.id&&i.message,"Draft info must contain valid data")}catch(n){m.default.reportError(n)}var r=t.isLocalOnlyAttachment();r&&(this._handleThreadLabelUpdates(t.getData(),void 0,t.getData().labelIds),this.changeID(t,t.id,i.message.threadId),this._threadCache.removeEntry(e));var a=this._findDraft(t,e,i.id);if(a){a.id=i.message.id;try{m.default.PAssert(898,a.draftID===i.id,"Should have valid draft ID associated with the message")}catch(n){m.default.reportError(n)}this._draftCache[a.id]=i.id,r&&this.cacheData(t.id,t.getData()),this._pendingDraftUpdates[e]&&(this._pendingDraftUpdates[a.id]=this._pendingDraftUpdates[e],delete this._pendingDraftUpdates[e]),this._pendingSends[e]&&(this._pendingSends[a.id]=this._pendingSends[e],delete this._pendingSends[e]),t.notifyDataMutated(["messages"],A.a.ChangeType.Local),this.cacheThreadData(t.id,this.serializeExternalData(t.getData()))}}},{key:"_updateDraftFromSend",value:function(t,e,i){try{m.default.PAssert(899,i,"Must provide a valid set of draft info")}catch(a){m.default.reportError(a)}try{m.default.PAssert(900,i.id&&i.threadId,"Draft info must contain valid data")}catch(a){m.default.reportError(a)}if(t.isLocalOnlyAttachment()){this._handleThreadLabelUpdates(t.getData(),void 0,t.getData().labelIds),this.changeID(t,t.id,i.threadId);try{m.default.PAssert(901,!m.default.isTempId(t.id),"After an ID change, should never be a temp ID")}catch(a){m.default.reportError(a)}this._threadCache.removeEntry(e)}var r=this._getMessageFromAttachment(t,e);r.id=i.id,r.labelIds=i.labelIds||[],this._updateAttachmentFromMessages(t,A.a.ChangeType.Remote),this._draftCache[r.id]=i.id,this._pendingDraftUpdates[e]&&(this._pendingDraftUpdates[r.id]=this._pendingDraftUpdates[e],delete this._pendingDraftUpdates[e]),this._pendingSends[e]&&(this._pendingSends[r.id]=this._pendingSends[e],delete this._pendingSends[e]),t.notifyDataMutated(["messages"],A.a.ChangeType.Local),this.cacheThreadData(t.id,this.serializeExternalData(t.getData()))}},{key:"_createRemoteDraft",value:function(t,e,i){var r=this;if(this._creatingDrafts[e])i(!1,{msg:"Already creating remote draft for given message"});else{this._creatingDrafts[e]=!0;var a=this._getMessageFromAttachment(t,e);if(a)this._createRFC822Message(t.getData(),a,!1,function(n){var o={raw:n};t.isLocalOnlyAttachment()||(o.threadId=t.id);var u=Pt.a.fns("gmail").users.drafts.create.packedFn,s={userId:t.getField("accountID"),resource:{message:o}};r._queueRemoteRequestMulti(t.getField("accountID"),u,s,function(n){r._attachmentHasMessage(t,e)&&(delete r._creatingDrafts[e],a.draftID=n.id,r.removeModifiedOffline(t.getData(),!1),r.removeModifiedOffline(a,!1),r._pendingDraftUpdates[e]&&r._notifyPendingDraftUpdate(),r._updateDraftID(t,e,n),r._updateIsSavingDrafts()),i(!0)},function(a){delete r._creatingDrafts[e],r._updateIsSavingDrafts(),i(!1,a),r._notifyFailedRequest(t.getField("accountID"),a)},void 0,ai)});else{try{var n={length:t.getField("messages").length};m.default.reportError(new Error("Unable to find valid draft for creation"),n)}catch(o){m.default.reportError(o)}i(!1,{msg:"Unable to find requested message in thread"})}}}},{key:"_updateIsSavingDrafts",value:function(){m.default.isSavingDrafts=this._activeDraftUpdates>0||!m.default.isEmpty(this._pendingDraftUpdates)||!m.default.isEmpty(this._creatingDrafts)}},{key:"_notifyPendingDraftUpdate",value:function(t,e,i,r){t&&e&&(this._pendingDraftUpdates[e]={attach:t,draftID:i,lastUpdate:Date.now()},r&&this._runDraftUpdate(e)),this._draftFlushTimer&&clearTimeout(this._draftFlushTimer),this._draftFlushTimer=setTimeout(this._flushPendingDraftUpdates,12e3),this._updateIsSavingDrafts()}},{key:"_flushPendingDraftUpdates",value:function(){if(this.isOnline()){for(var t in this._pendingDraftUpdates)this._pendingDraftUpdates.hasOwnProperty(t)&&this._runDraftUpdate(t);this._draftFlushTimer=void 0}}},{key:"_runDraftUpdate",value:function(t){var e=this;if(!this._creatingDrafts[t]){var i=this._pendingDraftUpdates[t];try{m.default.PAssert(902,i,"Must be able to find valid draft info for pending draft update")}catch(r){m.default.reportError(r)}this._updateRemoteDraft(i.attach,t,i.draftID,!1,function(t,i){t?An.toasts.clearMessage(A.a.MessageID.EmailUpdateFail):m.default.isHTTPStatusCode(i,A.a.HTTPStatusCode.NotFound)?An.toasts.clearMessage(A.a.MessageID.EmailUpdateFail):An.toasts.pushMessage(A.a.MessageID.EmailUpdateFail),e._updateIsSavingDrafts()}),delete this._pendingDraftUpdates[t],this.sendEvent("UpdateDraft")}}},{key:"_clearPendingDraftUpdate",value:function(t,e){var i=this._pendingDraftUpdates[e];if(i){try{m.default.PAssert(903,i.attach===t,"Must have the correct attachment for the draft update")}catch(r){m.default.reportError(r)}delete this._pendingDraftUpdates[e]}}},{key:"hasPendingSends",value:function(){return this._pendingSends.length>0}},{key:"notifyPendingSend",value:function(t,e){try{m.default.PAssert(904,!this._pendingSends[e],"Must not have an already pending send for a message")}catch(i){m.default.reportError(i)}this._pendingSends[e]=t,m.default.isSendingEmail=!0}},{key:"notifySent",value:function(t,e){try{m.default.PAssert(905,this._pendingSends[e],"Must have a pending send to be sent")}catch(i){m.default.reportError(i)}delete this._pendingSends[e],this.hasPendingSends()||(m.default.isSendingEmail=!1)}},{key:"notifySendError",value:function(t,e){try{m.default.PAssert(906,this._pendingSends[e],"Must have a pending send to have an error")}catch(i){m.default.reportError(i)}delete this._pendingSends[e],this.hasPendingSends()||(m.default.isSendingEmail=!1)}},{key:"onShutdown",value:function(){clearTimeout(this._draftFlushTimer),this._draftFlushTimer=void 0,this._flushPendingDraftUpdates(),this._updateIsSavingDrafts()}},{key:"_getLinkedResources",value:function(t){var e=[];return t.forEachResource(function(t){"attachment"===t.disposition&&t.link&&e.push(t)}),e}},{key:"_createDraftBody",value:function(t,e){var i;if(e){var r=this._getLinkedResources(e);if(r.length>0){for(var a=0,n="<br/><br/>",o=0;o<r.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n+=this._getLinkedResourceString(r[o])}i=t+'<var id="moodoAttach" moodoAttach="true">'+n+"</var>"}else i=t}else i=t;return i}},{key:"updateDraft",value:function(t,e,i,r,a,n,o,u){try{m.default.PAssert(907,m.default.isBoolean(n),"Must supply a valid bool for updateRemoteDraft")}catch(h){m.default.reportError(h)}try{m.default.PAssert(908,m.default.isBoolean(o),"Must supply a valid bool for forceFlush")}catch(h){m.default.reportError(h)}try{m.default.PAssert(909,m.default.isFunction(u),"Must supply a valid bool for cb")}catch(h){m.default.reportError(h)}var s=this._findDraft(t,e,i);if(s){if(s.to=r.to,s.from=r.from||s.from,s.cc=r.cc,s.bcc=r.bcc,s.subject=r.subject,s.decoded=this._createDraftBody(r.body||r.decoded,s.resources),s.snippet=a?m.default.escape(a.substring(0,30)):"",r.hasOwnProperty("resources")){try{m.default.PAssert(910,s.resources instanceof qe,"Resources must always be a valid resource lib")}catch(h){m.default.reportError(h)}s.resources=r.resources}this._updateAttachmentFromMessages(t,A.a.ChangeType.Local),t.notifyDataMutated(["messages"],A.a.ChangeType.Local),this.cacheThreadData(t.id,this.serializeExternalData(this.getCacheData(t.id))),!this._creatingDrafts[s.id]&&n?m.default.isTempId(s.id)?this._createRemoteDraft(t,s.id,function(t,e){t||An.toasts.pushMessage(A.a.MessageID.EmailUpdateFail),u(t,e)}):(this._notifyPendingDraftUpdate(t,s.id,s.draftID,o),u(!0)):(n&&this._notifyPendingDraftUpdate(t,s.id,s.draftID,o),u(!0)),this._updateIsSavingDrafts()}else{try{m.default.PAssert(911,!1,"Unable to update draft as expected from compose window")}catch(h){m.default.reportError(h)}u(!1)}return{threadID:t.id,draftID:s.draftID,messageID:s.id}}},{key:"_updateRemoteDraft",value:function(t,e,i,r,a){var n=this;try{m.default.PAssert(912,e&&i,"Must specify both a valid messageID and draftID"+e+"."+i)}catch(u){m.default.reportError(u)}var o=this._findDraft(t,e,i);try{m.default.PAssert(913,o&&o.labelIds.indexOf(Je.DRAFT)>=0,"Must be updating a valid draft"+!!o)}catch(u){m.default.reportError(u)}try{m.default.PAssert(914,!this._creatingDrafts[o.id],"Should not send a remote update while the original draft is being created")}catch(u){m.default.reportError(u)}this._activeDraftUpdates++,this._getRemoteDraftID(t.getField("accountID"),t.id,o.id,function(e){if(e)n._createRFC822Message(t.getData(),o,r,function(i){var r=Pt.a.fns("gmail").users.drafts.update.packedFn,u={userId:t.getField("accountID"),id:e,resource:{message:{raw:i,threadId:t.id}}};n._queueRemoteRequestMulti(t.getField("accountID"),r,u,function(e){n._updateDraftID(t,o.id,e),n._activeDraftUpdates--,a(e)},function(e){a(void 0,e),n._activeDraftUpdates--,n._notifyFailedRequest(t.getField("accountID"),e)},void 0,ni)});else{try{m.default.PAssert(915,!1,"Must always be able to get a valid draft ID when updating")}catch(u){m.default.reportError(u)}a(!1)}})}},{key:"sendDraft",value:function(t,e,i,r,a){var n=this;try{m.default.PAssert(916,!t.getField("pendingSend"),"Should not try to re-send a message after it has already been sent")}catch(v){m.default.reportError(v)}var o=!0,u=this._findDraft(t,e,i),s=function(e,i){e?(t.updateField("pendingSend",!1),n.removeModifiedOffline(t.getData(),!1),n.removeModifiedOffline(u,!1),n.notifySent(t,u.id)):(m.default.isHTTPStatusCode(i,A.a.HTTPStatusCode.Network)||t.updateField("pendingSend",!1),n.notifySendError(t,u.id)),a(e,i)},h=this._verifyEmailRecipients(t,u.id,u.draftID);if(h||(h=this._verifyEmailAttachments(t,u.id,u.draftID)),h){o=!1;var d=An.toasts.pushMessage({text:h.message,action:A.a.MessageAction.Okay});h.handleMessageFn&&h.handleMessageFn(d),this.notifyPendingSend(t,u.id),s(!1)}else if(!r){t.updateField("pendingSend",!0),this.notifyPendingSend(t,u.id);var c=!1;this.onEmailReadyToSend(u,function(){try{m.default.PAssert(917,!c,"Should not send an email twice")}catch(v){m.default.reportError(v)}c||(c=!0,t.isLocalOnlyAttachment()||m.default.isTempId(u.id)?n._sendEmail(t,u.id,u.draftID,s):n._sendRemoteDraft(t,u.id,s))})}return o}},{key:"onEmailReadyToSend",value:function(t,e){var i=this,r=!0;t.resources.forEachResource(function(a){if(a.uploader&&!a.uploader.isDone())if(r=!1,a.uploader.hasError())try{m.default.PAssert(918,!1,"Attachment has error when sending.")}catch(n){m.default.reportError(n)}else a.uploader.notifyOnComplete(i.onEmailReadyToSend.bind(i,t,e))}),r&&setTimeout(e,0)}},{key:"_sendRemoteDraft",value:function(t,e,i){var r=this;this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(t,e),this._getRemoteDraftID(t.getField("accountID"),t.id,e,function(a){if(a)r._updateRemoteDraft(t,e,a,!0,function(e){if(e&&e.message){var n=Pt.a.fns("gmail").users.drafts.send.packedFn,o={userId:t.getField("accountID"),resource:{id:a}};r._queueRemoteRequestMulti(t.getField("accountID"),n,o,function(a){r._updateLocalDraftFromSend(t,e.message.id,a,i)},function(e){r._notifySendFailed(),i(!1,e),r._notifyFailedRequest(t.getField("accountID"),e)},void 0,ui)}else An.toasts.pushMessage(A.a.MessageID.EmailUpdateFail),i(!1)});else{try{m.default.PAssert(919,!1,"Must always be able to get a valid draft ID when sending")}catch(n){m.default.reportError(n)}An.toasts.pushMessage(A.a.MessageID.EmailUpdateFail),i(!1)}})}},{key:"_updateLocalDraftFromSend",value:function(t,e,i,r){try{m.default.PAssert(920,i,"Must have a valid draft result")}catch(n){m.default.reportError(n)}var a=this._getMessageFromAttachment(t,e);try{m.default.PAssert(921,a,"Must always be able to find the sent message")}catch(n){m.default.reportError(n)}a&&(this.removeModifiedOffline(t.getData(),!1),this.removeModifiedOffline(a,!1),this._updateDraftFromSend(t,e,i)),m.default.isDemoMode()||this._requestRemoteMessageData(t,i.id,function(t){try{m.default.PAssert(922,t,"Should always be able to update message data after send")}catch(n){m.default.reportError(n)}}),r(!0)}},{key:"runDiscardDraft",value:function(t){var e=this._getDraftFromAttachment(t);this.discardDraft(t,e.id,e.draftID,function(t){try{m.default.PAssert(923,t,"Must be able to discard message draft")}catch(e){m.default.reportError(e)}})}},{key:"discardDraft",value:function(t,e,i,r){var a=t.getData(),n=this._findDraft(t,e,i),o=a.messages.indexOf(n);m.default.isTempId(e)?r(!0):this._deleteRemoteDraft(t,e,r);var u=a.messages[o];a.messages.splice(o,1),this._removeRemoteResources(u),this._updateAttachmentFromMessages(t,A.a.ChangeType.Local),this._clearPendingDraftUpdate(t,e),t.notifyDataMutated(["messages"],A.a.ChangeType.Local),this.cacheThreadData(a.id,this.serializeExternalData(a)),this.sendEvent("DiscardDraft")}},{key:"_removeRemoteResources",value:function(t){t&&t.resources.forEachResource(function(t){t.uploader&&!t.uploader.isDone()&&t.uploader.cancel()})}},{key:"_deleteRemoteDraft",value:function(t,e,i){var r=this;try{m.default.PAssert(924,!m.default.isTempId(e),"Should not try to remotely delete a local message")}catch(a){m.default.reportError(a)}this._getRemoteDraftID(t.getField("accountID"),t.id,e,function(e){if(e){var n=Pt.a.fns("gmail").users.drafts.delete.packedFn,o={userId:t.getField("accountID"),id:e};r._queueRemoteRequestMulti(t.getField("accountID"),n,o,function(){i(!0)},function(e){m.default.isHTTPStatusCode(e,A.a.HTTPStatusCode.NotFound)?i(!0):i(!1,e),r._notifyFailedRequest(t.getField("accountID"),e)},void 0,oi)}else{try{m.default.PAssert(925,!1,"Must always be able to get a valid draft ID when deleting")}catch(a){m.default.reportError(a)}An.toasts.pushMessage(A.a.MessageID.EmailUpdateFail),i(!1)}})}},{key:"_getRemoteDraftIDRaw",value:function(t,e,i,r){var a=Pt.a.fns("gmail").users.drafts.list.packedFn,n={userId:t,q:"rfc822msgid:"+e};this._queuePagedRemoteRequestMulti(t,a,n,i,r,void 0,si,{getAllPages:!0,resultsField:"drafts"})}},{key:"_getRemoteDraftID",value:function(t,e,i,r){var a=this;try{m.default.PAssert(926,m.default.isString(t),"Must provide a valid accountID")}catch(u){m.default.reportError(u)}try{m.default.PAssert(927,m.default.isString(e)&&!m.default.isTempId(e),"Should not try to remotely get the draft ID of a local thread: ",e)}catch(u){m.default.reportError(u)}try{m.default.PAssert(928,m.default.isString(i)&&!m.default.isTempId(i),"Should not try to remotely get the draft ID of a local draft: ",i)}catch(u){m.default.reportError(u)}var n=this.getAttachment(e);try{m.default.PAssert(929,n,"Must be able to find a valid attachment for the requested thread")}catch(u){m.default.reportError(u)}if(!n)return setTimeout(r,0,void 0,!1);var o=this._getMessageFromAttachment(n,i);try{m.default.PAssert(930,o,"Must be able to find a valid message for the requested draft")}catch(u){m.default.reportError(u)}if(!o)return setTimeout(r,0,void 0,!1);if(o.draftID)setTimeout(r,0,o.draftID,!1);else{try{m.default.PAssert(931,o.messageID&&!m.default.isTempId(o.messageID),"Must have a valid messageID for the draft being queried")}catch(u){m.default.reportError(u)}if(!o.messageID||m.default.isTempId(o.messageID))return setTimeout(r,0,void 0,!1);this._getRemoteDraftIDRaw(t,o.messageID,function(s){try{m.default.PAssert(932,s&&s.length<=1,"Must find only a single draft ID for a given message: ",s.length,o.messageID)}catch(u){m.default.reportError(u)}if(s){for(var h=0,d=0;d<s.length;++d){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var c=s[d];if(1===s.length||c.message.threadId===e){try{m.default.PAssert(933,!o.draftID||o.draftID===c.id,"Draft ID must either match or not be known yet")}catch(u){m.default.reportError(u)}o.draftID=c.id}}try{m.default.PAssert(934,0===s.length||o.draftID,"Draft returned but IDs dont match: ",s[0]?s[0].message.threadId:"NO RESULT",e,s[0]?s[0].message.id:"NO RESULT",i)}catch(u){m.default.reportError(u)}}return o.draftID?r(o.draftID,!0):o.contentType&&o.mimeType&&o.decoded?void a._createRemoteDraft(n,o.id,function(i,n){return i?r(o.draftID,!0):(m.default.isHTTPStatusCode(n,A.a.HTTPStatusCode.NotFound)&&a._deleteCachedThread(t,e),r(void 0,!1))}):(a._notifyLocalDraftDelete(t,e,i),r(void 0,!1))},function(e){return a._notifyFailedRequest(t,e),r(void 0,!1)})}}},{key:"_attachmentHasMessage",value:function(t,e){return t.getField("messages").indexOfWithProperty("id",e)>=0}},{key:"_getMessageFromAttachment",value:function(t,e){var i=t.getField("messages"),r=i.indexOfWithProperty("id",e);try{m.default.PAssert(935,r>=0,"Must have a vald draft")}catch(a){m.default.reportError(a)}return i[r]}},{key:"_getDraftFromAttachment",value:function(t,e){for(var i,r=0,a=t.getField("messages"),n=0;n<a.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(a[n].labelIds.indexOf(Je.DRAFT)>=0){e&&e!==a[n].draftID||(i=a[n]);break}}return i}},{key:"_findDraft",value:function(t,e,i){var r,a=t.getField("messages"),n=a.indexOfWithProperty("id",e);if(n>=0)r=a[n];else if(i){var o=a.indexOfWithProperty("draftID",i);o>=0&&(r=a[o])}try{m.default.PAssert(936,r,"Must be able to find a valid draft for given messageID/draftID")}catch(u){m.default.reportError(u)}return r}},{key:"isAttachmentDraftOnly",value:function(t){return this.attachmentHasLabel(t,fi.DRAFT)&&1===t.getField("messages").length}},{key:"archiveAttachment",value:function(t){try{m.default.PAssert(937,!this.attachmentIsArchived(t),"Should not archive a thread that is already archived")}catch(e){m.default.reportError(e)}return this.sendEvent("ArchiveMail"),this.removeLabelFromAttachment(t,fi.INBOX)}},{key:"unarchiveAttachment",value:function(t){try{m.default.PAssert(938,this.attachmentIsArchived(t),"Thread must be unarchived to archive it")}catch(e){m.default.reportError(e)}return this.sendEvent("UnarchiveMail"),this.addLabelToAttachment(t,fi.INBOX)}},{key:"trashAttachment",value:function(t){return this.sendEvent("TrashMail"),this.trashMail(t.getField("accountID"),t.id,void 0,function(t){try{m.default.PAssert(939,t,"Must have successfully trashed remote thread")}catch(e){m.default.reportError(e)}})}},{key:"untrashAttachment",value:function(t){return this.sendEvent("UntrashMail"),this.untrashMail(t.getField("accountID"),t.id,void 0,function(t){try{m.default.PAssert(940,t,"Must have successfully untrashed remote thread")}catch(e){m.default.reportError(e)}})}},{key:"markAttachmentRead",value:function(t){return this.sendEvent("MarkMailRead"),this.removeLabelFromAttachment(t,fi.UNREAD)}},{key:"markAttachmentUnread",value:function(t){return this.sendEvent("MarkMailUnread"),this.addLabelToAttachment(t,fi.UNREAD)}},{key:"snoozeAttachment",value:function(t,e){}},{key:"unsnoozeAttachment",value:function(t){this.sendEvent("UnsnoozeThread"),this.removeLabelFromAttachment(t,"Moo.do/Snoozed"),this.addLabelToAttachment(t,fi.INBOX),this.addLabelToAttachment(t,fi.UNREAD),this.cancelDeferredTask(t.id,Ue.Snooze)}},{key:"_handleDeferredSnoozeTask",value:function(t){}},{key:"scheduleSendMessage",value:function(t,e,i){}},{key:"cancelSendMessage",value:function(t,e){var i=this;this.sendEvent("UnscheduleMail"),this.removeLabelFromAttachment(t,"Moo.do/ScheduledSend"),this._getRemoteDraftID(t.getField("accountID"),t.id,e,function(t){t&&i.cancelDeferredTask(t,Ue.SendMail)})}},{key:"_handleDeferredSendMailTask",value:function(t){var e=t.getData();try{m.default.PAssert(943,e.gidLinked,"Must have valid gidLinked")}catch(i){m.default.reportError(i)}try{m.default.PAssert(944,e.threadID,"Must have a valid threadID")}catch(i){m.default.reportError(i)}m.default.log("Handling deferred send mail: ",e)}},{key:"_ensureNoPriority",value:function(t){var e=A.a.VMLIFlag.None;return this.attachmentHasLabel(t,Si.PRI0)&&(this.removeLabelFromAttachment(t,Si.PRI0),e=A.a.VMLIFlag.P0),this.attachmentHasLabel(t,Si.PRI1)&&(this.removeLabelFromAttachment(t,Si.PRI1),e=A.a.VMLIFlag.P1),this.attachmentHasLabel(t,Si.PRI2)&&(this.removeLabelFromAttachment(t,Si.PRI2),e=A.a.VMLIFlag.P2),e}},{key:"getAttachmentPriority",value:function(t){return this._attachmentHasPriorityLabel(t,A.a.VMLIFlag.P0)&&A.a.VMLIFlag.P0||this._attachmentHasPriorityLabel(t,A.a.VMLIFlag.P1)&&A.a.VMLIFlag.P1||this._attachmentHasPriorityLabel(t,A.a.VMLIFlag.P2)&&A.a.VMLIFlag.P2||A.a.VMLIFlag.None}},{key:"setAttachmentPriority",value:function(t,e){this.sendEvent("SetMailPriority");var i=this._ensureNoPriority(t);switch(e){case A.a.VMLIFlag.None:break;case A.a.VMLIFlag.P0:this.addLabelToAttachment(t,Si.PRI0);break;case A.a.VMLIFlag.P1:this.addLabelToAttachment(t,Si.PRI1);break;case A.a.VMLIFlag.P2:this.addLabelToAttachment(t,Si.PRI2);break;default:try{m.default.PAssert(945,!1,"Invalid priority for email attachment")}catch(r){m.default.reportError(r)}}return i}},{key:"markAttachmentStarred",value:function(t){return this.sendEvent("StarMail"),this.addLabelToAttachment(t,fi.STARRED)}},{key:"markAttachmentUnstarred",value:function(t){return this.sendEvent("UnstarMail"),this.removeLabelFromAttachment(t,fi.STARRED)}},{key:"attachmentHasLabelByID",value:function(t,e){return this.hasLabelByID(t.getField("accountID"),t.id,void 0,e)}},{key:"attachmentHasLabel",value:function(t,e){return this.hasLabel(t.getField("accountID"),t.id,void 0,e)}},{key:"attachmentHasFullLabel",value:function(t,e){return this.hasFullLabel(t.getField("accountID"),t.id,e)}},{key:"attachmentIsArchived",value:function(t){return this._threadIsArchived(t.getData())}},{key:"addLabelToAttachment",value:function(t,e){return this.addLabel(t.getField("accountID"),t.id,void 0,e)}},{key:"removeLabelFromAttachment",value:function(t,e){return this.removeLabel(t.getField("accountID"),t.id,void 0,e)}},{key:"trashMail",value:function(t,e,i,r){var a=this.getAttachment(e);if(this.isAttachmentDraftOnly(a)){var n=a.getField("messages")[0];this.discardDraft(a,n.id,n.draftID,r)}else this.removeLabelsFromMessage(t,e,i,[Je.INBOX],A.a.ChangeType.Local),this.addLabelsToMessage(t,e,i,[Je.TRASH],A.a.ChangeType.Local),m.default.isTempId(e)?r(!0):this._trashRemoteMail(t,e,i,r)}},{key:"untrashMail",value:function(t,e,i,r){this.removeLabelsFromMessage(t,e,i,[Je.TRASH],A.a.ChangeType.Local),m.default.isTempId(e)?(this.addLabelsToMessage(t,e,i,[Je.INBOX],A.a.ChangeType.Local),r(!0)):(this.addLabel(t,e,i,fi.INBOX),this._untrashRemoteMail(t,e,i,r))}},{key:"moveItem",value:function(t,e,i){return i.insertItem(e,0),[e,i]}},{key:"unmoveItem",value:function(t,e,i){return i.removeChild(e,A.a.ChangeType.Local),[e,i]}},{key:"hasLabelByID",value:function(t,e,i,r){try{m.default.PAssert(946,!i,"We don't support individual queries on messages, only threads")}catch(a){m.default.reportError(a)}return this.getAttachment(e).getField("labelIds").indexOf(r)>=0}},{key:"hasLabel",value:function(t,e,i,r){try{m.default.PAssert(947,!i,"We don't support individual queries on messages, only threads")}catch(o){m.default.reportError(o)}var a=!1;if(!i){var n=this._getLabelByName(t,r,!0);n&&(a=this.hasLabelByID(t,e,i,n.getLabelID()))}return a}},{key:"hasFullLabel",value:function(t,e,i){var r=!1,a=this.getCacheData(e),n=this._getLabelByName(t,i,!0);if(n&&a){var o=0,u=a.messages;r=!0;for(var s=0;s<u.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(u[s].labelIds.indexOf(n.getLabelID())<0){r=!1;break}}}return r}},{key:"hasLabelLike",value:function(t,e,i){var r=!1,a=this.getAttachment(e);if(a){var n=a.getField("labelIds"),o=this._getAccountLib(t,this._labelsByID);if(o)for(var u=0,s=0;s<n.length;++s){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var h=o[n[s]];h&&h.isMatched(i)&&(r=!0)}}return r}},{key:"addLabel",value:function(t,e,i,r){var a=this;try{m.default.PAssert(948,!i,"We currently do not support setting labels on single messages")}catch(u){m.default.reportError(u)}try{m.default.PAssert(949,!this.hasLabel(t,e,i,r),"Should not add the same label to a thread/message twice")}catch(u){m.default.reportError(u)}var n=this._getLabelByName(t,r,!0);if(n)n.isLocalOnly()?this._createRemoteLabel(t,r,function(i){if(i){try{m.default.PAssert(951,i,"Should have successfully created the remote label")}catch(u){m.default.reportError(u)}a._changeLabelID(t,n.getLabelID(),i.id),a._modifyRemoteThreadLabels(t,e,[i.id],void 0)}}):this._modifyRemoteThreadLabels(t,e,[n.getLabelID()],void 0);else{var o=m.default.generateTempId();n=this._ensureLabel(t,o,r,void 0,void 0,A.a.ChangeType.Local),this._ensureVMLIsForLabel(t,n),this._writeLabelsToCache(function(i){i&&a._createRemoteLabel(t,r,function(i){try{m.default.PAssert(950,i,"Should have successfully created the remote label")}catch(u){m.default.reportError(u)}i&&(a._changeLabelID(t,o,i.id),a._modifyRemoteThreadLabels(t,e,[i.id],void 0))})})}return this.addLabelsToMessage(t,e,i,[n.getLabelID()],A.a.ChangeType.Local),r}},{key:"removeLabel",value:function(t,e,i,r){try{m.default.PAssert(952,!i,"We currently do not support setting labels on single messages")}catch(n){m.default.reportError(n)}var a=this._getLabelByName(t,r);try{m.default.PAssert(953,a,"Must have valid label for gmail in order to remove")}catch(n){m.default.reportError(n)}return a&&(a.isLocalOnly()||this._modifyRemoteThreadLabels(t,e,void 0,[a.getLabelID()]),this.removeLabelsFromMessage(t,e,i,[a.getLabelID()],A.a.ChangeType.Local)),r}},{key:"_threadIsArchived",value:function(t){if(t){var e=t.labelIds.indexOf(Je.INBOX)>=0,i=this.hasFullLabel(t.accountID,t.id,fi.TRASH),r=t.labelIds.indexOf(Je.SPAM)>=0,a=this.hasFullLabel(t.accountID,t.id,fi.DRAFT);return!m.default.isTempId(t.id)&&!e&&!i&&!r&&!a}return!1}},{key:"_trashRemoteMail",value:function(t,e,i,r){var a,n,o=this;try{m.default.PAssert(954,!m.default.isTempId(e),"Should not try to trash local only threads")}catch(u){m.default.reportError(u)}try{m.default.PAssert(955,!i||!m.default.isTempId(i),"Should not try to trash local only messages")}catch(u){m.default.reportError(u)}i?(a=Pt.a.fns("gmail").users.messages.trash.packedFn,n={userId:t,id:i}):(a=Pt.a.fns("gmail").users.threads.trash.packedFn,n={userId:t,id:e});this._queueRemoteRequestMulti(t,a,n,function(){r(!0)},function(e){r(!1,e),o._notifyFailedRequest(t,e)},void 0,ii)}},{key:"_untrashRemoteMail",value:function(t,e,i,r){var a,n,o=this;try{m.default.PAssert(956,!m.default.isTempId(e),"Should not try to untrash local only threads")}catch(u){m.default.reportError(u)}try{m.default.PAssert(957,!i||!m.default.isTempId(i),"Should not try to untrash local only messages")}catch(u){m.default.reportError(u)}i?(a=Pt.a.fns("gmail").users.messages.untrash.packedFn,n={userId:t,id:i}):(a=Pt.a.fns("gmail").users.threads.untrash.packedFn,n={userId:t,id:e});this._queueRemoteRequestMulti(t,a,n,function(){r(!0)},function(e){r(!1,e),o._notifyFailedRequest(t,e)},void 0,ii)}},{key:"_createRemoteLabel",value:function(t,e,i){var r=this,a=Pt.a.fns("gmail").users.labels.create.packedFn,n={userId:t,resource:{name:e,labelListVisibility:"labelHide",messageListVisibility:"hide"}};this._queueRemoteRequestMulti(t,a,n,function(t){i&&i(t)},function(e){m.default.isHTTPStatusCode(e,A.a.HTTPStatusCode.Conflict)?i&&i(void 0,e):(i&&i(void 0,e),r._notifyFailedRequest(t,e))},void 0,ti)}},{key:"_modifyRemoteThreadLabels",value:function(t,e,i,r,a){var n=this,o=Pt.a.fns("gmail").users.threads.modify.packedFn,u={userId:t,id:e,resource:{addLabelIds:i,removeLabelIds:r}};this._queueRemoteRequestMulti(t,o,u,function(t){a&&a(t)},function(e){a&&a(void 0,e),n._notifyFailedRequest(t,e)},void 0,ei)}},{key:"_ensureRemoteLabel",value:function(t,e,i,r){this._getLabelByName(t,e,!0)?r&&r(!0):(this._ensureLabel(t,m.default.generateTempId(),e,void 0,void 0,i),this._createRemoteLabel(t,e,function(t,e){try{m.default.PAssert(958,t||m.default.isHTTPStatusCode(e,A.a.HTTPStatusCode.Conflict),"Should have successful root label creation")}catch(i){m.default.reportError(i)}r&&r(!!t)}))}},{key:"_createInMemoryLabel",value:function(t,e,i,r,a,n){var o=new Me(t,e,i,this._clampSyncTime(r),a,n);n[e]=o,this._ensureAccountLib(t,this._labelsByName)[i]=o}},{key:"_updateLabelName",value:function(t,e){var i=t.getAccountID(),r=this._getAccountLib(i,this._labelsByName);try{m.default.PAssert(959,r,"Must have valid label name bucket")}catch(a){m.default.reportError(a)}try{m.default.PAssert(960,r[t.getRawName()],"Must have valid label in bucket")}catch(a){m.default.reportError(a)}t.updateLabelName(e),delete r[t.getRawName()],r[e]=t}},{key:"_ensureLabel",value:function(t,e,i,r,a,n){var o=this._ensureAccountLib(t,this._labelsByID);if(o[e])!m.default.isRemoteChange(n)&&o[e].hasName()||o[e].isSystemLabel()||this._updateLabelName(o[e],i);else{var u=this._getLabelByName(t,i,!0);if(u)u.isLocalOnly()&&!m.default.isTempId(e)?this._changeLabelID(t,u.getLabelID(),e):u.isLocalOnly()||(o[e]=u);else{try{m.default.PAssert(962,i||!m.default.isTempId(e),"All local labels must have a valid name")}catch(s){m.default.reportError(s)}this._createInMemoryLabel(t,e,i,r,a,o)}}return o[e]}},{key:"_clampSyncTime",value:function(t){return t&&t.isBefore(this._getMetadataSyncTime())?this._getMetadataSyncTime():t}},{key:"_ensureLabelVMLIsForAccount",value:function(t){var e=this._getAccountLib(t,this._labelsByID);for(var i in e)e.hasOwnProperty(i)&&this._ensureVMLIsForLabel(t,e[i])}},{key:"_changeLabelID",value:function(t,e,i){var r=this._getLabelByID(t,e);An.PaneUpdateBatcher.beginUpdateItems(),r.updateLabelID(i),this._getAccountLib(t,this._labelsByID)[i]=r,this._ensureVMLIsForLabel(t,r),An.PaneUpdateBatcher.commitUpdateItems(),this.forEachAttachment(function(t){var r=t.getField("labelIds");if(r.remove(e)>=0){for(var a=0,n=t.getField("messages"),o=0;o<n.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n[o].labelIds.remove(e)>=0&&n[o].labelIds.push(i)}r.push(i),t.updateField("labelIds",r)}});var a=this.getDefaultItemStore(),n="L~"+t+"~"+e;a.hasItem(n)&&a.destroyItem(n)}},{key:"labelExists",value:function(t,e){var i=this._getAccountLib(t,this._labelsByID);return i&&i[e]}},{key:"_getLabelByID",value:function(t,e){try{m.default.PAssert(963,t,"Must supply a valid accountID")}catch(a){m.default.reportError(a)}try{m.default.PAssert(964,e,"Must supply a valid labelID")}catch(a){m.default.reportError(a)}var i=this._ensureAccountLib(t,this._labelsByID);if(!i[e]){var r=fi[e];this._createInMemoryLabel(t,e,r,void 0,void 0,i)}return i[e]}},{key:"_getLabelByName",value:function(t,e,i){try{m.default.PAssert(965,this.hasSyncAccount(t),"Must provide a valid accountID with a matching sync account: "+t)}catch(n){m.default.reportError(n)}var r,a=this._getAccountLib(t,this._labelsByName);try{m.default.PAssert(966,i||a,"Unable to find labelsByName for given account: "+t)}catch(n){m.default.reportError(n)}return a&&(r=a[e]),r}},{key:"_getPriorityLabel",value:function(t,e){var i=this._ensureAccountLib(t,this._priorityLabels);if(!i[e]){var r;switch(e){case A.a.VMLIFlag.P0:r=Si.PRI0;break;case A.a.VMLIFlag.P1:r=Si.PRI1;break;case A.a.VMLIFlag.P2:r=Si.PRI2;break;default:try{m.default.PAssert(967,!1,"Invalid priority for email attachment")}catch(a){m.default.reportError(a)}}i[e]=this._getLabelByName(t,r)}return i[e]}},{key:"_getAccountLib",value:function(t,e){try{m.default.PAssert(968,t,"Must provide valid accountID")}catch(a){m.default.reportError(a)}try{m.default.PAssert(969,e,"Must provide valid lib object")}catch(a){m.default.reportError(a)}var i;if(t)if(e[t])i=e[t];else for(var r in e)if(r.toUpperCase()===t.toUpperCase())try{m.default.PAssert(970,!1,"Mismatch case request found for accountIDs: "+t,r)}catch(a){m.default.reportError(a)}return i}},{key:"_ensureAccountLib",value:function(t,e){try{m.default.PAssert(971,t,"Must provide valid accountID")}catch(a){m.default.reportError(a)}try{m.default.PAssert(972,e,"Must provide valid lib object")}catch(a){m.default.reportError(a)}var i;if(t)if(e[t=t.toLowerCase()])i=e[t];else{for(var r in e)if(e.hasOwnProperty(r))try{m.default.PAssert(973,!t||!r||r.toUpperCase()!==t.toUpperCase(),"Dupe accountID found with non-matching case: "+t,r)}catch(a){m.default.reportError(a)}i=e[t]={}}return i}},{key:"_deleteAccountLib",value:function(t,e){try{m.default.PAssert(974,t,"Must provide valid accountID")}catch(i){m.default.reportError(i)}try{m.default.PAssert(975,e,"Must provide valid lib object")}catch(i){m.default.reportError(i)}try{m.default.PAssert(976,e[t],"Trying to delete an account lib that doesnt exist: ",t)}catch(i){m.default.reportError(i)}delete e[t]}},{key:"_attachmentHasPriorityLabel",value:function(t,e){var i=this._getPriorityLabel(t.getField("accountID"),e);return!!i&&t.getField("labelIds").indexOf(i.getLabelID())>=0}},{key:"getLabels",value:function(t,e,i){var r=[],a=e.toLowerCase(),n=0,o=this._labelsByID[t];for(var u in o)if(o.hasOwnProperty(u)){var s=o[u];if(s.matchesText(a)&&this.isDisplayTag(s)&&r.indexOf(s)<0&&(r.push(s),n++),i&&n>=i)break}return r}},{key:"_writeLabelsToCache",value:function(t){var e={};for(var i in this._labelsByID)if(this._labelsByID.hasOwnProperty(i)){e[i]={};var r=this._labelsByID[i];for(var a in r)r.hasOwnProperty(a)&&(e[i][a]=r[a].getSaveData())}this._threadCache.setMetadata(yi,e,t)}},{key:"_writeSendAsToCache",value:function(t){var e={};this._iterateSendAs(function(t,i){e[t]||(e[t]=[]),e[t].push(i)}),this._threadCache.setMetadata(gi,e,t)}},{key:"runLabelSync",value:function(t){var e=this;this._threadCache.onCacheReady(function(){for(var i=0,r=e.getSyncAccounts(),a=r.length,n=0,o=0,u=function(i,r){An.PaneUpdateBatcher.beginUpdateItems();var u={};if(r)for(var s=0,h=0;h<r.length;++h){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var d,c=r[h];u[c.id]=!0,d="system"===c.type&&fi[c.id]?fi[c.id]:c.name,e._ensureLabel(i,c.id,d,void 0,c,A.a.ChangeType.Remote)}e._ensureLabelVMLIsForAccount(i),e._ensureRemoteLabel(i,"Moo.do",A.a.ChangeType.Local),e._ensureRemoteLabel(i,Si.PRI0,A.a.ChangeType.Local),e._ensureRemoteLabel(i,Si.PRI1,A.a.ChangeType.Local),e._ensureRemoteLabel(i,Si.PRI2,A.a.ChangeType.Local),e._ensureRemoteLabel(i,"Moo.do/Snoozed",A.a.ChangeType.Local),e._ensureRemoteLabel(i,"Moo.do/Handled",A.a.ChangeType.Local),e._ensureRemoteLabel(i,"Moo.do/Scheduled",A.a.ChangeType.Local);var v=e._getAccountLib(i,e._labelsByID);if(v)for(var y in v)if(v.hasOwnProperty(y)){var g=v[y];if(g.isLocalOnly()){try{m.default.PAssert(977,g.hasName(),"Label must have a valid name to be created on remote")}catch(l){m.default.reportError(l)}e._createRemoteLabel(i,g.getName(),function(t,e){e&&this._changeLabelID(i,t,e.id)}.bind(e,y))}else 0!==o||u[y]||g.isSystemOrSpecialLabel()||m.default.isDemoMode()||g.delete()}An.PaneUpdateBatcher.commitUpdateItems(),e._writeLabelsToCache(),o+n===a&&t&&t()},s=function(t){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;d=Pt.a.fns("gmail").users.labels.list.packedFn;var a=r[t];c={userId:a,timeoutMS:0},kt.a.getAccountAuthToken(a,e.googleScopes(),function(t){t&&e._queueRemoteRequestMulti(a,d,c,function(t,e){n++,u(t,e.labels)}.bind(e,a),function(t,i){o++,u(t),e._notifyFailedRequest(t,i)}.bind(e,a),void 0,_e)})},h=0;h<r.length;++h){var d,c;s(h)}})}},{key:"getDescriptorForItem",value:function(t){try{m.default.PAssert(979,t,"Must have a valid item to get a description for")}catch(n){m.default.reportError(n)}var e=this._getAccountIDFromItem(t),i=this._getLabelIDFromItem(t),r={accountID:e,labelID:i,threadID:this._getThreadIDFromItem(t)};if(e&&i){var a=this._getLabelByID(e,i);r.labelName=a.getName()}return r}},{key:"handleItemChange",value:function(t,e){var i=this;this._threadCache.onCacheReady(function(){var r=i.getDescriptorForItem(t);if(r.labelID){try{m.default.PAssert(980,r.accountID,"Must specify a valid accountID")}catch(a){m.default.reportError(a)}i._getThreadsForLabel(r.accountID,i._getLabelByID(r.accountID,r.labelID),t,!1,function(t){try{m.default.PAssert(981,t,"Expected success when querying for remote threads")}catch(a){m.default.reportError(a)}e&&e()})}})}},{key:"handleViewModeChange",value:function(t,e){var i=this;e===A.a.GmailViewMode.Priority&&this._threadCache.onCacheReady(function(){var e=i._getAccountIDFromItem(t);try{m.default.PAssert(982,e,"Missing Account ID: ",t.id)}catch(o){m.default.reportError(o)}var r=i._getLabelByName(e,Si.PRI0);r&&i._getThreadsForLabel(e,r,void 0,!1,function(t){try{m.default.PAssert(983,t,"Expected success when querying for remote PRI0 threads")}catch(o){m.default.reportError(o)}});var a=i._getLabelByName(e,Si.PRI1);a&&i._getThreadsForLabel(e,a,void 0,!1,function(t){try{m.default.PAssert(984,t,"Expected success when querying for remote PRI1 threads")}catch(o){m.default.reportError(o)}});var n=i._getLabelByName(e,Si.PRI2);n&&i._getThreadsForLabel(e,n,void 0,!1,function(t){try{m.default.PAssert(985,t,"Expected success when querying for remote PRI2 threads")}catch(o){m.default.reportError(o)}})})}},{key:"_getThreadsForLabel",value:function(t,e,i,r,a){var n=this;try{m.default.PAssert(986,e,"Must provide a valid label to get thrads for")}catch(d){m.default.reportError(d)}var o="-in:chats -in:spam label:"+e.getName(),u=e.getOldestSync();m.default.isDateValid(u)&&(o+=" before:"+Math.floor(u.getTime()/1e3));var s=new Date,h=new Ze(function(e){if(e){var i=n._addRemoteEntry(t,e);i.internalDate.isBefore(s)&&(s=i.internalDate),n.cacheThreadData(i.id,n.serializeExternalData(i))}},function(t){e.setOldestSync(s),n._writeLabelsToCache(),a(t)});this._requestRemoteThreads(t,ri,i,o,r?999:25,void 0,h.getEntryCB(),h.getDoneCB())}},{key:"createOutlinePaneItem",value:function(t,e){for(var i=0,r=e.getItemStore(),a=t.getRawText(),n=t.getAttachmentByPlugin(this.id),o=this.getDisplayTags(n,void 0,!0),u=0;u<o.length;++u){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a+=" #"+o[u]}return r.createItem(m.default.generateTempId(),a,e.id,void 0,A.a.ChangeType.Local,e.getDocumentOwner())}},{key:"refreshCurrentView",value:function(){this._forceThreadSync()}},{key:"goOnline",value:function(){this._forceThreadSync(this._notifyPendingDraftUpdate.bind(this))}},{key:"loadInitialData",value:function(){g()(v()(e.prototype),"loadInitialData",this).call(this),m.default.isDemoMode()&&this._forceThreadSync()}},{key:"_forceThreadSync",value:function(t){this.hasRecurringTask("GmailThreadSync")&&this.getRecurringTask("GmailThreadSync").forceUpdate(t)}},{key:"_forceLabelSync",value:function(t){this.hasRecurringTask("GmailLabelSync")&&this.getRecurringTask("GmailLabelSync").forceUpdate(t)}},{key:"_syncOfflineChanges",value:function(){try{m.default.PAssert(987,!1,"Currently we do not perform a sync offline step for Gmail changes")}catch(t){m.default.reportError(t)}this._syncingOfflineChanges||(this._syncingOfflineChanges=!0)}},{key:"_cleanupLocalCaches",value:function(t){var e=this;try{m.default.PAssert(988,m.default.isFunction(t),"Must have a valid callback when cleaning local caches")}catch(u){m.default.reportError(u)}var i=0,r=0,a=this._getFullSyncTime(),n=this._getUnreadSyncTime(),o=this._getMetadataSyncTime();this._threadCache.getFilterEntries(function(t){return t&&t.date&&t.date.isBefore(a)},function(a){if(a)for(var u=0,s=0;s<a.length;++s){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var h=a[s],d=!0;if(!h.date.isBefore(n))for(var c=0,v=0;d&&v<h.messages.length;++v){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var y=h.messages[v];if(e.isPriorityData(y)){d=!1;break}}if(d){var g=0;h.date.isBefore(o)&&(e._threadCache.removeEntry(h.id),i++);for(var l=0;l<h.messages.length;++l){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;var p=h.messages[l];e._rawCache.removeEntry(p.id),r++}}}m.default.log("Gmail Cache Pruned: ",i,r),t(!1)})}},{key:"_cleanupRawCache",value:function(t){var e=this;try{m.default.PAssert(989,m.default.isFunction(t),"Must have a valid callback when cleaning local caches")}catch(a){m.default.reportError(a)}var i=0,r=this._getUnreadSyncTime();this._rawCache.getFilterEntries(function(t){return!t.internalDate||new Date(parseInt(t.internalDate)).isBefore(r)},function(r){if(r)for(var a=0,n=0;n<r.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=r[n];e._rawCache.removeEntry(o.id),i++}m.default.log("Raw Cache Pruned: ",i),t()})}},{key:"getAccountSetting",value:function(t,e){var i,r=this._getAccountLib(t,this._accountSettings);return r&&(i=r[e]),i}},{key:"setAccountSetting",value:function(t,e,i){var r,a=this._ensureAccountLib(t,this._accountSettings);return r=a[e],a[e]=i,r}},{key:"runSettingsSync",value:function(){var t=this;this._getSettingsSendAs(function(e){for(var i in e)e.hasOwnProperty(i)&&t.setAccountSetting(i,"sendAs",e[i]);t._writeSendAsToCache(function(){})})}},{key:"_getSyncDays",value:function(){var t=this.getSetting(this.Settings.SyncTime);An.billingManager.isTrialOver()&&(t=A.a.MaxGmailSyncTime.Free);var e=An.pluginManager.getCacheSizeRatio();return e<1&&e>0&&(t=Math.round(t*e)),t}},{key:"_getMetadataSyncDays",value:function(){var t=Math.max(this.getSetting(this.Settings.SyncTime),15),e=An.pluginManager.getCacheSizeRatio();return e<.5&&(t=Math.max(Math.round(t*e),7)),t}},{key:"_getUnreadSyncTime",value:function(){var t=this._getSyncDays();return(new Date).addDays(-1.5*t)}},{key:"_getFullSyncTime",value:function(){var t=this._getSyncDays();return(new Date).addDays(-t)}},{key:"_getMetadataSyncTime",value:function(){var t=this._getMetadataSyncDays();return(new Date).addDays(-t)}},{key:"_getFullSyncTimeStr",value:function(){return this._getSyncDays()+"d"}},{key:"_getMetadataSyncTimeStr",value:function(){return this._getMetadataSyncDays()+"d"}},{key:"runThreadSync",value:function(t){var e,i=this,r=0,a=0,n=[],o=[],u=function(u,s,h){u?(r++,n.push(s)):(a++,!m.default.isHTTPStatusCode(h,A.a.HTTPStatusCode.Network)&&i.isOnline()&&o.push(s)),a+r===e&&(o.length>0?An.toasts.pushMessage(A.a.MessageID.EmailSyncFail):An.toasts.clearMessage(A.a.MessageID.EmailSyncFail),n.length>0&&i._contentSyncTask.requestRun(),t&&t(0===o.length))},s=!1,h=this._getSyncDays();void 0!==this._lastSyncTime&&this._lastSyncTime<h&&(s=!0,m.default.log("Forcing full gmail sync")),this._lastSyncTime=h,this._threadCache.onCacheReady(function(){i._threadCache.getMetadata(vi,function(t){var r=0,a=i.getSyncAccounts();e=a.length;for(var n=function(){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var e=a[o];s||(d=t?t[e]:void 0,h=d?d.historyID:void 0),kt.a.getAccountAuthToken(e,i.googleScopes(),function(t){if(t){var r=i._getLabelByName(e,"Moo.do/Handled",!0);r&&i._getThreadsForLabel(e,r,void 0,!1,function(t){try{m.default.PAssert(990,t,"Expect to be able to get all handled messages")}catch(e){m.default.reportError(e)}}),i.performThreadSync(e,h,u)}})},o=0;o<a.length;++o){var h,d;n()}})})}},{key:"syncAllAccountsFull",value:function(t){this._lastSyncTime=0,this.runThreadSync(t)}},{key:"performThreadSync",value:function(t,e,i){e?(Date.now()-this._lastCacheCleanup>m.default.hours(12)&&(this._lastCacheCleanup=Date.now(),this._cacheCleanup.notifyWorkAvailable()),this._performThreadSyncPartial(t,e,i)):this._performThreadSyncFull(t,i)}},{key:"_performThreadSyncFull",value:function(t,e){var i,r=this,a="-in:chats -in:spam newer_than:"+this._getMetadataSyncTimeStr(),n=this.getDefaultItemStore(),o=this._ensureVMLIsForAccount(t,n);o.clearPaginationToken();var u=new Ze(function(e){if(e&&(!i&&e.historyId&&(i=e.historyId,r.setHistoryID(t,i)),r._shouldCacheThread(e))){var a=r._addRemoteEntry(t,e);r.cacheThreadData(a.id,r.serializeExternalData(a))}},function(i){e(i,t)});this._requestRemoteThreads(t,Re,o,a,999,0,u.getEntryCB(),u.getDoneCB()),this.runLabelSync(function(){var e=r._getLabelByName(t,"Moo.do/Handled",!0);e&&r._getThreadsForLabel(t,e,void 0,!0,function(t){try{m.default.PAssert(991,t,"Expect to be able to get all handled messages")}catch(e){m.default.reportError(e)}}),r._getThreadsForLabel(t,r._getLabelByID(t,Je.UNREAD),void 0,!1,function(t){try{m.default.PAssert(992,t,"Expect to be able to get all unread messages")}catch(e){m.default.reportError(e)}})})}},{key:"_compactHistoryEntries",value:function(t){for(var e=0,i={messages:{},messagesAdded:{},messagesDeleted:{},labelsAdded:{},labelsRemoved:{}},r=0;r<t.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=t[r],n=0;if(a.messagesAdded){for(var o=0,u=0;u<a.messagesAdded.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var s=a.messagesAdded[u].message,h=i.messagesAdded[s.threadId];h||(h=i.messagesAdded[s.threadId]=[]),h.indexOf(s.id)<0&&h.push(s.id)}n+=a.messagesAdded.length}if(a.messagesDeleted){for(var d=0,c=0;c<a.messagesDeleted.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var v=a.messagesDeleted[c].message,y=i.messagesDeleted[v.threadId];y||(y=i.messagesDeleted[v.threadId]=[]),y.indexOf(v.id)<0&&y.push(v.id)}n+=a.messagesDeleted.length}if(a.labelsAdded){for(var g=0,l=0;l<a.labelsAdded.length;++l){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;var p=a.labelsAdded[l].message,f=i.labelsAdded[p.threadId];f||(f=i.labelsAdded[p.threadId]={}),f[p.id]||(f[p.id]=[]),f[p.id].pushOnlyUniques(a.labelsAdded[l].labelIds)}n+=a.labelsAdded.length}if(a.labelsRemoved){for(var k=0,A=0;A<a.labelsRemoved.length;++A){if(k++>5e3&&__infLoop&&__infLoop(k))throw new RangeError;var S=a.labelsRemoved[A].message,w=i.labelsRemoved[S.threadId];w||(w=i.labelsRemoved[S.threadId]={}),w[S.id]||(w[S.id]=[]),w[S.id].pushOnlyUniques(a.labelsRemoved[A].labelIds)}n+=a.labelsRemoved.length}try{m.default.PAssert(993,0===n||n===a.messages.length,"Must have handled all or none of the generic messages")}catch(T){m.default.reportError(T)}if(0===n)for(var L=0,F=0;F<a.messages.length;++F){if(L++>5e3&&__infLoop&&__infLoop(L))throw new RangeError;var C=a.messages[F],I=i.messages[C.threadId];I||(I=i.messages[C.threadId]=[]),I.indexOf(C.id)<0&&I.push(C.id)}}var P={messages:[],messagesAdded:[],messagesDeleted:[],labelsAdded:[],labelsRemoved:[]};for(var N in i.messages)i.messages.hasOwnProperty(N)&&P.messages.push({id:N,msgIDs:i.messages[N]});for(var H in i.messagesAdded)i.messagesAdded.hasOwnProperty(H)&&!i.messages[H]&&P.messagesAdded.push({id:H,msgIDs:i.messagesAdded[H]});for(var M in i.messagesDeleted)i.messagesDeleted.hasOwnProperty(M)&&!i.messages[M]&&P.messagesDeleted.push({id:M,msgIDs:i.messagesDeleted[M]});for(var z in i.labelsAdded)if(i.labelsAdded.hasOwnProperty(z)&&!i.labelsAdded[z])for(var D in i.labelsAdded[z])i.labelsAdded[z].hasOwnProperty(D)&&P.labelsAdded.push({id:z,msgID:D,labelIDs:i.labelsAdded[z][D]});for(var V in i.labelsRemoved)if(i.labelsRemoved.hasOwnProperty(V)&&!i.messages[V])for(var G in i.labelsRemoved[V])i.labelsRemoved[V].hasOwnProperty(G)&&P.labelsRemoved.push({id:V,msgID:G,labelIDs:i.labelsRemoved[V][G]});return P}},{key:"_performThreadSyncPartial",value:function(t,e,i){var r=this,a=Pt.a.fns("gmail").users.history.list.packedFn,n={userId:t,startHistoryId:e},o={getAllPages:!0,maxPageResults:999,resultsField:"history",timeoutMS:0},u=function(t,e){m.default.log("History Sync Request Failed: ",t,e)};this._queuePagedRemoteRequestMulti(t,a,n,function(e,a,n){var o;n&&(o=n.historyId,r.setHistoryID(t,o)),An.PaneUpdateBatcher.beginUpdateItems();var s=r._compactHistoryEntries(e);r._handleCompactHistory(t,s,u),An.PaneUpdateBatcher.commitUpdateItems(),i(!0,t)},function(e){e&&e.error&&e.error.code===A.a.HTTPStatusCode.NotFound?r._clearCachedData(t,function(a){a?r.performThreadSync(t,void 0,i):i(!1,t,e)}):(i(!1,t,e),r._notifyFailedRequest(t,e))},void 0,Ee,o)}},{key:"_handleCompactHistory",value:function(t,e,i){for(var r=0,a=0,n=0,o=0,u=0,s=0,h=0;h<e.messages.length;++h){var d=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var c=e.messages[h],v=0;v<c.msgIDs.length;++v){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;this._handleMessageUpdated(t,c.id,c.msgIDs[v],i),s++}}for(var y=0;y<e.messagesAdded.length;++y){var g=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var l=e.messagesAdded[y],p=0;p<l.msgIDs.length;++p){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;this._handleMessageAdded(t,l.id,l.msgIDs[p],i),s++}}for(var m=0;m<e.messagesDeleted.length;++m){var f=0;if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;for(var k=e.messagesDeleted[m],A=0;A<k.msgIDs.length;++A){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;this._handleMessageDeleted(t,k.id,k.msgIDs[A]),s++}}for(var S=0;S<e.labelsAdded.length;++S){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var w=e.labelsAdded[S];this._handleLabelsAdded(t,w.id,w.msgID,w.labelIDs),s++}for(var L=0;L<e.labelsRemoved.length;++L){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var F=e.labelsRemoved[L];this._handleLabelsRemoved(t,F.id,F.msgID,F.labelIDs),s++}return s}},{key:"_handleMessageAdded",value:function(t,e,i,r){this.refreshThreadCacheData(t,e,i,r)}},{key:"_handleMessageDeleted",value:function(t,e,i){this._deleteCachedMessage(t,e,i)}},{key:"_handleLabelsAdded",value:function(t,e,i,r){this.addLabelsToMessage(t,e,i,r,A.a.ChangeType.Remote)}},{key:"_handleLabelsRemoved",value:function(t,e,i,r){this.removeLabelsFromMessage(t,e,i,r,A.a.ChangeType.Remote)}},{key:"_handleMessageUpdated",value:function(t,e,i,r){this.refreshThreadCacheData(t,e,i,r)}},{key:"getLastSyncTime",value:function(t,e){this._threadCache.getMetadata(vi,function(i){var r;if(i){var a=i[t];a&&a.date&&(r=new Date(a.date))}e(r)})}},{key:"getAllLastSyncTimes",value:function(t){var e=this;this._threadCache.getMetadata(vi,function(i){for(var r=0,a={},n=e.getSyncAccounts(),o=0;o<n.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=n[o],s=i?i[u]:void 0;s&&s.date?a[u]=new Date(s.date):a[u]=void 0}t(a)})}},{key:"setHistoryID",value:function(t,e,i){var r=this;try{m.default.PAssert(995,m.default.isString(t),"Must provide a valid account ID to set history ID")}catch(a){m.default.reportError(a)}try{m.default.PAssert(996,m.default.isString(e),"Must provide a valid history ID to set")}catch(a){m.default.reportError(a)}this._threadCache.getMetadata(vi,function(a){(a=a||{})[t]={historyID:e,date:Date.now()},r._threadCache.setMetadata(vi,a,i)})}},{key:"clearHistoryID",value:function(t,e){var i=this;try{m.default.PAssert(997,m.default.isString(t),"Must provide a valid account ID to clear history ID for")}catch(r){m.default.reportError(r)}try{m.default.PAssert(998,m.default.isFunction(e),"Must provide valid CB function when clearing history ID")}catch(r){m.default.reportError(r)}this._threadCache.getMetadata(vi,function(r){r?(delete r[t],i._threadCache.setMetadata(vi,r,e)):e(!1)})}},{key:"clearCachedLabel",value:function(t,e){var i=this;try{m.default.PAssert(999,m.default.isString(t),"Must provide a valid account ID to clear history ID for")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1e3,m.default.isFunction(e),"Must provide valid CB function when clearing history ID")}catch(r){m.default.reportError(r)}this._threadCache.getMetadata(yi,function(r){r?(delete r[t],i._threadCache.setMetadata(yi,r,e)):e(!1)})}},{key:"_clearCachedData",value:function(t,e){var i=this;this.clearHistoryID(t,function(r){r?i.clearCachedLabel(t,function(r){r?i.clearAccountThreadCache(t,e):e(!1)}):e(!1)})}},{key:"clearAccountThreadCache",value:function(t,e){var i=this;try{m.default.PAssert(1001,m.default.isString(t),"Must provide a valid account ID to clear thread cache for")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1002,m.default.isFunction(e),"Must provide valid CB function when clearing thread cache")}catch(r){m.default.reportError(r)}this._threadCache.getFilterEntries(function(e){return e.accountID===t},function(r){if(r){var a=0;m.default.log("Clearing account thread cache: "+t);for(var n=0;n<r.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=r[n];if(i._threadCache.removeEntry(o.id),o.messages)for(var u=0,s=0;s<o.messages.length;++s){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;i._rawCache.removeEntry(o.messages[s].id)}}e(!0)}else e(!1)})}},{key:"requestDataPage",value:function(t,e){m.default.log("Data Page: ",t.hasPaginationToken()),t.hasPaginationToken()&&!t.paginationTokenInUse()?this._requestRemoteThreads(void 0,Oe,t,void 0,25,void 0,void 0,e):e(!0)}},{key:"_requestRemoteThreads",value:function(t,e,i,r,a,n,o,u){var s,h=arguments,d=this;if(i&&i.hasPaginationToken()&&!i.paginationTokenInUse()){s=i.beginDataPageLoad();try{m.default.PAssert(1005,!r,"Should not define a new q for paged token")}catch(p){m.default.reportError(p)}try{m.default.PAssert(1006,!o,"Should not define a new entryCB for paged token")}catch(p){m.default.reportError(p)}if(r=s.getQuery(),a=s.getMaxResults(),o=s.getEntryCB(),u){var c=u;u=function(){s.getDoneCB().apply(null,h),c.apply(null,h)}}else u=s.getDoneCB();t=t||s.getInfo().accountID}else i&&i.needsPaginationToken()&&(s=this.createPaginationToken(void 0,r,{accountID:t},a,o,u),i.setPaginationToken(s),i.beginDataPageLoad());a=a||25;try{m.default.PAssert(1007,o&&m.default.isFunction(o),"Must define a valid entry callback")}catch(p){m.default.reportError(p)}try{m.default.PAssert(1008,u&&m.default.isFunction(u),"Must define a valid done callback")}catch(p){m.default.reportError(p)}var v,y,g=Pt.a.fns("gmail").users.threads.list.packedFn,l={userId:t,maxResults:a,timeoutMS:n,q:r,pageToken:s&&s.hasMorePages()?s.getNextPageToken():void 0};s||!i?(v=function(e){if(e.nextPageToken&&s&&d.updatePaginationToken(s,e.nextPageToken),i&&s&&i.endDataPageLoad(!!e.nextPageToken),e.threads)for(var r=0,a=e.threads.length,n=0,h=0,c=function(t){t?(o(t),n++):(o(void 0),h++),n+h===a&&u(!0)},v=0;v<e.threads.length;++v){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var y=e.threads[v];d._requestRemoteThreadMetadata(t,y.id,void 0,c)}else u(!0)},y=function(e){i&&s&&i.endDataPageLoad(s),u(!1),d._notifyFailedRequest(t,e)}):(v=function(){u(!0)},y=function(e){u(!1),d._notifyFailedRequest(t,e)}),this._queueRemoteRequestMulti(t,g,l,v,y,void 0,e)}},{key:"_requestRemoteMessageData",value:function(t,e,i){var r=this;try{m.default.PAssert(1009,!t.isLocalOnlyAttachment(),"Should never request remote data for a local only attachment")}catch(o){m.default.reportError(o)}var a=Pt.a.fns("gmail").users.messages.get.packedFn,n={userId:t.getField("accountID"),id:e,format:"full"};this._queueRemoteRequestMulti(t.getField("accountID"),a,n,function(a){var n=r._parseMailMessage(a);try{m.default.PAssert(1010,n,"Must be able to parse message")}catch(o){m.default.reportError(o)}r._updateMessageData(t,e,n),i(!0)},function(e){i(!1,e),r._notifyFailedRequest(t.getField("accountID"),e)},void 0,di)}},{key:"_requestRemoteMessageDataRaw",value:function(t,e,i,r){var a=this,n=Pt.a.fns("gmail").users.messages.get.packedFn,o={userId:t,id:i,format:"full"};this._queueRemoteRequestMulti(t,n,o,r,function(e){r(void 0,e),a._notifyFailedRequest(t,e)},void 0,di)}},{key:"_requestRemoteThreadDataRaw",value:function(t,e,i){var r=this,a=Pt.a.fns("gmail").users.threads.get.packedFn,n={userId:t,id:e,format:"full"};this._queueRemoteRequestMulti(t,a,n,i,function(e){i(void 0,e),r._notifyFailedRequest(t,e)},void 0,Ke)}},{key:"_requestRemoteThreadMetadata",value:function(t,e,i,r){var a=this,n=Pt.a.fns("gmail").users.threads.get.packedFn,o={userId:t,id:e,format:"metadata"};this._queueRemoteRequestMulti(t,n,o,function(t){r(t)},function(e){r(void 0,e),a._notifyFailedRequest(t,e)},i,xe)}},{key:"_persistRemoteSnoozeTask",value:function(t,e){var i=t.getData();m.default.XHR_PrivateAPI({type:"POST",path:"/tasks/snoozeMail",data:i,requireAuth:!0,autoRetry:!1,cb:this._handleRemotePersist.bind(this,e)})}},{key:"_cancelDeferredSnoozeTask",value:function(t,e){var i=t.getData();m.default.XHR_PrivateAPI({type:"POST",path:"/tasks/snoozeMail/cancel",data:i,requireAuth:!0,autoRetry:!1,cb:function(t){e(t.status===A.a.HTTPStatusCode.Success)}})}},{key:"_persistRemoteSendMailTask",value:function(t,e){var i=t.getData();m.default.XHR_PrivateAPI({type:"POST",path:"/tasks/sendMail",data:i,requireAuth:!0,autoRetry:!1,cb:this._handleRemotePersist.bind(this,e)})}},{key:"_cancelDeferredSendMailTask",value:function(t,e){var i=t.getData();m.default.XHR_PrivateAPI({type:"POST",path:"/tasks/sendMail/cancel",data:i,requireAuth:!0,autoRetry:!1,cb:function(t){e(t.status===A.a.HTTPStatusCode.Success)}})}},{key:"_handleRemotePersist",value:function(t,e){if(e.status!==A.a.HTTPStatusCode.Success)return t(!1);try{return t(!0,JSON.parse(e.response).data.messageID)}catch(i){return m.default.reportError(i),t(!1)}}},{key:"_parseMailThread",value:function(t,e){for(var i=0,r=[],a=0;a<e.messages.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=this._parseMailMessage(e.messages[a]);try{m.default.PAssert(1011,n,"Must be able to parse each message")}catch(u){m.default.reportError(u)}n&&r.push(n)}var o=t.getField("messages");this._mergeMessagesData(o,r,["labelIds","draftID"]),t.updateField("dataLoaded",!0),t.updateField("messages",r),this._updateAttachmentFromMessages(t,A.a.ChangeType.Remote)}},{key:"getAttachmentURL",value:function(t,e,i){return"https://mail.google.com/mail/b/"+t+"/?ui=2&view=att&disp=safe&zw"+("&th="+e)+("&attid="+i)}},{key:"getPreviewURL",value:function(t){return t.link}},{key:"reportMessage",value:function(t,e,i,r,a){var n=Pt.a.fns("gmail").users.messages.get.packedFn,o={userId:t,id:i,format:"full",forceNoDupe:!0};this._queueRemoteRequestMulti(t,n,o,this._sendReport.bind(this,a,r),function(){try{m.default.PAssert(1012,!1,"Failed to report message")}catch(t){m.default.reportError(t)}},void 0,di)}},{key:"dumpMessage",value:function(t,e,i){var r=this.getAttachment(e),a=this._getMessageFromAttachment(r,i);console.log("Message Dump: ",a)}},{key:"_sanitizeMessage",value:function(t){if(t.parts)for(var e=0,i=0;i<t.parts.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._sanitizeMessage(t.parts[i])}if(t.body&&t.body.data){var r=this._runDecodeEmail(t);r&&r.mimeType===Ti?t.body.data=this._encodeEmail(ze.a.sanitizeContent(r.decoded)):t.body.data=this._encodeEmail(ze.a.sanitizePlaintext(r.decoded))}if(t.headers)for(var a=0,n=0;n<t.headers.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=t.headers[n];switch(o.name.toUpperCase()){case"TO":case"CC":case"BCC":case"FROM":o.value=o.value.replace(/[A-Za-z0-9]/g,"#");break;case"SUBJECT":case"SNIPPET":o.value=new Array(o.name.length+1).join("#")}}}},{key:"_sendReport",value:function(t,e,i){try{m.default.PAssert(1013,m.default.isBoolean(t),"Must provide a valid boolean for sendContent")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1014,m.default.isString(e),"Must provide a valid description string")}catch(a){m.default.reportError(a)}try{m.default.PAssert(1015,m.default.isObject(i),"Must provide valid raw data")}catch(a){m.default.reportError(a)}try{m.default.log("Sending Message Report",i),t||this._sanitizeMessage(i.payload);var r={description:e,payload:i.payload};m.default.reportError(new Error("Report Message"),r)}catch(n){m.default.reportError(n)}}},{key:"loadResource",value:function(t,e,i,r){if(this.hasCacheData(t)){var a=this.getAttachment(t),n=this._getMessageFromAttachment(a,e).resources.find(i);n?(n.data?r(n,i):this._requestRemoteAttachment(a.getField("accountID"),e,n.id,function(t,e){t&&(n.data=t,n.size=e),r(n,i)}),this.sendEvent("FetchAttachment")):r(void 0,i)}else r(void 0,i)}},{key:"_requestRemoteAttachment",value:function(t,e,i,r){var a=this,n=Pt.a.fns("gmail").users.messages.attachments.get.packedFn,o={id:i,messageId:e,userId:t};this._queueRemoteRequestMulti(t,n,o,function(t){r(t.data.replace(/-/g,"+").replace(/_/g,"/"),t.size)},function(e){r(void 0),a._notifyFailedRequest(t,e)},void 0,hi)}},{key:"_parseAttachment",value:function(t,e,i){try{m.default.PAssert(1016,t,"Must have valid multipart lib")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1017,i.body,"Must have a valid attachment body")}catch(l){m.default.reportError(l)}try{m.default.PAssert(1018,i.body.attachmentId,"Must have a valid attachment ID")}catch(l){m.default.reportError(l)}var r,a,n,o,u,s="0."+i.partId;if(i.headers)for(var h=0,d=0;d<i.headers.length;++d){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var c=i.headers[d];switch(c.name.toUpperCase()){case"CONTENT-ID":var v=/^<(.*)>$/.exec(c.value);a=r=v?v[1]:c.value;break;case"CONTENT-TRANSFER-ENCODING":u=c.value;break;case"CONTENT-DISPOSITION":var y=c.value.split(";");o=y[0]?y[0].toLowerCase():void 0;break;case"X-ATTACHMENT-ID":n=c.value}}r&&o!==Xi||!i.filename?!r&&i.body.attachmentId&&(r=i.body.attachmentId):r=i.filename;try{m.default.PAssert(1019,r,"Must be able to find a valid resource ID")}catch(l){m.default.reportError(l)}var g={cid:r,rawContentID:a,id:i.body.attachmentId,attID:s,realAttrID:n,data:void 0,size:i.body.size,uploader:void 0,disposition:o,parentType:e.mimeType,mimeType:i.mimeType,contentEncoding:u};t.add(g)}},{key:"_decodeFlowed",value:function(t,e){return t.split(/\r?\n/).reduce(function(t,i,r){var a=t;return e&&(a=a.replace(/[ ]+$/,"")),/ $/.test(t)&&!/(^|\n)\-\- $/.test(t)||1===r?a+i:a+"\n"+i}).replace(/^ /gm,"")}},{key:"_decodeEmail",value:function(t,e,i){try{m.default.PAssert(1020,m.default.isString(t),"Passing in an invalid string to decode")}catch(a){m.default.reportError(a)}var r;if(t)try{r=m.default.b64_to_utf8(t),"FLOWED"===i.format&&(r=this._decodeFlowed(r,i.delSp))}catch(n){m.default.reportError(n)}return r}},{key:"_encodeEmail",value:function(t){var e;try{e=m.default.utf8_to_b64(t)}catch(i){m.default.reportError(i)}return e}},{key:"_runDecodeEmail",value:function(t){try{m.default.PAssert(1021,t&&t.body,"Must pass in a valid part")}catch(o){m.default.reportError(o)}var e,i=this._getHeader(t,"Content-Transfer-Encoding"),r=!1;if(Bi.indexOf(t.mimeType)>=0)return{decoded:e=this._generateMessageDisplayNode(t),mimeType:Ti,contentType:"text/html;charset=utf-8",name:"GeneratedContent",hasError:r};var a=this._getHeader(t,"Content-Type")||"text/html;charset=utf-8";try{m.default.PAssert(1022,a,"Must have a valid contentType")}catch(o){m.default.reportError(o)}var n=this._sanitizeContentType(a);return t.body&&t.body.data?e=this._decodeEmail(t.body.data,i,n):t.body&&t.body.attachmentId?e='<a href="attach:'+t.body.attachmentId+'">Load Message</a>':(e="Unable to decode email content",r=!0),{decoded:e,mimeType:t.mimeType,contentType:n.type,name:n.name,hasError:r}}},{key:"_runDecodeMessage",value:function(t){var e=this._decodeMessagePart(t);return 0===e.length&&t?Ji.indexOf(t.mimeType)>=0?[this._runDecodeEmail(t)]:Bi.indexOf(t.mimeType)>=0?[this._runDecodeEmail(t)]:[]:e}},{key:"_decodeMessagePart",value:function(t){var e=[];if(t)if(t.mimeType===Ii||t.mimeType===Pi||t.mimeType===Ci)for(var i=0,r=0;r<t.parts.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var a=this._decodeMessagePart(t.parts[r]);e.pushArray(a)}else if(t.mimeType===Fi||t.mimeType===Li||t.mimeType===Li||t.mimeType===Hi)for(var n=0,o=t.parts.length-1;o>=0;o--){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(this._isValidDisplayPart(t.parts[o])){var u=this._decodeMessagePart(t.parts[o]);if(u.length>0){e.pushArray(u);break}}}else this._isValidDisplayPart(t)&&e.push(this._runDecodeEmail(t));return e}},{key:"_combineMessageParts",value:function(t){var e="",i=Gi,r="text/html;charset=utf-8",a=!1;if(t&&t.length>0){var n=0;i=t[0].mimeType,r=t[0].contentType;for(var o=0;o<t.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;Zi.indexOf(t[o].mimeType)<0&&(a=!0)}e=ze.a.combineParts(t)}else e=" ";return i===Gi&&(i=Ti,r=Ti+";charset="+r.split(";charset=")[1]),{decoded:e,mimeType:i,contentType:r,reportMessage:a}}},{key:"_isValidDisplayPart",value:function(t){var e=!1;return!this._isResourcePart(t)&&Ji.indexOf(t.mimeType)>=0&&(e=!0),e}},{key:"_isResourcePart",value:function(t){var e=!1;return t.filename?e=!0:this._getHeader(t,"CONTENT-ID")&&(this._getHeader(t,"CONTENT-DISPOSITION")||Ji.indexOf(t.mimeType)<0)&&(e=!0),e}},{key:"_parseMessagePart",value:function(t,e){var i=0,r=0,a={parent:e,raw:t,mimeType:t.mimeType,children:[],resources:[]};switch(t.mimeType){case Gi:case Ti:case Mi:break;case Li:case Ci:case zi:case Fi:case Ni:case Pi:case Di:case Ii:for(var n=0;n<t.parts.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=t.parts[n],u=this._parseMessagePart(o,a);this._isResourcePart(o)?a.resources.push(u):a.children.push(u)}break;case Hi:for(var s=0;s<t.parts.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var h=this._parseMessagePart(t.parts[s],a);a.children.push(h)}break;default:var d=t.mimeType.split("/")[0];Qi.indexOf(d)<0&&(m.default.log("Unknown Part Mimetype: ",t),m.default.reportError(new Error("Unknown attachment mimetype: "+t.mimeType)))}return a}},{key:"_getMessageDisplay",value:function(t,e){var i=0;switch(t.mimeType){case Gi:case Ti:case Ii:case Pi:case Ni:e.push(t);break;case Fi:case Li:case Hi:case Ci:for(var r=0;r<t.children.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._getMessageDisplay(t.children[r],e)}break;case qi:case ji:break;case zi:case Vi:case Di:e.push(t);break;default:try{m.default.PAssert(1023,!1,"Should never have an unknown multipart mimetype in the tree: ",t.mimeType)}catch(a){m.default.reportError(a)}}}},{key:"_getResourcesForNode",value:function(t,e){for(var i=0,r=t.resources,a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=r[a].raw;this._parseAttachment(e,t,n)}t.raw&&t.raw.body&&t.raw.body.attachmentId&&this._parseAttachment(e,t.parent,t.raw)}},{key:"_getResourcesForPart",value:function(t){var e=0,i=new qe;if(t.mimeType===Ii||t.mimeType===Pi)for(var r=0,a=0;a<t.children.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this._getResourcesForNode(t.children[a],i)}for(;t;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._getResourcesForNode(t,i),t=t.parent}return i}},{key:"_displayAttachment",value:function(t,e){var i=!1;return t.cid===e&&(t.disposition===Xi?i=!0:t.disposition===Yi&&t.parentType===Ii&&(i=!0)),i}},{key:"getMessageAttachments",value:function(t){var e=this,i=[];return t.resources.forEachResource(function(t){e._displayAttachment(t,t.cid)&&i.push(t)}),i}},{key:"getMessageDisplayAttachments",value:function(t){var e,i=0,r=this.getMessageAttachments(t);if(t.initializedForDisplay)e=t.specialLinks?t.specialLinks.attachments:[];else{var a={ignoreQuotedAttachments:!!(t.labelIds.indexOf(Je.DRAFT)>=0)};e=ze.a.getAttachmentLinks(t.decoded,a)}for(var n=0;n<e.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=e[n];if(!t.resources.has(o.name)){var u=this._createResource(t.resources,o);u.link=o.href,r.push(u)}}return r}},{key:"_verifyDKIM",value:function(t){var e;if(t)for(var i=0,r=t.split(";"),a=/([a-z]+)[=](.*)/i,n=0;n<r.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[n].trim();if(o){var u=a.exec(o);if(u)switch(e={},u[1]){case"d":e.domain=u[2];break;case"h":e.headers=u[2].split(":").map(Function.prototype.call,String.prototype.trim)}}}return e}},{key:"_sanitizeContentType",value:function(t){var e="text/html;charset=utf-8";try{var i,r,a,n,o=0,u=t.replace(/[\"\']/g,"").split(";"),s=u[0].trim().toLowerCase();try{m.default.PAssert(1024,s===Gi||s===Ti,"Unknown ContentType MediaType: "+s)}catch(g){m.default.reportError(g)}for(var h=1;h<u.length;++h){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var d=u[h].trim();if(d){var c=d.indexOf("=");if(c>=1){var v=d.substr(0,c).trim(),y=d.substr(c+1).trim();if(v&&y)switch(v.toUpperCase()){case"CHARSET":i=y;break;case"FORMAT":r=y.toUpperCase();break;case"DELSP":a="YES"===y.toUpperCase();break;case"NAME":n=y;break;case"BOUNDARY":break;default:try{m.default.PAssert(1025,!1,"Unknown param in ContentType: "+d)}catch(g){m.default.reportError(g)}}else try{m.default.PAssert(1026,!1,"Malformed contentType part: ",t)}catch(g){m.default.reportError(g)}}else try{m.default.PAssert(1027,!1,"Invalid contentType part: ",t)}catch(g){m.default.reportError(g)}}}i||(i="utf-8"),s&&i&&(e=s+";charset="+i)}catch(l){m.default.reportError(l)}return{type:e,format:r,delSp:a,name:n}}},{key:"_getHeader",value:function(t,e){var i;if(t&&t.headers)for(var r=0,a=0;a<t.headers.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(t.headers[a].name.toUpperCase()===e.toUpperCase()){i=t.headers[a].value;break}}return i}},{key:"_generateMessageDisplayNode",value:function(t){try{m.default.PAssert(1029,Bi.indexOf(t.mimeType)>=0,"Must be a valid mimeType to generate content from")}catch(r){m.default.reportError(r)}var e;if(t.body&&t.body.attachmentId)e='<a href="attach:'+t.body.attachmentId+'">Load Message</a>';else{var i;switch(t.mimeType){case Vi:case Di:case Ii:i="&nbsp;";break;case zi:i="Unable to display encrypted message content.";break;default:i="Unable to display unknown content type: "+t.mimeType}e="<html><body>"+i+"</body></html>"}return e}},{key:"_parseMailMessage",value:function(t){var e;try{e=this._parseMailMessageInternal(t)}catch(i){m.default.reportError(i)}return e}},{key:"_parseMailMessageInternal",value:function(t){var e=0,i={},r=t.payload,a=!!r.body&&r.body.size>0;try{m.default.PAssert(1030,a!==r.mimeType.startsWith("multipart/")||r.mimeType===Ci,"Checking the body size should be the same as checking whether this is a multipart message")}catch(k){m.default.reportError(k)}this._verifyDKIM(this._getHeader(t.payload,"DKIM-Signature"));for(var n,o,u=t.payload.headers,s=0;s<u.length;++s){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var h=u[s];switch(h.name.toUpperCase()){case"FROM":t.from=this.parseEmailAddress(h.value);break;case"REPLY-TO":t.replyTo=this.parseEmailAddress(h.value);break;case"TO":t.to=this.parseEmailAddresses(h.value);break;case"CC":t.cc=this.parseEmailAddresses(h.value);break;case"BCC":t.bcc=this.parseEmailAddresses(h.value);break;case"SUBJECT":t.subject=h.value;break;case"DATE":t.date=this.parseDateHeader(h.value);try{m.default.PAssert(1031,m.default.isDateValid(t.date),"Must have a valid message date: ",t.date)}catch(k){m.default.reportError(k)}break;case"MESSAGE-ID":t.messageID=h.value;break;case"REFERENCES":t.references=h.value;break;case"IN-REPLY-TO":t.inReplyTo=h.value;break;case"LIST-UNSUBSCRIBE":t.listUnsubscribe=h.value;break;default:0}}if(t.messageID||(t.messageID=m.default.generateTempId()),a)o=r;else{var d,c=0,v=this._parseMessagePart(r),y=[];this._getMessageDisplay(v,y);for(var g=y.length-1;!d&&g>=0;g--){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;if(Ji.indexOf(y[g].mimeType)>=0)d=y[g];else if(Bi.indexOf(y[g].mimeType)>=0)d=y[g];else{m.default.log("Unknown bestNode mimepart: ",y[g]);try{m.default.PAssert(1032,!1,"Unknown mimePart display type: ",y[g].mimeType)}catch(k){m.default.reportError(k)}}}d?(n=this._getResourcesForPart(d),o=d.raw):this._sendReport(!1,"Missing bestNode",t)}try{m.default.PAssert(1033,o,"Must have found a valid message part to display")}catch(k){m.default.reportError(k)}var l=this._runDecodeMessage(o);try{m.default.PAssert(1034,l.length>0,"Should have at least one decoded message part available")}catch(k){m.default.reportError(k)}if(0===l.length)try{var p=JSON.parse(JSON.stringify(t));this._sendReport(!0,"No valid decoded part",p)}catch(A){m.default.reportError(A)}var f=this._combineMessageParts(l);f&&(i={id:t.id,labelIds:t.labelIds,messageID:t.messageID,decoded:f.decoded,mimeType:f.mimeType,contentType:f.contentType,from:t.from,to:t.to||[],cc:t.cc,bcc:t.bcc,snippet:t.snippet,subject:t.subject||"",date:t.date,internalDate:t.internalDate?new Date(m.default.parseInt(t.internalDate)):new Date,references:t.references,inReplyTo:t.inReplyTo,listUnsubscribe:t.listUnsubscribe,resources:n||new qe},f.reportMessage&&this._sendReport(!1,"Mismatch mimeType/contentType",t));return i}},{key:"parseEmailAddress",value:function(t){Ui.lastIndex=0;var e=Ui.exec(t),i={};if(e){var r=Ri.exec(e[1]);i.text=r?r[1]:e[1],i.email=e[2]}else i.email=t;return i.email&&(i.email=i.email.replace(/[\r\n]/g,"")),i.text&&(i.text=i.text.replace(/[\r\n]/g,"")),i}},{key:"parseEmailAddresses",value:function(t){for(var e=0,i=[],r=m.default.parseEmailAddresses(t),a=0;a<r.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=r[a];"contact"===n.type&&n.email&&i.push(n)}return i}},{key:"parseDateHeader",value:function(t){var e=new Date(t);return m.default.isDateValid(e)||(e=An.International.parseDate(t,A.a.DateFormat.MDY)),e}},{key:"runRemoteSearch",value:function(t,e,i,r){var a=this;try{m.default.PAssert(1036,t,"Must provide a valid search")}catch(f){m.default.reportError(f)}try{m.default.PAssert(1037,e,"Must provide a valid pane")}catch(f){m.default.reportError(f)}try{m.default.PAssert(1038,i,"Must provide a valid bucket ID")}catch(f){m.default.reportError(f)}try{m.default.PAssert(1039,m.default.isFunction(r),"Must provide a valid search callback")}catch(f){m.default.reportError(f)}var n="-in:chats -in:spam "+t,o=An.PaneManager.getPaneById(e),u=this._getAccountIDFromItem(o.getItem())||this.getDefaultAccount(),s=!1,h=0,d=0,c=new Bt(t,25,this.requestDataPage.bind(this)),v=function(t){if(h===d&&s){m.default.log("Done Searching: ",h);var n=t?A.a.SearchResultStatus.Error:h>0?A.a.SearchResultStatus.Done:A.a.SearchResultStatus.None;c.isValid()&&a.swapInSearchBucket(i,e),r(n)}},y=function(t){if(h++,t){var e=a._addRemoteEntry(u,t),r=a.getBucketItemStore(i);a._ensureVMLIsForSearchResult(e,r),d++}else d++;v()},g=function(t){s=!0,v(!t)},l=!1,p=new Ze(c.onEntry,function(t){c.onDone(t),l||(l=!0,c.isValid()&&c.hasResults()?c.getNextPage(y,g):g(t))});return this._requestRemoteThreads(u,be,void 0,n,25,void 0,p.getEntryCB(),p.getDoneCB()),c}},{key:"_addSearchCacheEntryInternal",value:function(t,e,i){var r=!1,a=this._ensureAccountLib(t,this._emailCache);return a[e]||(a[e]={}),a[e][i]||(a[e][i]=!0,r=!0),r}},{key:"_removeSearchCacheEntryInternal",value:function(t,e,i){var r,a=this._getAccountLib(t,this._emailCache);return a&&a[e]&&(r=a[e][i],delete a[e][i]),r}},{key:"_getSearchCacheLabelEntryInternal",value:function(t,e){var i,r=this._getAccountLib(t,this._emailCache);return r&&r[e]&&(i=r[e]),i}},{key:"_addEmailToSearchCache",value:function(t,e){var i=!1;if(e&&m.default.isArray(e.labelIds))for(var r=0,a=0;a<e.labelIds.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i=this._addSearchCacheEntryInternal(e.accountID,e.labelIds[a],t)||i}return i}},{key:"_removeEmailFromSearchCache",value:function(t,e){var i=!1;if(e&&m.default.isArray(e.labelIds))for(var r=0,a=0;a<e.labelIds.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=!!this._removeSearchCacheEntryInternal(e.accountID,e.labelIds[a],t);i=i||n,n&&this._removeThreadLabelVMLI(e.accountID,t,e.labelIds[a])}return i}},{key:"_addEmailLabelToSearchCache",value:function(t,e,i){return this._addSearchCacheEntryInternal(t,i,e)}},{key:"_removeEmailLabelFromSearchCache",value:function(t,e,i){var r=!!this._removeSearchCacheEntryInternal(t,i,e);return r&&this._removeThreadLabelVMLI(t,e,i),r}},{key:"runLocalItemSearch",value:function(t){var e=this.getDescriptorForItem(t.item),i=this._getSearchCacheLabelEntryInternal(e.accountID,e.labelID);if(i)for(var r in i)if(i.hasOwnProperty(r)){var a=this.getCacheData(r);try{m.default.PAssert(1040,a,"Must have valid data for search entry")}catch(o){m.default.reportError(o)}if(a){var n=this._ensureThreadLabelVMLI(a,e.labelID);t.comparator&&!t.comparator(n)||t.each&&t.each(n)}}}},{key:"getRemoteAttachmentData",value:function(t){var e=this;try{m.default.PAssert(1041,t.hasField("accountID"),"Must have a valid accountID for a thread")}catch(i){m.default.reportError(i)}if(t.hasField("accountID")){this._requestRemoteThreadMetadata(t.getField("accountID"),t.id,t,function(i,r){i?e._addRemoteEntry(t.getField("accountID"),i):(t.notifyDataRequestFailed(),e._notifyFailedRequest(t.getField("accountID"),r))})}else t.notifyDataRequestFailed()}},{key:"_updateThreadFromMessages",value:function(t){var e=0,i=this;try{m.default.PAssert(1042,!t.isDeleted||0===t.messages.length,"Should never run an update on a deleted thread with messages")}catch(v){m.default.reportError(v)}var r=t.labelIds,a=An.settings.getUserIdentifier();"me"===t.accountID&&"me"!==a&&(t.accountID=a),t.labelIds=[],t.date=void 0,t.participants=[],t.count=t.messages.length,t.snippet=t.count>0?t.messages[t.messages.length-1].snippet:"",t.hasPriority=!1;for(var n=0;n<t.messages.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=t.messages[n];try{m.default.PAssert(1043,o.id,"Each message must have a valid ID")}catch(v){m.default.reportError(v)}t.labelIds.pushOnlyUniques(o.labelIds);var u=o.labelIds.indexOf(Je.DRAFT)>=0,s=!1;if(o.labelIds.indexOf(Je.SENT)>=0)for(var h=0,d=0;d<o.to.length;++d){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var c=o.to[d];if(this.isMyAccountID(c.email)){s=!0;break}}else s=!0;if((!t.date||o.date&&t.date.isBefore(o.date)&&!u&&s)&&(t.date=o.date),(!t.internalDate||o.internalDate&&t.internalDate.isBefore(o.internalDate))&&(t.internalDate=o.internalDate),o.from&&t.participants.indexOfWithProperty("email",o.from.email)<0&&t.participants.push(o.from),o.resources instanceof qe)o.resources.forEachResource(function(e){i._displayAttachment(e,e.cid)&&(t.hasAttachments=!0)});else try{m.default.PAssert(1044,!1,"Message must always be a resource lib")}catch(v){m.default.reportError(v)}}return t.date=t.date?new Date(t.date):new Date(0),m.default.isDateValid(t.date)||(t.date=new Date(0)),t.internalDate=t.internalDate?new Date(t.internalDate):new Date,m.default.isDateValid(t.internalDate)||(t.internalDate=new Date),t.lastModifiedDate=t.lastModifiedDate?new Date(t.lastModifiedDate):t.date,m.default.isDateValid(t.lastModifiedDate)&&!t.lastModifiedDate.isBefore(t.date)||(t.lastModifiedDate=t.date),t.messages.length>0&&(t.subject=t.messages[0].subject,t.subjectLower=t.subject.toLowerCase(),t.from=t.messages[t.messages.length-1].from,t.to=t.messages[0].to),{labelsAdded:r?t.labelIds.removeArray(r):t.labelIds,labelsRemoved:r?r.removeArray(t.labelIds):void 0}}},{key:"_updateAttachmentFromMessages",value:function(t,e){var i=this._updateThreadFromMessages(t.getData());this._handleThreadLabelUpdates(t.getData(),i.labelsAdded,i.labelsRemoved),t.notifyDataMutated(["labelIds","date","lastModifiedDate","count","snippet","subject","subjectLower","hasAttachments","from","to"],e)}},{key:"_createRemoteEntry",value:function(t,e){for(var i=0,r={id:e.id,accountID:t,messages:[],labelIds:[]},a=0;a<e.messages.length;++a){var n=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=e.messages[a];try{m.default.PAssert(1045,o.id,"Message must have a valid id")}catch(d){m.default.reportError(d)}try{m.default.PAssert(1046,!o.labelIds||o.labelIds.indexOf(Je.CHAT)<0,"Should never receive a chat message")}catch(d){m.default.reportError(d)}o.labelIds&&o.labelIds.indexOf(Je.DRAFT)>=0&&this._notifyDraftMessage(t,e.id,o.id);for(var u={id:o.id,messageID:void 0,internalDate:o.internalDate?new Date(m.default.parseInt(o.internalDate)):new Date,snippet:o.snippet,labelIds:o.labelIds||[],to:[],resources:new qe,subject:""},s=0;s<o.payload.headers.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var h=o.payload.headers[s];switch(h.name.toUpperCase()){case"TO":u.to=this.parseEmailAddresses(h.value);break;case"FROM":u.from=this.parseEmailAddress(h.value);break;case"SUBJECT":u.subject=h.value;break;case"MESSAGE-ID":u.messageID=h.value;break;case"IN-REPLY-TO":u.inReplyTo=h.value;break;case"DATE":u.date=this.parseDateHeader(h.value);try{m.default.PAssert(1047,m.default.isDateValid(u.date),"Must have a valid message date: ",h.value)}catch(d){m.default.reportError(d)}}}m.default.isDateValid(u.date)||(u.date=u.internalDate),u.subject||(u.subject=""),u.messageID||(u.messageID=m.default.generateTempId()),r.messages.push(u)}return this._updateThreadFromMessages(r),r}},{key:"_addRemoteEntry",value:function(t,e){var i=this._createRemoteEntry(t,e);if(this.hasCacheData(i.id)){var r=this.getCacheData(i.id);if(r){this._mergeThreadData(r,i);var a=this._updateThreadFromMessages(i);this._handleThreadLabelUpdates(i,a.labelsAdded,a.labelsRemoved)}var n=this.getChangedFields(r,i);if(this.cacheData(i.id,i,!!r,n),this.fieldsHaveParseEffect(n))if(this.hasAttachment(i.id))this.getAttachment(i.id).notifyDataMutated(n,A.a.ChangeType.Remote)}else this.cacheData(i.id,i),this._updateSearchPanes(i,i.labelIds,[]);return i}},{key:"cacheData",value:function(t,i,r,a){this._verifyMessageState(i,!1);var n=this._addEmailToSearchCache(t,i);if(g()(v()(e.prototype),"cacheData",this).call(this,t,i,r,a),i.messages&&this._checkUnsyncdMessageContent(i),n){var o=this.getDefaultItemStore();o&&o.updateItems()}}},{key:"cacheThreadData",value:function(t,e){this._verifyMessageState(e,!0),this._threadCache.cacheEntry(t,e)}},{key:"_verifyMessageState",value:function(t,e){}},{key:"createEntryFromLocal",value:function(t,e){var i=0;e.subjectLower=e.subject.toLowerCase(),e.messages=e.messages||[];for(var r=0;r<e.messages.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var a=e.messages[r];if(m.default.isString(a.date)?a.date=this.parseDateHeader(a.date):a.date||(a.date=new Date),m.default.isString(a.internalDate)?a.internalDate=new Date(a.internalDate):a.internalDate||(a.internalDate=new Date),a.to||(a.to=[]),a.resources){var n=a.resources;if(n instanceof qe)a.resources=n.clone();else for(var o in a.resources=new qe,n)n.hasOwnProperty(o)&&a.resources.add(n[o])}else a.resources=new qe;try{m.default.PAssert(1052,a.draftID||a.messageID||m.default.isTempId(a.id),"Remotely saved messages must have a valid message ID")}catch(u){m.default.reportError(u)}try{m.default.PAssert(1053,m.default.isDateValid(a.date),"Must have a valid message date: ",a.date)}catch(u){m.default.reportError(u)}try{m.default.PAssert(1054,m.default.isDateValid(a.internalDate),"Must have a valid internal message date: ",a.internalDate)}catch(u){m.default.reportError(u)}!m.default.isTempId(a.id)&&!a.draftID&&a.labelIds&&a.labelIds.indexOf(Je.DRAFT)>=0&&this._notifyDraftMessage(e.accountID,t,a.id),a.decoded&&this.reportTrackedStat($e.MessageDataCached)}return this._updateThreadFromMessages(e),e}},{key:"_updateMessageData",value:function(t,e,i){var r=t.getField("messages"),a=r.indexOfWithProperty("id",e);try{m.default.PAssert(1055,a>=0,"Must always be able to find the message being updated")}catch(n){m.default.reportError(n)}a>=0&&(this._mergeMessageData(r[a],i,["labelIds"]),r[a]=i,t.updateField("messages",r),this._updateAttachmentFromMessages(t,A.a.ChangeType.Remote))}},{key:"_mergeMessageData",value:function(t,e,i){try{m.default.PAssert(1056,m.default.isObject(t),"Must pass in a valid old message")}catch(h){m.default.reportError(h)}try{m.default.PAssert(1057,m.default.isObject(e),"Must pass in a valid new message")}catch(h){m.default.reportError(h)}if(t.modifiedOffline){var r=0,a=t.modifiedOffline;try{m.default.PAssert(1058,m.default.isArray(a),"Should not be receiving an update for an event that was created locally")}catch(h){m.default.reportError(h)}for(var n=0;n<a.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e[a[n]]=t[a[n]]}e.modifiedOffline=t.modifiedOffline}if(i)for(var o=0,u=0;u<i.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;t.hasOwnProperty(i[u])&&(e[i[u]]=t[i[u]])}for(var s in t)if(t.hasOwnProperty(s))switch(s){case"snippet":this._pendingDraftUpdates[t.id]&&(e[s]=t[s]);break;default:e.hasOwnProperty(s)||(e[s]=t[s])}}},{key:"_mergeMessagesData",value:function(t,e,i){var r=0;try{m.default.PAssert(1059,m.default.isArray(t),"Must have a valid old messages array")}catch(c){m.default.reportError(c)}try{m.default.PAssert(1060,m.default.isArray(e),"Must have a valid new messages array")}catch(c){m.default.reportError(c)}try{m.default.PAssert(1061,t!==e,"Should not pass in the same array for old and new")}catch(c){m.default.reportError(c)}for(var a=0;a<t.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=t[a],o=e.indexOfWithProperty("id",n.id);if(o>=0){var u=e[o];try{m.default.PAssert(1062,u,"Must have a valid new message")}catch(c){m.default.reportError(c)}this._mergeMessageData(n,u,i)}else if(n.labelIds.indexOf(Je.DRAFT)>=0)if(m.default.isTempId(n.id)){var s=e.indexOfWithProperty("messageID",n.inReplyTo);try{m.default.PAssert(1063,s>=0,"Must be able to find the message being replied to")}catch(c){m.default.reportError(c)}s>=0&&e.splice(s+1,0,n)}else if(n.inReplyTo){var h=e.indexOfWithProperty("inReplyTo",n.inReplyTo);if(h>=0){var d=e[h];try{m.default.PAssert(1064,d,"Must have a valid new message")}catch(c){m.default.reportError(c)}this._mergeMessageData(n,d,i)}}}}},{key:"_mergeThreadData",value:function(t,e){this.reportTrackedStat($e.MergeThread);try{m.default.PAssert(1066,!t.isDeleted,"Should never merge message data in a deleted thread")}catch(u){m.default.reportError(u)}if(this._mergeMessagesData(t.messages,e.messages,["resources","draftID"]),t.modifiedOffline){var i=0,r=t.modifiedOffline;try{m.default.PAssert(1067,m.default.isArray(r),"Should not be receiving an update for an event that was created locally")}catch(u){m.default.reportError(u)}for(var a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=r[a];switch(n){case"messages":break;default:e[n]=t[n]}}e.modifiedOffline=t.modifiedOffline}for(var o in t)e.hasOwnProperty(o)||(e[o]=t[o]);e.labelIds=t.labelIds}},{key:"_shouldCacheThread",value:function(t){for(var e=0,i=!0,r=0;r<t.messages.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=t.messages[r];if(a.labelIds&&(a.labelIds.indexOf(Je.SPAM)>=0||a.labelIds.indexOf(Je.CHAT)>=0)){i=!1;break}}return i}},{key:"_shouldCacheMessageData",value:function(t){var e=!1,i=this._getFullSyncTime(),r=this._getUnreadSyncTime();if(t.date.isAfter(i))e=!0;else if(t.date.isAfter(r))for(var a=0,n=0;n<t.messages.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=t.messages[n];if(this.isPriorityData(o)){e=!0;break}}return e}},{key:"refreshThreadCacheData",value:function(t,e,i,r,a){var n=this;this._requestRemoteThreadMetadata(t,e,void 0,function(i,o){if(i)if(n._shouldCacheThread(i)){var u=n._addRemoteEntry(t,i);n.cacheThreadData(e,n.serializeExternalData(u)),a&&a(!0)}else n._deleteCachedThread(t,e,a);else o&&o.error&&o.error.code===A.a.HTTPStatusCode.NotFound?n._deleteCachedThread(t,e,a):(r(t,e),a&&a(!1))})}},{key:"_deleteCachedThread",value:function(t,e,i){if(this.hasCacheData(e)){for(var r=0,a=this.getAttachment(e),n=a.getField("messages"),o=0;o<n.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;An.menus.isComposeOpenForEmail(n[o].id)&&(this._clearPendingDraftUpdate(a,n[o].id),k.a.fireEvent("EmailCompose","onClosed",[]),An.menus.closeComposeEmail(a,n[o])),this._rawCache.removeEntry(n[o].id)}a.updateField("isDeleted",!0),a.updateField("messages",[]),this._updateAttachmentFromMessages(a,A.a.ChangeType.Remote)}this._threadCache.removeEntry(e,function(t){try{m.default.PAssert(1068,t,"Should be able to delete the thread from the local thread cache")}catch(e){m.default.reportError(e)}i&&i(t)})}},{key:"_deleteCachedMessage",value:function(t,e,i){var r=this;try{m.default.PAssert(1069,i,"Must specify a valid message ID to remove from thread")}catch(s){m.default.reportError(s)}if(this.hasCacheData(e))for(var a=0,n=this.getAttachment(e),o=n.getField("messages"),u=0;u<o.length;++u){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(o[u].id===i){o.removeAt(u),this._updateAttachmentFromMessages(n,A.a.ChangeType.Remote),n.updateField("messages",o);break}}this._threadCache.getEntry(e,function(t){if(t)for(var a=0,n=0;n<t.messages.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(t.messages[n].id===i){t.messages.removeAt(n),r.cacheThreadData(e,t);break}}}),this._rawCache.removeEntry(i)}},{key:"setLastModifiedDate",value:function(t,e,i){var r=this;this.hasCacheData(e)&&this.getAttachment(e).updateField("lastModifiedDate",i);this._threadCache.getEntry(e,function(t){t&&(t.lastModifiedDate=i,r.cacheThreadData(e,t))})}},{key:"addLabelsToMessage",value:function(t,e,i,r,a){var n=this;if(this.hasCacheData(e)){for(var o=0,u=this.getAttachment(e),s=u.getField("messages"),h=0;h<s.length;++h){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if((!i||s[h].id===i)&&(s[h].labelIds.pushOnlyUniques(r),i))break}this._updateAttachmentFromMessages(u,a),u.updateField("messages",s)}this._threadCache.getEntry(e,function(t){if(t){for(var a=0,o=!1,u=0;u<t.messages.length;++u){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!i||t.messages[u].id===i){t.messages[u].labelIds.pushOnlyUniques(r),n.cacheThreadData(e,t),o=!0;break}}try{m.default.PAssert(1071,o,"Must have found message to add labels to")}catch(s){m.default.reportError(s)}}})}},{key:"removeLabelsFromMessage",value:function(t,e,i,r,a){var n=this;if(this.hasCacheData(e)){for(var o=0,u=this.getAttachment(e),s=u.getField("messages"),h=0;h<s.length;++h){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(!i||s[h].id===i){for(var d=0,c=0;c<r.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;s[h].labelIds.remove(r[c])}if(i)break}}this._updateAttachmentFromMessages(u,a),u.updateField("messages",s)}this._threadCache.getEntry(e,function(t){if(t){for(var a=0,o=!1,u=0;u<t.messages.length;++u){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(!i||t.messages[u].id===i){for(var s=0,h=0;h<r.length;++h){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;t.messages[u].labelIds.remove(r[h])}n.cacheThreadData(e,t),o=!0;break}}try{m.default.PAssert(1072,o,"Must have found message to remove labels from")}catch(d){m.default.reportError(d)}}})}},{key:"changeMessageAccount",value:function(t,e,i,r,a,n){try{m.default.PAssert(1073,n,"Must supply a valid from contact")}catch(s){m.default.reportError(s)}var o=r!==t.getField("accountID"),u=this._findDraft(t,e,i);return o&&this.discardDraft(t,u.id,u.draftID,function(t){try{m.default.PAssert(1074,t,"Must successfully delete remote draft")}catch(s){m.default.reportError(s)}}),u.from=n,u.replyTo=this.getReplyToAddress(n.email),u.decoded=ze.a.replaceSignature(u.decoded,this.getSignature(a)),o?this.createDraft(r,void 0,void 0,u):this.updateDraft(t,u.id,u.draftID,u,u.snippet,!0,!0,function(t){try{m.default.PAssert(1075,t,"Must be able to successfully update the draft when swiching sending accounts")}catch(s){m.default.reportError(s)}})}},{key:"_ensureVMLIsForSearchResult",value:function(t,e){try{m.default.PAssert(1076,e,"Should never be ensuring a search VMLI in the default item store")}catch(o){m.default.reportError(o)}var i="S~"+t.accountID,r=this._ensureVMLIsForAccount(i,e),a=this._createThreadID(i,"",t.id);if(!e.hasItem(a)){var n=e.createItem(a,this._getTextForItem(t),r.id);r.insertSorted(n,this.sortFn)}}},{key:"_removeVMLIFromSearchResult",value:function(t,e){try{m.default.PAssert(1077,e,"Should never be ensuring a search VMLI in the default item store")}catch(a){m.default.reportError(a)}var i="S~"+t.accountID,r=this._createThreadID(i,"",t.id);e.hasItem(r)&&e.destroyItem(r)}},{key:"_createThreadID",value:function(t,e,i){return"T~"+t+"~"+e+"~"+i}},{key:"_getItemProps",value:function(t,e){var i;return e.isNamed(Si.PRI0)?i={priority:A.a.VMLIFlag.P0}:e.isNamed(Si.PRI1)?i={priority:A.a.VMLIFlag.P1}:e.isNamed(Si.PRI2)&&(i={priority:A.a.VMLIFlag.P2}),i}},{key:"_ensureThreadLabelVMLI",value:function(t,e,i){i=i||this.getDefaultItemStore();var r,a=this._getLabelByID(t.accountID,e),n=this._ensureVMLIsForLabel(t.accountID,a,i),o=this._createThreadID(t.accountID,e,t.id);if(this.reportTrackedStat($e.EnsureLabelVMLI),i.hasItem(o))r=i.getItem(o);else{this.reportTrackedStat($e.CreateLabelVMLI);var u=this._getItemProps(t,a);r=i.createItem(o,this._getTextForItem(t),n.id,u),n.insertSorted(r,this.threadSortFn,!1)}return r}},{key:"_removeThreadLabelVMLI",value:function(t,e,i,r){r=r||this.getDefaultItemStore();var a=this._createThreadID(t,i,e);r.hasItem(a)&&r.destroyItem(a)}},{key:"_getRequiredSearchLabels",value:function(t){for(var e=0,i=[Je.INBOX],r=t.split(" "),a=0;a<r.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=r[a].split(":");n&&2===n.length&&("label"!==n[0]&&"category"!==n[0]&&"is"!==n[0]||i.push(n[1].toUpperCase()))}return i}},{key:"_handleThreadLabelUpdates",value:function(t,e,i){An.PaneUpdateBatcher.beginUpdateItems();var r=!1;if(e)for(var a=0,n=0;n<e.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;r=this._addEmailLabelToSearchCache(t.accountID,t.id,e[n])||r}if(i)for(var o=0,u=0;u<i.length;++u){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;r=this._removeEmailLabelFromSearchCache(t.accountID,t.id,i[u])||r}this._updateSpecialLabels(t),this._updateSearchPanes(t,e,i),r&&this.getDefaultItemStore().updateItems(),An.PaneUpdateBatcher.commitUpdateItems()}},{key:"_updateSearchPanes",value:function(t,e,i){var r=this;An.PaneUpdateBatcher.beginUpdateItems(),An.PaneManager.runForEachPane(function(a){if(a.isSearchingRemote()){var n=r.getActiveItemStore(a.id),o=a.search.getRemoteValue(),u=r._getRequiredSearchLabels(o),s=!1,h=!1;u.forEach(function(t){i&&i.indexOf(t)>=0?s=!0:e&&e.indexOf(t)>=0&&(h=!0)}),s?n!==r.getDefaultItemStore()&&(m.default.focusedPane===a&&0===e.length&&i&&1===i.length&&i[0]===Je.UNREAD||r._removeVMLIFromSearchResult(t,n)):h&&n!==r.getDefaultItemStore()&&r._ensureVMLIsForSearchResult(t,n)}},this.getPaneType()),An.PaneUpdateBatcher.commitUpdateItems()}},{key:"_updateSpecialLabels",value:function(t){this._threadIsArchived(t)?this._addEmailLabelToSearchCache(t.accountID,t.id,ki):this._removeEmailLabelFromSearchCache(t.accountID,t.id,ki),this._addEmailLabelToSearchCache(t.accountID,t.id,Ai)}},{key:"_ensureVMLIsForAccount",value:function(t,e){try{m.default.PAssert(1078,t,"Must specify a valid account ID")}catch(n){m.default.reportError(n)}var i="A~"+t,r=(e=e||this.getDefaultItemStore()).getItem(i);if(!r){var a=e.getRoot();r=e.createItem(i,t,a.id),a.insertSorted(r,this.sortFn)}return r}},{key:"_ensureVMLIsForLabel",value:function(t,e,i){try{m.default.PAssert(1079,e,"Must specify a valid label")}catch(s){m.default.reportError(s)}try{m.default.PAssert(1080,e instanceof Me,"Must pass in a valid label object")}catch(s){m.default.reportError(s)}i=i||this.getDefaultItemStore();var r="L~"+t+"~"+e.getLabelID(),a=i.getItem(r),n=e.getDisplayText(!0);if(a)a.getParsedText()!==n&&a.setText(n,A.a.ChangeType.Auto);else{var o;if(e.hasAncestors()){var u=this._getLabelByName(t,e.getParent().getRawName(),!0);o=u?this._ensureVMLIsForLabel(t,u,i):this._ensureVMLIsForAccount(t,i)}else o=this._ensureVMLIsForAccount(t,i);a=i.createItem(r,n,o.id),o.insertSorted(a,this.sortFn)}return a}},{key:"getVMLIForAccount",value:function(t){return this._ensureVMLIsForAccount(t)}},{key:"getVMLIForLabel",value:function(t,e){return this._ensureVMLIsForLabel(t,e)}},{key:"getLabelForVMLI",value:function(t){var e,i=this.getDescriptorForItem(t);return i.accountID&&i.labelID&&(e=this._getLabelByID(i.accountID,i.labelID)),e}},{key:"_getAccountIDFromItem",value:function(t){var e,i=t.id;i.startsWith("R~")&&(i=i.substr(2)),i.startsWith("A~")?(e=i.substr(2)).startsWith("S~")&&(e=e.substr(2)):i.startsWith("L~")?e=i.substring(2,i.indexOf("~",2)):i.startsWith("T~")&&(e=i.substring(2,i.indexOf("~",2)));try{m.default.PAssert(1081,!e||e.indexOf("~")<0,"Should not contain delim in label ID")}catch(r){m.default.reportError(r)}return e}},{key:"_getLabelIDFromItem",value:function(t){var e,i=t.id;i.startsWith("L~")?e=i.substr(i.indexOf("~",2)+1):i.startsWith("T~")&&(e=i.substr(i.indexOf("~",2)+1));try{m.default.PAssert(1082,!e||m.default.isTempId(e)||e.indexOf("~")<0,"Should not contain delim in label ID")}catch(r){m.default.reportError(r)}try{m.default.PAssert(1083,!e||e.length>3,"Label ID should be longer than a couple of chars")}catch(r){m.default.reportError(r)}return e}},{key:"_getThreadIDFromItem",value:function(t){return this._getThreadID(t.id)}},{key:"_getThreadID",value:function(t){var e;t.startsWith("T~")?e=t.substr(t.lastIndexOf("~")+1):t.startsWith("A~")||t.startsWith("L~")||t.startsWith("R~")||(e=t);try{m.default.PAssert(1084,!e||m.default.isTempId(e)||e.indexOf("~")<0,"Should not contain delim in thread ID")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1085,!e||e.length>3,"Thread ID should be longer than a couple of chars")}catch(i){m.default.reportError(i)}return e}},{key:"isAccountItem",value:function(t){return t.id.startsWith("A~")}},{key:"isLabelItem",value:function(t){return t.id.startsWith("L~")}},{key:"isThreadItem",value:function(t){return t.id.startsWith("T~")}},{key:"getAttachmentClass",value:function(){return["plugin_gmail"]}},{key:"googleScopes",value:function(){return[A.a.GScope.GmailModify,A.a.GScope.GmailCompose]}},{key:"getDependencies",value:function(){return[A.a.PluginDependency.GoogleLogin]}},{key:"verifyAuthorization",value:function(t){return!this.getSetting(this.Settings.IsEnabled)||this.isCurrentlyAuthorized(t)}},{key:"handleUnauthorized",value:function(t){this.removeSyncAccount(t)}},{key:"_activate",value:function(){var t=this;Rt.a.onActiveUser(function(e){t.hasSyncAccount(e)||t.addSyncAccount(e)})}},{key:"_deactivate",value:function(){}},{key:"handleTapStart",value:function(){return!0}},{key:"handleTapClick",value:function(t,e,i,r){var a=r.target;try{m.default.PAssert(1086,e,"Gmail tapped but is not actually a pane",m.default.getElementPath(a))}catch(n){m.default.reportError(n)}if(e&&(P.a.isMobile||P.a.mac&&r.metaKey||!P.a.mac&&r.ctrlKey||!this.isPluginPane(e)))return this.openEmailByItem(t,e)}},{key:"handleDoubleTap",value:function(t,e,i,r){return this.openEmailByItem(t,e),!0}},{key:"isMyAccountID",value:function(t){try{m.default.PAssert(1087,"me"!==t||m.default.isDemoMode(),"Should not be checking me")}catch(i){m.default.reportError(i)}var e=An.settings.getUserIdentifier();try{m.default.PAssert(1088,m.default.isDemoMode()||"me"!==e,"Should not be checking against current account until loaded")}catch(i){m.default.reportError(i)}return t===e}},{key:"createURLForThread",value:function(t){var e=t.getField("accountID");return"me"===e&&(e=An.settings.getUserIdentifier()),"https://mail.google.com/mail/b/"+e+"#all/"+t.id}},{key:"createPrintURLForThread",value:function(t){var e=t.getField("accountID");return"me"===e&&(e=An.settings.getUserIdentifier()),"https://mail.google.com/mail/b/"+e+"/?ui=2&view=pt&search=all&th="+t.id}},{key:"openEmailByItem",value:function(t,e,i){var r=this,a=t.getAttachmentByPlugin(A.a.PluginID.Gmail);if((a&&a!==An.EmailPreview.getThreadAttach()||!An.EmailPreview.isOpenOnPane(this)||i)&&this.getCacheData(a.id))return this.isAttachmentDraftOnly(a)?(this.sendEvent("Tap_DesktopDraft"),this.loadThread(a,function(){An.menus.openComposeEmail(r,a.id)})):An.EmailPreview.open(t,a,e,i),!0}},{key:"_convertRawMessage",value:function(t,e,i,r){var a={id:e,payload:i},n=this._getMessageFromAttachment(t,e);try{m.default.PAssert(1089,n,"Must be able to get message metadata")}catch(o){m.default.reportError(o)}a.labelIds=n.labelIds,a.messageID=n.messageID,a.snippet=n.snippet,a.internalDate=i.internalDate,r(a)}},{key:"getThreadData",value:function(t,e,i){var r=this;if(0!==t.getField("messages").length)return this._getThreadData(t,e,i);this._requestRemoteThreadMetadata(t.getField("accountID"),t.id,void 0,function(a,n){var o=!0;a?r._addRemoteEntry(t.getField("accountID"),a):n&&n.error&&n.error.code===A.a.HTTPStatusCode.NotFound&&(o=!1),o?r._getThreadData(t,e,i):e(!1,"The conversation that you requested no longer exists.")})}},{key:"_getThreadData",value:function(t,e,i){for(var r=0,a=t.getField("messages"),n=a.length,o=0,u=!1,s={},h=function(){if(o===n&&u){for(var t=0,i={messages:[]},r=0,h=0;h<a.length;++h){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var d=s[a[h].id];d?i.messages.push(d):++r}try{m.default.PAssert(1090,i.messages.length+r===a.length,"Messages should always be found for thread")}catch(c){m.default.reportError(c)}0===a.length?e(void 0,"This message is not cached locally and we could not contact the remote server."):e(i)}},d=function(t){t&&(s[t.id]=t),++o,h()},c=0;c<a.length;++c){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var v=a[c];this.getMessageData(t,v.id,d)}u=!0,setTimeout(h.bind(this),0)}},{key:"getMessageData",value:function(t,e,i){var r=this;this._rawCache.getEntry(e,function(a){a?r._convertRawMessage(t,e,a,i):(m.default.log("Warning: Local message cache missing email display data: ",t.id,e),r._requestRemoteMessageDataRaw(t.getField("accountID"),t.id,e,i))})}},{key:"_handleThreadLoaded",value:function(t,e,i,r){var a=this._pendingThreadLoads[t];try{m.default.PAssert(1091,a,"Must always have a valid pending load when handling laod")}catch(u){m.default.reportError(u)}if(delete this._pendingThreadLoads[t],a)for(var n=0,o=0;o<a.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;try{a[o](e,i,r)}catch(s){m.default.reportError(s)}}}},{key:"loadThread",value:function(t,e){var i=this;try{m.default.PAssert(1092,0===this._loadThreadMutex,"Should never have an outstanding lock on thread load")}catch(a){m.default.reportError(a)}this._loadThreadMutex++;var r=t.getField("accountID");kt.a.getAccountAuthToken(r,[A.a.GScope.GmailModify],function(r){r?i._loadThread(t,e,8e3):e(!1,!1,"This thread belongs to an account ("+t.getField("accountID")+") you are not authorized to access.")}),this._loadThreadMutex--}},{key:"_loadThread",value:function(t,e,i){var r=this,a=this.isAttachmentDraftOnly(t),n=this._pendingThreadLoads[t.id];if(n)m.default.log("Duped pending thread load: ",t.id),n.push(e);else if(this._pendingThreadLoads[t.id]=[e],t.getField("dataLoaded")||t.isLocalOnlyAttachment()){for(var o=0,u=t.getField("messages"),s=!1,h=!1,d=0,c=0,v=u.length,y=0,g=function(){s&&d===c&&(v===y&&(h=!0),setTimeout(function(){r._handleThreadLoaded(t.id,!0,h)},0))},l=function(e){if(c++,e){""===e.decoded&&(e.decoded=void 0);var i=r._parseMailMessage(e);try{m.default.PAssert(1093,i,"Must be able to parse message")}catch(a){m.default.reportError(a)}r._updateMessageData(t,i.id,i),h=!0}g()},p=0;p<u.length;++p){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var f=u[p];void 0===f.decoded?(f.decoded="",d++,this.getMessageData(t,f.id,l)):(f.decoded||f.labelIds.indexOf(Je.DRAFT)>=0)&&y++}s=!0,g()}else if(a){var k=t.getField("messages")[0];this.getMessageData(t,k.id,function(e){if(e){var i=r._parseMailMessage(e);try{m.default.PAssert(1094,i,"Must be able to parse message")}catch(a){m.default.reportError(a)}r._updateMessageData(t,i.id,i)}h=!0,r._handleThreadLoaded(t.id,!0,h)})}else this.getThreadData(t,function(e,i){e&&r._parseMailThread(t,e),h=!0,r._handleThreadLoaded(t.id,!!t.getField("dataLoaded"),h,i)},i)}},{key:"forceReloadMessage",value:function(t,e,i){this._requestRemoteMessageData(t,e,i)}},{key:"_verifyEmailAttachments",value:function(t,e,i){var r,a,n=this,o=this._findDraft(t,e,i);return o?o.resources.forEachResource(function(t){t.uploader&&(t.uploader.hasError()?r="There was an error uploading one or more attachments. Please remove them or try uploading again.":t.uploader.isDone()||(r="One or more of your attachments is still uploading.",a=function(t){n.onEmailReadyToSend(o,function(){An.toasts.clearMessage(t)})}))}):r="Could not find message to verify attachments.",r?{message:r,handleMessageFn:a}:void 0}},{key:"_verifyEmailRecipients",value:function(t,e,i){var r,a=this._findDraft(t,e,i);if(a)if(a.to&&0!==a.to.length)for(var n=0,o=0;o<a.to.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=a.to[o];u&&u.email?m.default.isEmail(u.email)||(r="You have entered an invalid email"):r="You have entered a contact with an invalid email address"}else r="You must enter at least one person to send this email to";else r="Unable to find the message you are trying to send";return r?{message:r}:void 0}},{key:"_formatAddressText",value:function(t,e,i){return t?i?'"'+m.default.encodeMIMEHeader(t)+'" <'+e+">":'"'+t+'" <'+e+">":e}},{key:"_createAddressTextFromTokens",value:function(t,e){var i="";if(t)for(var r=0,a=0;a<t.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=t[a];m.default.isEmail(n.email)&&(0!==a&&(i+=", "),i+=this._formatAddressText(n.text,n.email,e))}try{m.default.PAssert(1095,!i.startsWith(","),"Should not start with a comma")}catch(o){m.default.reportError(o)}try{m.default.PAssert(1096,!i.endsWith(","),"Should not end with a comma")}catch(o){m.default.reportError(o)}try{m.default.PAssert(1097,i.indexOf(",,")<0,"Should not have two commas in a row")}catch(o){m.default.reportError(o)}return i.trim()}},{key:"_createRFC822Message",value:function(t,e,i,r){var a=this;try{m.default.PAssert(1098,e,"Must specify a valid draft")}catch(s){m.default.reportError(s)}try{m.default.PAssert(1099,e.contentType,"Must specify a valid content type for the draft")}catch(s){m.default.reportError(s)}try{m.default.PAssert(1100,e.from,"Must be able to get the from information for a user.")}catch(s){m.default.reportError(s)}try{m.default.PAssert(1101,!e.inReplyTo||e.inReplyTo.indexOf("undefined")<0,"Should not have an undefined message id in reply-to: "+e.inReplyTo)}catch(s){m.default.reportError(s)}try{m.default.PAssert(1102,!e.references||e.references.indexOf("undefined")<0,"Should not have an undefined message id in references: "+e.references)}catch(s){m.default.reportError(s)}var n=e.from.text,o=e.from.email,u=new Ge(this);u.updateFromDraft(t,e,n,o,i,function(){var t=u.generateBlob();r(a._encodeEmail(t))})}},{key:"createSignature",value:function(t){var e=this.getSignature(t);return e?this.getSetting(this.Settings.InsertSignatureAboveReplies)?'<br/><br/><div class="gmail_signature">'+e+"</div><br/>":'<br/><br/>--<br/><div class="gmail_signature">'+e+"</div>":'<div class="gmail_signature"></div>'}},{key:"createReplyQuote",value:function(t){var e;t&&(e='<br>\n<div class="gmail_extra">\n<br>\n<div class="gmail_quote">'+("On "+t.date.toString("MMM dd, y")+" at "+t.date.toString("hh:mm tt")+", "+m.default.escape(this._createAddressTextFromTokens([t.from]))+" wrote:")+'\n<br>\n<blockquote class="gmail_quote" style="margin:0 0 0 0.8ex;border-left:1px #ccc solid;padding-left:1ex">\n'+t.decoded+"\n</blockquote>\n</div>\n<br>\n</div>\n");return e}},{key:"createForwardQuote",value:function(t){var e,i=m.default.isArray(t.to)?t.to:[t.to];return t&&(e='<br>\n<div class="gmail_quote">\n<br>\n---------- Forwarded message ----------<br>\nFrom: '+m.default.escape(this._createAddressTextFromTokens([t.from]))+"<br>\nDate: "+t.date.toString("ddd, MMM dd, y")+" at "+t.date.toString("hh:mm tt")+"<br>\nSubject: "+t.subject+"<br>\nTo: "+m.default.escape(this._createAddressTextFromTokens(i))+"\n<br>\n<br>\n"+t.decoded+"\n</div>\n<br>\n"),e}},{key:"createMessageBody",value:function(t,e,i){var r,a=this.createSignature(e);if(i===A.a.EmailResponseMode.Reply||i===A.a.EmailResponseMode.ReplyAll)r=this.createReplyQuote(t);else if(i===A.a.EmailResponseMode.Forward)r=this.createForwardQuote(t);else try{m.default.PAssert(1103,!1,"Invalid email response mode: "+i)}catch(n){m.default.reportError(n)}return this.getSetting(this.Settings.InsertSignatureAboveReplies)?a+r:r+a}},{key:"_sendEmail",value:function(t,e,i,r){var a=this;this.sendEvent("SendDraft"),this._clearPendingDraftUpdate(t,e);var n=this._findDraft(t,e,i);this._createRFC822Message(t.getData(),n,!0,function(e){var i={raw:e};t.isLocalOnlyAttachment()||(i.threadId=t.id);var o=Pt.a.fns("gmail").users.messages.send.packedFn,u={userId:t.getField("accountID"),resource:i};a._queueRemoteRequestMulti(t.getField("accountID"),o,u,function(e){a._updateLocalDraftFromSend(t,n.id,e,r)},function(e){a._notifySendFailed(),r(!1,e),a._notifyFailedRequest(t.getField("accountID"),e)},void 0,We)})}},{key:"_shouldSaveMessageContent",value:function(t,e){return e.labelIds.indexOf(Je.DRAFT)>=0}},{key:"compactCacheField",value:function(t,e){var i,r=0;switch(e){case"messages":i=[];for(var a=t[e],n={},o=function(t){var e=m.default.clone(t);delete e.data,delete e.size,delete e.uploader,n[t.id]=e},u=0;u<a.length;++u){var s=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var h=a[u],d={},c=0;c<wi.length;++c){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;d[wi[c]]=h[wi[c]]}this._shouldSaveMessageContent(t,h)||(delete d.decoded,delete d.mimeType,delete d.contentType,delete d.listUnsubscribe),d.resources.forEachResource(o),d.resources=n,i.push(d)}break;default:i=t[e]}return i}},{key:"_generateUndoRedo",value:function(){this._undoStack.registerOwner(this,this.id),this._undoStack.registerAction(this.id,A.a.PluginAction.Gmail.Archive,{undo:this.unarchiveAttachment,redo:this.archiveAttachment}),this._undoStack.registerAction(this.id,A.a.PluginAction.Gmail.Unarchive,{undo:this.archiveAttachment,redo:this.unarchiveAttachment}),this._undoStack.registerAction(this.id,A.a.PluginAction.Gmail.Trash,{undo:this.untrashAttachment,redo:this.trashAttachment}),this._undoStack.registerAction(this.id,A.a.PluginAction.Gmail.Untrash,{undo:this.trashAttachment,redo:this.untrashAttachment}),this._undoStack.registerAction(this.id,A.a.PluginAction.Gmail.AddLabel,{undo:this.removeLabelFromAttachment,redo:this.addLabelToAttachment}),this._undoStack.registerAction(this.id,A.a.PluginAction.Gmail.RemoveLabel,{undo:this.addLabelToAttachment,redo:this.removeLabelFromAttachment}),this._undoStack.registerAction(this.id,A.a.PluginAction.Gmail.MarkRead,{undo:this.markAttachmentUnread,redo:this.markAttachmentRead}),this._undoStack.registerAction(this.id,A.a.PluginAction.Gmail.MarkUnread,{undo:this.markAttachmentRead,redo:this.markAttachmentUnread}),this._undoStack.registerAction(this.id,A.a.PluginAction.Gmail.Star,{undo:this.markAttachmentUnstarred,redo:this.markAttachmentStarred}),this._undoStack.registerAction(this.id,A.a.PluginAction.Gmail.Unstar,{undo:this.markAttachmentStarred,redo:this.markAttachmentUnstarred}),this._undoStack.registerAction(this.id,A.a.PluginAction.Gmail.SetPriority,{undo:this.setAttachmentPriority,redo:this.setAttachmentPriority}),this._undoStack.registerAction(this.id,A.a.PluginAction.Gmail.Move,{undo:this.unmoveItem,redo:this.moveItem}),this._undoStack.registerAction(this.id,A.a.PluginAction.Gmail.Snooze,{undo:this.unsnoozeAttachment,redo:this.snoozeAttachment}),this._undoStack.registerAction(this.id,A.a.PluginAction.Gmail.ScheduleSend,{undo:this.cancelSendMessage,redo:this.scheduleSendMessage}),this._undoStack.registerAction(this.id,A.a.PluginAction.Gmail.DiscardDraft,{undo:m.default.emptyFn,redo:this.runDiscardDraft})}},{key:"performAction",value:function(t,e,i,r,a){try{m.default.PAssert(1104,t,"Must supply a valid action")}catch(s){m.default.reportError(s)}try{m.default.PAssert(1105,m.default.isBoolean(e),"Invalid preventUndo param")}catch(s){m.default.reportError(s)}var n;this.beginAction(e);var o=[i,r,a];try{n=this._undoStack.runAction(this.id,t,o)}catch(h){m.default.reportError(h)}if(this._undoStack.isUndoableAction()){var u=[i];m.default.isArray(n)?u.pushArray(n):u.push(n),this._undoStack.performAction(this.id,t,{undoParams:u,redoParams:o})}this.endAction()}},{key:"performActions",value:function(t,e){var i=0;this.beginAction(e);for(var r=0;r<t.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this.performAction(t[r].action,!1,t[r].attach,t[r].param)}this.endAction()}},{key:"beginAction",value:function(t){this._undoStack.beginAction(t),Y.e.beginAction()}},{key:"endAction",value:function(){this._undoStack.endAction(),Y.e.endAction()}},{key:"handleUndo",value:function(){Y.e.beginAction(),this._undoStack.undoAction(),Y.e.endAction()}},{key:"handleRedo",value:function(){Y.e.beginAction(),this._undoStack.redoAction(),Y.e.endAction()}},{key:"supportUsageCache",value:function(){return!0}},{key:"supportOfflineLoad",value:function(){return!0}},{key:"_matchParticipant",value:function(t,e){var i=!1;return t&&(t.text&&(i=t.text.toLowerCase().indexOf(e)>=0),!i&&t.email&&(i=t.email.toLowerCase().indexOf(e)>=0)),i}},{key:"_matchLabels",value:function(t,e){return this.hasLabelLike(t.accountID,t.id,e)}},{key:"_matchEntry",value:function(t,e){return t.subjectLower.indexOf(e)>=0||this._matchParticipant(t.from,e)||this._matchLabels(t,e)}},{key:"matchAttachment",value:function(t,e){return this._matchEntry(t.getData(),e)}},{key:"findMatchExact",value:function(){}},{key:"findMatchLike",value:function(t,e){var i=this,r=t.toLowerCase();return this.findCachedItemsByFn(function(t){return i._matchEntry(t,r)},e)}},{key:"isGmailItem",value:function(t){return!!t.getAttachmentByPlugin(this.id)}},{key:"itemHasLabelByID",value:function(t,e){var i=t.getAttachmentByPlugin(this.id);return!!i&&this.attachmentHasLabelByID(i,e)}},{key:"itemHasLabel",value:function(t,e){var i=t.getAttachmentByPlugin(this.id);return!!i&&this.attachmentHasLabel(i,e)}},{key:"itemHasFullLabel",value:function(t,e){var i=t.getAttachmentByPlugin(this.id);return!!i&&this.attachmentHasFullLabel(i,e)}},{key:"itemHasDraft",value:function(t){return this.itemHasLabelByID(t,Je.DRAFT)}},{key:"isItemUnread",value:function(t){return this.itemHasLabelByID(t,Je.UNREAD)}},{key:"isItemImportant",value:function(t){return this.itemHasLabelByID(t,Je.IMPORTANT)}},{key:"isItemStarred",value:function(t){return this.itemHasLabelByID(t,Je.STARRED)}},{key:"isItemArchived",value:function(t){var e=t.getAttachmentByPlugin(this.id);return!!e&&this.attachmentIsArchived(e)}},{key:"isItemTrashed",value:function(t){return this.itemHasLabelByID(t,Je.TRASH)}},{key:"isItemFullTrashed",value:function(t){return this.itemHasFullLabel(t,fi.TRASH)}},{key:"isItemSpam",value:function(t){return this.itemHasLabelByID(t,Je.SPAM)}},{key:"isDisplayItem",value:function(t,e){var i=!1;return this.isItemSpam(t)||!this.isThreadItem(t)||this.isItemFullTrashed(t)&&!e||(i=!0),i}},{key:"getItemPriority",value:function(t){return t.hasPluginAttachment(this.id)?this.getAttachmentPriority(t.getAttachmentByPlugin(this.id)):0}},{key:"_getCompDateForItem",value:function(t){var e=0,i=t.getAttachmentByPlugin(this.id);if(i){var r=i.getField("lastModifiedDate");if(r)e=r.getTime();else{var a=i.getField("internalDate");a&&(e=a.getTime())}}return e}},{key:"_timeCompare",value:function(t,e){return t>e?1:t<e?-1:0}},{key:"threadSortFn",value:function(t,e){return this._timeCompare(this._getCompDateForItem(e),this._getCompDateForItem(t))}},{key:"threadSortPriorityFn",value:function(t,e){var i=t.getAttachmentByPlugin(this.id),r=e.getAttachmentByPlugin(this.id),a=this.getAttachmentPriority(i),n=this.getAttachmentPriority(r),o=this.attachmentHasLabelByID(i,Je.STARRED),u=this.attachmentHasLabelByID(r,Je.STARRED);return a>n?-1:a<n?1:o&&!u?-1:u&&!o?1:this._timeCompare(this._getCompDateForItem(e),this._getCompDateForItem(t))}},{key:"labelSortFn",value:function(t,e){return t.displayCompare(e)}},{key:"labelVMLISortFn",value:function(t,e){var i=this._getLabelByID(this._getAccountIDFromItem(t),this._getLabelIDFromItem(t)),r=this._getLabelByID(this._getAccountIDFromItem(e),this._getLabelIDFromItem(e));return this.labelSortFn(i,r)}},{key:"sortFn",value:function(t,e){return t.getParsedText().localeCompare(e.getParsedText())}},{key:"getCssClass",value:function(t,e){if(e&&e.type===this.getPaneType())return m.default.classNames({starred:this.attachmentHasLabelByID(t,Je.STARRED)},{unread:this.attachmentHasLabelByID(t,Je.UNREAD)},{p0:this.attachmentHasLabel(t,Si.PRI0)},{p1:this.attachmentHasLabel(t,Si.PRI1)},{p2:this.attachmentHasLabel(t,Si.PRI2)})}},{key:"getTotalMessageCount",value:function(t){var e=this._threadCache;e.onCacheReady(function(){e.count(t)})}},{key:"getUnsyncdMessageCount",value:function(){return this._numUnsyncdMessages}},{key:"getSyncdMessageCount",value:function(){return this._numSyncdMessages}},{key:"_checkUnsyncdMessageContent",value:function(t){for(var e=0,i=0;i<t.messages.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t.messages[i];r.cached?(this.reportTrackedStat($e.SyncdMessage),this._numSyncdMessages++):r.cachedError?this.reportTrackedStat($e.ErrorSyncdMessage):this._shouldCacheMessageData(t)?(this.reportTrackedStat($e.UnsyncdMessage),this._notifyUnsyncdMessage(t.accountID,t.id,r.id)):this.reportTrackedStat($e.OldUnsyncdMessage)}}},{key:"_notifyUnsyncdMessage",value:function(t,e,i){m.default.isTempId(e)||m.default.isTempId(i)||(this._handleSyncContentCacheOp(this._unsyncdMessages,t,e,i),this._numUnsyncdMessages++,this._contentSyncTask.notifyWorkAvailable())}},{key:"_notifyContentCached",value:function(t,e,i){this._numSyncdMessages++,this._handleSyncContentCacheOp(this._pendingSyncdMessages,t,e,i)}},{key:"_handleSyncContentCacheOp",value:function(t,e,i,r){var a=this._ensureAccountLib(e,t);a[i]?!0!==a[i]&&a[i].indexOf(r)<0&&a[i].push(r):a[i]=!r||[r]}},{key:"_removeUnsyncdMessage",value:function(t,e,i){this.reportTrackedStat($e.MessagesSyncd),this._numUnsyncdMessages--;var r=this._getAccountLib(t,this._unsyncdMessages);if(i){var a=r[e];a.remove(i),0===a.length&&delete r[e]}else delete r[e];m.default.isEmpty(r)&&this._deleteAccountLib(t,this._unsyncdMessages)}},{key:"_setCachedFieldForMessage",value:function(t,e,i){var r=this;if(this.hasCacheData(e))for(var a=0,n=this.getAttachment(e).getField("messages"),o=0;o<n.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;(!0===i||i.indexOf(n[o].id)>=0)&&(n[o].cached=!0)}this._threadCache.getEntry(e,function(t){if(t){for(var a=0,n=0;n<t.messages.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=t.messages[n];(!0===i||i.indexOf(o.id)>=0)&&(o.cached=!0)}r.cacheThreadData(e,t)}})}},{key:"_updateCachedErrorFieldForMessage",value:function(t,e,i){var r=this;if(this.hasCacheData(e))for(var a=0,n=this.getAttachment(e).getField("messages"),o=0;o<n.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;(!0===i||i.indexOf(n[o].id)>=0)&&(n[o].cachedError?n[o].cachedError++:n[o].cachedError=1)}this._threadCache.getEntry(e,function(t){if(t){for(var a=0,n=0;n<t.messages.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=t.messages[n];(!0===i||i.indexOf(o.id)>=0)&&(o.cached?o.cachedError++:o.cachedError=1)}r.cacheThreadData(e,t)}})}},{key:"_processSyncdContent",value:function(){for(var t in this._pendingSyncdMessages)if(this._pendingSyncdMessages.hasOwnProperty(t)){var e=this._pendingSyncdMessages[t];for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];if(m.default.isArray(r)){for(var a=0,n=0;n<r.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=r[n];this._removeUnsyncdMessage(t,i,o)}this._setCachedFieldForMessage(t,i,r)}else!0===r&&this._removeUnsyncdMessage(t,i)}}this._pendingSyncdMessages={}}},{key:"_processSyncErrors",value:function(t){for(var e in m.default.log("Process Sync Errors: ",t),t)if(t.hasOwnProperty(t)){var i=t[e];for(var r in i)if(i.hasOwnProperty(r)){var a=0,n=i[r];try{m.default.PAssert(1106,m.default.isArray(n),"Must have a valid message ID list")}catch(s){m.default.reportError(s)}for(var o=0;o<n.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var u=n[o];this._removeUnsyncdMessage(e,r,u)}this._updateCachedErrorFieldForMessage(e,r,n)}}}},{key:"driveMessageContentSync",value:function(t){var e=this;this._rawCache.onCacheReady(function(){if(An.cacheManager.hasReportedQuotaError())return t(!1);e._outstandingContentSync=!0,e._runMessageContentSync(35,function(i,r){if(!i)try{e._processSyncErrors(r)}catch(a){m.default.reportError(a)}return e._processSyncdContent(),e._outstandingContentSync=!1,t(!m.default.isEmpty(e._unsyncdMessages))})})}},{key:"_runMessageContentSync",value:function(t,e){var i=0,r=0,a=!1,n=0,o=0,u={},s=function(t,i,s){if(t?n++:(o++,u[i]=s),a&&n+o===r){var h=0===o;e(h,h?void 0:u)}},h=this.getSyncAccounts();for(var d in this._unsyncdMessages)if(h.indexOf(d)>=0&&(i+=this._syncMessageContentForAccount(d,this._unsyncdMessages[d],t-i,s),r++,i>=t))break;return a=!0,0===i&&setTimeout(function(){e(!0)},0),i}},{key:"_syncMessageContentForAccount",value:function(t,e,i,r){var a=0,n=0,o=0,u=0,s={},h=function(e,i,a){if(e?o++:(u++,s[i]=a),o+u===n){var h=0===u;r(h,t,h?void 0:s)}};for(var d in e)if(e.hasOwnProperty(d)&&(a+=this._syncMessageContentForThread(t,d,e[d],i-a,h),n++,a>=i))break;return a}},{key:"_syncMessageContentForThread",value:function(t,e,i,r,a){var n=this,o=0;if(m.default.isArray(i)){for(var u=0,s=!1,h=0,d=[],c=function(i,r){if(r?(h++,n._notifyContentCached(t,e,i)):d.push(i),s&&h+d.length===o){var u=0===d.length;a(u,e,u?void 0:d)}},v=0;v<i.length&&o<r;++v){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;this._requestRemoteMessageDataRaw(t,e,i[v],function(i,r,a){r?this._handleContentSyncdMessage(t,e,r,c.bind(this,i)):c.call(this,i,!1)}.bind(this,i[v])),o++}s=!0}else this._requestRemoteThreadDataRaw(t,e,function(i,r){i?n._handleContentSyncdThread(t,i,function(i){n._notifyContentCached(t,e),a(i,e)}):a(!1,e,!0)}),o++;return o}},{key:"_handleContentSyncdMessage",value:function(t,e,i,r){i.payload.id=i.id,i.payload.internalDate=i.internalDate,this._rawCache.cacheEntry(i.id,i.payload,r)}},{key:"_handleContentSyncdThread",value:function(t,e,i){for(var r=0,a=0;a<e.messages.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=e.messages[a];this._handleContentSyncdMessage(t,e.id,n,i)}}},{key:"scheduleEmail",value:function(t,e){var i=this;Y.e.beginAction();var r=t.getAttachmentByPlugin(this.id);try{m.default.PAssert(1107,r,"Must be able to get a valid attachment from item")}catch(h){m.default.reportError(h)}var a=r.getField("subject"),n=this.createURLForThread(r),o=A.a.MSPerHour,u=An.pluginManager.getPluginGCalendar();if(u){var s=u.getDefaultExportCalendarID();s&&(m.default.isDemoMode()||u.getSetting(u.Settings.WriteAccess))?u.createEventForEmail(s,a,n,e,o,function(t,e){t||e?e?(i.addLabelToAttachment(r,"Moo.do/Scheduled"),i.getSetting(i.Settings.ArchiveOnSchedule)&&i.archiveAttachment(r)):e||An.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:A.a.MessageAction.Okay}):An.toasts.pushMessage({text:"There was an error adding the email to your Google Calendar, and it was not saved locally.",actionText:"LEARN MORE",action:function(){An.toasts.pushMessage({text:"You are offline and we were unable to save your event information to your device. Please contact support@moo.do if you have questions.",action:A.a.MessageAction.Okay})}})}):An.toasts.pushMessage({text:"You must select an export calendar to enable scheduling and editing of events.",action:A.a.MessageAction.OpenCalendarSettings})}else An.toasts.pushMessage({text:"The Google Calendar plugin must be enabled to schedule emails.",action:A.a.MessageAction.OpenSettings});Y.e.endAction()}},{key:"getIconForLabel",value:function(t){switch(t.getParsedText()){case"Inbox":return"inbox2";case"Starred":return"star";case"Important":return"exclamation";case"Sent Mail":return"send";case"Draft":return"drafts";case"Archived":return"inbox";case"Trash":return"delete";case"Primary":return"user";case"Social":return"group";case"Promotions":return"tag";case"Updates":return"flag";case"Forums":return"question_answer";case"Chat":return"chat";case"Spam":return"warning"}}}]),e}(Gt),Ki=1,xi=3,bi=4,Oi=5,Wi=6,_i=7,tr=8,er=9,ir=10,rr=11,ar=12,nr=13,or="createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)",ur=function(t){function e(){var t;return o()(this,e),(t=d()(this,v()(e).call(this,A.a.PluginID.Moodo,"m","Moodo",!0))).setSetting(t.Settings.IsEnabled,!0,!1),t.useRenderer(A.a.PluginRenderTypes.StyledText,A.a.PluginRenderers.Unknown),t.useRenderer(A.a.PluginRenderTypes.Measure,A.a.PluginRenderers.Unknown),t}return p()(e,t),s()(e,[{key:"isPluginBlocked",value:function(){return!1}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"getRemoteAttachmentData",value:function(t){this.cacheData(t.id,{})}},{key:"runRemoteSingleRequest",value:function(t,e,i,r,a,n){var o=Rt.a.getDefaultAccountID();this._queueRemoteRequestMulti(o,t,e,i,r,void 0,a||Ki,n)}},{key:"runRemotePagedRequest",value:function(t,e,i,r,a,n){a||(a={}),a.accountID=Rt.a.getDefaultAccountID(),this._queuePagedRemoteRequest(t,e,i,r,void 0,n,a)}},{key:"drivePermissionsInsert",value:function(t,e,i,r,a){try{m.default.PAssert(739,m.default.isEmail(e),"Should pass in a valid email address")}catch(u){m.default.reportError(u)}var n=Pt.a.fns("drive").permissions.insert.packedFn,o={fileId:t,sendNotificationEmails:i,resource:{value:e,type:"user",role:"writer",withLink:!1}};this.runRemoteSingleRequest(n,o,r,a,xi)}},{key:"drivePermissionsDelete",value:function(t,e,i,r){var a=Pt.a.fns("drive").permissions.delete.packedFn,n={fileId:t,permissionId:e};this.runRemoteSingleRequest(a,n,i,r,bi)}},{key:"drivePermissionsList",value:function(t,e,i){var r=Pt.a.fns("drive").permissions.list.packedFn,a={fileId:t,fields:"items(id,name,role,type,emailAddress)"};this.runRemoteSingleRequest(r,a,e,i,Oi)}},{key:"drivePermissionsPublic",value:function(t,e,i){var r=Pt.a.fns("drive").permissions.insert.packedFn,a={fileId:t,sendNotificationEmails:!1,resource:{type:"anyone",role:"reader",withLink:!0}};this.runRemoteSingleRequest(r,a,e,i,xi)}},{key:"driveFilesGet",value:function(t,e,i,r){var a=Pt.a.fns("drive").files.get.packedFn,n={fileId:t,fields:or};r&&r.props&&Object.assign(n,r.props),this.runRemoteSingleRequest(a,n,e,i,Wi)}},{key:"driveFilesExport",value:function(t,e,i,r){var a=Pt.a.fns("drive").files.export.packedFn,n={fileId:t,mimeType:"application/vnd.google-apps.drive-sdk.597847337936"};this.runRemoteSingleRequest(a,n,e,i,Wi,r)}},{key:"realtimeFileGet",value:function(t,e,i,r){var a=Pt.a.fns("drive").realtime.get.packedFn,n={fileId:t};this.runRemoteSingleRequest(a,n,e,i,Wi,r)}},{key:"driveFilesList",value:function(t,e,i,r){var a=Pt.a.fns("drive").files.list.packedFn,n={q:t,fields:"items(createdDate,lastViewedByMeDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,labels,userPermission(id,role,type)),nextPageToken"};r&&r.props&&Object.assign(n,r.props),this.runRemotePagedRequest(a,n,e,i,r,_i)}},{key:"driveFilesTrash",value:function(t,e,i){var r=Pt.a.fns("drive").files.trash.packedFn,a={fileId:t};this.runRemoteSingleRequest(r,a,e,i,tr)}},{key:"driveFilesUntrash",value:function(t,e,i){var r=Pt.a.fns("drive").files.untrash.packedFn,a={fileId:t};this.runRemoteSingleRequest(r,a,e,i,tr)}},{key:"drivePropertiesInsert",value:function(t,e,i,r,a){var n=Pt.a.fns("drive").properties.insert.packedFn,o={fileId:t,resource:{key:e,value:i,visibility:"PRIVATE"}};this.runRemoteSingleRequest(n,o,r,a,er)}},{key:"drivePropertiesUpdate",value:function(t,e,i,r,a){var n=Pt.a.fns("drive").properties.update.packedFn,o={fileId:t,propertyKey:e,resource:{key:e,value:i,visibility:"PRIVATE"}};this.runRemoteSingleRequest(n,o,r,a,ir)}},{key:"driveParentsInsert",value:function(t,e,i,r){var a=Pt.a.fns("drive").parents.insert.packedFn,n={fileId:t,resource:{id:e}};this.runRemoteSingleRequest(a,n,i,r,rr)}},{key:"driveParentsDelete",value:function(t,e,i,r){var a=Pt.a.fns("drive").parents.delete.packedFn,n={fileId:t,parentId:e};this.runRemoteSingleRequest(a,n,i,r,ar)}},{key:"driveChildrenList",value:function(t,e,i,r){var a=Pt.a.fns("drive").children.list.packedFn,n={folderId:t,fields:"items(id),nextPageToken"};this.runRemotePagedRequest(a,n,e,i,r,nr)}}]),e}(Gt),sr=1,hr=4,dr=["description","end","start","status","summary","extendedProperties"],cr="syncTokens",vr="calendarList",yr={IsComplete:"isComplete",Priority:"priority",IsStarred:"isStarred",IsArchived:"isArchived"},gr=["modifiedOffline"],lr=2,pr=3,mr=4,fr=6,kr=7,Ar=8,Sr=9,wr=10,Lr=11,Fr=12,Cr=13,Ir=14,Pr=A.a.DefaultEventDuration,Nr=(li=function(t){function e(){var t;return o()(this,e),(t=d()(this,v()(e).call(this,A.a.PluginID.GCalendar,"c","Calendar",!1))).pluginMargin=4,t.pluginPadding=14,t._requiresOfflineAuth=!0,t._numEntriesSyncd=0,t._calendarList={},t.registerSetting("WriteAccess","writeAccess","w",!0,!0),t.registerSetting("ImportCalendars","importCalendars","i",!0),t.registerSetting("ExportCalendar","exportCalendar","x",!0),t.registerSetting("WeeksPast","weeksPast","p",!0,sr),t.registerSetting("WeeksFuture","weeksFuture","f",!0,hr),t.registerSetting("DisplayOverdueInAgenda","displayOverdueInAgenda","o",!0,!1),t.registerSetting("SyncNewEvents","syncNewEvents","n",!0,!0),t.registerSetting("SyncDraggedEvents","syncDraggedEvents","d",!0,!0),t.registerSetting("CreateLocalEvents","createLocalEvents","l",!0,!0),t._updateSyncTimes(),t._eventCache=t.registerLocalCache("EventCache",A.a.StorageType.IndexedDB,!0),t._cacheCleanup=t.registerLowImpactTask("CacheCleanup",t._purgeOldData),t.declareProperty("isInvalid",A.a.PluginLoad.Runtime,!0,!1),m.default.isDemoMode()?t.declareProperty("calendarID",A.a.PluginLoad.Preview|A.a.PluginLoad.Full|A.a.PluginLoad.Inline,!0,"me"):t.declareProperty("calendarID",A.a.PluginLoad.Preview|A.a.PluginLoad.Full|A.a.PluginLoad.Inline),t.declareProperty("summary",A.a.PluginLoad.Preview|A.a.PluginLoad.Full),t.declareProperty("status",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!0,"confirmed"),t.declareProperty("startTime",A.a.PluginLoad.Preview|A.a.PluginLoad.Full),t.declareProperty("endTime",A.a.PluginLoad.Preview|A.a.PluginLoad.Full),t.declareProperty("allDayEvent",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!0,!1),t.declareProperty("recurringEventId",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!0),t.declareProperty("eid",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!0),t.declareProperty("isComplete",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!0,!1),t.declareProperty("isArchived",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!0,!1),t.declareProperty("isStarred",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!0,!1),t.declareProperty("priority",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!0,A.a.VMLIFlag.None),t.declareProperty("locked",A.a.PluginLoad.Preview|A.a.PluginLoad.Full,!0,!1),t.declareProperty("modifiedOffline",A.a.PluginLoad.Full,!0,!1),t.declareProperty("source",A.a.PluginLoad.Full,!0),t.declareProperty("location",A.a.PluginLoad.Full,!0),t.declareProperty("description",A.a.PluginLoad.Full,!0),t.declareProperty("attendees",A.a.PluginLoad.Full,!0),t.declareProperty("organizer",A.a.PluginLoad.Full,!0),t.useRenderer(A.a.PluginRenderTypes.StyledText,A.a.PluginRenderers.CalendarEvent),t.useRenderer(A.a.PluginRenderTypes.UnstyledText,A.a.PluginRenderers.CalendarEvent),t.useRenderer(A.a.PluginRenderTypes.Measure,A.a.PluginRenderers.CalendarEvent),t._pendingCreates={},t._syncingOfflineChanges=!1,t._hasInitializedTasks=!1,t._purgeOldDataTimeout=void 0,t._eventUpdateTimeout=void 0,t._eventUpdateQueue={},t._propConverter={},t._propConverter[yr.IsComplete]=m.default.parseDate,t._propConverter[yr.IsArchived]=m.default.parseBoolean,t._propConverter[yr.IsStarred]=m.default.parseBoolean,t._propConverter[yr.Priority]=t.parsePriority,t}return p()(e,t),s()(e,[{key:"getType",value:function(){return A.a.PluginType.Calendar}},{key:"_attachMetadataFields",value:function(){return gr}},{key:"allowRemoteRequests",value:function(){return!0}},{key:"useItemStore",value:function(){return"Google Calendar"}},{key:"itemStoreOptions",value:function(){return{listenToItemStateChanged:!0,enabledFilters:A.a.ItemStoreFilter.Dates}}},{key:"supportOfflineLoad",value:function(){return!0}},{key:"supportUsageCache",value:function(){return!0}},{key:"googleScopes",value:function(){return this.getSetting(this.Settings.WriteAccess)?[A.a.GScope.Calendar]:[A.a.GScope.CalendarRO]}},{key:"getDependencies",value:function(){return[A.a.PluginDependency.PremiumSub,A.a.PluginDependency.GoogleLogin]}},{key:"hasSettingsError",value:function(){return!1}},{key:"verifyAuthorization",value:function(t){var e=this.googleScopes();return kt.a.isAuthorizedForScopes(t,e)}},{key:"getBlockedText",value:function(){return""}},{key:"computeBatchGroupID",value:function(t){var e="me";return t.data&&t.data.calendarId&&(e=t.data.calendarId),e}},{key:"_serializeDate",value:function(t){return t instanceof Date?t.toISOString():m.default.isNumber(t)?new Date(t).toISOString():t}},{key:"compactCacheField",value:function(t,e){var i;switch(e){case"startTime":case"endTime":i=this._serializeDate(t[e]);break;default:i=t[e]}return i}},{key:"_updateSyncTimes",value:function(){var t=-(this.getSetting(this.Settings.WeeksPast)||sr),e=this.getSetting(this.Settings.WeeksFuture)||hr;try{m.default.PAssert(740,m.default.isNumber(t)&&t<=0,"Invalid value for weeksPast: ",t)}catch(a){m.default.reportError(a)}try{m.default.PAssert(741,m.default.isNumber(e)&&e>=0,"Invalid valid for weeksFuture: ",e)}catch(a){m.default.reportError(a)}var i=Math.min(-7,t),r=Math.max(20,e);this._minSyncStartTime=(new Date).clearTime().addWeeks(i),this._maxSyncStartTime=(new Date).clearTime().addWeeks(r),this._syncTokenDuration=m.default.weeks(10),this._minDisplayStartTime=(new Date).clearTime().addWeeks(t),this._maxDisplayStartTime=(new Date).clearTime().addWeeks(e);try{m.default.PAssert(742,this._minDisplayStartTime.isBefore(this._maxDisplayStartTime),"Must have a valid start display date")}catch(a){m.default.reportError(a)}}},{key:"_shouldDisplayTime",value:function(t,e){return e>=this._minDisplayStartTime&&e<=this._maxDisplayStartTime||t>=this._minDisplayStartTime&&t<=this._maxDisplayStartTime}},{key:"_filterDates",value:function(t,e,i){return function(r){var a=new Date(r[t]);return a>=e&&a<=i}}},{key:"_getEndClearTime",value:function(){return this._minDisplayStartTime.clone().addDays(-1)}},{key:"_purgeOldData",value:function(t){var e=this;this._eventCache.onCacheReady(function(){e._eventCache.getFilterEntries(e._filterDates("startTime",new Date(0),e._getEndClearTime()),function(i){if(i){var r=0;m.default.log("Removing "+i.length+" old calendar entries.");for(var a=0;a<i.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e._eventCache.removeEntry(i[a].id)}}t&&t(!1)})})}},{key:"_offlineLoad",value:function(){var t=this;if(this.isEnabled())return this._eventCache.onCacheReady(function(){t._eventCache.getMetadata(vr,function(e){m.default.isEmpty(t._calendarList)&&(t._calendarList=e||{}),t._eventCache.onCacheReady(function(){var e=t._filterDates("startTime",t._minDisplayStartTime,t._maxDisplayStartTime),i=function(i,r){m.default.batchRenderUpdates(function(){var a=0;An.PaneUpdateBatcher.beginUpdateItems();for(var n=t.getDefaultItemStore(),o=n.getRoot(),u=0;u<i.length;++u){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=i[u];if(!r||e(s)){var h=t.createEntryFromLocal(s.id,s);t.cacheData(h.id,h,void 0,void 0,A.a.ChangeType.Auto);try{m.default.PAssert(743,!n.hasItem(h.id),"Load should never try to create a VMLI that has already been created")}catch(y){m.default.reportError(y)}if(t._eventNeedsItem(h)){if(h.source){var d=An.pluginManager.parseEmailURL(h.source.url);if(d.plugin&&!d.plugin.hasCacheData(d.threadID)){var c=d.plugin.createEntryFromLocal(d.threadID,{accountID:d.accountID,subject:h.source.title});d.plugin.cacheData(d.threadID,c)}}var v=t._createItem(n,h,o.id);o.insertItem(v)}}}An.PaneUpdateBatcher.commitUpdateItems(),t._cacheCleanup.notifyWorkAvailable()})};t._eventCache.requestPreloadData(function(r){m.default.isArray(r)?i(r,!0):t._eventCache.getFilterEntries(e,i)})})})}),!0}},{key:"_activate",value:function(){}},{key:"_deactivate",value:function(){An.PaneUpdateBatcher.beginUpdateItems(),this._hasInitializedTasks=!1,An.PaneUpdateBatcher.updateAllItems(!0,!0),An.PaneUpdateBatcher.commitUpdateItems()}},{key:"_load",value:function(){!m.default.isDemoMode()&&this.isEnabled()&&(this.createRecurringTask("CalendarListSync",{delay:m.default.hours(2),minDelay:m.default.hours(1),runOnCreate:!0,pauseWhileIdle:!0,async:!0,asyncTimeout:m.default.minutes(2),task:this.runCalendarListSync}),this.createRecurringTask("CalendarEventSync",{delay:m.default.minutes(15),minDelay:m.default.seconds(90),runOnCreate:!0,pauseWhileIdle:!0,minDelayOnResume:!0,async:!0,asyncTimeout:m.default.minutes(2),task:this.runCalendarSync}),this._hasInitializedTasks=!0)}},{key:"goOnline",value:function(){this._hasInitializedTasks&&this.getRecurringTask("CalendarEventSync").forceUpdate()}},{key:"handleTapStart",value:function(t,e,i,r){return P.a.isMobile&&r.preventDefault(),!0}},{key:"handleTapClick",value:function(t,e,i,r){var a=this.getCacheData(i);if(a){var n=this.getAttachment(i),o=n.getField("calendarID"),u=this._getCalendarInfo(o);if(u)try{m.default.PAssert(744,u.accountID,"Should have an accountID on the calendar")}catch(d){m.default.reportError(d)}if(a.eid&&u.accountID){var s="https://www.google.com/calendar/event?eid="+a.eid+"&authuser="+u.accountID;if(P.a.isMobile){var h=this.createDisplayElement(n).text;r.preventDefault(),m.default.preventClick(),An.menus.openMenuExternalApp(h,function(){m.default.openUrl(s,r)}),this.sendEvent("Tap_OpenGCalendarMobile")}else m.default.isDemoMode()?An.toasts.pushMessage(A.a.MessageID.DemoPluginClick):(m.default.openUrl(s,r),this.sendEvent("Tap_OpenGCalendarDesktop"))}return!0}return!1}},{key:"_durationToString",value:function(t){var e=Math.round(t/6e4),i=0,r=0;e>0&&(e-=60*(i=Math.floor(e/60)),i>0&&(i-=24*(r=Math.floor(i/24))));var a="";return r>0&&(a+=r+"d "),i>0&&(a+=i+"h "),e>0&&(a+=e+"m "),a.trim()}},{key:"_createItemDateText",value:function(t){return t.allDayEvent?t.startTime.toString(An.International.getFormat(A.a.DFormat.MonthDayYear)):t.startTime.toString(An.International.getFormat(A.a.DFormat.DayYearTime))}},{key:"_createItemDurationText",value:function(t){var e,i=t.endTime-t.startTime;if(t.allDayEvent)if(i>m.default.days(1)){var r=t.endTime.clone();r.addMilliseconds(-1),e="until "+r.toString(An.International.getFormat(A.a.DFormat.MonthDayYear))}else e="";else e=this._durationToString(i);return e}},{key:"_createItemSummaryText",value:function(t){var e;if(t.source&&t.source.url){var i=An.pluginManager.parseEmailURL(t.source.url);i.plugin&&(e=i.plugin._getTextForItem({id:i.threadID}))}return e||(e=t.summary?t.summary.replace(/\u2000/g,""):""),e}},{key:"_createItemText",value:function(t){try{m.default.PAssert(745,t,"Must specify a valid attachment")}catch(e){m.default.reportError(e)}return this._createItemSummaryText(t)}},{key:"_eventNeedsItem",value:function(t){return"cancelled"!==t.status&&!t.isArchived}},{key:"_createItem",value:function(t,e,i){var r;try{m.default.PAssert(746,this._eventNeedsItem(e),"Item must always be required to cause create")}catch(s){m.default.reportError(s)}m.default.isDateValid(e.isComplete)&&(r=e.isComplete);var a=!e.allDayEvent&&e.endTime-e.startTime||void 0,n={date:new $.a(new Date(e.startTime.getTime()),{gcalId:e.id,duration:a,gcalCalendar:e.calendarID}).toData(),priority:e.priority,isComplete:!!e.isComplete,isArchived:e.isArchived,dateCompleted:r,isStarred:e.isStarred},o=t.createItem(e.id,this._createItemText(e),i,n,A.a.ChangeType.Auto);if(e.description){var u=t.createItem(e.id+"_note",e.description,o.id,{isNote:!0},A.a.ChangeType.Auto);o.setNote(u,A.a.ChangeType.Auto)}return o}},{key:"getRemoteAttachmentData",value:function(t){var e=this;try{m.default.PAssert(747,t.hasField("calendarID")||!An.settings.fixedMissingCalendars.get(),"Must have a valid calendarID for an event")}catch(o){m.default.reportError(o)}if(t.hasField("calendarID")){var i=t.getField("calendarID"),r=this._getCalendarInfo(i);if(r)try{m.default.PAssert(748,r.accountID,"Should have an accountID on the calendar")}catch(o){m.default.reportError(o)}var a=Pt.a.fns("calendar").events.get.packedFn,n={eventId:t.id,calendarId:i};r&&this._queueRemoteRequestMulti(r.accountID,a,n,function(r){try{m.default.PAssert(749,!r||r.id===t.id,"If valid result, attachment should match remote event ID")}catch(o){m.default.reportError(o)}if(r){var a=e._addRemoteEntry(i,r);e._eventCache.cacheEntry(r.id,e.serializeExternalData(a))}},function(){t.notifyDataRequestFailed()},t,fr)}else An.settings.fixedMissingCalendars.get()?t.isLoaded()&&t.updateField("status","cancelled"):(this.needsFixMissingData||(this.needsFixMissingData=[]),this.needsFixMissingData.push(t),m.default.timeoutOnce("fixcalendar",this.fixMissingCalendars,5e3,function(){return e.needsFixMissingData=void 0},this.needsFixMissingData))}},{key:"_createRemoteEntry",value:function(t,e){var i,r,a,n=!1;try{m.default.PAssert(750,e.start,"Must always have valid start data")}catch(h){m.default.reportError(h)}if(e.start.dateTime){try{m.default.PAssert(751,e.end.dateTime,"End date format should always match start")}catch(h){m.default.reportError(h)}i=new Date(e.start.dateTime),r=new Date(e.end.dateTime)}else if(e.start.date){try{m.default.PAssert(752,e.end.date,"End date format should always match start")}catch(h){m.default.reportError(h)}var o=e.start.date.split("-"),u=e.end.date.split("-");i=new Date(o[0],o[1]-1,o[2]),r=new Date(u[0],u[1]-1,u[2]),n=!0}e.htmlLink&&(a=e.htmlLink.split("?eid=")[1]);var s={id:e.id,calendarID:t,status:e.status,summary:e.summary,startTime:i,endTime:r,allDayEvent:n,recurringEventId:e.recurringEventId,eid:a,isComplete:this._getRemoteProperty(e,yr.IsComplete),isArchived:this._getRemoteProperty(e,yr.IsArchived),isStarred:this._getRemoteProperty(e,yr.IsStarred),priority:this._getRemoteProperty(e,yr.Priority),locked:e.locked||!1,attendees:e.attendees,location:e.location,description:e.description,organizer:e.organizer?e.organizer.displayName||e.organizer.email||e.organizer.id:"Unknown"};return e.source&&(s.source={title:e.source.title,url:e.source.url}),s}},{key:"_addRemoteEntry",value:function(t,e){var i=this._createRemoteEntry(t,e);return this.cacheData(i.id,i),i}},{key:"createEntryFromLocal",value:function(t,e){return e.startTime=e.startTime?new Date(e.startTime):void 0,e.endTime=e.endTime?new Date(e.endTime):void 0,e.isComplete=this._propConverter[yr.IsComplete](e.isComplete),e.isArchived=this._propConverter[yr.IsArchived](e.isArchived),e.isStarred=this._propConverter[yr.IsStarred](e.isStarred),e.priority=this._propConverter[yr.Priority](e.priority),e}},{key:"_notifyFailedRequest",value:function(t,e){t&&t.error&&(t.error.code===A.a.HTTPStatusCode.Unauthorized?An.toasts.pushMessage(A.a.MessageID.LostPermission):t.error.code>=400&&t.error.code<500&&m.default.reportError(new Error("Failed GCalendar request: "+t.error.code),t))}},{key:"_getRemoteProperty",value:function(t,e){try{m.default.PAssert(753,t,"Must provide valid event info")}catch(r){m.default.reportError(r)}try{m.default.PAssert(754,e,"Must provide valid remote prop")}catch(r){m.default.reportError(r)}try{m.default.PAssert(755,this._propConverter[e],"Missing prop converter: ",e)}catch(r){m.default.reportError(r)}var i;return t.extendedProperties&&t.extendedProperties.private&&(i=t.extendedProperties.private["MDCProp_"+e]),this._propConverter[e]&&(i=this._propConverter[e](i)),i}},{key:"_updateAttachFromData",value:function(t,e){var i=[];for(var r in e)e.hasOwnProperty(r)&&t.isFieldDefined(r)&&(t.updateField(r,e[r]),i.push(r));return i}},{key:"_runRemoteUpdate",value:function(t,e,i,r,a,n){var o,u,s,h,d=this,c=arguments;try{m.default.PAssert(756,this.getSetting(this.Settings.WriteAccess),"Should not be calling _runRemoteUpdate without proper permission")}catch(g){m.default.reportError(g)}try{m.default.PAssert(757,!t.getField("locked"),"Should never try to modify an event that is locked")}catch(g){m.default.reportError(g)}try{m.default.PAssert(758,m.default.isBoolean(e)||m.default.isArray(e),"Must specify a boolean or list of fields for modified value")}catch(g){m.default.reportError(g)}try{m.default.PAssert(759,m.default.isFunction(r),"Must provide a valid localDoneCB")}catch(g){m.default.reportError(g)}try{m.default.PAssert(760,m.default.isFunction(a),"Must provide a valid remoteDoneCB")}catch(g){m.default.reportError(g)}try{m.default.PAssert(761,m.default.isFunction(n),"Must provide a valid allDoneCB")}catch(g){m.default.reportError(g)}var v=function(t,e,i){try{m.default.PAssert(762,m.default.isFunction(t),"Must supply a valid CB function")}catch(g){m.default.reportError(g)}try{m.default.PAssert(763,void 0!==e,"Must always pass success back from CB")}catch(g){m.default.reportError(g)}if(t.apply(d,Array.prototype.slice.call(c,1)),t===r){try{m.default.PAssert(764,void 0===o,"Local CB called twice")}catch(g){m.default.reportError(g)}o=e,s=i}else if(t===a){try{m.default.PAssert(765,void 0===u,"Remote CB called twice")}catch(g){m.default.reportError(g)}u=e,h=i}void 0!==o&&void 0!==u&&n(o,u,s,h)},y=this.getCacheData(t.id);try{m.default.PAssert(766,y,"Performing update on event that does not have local data")}catch(g){m.default.reportError(g)}y?(this.addModifiedOffline(y,e),this._eventCache.cacheEntry(t.id,this.serializeExternalData(y),function(n){n||v(r,!1),i(function(i,o){if(i){var u=d.getCacheData(t.id),s=!0!==e&&e;d.removeModifiedOffline(u,s),n&&d._eventCache.cacheEntry(t.id,d.serializeExternalData(u),function(t){v(r,t)}),v(a,!0)}else n&&v(r,!1),v(a,!1,o)})})):(v(r,!1),v(a,!1))}},{key:"_updateEvent",value:function(t,e,i,r,a,n){var o=this,u=this._updateAttachFromData(t,e);this._runRemoteUpdate(t,u,function(r){o._updateRemoteEvent(t.getField("calendarID"),t.id,e,i,r)},r,a,n)}},{key:"_updateRemoteEvent",value:function(t,e,i,r,a){var n=this;try{m.default.PAssert(767,this.getSetting(this.Settings.WriteAccess),"Should not be calling _updateRemoteEvent without proper permission")}catch(d){m.default.reportError(d)}try{m.default.PAssert(768,this.hasWritePermissionForCalendar(t),"Should not be calling _updateRemoteEvent for a read-only calendar")}catch(d){m.default.reportError(d)}var o=this._createEventUpdateInfo(i),u=this._getCalendarInfo(t);try{m.default.PAssert(769,u.accountID,"Should have an accountID on the calendar")}catch(d){m.default.reportError(d)}var s=Pt.a.fns("calendar").events.patch.packedFn,h={calendarId:t,eventId:e,resource:o};this._queueRemoteRequestMulti(u.accountID,s,h,function(){a(!0)},function(i){if(i&&i.error&&i.error.code===A.a.HTTPStatusCode.NotFound)n._eventCache.removeEntry(e),a(!0);else{var r=Object.keys(o);if(m.default.log("Failed Update: ",t,e,r),m.default.isHTTPStatusCode(i,A.a.HTTPStatusCode.Forbidden)&&!n.isRateLimitError(i)){var u=n.getCacheData(e);u&&(u.locked=!0),n.cacheData(e,u,!0,["locked"])}a(!1,i),n._notifyFailedRequest(i,t)}},void 0,Ar||r)}},{key:"_updateRemoteProperty",value:function(t,e,i,r,a,n){var o=this;t.updateField(e,i);var u={},s=void 0===i?null:i;u["MDCProp_"+e]=s;var h={extendedProperties:{private:u}};this._runRemoteUpdate(t,[e],function(e){o._updateRemoteEvent(t.getField("calendarID"),t.id,h,pr,e)},r,a,n)}},{key:"_getStartEndFromDateInfo",value:function(t,e){var i,r,a,n=!1;if(t instanceof Date)t.hasTimeOfDay()||(n=!0),i=t,r=t.clone().addMilliseconds(e);else if(t instanceof $.a)i=t.getStart(),r=t.getEnd(),a=t.toICal();else try{m.default.PAssert(770,!1,"Should always have a valid date")}catch(o){m.default.reportError(o)}return{startTime:i,endTime:r,allDayEvent:n,recurrence:a}}},{key:"deleteCalendarEventForItem",value:function(t,e,i,r,a){var n=this;this.sendEvent("DeleteEvent");this._runRemoteUpdate(e,["status"],function(i){t.getMooDate().removeGCal(),t.onMooDateUpdated(A.a.ChangeType.Local),t.onAttachInlineUpdate(),e.isLocalOnlyAttachment()?(e.updateField("status","cancelled"),i(!0)):n.deleteCalendarEvent(e,i)},i,r,a)}},{key:"deleteCalendarEvent",value:function(t,e){var i=this;try{m.default.PAssert(771,!t.isLocalOnlyAttachment(),"Should never make a remote request to delete a local-only event")}catch(s){m.default.reportError(s)}var r=t.getField("calendarID"),a=this._getCalendarInfo(r);try{m.default.PAssert(772,a.accountID,"Should have an accountID on the calendar")}catch(s){m.default.reportError(s)}var n=Pt.a.fns("calendar").events.delete.packedFn,o={calendarId:r,eventId:t.id},u=function(){var r=i.getDefaultItemStore();t.updateField("status","cancelled"),t.forEachItem(r,function(t){t.parent()&&(t.parent().removeChild(t),t.setParent(void 0))}),i._eventCache.cacheEntry(t.id,i.serializeExternalData(t.getData())),e(!0)};this._queueRemoteRequestMulti(a.accountID,n,o,function(){u()},function(r){r&&r.error&&r.error.code===A.a.HTTPStatusCode.Gone?u():r&&r.error&&r.error.code===A.a.HTTPStatusCode.NotFound?u():(e(!1,r),i._notifyFailedRequest(r,t.getField("calendarID")))},void 0,wr)}},{key:"forceRemoteEventSync",value:function(){if(!m.default.isDemoMode()&&this._hasInitializedTasks){if(this.hasRecurringTask("CalendarEventSync"))this.getRecurringTask("CalendarEventSync").forceUpdate();if(this.hasRecurringTask("CalendarListSync"))this.getRecurringTask("CalendarListSync").forceUpdate()}}},{key:"getDefaultExportCalendarID",value:function(){return m.default.isDemoMode()?"DemoCal":this.getSetting(this.Settings.ExportCalendar)}},{key:"isExportCalendarID",value:function(t){return this.getSetting(this.Settings.ExportCalendar)===t}},{key:"hasWritePermissionForAttach",value:function(t){var e=!1;if(this.getSetting(this.Settings.WriteAccess)){var i=t.getField("calendarID"),r=this._getCalendarInfo(i);r&&("writer"!==r.accessRole&&"owner"!==r.accessRole||(e=!0))}return e}},{key:"hasWritePermissionForCalendar",value:function(t){var e=!1;if(this.getSetting(this.Settings.WriteAccess)){var i=this._getCalendarInfo(t);i&&("writer"!==i.accessRole&&"owner"!==i.accessRole||(e=!0))}return e}},{key:"getCalendarBackgroundColor",value:function(t){var e="rgba(0, 120, 255, 0.85)",i=this._getCalendarInfo(t);return i&&i.backgroundColor&&(e=i.backgroundColor),e}},{key:"getCalendarForegroundColor",value:function(t){var e="#000000",i=this._getCalendarInfo(t);return i&&i.foregroundColor&&(e=i.foregroundColor),e}},{key:"getCalendarDisplayProps",value:function(t){var e,i=this._getCalendarInfo(t);return i&&"reader"===i.accessRole&&(e={style:{backgroundImage:"url(/img/stripe.png)",backgroundRepeat:"repeat"}}),e}},{key:"shouldDisplayOverdueInAgenda",value:function(){return this.getSetting(this.Settings.DisplayOverdueInAgenda)}},{key:"createEventForEmail",value:function(t,e,i,r,a,n){var o=this;try{m.default.PAssert(773,m.default.isString(t),"Must provide a valid calendarID for email")}catch(s){m.default.reportError(s)}try{m.default.PAssert(774,m.default.isString(e),"Must provide a valid subject")}catch(s){m.default.reportError(s)}try{m.default.PAssert(775,m.default.isString(i),"Must provide a valid email url")}catch(s){m.default.reportError(s)}try{m.default.PAssert(776,m.default.isDateValid(r),"Must provide a valid schedule date")}catch(s){m.default.reportError(s)}try{m.default.PAssert(777,m.default.isNumber(a),"Must provide a valid event duration")}catch(s){m.default.reportError(s)}this.sendEvent("AddEmailEvent");var u={duration:a,summary:e,date:r,source:{title:e,url:i}};this.createNewCalendarEvent(t,u,function(t){if(t){var e=o.getDefaultItemStore();if(!e.hasItem(t.id)){An.PaneUpdateBatcher.beginUpdateItems();var i=e.getRoot(),r=o._createItem(e,t,i.id);i.insertItem(r),An.PaneUpdateBatcher.commitUpdateItems()}}},m.default.newEmptyFn(),n)}},{key:"createEventForItem",value:function(t,e){!t.hasPluginAttachment(this.id)&&t.getNextDate()&&((e=e||this.getDefaultExportCalendarID())?t.getDate()?(this.sendEvent("AddSingleEvent"),this.newCalendarEventForItem(e,t,function(e,i,r,a){e||i?i?Y.e.miscAction({type:Y.c.Misc,misc:Y.a.AddToGCal,data:{item:t}}):a&&a.error&&-1===a.error.code?Y.e.miscAction({type:Y.c.Misc,misc:Y.a.AddToGCal,data:{item:t}}):An.toasts.pushMessage({text:"There was an error adding the event to your Google Calendar.",action:A.a.MessageAction.Okay}):r&&!1===r.isValid?An.toasts.pushMessage({text:"The event you are trying to create is not valid.",action:A.a.MessageAction.Okay}):An.toasts.pushMessage({text:'There was an error creating your calendar event. There may be a problem with your authorization. Please try toggling your "Save To" calendar off and back on, or try toggling the Google Calendar plugin off and on. Contact support@moo.do if you have questions',action:A.a.MessageAction.OpenCalendarSettings})})):(this.sendEvent("AddRepeatEvent"),An.toasts.pushMessage({text:"Moo.do does not currently support adding repeated dates to Google Calendar.",action:A.a.MessageAction.Okay})):An.toasts.pushMessage({text:"Please select a valid Google Calendar to save your events to.",action:A.a.MessageAction.OpenSettings}))}},{key:"newCalendarEventForItem",value:function(t,e,i){var r=this;try{m.default.PAssert(778,e,"Must provide a valid item")}catch(u){m.default.reportError(u)}try{m.default.PAssert(779,e.getNextDate(),"Item must have a valid date")}catch(u){m.default.reportError(u)}try{m.default.PAssert(780,!e.hasPluginAttachment(A.a.PluginID.GCalendar),"Must not already have a valid calendar attachment associated with the item")}catch(u){m.default.reportError(u)}var a=e.getDuration();a||(a=e.allDayDate()?m.default.days(1):Pr);var n={duration:a,summary:e.getCalendarParsedText()};if(e.getDate()&&(n.date=e.getDate()),e.hasNote()&&(n.description=e.getNote().getParsedText()),e.hasAttachmentType(A.a.PluginType.Email)){var o=e.getAttachmentByType(A.a.PluginType.Email);n.source={title:o.getField("subject"),url:o.getPlugin().createURLForThread(o)}}this.createNewCalendarEvent(t,n,function(t){if(t)if(e.isDestroyed()){var i=r.getDefaultItemStore();if(!i.hasItem(t.id)){An.PaneUpdateBatcher.beginUpdateItems();var a=i.getRoot(),n=r._createItem(i,t,a.id);a.insertItem(n),An.PaneUpdateBatcher.commitUpdateItems()}}else{e.getMooDate().setGCalIdAndCalendar(t.id,t.calendarID),e.onMooDateUpdated(A.a.ChangeType.Local);var o=e.getCalendarRawText();e.setText(o,A.a.ChangeType.Local)}},m.default.newEmptyFn(),i)}},{key:"createNewCalendarEvent",value:function(t,e,i,r,a){var n=this;try{m.default.PAssert(782,e,"Must have valid event info passed in")}catch(d){m.default.reportError(d)}try{m.default.PAssert(783,e.date,"Must have valid date for event")}catch(d){m.default.reportError(d)}try{m.default.PAssert(784,void 0!==e.duration,"Must have a valid event duration")}catch(d){m.default.reportError(d)}try{m.default.PAssert(785,e.summary,"Must have a valid event summary")}catch(d){m.default.reportError(d)}try{m.default.PAssert(786,m.default.isFunction(i),"Must supply a valid local done CB")}catch(d){m.default.reportError(d)}try{m.default.PAssert(787,m.default.isFunction(r),"Must supply a valid remote done CB")}catch(d){m.default.reportError(d)}var o=m.default.generateTempId(),u=this._getStartEndFromDateInfo(e.date,e.duration),s=this._getCalendarInfo(t);if(s){try{m.default.PAssert(788,s.accountID,"Should have an accountID on the calendar")}catch(d){m.default.reportError(d)}var h={id:o,calendarID:t,status:"confirmed",summary:e.summary,source:e.source,description:e.description,startTime:u.startTime,endTime:u.endTime,allDayEvent:u.allDayEvent,recurrence:u.recurrence,organizer:s.accountID,modifiedOffline:!0};this.cacheData(o,h),this._eventCache.cacheEntry(o,h,function(e){i(h,e);var o=n.getAttachment(h.id);m.default.isDemoMode()?(r(!0),a(e,!0)):n._runRemoteUpdate(o,!0,function(e){n._createRemoteEventFromCacheData(t,h,m.default.newEmptyFn(),e,a)},m.default.newEmptyFn(),r,function(){n.getDefaultItemStore().updateItems()})})}}},{key:"_createRemoteEventFromCacheData",value:function(t,e,i,r,a){var n,o,u,s,h=this,d=arguments;try{m.default.PAssert(789,!this._pendingCreates[e.id],"Should never try and double create a calendar event")}catch(v){m.default.reportError(v)}this._pendingCreates[e.id]=!0;var c=function(t,e,c){try{m.default.PAssert(790,m.default.isFunction(t),"Must supply a valid CB function")}catch(v){m.default.reportError(v)}try{m.default.PAssert(791,void 0!==e,"Must always pass success back from CB")}catch(v){m.default.reportError(v)}if(t.apply(h,Array.prototype.slice.call(d,1)),t===i){try{m.default.PAssert(792,void 0===n,"Local CB called twice")}catch(v){m.default.reportError(v)}n=e,u=c}else if(t===r){try{m.default.PAssert(793,void 0===o,"Remote CB called twice")}catch(v){m.default.reportError(v)}o=e,s=c}void 0!==n&&void 0!==o&&a(n,o,u,s)};this._createNewRemoteEvent(t,e,function(a,n){delete h._pendingCreates[e.id],An.PaneUpdateBatcher.beginUpdateItems();var o=h.getAttachment(e.id);if(a){var u=e.id;h.changeID(o,o.id,a.id);var s=h.getDefaultItemStore(),d=s.getRoot();s.hasItem(u)&&s.destroyItem(u),h._eventCache.removeEntry(u,function(t){try{m.default.PAssert(794,t,"Must always successfully remove the temp cached event: "+e.id)}catch(v){m.default.reportError(v)}});var y=h._addRemoteEntry(t,a),g=h._createItem(s,y,d.id);d.insertItem(g),h._eventCache.cacheEntry(a.id,h.serializeExternalData(y),c.bind(h,i)),o.updateField("isInvalid",!1),c(r,!0)}else o.updateField("isInvalid",!0),c(i,!1),c(r,!1,n);An.PaneUpdateBatcher.commitUpdateItems()})}},{key:"_createNewRemoteEvent",value:function(t,e,i){var r=this;try{m.default.PAssert(795,e,"Must specify valid event info")}catch(h){m.default.reportError(h)}try{m.default.PAssert(796,e.startTime instanceof Date,"Must have a valid start time")}catch(h){m.default.reportError(h)}try{m.default.PAssert(797,e.endTime instanceof Date,"Must have a valid end time")}catch(h){m.default.reportError(h)}try{m.default.PAssert(798,e.summary,"Must have a valid event title")}catch(h){m.default.reportError(h)}var a,n,o=this._getCalendarInfo(t);try{m.default.PAssert(799,o.accountID,"Should have an accountID on the calendar")}catch(h){m.default.reportError(h)}e.allDayEvent?(a={date:e.startTime.toString("yyyy-MM-dd")},n={date:e.endTime.toString("yyyy-MM-dd")}):(a={dateTime:e.startTime.toISOString()},n={dateTime:e.endTime.toISOString()});var u=Pt.a.fns("calendar").events.insert.packedFn,s={calendarId:t,resource:{start:a,end:n,recurrence:e.recurrence,summary:e.summary,description:e.description,status:e.status,source:e.source}};this._queueRemoteRequestMulti(o.accountID,u,s,function(t){i(t)},function(e){i(void 0,e),r._notifyFailedRequest(e,t)},void 0,kr)}},{key:"getImportCalendarList",value:function(){return this.getSetting(this.Settings.ImportCalendars)||[]}},{key:"getReadableCalendarList",value:function(t){return this._getCalendarList("reader",t)}},{key:"getWritableCalendarList",value:function(t){return this._getCalendarList("writer",t)}},{key:"getWritableCalendarListSync",value:function(t){var e=this.getSetting(this.Settings.ImportCalendars);if(e)return e.filter(function(e){return(!t||e.accountID===t||!e.accountID&&t===An.settings.getUserIdentifier())&&("writer"===e.accessRole||"owner"===e.accessRole)})}},{key:"getFullCalendarList",value:function(t){var e=this.getSetting(this.Settings.ImportCalendars);this.getReadableCalendarList(function(i){if(e&&i){var r=e.map(function(t){if(!m.default.isObject(t))return{id:t,accessRole:"none"};var e=m.default.clone(t);return e.accessRole="none",e}).filter(function(t){for(var e=0,r=0;r<i.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(i[r].id===t.id)return!1}return!0});i.pushArray(r)}t(i)})}},{key:"createCalendar",value:function(t,e){var i=this,r=Pt.a.fns("calendar").calendars.insert.packedFn,a={resource:{summary:t}};this._queueRemoteRequest(r,a,function(t){e(t)},function(t){e(),i._notifyFailedRequest(t,void 0)},void 0,Lr,{}),this.sendEvent("CreateCalendar")}},{key:"_getCalendarList",value:function(t,e){for(var i=0,r=this.getAccounts(),a=r.length,n=[],o=function(t){a--,t&&(n=n.concat(t)),0===a&&e(n)},u=0;u<r.length;++u){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._getCalendarListForAccount(r[u],t,o)}}},{key:"_getCalendarListForAccount",value:function(t,e,i){var r=this,a=Pt.a.fns("calendar").calendarList.list.packedFn,n={minAccessRole:e,userId:"me"};this._queuePagedRemoteRequestMulti(t,a,n,function(e){e=e.map(function(e){return e.accountID=t,e}),i(e)},function(t){i(),r._notifyFailedRequest(t,void 0)},void 0,mr,{getAllPages:!0,timeoutMS:0})}},{key:"handleEventUpdate",value:function(t,e){this._numEntriesSyncd++;var i=this.getDefaultItemStore();if("cancelled"===e.status){var r=this.getAttachment(e.id);r.getField("calendarID")===t&&(this._eventCache.removeEntry(e.id),this.hasCacheData(e.id)&&(r.updateField("status","cancelled"),r.forEachItem(i,function(t){t.parent()&&(t.parent().removeChild(t,A.a.ChangeType.Remote),t.setParent(void 0))})))}else{var a=this.getCacheData(e.id),n=this._createRemoteEntry(t,e);a&&a.modifiedOffline&&this._mergeEventData(a,n),this.cacheData(n.id,n),this._eventCache.cacheEntry(e.id,this.serializeExternalData(n));var o=i.getRoot(),u=this.getAttachment(e.id);this._beginIgnorePropertyChanges();try{this.updateVMLIsFromUpdate(u,a,n)}catch(h){m.default.reportError(h)}if(this._endIgnorePropertyChanges(),!i.hasItem(n.id)&&this._shouldDisplayTime(n.startTime,n.endTime)&&this._eventNeedsItem(n)){var s=this._createItem(i,n,o.id);o.insertItem(s)}}}},{key:"_mergeEventData",value:function(t,e){var i=0;try{m.default.PAssert(802,t.modifiedOffline,"Should only merge events that were locally modified")}catch(o){m.default.reportError(o)}var r=t.modifiedOffline;try{m.default.PAssert(803,m.default.isArray(r),"Should not be receiving an update for an event that was created locally")}catch(o){m.default.reportError(o)}for(var a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=r[a];0,e[n]=t[n]}e.modifiedOffline=t.modifiedOffline}},{key:"updateVMLIsFromUpdate",value:function(t,e,i){var r=this;try{m.default.PAssert(804,t,"Must provide a valid attachment")}catch(n){m.default.reportError(n)}try{m.default.PAssert(805,i,"Must provide valid new data")}catch(n){m.default.reportError(n)}if(e)t.hasInlineData(),t.forEachItem(void 0,function(t){t.getParsedText();(t.belongsToItemStore(An.itemStoreManager.getTempItemStore())&&t.getRawText().includes("calendarID"),e.summary!==i.summary)&&(t.hasAttachmentType(A.a.PluginType.Email)||i.summary&&i.summary.replace(/\u2000/g,""));if(e.description!==i.description&&t.belongsToItemStore(r.getDefaultItemStore()))if(t.hasNote())i.description?t.getNote().setText(i.description,A.a.ChangeType.Remote):t.setNote(void 0,A.a.ChangeType.Remote);else if(i.description){var a,n=i.id+"_note";r.getDefaultItemStore().hasItem(n)?(a=r.getDefaultItemStore().getItem(n)).setText(i.description,A.a.ChangeType.Remote):a=r.getDefaultItemStore().createItem(n,i.description,t.id,{isNote:!0},A.a.ChangeType.Remote),t.setNote(a,A.a.ChangeType.Remote)}r.areDatesEqual(e.isComplete,i.isComplete)||t.setComplete(!!i.isComplete,A.a.ChangeType.Remote),e.isArchived!==i.isArchived&&t.setArchived(i.isArchived),e.isStarred!==i.isStarred&&t.setStarred(i.isStarred,A.a.ChangeType.Remote),e.priority!==i.priority&&t.setPriority(i.priority,A.a.ChangeType.Remote)});else{var a=this._createItemText(i);t.forEachItem(void 0,function(t){t.setText(a,A.a.ChangeType.Remote)})}}},{key:"setSyncToken",value:function(t,e,i){var r=this;try{m.default.PAssert(806,m.default.isString(t),"Must provide a valid calendar ID to clear sync token for")}catch(a){m.default.reportError(a)}try{m.default.PAssert(807,m.default.isString(e),"Must provide a valid calendar ID to clear sync token for")}catch(a){m.default.reportError(a)}this._eventCache.getMetadata(cr,function(a){a=a||{};var n=Date.now()+r._syncTokenDuration;a[t]={token:e,date:Date.now(),expires:n},r._eventCache.setMetadata(cr,a,i)})}},{key:"clearSyncToken",value:function(t,e){var i=this;try{m.default.PAssert(808,m.default.isString(t),"Must provide a valid calendar ID to clear sync token for")}catch(r){m.default.reportError(r)}try{m.default.PAssert(809,m.default.isFunction(e),"Must provide valid CB function when clearing sync token")}catch(r){m.default.reportError(r)}this._eventCache.getMetadata(cr,function(r){r?(delete r[t],i._eventCache.setMetadata(cr,r,e)):e(!1)})}},{key:"clearCalendarEventCache",value:function(t,e){var i=this;try{m.default.PAssert(810,m.default.isString(t),"Must provide a valid calendar ID to clear event cache for")}catch(r){m.default.reportError(r)}try{m.default.PAssert(811,m.default.isFunction(e),"Must provide valid CB function when clearing event cache")}catch(r){m.default.reportError(r)}this._eventCache.getFilterEntries(function(e){return e.calendarID===t},function(t){if(t){for(var r=0,a=0;a<t.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i._eventCache.removeEntry(t[a].id)}e(!0)}else e(!1)})}},{key:"_calendarSyncComplete",value:function(t,e){if(e.length>0){if(ct.a.notifySyncError(e),!P.a.isMobile&&this.isOnline())for(var i=0,r=0;r<e.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e[r].result!==A.a.SyncResult.FailureNetwork&&An.toasts.pushMessage(A.a.MessageID.CalendarSync)}}else ct.a.notifySyncError(void 0),An.toasts.clearMessage(A.a.MessageID.CalendarSync);var a=this.getSetting(this.Settings.ExportCalendar);if(a){for(var n=0,o=!1,u=0;u<e.length;++u){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e[u].id===a){o=!0;break}}o||this._syncOfflineChanges(this._notifyOfflineSyncFailures)}}},{key:"_shouldExpireToken",value:function(t){var e=!0;return t&&(t.expires?e=t.expires<Date.now():t.date&&(e=t.date+this._syncTokenDuration<Date.now())),e}},{key:"_getCalendarInfo",value:function(t){return this._calendarList[t]}},{key:"allowTextEditing",value:function(t,e){var i=!1;if(this.getSetting(this.Settings.WriteAccess)){var r=e.getField("calendarID");(this.hasWritePermissionForCalendar(r)||e.isLocalOnlyAttachment())&&(i=!0)}return i}},{key:"_createCalendarFromRemote",value:function(t){var e={id:t.id,accountID:t.accountID,summary:t.summary,accessRole:t.accessRole};return m.default.isValidColor(t.backgroundColor)&&(e.backgroundColor=t.backgroundColor),m.default.isValidColor(t.foregroundColor)&&(e.foregroundColor=t.foregroundColor),e}},{key:"runCalendarListSync",value:function(t){var e=this;this.getReadableCalendarList(function(i){if(i){var r=0;e._calendarList={};for(var a=0;a<i.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=i[a];e._calendarList[n.id]=e._createCalendarFromRemote(n)}An.toasts.clearMessage(A.a.MessageID.CalendarSync);var o=e.getDefaultExportCalendarID();o&&!e._calendarList[o]&&(e.setSetting(e.Settings.ExportCalendar,void 0),An.toasts.pushMessage({text:"Your export calendar no longer exists, please select another.",action:A.a.MessageAction.OpenSettings})),e._eventCache.onCacheReady(function(){e._eventCache.setMetadata(vr,e._calendarList)})}else!P.a.isMobile&&e.isOnline()&&An.toasts.pushMessage(A.a.MessageID.CalendarSync);t&&t()})}},{key:"_notifyTokenExpired",value:function(t){this._purgeOldDataTimeout&&clearTimeout(this._purgeOldDataTimeout),this._purgeOldDataTimeout=setTimeout(this._purgeOldData,0)}},{key:"_notifyCalendarUnsyncd",value:function(t){m.default.log("Detected calendar "+t+" is no longer syncd"),this._clearCachedData(t,function(e){e||m.default.log("Failure unsyncing calendar "+t)}),this._clearCalendarItems(t)}},{key:"_clearCalendarItems",value:function(t){var e=this.getDefaultItemStore();An.PaneUpdateBatcher.beginUpdateItems(),e.forEach(function(i){i.hasAttachments()&&(i.getAttachment(0).getField("calendarID")===t&&e.destroyItem(i.id))}),An.PaneUpdateBatcher.commitUpdateItems()}},{key:"_getSyncResultFromResult",value:function(t,e){var i=A.a.SyncResult.Success;if(e&&e.error&&e.error.code){var r=e.error.code;if(r===A.a.HTTPStatusCode.Unauthorized){var a=this._getCalendarInfo(t);i=a&&"owner"===a.accessRole?A.a.SyncResult.FailureOAuth:a&&"writer"===a.accessRole?A.a.SyncResult.FailureNoWrite:A.a.SyncResult.FailureNoRead}else i=r===A.a.HTTPStatusCode.NotFound?A.a.SyncResult.FailureNoRead:r===A.a.HTTPStatusCode.Network?A.a.SyncResult.FailureNetwork:r===A.a.HTTPStatusCode.Forbidden?A.a.SyncResult.FailureNoRead:A.a.SyncResult.FailureUnknown}return i}},{key:"runCalendarSync",value:function(t,e){var i=this,r=0,a=0,n=[],o=[],u=function(e,u,s){try{m.default.PAssert(812,a<r,"Should never have more calendars syncd than we tried to sync")}catch(h){m.default.reportError(h)}e?n.push({id:u,result:A.a.SyncResult.Success}):o.push({id:u,result:i._getSyncResultFromResult(u,s)}),++a===r&&(i._calendarSyncComplete(n,o),t&&t())};this._eventCache.onCacheReady(function(){i._eventCache.getMetadata(cr,function(a){i._updateSyncTimes();var n=i.getSetting(i.Settings.ImportCalendars);if(n&&n.length>0){var o=0;r=n.length;for(var s=0;s<n.length;++s){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var h=n[s];m.default.isObject(h)||(h={id:n[s]});var d,c=a?a[h.id]:void 0;i._shouldExpireToken(c)?(i._notifyTokenExpired(h.id),d=void 0):d=c.token,i.performCalendarSync(h,d,u,e)}for(var v in a)if(a.hasOwnProperty(v)){var y=0,g=!1;for(s=0;s<n.length;++s){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;h=n[s];if(m.default.isObject(h)||(h={id:n[s]}),h.id===v){g=!0;break}}g||i._notifyCalendarUnsyncd(v)}}else i._clearAllData(),i._calendarSyncComplete([],[]),t&&t()})})}},{key:"performCalendarSync",value:function(t,e,i,r){var a=this,n=t.id,o=t.accountID;try{m.default.PAssert(813,m.default.isString(n),"Must provide a valid calendar ID for each sync op")}catch(d){m.default.reportError(d)}if(!o){var u=this._getCalendarInfo(t.id);u&&(o=u.accountID),o||(o=An.settings.getUserIdentifier())}var s=Pt.a.fns("calendar").events.list.packedFn,h={calendarId:n,singleEvents:!0};r||(e?h.syncToken=e:(h.timeMin=this._minSyncStartTime.toISOString(),h.timeMax=this._maxSyncStartTime.toISOString()));this._queuePagedRemoteRequestMulti(o,s,h,function(t,e,r){var o,u=0;r&&(o=r.nextSyncToken,a.setSyncToken(n,o)),An.PaneUpdateBatcher.beginUpdateItems();for(var s=0;s<t.length;++s){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;a.handleEventUpdate(n,t[s])}An.PaneUpdateBatcher.commitUpdateItems(),i(!0,n)},function(e){e&&e.error&&e.error.code===A.a.HTTPStatusCode.Gone?a._clearCachedData(n,function(o){o?a.performCalendarSync(t,void 0,i,r):i(!1,n,e)}):(i(!1,n,e),a._notifyFailedRequest(e,n))},void 0,lr,{getAllPages:!0,timeoutMS:0})}},{key:"_createEventUpdateInfo",value:function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&dr.indexOf(i)>=0&&(e[i]=t[i]);return e}},{key:"_notifyOfflineSyncFailures",value:function(t,e,i){e>0&&(ct.a.notifySyncError(i),m.default.log("Failed to sync offlineChanges: ",e))}},{key:"_syncOfflineChanges",value:function(t){var e=this;if(!this._syncingOfflineChanges){this._syncingOfflineChanges=!0;var i=0,r=0,a=0,n=[],o=function(o,u){u===A.a.SyncResult.Success?r++:(a++,n.push({id:o,result:u})),i===r+a&&(e._syncingOfflineChanges=!1,t(r,a,n))};this._eventCache.getFilterEntries(function(t){return!!t.modifiedOffline},function(t){var r=0;i=t.length;for(var a=0;a<t.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=e.createEntryFromLocal(t[a].id,t[a]);n.isInvalid||(m.default.isTempId(n.id)&&!e._pendingCreates[n.id]?e._createRemoteEventFromCacheData(n.calendarID,n,m.default.newEmptyFn(),function(t,e,i){o(t,this._getSyncResultFromResult(t,i))}.bind(e,n.calendarID),m.default.newEmptyFn()):e.hasWritePermissionForCalendar(n.calendarID)?e._updateRemoteEvent(n.calendarID,n.id,n,Sr,function(t,e,i){e?(delete n.modifiedOffline,this._eventCache.cacheEntry(n.id,n,function(e){o(t,e?A.a.SyncResult.Success:A.a.SyncResult.FailureUnknown)})):o(t,this._getSyncResultFromResult(t,i))}.bind(e,n.calendarID)):(delete n.modifiedOffline,e._eventCache.cacheEntry(n.id,n,function(t,e){o(t,e?A.a.SyncResult.Success:A.a.SyncResult.FailureUnknown)}.bind(e,n.calendarID))))}})}}},{key:"_getEventDuration",value:function(t){try{m.default.PAssert(814,!t.getField("allDayEvent"),"All day events do not have valid durations")}catch(r){m.default.reportError(r)}var e=t.getField("startTime"),i=t.getField("endTime");try{m.default.PAssert(815,e&&i,"Must always have valid start and end times")}catch(r){m.default.reportError(r)}return i-e}},{key:"_computeItemDates",value:function(t,e,i){var r,a;e.getDate()&&(a=(r=e.getDate().clone()).clone().addMilliseconds(e.getDuration())),r&&a&&(e.allDayDate()?(t.start={date:r.toString("yyyy-MM-dd"),dateTime:null},t.end={date:a.toString("yyyy-MM-dd"),dateTime:null}):(t.start={dateTime:r.toISOString(),date:null},t.end={dateTime:a.toISOString(),date:null})),t.startTime=r,t.endTime=a}},{key:"_queueEventUpdate",value:function(t,e){if(this._updateAttachFromData(t,e),this._eventUpdateTimeout&&clearTimeout(this._eventUpdateTimeout),this._eventUpdateTimeout=setTimeout(this._flushEventUpdateQueue,2e3),!t.isLocalOnlyAttachment()){var i=this._eventUpdateQueue[t.id];if(i)for(var r in e)e.hasOwnProperty(r)&&(i.info[r]=e[r]);else this._eventUpdateQueue[t.id]={attach:t,info:e}}}},{key:"onShutdown",value:function(){}},{key:"_flushEventUpdateQueue",value:function(){this._eventUpdateTimeout=void 0;var t=function(t,e){t||e?An.toasts.clearMessage(A.a.MessageID.CalendarSaveFail):An.toasts.pushMessage(A.a.MessageID.CalendarSaveFail)};for(var e in this._eventUpdateQueue)if(this._eventUpdateQueue.hasOwnProperty(e)){var i=this._eventUpdateQueue[e];this._updateEvent(i.attach,i.info,Fr,m.default.newEmptyFn(),m.default.newEmptyFn(),t)}this._eventUpdateQueue={}}},{key:"_handleAttachDeleted",value:function(t,e){var i=this;if(e.belongsToItemStore(this.getDefaultItemStore())){var r=t.getField("status");this.deleteCalendarEvent(t,function(a){if(a){An.toasts.pushMessage({text:"Event removed from your calendar.",actionText:"UNDO",action:function a(){i._updateEvent(t,{status:r},Cr,m.default.newEmptyFn(),function(t){t||An.toasts.pushMessage({text:"There was an error re-adding the event to your calendar",actionText:"RETRY",action:a,timeout:1e4})},m.default.newEmptyFn());var n=i._createItemText(t.getData());e.setText(n,A.a.ChangeType.Local),e.parent()||e.setParent(i.getDefaultItemStore().getRoot()),e.getIndex()<0&&e.parent().insertItem(e)},timeout:1e4})}else An.toasts.pushMessage({text:"There was an error removing the event from your calendar.",actionText:"RETRY",action:i._handleAttachDeleted.bind(i,t,e),timeout:1e4})})}}},{key:"notifyItemNoteChanged",value:function(t,e){this._queueEventUpdate(t,{description:e.getRawText()})}},{key:"notifyItemDateChanged",value:function(t,e){var i={};this._computeItemDates(i,e,t),this._queueEventUpdate(t,i)}},{key:"notifyItemTextChanged",value:function(t,e,i){if(i)this._handleAttachDeleted(t,e);else if(t.getField("recurringEventId")&&e.getCalendarParsedText()===t.getField("summary"))An.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"});else if(!m.default.isDemoMode())if(e.getDate()){var r,a=e.getCalendarParsedText(),n=t.getField("summary"),o=t.getField("source");if(e.hasAttachmentType(A.a.PluginType.Email)){var u=e.getAttachmentByType(A.a.PluginType.Email);r={title:u.getField("subject"),url:u.getPlugin().createURLForThread(u)}}var s={summary:a,start:void 0,end:void 0,source:void 0},h=!1;a!==n&&(h=!0),o&&!r||!o&&r?h=!0:o&&r&&(o.title===r.title&&o.url===r.url||(h=!0));var d=e.getDate(),c=t.getField("startTime");this.areDatesEqual(c,d)||(h=!0);var v=e.getEndDate(),y=t.getField("endTime");this.areDatesEqual(y,v)||(h=!0),h&&(this._computeItemDates(s,e,t),s.source=r,this._queueEventUpdate(t,s)),t.updateField("isInvalid",!1)}else t.updateField("isInvalid",!0)}},{key:"_beginIgnorePropertyChanges",value:function(){this._ignoringPropertyChanges=!0}},{key:"_endIgnorePropertyChanges",value:function(){this._ignoringPropertyChanges=!1}},{key:"_isIgnoringPropertyChanges",value:function(){return this._ignoringPropertyChanges}},{key:"notifyItemPropertyChanged",value:function(t,e,i){if(this.getSetting(this.Settings.WriteAccess)&&!t.getField("locked")&&this.hasWritePermissionForCalendar(t.getField("calendarID"))&&(!m.default.isRemoteChange(i)||!this._isIgnoringPropertyChanges())){var r=t.getField("isComplete"),a=t.getField("isArchived"),n=t.getField("isStarred"),o=t.getField("priority"),u=e.dateCompleted,s=e.isArchived(),h=e.isStarred(),d=e.getPriority(),c=m.default.newEmptyFn(),v=m.default.newEmptyFn(),y=function(t,e,i,r){t||e?An.toasts.clearMessage(A.a.MessageID.CalendarSaveFail):An.toasts.pushMessage(A.a.MessageID.CalendarSaveFail)};this.areDatesEqual(r,u)||(m.default.isLocalChange(i)?this._updateRemoteProperty(t,"isComplete",u,c,v,y):t.updateField("isComplete",u)),a!==s&&(m.default.isLocalChange(i)?this._updateRemoteProperty(t,"isArchived",s,c,v,y):t.updateField("isArchived",s)),n!==h&&(m.default.isLocalChange(i)?this._updateRemoteProperty(t,"isStarred",h,c,v,y):t.updateField("isStarred",h)),o!==d&&(m.default.isLocalChange(i)?this._updateRemoteProperty(t,"priority",d,c,v,y):t.updateField("priority",d))}}},{key:"_clearCachedData",value:function(t,e){var i=this;this.clearSyncToken(t,function(r){r?i.clearCalendarEventCache(t,e):e&&e(!1)})}},{key:"_clearAllData",value:function(t){var e=this;this._eventCache.clearMetadata(function(i){i?e._eventCache.clearCache(function(e){t&&t(e)}):t&&t(!1)}),this.getDefaultItemStore().clearStore()}},{key:"getAttachmentClass",value:function(t){var e=["plugin_gcalendar","c-date"];return t.isLoaded()&&(t.getField("isInvalid")&&e.push("invalid"),"cancelled"===t.getField("status")&&e.push("eventDeleted")),e}},{key:"getAttachmentTooltip",value:function(t){var e;return this.isPluginBlocked()?e="Go premium to view calendar events":t.isLoaded()?(t.isLocalOnlyAttachment()?e="Syncing event...":t.getField("isInvalid")&&(e="Item has an invalid date"),"cancelled"===t.getField("status")&&(e="Item was deleted from Google Calendar")):e="Plugin is loading data",e}},{key:"areDatesEqual",value:function(t,e){var i=!1;return t&&e?m.default.isDateValid(t)&&m.default.isDateValid(e)&&(i=t.equals(e)):i=!t&&!e,i}},{key:"parsePriority",value:function(t){var e=m.default.parseInt(t);return isNaN(e)&&(e=A.a.VMLIFlag.None),e}},{key:"fieldsHaveParseEffect",value:function(t){return(!t||1!==t.length||"isComplete"!==t[0])&&g()(v()(e.prototype),"fieldsHaveParseEffect",this).call(this,t)}},{key:"changeCalendarForEvent",value:function(t,e){var i=this;try{m.default.PAssert(817,t.hasField("calendarID"),"Must have a valid calendarID for an event")}catch(h){m.default.reportError(h)}var r=t.getField("calendarID"),a=this._getCalendarInfo(r),n=a.id;try{m.default.PAssert(818,a.accountID,"Should have an accountID on the calendar")}catch(h){m.default.reportError(h)}var o=Pt.a.fns("calendar").events.move.packedFn,u={eventId:t.id,calendarId:r,destination:e};t.updateField("calendarID",e);var s=function(){t.forEachItem(An.itemStoreManager.getDefaultItemStore(),function(t){var i=t.getMooDate();if(i){i.setGCalCalendar(e),t.onMooDateUpdated(A.a.ChangeType.Local);var r=t.getCalendarRawText();t.setText(r,A.a.ChangeType.Local)}}),i._queueEventUpdate(t,{calendarId:e})};this._queueRemoteRequestMulti(a.accountID,o,u,s,function(e){t.updateField("calendarID",n),e&&e.error&&e.error.code===A.a.HTTPStatusCode.Gone?s():(e&&e.error&&(e.error.code,A.a.HTTPStatusCode.NotFound),i._notifyFailedRequest(e,t.getField("calendarID")))},void 0,Ir)}},{key:"getCalendarForAttach",value:function(t){if(t.hasField("calendarID"))return this._getCalendarInfo(t.getField("calendarID"))}},{key:"fixMissingCalendars",value:function(){this.runCalendarSync(),An.settings.fixedMissingCalendars.set(!0)}}]),e}(Gt),I()(li.prototype,"_purgeOldData",[H.a],Object.getOwnPropertyDescriptor(li.prototype,"_purgeOldData"),li.prototype),I()(li.prototype,"createEventForItem",[H.a],Object.getOwnPropertyDescriptor(li.prototype,"createEventForItem"),li.prototype),I()(li.prototype,"runCalendarListSync",[H.a],Object.getOwnPropertyDescriptor(li.prototype,"runCalendarListSync"),li.prototype),I()(li.prototype,"runCalendarSync",[H.a],Object.getOwnPropertyDescriptor(li.prototype,"runCalendarSync"),li.prototype),I()(li.prototype,"_flushEventUpdateQueue",[H.a],Object.getOwnPropertyDescriptor(li.prototype,"_flushEventUpdateQueue"),li.prototype),I()(li.prototype,"parsePriority",[H.a],Object.getOwnPropertyDescriptor(li.prototype,"parsePriority"),li.prototype),I()(li.prototype,"fixMissingCalendars",[H.a],Object.getOwnPropertyDescriptor(li.prototype,"fixMissingCalendars"),li.prototype),li),Hr=m.default.seconds(30),Mr=(pi=function(t){function e(){var t;return o()(this,e),(t=d()(this,v()(e).call(this)))._plugins={},t._activePlugins=[],t._loadedDependencies={},t._isOnline=P.a.isPlatformOnline(),t._iteratingPlugins=!1,t._hasAdjustedCacheSizeRatio=!1,t._queueTimeout=void 0,t._forcedLastPossible=!1,t._numOutstandingReqs=0,t._pluginRenderer=new ft,t}return p()(e,t),s()(e,[{key:"init",value:function(){this._setupRequestQueues(),this._pluginRenderer.registerDefaultRenderers(),An.billingManager.hasPremiumFeatures()?(this.notifyDependencyLoad(A.a.PluginDependency.EarlyAccess),this.notifyDependencyLoad(A.a.PluginDependency.PremiumSub)):An.billingManager.hasEarlyAccess()&&this.notifyDependencyLoad(A.a.PluginDependency.EarlyAccess),m.default.isDemoMode()&&this.notifyDependencyLoad(A.a.PluginDependency.DemoMode),P.a.isMobile||(window.addEventListener("offline",this.goOffline),window.addEventListener("online",this.goOnline)),k.a.listen("resetEverything",this._clearRequestQueues.bind(this)),this.registerPlugins()}},{key:"printStats",value:function(t){if(m.default.log("---- Plugin Stats ----"),void 0!==t){var e=this._plugins[t];m.default.log(e.name),m.default.log(" Stats: ",e.getStats())}else for(var i=0,r=Object.keys(this._plugins),a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=this._plugins[r[a]],o=n.getStats();m.default.log(n.name),m.default.log(" Stats: ",o)}m.default.log("----------------------")}},{key:"dumpQueueState",value:function(){var t=0,e=Object.keys(this._plugins);console.log("Queue State: ["+this._numOutstandingReqs+"]");for(var i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._plugins[e[i]];console.log(r.name),r.dumpRequestQueue(!1)}}},{key:"dumpQueueStats",value:function(){for(var t=0,e=Object.keys(this._plugins),i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._plugins[e[i]];console.log(r.name),r.dumpQueueStats()}}},{key:"getStats",value:function(t){var e={};if(void 0!==t)e[t]=this._plugins[t].getStats();else for(var i=0,r=Object.keys(this._plugins),a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=this._plugins[r[a]];e[n.id]=n.getStats()}return e}},{key:"getCacheStats",value:function(t,e){var i={};if(void 0!==t)this._plugins[t].getCacheStats(e);else for(var r=0,a=Object.keys(this._plugins),n=0,o=0;o<a.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this._plugins[a[o]].getCacheStats(function(t,r){r&&(i[t]=r),a.length===++n&&e(i)}.bind(this,a[o]))}}},{key:"getState",value:function(t){var e={};if(void 0!==t)e[t]=this._plugins[t].getState();else for(var i=0,r=Object.keys(this._plugins),a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=this._plugins[r[a]];e[n.id]=n.getState()}return e}},{key:"registerPlugins",value:function(){try{this.registerPlugin(new ur)}catch(t){m.default.reportError(t)}try{this.registerPlugin(new le)}catch(t){m.default.reportError(t)}try{this.registerPlugin(new Ei)}catch(t){m.default.reportError(t)}try{this.registerPlugin(new Nr)}catch(t){m.default.reportError(t)}try{this.registerPlugin(new Se)}catch(t){m.default.reportError(t)}this.registerPlugin(new Tt)}},{key:"registerPlugin",value:function(t){try{m.default.PAssert(277,!this._plugins[t.id],"Should never double-register a plguin")}catch(e){m.default.reportError(e)}this._plugins[t.id]=t,this.isAuthorized(t.id)&&this.loadPlugin(t.id)}},{key:"getPlugin",value:function(t){return this._plugins[t]}},{key:"getPluginGmail",value:function(){return this._plugins[A.a.PluginID.Gmail]}},{key:"getPluginDrive",value:function(){return this._plugins[A.a.PluginID.Drive]}},{key:"getPluginGCalendar",value:function(){return this._plugins[A.a.PluginID.GCalendar]}},{key:"loadPlugin",value:function(t){var e=this.getPlugin(t);try{m.default.PAssert(278,e,"Must register a plugin before loading it")}catch(i){m.default.reportError(i)}this.activatePlugin(e)}},{key:"unloadPlugin",value:function(t){}},{key:"authorizePlugin",value:function(t,e,i){i(!0)}},{key:"deauthorizePlugin",value:function(t,e){try{m.default.PAssert(281,e&&m.default.isFunction(e),"Must provide a valid callback fn")}catch(r){m.default.reportError(r)}var i=this.getPlugin(t);try{m.default.PAssert(282,i,"Must register a plugin before loading it")}catch(r){m.default.reportError(r)}i.setSetting(i.Settings.IsEnabled,!1),m.default.shouldLog(A.a.LogLevels.Plugin)&&m.default.log("Plugin Deauthorized: ",t),this.deactivatePlugin(i),e(!0)}},{key:"onPluginAuthorized",value:function(t,e){t.setSetting(t.Settings.IsEnabled,e),m.default.shouldLog(A.a.LogLevels.Plugin)&&m.default.log("Plugin Authorized: ",t.id,e),e&&this.activatePlugin(t)}},{key:"activatePlugin",value:function(t){try{m.default.PAssert(283,t,"Plugin must be valid to be activated")}catch(e){m.default.reportError(e)}t.activate(this._loadedDependencies)&&this._activePlugins.indexOf(t.id)<0&&this._activePlugins.push(t.id),t.ensurePaneTypeIsActive(),m.default.shouldLog(A.a.LogLevels.Plugin)&&m.default.log("Plugin Activated: ",t.id)}},{key:"deactivatePlugin",value:function(t){try{m.default.PAssert(284,t,"Plugin must be valid to be deactivated")}catch(e){m.default.reportError(e)}this._activePlugins.indexOf(t.id)>=0&&(t.deactivate()&&this._activePlugins.remove(t.id),m.default.shouldLog(A.a.LogLevels.Plugin)&&m.default.log("Plugin Deactivated: ",t.id))}},{key:"isOnline",value:function(){return this._isOnline||m.default.isDemoMode()}},{key:"goOnline",value:function(){var t=this;this._isOnline=!0,setTimeout(function(){var e=0;t._setupRequestQueues(!0);for(var i=0;i<t._activePlugins.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t._plugins[t._activePlugins[i]];try{r.goOnline()}catch(a){t._reportPluginError(a)}}},2500)}},{key:"goOffline",value:function(){var t=0;this._isOnline=!1;for(var e=0;e<this._activePlugins.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._plugins[this._activePlugins[e]];try{i.goOffline()}catch(r){this._reportPluginError(r)}}}},{key:"onDocumentShared",value:function(t){for(var e=0,i=0;i<this._activePlugins.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this._plugins[this._activePlugins[i]];try{r.onDocumentShared(t)}catch(a){this._reportPluginError(a)}}}},{key:"onShutdown",value:function(){for(var t=0,e=[],i=0;i<this._activePlugins.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this._plugins[this._activePlugins[i]];try{var a=r.onShutdown();a&&e.push(a)}catch(n){this._reportPluginError(n)}}return e.length>0?e:void 0}},{key:"onClearData",value:function(){for(var t=0,e=0;e<this._activePlugins.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._plugins[this._activePlugins[e]];try{i.clearData()}catch(r){this._reportPluginError(r)}}}},{key:"getCacheSizeRatio",value:function(){var t=An.settings.cacheSizeRatio.get()||1;try{m.default.PAssert(285,t>=0&&t<=1,"Invalid ratio value: ",t)}catch(e){m.default.reportError(e)}return t}},{key:"hasAdjustedCacheSizeRatio",value:function(){return this._hasAdjustedCacheSizeRatio}},{key:"_adjustCacheSizeRatio",value:function(){var t=this.getCacheSizeRatio();1===t&&m.default.sendEvent("CacheRatioChange","FromDefault");t>.35?t-=.1:m.default.sendEvent("CacheRatioChange","Minimum"),m.default.sendEvent("CacheRatioChange","Change",t),An.settings.cacheSizeRatio.set(t)}},{key:"onCacheLimitExceeded",value:function(){if(!this._hasAdjustedCacheSizeRatio){var t=0;this._hasAdjustedCacheSizeRatio=!0,this._adjustCacheSizeRatio();for(var e=0;e<this._activePlugins.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._plugins[this._activePlugins[e]];try{i.onCacheLimitExceeded()}catch(r){this._reportPluginError(r)}}}}},{key:"getPluginsForType",value:function(t){var e;switch(t){case A.a.PluginType.Calendar:e=[A.a.PluginID.GCalendar];break;case A.a.PluginType.Email:e=[A.a.PluginID.Gmail];break;case A.a.PluginType.Storage:e=[A.a.PluginID.Drive];break;case A.a.PluginType.Unknown:e=[A.a.PluginID.Mailbird,A.a.PluginID.Moodo]}return e}},{key:"hasAttachmentType",value:function(t,e){var i=!1;if(t.hasAttachments())for(var r=0,a=this.getPluginsForType(e),n=0;n<a.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(t.hasPluginAttachment(a[n])){i=!0;break}}return i}},{key:"allowTextEditing",value:function(t){var e=!0;if(t&&t.hasAttachments())for(var i=0,r=t.getAttachments(),a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(!r[a].getPlugin().allowTextEditing(t,r[a])){e=!1;break}}return e}},{key:"validatePlugin",value:function(t){}},{key:"runForEachPlugin",value:function(t){var e=0;this._iteratingPlugins=!0;for(var i=0;i<this._activePlugins.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;try{t(this.getPlugin(this._activePlugins[i]))}catch(r){m.default.reportError(r)}}this._iteratingPlugins=!1}},{key:"getAttachment",value:function(t,e){try{m.default.PAssert(286,t.p,"Must specify the plugin string to be used: ",t)}catch(r){m.default.reportError(r)}try{m.default.PAssert(287,t.id,"Must specify the ID of the data to use from the plugin: ",t)}catch(r){m.default.reportError(r)}var i=this.getPlugin(t.p);try{m.default.PAssert(288,i,"Must specify a valid plugin: ",t)}catch(r){m.default.reportError(r)}if(i)return i.isActive()||this.activatePlugin(i),i.getAttachment(t.id,e?t:void 0)}},{key:"createDisplayElement",value:function(t,e){try{m.default.PAssert(289,t.p,"Must specify the plugin string to be used")}catch(n){m.default.reportError(n)}try{m.default.PAssert(290,t.id,"Must specify the ID of the data to use from the plugin")}catch(n){m.default.reportError(n)}var i,r=this.getPlugin(t.p);if(r){var a=this.getAttachment(t,e);if(a)try{i=r.createDisplayElement(a)}catch(o){this._reportPluginError(o),i=this.createUnknownPluginElement(t.p)}else i=this.createUnknownPluginElement(t.p)}else i=this.createUnknownPluginElement(t.p);return i}},{key:"createUnknownPluginElement",value:function(t){return{attrs:{cls:[],isUnknown:!0,plugin:A.a.PluginID.Moodo,"plugin-id":"Invalid"}}}},{key:"measureAttachment",value:function(t,e){try{m.default.PAssert(291,e&&e.attrs&&e.attrs.plugin,"Must have a valid plugin ID for measuring")}catch(a){m.default.reportError(a)}var i=0,r=this.getPlugin(e.attrs.plugin);try{m.default.PAssert(292,r,"Should always be able to find a valid plugin: ",e.attrs.plugin)}catch(a){m.default.reportError(a)}return r&&(i=r.measureAttachment(t,e)),i}},{key:"parseAttachmentEmbedString",value:function(t,e){try{m.default.PAssert(293,t,"Must provide a valid string to parse")}catch(n){m.default.reportError(n)}var i=t.replace(/&quot;/g,'"').split(","),r={};if(i.forEach(function(t){var e=t.indexOf(":"),i=t.substr(0,e),a=t.substr(e+1,t.length-e-1);if("p"!==i&&"id"!==i)try{a=decodeURIComponent(a)}catch(n){}r[i]=a}),e){var a=i.length>2;r.displayElement=this.createDisplayElement(r,a),r.hasInlineData=a}return r}},{key:"createSimpleAttachment",value:function(t){return t.isSimpleAttachment=!0,t}},{key:"handleDropEvent",value:function(t,e){for(var i=0,r=!1,a=0;a<this._activePlugins.length&&!r;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=this._activePlugins[a],o=this.getPlugin(n);try{r=o.handleDropEvent(t,e)}catch(u){this._reportPluginError(u)}}return r||(t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files.length>0||t.clipboardData&&t.clipboardData.items&&t.clipboardData.items.length>0)&&(An.toasts.pushMessage({text:"Attaching files is a Premium feature, using the Drive plugin. Please enable Drive in the settings.",action:A.a.MessageAction.OpenSettings}),r=!0),r}},{key:"handleTapEvent",value:function(t,e,i,r){var a=!1,n=m.default.getPluginForElement(i.target);if(n){var o=n.getAttribute("plugin"),u=this.getPlugin(o);try{m.default.PAssert(294,u,"Must be able to get a valid plugin from a plugin element")}catch(h){m.default.reportError(h)}if(u.isPluginBlocked())An.toasts.pushMessage(A.a.MessageID.PremiumRequired),a=!0;else{var s=n.getAttribute("plugin-id");try{m.default.PAssert(295,s,"Must have a valid item ID for a plugin element")}catch(h){m.default.reportError(h)}try{a=u[r](t,e,s,i)}catch(d){this._reportPluginError(d)}}}return a}},{key:"handleTapStart",value:function(t,e,i){return this.handleTapEvent(t,e,i,"handleTapStart")}},{key:"handleTapClick",value:function(t,e,i){if(!e.isEditable||m.default.findParent(i.target,"plugin"))return this.handleTapEvent(t,e,i,"handleTapClick")}},{key:"handleDoubleTap",value:function(t,e,i){return this.handleTapEvent(t,e,i,"handleDoubleTap")}},{key:"isAuthorized",value:function(t){return!!m.default.isDemoMode()||!!this.getPlugin(t)&&!!this.getSetting(t,this.getPlugin(t).Settings.IsEnabled)}},{key:"getSetting",value:function(t,e){return this.getPlugin(t).getSetting(e)}},{key:"setSetting",value:function(t,e,i){return this.getPlugin(t).setSetting(e,i)}},{key:"onAuthorizedSetting",value:function(t,e,i){this.getPlugin(t).onAuthorizedSetting(e,i)}},{key:"notifyDependencyLoad",value:function(t,e){for(var i in this._loadedDependencies[t]=e||!0,this._plugins)if(this._plugins.hasOwnProperty(i))try{this.getPlugin(i).onDependencyLoaded(t,e)}catch(r){this._reportPluginError(r)}}},{key:"notifyDependencyUnload",value:function(t,e){}},{key:"_handleBatchRequestResponse",value:function(t,e){try{m.default.PAssert(297,t,"Plugin must be passed to response to know who is handling it")}catch(i){m.default.reportError(i)}this._numOutstandingReqs--;try{m.default.PAssert(298,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(i){m.default.reportError(i)}try{t._handleBatchRequestResponse(e)}catch(r){this._reportPluginError(r)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()}},{key:"_handleRequestResponse",value:function(t,e,i){try{m.default.PAssert(299,e,"Plugin must be passed to response to know who is handling it")}catch(r){m.default.reportError(r)}if(!i){this._numOutstandingReqs--;try{m.default.PAssert(300,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(r){m.default.reportError(r)}}try{e._handleRequestResponse(t,i)}catch(a){this._reportPluginError(a)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()}},{key:"notifyNoOutstandingReqs",value:function(){try{m.default.PAssert(301,0===this._numOutstandingReqs,"Should only notify when there are no outstanding reqs left")}catch(t){m.default.reportError(t)}0===this._numOutstandingReqs&&this._setupRequestQueues(!0)}},{key:"notifyHasPendingRemoteRequest",value:function(){this._numOutstandingReqs<6&&this._setupRequestQueues(!0)}},{key:"notifyAuthorizationAdded",value:function(t){this._numOutstandingReqs<6&&this._setupRequestQueues(!0),this.verifyAuthorization(t)}},{key:"verifyAuthorization",value:function(t,e){for(var i,r,a=0,n=0;n<this._activePlugins.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this._activePlugins[n],u=this.getPlugin(o);if(u.isEnabled())!u.verifyAuthorization(t)&&(r=(r||[]).concat(u.googleScopes())),i=i||!u.verifyAuthorization(t)}}},{key:"_reportInvalidScopes",value:function(t,e){P.a.isMobile?An.toasts.pushMessage(A.a.MessageID.MissingOfflineMobile):An.toasts.pushMessage(A.a.MessageID.MissingOffline),An.toasts.clearMessage(A.a.MessageID.LostPermission),m.default.reportError(new Error("Invalid scopes reported"),{accountID:t,scopes:e})}},{key:"_setupRequestQueues",value:function(t){var e=t?1:Hr;this._forcedLastPossible||(clearTimeout(this._queueTimeout),this._queueTimeout=setTimeout(this._pumpRequestQueues,e)),this._forcedLastPossible=this._forcedLastPossible||!!t}},{key:"_pumpRequestQueues",value:function(){this._runPumpRequestQueues(A.a.RequestPriority.UserBlocking),this._runPumpRequestQueues(A.a.RequestPriority.Default),this._runPumpRequestQueues(A.a.RequestPriority.Low)}},{key:"_runPumpRequestQueues",value:function(t){var e=0;if(this.isOnline()){var i=0,r=6-this._numOutstandingReqs;try{m.default.PAssert(302,r>=0,"Should never have more than max outstanding requests at any given point in time")}catch(d){m.default.reportError(d)}for(var a=0;r>0&&a<this._activePlugins.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=this._activePlugins[a],o=this.getPlugin(n),u=4-o.getNumOutstandingReqs();try{m.default.PAssert(303,u>=0,"Must always have a postiive number of available plugin reqs")}catch(d){m.default.reportError(d)}var s=Math.min(r,u);if(s>0&&o.isReady()){var h=0;try{h=o._pumpRequestQueue(t,s,this._handleRequestResponse,this._handleBatchRequestResponse);try{m.default.PAssert(304,h>=0,"Number of requests sent can never be negative")}catch(d){m.default.reportError(d)}}catch(c){this._reportPluginError(c)}try{m.default.PAssert(305,r-h>=0,"Too Many requests sent")}catch(d){m.default.reportError(d)}e+=h,r-=h,this._numOutstandingReqs+=h}}}else 0;return this._forcedLastPossible=!1,this._setupRequestQueues(),e}},{key:"_clearRequestQueues",value:function(){var t=0;this._numOutstandingReqs=0;for(var e=0;e<this._activePlugins.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._activePlugins[e],r=this.getPlugin(i);try{r._clearRequestQueue()}catch(a){this._reportPluginError(a)}}}},{key:"useRenderer",value:function(t,e){return this._pluginRenderer.useRenderer(t,e)}},{key:"_reportPluginError",value:function(t){m.default.reportError(t)}},{key:"parseEmailURL",value:function(t){var e={accountID:void 0,threadID:void 0,plugin:void 0},i=/https:\/\/mail.google.com\/mail\/b\/(.*)#all\/(.*)/g.exec(t);return i&&(e.accountID=i[1],e.threadID=i[2],e.plugin=this.getPlugin(A.a.PluginID.Gmail)),e}},{key:"isAvailable",value:function(t){return this.getPlugin(t).isAvailable()}},{key:"isActive",value:function(t){return this.getPlugin(t).isActive()}},{key:"isEnabled",value:function(t){return this.getPlugin(t).isEnabled()}},{key:"isGmailPaneEnabled",value:function(){return this.isEnabled(A.a.PluginID.Gmail)}}]),e}(N.a),I()(pi.prototype,"goOnline",[H.a],Object.getOwnPropertyDescriptor(pi.prototype,"goOnline"),pi.prototype),I()(pi.prototype,"goOffline",[H.a],Object.getOwnPropertyDescriptor(pi.prototype,"goOffline"),pi.prototype),I()(pi.prototype,"_handleBatchRequestResponse",[H.a],Object.getOwnPropertyDescriptor(pi.prototype,"_handleBatchRequestResponse"),pi.prototype),I()(pi.prototype,"_handleRequestResponse",[H.a],Object.getOwnPropertyDescriptor(pi.prototype,"_handleRequestResponse"),pi.prototype),I()(pi.prototype,"_pumpRequestQueues",[H.a],Object.getOwnPropertyDescriptor(pi.prototype,"_pumpRequestQueues"),pi.prototype),pi),zr=i(79),Dr=i(64),Vr=i(100),Gr=["4.95","49.95","5","49"],Tr=P.a.demo,qr=(mi=function(){function t(){var e=this;o()(this,t),this._premiumStatus=new U.a(A.a.PremiumStatus.Unknown),Tr&&this._premiumStatus.set(A.a.PremiumStatus.Active),this.hasPremiumFeaturesObservable=new zr.a([this._premiumStatus],function(){return e.hasPremiumFeatures()}),this._lastSignupError=-1,this._earlyAdopter=!1,this._inviteCode=void 0,this._referredBy=void 0,this._joinDate=void 0,this._premiumStartDate=void 0,this._premiumEndDate=void 0,this._premiumCode=void 0,this._premiumCodeExpired=!1,this._nextBillingDate=void 0,this._trialStart=void 0,this._trialDuration=void 0,this._trialExtended=void 0,this._pricingSelected=A.a.Pricing.None,this._billingIdentifier=void 0,this._hasValidBillingData=new U.a(!1),this.daysLeftInTrial=new U.a(-1),this.inviteCodeError=new U.a,this.inviteEmailError=new U.a,this.inviteEmailSuccess=new U.a}return s()(t,[{key:"init",value:function(){var t=this;if(this._premiumStatus.listen(function(e,i){t.hasPremiumFeatures()?(An.pluginManager.notifyDependencyLoad(A.a.PluginDependency.EarlyAccess),An.pluginManager.notifyDependencyLoad(A.a.PluginDependency.PremiumSub)):t.hasEarlyAccess()&&An.pluginManager.notifyDependencyLoad(A.a.PluginDependency.EarlyAccess),e!==i&&i&&An.DisplaySettings.onSettingChanged()}),!Tr&&(this.userProperties=An.settings.userProperties.get(),this.userProperties&&(this.updateBillingData(),m.default.shouldLog(A.a.LogLevels.Account)&&m.default.log("Premium Status (Local): ",this.userProperties.premiumStatus),!P.a.isMobile))){var e=V.a.getURLParam("premium");void 0!==e&&V.a.removeURLParam("premium",!0),e&&setTimeout(function(){An.menus.openSettings(A.a.SettingsSections.Account)},100)}}},{key:"setLastSignupError",value:function(t){this._lastSignupError=t}},{key:"_reportRemoteStatusFailure",value:function(){m.default.sendEvent("Billing","RemoteStatusFailure")}},{key:"getBillingIdentifier",value:function(){this._billingIdentifier;return this._billingIdentifier}},{key:"onBillingIdentifierAvailable",value:function(t){}},{key:"onConnected",value:function(t){}},{key:"hasPremium",value:function(){return this._premiumStatus.get()===A.a.PremiumStatus.Active||this._premiumStatus.get()===A.a.PremiumStatus.PastDue}},{key:"isTrialState",value:function(){return this._premiumStatus.get()===A.a.PremiumStatus.Trial||this._premiumStatus.get()===A.a.PremiumStatus.TrialOver}},{key:"isCanceledState",value:function(){return this._premiumStatus.get()===A.a.PremiumStatus.CanceledUser||this._premiumStatus.get()===A.a.PremiumStatus.CanceledPastDue}},{key:"canceledUserHasPremiumAccess",value:function(){return this.isCanceledState()&&this.getPremiumEndDate().getTime()>Date.now()}},{key:"isInFreeMonthAndPremium",value:function(){return(this.hasPremium()||this.canceledUserHasPremiumAccess())&&this._nonReferralDiscounts>=100}},{key:"hasSubscription",value:function(){return!this._premiumCode}},{key:"updateBillingData",value:function(){var t,e=this.userProperties;this._earlyAdopter=e.earlyAdopter,this._joinDate=e.joinDate?new Date(e.joinDate):new Date,this._premiumStartDate=e.premiumSignupDate?new Date(e.premiumSignupDate):new Date,this._premiumEndDate=e.premiumEndDate?new Date(e.premiumEndDate):new Date,this._premiumCode=e.premiumCode,this._nextBillingDate=e.nextBillingDate?new Date(e.nextBillingDate):new Date,this._trialStart=e.trialStart?new Date(e.trialStart):new Date,this._trialDuration=e.trialDuration||A.a.TrialDuration,this._trialExtended=e.trialExtended||!1,t=e.premiumStatus===A.a.PremiumStatus.CanceledPastDue||e.premiumStatus===A.a.PremiumStatus.CanceledUser?-1:this._trialDuration-Math.ceil((Date.now()-this._trialStart.getTime())/864e5);try{m.default.PAssert(306,t<=320,"Sanity check on trial length",t)}catch(i){m.default.reportError(i)}this.daysLeftInTrial.set(t),this._premiumStatus.get()===A.a.PremiumStatus.Trial&&t<0?(e.premiumStatus=A.a.PremiumStatus.TrialOver,this.notifyTrialOver()):this._premiumStatus.get()===A.a.PremiumStatus.Trial&&t<5&&this.notifyTrialEndSoon(),e.premiumStatus&&this.setPremiumStatus(e.premiumStatus),this._hasValidBillingData.set(!0)}},{key:"setPremiumStatus",value:function(t){try{m.default.PAssert(307,m.default.isNumber(t),"Status must be a valid number",t)}catch(e){m.default.reportError(e)}try{m.default.PAssert(308,t>0&&t<8,"Should be a valid status identifier",t)}catch(e){m.default.reportError(e)}t!==this._premiumStatus.get()&&(this._premiumStatus.set(t),m.default.setDimension(A.a.Analytics.Dimensions.PremiumStatus,t))}},{key:"hasValidBillingData",value:function(){return this._hasValidBillingData.get()}},{key:"getPremiumStatus",value:function(){return this._premiumStatus.get()}},{key:"getInviteCode",value:function(){return this._inviteCode}},{key:"getJoinDate",value:function(){return this._joinDate||new Date}},{key:"getPremiumStartDate",value:function(){return this._premiumStartDate||new Date}},{key:"getPremiumEndDate",value:function(){return this._premiumEndDate||new Date}},{key:"hasTrialExtended",value:function(){return this._trialExtended||!1}},{key:"isEligibleForTrialExtension",value:function(){return!1}},{key:"getNextBillingDate",value:function(){return this._nextBillingDate||new Date}},{key:"hasEarlyAccess",value:function(){return this.hasPremiumFeatures()||this.canceledUserHasPremiumAccess()}},{key:"cancelSubscription",value:function(t,e){m.default.sendEvent("Billing","SubCancelTapped");var i=function(){e&&m.default.isFunction(e)&&e()};return An.menus.confirm("Are you sure you want to cancel your subscription?",function(t){t?(m.default.sendEvent("Billing","SubCancelYES"),Dr.a.cancelPremium().then(function(t){var e=t.value?"Your premium subscription has been canceled. Please contact support@moo.do if you need assistance.":"There was a server error, please try again in a few minutes or contact support@moo.do.";An.menus.alert({text:e}),i()})):(i(),m.default.sendEvent("Billing","SubCancelNO"))}),!0}},{key:"getCustomPurchaseURL",value:function(){}},{key:"_openPaymentWindow",value:function(t){An.menus.openModal(A.a.Modals.Billing,{isUpdate:t})}},{key:"onTapUpdatePaymentMethod",value:function(){this._openPaymentWindow(!0)}},{key:"onTapViewInvoices",value:function(t,e){return Dr.a.listTransactions().then(function(t){if(t&&t.value)try{An.menus.openModal(A.a.Modals.Invoices,t.value)}catch(i){m.default.reportError(i)}else An.menus.alert({text:"There was an error retreiving your invoice data. Please contact support@moo.do."});e()}),!0}},{key:"onTapDeleteAccount",value:function(t,e){return An.menus.openModal(A.a.Modals.DeleteAccount,{callback:function(){Dr.a.deleteAccount().then(function(t){t.value?G.a.clearLocalData():An.menus.alert({text:"There was a server error. Please try again in a few minutes or contact support@moo.do."}),e()})}}),!0}},{key:"getInviteUrl",value:function(){return"https://www.moo.do/"}},{key:"getSelectText",value:function(){return"Select and press "+P.a.cmdChar+" + C to copy to clipboard"}},{key:"wasInvited",value:function(){return!!this._referredBy}},{key:"sendInviteEmail",value:function(t,e){}},{key:"joinDateText",value:function(){return this.getJoinDate().toString(An.International.getFormat(A.a.DFormat.LongStrDate))}},{key:"premiumStartDateText",value:function(){return this.getPremiumStartDate().toString(An.International.getFormat(A.a.DFormat.LongStrDate))}},{key:"premiumEndDateText",value:function(){return this.getPremiumEndDate().toString(An.International.getFormat(A.a.DFormat.LongStrDate))}},{key:"nextBillingDateText",value:function(){return this.getNextBillingDate().toString(An.International.getFormat(A.a.DFormat.LongStrDate))}},{key:"shareTwitter",value:function(){var t="https://twitter.com/share?url="+escape(this.getInviteUrl())+"&text=I love this new organization app!";this.showPopup(t,550,420),m.default.sendEvent("Billing","ShareTwitter")}},{key:"shareFacebook",value:function(){var t="https://www.facebook.com/sharer/sharer.php?u="+escape(this.getInviteUrl());this.showPopup(t,600,303),m.default.sendEvent("Billing","ShareFacebook")}},{key:"shareGoogle",value:function(){var t="https://plus.google.com/share?url="+this.getInviteUrl();this.showPopup(t,500,650),m.default.sendEvent("Billing","ShareGoogle")}},{key:"showPopup",value:function(t,e,i){var r=e,a=i,n=window.screen.height,o=window.screen.width,u="scrollbars=yes,resizable=yes,toolbar=no,location=yes,width="+r+",height="+a+",left="+Math.round(o/2-r/2)+",top="+Math.round(n/2-a/2);window.open(t,null,u)}},{key:"onTapSignupMonth",value:function(){this._pricingSelected=this.getMonthlyPricing(),this._openPaymentWindow(!1),m.default.sendEvent("Billing","OpenSignupModal")}},{key:"onTapSignupYear",value:function(){this._pricingSelected=this.getYearlyPricing(),this._openPaymentWindow(!1),m.default.sendEvent("Billing","OpenSignupModal")}},{key:"onTapCodeSignup",value:function(){An.menus.alert({text:"Redeeming code is not ready yet in the new backend. Please contact support.",callback:function(){An.menus.openModal(A.a.Modals.ReportBug)}})}},{key:"getMonthlyPricing",value:function(){return this._earlyAdopter?A.a.Pricing.EarlyMonthly:A.a.Pricing.RegMonthly}},{key:"getYearlyPricing",value:function(){return this._earlyAdopter?A.a.Pricing.EarlyYearly:A.a.Pricing.RegYearly}},{key:"getMonthlyPrice",value:function(){return Gr[this.getMonthlyPricing()]}},{key:"getYearlyPrice",value:function(){return Gr[this.getYearlyPricing()]}},{key:"getPlanPrice",value:function(t){return Gr[t]}},{key:"notifyTrialOver",value:function(){if(!An.settings.notifiedTrialOver.get()){if(!An.toasts)return void setTimeout(this.notifyTrialOver.bind(this),0);An.toasts.pushMessage(A.a.MessageID.TrialOver),An.settings.notifiedTrialOver.set(!0)}}},{key:"notifyTrialEndSoon",value:function(){if(!An.settings.notifiedTrialEndSoon.get()){if(!An.toasts)return void setTimeout(this.notifyTrialEndSoon.bind(this),0);An.toasts.pushMessage(A.a.MessageID.TrialEndSoon),An.settings.notifiedTrialEndSoon.set(!0)}}},{key:"isTrialOver",value:function(){var t=!1;return this._premiumStatus.get()===A.a.PremiumStatus.TrialOver?t=!0:this._premiumStatus.get()!==A.a.PremiumStatus.CanceledUser&&this._premiumStatus.get()!==A.a.PremiumStatus.CanceledPastDue||this.canceledUserHasPremiumAccess()||(t=!0),t}},{key:"startTrial",value:function(){var t=this;try{m.default.PAssert(313,!this.isTrialOver(),"Should never try to start a trial once it is over")}catch(e){m.default.reportError(e)}Dr.a.startTrial().then(function(i){if(i.error)if(i.errorCode===A.a.PrivateAPIErrorCodes.TrialOver)An.toasts.pushMessage({text:"Your free trial of Premium has ended. Please contact support@moo.do to extend.",actionText:"OKAY"}),t._premiumStatus.set(A.a.PremiumStatus.TrialOver);else{try{m.default.PAssert(314,!1,"Failed to start trial for user")}catch(e){m.default.reportError(e)}An.toasts.pushMessage({text:"There was an error starting your trial. Please contact support@moo.do.",action:A.a.MessageAction.Contact})}})}},{key:"hasPremiumFeatures",value:function(){return this.hasPremium()||this._premiumStatus.get()===A.a.PremiumStatus.Trial||this.canceledUserHasPremiumAccess()}},{key:"getBillingPeriod",value:function(){return this._pricingSelected}},{key:"loadUserProperties",value:function(t){"premiumStatus"in t&&this._premiumStatus.set(t.premiumStatus);var e=An.settings.userProperties.get();if(e=Object.assign({},e,t),An.settings.userProperties.set(e),this.userProperties=e,this.updateBillingData(),!P.a.isMobile&&!this.userProperties.gid&&An.settings.shouldShowHelp("missingGID")){var i=An.toasts.pushMessage({id:"shouldImportMoodo",text:"If you are coming from the old Moo.do, please import your Premium settings and documents. If you're a new user just click to ignore this message.",hold:!0,actionText:"IMPORT",onClose:function(){i=void 0,An.settings.closeHelp("missingGID")},action:function(){(new Vr.a).authAndImportDocuments()}});An.settings.closedHelps.listen(function t(){An.settings.shouldShowHelp("missingGID")||(setTimeout(function(){return An.settings.closedHelps.unlisten(t)},0),i&&An.toasts.clearMessage(i))})}}}]),t}(),I()(mi.prototype,"cancelSubscription",[H.a],Object.getOwnPropertyDescriptor(mi.prototype,"cancelSubscription"),mi.prototype),I()(mi.prototype,"onTapUpdatePaymentMethod",[H.a],Object.getOwnPropertyDescriptor(mi.prototype,"onTapUpdatePaymentMethod"),mi.prototype),I()(mi.prototype,"onTapViewInvoices",[H.a],Object.getOwnPropertyDescriptor(mi.prototype,"onTapViewInvoices"),mi.prototype),I()(mi.prototype,"onTapDeleteAccount",[H.a],Object.getOwnPropertyDescriptor(mi.prototype,"onTapDeleteAccount"),mi.prototype),I()(mi.prototype,"onTapSignupMonth",[H.a],Object.getOwnPropertyDescriptor(mi.prototype,"onTapSignupMonth"),mi.prototype),I()(mi.prototype,"onTapSignupYear",[H.a],Object.getOwnPropertyDescriptor(mi.prototype,"onTapSignupYear"),mi.prototype),I()(mi.prototype,"onTapCodeSignup",[H.a],Object.getOwnPropertyDescriptor(mi.prototype,"onTapCodeSignup"),mi.prototype),mi);function jr(t,e,i){this._id=t,this._name=e,this._isOpen=!1,this._isReady=!1,this._isAllLoaded=!1,this._storageError=!1,this._loggingEnabled=!1,this._preloadConsumed=!1,this._usesDiskSpace||(this._usesDiskSpace=!1),this._onReadyFns=[],this._onMetadataReadyFns=[],this._cache={},this._metadata={},this._useInMemoryStore=!i||!i.noInMemoryCache,this._useMetadataInMemoryStore=!i||!i.noMetadataInMemoryCache,this._isPerDoc=i&&i.isPerDoc,this.open()}var Yr={getStats:function(t){this.getFilterEntries(function(){return!0},function(e){var i={id:this._id,count:e.length,size:JSON.stringify(e).length};t(i)}.bind(this))},getState:function(){return{isOpen:this._isOpen,isReady:this._isReady,isAllLoaded:this._isAllLoaded,storageError:this._storageError}},enableLogging:function(){this._loggingEnabled=!0},disableLogging:function(){this._loggingEnabled=!1},isLoggingEnabled:function(){return this._loggingEnabled},usesDiskSpace:function(){return this._usesDiskSpace},_cacheInMemory:function(){return this._useInMemoryStore},_cacheMetadataInMemory:function(){return this._useMetadataInMemoryStore},_hasLoadedAll:function(){return this._isAllLoaded},isPerDoc:function(){return this._isPerDoc},getStorageType:function(){try{m.default.PAssert(1201,!1,"SubClass must override")}catch(t){m.default.reportError(t)}},open:function(){this._isOpen=!0},close:function(){this._isOpen=!1,this._isReady=!1},isOpen:function(){return this._isOpen},isReady:function(){return this._isOpen&&this._isReady},requestPreloadData:function(t){var e=this._preloadConsumed;this._preloadConsumed=!0;var i=window.__preload;if(!(!e&&i&&i.cachePreloads&&i.cachePreloads.indexOf(this._id)>=0))return t(void 0);if(i.cacheResults[this._id]){try{m.default.PAssert(1202,!i.cacheCallbacks[this._id],"Should never have active callbacks and results")}catch(a){m.default.reportError(a)}var r=i.cacheResults[this._id];return delete i.cacheResults[this._id],i.cachePreloads.remove(this._id),t(r)}i.cacheCallbacks[this._id]||(i.cacheCallbacks[this._id]=[]),i.cacheCallbacks[this._id].push(t)},isMetadataReady:function(){return this._isOpen&&this._isMetadataReady},notifyCacheReady:function(t){if(t){var e=0;this._storageError=!1,this._isReady=!0;for(var i=0;i<this._onReadyFns.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._onReadyFns[i]()}this._onReadyFns=[]}else this._storageError=!0,this._isReady=!1},notifyCacheMetadataReady:function(t){if(t){var e=0;this._isMetadataReady=!0;for(var i=0;i<this._onMetadataReadyFns.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._onMetadataReadyFns[i]()}this._onMetadataReadyFns=[]}else this._isMetadataReady=!1},onCacheReady:function(t){try{m.default.PAssert(1203,t,"Must provide a valid cb")}catch(e){m.default.reportError(e)}if(this._isReady)setTimeout(t,0);else{try{m.default.PAssert(1204,this._onReadyFns.indexOf(t)<0,"Must not double register a cache ready fn")}catch(e){m.default.reportError(e)}this._onReadyFns.push(t)}},onCacheMetadataReady:function(t){try{m.default.PAssert(1205,t,"Must provide a valid cb")}catch(e){m.default.reportError(e)}if(this._isMetadataReady)setTimeout(t,0);else{try{m.default.PAssert(1206,this._onMetadataReadyFns.indexOf(t)<0,"Must not double register a cache metadata ready fn")}catch(e){m.default.reportError(e)}this._onMetadataReadyFns.push(t)}},setMetadata:function(t,e,i){try{m.default.PAssert(1207,!i,"In memory query is sync")}catch(r){m.default.reportError(r)}this._cacheMetadataInMemory()&&(this._metadata[t]=e)},removeMetadata:function(t,e){try{m.default.PAssert(1208,!e,"In memory query is sync")}catch(i){m.default.reportError(i)}this._cacheMetadataInMemory()&&delete this._metadata[t]},getMetadata:function(t,e){try{m.default.PAssert(1209,!e,"In memory query is sync")}catch(i){m.default.reportError(i)}return this._cacheMetadataInMemory()?this._metadata[t]:void 0},_setRawInMemoryMetadata:function(t){try{m.default.PAssert(1210,this._cacheMetadataInMemory(),"Must be running an in-memory cache")}catch(e){m.default.reportError(e)}this._metadata=t},_getRawInMemoryMetadata:function(){return this._cacheMetadataInMemory()?this._metadata:void 0},_setRawInMemoryCache:function(t){try{m.default.PAssert(1211,this._cacheInMemory(),"Must be running an in-memory cache")}catch(e){m.default.reportError(e)}this._cache=t},_getRawInMemoryCache:function(){return this._cacheInMemory()?this._cache:void 0},count:function(t){try{m.default.PAssert(1212,!t,"In memory query is sync")}catch(e){m.default.reportError(e)}return this._cacheInMemory()?Object.keys(this._cache).length:void 0},size:function(t){try{m.default.PAssert(1213,!t,"In memory query is sync")}catch(e){m.default.reportError(e)}return this._cacheInMemory()?2*JSON.stringify(this._cache).length:void 0},loadAll:function(t){try{m.default.PAssert(1214,!t,"In memory query is sync")}catch(e){m.default.reportError(e)}this._isAllLoaded=!0},getEntrySync:function(t){return this._cacheInMemory()?this._cache[t]:void 0},getEntry:function(t,e){try{m.default.PAssert(1215,!e,"In memory query is sync")}catch(i){m.default.reportError(i)}return this._cacheInMemory()?this._cache[t]:void 0},getBoundEntries:function(t,e,i,r){try{m.default.PAssert(1216,!r,"In memory query is sync")}catch(o){m.default.reportError(o)}var a;if(this._cacheInMemory())for(var n in a=[],this._cache)this._cache[n][t]>=e&&this._cache[n][t]<=i&&a.push(this._cache[n]);return a},getFilterEntries:function(t,e){try{m.default.PAssert(1217,!e,"In memory query is sync")}catch(a){m.default.reportError(a)}var i;if(this._cacheInMemory())for(var r in i=[],this._cache)t(this._cache[r])&&i.push(this._cache[r]);return i},removeEntry:function(t,e){try{m.default.PAssert(1218,!e,"In memory query is sync")}catch(i){m.default.reportError(i)}this._cacheInMemory()&&delete this._cache[t]},hasEntry:function(t,e){try{m.default.PAssert(1220,!e,"In memory query is sync")}catch(i){m.default.reportError(i)}return!!this._cacheInMemory()&&this._cache.hasOwnProperty(t)},cacheEntry:function(t,e,i){try{m.default.PAssert(1221,!i,"In memory query is sync")}catch(r){m.default.reportError(r)}this.isLoggingEnabled()&&m.default.log("Cache Entry: ",t,e),this._cacheInMemory()&&e&&(this._cache[t]=e)},clearCache:function(t){try{m.default.PAssert(1222,!t,"In memory query is sync")}catch(e){m.default.reportError(e)}this._cache={}},clearMetadata:function(t){try{m.default.PAssert(1223,!t,"In memory query is sync")}catch(e){m.default.reportError(e)}this._metadata={}},clearBackingStore:function(t){try{m.default.PAssert(1224,!1,"SubClass must override")}catch(e){m.default.reportError(e)}},dumpData:function(t){console.log("-- Cache: ",this._id,"--"),console.log(this._cache)},onCacheError:function(t){m.default.reportError(t)}};V.a.defineBase(jr),V.a.extend(jr.prototype,Yr);var Xr=jr;function Qr(t,e,i){if(i){try{m.default.PAssert(673,!i.noInMemoryCache,"Invalid in-memory cache option")}catch(r){m.default.reportError(r)}try{m.default.PAssert(674,!i.noMetadataInMemoryCache,"Invalid metadata in-memory cache option")}catch(r){m.default.reportError(r)}i.noInMemoryCache=!1,i.noMetadataInMemoryCache=!1}this._super.constructor.call(this,t,e,i),this._db=void 0}var Jr={getStorageType:function(){return A.a.StorageType.InMemory},setMetadata:function(t,e,i){this._super.setMetadata.call(this,t,e),i&&i(!0)},removeMetadata:function(t,e){this._super.removeMetadata.call(this,t),e&&e(!0)},getMetadata:function(t,e){var i=this._super.getMetadata.call(this,t)||void 0;e&&e(i)},count:function(t){try{m.default.PAssert(675,t,"Must provide a valid callback")}catch(i){m.default.reportError(i)}var e=this._super.count.call(this);t&&t(e)},size:function(t){try{m.default.PAssert(676,t,"Must provide a valid callback")}catch(i){m.default.reportError(i)}var e=this._super.size.call(this);t&&t(e)},loadAll:function(t){this._super.loadAll.call(this),t&&t(!0)},getEntrySync:function(t){try{m.default.PAssert(677,t,"Must provide a valid ID to get")}catch(e){m.default.reportError(e)}return this._super.getEntrySync.call(this,t)||void 0},getEntry:function(t,e){try{m.default.PAssert(678,t,"Must provide a valid ID to get")}catch(r){m.default.reportError(r)}try{m.default.PAssert(679,e,"Must provide a valid entry callback")}catch(r){m.default.reportError(r)}var i=this._super.getEntry.call(this,t)||void 0;e&&e(i,t)},getBoundEntries:function(t,e,i,r){try{m.default.PAssert(680,t,"Must specify a valid index")}catch(n){m.default.reportError(n)}try{m.default.PAssert(681,r,"Must provide a valid entry callback")}catch(n){m.default.reportError(n)}var a=this._super.getBoundEntries.call(this,t,e,i)||[];r&&r(a)},getFilterEntries:function(t,e){try{m.default.PAssert(682,m.default.isFunction(t),"Must specify a valid filter function")}catch(r){m.default.reportError(r)}try{m.default.PAssert(683,e,"Must provide a valid entry callback")}catch(r){m.default.reportError(r)}var i=this._super.getFilterEntries.call(this,t)||[];e&&e(i)},removeEntry:function(t,e){try{m.default.PAssert(684,t,"Must provide valid data id")}catch(i){m.default.reportError(i)}this._super.removeEntry.call(this,t),e&&e(!0)},hasEntry:function(t,e){var i=this._super.hasEntry.call(this,t);e&&e(i)},cacheEntry:function(t,e,i){try{m.default.PAssert(685,t,"Must provide valid data id")}catch(r){m.default.reportError(r)}this._super.cacheEntry.call(this,t,e),i&&i(!0)},clearCache:function(t){this._super.clearCache.call(this),t&&t(!0)},clearMetadata:function(t){this._super.clearMetadata.call(this),t&&t(!0)},clearBackingStore:function(t){t&&t(!0)}};V.a.inherit(Xr,Qr),V.a.extend(Qr.prototype,Jr);var Zr=Qr,Br=i(106);function $r(t,e,i){this._usesDiskSpace=!0,this._db=void 0,this._cacheTable=void 0,this._metadataTable=void 0,this._version=2,this._schema=this._getDefaultSchema(),this._super.constructor.call(this,t,e,i)}var Ur={_makeID:function(t){return t},validID:function(t){return!0},_metadataID:function(t){return t},getStorageType:function(){return A.a.StorageType.IndexedDB},_migrateEntry:function(t,e,i){delete t.cid,this._cacheTable.update(t).done(e).fail(i)},_migrateMetadata:function(t,e,i){delete t.cid,this._super.setMetadata.call(this,t.id,t.value),this._metadataTable.update(t).done(e).fail(i)},open:function(){var t=this;this._super.open.call(this),Br.default.openCacheDatabase(this._id,this._version,this._schema,function(e){try{m.default.PAssert(609,!t._db,"Should not open the cache DB twice")}catch(i){m.default.reportError(i)}e&&(t._db=e,t._cacheTable=e.cache,t._metadataTable=e.metadata),t.notifyCacheMetadataReady(!!e),t.notifyCacheReady(!!e)})},close:function(){this._super.close.call(this),this._db.close(),this._db=void 0,this._cacheTable=void 0,this._metadataTable=void 0},isReady:function(){return this._super.isReady.call(this)&&this._db&&this._cacheTable},isMetadataReady:function(){return this._super.isReady.call(this)&&this._db&&this._metadataTable},notifyCacheReady:function(t){this._super.notifyCacheReady.call(this,t)},notifyCacheMetadataReady:function(t){this._super.notifyCacheMetadataReady.call(this,t)},setMetadata:function(t,e,i){var r=this;if(this._super.setMetadata.call(this,t,e),this.isMetadataReady()){var a={id:t,value:e};try{this._metadataTable.update(a).done(function(){i&&i(!0)}).fail(function(t,e){r.onCacheError(e),i&&i(!1)})}catch(n){this.onTransactionError(n),i&&i(!1)}}else i&&i(!1)},removeMetadata:function(t,e){if(this._super.removeMetadata.call(this,t),this.isMetadataReady())try{this._metadataTable.remove(this._metadataID(t)).done(function(){e&&e(!0)}).fail(function(t){m.default.log("IDB removeMetadata Error: ",t),e&&e(!1)})}catch(i){this.onTransactionError(i),e&&e(!1)}else e&&e(!1)},getMetadata:function(t,e){var i=this._super.getMetadata.call(this,t);if(i)e(i);else if(this.isMetadataReady())try{this._metadataTable.query().only(this._metadataID(t)).limit(1).execute().done(function(t){var i;try{m.default.PAssert(610,!t||0===t.length||1===t.length&&t[0],"Mismatch in metadata value")}catch(r){m.default.reportError(r)}t&&1===t.length&&t[0]&&(i=t[0].value),e(i)}).fail(function(t){m.default.log("IDB getMetadata Error: ",t),e(void 0)})}catch(r){this.onTransactionError(r),e(void 0)}else e(void 0)},count:function(t){if(this.isReady())try{this._cacheTable.query().all().count().execute().done(function(e){t(e)}).fail(function(e){t()})}catch(e){this.onTransactionError(e),t()}else t()},size:function(t){if(this.isReady())try{this._cacheTable.query().all().execute().done(function(e){for(var i=0,r=0,a=0;a<e.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r+=this._entrySize(e[a])}t(r)}).fail(function(e){t()})}catch(e){this.onTransactionError(e),t()}else t()},loadAll:function(t){if(this.isReady())try{this._cacheTable.query().all().execute().done(function(e){for(var i=0,r=0;r<e.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._super.cacheEntry.call(this,e[r].id,e[r])}this._super.loadAll.call(this),t(!0,e)}.bind(this)).fail(function(e){m.default.log("IDB loadAll Error: ",e),this._super.loadAll.call(this),t(!1)})}catch(e){this.onTransactionError(e),t(!1)}else t(!1)},getEntrySync:function(t){try{m.default.PAssert(611,!1,"Sync access to IDB is not supported")}catch(e){m.default.reportError(e)}},getEntry:function(t,e){try{m.default.PAssert(612,t,"Must provide a valid ID to get")}catch(r){m.default.reportError(r)}try{m.default.PAssert(613,e,"Must provide a valid entry callback")}catch(r){m.default.reportError(r)}var i=this._super.getEntry.call(this,t);if(i)e(i);else if(this.isReady())try{this._cacheTable.query().only(this._makeID(t)).limit(1).execute().done(function(i){var r;i&&1===i.length&&(r=i[0],this._super.cacheEntry.call(this,t,r)),e(r,t)}.bind(this)).fail(function(t){m.default.log("IDB getEntry Error: ",t),e(void 0)})}catch(a){this.onTransactionError(a),e(void 0)}else e(void 0)},getBoundEntries:function(t,e,i,r){try{m.default.PAssert(614,t,"Must specify a valid index to query")}catch(a){m.default.reportError(a)}try{m.default.PAssert(615,r,"Must provide a valid entry callback")}catch(a){m.default.reportError(a)}if(this.isReady())try{this._cacheTable.query().filter(function(r){return r[t]>=e&&r[t]<=i}).execute().done(function(t){r(t,!0)}.bind(this)).fail(function(t){r([],!1)}.bind(this))}catch(n){this.onTransactionError(n),r([],!1)}else r([],!1)},getFilterEntries:function(t,e){try{m.default.PAssert(616,m.default.isFunction(t),"Must specify a valid filter function")}catch(i){m.default.reportError(i)}try{m.default.PAssert(617,e,"Must provide a valid entry callback")}catch(i){m.default.reportError(i)}if(this.isReady())try{this._cacheTable.query().filter(t).execute().done(function(t){e(t,!0)}.bind(this)).fail(function(t){e([],!1)}.bind(this))}catch(r){this.onTransactionError(r),e(!1)}else e([],!1)},removeEntry:function(t,e){try{m.default.PAssert(618,t,"Must provide valid data id")}catch(i){m.default.reportError(i)}if(this._super.removeEntry.call(this,t),this.isReady())try{this._cacheTable.remove(this._makeID(t)).done(function(){e&&e(!0)}).fail(function(t){m.default.log("IDB removeEntry Error: ",t),e&&e(!1)})}catch(r){this.onTransactionError(r),e&&e(!1)}else e&&e(!1)},hasEntry:function(t,e){if(this._super.hasEntry.call(this,t))e(!0);else if(this.isReady())try{this._cacheTable.query().only(this._makeID(t)).limit(1).execute().done(function(i){var r;i&&1===i.length&&(r=i[0],this._super.cacheEntry.call(this,t,r)),e(!!r)}.bind(this)).fail(function(t){m.default.log("IDB hasEntry Error: ",t),e(!1)})}catch(i){this.onTransactionError(i),e(!1)}else e(!1)},_entrySize:function(t){var e=0;try{e=2*JSON.stringify(t).length}catch(i){m.default.reportError(i)}return e},cacheEntry:function(t,e,i){try{m.default.PAssert(619,t,"Must provide valid data id")}catch(r){m.default.reportError(r)}try{m.default.PAssert(620,e.id,"Data must also contain a valid item id")}catch(r){m.default.reportError(r)}if(this._super.cacheEntry.call(this,t,e),this.isReady())try{this._cacheTable.update(e).done(function(){if(i)try{i(!0)}catch(t){m.default.reportError(t)}}).fail(function(t,e){this.onCacheError(e),i&&i(!1)}.bind(this))}catch(a){this.onTransactionError(a),i&&i(!1)}else i&&i(!1)},clearCache:function(t){if(this._super.clearCache.call(this),this.isReady())try{this._cacheTable.clear().done(function(){t&&t(!0)}).fail(function(e){m.default.log("IDB clearcache Error: ",e),t&&t(!1)})}catch(e){this.onTransactionError(e),t&&t(!1)}else t&&t(!1)},clearMetadata:function(t){if(this._super.clearMetadata.call(this),this.isReady())try{this._metadataTable.clear().done(function(){t&&t(!0)}.bind(this)).fail(function(e){m.default.log("IDB clearMetadata Error: ",e),t&&t(!1)})}catch(e){this.onTransactionError(e),t&&t(!1)}else t&&t(!1)},dumpData:function(t){t?this._super.dumpData.call(this,t):(console.log("-- Cache: ",this._id,"--"),this.isReady()?this._cacheTable.query().all().execute().done(function(t){for(var e=0,i=0;i<t.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;console.log(t[i])}}).fail(function(t){console.log("Error running IDB query: ",t)}):console.log("Cache not ready"))},_getDefaultSchema:function(){return{cache:{key:{keyPath:"id"}},metadata:{key:{keyPath:"id"}}}},onTransactionError:function(t){Br.default.notifyDBUnexpectedClose(!1)},onCacheError:function(t){if(t&&t.target)try{var e=t.target.error;e?"QuotaExceededError"===e.name||4===e.code?An.cacheManager.hasReportedQuotaError()||(An.cacheManager.reportQuotaExceeded(),An.pluginManager.onCacheLimitExceeded()):"InvalidStateError"===e.name?Br.default.notifyDBUnexpectedClose(!1):m.default.reportError(new Error("IDB Cache Transaction Error"),t):m.default.reportError(new Error("IDB Cache Transaction Error [No Target Error]"),t)}catch(i){m.default.reportError(i)}}};V.a.inherit(Xr,$r),V.a.extend($r.prototype,Ur);var Rr=$r,Er=5e3;function Kr(t,e,i){if(i){try{m.default.PAssert(664,!i.noInMemoryCache,"Invalid in-memory cache option")}catch(r){m.default.reportError(r)}try{m.default.PAssert(665,!i.noMetadataInMemoryCache,"Invalid metadata in-memory cache option")}catch(r){m.default.reportError(r)}i.noInMemoryCache=!1,i.noMetadataInMemoryCache=!1,this.saveTime=isNaN(i.saveTime)?Er:i.saveTime,i.writeOnUnload&&k.a.listen("onUnload",this.writeCache.bind(this)),i.clearBackingOnLoad&&(this.clearBackingOnLoad=!0,k.a.listen("enterForeground",this.clearBackingStore.bind(this)))}else this.saveTime=Er;this._super.constructor.call(this,t,e,i),this._saveTimeout=void 0,V.a.forceBind("writeCache",this)}var xr={_localStorageKey:function(){return"MDC_"+this._id},_onWrite:function(t){t||0===this.saveTime?(this._saveTimeout&&(clearTimeout(this._saveTimeout),this._saveTimeout=void 0),this.writeCache()):this.saveTime>=0&&(this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(this.writeCache,this.saveTime))},writeCache:function(){performance.now();var t,e={metadata:this._getRawInMemoryMetadata(),cache:this._getRawInMemoryCache()};try{t=JSON.stringify(e),nt.a.setValue(this._localStorageKey(),t)}catch(i){m.default.reportError(i)}},close:function(){this._onWrite(!0),this._super.close.call(this)},getStorageType:function(){return A.a.StorageType.LocalStorage},setMetadata:function(t,e,i){this._super.setMetadata.call(this,t,e),this._onWrite(),i&&i(!0)},getMetadata:function(t,e){var i=this._super.getMetadata.call(this,t)||void 0;e&&e(i)},count:function(t){try{m.default.PAssert(666,t,"Must provide a valid callback")}catch(i){m.default.reportError(i)}var e=this._super.count.call(this);t&&t(e)},size:function(t){try{m.default.PAssert(667,t,"Must provide a valid callback")}catch(i){m.default.reportError(i)}var e=this._super.size.call(this);t&&t(e)},loadAll:function(t){try{var e=nt.a.getValue(this._localStorageKey());if(e){var i=JSON.parse(e);this._setRawInMemoryMetadata(i.metadata),this._setRawInMemoryCache(i.cache)}this._super.loadAll.call(this),this.clearBackingOnLoad&&this.clearBackingStore(),t&&t(!0)}catch(r){m.default.reportError(r),this._super.loadAll.call(this),t&&t(!1)}},getEntrySync:function(t){try{m.default.PAssert(668,t,"Must provide a valid ID to get")}catch(e){m.default.reportError(e)}return this._super.getEntrySync.call(this,t)||void 0},getEntry:function(t,e){try{m.default.PAssert(669,t,"Must provide a valid ID to get")}catch(r){m.default.reportError(r)}try{m.default.PAssert(670,e,"Must provide a valid entry callback")}catch(r){m.default.reportError(r)}var i=this._super.getEntry.call(this,t)||void 0;e&&e(i,t)},getBoundEntries:function(t,e,i,r){var a=this._super.getBoundEntries.call(this,t,e,i);r&&r(a)},getFilterEntries:function(t,e){var i=this._super.getFilterEntries.call(this,t);e&&e(i)},removeEntry:function(t,e){try{m.default.PAssert(671,t,"Must provide valid data id")}catch(i){m.default.reportError(i)}this._super.removeEntry.call(this,t),this._onWrite(),e&&e(!0)},hasEntry:function(t,e){var i=this._super.hasEntry.call(this,t);e&&e(i)},cacheEntry:function(t,e,i){try{m.default.PAssert(672,t,"Must provide valid data id")}catch(r){m.default.reportError(r)}this._super.cacheEntry.call(this,t,e),this._onWrite(),i&&i(!0)},clearCache:function(t){this._super.clearCache.call(this),this._onWrite(!0),t&&t(!0)},clearMetadata:function(t){this._super.clearMetadata.call(this),this._onWrite(),t&&t(!0)},clearBackingStore:function(t){nt.a.deleteValue(this._localStorageKey()),t&&t(!0)}};V.a.inherit(Xr,Kr),V.a.extend(Kr.prototype,xr);var br,Or,Wr,_r,ta,ea=Kr,ia=function(){function t(){o()(this,t),this._reportedQuotaError=!1,this._migrationRequired=!1,this._registeredCaches={},this._storageReady=[]}return s()(t,[{key:"init",value:function(){this._storageReady[A.a.StorageType.InMemory]=!0,this._storageReady[A.a.StorageType.LocalStorage]=!0}},{key:"getInfo",value:function(){return{reportedQuotaError:this._reportedQuotaError,migrationRequired:this._migrationRequired,numCaches:Object.keys(this._registeredCaches).length}}},{key:"registerLocalCache",value:function(t,e,i,r){try{m.default.PAssert(315,t,"Must provide a valid cache ID")}catch(o){m.default.reportError(o)}try{m.default.PAssert(316,e,"Must have a valid cache name")}catch(o){m.default.reportError(o)}var a,n=this._createCacheId(t,e);try{m.default.PAssert(317,void 0===this._registeredCaches[n],"Must not have a previously registered cache with the same id")}catch(o){m.default.reportError(o)}switch(m.default.shouldWriteLocal()||(i=A.a.StorageType.InMemory,r&&(r.noInMemoryCache=!1,r.noMetadataInMemoryCache=!1)),i){case A.a.StorageType.InMemory:a=new Zr(n,e,r);break;case A.a.StorageType.LocalStorage:a=new ea(n,e,r);break;case A.a.StorageType.IndexedDB:a=new Rr(n,e,r)}try{m.default.PAssert(318,a,"Must have valid cache after creation")}catch(o){m.default.reportError(o)}return this._registeredCaches[t]=a,this._storageReady[i]&&(a.notifyCacheMetadataReady(!0),a.notifyCacheReady(!0)),a}},{key:"clearLocalCache",value:function(t,e){var i=this._registeredCaches[t];try{m.default.PAssert(319,i,"Must have valid local cache")}catch(r){m.default.reportError(r)}i.clearCache(),e&&i.clearMetadata()}},{key:"clearLocalCaches",value:function(t){for(var e in this._registeredCaches)this.clearLocalCache(e,t)}},{key:"clearPerDocCaches",value:function(t){for(var e in this._registeredCaches){this._registeredCaches[e].isPerDoc()&&this.clearLocalCache(e,t)}}},{key:"_notifyIDBReady",value:function(t){}},{key:"_createCacheId",value:function(t,e){return t}},{key:"notifyMigrationRequired",value:function(){this._migrationRequired=!0}},{key:"needsMigration",value:function(){return this._migrationRequired||1!==An.settings.localDataVersion.get()}},{key:"hasReportedQuotaError",value:function(){return this._reportedQuotaError}},{key:"reportQuotaExceeded",value:function(){this._reportedQuotaError||(this._reportedQuotaError=!0,m.default.reportError(new Error("Quota exceeded!")))}}]),t}(),ra=(br=function(){function t(e,i,r,a,n,u,s,h,d){o()(this,t),this._id=e,this._remoteID=n,this._type=i;try{m.default.PAssert(686,m.default.isDateValid(r),"Must specify a valid schedule date for deferred task")}catch(c){m.default.reportError(c)}this._scheduleDate=r,this._timeout=void 0,this._data=u,this._cbRun=s,this._cbCancel=h,this._cbPersistRemote=d,this._hasRun=!1,this._isCanceled=a,this._destroyed=!1}return s()(t,[{key:"schedule",value:function(){var t=this;try{m.default.PAssert(687,!this._timeout,"Should not schedule the same task multiple times")}catch(i){m.default.reportError(i)}try{m.default.PAssert(688,!this._hasRun,"Should not schedule a task once it has already run once")}catch(i){m.default.reportError(i)}try{m.default.PAssert(689,!this._isCanceled,"Should not schedule canceled tasks")}catch(i){m.default.reportError(i)}var e=Math.max(0,this._scheduleDate.getTime()-Date.now());this._timeout=setTimeout(this.runTask,e),!this._remoteID&&e>0&&kt.a.onLoaded(function(){try{t._cbPersistRemote(t,t._onPersistedRemote)}catch(e){m.default.reportError(e)}})}},{key:"_onCanceled",value:function(t){t&&(this._destroyed=!0,An.deferredTaskManager._notifyTaskComplete(this._id))}},{key:"_onPersistedRemote",value:function(t,e){t&&(this._remoteID=e,An.deferredTaskManager._updateTask(this._id))}},{key:"reschedule",value:function(t){try{m.default.PAssert(690,!this._hasRun,"Should never reschedule a task that has already run")}catch(e){m.default.reportError(e)}try{m.default.PAssert(691,!this._isCanceled,"Should not reschedule canceled tasks")}catch(e){m.default.reportError(e)}try{m.default.PAssert(692,this._timeout,"Must always have already schedule a task that is being rescheduled")}catch(e){m.default.reportError(e)}clearTimeout(this._timeout),this._timeout=void 0,this._scheduleDate=t,this.schedule()}},{key:"cancel",value:function(){var t=this;try{m.default.PAssert(693,this._timeout||this._remoteID,"Must always have already scheduled (locally or remotely) a task that is being canceled")}catch(e){m.default.reportError(e)}try{m.default.PAssert(694,!this._hasRun,"Should not cancel tasks that have already been run")}catch(e){m.default.reportError(e)}this._isCanceled=!0,clearTimeout(this._timeout),this._timeout=void 0,this._remoteID&&kt.a.onLoaded(function(){try{t._cbCancel(t,t._onCanceled)}catch(e){m.default.reportError(e)}}),An.deferredTaskManager._updateTask(this._id)}},{key:"runTask",value:function(){this._timeout=void 0,this._hasRun=!0;try{this._cbRun(this)}catch(t){m.default.reportError(t)}An.deferredTaskManager._notifyTaskComplete(this._id)}},{key:"getData",value:function(){return this._data}},{key:"getType",value:function(){return this._type}},{key:"getScheduleDate",value:function(){return this._scheduleDate}},{key:"getSaveData",value:function(){return{id:this._id,remoteID:this._remoteID,type:this._type,scheduleDate:this._scheduleDate,data:this._data,isCanceled:this._isCanceled}}},{key:"isPersistedRemote",value:function(){return!!this._remoteID}}]),t}(),I()(br.prototype,"_onCanceled",[H.a],Object.getOwnPropertyDescriptor(br.prototype,"_onCanceled"),br.prototype),I()(br.prototype,"_onPersistedRemote",[H.a],Object.getOwnPropertyDescriptor(br.prototype,"_onPersistedRemote"),br.prototype),I()(br.prototype,"runTask",[H.a],Object.getOwnPropertyDescriptor(br.prototype,"runTask"),br.prototype),br),aa=function(){function t(){o()(this,t),this._registeredTypes={},this._deferredTasks={},this._stats={}}return s()(t,[{key:"init",value:function(){var t=this;this._taskCache=An.cacheManager.registerLocalCache("DeferredTasks","DeferredTasks",A.a.StorageType.LocalStorage),this._taskCache.onCacheReady(function(){t._taskCache.loadAll(function(e){try{m.default.PAssert(320,e,"Must be able to load task cache")}catch(i){m.default.reportError(i)}t._taskCache.getFilterEntries(function(){return!0},function(e){for(var i=0,r=0;r<e.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var a=e[r];t.scheduleTask(a.id,a.type,new Date(a.scheduleDate),a.isCanceled,a.remoteID,a.data,!0)}})})})}},{key:"getLastSyncDate",value:function(){var t=An.settings.lastTaskSync.get();try{m.default.PAssert(321,!t||m.default.isString(t),"Must have a valid string sync date")}catch(e){m.default.reportError(e)}return t}},{key:"getStats",value:function(){return{}}},{key:"notifyRemoteTasks",value:function(t){for(var e=0,i=0;i<t.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._handleRemoteTask(t[i])}An.settings.lastTaskSync.set(new Date)}},{key:"_handleRemoteTask",value:function(t){m.default.log("Remote Task: ",t),this.scheduleTask(t.data.threadID,t.type,new Date(t.data.scheduleDate),!1,t.messageID,t.data)}},{key:"registerTaskType",value:function(t,e,i,r){try{m.default.PAssert(322,!this._registeredTypes[t],"Must not double register task type")}catch(a){m.default.reportError(a)}try{m.default.PAssert(323,m.default.isFunction(e),"Must register a valid run callback")}catch(a){m.default.reportError(a)}try{m.default.PAssert(324,m.default.isFunction(i),"Must register a valid cancel callback")}catch(a){m.default.reportError(a)}try{m.default.PAssert(325,m.default.isFunction(r),"Must register a valid persist callback")}catch(a){m.default.reportError(a)}this._registeredTypes[t]={cbRun:e,cbCancel:i,cbPersistRemote:r}}},{key:"_notifyTaskComplete",value:function(t){this._removeTask(t)}},{key:"scheduleTask",value:function(t,e,i,r,a,n,o){try{m.default.PAssert(326,t,"Must supply a valid task ID")}catch(u){m.default.reportError(u)}try{m.default.PAssert(327,e,"Must supply a valid task type")}catch(u){m.default.reportError(u)}try{m.default.PAssert(328,m.default.isDateValid(i),"Must always have a valid scheduled date available")}catch(u){m.default.reportError(u)}this._taskCache.onCacheReady(function(){try{m.default.PAssert(329,this._registeredTypes[e],"Must request a valid registered task type")}catch(u){m.default.reportError(u)}if(this._deferredTasks[t]){var s=this._deferredTasks[t];try{m.default.PAssert(330,s.getType()===e,"Task types must match")}catch(u){m.default.reportError(u)}try{m.default.PAssert(331,s.getScheduleDate().equals(i),"Task schedule dates must match")}catch(u){m.default.reportError(u)}}else{var h=this._registeredTypes[e];if(h){var d=new ra(t,e,i,r,a,n,h.cbRun,h.cbCancel,h.cbPersistRemote);if(this._deferredTasks[t]){m.default.log("Overriding existing task");try{m.default.PAssert(332,this._deferredTasks[t].type===e,"Should only update deferred tasks of the same type")}catch(u){m.default.reportError(u)}}this._addTask(t,d,o),r?d.cancel():d.schedule()}}}.bind(this))}},{key:"cancelTask",value:function(t,e){this._deferredTasks[t].cancel()}},{key:"_updateTask",value:function(t){var e=this._deferredTasks[t];this._taskCache.cacheEntry(t,e.getSaveData())}},{key:"_addTask",value:function(t,e,i){this._deferredTasks[t]=e,i||this._updateTask(t)}},{key:"_removeTask",value:function(t){this._deferredTasks[t]=void 0,this._taskCache.removeEntry(t)}}]),t}(),na=i(87),oa="Suspend",ua="Resume",sa="AsyncSkip",ha="SyncSkip",da="Run",ca="AsyncBegin",va="AsyncComplete",ya="AsyncAbort",ga="AsyncTimeout",la=(Or=function(){function t(e,i){o()(this,t);try{m.default.PAssert(695,i,"Must provide a valid set of task options: "+e)}catch(r){m.default.reportError(r)}this._id=e,this._iterationID=void 0,this._isAsync=i.async,this._isAsyncRunning=!1;try{m.default.PAssert(697,i.task&&m.default.isFunction(i.task),"Must provide a valid task function")}catch(r){m.default.reportError(r)}this._task=i.task,this._delay=i.delay;try{m.default.PAssert(698,void 0===i.asyncTimeout||i.async,"Should never specify an async timeout for a non-async task")}catch(r){m.default.reportError(r)}this._asyncTimeout=i.asyncTimeout||0,this._pauseWhileIdle=i.pauseWhileIdle||!1,this._minDelayOnResume=i.minDelayOnResume||!1;try{m.default.PAssert(699,this._pauseWhileIdle||!this._minDelayOnResume,"Must use pauseWhileIdle to support minDelayOnResume")}catch(r){m.default.reportError(r)}this._suspended=!1,this._remainingTime=0,this._lastUpdate=i.runOnCreate?0:Date.now(),this._asyncStartTime=-1,this._numUpdatesRun=0,this._numUpdatesSkipped=0,this._numUpdatesAsyncSkipped=0,this._numAsyncAborts=0,this._numAsyncTimeouts=0,this._minDelay=i.minDelay||0,this._lastSetDelay=this._delay,this._runningTimeout=void 0,this._asyncAbortTimeout=void 0,this._updateIsRunning=!1,this._isCancelled=!1,this._updateTimes=new na.a(10),this._actions=new na.a(20),this.init()}return s()(t,[{key:"init",value:function(){this._lastUpdate>0?(clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,this._delay)):this._runUpdate()}},{key:"getStats",value:function(){return{numUpdatesRun:this._numUpdatesRun,numUpdatesSkipped:this._numUpdatesSkipped,numUpdatesAsyncSkipped:this._numUpdatesAsyncSkipped,numAsyncAborts:this._numAsyncAborts,numAsyncTimeouts:this._numAsyncTimeouts,updateIsRunning:this._updateIsRunning,isAsync:this._isAsync,isAsyncRunning:this._isAsyncRunning,cancelled:this._isCancelled,suspended:this._suspended,lastUpdate:this._lastUpdate,asyncRunTime:this._asyncRunTime(),timeSinceLastUpdate:this._timeSinceLastUpdate(),updateTimes:this._updateTimes.ordered(),actions:this._actions.ordered()}}},{key:"cancel",value:function(){this._isCancelled=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0}},{key:"abortAsync",value:function(){this._numAsyncAborts++,this.performAction(ya),this._notifyAsyncAborted()}},{key:"performAction",value:function(t){try{m.default.PAssert(700,t,"Invalid action reported")}catch(e){m.default.reportError(e)}this._actions.push({action:t,time:Date.now()})}},{key:"notifyOfSuspend",value:function(){this._pauseWhileIdle&&(this.performAction(oa),this._suspended=!0,this._remainingTime=Math.max(0,this._lastSetDelay-this._timeSinceLastUpdate()),clearTimeout(this._runningTimeout),this._runningTimeout=void 0)}},{key:"notifyOfResume",value:function(){if(this._pauseWhileIdle){this.performAction(ua);var t,e=!this._suspended;if(this._suspended=!1,this._minDelayOnResume)t=Math.max(0,this._minDelay-this._timeSinceLastUpdate());else{try{m.default.PAssert(701,e||this._remainingTime>=0,"Must have a valid remaining time set for task")}catch(i){m.default.reportError(i)}t=this._remainingTime,this._remainingTime=-1}t=Math.max(500,t),clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,t)}}},{key:"isAsync",value:function(){return this._isAsync}},{key:"isAsyncRunning",value:function(){return this.isAsync()&&this._isAsyncRunning}},{key:"_notifyUpdateAsyncSkipped",value:function(){this._numUpdatesAsyncSkipped++,this.performAction(sa)}},{key:"_notifyUpdateSkipped",value:function(){this._numUpdatesSkipped++,this.performAction(ha)}},{key:"_notifyUpdateRun",value:function(){this._lastUpdate=Date.now(),this._updateTimes.push(this._lastUpdate),this._numUpdatesRun++,this.performAction(da)}},{key:"_timeSinceLastUpdate",value:function(){return Date.now()-this._lastUpdate}},{key:"_asyncRunTime",value:function(){var t=0;return this._asyncStartTime>0&&(t=Date.now()-this._asyncStartTime),t}},{key:"_notifyAsyncBegin",value:function(){return this.performAction(ca),this._isAsyncRunning=!0,this._iterationID=m.default.generateTempId(),this._asyncStartTime=Date.now(),this._asyncTimeout&&(this._asyncAbortTimeout=setTimeout(this._handleAsyncAbortTimeout,this._asyncTimeout)),this._iterationID}},{key:"_notifyAsyncComplete",value:function(){this.performAction(va),this._isAsyncRunning=!1,this._asyncStartTime=-1,this._iterationID=void 0,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)}},{key:"_notifyAsyncAborted",value:function(){this._isAsyncRunning=!1,this._asyncStartTime=-1,this._asyncAbortTimeout&&(clearTimeout(this._asyncAbortTimeout),this._asyncAbortTimeout=void 0)}},{key:"_handleAsyncAbortTimeout",value:function(){this._numAsyncTimeouts++,this.performAction(ga),this._notifyAsyncAborted()}},{key:"_runUpdate",value:function(t){var e=this,i=arguments;try{m.default.PAssert(702,!this._isCancelled,"Should never run a cancelled task")}catch(a){m.default.reportError(a)}try{m.default.PAssert(704,!this._updateIsRunning,"Should not run another update while already running one: "+this._id)}catch(a){m.default.reportError(a)}if(!this._updateIsRunning){if(this._updateIsRunning=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0,this._notifyUpdateRun(),this.isAsync())if(this.isAsyncRunning())this._asyncTimeout&&this._asyncTimeout<this._asyncRunTime()?(this.abortAsync(),setTimeout(this._runUpdate.bind(this,t),0)):this._notifyUpdateAsyncSkipped();else{var r=this._notifyAsyncBegin();try{this._task(function(){try{m.default.PAssert(706,r===e._iterationID,"Callback is only valid while task is considered running")}catch(a){m.default.reportError(a)}e._notifyAsyncComplete(),t&&t.apply(e,i)})}catch(n){m.default.reportError(n),this._notifyAsyncComplete()}}else try{this._task()}catch(n){m.default.reportError(n)}this._runningTimeout=setTimeout(this._runUpdate,this._delay),this._lastSetDelay=this._delay,this._remainingTime=this._delay,this._updateIsRunning=!1}}},{key:"requestUpdate",value:function(){if(this._timeSinceLastUpdate()>this._minDelay)this._runUpdate();else{this._notifyUpdateSkipped();var t=this._minDelay-this._timeSinceLastUpdate();clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,t),this._lastSetDelay=this._minDelay}}},{key:"forceUpdate",value:function(t){this._runUpdate(t)}},{key:"breakOnNextUpdate",value:function(){0}}]),t}(),I()(Or.prototype,"_notifyAsyncComplete",[H.a],Object.getOwnPropertyDescriptor(Or.prototype,"_notifyAsyncComplete"),Or.prototype),I()(Or.prototype,"_handleAsyncAbortTimeout",[H.a],Object.getOwnPropertyDescriptor(Or.prototype,"_handleAsyncAbortTimeout"),Or.prototype),I()(Or.prototype,"_runUpdate",[H.a],Object.getOwnPropertyDescriptor(Or.prototype,"_runUpdate"),Or.prototype),Or),pa=function(){function t(){o()(this,t),this._tasks={}}return s()(t,[{key:"init",value:function(){P.a.isMobile||(window.addEventListener("focus",this._handleFocus.bind(this)),window.addEventListener("blur",this._handleBlur.bind(this)))}},{key:"getStats",value:function(){var t={};for(var e in this._tasks)t[e]=this._tasks[e].getStats();return t}},{key:"createRecurringTask",value:function(t,e){try{m.default.PAssert(333,!this._tasks[t],"Must not register multiple tasks with the same ID")}catch(r){m.default.reportError(r)}var i=new la(t,e);return this._tasks[t]=i,i}},{key:"getRecurringTask",value:function(t){try{m.default.PAssert(334,this._tasks[t],"Must only retreive a valid recurring task")}catch(e){m.default.reportError(e)}return this._tasks[t]}},{key:"hasRecurringTask",value:function(t){return!!this._tasks[t]}},{key:"cancelRecurringTask",value:function(t){try{m.default.PAssert(335,this._tasks[t],"Must only cancel a valid recurring task")}catch(e){m.default.reportError(e)}this._tasks[t].cancel(),delete this._tasks[t]}},{key:"_handleFocus",value:function(){for(var t in this._tasks)this._tasks[t].notifyOfResume()}},{key:"_handleBlur",value:function(){for(var t in this._tasks)this._tasks[t].notifyOfSuspend()}}]),t}(),ma=(Wr=function(){function t(){o()(this,t),this._numTimesItemsUpdated=0,this._itemsUpdateTimeout=void 0,this.itemFlushStacks=[],this.EnableItemFlushStacks=!0,this._isUpdating=!1,this._numFlushesInCommit=0,this._isWaitingUpdateItems=0,this._itemsDirty=!1,this._forceNotify=!1,this._updateSearch=!1,this._itemsUpdateWatchdog=void 0,this._lastUpdateItemsStack=void 0}return s()(t,[{key:"checkItemsUpdated",value:function(){0}},{key:"notifyItemsUpdated",value:function(t,e){this._numTimesItemsUpdated++,this.EnableItemFlushStacks&&this.itemFlushStacks.push({stack:m.default.getCurrentStack("Update Items Stack"),panes:t,forceNotify:e}),this._itemsUpdateTimeout||(this._itemsUpdateTimeout=setTimeout(this.checkItemsUpdated,0))}},{key:"_updateAllItems",value:function(){var t=this._forceNotify;this._forceNotify=!1;var e=this._updateSearch;(this._updateSearch=!1,this._itemsDirty||t)&&(this._itemsDirty=!1,this._isUpdating=!0,An.PaneManager.runForEachPane(function(i){(t||i.isItemsDirty())&&i.updateItemsImmediate(e,t)}),this._isUpdating=!1)}},{key:"updateWatchdog",value:function(){m.default.log("Last Update Items Stack: "+this._lastUpdateItemsStack);try{m.default.PAssert(337,!1,"Update Watchdog Triggered - This should never happen.",this._isWaitingUpdateItems)}catch(t){m.default.reportError(t)}this._isWaitingUpdateItems=1,this.commitUpdateItems()}},{key:"isUpdatingItems",value:function(){return this._isWaitingUpdateItems>0&&this._itemsDirty}},{key:"beginUpdateItems",value:function(){this._isWaitingUpdateItems++,1===this._isWaitingUpdateItems&&(this._lastUpdateItemsStack=m.default.getCurrentStack("Update Items Stack"),this._itemsUpdateWatchdog=setTimeout(this.updateWatchdog,0))}},{key:"commitUpdateItems",value:function(t,e){try{m.default.PAssert(340,this._isWaitingUpdateItems>0,"Missing a call to beginUpdateItems: ",this._isWaitingUpdateItems)}catch(i){m.default.reportError(i)}this._isWaitingUpdateItems--,0===this._isWaitingUpdateItems&&(clearTimeout(this._itemsUpdateWatchdog),this._itemsUpdateWatchdog=void 0,this._lastUpdateItemsStack=void 0,this._numFlushesInCommit=0),this._itemsDirty&&this.updateAllItems(t,e)}},{key:"flushItemsUpdate",value:function(t){this.isUpdatingItems()&&(t?t.isItemsDirty()&&(this._itemsDirty||this._forceNotify)&&(this._numFlushesInCommit++,t.updateItemsImmediate(this._updateSearch,this._forceNotify)):(this._numFlushesInCommit++,this._updateAllItems()))}},{key:"updateAllItems",value:function(t,e){try{m.default.PAssert(341,void 0===t||m.default.isBoolean(t),"Must supply a bool param for updateSearch")}catch(i){m.default.reportError(i)}try{m.default.PAssert(342,void 0===e||m.default.isBoolean(e),"Must supply a bool param for forceNotify")}catch(i){m.default.reportError(i)}this._itemsDirty=!0,e&&(this._forceNotify=e),t&&(this._updateSearch=t),0===this._isWaitingUpdateItems&&this._updateAllItems()}}]),t}(),I()(Wr.prototype,"checkItemsUpdated",[H.a],Object.getOwnPropertyDescriptor(Wr.prototype,"checkItemsUpdated"),Wr.prototype),I()(Wr.prototype,"updateWatchdog",[H.a],Object.getOwnPropertyDescriptor(Wr.prototype,"updateWatchdog"),Wr.prototype),Wr),fa=i(50),ka=0,Aa=(_r=function(){function t(e,i){o()(this,t);try{m.default.PAssert(707,e,"Must provide valid message info")}catch(r){m.default.reportError(r)}try{m.default.PAssert(708,i,"Must provide a valid message owner")}catch(r){m.default.reportError(r)}if(this.info=e,this.id=e.id||"Message_"+ka++,this.owner=i,this.timeout=e.timeout||A.a.ToastTimeoutDefault,this.text=new U.a(e.text),this.action=e.action||A.a.MessageAction.Default,this.isBig=e.big,this.data=e.data,this.hold=!e.timeout&&!1!==e.hold&&(e.hold||this.action!==A.a.MessageAction.Default),this.noIgnore=e.noIgnore,this.onCloseFn=e.onClose,this.clearTimeout=void 0,this._isVisible=!1,this.actionText=e.actionText,!this.actionText)switch(this.action){case A.a.MessageAction.Default:this.actionText="";break;case A.a.MessageAction.Reload:case A.a.MessageAction.ResetClient:this.actionText="RELOAD";break;case A.a.MessageAction.Okay:this.actionText="OKAY";break;case A.a.MessageAction.Blog:this.actionText="BLOG";break;case A.a.MessageAction.Undo:this.actionText="UNDO";break;case A.a.MessageAction.LoginScreen:this.actionText="LOGIN";break;case A.a.MessageAction.Contact:this.actionText="CONTACT";break;case A.a.MessageAction.OpenSettings:case A.a.MessageAction.OpenAccountSettings:case A.a.MessageAction.OpenLinkedSettings:case A.a.MessageAction.OpenGeneralSettings:case A.a.MessageAction.OpenCalendarSettings:this.actionText="SETTINGS";break;case A.a.MessageAction.OpenGoogleDrive:this.actionText="GOOGLE DRIVE";break;case A.a.MessageAction.OpenDisplaySettings:this.actionText="DISPLAY SETTINGS";break;case A.a.MessageAction.StartDemo:this.actionText="START DEMO"}}return s()(t,[{key:"show",value:function(){this._isVisible||(this._isVisible=!0,this.hold||(this.clearTimeout=setTimeout(this.hide,this.timeout)),this.owner.onMessageShow(this))}},{key:"hide",value:function(t){this._isVisible&&(this._isVisible=!1,clearTimeout(this.clearTimeout),this.clearTimeout=void 0,this.onCloseFn&&this.onCloseFn(this),t||this.owner.onMessageHide(this))}},{key:"isVisible",value:function(){return this._isVisible}},{key:"doAction",value:function(t){if(this.isVisible()){if(m.default.isFunction(this.action))this.action();else switch(this.action){case A.a.MessageAction.None:case A.a.MessageAction.Okay:case A.a.MessageAction.Default:break;case A.a.MessageAction.Reload:m.default.reload();break;case A.a.MessageAction.LoginScreen:V.a.removeURLParam("demo");break;case A.a.MessageAction.Demo:V.a.insertURLParam("demo","true");break;case A.a.MessageAction.ResetClient:break;case A.a.MessageAction.OpenURL:var e=this.data?this.data.url:void 0;try{m.default.PAssert(709,e,"Should always have a valid URL to navigate")}catch(i){m.default.reportError(i)}e&&m.default.openUrl(e);break;case A.a.MessageAction.Blog:m.default.openUrl("https://www.moo.do/blog/updates");break;case A.a.MessageAction.Undo:fa.a.undo();break;case A.a.MessageAction.LoginScreen:V.a.removeURLParam("demo",!0),V.a.removeURLParam("dmode");break;case A.a.MessageAction.Contact:An.menus.openModal(A.a.Modals.ReportBug);break;case A.a.MessageAction.OpenSettings:P.a.isMobile?An.menus.openModal(A.a.Modals.MobileSettings):An.menus.openSettings(A.a.SettingsSections.Plugins);break;case A.a.MessageAction.OpenGeneralSettings:P.a.isMobile?An.menus.openModal(A.a.Modals.MobileSettings):An.menus.openSettings(A.a.SettingsSections.General);break;case A.a.MessageAction.OpenAccountSettings:P.a.isMobile?An.menus.openModal(A.a.Modals.MobileSettings):An.menus.openSettings(A.a.SettingsSections.Account);break;case A.a.MessageAction.OpenLinkedSettings:P.a.isMobile||An.menus.openSettings(A.a.SettingsSections.Linked);break;case A.a.MessageAction.OpenCalendarSettings:P.a.isMobile?An.menus.openModal(A.a.Modals.MobileSettings):An.menus.openSettings(A.a.SettingsSections.GoogleCalendar);break;case A.a.MessageAction.OpenGoogleDrive:m.default.openUrl("https://drive.google.com");break;case A.a.MessageAction.OpenDisplaySettings:P.a.isMobile||m.default.vmMain.isDisplaySettingsOpen.set(!0);break;case A.a.MessageAction.StartDemo:window.postMessage("resume","*");break;default:try{m.default.PAssert(710,!1,"Invalid message action, add a new case here or pass in a function",this.action)}catch(i){m.default.reportError(i)}}m.default.stopPropagation(t),this.info.holdOnAction||this.hide()}}},{key:"onTapIgnore",value:function(t){this.isVisible()&&!this.noIgnore&&this.hide()}},{key:"setText",value:function(t){this.text.set(t)}}]),t}(),I()(_r.prototype,"hide",[H.a],Object.getOwnPropertyDescriptor(_r.prototype,"hide"),_r.prototype),I()(_r.prototype,"onTapIgnore",[H.a],Object.getOwnPropertyDescriptor(_r.prototype,"onTapIgnore"),_r.prototype),_r),Sa=function(){function t(){o()(this,t),this.queue=new R.a,this.defaultMessages=[],this.defaultMessages[A.a.MessageID.Undefined]=void 0}return s()(t,[{key:"getMessageById",value:function(t){void 0===this.defaultMessages[t]&&this.initMessageById(t);try{m.default.PAssert(343,void 0!==this.defaultMessages[t],"After init message should always be defined")}catch(e){m.default.reportError(e)}return this.defaultMessages[t]}},{key:"testMessageById",value:function(t){return!!this.defaultMessages[t]}},{key:"initMessageById",value:function(t){var e;switch(t){case A.a.MessageID.ConnectionError:e={text:"Connection error detected. Please reload to try again.",action:A.a.MessageAction.Reload};break;case A.a.MessageID.OfflineUndo:e={text:"Offline undo/redo has been disabled temporarily.",hold:!0};break;case A.a.MessageID.FatalError:e={text:"There was a fatal error in the application. "+P.a.actionVerbCaps()+" to restart.",action:A.a.MessageAction.Reload};break;case A.a.MessageID.MailbirdClick:e={text:"Sorry, emails can currently only be opened from inside Mailbird.",action:A.a.MessageAction.Okay};break;case A.a.MessageID.ExitDemo:e={text:"Changes are not saved in demo",action:A.a.MessageAction.LoginScreen,hold:!0,noIgnore:!0};break;case A.a.MessageID.ShareFailure:e={text:"There was an error sharing the file you attached.",action:A.a.MessageAction.OpenSettings,timeout:8e3};break;case A.a.MessageID.ThisIsDemo:e={text:"Click anywhere to try this live demo of <b>Moo.do</b>",onClose:function(){window.parent.postMessage("userInteracted","*")},hold:!0,big:!0};break;case A.a.MessageID.InviteFailure:e={text:"Failed to use referral code. Please try again in your account settings.",action:A.a.MessageAction.OpenAccountSettings};break;case A.a.MessageID.InviteSuccess:e={text:"You have successfully used your referral code. Enjoy your additional free trial of premium Moo.do!",action:A.a.MessageAction.Okay};break;case A.a.MessageID.PremiumRequired:e={text:"You must be a premium subscriber to use plugins.",action:A.a.MessageAction.OpenAccountSettings,actionText:"LEARN MORE"};break;case A.a.MessageID.TrialOver:e={text:"Your trial of Premium has come to an end. Please sign up to continue using Premium features.",action:A.a.MessageAction.OpenAccountSettings,actionText:"SETTINGS"};break;case A.a.MessageID.TrialEndSoon:e={text:"Your trial of Premium is ending soon. Please sign up to continue using Premium features after your trial ends.",action:A.a.MessageAction.OpenAccountSettings,actionText:"SETTINGS"};break;case A.a.MessageID.WarnLargeFile:e={text:"Warning: You are uploading a large file. If the upload is not successful, try uploading directly to Google Drive.",action:A.a.MessageAction.OpenGoogleDrive};break;case A.a.MessageID.InviteInvalid:e={text:"Invalid referral code. Please try again in your account settings.",action:A.a.MessageAction.OpenAccountSettings,actionText:"OKAY"};break;case A.a.MessageID.NoSharingWarning:e={text:"You have shared your document with someone else, however the files attached have not been shared due to your permissions settings.",action:A.a.MessageAction.OpenSettings,actionText:"SETTINGS"};break;case A.a.MessageID.LostPermission:e={text:"Moo.do has lost permissions for a plugin or option you enabled. Please update your plugin settings.",action:A.a.MessageAction.OpenSettings,actionText:"SETTINGS"};break;case A.a.MessageID.CalendarSync:e={text:"There was an error syncing your calendars.",action:A.a.MessageAction.OpenCalendarSettings,actionText:"SETTINGS"};break;case A.a.MessageID.EmailSendFail:e={text:"Your email was not sent, there was an error contacting the remote server."};break;case A.a.MessageID.EmailUpdateFail:e={text:"Unable to save draft to Gmail. Your draft is still saved locally."};break;case A.a.MessageID.EmailLabelFail:e={text:"Unable to sync you changes to Gmail. Your changes are still saved locally."};break;case A.a.MessageID.EmailSyncFail:e={text:"There was an error syncing your Gmail data.",action:function(){An.pluginManager.getPluginGmail().runThreadSync()},actionText:"RETRY"};break;case A.a.MessageID.DemoPluginClick:e={text:"Outside of demo mode this would show you more information about the plugin.",timeout:3e3};break;case A.a.MessageID.PromptScriptStart:e={text:"Start demo",hold:!0,big:!0,action:A.a.MessageAction.StartDemo};break;case A.a.MessageID.SnoozeOffline:e={text:"You must be online to Snooze. Please try again when Moo.do has connected.",action:A.a.MessageAction.Okay};break;case A.a.MessageID.NeedDrivePermission:e={text:"Attaching files already in Drive requires 'Shared Drive' to be enabled in settings.",action:A.a.MessageAction.OpenSettings};break;case A.a.MessageID.NeedGmailPermission:e={text:"Sending email requires the Gmail plugin to be enabled in settings.",action:A.a.MessageAction.OpenSettings};break;case A.a.MessageID.LostLinked:e={text:"Moo.do has lost access to one of your linked accounts.",action:A.a.MessageAction.OpenLinkedSettings};break;case A.a.MessageID.GmailDisabled:e={text:"Gmail may not be enabled on your Google account. Please contact your domain admin or reload app.",action:A.a.MessageAction.Okay};break;case A.a.MessageID.LocalWritesDisabled:e={text:"There was an error writing to the local cache. Please restart Moo.do.",action:A.a.MessageAction.Reload};break;case A.a.MessageID.MissingOffline:case A.a.MessageID.MissingOfflineMobile:e={text:"We are missing authorization for your account. Please reauthorize.",actionText:"REAUTHORIZE",action:function(){ct.a.enableOfflineFeatures(!0)}};break;case A.a.MessageID.FlatSearchMultiSelect:e={text:"Editing multiple items in flat search results is not supported because it would have unpredictable results."};break;case A.a.MessageID.FlatSearchEnter:e={text:"Pressing Enter in flat search results is not supported because it would have unpredictable results."};break;case A.a.MessageID.FlatSearchTab:e={text:"Indenting search results while in flat search results is not supported because it would have unpredictable results."};break;case A.a.MessageID.ReadOnlyCalendar:e={text:"You do not have write permission for the calendar you are trying to modify."};break;case A.a.MessageID.CalendarSaveFail:e={text:"Some changes you made were not able to be saved properly. Please free up disk space and try again."};break;case A.a.MessageID.QuotaError:e={text:"You have run out of disk space. Moo.do will be unable to operate offline.",timeout:3e3};break;case A.a.MessageID.ReselectEmail:e={text:"Please re-select the email item and try again."};break;case A.a.MessageID.ReactError:e={text:"The application has encountered an error. The developers have been notified, but sending a bug report describing what happened would be very helpful!",actionText:"REPORT",action:function(){An.menus.openModal(A.a.Modals.ReportBug)}};break;case A.a.MessageID.PaneLoadTimeout:e={text:"The file is taking an unusually long time to load. Please try loading again.",actionText:"RELOAD",action:m.default.reload};break;default:try{m.default.PAssert(344,!1,"Invalid MessageID: ",t)}catch(i){m.default.reportError(i)}}e&&(this.defaultMessages[t]=new Aa(e,this))}},{key:"pushMessage",value:function(t){try{m.default.PAssert(345,t,"Must supply a valid message to display")}catch(i){m.default.reportError(i)}var e;if(t instanceof Aa)e=t;else if(m.default.isObject(t))this.hasMsgWithText(t.text)||(e=new Aa(t,this));else if(m.default.isString(t))this.hasMsgWithText(t)||(e=new Aa({text:t},this));else if(!(e=this.getMessageById(t))){try{m.default.PAssert(346,!1,"Invalid data passed to message creation")}catch(i){m.default.reportError(i)}m.default.log("Message not created properly",t)}return e&&e.show(),e}},{key:"clearMessage",value:function(t){var e;return t instanceof Aa?e=t:this.testMessageById(t)&&(e=this.getMessageById(t)),e&&e.hide(),e}},{key:"isMessageVisible",value:function(t){var e=!1;t instanceof Aa?e=t.isVisible():this.testMessageById(t)&&(e=this.getMessageById(t).isVisible());return e}},{key:"onMessageShow",value:function(t){try{m.default.PAssert(347,t,"Must pass in a valid message to add to the queue")}catch(e){m.default.reportError(e)}try{m.default.PAssert(348,t&&t.doAction,"Message added to queue must have valid API exposed - doAction")}catch(e){m.default.reportError(e)}t instanceof Aa?this.queue.push(t):m.default.reportError(new Error("Toast message must be an instance of Toast"),t)}},{key:"onMessageHide",value:function(t){try{m.default.PAssert(349,t,"Must pass in a valid message to be removed from the queue")}catch(i){m.default.reportError(i)}var e=this.queue.indexOf(t);if(e<0)try{m.default.PAssert(350,!1,"Trying to remove an invalid message from the queue")}catch(i){m.default.reportError(i)}else this.queue.splice(e,1)}},{key:"hasMsgWithText",value:function(t){return!!this.queue.get().find(function(e){return e.text.get()===t})}}]),t}(),wa=function(){function t(){o()(this,t)}return s()(t,[{key:"init",value:function(){}},{key:"render",value:function(t,e){var i,r=0,a=[],n=e.convertSpaces,o=e.pane,u=e.noPrefix,s=e.suffix,h=e.highlightSearch,d=e.item,c=!1;try{m.default.PAssert(575,t,"C Item has no els: ")}catch(P){m.default.reportError(P)}t||(t=[]);for(var v=0;v<t.length;++v){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var y=t[v],g=y.getAttrs(),l="",p="",f=y.getStyledText(o,!0,h,d);if(!h||g&&y.hasClass("plugin")?y.hasClass("plugin")||(f=m.default.escape(f)):f=this.replaceTextWithSearch(f,o),n&&(f=f&&f.replace(/ /g,"&nbsp;")),!u||!y.hasClass("itemPrefix"))if(g){if(o&&!o.plugin&&y.hasClass("plugin_drive_image_inline")){var k=An.pluginManager.getPluginDrive(),S=k.getAttachment(y.getAttr("plugin-id")),w=k.getAttachUrl(S);if(w)return{isImage:!0,isDriveImage:!0,maxWidth:k.getAttachWidth(S),src:w,srcDataUrl:k.getAttachDataUrl(S),text:y.getParsedText(),originalText:y.getParsedText(),previousText:a.join(""),attach:S,nextText:v<t.length-1?" ":""}}if(y.hasClass("mdImage"))return{isImage:!0,src:y.getAttr("data-href"),text:y.getParsedText(),maxWidth:y.getAttr("size"),originalText:y.getAttr("data-original-text"),previousText:a.join(""),nextText:v<t.length-1?" ":""};var L="",F="",C=y.getClassString();for(var I in y.getAttr("appLink")&&(c||(L+='<span class="appLink '+((y.hasClass("evernote")?"Evernote":"")||(y.hasClass("onenote")?"OneNote":"")||(y.hasClass("bear")?"Bear":""))+'">',L+='<span contenteditable="false"'+(y.getAttr("appLinkStart")?' class="appLinkStart"':"")+"></span>"),c=!0),y.hasClass("plugin")&&(f="<span>"+f+"</span>"),L+="<span ",F+=">"+f+"</span>",y.hasClass("plugin")&&(L+='contenteditable="false" '),g)g.hasOwnProperty(I)&&("cls"===I?(p='class="'+C+'" ',"itemPrefix"===g[I][0]&&(i=!0)):"appLink"!==I&&(l+=I+'="'+g[I]+'" '));!c||v!==t.length-1&&t[v+1].getAttr("appLink")||(F+="</span>",c=!1),p||l?a.push(L+(p||"")+(l?" "+l:"")+F):a.push(f)}else a.push(f)}return i&&1===t.length&&a.push("<span>"+A.a.TextSpace+"</span>"),s&&a.push(s),a.join("")}},{key:"replaceTextWithSearch",value:function(t,e){for(var i=0,r=e.search.getSearchWords(),a=t.toLowerCase(),n=[],o=t.length+1,u=0;u<r.length;u++){var s=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var h=r[u],d=void 0,c=void 0;(d=a.indexOf(h,c))>=0;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(d>=0)for(var v=0,y=d;y<d+h.length;y++){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;(isNaN(o)||y<o)&&(o=y),n[y]=!0}c=d+1}}if(o<=t.length)for(var g=0,l=-1,p=!0,f=t.length-1;f>=o-1;f--){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;if(l>=0&&(f<0||!n[f])){var k=t.substring(f+1,l+1),A=t.substr(l+1),S=t.substr(0,f+1);f===o&&(S=m.default.escape(S)),p&&(A=m.default.escape(A),p=!1),t=S+'<span class="c-search-highlight">'+m.default.escape(k)+"</span>"+A,l=-1}n[f]&&l<0&&(l=f)}else t=m.default.escape(t);return t}}]),t}(),La=i(30),Fa=i.n(La),Ca=i(48),Ia=i.n(Ca),Pa=i(47),Na=function(){function t(){o()(this,t)}return s()(t,[{key:"init",value:function(){this.storage=Pa.a.storage()}},{key:"uploadString",value:function(){var t=Ia()(Fa.a.mark(function t(e,i){var r=this;return Fa.a.wrap(function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise(function(t,a){var n=r.storage.ref(e).putString(i);n.on("state_changed",function(t){},function(t){a(t)},function(){n.snapshot.ref.getDownloadURL().then(function(e){return t(e)})})}));case 1:case"end":return t.stop()}}},t,this)}));return function(e,i){return t.apply(this,arguments)}}()},{key:"getString",value:function(){var t=Ia()(Fa.a.mark(function t(e){var i,r;return Fa.a.wrap(function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:return t.next=2,this.storage.ref(e).getDownloadURL();case 2:if(!(i=t.sent)){t.next=14;break}return t.prev=4,t.next=7,fetch(i);case 7:return r=t.sent,t.abrupt("return",r.text());case 11:t.prev=11,t.t0=t.catch(4),m.default.reportError(t.t0);case 14:case"end":return t.stop()}}},t,this,[[4,11]])}));return function(e){return t.apply(this,arguments)}}()}]),t}(),Ha=i(73),Ma=new(function(){function t(){o()(this,t)}return s()(t,[{key:"deriveKey",value:function(t,e){var i=(new TextEncoder).encode(t),r=Ha.a.str2ab(e);return crypto.subtle.importKey("raw",i,{name:"PBKDF2"},!1,["deriveBits","deriveKey"]).then(function(t){return crypto.subtle.deriveKey({name:"PBKDF2",salt:r,iterations:2e5,hash:"SHA-512"},t,{name:"AES-CTR",length:256},P.a.isMobile,["encrypt","decrypt"])}).then(function(t){return t})}},{key:"importKey",value:function(t){return crypto.subtle.importKey("raw",t,"AES-CTR",!0,["encrypt","decrypt"])}},{key:"exportKey",value:function(t){return crypto.subtle.exportKey("raw",t)}},{key:"encrypt",value:function(t,e,i){var r={name:"AES-CTR",counter:i,length:128};return crypto.subtle.encrypt(r,e,t)}},{key:"decrypt",value:function(t,e,i){var r={name:"AES-CTR",counter:i,length:128};return crypto.subtle.decrypt(r,e,t)}}]),t}()),za=new(function(){function t(){o()(this,t)}return s()(t,[{key:"key",value:function(t,e){return Ma.deriveKey(t,e)}},{key:"saltToCounter",value:function(t){var e=Ha.a.str2ab(t);if(e.length>16)e=e.slice(0,16);else if(e.length<16){for(var i=0,r=new Uint8Array(16),a=0;a<e.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r[a]=e[a]}e=r}return e}},{key:"encrypt",value:function(t,e,i){var r=this.saltToCounter(i),a=Ha.a.unicode2ab(t);return Ma.encrypt(a,e,r).then(function(t){return Ha.a.ab2str(t)})}},{key:"decrypt",value:function(t,e,i){var r=this.saltToCounter(i),a=Ha.a.str2ab(t);return Ma.decrypt(a,e,r).then(function(t){return Ha.a.ab2unicode(t)})}}]),t}()),Da="afolaw8klslbsahgbeoiya4pifoqlncduzvxgze60lvk17sevauroatsxm8qqia",Va=new Uint8Array([76,30,217,70,117,53,119,240,33,22,147,24,106,228,253,86,175,251,159,47,232,124,89,230,19,65,243,211,58,83,88,158]).buffer;function Ga(t){this.message=t,"captureStackTrace"in Error?Error.captureStackTrace(this,Ga):this.stack=(new Error).stack}function Ta(t){this.message=t,"captureStackTrace"in Error?Error.captureStackTrace(this,Ta):this.stack=(new Error).stack}Ga.prototype=Object.create(Error.prototype),Ga.prototype.name="InvalidArgumentError",Ga.prototype.constructor=Ga,Ta.prototype=Object.create(Ga.prototype),Ta.prototype.name="InvalidPasswordError",Ta.prototype.constructor=Ta;var qa=(ta=function(){function t(){o()(this,t),this.sentinel=A.a.EncryptionSentinel,this.keys={},this.importKeys({})}return s()(t,[{key:"canDecryptSentinel",value:function(t){return!!this.getKeyBySentinel(t)}},{key:"getKeyBySentinel",value:function(t){for(var e in this.keys)if(this.keys[e].sentinel===t)return this.keys[e].key}},{key:"encryptSentinel",value:function(t,e){return za.encrypt(this.sentinel,t,e)}},{key:"createKeyInfo",value:function(t){var e=this,i=t.name,r=t.password,a=t.sentinelSalt;return za.key(r,Da).then(function(t){return e.encryptSentinel(t,a).then(function(e){return{name:i,key:t,sentinel:e}})})}},{key:"importKeys",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.keys.Global||(e[A.a.EncryptionKeys.Global]=Va),Promise.all(Object.keys(e).map(function(i){var r=e[i],a=(i===A.a.EncryptionKeys.Global?Da:i===A.a.EncryptionKeys.UserPassword&&Rt.a.getEncryptionUid())||i;return(!P.a.isMobile||P.a.isMobileWeb)&&r instanceof CryptoKey?t.encryptSentinel(r,a).then(function(e){t.keys[i]={name:i,key:r,sentinel:e}}):(m.default.isString(r)&&(r=Ha.a.str2ab(r)),Ma.importKey(r).then(function(e){return t.encryptSentinel(e,a).then(function(r){t.keys[i]={name:i,key:e,sentinel:r}})}))})).then(function(){return t.keys}).catch(function(e){return console.log(e),t.keys})}},{key:"getGlobalKeyInfo",value:function(){return this.keys[A.a.EncryptionKeys.Global]}},{key:"getGlobalKey",value:function(){return this.keys[A.a.EncryptionKeys.Global].key}},{key:"getKey",value:function(t){return this.keys[t].key}},{key:"getKeyInfo",value:function(t){return this.keys[t]}},{key:"setKey",value:function(t){var e=this,i=t.name,r=t.password,a=t.sentinelSalt;return this.createKeyInfo({name:i,password:r,sentinelSalt:a}).then(function(t){return e.keys[i]=t,t})}},{key:"canDecrypt",value:function(t){var e=t.source,i=t.target,r=t.key;return za.decrypt(e,r.key,r.salt).then(function(t){return t===i})}},{key:"findDecryptKeys",value:function(t){var e=t.source,i=t.target,r=t.keys,a=m.default.objectValues(r).map(function(t){return za.decrypt(e,t.key,t.salt).then(function(e){return{name:t,text:e}})});return Promise.all(a).then(function(t){return t.filter(function(t){return t.text===i}).map(function(t){return t.name})})}},{key:"addKey",value:function(t){var e=t.name,i=t.password,r=t.sentinelSalt;return"string"!==typeof e?Promise.reject(new Ga("Name must be a string. Saw: ".concat(e))):e in this.keys?Promise.reject(new Ga("".concat(e," exists. Use 'updateKey' to change existing keys."))):this.setKey({name:e,password:i,sentinelSalt:r})}},{key:"updateKey",value:function(t){var e=t.name,i=t.password,r=t.sentinelSalt;return"string"!==typeof e?Promise.reject(new Ga("Name must be a string. Saw: ".concat(e))):e in this.keys?this.setKey({name:e,password:i,sentinelSalt:r}):Promise.reject(new Ga("".concat(e," does not exist. Use 'addKey' to add new key.")))}},{key:"removeKey",value:function(t){delete this.keys[t]}},{key:"createKey",value:function(t){var e=t.name,i=t.password,r=t.sentinelSalt;return"string"!==typeof e?Promise.reject(new Ga("Name must be a string. Saw: ".concat(e))):this.createKeyInfo({name:e,password:i,sentinelSalt:r})}},{key:"exists",value:function(t){return!!(t in this.keys)}},{key:"encryptText",value:function(t,e,i){var r="string"===typeof t?this.keys[t]?this.keys[t].key:void 0:t;try{m.default.PAssert(574,r,"No valid encryption key")}catch(a){m.default.reportError(a)}return"string"!==typeof e?Promise.reject(new Ga("Text must be a string. Saw: ".concat(e))):za.encrypt(e,r,i)}},{key:"decryptText",value:function(t,e,i){var r="string"===typeof t?this.keys[t]?this.keys[t].key:void 0:t;return"string"!==typeof e?Promise.reject(new Ga("Text must be a string. Saw: ".concat(e))):za.decrypt(e,r,i)}},{key:"exportKey",value:function(t){return Ma.exportKey(t)}}]),t}(),I()(ta.prototype,"addKey",[H.a],Object.getOwnPropertyDescriptor(ta.prototype,"addKey"),ta.prototype),I()(ta.prototype,"updateKey",[H.a],Object.getOwnPropertyDescriptor(ta.prototype,"updateKey"),ta.prototype),ta),ja=function(){function t(){o()(this,t)}return s()(t,[{key:"init",value:function(){this.settings=new f.a,this.International=new F,this.billingManager=new qr,this.pluginManager=new Mr,this.DisplaySettings=new M,this.itemStoreManager=new at,this.PaneUpdateBatcher=new ma,this.PaneManager=new ht,this.DragDrop=new dt.default,this.timeline=new pt,this.cacheManager=new ia,this.recurringTaskManager=new pa,this.deferredTaskManager=new aa,this.toasts=new Sa,this.ElementRenderer=new wa,this.crypto=new qa,this.cloudStorage=new Na,this.International.init(),this.DisplaySettings.init(),this.itemStoreManager.init(),this.cacheManager.init(),this.pluginManager.init(),this.PaneManager.init(),this.recurringTaskManager.init(),this.deferredTaskManager.init(),this.ElementRenderer.init(),this.cloudStorage.init(),Q.a.init()}},{key:"searchVMLIArray",value:function(t,e,i){for(var r=0,a=0;a<e.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=e[a];if(!t.headers||n.showInOverview()){if(!t.comparator||t.comparator(n,t))if(t.each)if(!1===t.each(n,t))return!1;this.searchFromVMLI(n,t,i+1)}}}},{key:"searchFromVMLI",value:function(t,e,i){i=i||0;var r,a=e.noCollapsed,n=e.pane,o=e.overview;e.includeNotes&&!e.headers&&t.hasNote()&&(e.comparator&&!e.comparator(t.getNote(),e)||e.each&&(r=e.each(t.getNote(),e))),!1===r||a&&0!==i&&t.isCollapsed(n,o)||(r=this.searchVMLIArray(e,t.items.get(),i))}},{key:"searchVMLIs",value:function(t){var e=this;try{m.default.PAssert(143,t,"Must supply a valid options param")}catch(i){m.default.reportError(i)}try{if(t.itemStoreFilter)this.itemStoreManager.runForEachStore(function(i){var r=t.item,a=r&&r.belongsToItemStore(i)?r:i.getRoot();e.searchFromVMLI(a,t)},t.itemStoreFilter);else if(t.item){try{m.default.PAssert(144,!t.itemStore&&!t.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(i){m.default.reportError(i)}this.searchFromVMLI(t.item,t)}else if(t.itemStore){try{m.default.PAssert(145,!t.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(i){m.default.reportError(i)}this.searchFromVMLI(t.itemStore.getRoot(),t)}else try{m.default.PAssert(146,!1,"Must specify a valid search root, using the default root is deprecated")}catch(i){m.default.reportError(i)}}catch(r){m.default.reportError(r)}}},{key:"sendFeedback",value:function(t,e){var i={};m.default.vmMain.getAppInfo(i),i.eventStream=void 0;var r={name:t,message:e,appInfo:i,email:this.settings.getUserIdentifier(),premiumStatus:this.billingManager.getPremiumStatus()};return Dr.a.sendFeedback(r)}}]),t}(),Ya=i(38),Xa={" ":!0,"-":!0},Qa=i.n(Ya)()({},A.a.AttachChar,!0),Ja={CallCount:{GetCaretOffset:0,GetClassStyles:0,measurePaneObject:0,MeasureLines:0,MeasureWord:0,GetOffsetForPositionInLine:0},Cache:{ItemCacheMiss:0,ItemCacheHit:0,LinesCacheMiss:0,LinesCacheHit:0,CanvasStyleHit:0,CanvasStyleMiss:0,WordCacheHit:0,WordCacheMiss:0}};var Za=100;function Ba(t){return Math.round(t*Za)/Za}var $a=function(){function t(){o()(this,t),V.a.binder(this,"clearCacheForItem","onDisplaySettingsChanged"),this.fontSize=An.DisplaySettings.fontSize(),this.isNote=!1,this.isBold=!1,this.needsFontUpdate=!0,this.canvasContext=void 0,this.canvasElement=void 0,this.measureTextItem=new U.a,this.measureTextPane=new U.a,this._paneObjectCache={},this._paneObjectsForItem={}}return s()(t,[{key:"init",value:function(){var t=this;this.registerWordCaches(["Normal","Bold","Note","Header","HeaderTopLevel","Date"]),this._lineCache=An.cacheManager.registerLocalCache("LineCache","LineCache",A.a.StorageType.LocalStorage,{saveTime:-1,writeOnUnload:!0,clearBackingOnLoad:!0,isPerDoc:!0}),this._imageCache=An.cacheManager.registerLocalCache("ImageCache","ImageCache",A.a.StorageType.LocalStorage,{saveTime:-1,writeOnUnload:!0,clearBackingOnLoad:!0,isPerDoc:!0}),this._loadCaches(),k.a.listen("clearMeasureCacheItem",this.clearCacheForItem),k.a.listen("clearMeasureCacheAll",function(){t.clearItemCache(),t.clearLineCache()}),An.DisplaySettings.listen("settingsChanged",this.onDisplaySettingsChanged)}},{key:"registerWordCaches",value:function(t){var e=0;this._wordCaches=[];for(var i=0;i<t.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t[i],a=An.cacheManager.registerLocalCache("WordCache"+r,"WordCache"+r,A.a.StorageType.LocalStorage,{isPerDoc:!0});this._wordCaches.push(a),this["_wordCache"+r]=a}}},{key:"updateFont",value:function(t){this.needsFontUpdate||this.fontSize!==t.fontSize||t.isBold!==this.isBold||t.isNote!==this.isNote||t.isPrefixHeader!==this.isPrefixHeader||t.isHeaderTopLevel!==this.isHeaderTopLevel?(this.fontSize=t.fontSize,this.isBold=!!t.isBold,this.isNote=!!t.isNote,this.isPrefixHeader=t.isPrefixHeader,this.isHeaderTopLevel=t.isHeaderTopLevel,this.canvasFont=(this.isBold?"bold ":"")+this.fontSize+"px Helvetica Neue, Helvetica, Arial, Sans-serif",Ja.Cache.CanvasStyleMiss++,this.canvasContext&&(this.canvasContext.font=this.canvasFont),this.needsFontUpdate=!1):Ja.Cache.CanvasStyleHit++}},{key:"getCanvasElement",value:function(){return this.canvasElement||(this.canvasElement=document.createElement("canvas")),this.canvasElement}},{key:"getCanvasContext",value:function(t){return this.canvasContext||(this.canvasContext=this.getCanvasElement().getContext("2d")),this.updateFont(t),this.canvasContext}},{key:"getMeasureStats",value:function(){return Ja}},{key:"_getLineOffset",value:function(t,e,i){var r=t.childNodes,a=0;if(r)for(var n=0,o=0;o<r.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=r[o];if(u===e){a+=i;break}if(m.default.hasClass(u,"plugin")?a+=1:u.nodeType===Node.TEXT_NODE?u.nodeValue!==A.a.TextSpace&&(a+=u.length):u.childNodes.length>0&&(a+=this._getLineOffset(u,e,i)),e&&m.default.isAncestor(e,u))break}return a}},{key:"_getCaretPosition",value:function(t,e,i,r,a){var n=m.default.element("measureTextItem"),o=n.querySelector(".line");if(o){var u,s,h,d,c=o.getBoundingClientRect(),v=n.getBoundingClientRect(),y={left:c.left,top:v.top},g=i.isNote()?m.default.unescape(i.getNotePreviewText()):i.getParsedText(),l=0,p=i.hasPrefix()&&r.isViewProject()&&r.isItemTopLevel(e,i);t>g.length&&(t=g.length);var f=T.default._getSelectionRange();T.default.selectElement(n,t);var k,S=T.default._getSelectionRange();if(S){s=m.default.findParent(S.startContainer,"line");var w=m.default.findParent(S.startContainer,"itemPrefix",2);if(s){var L=0;h=[].indexOf.call(s.parentNode.children,s),d=this._getLineOffset(s,S.startContainer,S.startOffset);var F=0,C=S.startContainer.parentElement,I=C.previousElementSibling;if(I&&!a&&"IMG"===I.nodeName)F=-I.getBoundingClientRect().width;else if(!a&&m.default.hasClass(C,"mdImageMarkup")){var N=C.nextElementSibling;S.startOffset>0&&S.endOffset>0&&"IMG"===N.nodeName&&(F=N.getBoundingClientRect().width+10+(i.hasPrefix()?A.a.PrefixWidth:0))}An.settings.showMarkdown.get()||m.default.hasClass(C,"mdMarkup")&&(S=this.adjustSelectionForMarkup(S)),m.default.hasClass(S.startContainer,"plugin")?(k=S.startContainer.getBoundingClientRect(),u={left:S.startOffset>0?k.right+(m.default.hasClass(S.startContainer,"inlineDate")?1:12):k.left,top:k.top}):w&&t===i.getPrefixLength()?(k=w.getBoundingClientRect(),u={left:y.left+A.a.PrefixWidth+(P.a.isFirefox?0:5),top:k.top}):a&&d===this._getLineOffset(s)&&s.nextSibling?(u={left:(k=(s=s.nextSibling).getBoundingClientRect()).left+5+(i.hasPrefix()?A.a.PrefixWidth:0),top:k.top},d=0,h++):(k=S.getBoundingClientRect())&&(k.left===k.right&&0===k.left&&(k=S.getClientRects()[0]||s.getBoundingClientRect()),u={left:k.left,top:k.top}),P.a.isFirefox||(u.left=Math.max(u.left-5,0));for(var H=s.parentNode.childNodes,M=0;M<h;M++){if(L++>5e3&&__infLoop&&__infLoop(L))throw new RangeError;l+=this._getLineOffset(H[M])}return f&&!m.default.findParent(f.startContainer,"fancyInput")&&T.default.setSelectionRange(f),{left:u.left-y.left-(p?A.a.PrefixWidth:0)+F,top:u.top-y.top,line:h,lineOffset:d,lineLength:this._getLineOffset(s),lineStart:l}}}}try{m.default.PAssert(147,!1,"Failed to compute caret position: ",t,i.getParsedText().length,m.default.getElementPath(n))}catch(z){m.default.reportError(z)}return{left:0,top:0,line:0,lineOffset:0,lineLength:0,lineStart:0}}},{key:"_measureCaretPosition",value:function(t,e,i,r){for(var a=0,n=m.default.element("measureText"),o=m.default.element("measureTextItem"),u=t.item,s=i.getStyledLinesForPaneObject(t,!1,!0),h="",d=0;d<s.length;d++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var c=s[d],v=(0===d?"margin-top:"+An.DisplaySettings.paddingForItemTop(t,u)+"px;":"")+(c.isImage||d===s.length-1?"margin-bottom:"+An.DisplaySettings.paddingForItemBottom(t,u,i)+"px;":"");if(c.isImage)h+='<span class="line" style="'+(v+=c.maxWidth?"max-width: "+c.maxWidth+"px;":"")+'">'+c.previousText+'<span class="mdImageMarkup">'+c.originalText+"</span>"+(c.isDriveImage||!An.settings.showMarkdown.get()?'<img class="inlineImage" src="'+c.src+'"></img>':"")+"<span>"+c.nextText+"</span></span>";else h+='<span class="line" style="'+(v+="font-size:"+An.DisplaySettings.fontSizeForItem(t,u,i)+"px;line-height:"+An.DisplaySettings.lineHeightForItem(t,u,i)+"px")+'">'+(s[d]||A.a.TextSpace)+"</span>"}return n.className="pane "+i.paneClass,o.className="item "+u.styleProps(t,i),o.innerHTML=h,this._getCaretPosition(e,t,u,i,r)}},{key:"getCaretOffset",value:function(t,e,i,r){var a=t.item;if(Ja.CallCount.GetCaretOffset++,isNaN(i)&&(i=a.getParsedText().length),void 0===r){var n=e.caretPosition.get();if(n&&q.a.getStartOffset()===q.a.getEndOffset()&&q.a.getStartIndex()===q.a.getEndIndex())r=n.left-e.getPaddingForPaneObject(t)<30;else{var o=q.a.isArrowSelectInverted(),u=o?q.a.getStartOffset():q.a.getEndOffset(),s=o?q.a.getStartObject():q.a.getEndObject(),h=this._measureCaretPosition(s,u,e,!0),d=this._measureCaretPosition(s,u,e,!1);h.left!==d.left&&(r=!o)}}return this._measureCaretPosition(t,i,e,r)}},{key:"getCaretScreenPosition",value:function(t,e,i){try{m.default.PAssert(148,e>=0,"Must provide a valid index")}catch(d){m.default.reportError(d)}var r=t.itemAtIndex(e),a=t.objectAtIndex(e);try{m.default.PAssert(149,r,"Must be able to find a valid item at index")}catch(d){m.default.reportError(d)}if(t.isIndexMounted(e)){var n=t.elementAtIndex(e);try{m.default.PAssert(150,n,"Must be able to get element for item at index")}catch(d){m.default.reportError(d)}var o=t.getPaddingForPaneObject(a),u=this.getCaretOffset(a,t,i),s={left:-1,top:-1};if(n){var h=n.getBoundingClientRect();s.left=u.left+h.left+o,s.top=u.top+h.top}return s}return{left:-1,top:-1}}},{key:"_getClassStyles",value:function(t,e,i,r){Ja.CallCount.GetClassStyles++;try{m.default.PAssert(151,m.default.isVMLI(e),"Item must be a valid VMLI instance")}catch(u){m.default.reportError(u)}var a=e.isNote(),n=e.isPrefixHeader(),o=e.isPrefixHeader()&&i.isItemTopLevel(t,e);return{isBold:n||r.hasClass("mdBold")||o&&i.isViewProject()||e.isHeader()&&An.DisplaySettings.boldHeaders()||r.hasClass("contact")||r.hasClass("date")||r.hasClass("duration")||r.hasClass("tag"),fontSize:e.isNote()?An.DisplaySettings.noteFontSize():o&&An.DisplaySettings.fontSizeHeaderTopLevel()||n&&An.DisplaySettings.fontSizeHeader()||An.DisplaySettings.fontSize(),isPrefixHeader:n,isHeaderTopLevel:o,isNote:a,attrs:r.getAttrs()}}},{key:"measureLines",value:function(t,e,i,r,a){var n=0;try{m.default.PAssert(152,m.default.isVMLI(e),"Must provide a valid item to measure lines for")}catch(et){m.default.reportError(et)}try{m.default.PAssert(153,m.default.isPane(i),"Must provide a valid pane to measure lines for")}catch(et){m.default.reportError(et)}try{m.default.PAssert(154,r>=0,"Max width must be greater than 0: ",r)}catch(et){m.default.reportError(et)}Ja.CallCount.MeasureLines++;var o=this.getItemDisplayText(e),u=!e.isDestroyed()&&e.requireStoredEls();a=a||!u;try{m.default.PAssert(155,e&&(e.els||!u),"A Item has no els: ",e.__TEMP_InitCalled,e.__TEMP_InitParseCalled,e.__TEMP_ParseCalled,e.__TEMP_SkippedInitParsed)}catch(et){m.default.reportError(et)}if(0===o.length||!e||!e.els&&u)return e&&m.default.vmMain.runSingleParse(e,A.a.ChangeType.Auto),[{text:"",start:0,length:0,width:0}];if(!a){var s=this.getLinesFromCache(e,i,r);if(s){for(var h=0,d=o.length,c=0,v=0;v<s.length;v++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;c+=s[v].length}if(d===c)return Ja.Cache.LinesCacheHit++,s}else Ja.Cache.LinesCacheMiss++}var y=[],g=e.els,l=0,p="",f=0,k=[],S=0;if(g&&u)for(var w=0,L=0;L<g.length;++L){var F=0;if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;var C=g[L],I=this._getClassStyles(t,e,i,C),P=C.getParsedText(),N=C.getWidth(a),H=!!(I&&I.attrs&&I.attrs.attachSimple),M=void 0;if(C.hasClass("plugin_drive_image_inline")&&(N=r,H=!0,M=!0),void 0===N){var z=P.length;try{m.default.PAssert(156,!I.plugin||P===A.a.AttachChar,"Plugin should only be set for attachment element")}catch(et){m.default.reportError(et)}for(var D=0;D<z;++D){if(F++>5e3&&__infLoop&&__infLoop(F))throw new RangeError;var V=P[D];if(!Xa[V]||l===S||0===D&&L>0&&void 0!==g[L-1].getWidth(a)){var G=0;p+=V;for(var T="",q=l+1;q<o.length;++q){if(G++>5e3&&__infLoop&&__infLoop(G))throw new RangeError;var j=o[q];if(!Xa[j])break;T+=j}var Y=T||Qa[V]||P[D+1]===A.a.AttachChar;if(Y&&H&&D+T.length<z)p+=T;else if(Y){var X=this.measureWord(i,p,I,a),Q=this.measureWord(i,T,I,a);k.push({text:p,delim:T,styles:I,width:X,delimWidth:Math.min(Q,r),isAttach:V===A.a.AttachChar,isImage:H,isDriveImage:M}),p=""}}l++}if(p.length>0){var J=this.measureWord(i,p,I,a);k.push({text:p,delim:"",styles:I,width:J,delimWidth:0,isImage:H,isDriveImage:M}),p=""}}else k.push({isPrefix:0===L,text:P,width:L>0||i.shouldRenderPrefix(t)?N:0,styles:I,delimWidth:0,delim:"",isImage:H,isDriveImage:M}),S+=P.length,l+=P.length}else{try{m.default.PAssert(157,e&&!u,"Items that do not have els must be marked as not requiring them to be cached")}catch(et){m.default.reportError(et)}e.els||m.default.vmMain.runSingleParse(e,A.a.ChangeType.Auto);try{m.default.PAssert(158,e.els&&1===e.els.length,"Should always have a single el for non-measure cached items")}catch(et){m.default.reportError(et)}var Z=this._getClassStyles(t,e,i,e.els[0]);Z&&Z.attrs?k.push({text:A.a.AttachChar,delim:"",styles:Z,width:An.pluginManager.measureAttachment(i,Z),delimWidth:0}):(p=e.els[0].getParsedText(),k.push({text:p,delim:"",styles:Z,width:this.measureWord(i,p,Z,a),delimWidth:0}))}var B=0,$="",U=0,R=0;l=0;for(var E=0;E<k.length;++E){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if((p=k[E]).isPrefix&&(U=p.width),p.isImage&&1===E&&U){var K=this.getAttachSimpleLine(p,l,k[0]);if(K){y.push(K),l+=K.length,$="",f=E+1,U=0;continue}}if(E>f&&(p.isImage||B+p.width>r&&!(U&&1===R&&p.width>0))&&(y.push({text:$,start:l,length:$.length,width:Ba(B)}),l+=$.length,B=0,$="",f=E,U=0),p.isImage){var x=this.getAttachSimpleLine(p,l);if(x){y.push(x),l+=x.length,$="",f=E+1,U=0;continue}}if(!p.isPrefix&&p.width+p.delimWidth>r&&!p.isAttach){var b=0,O=0,W=0;B=0;for(var _=0;_<p.text.length;++_){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;B=W,(W+=this.measureChar(p.text[_],p.styles))>r&&_>0&&_-1>O&&($+=p.text.substring(O,_),y.push({text:$,start:l,length:$.length,width:Ba(B)}),l+=$.length,O=_,B=0,U=0,$="",_--,W=0)}if(O>=0){var tt=p.text.substring(O,p.text.length);tt.length>0&&(p.text=p.text.substr(0,O),$=tt+p.delim,B=this.measureWord(i,tt,p.styles,!0),f=E)}}else p.isPrefix||(B+=p.width+p.delimWidth),$+=p.text+p.delim;E===k.length-1&&(y.push({text:$,start:l,length:$.length,width:Ba(B)}),U=0),p.width>0&&R++}return a||this.saveLinesToCache(e,i,r,y),y}},{key:"getPaneObjectFromCache",value:function(t,e){var i,r=t.item,a=t.id,n=this._paneObjectCache[a],o=e,u=this.getItemDisplayText(r);if(n&&n[o]&&n[o].isHeader===r.isHeader()&&u===n.text&&n[o].isNote===r.isNote()&&u.indexOf(A.a.AttachChar)<0){var s=n[o];if(s.els)Ja.Cache.ItemCacheHit++,i=s;else try{m.default.PAssert(159,!1,"Getting item from cache with no els")}catch(h){m.default.reportError(h)}}return i||Ja.Cache.ItemCacheMiss++,i}},{key:"savePaneObjectToCache",value:function(t,e){try{m.default.PAssert(160,e,"Must save a valid measured item to cache")}catch(c){m.default.reportError(c)}try{m.default.PAssert(161,e.els,"Measured item must have els")}catch(c){m.default.reportError(c)}try{m.default.PAssert(162,e.maxWidth,"Measured item must have a valid max width")}catch(c){m.default.reportError(c)}var i=t.item,r=this.getItemDisplayText(i),a=t.id,n=this._paneObjectCache[a];if(n&&n.text===r){var o,u=0,s=Number.MAX_VALUE;for(var h in n)if(n.hasOwnProperty(h)){u++;var d=n[h].lastAccess;d<s&&(s=d,o=h)}u>=5&&delete n[o]}else n=this._paneObjectCache[a]={text:r},this._paneObjectsForItem[i.id]||(this._paneObjectsForItem[i.id]=[]),this._paneObjectsForItem[i.id].push(a);n[e.maxWidth]=e}},{key:"getLinesFromCache",value:function(t,e,i){if(e.useLineCache){var r,a,n=this._lineCache.getEntrySync(t.id);if(n)for(var o=0,u=0;u<n.length;u++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(r=n[u][i])break}if(r){var s=this.getItemDisplayText(t);if(m.default.isNumber(r))a=[{start:0,length:s.length,text:s}];else{var h=0;a=new Array(r.length);for(var d=0,c=0;c<r.length;c++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var v=r[c];try{m.default.PAssert(163,!m.default.isNumber(v),"Cached lines should always be line info rather than a number")}catch(y){m.default.reportError(y)}a[c]={start:d,length:v.length,text:s.substr(d,v.length)},v.size&&(a[c].size=v.size),d+=v.length}}}return a}}},{key:"saveLinesToCache",value:function(t,e,i,r){if(e.useLineCache){var a,n=0;if(r.length>1||r[0].size){var o=0;a=r;for(var u=0;u<a.length;u++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;delete a[u].imageUrl,delete a[u].originalText}}else a=1;var s=this._lineCache.getEntrySync(t.id)||[];s.length>=5&&s.pop();for(var h=0;h<s.length;h++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;s[h][i]&&(s.splice(h,1),h--)}var d={};d[i]=a,s.splice(0,0,d),this._lineCache.cacheEntry(t.id,s)}}},{key:"measurePaneObject",value:function(t,e,i){Ja.CallCount.measurePaneObject++;var r,a=t.item,n=e.maxWidthOfPaneObject(t),o=this.getItemDisplayText(a),u=a.isHeader(),s=a.isNote();try{m.default.PAssert(164,m.default.isNumber(n),"Must provide a valid number for maxWidth: ",n)}catch(S){m.default.reportError(S)}try{m.default.PAssert(165,n>=0,"Max width must be greater than 0: ",n)}catch(S){m.default.reportError(S)}if(0===o.length||n<m.default.MinItemWidth){return{height:An.DisplaySettings.lineItemHeight(t,a,e,1),maxWidth:n,lineLengths:[0],styledLines:[A.a.TextSpace],els:[{text:"",start:0,length:0,width:0,cls:"line",index:0}],isHeader:u,isNote:s}}if(!(r=!i&&this.getPaneObjectFromCache(t,n))||e.search.shouldHighlightSearch()){for(var h=0,d=this.measureLines(t,a,e,n,i),c=[],v=[],y=0,g=d.length,l=0;l<d.length;++l){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var p=d[l];if(p.size&&!isNaN(p.size.height)){var f=Math.min(p.size.width,n);y+=p.size.height*f/p.size.width+(l>0?An.DisplaySettings.paddingForItemTop(t,a):0)+(l<d.length-1?An.DisplaySettings.paddingForItemBottom(t,a,e):0),g--}c.push(p.length),v.push({text:p.text,start:p.start,length:p.length,width:p.width,cls:"line",index:l})}try{m.default.PAssert(167,a&&(a.els||!a.requireStoredEls()),"B Item has no els: ",a.__TEMP_InitCalled,a.__TEMP_InitParseCalled,a.__TEMP_ParseCalled,a.__TEMP_SkippedInitParsed)}catch(S){m.default.reportError(S)}if(!a.els&&a.requireStoredEls()){return{height:An.DisplaySettings.lineItemHeight(t,a,e,1),maxWidth:n,lineLengths:[],styledLines:[],els:[{text:"",start:0,length:0,width:0,cls:"line",index:0}],isHeader:u,isNote:s}}var k=J.a.generateStyledLines(a.els,d,e);r={height:An.DisplaySettings.lineItemHeight(t,a,e,g)+y,maxWidth:n,lineLengths:c,styledLines:k,els:v,isHeader:u,isNote:s,lastAccess:Date.now()},e.search.shouldHighlightSearch()&&(r.searchHighlightedLines=J.a.generateStyledLines(a.els,d,e,!0)),i||this.savePaneObjectToCache(t,r)}return r}},{key:"measureWord",value:function(t,e,i,r){Ja.CallCount.MeasureWord++;try{m.default.PAssert(168,void 0!==e,"Must pass in a valid word")}catch(d){m.default.reportError(d)}try{m.default.PAssert(169,i,"Must supply valid styles for word")}catch(d){m.default.reportError(d)}try{m.default.PAssert(170,e.indexOf(A.a.AttachChar)<0||1===e.length,"AttachChar should not be processed with other chars")}catch(d){m.default.reportError(d)}if(e.length>0){if(e===A.a.AttachChar&&i&&i.attrs){try{m.default.PAssert(171,!i.attrs||i.attrs.plugin,"Must have a valid plugin: ",i.attrs&&i.attrs.plugin)}catch(d){m.default.reportError(d)}try{m.default.PAssert(172,!i.attrs||i.attrs["plugin-id"],"Must have a valid attachment",i.attrs&&i.attrs["plugin-id"])}catch(d){m.default.reportError(d)}return An.pluginManager.measureAttachment(t,i)}var a=this._selectCache(i),n=a.getEntrySync(e);if(n)return Ja.Cache.WordCacheHit++,n;for(var o=0,u=0,s=0;s<e.length;s++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;u+=this.measureChar(e[s],i)}var h=Ba(u);return r||a.cacheEntry(e,h),h}return 0}},{key:"measureChar",value:function(t,e){var i=this._selectCache(e),r=i.getEntrySync(t);if(r)return r;var a=this.getCanvasContext(e).measureText(t).width;return i.cacheEntry(t,a),a}},{key:"getOffsetForScreenPositionInLine",value:function(t,e,i,r,a){var n,o=e.item;if(i.isIndexMounted(t)){var u=i.elementAtIndex(t).querySelectorAll(".line");if(u.length>r){var s=u[r],h=s.getBoundingClientRect(),d=T.default.getSelectOffsetsForMouseEvent({target:s,clientX:m.default.clamp(a,h.left,h.right-2),clientY:h.top+2+(o.shouldShowParents(e,i)?A.a.HeightAgendaParents:0)+(0===r?An.DisplaySettings.paddingForItemTop(e,o):0)});d&&(n=d.start)}}if(isNaN(n)){var c=0,v=this.measurePaneObject(e,i,!0).lineLengths;n=0;for(var y=0;y<v.length;y++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;n+=v[y]}}return n}},{key:"clearCacheForItem",value:function(t){this._lineCache.removeEntry(t);var e=this._paneObjectsForItem[t];if(e){for(var i=0,r=0;r<e.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var a=e[r];this._paneObjectCache[a]&&delete this._paneObjectCache[a]}delete this._paneObjectsForItem[t]}}},{key:"_loadCaches",value:function(){for(var t=0,e=0;e<this._wordCaches.length;e++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._wordCaches[e].loadAll()}this._lineCache.loadAll(),this._imageCache.loadAll()}},{key:"clearWordCaches",value:function(){for(var t=0,e=0;e<this._wordCaches.length;e++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._wordCaches[e].clearCache()}}},{key:"clearItemCache",value:function(){this._paneObjectCache={},this._paneObjectsForItem={}}},{key:"clearLineCache",value:function(){this._lineCache.clearCache()}},{key:"_selectCache",value:function(t){var e;if(t.isHeaderTopLevel)e=this._wordCacheHeaderTopLevel;else if(t.isPrefixHeader)e=this._wordCacheHeader;else if(t.isBold){try{m.default.PAssert(173,!t.isNote,"Currently do not support bold+note")}catch(i){m.default.reportError(i)}e=this._wordCacheBold}else e=t.isNote?this._wordCacheNote:11===t.fontSize?this._wordCacheDate:this._wordCacheNormal;return e}},{key:"getItemDisplayText",value:function(t){return t.getParsedText()}},{key:"onDisplaySettingsChanged",value:function(t){this.needsFontUpdate=!0,t&&this.clearWordCaches(),this.clearItemCache(),this.clearLineCache()}},{key:"measureImage",value:function(t){var e=!this._imageCache.getEntrySync(t.src);return this._imageCache.cacheEntry(t.src,{width:t.naturalWidth,height:t.naturalHeight}),e}},{key:"getImageOriginalSize",value:function(t,e){var i=this._imageCache.getEntrySync(t)||e&&this._imageCache.getEntrySync(e);return{width:i.width,height:i.height}}},{key:"getImageSize",value:function(t,e,i){var r,a=this._imageCache.getEntrySync(t)||e&&this._imageCache.getEntrySync(e);return a&&(r=i?{width:i=Math.min(i,a.width),height:a.height*(i/a.width)}:{width:a.width,height:a.height}),r}},{key:"getAttachSimpleLine",value:function(t,e,i){var r,a,n,o=t.styles.attrs,u=(i?i.text+i.delim:"")+t.text+t.delim;if(o.plugin){try{m.default.PAssert(174,o.plugin===A.a.PluginID.Drive,"Attach simple line with a plugin other than Drive",o.plugin)}catch(c){m.default.reportError(c)}var s=An.pluginManager.getPluginDrive(),h=s.getAttachment(o["plugin-id"]);r=s.getAttachUrl(h),a=s.getAttachDataUrl(h),n=s.getAttachWidth(h)}else r=o["data-href"],n=o.size;if(r){var d=this.getImageSize(r,a,n);return{text:u,start:e,length:u.length,size:d}}}},{key:"adjustSelectionForMarkup",value:function(t){var e=!1,i=t.startContainer.parentElement,r=m.default.hasClass(i,"mdMarkupStart"),a=m.default.hasClass(i,"mdMarkupEnd","appLinkStart");if(r||a){var n=r?1:-1,o=this.findNextNonMarkup(i,n);if(o){var u=o.childNodes[0]||o;u&&(t.setStart(u,n<0?u.length:0),e=!0)}else if(n*=-1,o=this.findNextNonMarkup(i,n)){var s=o.childNodes[0];s&&(t.setStart(s,n<0?s.length:0),e=!0)}}return e?this.adjustSelectionForMarkup(t):t}},{key:"findNextNonMarkup",value:function(t,e){for(var i=0;t&&m.default.hasClass(t,"mdMarkup","appLinkStart");){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t=e>0?t.nextSibling:t.previousSibling}return t}}]),t}(),Ua=i(102);var Ra,Ea=function(){function t(){o()(this,t),this.openOnPane=void 0,this.messages=new R.a,this.messagesLoaded=new U.a(!1),this.isLoading=new U.a(!1),this.errorMessage=new U.a(""),this.threadAttach=void 0,this.threadAttachLoading=void 0,this.threadItem=void 0,this.numLoaded=0,this._cachedCSS=void 0,V.a.binder(this,"onAttachmentUpdate","reset","_onWindowResizeTimeout")}return s()(t,[{key:"init",value:function(){var t=this;An.DisplaySettings.listen("themeChanged",this.onDisplaySettingsChanged.bind(this)),window.addEventListener("message",function(e){if(m.default.getLocationOrigin()===e.origin&&e.data&&e.data.startsWith&&e.data.startsWith("-")){var i=e.data.indexOf("-",1),r=e.data.indexOf("-",i+1);r<0&&(r=void 0);var a=e.data.substring(1,i),n=e.data.substring(i+1,r),o=r?e.data.substring(r+1):void 0;m.default.batchRenderUpdates(function(){t.handleFrameMessage(n,a,o,e)})}}),k.a.listen("selectedIndexChanged",this.onSelectedIndexChanged.bind(this)),P.a.onResize.listen(this._onWindowResize.bind(this))}},{key:"reset",value:function(t,e){if(this.threadAttach){for(var i=0,r=this.threadAttach.getField("messages"),a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r[a].initializedForDisplay&&this._destroyMessageDisplay(r[a])}this.threadAttach.unsubscribe(this)}this.numLoaded=0,this.threadAttach=void 0,this.threadItem=void 0,this.emailElement=void 0,this.errorMessage.set("",!1),this.isLoading.set(e,!1),this.messagesLoaded.set(!1,!1),this.messages.get().length>0&&this.messages.set([],t)}},{key:"_onWindowResizeTimeout",value:function(){if(this.threadAttach)for(var t=0,e=this.threadAttach.getField("messages"),i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.updateMessageHeight(e[i].id,!0)}}},{key:"_onWindowResize",value:function(){m.default.timeoutOnce("email resize",this._onWindowResizeTimeout,0)}},{key:"getPlugin",value:function(){return this.threadAttach?this.threadAttach.getPlugin():m.default.vmMain.getDefaultEmailPlugin()}},{key:"_sendReply",value:function(t,e,i){try{m.default.PAssert(175,t,"Must supply a valid target")}catch(a){m.default.reportError(a)}try{m.default.PAssert(176,e,"Must supply a valid action")}catch(a){m.default.reportError(a)}try{var r="-"+e+(void 0!==i?"-"+i:"");t.postMessage(r,"*")}catch(n){m.default.reportError(n)}}},{key:"handleFrameMessage",value:function(t,e,i,r){var a=this;switch(e){case"resize":try{var n=JSON.parse(i);this.updateMessageHeight(t,!0===n.canBeShorter,n.scale)}catch(g){m.default.reportError(g)}break;case"click":k.a.fireEvent("tapMain",[]);break;case"keypress":try{var o=JSON.parse(i);P.a.normalizeKeys(o),q.a.fireKeyEvent(document.documentElement,o)}catch(g){m.default.reportError(g)}break;case"href":if(i.startsWith("mailto:")){var u=this.parseMailtoURL(i.replace(/^mailto:/gi,"")),s={to:[{email:u.to}],subject:u.subject&&unescape(u.subject),body:u.body&&unescape(u.body).replace(/\r?\n/g,"<br>")};An.menus.openComposeEmail(this.getPlugin(),void 0,void 0,s)}else m.default.openUrl(i);break;case"epLoaded":this.onMessageLoaded(t);break;case"reloadMessage":this.threadAttach&&this._requestMessageReload(t,this.threadAttach,t);break;case"reqResource":try{try{m.default.PAssert(177,r,"Must provide a valid request event")}catch(l){m.default.reportError(l)}if(this.threadAttach)for(var h=0,d=JSON.parse(i),c=0;c<d.length;++c){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var v=d[c],y=!1;v.startsWith("attach:")&&(v=v.replace(/^attach:/gi,""),y=!0),this.getPlugin().loadResource(this.threadAttach.id,t,v,function(t,e){var i;t&&(i={cid:e,data:y?a._createMessageHTML(a.getPlugin()._decodeEmail(t.data,void 0,{}),{},"text/html").parsed:t.data,mimeType:t.mimeType});try{if(r.source&&i){var n=y?"contentLoad":"resLoad";a._sendReply(r.source,n,i?JSON.stringify(i):void 0)}}catch(o){m.default.reportError(o)}})}}catch(g){m.default.reportError(g)}break;default:m.default.log("Unknown message from child frame: ",t,e,i,r)}}},{key:"isOpen",value:function(){return this.openOnPane&&this.openOnPane.isExpanded.get()}},{key:"isOpenOnPane",value:function(t){return this.openOnPane===t&&this.openOnPane.isExpanded.get()}},{key:"isOpenOnThread",value:function(t){return this.isOpen()&&this.threadAttach===t}},{key:"close",value:function(){this.isOpen()&&(this.wantsPaneTransition=!0,this.setOpenPane(null),P.a.isMobile?setTimeout(this.reset,A.a.EmailOpenTimeMobile):this.reset(),this.wantsPaneTransition=!1,k.a.fireEvent("EmailPreview","onClosed",[]))}},{key:"setOpenPane",value:function(t,e){this.openOnPane&&this.openOnPane!==t&&this.openOnPane.setExpanded(!1,e),this.openOnPane=t,t&&t.setExpanded(!0,e)}},{key:"_openPane",value:function(t,e){var i=this;try{m.default.PAssert(178,e,"Must supply a valid cb to openPane")}catch(r){m.default.reportError(r)}t!==this.openOnPane?(this.wantsPaneTransition=!0,setTimeout(function(){i.wantsPaneTransition=!1,e()},A.a.EmailOpenTime+100)):e(),this.setOpenPane(t)}},{key:"getPane",value:function(){try{m.default.PAssert(179,this.openOnPane,"Should not be trying to get pane if email preview is not open")}catch(t){m.default.reportError(t)}return this.openOnPane}},{key:"startOpenOnLoad",value:function(t){this.setOpenPane(t,!1)}},{key:"open",value:function(t,e,i,r){var a=this;if(e!==this.threadAttach||i!==this.openOnPane){var n=e.getPlugin();this.reset(!0,!0),this.threadAttachLoading=e,P.a.isMobile?q.a.closeKeyboard():An.PaneManager.ensurePaneInView(i);var o=2,u=!1;if(r){this.messages.listen(function(t){if(t.length>0)return t[t.length-1].labelIds.indexOf("DRAFT")<0&&a.setLastMessageResponseMode(r),!1})}var s=function(){0===--o&&e===a.threadAttachLoading&&(u?(a._setThread(e,t),Y.e.miscAction({type:Y.c.Misc,misc:Y.a.OpenEmail,data:{pane:i}})):a.errorMessage.get()?a.isLoading.set(!1):An.menus.alert({text:"Unable to load email messages. You may be offline.",actionText:"OKAY"}))};this._openPane(i,function(){s()}),n.loadThread(e,function(t,e,i){u=t,!t&&i?a.errorMessage.set(i):a.errorMessage.set(""),s()})}else r&&this.isOpen()&&this.setLastMessageResponseMode(r)}},{key:"_getReplyToFromMessage",value:function(t){return this._selfSentMessage(t)?t.to:t.replyTo?[t.replyTo]:[t.from]}},{key:"_getSenderFromMessage",value:function(t){var e=this.threadAttachLoading||this.threadAttach;return this._findSelf(e.getField("accountID"),t)}},{key:"_selfSentMessage",value:function(t){return this.getPlugin().isMyAccountID(t.from.email)}},{key:"_removeSelf",value:function(t){if(t){for(var e=0,i=t.slice(0),r=this.getPlugin(),a=0;a<i.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;r.isMyAccountID(i[a].email)&&(i.splice(a,1),a--)}return i}}},{key:"_findSelf",value:function(t,e){var i,r=this.getPlugin(),a=r.getSendingAccounts(t);if(a.indexOf(e.from.email)>=0)i=e.from.email;else{if(e.to)for(var n=0,o=0;o<e.to.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(a.indexOf(e.to[o].email)>=0){i=e.to[o].email;break}}if(!i&&e.cc){var u=0;for(o=0;o<e.cc.length;++o){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(a.indexOf(e.cc[o].email)>=0){i=e.cc[o].email;break}}}if(!i&&e.bcc){var s=0;for(o=0;o<e.bcc.length;++o){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(a.indexOf(e.bcc[o].email)>=0){i=e.bcc[o].email;break}}}}return i||(i=r.getDefaultSendingAccount(t)),{text:r.getDisplayName(i),email:i}}},{key:"areContactsEqual",value:function(t,e){return t.email===e.email}},{key:"_updateDraftFromMessage",value:function(t,e,i){var r,a,n,o,u=this.getPlugin(),s=t.subject,h=this._getSenderFromMessage(t);try{m.default.PAssert(180,i!==A.a.EmailResponseMode.Other,"Should never pass Other mode to _updateDraftFromMessage")}catch(c){m.default.reportError(c)}i===A.a.EmailResponseMode.Reply?r=this._getReplyToFromMessage(t):i===A.a.EmailResponseMode.ReplyAll?(r=this._removeSelf(this._getReplyToFromMessage(t).concat(t.to)),a=this._removeSelf(t.cc)):i===A.a.EmailResponseMode.Forward&&(o=t.resources.clone()),i&&(n=u.createMessageBody(t,e.from.email,i)),r=m.default.arrayUniques(r||[],this.areContactsEqual),a=m.default.arrayUniques(a||[],this.areContactsEqual),i===A.a.EmailResponseMode.Reply||i===A.a.EmailResponseMode.ReplyAll?(0!==s.toLowerCase().indexOf("re")&&(s="Re: "+s),o=e.resources):i===A.a.EmailResponseMode.Forward&&0!==s.toLowerCase().indexOf("fwd")&&(s="Fwd: "+s);var d={to:r,from:h,cc:a,bcc:void 0,subject:s,body:n,resources:o||new qe};this.getPlugin().updateDraft(this.threadAttach,e.id,e.draftID,d,n,!0,!1,function(t){try{m.default.PAssert(181,t,"Should always be able to update a draft")}catch(c){m.default.reportError(c)}})}},{key:"requestAttachment",value:function(t,e,i,r){this.getPlugin().loadResource(t,e,i,r)}},{key:"getAttachmentURL",value:function(t,e,i){return this.getPlugin().getAttachmentURL(t,e,i)}},{key:"getPreviewURL",value:function(t){return this.getPlugin().getPreviewURL(t)}},{key:"reportMessage",value:function(t,e,i,r,a){this.getPlugin().reportMessage(t,e,i,r,a)}},{key:"dumpMessage",value:function(t,e,i){try{m.default.PAssert(182,!1,"Should not be dumping message in non-__DEV__ modes")}catch(r){m.default.reportError(r)}this.getPlugin().dumpMessage(t,e,i)}},{key:"parseMailtoURL",value:function(t){var e={to:void 0,subject:void 0,body:void 0},i=t.split("?");if(e.to=i[0],i[1])for(var r=0,a=i[1].split("&"),n=0;n<a.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=a[n].split("=");switch(o[0].toUpperCase()){case"SUBJECT":e.subject=o[1];break;case"BODY":e.body=o[1]}}return e}},{key:"parseListUnsubscribe",value:function(t){for(var e=0,i={emailData:void 0,url:void 0},r=t.split(","),a=0;a<r.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=/^<?(http|https|mailto):([^<>]*)>?/gi.exec(r[a]);if(n)switch(n[1]){case"http":case"https":i.url=n[1]+":"+n[2];break;case"mailto":i.emailData=this.parseMailtoURL(n[2]);break;default:try{m.default.PAssert(183,!1,"Unknown List Unsubscribe Format: "+t)}catch(o){m.default.reportError(o)}}}return i}},{key:"setMessageResponseMode",value:function(t,e){var i=this.messages.get()[this.messages.indexOfWithProperty("id",t)];try{m.default.PAssert(184,i,"Must be able to find a valid reply message to update response mode for")}catch(a){m.default.reportError(a)}if(i){if(e!==A.a.EmailResponseMode.None){try{m.default.PAssert(185,i.initializedForDisplay,"Must be initialized for display to set response mode")}catch(a){m.default.reportError(a)}var r=this.getPlugin().getDraftForMessage(this.threadAttach.getField("accountID"),this.threadAttach.id,t,this._getSenderFromMessage(i));this._updateDraftFromMessage(i,r,e)}i.responseMode&&i.responseMode.set(e),P.a.isMobile&&e!==A.a.EmailResponseMode.None&&An.menus.openModal(A.a.Modals.EmailReply,{threadAttach:this.getThreadAttach(),message:r,inReplyToMessage:i,responseMode:e})}}},{key:"setLastMessageResponseMode",value:function(t){if(t){var e=this.messages.get()[this.messages.length()-1];try{m.default.PAssert(186,e,"Setting message response mode when there are no messages")}catch(i){m.default.reportError(i)}e&&this.setMessageResponseMode(e.id,t)}}},{key:"_createErrorHTML",value:function(){return ze.a.update('<html><body>There was an error loading your mail message.<br><br><a href="moodoAction:reloadMessage">Retry</a></body></html>',{},{},"text/html")}},{key:"_createMessageHTML",value:function(t,e,i,r){var a={collapseQuotes:!0,replaceLinks:!0,createLinksFromText:!0};if(r)for(var n in r)r.hasOwnProperty(n)&&(a[n]=r[n]);return ze.a.update(t,e,a,i)}},{key:"_generateCSS",value:function(){if(!this._cachedCSS){var t={html:{"transform-origin":"0 0"},body:{"overflow-x":"auto","overflow-y":"hidden","font-family":"'Helvetica Neue', Helvetica, Arial, Sans-serif","font-size":"14px","text-rendering":"optimizeLegibility","-moz-font-smoothing":"antialiased","-webkit-font-smoothing":"antialiased","font-smoothing":"antialiased",margin:0},"#moodoAttach":{display:"none"},'[moodoAttach="true"]':{display:"none"},'[quote="collapsed"]':{display:"none"},'[place="true"]':{cursor:"pointer",display:"inline-block",height:"12px",width:"26px","text-align":"center","margin-top":"8px","margin-bottom":"8px",color:"#aaa",border:"1px solid #ddd","background-color":"#f6f6f6","border-radius":"3px"},'[place="true"]:before':{content:'"..."',"line-height":"5px","font-size":"16px","vertical-align":"text-top"}};An.DisplaySettings.isDark()&&(t.body["-webkit-filter"]="invert(100%) hue-rotate(180deg)",t.img={"-webkit-filter":"invert(100%) hue-rotate(180deg)"});var e="";Object.keys(t).forEach(function(i){e+=i+"{",Object.keys(t[i]).forEach(function(r){var a=t[i][r];e+=r+":"+a+";"}),e+="}"}),this._cachedCSS="<style>"+e+"</style>"}return this._cachedCSS}},{key:"_createFrameBlob",value:function(t,e,i){var r={isApp:P.a.app,isAndroid:P.a.android},a=this._generateCSS(),n="<script>("+function(t,e){!function(){function i(t){console.log("ERROR: ",t)}var r=window.InjectedJS={postMessage:function(e,r){try{var a;if(void 0!==r)if("string"===typeof r)a="-"+r;else try{a="-"+JSON.stringify(r)}catch(n){i(n),a=""}else a="";window.parent.postMessage("-"+e+"-"+t+a,"*")}catch(n){i(n)}}};function a(t){var i=1;e.isAndroid&&(i=function(t){var e=document.documentElement.clientWidth/t;return Math.max(e,.25)}(document.documentElement.scrollWidth))<1&&(document.documentElement.style.transform="scale("+i+")"),r.postMessage("resize",{canBeShorter:t,scale:i})}var n=!1;function o(){document.removeEventListener("DOMContentLoaded",o,!1),n?a():(n=!0,function(){var t=0,e=0,i=0;document.documentElement.addEventListener("click",function(t){r.postMessage("click")}),document.addEventListener("keydown",function(t){var e={type:t.type,keyCode:t.keyCode,charCode:t.charCode,which:t.which,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,metaKey:t.metaKey,altKey:t.altKey};r.postMessage("keypress",e)},!0);for(var n=function(t){t.stopImmediatePropagation(),t.preventDefault();var e=this.getAttribute("href");return e.startsWith("attach:")?r.postMessage("reqResource",[e]):e.startsWith("moodoAction:")?r.postMessage(e.replace(/^moodoAction:/gi,"")):r.postMessage("href",e),!1},o=document.querySelectorAll("[mlink]"),u=0;u<o.length;++u){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;o[u].addEventListener("click",n)}for(var s=document.querySelectorAll("[place]"),u=0;u<s.length;++u){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;s[u].addEventListener("click",function(t){for(var e=0,i=this.id,r=this.nextElementSibling,n=!1;r&&r.getAttribute("group")===i;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=r.getAttribute("quote"),u="collapsed"===o?"uncollapsed":"collapsed";"collapsed"===u&&(n=!0),r.setAttribute("quote",u),r=r.nextElementSibling}return setTimeout(function(){a(n)},0),t.stopImmediatePropagation(),t.preventDefault(),!1})}for(var h=[],d=document.querySelectorAll("img"),u=0;u<d.length;++u){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var c=d[u].getAttribute("cid");c&&h.push(c),d[u].addEventListener("load",function(){a()})}h.length>0&&r.postMessage("reqResource",h)}(),r.postMessage("epLoaded"))}window.addEventListener("message",function(t){if(t.data&&t.data.startsWith&&t.data.startsWith("-")){var e=t.data.indexOf("-",1),r=t.data.substring(1,e),n=t.data.substring(e+1);switch(r){case"resLoad":try{if(n)for(var o=0,u=JSON.parse(n),s=document.querySelectorAll('[cid="'+u.cid+'"]'),h="data:"+u.mimeType+";base64,"+u.data,d=0;d<s.length;++d){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;s[d].src=h}}catch(c){i(c)}break;case"contentLoad":try{if(n){var u=JSON.parse(n);document.open(),document.write(u.data),document.close(),setTimeout(a,0)}}catch(c){i(c)}break;default:i(new Error("Unknown PreviewFrame message: "+r))}}}),"complete"===document.readyState||"interactive"===document.readyState?setTimeout(o):(document.addEventListener("DOMContentLoaded",o,!1),window.addEventListener("load",o,!1))}()}.toString()+')("'+i+'",'+JSON.stringify(r)+");<\/script>",o="<!DOCTYPE html>";return e='<meta http-equiv="Content-Type" content="'+e+'">',P.a.supportBlobURLIFrame?new Blob([o,"<html>","<head>",e,a,n,"</head>",t,"</html>"],{type:"text/html"}):[o,"<html>","<head>",e,a,n,"</head>",t,"</html>"].join("")}},{key:"onMessageLoaded",value:function(t){this.updateMessageHeight(t),this.messagesLoaded.set(!0)}},{key:"getPreviewIFrame",value:function(t){return document.getElementById("emailPreview_"+t)}},{key:"updateMessageHeight",value:function(t,e,i){var r=this.getPreviewIFrame(t);if(r){var a=this.messages.get()[this.messages.indexOfWithProperty("id",t)];e&&(r.style.height="0px");try{var n=r.contentDocument.documentElement;if(n){var o=i||a.defaultScale.get(),u=Math.ceil(n.scrollWidth*o),s=Math.ceil(n.scrollHeight*o);e&&s===a.height.get()&&(r.style.height=s+"px"),a.width.set(u),a.height.set(s),i&&a.defaultScale.get()!==i&&a.defaultScale.set(i)}}catch(h){m.default.reportError(h)}}}},{key:"_generateAltParts",value:function(t,e){var i=this.getPlugin().getMessageAttachments(e);if(i)for(var r=0,a=0;a<i.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=i[a];"application/ics"===n.mimeType&&this.getPlugin().loadResource(t.id,e.id,n.cid,function(t){if(t){var e=Ua.a.parseICS(m.default.b64_to_utf8(t.data));m.default.log("Parsed ICS Data: ",e)}})}}},{key:"_computeResponseMode",value:function(t){var e=A.a.EmailResponseMode.None;return t&&t.labelIds.indexOf("DRAFT")>=0&&(e=t.subject.startsWith("Fwd:")?A.a.EmailResponseMode.Forward:t.subject.startsWith("Re:")?1===t.to.length?A.a.EmailResponseMode.Reply:A.a.EmailResponseMode.ReplyAll:A.a.EmailResponseMode.Other),e}},{key:"_createMessageDisplay",value:function(t,e,i){try{m.default.PAssert(187,!t.initializedForDisplay,"Should only initialize message for display once")}catch(o){m.default.reportError(o)}try{m.default.PAssert(188,t.to,"Must have a valid to object")}catch(o){m.default.reportError(o)}try{m.default.PAssert(189,t.from,"Mus have a valid from object")}catch(o){m.default.reportError(o)}var r,a=!0;if(t.decoded?(t.isErrorMessage=!1,(r=this._createMessageHTML(t.decoded,t.resources,t.mimeType,i)).missingResourceData&&(a=!1)):(m.default.reportError(!1,"Missing message decoded data: "+m.default.isString(t.decoded)),t.isErrorMessage=!0,r=this._createErrorHTML()),t.listUnsubscribe){var n=this.parseListUnsubscribe(t.listUnsubscribe);m.default.log("Unsub Data: ",n)}try{m.default.PAssert(190,r.parsed,"Must have valid parsed data")}catch(o){m.default.reportError(o)}return t.blob=this._createFrameBlob(r.parsed,t.contentType,t.id),m.default.isString(t.blob)||(t.blobURL&&(P.a.URL.revokeObjectURL(t.blobURL),t.blobURL=void 0),t.blobURL=P.a.URL.createObjectURL(t.blob)),t.specialLinks=r.specialLinks,t.width||(t.width=new U.a(0)),t.height||(t.height=new U.a(0)),t.defaultScale||(t.defaultScale=new U.a(1)),t.responseMode||(t.responseMode=new U.a(this._computeResponseMode(e))),t.initializedForDisplay=!0,a}},{key:"_destroyMessageDisplay",value:function(t){try{m.default.PAssert(191,t.initializedForDisplay,"Message must first be initialized before being destroyed")}catch(e){m.default.reportError(e)}t.initializedForDisplay=!1,t.isErrorMessage=!1,t.width=void 0,t.height=void 0,t.defaultScale=void 0,t.responseMode&&(t.responseMode=void 0),t.specialLinks=void 0,t.blob=void 0,t.blobURL&&(P.a.URL.revokeObjectURL(t.blobURL),t.blobURL=void 0)}},{key:"ensureDisplayMessages",value:function(t){if(t===this.threadAttach)try{for(var e=0,i=t.getField("messages"),r=[],a=0;a<i.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=i[a];if(!t.getPlugin().isMessageDraft(n)&&!n.initializedForDisplay){try{this._generateAltParts(t,n)}catch(o){m.default.reportError(o)}(0===a?this._createMessageDisplay(n,i[a+1],{collapseQuotes:!1}):this._createMessageDisplay(n,i[a+1]))||this.getPlugin().reportMessage(t.getField("accountID"),t.id,n.id,"Error creating display",!1)}r.push(n)}r.equals(this.messages.get())||this.messages.set(r)}catch(o){m.default.reportError(o)}}},{key:"_requestMessageReload",value:function(t,e,i){var r=this;e.getPlugin().forceReloadMessage(e,i,function(a){try{m.default.PAssert(192,a,"Must be able to re-load message data")}catch(d){m.default.reportError(d)}if(e===r.threadAttach){var n=e.getField("messages"),o=n.indexOfWithProperty("id",i),u=n[o];if(u){var s=r.getPreviewIFrame(t);if(s)if(u.initializedForDisplay=!1,r.ensureDisplayMessages(e),P.a.supportBlobURLIFrame)s.src=u.blobURL;else{var h=s.contentWindow.document;h.documentElement.innerHTML="",h.open(),h.write(u.blob),h.close()}}}})}},{key:"onAttachmentUpdate",value:function(t,e,i){var r=this;(!e||e.indexOf("messages")>=0)&&t.getPlugin().loadThread(t,function(e,i){try{m.default.PAssert(193,e,"Must be able to re-load thread data")}catch(a){m.default.reportError(a)}i&&t===r.threadAttach&&r.ensureDisplayMessages(t)})}},{key:"getThreadAttach",value:function(){return this.threadAttach}},{key:"_setThread",value:function(t,e){try{m.default.PAssert(194,t.hasField("messages"),"Must supply valid messages to the email preview")}catch(r){m.default.reportError(r)}try{m.default.PAssert(195,this.errorMessage.get()||t.getField("dataLoaded"),"Must have loaded remote data or have an error")}catch(r){m.default.reportError(r)}if(!this.threadAttach||this.threadAttach.id!==t.id){this.reset(),this.threadAttach=t,this.threadItem=e,t.subscribe(this),this.ensureDisplayMessages(t);var i=t.getPlugin();i.attachmentHasLabelByID(t,"UNREAD")&&i.performAction(A.a.PluginAction.Gmail.MarkRead,!0,t),k.a.fireEvent("EmailPreview","openThreadChanged",[])}}},{key:"onSelectedIndexChanged",value:function(t,e,i){!P.a.isMobile&&this.isOpen()&&e===this.openOnPane&&(i&&i.hasAttachmentType(A.a.PluginType.Email)?i.getAttachmentByType(A.a.PluginType.Email).getPlugin()===this.getPlugin()&&this.getPlugin().openEmailByItem(i,e):"PaneGmail"===e.type&&this.reset())}},{key:"onDisplaySettingsChanged",value:function(){this._cachedCSS=void 0,this.threadAttach&&this.ensureDisplayMessages(this.threadAttach)}}]),t}(),Ka=function(){function t(){o()(this,t),this.sidebarTransitioning=!1,this.isDraggingSidebar=new U.a(!1),this.lightboxPosition=new U.a,this.lightboxSrc=new U.a,this.lightboxElement=void 0,this.sidebarChanged=new E.a}return s()(t,[{key:"init",value:function(){this.showSidebar=P.a.isMailbirdSidebar()||m.default.isDemoInIframe()?new U.a(!1):An.settings.showSidebar;var t=An.settings.sidebarWidth.get()||A.a.DesktopMenuWidthDefault;this._savedSidebarWidth=t===A.a.DesktopMenuWidthSmall?A.a.DesktopMenuWidthDefault:t,this.sidebarWidth=new U.a(t)}},{key:"toggleSidebar",value:function(t){this.sidebarTransitioning=!0;var e=void 0!==t?t:!this.showSidebar.get();e&&(!0===t&&this._savedSidebarWidth===A.a.DesktopMenuWidthSmall&&(this._savedSidebarWidth=A.a.DesktopMenuWidthDefault),this.sidebarWidth.set(this._savedSidebarWidth)),this._setSidebarVisible(e),this.sidebarChanged.notify()}},{key:"minimize",value:function(){this.sidebarTransitioning=!0;var t=A.a.DesktopMenuWidthSmall;An.settings.sidebarWidth.set(t),this.sidebarWidth.set(t),this.sidebarChanged.notify()}},{key:"restore",value:function(){this.toggleSidebar(!0),An.settings.sidebarWidth.set(this.sidebarWidth.get())}},{key:"getSidebarWidth",value:function(){return P.a.isMailbirdSidebar()||!this.showSidebar.get()?0:this.sidebarWidth.get()}},{key:"setSidebarWidthMoving",value:function(t){this.showSidebar.set(!0),this.sidebarTransitioning=!1,this.isDraggingSidebar.set(!0),this.sidebarWidth.set(t)}},{key:"setSidebarWidthUp",value:function(){var t=this.sidebarWidth.get();t<20?t=0:t<A.a.DesktopMenuWidthMinBig&&(t=A.a.DesktopMenuWidthSmall),t!==this.sidebarWidth.get()&&(this.sidebarTransitioning=!0,this.sidebarWidth.set(t)),t>0&&(this._savedSidebarWidth=t,An.settings.sidebarWidth.set(t)),this._setSidebarVisible(t>0),this.isDraggingSidebar.set(!1),this.sidebarChanged.notify()}},{key:"_setSidebarVisible",value:function(t){An.settings.showSidebar.set(t),this.showSidebar.set(t)}},{key:"shouldShowTopBar",value:function(){return!this.showSidebar.get()||P.a.isNativeMac()&&this.sidebarWidth.get()<A.a.DesktopMenuWidthMinBig}},{key:"topBarHeight",value:function(){return this.shouldShowTopBar()?32:0}}]),t}(),xa=function(){function t(){o()(this,t),this.modalStack=new R.a,this.contextMenuStack=new R.a,this.emailComposeStack=new R.a,V.a.forceBind("onClosingSettings",this)}return s()(t,[{key:"toggleContextMenu",value:function(t,e){this.isContextMenuOpen()?this.closeContextMenu():this.openContextMenu(t,e)}},{key:"openAddPaneMenu",value:function(t){t.componentName="ReactContextMenuAddPane",t.onSelected=function(t,e,i){An.PaneManager.addPaneByButton(t,e,i)},this.openContextMenu(t)}},{key:"openContextMenu",value:function(t,e){t.element&&m.default.findParent(t.element,"desktopSidebar")&&(t.pos={left:An.DesktopUI.getSidebarWidth()+4},t.side="right",m.default.findParent(t.element,"desktopMenuBottom")&&(t.openFromBottom=!0)),this.contextMenuNoFade=e,this.contextMenuStack.push(t)}},{key:"indexOfContextMenu",value:function(t){var e=this.contextMenuStack.get(),i=e.indexOfWithProperty("fn",t);return i<0&&(i=e.indexOfWithProperty("componentName",t)),i}},{key:"closeContextMenu",value:function(t,e,i){if(t){var r=this.indexOfContextMenu(t);try{m.default.PAssert(196,r>=0,"Tried to close a context menu that was not open")}catch(s){m.default.reportError(s)}if(r>=0){var a=this.contextMenuStack.get()[r];a.onClosed&&a.onClosed(e,i),this.contextMenuStack.removeAt(r)}}else{for(var n=0,o=this.contextMenuStack.get(),u=o.length-1;u>=0;u--){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;o[u].onClosed&&o[u].onClosed(!1,i)}this.contextMenuStack.clear()}P.a.isMobile||0!==this.contextMenuStack.length()||q.a.updateCaret()}},{key:"getTopContextMenu",value:function(){var t=this.contextMenuStack.get();if(t&&t.length){var e=t[t.length-1];return e.componentName||e.fn}}},{key:"isAutocompleteOpen",value:function(){return this.indexOfContextMenu("ReactAutocomplete")>=0||this.indexOfContextMenu("ReactContextMenuDate")>=0}},{key:"isOnlyAutocompleteOpen",value:function(){return this.isAutocompleteOpen()&&1===this.contextMenuStack.get().length}},{key:"isContextMenuOpen",value:function(t){return t?this.indexOfContextMenu(t)>=0:this.contextMenuStack.get().length>0}},{key:"isModalOpen",value:function(t){var e=this.modalStack.get();if(!t)return e.length>0;for(var i=0,r=0;r<e.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e[r].id===t)return!0}}},{key:"openModal",value:function(t,e){try{m.default.PAssert(197,void 0===e||m.default.isObject(e),"Must always pass in a valid object for params")}catch(i){m.default.reportError(i)}if(!this.isModalOpen(t)){e=e||{};try{m.default.PAssert(198,void 0===e.id,"Should not already have an ID defined with modal params")}catch(i){m.default.reportError(i)}e.id=t,q.a.reset(),this.modalStack.push(e)}}},{key:"closeModal",value:function(t,e){var i=this.modalStack.get().indexOfWithProperty("id",t);if(i>=0){var r=this.modalStack.get()[i],a=!0;r.onClosing&&(a=r.onClosing()),a&&(this.modalStack.removeAt(i),r.callback&&r.callback(e))}}},{key:"confirm",value:function(t,e){try{m.default.PAssert(199,e,"Confirm modals should have callbacks",t)}catch(i){m.default.reportError(i)}this.openModal(A.a.Modals.Confirm,{text:t,callback:e})}},{key:"prompt",value:function(t,e){try{m.default.PAssert(200,e,"Prompt modals should have callbacks",t)}catch(i){m.default.reportError(i)}this.openModal(A.a.Modals.Prompt,{text:t,callback:e})}},{key:"alert",value:function(t){try{m.default.PAssert(201,!t.action,"Still using an old style alert",t)}catch(e){m.default.reportError(e)}t.action&&(t.callback=t.action),this.openModal(A.a.Modals.Alert,t)}},{key:"options",value:function(t){function e(e,i,r){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e,i){try{m.default.PAssert(202,m.default.isArray(e),"Must have valid options array")}catch(r){m.default.reportError(r)}try{m.default.PAssert(203,i,"Options modal must have a callback")}catch(r){m.default.reportError(r)}this.openModal(A.a.Modals.Options,{text:t,options:e,callback:i})})},{key:"openSettings",value:function(t){Y.e.performAction(Y.c.UIAction,{type:Y.d.OpenSettingsMenu}),this.openModal(A.a.Modals.Settings,{section:t,onClosing:this.onClosingSettings})}},{key:"onClosingSettings",value:function(){var t=!ct.a.isSaveEnabled.get();return t||this.confirm("You have unsaved changes. Are you sure you want to cancel your changes?",function(t){t&&(ct.a.isSaveEnabled.set(!1),this.closeModal(A.a.Modals.Settings))}.bind(this)),t}},{key:"openDisplaySettings",value:function(){q.a.reset(),m.default.vmMain.isDisplaySettingsOpen.set(!0),Y.e.performAction(Y.c.UIAction,{type:Y.d.OpenDisplaySettings})}},{key:"getUserEmail",value:function(){return An.settings.getUserIdentifier()}},{key:"getUserName",value:function(){return m.default.isDemoMode()?"Demo":Rt.a.getAccountName()}},{key:"openMenuExternalApp",value:function(t,e){this.openContextMenu({componentName:"ReactContextMenuMobileOpenLink",position:"bottom",html:t,onClick:e})}},{key:"_indexOfCompose",value:function(t){for(var e=0,i=this.emailComposeStack.get(),r=0;r<i.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(i[r].draftMsg.id===t)return r}return-1}},{key:"isComposeOpenForEmail",value:function(t){return!P.a.isMobile&&(t?this._indexOfCompose(t)>=0:this.emailComposeStack.length()>0)}},{key:"openComposeEmail",value:function(t,e,i,r){try{m.default.PAssert(204,t,"Must have a valid email plugin")}catch(o){m.default.reportError(o)}try{m.default.PAssert(205,!e||m.default.isString(e),"Must have a string threadID")}catch(o){m.default.reportError(o)}try{m.default.PAssert(206,!i||m.default.isString(i),"Must have a string messageID")}catch(o){m.default.reportError(o)}if(q.a.reset(),this.isComposeOpenForEmail())   ;else{var a=t.getDraftByID(t.getDefaultAccount(),e,i,r);try{m.default.PAssert(207,a,"Must always create a valid draft")}catch(o){m.default.reportError(o)}if(P.a.isMobile){var n={threadAttach:a.attach,message:a.draftMsg};this.openModal(A.a.Modals.EmailCompose,n)}else{try{m.default.PAssert(208,this.emailComposeStack.indexOf(a)<0,"Must not double-open drafts, should re-use")}catch(o){m.default.reportError(o)}this.emailComposeStack.get().indexOfWithProperty("attach",a.attach)<0&&this.emailComposeStack.push(a)}}Y.e.miscAction({type:Y.c.Misc,misc:Y.a.ComposeEmail})}},{key:"closeComposeEmail",value:function(t,e){var i=this._indexOfCompose(e.id);try{m.default.PAssert(209,i>=0,"Must have found a valid composing email to remove")}catch(r){m.default.reportError(r)}this.emailComposeStack.removeAt(i)}},{key:"openItemEditor",value:function(t){var e=this,i=arguments;try{m.default.PAssert(210,!t.item===!!t.addOnSave,"Must be adding item if no item prop")}catch(n){m.default.reportError(n)}if(!t.item){t.parent||(t.parent=t.pane&&t.pane.type===A.a.PaneMode.Task?t.pane.getRootItem():G.a.getDefaultDocument().getRootItem());var r=G.a.createTempVMLI({text:t.text||An.settings.getDefaultItemText(),date:t.mooDate},{changeType:A.a.ChangeType.AllLocal});t.item=r;var a=t.endSave;t.endSave=function(){setTimeout(function(){G.a.destroyTempVMLI(r.id)},0),a&&a.apply(e,i)}}t.componentName="ReactItemDetailsPopup",this.openContextMenu(t)}},{key:"openLightbox",value:function(t,e,i){try{m.default.PAssert(211,!P.a.isMobile,"Should never open lightbox on mobile")}catch(r){m.default.reportError(r)}this.openModal(A.a.Modals.Lightbox,{src:t,buttonText:e,buttonAction:i})}},{key:"confirmEncrypt",value:function(t,e){this.openModal(A.a.Modals.ConfirmEncrypt,{password:t,onYes:function(){return e(!0)},onCancel:function(){return e(!1)}})}}]),t}(),ba=i(39),Oa=(Ra=function(){function t(){o()(this,t)}return s()(t,[{key:"setup",value:function(){this.callbacks={},this.nextId=0,this.ipcBridge=window.___electronIPCBridge;try{m.default.PAssert(212,this.ipcBridge,"IPC bridge was not created")}catch(t){m.default.reportError(t)}this.ipcBridge&&(this.ipcBridge.onElectronMessage=this.handleMessage)}},{key:"handleMessage",value:function(t,e){try{if(isNaN(+t)){try{m.default.PAssert(213,this["onEvent_"+t],"Missing handler for native event")}catch(r){m.default.reportError(r)}this["onEvent_"+t](e)}else{var i=this.callbacks[+t];i&&i(e)}}catch(a){m.default.reportError(a)}}},{key:"sendMessage",value:function(t,e,i){if(this.ipcBridge){var r=this.nextId++,a=r+"~"+t;void 0!==e&&(m.default.isObject(e)&&(e=JSON.stringify(e)),a+="~"+e),i&&(this.callbacks[r]=i),this.ipcBridge.send("moodo-message",a)}}},{key:"saveFile",value:function(t,e,i){this.sendMessage("saveFile",{filename:t,data:e},i)}},{key:"onEvent_features",value:function(t){try{var e=JSON.parse(t);e.version&&P.a.recordAppSubVersion(e.version),!1===e.notifications&&P.a.disallowNativeNotifications()}catch(i){m.default.reportError(i)}}},{key:"onEvent_downloadProgress",value:function(t){m.default.handleNativeDownloadProgress(t)}},{key:"onEvent_reportError",value:function(t){m.default.reportError(new Error("Native Error"),t)}},{key:"onEvent_onMenuClick",value:function(t){if("NewMessage"===t||"NewEmail"===t){var e=m.default.vmMain.getDefaultEmailPlugin();e.isEnabled()?An.menus.openComposeEmail(e):An.toasts.pushMessage(A.a.MessageID.NeedGmailPermission)}else"NewPane"===t?ba.a.hotkeyAddPane():"NewItem"===t?ba.a.hotkeyNewItem():"Preferences"===t?An.menus.openSettings():"DisplaySettings"===t?An.menus.openDisplaySettings():"ToggleSidebar"===t?An.DesktopUI.toggleSidebar():m.default.reportError(new Error("Unknown Native Menu Click: "+t))}}]),t}(),I()(Ra.prototype,"handleMessage",[H.a],Object.getOwnPropertyDescriptor(Ra.prototype,"handleMessage"),Ra.prototype),Ra),Wa=i(59);function _a(t){try{m.default.PAssert(500,void 0===window.__MoodoBridge[t],"Registering an Inbound API that already exists on the window object",t)}catch(e){m.default.reportError(e)}this._name=t,this._publicObj={},this._privateObj={},window.__MoodoBridge[t]=this._publicObj,this.init()}_a.prototype={init:function(){},_createWrapper:function(t){return function(){try{return t.apply(this,arguments)}catch(e){m.default.reportError(e)}}},registerFunction:function(t,e,i){try{m.default.PAssert(501,t,"Name must be provided to register function")}catch(r){m.default.reportError(r)}try{m.default.PAssert(502,e,"A valid function must be provided to register")}catch(r){m.default.reportError(r)}try{m.default.PAssert(503,void 0===this._privateObj[t],"Re-registering an api function on private obj",t)}catch(r){m.default.reportError(r)}try{m.default.PAssert(504,void 0===this._publicObj[t],"Re-registering an api function on public obj",t)}catch(r){m.default.reportError(r)}this._privateObj[t]=e.bind(this._privateObj),i&&(this._publicObj[t]=this._createWrapper(this._privateObj[t]))},registerVariable:function(t,e,i){try{m.default.PAssert(505,t,"Name must be provided to register variable")}catch(r){m.default.reportError(r)}try{m.default.PAssert(506,!i,"Public variables are not currently supported")}catch(r){m.default.reportError(r)}try{m.default.PAssert(507,void 0===this._privateObj[t],"Re-registering an api variable on private obj")}catch(r){m.default.reportError(r)}try{m.default.PAssert(508,void 0===this._publicObj[t],"Re-registering an api variable on public obj")}catch(r){m.default.reportError(r)}this._privateObj[t]=e}},V.a.defineBase(_a);var tn=_a;function en(t){this._name=t,this._apiLoaded=!1,this._apiError=!1,this._listeners=void 0,this._requiredFns=[],this._missingFns=void 0,this.init()}en.prototype={init:function(){m.default.isObject(window[this._name])?this.onAPILoaded():(V.a.forceBind("_checkAPI",this),setTimeout(this._checkAPI,1e3))},_checkAPI:function(){try{m.default.PAssert(509,!this._apiLoaded,"Should not be checking for API load if already loaded")}catch(t){m.default.reportError(t)}m.default.isObject(window[this._name])&&this.onAPILoaded(),this._apiLoaded||setTimeout(this._checkAPI,1e3)},onAPILoaded:function(){var t=0;this._apiLoaded=!0;for(var e=0;e<this._requiredFns.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;m.default.isFunction(window[this._name][name])||(this._apiError=!0,this._addMissingFn(name))}this.notifyListeners()},requestNotification:function(t){this._apiLoaded?setTimeout(t,0):this._listeners?this._listeners.push(t):this._listeners=[t]},notifyListeners:function(){try{m.default.PAssert(510,this._apiLoaded,"API must be loaded to notify listeners")}catch(i){m.default.reportError(i)}if(this._listeners)for(var t=0,e=0;e<this._listeners.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._listeners[e]()}this._listeners=void 0},requireFunction:function(t,e){try{m.default.PAssert(511,this._requiredFns.indexOf(t)<0,"Should not double require a single function")}catch(i){m.default.reportError(i)}this._requiredFns.push(t),this._apiLoaded&&(m.default.isFunction(window[this._name][t])||e||(this._apiError=!0,this._addMissingFn(t)))},_addMissingFn:function(t){if(this._missingFns){try{m.default.PAssert(512,this._missingFns.indexOf(t)<0,"Should not be missing the same function multiple times")}catch(e){m.default.reportError(e)}this._missingFns.push(t)}else this._missingFns=[t]},hasOptionalFunction:function(t){try{m.default.PAssert(513,this._requiredFns.indexOf(t)>=0,"Must be querying for a registered function")}catch(e){m.default.reportError(e)}return!!window[this._name]&&!!window[this._name][t]},call:function(t){try{m.default.PAssert(514,this._apiLoaded,"Trying to call an API function before it is loaded",t)}catch(i){m.default.reportError(i)}if(this._apiLoaded){var e=Array.prototype.slice.call(arguments,1);try{return window[this._name][t].apply(window[this._name],e)}catch(r){m.default.reportError(r)}}}},V.a.defineBase(en);var rn,an=en,nn=0,on={},un=(rn=function(){function t(){if(o()(this,t),P.a.app)try{this.backlog=[],this._iOS7Queue=[],this._iOS7QueueTimeout=void 0,this.flushingBacklog=!1,this.isPokingBackground=!1,this.setupFns=[],this.setupFns[A.a.AppPlatform.iOS]=this.setupiOS,this.setupFns[A.a.AppPlatform.Android]=this.setupAndroid,this.setupFns[A.a.AppPlatform.Electron]=this.setupElectron,this.sendFns=[],this.sendFns[A.a.AppPlatform.iOS]=this.sendToAppiOS,this.sendFns[A.a.AppPlatform.Android]=this.sendToAppAndroid,this.sendFns[A.a.AppPlatform.Electron]=this.sendToAppElectron,this.setupFn=this.setupFns[P.a.appPlatform],this.sendFn=this.sendFns[P.a.appPlatform],this.init(),this._isEnabled=!0}catch(e){m.default.log("Native API Bridge Disabled"),m.default.reportError(e)}else this._isEnabled=!1;if(this._embedBridge=void 0,P.a.app||P.a.embed){try{m.default.PAssert(214,void 0===window.__MoodoBridge,"Must not have a previous bridge in place")}catch(i){m.default.reportError(i)}window.__MoodoBridge={},this._canRegisterAPIs=!0,this._inboundAPIs={},this._outboundAPIs={}}}return s()(t,[{key:"init",value:function(){try{m.default.PAssert(215,this.setupFn,"Must have a valid setup function")}catch(t){m.default.reportError(t)}try{m.default.PAssert(216,this.sendFn,"Must have a valid send function")}catch(t){m.default.reportError(t)}this.setupFn&&this.sendFn&&(this.initAppEvents(),this.setupFn(),this.backlog=m.default.nativeBacklog,this.flushBacklog())}},{key:"isEnabled",value:function(){return this._isEnabled}},{key:"flushBacklog",value:function(){var t=0;this.flushingBacklog=!0;for(var e=0;e<this.backlog.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.backlog[e];this.sendToApp(i.method,i.data)}this.flushingBacklog=!1}},{key:"addToBacklog",value:function(t,e){try{m.default.PAssert(217,!this.flushingBacklog,"Should never be adding to backload while flushing it")}catch(i){m.default.reportError(i)}this.flushingBacklog||this.backlog.push({method:t,data:e})}},{key:"registerEmbedBridge",value:function(t){try{m.default.PAssert(218,t,"Must supply a valid embed bridge")}catch(e){m.default.reportError(e)}try{m.default.PAssert(219,P.a.embed,"Must be embedded")}catch(e){m.default.reportError(e)}this._embedBridge=t}},{key:"hasEmbedBridge",value:function(){return!!this._embedBridge}},{key:"sendToEmbed",value:function(t,e){try{m.default.PAssert(220,this.hasEmbedBridge(),"Must have a valid embed bridge to send message: ",t)}catch(i){m.default.reportError(i)}this._embedBridge.handleEmbedMessage(t,e)}},{key:"registerInboundAPI",value:function(t){try{m.default.PAssert(221,!this._inboundAPIs[t],"Should not have already registered an outbound API with this name")}catch(i){m.default.reportError(i)}if(this._canRegisterAPIs){var e=new tn(t);return this._inboundAPIs[t]=e,e}}},{key:"registerOutboundAPI",value:function(t){try{m.default.PAssert(222,!this._outboundAPIs[t],"Should not have already registered an outbound API with this name")}catch(i){m.default.reportError(i)}if(this._canRegisterAPIs){var e=new an(t);return this._outboundAPIs[t]=e,e}}},{key:"initAppEvents",value:function(){window.appEvents=this.appEvents(),window._SENDJSMESSAGE_=this.handleNativeMessage}},{key:"setupAndroid",value:function(){}},{key:"setupiOS",value:function(){this.setupiOSUI()}},{key:"setupiOSUI",value:function(){this.iframeApp=document.createElement("IFRAME"),this.iframeApp.setAttribute("height","1px"),this.iframeApp.setAttribute("width","1px"),this.iframeApp.id="appComm",document.documentElement.appendChild(this.iframeApp)}},{key:"setupElectron",value:function(){An.ElectronBridge.setup()}},{key:"onSaveChange",value:function(t){this.isPokingBackground&&(this.sendToApp("pokeChanged",t>0?"true":"false"),this.isPokingBakground=!1)}},{key:"sendToApp",value:function(t,e){try{m.default.PAssert(223,P.a.app,"Only use native bridge when creating an app")}catch(a){m.default.reportError(a)}try{m.default.PAssert(224,this.sendFn,"Must have a valid send method for the native bridge")}catch(a){m.default.reportError(a)}var i=!1;try{var r;e&&(r=m.default.isString(e)?e:JSON.stringify(e)),this.sendFn&&(this.sendFn(t,r),i=!0)}catch(n){m.default.reportError(n)}return i}},{key:"sendToAppiOS",value:function(t,e){P.a.ioswk?this.sendToAppiOS8(t,e):this.sendToAppiOS7(t,e)}},{key:"sendToAppiOS7",value:function(t,e){if(this.iframeApp){var i="duchess://"+t;void 0!==e&&(i+="//"+e),this._addiOS7Queue(i)}else this.addToBacklog(t,e)}},{key:"_addiOS7Queue",value:function(t){this._iOS7Queue.push(t),this._iOS7QueueTimeout||(this._iOS7QueueTimeout=setTimeout(this._pumpiOS7Queue,17))}},{key:"_pumpiOS7Queue",value:function(){var t=this._iOS7Queue.shift();try{m.default.PAssert(225,t,"Must have a valid href",t)}catch(e){m.default.reportError(e)}this.iframeApp.src=t,this._iOS7Queue.length>0?this._iOS7QueueTimeout=setTimeout(this._pumpiOS7Queue,17):this._iOS7QueueTimeout=void 0}},{key:"sendToAppiOS8",value:function(t,e){var i=window.webkit;if(i.messageHandlers&&i.messageHandlers.MoodoEvents){var r=t;void 0!==e&&(r+="//"+e),i.messageHandlers.MoodoEvents.postMessage(r)}else this.addToBacklog(t,e)}},{key:"sendToAppAndroid",value:function(t,e){var i=window.AppInterface;i&&void 0!==i.sendAppMessage&&null!==i.sendAppMessage?i.sendAppMessage(t,e):this.addToBacklog(t,e)}},{key:"sendToAppElectron",value:function(t,e){An.ElectronBridge.sendMessage(t,e)}},{key:"handleNativeMessage",value:function(t,e){try{window.appEvents[t]?window.appEvents[t](e):t.startsWith("-")||m.default.reportError(new Error("Calling invalid JS method from native: "+t))}catch(i){m.default.reportError(i)}}},{key:"nativeOauth",value:function(t,e){var i=++nn,r={id:i,scope:Rt.a.getScopes().join(" "),immediate:t,offline:!1,state:"Dchs"+(new Date).getTime(),include_granted_scopes:!0,redirect_uri:window.location.protocol+"//"+window.location.host+"/oauthRelay.html"};this.sendToApp("getOAuth",r)?m.default.shouldLog(A.a.LogLevels.NativeAuth)&&m.default.log("Native OAuth Request: "+i):m.default.shouldLog(A.a.LogLevels.NativeAuth)&&m.default.log("Native OAuth Request: Failed to send."),on[i]=e}},{key:"appEvents",value:function(){var t=this;return{undo:function(){m.default.log("Native Undo"),m.default.sendEvent("Hotkey","ShakeUndo"),fa.a.undo()},redo:function(){m.default.log("Native Redo"),m.default.sendEvent("Hotkey","ShakeRedo"),fa.a.redo()},selectAll:function(){m.default.focusedPane&&Wa.default.handleSelectAll(m.default.focusedPane)},kbsize:function(t){t>0&&+t!==P.a.getKBSize()&&(P.a.setKBSize(t),m.default.keyboardToolbar&&m.default.keyboardToolbar.updatePosition())},closeKeyboard:function(){!P.a.isMobile||An.menus&&An.menus.isModalOpen(A.a.Modals.EmailCompose)||(q.a.closeKeyboard(),j.a.reset())},enterBackground:function(){m.default.vmMain.onUnload()},enterForeground:function(){k.a.fireEvent("enterForeground",[])},backButtonPressed:function(){q.a.fireKeyEvent(document.documentElement,{normCode:A.a.KeyCode.Escape})},quickAddItems:function(e){try{for(var i=0,r=e.replace(/\r/g," ").replace(/\n/g," "),a=JSON.parse(r),n=0;n<a.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=a[n];m.default.log("Quick Add Item: ",o),m.default.vmMain.dropBucket.addTextEntry(o.key,o.value),m.default.vmMain.dropBucket.persistTextEntry(o.key)}t.sendToApp("quickAddConsumed",[])}catch(u){m.default.reportError(u,e)}},pokeBackground:function(){t.isPokingBackground=!0},reportLowMemory:function(t){},statusBarTap:function(){m.default.focusedPane&&m.default.focusedPane.setScrollOffset(0,A.a.ScrollDuration.Default)},features:function(t){try{var e=JSON.parse(t);e.version&&P.a.recordAppSubVersion(e.version),!1===e.notifications&&P.a.disallowNativeNotifications()}catch(i){m.default.reportError(i)}},notifyOAuth:function(t){try{m.default.isString(t)&&(t=JSON.parse(t)),Rt.a.handleNativeOAuthResponse(t)}catch(e){m.default.reportError(e)}},reportError:function(t){m.default.reportError(new Error("Native Error"),t)},downloadProgress:function(t){m.default.handleNativeDownloadProgress(t)}}}}]),t}(),I()(rn.prototype,"setupAndroid",[H.a],Object.getOwnPropertyDescriptor(rn.prototype,"setupAndroid"),rn.prototype),I()(rn.prototype,"setupiOS",[H.a],Object.getOwnPropertyDescriptor(rn.prototype,"setupiOS"),rn.prototype),I()(rn.prototype,"setupElectron",[H.a],Object.getOwnPropertyDescriptor(rn.prototype,"setupElectron"),rn.prototype),I()(rn.prototype,"sendToApp",[H.a],Object.getOwnPropertyDescriptor(rn.prototype,"sendToApp"),rn.prototype),I()(rn.prototype,"sendToAppiOS",[H.a],Object.getOwnPropertyDescriptor(rn.prototype,"sendToAppiOS"),rn.prototype),I()(rn.prototype,"_pumpiOS7Queue",[H.a],Object.getOwnPropertyDescriptor(rn.prototype,"_pumpiOS7Queue"),rn.prototype),I()(rn.prototype,"sendToAppAndroid",[H.a],Object.getOwnPropertyDescriptor(rn.prototype,"sendToAppAndroid"),rn.prototype),I()(rn.prototype,"sendToAppElectron",[H.a],Object.getOwnPropertyDescriptor(rn.prototype,"sendToAppElectron"),rn.prototype),rn),sn=A.a.TooltipDelay,hn=function(){function t(){o()(this,t),this.tooltip=new U.a,this.tooltipsSticky=new R.a,this.displayElement=void 0,this.isSticky=!1,this.displayTimeout=void 0,P.a.touch||(k.a.listen("mouseover",this.handleEleOver.bind(this)),k.a.listen("mouseout",this.handleEleOut.bind(this)),window.addEventListener("mouseout",this.windowOut.bind(this)),document.addEventListener("mousedown",this.hideTip.bind(this),!0))}return s()(t,[{key:"windowOut",value:function(t){(t.pageX>=P.a.windowWidth()||t.pageY>=P.a.windowHeight()||t.pageX<=0||t.pageY<=0)&&this.hideTip()}},{key:"register",value:function(t,e){this.update(t,e)}},{key:"update",value:function(t,e){t.setAttribute("tooltip",e)}},{key:"displayTipSticky",value:function(t){t.sticky=!0,this.displayTip(t)}},{key:"displayTip",value:function(t){try{m.default.PAssert(226,t,"When display a tooltip, must pass in some info")}catch(a){m.default.reportError(a)}clearTimeout(this.displayTimeout),this.displayTimeout=void 0;var e=this.displayElement=t.element;if(t&&e&&e.offsetWidth>0&&e.offsetHeight>0){var i=t.text;this.isSticky=t.sticky;try{m.default.PAssert(227,i,"When display a tooltip, elements should always have valid data set")}catch(a){m.default.reportError(a)}if(i){var r={text:i,hotkey:t.hotkey,element:e,blue:t.blue,sticky:t.sticky,maxWidth:t.maxWidth,onRight:t.onRight,arrowClass:t.arrowDirection||"hidden"};t.sticky?this.tooltipsSticky.push(r):this.tooltip.set(r)}}}},{key:"tipOut",value:function(t){var e=!0;t.target&&(e=m.default.isAttachedToDoc(t.target)&&!m.default.findParent(t.target,"tooltip")),e&&this.hideTip()}},{key:"getAttr",value:function(t){return t&&t.getAttribute&&(t.getAttribute("tooltip")||t.getAttribute("data-tooltip"))}},{key:"getAttrHotkey",value:function(t){return t&&t.getAttribute&&(t.getAttribute("tooltipHotkey")||t.getAttribute("data-tooltiphotkey"))}},{key:"getByClassName",value:function(t,e){var i,r=P.a.priModKey,a=t.parentElement,n=t.textContent;if(!m.default.findParent(t,"fancyInputInner"))if(m.default.hasClass(t,"linkImage"))i="<b>Click</b> to open image.<br><b>"+r+" + Click</b> to open in "+(P.a.app?"browser":"new tab")+".";else if(a&&m.default.hasClass(a,"appLink")){i="<b>"+r+" + Click</b> to open in "+((m.default.hasClass(a,"Evernote")?"Evernote":"")||(m.default.hasClass(a,"OneNote")?"OneNote":"")||(m.default.hasClass(a,"Bear")?"Bear":""))}else if(m.default.hasClass(t,"link")&&t.getAttribute("data-href")){var o=t.getAttribute("data-href");i=(o!==n?o+"<br>":"")+"<b>"+r+" + Click</b> to open"}else if(m.default.hasClass(t,"tag")||m.default.hasClass(t,"date")||m.default.hasClass(t,"duration")){i="<b>"+r+"+ Click</b> to show only "+n+"<br><b>"+r+" + Shift + Click</b> to hide "+n+"<br><b>"+(P.a.mac?"Option":"Alt")+" + Click</b> to remove "+n}else m.default.hasClass(t,"email")?i="<b>"+r+"+ Click</b> to email "+n:m.default.hasClass(t,"prefixHeader")||m.default.hasClass(t,"prefixBullet")?i="<b>Click</b> to zoom in":m.default.hasClass(t,"prefixTask")?i="<b>Click</b> to toggle complete.<br><b>"+P.a.priModKey+" + Click</b> to zoom in.":m.default.hasClass(t,"prefixNumList")?i="<b>"+P.a.priModKey+" + Click</b> to zoom in":m.default.hasClass(t,"inlineDate")?i="<b>Click</b> to edit date":m.default.hasClass(t,"plugin")&&(i=(e>0?"<b>"+P.a.priModKey+" + Click</b>":"<b>Click icon</b>")+" to open");return i}},{key:"getTooltipText",value:function(t,e){return this.getAttr(t)||this.getByClassName(t,e)}},{key:"handleEleOver",value:function(t){try{m.default.PAssert(228,m.default.isDOMNode(t.target),"Must have a valid DOM node: ",D()(t.target))}catch(o){m.default.reportError(o)}if(t.target){for(var e,i,r=0,a=t.target,n=0;!e&&a&&n<3;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;e=this.getTooltipText(a,n),i=this.getAttrHotkey(a),e||i||(a=a.parentElement)}if(a&&(!e&&i&&(e=i,i=void 0),e&&this.displayElement!==a&&!An.DragDrop.isDragging&&!q.a.isMouseDown())){clearTimeout(this.displayTimeout),this.displayTimeout=setTimeout(this.displayTip.bind(this),sn,{element:a,offset:{y:5},text:e,hotkey:i})}}}},{key:"handleEleOut",value:function(t){this.tipOut(t)}},{key:"isOpenSticky",value:function(){return this.tooltipsSticky.get().length>0}},{key:"hideSticky",value:function(t){for(var e=0,i=this.tooltipsSticky.get(),r=0;r<i.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(i[r].text===t){this.tooltipsSticky.removeAt(r);break}}}},{key:"hideTip",value:function(){this.displayElement=void 0,clearTimeout(this.displayTimeout),this.displayTimeout=void 0,this.tooltip.set(void 0)}}]),t}(),dn=i(143),cn=i(139),vn=i(2),yn=i.n(vn),gn=function(){function t(e,i,r){o()(this,t),this.isComplete=new U.a(!1),this.id=e,this.text=i,this.noRender=r,this.items=[],this.inOrder=!1,this.enforceOrder=!1,this.owner=void 0,this.numComplete=0,this.next=0}return s()(t,[{key:"loadFromSaveData",value:function(t){var e=0;this.numComplete=0;for(var i=0,r=0;r<this.items.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.items[r];t[a.id]&&(a.isComplete.set(!0),this.numComplete++,this.inOrder&&(this.next=Math.max(this.next,r+1))),a.hiddenObservable&&a.hiddenObservable.get()||a.visibleObservable&&!a.visibleObservable.get()||i++}if((this.numComplete===i||t[this.id])&&this.isComplete.set(!0),this.inOrder&&0!==this.next&&this.next<i){var n=this.items[this.next];n&&(n.show(),!m.default.isKeyboardOpen&&this.owner.needsKeyboardOpen&&An.tooltip.hideTip())}}},{key:"saveData",value:function(t,e){for(var i=0,r=0;r<this.items.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var a=this.items[r];try{m.default.PAssert(576,a,"Item entries must exist")}catch(n){m.default.reportError(n)}a.isComplete.get()&&(t[a.id]=1)}e&&this.isComplete.get()&&(t[this.id]=1)}},{key:"addStep",value:function(t){try{m.default.PAssert(577,!!t.id===!!t.check,"Invalid help step")}catch(e){m.default.reportError(e)}!1!==t.if&&(t.isComplete||(t.isComplete=new U.a(!1)),this.inOrder&&!P.a.isMobile?t.isDisabled||(t.isDisabled=new U.a(this.items.length>0)):t.isDisabled=new U.a(!1),t.isHotkeyOr=t.isHotkeyOr,t.show||(t.show=function(){return t.isDisabled.set(!1)}),this.items.push(t))}},{key:"complete",value:function(t){t.isComplete.get()||(t.isComplete.set(!0),this.numComplete++,this.numComplete===this.items.length&&this.isComplete.set(!0),this.owner.notifyOfChange(t))}},{key:"forceComplete",value:function(){this.isComplete.set(!0),this.numComplete=this.items.length,this.owner.notifyOfChange()}},{key:"check",value:function(t){var e=0;try{m.default.PAssert(578,!this.isComplete.get(),"Should never be checking items in a completed section")}catch(a){m.default.reportError(a)}for(var i=0;i<this.items.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this.items[i];if(!r.isComplete.get()&&((!0===t||r.check&&r.check(t))&&(this.complete(r),this.inOrder&&i===this.next&&(this.next++,this.next<this.items.length&&this.items[this.next].show())),this.enforceOrder))break}}}]),t}(),ln=i(13),pn={display:"inline-block",height:"24px"};function mn(){An.menus.openSettings(A.a.SettingsSections.Plugins)}var fn=function(){function t(){o()(this,t)}return s()(t,[{key:"init",value:function(){var t=this;this.mode=new U.a(A.a.HelpMode.None),this.position=new U.a,this.sections=new R.a,this.isVisible=new zr.a([this.mode],function(){return t.isHelpShowing()}),this.priKey=P.a.priModKey,this.secKey=P.a.secModKey,this.secKeyForce=P.a.secModKeyForce,this.tooltipIntroSection=void 0;var e=An.settings.helpPaneState.get();void 0===e&&(e=A.a.HelpMode.None),this.initItemsDesktop(),m.default.isDemoMode()||(this.initState(e),!P.a.isMobile&&An.settings.inTooltipIntro.get()&&this.tooltipIntroSection.isComplete.get()&&An.settings.inTooltipIntro.set(!1)),An.settings.helpPaneState.listen(function(e,i){void 0!==e&&e!==i&&t.initState(e)}),An.settings.helpState.listen(function(e,i){e&&e!==i&&t.loadState()}),Y.e.addListener(this.onAction.bind(this))}},{key:"isHelpShowing",value:function(){return this.mode.get()!==A.a.HelpMode.None}},{key:"initState",value:function(t){try{m.default.PAssert(230,void 0!==t,"Must pass in a valid intro mode")}catch(e){m.default.reportError(e)}this.sections.clear(),this.mode.set(t),this.isHotkeyMode()||this.initHelp(),!P.a.isMobile&&An.settings.inTooltipIntro.get()&&this.initTooltipIntro(),this.loadState()}},{key:"initItemsDesktop",value:function(){this.itemIndent={id:"458052715",text:'Press <span class="hHotkey">Tab</span> to indent an item into a list and <span class="hHotkey">Shift + Tab</span> to unindent out of a list',check:this.checkIndent},this.itemDateTime={id:"321249113",text:'Add a date/time by typing ! in the text of an item or pressing <span class="hHotkey">'+this.priKey+" + Shift + D</span>",check:this.checkDate},this.itemRightClick={id:"3288459206",text:"Right click an item to explore more options",check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.RightClick}};var t=m.default.vmMain.getDefaultEmailPlugin(),e=An.pluginManager.getPlugin(A.a.PluginID.GCalendar),i=An.pluginManager.getPlugin(A.a.PluginID.Drive);this.itemPluginSettings={id:"ep",jsx:yn.a.createElement("span",null,yn.a.createElement("span",{style:pn},yn.a.createElement(ln.a,{raised:!0,primary:!0,marginRight:8,onClick:mn},"Enable plugins")),"to connect to your other services"),hiddenObservable:new zr.a([t.isActiveObs,e.isActiveObs,i.isActiveObs]),check:function(){}},this.itemOpenEmail={id:"dblE",text:"Double click an email to open it",check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.OpenEmail&&t.data.pane.type===A.a.PaneMode.Gmail}},this.itemDragEmail={id:"drgEm",text:"Drag an email to your Tasks to organize it",check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.DropItem&&t.data.fromPane&&t.data.fromPane.type===A.a.PaneMode.Gmail}},this.itemRightClickEmail={id:"rcE",text:"Right click an email to explore more options",check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.RightClick&&t.data.pane.type===A.a.PaneMode.Gmail}},this.itemGmailLabels={id:"lbls",text:'Click <i class="overviewButtonNormal icon-menu g"></i> in the top left to access your labels',check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.ToggleOverview&&t.data.pane.type===A.a.PaneMode.Gmail}},this.itemGmailCompose={id:"cmp",text:'Click <i class="icon-edit2 g"></i> in the sidebar to compose a new email',check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.ComposeEmail}}}},{key:"setMode",value:function(t){this.mode.set(t),An.settings.helpPaneState.set(t)}},{key:"show",value:function(t){this.setMode(t||A.a.HelpMode.Normal)}},{key:"toggle",value:function(t){!this.isHelpShowing()||t&&this.mode.get()!==t?this.show(t):this.close()}},{key:"close",value:function(){An.tooltip.hideTip(),this.setMode(A.a.HelpMode.None),m.default.sendEvent("Menu","CloseHelp")}},{key:"isHotkeyMode",value:function(){return this.mode.get()===A.a.HelpMode.Hotkeys}},{key:"_getHelpStateObj",value:function(){var t={},e=An.settings.helpState.get();if(m.default.isString(e)){if(e)try{(t=JSON.parse(e))&&!m.default.isString(t)||(t={})}catch(i){m.default.reportError(i)}}else t=e;return t||{}}},{key:"loadState",value:function(){var t=this._getHelpStateObj();if(t)for(var e=0,i=0;i<this.sections.get().length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.sections.get()[i].loadFromSaveData(t)}}},{key:"saveState",value:function(){if(m.default.shouldWriteLocal())try{var t=this.getState();0,An.settings.helpState.set(JSON.stringify(t))}catch(e){m.default.reportError(e)}}},{key:"getState",value:function(){for(var t=0,e=this._getHelpStateObj(),i=0;i<this.sections.get().length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.sections.get()[i].saveData(e)}return e}},{key:"notifyOfChange",value:function(){this.saveState()}},{key:"createSection",value:function(t,e,i,r){var a=0,n=new gn(t,e,r);n.owner=this;for(var o=0;o<i.length;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n.addStep(i[o])}return n}},{key:"addSection",value:function(t,e,i,r){var a=this.createSection(t,e,i,r);return this.sections.push(a),a}},{key:"checkAddItem",value:function(t){if(t.type===Y.c.Create){G.a.getItem(t.data[0].itemID);return!1}}},{key:"checkIndent",value:function(t){if(t.type===Y.c.Move){var e=t.data[0].oldParent;try{m.default.PAssert(231,e&&e.items,"Old parent must have items",e)}catch(i){m.default.reportError(i)}if(e&&e.items&&e.items.get().indexOf(t.data[0].newParent)>=0)return!0}}},{key:"checkSearch",value:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.SearchChanged}},{key:"checkComplete",value:function(t){if(t.type===Y.c.Update){var e=t.data[0];return"isComplete"===e.field&&e.newValue}}},{key:"checkOverview",value:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.ToggleOverview}},{key:"checkZoom",value:function(t){return t.type===Y.c.Zoom&&!t.data[0].zoomOut&&m.default.focusedPane.overview.isVisible.get()}},{key:"checkPriority",value:function(t){var e=t.data[0];return t.type===Y.c.Update&&"priority"===e.field&&e.newValue>0}},{key:"checkDate",value:function(t){return t.type===Y.c.Insert&&"!"===t.data[0].text}},{key:"checkGoogleCalendar",value:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.AddToGCal}},{key:"checkGoogleDrive",value:function(){}},{key:"initHelp",value:function(){function t(){An.menus.openContextMenu({componentName:"ReactContextMenuOptions",element:"optionsButton"})}this.sections.clear(),this.addSection("2102025841","Organization",[this.itemIndent,{id:"3825397189",text:"Click and drag on the left edge of an item to move it",check:function(t){if(t.type===Y.c.Misc&&t.misc===Y.a.DropItem&&m.default.isLoaded)return!0}},{id:"441256378",text:'Click the left edge of a list or press <span class="hHotkey">'+this.secKey+" + ,</span> to collapse its subitems",check:function(t){if(t.type===Y.c.Update){var e=t.data[0];return"isCollapsed"===e.field&&e.newValue}}}]),this.addSection("prefixes","Item Prefixes",[{id:"header",text:"Start a line with "+A.a.Prefix.Header+" to create a project",check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.SetPrefix&&t.data.prefix===A.a.Prefix.Header}},{id:"task",text:"Start a line with [ to create a task",check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.SetPrefix&&t.data.prefix===A.a.Prefix.Task}},{id:"bullet",text:"Start a line with - to create a bullet",check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.SetPrefix&&(t.data.prefix===A.a.Prefix.Bullet||t.data.prefix===A.a.Prefix.Bullet2||t.data.prefix===A.a.Prefix.Bullet3)}},{id:"numlist",text:"Start a line with 1. to create a numbered list",check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.SetPrefix&&t.data.prefix===A.a.Prefix.NumList}}]),this.addSection("cal","Dates",[this.itemDateTime,{id:"enableCalendar",jsx:yn.a.createElement("span",null,yn.a.createElement(ln.a,{raised:!0,primary:!0,marginRight:8,onClick:mn},"Enable Google Calendar"),"to sync Google Calendar."),hiddenObservable:An.pluginManager.getPlugin(A.a.PluginID.GCalendar).isActiveObs,check:function(){}},{id:"adc2",text:'Add an item with a date to Google Calendar by pressing <span class="hHotkey">'+this.secKeyForce+' + C</span> or right clicking the date.<span style="color: #777;"></span>',check:this.checkGoogleCalendar}]),this.addSection("3971635305","Priority",[this.itemRightClick,{id:"215510164",text:'Set a priority with the right click menu or <span class="hHotkey">'+this.secKey+" + 1|2|3</span>",check:this.checkPriority},{id:"2165585377",text:'Click the right edge of an item or <span class="hHotkey">'+this.secKey+" + /</span> to complete it",check:this.checkComplete},{id:"4286506454",text:'Press <span class="hHotkey">'+this.secKey+" + 8</span> to star an item and highlight it in yellow",check:function(t){if(t.type===Y.c.Update){var e=t.data[0];return"isStarred"===e.field&&e.newValue}}}]),this.addSection("4240025947","Contacts",[{id:"9158366",text:"Add a contact by typing + in the text of an item",check:function(t){return t.type===Y.c.Insert&&"+"===t.data[0].text}},{id:"1594166733",text:'Click on a <span class="contact c-contact">+contact</span> to start a call or email',check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.OpenContact}}]),this.addSection("1493247039","Zooming",[{id:"1829655333",text:'To zoom in on an item, right click it and select Zoom In, press <span class="hHotkey">'+this.priKey+' + Enter</span>, or hold <span class="hHotkey">'+this.priKey+"</span> and click its left edge",check:function(t){return t.type===Y.c.Zoom&&!t.data[0].zoomOut}},{id:"3440644647",text:"To zoom back out, click the title of the list in the top of the pane",check:function(t){return t.type===Y.c.Zoom&&t.data[0].zoomOut}},{id:"801492595",text:'Press <i class="overviewButtonNormal icon-menu g"></i> in the top left of a pane to open the overview',check:this.checkOverview},{id:"1720747864",text:'Click an item in the Overview to scroll to it or click <i class="icon-zoom-in g"></i> to zoom into it',check:this.checkZoom}]),this.addSection("1393893782","Search",[{id:"3689209442",text:'Mark similar items with a <span class="tag">#tag</span> to easily search for all items matching that tag',check:function(t){return t.type===Y.c.Insert&&t.data[0].text===A.a.TagPrefix}},{id:"2783340419",text:'Filter by priority by clicking the <span class="searchPriority searchP0 hovered"></span> <span class="searchPriority searchP1 hovered"></span> <span class="searchPriority searchP2 hovered"></span> buttons',check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.SearchChanged&&0!==t.data.priority}},{id:"923656242",text:'Show only starred items by clicking the <span class="c-foreground-faded icon-star"></span> button',check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.SearchChanged&&0!==t.data.starred}},{id:"2227925102",text:'Hide completed items by clicking the <span class="c-foreground-faded icon-check"></span> button',check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.SearchChanged&&0!==t.data.complete}},{id:"457209713",text:"Hide items you're not interested in by starting a search with - (dash)",check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.SearchChanged&&t.data.text.indexOf("-")>=0}}]),this.addSection("gm","Gmail",[{id:"eG",jsx:yn.a.createElement("span",null,yn.a.createElement(ln.a,{raised:!0,primary:!0,marginRight:8,onClick:mn},"Enable Gmail"),"to sync Gmail."),hiddenObservable:An.pluginManager.getPlugin(A.a.PluginID.Gmail).isActiveObs,check:function(){}},this.itemOpenEmail,this.itemDragEmail,this.itemRightClickEmail,this.itemGmailLabels]),this.addSection("formatting","Formatting",[{id:"format",text:"Format text like <i>*italic*</i>, <b>**bold**</b>, or <b><i>***both***</i></b>",check:function(t){}},{id:"link",text:"Insert links like [title](http://address.com)",check:function(t){}},{id:"hr",text:"--- to insert a horizontal line",check:function(t){}}]),this.addSection("327865517","Collaboration",[{id:"3453735943",jsx:yn.a.createElement("span",null,yn.a.createElement("span",{style:pn},"Click the ",yn.a.createElement(ln.a,{icon:"icon-folder",iconSize:18},"File"))," in the options button to open the Files menu"),check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.OpenDocumentsMenu}},{id:"4176091097",text:'Click <i class="icon-settings f18 g"></i> to change the sharing settings',check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.OpenDocSharing}}]),this.addSection("drv","Google Drive (Premium)",[{id:"eD",jsx:yn.a.createElement("span",null,yn.a.createElement(ln.a,{raised:!0,primary:!0,marginRight:8,onClick:mn},"Enable Google Drive"),"to sync Google Drive."),hiddenObservable:An.pluginManager.getPlugin(A.a.PluginID.Drive).isActiveObs,check:function(){}},{id:"drL",text:"Drag a file from the Google Drive Pane to an Task Pane to add it to a list",check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.DropItem&&t.data.fromPane&&t.data.fromPane.type===A.a.PaneMode.Drive}},{id:"drDr",text:"Drag a file from your "+(P.a.mac?"Finder":"Explorer")+" to your Tasks to upload it to Drive and add it to a list",check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.DriveUpload}}]),this.addSection("set","Settings",[{id:"oS",jsx:yn.a.createElement("span",null,"Click ",yn.a.createElement("span",{style:pn},yn.a.createElement(ln.a,{icon:"icon-settings",iconSize:18,onClick:t}))," in the sidebar, then Settings, to access plugin and account settings."),check:function(t){return t.type===Y.c.UIAction&&t.data[0].type===Y.d.OpenSettingsMenu}},{id:"oDS",jsx:yn.a.createElement("span",null,"Click ",yn.a.createElement("span",{style:pn},yn.a.createElement(ln.a,{icon:"icon-settings",iconSize:18,onClick:t}))," in the sidebar, then Display Settings, to change display settings."),check:function(t){return t.type===Y.c.UIAction&&t.data[0].type===Y.d.OpenDisplaySettings}}]),this.addSection("3926176240","Data",[{id:"1927292896",jsx:yn.a.createElement("span",null,"Click on Import Data in the options menu in the sidebar, then choose the app to import from and follow the instructions. If you do not see your app, try using copy and paste to paste it in to Moo.do. If that does not work, please ",yn.a.createElement(ln.a,{primary:!0,onClick:function(){An.menus.openModal(A.a.Modals.ReportBug)}},"contact us")," and tell us what app you want to import from."),check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.OpenImport}},{id:"67562060",text:"Click on Export Data in the options menu in the sidebar, then choose the format you'd like.",check:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.OpenExport}}])}},{key:"onAction",value:function(t){if(!An.menus.isModalOpen(A.a.Modals.ImportData))try{for(var e=0,i=this.sections.get(),r=0;r<i.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;i[r].isComplete.get()||i[r].check(t)}}catch(a){m.default.reportError(a)}}},{key:"runTooltipIntro",value:function(){An.settings.inTooltipIntro.set(!0),this.initTooltipIntro()}},{key:"initTooltipIntro",value:function(){function t(){return An.pluginManager.isGmailPaneEnabled()}function e(t){try{m.default.PAssert(232,t,"Must supply a valid tooltip descriptor")}catch(e){m.default.reportError(e)}try{m.default.PAssert(233,!t||t.element,"Must specify a valid target tooltip element")}catch(e){m.default.reportError(e)}An.tooltip.hideSticky(t.text),t.blue=!0,"top"===t.arrowDirection&&(t.offset={top:15}),An.tooltip.displayTipSticky(t)}var i,r,a,n=[];function o(t){var i=!1;n.push({id:t.id,check:function(r){return!(!t.check2Invalidates1||!t.check2(r))||(t.check1(r)?(setTimeout(function(){var r=m.default.isFunction(t.element)?t.element():t.element,a=m.default.isFunction(t.text)?t.text():t.text;r&&(i=!0,e({text:a,element:r,arrowDirection:t.arrowDirection,onRight:t.onRight}))},1e3),!0):void 0)}}),n.push({id:t.id+"_complete",check:function(e){if(t.check2(e)){if(i){var r=m.default.isFunction(t.text)?t.text():t.text;An.tooltip.hideSticky(r)}return!0}}})}if(o({id:"tipAddPaneMenu",text:"Click here to add a new pane",element:function(){return m.default.element("addPaneButton")},arrowDirection:"left",check2Invalidates1:!0,check1:this.checkAddItem,check2:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.OpenAddPaneMenu}}),o({id:"tipAddPane",text:function(){return t()?"Add a Gmail pane to organize your email":"Add another Task pane to get another view on your tasks."},element:function(){return t()?m.default.element("addPane_PaneGmail"):m.default.element("addPane_PaneTask")},arrowDirection:"left",check2Invalidates1:!0,onRight:!0,check1:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.OpenAddPaneMenu},check2:function(e){return e.type===Y.c.UIAction&&e.data[0].type===Y.d.AddPane&&e.data[0].data.type===(t()?A.a.PaneMode.Gmail:A.a.PaneMode.Task)}}),o({id:"tipNewTaskPane",text:"Each Task pane is a unique view on the same data. Customize your view by searching and filtering.",element:function(){if(i){var t=i.element;if(t)return t.getElementsByClassName("searchWrap")[0]}},arrowDirection:"top",check1:function(t){if(t.type===Y.c.UIAction&&t.data[0].type===Y.d.AddPane&&t.data[0].data.type===A.a.PaneMode.Task)return i=t.data[0].data.pane,!0},check2:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.SearchChanged}}),o({id:"tipNewGmailPane",text:"Try dragging an email to your Task Pane",element:function(){if(r){var t=r.element;if(t)return t.getElementsByClassName("paneContent")[0]}},arrowDirection:"bottom",check2Invalidates1:!0,check1:function(t){if(t.type===Y.c.UIAction&&t.data[0].type===Y.d.AddPane&&t.data[0].data.type===A.a.PaneMode.Gmail&&An.PaneManager.getPanesByType(A.a.PaneMode.Task).length>0)return r=t.data[0].data.pane,!0},check2:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.DropItem&&t.data.fromPane&&t.data.fromPane.type===A.a.PaneMode.Gmail}}),o({id:"tipNewGmailPane",text:"Each board is a different set of panes. Add a new pane to start setting up your new board.",element:function(){return m.default.element("addPaneButton")},arrowDirection:"left",onRight:!0,check1:function(t){return t.type===Y.c.UIAction&&t.data[0].type===Y.d.AddBoard},check2:function(t){return t.type===Y.c.UIAction&&t.data[0].type===Y.d.AddPane}}),o({id:"tipAddToCalendar",text:function(){return"Sync items with dates to Google Calendar by pressing "+P.a.secModKeyForce+" + C"},element:function(){var t=q.a.getStartElement();if(t)return t.getElementsByClassName("date")[0]},arrowDirection:"top",check1:function(t){if(t.type===Y.c.Misc&&t.misc===Y.a.ChangeDate&&m.default.isLoaded&&An.pluginManager.getPlugin(A.a.PluginID.GCalendar).isActive())return!0},check2:function(t){return t.type===Y.c.Misc&&t.misc===Y.a.AddToGCal}}),o({id:"tipOverviewButton",text:"Toggle the Overview open and closed",element:function(){var t=a.element;if(t)return t.getElementsByClassName("overviewButton")[0]},arrowDirection:"top",check1:function(t){if(t.type===Y.c.Zoom)return a=t.data[0].pane,!0},check2:this.checkOverview,check2Invalidates1:!0}),An.settings.shouldShowHelp("helpTooltip")){setTimeout(function t(){if(An.tooltip.isOpenSticky())setTimeout(t,5e3);else if(An.settings.closeHelp("helpTooltip"),m.default.element("helpButton")){var i={text:"See the Help to learn more",element:m.default.element("helpButton"),arrowDirection:"left",onRight:!0};k.a.listen("helpOpened",function t(){An.tooltip.hideSticky(i.text),k.a.unlisten("helpOpened",t)}),e(i)}},9e4)}this.tooltipIntroSection=this.addSection("tooltipIntro","Tooltip Intro",n,!0)}}]),t}(),kn=function(t){function e(){return o()(this,e),d()(this,v()(e).apply(this,arguments))}return p()(e,t),s()(e,[{key:"init",value:function(){this.ElectronBridge=new Oa,this.nativeBridge=new un,g()(v()(e.prototype),"init",this).call(this),this.setup=new dn.a,this.Measure=new $a,this.Measure.init(),this.EmailPreview=new Ea,this.EmailPreview.init(),this.DesktopUI=new Ka,this.DesktopUI.init(),this.menus=new xa,this.tooltip=new hn,this.AppCache=new cn.a,this.intro=new fn}}]),e}(ja),An=e.default=new kn},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(17),s=i.n(u),h=i(9),d=i.n(h),c=i(24),v=i.n(c),y=i(18),g=i.n(y),l=i(0),p=i(1),m=i(4),f=i(3),k=i(19),A=i(21),S=i(10),w=i(22),L=i(42),F=i(23),C=i(6),I="start",P="end",N=["mdImageResizer","emptyItemAddButton",["itemNotInPane",!0],"itemCheckbox","itemPrefix",["searchWrap",!0],"collapser","itemMenuIcon","itemEditButton",["formattingToolbar",!0],"itemTime"],H=function(t){function e(){var t;return a()(this,e),(t=s()(this,d()(e).call(this)))._isValid=!1,t._isInRightClick=!1,t._isDirty=!1,t._isWatchingChange=!0,t._isMouseDown=!1,t.isWindowFocused=new S.a(!0),t.hoveredItem=void 0,t.hoveredReactCell=void 0,t._previousSelectedIndex=void 0,t._previousIsValid=void 0,t._selectedMap=[],t.mousePos={x:-1,y:-1},t.mouseDownPos={x:-1,y:-1},t._lastClickTime=0,t._numClicks=0,t._savedPaneSels={},t._itemHighlightPosition=void 0,t.itemHighlightPosition=new S.a,t.init(),t}return g()(e,t),o()(e,[{key:"init",value:function(){this.reset();var t={};t.onMove=this.onMouseMoveMobile.bind(this),document.addEventListener("selectstart",this._onSelectStart.bind(this)),document.addEventListener("selectionchange",this._onSelectionChange.bind(this)),l.default.setupClick(document,this,t),A.a.listen("paneAdded",this.onPaneAdded.bind(this)),A.a.listen("paneRemoved",this.onPaneRemoved.bind(this)),k.a.binder(this,"restore","onScroll","closeKeyboardIfNoSelection","_closeKeyboard")}},{key:"reset",value:function(t,e){if(this._isValid){l.default.shouldLog(p.a.LogLevels.Selection)&&l.default.log("Sel::reset");var r=!e&&this.save();r&&(this._previousSelection=r),this._setIndexSide(I,void 0),this._setIndexSide(P,void 0),this._setOffsetSide(I,void 0),this._setOffsetSide(P,void 0),this._dblClickOffsets=void 0,this.preferLineStart=!1,this._mouseOffset=-1,this._mouseMoved=!1,this._isValid=!1,this._isArrowSelectInverted=!1,this._itemHighlightPosition=void 0;var a=this.getPane();!a||a.isUnloaded()||a.isDestroyed()||(a.caretPosition.set(void 0),this._updateSelection()),l.default.keyboardToolbar&&(F.a.reset(),t||i(59).default.isTyping||A.a.fireEvent("closeKeyboard",[]))}}},{key:"getPreviousSelection",value:function(){return this._previousSelection}},{key:"dumpState",value:function(){var t={isValid:this._isValid,isDirty:this._isDirty,isWatchingChange:this._isWatchingChange,isMouseDown:this._isMouseDown,isWindowFocused:this.isWindowFocused.get(),numClicks:this._numClicks,start:{index:this.startIndex,offset:this.startOffset},end:{index:this.endIndex,offset:this.endOffset}};try{var e=!!this.pane.get();t.paneInfo=e?{hasPane:e,id:this.pane.get().id,numItems:this.pane.get().items.get().length,displayTop:this.pane.get().indexOfTop(),displayCount:this.pane.get().inViewCount()}:"No Pane Set"}catch(i){t.paneInfo="Invalid Pane"}try{void 0!==this.startIndex&&(t.start.item=this.pane.get().items.get()[this.startIndex].id)}catch(i){t.start.item="Invalid Item"}try{void 0!==this.endIndex&&(t.end.item=this.pane.get().items.get()[this.endIndex].id)}catch(i){t.end.item="Invalid Item"}return t}},{key:"setValid",value:function(t){if(t){try{l.default.PAssert(393,!isNaN(this.getStartIndex())&&this.getStartIndex()>=0,"Must have a valid start index when sel is valid: ",this.getStartIndex())}catch(r){l.default.reportError(r)}try{l.default.PAssert(394,!isNaN(this.getEndIndex())&&this.getEndIndex()>=0,"Must have a valid end index when sel is valid: ",this.getEndIndex())}catch(r){l.default.reportError(r)}try{var e=this.pane.get().items.get()[this.startIndex];try{l.default.PAssert(395,e&&(l.default.isVMLI(e)||l.default.isVMLI(e.item)),"Valid selection must always be into a VMLI for start item")}catch(r){l.default.reportError(r)}var i=this.pane.get().items.get()[this.endIndex];try{l.default.PAssert(396,i&&(l.default.isVMLI(i)||l.default.isVMLI(i.item)),"Valid selection must always be into a VMLI for end item")}catch(r){l.default.reportError(r)}}catch(a){l.default.reportError(a)}}else this.reset();this._isValid=t}},{key:"isArrowSelectInverted",value:function(){return this._isArrowSelectInverted}},{key:"setArrowSelectInverted",value:function(t){this._isArrowSelectInverted=t}},{key:"getStartItem",value:function(){return this.getPane().itemAtIndex(this.startIndex)}},{key:"getStartObject",value:function(){return this.getPane().objectAtIndex(this.startIndex)}},{key:"getStartOffset",value:function(){var t;return-1===this.startOffset?(t=this.getStartTotal(),this.startOffset=t):t=this.startOffset,t}},{key:"getStartIndex",value:function(){return this.startIndex}},{key:"getStartTotal",value:function(){return this.getStartItem().getParsedText().length}},{key:"getEndItem",value:function(){return this.getPane().itemAtIndex(this.endIndex)}},{key:"getEndObject",value:function(){return this.getPane().objectAtIndex(this.endIndex)}},{key:"getEndOffset",value:function(){var t;return-1===this.endOffset?(t=this.getEndTotal(),this.endOffset=t):t=this.endOffset,t}},{key:"getEndIndex",value:function(){return this.endIndex}},{key:"getEndTotal",value:function(){return this.getEndItem().getParsedText().length}},{key:"isMouseDown",value:function(){return this._isMouseDown}},{key:"_mutateProperty",value:function(t,e){var i=this[t];this[t]=e,i!==e&&(this._isDirty=!0)}},{key:"_setIndexSide",value:function(t,e){this._mutateProperty(t+"Index",e)}},{key:"_setOffsetSide",value:function(t,e){if(m.default.settings.selectFullItems.get()&&this.getStartIndex()!==this.getEndIndex()){var i=t===I?this.getStartIndex():this.getEndIndex(),r=this.getPane().itemAtIndex(i);e=t===I?0:r.getParsedText().length}this._mutateProperty(t+"Offset",e),l.default.shouldLog(p.a.LogLevels.Edit)&&l.default.log(t,e)}},{key:"setSelection",value:function(t,e,i,r){this._setIndexSide(I,t),this._setIndexSide(P,i),this._setOffsetSide(I,e),this._setOffsetSide(P,r),this._downIndex=t,this._downOffset={start:e,end:r}}},{key:"isValid",value:function(){return this._isValid}},{key:"checkValid",value:function(){var t=!1,e=this.getPane();if(e&&this.startIndex>=0&&this.startIndex<e.numItems()&&this.endIndex>=0&&this.endIndex<e.numItems())if(this.getStartItem()&&this.getEndItem()){var i=this.getStartItem().getParsedText(),r=this.getEndItem().getParsedText();this.startOffset>=0&&this.startOffset<=i.length&&this.endOffset>=0&&this.endOffset<=r.length&&(t=!0)}else t=!1;return!t&&this.isValid()&&(l.default.log("Sel is now invalid"),this.reset(void 0,!0)),t}},{key:"clearSelection",value:function(t){this.reset(t)}},{key:"onPaneAdded",value:function(t){}},{key:"onPaneRemoved",value:function(t){this.getPane()===t&&this.setFocusedPane(void 0)}},{key:"onScroll",value:function(t){var e=l.default.getPaneForElement(t.target);if(this._isMouseDown&&e===this.getPane()&&e.isWriteable&&!i(98).default.isDragging){var r=this.getMousePos();this._mouseOffset=r.y+e.getScrollTop();var a=document.elementFromPoint(r.x,r.y),n={clientX:r.x,clientY:r.y,target:a};this._updateFromMouse(n),this._updateSelection()}}},{key:"onRightMouseDown",value:function(t){var e=!l.default.hasClass(t.target,"mdImage"),i=l.default.findParent(t.target,"item")&&l.default.getElementParent(t.target);if(i&&!l.default.findParent(i,"autocompleteItem",2)&&!l.default.hasClass(i,"itemNotInPane")){var r=l.default.getPaneObjectForElement(i);if(r){var a=l.default.getPaneForElement(i),n=r.index;this.isSelected(n,a)&&(e=!1)}}e&&(this._isInRightClick=!0,this.onMouseDown(t,!0),this._isInRightClick=!1)}},{key:"checkDoubleClick",value:function(){this._isValid&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()!==this.getEndOffset()&&(this._dblClickOffsets={index:this.getStartIndex(),start:this.getStartOffset(),end:this.getEndOffset()}),this._dblClickTimeout=void 0}},{key:"onMouseDown",value:function(t,e){var i=l.default.getPaneForElement(t.target);if(this.isWindowFocused.set(!0),l.default.findParent(t.target,"formattingToolbar")||(this._itemHighlightPosition=void 0,this.itemHighlightPosition.set(void 0)),i){this.setFocusedPane(i);var r=t.target,a=i.getInfiniteList();if(i.supportSel&&!N.some(function(t){return l.default.isArray(t)?l.default.findParent(r,t[0]):l.default.hasClass(r,t)})){e||(this._isMouseDown=!0),this._selectionBeforeBlur=void 0,this.preferLineStart=!1;var n,o=this.mouseDownPos.x,u=this.mouseDownPos.y,s=!1,h=l.default.getElementParent(t.target),d=l.default.findParent(t.target,"line");if(this.mouseDownPos.x=t.pageX,this.mouseDownPos.y=t.pageY,!d&&(d=h&&l.default.findChild(h,"line"))){var c=l.default.offset(d);n=t.clientX>c.left+50||t.clientY>c.top+10?"end":"start"}if(l.default.findParent(r,"paneContent")){if(i&&i.isWriteable&&i.isEditable){if(h&&d){if(e)this._numClicks=1,this._lastClickTime=0,this._dblClickOffsets=void 0;else{var v=Date.now();v-this._lastClickTime<p.a.DoubleClickTime&&Math.abs(t.pageX-this.mouseDownPos.x)<2&&Math.abs(t.pageY-this.mouseDownPos.y)<2&&Math.abs(t.pageX-o)<2&&Math.abs(t.pageY-u)<2?this._numClicks++:(this._numClicks=1,this._dblClickOffsets=void 0),this._lastClickTime=v}var y=w.default.getCursorSelectionRange(t);if(y){l.default.shouldLog(p.a.LogLevels.Selection)&&l.default.log("Sel::onMouseDown - Default");var g=l.default.getListCellForElement(t.target);if(g&&!g.props.overview){if(this.preferLineStart=t.clientX-l.default.offset(d).left<30,t.shiftKey&&!(f.a.mac&&t.metaKey||!f.a.mac&&t.ctrlKey))this._mouseMoved=!0,this._mouseOffset=t.eventY+i.getScrollTop(),this._updateFromMouse(t);else if(1===this._numClicks||this._numClicks>3){this._downIndex=g.getIndex();try{l.default.PAssert(400,this._downIndex>=0,"Must have a valid index in react item")}catch(T){l.default.reportError(T)}if(this._downIndex<0)try{l.default.PAssert(401,this._downIndex>=0,"Dead cell error",l.default.getElementPath(y.getStartElement()),l.default.getElementPath(t.target))}catch(T){l.default.reportError(T)}this._downItem=g.getItem();try{l.default.PAssert(402,this._downItem,"Must have a valid item in react item")}catch(T){l.default.reportError(T)}var k=y.getSelectOffsetsInElement(h);if(n){var A="start"===n?this._downItem.getPrefixLength():this._downItem.getTextLength();k.start=A,k.end=A}if(0===this._downItem.getParsedTextWithoutPrefix().length?this._downOffset={start:k.total,end:k.total}:this._downOffset={start:k.start,end:k.start},m.default.settings.showMarkdown.get()&&!this.isSelected(this._downIndex,i)){var S=l.default.findParent(y.getStartContainer(),"mdSpan",2);if(S&&y.getStartOffset()===S.innerHTML.length){for(var F=0,C=S.nextElementSibling,H=0;C&&l.default.hasClass(C,"mdMarkup");){if(F++>5e3&&__infLoop&&__infLoop(F))throw new RangeError;H+=C.innerHTML.length,C=C.nextElementSibling}if(!C){var M=Math.min(this._downOffset.start+H,k.total);this._downOffset={start:M,end:M}}}}this.setSelection(this._downIndex,this._downOffset.start,this._downIndex,this._downOffset.end)}else if(2===this._numClicks){var z=this._downItem.getParsedText(),D=L.a.getPreviousWord(this._downItem,z,this._downOffset.start)+1,V=L.a.getNextWord(this._downItem,z,this._downOffset.end);this._setOffsetSide(I,D),this._setOffsetSide(P,V),this._downOffset={start:D,end:V}}else 3===this._numClicks&&(this._setOffsetSide(I,0),this._setOffsetSide(P,this._downItem.getParsedText().length),this._downOffset={start:0,end:this._downItem.getParsedText().length});s=!0}}}else if(!l.default.findParent(t.target,"paneContent")||l.default.findParent(t.target,"addItemButton")||a.disablePointerEvents.get())l.default.shouldLog(p.a.LogLevels.Selection)&&l.default.log("Sel::onMouseDown - Skip");else{var G=i.indexOfLastItem();G>=0&&(t.shiftKey&&this.isValid()&&!e?this.selectIndices(this.getStartIndex(),this.getStartOffset(),G,-1):this.selectIndex(G,-1),s=!0),t.preventDefault()}this._dblClickTimeout=setTimeout(this.checkDoubleClick.bind(this),0)}}else l.default.shouldLog(p.a.LogLevels.Selection)&&l.default.log("Sel::onMouseDown - Skip header");this.setValid(s&&this.checkValid()),this.isValid()&&(l.default.setItemAnimationMode(p.a.ItemAnimationMode.None),this._updateSelection(),l.default.resetItemAnimationMode()),a&&a.flushTimeoutPointerEvents()}}}},{key:"getMousePos",value:function(){return this.mousePos}},{key:"onMouseMoveDocument",value:function(t){this.mousePos.x=t.pageX,this.mousePos.y=t.pageY}},{key:"onMouseMove",value:function(t){if(this._dblClickTimeout&&(clearTimeout(this._dblClickTimeout),this._dblClickTimeout=void 0),t.target!==document.documentElement&&t.target.parentElement&&!l.default.isDraggingImage){var e=l.default.getPaneForElement(t.target);if(this._isValid&&this._isMouseDown&&e===this.getPane()&&e.supportSel&&e.isWriteable&&!i(98).default.isDragging)return this._mouseMoved=!0,l.default.setItemAnimationMode(p.a.ItemAnimationMode.None),this._mouseOffset=t.eventY+e.getScrollTop(),this._updateFromMouse(t),this._updateSelection(),t.preventDefault(),!1}}},{key:"onMouseMoveMobile",value:function(t){this.mousePos.x=t.pageX||t.clientX,this.mousePos.y=t.pageY||t.clientY}},{key:"onMouseUp",value:function(t){var e=l.default.isAttachedToDoc(t.target)&&l.default.getPaneForElement(t.target),i=e&&l.default.getElementParent(t.target);e&&e.supportSel&&!N.some(function(e){return l.default.isArray(e)?l.default.findParent(t.target,e[0]):l.default.hasClass(t.target,e)})&&(this._isMouseDown=!1,l.default.shouldLog(p.a.LogLevels.Selection)&&l.default.log("Sel::onMouseDown - onMouseUp"),l.default.vmMain&&l.default.resetItemAnimationMode(),!i||l.default.hasClass(t.target,"contact")||l.default.hasClass(i,"itemNotInPane")||this.updateCaret(),this._itemHighlightPosition&&this.itemHighlightPosition.set(this._itemHighlightPosition),l.default.cancelRepeatScrolls())}},{key:"focusPane",value:function(t){this.setFocusedPane(t),this.updateCaret()}},{key:"setFocusedPane",value:function(t){if(!t||!l.default.focusedPane||l.default.focusedPane.id!==t.id){var i=l.default.focusedPane;i&&!i.isUnloaded()&&(i.setFocused(!1),i.isEditable&&this.isValid()&&(this._savedPaneSels[i.id]=this.save())),m.default.PaneUpdateBatcher.beginUpdateItems(),this.reset(),F.a.reset(i),l.default.focusedPane=t,l.default.focusedItem=t?t.getItem():void 0,v()(d()(e.prototype),"setFocusedPane",this).call(this,t),i&&i.deactivate(),t&&t.activate(),m.default.PaneUpdateBatcher.commitUpdateItems()}}},{key:"_updateWith",value:function(t,e,i){var r=e===I?i.getStartElement():i.getEndElement();try{l.default.PAssert(403,r,"Trying to select in invalid container")}catch(h){l.default.reportError(h)}if(r){var a=l.default.getListCellForElement(r),n=l.default.getElementParent(r),o=l.default.getItemForElement(n),u=i.getSelectOffsetsInElement(n),s=e===I?u.start:u.end;try{l.default.PAssert(404,a.getItem(),"Should not be updating ReactCells without VMLIs")}catch(h){l.default.reportError(h)}if(l.default.shouldLog(p.a.LogLevels.Selection)&&l.default.log("Sel::_updateWith["+t+"] - ",s,a.index),this._setIndexSide(t,a.getIndex()),this._dblClickOffsets&&a.getIndex()===this._dblClickOffsets.index)if(t===I)s=Math.min(s,this._dblClickOffsets.start);else if(t===P)s=Math.max(s,this._dblClickOffsets.end);else try{l.default.PAssert(405,!1,"Invalid toUpdate value")}catch(h){l.default.reportError(h)}this._downOffset.start!==this._downOffset.end&&(s=t===I?L.a.getPreviousWord(o,o.getParsedText(),s)+1:L.a.getNextWord(o,o.getParsedText(),s-1)),this._setOffsetSide(t,s);try{l.default.PAssert(406,!isNaN(s),"Selection offsets should not be undefined")}catch(h){l.default.reportError(h)}}}},{key:"_setSelectionOnSide",value:function(t,e,i){var r=t===I?P:I;this._setIndexSide(t,e),this._setIndexSide(r,this._downIndex),this._setOffsetSide(t,i),this._setOffsetSide(r,t===I?this._downOffset.start:this._downOffset.end),this.setArrowSelectInverted(e<this._downIndex||e===this._downIndex&&i<this._downOffset.start)}},{key:"_updateFromMouse",value:function(t){var e=t.target;if(e){var i=l.default.focusedPane;if(!l.default.getElementParent(e)&&t.clientY<i.contentTop()){if(l.default.shouldLog(p.a.LogLevels.Selection)&&l.default.log("Sel::_updateFromMouse - outOfPane"),e=l.default.elementFromPoint(t.clientX,i.contentTop()+1),l.default.getElementParent(e)){var r=l.default.getListCellForElement(e),a=l.default.getItemForElement(e);try{l.default.PAssert(407,a,"If it is an LI it should be an item",e)}catch(A){l.default.reportError(A)}this._setIndexSide(I,r.getIndex()),this._setOffsetSide(I,0)}}else{var n,o,u,s=l.default.getElementParent(e);if(s){if(l.default.findParent(e,"line")||(e=s.firstElementChild),(u=w.default.getCursorSelectionRange(t))&&u.getStartElement()){var h=l.default.getListCellForElement(e);try{l.default.PAssert(408,h,"Must be able to find a valid reactCell for the start element")}catch(A){l.default.reportError(A)}if(h){if((n=h.getIndex())<0)try{l.default.PAssert(410,n>=0,"Dead cell error",l.default.getElementPath(u.getStartElement()),l.default.getElementPath(e))}catch(A){l.default.reportError(A)}if(l.default.findParent(u.getStartContainer(),"line")&&l.default.findParent(u.getEndContainer(),"line"))o=u.getSelectOffsetsInElement(s).start;else n<=this._downIndex?this._setSelectionOnSide(I,n,0):this._setSelectionOnSide(P,n,0)}}}else if(i.hasNonVMLIs){var d=l.default.getPaneObjectForElement(e);if(d){var c=d.index;if(c>=0)if(!i.itemAtIndex(c))if(c<this._downIndex){var v=i.indexOfNextVMLI(c);v>=0&&this._setSelectionOnSide(I,v,0)}else{var y=i.indexOfPrevVMLI(c);if(y>=0){var g=i.itemAtIndex(y);this._setSelectionOnSide(P,y,g.getParsedText().length)}}}}else if(l.default.hasClass(e,"paneContent")){l.default.shouldLog(p.a.LogLevels.Selection)&&l.default.log("Sel::_updateFromMouse - paneContent");var m=i.getLastItem();this._setIndexSide(P,i.numItems()-1),this._setOffsetSide(P,m?m.getParsedText().length:0)}if(!isNaN(n)&&!isNaN(o)&&u){var f,k=l.default.findParent(e,"line");if(k)this.preferLineStart=t.clientX-l.default.offset(k).left<30,n<this._downIndex||n===this._downIndex&&o<this._downOffset.start?(f=P,this._updateWith(I,I,u),this.setArrowSelectInverted(!0)):(n>this._downIndex||n===this._downIndex&&o>=this._downOffset.start)&&(f=I,this._updateWith(P,P,u),this.setArrowSelectInverted(!1),o===this._downOffset.start&&(this._isDirty=!0)),void 0!==f&&(l.default.shouldLog(p.a.LogLevels.Selection)&&l.default.log("Sel::_updateFromMouse - RunAfterUpdates"),this._setIndexSide(f,this._downIndex),this._dblClickOffsets?this._setOffsetSide(f,this._dblClickOffsets[f]):this._setOffsetSide(f,f===I?this._downOffset.start:this._downOffset.end),this.setValid(!0))}}}}},{key:"setSelectionFromNativeRange",value:function(t){this._updateWith(I,I,t),this._updateWith(P,P,t),this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex()))}},{key:"_updateSelection",value:function(){var t=this;if(this._isDirty){var e=this.getPane(),i=this.save(),r=this._selectedMap;this.getStartIndex()!==this.getEndIndex()||(this.getStartOffset(),this.getEndOffset());if(this._selectedMap=[],this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex())),this.getStartIndex()===this.getEndIndex()&&void 0!==this.getStartIndex()){try{l.default.PAssert(411,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(c){l.default.reportError(c)}this._selectedMap[this.getStartIndex()]={start:this.getStartOffset(),end:this.getEndOffset()}}else for(var a=0,n=this.getStartIndex();n<=this.getEndIndex();++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=!0;if(!m.default.settings.selectFullItems.get())if(n===this.getStartIndex())o={start:this.getStartOffset(),end:-1};else if(n===this.getEndIndex()){try{l.default.PAssert(412,this.getEndOffset()<=this.getEndItem().getParsedText().length,"Selection is past end of text string")}catch(c){l.default.reportError(c)}o={start:0,end:this.getEndOffset()}}this._selectedMap[n]=o}if(e){var u=!1;r.forEach(function(i,r){if(void 0===t._selectedMap[r]&&r<e.numItems()){var a=e.itemAtIndex(r);a&&(a.itemChanged.notify(),u=u||e.checkHeightChanged(a,r),0)}}),this._selectedMap.forEach(function(i,a){var n=r[a],o=t._selectedMap[a];if(void 0===n||n.start!==o.start||n.end!==o.end){var s=e.itemAtIndex(a);s&&((!n||o.start!==o.end||n&&n.start!==n.end||l.default.isObject(n)!==l.default.isObject(o))&&s.itemChanged.notify(),u=u||e.checkHeightChanged(s,a),0)}}),u&&(l.default.setItemAnimationMode(p.a.ItemAnimationMode.Move),e.updateItems(!1,!0),l.default.resetItemAnimationMode())}this.updateCaret(),this._isDirty=!1,A.a.fireEvent("selectionChanged",[i]);var s=this.getStartIndex(),h=this.isValid();if(s===this.getEndIndex()||!h){if(s!==this._previousSelectedIndex||h!==this._previousIsValid){var d=h?this.getStartItem():void 0;A.a.fireEvent("selectedIndexChanged",[s,e,d])}this._previousSelectedIndex=s,this._previousIsValid=h}}}},{key:"_onSelectStart",value:function(t){return!i(98).default.isDragging||(t.preventDefault(),!1)}},{key:"_onSelectionChange",value:function(t){if(w.default.hasSelection()){if(f.a.android&&i(98).default.isDragging)return void w.default.clearSelection();if(this.getPane().isWriteable)if(f.a.android){if(this.isValid()){var e=this.getStartElement();e===document.activeElement&&this.setSelection(this.getStartIndex(),e.selectionStart,this.getEndIndex(),e.selectionEnd)}}else{var r=w.default.getSelectionRange(),a=r.getStartElement(),n=r.getEndElement();if(a&&n){var o=l.default.findParent(a,"item"),u=l.default.findParent(n,"item");o&&u&&!l.default.hasClass(o,"dead")&&!l.default.hasClass(u,"dead")&&this.setSelectionFromNativeRange(r)}}else this.reset()}l.default.timeoutOnce("closeKeyboardIfNoSelection",this.closeKeyboardIfNoSelection,100)}},{key:"closeKeyboardIfNoSelection",value:function(){w.default.hasValidSelection()||this.closeKeyboard()}},{key:"closeKeyboard",value:function(){l.default.batchRenderUpdates(this._closeKeyboard)}},{key:"_closeKeyboard",value:function(){this.reset(),l.default.blurActiveElement()}},{key:"updateCaret",value:function(){var t=this.getPane();if(t&&t.isWriteable){if(this.isValid()){var e=!this._isInRightClick&&this.getStartItem()===this.getEndItem()&&this.getStartItem()&&this.getStartItem().isNote();e?t.openNoteContextMenu():!m.default.menus.isAutocompleteOpen()&&m.default.menus.isContextMenuOpen()&&m.default.menus.closeContextMenu()}if(!f.a.isMobile)if(this.isValid()){0;var i=this.getStartItem(),r=this.getStartObject(),a=t.topOfIndex(this.getStartIndex())+(i&&i.shouldShowParents(r,t)?p.a.HeightAgendaParents:0),n=t.getPaddingForPaneObject(r),o=m.default.Measure.getCaretOffset(r,t,this.getStartOffset(),this.preferLineStart);if(this.getStartItem()&&this.getEndItem()&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()===this.getEndOffset()){this._selectionBeforeUpdate={index:this.getStartIndex(),offset:this.getStartOffset()};var u=t.caretPosition.get();o.left=Math.floor(Math.min(o.left+n,t.getWidth()-10)),o.top+=a,o.isVisible=!0,o.item=i,o.pane=t,o.paneObject=r,this._itemHighlightPosition=void 0,this.itemHighlightPosition.set(void 0),u&&u.isVisible&&u.left===o.left&&u.top===o.top||t.caretPosition.set(o)}else{var s=t.caretPosition.get();s&&s.isVisible&&((s=l.default.clone(s)).isVisible=!1,t.caretPosition.set(s));var h=this.getStartIndex()===this.getEndIndex()?this.getEndOffset():i.getTextLength(),d=m.default.Measure.getCaretOffset(r,t,h,this.preferLineStart);this._itemHighlightPosition={x:n+(o.left+d.left)/2,y:a}}e||!t.hiddenInput||this.isComposing||this.focusHiddenInput()}else t.caretPosition.set(void 0)}}},{key:"focusHiddenInput",value:function(){var t=this.getPane();if(t&&t.isEditable&&t.hiddenInput){var e=w.default.createSelectionRange(),i=t.hiddenInput,r=0,a=1,n=t.scrollElement,o=n.scrollLeft,u=n.scrollTop;if(this.isValid()){var s=this.getStartItem().getParsedText();i.innerHTML=l.default.escape(s),r=this.getStartOffset(),a=this.getStartItem()===this.getEndItem()?this.getEndOffset():this.getStartOffset()}i.firstChild&&0!==i.firstChild.length||(i.innerHTML=p.a.TextSpace);var h=i.firstChild;try{l.default.PAssert(416,h,"Empty element must have a valid child")}catch(d){l.default.reportError(d)}try{i.focus(),e.setStart(h,r),e.setEnd(h,a),w.default.setSelectionRange(e)}catch(c){l.default.reportError(c)}n.scrollLeft=o,n.scrollTop=u}}},{key:"isSelected",value:function(t,e){return e===this.getPane()&&!!this._selectedMap[t]}},{key:"getSelectionAtIndex",value:function(t){return this._selectedMap[t]}},{key:"selectIndex",value:function(t,e,i,r){return void 0===i&&(i=e),this.selectIndices(t,e,t,i,r)}},{key:"selectIndices",value:function(t,e,i,r,a){try{l.default.PAssert(417,t>=0,"Must supply a valid start index")}catch(y){l.default.reportError(y)}try{l.default.PAssert(418,i>=0,"Must supply a valid end index")}catch(y){l.default.reportError(y)}try{l.default.PAssert(419,i>t||i===t&&(r>=e||-1===r),"Must not pass reversed selection")}catch(y){l.default.reportError(y)}if(!(t<0||i<0)){var n,o,u=!1,s=this.getPane();if(s&&s.isWriteable){n=s.itemAtIndex(t),o=s.itemAtIndex(i);try{l.default.PAssert(420,n,"Trying to select invalid start index")}catch(y){l.default.reportError(y)}try{l.default.PAssert(421,o,"Trying to select invalid end index")}catch(y){l.default.reportError(y)}if(n&&o&&a!==p.a.SelectOption.AllowPrefix){var h=n.getPrefixLength(),d=o.getPrefixLength();e>=0&&e<h&&(e=h),r>=0&&r<d&&(r=d)}}if(!n||!o||this.isValid()&&t===this.getStartIndex()&&e===this.getStartOffset()&&i===this.getEndIndex()&&r===this.getEndOffset())this.updateCaret();else{l.default.shouldLog(p.a.LogLevels.Selection)&&l.default.log("Sel::selectIndices -",e,r),this.setSelection(t,e,i,r);try{l.default.PAssert(422,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(y){l.default.reportError(y)}if(!isNaN(this.getStartOffset())&&this.getStartOffset()>=0&&!isNaN(this.getEndOffset())&&this.getEndOffset()<=this.getEndTotal()&&(f.a.android&&a===p.a.SelectOption.Delay||this._updateSelection()),a!==p.a.SelectOption.DoNothing)if(f.a.android&&a===p.a.SelectOption.Delay)F.a.setSelected([t],s,!0),l.default.timeoutOnce("selectAfterEnter",function(){var a=s.elementAtIndex(t),n=s.elementAtIndex(i);this.selectElements(a,e,n,r),F.a.clearEditables(s),this._updateSelection()}.bind(this),0);else{var c=s.elementAtIndex(t),v=s.elementAtIndex(i);c&&v&&(l.default.clearTimeoutOnce("selectAfterEnter"),this.selectElements(c,e,v,r))}u=!0}return u}}},{key:"selectItem",value:function(t,e,i){try{l.default.PAssert(423,l.default.isNumber(e),"Must pass a valid start offset")}catch(r){l.default.reportError(r)}try{l.default.PAssert(424,l.default.isNumber(i)||void 0===i,"Must pass a valid end offset")}catch(r){l.default.reportError(r)}return void 0===i&&(i=e),this.selectItems(t,e,t,i)}},{key:"selectItems",value:function(t,e,i,r){try{l.default.PAssert(425,l.default.isVMLI(t),"Should only be passing VMLIs to start this fn")}catch(u){l.default.reportError(u)}try{l.default.PAssert(426,l.default.isVMLI(i),"Should only be passing VMLIs to end this fn")}catch(u){l.default.reportError(u)}var a=this.getPane();if(a){var n=a.indexOfItem(t);try{l.default.PAssert(427,n>=0,"Must be able to find the start item in the pane")}catch(u){l.default.reportError(u)}var o=a.indexOfItem(i);try{l.default.PAssert(428,o>=0,"Must be able to find the end item in the pane")}catch(u){l.default.reportError(u)}return this.selectIndices(n,e,o,r)}}},{key:"selectElements",value:function(t,e,i,r){try{l.default.PAssert(429,!l.default.isVMLI(t),"Should not be passing VMLIs to start this fn")}catch(u){l.default.reportError(u)}try{l.default.PAssert(430,!l.default.isVMLI(i),"Should not be passing VMLIs to end this fn")}catch(u){l.default.reportError(u)}l.default.shouldLog(p.a.LogLevels.Selection)&&l.default.log("Sel::selectElements -",e,r),this._isWatchingChange=!1,f.a.isMobile&&f.a.android&&(t=t.firstElementChild,i=i.firstElementChild);var a=!1,n=w.default.getOffsetChildElement(t,e),o=w.default.getOffsetChildElement(i,r);try{l.default.PAssert(431,n&&n.element&&!isNaN(n.offset),"Start element is invalid")}catch(u){l.default.reportError(u)}try{l.default.PAssert(432,o&&o.element&&!isNaN(o.offset),"End element is invalid")}catch(u){l.default.reportError(u)}return n&&n.element&&o&&o.element&&(w.default.setSelection(n.element,n.offset,o.element,o.offset),a=!0),this._isWatchingChange=!0,a}},{key:"save",value:function(t){if(this._isValid){var e=this.getPane();if(!e.isDestroyed()&&!e.isUnloaded()){try{l.default.PAssert(433,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(r){l.default.reportError(r)}try{l.default.PAssert(434,!isNaN(this.getEndIndex()),"End index must be valid")}catch(r){l.default.reportError(r)}var i={pane:e,startIndex:this.getStartIndex(),startOffset:this.getStartOffset(),endIndex:this.getEndIndex(),endOffset:this.getEndOffset()};return t||(i.endItem=this.getEndItem(),i.endObject=this.getEndObject(),i.startItem=this.getStartItem(),i.startObject=this.getStartObject()),this._savedSelection=i,i}}}},{key:"getSavedSelection",value:function(){return this._savedSelection}},{key:"restore",value:function(t,e){var i=!1;if(t&&!t.pane.isDestroyed()){try{l.default.PAssert(435,t.pane,"Must have a valid pane to restore selection to")}catch(a){l.default.reportError(a)}var r=l.default.focusedPane;l.default.focusedPane=t.pane,l.default.focusedItem=t.pane.getItem(),r&&!r.isUnloaded()&&r!==t.pane&&r.setFocused(!1),t.pane.setFocused(!0),this.pane.set(t.pane),e||(t=t.pane.adjustSelectionFromPaneObject(t))}return t&&t.startItem&&t.endItem?(this.selectIndices(t.startIndex,t.startOffset,t.endIndex,t.endOffset),i=!0):this.reset(),this._savedSelection=void 0,i}},{key:"scrollStartIntoView",value:function(t){if(this._isValid){try{l.default.PAssert(436,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(e){l.default.reportError(e)}try{l.default.PAssert(437,!isNaN(this.getEndIndex()),"End index must be valid")}catch(e){l.default.reportError(e)}l.default.focusedPane.scrollIndexIntoView(this.getStartIndex(),t?p.a.ScrollDuration.Snap:p.a.ScrollDuration.Default)}}},{key:"scrollEndIntoView",value:function(){if(this._isValid){try{l.default.PAssert(438,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(t){l.default.reportError(t)}try{l.default.PAssert(439,!isNaN(this.getEndIndex()),"End index must be valid")}catch(t){l.default.reportError(t)}l.default.focusedPane.scrollIndexIntoView(this.getEndIndex(),p.a.ScrollDuration.Default)}}},{key:"onWindowBlur",value:function(t){this.isWindowFocused.set(!1)}},{key:"onWindowFocus",value:function(t){this.isWindowFocused.set(!0)}},{key:"getSelectedObjects",value:function(t){var e=0;if(!this._isValid)return[];for(var i=[],r=this.getPane(),a=this.getStartIndex();a<=this.getEndIndex();++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=r.objectAtIndex(a),o=n.item;!o||!t&&o.isNote()||i.push(n)}return i}},{key:"getSelectedItems",value:function(t){var e=0;if(!this._isValid)return[];for(var i=[],r=this.getPane(),a=this.getStartIndex();a<=this.getEndIndex();++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=r.itemAtIndex(a);!n||!t&&n.isNote()||i.push(n)}return i}},{key:"getStartElement",value:function(){if(this._isValid&&!isNaN(this.getStartIndex()))return this.getPane().elementAtIndex(this.getStartIndex())}},{key:"getEndElement",value:function(){if(this._isValid&&!isNaN(this.getEndIndex()))return this.getPane().elementAtIndex(this.getEndIndex())}},{key:"setHovered",value:function(t,e,i){if(this.hoveredReactCell!==i){var r=this.hoveredItem;this.hoveredItem=e,this.hoveredReactCell=i,r&&r.itemChanged.notify(),e&&e.itemChanged.notify()}}},{key:"isReactCellHovered",value:function(t){return this.hoveredReactCell===t}},{key:"isItemHovered",value:function(t){return this.hoveredItem===t}},{key:"insertTextAtCaret",value:function(t,e){this.pane.get().updateSelectionAndroid({target:this.getStartElement()});try{l.default.PAssert(440,this.getStartIndex()===this.getEndIndex(),"Cannot insert text in multiselect")}catch(u){l.default.reportError(u)}var i=this.getStartIndex(),r=this.getStartItem(),a=this.getStartOffset(),n=this.getEndOffset(),o=r.getRawText();a!==n&&(o=o.substr(0,a)+o.substr(n,o.length-n)),e&&a>0&&" "!==o[a-1]&&(o=l.default.insertIntoText(o," ",a),a++),o=l.default.insertIntoText(o,t,a),a+=t.length,r.setText(o,p.a.ChangeType.Local),this.selectIndex(i,a)}},{key:"fireKeyEvent",value:function(t,e,i){this.fireKeyEventInternal(t,"keydown",e),this.fireKeyEventInternal(t,"keypress",i||e),this.fireKeyEventInternal(t,"keyup",e)}},{key:"fireKeyEventInternal",value:function(t,e,i){try{l.default.PAssert(441,void 0!==i,"Must pass in valid key data to type")}catch(a){l.default.reportError(a)}if(t||(t=this.getStartElement()),document.createEvent&&t){var r=document.createEvent("Event");r.normCode=i.normCode,r.shiftKey=!!i.shiftKey,r.altKey=!!i.altKey,r.ctrlKey=!!i.ctrlKey,r.metaKey=!!i.metaKey,r.synthetic=!0,r.initEvent(e,!0,!0),t.dispatchEvent(r)}else if(t)try{l.default.PAssert(442,!1,"Unable to fire key event")}catch(a){l.default.reportError(a)}else try{l.default.PAssert(443,!1,"No element available to fire key event on")}catch(a){l.default.reportError(a)}}},{key:"fireClickEvent",value:function(t,e){this.fireClickEventInternal(t,"mousedown",e),this.fireClickEventInternal(t,"mouseup",e),this.fireClickEventInternal(t,"mouseclick",e)}},{key:"fireClickEventInternal",value:function(t,e,i,r){try{l.default.PAssert(444,void 0!==i,"Must pass in a valid button to click with")}catch(o){l.default.reportError(o)}if(t||(t=w.default.getSelectionNode()),document.createEvent&&t){var a=document.createEvent("Event");if(a.button=i,a.synthetic=!0,r)for(var n in r)r.hasOwnProperty(n)&&(a[n]=r[n]);a.initEvent(e,!0,!0),t.dispatchEvent(a)}else if(t)try{l.default.PAssert(445,!1,"Unable to fire click event")}catch(o){l.default.reportError(o)}else try{l.default.PAssert(446,!1,"No element available to fire click event on")}catch(o){l.default.reportError(o)}}},{key:"fireMouseUp",value:function(t,e){this.fireClickEventInternal(t,"mouseclick",e)}},{key:"editNote",value:function(t){var e=this,i=l.default.focusedPane,r=this.getStartObject();if(t.isNote())this.selectIndex(this.getStartIndex(),0);else{t.hasNote()||(C.e.beginAction(),t.createNote(),C.e.endAction());var a=i.indexOfObject(r);setTimeout(function(){e.selectIndex(a+1,0)},0)}}}]),e}(function(){function t(){a()(this,t),this.pane=new S.a}return o()(t,[{key:"setSelectedPaneObject",value:function(t){}},{key:"scrollStartIntoView",value:function(){}},{key:"updateCaret",value:function(){}},{key:"checkValid",value:function(){}},{key:"getPane",value:function(){try{l.default.PAssert(715,this.pane.get()===l.default.focusedPane,"Should these always match?")}catch(t){l.default.reportError(t)}return this.pane.get()}},{key:"setFocusedPane",value:function(t){this.pane.set(t)}},{key:"closeKeyboard",value:function(){}}]),t}());e.a=new H},function(t,e,i){"use strict";i.d(e,"c",function(){return s}),i.d(e,"a",function(){return h}),i.d(e,"b",function(){return d}),i.d(e,"d",function(){return c});var r=i(0),a=i(4),n=i(1),o=i(19),u=i(14),s={Insert:1,Remove:2,SetText:3,Create:4,Delete:5,Move:6,Update:7,Format:8,Zoom:9,UIAction:10,Misc:11,Mobile:12},h={ToggleOverview:1,RightClick:2,CloseMessage:3,ChangeDate:4,AddContact:5,DropItem:6,SyncContacts:7,OpenContact:8,SearchChanged:10,OpenDocumentsMenu:11,AddDocument:12,OpenDocument:13,OpenDocSharing:14,Copy:15,Paste:16,OpenImport:17,OpenExport:18,UndoRedo:19,AddToGCal:20,OpenEmail:21,ComposeEmail:22,DriveUpload:23,OpenDisplaySettings:24,DragItem:25,OpenAddPaneMenu:26,SetPrefix:27,OpenCalendarsMenu:28,OpenHelp:29},d={OpenKeyboard:1,CloseKeyboard:2,PaneCalendar:3,PaneOutline:4,OpenAutocomplete:5,CloseAutocomplete:6,AtButton:7,OpenMultiselect:8,CloseMultiselect:9},c={AddPane:1,RemovePane:2,SwitchPaneMode:3,OpenSettingsMenu:4,AddBoard:5,OpenDisplaySettings:6};function v(){this.disabled=!1,this.allowOfflineUndo=!1,this.cursor=-1,this.groupID=0,this.groups=[],this.externalUndoRedo=!1,this.undoRedoActive=!1,this.canRedo=!1,this.canUndo=!1,this._performingActions=!1,this._currentAction=[],this._actionsPreventUndo=!1,this._aggregateActions=0,this._externalStateChanged=[],o.a.binder(this,"stateChangeForUndoRedo"),this.init()}function y(t){var e=t[0],i=u.a.getItem(e.oldItemID),a=r.default.focusedPane;try{r.default.PAssert(462,i,"Expected model to exist: ",e)}catch(n){r.default.reportError(n)}if(e.zoomIn)a.zoomOut(i,!0);else if(e.zoomOut)a.zoomIn(i,!0);else try{r.default.PAssert(463,!1,"Zoom action must define either zoomIn or zoomOut")}catch(n){r.default.reportError(n)}}function g(t){var e=t[0],i=u.a.getItem(e.itemID),a=r.default.focusedPane;try{r.default.PAssert(464,i,"Expected model to exist: ",e)}catch(n){r.default.reportError(n)}if(e.zoomIn)a.zoomOut(i,!0);else if(e.zoomOut)a.zoomIn(i,!0);else try{r.default.PAssert(465,!1,"Zoom action must define either zoomIn or zoomOut")}catch(n){r.default.reportError(n)}}function l(t){switch(t[0].type){case c.RemovePane:case c.SwitchPaneMode:break;default:try{r.default.PAssert(466,!1,"Invalid UIAction")}catch(e){r.default.reportError(e)}}}function p(t){}v.prototype={init:function(){this.listeners=[]},addListener:function(t){this.listeners.push(t)},removeListener:function(t){this.listeners.remove(t)},_getNextGroupID:function(){return this.groupID+1},_useNextGroupID:function(){return++this.groupID},_getCurrentGroup:function(){return this.groups[this.cursor]},_getCurrentAction:function(){return this.groups[this.cursor].events[this.groups[this.cursor].events.length-1]},_pushGroup:function(){var t=this._useNextGroupID();return this.groups.push({id:t,events:[],persisted:!1}),this.cursor<74&&this.cursor++,this.groups.length>75&&this._handleGroupTrimmed(this.groups.shift()),t},_doAction:function(t,e){var i=this._getCurrentGroup();try{r.default.PAssert(467,i,"Expected group to exist")}catch(n){r.default.reportError(n)}var a={type:t,data:e};switch(t){case s.Zoom:a.cb={undo:y,redo:g};break;case s.UIAction:a.cb={undo:l,redo:p}}i.events.push(a)},_handleGroupTrimmed:function(t){for(var e=0,i=0;i<t.events.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=t.events[i];switch(a.type){case s.Insert:case s.Remove:case s.Create:case s.Delete:case s.Move:case s.Update:case s.Format:case s.Zoom:case s.UIAction:break;default:try{r.default.PAssert(469,!1,"Expected TrackerType, received: ",a.type)}catch(n){r.default.reportError(n)}}}},_mergeAction:function(t,e){r.default.log("Tracker Action Merged: ",t,e);var i=this._getCurrentAction();try{r.default.PAssert(470,i,"Expected action to exist")}catch(a){r.default.reportError(a)}switch(t){case s.Insert:case s.Remove:case s.Create:case s.Delete:case s.Move:case s.Update:break;case s.Format:try{r.default.PAssert(471,!1,"Formats cannot be merged")}catch(a){r.default.reportError(a)}break;case s.Zoom:try{r.default.PAssert(472,!1,"Zooms cannot be merged")}catch(a){r.default.reportError(a)}break;case s.UIAction:try{r.default.PAssert(473,!1,"UIActions cannot be merged")}catch(a){r.default.reportError(a)}break;default:try{r.default.PAssert(474,!1,"Expected TrackerType, received: ",t)}catch(a){r.default.reportError(a)}}},_canMerge:function(t){var e=!1,i=this._getCurrentGroup();return i&&i.events.length>0&&(i.events[i.events.length-1].type===t?t===s.Insert&&(e=!0):e=!1),e},_canCombine:function(t,e){var i=this._getCurrentGroup();return i&&(i.id===e||0===i.events.length)},performActions:function(t){try{r.default.PAssert(475,!this.disabled||a.default.intro,"Can only perform actions when enabled or during the intro")}catch(u){r.default.reportError(u)}try{r.default.PAssert(476,!this._performingActions,"Can not nest performing actions")}catch(u){r.default.reportError(u)}if(this._performingActions=!0,t&&t.length>0){var e,i=0;if(!this.disabled)this.cursor!==this.groups.length-1?(this.groups.splice(this.cursor+1,this.groups.length-(this.cursor+1)),e=this._pushGroup()):e=this._getNextGroupID();for(var n=0;n<t.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=t[n];this.fireActionEvent(o),this.disabled||(this._canCombine(o.type,e)?this._canMerge(o.type)?this._mergeAction(o.type,o.data):this._doAction(o.type,o.data):(e=this._pushGroup(),this._doAction(o.type,o.data)))}}this._performingActions=!1},beginAction:function(t){try{r.default.PAssert(477,!this._performingActions,"Should never begin an action while replaying old actions")}catch(e){r.default.reportError(e)}if(0===this._aggregateActions){this._actionsPreventUndo=!!t;try{r.default.PAssert(478,0===this._currentAction.length,"Current actions should always be empty when starting a new action")}catch(e){r.default.reportError(e)}}else r.default.shouldLog(n.a.LogLevels.Tracker)&&r.default.log("  -- Beginning Nested Action --");this._aggregateActions++},performAction:function(t,e){try{r.default.PAssert(479,!this._performingActions,"Should never perform an action while replaying old actions")}catch(o){r.default.reportError(o)}var i=!r.default.isLoaded||r.default.isLoadingRemote;this.disabled?a.default.intro?i?r.default.shouldLog(n.a.LogLevels.Tracker)&&r.default.log("Skipping Action For Intro: ",t,e):(r.default.shouldLog(n.a.LogLevels.Tracker)&&r.default.log("Performing Action For Intro: ",t,e),this.performActions([{type:t,data:[e]}])):r.default.shouldLog(n.a.LogLevels.Tracker)&&r.default.log("Performing Disabled Action: ",t,e):(r.default.shouldLog(n.a.LogLevels.Tracker)&&r.default.log("Performing Action: ",t,e),this._aggregateActions?this._currentAction.push({type:t,data:[e]}):this.performActions([{type:t,data:[e]}]))},endAction:function(){try{r.default.PAssert(480,!this._performingActions,"Should never end an action while replaying old actions")}catch(t){r.default.reportError(t)}try{r.default.PAssert(481,0!==this._aggregateActions,"Must have called beginAction before calling endAction")}catch(t){r.default.reportError(t)}1===this._aggregateActions?(this.disabled&&!a.default.intro||this.performActions(this._currentAction),this._currentAction.length=0,this._actionsPreventUndo=!1):r.default.shouldLog(n.a.LogLevels.Tracker)&&r.default.log("  -- Ending Nested Action --"),this._aggregateActions=Math.max(0,this._aggregateActions-1)},resetAggregateActionCount:function(){this._aggregateActions=0},notifyStateChangedFromUndoRedo:function(t,e){try{r.default.PAssert(482,this.undoRedoActive)}catch(i){r.default.reportError(i)}r.default.shouldLog(n.a.LogLevels.Tracker)&&r.default.log("Tracker notified of state change: ",e),this._externalStateChanged.push({type:t,data:e})},miscAction:function(t){this.fireActionEvent(t)},resetState:function(){this._performingActions=!1,this._externalStateChanged=[],this._currentAction=[],this.undoRedoActive=!1,this.cursor=-1,this.groupID=0,this.groups=[]},_getOrderedGroups:function(){return this.groups.slice(this.cursor).concat(this.groups.slice(0,this.cursor))},stringifyGroups:function(){return"Tracker: "+this._getOrderedGroups().length},stateChangeForUndoRedo:function(t){this.externalUndoRedo=!0,this.disabled=!0,this.canRedo=t.canRedo,this.canUndo=t.canUndo},fireActionEvent:function(t){try{if(t.data||(t.data={}),this.listeners)for(var e=0,i=0;i<this.listeners.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.listeners[i](t)}}catch(a){r.default.reportError(a)}}},e.e=new v},,,,function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(117),s=i(0),h=function(){function t(e,i){a()(this,t),this._value=e,this._listeners=i?[i]:void 0}return o()(t,[{key:"get",value:function(){return this._value}},{key:"set",value:function(t,e){var i=this._value;return this._value=t,!1!==e&&this.notify(t,i,e),t}},{key:"onHasValue",value:function(t){if(void 0!==this._value)t(this._value);else var e,i=this.listen(function(r,a){void 0===r||e||(e=!0,t(r,a),setTimeout(function(){i.dispose()},0))})}},{key:"dbgObserve",value:function(){this.listen(function(t,e){s.default.log("Value: ",e,"->",t)})}},{key:"hasListeners",value:function(){return this._listeners&&this._listeners.length>0}},{key:"listen",value:function(t){return this._listeners||(this._listeners=[]),this._listeners.push(t),new u.a(this,t)}},{key:"unlisten",value:function(t){this._listeners&&this._listeners.remove(t)}},{key:"notify",value:function(t,e,i){0===arguments.length&&(t=this._value,e=this._value,i=!0);var r=this._listeners;if(r&&r.length>0&&(t!==e||!0===i)){var a=0;0;for(var n=0;n<r.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;!1===(0===arguments.length?r[n](this._value,void 0,i):r[n](t,e,i))&&(r.splice(n,1),n--)}0}}}]),t}();e.a=h},,,function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(17),s=i.n(u),h=i(9),d=i.n(h),c=i(18),v=i.n(c),y=i(0),g=i(1),l=i(3),p=i(39),m=i(2),f=i(71),k=i(20),A=i(76),S=function(t){function e(){return a()(this,e),s()(this,d()(e).apply(this,arguments))}return v()(e,t),o()(e,[{key:"init",value:function(){this.createObservables({isLoading:!1})}},{key:"getElement",value:function(){return f.findDOMNode(this)}},{key:"onClick",value:function(t){this.isLoading.get()||!1===this.props.enabled||(this.props.onClick||this.props.onMouseDown)(t,this.onButtonClickCallback)&&this.isLoading.set(!0)}},{key:"onMouseDown",value:function(t){if(!1!==this.props.enabled&&t.button===g.a.ButtonCode.Left&&this.props.onHold){var e={target:t.target,preventDefault:t.preventDefault};this._holdTimeout=setTimeout(this.onHold,150,e)}}},{key:"onMouseUp",value:function(t){this._clearHoldTimeout(),this.props.onMouseUp&&this.props.onMouseUp(t)}},{key:"onHold",value:function(t){this._clearHoldTimeout(),this.props.onHold(t)}},{key:"_clearHoldTimeout",value:function(){this._holdTimeout&&(clearTimeout(this._holdTimeout),this._holdTimeout=0)}},{key:"onKeyDown",value:function(t){t.keyCode===g.a.KeyCode.Enter&&this.onClick(t)}},{key:"focus",value:function(){this.getElement().focus()}},{key:"onButtonClickCallback",value:function(){this.isLoading.set(!1)}},{key:"removeRipple",value:function(){this.ripples.removeAt(0)}},{key:"render",value:function(){var t,e=this.state,i=this.props,r=!1===i.enabled;i.color?t=i.color:i.primary?t=i.raised?"c-button-raised-primary":"c-button-primary":i.heavy?i.raised||(t="c-button-heavy"):t=i.cancel?i.raised?"c-button-raised-cancel":"c-button-cancel":i.raised?"c-button-raised":"c-button";var a={display:i.display,lineHeight:i.height?"auto"===i.height?null:i.height+"px":"36px",height:i.height,width:i.width,textAlign:"center",margin:i.margin,paddingLeft:i.paddingLeft,paddingTop:i.paddingTop,paddingRight:i.paddingRight,paddingBottom:i.paddingBottom,fontWeight:i.fontWeight,fontSize:i.fontSize,color:i.color};void 0===i.margin&&(a.marginLeft=i.marginLeft,a.marginTop=i.marginTop,a.marginRight=i.marginRight,a.marginBottom=i.marginBottom),a=y.default.extend(a,this.props.style),i.raised&&!i.children&&i.icon&&!1!==i.round&&(a.borderRadius="50%");var n,o={fontSize:i.fontSize};if(i.icon){var u={height:i.height,fontSize:i.iconSize,color:i.color},s=y.default.classNames("fancyButtonIcon",i.icon,{"c-button":!l.a.isMobile&&!!i.color});i.children?0!==i.padding&&(o.paddingLeft="6px",o.paddingRight=0,a.paddingLeft="16px",a.paddingRight="16px"):(a.width=i.width||36,a.height=i.height||36,a.maxWidth=i.height||36,a.maxHeight=i.height||36,a.textAlign="center"),n=m.createElement("i",{className:s,style:u})}isNaN(i.padding)||(o.padding="0 "+i.padding+"px");var h=i.children&&m.Children.count(i.children)>0,d=y.default.classNames("fancyButtonText"),c=h&&m.createElement("div",{className:d,style:o},i.children),v=y.default.classNames("fancyButton",t,{raised:i.raised},{loading:e.isLoading},{primary:i.primary},{cancel:i.cancel},{hasText:h},{hasIcon:!!i.icon},{disabled:r},{selected:i.selected},i.className),g=e.isLoading&&m.createElement("div",{className:"fancyButtonLoading"},m.createElement("i",{className:"icon-spinner"})),f=i.tooltipHotkey,k=f?y.default.isString(f)?f:p.a.printHotkeyByName(f.name,f.group):void 0;return m.createElement(A.a,{className:v,style:a,enabled:i.enabled,onMouseEnter:l.a.isMobile?void 0:i.onMouseEnter,onMouseLeave:l.a.isMobile?void 0:i.onMouseLeave,onMouseDown:!l.a.isMobile&&i.onMouseDown&&this.onClick||i.onHold&&this.onMouseDown||void 0,onMouseUp:l.a.isMobile||!i.onHold&&!i.onMouseUp?void 0:this.onMouseUp,onClick:i.onClick?this.onClick:void 0,onDoubleClick:i.onDoubleClick,onRightClick:i.onRightClick,onKeyDown:this.onKeyDown,id:i.id,center:i.center||!!i.icon&&!h,ripple:i.ripple,tabIndex:i.tabIndex,"data-tooltip":!r&&i.tooltip?i.tooltip:null,"data-tooltiphotkey":r?null:k},n,c,g)}}]),e}(k.a);e.a=S},function(t,e,i){"use strict";var r,a,n=i(38),o=i.n(n),u=i(7),s=i.n(u),h=i(8),d=i.n(h),c=i(15),v=i.n(c),y=i(0),g=i(1),l=i(4),p=i(3),m=i(10),f=i(25),k=i(26),A=i(19),S=i(63),w=i(16),L=i(51),F=new(r=function(){function t(){s()(this,t),this.dataCache={},this.itemCache={},this.documents=[],this.isLoaded=!1,this._demoId=1}return d()(t,[{key:"init",value:function(t,e){var r=this,a=i(151).default,n=A.a.getURLParam("data"),u=n.split(","),s=[],h=0,d=o()({},k.a.getUid(),{e:k.a.getDefaultAccountID(),t:k.a.getAccountName(),r:g.a.DocumentAccessRoles.Admin});this.loadDemoContacts(["Jay","Grant","Ramada","Canyon Ranch","Jim Joseph","Miller Harris","Bob Johnson","Bill Wilson","Emily Edwards","Jane Johnson","Mike Thomas","Joe Lewis","Steve","Melissa","Mikey","Bart","Dad","Mom","James Rhodes","Neptures","Pepper","President Ellis","Contacts","Jane"]),a.areRemoteFunctionsHooked()||a.hookRemoteFunctions();var c=function(e,a){var n,o;if(a&&(n=a[0],o=a[1]),o&&i(106).default.setPluginData(o),n){!function t(e){e.id||(e.id="demo"+h++),r.dataCache[e.id]=e;var i=e.note;i&&(i.id||(i.id="demo"+h++),t(i),e.note=i.id);var a=e.items;if(a){for(var n=0,o=[],u=0;u<a.length;++u){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=a[u];s.id||(s.id="demo"+h++),s.index=u,o.push(s.id),t(s)}e.items=o}}(n),r.isLoaded=!0;var c=new S.a({id:e,text:e,dateModified:Date.now(),rootData:n,acl:d,backing:r});c.createVMLIs(),s.push(c),s.length===u.length&&(r.documents=s,t(s,r.dataCache))}};if(n&&u.length>0)u.forEach(function(t){a.loadRemoteData(t,c.bind(r,t))});else{try{y.default.PAssert(584,!1,"Test data must be defined using #data=XXX.YYY in URL")}catch(p){y.default.reportError(p)}var v={text:g.a.RootItemName,items:[]},l=new S.a({id:"Failed",text:"Failed",dateModified:Date.now(),rootData:v,acl:d,backing:this});c("Failed",[l])}}},{key:"loadDemoContacts",value:function(t){var e=0,i=[],r=0;function a(t){var e="test-"+t.split(" ")[0].toLowerCase()+"@moo.do";i.push({id:"contact_"+r++,name:t,isDemo:!0,emails:[{address:e,primary:!0}],phoneNumbers:[{number:"(555) 123-4567",type:"mobile"}]})}for(var n=0;n<t.length;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;a(t[n])}L.a.loadContacts(i)}},{key:"getItemData",value:function(t){return this.dataCache[t]}},{key:"saveItem",value:function(t,e,i,r,a){var n=this.dataCache[e.id]||{};return Object.assign(n,i),this.dataCache[e.id]=n,Promise.resolve()}},{key:"deleteItem",value:function(t,e,i){var r=e.parent();this.saveItem(t,r,void 0,g.a.ChangeType.Local,g.a.SaveFlag.Prop),delete this.dataCache[e.id]}},{key:"addItem",value:function(t,e,i,r){this.saveItem(t,e,void 0,g.a.ChangeType.Local,g.a.SaveFlag.Prop),this.saveItem(t,i,void 0,g.a.ChangeType.Local,g.a.SaveFlag.Prop)}},{key:"moveItem",value:function(t,e){this.saveItem(t,e,void 0,g.a.ChangeType.Local,g.a.SaveFlag.Prop)}},{key:"setNote",value:function(t,e,i,r,a){this.saveItem(t,e,void 0,g.a.ChangeType.Local,g.a.SaveFlag.Prop),i?this.saveItem(t,i,void 0,g.a.ChangeType.Local,g.a.SaveFlag.Prop):delete this.dataCache[i.id]}},{key:"addDocument",value:function(t){var e=t.getRootItem();return this.documents.push(t),this.saveItem(t,e,void 0,g.a.ChangeType.Local,g.a.SaveFlag.Prop)}},{key:"saveDocument",value:function(t){}},{key:"getSetting",value:function(t){return""}},{key:"setSetting",value:function(t,e){}},{key:"saveBoard",value:function(t){}},{key:"deleteBoard",value:function(t){}},{key:"generateId",value:function(){return""+this._demoId++}}]),t}(),v()(r.prototype,"generateId",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"generateId"),r.prototype),r),C=i(58),I=i(104),P=i(50),N=i(49),H=i(33),M=i(121),z=(a=function(){function t(){s()(this,t),this.isLoaded=new m.a(!1),this._isRemoteEnabled=!y.default.isDemoMode(),this._documentsById={},this._itemCache={},this.documentsArray=new H.a,this.documentsEncryptedArray=new H.a,this._sources=y.default.isDemoMode()?[F]:[C.a],this._idProvider=y.default.isDemoMode()?F.generateId:C.a.generateId,this.settingProvider=C.a,this.loadState=C.a.loadState,this.onlineStatus=new m.a(p.a.isPlatformOnline()?g.a.OnlineStatus.Connecting:g.a.OnlineStatus.Offline)}return d()(t,[{key:"init",value:function(){this._emptyDocument=this.createEmptyDocument("Empty"),p.a.isMobile||(window.__clearLocalData=this.clearLocalData)}},{key:"loadLocal",value:function(t){var e=this;this._emptyDocument.createVMLIs(),this._cbOnLoad=t,this._sourcesWaiting=this._sources.length,this._sources.forEach(function(t){return t.init(e.onSourceLoaded,e.onSourceDocumentsChanged)}),this._isRemoteEnabled&&I.a.init()}},{key:"onSourceLoaded",value:function(t){var e=this;this._sourcesWaiting--,t.forEach(function(t){e._documentsById[t.id]=t,e.documentsArray.push(t,!1)}),0===this._sourcesWaiting&&(this.documentsArray.sort(S.a.comparatorModified),l.default.PaneManager.loadInitialState(),this.isLoaded.set(!0),this._cbOnLoad(t))}},{key:"onSourceDocumentsChanged",value:function(t,e){var i=this,r=this.documentsArray.get();Object.keys(t).forEach(function(e){var a=t[e];i._documentsById[a.id]||(i._documentsById[a.id]=a,r.push(a))}),r.sort(S.a.comparatorModified),this.documentsArray.set(r),this.documentsEncryptedArray.set(Object.keys(e).map(function(t){return e[t]}))}},{key:"getDefaultBacking",value:function(){return this._sources[0]}},{key:"getDocumentById",value:function(t){return this._documentsById[t]}},{key:"getDefaultDocument",value:function(){return this.documentsArray.get().length>0?this.documentsArray.get()[0]:this.addEmptyDocument("My First Document",!1)}},{key:"getDocumentsArray",value:function(){return this.documentsArray.get()}},{key:"hasDocuments",value:function(){return this.documentsArray.get().length>0}},{key:"runOnAllDocuments",value:function(t){this.documentsArray.get().forEach(function(e){return t(e)})}},{key:"runOnAllDocumentRoots",value:function(t){this.documentsArray.get().forEach(function(e){return t(e.getRootItem())})}},{key:"getItemDataLocal",value:function(t,e){return t.getBacking().getItemData(e)}},{key:"getDocumentBacking",value:function(t){return t.getBacking()}},{key:"getItemBacking",value:function(t){var e=t.getDocumentOwner();try{y.default.PAssert(234,e,"Item document must exist")}catch(i){y.default.reportError(i)}return e.getBacking()}},{key:"_getPreviousState",value:function(t,e){try{y.default.PAssert(235,t.getDocumentOwner(),"Missing document owner",t.getRawText())}catch(a){y.default.reportError(a)}var i=t.getDocumentOwner().getBacking().getItemData(t.id),r={};return i&&Object.keys(e).forEach(function(t){r[t]=i[t]}),r}},{key:"saveItem",value:function(t,e,i,r,a){var n=t.parent()||t.isRoot;try{y.default.PAssert(236,n,"Item must have parent unless root")}catch(u){y.default.reportError(u)}if(n&&(e=this._transformChange(t,e),y.default.isLocalChange(i)&&P.a.pushModified(t,e,this._getPreviousState(t,e)),t.shouldSave())){var o=t.getDocumentOwner();o.getBacking().saveItem(o,t,y.default.clone(e),i,r),y.default.isDemoMode()||I.a.onDataSaved(o)}}},{key:"saveItemRemote",value:function(t,e){var i=t.getDocumentOwner();i.getBacking().saveItem(i,t,e,g.a.ChangeType.Local,g.a.SaveFlag.Prop)}},{key:"saveItemLocal",value:function(t,e,i){e||(e=t.getFullSaveData()),f.a.saveItem(t,e)}},{key:"_transformChange",value:function(t,e){return e.dateModified=Date.now(),e.id=t.id,e}},{key:"updateItemIndex",value:function(t){var e=t.parent();if(!t.isNote())if(e.items.length()>1){var i=e.items.get(),r=i.indexOf(t),a=!t.isNote()&&r>0?i[r-1]:null,n=!t.isNote()&&r<i.length-1?i[r+1]:null;0,t.index=Object(M.a)(a?a.index:null,n?n.index:null)}else t.index="0"}},{key:"addItem",value:function(t,e,i){if(!(arguments.length>3&&void 0!==arguments[3]&&arguments[3])){this.updateItemIndex(e),P.a.pushAdded(t,e,i);var r=e.getDocumentOwner();r.getBacking().addItem(r,t,e,i)}}},{key:"deleteItem",value:function(t,e,i,r,a){if(y.default.isLocalChange(r)){P.a.pushRemoved(t,e,i);var n=e.getDocumentOwner();n.getBacking().deleteItem(n,e,r)}}},{key:"moveItem",value:function(t,e,i,r){if(this.updateItemIndex(t),y.default.isLocalChange(r)){var a={parent:t.parent().id,index:t.index},n={parent:e.id,index:i};P.a.pushModified(t,a,n);var o=t.getDocumentOwner();o.getBacking().moveItem(o,t)}}},{key:"attachEventsToItem",value:function(t){}},{key:"setNote",value:function(t,e,i,r){var a=t.getDocumentOwner();a.getBacking().setNote(a,t,e,i,r)}},{key:"generateID",value:function(){return this._idProvider()}},{key:"getEmptyDocument",value:function(){return this._emptyDocument}},{key:"addDocument",value:function(t,e){t.createVMLIs();var i=e?Promise.resolve():this._sources[0].addDocument(t);return this._documentsById[t.id]=t,this.documentsArray.push(t,!1),this.documentsArray.sort(S.a.comparatorModified),i}},{key:"createEmptyDocument",value:function(t){var e=this.getDefaultBacking(),i=this.generateID(),r={id:this.generateID(),isRoot:!0,text:"Root",items:[]};return new S.a({id:i,text:t,dateModified:Date.now(),rootData:r,acl:o()({},k.a.getUid(),{t:k.a.getAccountName(),e:k.a.getDefaultAccountID(),r:g.a.DocumentAccessRoles.Admin}),backing:e})}},{key:"addEmptyDocument",value:function(t,e,i){var r=this.createEmptyDocument(t);return r.needsSave=!0,this.addDocument(r,e).then(function(){return i&&i()}),r}},{key:"saveDocument",value:function(t){t.getBacking().saveDocument(t)}},{key:"renameDocument",value:function(t,e){t.setText(e),t.needsSave?(t.needsSave=!1,this._sources[0].addDocument(t)):this.saveDocument(t)}},{key:"getSetting",value:function(t,e){return f.a.getSetting(e+"\\"+t)}},{key:"setSetting",value:function(t,e,i){i?this.settingProvider.setSetting(t,e):f.a.setSetting(t,{v:e})}},{key:"saveBoard",value:function(t){this.settingProvider.saveBoard(t)}},{key:"deleteBoard",value:function(t){return f.a.deleteBoard(t),this.settingProvider.deleteBoard(t)}},{key:"getBoards",value:function(){return f.a.getBoards()}},{key:"setItem",value:function(t){this._itemCache[t.id]=t}},{key:"getItem",value:function(t){return this._itemCache[t]}},{key:"clearItem",value:function(t){delete this._itemCache[t]}},{key:"createVMLI",value:function(t,e){return l.default.itemStoreManager.getDefaultItemStore().createItemRaw(t,e)}},{key:"createTempVMLI",value:function(t,e){return e.noSave=!0,e.canDestroy=!0,e.isTemp=!0,l.default.itemStoreManager.getTempItemStore().createItemRaw(t,e)}},{key:"destroyTempVMLI",value:function(t){l.default.itemStoreManager.getTempItemStore().destroyItem(t)}},{key:"clearLocalData",value:function(){return N.a.clear(),f.a.clearAllData().then(function(){y.default.reload()})}},{key:"deleteDocument",value:function(t,e){delete this._documentsById[t.id],this.documentsArray.remove(t),f.a.deleteDocument(t),e||C.a.deleteDocument(t)}},{key:"hasPendingRemoteUpdates",value:function(){return Object.keys(C.a.itemsPending).length>0}},{key:"isOnline",value:function(){return this.onlineStatus.get()===g.a.OnlineStatus.Online}},{key:"__clearAllData",value:function(){confirm("Are you sure you want to clear everything?")&&(N.a.clear(),Promise.all([f.a.clearAllData(),C.a.clearAllData()]).then(function(){y.default.reload()}))}}]),t}(),v()(a.prototype,"onSourceLoaded",[w.a],Object.getOwnPropertyDescriptor(a.prototype,"onSourceLoaded"),a.prototype),v()(a.prototype,"onSourceDocumentsChanged",[w.a],Object.getOwnPropertyDescriptor(a.prototype,"onSourceDocumentsChanged"),a.prototype),v()(a.prototype,"clearLocalData",[w.a],Object.getOwnPropertyDescriptor(a.prototype,"clearLocalData"),a.prototype),v()(a.prototype,"__clearAllData",[w.a],Object.getOwnPropertyDescriptor(a.prototype,"__clearAllData"),a.prototype),a);e.a=new z},,,,,function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(17),s=i.n(u),h=i(9),d=i.n(h),c=i(18),v=i.n(c),y=function(){function t(){a()(this,t),this.storage={getItem:function(){console.log("refactor this")},setItem:function(){console.log("refactor this")}}}return o()(t,[{key:"extendPrototype",value:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t.prototype[i]=e[i])}},{key:"extendClass",value:function(t,e,i){for(var r=0,a=Object.getOwnPropertyNames(e.prototype),n=0;n<a.length;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=a[n];i&&t[o]||(t.prototype[o]=e.prototype[o])}}},{key:"defineBase",value:function(t){t.prototype.constructor=t}},{key:"extend",value:function(t,e,i,r){if(e)for(var a in e)if(e.hasOwnProperty(a)&&(!r||!t[a])){var n=e[a],o=i&&n&&n.bind?n.bind(t):n;t[a]=o}return t}},{key:"inherit",value:function(t,e){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.prototype._super=t.prototype}},{key:"binder",value:function(t){var e=0;for(var i=0;i<(arguments.length<=1?0:arguments.length-1);i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=i+1<1||arguments.length<=i+1?void 0:arguments[i+1];t[r]=t[r].bind(t)}}},{key:"forceBind",value:function(t,e){var i=e[t].bind(e);return e[t]=i,i}},{key:"destroy",value:function(t){}}]),t}(),g=i(1).a.URLPart,l={demo:g.Hash,login:g.Hash,user:g.Hash,premium:g.Hash,ispremium:g.Hash,access_token:g.Hash,error:g.Hash,expires_in:g.Hash,expires_at:g.Hash,issued_at:g.Hash,scope:g.Hash,token_type:g.Hash,id_token:g.Hash,data:g.Hash,script:g.Hash,dmode:g.Hash,jasmine:g.Hash,touch:g.Hash,noverify:g.Hash,file:g.Hash,sinfo:g.Hash,panes:g.Hash,offline:g.Hash,live:g.Hash,test:g.Hash,nolocal:g.Hash,nosync:g.Hash,rdebug:g.Hash,rsession:g.Hash,versionError:g.Hash,invite:g.Hash,state:g.Search};function p(t,e){t===g.Search?window.location.search=e:t===g.Hash&&(window.location.hash=e)}function m(t){return t===g.Search?window.location.search:t===g.Hash?window.location.hash:void 0}function f(t){return l[t]}var k=function(t){function e(){return a()(this,e),s()(this,d()(e).call(this))}return v()(e,t),o()(e,[{key:"hasURLParam",value:function(t,e){var r=t+"=";e&&(r+=e);var a=f(t);return a||i(0).default.log("Invalid URL Part"),m(a).indexOf(r)>=0}},{key:"getURLParam",value:function(t,e){var r=e||f(t);if(r===g.Search){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp('[\\?&]" + key + "=([^&#]*)').exec(window.location.href);return null===a?void 0:decodeURIComponent(a[1].replace(/\+/g," "))}if(r!==g.Hash)i(0).default.log("Invalid URL part");else for(var n,o=0,u=m(g.Hash).substring(1),s=/([^&=]+)=([^&]*)/g;n=s.exec(u);){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(decodeURIComponent(n[1])===t)return decodeURIComponent(n[2])}}},{key:"insertURLParam",value:function(t,e,i){var r=0;t=encodeURIComponent(t),e=encodeURIComponent(e);for(var a=f(t),n=m(a).substr(1).split("&"),o=n.length-1;o>=0;o--){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=n[o].split("=");if(u[0]==t){u[1]=e,n[o]=u.join("=");break}}o<0&&(n[n.length]=[t,e].join("=")),p(a,n.join("&")),a!==g.Hash||i||window.location.reload()}},{key:"removeURLParam",value:function(t,e){for(var i=0,r=f(t=encodeURIComponent(t)),a=m(r).substr(1).split("&"),n=a.length-1;n>=0;n--){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a[n].split("=")[0]==t){a.splice(n,1),p(r,a.join("&")),r!==g.Hash||e||window.location.reload();break}}}},{key:"genPromise",value:function(t){t.then=function(t,e,i){},t.execute=function(t,e,i){}}}]),e}(y);e.a=new k},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(17),s=i.n(u),h=i(9),d=i.n(h),c=i(18),v=i.n(c),y=i(37),g=i.n(y),l=i(43),p=i.n(l),m=i(0),f=i(19),k=i(1),A=i(4),S=i(2),w=i(39),L=i(10),F=i(33),C=i(21),I=i(55),P=i(71),N=i(289),H=i.n(N),M={addTap:function(t,e,i){var r=this.refs[t];try{m.default.PAssert(1198,r,"Invalid refName to add tap to: ",t)}catch(a){m.default.reportError(a)}r&&m.default.setupClick(r,e,i)},refElement:function(t){var e=this.refs[t];return m.default.isDOMNode(e)?e:P.findDOMNode(e)}},z=function(t){return function(e){try{m.default.PAssert(1199,!e.mixins,"Should not supply separate mixins value")}catch(i){m.default.reportError(i)}try{m.default.PAssert(1200,e.displayName,"Must always specify displayName for react components")}catch(i){m.default.reportError(i)}e.mixins=[t];return!0,H()(e)}};i.d(e,"a",function(){return Y});var D={},V=0;function G(t,e){return t===e?0!==t||1/t===1/e:t!==t&&e!==e}function T(t,e,i){var r=0;if(G(t,e))return!0;if("object"!==p()(t)||null===t||"object"!==p()(e)||null===e)return!1;var a,n=Object.keys(t),o=Object.keys(e);if(n.length!==o.length)return!1;for(var u=0;u<n.length;u++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(a=void 0,!hasOwnProperty.call(e,n[u]))return!1;if(i&&!1===(a=i(n[u],t[n[u]],e[n[u]])))return!1;if(void 0===a&&!G(t[n[u]],e[n[u]]))return!1}return!0}var q={shouldComponentUpdate:function(t,e){return!T(this.props,t,this.arePropsEqual)||!T(this.state,e,this.areStatesEqual)},getInitialState:function(){this.init&&this.init();var t=this.getState?this.getState(this.props):{};this._observables&&(t=m.default.extend(t,this._observables));var e=null;return t&&(this.setupListeners(t),e=this.transformState(t)),e},createObservables:function(t){try{m.default.PAssert(598,!this._listeners,"You have to run createObservables in init()")}catch(r){m.default.reportError(r)}for(var e in t)if(t.hasOwnProperty(e)){var i=t[e];m.default.isArray(i)?t[e]=new F.a(i):t[e]=new L.a(i);try{m.default.PAssert(599,!this.hasOwnProperty(e),"Must not multi-define observable properties")}catch(r){m.default.reportError(r)}this[e]=t[e]}try{m.default.PAssert(600,!this.hasOwnProperty("_observables"),"Must not define an _observables property and use createObservables")}catch(r){m.default.reportError(r)}this._observables=t},addObservable:function(t,e){e=m.default.isArray(e)?new F.a(e):new L.a(e),this[t]=e,this._observables[t]=e,this._addListener(e.listen(this.onListener))},_addListener:function(t){try{m.default.PAssert(601,t&&t.target,"Must add a valid listener")}catch(e){m.default.reportError(e)}this._ensureListeners();try{m.default.PAssert(602,!this._hasListener(t.target),"Must not double register the same observable/trigger")}catch(e){m.default.reportError(e)}this._listeners.push(t)},refreshListeners:function(t){this.disposeListeners();var e=this.getState?this.getState(t||this.props):{};this._observables&&(e=m.default.extend(e,this._observables)),e&&this.setupListeners(e)},_ensureListeners:function(){this._listeners||(this._listeners=[],this._permanentListeners=[])},setupListeners:function(t){for(var e in this._ensureListeners(),t||(t=this.getState?this.getState(this.props):{}),t)if(t.hasOwnProperty(e)){var i=t[e];i instanceof L.a&&this._addListener(i.listen(this.onListener))}},disposeListeners:function(t){if(this._listeners){for(var e=0,i=0;i<this._listeners.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._listeners[i].dispose()}if(this._listeners=[],t){var r=0;for(i=0;i<this._permanentListeners.length;++i){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this._permanentListeners[i].dispose()}}}t&&this.disposeDispatcherListeners()},disposeDispatcherListeners:function(){if(this._dispatcherListeners){for(var t=0,e=0;e<this._dispatcherListeners.length;e++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this._dispatcherListeners[e],r=i[0],a=i.slice(1);r.unlisten.apply(r,a)}this._dispatcherListeners=[]}},listenTo:function(t,e){try{m.default.PAssert(603,t&&(t instanceof I.a||t instanceof L.a),"Can only listen to an Observable or a Trigger object")}catch(r){m.default.reportError(r)}if(t instanceof I.a||t instanceof L.a){var i=t.listen(this.onListener);!1!==e?this._addListener(i):this._permanentListeners.push(i)}},listenToDispatcher:function(){this._dispatcherListeners||(this._dispatcherListeners=[]);var t,e=Array.prototype.slice.call(arguments);m.default.isString(e[0])?t=C.a:(t=e[0],e.splice(0,1)),e.push(this.onListener),t.listen.apply(t,e);var i=[t].concat(e);this._dispatcherListeners.push(i)},_hasListener:function(t){var e=0;try{m.default.PAssert(604,t,"Must have a valid target")}catch(a){m.default.reportError(a)}for(var i=!1,r=0;r<this._listeners.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(this._listeners[r].target===t){i=!0;break}}return i},_getState:function(t){var e=this.getState?this.getState(t||this.props):{};return this._observables&&(e=m.default.extend(e,this._observables)),this.transformState(e)},transformState:function(t){for(var e in t)if(t.hasOwnProperty(e)){var i=t[e];i&&i instanceof L.a&&(t[e]=i.get(),i instanceof F.a&&(t[e+"_arrVer"]=i.version))}return t},onListener:function(){this.updateState()},updateState:function(t){try{m.default.PAssert(606,this._isMounted,"updateState called on a component that is not yet mounted:",this.constructor&&this.constructor.displayName)}catch(a){m.default.reportError(a)}if(this._isMounted){var e=this.state,i=this._getState(t);if(this.onBeforeChanged){var r=this.onBeforeChanged(i,e,t);void 0!==r&&(i=r)}!1!==i&&(this.setState(i),this.onAfterChanged&&this.onAfterChanged(i,e))}},componentWillUnmount:function(){this.disposeListeners(!0),this.__hotkeys&&(w.a.popStack(this.__hotkeys),this.__hotkeys=void 0),this.onUnmount&&this.onUnmount(this.state),this._isMounted=!1},getChildByKey:function(t){var e;return S.Children.forEach(this.props.children,function(i){i&&i.key===t&&(e=i)}),e},componentDidMount:function(){this._isMounted=!0,this.getHotkeys?this.__hotkeys=w.a.pushStack(this.getHotkeys()):this.onEscapeKey&&(this.__hotkeys=w.a.pushStackEscape(this.onEscapeKey)),this.onMount&&this.onMount()},getUniqueID:function(){return this.props["data-moo-id"]?this.props["data-moo-id"]:(this.__id||(this.__id="m_"+V++),this.__id)},componentDidCatch:function(t,e){this.onComponentError&&this.onComponentError(t,e),m.default.reportError(t,e,void 0,"React Component Error: "),A.default.toasts.pushMessage(k.a.MessageID.ReactError)}};M&&f.a.extend(q,M),z&&(D.createClass=z(q));var j={constructor:!0,componentWillMount:!0,render:!0,componentDidMount:!0,componentWillReceiveProps:!0,shouldComponentUpdate:!0,componentWillUpdate:!0,componentDidUpdate:!0,componentWillUnmount:!0},Y=function(t){function e(t){var i;a()(this,e),i=s()(this,d()(e).call(this,t));var r=Object.getPrototypeOf(g()(g()(i))),n=Object.getOwnPropertyNames(r).concat(Object.getOwnPropertyNames(r.__proto__)),o=[g()(g()(i))].concat(m.default.arrayDifference(n,j));return f.a.binder.apply(f.a,o),i.state=i.getInitialState(),i}return v()(e,t),o()(e,[{key:"getInitialState",value:function(){return{}}}]),e}(S.Component);f.a.extend(Y.prototype,q);e.b=D},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(17),o=i.n(n),u=i(9),s=i.n(u),h=i(18),d=i.n(h),c=function(t){function e(){return a()(this,e),o()(this,s()(e).apply(this,arguments))}return d()(e,t),e}(i(68).a);e.a=new c},function(t,e,i){"use strict";i.r(e);var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(0),s=i(3),h=function(){function t(e){a()(this,t),this._range=e,this._range||(this._range=i(22).default._getSelectionRange())}return o()(t,[{key:"isValid",value:function(){return!!this._range}},{key:"getNativeRange",value:function(){return this._range}},{key:"getStartContainer",value:function(){return this._range.startContainer}},{key:"getEndContainer",value:function(){return this._range.endContainer}},{key:"getStartElement",value:function(){return u.default.getElementParent(this.getStartContainer())}},{key:"getEndElement",value:function(){return u.default.getElementParent(this.getEndContainer())}},{key:"getSelectOffsetsInElement",value:function(t){return i(22).default.getSelectOffsetsInElement(t,this._range)}},{key:"getStartOffset",value:function(){return this._range.startOffset}},{key:"getEndOffset",value:function(){return this._range.endOffset}}]),t}(),d=i(1),c=function(){function t(){a()(this,t)}return o()(t,[{key:"createFakeRange",value:function(t,e,i,r){try{var a=this.createSelectionRange();return a.setStart(t,e),a.setEnd(i,r),new h(a)}catch(n){u.default.reportError(n)}}},{key:"createSelectionRange",value:function(){return document.createRange()}},{key:"setSelection",value:function(t,e,i,r,a){if("TEXTAREA"===t.nodeName){try{u.default.PAssert(359,t===i,"Cannot multiselect textareas")}catch(o){u.default.reportError(o)}t.focus(),t.selectionStart=e,t.selectionEnd=r,s.a.isMobile&&!a&&s.a.android&&setTimeout(this.setSelection.bind(this,t,e,i,r,!0),0)}else{var n=this.createSelectionRange();this.setSelectionValues(n,t,e,i,r),this.setSelectionRange(n)}}},{key:"setSelectionRange",value:function(t){var e=window.getSelection();u.default.shouldLog(d.a.LogLevels.Selection)&&u.default.log("Set Selection to Range",t),e.removeAllRanges(),t instanceof h&&(t=t.getNativeRange()),e.addRange(t)}},{key:"insertNode",value:function(t){var e=this._getSelectionRange();e&&e.insertNode(t)}},{key:"selectAfterNode",value:function(t){var e=document.createRange();e.setStartAfter(t),this.setSelectionRange(e)}},{key:"setSelectionRangeToWhatItAlreadyIs",value:function(){var t=this._getSelectionRange();u.default.shouldLog(d.a.LogLevels.Selection)&&u.default.log("Set Selection to Same",t),t&&this.setSelectionRange(t)}},{key:"hasValidSelection",value:function(){return this.getSelectionRange(!0).isValid()||s.a.android&&document.activeElement&&"TEXTAREA"===document.activeElement.nodeName}},{key:"getSelectionRange",value:function(t){var e;return t&&(e=this._getSelectionRange()),new h(e)}},{key:"_getSelectionRange",value:function(){var t,e=window.getSelection();return e.rangeCount>0&&(t=e.getRangeAt(0)),t}},{key:"getSelectionNode",value:function(){var t=window.getSelection().anchorNode;if(t)return t.nodeType===Node.TEXT_NODE?t.parentNode:t}},{key:"getSelectedText",value:function(){return window.getSelection?window.getSelection().toString():document.selection&&"Control"!==document.selection.type?document.selection.createRange().text:void 0}},{key:"clearSelection",value:function(){var t=window.getSelection();u.default.shouldLog(d.a.LogLevels.Selection)&&u.default.log("Clear Selection"),t.removeAllRanges()}},{key:"hasSelection",value:function(){var t=this._getSelectionRange();return!(!t||t.startContainer===document.documentElement)&&(u.default.getPaneForElement(t.startContainer)&&u.default.findParent(t.startContainer,"paneContent"))}},{key:"hasRawSelection",value:function(){return!!window.getSelection().anchorNode}},{key:"getCursorSelectionRange",value:function(t){var e,i=t.target,r=u.default.ensureDOMNode(t.target);if(r){var a=u.default.getElementParent(i),n=0,o=u.default.getItemForElement(i),s=u.default.getPaneObjectForElement(i);try{u.default.PAssert(360,a,"getCursorSelectionRange must only be called when hovered item is item",r)}catch(g){u.default.reportError(g)}u.default.findParent(i,"line")||(r=a.firstElementChild,n=d.a.LineLeftPad+(!s.isBlockHeader&&o.hasPrefix()?d.a.PrefixWidth:0));var c=r.getBoundingClientRect(),v=u.default.clamp(t.clientY,c.top+9,c.bottom-9),y=u.default.clamp(t.clientX,c.left+n,c.right-1);e=this._getCursorSelectionRange(y,v)}return e?new h(e):void 0}},{key:"_getCursorSelectionRange",value:function(t,e){var i;if(document.caretRangeFromPoint)i=document.caretRangeFromPoint(t,e);else if(document.caretPositionFromPoint){var r=document.caretPositionFromPoint(t,e);r&&((i=document.createRange()).setStart(r.offsetNode,r.offset),i.setEnd(r.offsetNode,r.offset))}else if(document.body.createTextRange){var a=this._getSelectionRange(),n=document.body.createTextRange();try{n.moveToPoint(t,e),n.select(),i=this._getSelectionRange(),this.setSelectionRange(a)}catch(o){}}else try{u.default.PAssert(361,!1,"Unable to get selection range at cursor")}catch(s){u.default.reportError(s)}return i}},{key:"_getPreviousComponentNode",value:function(t){var e=t.previousSibling;return e&&!this._isComponentNode(e)&&1===e.childNodes.length&&this._isComponentNode(e.childNodes[0])&&(e=e.childNodes[0]),e}},{key:"_ensureSelectionInElement",value:function(t,e){try{u.default.PAssert(362,t,"Must have a valid element")}catch(d){u.default.reportError(d)}try{u.default.PAssert(363,e,"Must have a valid range")}catch(d){u.default.reportError(d)}if(u.default.isAncestor(e.startContainer,t)||e.setStart(t,0),u.default.isAncestor(e.endContainer,t)||e.setEnd(t,0),u.default.hasClass(e.startContainer,"textSelected")&&e.setStart(e.startContainer.parentElement.firstElementChild,e.startContainer.textContent.length),u.default.hasClass(e.endContainer,"textSelected")&&e.setEnd(e.endContainer.parentElement.firstElementChild,e.endContainer.textContent.length),u.default.hasClass(e.startContainer,"itemIgnoreText")){var i=this._getPreviousComponentNode(e.startContainer);i&&e.setStart(i,i.textContent.length)}if(u.default.hasClass(e.endContainer,"itemIgnoreText")){var r=this._getPreviousComponentNode(e.endContainer);r&&e.setEnd(r,r.textContent.length)}var a=u.default.getPluginForElement(e.startContainer);if(a){var n=a.textContent.length;!(s=a.nodeType===Node.TEXT_NODE)&&0===e.startOffset||s&&e.startOffset<n/2?e.setStartBefore(a):e.setStartAfter(a)}var o=u.default.getPluginForElement(e.endContainer);if(o){var s,h=o.textContent.length;!(s=o.nodeType===Node.TEXT_NODE)&&0===e.endOffset||s&&e.endOffset<h/2?e.setEndBefore(o):e.setEndAfter(o)}}},{key:"getSelectOffsetsInElement",value:function(t,e){var i={start:0,end:0,total:0};if("TEXTAREA"===t.nodeName){i.start=t.selectionStart,i.end=t.selectionEnd,i.total=t.value.length;var r=t.value.indexOf("\n");r>=0&&i.start>r&&(i.start--,i.end--,i.total--)}else if(t){try{u.default.PAssert(364,e,"Must provide a valid range")}catch(g){u.default.reportError(g)}if(e){this._ensureSelectionInElement(t,e);var a=this._getComponentNode(e.startContainer),n=e.startOffset,o=this._getComponentNode(e.endContainer),s=e.endOffset;!a||a.textContent!==d.a.TextSpace&&0!==a.textContent.length||(n=0),!o||o.textContent!==d.a.TextSpace&&0!==o.textContent.length||(s=0);var h=0,c=this._getComponentNodesIn(t);if(c.length>0)for(var v=0,y=0;y<c.length;++y){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;c[y]===a&&(i.start=h+n),c[y]===o&&(i.end=h+s),h+=this._getComponentNodeLength(c[y]),void 0===o&&(y===s-1?i.end=h:0===y&&0===s&&(i.end=0)),void 0===a&&(y===n-1?i.start=h:0===y&&0===n&&(i.start=0))}else i.start=0,i.end=0;i.total=h,isNaN(i.end)&&(i.end=h),i.start>i.total&&(i.start=i.total),i.end>i.total&&(i.end=i.total)}}try{u.default.PAssert(365,!isNaN(i.start)&&!isNaN(i.end),"Must have valid start and end",i)}catch(g){u.default.reportError(g)}return i}},{key:"getSelectOffsetsForMouseEvent",value:function(t){var e=u.default.getElementParent(t.target),i=this.getCursorSelectionRange(t);return i&&i.getSelectOffsetsInElement(e)}},{key:"getOffsetChildElement",value:function(t,e){try{u.default.PAssert(366,t,"Must supply a valid element")}catch(s){u.default.reportError(s)}if("TEXTAREA"===t.nodeName)return{element:t,offset:e};if(this._isComponentNode(t)){try{u.default.PAssert(368,this._isComponentSelectable(t),"Component must be selectable")}catch(s){u.default.reportError(s)}return{element:t,offset:e}}for(var i=0,r=0,a=this._getComponentNodesIn(t),n=0;n<a.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=this._getComponentNodeLength(a[n]);if(r+o>=e)return{element:a[n],offset:e-r};r+=o}try{u.default.PAssert(367,!1,"Unable to find offset child element")}catch(s){u.default.reportError(s)}}},{key:"getChildNodeOffset",value:function(t){var e=0;try{u.default.PAssert(369,t,"Must supply a valid child element")}catch(o){u.default.reportError(o)}for(var i=0,r=this._getComponentNodesIn(u.default.getElementParent(t)),a=this._getComponentNodesIn(t),n=0;n<r.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(r[n]===a[0])break;i+=this._getComponentNodeLength(r[n])}return i}},{key:"_getComponentNodeLength",value:function(t){try{u.default.PAssert(370,this._isComponentNode(t),"Supplied node must be a valid component")}catch(e){u.default.reportError(e)}return u.default.hasClass(t,"plugin")?1:u.default.hasClass(t,"mdImageWrapper")?0:1===t.length&&t.textContent===d.a.TextSpace?0:t.length}},{key:"_getComponentNodesIn",value:function(t){if(this._isComponentNode(t))return[t];var e=[];return this._getComponentNodes(e,t),e}},{key:"_isComponentNode",value:function(t){var e=!1;return t&&(t.nodeType===Node.TEXT_NODE&&!u.default.getPluginForElement(t)||u.default.hasClass(t,"plugin")||u.default.hasClass(t,"mdImageWrapper"))&&(e=!0),e}},{key:"_isComponentSelectable",value:function(t){try{u.default.PAssert(371,!t||this._isComponentNode(t),"Must either be an invalid node (not-selectable) or a component")}catch(i){u.default.reportError(i)}var e=!1;return t&&t.nodeType===Node.TEXT_NODE&&(e=!0),e}},{key:"_getComponentNodes",value:function(t,e){if(e)if(this._isComponentNode(e))t.push(e);else if(!u.default.hasClass(e,"itemTime")&&e.childNodes)for(var i=0,r=0;r<e.childNodes.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var a=e.childNodes[r];this._getComponentNodes(t,a)}}},{key:"_getComponentNode",value:function(t){var e;if(this._isComponentNode(t))e=t;else{var i=u.default.getPluginForElement(t);i&&(e=i)}return e}},{key:"setSelectionValues",value:function(t,e,i,r,a){try{u.default.PAssert(372,t,"Range must be supplied")}catch(n){u.default.reportError(n)}try{u.default.PAssert(373,this._isComponentNode(e),"Must be selecting a valid component")}catch(n){u.default.reportError(n)}try{u.default.PAssert(374,this._isComponentNode(r),"Must be selecting a valid component")}catch(n){u.default.reportError(n)}try{u.default.PAssert(375,e!==r||i<=a,"Select elements must be different, or selection must start before it ends")}catch(n){u.default.reportError(n)}if(e.nodeType===Node.TEXT_NODE)t.setStart(e,i);else{try{u.default.PAssert(376,u.default.hasClass(e,"plugin"),"Only other valid component is plugin")}catch(n){u.default.reportError(n)}try{u.default.PAssert(377,0===i||1===i,"Must eiter be selecting before or after the plugin")}catch(n){u.default.reportError(n)}0===i?this._selectBeforeComponent(t,e,"setStart"):1===i&&this._selectAfterComponent(t,e,"setStart")}if(r.nodeType===Node.TEXT_NODE)t.setEnd(r,a);else{try{u.default.PAssert(378,u.default.hasClass(r,"plugin"),"Only other valid component is plugin")}catch(n){u.default.reportError(n)}try{u.default.PAssert(379,0===a||1===a,"Must eiter be selecting before or after the plugin")}catch(n){u.default.reportError(n)}0===a?this._selectBeforeComponent(t,r,"setEnd"):1===a&&this._selectAfterComponent(t,r,"setEnd")}u.default.shouldLog(d.a.LogLevels.Selection)&&u.default.log("Set Selection: ["+i+","+a+"] - [",e+","+r+"]")}},{key:"_selectBeforeComponent",value:function(t,e,i){var r=this._getPrevComponent(e);if(this._isComponentSelectable(r))t[i](r,this._getComponentNodeLength(r));else{var a=document.createTextNode("");e.parentNode.insertBefore(a,e),t[i](a,0)}}},{key:"_selectAfterComponent",value:function(t,e,i){var r=this._getNextComponent(e);if(this._isComponentSelectable(r))t[i](r,0);else{var a=document.createTextNode("");e.parentNode.insertBefore(a,void 0),t[i](a,0)}}},{key:"_getPrevComponent",value:function(t){try{u.default.PAssert(380,t,"Must supply a valid node")}catch(i){u.default.reportError(i)}try{u.default.PAssert(381,this._isComponentNode(t),"Supplied node must be a valid component itself")}catch(i){u.default.reportError(i)}var e=t.previousSibling;try{u.default.PAssert(382,!e||this._isComponentNode(e),"Siblings must always be valid components")}catch(i){u.default.reportError(i)}return e}},{key:"_getNextComponent",value:function(t){try{u.default.PAssert(383,t,"Must supply a valid node")}catch(i){u.default.reportError(i)}try{u.default.PAssert(384,this._isComponentNode(t),"Supplied node must be a valid component itself")}catch(i){u.default.reportError(i)}var e=t.nextSibling;try{u.default.PAssert(385,!e||this._isComponentNode(e),"Siblings must always be valid components")}catch(i){u.default.reportError(i)}return e}},{key:"selectElement",value:function(t,e,i){var r;if(isNaN(i)&&(i=e),isNaN(e))(r=this.createSelectionRange()).selectNodeContents(t);else{var a=this.getOffsetChildElement(t,e),n=e!==i?this.getOffsetChildElement(t,i):a;a&&(r=this.createFakeRange(a.element,a.offset,n.element,n.offset))}r&&this.setSelectionRange(r)}},{key:"getSelectionInElement",value:function(t){var e=this._getSelectionRange();if(e&&u.default.isAncestor(e.startContainer,t)&&u.default.isAncestor(e.endContainer,t))return this.getSelectOffsetsInElement(t,e)}},{key:"deleteRangeContents",value:function(){var t=this._getSelectionRange();t&&t.deleteContents()}}]),t}();e.default=new c},function(t,e,i){"use strict";var r,a=i(7),n=i.n(a),o=i(8),u=i.n(o),s=i(17),h=i.n(s),d=i(9),c=i.n(d),v=i(18),y=i.n(v),g=i(15),l=i.n(g),p=i(0),m=i(4),f=i(3),k=i(68),A=i(10),S=i(33),w=i(16),L=(r=function(t){function e(){var t;return n()(this,e),(t=h()(this,c()(e).call(this))).selected={},t.numSelected=new A.a(0),t._queueRemoveEditables=[],t}return y()(e,t),u()(e,[{key:"_selectedObjForPane",value:function(t){try{p.default.PAssert(532,t,"Multiselect should always pass in a pane")}catch(i){p.default.reportError(i)}t=t||p.default.focusedPane;var e=this.selected[t.id];return e||(e=this.selected[t.id]={arr:new S.a,isInverted:!1},f.a.isMobile&&e.arr.listen(this.onChanged.bind(this,t))),e}},{key:"_selectedForPaneObs",value:function(t){return this._selectedObjForPane(t).arr}},{key:"_selectedForPane",value:function(t){return this._selectedObjForPane(t).arr.get()}},{key:"onChanged",value:function(t){this.numSelected.set(this.numSelectedInPane(t))}},{key:"isInverted",value:function(t){return this._selectedObjForPane(t).isInverted}},{key:"setInverted",value:function(t,e){this._selectedObjForPane(e).isInverted=t}},{key:"isSelected",value:function(t,e){return this._selectedForPane(e).indexOf(t)>=0}},{key:"getSelected",value:function(t){return this._selectedForPane(t)}},{key:"getSelectedItems",value:function(t,e){for(var i=0,r=this._selectedForPane(t),a=[],n=0;n<r.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=r[n];if(t.numItems()>o){var u=t.itemAtIndex(o);!u||!e&&u.isNote()||a.push(u)}}return a}},{key:"numSelectedInPane",value:function(t){for(var e=0,i=0,r=this._selectedForPane(t),a=0;a<r.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=t.itemAtIndex(r[a]);!n||n.isNote&&n.isNote()||i++}return i}},{key:"getFirstSelectedIndex",value:function(t){var e=0;t=t||p.default.focusedPane;for(var i=this._selectedForPane(t),r=Number.MAX_VALUE,a=!1,n=0;n<i.length;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=i[n];o<r&&(r=o,a=!0)}return a?r:-1}},{key:"getFirstSelectedItem",value:function(t){t=t||p.default.focusedPane;var e=this.getFirstSelectedIndex(t);if(e>=0)return t.itemAtIndex(e)}},{key:"getLastSelectedIndex",value:function(t){var e=0;t=t||p.default.focusedPane;for(var i=this._selectedForPane(t),r=-1,a=0;a<i.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=i[a];n>r&&(r=n)}return r}},{key:"getLastSelectedItem",value:function(t){t=t||p.default.focusedPane;var e=this.getLastSelectedIndex(t);if(e>=0)return t.itemAtIndex(e)}},{key:"_resetPaneID",value:function(t){var e=m.default.PaneManager,i=!0;if(e.isPaneActive(t)){var r=e.getPaneById(t);r.canResetMultiselect()?(this.setSelected([],r),this.selected[t].isInverted=!1):i=!1}else delete this.selected[t];return i}},{key:"reset",value:function(t){var e=!0;if(t)t.canResetMultiselect()?this._resetPaneID(t.id):e=!1;else for(var i in this.selected)this.selected.hasOwnProperty(i)&&(e=e&&this._resetPaneID(i));e&&this.fireEvent("reset",[t])}},{key:"clearEditables",value:function(t){for(var e=0,i=this.getSelectedItems(t),r=1===i.length?i[0]:void 0,a=0;a<this._queueRemoveEditables.length;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._queueRemoveEditables[a];n!==r&&(n.isEditable.set(!1),n.itemChanged.notify())}this._queueRemoveEditables=[]}},{key:"setSelected",value:function(t,e,i){var r=0;e=e||p.default.focusedPane;var a=this._selectedForPane(e),n=p.default.arrayDiff(a,t);this.setInverted(!1,e),this._selectedForPaneObs(e).set(t);for(var o=0;o<n.length;o++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=n[o];if(u<e.numItems()){var s=e.itemAtIndex(u);if(s){if(f.a.isMobile&&e.isWriteable)1===t.length&&t[0]===u?s.isEditable.set(!0):i?this._queueRemoveEditables.push(s):s.isEditable.set(!1);s.itemChanged.notify()}}}}},{key:"toggleSelected",value:function(t,e,i){e=e||p.default.focusedPane;var r=this._selectedForPaneObs(e),a=e.itemAtIndex(t),n=r.indexOf(t);n>=0&&!0!==i?(r.remove(t),a.itemChanged.notify()):n<0&&!1!==i&&(r.push(t),a.itemChanged.notify())}},{key:"addSelected",value:function(t,e){this.toggleSelected(t,e,!0)}},{key:"removeSelected",value:function(t,e){this.toggleSelected(t,e,!1)}},{key:"selectInOrder",value:function(t,e,i){var r=0;i=i||p.default.focusedPane;for(var a=[],n=t;n<=e;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;a.push(n)}this.setSelected(a,i)}},{key:"applyFnToSelected",value:function(t,e){var i=0;m.default.PaneUpdateBatcher.beginUpdateItems(),e=e||p.default.focusedPane;for(var r,a=this.getSelectedItems(e),n=0;n<a.length&&!1!==r;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r=t(a[n],n,a.length)}m.default.PaneUpdateBatcher.commitUpdateItems()}}]),e}(k.a),l()(r.prototype,"reset",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"reset"),r.prototype),r);e.a=new L},,function(t,e,i){"use strict";var r,a=i(144),n=i.n(a),o=i(7),u=i.n(o),s=i(8),h=i.n(s),d=i(17),c=i.n(d),v=i(9),y=i.n(v),g=i(24),l=i.n(g),p=i(18),m=i.n(p),f=i(0),k=i(88),A=i(15),S=i.n(A),w=i(4),L=i(1),F=i(26),C=i(35),I=i(63),P=i(16),N=i(51),H=function(t){function e(){var t;return u()(this,e),(t=c()(this,y()(e).call(this))).TEST_DOC_ID="",t.canWrite=!f.default.isDemoMode(),t}return m()(e,t),h()(e,[{key:"preload",value:function(t){var e=this;if(this.canWrite){this.db=k.a.createDB();var i=window.__preload;i?i.data?this.onPreload(i.data,t):i.worker.onmessage=function(i){e.onPreload(i.data,t)}:k.a.load(this.db,function(i){e.onPreload(i,t)})}}},{key:"init",value:function(t,i){l()(y()(e.prototype),"init",this).call(this,t,i)}},{key:"_saveItemData",value:function(t){this.canWrite&&this.db.items.put(t)}},{key:"_deleteItemData",value:function(t){this.canWrite&&this.db.items.delete(t)}},{key:"_saveDocumentData",value:function(t){this.canWrite&&this.db.documents.put(t)}},{key:"setSetting",value:function(t,i){l()(y()(e.prototype),"setSetting",this).call(this,t,i),this.canWrite&&(null!=i&&void 0!==i?this.db.settings.put(n()({id:t},i)):this.db.settings.delete(t))}},{key:"deleteSettings",value:function(t){var i=this;l()(y()(e.prototype),"deleteSettings",this).call(this,t),this.canWrite&&Object.keys(t).forEach(function(t){return i.db.settings.delete(t)})}},{key:"saveSettings",value:function(t){l()(y()(e.prototype),"saveSettings",this).call(this,t);var i=Object.keys(t).map(function(e){return n()({id:e},t[e])});this.canWrite&&this.db.settings.bulkPut(i)}},{key:"saveBoard",value:function(t){if(l()(y()(e.prototype),"saveBoard",this).call(this,t),this.canWrite){var i=C.a.boardOut(t);this.db.boards.put(i)}}},{key:"deleteBoard",value:function(t){l()(y()(e.prototype),"deleteBoard",this).call(this,t),this.canWrite&&this.db.boards.delete(t)}},{key:"deleteDocument",value:function(t){var i=this;l()(y()(e.prototype),"deleteDocument",this).call(this,t),this.canWrite&&(t.getAllItems().forEach(function(t){i.db.items.delete(t.id)}),this.db.documents.delete(t.id))}},{key:"saveContacts",value:function(t){l()(y()(e.prototype),"saveContacts",this).call(this,t),this.canWrite&&this.db.contacts.bulkPut(t)}},{key:"clearContacts",value:function(){l()(y()(e.prototype),"clearContacts",this).call(this),this.canWrite&&this.db.contacts.clear()}},{key:"_bulkSaveItems",value:function(t,e,i){var r=this;if(e.length>0&&e.forEach(function(t){r.db.items.delete(t)}),t.length>0)if(this.canWrite){var a=this.db.items.bulkPut(t);this.cbOnLoad&&a.then(function(){k.a.load(r.db,function(t){i(t)})})}else this.cbOnLoad&&i()}},{key:"getLegacyLocalStorage",value:function(t){var i=l()(y()(e.prototype),"getLegacyLocalStorage",this).call(this,t);return i||(i=localStorage.getItem(t))&&l()(y()(e.prototype),"setLegacyLocalStorage",this).call(this,t,i),i}},{key:"setLegacyLocalStorage",value:function(t,i){l()(y()(e.prototype),"setLegacyLocalStorage",this).call(this,t,i),f.default.isString(i)||(i=JSON.stringify(i)),localStorage.setItem(t,i)}},{key:"deleteLegacyLocalStorage",value:function(t){l()(y()(e.prototype),"deleteLegacyLocalStorage",this).call(this,t),localStorage.removeItem(t)}},{key:"setValue",value:function(t,i){l()(y()(e.prototype),"setValue",this).call(this,t,i),this.db.localStorage.put({id:t,value:i})}},{key:"clearAllData",value:function(){return Promise.all(this.db.tables.map(function(t){return t.clear()}))}},{key:"deletePluginUsage",value:function(t,i){l()(y()(e.prototype),"deletePluginUsage",this).call(this,t,i),this.db.plugins.delete(i)}},{key:"savePluginUsage",value:function(t,i){l()(y()(e.prototype),"savePluginUsage",this).call(this,t,i),this.db.plugins.put(i)}}]),e}((r=function(){function t(){u()(this,t),this.encryptLocal=!1,this.dataCache={settings:{},items:{},documents:{},boards:[],contacts:[],localStorage:{},user:{}}}return h()(t,[{key:"init",value:function(t,e){this._backing=t,this.cbOnLoad=e,this.onDataReady()}},{key:"transformFieldsDocument",value:function(t){var e=f.default.clone(t);return f.default.isVMLI(e.parent)&&(e.parent=e.parent.id),delete e.items,delete e.archivedItems,e=C.a.documentOut(e)}},{key:"transformFieldsItem",value:function(t){var e=f.default.clone(t);return f.default.isVMLI(e.parent)&&(e.parent=e.parent.id),delete e.items,delete e.archivedItems,this.encryptLocal?C.a.encryptItemOut(e,w.default.crypto,L.a.EncryptionKeys.Global):Promise.resolve(C.a.itemOut(e))}},{key:"getItemData",value:function(t,e){return this.dataCache.items[t]}},{key:"getDocumentData",value:function(t){return this.dataCache.documents[t]}},{key:"getSetting",value:function(t){return this.dataCache.settings[t]}},{key:"getBoards",value:function(){return this.dataCache.boards}},{key:"getBoard",value:function(t){return this.dataCache.boards[t]}},{key:"getContacts",value:function(){return this.dataCache.contacts}},{key:"saveDocument",value:function(t){this._saveDocumentData(C.a.documentOut(t))}},{key:"setSetting",value:function(t,e){this.dataCache.settings[t]=e}},{key:"saveSettings",value:function(t){Object.assign(this.dataCache.settings,t)}},{key:"saveBoard",value:function(t){this.dataCache.boards[t.id]=Object.assign(this.dataCache.boards[t.id]||{},t)}},{key:"saveContacts",value:function(t){this.dataCache.contacts=t}},{key:"clearContacts",value:function(){this.dataCache.contacts=[]}},{key:"cacheItem",value:function(t){this.dataCache.items[t.id]=t}},{key:"saveItem",value:function(t,e){var i=this;var r=this.dataCache.items[t.id]||{};Object.assign(r,e,{docId:t.getDocumentOwner().id});try{f.default.PAssert(99,r.id,"Saved item must have id")}catch(a){f.default.reportError(a)}try{f.default.PAssert(100,r.isRoot||r.parent,"Saved item must have parent or be root")}catch(a){f.default.reportError(a)}try{f.default.PAssert(101,r.docId,"Saved item must have docId")}catch(a){f.default.reportError(a)}if(!r.docId||!r.isRoot&&!r.parent){0,r=Object.assign(t.getFullSaveData(),e);try{f.default.PAssert(102,r.isRoot||r.parent,"Saved item had root or parent overridden")}catch(a){f.default.reportError(a)}try{f.default.PAssert(103,r.docId,"Saved item had docId overridden")}catch(a){f.default.reportError(a)}}this.dataCache.items[t.id]=r,this.transformFieldsItem(r).then(function(t){i._saveItemData(t)})}},{key:"deleteItem",value:function(t){var e=this.dataCache.items[t];e&&(delete this.dataCache.items[e.id],this._deleteItemData(e.id))}},{key:"deleteBoard",value:function(t){delete this.dataCache.boards[t]}},{key:"deleteDocument",value:function(t){var e=this;t.getAllItems().forEach(function(t){delete e.dataCache.items[t.id]}),delete this.dataCache.documents[t.id]}},{key:"deleteSettings",value:function(t){var e=this;Object.keys(t).forEach(function(t){delete e.dataCache.settings[t]})}},{key:"clearAllData",value:function(){}},{key:"ensureMirror",value:function(t){for(var e=0,i=this,r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],a=[],n=[],o=!this.TEST_DOC_ID,u=t.length>0&&!!t[0].id,s=0;s<t.length;s++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var h=u?t[s]:t[s].value,d=u?"load":t[s].type,c=this.dataCache.items[h.id];c&&c.parent||h.parent;if("removed"===d)n.push(h.id);else if(!c||!this.areObjectsEqual(h,c)){r&&!o&&console.log("THIS IS BAD, document mismatch");var v=Object.assign(c||{},h);delete v.pendingSync;try{f.default.PAssert(104,v.id,"Saved item must have id")}catch(y){f.default.reportError(y)}try{f.default.PAssert(105,v.isRoot||v.parent,"Saved item must have parent or be root")}catch(y){f.default.reportError(y)}try{f.default.PAssert(106,v.docId,"Saved item must have docId")}catch(y){f.default.reportError(y)}this.dataCache.items[h.id]=v,a.push(v)}}Promise.all(a.map(function(t){return i.transformFieldsItem(t)})).then(function(t){i.bulkSave(t,n)})}},{key:"areObjectsEqual",value:function(t,e){return delete(e=Object.assign({},e)).items,delete e.archivedItems,delete(t=Object.assign({},t)).items,delete t.archivedItems,t.parent===e.parent&&(delete t.parent,delete e.parent,f.default.areObjectsEqual(t,e))}},{key:"onDataReady",value:function(){var t=this;this.dataCache.settings&&w.default.settings.load(this.dataCache.settings,!1),w.default.billingManager.init(),this.dataCache.contacts&&N.a.loadContacts(),F.a.onActiveUser(function(e){try{f.default.PAssert(107,t.dataCache.documents,"Must be documents in cache at this point")}catch(n){f.default.reportError(n)}if(t.dataCache.documents){var i=f.default.objectValues(t.dataCache.documents),r=f.default.filterWithNonMatches(i,t.checkDocHasRoot);if(r.fail.length>0&&(console.log("Failed docs",r.fail),r.fail.forEach(function(e){delete t.dataCache.documents[e.id]})),i=r.match.map(function(e){e.rootData=t.dataCache.items[e.root];var i=I.a.fromData(e,t._backing);return i.createVMLIs(),i}),t._isLoaded=!0,t.cbOnLoad){var a={documentsPending:t.dataCache.documentsPending,itemsPending:t.dataCache.itemsPending,settingsPending:t.dataCache.settingsPending,boardsPending:t.dataCache.boardsPending};t.cbOnLoad(i,a)}t.cbOnLoad=void 0}})}},{key:"checkDocHasRoot",value:function(t){return!!this.dataCache.items[t.root]}},{key:"getLegacyLocalStorage",value:function(t){return this.dataCache.localStorage[t]}},{key:"setLegacyLocalStorage",value:function(t,e){this.dataCache.localStorage[t]=e}},{key:"deleteLegacyLocalStorage",value:function(t){delete this.dataCache.localStorage[t]}},{key:"getValue",value:function(t){return this.dataCache.localStorage[t]}},{key:"setValue",value:function(t,e){this.dataCache.localStorage[t]=e}},{key:"deleteValue",value:function(t){delete this.dataCache.localStorage[t]}},{key:"onPreload",value:function(t,e){this.dataCache=t,e()}},{key:"saveEncryptionKey",value:function(t,e){}},{key:"bulkSave",value:function(t,e){var i=this;e.length>0&&e.forEach(function(t){delete i.dataCache.items[t]}),t.length>0&&this._bulkSaveItems(t,e,function(t){t&&(i.dataCache=t),i.onDataReady()})}},{key:"getItemsMap",value:function(){return this.dataCache.items}},{key:"savePluginUsage",value:function(t,e){this.dataCache.plugins[t]||(this.dataCache.plugins[t]={}),this.dataCache.plugins[t][e.id]=e}},{key:"getPluginTableUsage",value:function(t){return this.dataCache.plugins[t]}},{key:"getPluginUsage",value:function(t,e){if(this.dataCache.plugins[t])return this.dataCache.plugins[t][e]}},{key:"deletePluginUsage",value:function(t,e){this.dataCache.plugins[t]&&delete this.dataCache.plugins[t][e]}}]),t}(),S()(r.prototype,"checkDocHasRoot",[P.a],Object.getOwnPropertyDescriptor(r.prototype,"checkDocHasRoot"),r.prototype),r));e.a=new H},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(17),s=i.n(u),h=i(9),d=i.n(h),c=i(18),v=i.n(c),y=i(4),g=i(0),l=i(1),p=i(30),m=i.n(p),f=i(48),k=i.n(f),A=function(){function t(){a()(this,t),this.onAuthedCallbacks=[]}return o()(t,[{key:"getScopes",value:function(){return[l.a.GScope.UserInfoEmail,l.a.GScope.UserInfoProfile]}},{key:"onSignInWithUser",value:function(t){this.user=t,y.default.settings.activeUser.set(t.email),y.default.settings.displayName.set(t.displayName),this.runAuthedCallbacks(t)}},{key:"runAuthedCallbacks",value:function(t){this.onAuthedCallbacks.length>0&&this.onAuthedCallbacks.forEach(function(e){return e(t)})}},{key:"getUserSync",value:function(){return this.user}},{key:"getUser",value:function(){var t=k()(m.a.mark(function t(){var e=this;return m.a.wrap(function(t){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(t.prev=t.next){case 0:if(!this.user){t.next=4;break}return t.abrupt("return",Promise.resolve(this.user));case 4:return t.abrupt("return",new Promise(function(t){e.onAuthedCallbacks.push(function(e){t(e)})}));case 5:case"end":return t.stop()}}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"onAuthed",value:function(t){this.user?t(this.user):this.onAuthedCallbacks.push(t)}},{key:"onActiveUser",value:function(t){y.default.settings.activeUser.onHasValue(t)}},{key:"getAccountName",value:function(){return g.default.isDemoMode()?"Demo User":y.default.settings.displayName.get()}},{key:"getDefaultAccountID",value:function(){return g.default.isDemoMode()?"demoemail@moo.do":y.default.settings.activeUser.get()}},{key:"getEncryptionUid",value:function(){return this.getUid()}}]),t}(),S=i(3),w=i(47),L=function(t){function e(){return a()(this,e),s()(this,d()(e).call(this))}return v()(e,t),o()(e,[{key:"init",value:function(){var t=this,e={clientId:l.a.ClientID,apiKey:l.a.APIKey,authDomain:"api-project-597847337936.firebaseapp.com",databaseURL:"https://api-project-597847337936.firebaseio.com",projectId:"api-project-597847337936",storageBucket:"api-project-597847337936.appspot.com",messagingSenderId:"597847337936",scopes:this.getScopes()};w.a.initializeApp(e),window.firebase=w.a,w.a.auth().onAuthStateChanged(function(e){e&&y.default.settings.activeUser.get()?t.onSignInWithUser(e):y.default.settings.activeUser.set(void 0)})}},{key:"handleNativeOAuthResponse",value:function(t){var e=this;if(t.success){var i=t.token,r=i.access_token,a=i.id_token;if(r&&a){var n=w.a.auth.GoogleAuthProvider.credential(a,r);w.a.auth().signInWithCredential(n).then(function(t){e.onSignInWithUser(t)})}}}},{key:"signIn",value:function(){var t=this;if(this._isSigningIn=!0,S.a.mobile&&S.a.app)y.default.nativeBridge.nativeOauth(!1,function(t){console.log(t)});else{var e=new w.a.auth.GoogleAuthProvider,i=this.getScopes();e.setCustomParameters({prompt:"select_account"}),i.forEach(function(t){e.addScope(t)}),w.a.auth().signInWithPopup(e).then(function(e){e.additionalUserInfo&&(t.userProfile=e.additionalUserInfo.profile);try{g.default.PAssert(141,e.user,"Somehow signed in without a valid user")}catch(i){g.default.reportError(i)}e.user&&t.onSignInWithUser(e.user)}).catch(function(t){if("auth/popup-closed-by-user"===t.code)y.default.setup.popupClosedError.set("Error signing in. Please try again.");else if("auth/network-request-failed"===t.code)y.default.setup.popupClosedError.set("Connection error. Please try again.");else try{g.default.PAssert(142,!1,"Error on signin",t.code,t.message)}catch(e){g.default.reportError(e)}})}}},{key:"getUid",value:function(){return g.default.isDemoMode()?"demouid":w.a.auth().getUid()}},{key:"signOut",value:function(t){w.a.auth().signOut().then(function(){y.default.settings.activeUser.set(void 0),t&&t()}).catch(function(e){t&&t()})}}]),e}(A);e.a=new L},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(0),s=i(1),h=function(t,e){this._batchConstructor=t,this._batchParams=e,this._batchedRequests={},this._successCB=u.default.emptyFn,this._failureCB=u.default.emptyFn,this._context=void 0,this._hasRun=!1,this._batchID=u.default.generateTempId()};h.prototype={add:function(t,e,i){try{u.default.PAssert(1694,t,"Must provide a valid request to add to batch")}catch(a){u.default.reportError(a)}try{u.default.PAssert(1695,e,"Must supply a valid group ID when adding to a batch")}catch(a){u.default.reportError(a)}try{u.default.PAssert(1696,!this._hasRun,"Should never add new requests to a batch that has already run")}catch(a){u.default.reportError(a)}var r=this._ensureGroup(e);return this._addRequestToGroup(e,i,t),r},then:function(t,e,i){this._successCB=t||u.default.newEmptyFn(),this._failureCB=e||u.default.newEmptyFn(),this._context=i,this._run()},execute:function(t){this._successCB=t,this._failureCB=t,this._run()},getBatchID:function(){return this._batchID},_ensureGroup:function(t){var e=!1;return this._batchedRequests[t]||(this._batchedRequests[t]={size:0,batch:this._createBatchInternal()},e=!0),e},_addRequestToGroup:function(t,e,i){var r=this._getGroupBatch(t),a=this._getGroupSize(t);try{u.default.PAssert(1697,a<=s.a.MaxBatchSize,"Too many requests for a single batch")}catch(n){u.default.reportError(n)}e?r.add(i,{id:e}):r.add(i)},_getGroupBatch:function(t){try{u.default.PAssert(1698,this._batchedRequests[t],"Must ensure before querying")}catch(e){u.default.reportError(e)}return this._batchedRequests[t].batch},_getGroupSize:function(t){try{u.default.PAssert(1699,this._batchedRequests[t],"Must ensure before querying")}catch(e){u.default.reportError(e)}return this._batchedRequests[t].size},_getBatchURL:function(){return this._baseURL},_run:function(){try{u.default.PAssert(1700,!this._hasRun,"Should never run a batch twice")}catch(e){u.default.reportError(e)}for(var t in this._hasRun=!0,this._batchedRequests){this._getGroupBatch(t).then(this._handleSuccess.bind(this),this._handleFailure.bind(this))}},_createBatchInternal:function(){return new this._batchConstructor(this._batchParams)},_handleSuccess:function(t){try{u.default.PAssert(1701,this._hasRun,"Must run batch before success")}catch(e){u.default.reportError(e)}this._successCB.call(this._context,t)},_handleFailure:function(t){try{u.default.PAssert(1702,this._hasRun,"Must run batch before failure")}catch(e){u.default.reportError(e)}this._failureCB.call(this._context,t)}};var d=h,c=function(){function t(){a()(this,t),this._data={gapi:{client:{drive:{files:{get:{path:"/drive/v2/files/{fileId}",method:"GET",packedFn:["gapi","client","drive","files","get"]},export:{path:"/drive/v2/files/{fileId}/export",method:"GET",packedFn:["gapi","client","drive","files","export"]},list:{path:"/drive/v2/files",method:"GET",packedFn:["gapi","client","drive","files","list"]},trash:{path:"/drive/v2/files/{fileId}/trash",method:"POST",packedFn:["gapi","client","drive","files","trash"]},untrash:{path:"/drive/v2/files/{fileId}/untrash",method:"POST",packedFn:["gapi","client","drive","files","untrash"]},insert:{path:"/drive/v2/files",method:"POST",packedFn:["gapi","client","drive","files","insert"]},patch:{path:"/drive/v2/files/{fileId}",method:"PATCH",packedFn:["gapi","client","drive","files","patch"]}},permissions:{list:{path:"/drive/v2/files/{fileId}/permissions",method:"GET",packedFn:["gapi","client","drive","permissions","list"]},insert:{path:"/drive/v2/files/{fileId}/permissions",method:"POST",packedFn:["gapi","client","drive","permissions","insert"]},delete:{path:"/drive/v2/files/{fileId}/permissions/{permissionId}",method:"DELETE",packedFn:["gapi","client","drive","permissions","delete"]}},properties:{insert:{path:"/drive/v2/files/{fileId}/properties",method:"POST",packedFn:["gapi","client","drive","properties","insert"]},update:{path:"/drive/v2/files/{fileId}/properties/{propertyKey}",method:"PUT",packedFn:["gapi","client","drive","properties","update"]}},parents:{insert:{path:"/drive/v2/files/{fileId}/parents",method:"POST",packedFn:["gapi","client","drive","parents","insert"]},delete:{path:"/drive/v2/files/{fileId}/parents/{parentId}",method:"DELETE",packedFn:["gapi","client","drive","parents","delete"]}},changes:{list:{path:"/drive/v2/changes",method:"GET",packedFn:["gapi","client","drive","changes","list"]}},children:{list:{path:"/drive/v2/files/{folderId}/children",method:"GET",packedFn:["gapi","client","drive","children","list"]},delete:{path:"/drive/v2/files/{folderId}/children/{childId}",method:"DELETE",packedFn:["gapi","client","drive","children","delete"]}},realtime:{get:{path:"/drive/v2/files/{fileId}/realtime",method:"GET",packedFn:["gapi","client","drive","realtime","get"]}}},gmail:{users:{threads:{list:{path:"/gmail/v1/users/{userId}/threads",method:"GET",packedFn:["gapi","client","gmail","users","threads","list"]},get:{path:"/gmail/v1/users/{userId}/threads/{id}",method:"GET",packedFn:["gapi","client","gmail","users","threads","get"]},modify:{path:"/gmail/v1/users/{userId}/threads/{id}/modify",method:"POST",packedFn:["gapi","client","gmail","users","threads","modify"]},trash:{path:"/gmail/v1/users/{userId}/threads/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","threads","trash"]},untrash:{path:"/gmail/v1/users/{userId}/threads/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","threads","untrash"]}},labels:{list:{path:"/gmail/v1/users/{userId}/labels",method:"GET",packedFn:["gapi","client","gmail","users","labels","list"]},create:{path:"/gmail/v1/users/{userId}/labels",method:"POST",packedFn:["gapi","client","gmail","users","labels","create"]}},history:{list:{path:"/gmail/v1/users/{userId}/history",method:"GET",packedFn:["gapi","client","gmail","users","history","list"]}},messages:{get:{path:"/gmail/v1/users/{userId}/messages/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","get"]},send:{path:"/gmail/v1/users/{userId}/messages/send",method:"POST",packedFn:["gapi","client","gmail","users","messages","send"]},trash:{path:"/gmail/v1/users/{userId}/messages/{id}/trash",method:"POST",packedFn:["gapi","client","gmail","users","messages","trash"]},untrash:{path:"/gmail/v1/users/{userId}/messages/{id}/untrash",method:"POST",packedFn:["gapi","client","gmail","users","messages","untrash"]},attachments:{get:{path:"/gmail/v1/users/{userId}/messages/{messageId}/attachments/{id}",method:"GET",packedFn:["gapi","client","gmail","users","messages","attachments","get"]}}},drafts:{create:{path:"/gmail/v1/users/{userId}/drafts",method:"POST",packedFn:["gapi","client","gmail","users","drafts","create"]},update:{path:"/gmail/v1/users/{userId}/drafts/{id}",method:"PUT",packedFn:["gapi","client","gmail","users","drafts","update"]},send:{path:"/gmail/v1/users/{userId}/drafts/send",method:"POST",packedFn:["gapi","client","gmail","users","drafts","send"]},delete:{path:"/gmail/v1/users/{userId}/drafts/delete",method:"DELETE",packedFn:["gapi","client","gmail","users","drafts","delete"]},list:{path:"/gmail/v1/users/{userId}/drafts",method:"GET",packedFn:["gapi","client","gmail","users","drafts","list"]}},settings:{sendAs:{list:{path:"/gmail/v1/users/{userId}/settings/sendAs",method:"GET",packedFn:["gapi","client","gmail","users","settings","sendAs","list"]}}}}},calendar:{settings:{list:{path:"/calendar/v3/users/{userId}/settings",method:"GET",packedFn:["gapi","client","calendar","settings","list"]}},events:{get:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"GET",packedFn:["gapi","client","calendar","events","get"]},list:{path:"/calendar/v3/calendars/{calendarId}/events",method:"GET",packedFn:["gapi","client","calendar","events","list"]},patch:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"PATCH",packedFn:["gapi","client","calendar","events","patch"]},insert:{path:"/calendar/v3/calendars/{calendarId}/events",method:"POST",packedFn:["gapi","client","calendar","events","insert"]},move:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}/move",method:"POST",packedFn:["gapi","client","calendar","events","move"]},delete:{path:"/calendar/v3/calendars/{calendarId}/events/{eventId}",method:"DELETE",packedFn:["gapi","client","calendar","events","delete"]}},calendars:{insert:{path:"/calendar/v3/calendars",method:"POST",packedFn:["gapi","client","calendar","calendars","insert"]}},calendarList:{list:{path:"/calendar/v3/users/{userId}/calendarList",method:"GET",packedFn:["gapi","client","calendar","calendarList","list"]}}}}}}}return o()(t,[{key:"fns",value:function(t){return this._data.gapi.client[t]}},{key:"generatePackedFns",value:function(t){var e=this._data.gapi.client[t],i=["gapi","client",t];this._iterateAPI(e,i)}},{key:"_iterateAPI",value:function(t,e){if(u.default.isString(t.path))t.packedFn||(u.default.log("WARNING: Missing Pre-Packed Fn: [ '"+e.join("', '")+"' ]"),t.packedFn=e.slice(0));else for(var i in t)u.default.isObject(t[i])&&(e.push(i),this._iterateAPI(t[i],e),e.pop())}},{key:"_constructPath",value:function(t,e){var i=u.default.clone(e);return Object.keys(e).forEach(function(r){var a=new RegExp("\\{"+r+"\\}"),n=t.replace(a,encodeURIComponent(e[r]));n!==t&&delete i[r],t=n}),delete i.resource,delete i.timeoutMS,delete i.forceNoDupe,{path:t,fields:i}}},{key:"_constructHeaders",value:function(t,e,i){try{u.default.PAssert(1374,e||i,"Must have either accountID or token")}catch(a){u.default.reportError(a)}try{u.default.PAssert(1375,i||u.default.isDemoMode(),"Should have a token at this point")}catch(a){u.default.reportError(a)}var r={Authorization:i?"Bearer "+i.access_token:void 0};return t&&Object.keys(t).forEach(function(e){r[e]=t[e]}),r}},{key:"canConstruct",value:function(t){var e=!1;return u.default.isFunction(t)||(e=!!u.default.unpackFn(t,this._data)),e}},{key:"createBatch",value:function(t){return new d(window.gapi.client.newBatch,t)}},{key:"createRequest",value:function(t,e,i,r){var a,n=u.default.unpackFn(e,this._data);if(n){var o=this._constructPath(n.path,i),s=this._constructHeaders(n.headers,t,r),h={path:o.path,method:n.method||"GET",params:o.fields,body:i.resource,headers:s};u.default.isDemoMode()&&(h.__packedFn=e,h.__rawParams=i);try{u.default.PAssert(1376,window.gapi&&window.gapi.client,"Trying to make a request with no gapi")}catch(c){u.default.reportError(c)}window.gapi&&window.gapi.client&&(a=window.gapi.client.request(h))}else{var d=u.default.unpackFn(e);d&&(a=d(i))}return a}},{key:"getAPIForRequest",value:function(t){try{u.default.PAssert(1377,u.default.isDemoMode(),"Must only reverse the path in demo mode")}catch(e){u.default.reportError(e)}return u.default.unpackFn(t.__packedFn)}}]),t}();e.a=new c},,,,,,function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(17),s=i.n(u),h=i(9),d=i.n(h),c=i(24),v=i.n(c),y=i(18),g=i.n(y),l=i(0),p=function(t){function e(t,i){var r;return a()(this,e),(r=s()(this,d()(e).call(this,t,i)))._value=t||[],r.version=0,r}return g()(e,t),o()(e,[{key:"notify",value:function(t,i,r){0===arguments.length&&this.version++,v()(d()(e.prototype),"notify",this).apply(this,arguments)}},{key:"length",value:function(){return this._value.length}},{key:"set",value:function(t,e){try{l.default.PAssert(249,t&&l.default.isArray(t),"Value set on an Observable array must be an array",t)}catch(i){l.default.reportError(i)}return this._value=t,this.version++,!1!==e&&this.notify(this._value),t}},{key:"clear",value:function(t){this.set([],t)}},{key:"remove",value:function(t,e){var i;if(l.default.isFunction(t))for(var r=0,a=0;a<this._value.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;t(this._value[a])&&(void 0===i&&(i=a),this._value.splice(a,1),a--)}else i=this._value.remove(t);return this.version++,!1!==e&&this.notify(this._value),i}},{key:"removeAt",value:function(t,e){var i=this._value.removeAt(t);return this.version++,!1!==e&&this.notify(this._value),i}},{key:"push",value:function(t,e){var i=this._value.push(t);return this.version++,!1!==e&&this.notify(this._value),i}},{key:"insertSorted",value:function(t,e,i){var r=this._value.insertSorted(t,e);return this.version++,!1!==i&&this.notify(this._value),r}},{key:"sort",value:function(t,e){return this._value.sort(t),this.version++,!1!==e&&this.notify(this._value),this}},{key:"splice",value:function(t,e,i,r){var a;return a=i?this._value.splice(t,e,i):this._value.splice(t,e),this.version++,!1!==r&&this.notify(this._value),a}},{key:"indexOf",value:function(t){return this._value.indexOf(t)}},{key:"indexOfWithProperty",value:function(t,e){return this._value.indexOfWithProperty(t,e)}}]),e}(i(10).a);e.a=p},function(t,e,i){"use strict";var r,a=i(7),n=i.n(a),o=i(8),u=i.n(o),s=i(15),h=i.n(s),d=i(0),c=i(1),v=i(4),y=i(3),g=i(55),l=i(26),p=i(16),m=i(10),f=i(64),k=i(58),A=(r=function(){function t(){n()(this,t),this.isLoaded=new m.a(!1),this.isGapiLoaded=new m.a(!1),this._handlersOnLoaded=[],this.authTokens={},this.onAccountsUpdated=new g.a}return u()(t,[{key:"loadWithTokens",value:function(t){var e=this;this.ensureGapi(),Promise.all(Object.keys(t).map(function(t){return e.refreshAuthToken(t)})).then(function(t){e.isLoaded.set(!0),e._runOnSyncHandlers()})}},{key:"authAccount",value:function(t,e,i){var r=this,a=function(a){a&&!a.error?i(a):r.doAuthForAccount({email:t,scopes:e},i)};this.authTokens[t]?this.getAccountAuthToken(t,e,a,!0):a()}},{key:"authAccountTemp",value:function(t,e){this.doAuthForAccount({scopes:t,temp:!0},e)}},{key:"removeAccount",value:function(t){delete this.authTokens[t],this.onAccountsUpdated.notify(),k.a.deleteAuthToken(t)}},{key:"convertScopeToScopes",value:function(t){var e=t.scope?t.scope.split(" "):void 0;return t.scopes=e?e.map(function(t){return c.a.GScopeArray[t]}):void 0,delete t.scope,t}},{key:"refreshAuthToken",value:function(t){var e=this;return new Promise(function(i){f.a.getAccessToken(t).then(function(r){if(r.value){var a=e.convertScopeToScopes(r.value);e.authTokens[t]=a,i(a)}else console.log(r.error),r.error&&r.error.includes("invalid_grant")&&e.redoAuth(t,l.a.getScopes())})})}},{key:"redoAuth",value:function(t,e,i){var r=this;y.a.isMobile?v.default.toasts.pushMessage({text:"Error authorizing for account: "+t+". Please reauthorize in Moo.do on your computer.",action:c.a.MessageAction.Okay}):v.default.toasts.pushMessage({text:"Error authorizing for account: "+t+". Please reauthorize.",actionText:"REAUTHORIZE",action:function(){r.doAuthForAccount({email:t,scopes:e},i)}})}},{key:"getAccountAuthToken",value:function(t,e,i,r){var a=this;this.onLoaded(function(){var n=a.authTokens[t];n?a._verifyScopes(e,n)?!n.expires_at||n.expires_at-Date.now()<c.a.MinimumTokenExpireTimeMS?a.refreshAuthToken(t).then(i):i(n):r?i(void 0):a.redoAuth(t,e,i):(i(void 0),a.redoAuth(t,e))})}},{key:"isAuthorizedForScopes",value:function(t,e){var i=this.authTokens&&this.authTokens[t];return!!i&&this._verifyScopes(e,i)}},{key:"notifyUnauthorizedRequest",value:function(t){}},{key:"_verifyScopes",value:function(t,e){var i=0;if(!e||!e.scopes)return!1;for(var r=e.scopes,a=0;a<t.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(!r.includes(t[a]))return!1}return!0}},{key:"_getRedirectURL",value:function(){return window.location.protocol+"//"+window.location.host+"/oauthRelay.html"}},{key:"_createAuthURL",value:function(t){var e=t.email,i=t.scopes,r=t.temp;try{d.default.PAssert(246,d.default.isArray(i)&&i.length>0,"Must pass in a valid scopes array")}catch(n){d.default.reportError(n)}var a={email:e,temp:r,scope:i.join(" "),redirect_uri:this._getRedirectURL()};return f.a.createURL("auth/authGoogleAPI",a)}},{key:"doAuthForAccount",value:function(t,e){var i=this,r=t.email,a=t.scopes,n=t.temp;try{d.default.PAssert(247,r||n,"Must provide a valid email to link if not temp")}catch(s){d.default.reportError(s)}try{d.default.PAssert(248,d.default.isArray(a),"Must always provide a valid scopes array")}catch(s){d.default.reportError(s)}a=d.default.arrayUnion([c.a.GScope.UserInfoEmail],a);var o,u=!1;this._createAuthURL({email:r,scopes:a,temp:n}).then(function(t){var a,n=window.open(t,"googleauth","height=600,width=550"),s=!1,h=function t(a){if(clearInterval(o),d.default.getLocationOrigin()&&!s&&d.default.isObject(a.data)){if(window.removeEventListener("message",t),u=!0,a.data){var n=i.convertScopeToScopes(a.data);i.authTokens[r]=n,i.onAccountsUpdated.notify(),e&&e(n)}e&&!u&&e(void 0),s=!0}};y.a.isNativeApp()&&((a=new BroadcastChannel("Moo.do_auth_gapi_channel")).onmessage=function(t){h(t)}),o=setInterval(function(){a&&n&&!n.closed?(console.log("posting auth"),a.postMessage("checkAuth")):n&&!n.closed||(clearInterval(o),window.removeEventListener("message",h),!u&&e&&e(void 0))},1e3),window.addEventListener("message",h)})}},{key:"ensureGapi",value:function(t){var e=this;if(!y.a.isMobile||y.a.isMobileWeb){window.gapi&&window.gapi.client&&t&&t();var i=function(t){};document.getElementById("gapiScript")||d.default.addScript("https://apis.google.com/js/api.js","gapiScript",this.ensureGapi.bind(this,t),i),window.gapi&&!window.gapi.client&&window.gapi.load("client",{callback:function(i){window.gapi.client.init({apiKey:c.a.APIKey,clientId:c.a.ClientID}).then(function(){e.isGapiLoaded.set(!0),v.default.pluginManager.notifyDependencyLoad(c.a.PluginDependency.GoogleLogin)}),t&&t()},onerror:i,timeout:2e4,ontimeout:function(t){}})}}},{key:"onLoaded",value:function(t){this.isLoaded.get()?t():this._handlersOnLoaded.push(t)}},{key:"_runOnSyncHandlers",value:function(){this._handlersOnLoaded.forEach(function(t){return t()}),this._handlersOnLoaded=[]}},{key:"getAccountName",value:function(t){}},{key:"getDefaultAuthToken",value:function(t,e){var i=l.a.getDefaultAccountID();this.getAccountAuthToken(i,t,function(t){t?e(t):console.log("No auth token")})}},{key:"hasError",value:function(){return!1}},{key:"getError",value:function(t){return""}},{key:"getGoogleUserInfo",value:function(t){this.getDefaultAuthToken(["profile"],function(e){e?fetch("https://www.googleapis.com/oauth2/v1/userinfo?alt=json&access_token=".concat(e.access_token)).then(function(e){200===e.status&&e.json().then(function(e){return t(e)})}):t(void 0)})}},{key:"isEmailAuthed",value:function(t){var e=t.toLowerCase();return Object.keys(this.authTokens).some(function(t){return t.toLowerCase()===e})}}]),t}(),h()(r.prototype,"refreshAuthToken",[p.a],Object.getOwnPropertyDescriptor(r.prototype,"refreshAuthToken"),r.prototype),r);e.a=new A},function(t,e,i){"use strict";var r=function(t){var e={};return Object.keys(t).forEach(function(i){e[t[i]]=i}),e},a=function(t){return"string"===typeof t},n={billingID:"b",displayName:"n",gid:"g",earlyAdopter:"x",email:"e",fname:"f",lname:"l",inviteCode:"i",invoiceAddress:"a",invoiceCompany:"c",invoiceEmail:"d",joinDate:"j",monthlyInvoice:"m",nextBillingDate:"o",planID:"h",picture:"p",premiumCode:"k",premiumSignupDate:"q",premiumEndDate:"r",premiumStatus:"s",subscriptionID:"v",trialDuration:"u",trialExtended:"w",trialStart:"t",isUnsubscribed:"y"},o=r(n),u={items:!0},s={dateCreated:"c",dateCompleted:"e",dateModified:"d",date:"b",flags:"f",id:"id",index:"i",isArchived:"r",isDeleted:"x",note:"n",parent:"p",pendingSync:"m",text:"t",docId:"o",isRoot:"q"},h=r(s),d={validateInFields:function(t,e){return!(e&&(!t.id||"undefined"===t.id))&&(Object.keys(t).forEach(function(t){if(t.length<2||"undefined"===t)return!1}),!0)},validateOutFields:function(t,e){return!(e&&(!t.id||"undefined"===t.id))&&(Object.keys(t).forEach(function(t){if(t.length>2||"undefined"===t)return!1}),!0)},itemFieldMapIn:h,itemFieldMapOut:s,documentIn:function(t){return{id:t.id,acl:t.a,dateModified:t.p.d,text:t.p.t,encryptionSentinel:t.p.s,root:t.r,version:t.v,pendingSync:t.m,backups:t.c}},documentOut:function(t,e){var i={id:t.id,p:{d:t.dateModified,t:t.text}};return t.encryptionSentinel&&(i.p.s=t.encryptionSentinel),e||(i.a=t.acl,i.r=t.root,i.v=t.version),t.pendingSync&&(i.m=t.pendingSync),i},userIn:function(t){var e={};return Object.keys(t).forEach(function(i){o[i]&&"undefined"!==o[i]&&(e[o[i]]=t[i])}),e},userOut:function(t){var e={};return Object.keys(t).forEach(function(i){n[i]&&void 0!==n[i]&&"undefined"!==n[i]&&(e[n[i]]=t[i])}),e},itemIn:function(t){var e={};return Object.keys(t).forEach(function(i){h[i]&&"undefined"!==h[i]&&(e[h[i]]=t[i])}),e},itemOut:function(t){var e={};return Object.keys(t).forEach(function(i){void 0!==t[i]&&!u[i]&&s[i]&&"undefined"!==s[i]&&(e[s[i]]=t[i])}),e},decryptItem:function(t,e,i){return t.text?e.decryptText(i,t.text,t.id).then(function(e){return t.text=e,t}):Promise.resolve(t)},encryptItem:function(t,e,i){return t.text?e.encryptText(i,t.text,t.id).then(function(e){return t.text=e,t}):Promise.resolve(t)},encryptItemOut:function(t,e,i){return d.encryptItem(t,e,i).then(function(t){return d.itemOut(t)})},decryptItemIn:function(t,e,i){return t=d.itemIn(t),d.decryptItem(t,e,i)},boardIn:function(t){var e=Object.assign({},t);return a(t.panes)&&(e.panes=JSON.parse(t.panes)),a(t.defaultPanes)&&(e.defaultPanes=JSON.parse(t.defaultPanes)),e},boardOut:function(t){var e=Object.assign({},t);return t.panes&&(e.panes=JSON.stringify(t.panes)),t.defaultPanes&&(e.defaultPanes=JSON.stringify(t.defaultPanes)),e},compareItemIndex:function(t,e){var i=0,r=t.index,a=e.index;if(void 0===r||void 0===a)return 0;"number"===typeof r&&(r=""+r),"number"===typeof a&&(a=""+a);for(var n=r.split(","),o=a.split(","),u=0;u<n.length;u++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(void 0===o[u])return 1;var s=+n[u],h=+o[u];if(s!==h)return s-h}return-1}};e.a=d},,,,function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(0),s=i(1),h=i(4),d=i(6),c=i(19),v=i(3),y=i(10),g=i(59),l=i(22),p=function(){function t(){a()(this,t),this.stack=[]}return o()(t,[{key:"push",value:function(t){this.stack.push(t)}},{key:"pop",value:function(t){this.stack.remove(t)}},{key:"peek",value:function(){return this.stack[this.stack.length-1]}},{key:"contains",value:function(t){return this.stack.indexOf(t)>=0}},{key:"forEach",value:function(t){for(var e=0,i=this.stack.length-1;i>=0;i--){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(!1===t(this.stack[i],i))break}}}]),t}(),m=i(5),f=i(49),k=i(50),A={},S={Ctrl:0,Meta:1,Alt:2,Shift:3},w=function(){function t(){var e,i=this;a()(this,t),this.currentArrowsMode=void 0,this.platformPrimaryKey=v.a.mac?S.Meta:S.Ctrl,this.platformSecondaryKey=v.a.mac?S.Ctrl:S.Alt;var r=function(t,e){for(var r,a=0,n=0;n<e.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o,s,d,c,v=e[n],y=!v.mods;if(y||(o=!!v.mods[S.Ctrl]===!!t.ctrlKey,s=!!v.mods[S.Meta]===!!t.metaKey,d=!!v.mods[S.Alt]===!!t.altKey,c=!!v.mods[S.Shift]===!!t.shiftKey),(y||o&&s&&d&&c)&&(v.isGlobal||t.target===document.body&&!h.default.menus.isContextMenuOpen()&&!h.default.menus.isModalOpen()||u.default.findParent(t.target,"paneContent"))){r=v;break}}if(r){i.currentArrowsMode&&!r.isOnPane&&(i._exitingArrowsMode=i.currentArrowsMode,i._exitArrowsMode());var g=r.callback.call(i,t);return r.stopPropagation&&t.stopPropagation(),i._exitingArrowsMode=void 0,!1===g||(t.handled=!0,t.preventDefault(),!1)}},n=function(t){if(h.default.setup&&h.default.settings.activeUser.get()){var a;if(v.a.normalizeKeys(t),e=t.normCode,i.currentArrowsMode&&i._updateArrowsMode(t),i.hotkeyStack.forEach(function(e){if(e&&e[t.normCode]&&(a=r(t,[e[t.normCode]])),void 0!==a)return!1}),void 0===a){var n=A[t.normCode];n&&(a=r(t,n))}if(void 0!==a)return u.default.vmMain&&u.default.vmMain.updateCursorFromEvent(t),a;if(v.a.android&&t.target===document.body){if(function(t){return(v.a.mac&&t.metaKey||!v.a.mac&&t.ctrlKey)&&t.normCode===s.a.KeyCode.A}(t))return t.preventDefault(),!1;g.default.keydown(null,t)}}};this.hotkeyStack=new p,this.currentArrowsMode=void 0,this.arrowsModeHotkeys={},c.a.binder(this,"onMouseDownArrowsMode"),document.addEventListener("keydown",n,!0),document.addEventListener("keyup",function(t){h.default.setup&&h.default.settings.activeUser.get()&&(v.a.normalizeKeys(t),u.default.vmMain&&u.default.vmMain.updateCursorFromEvent(t),v.a.windows&&e!==t.normCode&&(t.normCode!==s.a.KeyCode.D1&&t.normCode!==s.a.KeyCode.D2&&t.normCode!==s.a.KeyCode.D3&&t.normCode!==s.a.KeyCode.D8||A[t.normCode]&&(n(t),e=void 0)))},!0),this.loadConfig()}return o()(t,[{key:"loadConfig",value:function(){for(var t in this.config={Pane:{Search:["Pr+F"],Goto:["Se+G"],Overview:["Se+O"],Complete:["Pr+Enter"],ZoomOut:["Se+Sh+Enter","Se+LeftArrow"],ZoomIn:["Se+Enter","Se+RightArrow"],EditNote:["Sh+Enter"],Collapse:["Pr+Period","mac:Se+Space"],CollapseRecursive:["Pr+Sh+Period","mac:Se+Sh+Space"],CollapseAll:["Pr+Se+Period","mac:Pr+Se+Sh+Space"],Unindent:["Sh+Tab","Pr+LBracket","Se+LBracket","Se+Sh+LeftArrow"],Indent:["Tab","Pr+RBracket","Se+RBracket","Se+Sh+RightArrow"],MoveUp:["Se+Sh+UpArrow","mac:Op+UpArrow"],MoveDown:["Se+Sh+DownArrow","mac:Op+DownArrow"],Priority1:["Pr+D1"],Priority2:["Pr+D2"],Priority3:["Pr+D3"],PriorityNone:["Pr+D0","Pr+D4"],Star:["Pr+D8","win:Pr+Tilde"],NextPane:["mac:app:Se+Tilde","mac:app:Pr+Op+RightArrow","win:Se+Tilde"],PreviousPane:["mac:app:Se+Sh+Tilde","mac:app:Pr+Op+LeftArrow","win:Se+Sh+Tilde"],SelectItem:["Se+L"],ClosePane:["Sh+F4"],Bold:["Pr+B"],Italic:["Pr+I"],Underline:["Pr+U"],InsertLink:["Pr+K"],MoveAutocomplete:["Se+M"],JumpAutocomplete:["Se+J"],PrefixHeader:["Pr+Sh+D6","Pr+Sh+P","Pr+Sh+H","win:Pr+Sh+D3"],PrefixTask:["mac:app:Pr+Sh+LBracket","win:Pr+Sh+LBracket","Se+Sh+LBracket","Pr+Sh+D9","Pr+Sh+D0"],PrefixBullet:["Pr+Sh+D8"],PrefixNumList:["Pr+Sh+D1"],AddToCalendar:["Se+C"],DeleteItem:["Pr+Sh+Backspace","Pr+Sh+K"],Date:["Pr+Sh+D"]},Global:{SelectPane1:["app:Se+D1"],SelectPane2:["app:Se+D2"],SelectPane3:["app:Se+D3"],SelectPane4:["app:Se+D4"],SelectPane5:["app:Se+D5"],SelectPane6:["app:Se+D6"],SelectPane7:["app:Se+D7"],SelectPane8:["app:Se+D8"],SelectPane9:["app:Se+D9"],SelectPane10:["app:Se+D0"],Undo:["Pr+Z"],Redo:["Pr+Y","Pr+Sh+Z"],AddPane:["app:Pr+T","Se+T"],NewItem:["app:Pr+N","Se+N"],EmailCompose:["Pr+E"],NextBoard:["mac:app:Se+Tab","win:app:Pr+Tab"],PreviousBoard:["mac:app:Se+Sh+Tab","win:app:Pr+Sh+Tab"],SelectBoard1:["Se+Sh+D1"],SelectBoard2:["Se+Sh+D2"],SelectBoard3:["Se+Sh+D3"],SelectBoard4:["Se+Sh+D4"],SelectBoard5:["Se+Sh+D5"],SelectBoard6:["Se+Sh+D6"],SelectBoard7:["Se+Sh+D7"],SelectBoard8:["Se+Sh+D8"],SelectBoard9:["Se+Sh+D9"],SelectBoard10:["Se+Sh+D0"],HelpHotkeys:["Pr+Slash","Se+Slash"],Help:["Pr+Sh+Slash","Se+Sh+Slash"],Settings:["mac:app:Pr+Comma"],ZoomInApp:["app:Pr+Plus"],ZoomOutApp:["app:Pr+Dash"]},Email:{Down:["DownArrow","J"],Up:["UpArrow","K"],Open:["Enter"],Archive:["E","Slash"],Delete:["Delete","win:Backspace","Sh+D3"],Schedule:["C"],Snooze:["D"],Move:["M","V"],Task:["T"],Label:["L"],MarkRead:["I"],MarkUnread:["U"],Star:["S","D8"],Reply:["R"],ReplyAll:["Sh+R","A"],Forward:["F"],Priority1:["D1"],Priority2:["D2"],Priority3:["D3"],RemoveFromLabel:["Y"],Undo:["Z"],Print:["P"],OpenInGmail:["G"]}},this.config.Pane)this.config.Pane.hasOwnProperty(t)&&this.createHotkeyNew(t,this.config.Pane[t],!1);for(var e in this.config.Global)this.config.Global.hasOwnProperty(e)&&this.createHotkeyNew(e,this.config.Global[e],!0);for(var i in this.config.Email)this.config.Email.hasOwnProperty(i)&&this.createHotkeyNew(i,this.config.Email[i],!1,!0,"Email");this.createHotkeyNew("Noop",["Pr+S"],!0)}},{key:"createHotkeyNew",value:function(t,e,i){var r=0,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],n=arguments.length>4?arguments[4]:void 0,o=a?this.callbackOnPane.bind(this,n,t):this["hotkey"+t];try{u.default.PAssert(489,o&&u.default.isFunction(o),"Missing hotkey handler",t)}catch(l){u.default.reportError(l)}for(var h=0;h<e.length;h++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var d=e[h],c=d.split(":"),v=c[c.length-1].split("+"),y=s.a.KeyCode[v[v.length-1]];try{u.default.PAssert(490,y,"Key code must be defined",d)}catch(l){u.default.reportError(l)}if(this.isValidPlatform(d)){var g={name:h>0?t+h:t,isGlobal:i,keyCode:y,primary:v.indexOf("Pr")>=0,secondary:v.indexOf("Se")>=0,shift:v.indexOf("Sh")>=0,option:v.indexOf("Op")>=0,isOnPane:a,callback:o};this.addHotkeyNew(g)}}}},{key:"isValidPlatform",value:function(t){var e=t.split(":");return 1===e.length||(e.indexOf("win")<0||!v.a.mac)&&(e.indexOf("mac")<0||v.a.mac)&&(e.indexOf("app")<0||v.a.isNativeApp())}},{key:"pushStack",value:function(t){for(var e=0,i={},r=0;r<t.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=t[r];i[a.keyCode]=a}return this.hotkeyStack.push(i),i}},{key:"pushStackEscape",value:function(t){return this.pushStack([this.createEscape(t)])}},{key:"popStack",value:function(t){this.hotkeyStack.pop(t)}},{key:"getHotkey",value:function(t){var e,i=A[t.normCode];if(i)for(var r=0,a=0;a<i.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n,o,u,s,h=i[a],d=!h.mods;if(d||(n=!!h.mods[S.Ctrl]===!!t.ctrlKey,o=!!h.mods[S.Meta]===!!t.metaKey,u=!!h.mods[S.Alt]===!!t.altKey,s=!!h.mods[S.Shift]===!!t.shiftKey),d||n&&o&&u&&s){e=h.name;break}}return e}},{key:"create",value:function(t,e,i,r,a,n){try{u.default.PAssert(491,u.default.isNumber(t),"Invalid keyCode")}catch(h){u.default.reportError(h)}try{u.default.PAssert(492,u.default.isBoolean(e),"Invalid isGlobal")}catch(h){u.default.reportError(h)}try{u.default.PAssert(493,u.default.isFunction(a),"Invalid callback")}catch(h){u.default.reportError(h)}var o={keyCode:t,mods:{},callback:a,isGlobal:e};return i!==s.a.Primary.Yes&&i!==s.a.Primary.Both&&i!==s.a.Primary.Only||(o.mods[this.platformPrimaryKey]=!0),i!==s.a.Primary.No&&i!==s.a.Primary.Never&&i!==s.a.Primary.Both||(o.mods[this.platformSecondaryKey]=!0),n&&v.a.mac&&(o.mods[S.Alt]=!0),r===s.a.Shift.Yes&&(o.mods[S.Shift]=!0),o}},{key:"addHotkeyNew",value:function(t){t.mods={},t.primary&&(t.mods[this.platformPrimaryKey]=!0),t.secondary&&(t.mods[this.platformSecondaryKey]=!0),t.option&&(t.mods[S.Alt]=!0),t.shift&&(t.mods[S.Shift]=!0);var e=t.keyCode;A[e]||(A[e]=[]),A[e].push(t)}},{key:"createEscape",value:function(t){return this.create(s.a.KeyCode.Escape,!0,s.a.Primary.Either,s.a.Shift.Either,t)}},{key:"addHotkey",value:function(t,e,i,r,a,n,o,h){try{u.default.PAssert(494,i,"Must supply a valid keycode")}catch(d){u.default.reportError(d)}v.a.app&&!isNaN(r)&&r!==s.a.Primary.Both&&r!==s.a.Primary.Never&&r!==s.a.Primary.Only&&(r=s.a.Primary.Either),this._addHotkey(t,e,i,r,a,n,o,h)}},{key:"_addHotkey",value:function(t,e,i,r,a,n,o,h){try{u.default.PAssert(495,i,"Must supply a valid keycode")}catch(c){u.default.reportError(c)}if(!h||!v.a.windows){if(A[i]=A[i]||[],r===s.a.Primary.Either)return this._addHotkey(t,e,i,s.a.Primary.No,a,n,o,h),void this._addHotkey(t,e,i,s.a.Primary.Yes,a,n,o,h);if(a===s.a.Shift.Either)return this._addHotkey(t,e,i,r,s.a.Shift.No,n,o,h),void this._addHotkey(t,e,i,r,s.a.Shift.Yes,n,o,h);try{u.default.PAssert(496,!v.a.windows||r!==s.a.Primary.Both,"Should never require AltGr combo on windows")}catch(c){u.default.reportError(c)}var d=this.create(i,e,r,a,n,h);d.stopPropagation=o,d.name=t,A[i].push(d)}}},{key:"registerArrowsMode",value:function(t,e,i,r,a,n){var o=this["arrowsModeIndex"+t]=new y.a(-1);return!0===e?this._enterArrowsMode(t,i,r,a):this._addHotkey(t,!0,e.keyCode,e.primary,e.shift,this._onKeyDownArrowsMode.bind(this,t,i,r,a,n)),o}},{key:"getArrowsModeObs",value:function(t){return this["arrowsModeIndex"+t]}},{key:"isInArrowsMode",value:function(t){return this.currentArrowsMode&&this.currentArrowsMode.name===t}},{key:"exitArrowsMode",value:function(t){this.isInArrowsMode(t)&&this._exitArrowsMode()}},{key:"_onKeyDownArrowsMode",value:function(t,e,i,r,a){this.currentArrowsMode?this._exitArrowsMode():this._exitingArrowsMode&&this._exitingArrowsMode.name===t||this._enterArrowsMode(t,e,i,r,a)}},{key:"_enterArrowsMode",value:function(t,e,i,r,a){this.currentArrowsMode={name:t,cbGetMax:e,cbSelect:i,cbKey:r,cbOnHotkey:a},a&&a(),document.addEventListener("mousedown",this.onMouseDownArrowsMode,!0),this["arrowsModeIndex"+t].set(-1)}},{key:"_exitArrowsMode",value:function(){this.currentArrowsMode&&(document.removeEventListener("mousedown",this.onMouseDownArrowsMode,!0),this.getArrowsModeObs(this.currentArrowsMode.name).set(-1),this.currentArrowsMode=void 0)}},{key:"onMouseDownArrowsMode",value:function(t){this._exitArrowsMode()}},{key:"_updateArrowsMode",value:function(t){var e=this.currentArrowsMode,i=this.getArrowsModeObs(e.name),r=v.a.getKeyCode(t),a=i.get(),n=e.cbGetMax();if(r===s.a.KeyCode.Enter)a>=0&&e.cbSelect(a),this._exitArrowsMode();else if(r===s.a.KeyCode.Escape)this._exitArrowsMode();else if(r===s.a.KeyCode.UpArrow)a>0&&i.set(a-1);else if(r===s.a.KeyCode.DownArrow)a<n-1&&i.set(a+1);else if(e.cbKey){var o=e.cbKey(r,t);o>=0&&(e.cbSelect(o),this._exitArrowsMode(),t.stopPropagation(),t.preventDefault())}}},{key:"checkToggleSearchFilter",value:function(t){var e=u.default.focusedPane;return!(!e||!e.search.isFocused.get())&&(e.search.toggleFilterDefault(t),!0)}},{key:"checkToggleSearchPriority",value:function(t){var e=u.default.focusedPane;return!(!e||!e.search.isFocused.get())&&(e.search.getFilterValue("priority")===t&&(t=0),e.search.setFilter("priority",t),!0)}},{key:"hotkeyNewItem",value:function(){h.default.menus.openItemEditor({addOnSave:!0,element:u.default.element("newItemButton")})}},{key:"hotkeyAddPane",value:function(){h.default.menus.openAddPaneMenu({element:u.default.element("addPaneButton")})}},{key:"hotkeySearch",value:function(){var t=u.default.focusedPane||h.default.PaneManager.getPaneAtIndex(0);if(t){var e=t.search;e.isFocused.get()||e.focus()}}},{key:"hotkeyGoto",value:function(){u.default.focusedPane.applyToSelection(function(t){return h.default.PaneManager.scrollToAndHighlightItem(t,u.default.focusedPane),!1})}},{key:"hotkeyOverview",value:function(){u.default.focusedPane&&u.default.focusedPane.toggleOverviewVisibility()}},{key:"hotkeyComplete",value:function(){var t,e=m.a.getSelectedItems();m.a.isValid()&&1===e.length&&!e[0].isComplete()&&(t=!0),u.default.beginCompleteAction(),u.default.focusedPane.applyFnToSelection("setComplete",{toggle:"isComplete",value2:s.a.ChangeType.Local}),t&&u.default.focusedPane.selectNearestItem(m.a.getStartIndex()),u.default.endCompleteAction(),u.default.sendEvent("Hotkey","Complete")}},{key:"_hotkeyPriorityHelper",value:function(t){u.default.focusedPane&&!this.checkToggleSearchPriority(t)&&u.default.focusedPane.applyPriorityToSelection(t,!0)}},{key:"hotkeyPriority1",value:function(){this._hotkeyPriorityHelper(s.a.VMLIFlag.P0)}},{key:"hotkeyPriority2",value:function(){this._hotkeyPriorityHelper(s.a.VMLIFlag.P1)}},{key:"hotkeyPriority3",value:function(){this._hotkeyPriorityHelper(s.a.VMLIFlag.P2)}},{key:"hotkeyPriorityNone",value:function(){u.default.focusedPane.applyPriorityToSelection(s.a.VMLIFlag.None)}},{key:"hotkeyStar",value:function(){this.checkToggleSearchFilter("starred")||u.default.focusedPane.applyFnToSelection("setStarred",{toggle:"isStarred",value2:s.a.ChangeType.Local})}},{key:"selectPaneAtIndex",value:function(t){if(t>=0&&t<h.default.PaneManager.paneCount()){var e=h.default.PaneManager.getPaneAtIndex(t);if(e&&(m.a.focusPane(e),!m.a.isValid()&&e.isEditable)){var i=e.indexOfFirstItem();e.selectIndex(i),e.scrollIndexIntoView(i,s.a.ScrollDuration.Default)}}}},{key:"hotkeySelectPane1",value:function(){this.selectPaneAtIndex(0)}},{key:"hotkeySelectPane2",value:function(){this.selectPaneAtIndex(1)}},{key:"hotkeySelectPane3",value:function(){this.selectPaneAtIndex(2)}},{key:"hotkeySelectPane4",value:function(){this.selectPaneAtIndex(3)}},{key:"hotkeySelectPane5",value:function(){this.selectPaneAtIndex(4)}},{key:"hotkeySelectPane6",value:function(){this.selectPaneAtIndex(5)}},{key:"hotkeySelectPane7",value:function(){this.selectPaneAtIndex(6)}},{key:"hotkeySelectPane8",value:function(){this.selectPaneAtIndex(7)}},{key:"hotkeySelectPane9",value:function(){this.selectPaneAtIndex(8)}},{key:"hotkeySelectPane10",value:function(){this.selectPaneAtIndex(9)}},{key:"hotkeyPreviousPane",value:function(){var t=h.default.PaneManager,e=t.getFocusedPaneIndex()-1;e<0&&(e=t.paneCount()-1),this.selectPaneAtIndex(e)}},{key:"hotkeyNextPane",value:function(){var t=h.default.PaneManager,e=t.getFocusedPaneIndex()+1;e>=t.paneCount()&&(e=0),this.selectPaneAtIndex(e)}},{key:"hotkeyZoomIn",value:function(){u.default.focusedPane&&u.default.focusedPane.applyToSelection(function(t){return t.isNote()||u.default.focusedPane.zoomIn(t),!1})}},{key:"hotkeyZoomOut",value:function(){var t=u.default.focusedItem;t&&t.parent()&&u.default.focusedPane.zoomOut(t.parent())}},{key:"hotkeyCollapse",value:function(){u.default.focusedPane.applyToSelection(function(t){u.default.focusedPane.supportCollapsing&&t.toggleCollapsed(u.default.focusedPane)})}},{key:"hotkeyCollapseAll",value:function(){u.default.focusedItem&&u.default.focusedPane&&u.default.focusedPane.supportCollapsing&&u.default.focusedPane.toggleCollapseAll()}},{key:"hotkeyCollapseRecursive",value:function(){var t,e=u.default.focusedPane;u.default.focusedPane.applyToSelection(function(i,r,a,n){e.supportCollapsing&&(void 0===t&&(t=!e.isPaneObjectCollapsed(n)),e.collapseAll(i,t,!0))})}},{key:"hotkeyIndent",value:function(){g.default.compoundOperation(function(){m.a.isValid()&&g.default.handleTab()})}},{key:"hotkeyUnindent",value:function(){g.default.compoundOperation(function(){m.a.isValid()&&g.default.handleTab(!0)})}},{key:"hotkeyMoveUp",value:function(){g.default.moveUp()}},{key:"hotkeyMoveDown",value:function(){g.default.moveDown()}},{key:"hotkeySelectItem",value:function(){g.default.handleSelectAllItem()}},{key:"hotkeyClosePane",value:function(t){var e=h.default.PaneManager.removeFocusedPane();void 0!==e&&(d.e.performAction(d.c.UIAction,{type:d.d.RemovePane,data:e}),h.default.tooltip.hideTip(),t.stopImmediatePropagation())}},{key:"hotkeyBold",value:function(t){return m.a.isValid()&&u.default.vmMain.applyFormatToSelection("**"),t.preventDefault(),!1}},{key:"hotkeyItalic",value:function(t){return m.a.isValid()&&u.default.vmMain.applyFormatToSelection("*"),t.preventDefault(),!1}},{key:"hotkeyUnderline",value:function(t){return m.a.isValid()&&u.default.vmMain.applyFormatToSelection("__"),t.preventDefault(),!1}},{key:"hotkeyInsertLink",value:function(t){m.a.isValid()&&m.a.getStartItem().insertLinkAtSelection();return t.preventDefault(),!1}},{key:"hotkeyMoveAutocomplete",value:function(){u.default.focusedPane&&m.a.isValid()&&u.default.focusedPane.autocompleteMove()}},{key:"hotkeyJumpAutocomplete",value:function(){var t=u.default.focusedPane;if(t){var e=t.search,i={};e.isFocused.get()?i.elementDisplay=e.getSearchBox():t!==u.default.focusedPane&&(m.a.focusPane(t),i.elementDisplay=e.getSearchBox()),t.autocompleteJump(i)}}},{key:"hotkeyUndo",value:function(){l.default.hasRawSelection()&&u.default.elementInNonPaneEdit(l.default.getSelectionNode())||(u.default.focusedPane?u.default.focusedPane.handleUndo():k.a.undo())}},{key:"hotkeyRedo",value:function(){l.default.hasRawSelection()&&u.default.elementInNonPaneEdit(l.default.getSelectionNode())||(u.default.focusedPane?u.default.focusedPane.handleRedo():k.a.redo())}},{key:"hotkeyPrefixHeader",value:function(){u.default.vmMain.applyPrefixToSelection(s.a.Prefix.Header)}},{key:"hotkeyPrefixTask",value:function(t){u.default.vmMain.applyPrefixToSelection(s.a.Prefix.Task)}},{key:"hotkeyPrefixBullet",value:function(t){u.default.vmMain.applyPrefixToSelection(s.a.Prefix.Bullet)}},{key:"hotkeyPrefixNumList",value:function(t){u.default.vmMain.applyPrefixToSelection(s.a.Prefix.NumList)}},{key:"hotkeyEmailCompose",value:function(){var t=u.default.vmMain.getDefaultEmailPlugin();t.isEnabled()?h.default.menus.openComposeEmail(t):h.default.toasts.pushMessage(s.a.MessageID.NeedGmailPermission)}},{key:"hotkeyPreviousBoard",value:function(){f.a.hotkeyPrevBoard()}},{key:"hotkeyNextBoard",value:function(){f.a.hotkeyNextBoard()}},{key:"hotkeySelectBoard1",value:function(){f.a.selectBoard(0)}},{key:"hotkeySelectBoard2",value:function(){f.a.selectBoard(1)}},{key:"hotkeySelectBoard3",value:function(){f.a.selectBoard(2)}},{key:"hotkeySelectBoard4",value:function(){f.a.selectBoard(3)}},{key:"hotkeySelectBoard5",value:function(){f.a.selectBoard(4)}},{key:"hotkeySelectBoard6",value:function(){f.a.selectBoard(5)}},{key:"hotkeySelectBoard7",value:function(){f.a.selectBoard(6)}},{key:"hotkeySelectBoard8",value:function(){f.a.selectBoard(7)}},{key:"hotkeySelectBoard9",value:function(){f.a.selectBoard(8)}},{key:"hotkeySelectBoard10",value:function(){f.a.selectBoard(9)}},{key:"hotkeyAddToCalendar",value:function(){var t=h.default.pluginManager.getPluginGCalendar();t&&t.isActive()&&!t.isPluginBlocked()&&u.default.focusedPane.applyToSelection(function(e){return t.createEventForItem(e)})}},{key:"hotkeyEditNote",value:function(){u.default.focusedPane&&(h.default.PaneUpdateBatcher.beginUpdateItems(),u.default.focusedPane.clearPreventUpdate(),u.default.focusedPane.applyToSelection(function(t){t.isNote()||m.a.editNote(t)}),h.default.PaneUpdateBatcher.commitUpdateItems())}},{key:"hotkeyHelp",value:function(){h.default.intro.toggle(s.a.HelpMode.Normal)}},{key:"hotkeyHelpHotkeys",value:function(){h.default.intro.toggle(s.a.HelpMode.Hotkeys)}},{key:"hotkeySettings",value:function(){h.default.menus.openSettings()}},{key:"hotkeyDeleteItem",value:function(){u.default.focusedPane.deleteSelected()}},{key:"hotkeyZoomInApp",value:function(){h.default.nativeBridge.sendToApp("zoomIn")}},{key:"hotkeyZoomOutApp",value:function(){h.default.nativeBridge.sendToApp("zoomOut")}},{key:"hotkeyDate",value:function(){if(m.a.isValid()){var t=m.a.getStartIndex(),e=m.a.getStartItem(),i=m.a.getPane(),r=m.a.getStartOffset();if(t>=0){var a=i.elementAtIndex(t);a&&h.default.menus.openContextMenu({componentName:"ReactContextMenuDate",element:a,item:e,pane:i,textOffset:r>=0?r:e.getParsedText().length})}}}},{key:"hotkeyNoop",value:function(){}},{key:"callbackOnPane",value:function(t,e,i){var r=u.default.focusedPane;return r&&r.onHotkey&&r.onHotkey(t,e,i),!1}},{key:"printHotkeyByName",value:function(t,e){var i=this.config[e||"Pane"][t];try{u.default.PAssert(497,i,"Getting an invalid hotkey")}catch(o){u.default.reportError(o)}if(i)for(var r=0,a=0;a<i.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=i[a];if(this.isValidPlatform(n))return this.printHotkey(n)}}},{key:"printHotkey",value:function(t){for(var e=0,i=t.split(":"),r=i[i.length-1].split("+"),a="",n=0;n<r.length;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=r[n];n>0&&(a+=v.a.windows?" + ":" "),a+="Pr"===o?v.a.priModKey:"Se"===o?v.a.secModKeyForce:"Sh"===o?v.a.mac?"\u21e7":"Shift":"Op"===o?"\u2325":2===o.length&&"D"===o[0]?o[1]:"Slash"===o?"/":"Tilde"===o?"~":"LeftArrow"===o?"\u2190":"RightArrow"===o?"\u2192":"UpArrow"===o?"\u2191":"DownArrow"===o?"\u2193":"Period"===o?".":"Comma"===o?",":"Equals"===o?"=":"Plus"===o?"+":"Dash"===o?"-":"Backspace"===o?v.a.mac?"Delete":o:o.endsWith("Bracket")?o.startsWith("L")?"[":"]":o}return a}},{key:"__dbgCheckHotkeyOverlap",value:function(t,e){for(var i=0,r=e.mods,a=A[t],n=0;n<a.length;++n){var o=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var s=a[n].mods,h=!0,d=0;d<4;d++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(r[d]!==s[d]){h=!1;break}}if(h){if(s[this.platformPrimaryKey]&&r[this.platformPrimaryKey])try{u.default.PAssert(498,!1,"Overlapping hotkey: ",e)}catch(c){u.default.reportError(c)}if(s[this.platformSecondaryKey]&&r[this.platformSecondaryKey])try{u.default.PAssert(499,!1,"Overlapping hotkey: ",e)}catch(c){u.default.reportError(c)}}}}}]),t}();e.a=new w},,function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(17),s=i.n(u),h=i(9),d=i.n(h),c=i(18),v=i.n(c),y=i(0),g=i(1),l=i(4),p=i(3),m=i(39),f=i(2),k=i.n(f),A=i(20),S=i(13),w=i(76),L=function(t){function e(){return a()(this,e),s()(this,d()(e).apply(this,arguments))}return v()(e,t),o()(e,[{key:"init",value:function(){this.createObservables({isHovered:!1})}},{key:"getElement",value:function(){var t=this.refs.element;return t.getElement?t.getElement():t}},{key:"closeMenu",value:function(){!1!==this.props.canClose&&l.default.menus.closeContextMenu()}},{key:"onClick",value:function(t){var e=this.props;e.hasButtons||this.didClickJustFire||!e.onClick||(!1!==e.clickCloses&&this.closeMenu(),e.onClick(t),this.didClickJustFire=!0,setTimeout(function(){this.didClickJustFire=!1}.bind(this),300))}},{key:"onClickIcon",value:function(t){var e=this.props;e.onClickIcon?(this.closeMenu(),e.onClickIcon(t)):this.onClick(t)}},{key:"onMouseDown",value:function(t){(this.props.onClickIcon||y.default.hasClass(t.target,"fancyContextMenuIcon"))&&t.preventDefault()}},{key:"onMouseUp",value:function(t){var e=this.props;!isNaN(t.button)&&t.button!==g.a.ButtonCode.Left||p.a.mac&&t.ctrlKey||e.onClickIcon&&y.default.hasClass(t.target,"fancyContextMenuIcon")||this.onClick(t)}},{key:"onMouseEnter",value:function(t){this.isHovered.set(!0),this.props.onMouseEnter&&this.props.onMouseEnter(t)}},{key:"onMouseLeave",value:function(){this.isHovered.set(!1)}},{key:"render",value:function(){var t,e=this.props,i=this.state,r=e.onClick||e.hoverEffects,a=y.default.classNames("fancyContextMenuItem",{flexbox:!e.customLayout},{"c-foreground":!e.faded},{"c-foreground-faded":e.faded},{"c-popup-item":r&&!1!==e.hoverEffects},{selected:e.selected||!1!==e.hoverEffects&&i.isHovered},{active:e.active},{disabled:e.disabled},{hasIcon:!!e.icon},{hasContent:!!e.children},{bold:e.bold},{hasHotkey:e.hotkey},{"flex-center":e.center},{hasButtons:e.hasButtons},this.props.className);if(e.icon)if(e.onClickIcon)t=k.a.createElement(S.a,{className:"fancyContextMenuIcon",icon:e.icon,tooltip:e.iconTooltip,width:36,height:e.height||28,onClick:this.onClickIcon});else{var n=y.default.classNames("fancyContextMenuIcon c-foreground-faded",e.icon),o={fontSize:e.iconSize,height:e.height,lineHeight:e.height&&e.height+"px",color:e.iconColor};t=k.a.createElement("span",{className:n,style:o,onClick:this.onClickIcon,"data-tooltip":e.iconTooltip})}var u,s=e.hotkey;if(s){var h=y.default.classNames("fancyContextMenuHotkey c-foreground-faded",{centered:e.hotkeyCentered}),d=y.default.isString(s)?s:m.a.printHotkeyByName(s.name,s.group);u=k.a.createElement("span",{className:h},d)}var c=e.style||{};c.height=e.height,c.lineHeight=e.height&&e.height+"px",c.cursor=r?"pointer":"";var v={id:e.id,className:a,"data-tooltip":e.tooltip,onMouseOver:e.onMouseOver,style:c,ref:"element"};return r&&(v.onMouseDown=e.onClick&&!p.a.isMobile?this.onMouseDown:void 0,v.onMouseUp=e.onClick&&!e.noMouseUp?this.onMouseUp:void 0,v.onClick=e.onClick&&(e.noMouseUp||p.a.isMobile)?this.onMouseUp:void 0,v.onMouseEnter=p.a.isMobile||!1===e.hoverEffects?void 0:this.onMouseEnter,v.onMouseLeave=p.a.isMobile||!1===e.hoverEffects?void 0:this.onMouseLeave),k.a.createElement(e.onClick?w.a:"div",v,t,u?k.a.createElement("span",{className:"f1"},e.children):e.children,u)}}]),e}(A.a);e.a=L},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(0),s=i(1),h=i(4),d=[" ","-","/","[","]","(",")","*","_","@",".",":"],c=function(){function t(){a()(this,t)}return o()(t,[{key:"getPreviousWord",value:function(t,e,i){for(var r=0,a=i-1;a>=0;a--){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=e[a];if(u.default.shouldLog(s.a.LogLevels.Edit)&&console.log(a,n),d.indexOf(n)>=0&&!this.isInsideMarkup(t,a))return a}return-1}},{key:"getNextWord",value:function(t,e,i){for(var r=0,a=i+1;a<e.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=e[a];if(d.indexOf(n)>=0&&!this.isInsideMarkup(t,a,!0))return a}return e.length}},{key:"moveLeft",value:function(t,e){if(h.default.settings.showMarkdown.get())e--;else{var i=0;do{if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e--}while(e>0&&this.isInsideMarkup(t,e,!1))}return e}},{key:"moveRight",value:function(t,e,i){var r=e;if(h.default.settings.showMarkdown.get())r++;else{var a=0;do{if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;r++}while(r<=i&&this.isInsideMarkup(t,r-1,!0))}return e<i-3&&r>i&&(r=i),r}},{key:"isInsideMarkup",value:function(t,e,i,r){if(!h.default.settings.showMarkdown.get())for(var a=0,n=t.getEls(),o=0;o<n.length;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var u=n[o],s=u.getOrigTextLength();if(e<s)return(r?u.hasClass(r):u.isMarkdown()||u.isMDImage()||!!i&&u.hasClass("itemPrefix"))?u:void 0;e-=s}}}]),t}();e.a=new c},,function(t,e,i){"use strict";i.r(e);var r=i(0),a=i(1),n=i(4),o=i(3),u=i(10),s=i(79),h=i(5),d=i(23),c=i(14),v={None:0,Item:1,Multiselect:2,Overview:3};function y(){this.swipeMode=v.None,this.swipeX=0,this.swipePoints=[],this.multiselectAnimate=!1,this.multiselectOffset=new u.a(0),this.topBarMode=new u.a(a.a.TopBarMode.Normal),this.bottomBarHeight=new s.a([c.a.onlineStatus],this.getBottomBarHeight.bind(this)),this._isDisabled=!1}y.prototype={init:function(){},isSwiping:function(){return this._isSwiping},disable:function(){this._isDisabled=!0},enable:function(){this._isDisabled=!1},isDisabled:function(){return this._isDisabled||r.default.isKeyboardOpen},start:function(t){if(this.enable(),r.default.focusedPane.isOverviewVisible()&&t.clientX>this.overviewWidth())return!0},update:function(t){if(!this.isDisabled()){var e=r.default.getItemForElement(t.startSrc);this.swipeMode===v.None&&(r.default.focusedPane.isOverviewVisible()?this.swipeMode=v.Overview:Math.abs(t.distanceY)<r.default.ClickThreshold&&Math.abs(t.diffX)>r.default.ClickThreshold&&(this.isInMultiselect()?this.swipeMode=v.Multiselect:e&&r.default.isVMLI(e)&&!e.isNote()&&(this.swipeMode=v.Item)));var i=t.diffX;if(this.swipePoints.splice(0,0,{time:Date.now(),x:t.xThisFrame}),this.swipePoints.length>20&&this.swipePoints.splice(this.swipePoints.length-1,1),this.swipeMode===v.Multiselect)i=r.default.clamp(-a.a.RightMenuWidth+i,-a.a.RightMenuWidth,0),this.updateMultiselectPosition(i);else if(this.swipeMode===v.Overview)i=r.default.clamp(this.overviewWidth()+i,0,this.overviewWidth()),r.default.focusedPane.updatePosition(i,!1);else if(this.swipeMode===v.Item&&e){var n=r.default.getCellForElement(t.target);try{r.default.PAssert(607,n,"Expected cell for swipe")}catch(u){r.default.reportError(u)}n&&(i=r.default.clamp(i,-o.a.windowWidth(),o.a.windowWidth()),n.isAnimatingOffsetX=!1,n.offsetX.set(i))}this.lastX=t.diffX}return this.swipeMode!==v.None&&t.preventDefault(),this.swipeMode!==v.None},onClickPane:function(t){var e=r.default.focusedPane;!this.isDisabled()&&e.isOverviewVisible()&&(h.a.closeKeyboard(),this.setOverviewVisibility(e,!1))},end:function(t){var e=r.default.focusedPane,i=this.swipeMode!==v.None;if(!this.isDisabled())if(this.swipeMode===v.Item){var n=r.default.getItemForElement(t.startSrc);if(n){var u=r.default.getCellForElement(t.target);try{r.default.PAssert(608,u,"Expected cell and item for swipe")}catch(A){r.default.reportError(A)}if(u){var s=e.getSwipeMenuItem(n,u.offsetX.get());u.isAnimatingOffsetX=!0,u.offsetX.set(0),s.fn&&s.fn(n)}}}else if(this.swipeMode===v.Multiselect||this.swipeMode===v.Overview){for(var d,c,y=0,g=Date.now(),l=0,p=0,m=0;m<this.swipePoints.length;m++){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;var f=this.swipePoints[m];if(!(g-f.time<300))break;l+=f.x,p=g-f.time}var k=l?l/(p/1e3):0;k<-200?d=0:k>200?d=1:this.swipeMode===v.Overview?d=Math.round((this.overviewWidth()+this.lastX)/o.a.windowWidth()):this.swipeMode===v.Multiselect&&(d=Math.round(this.lastX/a.a.RightMenuWidth)),this.swipeMode===v.Overview?(c=d>0,this.setOverviewVisibility(e,c),c&&h.a.closeKeyboard()):this.swipeMode===v.Multiselect&&(c=0===d,this.setMultiselectVisibility(c))}return this.swipeMode=v.None,this.swipePoints.length=0,i},setOverviewVisibility:function(t,e){t.updatePosition(e?this.overviewWidth():0,!0),t.overview.setVisibility(e)},toggleOverviewVisibility:function(t){var e=!(t=t||r.default.focusedPane).isOverviewVisible();this.setOverviewVisibility(t,e)},overviewWidth:function(){return Math.min(Math.floor(.85*o.a.windowWidth()),400)},isInMultiselect:function(){return 0!==this.multiselectOffset.get()},updateMultiselectPosition:function(t,e){this.multiselectAnimate=e,this.multiselectOffset.set(t),this.topBarMode.set(0!==t?a.a.TopBarMode.Multiselect:a.a.TopBarMode.Normal),0!==t&&h.a.closeKeyboard()},setMultiselectVisibility:function(t){this.updateMultiselectPosition(t?-a.a.RightMenuWidth:0,!0),t||(r.default.focusedPane.search.hideNonMatches(),d.a.reset())},setTopBarMode:function(t){this.topBarMode.set(t)},resetTopBarMode:function(){var t=this.topBarMode.get();t===a.a.TopBarMode.Multiselect?this.setMultiselectVisibility(!1):t===a.a.TopBarMode.Note&&(n.default.menus.closeContextMenu(),h.a.reset()),this.topBarMode.set(a.a.TopBarMode.Normal)},getBottomBarHeight:function(){return a.a.MobileBottomHeight+(c.a.onlineStatus.get()!==a.a.OnlineStatus.Online?14:0)}},e.default=new y},function(t,e,i){"use strict";var r,a=i(7),n=i.n(a),o=i(8),u=i.n(o),s=i(0),h=i(4),d=i(3),c=i(19),v=i(1),y=i(33),g=i(5),l=function(){function t(){n()(this,t),this.softDays=["today","tomorrow"],this.dayModifiers=["next"],this.days=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],this.months=["january","february","march","april","may","june","july","august","september","october","november","december"],this.repeatStart=["every"],this.dict=this.repeatStart.concat(this.softDays).concat(this.dayModifiers).concat(this.days).concat(this.months)}return u()(t,[{key:"findMatchLike",value:function(t){for(var e=0,i=t.toLowerCase(),r=[],a=0;a<this.dict.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;0===this.dict[a].indexOf(i)&&r.push({type:"date",text:this.dict[a]})}return r}},{key:"findMatchExact",value:function(t){if(this.dict.indexOf(t)>=0)return{type:"date",text:t}}}]),t}(),p=i(15),m=i.n(p),f=i(16),k=new(r=function(){function t(){n()(this,t)}return u()(t,[{key:"tagComparator",value:function(t,e){return t.localeCompare(e)}},{key:"tagComparatorNumber",value:function(t,e){var i=t.count,r=e.count;return i===r?t.text.localeCompare(e.text):i>r?-1:1}},{key:"findMatchExact",value:function(t){return!1}},{key:"findMatchLike",value:function(t,e,i){var r={},a=[],n=t.toLowerCase(),o={comparator:function(t){if(!t.isComplete()){var e=t.getTagsLower();if(e)for(var i=0,o=0;o<e.length;o++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var u=e[o];if(!n||u.startsWith(n)&&u!==n){if(!r[u]){var s=r[u]={type:"tag",text:u,count:0};a.push(s)}r[u].count++}}}}};return i?o.item=i:o.itemStore=h.default.itemStoreManager.getDefaultItemStore(),s.default.searchVMLIs(o),a.sort(this.tagComparatorNumber),a.length>e&&(a=a.slice(0,e)),a}},{key:"printStats",value:function(t){var e=0;s.default.log("--- Tag stats ---",t);for(var i=this.findMatchLike("",100),r=0;r<i.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;console.log(i[r].text,i[r].count)}}},{key:"getAll",value:function(){return this.findMatchLike("")}}]),t}(),m()(r.prototype,"tagComparatorNumber",[f.a],Object.getOwnPropertyDescriptor(r.prototype,"tagComparatorNumber"),r.prototype),r),A=new(function(){function t(){n()(this,t)}return u()(t,[{key:"findMatchLike",value:function(t,e,i){var r=t.toLowerCase(),a=[];return s.default.searchVMLIs({item:i,comparator:function(t){return!t.isComplete()},each:function(t){var i=!1;r?(t.getPrefix()+t.getSearchText()).indexOf(r)>=0&&(i=!0):i=t.isPrefixHeader();if(i&&a.push({type:"item",text:t.getParsedText(),item:t}),a.length>=e)return!1}}),a}},{key:"findMatchExact",value:function(t,e){}}]),t}()),S=new(function(){function t(){n()(this,t),this.accountID=void 0}return u()(t,[{key:"setAccountID",value:function(t){this.accountID=t}},{key:"findMatchLike",value:function(t,e){for(var i=0,r=s.default.vmMain.getDefaultEmailPlugin(),a=r.getLabels(this.accountID,t,e),n=[],o=0;o<a.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;a[o].isSystemLabel()||n.insertSorted(a[o],r.labelSortFn)}return n.map(function(t){return{type:v.a.AutocompleteMode.GmailLabel,text:t.getName(),label:t}})}},{key:"findMatchExact",value:function(t,e){}}]),t}()),w=i(51),L=i(14),F=function(){function t(){n()(this,t),this.matches=new y.a,this._isShowing=!1,this._isTempDisabled=!1,this._showNoMatches=!1,this._searchInfo=void 0,this.owner=void 0,this.elementInput=void 0,this.text=void 0,this._prefixes=[v.a.ContactPrefix,v.a.TagPrefix,v.a.PrefixItemAutocomplete],this._prefixMap={},this.autocompleteDates=new l,this._prefixMap[v.a.ContactPrefix]=w.a,this._prefixMap[v.a.TagPrefix]=k,this._prefixMap[v.a.PrefixItemAutocomplete]=A,c.a.binder(this,"onClosed","onSelectedFromPane"),this.supportedModes=null}return u()(t,[{key:"isShowing",value:function(){return this._isShowing}},{key:"getText",value:function(){return this.text}},{key:"getProviderForPrefix",value:function(t){return this._prefixMap[t]}},{key:"_checkPrefixes",value:function(t,e){for(var i=0,r=t.startsWith("-")?1:0,a=0;a<this._prefixes.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=this._prefixes[a];if((n!==v.a.PrefixItemAutocomplete||e)&&t[r]===n)return{length:r+1,prefix:n}}}},{key:"_findClosestWithPrefix",value:function(t,e,i,r){for(var a,n=0,o=t.split(/\s/),u=0,h=-1,d=-1,c=-1,y=0,g=0;g<o.length&&u<=e;++g){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var l=o[g];o[h]===a&&(y=0);var p=this._checkPrefixes(l,r.canAutocompleteItems);p?(h=g,c=(d=u)+l.length,y=p.length,a=p.prefix):y&&a!==v.a.TagPrefix&&(c+=l.length+1),u+=l.length+1}if(y&&e>=d&&e<=c){var m=t.substr(d+y,c-d-y);return s.default.shouldLog(v.a.LogLevels.Autocomplete)&&s.default.log("closest is",a,"--",m),{mode:i,text:t,prefix:a,searchText:m,start:d+y,end:c}}}},{key:"_findClosestDelimited",value:function(t,e,i){var r,a=0;r=i===v.a.AutocompleteMode.Item?[t]:t.split(",");for(var n=!1,o=0,u=-1,h=-1,d=0;d<r.length&&o<=e;++d){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var c=r[d];u=o+this._numStartSpaces(c),h=o+c.length-this._numEndSpaces(c),u<e&&e<=h&&c.length>0?(n=!0,s.default.shouldLog(v.a.LogLevels.Autocomplete)&&s.default.log("phrase",c,c.length),s.default.shouldLog(v.a.LogLevels.Autocomplete)&&s.default.log("start char",u,t[u]),s.default.shouldLog(v.a.LogLevels.Autocomplete)&&s.default.log("end char",h,t[h])):n=!1,o+=c.length+1}if(n||this._showNoMatches){var y=t.substr(u,h-u+1);return s.default.shouldLog(v.a.LogLevels.Autocomplete)&&s.default.log("closest is",y),{mode:i,text:t,searchText:y,start:u,end:h}}}},{key:"_findClosestVMLIElement",value:function(t,e,i,r){for(var a,n,o,u=0,s=0,h=!1,d=0;d<e.length&&!1===h;d++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var c=e[d].getParsedText();if(a=s+this._numStartSpaces(c),n=s+c.length-1-this._numEndSpaces(c),a<i&&i<=n+1&&c.length>0){h=d,o=c.trim();break}s+=c.length}if(!1!==h)return{mode:r,text:t,prefix:"",searchText:o,start:a,end:n,el:e[d]}}},{key:"_numStartSpaces",value:function(t){for(var e=0,i=0,r=0;r<t.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(" "!==t[r])break;i++}return i}},{key:"_numEndSpaces",value:function(t){for(var e=0,i=0,r=t.length-1;r>=0;r--){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(" "!==t[r])break;i++}return i}},{key:"insertMatch",value:function(t){var e=this._searchInfo,i=e.text,r=i.substr(0,e.start),a=i.substr(e.end,i.length),n=e.start+t.length;" "!==a[0]&&t&&" "!==t[t.length-1]&&(t+=" ",n++);var o=r+t+a;return s.default.shouldLog(v.a.LogLevels.Autocomplete)&&s.default.log(r,r.length,a,a.length),s.default.shouldLog(v.a.LogLevels.Autocomplete)&&s.default.log(o),{text:o,offset:n}}},{key:"onSelectedFromPane",value:function(t){t.owner.setText(t.value,v.a.ChangeType.Local),g.a.selectIndex(t.index,t.offset)}},{key:"prefixForMode",value:function(t){return"contact"===t&&v.a.ContactPrefix||"tag"===t&&v.a.TagPrefix||void 0}},{key:"startMobileAutocomplete",value:function(t){var e=t.mode,i=this.prefixForMode(e),r="date"===e?"Enter date":"Search "+e.capitalize()+"s";this.showPopup({mode:e,text:r,allowCustom:"date"===e,buttonText:"Add",pane:t.pane,onSelected:function(e){var r=t.owner;if(r){var a=r.getParsedText();a=a+(a.endsWith(" ")?"":" ")+i+e.value,r.setText(a,v.a.ChangeType.Local),d.a.isMobile||g.a.selectIndex(t.index,a.length)}}})}},{key:"updateFromPane",value:function(t){var e=t.owner.getParsedText()||"";if(!(t.start<=1)||"#"!==e&&"+"!==e){var i=t.element.getBoundingClientRect(),r=h.default.Measure.getCaretScreenPosition(t.pane,t.index,t.start);this.update({mode:"all",text:e,pane:t.pane,offset:t.start,owner:t.owner,item:t.owner,positionOffset:{left:r.left-i.left,top:0},fromPane:!0,indexInPane:t.index,elementDisplay:t.element,position:d.a.isMobile?"full":void 0,onSelected:this.onSelectedFromPane})}}},{key:"update",value:function(t){var e=t.text,i=t.offset,r=t.mode,a=t.item;if(t.owner===this.owner&&t.elementInput===this.elementInput||(this._isTempDisabled=!1),t.showNoMatches&&(this._showNoMatches=!0),this.text=t.text,this._isTempDisabled||!t.text&&!this._showNoMatches)this.matches.set([]),this._showNoMatches||this.hide();else{this.owner=t.owner,this.elementInput=t.elementInput;e=t.text;var n=null,o=null;this._searchInfo="all"===r?this._findClosestWithPrefix(e,t.offset,t.mode,t):this._findClosestDelimited(e,t.offset,t.mode);if(this._searchInfo){if(this.text=this._searchInfo.searchText,"all"===r)o=this.getProviderForPrefix(this._searchInfo.prefix);else switch(r){case v.a.AutocompleteMode.Move:case v.a.AutocompleteMode.Jump:case v.a.AutocompleteMode.Item:o=A;break;case v.a.AutocompleteMode.Email:n=(o=this._prefixMap[v.a.ContactPrefix]).findEmailsLike(this._searchInfo.searchText.trim(),100);break;case v.a.AutocompleteMode.Contact:o=this._prefixMap[v.a.ContactPrefix];break;case v.a.AutocompleteMode.Tag:o=this._prefixMap[v.a.TagPrefix];break;case v.a.AutocompleteMode.Date:case v.a.AutocompleteMode.Snooze:o=this.autocompleteDates;break;case v.a.AutocompleteMode.GmailLabel:var u=s.default.vmMain.getDefaultEmailPlugin()._getAccountIDFromItem(t.item);(o=S).setAccountID(u);break;default:try{s.default.PAssert(237,!1,"Unknown autocomplete mode: ",r)}catch(g){s.default.reportError(g)}}if(null===n){var c,y=t.pane;c=y&&y.type===v.a.PaneMode.Task?y.getRootItem():t.item?t.item:L.a.getDefaultDocument().getRootItem(),n=o.findMatchLike(this._searchInfo.searchText,100,c)}d.a.isMobile||1!==n.length||o.findMatchExact(this._searchInfo.searchText,n)&&(n=[])}this._searchInfo&&0!==n.length||!a||a.getRawText().includes(v.a.CharDate)||e[i-1]!==v.a.PrefixDate||!(i<2||" "===e[i-2]||e[i-2]===v.a.AttachChar)||e[i]&&" "!==e[i]&&e[i]!==v.a.AttachChar||h.default.menus.openContextMenu(Object.assign({componentName:"ReactContextMenuDate",item:t.item,textOffset:t.offset,element:t.elementDisplay,onClosed:function(){var e=t.owner&&t.owner.onDatePickerClosed;e&&e()}},t)),n=n||[],t.supportSearchItemAutocomplete&&"all"===r&&0===n.length&&t.parsedEls&&(this._searchInfo=this._findClosestVMLIElement(e,t.parsedEls,t.offset,r)),this.matches.set(n),!this._isShowing&&n.length>0&&!this._isTempDisabled&&!t.noShow?this.show(t):0===n.length&&(this._showNoMatches||this.hide(),this._isTempDisabled=!1)}}},{key:"clearDisabled",value:function(){this._isTempDisabled=!1}},{key:"onClosed",value:function(){this._isShowing=!1,this._owner=null,this.matches.clear()}},{key:"show",value:function(t){var e=d.a.isMobile&&"email"===t.mode;this._isShowing=!0,this._showNoMatches=!!t._showNoMatches,this._owner=t.owner,t.componentName="ReactAutocomplete",t.onClosed=this.onClosed,h.default.menus.openContextMenu(t,e)}},{key:"showPopup",value:function(t){this._isShowing=!0,this._showNoMatches=!0,t.componentName="ReactAutocomplete",t.onClosed=this.onClosed,d.a.isMobile&&(t.position="full"),h.default.menus.openContextMenu(t)}},{key:"hide",value:function(){this._isShowing&&(this._isShowing=!1,h.default.menus.closeContextMenu("ReactAutocomplete"))}}]),t}();e.a=new F},,function(t,e,i){"use strict";var r=i(287);i(317),i(448),i(320);e.a=r},,function(t,e,i){"use strict";var r,a=i(7),n=i.n(a),o=i(8),u=i.n(o),s=i(15),h=i.n(s),d=i(0),c=i(1),v=i(4),y=i(3),g=i(10),l=i(55),p=i(14),m=i(79),f=i(33),k=i(16),A=function(){function t(e){n()(this,t),this.id=e.id,this.name=new g.a(e.name),this.panes=e.panes,this.index=e.index,this.defaultPanes=e.defaultPanes}return u()(t,[{key:"getSaveInfo",value:function(){var t={id:this.id,name:this.name.get(),index:this.index};return this.panes&&(t.panes=this.panes.map(d.default.cloneWithoutUndefineds)),this.defaultPanes&&(t.defaultPanes=this.defaultPanes.map(d.default.cloneWithoutUndefineds)),t}}]),t}(),S=i(121),w=i(35),L=c.a.TaskViewMode,F=1,C=(r=function(){function t(){var e=this;n()(this,t),this._isSaving=!1,this._isAdding=!1,this._localState=void 0,this._selectionState=void 0,this._boards=new f.a,this.selectedIndex=new g.a,this.selected=new m.a([this.selectedIndex],function(){return e.get()}),this.selectedChanged=new l.a}return u()(t,[{key:"init",value:function(){this.load()}},{key:"setIsAdding",value:function(t){this._isAdding=t}},{key:"isAdding",value:function(){return this._isAdding}},{key:"add",value:function(t){this.setIsAdding(!0);var e=new A({id:this.getNextID(),name:this.getNextName(),panes:t||[],index:""+this._boards.length()});return this._boards.push(e),this.saveBoard(e),e}},{key:"removeBoard",value:function(t){if(this._boards.length()>1){var e=this._boards.indexOf(t),i=this.selectedIndex.get();this._boards.remove(t),!isNaN(i)&&i>=e&&this.setSelectedIndex(i-1),p.a.deleteBoard(t.id),this._localState&&delete this._localState[t.id]}}},{key:"length",value:function(){return this._boards.length()}},{key:"ensureSelected",value:function(){if(y.a.isMobile)v.default.PaneManager.onLoadRemote(),v.default.PaneManager.updateDisplayPanes();else{var t=this.selectedIndex.get();(void 0===t||t<0||t>=this.length())&&this.setSelectedIndex(0,!0),v.default.PaneManager.updateDisplayPanes()}}},{key:"setSelectedIndex",value:function(t,e){var i=t!==this.selectedIndex.get();this.selectedIndex.set(t),(e||!1!==e&&i)&&this.selectedChanged.notify(),this._selectionState!==t&&(this._selectionState=t,v.default.settings.selectedBoard.set(this._selectionState))}},{key:"switchTo",value:function(t,e){var i=this._boards.indexOf(t);this.setSelectedIndex(i,e)}},{key:"_findMatchingLocalPane",value:function(t,e){var i;if(e)for(var r=0,a=0;a<e.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(e[a].id===t){i=e[a];break}}return i}},{key:"_generateUsablePaneState",value:function(t,e){for(var i=0,r=[],a=0;a<t.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=t[a],o=this._findMatchingLocalPane(n.id,e)||n;r.push(d.default.cloneWithoutUndefineds({id:n.id,name:n.name,item:n.item,document:n.document||p.a.getDefaultDocument().id,type:n.type,showarch:n.showarch,search:n.search,viewState:n.viewState||(n.viewMode?{viewMode:n.viewMode}:void 0),displayLocalItems:n.displayLocalItems,displayCalendars:n.displayCalendars,blocksCollapsed:n.blocksCollapsed,documentSortMode:n.documentSortMode,widthManual:n.widthManual,widthManualExpanded:n.widthManualExpanded,offset:o?o.offset:0,itemState:o?o.itemState:{},isOverviewVisible:!!o&&o.isOverviewVisible,isOverviewShowingContents:!!o&&o.isOverviewShowingContents,isExpanded:!!o&&o.isExpanded,selectedItem:o?o.selectedItem:void 0}))}return r}},{key:"hasLoadedPaneState",value:function(){return!!this._localState}},{key:"getPaneState",value:function(){var t=this.get();return t?this._generateUsablePaneState(t.panes||[],this._localState[t.id]):[]}},{key:"_generateSyncPaneState",value:function(t){for(var e=0,i=[],r=0;r<t.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=t[r];i.push({id:a.id,name:a.name,item:a.item,type:a.type,document:a.document,showarch:a.showarch,search:a.search,viewState:a.viewState,displayCalendars:a.displayCalendars,displayLocalItems:a.displayLocalItems,widthManual:a.widthManual,widthManualExpanded:a.widthManualExpanded,blocksCollapsed:a.blocksCollapsed,documentSortMode:a.documentSortMode})}return i}},{key:"_generateLocalPaneState",value:function(t){for(var e=0,i=[],r=0;r<t.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=t[r];i.push({id:a.id,offset:a.offset,itemState:a.itemState,isOverviewVisible:a.isOverviewVisible,isOverviewShowingContents:a.isOverviewShowingContents,isExpanded:a.isExpanded,selectedItem:a.selectedItem})}return i}},{key:"savePaneState",value:function(t){if(this._boards.length()>0)try{this._saveSyncState(t),this._saveLocalState(t),this.saveBoard()}catch(e){d.default.reportError(e,{numBoards:this._boards.length(),selectedIndex:this.selectedIndex.get()})}}},{key:"_saveLocalState",value:function(t){var e=this.get().id;try{d.default.PAssert(579,e,"Must have a valid board ID")}catch(r){d.default.reportError(r)}var i=this._generateLocalPaneState(t);this._localState[e]=i}},{key:"_saveSyncState",value:function(t){var e=this.get();try{d.default.PAssert(580,e,"Selected board does not exist")}catch(i){d.default.reportError(i)}e&&(e.panes=this._generateSyncPaneState(t))}},{key:"renameBoard",value:function(t,e){if(t.name.get()!==e){for(var i=0,r=!1,a=0;a<this._boards.length();a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=this._boards.get()[a];n!==t&&n.name.get()===e&&(r=!0)}if(!r)return t.name.set(e),this.saveBoard(t),this.selected.notify(),!0}return!1}},{key:"saveBoardDefault",value:function(t){t.defaultPanes=d.default.clone(t.panes),this.saveBoard(t)}},{key:"restoreBoardDefault",value:function(t){t.panes=d.default.clone(t.defaultPanes),this.selectedChanged.notify()}},{key:"get",value:function(){var t=this.selectedIndex.get();if(void 0!==t)return this._boards.get()[t]}},{key:"createDefaultState",value:function(){if(0===this._boards.length()){var t=p.a.getDefaultDocument(),e=[];if(t){var i=t.getRootItem();e=[new A({id:p.a.generateID(),name:"Tasks",index:"0",panes:[{document:t.id,item:i.id,type:c.a.PaneMode.Task,viewState:{viewMode:L.Outline},isOverviewVisible:!0}]}),new A({id:p.a.generateID(),name:"Today",index:"1",panes:[{document:t.id,item:i.id,type:c.a.PaneMode.Task,viewState:{viewMode:L.Agenda_Today},isOverviewVisible:!0}]}),new A({id:p.a.generateID(),name:"Calendar",index:"2",panes:[{document:t.id,item:i.id,type:c.a.PaneMode.Task,viewState:{viewMode:L.Calendar_Week}}]})],v.default.pluginManager.isEnabled(c.a.PluginID.Gmail)&&e.splice(2,0,new A({id:p.a.generateID(),name:"Email",index:"1,0",panes:[{type:c.a.PaneMode.Gmail,isOverviewVisible:!0,isExpanded:!0}]}))}return this._boards.set(e),this.saveAll(),this.setSelectedIndex(0,!0),e}}},{key:"getNextName",value:function(){var t,e,i=0,r=this._boards.get(),a=1;do{var n=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t=!1,e="Board "+a,a++;for(var o=0;o<r.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r[o].name.get()===e){t=!0;break}}}while(t);return e}},{key:"getNextID",value:function(){return 1e3*Math.floor(Math.random())+"I"+Date.now()+"Z"+ ++F}},{key:"load",value:function(){var t,e;if(d.default.isDemoMode())e=this.createDefaultState(),t={};else if(this.trackPaneState()){var i=p.a.getBoards();(e=Object.keys(i).map(function(t){return new A(i[t])})).sort(w.a.compareItemIndex);try{t=v.default.settings.localPaneState.get()||{}}catch(r){t={}}}else t={};this._localState=t,e&&e.length>0&&(this._selectionState=v.default.settings.selectedBoard.get(),void 0===this._selectionState&&(this._selectionState=0),!isNaN(this._selectionState)&&this._selectionState>=e.length&&(this._selectionState=e.length-1),this._boards.set(e),this.setSelectedIndex(this._selectionState,!0))}},{key:"setBoards",value:function(t){this._boards.set(t),this.ensureSelected()}},{key:"saveAll",value:function(){var t=this;this.trackPaneState()&&this._boards.get().forEach(function(e){t.saveBoard(e)})}},{key:"saveBoard",value:function(t){if(this.trackPaneState()){t||(t=this.get());var e=t.getSaveInfo();p.a.saveBoard(e),v.default.settings.localPaneState.set(d.default.cloneWithoutUndefineds(this._localState))}}},{key:"trackPaneState",value:function(){return!d.default.isRunningScript()&&!d.default.isDemoMode()}},{key:"onSettingChanged",value:function(){this._isSaving||this.load()}},{key:"moveTo",value:function(t,e){var i=this._boards.get(),r=i[t],a=this.get();this._boards.splice(t,1,void 0,!1);var n=i[e-1],o=i[e],u=Object(S.a)(n?n.index:void 0,o?o.index:void 0);r.index=u,this._boards.splice(e,0,r);var s=this._boards.indexOf(a);s>=0&&this.setSelectedIndex(s,!1),this.saveBoard(r)}},{key:"cloneBoard",value:function(t,e){var i;(t=t||this.get(),e)?i=[e.getSaveInfoForClone()]:i=t.panes;try{d.default.PAssert(581,i,"Must have valid panes to clone a board")}catch(a){d.default.reportError(a)}var r=this.add(i);return this.switchTo(r),r}},{key:"getById",value:function(t){return this._boards.get().find(function(e){return e.id===t})}},{key:"onRemoteUpdate",value:function(t,e){var i=e.id,r=e.name,a=e.panes,n=e.index,o=e.defaultPanes,u=this.getById(i),s=this.get();if(t===c.a.CrudActions.Removed)u&&this.removeBoard(u);else if(u){var h=u.index!==n||!u.panes.equals(a,!0);try{u.name.set(r),u.index=n,u.panes=a,u.defaultPanes=o,h&&(this._boards.sort(w.a.compareItemIndex),this.switchTo(s,u===s))}catch(v){d.default.reportError(v,u.name)}}else this._boards.insertSorted(new A({id:i,name:r,panes:a,index:n,defaultPanes:o}),w.a.compareItemIndex),this.switchTo(s)}},{key:"hotkeyPrevBoard",value:function(){var t=this.selectedIndex.get()-1;t<0&&(t=this.length()-1),this.setSelectedIndex(t)}},{key:"hotkeyNextBoard",value:function(){var t=this.selectedIndex.get()+1;t>=this.length()&&(t=0),this.setSelectedIndex(t)}},{key:"selectBoard",value:function(t){t>=0&&t<this.length()&&this.setSelectedIndex(t)}},{key:"clear",value:function(){this._boards.clear()}}]),t}(),h()(r.prototype,"saveAll",[k.a],Object.getOwnPropertyDescriptor(r.prototype,"saveAll"),r.prototype),h()(r.prototype,"saveBoard",[k.a],Object.getOwnPropertyDescriptor(r.prototype,"saveBoard"),r.prototype),h()(r.prototype,"hotkeyPrevBoard",[k.a],Object.getOwnPropertyDescriptor(r.prototype,"hotkeyPrevBoard"),r.prototype),h()(r.prototype,"hotkeyNextBoard",[k.a],Object.getOwnPropertyDescriptor(r.prototype,"hotkeyNextBoard"),r.prototype),h()(r.prototype,"selectBoard",[k.a],Object.getOwnPropertyDescriptor(r.prototype,"selectBoard"),r.prototype),r);e.a=new C},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(17),s=i.n(u),h=i(9),d=i.n(h),c=i(24),v=i.n(c),y=i(18),g=i.n(y),l=i(0),p=i(19),m=i(1),f=i(4),k=i(120),A=i(21),S=i(14),w=function(){function t(){a()(this,t),this.undoStack=[],this.redoStack=[],this.isUndoing=!1,this._deleteSelection=void 0,this._batch=[],this._isBatching=!1,this._batchPrevSel=void 0,this._groupTextChanges=!1,this._needsSelection=!1,p.a.binder(this,"_onSelectionChanged"),A.a.listen("selectionChanged",this._onSelectionChanged)}return o()(t,[{key:"_getLastState",value:function(){return this.undoStack[this.undoStack.length-1]}},{key:"_getLastAction",value:function(){var t=this.undoStack[this.undoStack.length-1];if(t&&1===t.actions.length)return t.actions[0]}},{key:"pushModified",value:function(t,e,i){if(!this.isUndoing){var r=!1;if("text"in e){var a=this._getLastAction(),n=this._getLastState();this._needsSelection=!0,this._groupTextChanges&&n&&a&&a.itemId===t.id&&(a.changes.text=e.text,r=!0)}r||this._doPush(t,{type:m.a.CrudActions.Modified,changes:e,prevState:i}),this.clearDeleteSelection()}}},{key:"pushAdded",value:function(t,e,i){try{l.default.PAssert(737,!this._deleteSelection,"Should not still have delete selection when adding")}catch(r){l.default.reportError(r)}this.isUndoing||(this._doPush(e,{type:m.a.CrudActions.Added,changes:{parent:t.id,index:i}}),this.clearDeleteSelection())}},{key:"pushRemoved",value:function(t,e,i){this.isUndoing||(this._doPush(e,{type:m.a.CrudActions.Removed,prevSel:this._deleteSelection,changes:{parent:t.id,index:i}}),this.clearDeleteSelection())}},{key:"clearDeleteSelection",value:function(){this._isBatching||(this._deleteSelection=void 0)}},{key:"_doAction",value:function(t){if(!this.isUndoing)try{var e=t?this.redoStack:this.undoStack,i=t?this.undoStack:this.redoStack,r=e.pop();if(r){var a=r.actions;try{l.default.PAssert(738,a.length>0,"Undo state should have some actions")}catch(n){l.default.reportError(n)}a.length>0&&(this.isUndoing=!0,f.default.PaneUpdateBatcher.beginUpdateItems(),l.default.focusedPane.clearPreventUpdate(),a.forEach(function(e){var i=e.type,r=i===m.a.CrudActions.Added||i===m.a.CrudActions.Removed?e.changes:t?e.changes:e.prevState;t||(i===m.a.CrudActions.Added?i=m.a.CrudActions.Removed:i===m.a.CrudActions.Removed&&(i=m.a.CrudActions.Added));var a=S.a.getItem(e.itemId);if(a){var n=a.getDocumentOwner();i===m.a.CrudActions.Removed?n.getBacking().deleteItem(n,a,m.a.ChangeType.Local):S.a.saveItem(a,r,m.a.ChangeType.Local,m.a.SaveFlag.All),k.a.onRemoteChange(n,i,e.itemId,r)}}),f.default.PaneUpdateBatcher.commitUpdateItems(),this.restoreSelFromState(t,r),i.push(r))}}finally{this.isUndoing=!1}}},{key:"restoreSelFromState",value:function(t,e){}},{key:"undo",value:function(){this._doAction(!1)}},{key:"redo",value:function(){this._doAction(!0)}},{key:"_onSelectionChanged",value:function(t){var e=this._getLastState();e&&this._needsSelection?(this._needsSelection=!1,e.selection=t,this._groupTextChanges=!0):this._groupTextChanges=!1}},{key:"saveDeleteSelection",value:function(){}},{key:"beginAction",value:function(){this._isBatching=!0}},{key:"endAction",value:function(){this._batch.length>0&&(this.undoStack.push({prevSel:this._batchPrevSel,actions:this._batch}),this._batch=[]),this._isBatching=!1,this._deleteSelection=void 0}},{key:"clearGroupTextChanges",value:function(){this._needsSelection=!1,this._groupTextChanges=!1}}]),t}(),L=i(5),F=function(t){function e(){return a()(this,e),s()(this,d()(e).apply(this,arguments))}return g()(e,t),o()(e,[{key:"_doPush",value:function(t,e){this.redoStack=[];var i=e.prevSel||L.a.getSavedSelection()||L.a.save();e.itemId=t.id,L.a.isValid()&&(e.selection=L.a.save(!0)),this._isBatching?(this._batchPrevSel=i,this._batch.push(e)):this.undoStack.push({prevSel:i,actions:[e]})}},{key:"restoreSelFromState",value:function(t,e){var i=t?e.selection:e.prevSel;i&&L.a.restore(i,!0)}},{key:"saveDeleteSelection",value:function(){this._deleteSelection=L.a.save()}},{key:"pushRemoved",value:function(t,i,r){if(!this.isUndoing)try{l.default.PAssert(533,this._deleteSelection,"Must have saved delete selection before deleting")}catch(a){l.default.reportError(a)}v()(d()(e.prototype),"pushRemoved",this).call(this,t,i,r)}}]),e}(w);e.a=new F},function(t,e,i){"use strict";var r,a=i(7),n=i.n(a),o=i(8),u=i.n(o),s=i(15),h=i.n(s),d=i(0),c=i(4),v=i(1),y=/^(?:\+?1[-. ]?)?(?:\(?([0-9]{3})\)?[-. ]?)?([0-9]{3})[-. ]?([0-9]{4})$/,g=function(){function t(e){var i=0,r=0;n()(this,t);try{d.default.PAssert(244,d.default.isObject(e),"Should always supply a valid object to init a contact")}catch(u){d.default.reportError(u)}this.id=e.id,this.type="contact",this.text=e.text||"",this.phoneNumbers=e.phoneNumbers||[],this.emails=e.emails||[];for(var a=0;a<this.phoneNumbers.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=this.phoneNumbers[a];o.link=this.formatPhone(o.number),o.type=o.type?o.type[0].toLowerCase():""}for(a=0;a<this.emails.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;this.emails[a].link="mailto:"+this.emails[a].address}}return u()(t,[{key:"formatPhone",value:function(t){if(y.test(t)){var e=t.match(y),i="";return e[1]&&(i+="+1-"+e[1]+"-"),"tel:"+(i+=e[2]+"-"+e[3])}var r=t.replace(/\D+/g,"");try{d.default.PAssert(245,r&&""!==r,"Invalid phone number format: "+t)}catch(a){d.default.reportError(a)}return t.startsWith("+")&&(r="+"+r),"tel:"+r}}]),t}(),l=i(34),p=i(33),m=i(25),f=i(16),k=(r=function(){function t(){n()(this,t),this._contactCache={},this._contacts=new p.a,this._contactsByName={},this._contactNames={},this.areContactsLoaded=!1}return u()(t,[{key:"init",value:function(){var t=this;c.default.settings.syncContacts.listen(function(e){e&&t.refreshContacts()})}},{key:"loadContacts",value:function(t){var e=!1,i=!!t;if(!this.areContactsLoaded){var r=t||m.a.getContacts();try{d.default.PAssert(128,0===this._contacts.get().length,"Should only load contacts once")}catch(h){d.default.reportError(h)}if(this.areContactsLoaded=!0,r){for(var a=0,n=[],o=0;o<r.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var u=r[o];if(u.name&&(u.text=u.name,r[o].text=u.name,delete r[o].name,e=!0),!i&&u.isDemo||u.text&&!u.phoneNumbers&&!u.emails)e=!0;else{if(u.text){var s=d.default.escape(u.text);this._contactNames[s]="",this._contactsByName[u.text]=u,n.push(u)}try{d.default.PAssert(129,u.id,"Each contact must have a valid id")}catch(h){d.default.reportError(h)}}}this._contacts.set(n)}else this.clearContacts()}return e}},{key:"addContact",value:function(t){try{d.default.PAssert(130,t.id,"Incoming contacts must have a valid id")}catch(c){d.default.reportError(c)}try{d.default.PAssert(131,t.text,"All contacts are expected to have a text")}catch(c){d.default.reportError(c)}var e=this._contactsByName[t.text];if(t.emails){for(var i=0,r=[],a=0;a<t.emails.length;a++){var n=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var o=t.emails[a],u=!1,s=0;s<r.length;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(r[s].address.toLowerCase()===o.address.toLowerCase()){u=!0;break}}u||r.push(o)}t.emails=r}if(e)t.emails&&(e.emails||(e.emails=[]),e.emails.pushOnlyUniques(t.emails,this.emailComparator)),t.phoneNumbers&&(e.phoneNumbers||(e.phoneNumbers=[]),e.phoneNumbers.pushOnlyUniques(t.phoneNumbers,this.phoneComparator));else if(this._contacts.insertSorted(t,this.contactComparator),t.text){var h=d.default.escape(t.text);this._contactNames[h]="",this._contactsByName[t.text]=t}this._contactCache[t.id]&&(this._contactCache[t.id]=new g(t))}},{key:"updateContact",value:function(t){var e=0;try{d.default.PAssert(132,t.id,"Incoming contacts must have a valid id")}catch(n){d.default.reportError(n)}try{d.default.PAssert(133,t.text,"All contacts are expected to have a text")}catch(n){d.default.reportError(n)}for(var i=!1,r=0;r<this._contacts.get().length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._contacts.get()[r];if(a.id===t.id){a.text=t.text,a.emails=a.phoneNumbers=void 0,this.addContact(t),i=!0;break}}if(!i)return this.addContact(t),!0}},{key:"clearContacts",value:function(){this._contactCache={},this._contacts.clear(),this._contactsByName={},this._contactNames={}}},{key:"numContacts",value:function(){return this._contacts.get().length}},{key:"getContacts",value:function(){return this._contactNames}},{key:"getAll",value:function(){return this._contacts.get()}},{key:"contactComparator",value:function(t,e){return t.text&&e.text?t.text.localeCompare(e.text):t.text&&!e.text?1:!t.text&&e.text?-1:void 0}},{key:"emailComparator",value:function(t,e){return t.address.toLowerCase()===e.address.toLowerCase()}},{key:"emailComparatorSort",value:function(t,e){return t.address&&e.address?t.address.toLowerCase().localeCompare(e.address.toLowerCase()):t.address&&!e.address?1:!t.address&&e.address?-1:void 0}},{key:"phoneComparator",value:function(t,e){return t===e||t.number===e.number}},{key:"ensureCacheObject",value:function(t){try{d.default.PAssert(134,t,"Must have valid data to store in cache")}catch(i){d.default.reportError(i)}if(this._contactCache[t.id])return this._contactCache[t.id];var e=new g(t);return this._contactCache[t.id]=e,e}},{key:"findMatchExact",value:function(t){var e=this._contactsByName[t];if(e)return this.ensureCacheObject(e)}},{key:"findMatchLike",value:function(t,e){var i=0;try{d.default.PAssert(135,void 0!==t,"Must provide a valid contact part")}catch(y){d.default.reportError(y)}for(var r=t.toUpperCase(),a=[],n=this._contacts.get(),o=0;o<n.length;++o){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var u=n[o],s=!1;if(u.text.toUpperCase().indexOf(r)>=0&&(s=!0),u.emails)for(var h=0,c=0;!s&&c<u.emails.length;++c){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(u.emails[c].address.toUpperCase().indexOf(r)>=0){s=!0;break}}if(u.phoneNumbers){var v=0;for(c=0;!s&&c<u.phoneNumbers.length;++c){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;if(u.phoneNumbers[c].number.indexOf(r)>=0){s=!0;break}}}if(s&&(a.push(this.ensureCacheObject(u)),a.length>=e))break}return a.sort(this.contactComparator),a}},{key:"findContactByEmail",value:function(t){for(var e=0,i=0;i<this._contacts.get().length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this._contacts.get()[i];if(r.emails)for(var a=0,n=0;n<r.emails.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if(r.emails[n].address===t)return r}}}},{key:"findEmailsLike",value:function(t,e){var i=0;try{d.default.PAssert(136,void 0!==t,"Must provide a valid email part")}catch(v){d.default.reportError(v)}e=e||20;for(var r=[],a=t.toUpperCase(),n=0;n<this._contacts.get().length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=this._contacts.get()[n];if(o&&o.emails){var u=0,s=!1;o.text&&o.text.toUpperCase().indexOf(a)>=0&&(s=!0);for(var h=0;h<o.emails.length;++h){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var c=o.emails[h].address;(s||c.toUpperCase().indexOf(a)>=0)&&r.push({type:"contact",text:o.text,email:c})}}if(r.length>=e)break}return r.sort(this.emailComparatorSort),r}},{key:"save",value:function(){this.clearLocalContacts(),m.a.saveContacts(this._contacts.get())}},{key:"clearLocalContacts",value:function(){m.a.clearContacts()}},{key:"handleRemoteContactLoad",value:function(t,e){var i=0,r=this.numContacts();d.default.log("Loading Remote Contacts!",t.length);for(var a=0;a<t.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=t[a],o={id:n.resourceName.replace("people/",""),text:""};if(n.names&&n.names.length>0){var u=n.names[0].displayName;o.text=u,"'"===o.text[0]&&(o.text=o.text.substr(1))}if(!o.text&&n.organizations){for(var s=0,h=0;h<n.organizations.length;h++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var y=n.organizations[h];y.metadata&&y.metadata.primary&&(o.text=y.name)}o.text||(o.text=n.organizations[0].name)}if(n.emailAddresses){var g=0;o.emails=[];for(var l=0;l<n.emailAddresses.length;l++){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;var p=n.emailAddresses[l],m={address:p.value,type:p.type,isPrimary:p.metadata&&p.metadata.primary};o.emails.push(m),!o.text&&m.isPrimary&&(o.text=m.address)}!o.text&&o.emails.length>0&&(o.text=o.emails[0].address)}if(n.phoneNumbers){var f=0;o.phoneNumbers=[];for(var k=0;k<n.phoneNumbers.length;k++){if(f++>5e3&&__infLoop&&__infLoop(f))throw new RangeError;var A=n.phoneNumbers[k],S={number:A.value,type:A.type,isPrimary:A.metadata&&A.metadata.primary};o.phoneNumbers.push(S)}}o.text?0===r?this.addContact(o):this.updateContact(o):d.default.shouldLog(v.a.LogLevels.Data)&&d.default.log("Contact entry with no name or email address",n)}t.length>0&&(this.save(),c.default.PaneUpdateBatcher.updateAllItems(!1,!0)),e&&e(t.length)}},{key:"syncContactInfo",value:function(t,e){var i=this;l.a.getAccountAuthToken(t,[v.a.GScope.Contacts],function(t){var r,a=[],n=t&&t.access_token,o=function(t){var n;try{n=JSON.parse(t.response)}catch(o){}if(n){try{d.default.PAssert(137,d.default.isArray(n.connections),"Connections are not array")}catch(u){d.default.reportError(u)}d.default.isArray(n.connections)&&a.pushArray(n.connections),n.nextPageToken?r(n.nextPageToken):i.handleRemoteContactLoad(a,e)}};r=function(t){var e="https://people.googleapis.com/v1/people/me/connections?personFields=names,emailAddresses,phoneNumbers,organizations&access_token=".concat(n)+(t?"&pageToken=".concat(t):"");d.default.XHR({type:"GET",url:e,cb:o})},n&&r()})}},{key:"refreshContacts",value:function(t){return!!c.default.settings.syncContacts.get()&&(this.syncContactInfo(c.default.settings.getUserIdentifier(),function(e){t&&t()}),!0)}}]),t}(),h()(r.prototype,"refreshContacts",[f.a],Object.getOwnPropertyDescriptor(r.prototype,"refreshContacts"),r.prototype),r);e.a=new k},,,function(t,e,i){"use strict";var r,a=i(38),n=i.n(a),o=i(7),u=i.n(o),s=i(8),h=i.n(s),d=i(15),c=i.n(d),v=i(0),y=i(1),g=i(4),l=i(21),p=i(5),m=i(6),f=i(16),k=(r=function(){function t(){u()(this,t),this._batchTimeout=void 0,this.itemsBatchingUpdates={}}return h()(t,[{key:"beginBatch",value:function(t,e){v.default.isEmpty(this.itemsBatchingUpdates)&&(!m.e.undoRedoActive&&e?(this._savedSelectionDrive=p.a.save(),p.a.reset()):this._savedSelectionDrive=void 0,this._batchTimeout=setTimeout(this._runUpdates,500)),this.itemsBatchingUpdates[t.id]||(this.itemsBatchingUpdates[t.id]={item:t})}},{key:"commitBatch",value:function(t){var e=this.itemsBatchingUpdates[t.id];e&&(this._runUpdate(t,e),delete this.itemsBatchingUpdates[t.id])}},{key:"itemItemsChanged",value:function(t){this.updateItem(t,y.a.ItemProp.Items)}},{key:"itemTextChanged",value:function(t){this.updateItem(t,y.a.ItemProp.Text)}},{key:"itemDateChanged",value:function(t){this.updateItem(t,y.a.ItemProp.Date)}},{key:"itemTagsChanged",value:function(t,e){this.updateItem(t,y.a.ItemProp.Tags,e)}},{key:"itemFontChanged",value:function(t){this.updateItem(t,y.a.ItemProp.Font)}},{key:"itemSearchChanged",value:function(t){this.updateItem(t,y.a.ItemProp.Search)}},{key:"updateItem",value:function(t,e,i){if(i=i||!0,this.itemsBatchingUpdates[t.id]){var r=this.itemsBatchingUpdates[t.id];r||(r=this.itemsBatchingUpdates[t.id]={item:t}),r[e]=i,this._batchTimeout&&clearTimeout(this._batchTimeout),this._batchTimeout=setTimeout(this._runUpdates,500)}else this._runUpdate(t,n()({item:t},e,i))}},{key:"_runUpdate",value:function(t,e){l.a.fireEvent("clearMeasureCacheItem",[t.id]),!t.isDestroyed()&&t.getItemStore()&&t.getItemStore().onItemChanged(t,e)}},{key:"_runUpdates",value:function(){var t=this;v.default.batchRenderUpdates(function(){for(var e in g.default.PaneUpdateBatcher.beginUpdateItems(),t.itemsBatchingUpdates)if(t.itemsBatchingUpdates.hasOwnProperty(e)){var i=t.itemsBatchingUpdates[e];t._runUpdate(i.item,i)}t.itemsBatchingUpdates={},g.default.PaneUpdateBatcher.commitUpdateItems(),t._savedSelectionDrive&&p.a.restore(t._savedSelectionDrive)})}}]),t}(),c()(r.prototype,"_runUpdate",[f.a],Object.getOwnPropertyDescriptor(r.prototype,"_runUpdate"),r.prototype),c()(r.prototype,"_runUpdates",[f.a],Object.getOwnPropertyDescriptor(r.prototype,"_runUpdates"),r.prototype),r);e.a=new k},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(117),s=function(){function t(e){a()(this,t),this._listeners=[],this._enabled=!0,e&&this._listeners.push(e)}return o()(t,[{key:"listen",value:function(t){return this._addListener(t),new u.a(this,t)}},{key:"_addListener",value:function(t){this._listeners.push(t)}},{key:"_hasListener",value:function(t){return this._listeners.indexOf(t)>=0}},{key:"unlisten",value:function(t){this._listeners.remove(t)}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1}},{key:"notify",value:function(){for(var t=0,e=arguments.length,i=new Array(e),r=0;r<e;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;i[r]=arguments[r]}if(this._enabled)for(var a=0,n=0;n<this._listeners.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;arguments.length>0?this._listeners[n](arguments[0]):this._listeners[n]()}}}]),t}();e.a=s},function(t,e,i){"use strict";var r,a=i(7),n=i.n(a),o=i(8),u=i.n(o),s=i(15),h=i.n(s),d=i(0),c=i(1),v=i(4),y=["data-href","plugin","plugin-id","appLink","tooltip","data-original-text","attachSimple","size"],g=function(){function t(e,i){n()(this,t),this._parsedText=e,this._textLength=e.length,this._attrs=i?d.default.clone(i):{},this._width=void 0}return u()(t,[{key:"setWidth",value:function(t){this._width=t}},{key:"getWidth",value:function(t){return!this.isMarkdown()||v.default.settings.showMarkdown.get()&&t?this._width:this.isAppLinkStart()?20:0}},{key:"getParsedText",value:function(){return this._parsedText}},{key:"getOrigTextLength",value:function(){return this._textLength}},{key:"setParsedText",value:function(t){this._parsedText=t}},{key:"getUnstyledText",value:function(t){var e;if(this.getAttr("plugin")){try{d.default.PAssert(711,this.getAttr("plugin-id"),"If a plugin is specified, must have the ID for that plugin as well")}catch(a){d.default.reportError(a)}var i=v.default.pluginManager.getPlugin(this._attrs.plugin),r=i.getAttachment(this.getAttr("plugin-id"));e=i.getUnstyledText(r)}else e=d.default.escape(this._parsedText);return e}},{key:"getStyledText",value:function(t,e,i,r){var a;if(this.getAttr("plugin")){try{d.default.PAssert(712,this.getAttr("plugin-id"),"If a plugin is specified, must have the ID for that plugin as well")}catch(u){d.default.reportError(u)}var n=v.default.pluginManager.getPlugin(this._attrs.plugin),o=n.getAttachment(this.getAttr("plugin-id"));a=n._getDisplayText(o,t,i,r)}else a=e?this._parsedText:d.default.escape(this._parsedText);return a}},{key:"getAttrs",value:function(){return this._attrs}},{key:"getAttr",value:function(t){var e;return this._attrs&&(e=this._attrs[t]),e}},{key:"hasAttrs",value:function(){return!!this._attrs}},{key:"getClasses",value:function(){var t;return this._attrs&&(t=this._attrs.cls),t}},{key:"hasClasses",value:function(){var t=this.getClasses();return!!t&&t.length>0}},{key:"hasClass",value:function(t){var e=!1,i=this.getClasses();return i&&(e=i.indexOf(t)>=0),e}},{key:"getClassString",value:function(){var t="",e=this.getClasses();return e&&(t=e.join(" ")),t}},{key:"addClass",value:function(t){this._attrs||(this._attrs={}),this._attrs.cls||(this._attrs.cls=[]),this._attrs.cls.push(t)}},{key:"mergeAttrs",value:function(t){if(t)if(this._attrs){var e=0;t.cls&&(this._attrs.cls?this._attrs.cls=this._attrs.cls.concat(t.cls):this._attrs.cls=t.cls);try{d.default.PAssert(713,void 0===this._attrs.plugin||void 0===t.plugin||this._attrs.plugin===t.plugin,"A single element cannot match multiple plugins")}catch(n){d.default.reportError(n)}try{d.default.PAssert(714,void 0===this._attrs["plugin-id"]||void 0===t["plugin-id"]||this._attrs["plugin-id"]===t["plugin-id"],"A single element cannot match multiple plugins")}catch(n){d.default.reportError(n)}for(var i=0;i<y.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=y[i],a=this._attrs[r]||t[r];a&&(this._attrs[r]=a)}}else this._attrs=t}},{key:"addAttr",value:function(t,e){this._attrs||(this._attrs={}),this._attrs[t]=e}},{key:"isMarkdown",value:function(){return this.hasClass("mdMarkup")}},{key:"isMDImage",value:function(){return this.hasClass("mdImage")}},{key:"isAppLinkStart",value:function(){return this.hasClass("mdMarkupStart")&&this._attrs.appLink}}]),t}(),l=i(51),p=i(16),m=", . ? ! ) ( : ; [ ] ' \" _".split(" "),f=0,k=["http","https","evernote","onenote","bear"],A=window.__PARSE_STATS={total:0,parseText:0,parseNote:0,parseSinglePlugin:0},S=/(^#|[\(\s-]#)([^\s\),*#]+)/g,w=(c.a.Regexp.Link,c.a.Regexp.LinkExc),L=/(?:^|[\s\(\[])([^\(\[#@\s]+\.(?:com|org|net|io))/gi,F=/(?:(?:\u2001|\u2003)(p:[^\u2001\u2003]+)(?:\u2001|\u2003))/gi,C=c.a.Regexp.Prefix,I=/(\#+|\^|\-|\*|\[(?: ?\])?|\]|\((?: ?\))?|\)|\+|[0-9]+\.) /gi,P=c.a.Regexp.MDLink,N=/^(-{3,})$/g,H=/\b([^<>\s]+@[^<>\s]+\.[^<>\s]+)\b/gi,M=/^(\#+|\^|\-|\*|\[(?: ?\])?|\]|\((?: ?\))?|\)|\+|[0-9]+\.) (-{3,})$/g,z=/(\*\*\*)(.*?)\1/g,D=/(\*\*)(.*?)\1/g,V=/(__)(.*?)\1/g,G=/(\*)(\u2005*?)([^\u2005|\*]+?)\2\1/gi,T=(r=function(){function t(){n()(this,t)}return u()(t,[{key:"isFlagSet",value:function(t,e){return(t&e)===e}},{key:"trimPunc",value:function(t){return t.replace(/[:,\.\'\"\)\]\*_]*$/g,"")}},{key:"generateStyledLines",value:function(t,e,i,r){for(var a=0,n=this.linesToEls(t,e),o=[],u=0;u<n.length;++u){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;o.push(v.default.ElementRenderer.render(n[u],{convertLines:!1,pane:i,highlightSearch:r}))}return o}},{key:"linesToEls",value:function(t,e){for(var i=0,r=[],a=[],n=!1,o=0;o<e.length;++o){var u=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var s=0,h=e[o].start,d=e[o].length,c=0,v=0;v<t.length;++v){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var y=t[v],l=y.getParsedText().length,p=Math.max(h-s,0);if(p<l){var m=Math.min(l-p,d-c);if(m>0){var f=y.getParsedText().substr(p,m),k=new g(f,y.getAttrs());k.getAttr("appLink")&&!n&&k.addAttr("appLinkStart",!0),a.push(k),n=!!k.getAttr("appLink"),c+=m}}s+=l}r.push(a),a=[]}return r}},{key:"replaceTextInEls",value:function(t,e,i,r){var a=0;try{d.default.PAssert(386,d.default.isArray(t),"Must supply a valid VMLIElement array")}catch(g){d.default.reportError(g)}try{d.default.PAssert(387,e,"Must be replacing at least one of parsed or styled text")}catch(g){d.default.reportError(g)}for(var n=0,o=0;o<t.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var u=t[o],s=u.getParsedText();if(i+r>=n&&i<n+u.getOrigTextLength()){var h=i-n,c=Math.min(r,s.length-h),v=s.substr(0,h),y=s.substr(h+c);e&&u.setParsedText(v+e+y);break}n+=u.getOrigTextLength()}}},{key:"getElAtOffset",value:function(t,e){for(var i=0,r=0,a=0;a<t.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=t[a],o=n.getOrigTextLength();if(e>=r&&e<r+o)return n;r+=o}}},{key:"insertEl",value:function(t,e,i,r){var a=0;try{d.default.PAssert(388,d.default.isArray(e.cls),"Must always pass in a valid classes array")}catch(S){d.default.reportError(S)}try{d.default.PAssert(389,d.default.isNumber(i),"Must have a valid start")}catch(S){d.default.reportError(S)}try{d.default.PAssert(390,d.default.isNumber(r),"Must have a valid length")}catch(S){d.default.reportError(S)}for(var n,o=0,u=r,s=0;s<t.length;++s){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var h=t[s],c=h.getParsedText();if(o<i+r&&i<o+h.getOrigTextLength()){var v=0,y=Math.max(i-o,0),l=Math.min(u,c.length),p=y+u,m=c.length-p;if(y>0){var f=c.substr(0,y);t.splice(s,0,new g(f,h.getAttrs())),v++}var k=c.substr(y,l);if((n=new g(k,h.getAttrs())).mergeAttrs(e),t.splice(s+v,1,n),v++,m>0){var A=c.substr(p,m);t.splice(s+v,0,new g(A,h.getAttrs()))}if(s+=v-1,u-=l,m>0)break}o+=h.getOrigTextLength()}return n}},{key:"_notifyParse",value:function(t){A.total++,A[t]++}},{key:"runParseSinglePlugin",value:function(t,e){return this.parseSinglePlugin(t.getRawText(),e)}},{key:"parseSinglePlugin",value:function(t,e){if(this._notifyParse("parseSinglePlugin"),!t||0===t.length)return{parsedText:void 0,els:void 0};try{d.default.PAssert(391,!f,"We do not support recursive calls to parse")}catch(o){d.default.reportError(o)}var i,r;if(f++,"\u2001"===t[0]||"\u2003"===t[0]){var a=!d.default.isFlagSet(e,c.a.ChangeType.ItemLoad),n=v.default.pluginManager.parseAttachmentEmbedString(t.slice(1,-1),a);r=[n],t=c.a.AttachChar,a&&(i=[new g(c.a.AttachChar,n.displayElement.attrs)])}else i=[new g(t)];return f--,{parsedText:t,attachments:r,els:i}}},{key:"parseNote",value:function(t){return this._notifyParse("parseNote"),{parsedText:t.getRawText(),els:[new g(t.getRawText())]}}},{key:"runParseText",value:function(t){return this.parseText(t.getRawText(),l.a.getContacts(),void 0,void 0,void 0,t)}},{key:"parseText",value:function(t,e,i,r,a,n){if(this._notifyParse("parseText"),!t||0===t.length)return{parsedText:void 0,contacts:void 0,tags:void 0,attachments:void 0,els:[]};try{d.default.PAssert(392,!f,"We do not support recursive calls to parse")}catch(zt){d.default.reportError(zt)}f++;var o,u,s,h,y,l,p,A,I,M=!1,T=t,q=t,j=0,Y=!1,X=[new g(T)];r||(C.lastIndex=0,null!==(o=C.exec(T))&&(y=o[1])&&(j=o[0].length,0===y.indexOf("#")||0===y.indexOf("^")?(I="prefixHeader",l="header"):"["===y||"[]"===y||"[ ]"===y||"]"===y||"("===y||"()"===y||"( )"===y||")"===y?(I="prefixTask icon-square-o",l="task"):"*"===y||"-"===y||"+"===y?(I="prefixBullet",l="bullet"):(I="prefixNumList",l="numList"),this.insertEl(X,{cls:["itemPrefix",I]},0,j).setWidth(c.a.PrefixWidth),q=T.substr(j)));var Q=0;for(F.lastIndex=0;null!==(o=F.exec(T));){if(Q++>5e3&&__infLoop&&__infLoop(Q))throw new RangeError;var J=v.default.pluginManager.parseAttachmentEmbedString(o[1],!0),Z=this.insertEl(X,J.displayElement.attrs,o.index,o[0].length);this.replaceTextInEls(X,c.a.AttachChar,o.index,o[0].length);var B=X.indexOf(Z);B>0&&Z.addClass("padB"),B<X.length-1&&Z.addClass("padA"),M=!0,h?h.push(J):h=[J]}var $=T.indexOf(c.a.CharDate);if($>=0&&n){var U={p:c.a.PluginID.Date,id:n.id,itemID:n.id};U.displayElement=v.default.pluginManager.createDisplayElement(U,!0);Z=this.insertEl(X,U.displayElement.attrs,$,1);this.replaceTextInEls(X,c.a.AttachChar,$,1),T=T.replace(c.a.CharDate,c.a.AttachChar),M=!0,h?h.push(U):h=[U]}var R=0,E=0,K=0,x=0,b=0;for(P.lastIndex=0;null!==(o=P.exec(q));){if(R++>5e3&&__infLoop&&__infLoop(R))throw new RangeError;var O=o[3],W=O.indexOf("://")>0?O:"http://"+O,_=!!d.default.parseEvernoteLink(O),tt=d.default.isOneNoteLink(O),et=d.default.isBearLink(O),it=_||tt||et,rt=["mdMarkup","mdMarkupStart"],at=j+o.index+o[1].length,nt="!"===o[1],ot=o[4]||"",ut=ot&&+ot.replace(/\s|=|x/g,"");nt?(this.insertEl(X,{attachSimple:"inlineImage",cls:["mdImage"],"data-href":W,"data-original-text":o[0],size:ut},j+o.index,o[0].length),Y=!0):o[2]&&(_?rt.push("evernote"):tt?rt.push("onenote"):et&&rt.push("bear"),this.insertEl(X,{cls:rt,appLink:it},j+o.index,1+o[1].length),this.insertEl(X,{cls:["mdSpan","link","c-link"].concat(d.default.isUrlImage(W)?"linkImage":[]),appLink:it,"data-href":W,"data-original-text":o[0]},at+1,o[2].length),this.insertEl(X,{cls:["mdMarkup"],appLink:it},at+1+o[2].length,2),this.insertEl(X,{cls:["mdSpan","link","c-link","mdMarkup"].concat(d.default.isUrlImage(W)?"linkImage":[]),appLink:it,"data-href":W,"data-original-text":o[0]},at+o[2].length+3,O.length+ot.length),this.insertEl(X,{cls:["mdMarkup","mdMarkupEnd"],appLink:it},at+o[2].length+ot.length+O.length+3,1),Y=!0)}if(!Y){var st,ht,dt,ct;if(w.lastIndex=0,null!==(o=w.exec(q)))dt=k.indexOf(o[3])>=0?o[2]:"http://"+o[2],st=o.index+j,ht=o[0].length,ct="!"===o[1];else if(L.lastIndex=0,null!==(o=L.exec(q))){var vt=o[0].length-o[1].length;dt=o[1].startsWith("http")?o[1]:"http://"+o[1],st=o.index+vt+j,ht=o[1].length}if(dt)if(ct)this.insertEl(X,{attachSimple:"inlineImage",cls:["mdImage"],"data-href":dt,"data-original-text":o[0]},j+o.index,o[0].length);else{var yt=d.default.parseEvernoteLink(dt),gt=d.default.isOneNoteLink(dt),lt=d.default.isBearLink(dt),pt={cls:["link","c-link"].concat(d.default.isUrlImage(dt)?"linkImage":[]),"data-href":dt};yt&&(pt.appLink=!0,pt.cls.push("evernote")),gt&&(pt.appLink=!0,pt.cls.push("onenote")),lt&&(pt.appLink=!0,pt.cls.push("bear")),this.insertEl(X,pt,st,ht)}}for(V.lastIndex=0;null!==(o=V.exec(q));){if(E++>5e3&&__infLoop&&__infLoop(E))throw new RangeError;this.isInTag(o)||this.getElAtOffset(X,o.index).hasClass("link")||(this.insertEl(X,{cls:["mdMarkup","mdMarkupStart"]},j+o.index,o[1].length),this.insertEl(X,{cls:["mdSpan","mdUnderline"]},j+o.index+o[1].length,o[2].length),this.insertEl(X,{cls:["mdMarkup","mdMarkupEnd"]},j+o.index+o[1].length+o[2].length,o[1].length))}for(z.lastIndex=0;null!==(o=z.exec(q));){if(K++>5e3&&__infLoop&&__infLoop(K))throw new RangeError;this.isInTag(o)||this.getElAtOffset(X,o.index).hasClass("link")||(this.insertEl(X,{cls:["mdMarkup","mdMarkupStart"]},j+o.index,o[1].length),this.insertEl(X,{cls:["mdSpan","mdBold","mdItalic"]},j+o.index+o[1].length,o[2].length),this.insertEl(X,{cls:["mdMarkup","mdMarkupEnd"]},j+o.index+o[1].length+o[2].length,o[1].length))}var mt=q.replace(z,"\u2005\u2005\u2005$2\u2005\u2005\u2005");for(D.lastIndex=0;null!==(o=D.exec(mt));){if(x++>5e3&&__infLoop&&__infLoop(x))throw new RangeError;this.isInTag(o)||this.getElAtOffset(X,o.index).hasClass("link")||(this.insertEl(X,{cls:["mdMarkup","mdMarkupStart"]},j+o.index,o[1].length),this.insertEl(X,{cls:["mdSpan","mdBold"]},j+o.index+o[1].length,o[2].length),this.insertEl(X,{cls:["mdMarkup","mdMarkupEnd"]},j+o.index+o[1].length+o[2].length,o[1].length))}for(mt=mt.replace(D,"\u2005\u2005$2\u2005\u2005"),G.lastIndex=0;null!==(o=G.exec(mt));){if(b++>5e3&&__infLoop&&__infLoop(b))throw new RangeError;this.isInTag(o)||this.getElAtOffset(X,o.index).hasClass("link")||(this.insertEl(X,{cls:["mdMarkup","mdMarkupStart"]},j+o.index,o[1].length),this.insertEl(X,{cls:["mdSpan","mdItalic"]},j+o.index+o[1].length+o[2].length,o[3].length),this.insertEl(X,{cls:["mdMarkup","mdMarkupEnd"]},j+o.index+o[1].length+o[2].length+o[3].length+o[2].length,o[1].length))}if(N.lastIndex=0,null!==(o=N.exec(q))&&this.insertEl(X,{cls:["mdSpan","mdHR","c-border-heavy"]},0,T.length),!h){var ft=0;for(H.lastIndex=0;null!==(o=H.exec(T));){if(ft++>5e3&&__infLoop&&__infLoop(ft))throw new RangeError;this.getElAtOffset(X,o.index).hasClass("link")||this.insertEl(X,{cls:["email","c-contact"]},o.index,o[1].length)}}if(e&&Object.keys(e).length>0){var kt=T.split(c.a.ContactPrefix);if(kt.length>1){var At=0,St=kt[0].length;for(kt=kt.slice(1),p=0;p<kt.length;p++){if(At++>5e3&&__infLoop&&__infLoop(At))throw new RangeError;var wt=kt[p],Lt=void 0;if(" "!==wt[0]&&!m.includes(wt[0])){var Ft=0;for(A=0;A<wt.length;A++){if(Ft++>5e3&&__infLoop&&__infLoop(Ft))throw new RangeError;var Ct=wt.substr(0,A+1);""===e[Ct]&&(Lt=Ct)}}Lt&&(s?s.push(Lt):s=[Lt],this.insertEl(X,{cls:["contact","c-contact"]},St,Lt.length+1)),St+=wt.length+c.a.ContactPrefix.length}}}var It=0;for(S.lastIndex=0;null!==(o=S.exec(T));){var Pt=0;if(It++>5e3&&__infLoop&&__infLoop(It))throw new RangeError;for(var Nt=o.index+o[1].length-1,Ht=o[2].length+1,Mt=o[2];m.indexOf(Mt.charAt(Mt.length-1))>=0;){if(Pt++>5e3&&__infLoop&&__infLoop(Pt))throw new RangeError;Ht--,Mt=Mt.substr(0,Mt.length-1)}Mt&&(u?u.push(Mt):u=[Mt]),this.insertEl(X,{cls:["tag","c-tag"]},Nt,Ht)}return h&&(F.lastIndex=0,T=T.replace(F,c.a.AttachChar)),f--,{parsedText:M?T:void 0,durations:void 0,tags:u,attachments:h,contacts:s,prefix:y,prefixType:l,els:X}}},{key:"isInTag",value:function(t){for(var e=0,i=t.index;i>=0;i--){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(" "===t.input[i])return!1;if("#"===t.input[i])return!0}return!1}},{key:"checkMultiplePrefixes",value:function(t){var e,i,r=0;for(I.lastIndex=0;null!==(i=I.exec(t));){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(e)i.index===e[0].length&&(t=t.substr(i.index));else{if(0!==i.index)break;e=i}}return t=t.replace(M,c.a.TextMDHR)}}]),t}(),h()(r.prototype,"runParseSinglePlugin",[p.a],Object.getOwnPropertyDescriptor(r.prototype,"runParseSinglePlugin"),r.prototype),h()(r.prototype,"runParseText",[p.a],Object.getOwnPropertyDescriptor(r.prototype,"runParseText"),r.prototype),r);e.a=new T},function(t,e,i){"use strict";var r=i(89),a=i.n(r),n=i(7),o=i.n(n),u=i(8),s=i.n(u),h=i(0),d=i(1),c=i(29),v=i(65),y={notify:"n",duration:"d",gcalId:"c",gcalCalendar:"b",completes:"x"},g=h.default.invertObject(y),l={freq:"f",byweekday:"w",byday:"b",byhour:"h",bymonth:"m",bymonthday:"d",byyearday:"y",byweekno:"n",byminute:"o",bysecond:"s",dtstart:"d",until:"u",interval:"i",count:"c"},p=h.default.invertObject(l),m=["notify","duration","gcalId","gcalCalendar","completes"],f=d.a.CalendarDayViewNumDaysPad,k=function(){function t(e,i){if(o()(this,t),e instanceof Date)this.date=e,this.dateCleared=e.clone().clearTime();else{this.rruleset=e;try{h.default.PAssert(1363,this.rruleset._rrule[0],"MooDate missing rrule in constructor",function(){return e})}catch(r){h.default.reportError(r)}}i&&(this.notify=i.notify,this.duration=i.duration,this.gcalId=i.gcalId,this.completes=i.completes,this.gcalCalendar=i.gcalCalendar)}return s()(t,[{key:"getNext",value:function(t,e,i){if(this.date)return this.date;var r=this.rruleset._rrule[0];try{h.default.PAssert(1364,r,"MooDate missing rrule",this.toData())}catch(u){h.default.reportError(u)}if(r){t||(t=new Date);var a,n=this.rruleset._rrule[0].options;n.dtstart&&n.dtstart>t?(a=n.dtstart,i&&(a=a.clone().addMinutes(1))):(e||!(n.freq<c.a.DAILY)&&(n.freq!==c.a.DAILY||n.byhour&&0!==n.byhour[0])||(t=new Date(t).clearTime()),a=new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes())));var o=this.rruleset.after(a,!0);return o&&(o=v.a.UTCtoLocal(o)),o}}},{key:"getStart",value:function(){if(this.date)return this.date;var t=this.rruleset._rrule[0].options;return v.a.UTCtoLocal(t.dtstart)}},{key:"getEnd",value:function(){var t=this.getDuration()||d.a.DefaultEventDuration;if(this.date)return new Date(this.date.getTime()+t);var e=this.rruleset._rrule[0].options;return e.until?v.a.UTCtoLocal(e.until):new Date(this.getStart().getTime()+t)}},{key:"isOnDate",value:function(t,e){return this.date?+t===+this.dateCleared:(this._nextDates||this._generateDates(),!0===this._nextDatesMap[+t])}},{key:"getDate",value:function(){return this.date}},{key:"_generateDates",value:function(){var t=this;if(!this.date&&!this._nextDates){var e=Date.now()+f*d.a.MSPerDay,i=this.rruleset.all(function(t,i){return i<f&&+t<e});this._nextDates=i.map(function(t){return v.a.UTCtoLocal(t).clearTime()}),this._nextDatesMap={},this._nextDates.forEach(function(e){return t._nextDatesMap[+e]=!0})}}},{key:"getAllDates",value:function(){return this.date?[this.date]:(this._nextDates||this._generateDates(),this._nextDates)}},{key:"isRange",value:function(){if(this.date)return!1;var t=this.rruleset._rrule[0].options;return 3===t.freq&&1===t.interval&&t.until}},{key:"setDate",value:function(t){if(this.date&&!t.hasTimeOfDay()){var e=this.date.getTimeOfDay();this.date=t.clone().clearTime().addMilliseconds(e)}else this.date=t;this.dateCleared=this.date.clone().clearTime(),this._nextDates=void 0}},{key:"setDuration",value:function(t){this.duration=t}},{key:"getDuration",value:function(){return this.duration}},{key:"setHours",value:function(t){var e=Math.floor(t),i=60*(t-e);if(this.date)this.date.setHours(e),this.date.setMinutes(i);else{var r=this.rruleset._rrule[0];r.options.byhour=[e],r.origOptions.byhour=[e],r.options.byminute=[i],r.origOptions.byminute=[i],this._nextDates=void 0}}},{key:"toText",value:function(t){var e,i=this;if(this.date)e=v.a.toHumanText(this.date);else{var r=this.rruleset._rrule[0];try{h.default.PAssert(1365,r,"MooDate has no rrule",function(){return i.toData()})}catch(n){h.default.reportError(n)}r&&(e=t?r.toTextShort():r.toText())}if(e&&!t&&this.duration){var a=this.duration/d.a.MSPerMinute;e+=" "+(a>=60?a/60+"hr":a+"m")}return e||""}},{key:"getGCalId",value:function(){return this.gcalId}},{key:"getGCalCalendar",value:function(){return this.gcalCalendar}},{key:"setGCalId",value:function(t){this.gcalId=t}},{key:"setGCalCalendar",value:function(t){this.gcalCalendar=t}},{key:"setGCalIdAndCalendar",value:function(t,e){this.gcalId=t,this.gcalCalendar=e}},{key:"removeGCal",value:function(){this.gcalId=void 0,this.gcalCalendar=void 0}},{key:"clone",value:function(){return t.fromData(this.toData())}},{key:"isRepeatDate",value:function(){return!!this.rruleset}},{key:"getTime",value:function(){if(this.date)return this.date.getTimeOfDay();var t=this.getNext();return t||(t=this.rruleset&&this.rruleset.before(new Date))&&(t=v.a.UTCtoLocal(t)),t?t.getTimeOfDay():void 0}},{key:"copyFrom",value:function(t){t.rruleset?(this.rruleset=t.rruleset,this.date=void 0):t.date&&(this.date=t.date,this.dateCleared=t.date.clone().clearTime(),this.rruleset=void 0),this.duration=t.duration,this._nextDates=void 0}},{key:"complete",value:function(){if(this.isRepeatDate()){var t=new Date;this.completes?this.completes.push(t):this.completes=[t];var e=this.getNext(t,!0,!0),i=this.rruleset._rrule[0];e=v.a.toUTCDate(e),i.origOptions.dtstart=e,i.options.dtstart=e,this._nextDates=void 0}}},{key:"toICal",value:function(){if(this.isRepeatDate())return this.rruleset.toString()}},{key:"toData",value:function(){var t=this,e=[],i=[];if(m.forEach(function(e){var r=t[e];r&&("completes"===e?r=r.filter(function(t){return!isNaN(+t)}).map(function(t){return+t}).join(","):"duration"===e&&(r=Math.round(r/1e5)),i.push("".concat(y[e],":").concat(r)))}),i.length&&e.push(i.join(";")),this.date){var r=+this.date;if(!i.length)return r;e.push(r)}else e.push(this.rruleset._rrule.map(function(t){var e=t.origOptions;return Object.keys(e).map(function(t){var i=e[t];return t=t.toLowerCase(),i instanceof Date?i=Math.round(+i/1e5):h.default.isArray(i)&&i[0]&&i[0]instanceof c.d?i=i.map(function(t){return t.weekday+(t.n?"-"+t.n:"")}).join(","):h.default.isNumber(i)&&(i=Math.round(i)),"".concat(l[t],":").concat(i)}).join(";")}).join("\n"));return e.join("\\")}}],[{key:"fromData",value:function(e){if(e){var i,r;if(h.default.isString(e)){var n=e.split("\\");if(n.length>1)i={},n[0].split(";").forEach(function(t){var e=t.split(":"),r=a()(e,2),n=r[0],o=r[1];"completes"===g[n]?o=o.split(",").map(function(t){return new Date(t)}):"duration"===g[n]&&(o*=1e5),i[g[n]]=o}),e=n[1]}if(h.default.isNumber(+e))r=new Date(+e);else try{r=new c.c,e.split("n").forEach(function(t){var i={};t.split(";").forEach(function(t){var e=t.split(":"),r=a()(e,2),n=r[0],o=r[1],u=p[n];if(n===l.byweekday)o=o.split(",").map(function(t){var e=t.split("-"),i=a()(e,2),r=i[0],n=i[1];return new c.d(h.default.isNumber(+r)?+r:void 0,h.default.isNumber(n)?+n:void 0)});else if(o.indexOf(",")>0)o=o.split(",").map(function(t){return+t});else if(h.default.isNumber(+o)){var s=o.indexOf(".");s>0&&(o=o.substr(0,s)),"dtstart"===u||"until"===u||o.length>6?o=new Date(1e5*+o):(o=+o,"interval"===u&&o<0&&(o=Math.abs(o)))}i[u]=o}),r.rrule(new c.b(i));try{h.default.PAssert(1366,r._rrule[0],"RRuleSet created with no rrule",e)}catch(n){h.default.reportError(n)}r._rrule[0]})}catch(o){h.default.reportError(o,"Error parsing date string: "+e)}return new t(r,i)}}},{key:"fromRRuleOptions",value:function(e,i){var r=new c.c;return r.rrule(new c.b(e)),new t(r,{duration:i})}},{key:"fromRange",value:function(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=(arguments.length>3&&arguments[3],Math.floor(a)),o=60*(a-n);if(e=e.clone(),i=i.clone(),e.equals(i))(r=e).setHours(n),r.setMinutes(o);else{n&&(e.setHours(n),i.setHours(n)),o&&(e.setHours(o),i.setHours(o));var u={freq:c.a.DAILY,dtstart:v.a.toUTCDate(e),until:v.a.toUTCDate(i)};n&&(u.byhour=n?[n]:void 0),o&&(u.byminute=o?[o]:void 0);var s=new c.c;s.rrule(new c.b(u)),r=s}return new t(r)}},{key:"now",value:function(){return new t(new Date)}}]),t}();e.a=k},function(t,e,i){"use strict";var r,a,n,o=i(30),u=i.n(o),s=i(48),h=i.n(s),d=i(7),c=i.n(d),v=i(8),y=i.n(v),g=i(15),l=i.n(g),p=i(0),m=i(1),f=i(4),k=i(3),A=i(16),S=i(35),w=i(63),L=i(25),F=i(38),C=i.n(F),I={identity:function(t){return t},true:function(t){return!0},index:function(t,e){return e}},P=function(){var t,e,i,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I.identity,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:I.true,n=arguments.length>2?arguments[2]:void 0,o=arguments.length>3?arguments[3]:void 0,u=arguments.length>4?arguments[4]:void 0;return t=r(o,u),e=a(o,u),i=n,Object.assign(i,C()({},t,e))},N=function(t,e,i){return P(void 0,void 0,t,e,i)},H=function(t,e){var i={id:t.id},r=function(r){void 0===e[r]?i[r]=null:t[r]!==e[r]&&(i[r]=e[r])};return Object.keys(t).forEach(r),Object.keys(e).forEach(r),i},M=function(t,e,i){return"removed"===t||"added"===t?{type:t,value:i}:{type:t,value:e?H(e,i):i}},z=function(t,e){return{type:e,value:t}},D=function(t,e){return function(e){return[e].map((i=t,function(t){return M(t.type,i[t.value.id],t.value)}))[0];var i}},V=function(t,e){var i,r=e.value;return t=(i="id",function(t,e,r){return P(function(t){return function(e){return function(t,e){return e?e[t]:void 0}(t,e)}}(i),I.identity,t,e,r)})(t,r),"removed"===e.type&&delete t[r.id],t},G=function(t){return t.changes.map(function(t){return t.value})},T=function(t){var e=t.changes,i=t.prevStore;return e.map(D(i))},q=function(t){return t._store={},t},j=function(t){var e=t.changes,i=(t.type,t.prevStore,t.api);return i._store=e.reduce(V,i._store),i},Y=function(t){var e=t.item,i=t.api,r=t.changeType,a=Object.assign({},i._store),n=z(e,r);j({changes:[n],prevStore:a,api:i})},X=function(t){return function(e,i){return Y({item:i,api:e,changeType:t})}},Q={load:function(t){var e=t.changes,i=t.api,r=t.prevStore;return j({api:i,type:"update",changes:e,prevStore:r})},normalizeChanges:T,addItem:X("added"),removeItem:X("removed"),modifyItem:X("modified")},J={load:function(t){var e=t.changes,i=t.api,r=t.prevStore;return j({changes:e,api:q(i),prevStore:r})},normalizeChanges:G},Z=i(105),B=i.n(Z),$=function(t,e,i){return t.push(e),i},U=function(t,e,i){var r=t.indexOf(e);return r>-1&&t.splice(r,1),i},R=function(t,e,i){var r=!0,a=!1,n=void 0;try{for(var o,u=0,s=function(){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var t=o.value;setTimeout(function(){return t.apply(void 0,B()(e))},0)},h=t[Symbol.iterator]();!(r=(o=h.next()).done);r=!0)s()}catch(d){a=!0,n=d}finally{try{r||null==h.return||h.return()}finally{if(a)throw n}}return i},E=function(t){return function(e,i){return function(t,e,i){var r=Object.assign({},i._store),a=i._loadingState,n="load"===a?i._loader:i._updater,o="load"===a;o||(t=t.filter(function(t){var e=t.value;return"removed"===t.type||!r[e.id]||e.d!==r[e.id].d})),o&&(i._loadingState="update","load"===a&&i._earlyEdits.length&&(i._earlyEdits.forEach(function(t){R(i._callbacks.update,[t])}),i._earlyEdits=[]));if("update"===i._loadingState){if(o||t.length>0){i=n.load({api:i,changes:t,prevStore:r});var u=n.normalizeChanges({api:i,changes:t,prevStore:r});R(i._callbacks[a],[{responses:u},e]),R(i._callbacks["".concat(a,"Debug")],[{responses:u,changes:t,api:i},e])}}else i._earlyEdits.push({changes:t,api:i});return i}(e,i,t)}},K=function(t){var e=t.id,i=t.store;return i[e]?Object.assign({},i[e]):void 0},x=[],b=function(t){var e=t.db,i=t.config,r=t.ignore,a=void 0===r?x:r,n=t.backend,o=t.path,u=t.orderBy,s=t.startAt,h=t.extraModifiedPath,d={_config:i,_database:e,_store:{},_callbacks:{update:[],load:[],updateDebug:[],loadDebug:[]},_ignore:a.reduce(N,{}),_loadingState:"load",_earlyEdits:[],_backend:n.create({db:e,path:o,orderBy:u,startAt:s,extraModifiedPath:h}),_loader:J,_updater:Q};return d._backend.onUpdate(E(d)),d.get=function(t){return K({id:t,store:d._store})},d.getFromRemote=function(t){return d._backend.getFromRemote(t)},d.update=function(t){return function(t){var e=t.item,i=t.backend,r=t.api;console.assert(!!e,"item must exist");var a,n=(a=r._ignore,function(t){return function(t,e){if(!t)return t;var i={};for(var r in t)r in e||(i[r]=t[r]);return i}(t,a)})(e);return r._updater.modifyItem(r,n),i.update(n,function(t){return r._updater.modifyItem(r,t)})}({item:t,backend:d._backend,api:d})},d.getPathForItem=function(t){return function(t){var e=t.item,i=t.backend;t.api,t.batch;return i.getPathForItem(e)}({item:t,backend:d._backend,api:d})},d.remove=function(t){return function(t){var e=t.item,i=t.backend,r=t.api;return console.assert(!!e,"item must exist"),r._updater.removeItem(r,e),console.log("remove",e),i.remove(e)}({item:t,backend:d._backend,api:d})},d.onLoad=function(t){return $(d._callbacks.load,t)},d.offLoad=function(t){return U(d._callbacks.load,t)},d.onUpdate=function(t){return $(d._callbacks.update,t)},d.offUpdate=function(t){return U(d._callbacks.update,t)},d.onLoadDebug=function(t){return $(d._callbacks.loadDebug,t)},d.offLoadDebug=function(t){return U(d._callbacks.loadDebug,t)},d.onUpdateDebug=function(t){return $(d._callbacks.updateDebug,t)},d.offUpdateDebug=function(t){return U(d._callbacks.updateDebug,t)},d.setSent=function(t,e){return d._backend.setSent(t,e)},d},O=i(47),W=function(){function t(e){var i=e.path,r=e.orderBy,a=e.startAt,n=e.extraModifiedPath;c()(this,t),this.path=i,this.session=O.a.database(),this.orderBy=r,this.startAt=a,this.extraModifiedPath=n,this.updatesSent={},this.reqNum=0}return y()(t,[{key:"update",value:function(t){var e=this;var i={},r=(this.session.ref(),Object.assign({},t));delete r.id,p.default.isObject(r)?Object.keys(r).forEach(function(a){i["".concat(e.path,"/").concat(t.id,"/").concat(a)]=r[a]}):i["".concat(this.path,"/").concat(t.id)]=r,this.extraModifiedPath&&(i[this.extraModifiedPath]=O.a.database.ServerValue.TIMESTAMP);var a=this.setSent(t.id,i);return this.session.ref().update(i).then(function(){return delete e.updatesSent[t.id][a],p.default.isEmpty(e.updatesSent[t.id])}).catch(function(t){return p.default.reportError(t)})}},{key:"getPathForItem",value:function(t){return"".concat(this.path,"/").concat(t.id,"/")}},{key:"remove",value:function(t){var e=this,i=this.setSent(t.id,{type:m.a.CrudActions.Removed,id:t});return this.session.ref("".concat(this.path,"/").concat(t.id)).remove().then(function(){return delete e.updatesSent[t.id][i],p.default.isEmpty(e.updatesSent[t.id])})}},{key:"toChangeInternal",value:function(t,e,i){return e.id=t,{type:i,value:e}}},{key:"isChangeRemote",value:function(t){var e=t.key,i=(t.val(),this.updatesSent[e]);return!(i&&!p.default.isEmpty(i))}},{key:"onUpdate",value:function(t){var e=this;this.cbOnUpdate=t;var i=!1,r=this.session.ref(this.path);this.orderBy&&this.startAt&&(r=r.orderByChild(this.orderBy).startAt(this.startAt)),r.once("value",function(r){if(!i){i=!0;var a=r.val(),n=Object.keys(a||{}).map(function(t){return e.toChangeInternal(t,a[t],"load")});t(n,!0)}},function(t){console.log("Firebase error",t)}),r.on("child_added",function(r){if(i){var a=[e.toChangeInternal(r.key,r.val(),"added")];t(a,e.isChangeRemote(r))}},function(t){console.log("Firebase error",t)}),r.on("child_changed",function(r){if(i){var a=[e.toChangeInternal(r.key,r.val(),"modified")];t(a,e.isChangeRemote(r))}},function(t){console.log("Firebase error",t)}),r.on("child_removed",function(r){if(i){var a=[e.toChangeInternal(r.key,r.val(),"removed")];t(a,e.isChangeRemote(r))}},function(t){console.log("Firebase error",t)})}},{key:"setSent",value:function(t,e){var i=this.reqNum++;return this.updatesSent[t]||(this.updatesSent[t]={}),this.updatesSent[t][i]=e,i}}]),t}(),_=new(r=function(){function t(){c()(this,t)}return y()(t,[{key:"init",value:function(){return this.session||(this.database=this.session=O.a.database()),this.serverTime=O.a.database.ServerValue.TIMESTAMP,this}},{key:"create",value:function(t){return new W(t)}},{key:"onOnlineChange",value:function(t){this.session.ref(".info/connected").on("value",function(e){t(!0===e.val())})}},{key:"generateId",value:function(){return O.a.database().ref().push().key}}]),t}(),l()(r.prototype,"onOnlineChange",[A.a],Object.getOwnPropertyDescriptor(r.prototype,"onOnlineChange"),r.prototype),l()(r.prototype,"generateId",[A.a],Object.getOwnPropertyDescriptor(r.prototype,"generateId"),r.prototype),r),tt=i(43),et=i.n(tt),it=function(){function t(e){c()(this,t),this.path=e,this.firebasePath=new W({path:e}),this.session=O.a.database(),this.dataCache={},this.isLoaded=!1,this.ignoreLocalChange=!1,this.cbsOnUpdate={},this.updatesSent={},this.reqNum=0}return y()(t,[{key:"toChangeInternal",value:function(t,e,i){var r=t.ref.path.slice(2),a=t.val(),n={},o=n,u=this.dataCache;if("object"===et()(a)){for(var s=0,h=0;h<r.length;h++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var d=r[h];o[d]={},o=o[d],"removed"!==e&&(u[d]||(u[d]={}),u&&(u=u[d]))}Object.keys(a).forEach(function(t){o[t]=a[t],"removed"!==e?u[t]=a[t]:u&&delete u[t]}),n=n[r[0]]}else{var c=t.key;u[i]||(u[i]={}),u=u[i],"removed"!==e?u[c]=a:u&&delete u[c],n[c]=a}return{type:e,value:n}}},{key:"set",value:function(){var t=h()(u.a.mark(function t(e,i){var r,a,n,o,s,h,d,c=0;return u.a.wrap(function(t){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(t.prev=t.next){case 0:r=e.split("/"),a=this.dataCache,n=r[r.length-1],o="".concat(this.path,"/").concat(e),s=0;case 2:if(!(s<r.length-1)){t.next=15;break}if(!(c++>5e3&&__infLoop&&__infLoop(c))){t.next=5;break}throw new RangeError;case 5:if(a){t.next=7;break}return t.abrupt("return",Promise.resolve(!1));case 7:if(r[s]){t.next=10;break}return t.abrupt("continue",12);case 10:a[r[s]]||(a[r[s]]={}),a=a[r[s]];case 12:s++,t.next=2;break;case 15:return a[n]=i,h=this.session.ref(o),d=this.setSent(e,i),t.prev=19,t.next=22,h.update(i);case 22:return delete this.updatesSent[e][d],t.abrupt("return",p.default.isEmpty(this.updatesSent[e]));case 26:t.prev=26,t.t0=t.catch(19),p.default.reportError(t.t0);case 29:return t.abrupt("return",!1);case 30:case"end":return t.stop()}}},t,this,[[19,26]])}));return function(e,i){return t.apply(this,arguments)}}()},{key:"remove",value:function(){var t=h()(u.a.mark(function t(e){var i;return u.a.wrap(function(t){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(t.prev=t.next){case 0:return i=this.setSent(e,{type:m.a.CrudActions.Removed,id:e}),t.prev=1,t.next=4,this.session.ref("".concat(this.path,"/").concat(e)).remove();case 4:return delete this.updatesSent[e][i],t.abrupt("return",p.default.isEmpty(this.updatesSent[e]));case 8:t.prev=8,t.t0=t.catch(1),p.default.reportError(t.t0);case 11:return t.abrupt("return",!1);case 12:case"end":return t.stop()}}},t,this,[[1,8]])}));return function(e){return t.apply(this,arguments)}}()},{key:"isChangeRemote",value:function(t){var e=this.updatesSent[t];return!(e&&!p.default.isEmpty(e))}},{key:"sendChangeCB",value:function(t,e,i){var r=t.ref.path;p.default.isString(r)&&(r=r.split("/"));var a=r.slice(2).join("/"),n=this.isChangeRemote(a);n&&i(e,n)}},{key:"onLoad",value:function(t,e){var i=this;this.session.ref(this.path).once("value",function(e){if(!i.isLoaded){i.isLoaded=!0;var r=e.val()||{};i.dataCache=r,t(r)}},function(t){console.log("Firebase error",t),e?e(t):p.default.reportError(t,"Missing cbError handler")})}},{key:"onUpdate",value:function(t,e,i){var r=this;this.cbsOnUpdate[t]=e;var a=this.path+"/"+t;this.session.ref(a).on("child_added",function(i){if(r.isLoaded){var a=r.toChangeInternal(i,"added",t);r.sendChangeCB(i,a,e)}},function(t){console.log("Firebase error",t),i&&i(t)}),this.session.ref(a).on("child_changed",function(i){if(r.isLoaded){var a=r.toChangeInternal(i,"modified",t);r.sendChangeCB(i,a,e)}},function(t){console.log("Firebase error",t),i&&i(t)}),this.session.ref(a).on("child_removed",function(i){if(r.isLoaded){var a=r.toChangeInternal(i,"removed",t);r.sendChangeCB(i,a,e)}},function(t){console.log("Firebase error",t),i&&i(t)})}},{key:"offUpdate",value:function(t,e){var i=this.path+"/"+t;this.session.ref(i).off("child_added"),this.session.ref(i).off("child_changed"),this.session.ref(i).off("child_removed")}},{key:"setSent",value:function(t,e){var i=this.reqNum++;return this.updatesSent[t]||(this.updatesSent[t]={}),this.updatesSent[t][i]=e,i}}]),t}(),rt=(a=function(){function t(e,i,r){c()(this,t),this.docID=e,this.uid=i,this.userDocuments=r,this.treeApi=new it("documents/".concat(e)),this.cbs=[],this.cbsAcl=[]}return y()(t,[{key:"onLoad",value:function(t,e){this.treeApi.onLoad(function(e){t(e)},e)}},{key:"onUpdate",value:function(t,e){this.cbs.push(t),this.treeApi.onUpdate("p",t,e)}},{key:"offUpdate",value:function(t){var e=this.cbs.indexOf(t);this.cbs.splice(e,1),this.treeApi.offUpdate("p",t)}},{key:"onAclUpdate",value:function(t,e){this.cbsAcl.push(t),this.treeApi.onUpdate("a",t,e)}},{key:"offAclUpdate",value:function(t){var e=this.cbsAcl.indexOf(t);this.cbsAcl.splice(e,1),this.treeApi.offUpdate("p",t)}},{key:"create",value:function(t,e){var i,r=Object.assign({},t),a={d:r.p.d,t:r.p.t};delete r.id;var n=(i={},C()(i,"/documents/".concat(this.docID),r),C()(i,"/userdocuments/".concat(this.uid,"/").concat(this.docID),a),i);if(e)for(var o=0,u=0;u<e.length;u++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var s=e[u],h=s.id;delete s.id,n["/items/".concat(this.docID,"/").concat(h)]=s}return this.userDocuments.setSent(this.docID,a),_.database.ref().update(n)}},{key:"deleteFully",value:function(){var t;this.cbs.forEach(this.offUpdate),_.database.ref("/items/".concat(this.docID)).off(),_.database.ref("/userdocuments/".concat(this.uid,"/").concat(this.docID)).off(),_.database.ref("/documents/".concat(this.docID,"/a")).off(),_.database.ref("/documents/".concat(this.docID)).off();var e=(t={},C()(t,"/items/".concat(this.docID),null),C()(t,"/userdocuments/".concat(this.uid,"/").concat(this.docID),null),C()(t,"/documents/".concat(this.docID),null),t);return _.database.ref().update(e)}},{key:"update",value:function(t,e){var i=Object.assign({},t);delete i.id;var r={};e?r["/documents/".concat(this.docID,"/p")]=i.p:r["/documents/".concat(this.docID)]=i,i.p.d&&(r["/userdocuments/".concat(this.uid,"/").concat(this.docID,"/d")]=i.p.d),i.p.t&&(r["/userdocuments/".concat(this.uid,"/").concat(this.docID,"/t")]=i.p.t),_.database.ref().update(r)}},{key:"addBackup",value:function(t){_.database.ref("/documents/".concat(this.docID,"/c")).update(C()({},t,""))}}]),t}(),l()(a.prototype,"offUpdate",[A.a],Object.getOwnPropertyDescriptor(a.prototype,"offUpdate"),a.prototype),l()(a.prototype,"offAclUpdate",[A.a],Object.getOwnPropertyDescriptor(a.prototype,"offAclUpdate"),a.prototype),a),at=function(){function t(e){var i=this;c()(this,t),this.uid=e,this.session=O.a.database(),this.treeApi=new it("users/".concat(e));var r={a:"AuthToken",b:"Board",p:"Property",s:"Setting"};Object.keys(r).forEach(function(t){var e=r[t];i["on"+e+"Update"]=i.treeApi.onUpdate.bind(i.treeApi,t),i["set"+e]=function(e,r){return i.treeApi.set(t+"/"+e,r)},i["remove"+e]=function(e){return i.treeApi.remove(t+"/"+e)}})}return y()(t,[{key:"onLoad",value:function(t){this.treeApi.onLoad(function(e){t({properties:e.p,settings:e.s,authTokens:e.a,boards:e.b})},void 0)}},{key:"getPathForSettings",value:function(){return"users/".concat(this.uid,"/s/")}},{key:"deleteFully",value:function(){var t,e=(t={},C()(t,"/users/".concat(this.uid,"/a"),null),C()(t,"/users/".concat(this.uid,"/b"),null),C()(t,"/users/".concat(this.uid,"/s"),null),t);return this.session.ref().update(e)}},{key:"setProperties",value:function(t){return this.session.ref("/users/".concat(this.uid,"/p")).update(t)}}]),t}(),nt=function(){function t(e){c()(this,t),this.uid=e,this.docs={},this.db={firebase:O.a,session:O.a.database()},_.init(),this.onOnlineChange=_.onOnlineChange,this.serverTime=_.serverTime,this.generateId=_.generateId,this.user=new at(e),this.userDocuments=b({db:this.db,backend:_,path:"userdocuments/".concat(e)})}return y()(t,[{key:"loadDocuments",value:function(t){this.userDocuments.onLoad(function(e){var i=e.responses;t(i)})}},{key:"onDocumentsUpdate",value:function(t){this.userDocuments.onUpdate(t)}},{key:"document",value:function(t,e,i){if(!(t in this.docs)){var r=i||new rt(t,this.uid,this.userDocuments),a=b({db:this.db,backend:_,path:"items/".concat(t),orderBy:"d",startAt:e?e+1:void 0,extraModifiedPath:"documents/".concat(t,"/p/d")});this.docs[t]={info:r,items:a}}return this.docs[t]}},{key:"addDocument",value:function(t,e){var i=this,r=t.id,a=this.docs[r];if(!a){var n=new rt(r,this.uid,this.userDocuments);return n.create(t,e).then(function(){return i.document(r,void 0,n)})}return Promise.resolve(a)}},{key:"forgetDocument",value:function(t){var e=this.docs[t];return delete this.docs[t],e._callbacks={update:[],load:[],updateDebug:[],loadDebug:[]},!0}},{key:"commitBatch",value:function(t){return this.db.session.ref().update(t)}}]),t}(),ot=i(120),ut=i(26),st=i(14),ht=i(34),dt=i(10),ct=i(88),vt=i(49),yt=i(64),gt=(n=function(){function t(){c()(this,t),this.documents={},this.documentsEncrypted={},this._isLoaded=!1,this.loadState=new dt.a(m.a.LoadState.Connecting)}return y()(t,[{key:"init",value:function(t,e){this.__DEBUG_FIX_REMOVED=!1,this._timeoutVerify=0,this._fixMismatches=!0,this._seenLocal={},this._coalescedChanges={},this._itemsChangedQueue=[],this._isLoaded=!1,this.cbOnLoad=t,this.cbOnDocumentsChanged=e,this.docProps={},L.a.init(this,this.onLoadLocal)}},{key:"onLoadLocal",value:function(t,e){var i=this,r=e.documentsPending,a=e.itemsPending,n=e.settingsPending,o=e.boardsPending;t||(t=[]),t.forEach(function(t){return i.documents[t.id]=t}),this.documentsPending=r,this.itemsPending=a,this.settingsPending=n,this.boardsPending=o,this.cbOnLoad(t),ut.a.onAuthed(function(){i.createStore(t)})}},{key:"onLoadRemoteDocuments",value:function(){this._isLoaded=!0,f.default.settings.lastSync.set(Date.now()),this.cbOnDocumentsChanged(this.documents,this.documentsEncrypted),vt.a.ensureSelected()}},{key:"createStore",value:function(t){var e,i,r=this,a=new nt(ut.a.getUid());this.api=a;var n=function(){e&&i&&(Object.keys(r.documents).forEach(function(t){i.indexOfWithProperty("id",t)<0&&(st.a.deleteDocument(r.documents[t],!0),delete r.documents[t])}),Promise.all(Object.keys(r.documentsPending).map(function(t){var e=r.documents[t];return e&&(!i||i.indexOfWithProperty("id",e.id)<0)?r.addDocument(e,!1):Promise.resolve()})).then(function(){r.documentsPending={},Promise.all(i.map(function(t){return r.loadDocumentData(t)})).then(function(){r.onLoadRemoteDocuments(),r.loadState.set(m.a.LoadState.Connected)})}).catch(function(t){return p.default.reportError(t)}))};a.user.onLoad(function(t){var i=f.default.settings.getSettingAbbrev("userEncryptionSentinel"),a=t.settings;t.properties?(r.userProperties=S.a.userIn(t.properties),f.default.billingManager.loadUserProperties(r.userProperties)):r.onFirstSync(),r.checkUserEncryption(a&&a[i]&&a[i].v,function(){r.loadState.set(m.a.LoadState.LoadingDocs),a&&r.onSettingsChange(m.a.CrudActions.Modified,a,!0,!0),r.settingsPending&&Object.keys(r.settingsPending).forEach(function(t){var e=f.default.settings.getValueFromAbbrev(t);void 0!==e&&r._setSettingRemote(t,e)});var i=t.boards;i&&r.onBoardsChange(m.a.CrudActions.Modified,i,!0),!k.a.mobile&&r.boardsPending&&Object.keys(r.boardsPending).forEach(function(t){var e=vt.a.getById(t);try{p.default.PAssert(252,e,"Pending board that does not exist")}catch(i){p.default.reportError(i)}e&&r._saveBoardRemote(e.getSaveInfo())}),e=!0;var o=t.authTokens;r.onAuthTokensChange(m.a.CrudActions.Added,o,!0),n(),f.default.settings.userEncryptionSentinel.listen(function(t){t?r.checkUserEncryption(t):f.default.settings.removeEncryptionKey(m.a.EncryptionKeys.UserPassword)})})}),a.user.onPropertyUpdate(function(t,e){var i=t.type,r=t.value;if(e){i===m.a.CrudActions.Removed&&Object.keys(r).forEach(function(t){return r[t]=null});var a=S.a.userIn(r);f.default.billingManager.loadUserProperties(a)}}),a.user.onSettingUpdate(function(t,e){var i=t.type,a=t.value;r.onSettingsChange(i,a,e,!1)}),a.user.onBoardUpdate(function(t,e){var i=t.type,a=t.value;r.onBoardsChange(i,a,e)}),a.user.onAuthTokenUpdate(function(t,e){var i=t.type,a=t.value;r.onAuthTokensChange(i,a,e)}),a.loadDocuments(function(t){i=t,n()}),a.onDocumentsUpdate(function(t,e){var i=t.responses;Promise.all(i.map(function(t){var e=t.type,i=t.value;if(e!==m.a.CrudActions.Removed)return r.loadDocumentData(i);st.a.deleteDocument(r.documents[i.id],!0),delete r.documents[i.id]})).then(function(){r.cbOnDocumentsChanged(r.documents,r.documentsEncrypted)}).catch(function(t){return p.default.reportError(t)})}),a.onOnlineChange(function(t){r.updateOnlineStatus(t)}),this._isLoaded||(this._isLoaded=!0),this._runCoalescedChanges()}},{key:"onFirstSync",value:function(){var t=h()(u.a.mark(function t(){var e,i,r=this;return u.a.wrap(function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:if(e=function(t){r.userProperties=t;var e={email:t.email,fname:t.given_name,lname:t.family_name,picture:t.picture,displayName:t.name};yt.a.setUserProperties(S.a.userOut(e))},!ut.a.userProfile){t.next=5;break}e(ut.a.userProfile),t.next=9;break;case 5:return t.next=7,ut.a.getUser();case 7:i=t.sent,ht.a.getGoogleUserInfo(function(t){t?e({email:i.email,given_name:t.given_name,family_name:t.family_name,picture:t.picture,name:i.displayName}):f.default.settings.activeUser.set(void 0)});case 9:case"end":return t.stop()}}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"loadSingleDocument",value:function(){var t=h()(u.a.mark(function t(e){var i;return u.a.wrap(function(t){for(var r=0;;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.loadDocumentData(e);case 3:return i=t.sent,this.cbOnDocumentsChanged(this.documents,this.documentsEncrypted),t.abrupt("return",i);case 8:t.prev=8,t.t0=t.catch(0),p.default.reportError(t.t0);case 11:case"end":return t.stop()}}},t,this,[[0,8]])}));return function(e){return t.apply(this,arguments)}}()},{key:"loadDocumentData",value:function(){var t=h()(u.a.mark(function t(e){var i,r,a,n,o,s,h,d,c,v,y=this;return u.a.wrap(function(t){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(t.prev=t.next){case 0:if(!(r=this.documents[e.id])){t.next=5;break}i=r.dateModified.get(),t.next=8;break;case 5:if(!e.s||f.default.crypto.canDecryptSentinel(e.s)){t.next=8;break}return this.documentsEncrypted[e.id]=e,t.abrupt("return",Promise.resolve(void 0));case 8:return t.prev=8,a=this.api.document(e.id,i),t.next=13,new Promise(function(t){var i,r;if(y.docProps[e.id])t(y.docProps[e.id]);else{var n=function(){if(null===i)t(void 0);else if(i&&r){var a={docProps:i,docItemsEncrypted:r};y.docProps[e.id]=a,t(a)}},o=a.info;o.onLoad(function(t){t.id=e.id;var r=S.a.documentIn(t);i=r,n()},function(t){i=null,n()}),o.onUpdate(y.onDocInfoChange.bind(y,e)),o.onAclUpdate(y.onDocAclChange.bind(y,e));var u=a.items;u.onLoad(function(t){var e=t.responses;r=e,n()}),u.onUpdate(y.onItemsChange.bind(y,e))}});case 13:if(!(n=t.sent)){t.next=28;break}if(o=n.docProps,s=n.docItemsEncrypted,h=this.getEncryptionForDocument(o)){t.next=20;break}return e.s=o.encryptionSentinel,this.documentsEncrypted[e.id]=e,t.abrupt("return",Promise.resolve(void 0));case 20:return t.next=22,Promise.all(s.map(function(t){return S.a.decryptItemIn(t,f.default.crypto,h)})).then(function(t){return ct.a.createItemHierarchy(t,L.a.getItemsMap()),t.forEach(function(t){return t.docId=o.id}),r&&y.resolveItemConflicts(r,t),t});case 22:return d=t.sent,r?Object.keys(this.itemsPending).forEach(function(t){var e=L.a.getItemData(t),i=st.a.getItem(t),a=y.itemsPending[t];if(e&&e.docId===r.id){try{p.default.PAssert(253,i||e.isDeleted,"Pending update that has no parent")}catch(o){p.default.reportError(o)}if(e.isDeleted)y._deleteItemRemote(r,i,e.id);else if(i&&!p.default.isEmpty(a)){var n={id:t};Object.keys(a).forEach(function(t){n[t]=e[t]}),y._saveItemRemote(r,i,n)}}}):d=d.filter(function(t){return!t.isDeleted}),L.a.ensureMirror(d,!1),r?(this.documentsPending[r.id]?(this._saveDocumentRemote(r,r.getSaveInfo()),delete this.documentsPending[r.id]):(L.a.saveDocument(o),r.onRemoteUpdate(o)),c=r):o.root&&(L.a.saveDocument(o),o.backing=this,(v=p.default.clone(o)).rootData=this.getItemData(o.root),v.rootData&&(this.documents[o.id]=r=w.a.fromData(v,this),r.createVMLIs(),c=r,delete this.documentsEncrypted[r.id])),c||console.log("Failed to find root item"),t.abrupt("return",c);case 28:t.next=35;break;case 30:t.prev=30,t.t0=t.catch(8),console.log(t.t0),p.default.reportError(t.t0);case 35:case"end":return t.stop()}}},t,this,[[8,30]])}));return function(e){return t.apply(this,arguments)}}()},{key:"getItemData",value:function(t){var e=this._coalescedChanges[t],i=L.a.getItemData(t,!0);return e&&e.type!==m.a.CrudActions.Removed&&(i=Object.assign({},i,e.info)),i}},{key:"getItemSaveData",value:function(t){return t.getFullSaveData()}},{key:"importItem",value:function(t){var e=this,i=t.getDocumentOwner();t.parent();this._saveItem(i,t,this.getItemSaveData(t)),t.hasNote()&&this.importItem(t.getNote()),t.getItems().forEach(function(t,i){t.index=""+i,e.importItem(t)}),this._seenLocal[t.id]=!0}},{key:"onSettingsChange",value:function(t,e,i,r){var a=this,n=e;Object.keys(e).forEach(function(r){var o=e[r];i&&a.settingsPending[r]?(n===e&&(n=p.default.clone(e)),delete n[r]):delete a.settingsPending[r],o.v=t===m.a.CrudActions.Removed?void 0:a.decodeValue(o.v)}),t===m.a.CrudActions.Removed?L.a.deleteSettings(n):L.a.saveSettings(n),f.default.settings.load(e,r)}},{key:"onBoardsChange",value:function(t,e,i){var r=this;Object.keys(e).forEach(function(a){if(!i||!r.boardsPending[a]){e[a].id=a;var n=S.a.boardIn(e[a]);t===m.a.CrudActions.Removed?L.a.deleteBoard(a):L.a.saveBoard(n),i&&vt.a.onRemoteUpdate(t,n)}})}},{key:"onAuthTokensChange",value:function(t,e,i){var r={};e&&t!==m.a.CrudActions.Removed&&Object.keys(e).forEach(function(t){var i=t.replace(/,/g,"."),a=e[t],n=a.s?a.s.split(" "):void 0,o={email:i,scopes:n?n.map(function(t){return m.a.GScopeArray[t]}):void 0};try{p.default.PAssert(254,"Have an auth token without scopes")}catch(u){p.default.reportError(u)}r[i]=o}),ht.a.loadWithTokens(r)}},{key:"onDocAclChange",value:function(t,e,i){var r=e.type,a=e.value,n=this.documents[t.id];if(n){r===m.a.CrudActions.Removed&&Object.keys(a).forEach(function(t){a[t]=void 0}),n.onAclUpdate(a);var o=n.getSaveInfo();L.a.saveDocument(o)}}},{key:"onDocInfoChange",value:function(t,e,i){var r=e.type,a=e.value,n=this.documents[t.id];if(n)if(r!==m.a.CrudActions.Removed){if(a){var o=a.t,u=a.d,s={text:o,date:u},h=f.default.settings.lastSync;n&&((!h.get()||u>h.get())&&h.set(u),n.onRemoteUpdate(s))}}else 0}},{key:"_processItemsChange",value:function(){var t=h()(u.a.mark(function t(){var e,i,r,a,n,o,s,h,d,c,v,y,g,l,k,A;return u.a.wrap(function(t){for(var u=0;;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;switch(t.prev=t.next){case 0:if(this._isProcessingItemsChanged||this._pauseProcessingItemsChanged||!(this._itemsChangedQueue.length>0)){t.next=35;break}if(this._isProcessingItemsChanged=!0,e=this._itemsChangedQueue[0],i=e.docInfo,r=e.responses,a=e.isRemote,this._itemsChangedQueue.splice(0,1),n=[],o=this.documents[i.id],t.prev=5,!o){t.next=28;break}return s=0,t.next=10,Promise.all(r.map(function(t){return S.a.decryptItemIn(t.value,f.default.crypto,o.getBestEncryption()).then(function(e){return{type:t.type,value:e}})}));case 10:h=t.sent,a&&f.default.PaneUpdateBatcher.beginUpdateItems(),d=0,c=0;case 14:if(!(c<h.length)){t.next=26;break}if(!(s++>5e3&&__infLoop&&__infLoop(s))){t.next=17;break}throw new RangeError;case 17:v=h[c],y=v.type,g=v.value,l=g,k=L.a.getItemData(g.id),g.isDeleted?y=m.a.CrudActions.Removed:y===m.a.CrudActions.Added&&k&&(y=m.a.CrudActions.Modified),y===m.a.CrudActions.Removed&&L.a.deleteItem(g.id),d=Math.max(g.dateModified),a&&this.handleRemoteItemChange(this.documents[i.id],y,g.id,g),y===m.a.CrudActions.Removed?L.a.deleteItem(g.id):(l.docId=i.id,n.push(l));case 23:c++,t.next=14;break;case 26:a&&(f.default.PaneUpdateBatcher.commitUpdateItems(),L.a.ensureMirror(n)),o&&(o.updateModified(d),A=o.getSaveInfo(),L.a.saveDocument(A));case 28:t.next=33;break;case 30:t.prev=30,t.t0=t.catch(5),p.default.reportError(t.t0);case 33:this._isProcessingItemsChanged=!1,this._itemsChangedQueue.length>0&&this._processItemsChange();case 35:case"end":return t.stop()}}},t,this,[[5,30]])}));return function(){return t.apply(this,arguments)}}()},{key:"onItemsChange",value:function(t,e,i){var r=e.responses;this._itemsChangedQueue.push({docInfo:t,responses:r,isRemote:i}),this._processItemsChange()}},{key:"convertItemUndefineds",value:function(t,e){var i=this,r=this.getItemData(t.id);return Object.keys(e).forEach(function(a){void 0===e[a]&&(void 0===r[a]?delete e[a]:e[a]=i.getAPIForItem(t).props.remove)}),e}},{key:"_coalesceChange",value:function(t,e,i,r){var a=this._coalescedChanges[e.id],n=!a;if(r.id||(r.id=e.id),a){try{p.default.PAssert(255,a.type!==m.a.CrudActions.Removed,"Should not be modifying an item that was deleted")}catch(o){p.default.reportError(o)}try{p.default.PAssert(256,i!==m.a.CrudActions.Added,"Cannot be existing change on item if adding it")}catch(o){p.default.reportError(o)}i===m.a.CrudActions.Modified?a.type===m.a.CrudActions.Modified?a.info=Object.assign(a.info,r):(a.type,m.a.CrudActions.Added):i===m.a.CrudActions.Removed&&(a.type===m.a.CrudActions.Added?delete this._coalescedChanges[e.id]:n=!0)}n&&(a=this._coalescedChanges[e.id]={id:e.id,time:Date.now(),doc:t,type:i,info:r}),this._runCoalescedChanges()}},{key:"_runCoalescedChanges",value:function(){var t=this;if(this._isLoaded){var e=p.default.objectValues(this._coalescedChanges);if(e.length>0)e.sort(function(t,e){return t.time-e.time}).forEach(function(e){var i=e.info,r=e.doc,a=st.a.getItem(e.id);e.type===m.a.CrudActions.Added?t.importItem(a):e.type===m.a.CrudActions.Modified?a.isNote()?t.importItem(a):p.default.isEmpty(i)||t._saveItem(r,a,i):e.type===m.a.CrudActions.Removed&&t._deleteItem(r,a)}),this._coalescedChanges={}}}},{key:"saveItem",value:function(t,e,i,r,a){p.default.isLocalChange(r)&&!p.default.isUndoRedoChange(r)&&this._coalesceChange(t,e,m.a.CrudActions.Modified,i)}},{key:"addItem",value:function(t,e,i,r){var a=this.getItemSaveData(i);this._coalesceChange(t,i,m.a.CrudActions.Added,a)}},{key:"deleteItem",value:function(t,e,i){this._coalesceChange(t,e,m.a.CrudActions.Removed,e)}},{key:"setNote",value:function(t,e,i,r,a){if(p.default.isLocalChange(a))if(i){var n=this.getItemSaveData(i);this._coalesceChange(t,i,m.a.CrudActions.Modified,n)}else r&&this._coalesceChange(t,r,m.a.CrudActions.Removed,r)}},{key:"moveItem",value:function(t,e){var i=e.parent(),r=e.index;this._coalesceChange(t,e,m.a.CrudActions.Modified,{parent:i,index:r})}},{key:"_saveItem",value:function(t,e,i){i.parent&&p.default.isVMLI(i.parent)&&(i.parent=i.parent.id);var r=p.default.extend({id:e.id},this.convertItemUndefineds(e,i)),a=L.a.getItemData(e.id)||{},n=a.pendingSync||{};Object.keys(i).forEach(function(t){"id"!==t&&"dateModified"!==t&&void 0===n[t]&&(n[t]=a[t])});var o=Object.assign({pendingSync:n},r);this.itemsPending[e.id]=Object.assign(this.itemsPending[e.id]||{},n),L.a.saveItem(e,o),this._saveItemRemote(t,e,r)}},{key:"_saveItemRemote",value:function(){var t=h()(u.a.mark(function t(e,i,r){var a,n;return u.a.wrap(function(t){for(var o=0;;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;switch(t.prev=t.next){case 0:if(!this.api){t.next=14;break}return t.next=4,this.encryptItemForSaveRemote(e,r);case 4:if(a=t.sent,!S.a.validateOutFields(a,!0)){t.next=13;break}return t.next=8,this.getAPIForDocumentItems(e).update(a);case 8:return(n=t.sent)&&(delete this.itemsPending[r.id],r.isDeleted?L.a.deleteItem(r.id):L.a.saveItem(i,{id:i.id,pendingSync:void 0})),t.abrupt("return",n);case 13:0;case 14:case"end":return t.stop()}}},t,this)}));return function(e,i,r){return t.apply(this,arguments)}}()},{key:"_deleteItem",value:function(t,e){if(this.getItemData(e.id))this._saveItem(t,e,{isDeleted:!0});else try{p.default.PAssert(257,!1,"Remove Error: Item did not exist",e.getParsedText())}catch(i){p.default.reportError(i)}}},{key:"_deleteItemRemote",value:function(){var t=h()(u.a.mark(function t(e,i,r){return u.a.wrap(function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:return t.abrupt("return",this._saveItemRemote(e,i,{id:r,isDeleted:!0}));case 1:case"end":return t.stop()}}},t,this)}));return function(e,i,r){return t.apply(this,arguments)}}()},{key:"generateId",value:function(){return O.a.database().ref().push().key}},{key:"addDocument",value:function(t,e){var i=this,r=t.getSaveInfo(),a=t.getRootItem(),n=this.getItemSaveDataRecursive(a);if(!1!==e&&(this.documents[t.id]=t,r.pendingSync=Date.now(),L.a.saveDocument(r),L.a.ensureMirror(n)),this.api){var o=S.a.documentOut(r);return Promise.all(n.map(function(e){return i.encryptItemForSaveRemote(t,e)})).then(function(t){i.api.addDocument(o,t).then(function(t){t.items.onLoad(p.default.emptyFn),t.items.onUpdate(i.onItemsChange.bind(i,r)),t.info.onLoad(p.default.emptyFn),t.info.onUpdate(i.onDocInfoChange.bind(i,r)),t.info.onAclUpdate(i.onDocAclChange.bind(i,r))})}).catch(function(t){return p.default.reportError(t)})}return Promise.resolve()}},{key:"encryptItemForSaveRemote",value:function(t,e){return e.dateModified=this.api.serverTime,delete e.pendingSync,delete e.docId,S.a.encryptItemOut(e,f.default.crypto,t.getBestEncryption())}},{key:"saveDocument",value:function(t){var e=t.getSaveInfo(),i=Object.assign({pendingSync:Date.now()},e);this.documentsPending[t.id]=!0,L.a.saveDocument(i),this._saveDocumentRemote(t,e)}},{key:"_saveDocumentRemote",value:function(t,e){e||(e=t.getSaveInfo()),delete e.pendingSync;var i=S.a.documentOut(e,!0);S.a.validateOutFields(i,!0)&&this.getAPIForDocument(t).update(i,!0)}},{key:"getItemSaveDataRecursive",value:function(t,e){var i=this,r=!e;return e||(e=[]),e.push(t),t.hasNote()&&e.push(t.getNote()),t.hasChildren()&&t.getItems().forEach(function(t){i.getItemSaveDataRecursive(t,e)}),r&&(e=e.map(function(t){return i.getItemSaveData(t)})),e}},{key:"encodeValue",value:function(t){return p.default.isObject(t)||p.default.isArray(t)?JSON.stringify(t):t}},{key:"decodeValue",value:function(t){if("{"===t[0]||"["===t[0])try{t=JSON.parse(t)}catch(e){}return t}},{key:"getSetting",value:function(t){return L.a.getSetting(t)}},{key:"setSetting",value:function(t,e){var i=Date.now();L.a.setSetting(t,{pendingSync:i,v:e}),this._setSettingRemote(t,e)}},{key:"_setSettingRemote",value:function(t,e){var i=this;if(this.api)if(void 0===e||null===e)this.api.user.removeSetting(t);else{e=this.encodeValue(e),this.settingsPending[t]=!0;var r={v:e,d:this.api.serverTime};this.api.user.setSetting(t,r).then(function(e){if(e){delete i.settingsPending[t];var r=L.a.getSetting(t);delete r.pendingSync,L.a.setSetting(t,r)}})}}},{key:"saveBoard",value:function(t){var e=Date.now(),i=Object.assign({pendingSync:e},t);L.a.saveBoard(i),this._saveBoardRemote(t)}},{key:"_saveBoardRemote",value:function(t){var e=this;if(this.api){var i=p.default.cloneDeep(t);delete i.id,delete i.pendingSync,this.boardsPending[t.id]=!0;var r=S.a.boardOut(i);r.d=this.api.serverTime,this.api.user.setBoard(t.id,r).then(function(i){if(i){delete e.boardsPending[t.id];var r=L.a.getBoard(t.id);delete r.pendingSync,L.a.saveBoard(r)}})}}},{key:"deleteBoard",value:function(t){this.api&&this.api.user.removeBoard(t)}},{key:"deleteAuthToken",value:function(t){this.api&&(t=t.replace(/\./g,","),this.api.user.removeAuthToken(t))}},{key:"getAPIForDocument",value:function(t){return this.api.document(t.id).info}},{key:"getAPIForDocumentItems",value:function(t){return this.api.document(t.id).items}},{key:"getAPIForItem",value:function(t){return this.getAPIForDocumentItems(t.getDocumentOwner())}},{key:"clearAllData",value:function(){var t=h()(u.a.mark(function t(){var e=this;return u.a.wrap(function(t){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,Promise.all(Object.keys(this.documents).map(function(t){return e.documents[t].isAdmin()?e.getAPIForDocument({id:t}).deleteFully():Promise.resolve()}));case 3:return t.abrupt("return",this.api.user.deleteFully());case 6:t.prev=6,t.t0=t.catch(0),p.default.reportError(t.t0);case 9:case"end":return t.stop()}}},t,this,[[0,6]])}));return function(){return t.apply(this,arguments)}}()},{key:"deleteDocument",value:function(t){this.getAPIForDocument(t).deleteFully()}},{key:"updateOnlineStatus",value:function(t){var e=st.a.onlineStatus,i=e.get();t||i!==m.a.OnlineStatus.Connecting?(p.default.clearTimeoutOnce("initialOffline"),e.set(t?m.a.OnlineStatus.Online:m.a.OnlineStatus.Offline)):k.a.isPlatformOnline()?p.default.timeoutOnce("initialOffline",function(){return e.set(m.a.OnlineStatus.Offline)},2e3):e.set(m.a.OnlineStatus.Offline)}},{key:"resolveItemConflicts",value:function(t,e){var i=this;f.default.PaneUpdateBatcher.beginUpdateItems(),e.forEach(function(e){var r=i.itemsPending[e.id],a=st.a.getItem(e.id),n=i.getItemData(e.id);r&&(Object.keys(r).forEach(function(o){var u=n[o],s=e[o];if(s===r[o]||s===u)u===s&&delete r[o],delete e[o];else if("text"!==o||e.isDeleted)delete e[o];else{var h="Sync Conflict: ".concat(s,"  ;  ").concat(u);r[o]=e.text,i.handleRemoteItemChange(t,m.a.CrudActions.Modified,a.id,{text:h}),L.a.saveItem(a,{id:a.id,text:h}),delete e[o]}}),e.isDeleted&&(L.a.saveItem(a,{id:a.id,isDeleted:!1}),e.isDeleted=!1,r.isDeleted=!0));var o=e.id;p.default.isEmpty(e)||i.handleRemoteItemChange(t,m.a.CrudActions.Modified,o,e)}),f.default.PaneUpdateBatcher.commitUpdateItems()}},{key:"handleRemoteItemChange",value:function(t,e,i,r){var a,n,o=this.getItemData(i);r.isDeleted?e=m.a.CrudActions.Removed:o||(e=m.a.CrudActions.Added),e===m.a.CrudActions.Modified&&o?(n={id:i},Object.keys(r).forEach(function(t){o[t]!==r[t]&&("dateModified"!==t&&"id"!==t&&(a=!0),n[t]=r[t])}),Object.keys(o).forEach(function(t){"items"!==t&&t in r&&void 0!==o[t]&&void 0===r[t]&&(n[t]=void 0,a=!0)})):(a=!0,n=r),a&&ot.a.onRemoteChange(t,e,i,n)}},{key:"getEncryptionForDocument",value:function(t){return t.encryptionSentinel?f.default.crypto.getKeyBySentinel(t.encryptionSentinel):Object.keys(t.acl).length>1?f.default.crypto.getGlobalKey():f.default.crypto.getKey(f.default.settings.getBestUserEncryption())}},{key:"_getItemWithText",value:function(t){return{id:t.id,text:t.getRawText()}}},{key:"checkUserEncryption",value:function(t,e){var i=this;if(t){var r=function(){i.loadState.set(m.a.LoadState.NeedPassword),i._pauseProcessingItemsChanged=!0,f.default.menus.openModal(m.a.Modals.EnterCode,{noCancel:!0,isPassword:!0,text:"Please enter your encryption password to unlock your data.",onSelect:function(r){return new Promise(function(a,n){r&&f.default.crypto.setKey({name:m.a.EncryptionKeys.UserPassword,password:r,sentinelSalt:ut.a.getEncryptionUid()}).then(function(r){t===r.sentinel?(f.default.settings.addEncryptionKey(m.a.EncryptionKeys.UserPassword,r.key),e&&e(),a(),i._pauseProcessingItemsChanged=!1,i._processItemsChange()):(f.default.crypto.removeKey(m.a.EncryptionKeys.UserPassword),n("The password was invalid. Please try again."))}).catch(function(t){return p.default.reportError(t)})})}})},a=f.default.settings.getEncryptionKey(m.a.EncryptionKeys.UserPassword);a?f.default.crypto.decryptText(a,t,ut.a.getEncryptionUid()).then(function(t){t===m.a.EncryptionSentinel?e&&e():r()}):r()}else e&&e()}},{key:"_encryptDocumentItems",value:function(t,e,i){var r=this.getAPIForDocumentItems(e);return Promise.all(e.getAllItems().map(function(e){var a={id:e.id,text:e.getRawText()};return new Promise(function(e){S.a.encryptItemOut(a,f.default.crypto,i.key).then(function(i){if(S.a.validateOutFields(i,!0)){var a=r.getPathForItem(i,t);t[a+"t"]=i.t,e()}})})}))}},{key:"updateDocumentEncryption",value:function(t,e){var i,r=this,a={};return e&&e!==f.default.crypto.getKeyInfo(m.a.EncryptionKeys.Global)?(i=Object.assign({},f.default.settings.encryptionKeys.get()))[t.id]=e.key:e=f.default.crypto.getKeyInfo(m.a.EncryptionKeys.Global),a["documents/".concat(t.id,"/p/s")]=e.sentinel,a["userdocuments/".concat(ut.a.getUid(),"/").concat(t.id,"/s")]=e.sentinel,this._encryptDocumentItems(a,t,e).then(function(){return r.api.commitBatch(a).then(function(){i&&(t.encryptionSentinel.set(e.sentinel),f.default.settings.encryptionKeys.set(p.default.clone(i)))}).catch(function(t){return p.default.reportError(t)})}).catch(function(t){return p.default.reportError(t)})}},{key:"updateUserEncryption",value:function(t){var e=this;if(this.api){var i,r={},a=Object.assign({},f.default.settings.encryptionKeys.get());t!==f.default.crypto.getGlobalKeyInfo()?(i=t.sentinel,a[t.name]=t.key):(i=null,delete a[m.a.EncryptionKeys.UserPassword]);var n=f.default.settings.getSettingAbbrev("userEncryptionSentinel");return r[this.api.user.getPathForSettings()+n]={v:i},Promise.all(Object.keys(this.documents).filter(function(t){return!e.documents[t].encryptionSentinel.get()&&!e.documents[t].isShared()}).map(function(i){return e._encryptDocumentItems(r,e.documents[i],t)})).then(function(){return e.api.commitBatch(r).then(function(){f.default.settings.encryptionKeys.set(a),null===i&&f.default.crypto.removeKey(m.a.EncryptionKeys.UserPassword)})}).catch(function(t){return p.default.reportError(t)})}}}]),t}(),l()(n.prototype,"onLoadLocal",[A.a],Object.getOwnPropertyDescriptor(n.prototype,"onLoadLocal"),n.prototype),l()(n.prototype,"onLoadRemoteDocuments",[A.a],Object.getOwnPropertyDescriptor(n.prototype,"onLoadRemoteDocuments"),n.prototype),l()(n.prototype,"clearAllData",[A.a],Object.getOwnPropertyDescriptor(n.prototype,"clearAllData"),n.prototype),n);e.a=new gt},function(t,e,i){"use strict";i.r(e);var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(0),s=i(1),h=i(4),d=i(3),c=i(6),v=i(5),y=i(42),g=i(45),l=i(50),p={None:0,Left:1,Right:2,StartLine:3,EndLine:4,LeftWord:5,RightWord:6,Down:7,Up:8,PageDown:9,PageUp:10,Top:11,Bottom:12,PrevHeader:13,NextHeader:14,All:15},m=[s.a.KeyCode.Tab,s.a.KeyCode.Backspace,s.a.KeyCode.Delete],f=[s.a.KeyCode.UpArrow,s.a.KeyCode.DownArrow,s.a.KeyCode.LeftArrow,s.a.KeyCode.RightArrow,s.a.KeyCode.Home,s.a.KeyCode.End,s.a.KeyCode.A,s.a.KeyCode.E,s.a.KeyCode.F,s.a.KeyCode.B,s.a.KeyCode.PageUp,s.a.KeyCode.PageDown],k=function(){function t(){a()(this,t)}return o()(t,[{key:"getNavigationAction",value:function(t){var e=d.a.mac,i=t.ctrlKey&&!t.altKey&&!t.metaKey,r=t.altKey&&!t.ctrlKey&&!t.metaKey,a=t.metaKey&&!t.ctrlKey&&!t.altKey,n=!t.ctrlKey&&!t.altKey&&!t.metaKey,o=t.normCode,u=s.a.KeyCode,h=p;if(o===u.LeftArrow){if(i&&!d.a.mac||r&&d.a.mac)return h.LeftWord;if(a&&e)return h.StartLine;if(n)return h.Left}if(o===u.RightArrow){if(i&&!d.a.mac||r&&d.a.mac)return h.RightWord;if(a&&e)return h.EndLine;if(n)return h.Right}if(o===u.UpArrow){if(e&&a)return h.Top;if(e&&i)return h.PageUp;if(e&&r)return h.StartLine;if(!e&&i)return h.PrevHeader;if(n)return h.Up}if(o===u.DownArrow){if(e&&a)return h.Bottom;if(e&&i)return h.PageDown;if(e&&r)return h.EndLine;if(!e&&i)return h.NextHeader;if(n)return h.Down}if(o===u.A&&i&&e)return h.StartLine;if(o===u.E&&i&&e)return h.EndLine;if(o===u.B&&i&&e)return h.Left;if(o===u.F&&i&&e)return h.Right;if(o===u.Home&&!e){if(i)return h.Top;if(n)return h.StartLine}if(o===u.End&&!e){if(i)return h.Bottom;if(n)return h.EndLine}return o===u.PageUp&&n?h.PageUp:o===u.PageDown&&n?h.PageDown:o===u.A&&a&&e||o===u.A&&i&&!e?h.All:h.None}},{key:"updateAutocomplete",value:function(t){var e=t&&t.normCode&&f.indexOf(t.normCode)>=0&&"#"!==t.key;if(!d.a.isMobile&&!u.default.isDemoRunning&&v.a.isValid()){var i=v.a.getStartIndex(),r=v.a.getStartItem(),a=v.a.getStartOffset(),n=v.a.getPane();v.a.isValid()&&r===v.a.getEndItem()&&a===v.a.getEndOffset()&&n.isIndexMounted(i)?g.a.updateFromPane({owner:r,pane:n,index:i,start:a,element:v.a.getStartElement(),fromArrows:e}):g.a.hide()}}},{key:"stopPropagation",value:function(t){try{u.default.PAssert(515,t.stopImmediatePropagation,"Should always be defined")}catch(e){u.default.reportError(e)}t.stopImmediatePropagation&&t.stopImmediatePropagation()}},{key:"preventDefault",value:function(t){try{u.default.PAssert(516,t.preventDefault,"Should always be defined")}catch(e){u.default.reportError(e)}t.preventDefault&&t.preventDefault()}},{key:"keyup",value:function(t,e){if(d.a.isMobile&&v.a.scrollStartIntoView(d.a.ios),e.normCode===s.a.KeyCode.Space&&l.a.clearGroupTextChanges(),this.stopPropagation(e),this.preventDefault(e),this.isTyping=!1,e.handled)return!0}},{key:"handleSelectAll",value:function(t){var e=t.indexOfFirstItem(),i=t.indexOfLastItem();return v.a.selectIndices(e,0,i,-1,s.a.SelectOption.AllowPrefix),!1}},{key:"handleSelectAllItem",value:function(){if(u.default.focusedPane&&u.default.focusedPane.isWriteable)return v.a.selectIndex(v.a.getStartIndex(),0,-1),!1}},{key:"_move",value:function(t){try{u.default.PAssert(517,t===s.a.Direction.Up||t===s.a.Direction.Down,"Must move in a direction")}catch(p){u.default.reportError(p)}var e,i,r=u.default.focusedPane,a=v.a.getStartIndex(),n=v.a.getEndIndex(),o=v.a.getStartItem(),h=v.a.getEndItem(),d=!1;if((o.parent()===h.parent()&&(d=!0),!d)&&!r.getNextItem(v.a.getEndIndex(),!0))for(var y=0;h;){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;if(o.parent()===h.parent()){d=!0;break}h=h.parent()}if(d&&(t===s.a.Direction.Up?(e=r.getPreviousItem(a,!0),i=h.getIndex()+1):(e=r.getNextItem(n,!0),i=o.getIndex()),e)){c.e.beginAction(),r.setIgnoreRestoreScroll();var g=v.a.save();v.a.reset();var l=1+e.numChildrenRecursive();u.default.setItemAnimationMode(s.a.ItemAnimationMode.Move),e.moveTo({parent:e.parent(),index:i},s.a.ChangeType.Local),u.default.resetItemAnimationMode(),t===s.a.Direction.Up?(g.startIndex-=l,g.endIndex-=l):t===s.a.Direction.Down&&(g.startIndex+=l,g.endIndex+=l),v.a.restore(g),t===s.a.Direction.Up?v.a.scrollStartIntoView():v.a.scrollEndIntoView(),c.e.endAction()}}},{key:"moveUp",value:function(){!u.default.focusedPane.isViewAgenda()&&v.a.isValid()&&this._move(s.a.Direction.Up)}},{key:"moveDown",value:function(){!u.default.focusedPane.isViewAgenda()&&v.a.isValid()&&this._move(s.a.Direction.Down)}},{key:"handleArrows",value:function(t,e){var i=u.default.focusedPane;if(!v.a.isValid())return!0;var r=this.getNavigationAction(e),a=p;switch(v.a.preferLineStart=!1,r){case a.Left:case a.Right:case a.StartLine:case a.EndLine:case a.LeftWord:case a.RightWord:var n,o,c,g,l,m,f=r===a.Left||r===a.LeftWord||r===a.StartLine,k=r===a.Right||r===a.RightWord||r===a.EndLine;f&&(!e.shiftKey||v.a.isArrowSelectInverted())||k&&e.shiftKey&&v.a.isArrowSelectInverted()||r===a.StartLine&&v.a.getStartIndex()===v.a.getEndIndex()?(c=v.a.getStartOffset(),g=v.a.getStartIndex(),m=v.a.getStartTotal(),n=v.a.getStartObject()):(c=v.a.getEndOffset(),g=v.a.getEndIndex(),m=v.a.getEndTotal(),n=v.a.getEndObject());var A,S=n.item;if(o=S.getParsedText(),r===a.StartLine)l=h.default.Measure.getCaretOffset(n,i,c).lineStart,g=v.a.isArrowSelectInverted()?v.a.getStartIndex():v.a.getEndIndex(),m=v.a.isArrowSelectInverted()?v.a.getStartTotal():v.a.getEndTotal();else if(r===a.EndLine){var w=h.default.Measure.getCaretOffset(n,i,c);S.metricsInPane(i,g);l=w.lineStart+w.lineLength,g=v.a.isArrowSelectInverted()?v.a.getStartIndex():v.a.getEndIndex()}else if(r===a.LeftWord){var L=y.a.getPreviousWord(S,o,c-1),F=o.prevIndexOf(s.a.AttachChar,c);if(F<0||F<=L)if(-1===L&&0===c)if(h.default.settings.selectFullItems.get()&&e.shiftKey)l=0;else if(g>0){if((g=i.indexOfPrevVMLI(g,!1,!0))>=0){var C=i.itemAtIndex(g).getParsedText();l=y.a.getPreviousWord(S,C,C.length-1)+1,m=C.length}}else l=-1;else l=L+1;else F>L&&(l=F+1,F+1===c&&l--)}else if(r===a.RightWord){var I=y.a.getNextWord(S,o,c+1),P=o.indexOf(s.a.AttachChar,c);if(P<0||P>=I)if(I===m)if(c!==m||e.shiftKey&&h.default.settings.selectFullItems.get())l=m;else if(g<i.numItems()-1){if((g=i.indexOfNextVMLI(g,!1,!0))>=0){var N=(A=i.itemAtIndex(g)).getParsedText();I=y.a.getNextWord(A,N,0),m=N.length,-1===I&&(I=N.length),l=I}}else l=m+1;else l=I;else(I>P||I<0)&&P>=0&&(l=P,P===c&&l++)}else r===a.Left?l=v.a.getStartOffset()===v.a.getEndOffset()||e.shiftKey?y.a.moveLeft(S,c):v.a.getStartOffset():r===a.Right&&(l=v.a.getStartOffset()===v.a.getEndOffset()||e.shiftKey?y.a.moveRight(S,c,m):v.a.getEndOffset());if(v.a.preferLineStart=f,!A&&(!h.default.settings.selectFullItems.get()||!e.shiftKey))if(l<v.a.getStartItem().getPrefixLength()&&r!==a.StartLine)if(v.a.preferLineStart=!1,g>0){g=i.indexOfPrevVMLI(g,!1,!0);var H=i.itemAtIndex(g);l=H.getParsedText().length,y.a.isInsideMarkup(H,l)&&(l=y.a.moveLeft(H,l))}else l=0;else l>m&&(g<i.numItems()-1?(g=i.indexOfNextVMLI(g,!1,!0),l=0):l=m);if(e.shiftKey){var M=v.a.isArrowSelectInverted()?v.a.getEndIndex():v.a.getStartIndex(),z=v.a.isArrowSelectInverted()?v.a.getEndOffset():v.a.getStartOffset();!v.a.isArrowSelectInverted()&&f&&g<=v.a.getStartIndex()&&l>=-1&&l<v.a.getStartOffset()?v.a.setArrowSelectInverted(!0):v.a.isArrowSelectInverted()&&k&&g>=v.a.getEndIndex()&&l>v.a.getEndOffset()&&v.a.setArrowSelectInverted(!1),v.a.isArrowSelectInverted()?v.a.selectIndices(g,l,M,z):v.a.selectIndices(M,z,g,l)}else v.a.selectIndex(g,l);if(d.a.isFirefox)if(e.normCode===s.a.KeyCode.LeftArrow){if(S.getParsedText()[v.a.getStartOffset()-1]===s.a.AttachChar&&!e.shiftKey)return v.a.selectItem(S,v.a.getStartOffset()-1),!1}else if(e.normCode===s.a.KeyCode.RightArrow){if(S.getParsedText()[v.a.getEndOffset()]===s.a.AttachChar&&!e.shiftKey)return v.a.selectItem(S,v.a.getEndOffset()+1),!1}f?v.a.scrollStartIntoView():v.a.scrollEndIntoView();break;case a.Up:case a.Down:case a.Top:case a.Bottom:case a.PageUp:case a.PageDown:case a.PrevHeader:case a.NextHeader:var D,V,G,T=r===a.Up||r===a.Top||r===a.PageUp,q=r===a.Down||r===a.Bottom||r===a.PageDown;T&&(!e.shiftKey||v.a.isArrowSelectInverted())||q&&e.shiftKey&&v.a.isArrowSelectInverted()?(G=v.a.getStartOffset(),V=v.a.getStartIndex(),D=v.a.getStartObject()):(G=v.a.getEndOffset(),V=v.a.getEndIndex(),D=v.a.getEndObject());var j,Y=D.item,X=h.default.Measure.getCaretOffset(D,i,G),Q=h.default.Measure.getCaretScreenPosition(i,V,G),J=(X.lineOffset,Q.left);if(v.a.preferLineStart=X.lineOffset<=2,r===a.Up){var Z=X.line-1;if(0===V&&Z<0)j=0,Z=0;else{if(Z<0&&V>0)if((V=i.indexOfPrevVMLI(V,!1,!0))>=0)Y=i.itemAtIndex(V),D=i.objectAtIndex(V),Z=h.default.Measure.getCaretOffset(D,i).line;Z>=0&&(j=h.default.Measure.getOffsetForScreenPositionInLine(V,D,i,Z,J))}}else if(r===a.Down){var B=X.line+1;B>Y.metricsInPane(i,V).styledLines.length-1&&(V<i.numItems()-1&&(V=i.indexOfNextVMLI(V,!1,!0))>=0?(Y=i.itemAtIndex(V),B=0):B=X.line),V>=0&&(D=i.objectAtIndex(V),j=h.default.Measure.getOffsetForScreenPositionInLine(V,D,i,B,J))}else if(r===a.Top)V=i.indexOfFirstItem(),j=0;else if(r===a.Bottom){var $=i.getLastItem(),U=i.numItems();$&&U>0&&(V=i.indexOfLastItem(),j=$.getParsedText().length)}else if(r===a.PageUp){V=i.indexPageUp(v.a.getStartIndex()),j=0}else if(r===a.PageDown){var R=i.indexPageDown(v.a.getStartIndex());V=R,j=i.itemAtIndex(R).getParsedText().length}else{if(r===a.PrevHeader&&i.isViewOutline()){var E=v.a.getStartItem();if(E.parent()===u.default.focusedItem){if(!E.isFirstChild()){try{u.default.PAssert(518,E.getIndex()>0,"Should never hit this with the first item in the list")}catch(W){u.default.reportError(W)}x=E.parent().getChild(E.getIndex()-1)}}else{for(var K=0;E.parent()!==u.default.focusedItem;){if(K++>5e3&&__infLoop&&__infLoop(K))throw new RangeError;E=E.parent()}x=E}return void 0!==x&&v.a.selectItem(x,-1),!1}if(r===a.NextHeader&&i.isViewOutline()){var x,b=v.a.getEndItem();if(b.parent()===u.default.focusedItem)b.isLastChild()||(x=b.parent().getChild(b.getIndex()+1));else{for(var O=0;b.parent()!==u.default.focusedItem;){if(O++>5e3&&__infLoop&&__infLoop(O))throw new RangeError;b=b.parent()}b.isLastChild()||(x=b.parent().getChild(b.getIndex()+1))}return void 0!==x&&v.a.selectItem(x,-1),!1}}if(V>=0&&!isNaN(j))if(e.shiftKey){M=v.a.isArrowSelectInverted()?v.a.getEndIndex():v.a.getStartIndex(),z=v.a.isArrowSelectInverted()?v.a.getEndOffset():v.a.getStartOffset();!v.a.isArrowSelectInverted()&&T&&(V===v.a.getStartIndex()&&j<v.a.getStartOffset()||V<v.a.getStartIndex())?v.a.setArrowSelectInverted(!0):v.a.isArrowSelectInverted()&&q&&(V===v.a.getEndIndex()&&j>v.a.getEndOffset()||V>v.a.getEndIndex())&&v.a.setArrowSelectInverted(!1),v.a.isArrowSelectInverted()?v.a.selectIndices(V,j,M,z):v.a.selectIndices(M,z,V,j)}else v.a.selectIndex(V,j);T?v.a.scrollStartIntoView():v.a.scrollEndIntoView();break;case a.All:this.handleSelectAll(i)}return r===a.None}},{key:"keydown",value:function(t,e){this.isTyping=!0;var i=!0;if(m.indexOf(e.normCode)>=0?i=this.keypress(t,e,!0):d.a.mac&&e.ctrlKey&&e.normCode===s.a.KeyCode.D?i=this.keypress(t,e,!0):f.indexOf(e.normCode)>=0?(u.default.setItemAnimationMode(s.a.ItemAnimationMode.None),i=this.handleArrows(t,e),u.default.resetItemAnimationMode(),d.a.ios||this.getNavigationAction(e)&&this.updateAutocomplete(e)):d.a.mac&&e.metaKey||!d.a.mac&&e.ctrlKey&&!e.altKey?e.normCode!==s.a.KeyCode.Y&&e.normCode!==s.a.KeyCode.Z||(i=this.keypress(t,e,!0)):d.a.mac&&e.ctrlKey&&e.normCode===s.a.KeyCode.H&&this.preventDefault(e),i&&v.a.getStartIndex()===v.a.getEndIndex()&&v.a.getStartOffset()===v.a.getEndOffset()){var r=v.a.getStartOffset(),a=v.a.getStartItem(),n=a.getParsedText();u.default.shouldLog(s.a.LogLevels.Edit)&&console.log("check markdown",r,n[r]),"]"===n[r]&&y.a.isInsideMarkup(a,r)&&(r=y.a.moveRight(a,r,n.length-1),v.a.selectIndex(v.a.getStartIndex(),r),v.a.focusHiddenInput(),u.default.shouldLog(s.a.LogLevels.Edit)&&console.log("Adjusted to",r))}return!d.a.isMobile&&i&&this.keyWantsScrollIntoView(e,!0)&&v.a.scrollStartIntoView(),i}},{key:"checkKeypressSpecialCases",value:function(t,e){var i;return t.ctrlKey&&t.altKey&&e?i=!0:t.metaKey&&t.normCode===s.a.KeyCode.Tilde&&(i=!1),i}},{key:"isMultiselectDangerous",value:function(){var t=0,e=u.default.focusedPane;if(!e.isViewOutline()&&!e.isViewProject())return"Are you sure you want to delete multiple items?";for(var i=e.indexOfNextVMLI(v.a.getStartIndex()-1),r=e.indexOfPrevVMLI(v.a.getEndIndex()+1),a=i,n=0;!isNaN(a)&&a>=0&&a<=r;){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=e.itemAtIndex(a);if(e.isSearchedFlat()){if(e.search.isFlatSearchResult(o)&&n++,n>=2)return s.a.MessageID.FlatSearchMultiSelect}else if(++n>=8)return"You have selected a large number of items to delete. Are you sure?";a=e.indexOfNextVMLI(a)}return!1}},{key:"keypress",value:function(t,e,i,r){var a=[s.a.KeyCode.Enter,s.a.KeyCode.D];try{u.default.PAssert(519,e.stopPropagation,"Should always be defined")}catch(f){u.default.reportError(f)}e.stopPropagation&&e.stopPropagation();var n=!0,o=u.default.focusedPane,y=e.normCode>=32||a.indexOf(e.normCode)>=0;if(!(0===e.which)&&(i||y)){if(d.a.mac&&e.metaKey||!d.a.mac&&e.ctrlKey)switch(String.fromCharCode(e.normCode)){case"c":case"C":return e.handled=!0,!0;case"v":case"V":return e.handled=!0,!0;case"x":case"X":return e.handled=!0,!0;case"Y":case"y":case"Z":case"z":try{u.default.PAssert(520,!1,"Should not be handled undo/redo hotkeys here")}catch(f){u.default.reportError(f)}return e.handled=!0,!0;case"r":case"R":case"a":case"A":case"t":case"T":return e.handled=!0,!0}var g=v.a.getStartItem();c.e.beginAction();var l=[s.a.KeyCode.Tab,s.a.KeyCode.Enter,s.a.KeyCode.Backspace,s.a.KeyCode.Delete,s.a.KeyCode.D];if(v.a.getStartIndex()!==v.a.getEndIndex()&&e.normCode!==s.a.KeyCode.Tab&&(!e.metaKey&&!e.ctrlKey&&!e.altKey||l.indexOf(e.normCode)>=0))if(o.isViewOutline()||o.isViewProject()){var p;if(h.default.PaneUpdateBatcher.beginUpdateItems(),!r&&(p=this.isMultiselectDangerous())){if(o.isSearchedFlat())h.default.toasts.pushMessage(s.a.MessageID.FlatSearchMultiSelect);else{var m=v.a.save();h.default.menus.confirm(p,function(r){v.a.restore(m),r&&this.keypress(t,e,i,!0)}.bind(this))}n=!1}else n=!!o.isEditable&&(n&&this.handleMultiselect(e));h.default.PaneUpdateBatcher.commitUpdateItems()}else h.default.toasts.pushMessage({text:"Editing multiple items from this view is not currently supported. Please edit them individually.",actionText:"OKAY"}),n=!1;n&&l.indexOf(e.normCode)>=0&&(h.default.PaneUpdateBatcher.beginUpdateItems(),e.normCode===s.a.KeyCode.Enter?n=!!o.isEditable&&(n&&this.handleEnter(e)):e.normCode===s.a.KeyCode.Backspace?n=!!(g&&g.allowTextEditing()&&o.isEditable)&&(n&&this.handleBackspace(e)):(e.normCode===s.a.KeyCode.Delete||d.a.mac&&e.ctrlKey&&e.normCode===s.a.KeyCode.D)&&(n=!!(g&&g.allowTextEditing()&&o.isEditable)&&(n&&this.handleDelete(e))),h.default.PaneUpdateBatcher.commitUpdateItems()),c.e.endAction()}return!d.a.isMobile&&this.keyWantsScrollIntoView(e,i)&&v.a.scrollStartIntoView(),n}},{key:"handleMultiselect",value:function(t){var e=0,i=0,r=u.default.focusedPane,a=r.indexOfNextVMLI(v.a.getStartIndex()-1),n=r.indexOfPrevVMLI(v.a.getEndIndex()+1),o=v.a.getStartOffset(),h=v.a.getEndOffset();v.a.selectIndices(a,o,n,h,s.a.SelectOption.AllowPrefix);var d=!0,y=r.objectAtIndex(a),g=v.a.getStartItem(),p=v.a.getEndItem();if(g.isNote()&&(g=g.parent()),p.isNote()&&(p=p.parent()),!r.hasNonVMLIs&&g===p)return!1;if(t.normCode===s.a.KeyCode.Enter&&t.shiftKey)return!0;var m=[];n=n;for(var f=r.indexOfNextVMLI(a);f&&f>=0&&(f<n||f===n&&v.a.getEndOffset()===v.a.getEndTotal());){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var k=r.itemAtIndex(f);k.parent()===u.default.focusedPane.getItem()&&k.isHeader()&&0,m.indexOf(k)<0&&k!==g&&m.push(k),f=r.indexOfNextVMLI(f)}var A,S=v.a.getEndItem().levelsDeep.get()-v.a.getStartItem().levelsDeep.get();if(v.a.getStartOffset()>0||v.a.getEndOffset()<v.a.getEndTotal()){var w=g.splitUsableText(g.getParsedText(),o,o),L=p.splitUsableText(p.getParsedText(),h,h);A=w.before+L.after,c.e.performAction(c.c.Remove,{itemID:g.id,position:v.a.getStartOffset(),text:g.getParsedText().slice(v.a.getStartOffset())}),c.e.performAction(c.c.Insert,{itemID:g.id,position:v.a.getStartOffset(),text:p.getParsedText().substring(v.a.getEndOffset())}),m.indexOf(p)<0&&m.push(p),0===v.a.getStartOffset()&&g.copyProperties(p)}else c.e.performAction(c.c.Remove,{itemID:g.id,position:0,text:g.getParsedText()}),A="";if(t.normCode!==s.a.KeyCode.Backspace&&t.normCode!==s.a.KeyCode.Delete&&t.normCode!==s.a.KeyCode.Enter||(d=!1),g.setText(A,s.a.ChangeType.Local),p.moveChildren(g,0,s.a.ChangeType.Local),S>0){for(var F=0,C=[],I=p.nextSibling();S>0&&I;){if(F++>5e3&&__infLoop&&__infLoop(F))throw new RangeError;f=I.getIndex();var P=I.parent().getItems().slice(f);C=C.concat(P),I=I.parent().nextSibling(),S--}if(C.length>0){var N=0,H=g;f=0;for(var M=0;M<C.length;M++){if(N++>5e3&&__infLoop&&__infLoop(N))throw new RangeError;var z=C[M],D=z.parent();if(m.indexOf(D)>=0){var V=z.getIndex();z.moveTo({parent:H,index:f},s.a.ChangeType.Local),c.e.performAction(c.c.Move,{itemID:z.id,oldParent:D.id,oldPosition:V,newParent:H.id,newPosition:f}),f++}}}}else if(m.indexOf(p.parent())>=0)for(var G=0,T=(H=g.parent(),r.getNextItem(n,!0));T;){if(G++>5e3&&__infLoop&&__infLoop(G))throw new RangeError;f=H.numItems();var q=T.parent(),j=q.getChildIndex(T);T.moveTo({parent:H,index:f},s.a.ChangeType.Local),c.e.performAction(c.c.Move,{itemID:T.id,oldParent:q.id,oldPosition:j,newParent:H.id,newPosition:f}),T=r.getNextItem(n,!0)}l.a.saveDeleteSelection(),l.a.beginAction();for(M=0;M<m.length;M++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var Y=m[M];try{u.default.PAssert(521,Y,"Item must exist")}catch(Q){u.default.reportError(Q)}Y.isDeleted()||Y.parent().deleteChild(Y,void 0,void 0,s.a.ChangeType.Local)}if(l.a.endAction(),r.hasNonVMLIs){var X=r.closestIndexOfObject(y);try{u.default.PAssert(522,X>=0,"Could not find item to select")}catch(Q){u.default.reportError(Q)}X>=0&&v.a.selectIndex(X,o)}else v.a.selectIndex(a,o);return d}},{key:"handleTab",value:function(t){var e=0,i=v.a.getPane(),r=v.a.getStartItem(),a=v.a.getStartIndex(),n=v.a.getEndItem(),o=v.a.getStartObject(),d=v.a.getEndObject(),y=v.a.getStartOffset(),g=v.a.getEndOffset(),l=!t,p=l?0:1;if(o.levelsDeep<p)return!1;if(l&&i.isViewAutoBlocks()&&o.levelsDeep===p){var m=i.prevPaneObjectAtSameLevel(a);if(!m||m.block!==o.block||m.item.parent()!==r.parent())return!1}h.default.PaneUpdateBatcher.beginUpdateItems(),r&&r.isNote()&&(r=r.parent()),n&&n.isNote()&&(n=n.parent()),v.a.scrollStartIntoView();var f=r,k={},A=[r],S={},w={};if(w[r.id]=!0,r!==n){var L=0;do{if(L++>5e3&&__infLoop&&__infLoop(L))throw new RangeError;(f=u.default.getNextItem(f,i,{numLevels:0,ignoreSearch:!0}))&&(A.push(f),w[f.id]=!0)}while(f!==n&&void 0!==f)}var F,C,I,P=0;for(t?(F=function(){P=A.length-1},C=function(){return P>=0},I=function(){P--}):(F=function(){P=0},C=function(){return P<A.length},I=function(){P++}),F();C();I()){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var N=A[P];try{u.default.PAssert(523,N,"Must always be tabbing/untabbing valid items")}catch(W){u.default.reportError(W)}var H,M,z=N.parent(),D=z.getItems().indexOf(N);if(l){var V=0,G=void 0;if(H=D>0&&!o.isBlockHeader,i.search.isFlatSearchResult(N)&&(H=!1,h.default.toasts.pushMessage(s.a.MessageID.FlatSearchTab)),H)if(o.block){var T=i.prevPaneObjectAtSameLevel(a+P);T&&T.item&&(G=T.item,!0)}else G=z.itemAtIndex(D-1);if(H&&G){for(var q=0;G.isHidden(i);){if(q++>5e3&&__infLoop&&__infLoop(q))throw new RangeError;if(--D<=0)return h.default.PaneUpdateBatcher.commitUpdateItems(),!1;G=z.itemAtIndex(D-1)}S[z.id]||(k[N.parent().id]=N.parent(),k[G.id]=G,N.moveTo({parent:G,fromTab:!0},s.a.ChangeType.Local),G.isCollapsed(i,!1)&&G.setCollapsed(!1,i)),S[N.id]=!0,c.e.performAction(c.c.Move,{itemID:N.id,oldParent:z,oldPosition:D,newParent:G,newPosition:G.numItems()-1})}else G=z,S[N.id]=S[z.id];for(var j=!1,Y=N;Y;){if(V++>5e3&&__infLoop&&__infLoop(V))throw new RangeError;if(S[Y.id]){Y.isCollapsed(i,!1)||(j=!0);break}Y=Y.parent()}var X=N.getIndex()+1;if(j){var Q=0,J=N.getItems(),Z=0;for(M=0;M<J.length;M++){if(Q++>5e3&&__infLoop&&__infLoop(Q))throw new RangeError;var B=J[M];if(!w[B.id]){if(B.isHidden(i))continue;k[B.parent().id]=B.parent(),k[N.parent().id]=N.parent();var $=X+Z;B.moveTo({parent:N.parent(),index:$,fromTab:!0},s.a.ChangeType.Local),S[B.id]=!0,c.e.performAction(c.c.Move,{itemID:B.id,oldParent:N,oldPosition:M,newParent:N.parent(),newPosition:$}),Z++,M--}}}}else if(H=N.parent()!==u.default.focusedItem&&!(i.isViewProject()&&o.block.id!==i.blockNoKey&&N.parent().parent()===u.default.focusedItem),(i.search.isFlatSearchResult(N)||i.search.isFlatSearchResult(N.parent()))&&(H=!1,h.default.toasts.pushMessage(s.a.MessageID.FlatSearchTab)),H){var U=0,R=N.parent().parent(),E=z.getItems();for(M=D+1;E[D+1];){if(U++>5e3&&__infLoop&&__infLoop(U))throw new RangeError;var K=E[D+1];w[K.id]||K.isHidden(i)?D++:(k[K.parent().id]=K.parent(),k[N.id]=N,K.moveTo({parent:N,fromTab:!0},s.a.ChangeType.Local),S[K.id]=!0,c.e.performAction(c.c.Move,{itemID:K.id,oldParent:z,oldPosition:M,newParent:N,newPosition:N.numItems()-1})),M++}if(w[z.id]>=0&&(!z.parent()||z.parent()!==u.default.focusedItem))continue;var x=R.getItems().indexOf(z);k[N.parent().id]=N.parent(),k[R.id]=R,N.moveTo({parent:R,index:x+1,fromTab:!0},s.a.ChangeType.Local),S[N.id]=!0,c.e.performAction(c.c.Move,{itemID:N.id,oldParent:z,oldPosition:D,newParent:R,newPosition:x+1})}}i.setIgnoreRestoreScroll(),h.default.PaneUpdateBatcher.commitUpdateItems(!1,!1);var b=i.indexOfObject(o),O=i.indexOfObject(d);b>=0&&O>=0?v.a.selectIndices(b,y,O,g):requestAnimationFrame(function(){return v.a.updateCaret()})}},{key:"handleEnter",value:function(t){var e=u.default.focusedPane,i=v.a.getStartItem(),r=v.a.getStartObject(),a=v.a.getStartIndex(),n=v.a.getStartOffset(),o=v.a.getStartTotal(),g=v.a.getEndItem(),l=v.a.getEndOffset(),p=v.a.getEndTotal();if(!i){try{u.default.PAssert(524,!1,"Invalid item in handleEnter")}catch(j){u.default.reportError(j)}return!1}var m=i.parent();if(!m){try{u.default.PAssert(525,!1,"Invalid parent in handleEnter")}catch(j){u.default.reportError(j)}return!1}var f,k=m.getItems().indexOf(i),A=i.getParsedText(),S=i.getMooDate(),w=!1,L=m;if(e.clearPreventUpdate(),e.setIgnoreRestoreScroll(),t.shiftKey)return t.preventDefault(),!1;if(i.isNote()){if(!d.a.isMobile)return t.preventDefault(),!1}else{if(e.search.isFlatSearchResult(i))return h.default.toasts.pushMessage(s.a.MessageID.FlatSearchEnter),t.preventDefault(),!1;if(e.isViewProject()&&e.isItemTopLevel(r,i)&&i.hasChildren()&&0===i.getChild(0).getParsedTextWithoutPrefix().length)v.a.selectIndex(a+1,0);else if(i.shouldCopyPrefix()&&A===i.getPrefix())i.setText("",s.a.ChangeType.Local),v.a.selectIndex(a,0);else{if(!i.getPrefix()||n!==i.getPrefixLength()||l!==p){var F,C,I=!0,P=!1,N=!1,H={text:""},M=r.block;if(e.setIgnoreRestoreScroll(),e.isViewTag()&&i.getParsedText().indexOf(r.block.text)>=0&&(F=r.block.text,C=i.getParsedText()[i.getPrefixLength()]===s.a.TagPrefix?0:-1),y.a.isInsideMarkup(i,n)&&(n=y.a.moveRight(i,n,A.length)),!e.isViewAgenda()||0!==r.levelsDeep||i.hasVisibleChildren(e)&&!i.isCollapsed(e))if(i.hasAttachmentType(s.a.PluginType.Calendar))   ;else if(l===g.getPrefixLength()&&""!==A)k--,I=!1,P=!0;else if(n>=o)(w=!i.isCollapsed(e,!1)&&(i.getVisibleChildren(e).length>0||i.isPrefixHeader()))&&(L=i);else if(n===i.getPrefixLength()&&l===p)i.setText(i.getPrefix(),s.a.ChangeType.Local),c.e.performAction(c.c.Remove,{itemID:i.id,position:0,text:A});else{var z=i.splitUsableText(A,n,l);F&&z.before.indexOf(z)<0&&(0===C?z.before=F+" "+z.before:z.before+=" "+F),H.text=z.after,S&&z.after.includes(s.a.CharDate)&&(H.date=S),u.default.setItemAnimationMode(s.a.ItemAnimationMode.Move),i.setText(z.before,s.a.ChangeType.Local),c.e.performAction(c.c.Remove,{itemID:i.id,position:0,text:A.substring(0,l)}),N=!0,(w=!i.isCollapsed(e,!1)&&(i.numItems()>0||i.isHeader()))&&(L=i)}else M.isStarred?H.isStarred=!0:M.isImportant?H.priority=i.getPriority():M.isDate&&M.date&&i.getMooDate()?H.date=i.getMooDate().toData():H.text=" "+M.id,i.shouldSave()||(k=-1);!w&&F&&H.text.indexOf(F)<0&&(0===C?H.text=F+" "+H.text:H.text+=" "+F);var D=h.default.settings.defaultItemPrefix.get();if(w||!i.shouldCopyPrefix()&&!N?(!w||w&&D&&(i.isPrefixHeader()||i.shouldCopyPrefix()&&i.prefix===D))&&(H.text=(D&&D+" ")+H.text):H.text=i.getPrefix()+H.text,f=e.createVMLI(H,{parent:L,changeType:s.a.ChangeType.AllLocal,isEditable:!0}),N&&f.copyProperties(i),f.parseText("",s.a.ChangeType.Local|s.a.ChangeType.All),w)i.insertItem(f,0),c.e.performAction(c.c.Create,{itemID:f.id,parent:i.id,position:0,text:f.getParsedText()});else{try{u.default.PAssert(526,!f.isNote(),"Should never be inserting a note here")}catch(j){u.default.reportError(j)}L.insertItem(f,k+1),c.e.performAction(c.c.Create,{itemID:f.id,parent:L.id,position:k+1,text:f.getParsedText()})}u.default.resetItemAnimationMode();var V=I?f:i;try{u.default.PAssert(527,V,"Expected another item to exist")}catch(j){u.default.reportError(j)}var G=e.closestIndexOfObject(r),T=I?e.indexOfItem(f,M):P?G-1:G,q=V.shouldCopyPrefix()&&V.getPrefixLength()||0;T>=0&&v.a.selectIndex(T,q,q,d.a.android&&s.a.SelectOption.Delay);try{u.default.PAssert(528,t.preventDefault,"Should always be defined")}catch(j){u.default.reportError(j)}return t.preventDefault&&t.preventDefault(),!1}i.setText(i.getPrefix(),s.a.ChangeType.Local),v.a.selectIndex(a,0),c.e.performAction(c.c.Remove,{itemID:i.id,position:0,text:A})}}}},{key:"handleBackspace",value:function(t){var e=v.a.getStartItem(),i=v.a.getStartIndex(),r=v.a.getStartOffset(),a=v.a.getEndOffset(),n=v.a.getStartObject(),o=u.default.focusedPane,g=r===a;if(!e){try{u.default.PAssert(529,!1,"Invalid item in handleBackspace")}catch(T){u.default.reportError(T)}return!1}var p=e.parent();try{u.default.PAssert(530,p,"Must always have a valid parent for an item")}catch(T){u.default.reportError(T)}d.a.ie&&(t.preventDefault(),t.stopImmediatePropagation());var m=e.getParsedText(),f="",k=0,A=!0,S=e.hasAttachmentType(s.a.PluginType.Calendar);if(0===r&&0===a||""===m)if(n.isBlockHeader&&e.hasChildren())A=!1;else if(e.isNote()&&""!==m)A=!1;else if(S)A=!1;else if(v.a.getStartIndex()>0){var w=u.default.focusedPane.indexOfPrevVMLI(v.a.getStartIndex(),!0,!0),L=w>=0&&u.default.focusedPane.itemAtIndex(w);if(L&&L.allowTextEditing()){if((o.isViewAgenda()||o.search.isFlatSearchResult(e))&&0!==m.length&&(A=!1),A){o.setIgnoreRestoreScroll(),l.a.saveDeleteSelection();var F=L.getParsedText(),C=L.isFullscreen()?0:w,I=o.objectAtIndex(C),P=L.isFullscreen()?0:F.length;v.a.selectIndex(C,P),p.deleteChild(e,L,0,s.a.ChangeType.Local),m.length>0&&""!==m&&(0===F.length&&L.copyProperties(e),L.setText(L.generateSaveText(F)+e.generateSaveText(m),s.a.ChangeType.Local),e.hasNote()&&(L.hasNote()||L.moveNote(e,s.a.ChangeType.Local)),c.e.performAction(c.c.Insert,{itemID:L.id,position:F.length,text:m})),C=o.indexOfObject(I),v.a.selectIndex(C,P),A=!1}}else A=!1}else A=!1;else if(g&&r<=e.getPrefixLength())n.isBlockHeader&&e.hasChildren()?A=!1:(c.e.performAction(c.c.Remove,{itemID:e.id,position:0,text:m.slice(0,e.getPrefixLength())}),f=m.substr(e.getPrefixLength()),k=0);else if(0===r&&a===m.length)c.e.performAction(c.c.Remove,{itemID:e.id,position:0,text:e.getParsedText()}),f="",k=0;else if(t.metaKey)if(e.isNote()){var N=m.prevIndexOf("\n",a);N<0?(f=m.substring(a),k=0,c.e.performAction(c.c.Remove,{itemID:e.id,position:0,text:m.slice(0,a)})):(f=m.substring(0,N)+m.substring(a),k=N,c.e.performAction(c.c.Remove,{itemID:e.id,position:0,text:m.slice(N,a)}))}else f=e.getPrefix()+m.substring(a),c.e.performAction(c.c.Remove,{itemID:e.id,position:0,text:m.slice(0,a)}),k=0;else{var H=y.a.isInsideMarkup(e,r-1);if(H&&(r=y.a.moveLeft(e,r-1)+1,H.isMDImage()&&"!"===m[r-1]&&r--),g?a=r:y.a.isInsideMarkup(e,a-1)&&(a=y.a.moveRight(e,a-1,v.a.getStartTotal())-1),g=r===a,(d.a.mac&&t.altKey||!d.a.mac&&t.ctrlKey)&&g){var M=m.substring(r),z=y.a.getPreviousWord(e,m,r-1)+1;u.default.shouldLog(s.a.LogLevels.Edit)&&console.log(z,m[z],M),z>=0?(c.e.performAction(c.c.Remove,{itemID:e.id,position:z,text:m.slice(z,r)}),f=m.substring(0,z)+M,k=z):(r===m.length?0===r&&(f="",c.e.performAction(c.c.Remove,{itemID:e.id,position:0,text:m})):(c.e.performAction(c.c.Remove,{itemID:e.id,position:0,text:m.slice(0,r)}),f=M),k=0)}else if(g){var D=1;m.length>1&&""===m[r-1]&&D++,S&&m.charAt(r-1)===s.a.AttachChar?" "===m.charAt(r-2)?(f=m.substr(0,r-3)+m.substr(r-2),k=r-3):(f=m.substr(0,r-2)+m.substr(r-1),k=r-2):(f=m.substr(0,r-D)+m.substr(r),c.e.performAction(c.c.Remove,{itemID:e.id,position:r-D,text:m.slice(r-D,r)}),k=r-D),!S||f!==" "+s.a.AttachChar&&f!==s.a.AttachChar||(f="",k=0)}else{var V=m.slice(r,a);c.e.performAction(c.c.Remove,{itemID:e.id,position:r,text:V}),f=m.substr(0,r)+m.substr(a),k=r}}if(A){if(!h.default.settings.showMarkdown.get()){var G=f.search(/(_{4,}?|\*{4,}?)/);G>=0&&(f=f.replace(/(_{4,}?|\*{4,}?)/g,""),k>G&&(k-=k-G))}e.setText(f,s.a.ChangeType.Local),v.a.selectIndex(i,k),this.updateAutocomplete(t)}return!1}},{key:"handleDelete",value:function(t){var e=v.a.getStartItem(),i=u.default.focusedPane;if(!e)return!1;var r,a=e.parent(),n=e.getParsedText(),o=v.a.getStartIndex(),h=v.a.getStartOffset(),g=v.a.getEndOffset(),p=h===g,m=!0,f=e.hasAttachmentType(s.a.PluginType.Calendar);if(""===n)if(i.isViewOutline()){if(e.isNote())a.setNote(void 0,s.a.ChangeType.Local),v.a.selectItem(a,-1);else if(o<i.numItems()-1){var k=o;i.setIgnoreRestoreScroll(),l.a.saveDeleteSelection(),i.numItems()>1&&(e.hasChildren()?a.replaceChild(e,e.getFirstChild(),s.a.ChangeType.Local):a.deleteChild(e,a,k,s.a.ChangeType.Local)),v.a.selectIndex(k,0)}}else m=!1;else if(h===v.a.getStartTotal()&&g===v.a.getEndTotal())if(i.isViewOutline())if(e.isNote())m=!1;else{var A=i.indexOfNextVMLI(o,!0,!0),S=A>=0&&i.itemAtIndex(A);if(i.setIgnoreRestoreScroll(),S&&m){n=e.generateSaveText(n);var w=S.generateSaveText(S.getParsedText()),L=S.hasNote()&&S.getNote();if(e.setText(n+w,s.a.ChangeType.Local),L){var F=e.hasNote()&&e.getNote();if(F){var C=F.getRawText()+"\n\n--- merged note ---\n\n"+L.getRawText();F.setText(C,s.a.ChangeType.Local)}else L.setParent(e),e.setNote(L,s.a.ChangeType.Local)}c.e.performAction(c.c.Insert,{itemID:e.id,position:n.length,text:S.getParsedText()}),l.a.saveDeleteSelection(),S.parent().deleteChild(S,e,0,s.a.ChangeType.Local),v.a.selectIndex(v.a.getEndIndex(),g)}}else m=!1;else if(t.metaKey)e.isNote()||(r=n.substring(0,h),e.setText(r,s.a.ChangeType.Local),c.e.performAction(c.c.Remove,{itemID:e.id,position:0,text:n.slice(0,h)}),v.a.selectIndex(o,h));else if((d.a.mac&&t.altKey||!d.a.mac&&t.ctrlKey)&&h===g){var I=y.a.getNextWord(e,n,h+1);I<0&&(I=v.a.getStartTotal()),I>=0&&(r=n.substring(0,h)+n.substring(I),e.setText(r,s.a.ChangeType.Local),c.e.performAction(c.c.Remove,{itemID:e.id,position:I,text:r}),v.a.selectIndex(o,h))}else{if(y.a.isInsideMarkup(e,h-1)&&(h=y.a.moveLeft(e,h-1)+1),y.a.isInsideMarkup(e,g)&&(g=y.a.moveRight(e,g,v.a.getStartTotal())-1),p)f&&n.charAt(h)===s.a.AttachChar||(r=n.substr(0,h)+n.substr(h+1),c.e.performAction(c.c.Remove,{itemID:e.id,position:h,text:n.slice(h,h+1)}));else{n.slice(h,g);r=n.substr(0,h)+n.substr(g),c.e.performAction(c.c.Remove,{itemID:e.id,position:h,text:n.slice(h,g)})}!f||r!==" "+s.a.AttachChar&&r!==s.a.AttachChar&&r!==" "+s.a.AttachChar&&n!==s.a.AttachChar||(r=""),void 0!==r&&(e.setText(r,s.a.ChangeType.Local),v.a.selectIndex(o,h),this.updateAutocomplete(t))}return!1}},{key:"keyWantsScrollIntoView",value:function(t,e){switch(t.normCode){case s.a.KeyCode.LeftMeta:case s.a.KeyCode.RightMeta:case s.a.KeyCode.Alt:case s.a.KeyCode.Shift:case s.a.KeyCode.Ctrl:case s.a.KeyCode.LeftArrow:case s.a.KeyCode.RightArrow:case s.a.KeyCode.UpArrow:case s.a.KeyCode.DownArrow:return!1}return!(d.a.mac&&t.metaKey&&(e&&t.normCode===s.a.KeyCode.Tilde||!e&&"`"===String.fromCharCode(t.normCode)))&&((!(d.a.mac&&t.metaKey||!d.a.mac&&t.ctrlKey)||t.normCode!==s.a.KeyCode.Z&&t.normCode!==s.a.KeyCode.Y)&&!(t.normCode>=s.a.KeyCode.F1&&t.normCode<=s.a.KeyCode.F12))}},{key:"compoundOperation",value:function(t){c.e.beginAction(),h.default.PaneUpdateBatcher.beginUpdateItems(),t(),h.default.PaneUpdateBatcher.commitUpdateItems(),c.e.endAction()}}]),t}();e.default=new k},function(t,e,i){"use strict";var r=i(75),a=i.n(r),n=i(7),o=i.n(n),u=i(8),s=i.n(u),h=i(17),d=i.n(h),c=i(9),v=i.n(c),y=i(18),g=i.n(y),l=i(0),p=i(1),m=i(4),f=i(3),k=i(2),A=i.n(k),S=i(20),w=i(39),L=i(78),F=function(t){function e(){return o()(this,e),d()(this,v()(e).apply(this,arguments))}return g()(e,t),s()(e,[{key:"init",value:function(){var t=this.props;this.listenToDispatcher("windowResize"),t.supportArrows&&(this.selectedIndex=w.a.registerArrowsMode("FancyContextMenu",!0,this.getNumItems,this.onArrowsModeSelect,this.onArrowsModeKey),t.fromHotkey&&this.selectedIndex.set(0,!1),t.onSelectedIndexChanged&&this.selectedIndex.listen(t.onSelectedIndexChanged))}},{key:"close",value:function(){try{l.default.PAssert(1225,this.props.name,"Cannot call close on a menu without a name")}catch(t){l.default.reportError(t)}m.default.menus.closeContextMenu(this.props.name)}},{key:"getHotkeys",value:function(){var t=this.props,e=[w.a.createEscape(this.onEscapeKey)];return t.hotkeys&&(e=e.concat(t.hotkeys)),e}},{key:"getRefAtIndex",value:function(t){return this.refs["el_"+t]}},{key:"onMount",value:function(){f.a.isMobile||(this.props.noBackdrop&&document.addEventListener("mousedown",this.onMouseDownNoBackdrop,!0),this.updateState())}},{key:"onUnmount",value:function(){this.props.supportArrows&&w.a.exitArrowsMode("FancyContextMenu"),!f.a.isMobile&&this.props.noBackdrop&&document.removeEventListener("mousedown",this.onMouseDownNoBackdrop,!0)}},{key:"getState",value:function(){if(!f.a.isMobile||this.props.useElementPosition){var t=this.updatePosition();return{selectedIndex:this.selectedIndex,left:t.left,top:t.top,right:t.right,bottom:t.bottom,maxHeight:t.maxHeight}}return{top:this.isAtPosition("search")&&l.default.topBarHeight+p.a.MobileHeaderRow2Height||this.isAtPosition("top")&&l.default.topBarHeight||null,bottom:this.isAtPosition("bottom")?0:null}}},{key:"onMouseDownNoBackdrop",value:function(t){l.default.findParent(t.target,"fancyContextMenu")||m.default.menus.closeContextMenu()}},{key:"isAtPosition",value:function(t){if(this.props.position&&this.props.position.split("-").indexOf(t)>=0)return!0;return!1}},{key:"getNumItems",value:function(){return this.numItems}},{key:"onArrowsModeSelect",value:function(t){if(t>=0)if(this.props.onEnterKey)this.props.onEnterKey();else{var e=this.refs["el_"+t];e&&e.onClick&&e.onClick()}}},{key:"onArrowsModeKey",value:function(t,e){var i=this.props;i.onKeyPress&&i.onKeyPress(t,e)&&i.supportArrows&&w.a.exitArrowsMode("FancyContextMenu")}},{key:"onEscapeKey",value:function(){this.props.onEscape&&this.props.onEscape(),m.default.menus.closeContextMenu()}},{key:"onChildMouseEnter",value:function(t,e){this.selectedIndex.set(t)}},{key:"isOnSide",value:function(t){return this.props.side?this.props.side.indexOf(t)>=0:"bottom"===t}},{key:"updatePosition",value:function(){var t=this.props,e=f.a.windowWidth(),i=f.a.windowHeight();try{l.default.PAssert(1226,t.element,"Context menu needs an element to open on",t.id)}catch(m){l.default.reportError(m)}if(t.element){var r,a,n=t.element.getBoundingClientRect(),o=t.pos,u=this.refs.menu,s=o?o.left:void 0,h=o?o.top:void 0;isNaN(s)&&(this.isOnSide("right")?s=n.right:this.isOnSide("left")?r=e-("top left"===t.side?n.right:n.left):s=n.left),isNaN(h)&&(this.isOnSide("bottom")?h=n.bottom:this.isOnSide("top")?a=i-n.top:h=n.top);var d=t.positionOffset;d&&(!isNaN(s)&&d.left&&(s+=d.left),!isNaN(r)&&d.right&&(r+=d.right),!isNaN(h)&&d.top&&(h+=d.top),!isNaN(a)&&d.bottom&&(a+=d.bottom));var c={left:s,top:h,right:r,bottom:a};if(f.a.isMobile)c.left=0,c.bottom=f.a.getKBSize();else if(u){var v=s+u.clientWidth,y=h+u.clientHeight,g=e-8,p=i-8;"shrink"===this.props.overflowHeight&&a>i-8&&(c.maxHeight=Math.min(Math.max(i-h,260),500),y=Math.min(y,c.maxHeight+h)),v>g&&(c.left+=g-v),y>p&&(c.top+=p-y),(s<8||s+c.left<8)&&v<e&&(c.left+=8-s)}return c}return{left:0,top:0,maxHeight:400}}},{key:"remapChildren",value:function(t,e){var i=this;return A.a.Children.map(t,function(t){if(t&&"hr"!==t.type){if("leftcol"===t.key){var r=t.props,n=r.children,o=a()(r,["children"]);return A.a.createElement("div",o,i.remapChildren(n,e))}if("scroller"===t.key){var u={maxHeight:f.a.isMobile?.6*f.a.windowHeight():400};return A.a.createElement(L.a,{style:u},i.remapChildren(t.props.children,e))}if(!t.props||t.props.onClick||t.props.customLayout){var s=t.props.onMouseEnter?function(r){i.onChildMouseEnter(e.index,r),t.props.onMouseEnter(r)}:i.onChildMouseEnter.bind(i,e.index);return A.a.cloneElement(t,{onMouseEnter:s,ref:"el_"+e.index,selected:!f.a.isMobile&&i.state.selectedIndex===e.index++})}return t}return t})}},{key:"render",value:function(){var t=this.state,e=this.props,i=l.default.classNames("fancyContextMenu popup c-shadow-popup",e.className,e.position,e.background,{"c-bg-menu":!e.background},{loading:e.loading},{openFromBottom:e.openFromBottom},{top:this.isAtPosition("top")},{bottom:this.isAtPosition("bottom")},{left:this.isAtPosition("left")},{right:this.isAtPosition("right")},{fill:this.isAtPosition("fill")},{full:this.isAtPosition("full")}),r={left:t.left,top:t.top,right:t.right,bottom:isNaN(e.bottom)?t.bottom:e.bottom,width:e.width,height:e.height,minWidth:e.minWidth,maxHeight:t.maxHeight||e.maxHeight,maxWidth:e.maxWidth};f.a.isMobile&&this.isAtPosition("fill")&&(r.top=l.default.topBarHeight),r=l.default.extend(r,this.props.style);var a=this.props.children;if(e.supportArrows){var n={index:0};a=this.remapChildren(this.props.children,n),this.numItems=n.index}return A.a.createElement("div",{ref:"menu",id:e.id,className:i,style:r},a)}}]),e}(S.a);e.a=F},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(0),s=i(1),h=i(4),d=i(19),c=i(3),v=i(6),y=i(10),g=i(33),l=i(51),p=i(34),m=i(26),f=function(){function t(){a()(this,t),this.pluginsAvailable=[s.a.PluginID.Contacts,s.a.PluginID.Drive,s.a.PluginID.GCalendar,s.a.PluginID.Gmail],this._pluginEnabledObservables={},this._pluginOptionObservables={},this.isRefreshingContacts=new y.a(!1),this.GCalendarsAvailable=new g.a,this.GCalendarSyncErrors=new g.a(void 0),this.GCalendarAddFailure=new y.a(!1),this.GCalendarListFailure=new y.a(!1),this.GCalendarListLoading=new y.a(!1),this.GmailNumSyncd=new y.a(0),this.GmailNumTotal=new y.a(0),this.GmailCacheSize=new y.a(0),this.GmailSyncAccounts=new g.a,this.isSaveEnabled=new y.a(!1),this.hasRefreshed=!1,d.a.forceBind("calendarComparator",this)}return o()(t,[{key:"init",value:function(){var t=h.default.pluginManager.getPlugin(s.a.PluginID.GCalendar),e=t.getSetting(t.Settings.ImportCalendars);e&&this.GCalendarsAvailable.set(e)}},{key:"checkRefresh",value:function(){this.hasRefreshed||this.refreshPluginStatus()}},{key:"refreshPluginStatus",value:function(t){var e=0;this.hasRefreshed=!0;for(var i=0;i<this.pluginsAvailable.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r,a=this.pluginsAvailable[i];r=a===s.a.PluginID.Contacts?h.default.settings.syncContacts.get():h.default.pluginManager.isAuthorized(a),this.updatePluginStatus(a,r)}t&&t!==s.a.PluginID.GCalendar||(this.updatePluginOptionStatus(s.a.PluginID.GCalendar,s.a.PluginSettingsID.GCalendar.WriteAccess),this.updatePluginOptionStatus(s.a.PluginID.GCalendar,s.a.PluginSettingsID.GCalendar.ImportCalendars,!0),this.updatePluginOptionStatus(s.a.PluginID.GCalendar,s.a.PluginSettingsID.GCalendar.ExportCalendar)),t&&t!==s.a.PluginID.Drive||this.updatePluginOptionStatus(s.a.PluginID.Drive,s.a.PluginSettingsID.Drive.WriteAccess)}},{key:"refresh",value:function(t){this.refreshPluginStatus(),t&&t!==s.a.PluginID.GCalendar||(this.GCalendarAddFailure.set(!1),this.GCalendarListFailure.set(!1),this.updateCalendarList()),t&&t!==s.a.PluginID.Gmail||this.updateGmailInfo()}},{key:"calendarComparator",value:function(t,e){return t.summary.localeCompare(e.summary)}},{key:"updateGmailInfo",value:function(){var t=this,e=h.default.pluginManager.getPluginGmail();e.getTotalMessageCount(function(e){t.GmailNumTotal.set(e)}),this.GmailNumSyncd.set(e.getSyncdMessageCount()),this.GmailSyncAccounts.set(e.getSyncAccounts())}},{key:"updateCalendarList",value:function(){if(h.default.pluginManager.isAuthorized(s.a.PluginID.GCalendar)){var t=h.default.pluginManager.getPluginGCalendar();this.GCalendarListLoading.set(!0),t.getFullCalendarList(function(t){this.GCalendarListLoading.set(!1,!1),t?(t.sort(this.calendarComparator),this.GCalendarsAvailable.set(t),this.GCalendarListFailure.set(!1)):this.GCalendarListFailure.set(!0)}.bind(this))}}},{key:"getEnabledPlugins",value:function(){this.checkRefresh();var t=this._pluginEnabledObservables;return Object.keys(t).filter(function(e){return t[e].get()})}},{key:"getPluginEnabledObservable",value:function(t){return this.checkRefresh(),this._pluginEnabledObservables[t]}},{key:"isPluginEnabled",value:function(t){return this.checkRefresh(),this._pluginEnabledObservables[t].get()}},{key:"getPluginOptionObservable",value:function(t,e){return this.checkRefresh(),this._pluginOptionObservables[t][e]}},{key:"getPluginOptions",value:function(t){return this.checkRefresh(),this._pluginOptionObservables[t]}},{key:"isPluginAnOption",value:function(t){return t===s.a.PluginID.Mailbird?c.a.embed===s.a.EmbedApps.Mailbird:this.pluginsAvailable.indexOf(t)>=0}},{key:"updatePluginStatus",value:function(t,e,i){this._pluginEnabledObservables[t]?this._pluginEnabledObservables[t].set(e,i):this._pluginEnabledObservables[t]=new y.a(e)}},{key:"updatePluginOptionStatus",value:function(t,e,i){var r=h.default.pluginManager.getSetting(t,e);this._pluginOptionObservables[t]||(this._pluginOptionObservables[t]={}),this._pluginOptionObservables[t][e]?this._pluginOptionObservables[t][e].set(r||i&&[]):this._pluginOptionObservables[t][e]=i?new g.a(r):new y.a(r)}},{key:"onFailedAuthenticate",value:function(t){h.default.toasts.pushMessage({text:"We failed to successfully authenticate you for "+t+", please try again.",actionText:"OKAY"})}},{key:"_wasPluginAuthorized",value:function(t,e){var i;if(t===s.a.PluginID.Contacts)e.indexOf(s.a.GScope.Contacts)>=0&&(i=!0);else{var r=h.default.pluginManager.getPlugin(t),a=m.a.getUserSync();a&&(i=r.verifyAuthorization(a.email))}try{u.default.PAssert(487,i,"Should always be successful at authorizing plugins")}catch(n){u.default.reportError(n)}return i}},{key:"setEnabledPlugins",value:function(t,e){for(var i=0,r=0;r<t.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var a=t[r],n=a.id,o=a.enable,u=this._pluginEnabledObservables[n].get(),d=h.default.pluginManager.getPlugin(a.id);o?(a.id===s.a.PluginID.GCalendar&&d.setSetting(s.a.PluginSettingsID.GCalendar.WriteAccess,!0),a.id!==s.a.PluginID.Drive||a.shared||d.setSetting(s.a.PluginSettingsID.Drive.WriteAccess,!1)):u&&this.disablePlugin(n)}var c=t.filter(function(t){return t.enable});this.enablePlugins(c,!1,e)}},{key:"enablePlugins",value:function(t,e,i){var r=this,a=t.map(function(t){var e=t.id,i=h.default.pluginManager.getPlugin(t.id);return i?e===s.a.PluginID.Drive?i.googleScopes(t.shared):i.googleScopes():e===s.a.PluginID.Contacts?[s.a.GScope.Contacts]:void 0}).reduce(function(t,e){return t.concat(e)},[]);if(a=u.default.arrayUnion(a,[s.a.GScope.UserInfoEmail]),e||a&&a.length>1){var n=h.default.settings.activeUser.get();p.a.authAccount(n,a,function(e){e&&!e.error?(r.refresh(),t.map(function(t){if(t.id===s.a.PluginID.Contacts)r.enableSyncContacts();else{var i=h.default.pluginManager.getPlugin(t.id);h.default.pluginManager.onPluginAuthorized(i,!0),t.id===s.a.PluginID.Drive&&t.shared&&i.setSetting(s.a.PluginSettingsID.Drive.WriteAccess,!0)}try{u.default.PAssert(488,r._wasPluginAuthorized(t.id,e.scopes),"Plugin "+t.id+" was not authorized properly.")}catch(a){u.default.reportError(a)}}),r.refresh(),i(!0)):i(!1)})}else this.refresh(),i(!0)}},{key:"_enablePlugin",value:function(t){var e=this,i=this._pluginEnabledObservables[t];h.default.pluginManager.authorizePlugin(t,!0,function(r){r?(i.set(!0),e.refresh(t),u.default.sendEvent(t,"PluginEnabled")):(e.onFailedAuthenticate(t),u.default.sendEvent(t,"PluginEnableFailed"))})}},{key:"enablePlugin",value:function(t){t===s.a.PluginID.Contacts?this.enableSyncContacts():this._enablePlugin(t)}},{key:"disablePlugin",value:function(t){var e=this._pluginEnabledObservables[t];t===s.a.PluginID.Contacts?(u.default.sendEvent("Settings","DisableContacts"),h.default.settings.syncContacts.set(!1),l.a.clearLocalContacts(),e.set(!1)):h.default.pluginManager.deauthorizePlugin(t,function(){e.set(!1),u.default.sendEvent(t,"PluginDisabled")})}},{key:"togglePlugin",value:function(t){!this._pluginEnabledObservables[t].get()?this.enablePlugin(t):this.disablePlugin(t)}},{key:"togglePluginOption",value:function(t,e){var i=this,r=this._pluginOptionObservables[t][e],a=!r.get();h.default.pluginManager.setSetting(t,e,a),a?h.default.pluginManager.authorizePlugin(t,!0,function(n){n?(h.default.pluginManager.onAuthorizedSetting(t,e,a),r.set(!0),u.default.sendEvent(t,"OptionEnabled_"+e)):(i.onFailedAuthenticate(e),h.default.pluginManager.setSetting(t,e,!a),u.default.sendEvent(t,"OptionEnableFailed_"+e))}):(r.set(!1),u.default.sendEvent(t,"OptionDisabled_"+e))}},{key:"setPluginOption",value:function(t,e,i,r,a){var n=this,o=this._pluginOptionObservables[t][e],s=o.get();h.default.pluginManager.setSetting(t,e,i),i&&r?h.default.pluginManager.authorizePlugin(t,!0,function(r){r?(h.default.pluginManager.onAuthorizedSetting(t,e,i),o.set(i),u.default.sendEvent(t,"OptionSet_"+e+"_"+i),a&&a(!0)):(n.onFailedAuthenticate(e),h.default.pluginManager.setSetting(t,e,s),u.default.sendEvent(t,"OptionEnableFailed_"+e+"_"+i),a&&a(!1))}):(o.set(i),u.default.sendEvent(t,"OptionSet_"+e+"_"+i),a&&a(!0))}},{key:"enableOfflineFeatures",value:function(t,e){var i=this,r=this.getEnabledPlugins().map(function(t){return t===s.a.PluginID.Drive?{id:t,shared:i.getPluginOptionObservable(t,s.a.PluginSettingsID.Drive.WriteAccess).get()}:{id:t}});this.enablePlugins(r,t,function(t){t||(h.default.toasts.pushMessage({text:"We failed to successfully authenticate you for offline access.",actionText:"OKAY"}),u.default.sendEvent("OfflineAccessFailed",!0)),e&&e(t)})}},{key:"isNotificationsEnabled",value:function(){return!h.default.settings.disableNotifications.get()}},{key:"toggleNotifications",value:function(){var t=h.default.settings.disableNotifications.get();h.default.settings.disableNotifications.set(!t),t?h.default.timeline.updateNotifications():h.default.timeline.clearNotifications()}},{key:"enableSyncContacts",value:function(){var t=this;u.default.sendEvent("Settings","EnableContacts");h.default.settings.syncContacts.set(!0),this.updatePluginStatus(s.a.PluginID.Contacts,!0),l.a.refreshContacts(function(e){e<0?h.default.toasts.pushMessage({text:"There was an error syncing your contacts. Please try again.",actionText:"SYNC",action:function(){t.enableSyncContacts()}}):e>0&&u.default.vmMain.parseAll(s.a.ChangeType.Auto)}),v.e.miscAction({type:v.c.Misc,misc:v.a.SyncContacts})}},{key:"onTapRefreshContacts",value:function(t,e){var i=this,r=!1;return this.isRefreshingContacts.get()||(this.isRefreshingContacts.set(!0),r=l.a.refreshContacts(function(){i.isRefreshingContacts.set(!1),e&&e()}),u.default.sendEvent("Menu","RefreshContacts")),r}},{key:"addCalendar",value:function(t){var e=h.default.pluginManager.getPluginGCalendar();this.GCalendarListLoading.set(!0),e.createCalendar(t,function(t){this.GCalendarListLoading.set(!1),t?this.updateCalendarList():this.GCalendarAddFailure.set(!0)}.bind(this))}},{key:"notifySyncError",value:function(t){this.GCalendarSyncErrors.set(t||[])}}]),t}();e.a=new f},,function(t,e,i){"use strict";var r,a=i(38),n=i.n(a),o=i(7),u=i.n(o),s=i(8),h=i.n(s),d=i(15),c=i.n(d),v=i(0),y=i(1),g=i(4),l=i(10),p=i(118),m=i(104),f=i(26),k=i(58),A=i(16),S=i(14),w=i(64),L=(r=function(){function t(e){var i=e.id,r=e.text,a=e.dateModified,n=e.rootData,o=e.acl,s=e.backing,h=e.encryptionSentinel,d=e.backups;u()(this,t);try{v.default.PAssert(138,i,"Document must have id")}catch(c){v.default.reportError(c)}try{v.default.PAssert(139,o,"Document must have acl")}catch(c){v.default.reportError(c)}try{v.default.PAssert(140,n&&n.isRoot,"Document must have root item set to root")}catch(c){v.default.reportError(c)}n&&!n.isRoot&&(n.isRoot=!0),this.id=i,this.text=new l.a(r),this.contentPreview=new l.a(""),this._root=n,this._backing=s,this.acl=new l.a(o),this.dateModified=new l.a(a),this.encryptionSentinel=new l.a(h),this.isDecrypted=this.canDecrypt(),this.backups=new l.a(d),n.archivedItems&&(this._archivedItemsData=n.archivedItems,delete n.archivedItems)}return h()(t,[{key:"createVMLIs",value:function(){var t=g.default.itemStoreManager.getDefaultItemStore();this._rootItem||(this._rootItem=t.createItemRaw(this._root,{documentOwner:this,changeType:y.a.ChangeType.Auto,isRoot:!0}),t.addItemToRoot(this._rootItem)),this.ensureRootArchivedItem(),this._archivedItemsData&&this._archivedItemsData.forEach(this.createArchivedVMLI),this._rootItem.items.listen(this.updatePreviewTextListener),this.updatePreviewTextListener()}},{key:"ensureRootArchivedItem",value:function(){this._rootArchivedItem||(this._rootArchivedItem=g.default.itemStoreManager.getDefaultItemStore().createItemRaw({text:"Archived Root"},{documentOwner:this,changeType:y.a.ChangeType.Auto,isRoot:!0}))}},{key:"createArchivedVMLI",value:function(t){t.isArchived=!0,this._rootArchivedItem.items.push(g.default.itemStoreManager.getDefaultItemStore().createItemRaw(t,{parent:this._rootArchivedItem,documentOwner:this,changeType:y.a.ChangeType.Auto}))}},{key:"archiveItem",value:function(t,e){t.parent().items.remove(t),t.setParent(this._rootItem),this.ensureRootArchivedItem(),this._rootArchivedItem.items.push(t),this.propagateArchive(t,!0,e,this._rootItem)}},{key:"unArchiveItem",value:function(t,e,i){t.parent()&&t.parent().items.indexOf(t)>=0&&t.parent().items.remove(t),t.setParent(e),e.items.push(t),this._rootArchivedItem.items.remove(t),this.propagateArchive(t,!1,i,this._rootItem)}},{key:"propagateArchive",value:function(t,e,i,r){var a=this;t._isArchived=!0;var n={id:t.id,isArchived:e};r&&(n.parent=this._rootItem.id),S.a.saveItem(t,n,i,y.a.SaveFlag.All),t.items.get()&&t.items.get().forEach(function(t){return a.propagateArchive(t,e,i)})}},{key:"getRootData",value:function(){return this._root}},{key:"getRootItem",value:function(){return this._rootItem}},{key:"getRootArchivedItem",value:function(){return this._rootArchivedItem}},{key:"getBacking",value:function(){return this._backing}},{key:"getSaveInfo",value:function(t){var e={id:this.id,version:1,root:this._root.id,text:this.text.get(),dateModified:this.dateModified.get()};return t||(e.acl=this.acl.get(),e.encryptionSentinel=this.encryptionSentinel.get()),e}},{key:"setText",value:function(t,e){this.text.set(t,e)}},{key:"onRemoteUpdate",value:function(t){void 0!==t.backups&&this.backups.set(t.backups),void 0!==t.text&&this.setText(t.text),void 0!==t.date&&this.updateModified(t.date),void 0!==t.acl&&this.onAclUpdate(t.acl)}},{key:"getBestEncryptionInfo",value:function(){var t=g.default.crypto.getGlobalKeyInfo();return this.encryptionSentinel.get()?t.sentinel===this.encryptionSentinel.get()?t:g.default.crypto.getKeyInfo(this.id):this.isShared()?t:g.default.crypto.getKeyInfo(g.default.settings.getBestUserEncryption())}},{key:"getBestEncryption",value:function(){return this.getBestEncryptionInfo().key}},{key:"toJSON",value:function(t){var e=this,i=this.getRootItem();return new Promise(function(r){var a=e.getBestEncryptionInfo();t.encryptionKey=a.key,p.a.getItemsData(i,t).then(function(i){var n={moodoVer:g.default.settings.localDataVersion.get(),doc:e.getSaveInfo(!0),items:i};t.encrypt&&(n.sentinel=a.sentinel),r(JSON.stringify(n,null,2))})})}},{key:"delete",value:function(){var t=this;g.default.itemStoreManager.getDefaultItemStore().removeItemFromRoot(this._rootItem);var e=function(){var e=t.getCollaborators();e&&e.length>0?t.shareWithUser(t.getCollaborators().map(function(t){return t.email}),null).then(function(){S.a.deleteDocument(t)}):S.a.deleteDocument(t)};this.getAllItems().length>2?m.a.backupDocumentAll(this).then(function(){e()}):e()}},{key:"getAllItems",value:function(){var t=[],e=this._rootItem;return this._getAllItems(t,e),t}},{key:"_getAllItems",value:function(t,e){var i=0;t.push(e),e.hasNote()&&t.push(e.getNote());for(var r=e.items.get(),a=0;a<r.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._getAllItems(t,r[a])}}},{key:"updateModified",value:function(t){this.dateModified.set(t)}},{key:"updatePreviewTextListener",value:function(){var t=this._rootItem.getFirstChild();t!==this._firstChild&&(this._firstChild&&this._firstChild.itemChanged.unlisten(this.onFirstItemChanged),this._firstChild=t,t&&(this._firstChild.itemChanged.listen(this.onFirstItemChanged),this.onFirstItemChanged()))}},{key:"onFirstItemChanged",value:function(){var t=this._firstChild.getParsedText();t!==this.contentPreview.get()&&this.contentPreview.set(t)}},{key:"isShared",value:function(){return Object.keys(this.acl.get()).length>1}},{key:"isAdmin",value:function(){var t=this.acl.get()[f.a.getUid()];return t&&t.r===y.a.DocumentAccessRoles.Admin}},{key:"getCollaborators",value:function(){var t=this.acl.get();return Object.keys(t).filter(function(t){return t!==f.a.getEncryptionUid()}).map(function(e){return{uid:e,name:t[e].t,email:t[e].e,role:t[e].r}})}},{key:"shareWithUser",value:function(t,e){return w.a.shareDocument({docID:this.id,docName:this.text.get(),encryptionSentinel:this.encryptionSentinel.get(),emails:t,accessRole:e})}},{key:"onAclUpdate",value:function(t){var e=v.default.clone(this.acl.get());Object.keys(t).forEach(function(i){t[i]?e[i]=t[i]:delete e[i]}),this.acl.set(e)}},{key:"canDecrypt",value:function(){var t=this.encryptionSentinel.get();return this.isDecrypted=!t||g.default.crypto.canDecryptSentinel(t),this.isDecrypted}},{key:"addBackup",value:function(t){this.backups.get()?this.backups.get()[t]="":this.backups.set(n()({},t,""))}},{key:"getLastBackup",value:function(){var t=this.backups.get();if(t){var e=Object.keys(t).sort();return+e[e.length-1]}return 0}}],[{key:"create",value:function(e){var i=e.id,r=e.text,a=e.rootData,o=e.backing;return new t({id:i||S.a.generateID(),rootData:a,text:r,acl:n()({},f.a.getUid(),{r:y.a.DocumentAccessRoles.Admin,e:f.a.getDefaultAccountID(),t:f.a.getAccountName()}),dateModified:Date.now(),backing:o||k.a,encryptionSentinel:void 0})}},{key:"fromData",value:function(e,i){var r={};return Object.keys(e.acl).forEach(function(t){var i=e.acl[t];r[t]=v.default.isNumber(i)?{r:i,t:f.a.getAccountName(),e:f.a.getDefaultAccountID()}:i}),new t({id:e.id,rootData:e.rootData,text:e.text,acl:r,dateModified:e.dateModified,backing:i,encryptionSentinel:e.encryptionSentinel})}},{key:"comparatorModified",value:function(t,e){return e.dateModified.get()-t.dateModified.get()}},{key:"comparatorAlpha",value:function(t,e){return t.text.get().localeCompare(e.text.get())}},{key:"getCompareFn",value:function(t){return t===y.a.DocumentSortMode.Alphabetical&&this.comparatorAlpha||t===y.a.DocumentSortMode.Modified&&this.comparatorModified}}]),t}(),c()(r.prototype,"createArchivedVMLI",[A.a],Object.getOwnPropertyDescriptor(r.prototype,"createArchivedVMLI"),r.prototype),c()(r.prototype,"updatePreviewTextListener",[A.a],Object.getOwnPropertyDescriptor(r.prototype,"updatePreviewTextListener"),r.prototype),c()(r.prototype,"onFirstItemChanged",[A.a],Object.getOwnPropertyDescriptor(r.prototype,"onFirstItemChanged"),r.prototype),r);e.a=L},function(t,e,i){"use strict";var r=i(30),a=i.n(r),n=i(48),o=i.n(n),u=i(7),s=i.n(u),h=i(8),d=i.n(h),c=i(0),v=i(1),y=i(26),g=function(){function t(){s()(this,t),this.url=v.a.CloudFunctionsURL}return d()(t,[{key:"run",value:function(){var t=o()(a.a.mark(function t(e){var i,r,n,o,u,s,h,d,c=arguments;return a.a.wrap(function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:return i=c.length>1&&void 0!==c[1]?c[1]:{},r=i.query,n=i.body,t.next=3,this.createURL(e,r);case 3:if(!(o=t.sent)){t.next=22;break}return u=n?{method:"POST",body:JSON.stringify(n)}:void 0,t.next=8,fetch(o,u);case 8:if(200!==(s=t.sent).status){t.next=16;break}return t.next=12,s.json();case 12:return h=t.sent,t.abrupt("return",{value:h,errorCode:void 0,error:void 0});case 16:return t.next=18,s.json();case 18:return d=t.sent,t.abrupt("return",{value:void 0,errorCode:d.errorCode||d.status,error:d.message,braintreeErrorCode:d.braintreeErrorCode});case 20:t.next=23;break;case 22:return t.abrupt("return",{value:void 0,errorCode:v.a.PrivateAPIErrorCodes.MissingIDToken,error:"User does not have a valid id_token"});case 23:case"end":return t.stop()}}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"createURL",value:function(){var t=o()(a.a.mark(function t(e){var i,r,n,o,u,s,h=arguments;return a.a.wrap(function(t){for(var a=0;;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;switch(t.prev=t.next){case 0:return i=h.length>1&&void 0!==h[1]?h[1]:{},t.next=3,y.a.getUser();case 3:return r=t.sent,t.next=6,r.getIdToken();case 6:n=t.sent;try{c.default.PAssert(250,n,"User does not have a valid id_token")}catch(d){c.default.reportError(d)}if(!n){t.next=14;break}for(s in i.id_token=n,o=this.url+e+"?",u=[],i)i.hasOwnProperty(s)&&i[s]&&u.push(s+"="+encodeURIComponent(i[s]));return t.abrupt("return",o+u.join("&"));case 14:return t.abrupt("return",void 0);case 15:case"end":return t.stop()}}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"getAccessToken",value:function(t){return this.run("auth/getAccessToken",{query:{email:t}})}},{key:"sendFeedback",value:function(t){return this.run("user/sendFeedback",{body:t})}},{key:"setUserProperties",value:function(t){return this.run("user/setUserProperties",{body:t})}},{key:"shareDocument",value:function(t){return this.run("sharing/shareDocument",{body:t})}},{key:"listTransactions",value:function(){return this.run("billing/listTransactions")}},{key:"getBillingToken",value:function(){return this.run("billing/getBillingToken")}},{key:"purchasePlan",value:function(t){return this.run("billing/purchasePlan",{body:t})}},{key:"updatePlan",value:function(t){return this.run("billing/updatePlan",{body:t})}},{key:"startTrial",value:function(){return this.run("billing/startTrial")}},{key:"cancelPremium",value:function(){return this.run("billing/cancelPremium")}},{key:"deleteAccount",value:function(){return this.run("user/deleteAccount")}}]),t}();e.a=new g},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(4),s=i(0),h=i(1),d=i(57),c=i(107),v=i.n(c),y=i(29),g=i(80),l=function(){function t(){a()(this,t)}return o()(t,[{key:"parseText",value:function(t){var e,i=(t=t.toLowerCase()).substring(t.indexOf("every")),r=y.b.parseText(i,void 0);if(r){try{s.default.PAssert(1370,!(r.options.interval<0),"Interval set to negative",t)}catch(L){s.default.reportError(L)}var a=r.options,n=r.fromDate,o=r.duration;n||(n=new Date,n=this.toUTCDate(n));var c=Object.assign({dtstart:n},a);delete c.interval;var l=new y.b(c).after(n,!0);if(l){l=this.UTCtoLocal(l);var p=a.byhour?a.byhour[0]:0,m=a.byminute?a.byminute[0]:0;l.setHours(p),l.setMinutes(m),l.setSeconds(0),l.setMilliseconds(0),l=new Date(this.toUTCDate(l).getTime()),a.dtstart=l,a.until&&(a.until=new Date(l.getTime()+a.until.getTime()-n.getTime())),e=d.a.fromRRuleOptions(a,o?o*h.a.MSPerMinute:void 0)}}else{var f=t.replace(/\./g,"/"),k=v.a.parse(f,void 0,{forwardDate:!0})[0];if(k){var A=u.default.International.parseDate(k.text,u.default.settings.dateFormat.get());if(A){var S,w=t.substring(k.index+k.text.length).trim().match(g.a.tokens.duration);w&&(S=Math.round(+w[1]*("h"===w[2][0]?h.a.MSPerHour:h.a.MSPerMinute))),e=new d.a(A,{duration:S})}}}return e}},{key:"toUTCDate",value:function(t){return new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes()))}},{key:"UTCtoLocal",value:function(t){return new Date(t.getTime()+t.getTimezoneOffset()*h.a.MSPerMinute)}},{key:"toHumanText",value:function(t,e){var i=+new Date(t).clearTime()-+Date.today(),r="";return e||(i<0&&i>=-864e5?r="Yesterday":t.isToday()?r="Today":i>0&&i<1728e5&&(r="Tomorrow")),r||(r=t.toString(u.default.International.getFormat(t.getFullYear()!==Date.today().getFullYear()?h.a.DFormat.MonthDayYear:h.a.DFormat.MonthDay))),t.hasTimeOfDay()&&(r+=" "+t.toString("h:mmtt").toLowerCase()),r}},{key:"testGetNext",value:function(t,e,i){}},{key:"testOnDate",value:function(t,e,i){}}]),t}();e.a=new l},,function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(17),s=i.n(u),h=i(9),d=i.n(h),c=i(18),v=i.n(c),y=i(0),g=i(1),l=i(3),p=i(4),m=i(2),f=i(20),k=i(39),A=i(56),S=i(45),w=i(22),L=i(51),F=function(t){function e(t){var i;return a()(this,e),(i=s()(this,d()(e).call(this,t))).__isInput=!0,i}return v()(e,t),o()(e,[{key:"init",value:function(){var t=this.props,e={isFocused:t.focused,isComposing:!1,value:t.value||"",tokens:t.tokens||[],item:t.item?{item:t.item,text:t.item.getStyledTextAsOneLine()}:void 0};this.isInput="password"===t.type,this.isInput||(this.html=this.parseHTML(e.value||g.a.TextSpace)),t.buttonText&&(e.isLoading=!1),this.createObservables(e)}},{key:"onMount",value:function(){this.updateHTML(this.state.value,!1),this.props.focused&&(this.focus(),this.props.selectAll?this.selectAll():this.selectEnd())}},{key:"onUnmount",value:function(){this.isFocused.get()&&this.onBlur(),l.a.isMobile&&S.a.hide()}},{key:"componentWillReceiveProps",value:function(t){this.state.item!==t.item&&t.item&&this.item.set(t.item?{item:t.item,text:t.item.getStyledTextAsOneLine()}:void 0),this.props.value!==t.value&&t.value!==this.state.value&&(this.setValue(t.value,this.isFocused.get()),this.forceUpdate()),this.props.tokens!==t.tokens&&t.tokens!==this.state.tokens&&this.tokens.set(t.tokens)}},{key:"componentDidUpdate",value:function(t){var e=this._isDirty;if(this._isDirty=void 0,e&&this._dirtyCallbacks){for(var i=0,r=0;r<this._dirtyCallbacks.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._dirtyCallbacks[r]()}this._dirtyCallbacks=void 0}this.props.autocompleteItem!==t.autocompleteItem&&this.updateAutocomplete()}},{key:"clearValue",value:function(){this.setValue("")}},{key:"clearTokens",value:function(){this.tokens.clear()}},{key:"isButtonEnabled",value:function(){return void 0!==this.props.buttonEnabled?this.props.buttonEnabled:this.state.value||this.state.tokens.length>0}},{key:"getValue",value:function(){return this.value.get()}},{key:"getTokens",value:function(){var t=this.getValue().trim(),e=this.tokens.get();return t?e.concat([{text:t,email:t,type:"contact"}]):e}},{key:"getItem",value:function(){return this.state.item}},{key:"parseHTML",value:function(t){var e;if(this.props.parse){var i=A.a.parseText(t,L.a.getContacts(),!0,!0,this.props.isSearch);this.parsedEls=i.els;var r=t.match(/(^#|[\(\s]#)([^\s\),#]+)/g);r&&(r=r.map(function(t){return t.trim().slice(1)})),this.tags=i.tags=r,this.contacts=i.contacts,this.props.onParsed&&this.props.onParsed(i),e=p.default.ElementRenderer.render(i.els,{convertSpaces:!0})}else e=t&&y.default.escape(t).replace(/ /g,"&nbsp;");return e}},{key:"addDirtyCallback",value:function(t){this._dirtyCallbacks||(this._dirtyCallbacks=[]),this._dirtyCallbacks.push(t)}},{key:"focus",value:function(){this._isDirty?this.addDirtyCallback(this.focus):this.refs.input.focus()}},{key:"blur",value:function(){this.refs.input.blur()}},{key:"select",value:function(){w.default.selectElement(this.refs.input)}},{key:"selectEnd",value:function(t){if(!t&&this._isDirty)this.addDirtyCallback(this.selectEnd);else{var e=this.refs.input.textContent;e.length>0&&e!==g.a.TextSpace&&w.default.selectElement(this.refs.input,e.length)}}},{key:"selectAll",value:function(t){if(!t&&this._isDirty)this.addDirtyCallback(this.selectAll);else{var e=this.refs.input.textContent;e.length>0&&e!==g.a.TextSpace&&w.default.selectElement(this.refs.input,0,e.length)}}},{key:"handleCut",value:function(t){var e=this.getSelectionOffsets();if(e.start===e.end){var i=l.a.ie?"Text":"text/plain",r=t&&t.clipboardData?t.clipboardData:window.clipboardData,a=this.getValue();r.setData(i,a),this.clearValue(),this.onInput(),y.default.preventDefault(t),y.default.stopPropagation(t)}}},{key:"_getHotkeys",value:function(t){var e=[k.a.create(g.a.KeyCode.L,!0,g.a.Primary.No,g.a.Shift.Either,this.selectAll)];return l.a.app&&e.push(k.a.create(g.a.KeyCode.L,!0,g.a.Primary.Yes,g.a.Shift.Either,this.selectAll)),t&&e.push(k.a.create(g.a.KeyCode.Escape,!0,g.a.Primary.Either,g.a.Shift.Either,this.handleEscapeKey)),e}},{key:"onFocus",value:function(t){this.props.autocompleteMode&&S.a.clearDisabled(),this.props.autocompleteOnClick&&this.updateAutocomplete(),y.default.vmMain.activeInput.set(this),this.isFocused.set(!0),this.___hotkeys=k.a.pushStack(this._getHotkeys(!!this.props.onEscape)),this.refs.input.addEventListener("cut",this.handleCut,!0),this.props.onFocus&&this.props.onFocus(t)}},{key:"onBlur",value:function(t){y.default.vmMain.activeInput.set(null),this.isFocused.set(!1),this.___hotkeys&&(k.a.popStack(this.___hotkeys),this.___hotkeys=void 0),this.refs.input.removeEventListener("cut",this.handleCut,!0),this.props.onBlur&&this.props.onBlur(t)}},{key:"getSelectionOffset",value:function(){return this.getSelectionOffsets().end}},{key:"getSelectionOffsets",value:function(){var t=w.default._getSelectionRange(),e={start:0,end:0};return t&&(e=w.default.getSelectOffsetsInElement(this.refs.input,t)),e}},{key:"_setSelectionOffset",value:function(t){var e,i;if(t>0){var r=w.default.getOffsetChildElement(this.refs.input,t);r&&(e=r.element,i=r.offset)}else e=this.refs.input,i=0;if(e){var a=w.default.createFakeRange(e,i,e,i);try{y.default.PAssert(1227,a,"Range should be valid when setting selection offset")}catch(n){y.default.reportError(n)}a&&w.default.setSelectionRange(a)}}},{key:"setSelectionOffset",value:function(t){this._setSelectionOffset(t)}},{key:"updateAutocomplete",value:function(t){var e=this.props,i=this.refs.input,r=e.autocompleteMode;if(t=e.autocompleteItem||t||this.item.get(),r){var a=w.default.getSelectionInElement(i);l.a.isMobile&&!a&&(a={start:0,end:0}),(e.autocompleteOnClick||a&&a.start===a.end)&&S.a.update({mode:r,canAutocompleteItems:e.canAutocompleteItems,text:this.value.get(),offset:a?a.start:0,owner:this,item:t,pane:this.props.pane,parsedEls:this.parsedEls,positionOffset:e.positionOffset,elementDisplay:e.autocompleteElementDisplay||this.refs.wrapper,elementInput:i,supportSearchItemAutocomplete:e.supportSearchItemAutocomplete,noShow:e.noShowAutocomplete,showNoMatches:e.autocompleteOnClick})}}},{key:"setValue",value:function(t,e,i){this._isDirty=!0;try{y.default.PAssert(1228,void 0!==t,"Should not set FancyInput value to undefined")}catch(r){y.default.reportError(r)}t=t||"",this.updateHTML(t,e,i),this.value.set(t)}},{key:"updateHTML",value:function(t,e,i){var r=i;e&&void 0===r&&(r=this.getSelectionOffset());var a=this.parseHTML(t||g.a.TextSpace);a!==this.refs.input.innerHTML&&(this.refs.input.innerHTML=a),e&&(r>t.length&&(r=t.length),this.setSelectionOffset(r))}},{key:"addToken",value:function(t){this.tokens.push(t);var e=this.refs.inner;e.scrollWidth>e.clientWidth&&(e.scrollLeft=e.scrollWidth-e.clientWidth)}},{key:"updateTokens",value:function(t){for(var e=0,i=y.default.parseTokensFromText(this.value.get()),r="",a=0;a<i.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=i[a];"contact"===n.type?this.addToken(n):r+=n.text}this.setValue(r,!0)}},{key:"onChange",value:function(){this.value.set(this.refs.input.value)}},{key:"stripBRs",value:function(t){for(var e=0,i=t.children,r=i.length-1;r>=0;r--){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=i[r];"BR"===a.nodeName?a.remove():a.children.length>0&&this.stripBRs(a)}}},{key:"onInput",value:function(){if(!this.isComposing.get()){l.a.isMobile&&this.stripBRs(this.refs.input);var t=this.refs.input.textContent.replace(/\u00a0/g," ").replace(new RegExp(g.a.TextSpace,"g"),"").replace(/\n/g,"");this.setValue(t,!0),this.updateAutocomplete(),this.props.onChange&&this.props.onChange(t,this.item.get())}}},{key:"handleEscapeKey",value:function(){this.props.onEscape?this.props.onEscape():this.isInput||this.select(),this.__hotkeyEscape&&(k.a.popStack(this.handleEscapeKey),this.__hotkeyEscape=void 0)}},{key:"onMouseDown",value:function(t){t.stopPropagation(),this.props.onMouseDown&&this.props.onMouseDown(t)}},{key:"onKeyDown",value:function(t){var e=this.props;this.isInput||(e.autocompleteMode&&S.a.isShowing()||e.buttonText&&t.keyCode===g.a.KeyCode.Enter&&this.onButtonClick(),t.keyCode===g.a.KeyCode.Backspace&&(!this.state.value&&this.state.tokens.length>0&&this.removeToken(this.tokens.length()-1),0===this.refs.input.textContent.length&&(this.refs.input.textContent=g.a.TextSpace)),t.keyCode===g.a.KeyCode.Tab&&S.a.isShowing()&&S.a.hide()),t.keyCode===g.a.KeyCode.Enter&&(e.onEnter&&e.onEnter(t),t.preventDefault()),e.onKeyDown&&e.onKeyDown(t)}},{key:"onKeyUp",value:function(t){var e=this.props;!this.isInput&&e.autocompleteMode&&(t.keyCode!==g.a.KeyCode.LeftArrow&&t.keyCode!==g.a.KeyCode.RightArrow||this.updateAutocomplete()),"email"===e.autocompleteMode&&(t.keyCode===g.a.KeyCode.Comma?this.updateTokens(!1):t.keyCode===g.a.KeyCode.Enter&&this.updateTokens(!0)),l.a.isMobile&&t.keyCode===g.a.KeyCode.Enter&&this.selectEnd(!0),e.onKeyUp&&e.onKeyUp(t)}},{key:"onCompositionStart",value:function(){l.a.android||this.isComposing.set(!0)}},{key:"onCompositionEnd",value:function(t){l.a.android||(this.isComposing.set(!1),this.onInput())}},{key:"onAutocompleteSelected",value:function(t){var e=this.props;t.item&&e.isSearch?e.onAutocompleteSelected(t):(t.item&&this.item.set({item:t.item,text:t.item.getStyledTextAsOneLine()}),void 0!==t.value&&(this.setValue(t.value,!0,t.offset),e.onChange&&e.onChange(t.value,this.item.get())),t.token&&this.addToken(t.token),e.onAutocompleteSelected&&e.onAutocompleteSelected(t))}},{key:"onButtonClick",value:function(){var t=this.state;if(this.isButtonEnabled()){if(this.props.onButtonClick)this.props.onButtonClick(t.value,this.onButtonClickCallback)&&this.isLoading.set(!0);S.a.isShowing()&&S.a.hide()}}},{key:"onButtonClickCallback",value:function(){this.value.set(""),this.isLoading.set(!1)}},{key:"removeToken",value:function(t){var e=this.props,i=this.tokens.get()[t];this.tokens.removeAt(t),e.onChange&&e.onChange(this.getValue(),this.item.get()),e.onTokenRemoved&&e.onTokenRemoved(i)}},{key:"removeItem",value:function(){this.item.set(void 0),this.props.onChange&&this.props.onChange(this.getValue(),this.item.get())}},{key:"render",value:function(){var t,e,i=this.state,r=this.props,a=r.margin||{},n=r.padding||{};isNaN(n.left)&&(n.left=8),isNaN(n.right)&&(n.right=8);var o=!1!==r.border,u=o?2:0,s=y.default.classNames("fancyInput",{disabled:r.disabled},{focused:i.isFocused},{hasFloatingText:!!r.floatingText},{hasButton:!!r.buttonText},{hasBorder:o},this.props.className),h=r.height||40,d=(h-40)/2,c=y.default.extend({width:r.width,height:h,display:r.display,fontSize:r.fontSize},r.style);if(r.floatingText)n.bottom=5+Math.min(d,2),n.top=h-16-n.bottom;else{var v=(h-u-16)/2;n.top=v,n.bottom=v}if(r.floatingText){var g={marginBottom:5+d,marginLeft:n.left,marginRight:n.right};i.isFocused||i.value?i.isFocused?g.color=y.default.colorBlue:g.color="#ccc":g.color="#aaa";var p=y.default.classNames("placeholder c-foreground-super-faded","noSelect",{floating:i.isFocused||i.value||i.tokens.length>0});t=m.createElement("div",{className:p,style:g},r.floatingText)}else if(r.placeholder&&!i.value&&!i.isComposing&&0===i.tokens.length&&!i.item){var f={paddingTop:n.top,marginLeft:n.left,marginRight:n.right};t=m.createElement("div",{className:"placeholder c-foreground-super-faded noSelect",style:f},r.placeholder)}var k,A={right:r.buttonText&&50};if(i.isFocused&&!i.item?A[l.a.transform.react]="":A[l.a.transform.react]="scale(0,1)",e=m.createElement("div",{className:"focusUnderline",style:A}),r.buttonText){var S=y.default.classNames("fancyInputButton c-button-raised-primary",{loading:i.isLoading},{disabled:!this.isButtonEnabled()}),w={width:r.buttonWidth,lineHeight:h+"px"};k=m.createElement("span",{className:S,style:w,onClick:this.onButtonClick},r.buttonText)}var L,F={paddingLeft:n.left,paddingRight:n.right,marginLeft:a.left,marginRight:a.right},C={ref:"input",className:"fancyInputInput",style:{paddingTop:n.top,paddingBottom:n.bottom},onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onMouseDown:this.onMouseDown,autoComplete:"false",tabIndex:r.tabIndex,disabled:i.isLoading};this.isInput?(C.type=r.type,C.onChange=this.onChange,L=m.createElement("input",C)):(C.onInput=this.onInput,C.contentEditable=r.readonly||i.item?null:"true",C.onCompositionStart=this.onCompositionStart,C.onCompositionEnd=this.onCompositionEnd,L=m.createElement("div",C));var I=[];if(i.tokens)for(var P=0,N=0;N<i.tokens.length;N++){if(P++>5e3&&__infLoop&&__infLoop(P))throw new RangeError;var H=i.tokens[N],M={marginTop:n.top-4,paddingLeft:r.padding&&!isNaN(r.padding.left)?r.padding.left:8};I.push(m.createElement("div",{key:"token"+N,className:"token c-button-raised c-border",style:M},m.createElement("span",{dangerouslySetInnerHTML:{__html:H.text}}),m.createElement("i",{className:"icon-close c-button",onClick:this.removeToken.bind(this,N)})))}if(i.item){var z={lineHeight:h+"px",marginTop:0,paddingLeft:r.padding&&!isNaN(r.padding.left)?r.padding.left:8};I.push(m.createElement("div",{key:"tokenItem",className:"token flexbox",style:z},m.createElement("span",{className:"f1",dangerouslySetInnerHTML:{__html:i.item.text}}),m.createElement("i",{className:"icon-close c-button",onClick:this.removeItem})))}var D=y.default.classNames("fancyInputWrap c-foreground c-background c-border",{hasTokens:I.length>0},{hasItem:i.item});return m.createElement("div",{className:s,id:this.props.id,style:c,onClick:this.props.onClick},m.createElement("div",{className:"fancyInputContent"},m.createElement("div",{className:D,ref:"wrapper"},t,m.createElement("div",{className:"fancyInputInner",style:F,ref:"inner"},I,m.createElement("div",{className:"fancyInputInner2"},L))),k,e))}}]),e}(f.a);e.a=F},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(0),s=function(){function t(){a()(this,t)}return o()(t,[{key:"_ensureListeners",value:function(){return this._listeners||(this._listeners={}),this._listeners}},{key:"clearListeners",value:function(){this._listeners=void 0}},{key:"listen",value:function(){for(var t=0,e=0,i=arguments.length,r=new Array(i),a=0;a<i;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r[a]=arguments[a]}for(var n=this._ensureListeners(),o=0;o<arguments.length-1;++o){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;try{u.default.PAssert(585,"callbacks"!==arguments[o],"Invalid event name/grouping")}catch(h){u.default.reportError(h)}try{u.default.PAssert(586,u.default.isString(arguments[o])||u.default.isFunction(arguments[o]),"Only accept string or functions for listen")}catch(h){u.default.reportError(h)}n[arguments[o]]||(n[arguments[o]]={callbacks:[]}),n=n[arguments[o]]}var s=arguments[arguments.length-1];try{u.default.PAssert(587,u.default.isFunction(s),"Listeners must always be valid functions")}catch(h){u.default.reportError(h)}try{u.default.PAssert(588,n.callbacks.indexOf(s)<0,"Should never listen with the same function twice")}catch(h){u.default.reportError(h)}n.callbacks.push(s)}},{key:"isListening",value:function(){for(var t=0,e=0,i=arguments.length,r=new Array(i),a=0;a<i;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r[a]=arguments[a]}var n=this._ensureListeners(),o=arguments[arguments.length-1];try{u.default.PAssert(589,u.default.isFunction(o),"Listeners must always be valid functions")}catch(h){u.default.reportError(h)}for(var s=0;s<arguments.length-1;++s){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;n[arguments[s]]&&(n=n[arguments[s]])}return n&&n.callbacks&&n.callbacks.indexOf(o)>=0}},{key:"unlisten",value:function(){for(var t=0,e=0,i=arguments.length,r=new Array(i),a=0;a<i;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r[a]=arguments[a]}var n=this._ensureListeners(),o=arguments[arguments.length-1];try{u.default.PAssert(590,u.default.isFunction(o),"Listeners must always be valid functions")}catch(h){u.default.reportError(h)}for(var s=0;s<arguments.length-1;++s){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;try{u.default.PAssert(591,"callbacks"!==arguments[s],"Invalid event name/grouping")}catch(h){u.default.reportError(h)}try{u.default.PAssert(592,u.default.isString(arguments[s]),"Only accept string for unlisten")}catch(h){u.default.reportError(h)}try{u.default.PAssert(593,n[arguments[s]],"Cannot unlisten something that has never been listened")}catch(h){u.default.reportError(h)}n[arguments[s]]&&(n=n[arguments[s]])}try{u.default.PAssert(594,n&&n.callbacks&&n.callbacks.indexOf(o)>=0,"Cannot unlisten something that has never been listened")}catch(h){u.default.reportError(h)}n.callbacks&&n.callbacks.remove(o)}},{key:"fireEvent",value:function(){for(var t=0,e=0,i=arguments.length,r=new Array(i),a=0;a<i;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;r[a]=arguments[a]}var n=!0,o=this._ensureListeners(),s=arguments[arguments.length-1];try{u.default.PAssert(595,void 0===s||u.default.isArray(s),"Last argument to fireEvent must be an array")}catch(v){u.default.reportError(v)}for(var h=0;h<arguments.length-1;++h){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;try{u.default.PAssert(596,"callbacks"!==arguments[h],"Invalid event name/grouping")}catch(v){u.default.reportError(v)}try{u.default.PAssert(597,u.default.isString(arguments[h])||u.default.isArray(arguments[h]),"Only accept strings for firing event")}catch(v){u.default.reportError(v)}if(!o[arguments[h]])break;var d=0;o=o[arguments[h]];for(var c=0;c<o.callbacks.length;++c){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;try{n=o.callbacks[c].apply(this,s)&&n}catch(y){u.default.reportError(y)}}}return n}}]),t}();e.a=s},function(t,e,i){"use strict";var r=i(0),a=/^<(.*)>$/,n=/^[^:]+(?=:)/;function o(){}var u={Default:{bannedTags:["style","script","source","track","iframe","frame","frameset","button","input","audio","video","math","svg","link","comment","base","object","embed"],allowedAttributes:["abbr","accept","acceptcharset","accesskey","align","alt","async","autocomplete","axis","background","border","bordercolor","bgcolor","cellpadding","cellspacing","char","charoff","charset","checked","cid","class","classid","classname","color","colspan","cols","content","contextmenu","controls","coords","data","datetime","defer","dir","disabled","download","draggable","enctype","form","formaction","formenctype","formmethod","formnovalidate","formtarget","frame","frameborder","headers","height","hidden","high","href","hreflang","htmlfor","httpequiv","icon","itemscope","itemtype","itemid","itemprop","itemref","label","lang","list","loop","low","manifest","marginheight","marginwidth","max","maxlength","media","mediagroup","method","min","multiple","muted","name","novalidate","nowrap","open","optimum","pattern","placeholder","poster","preload","radiogroup","readonly","rel","required","role","rowspan","rows","rules","sandbox","scope","scoped","scrolling","seamless","selected","shape","size","sizes","sortable","sorted","span","spellcheck","src","srcdoc","srcset","start","step","style","summary","tabindex","target","title","translate","type","usemap","valign","value","width","wmode"],allowedTagAttributes:{A:["href","name"],IMG:["src","alt"],FONT:["face"],HTML:["xmlns"],BODY:["text","link","alink","vlink"],META:["http-equiv"],VAR:["id"]}}};o.prototype={update:function(t,e,i,a){try{r.default.PAssert(451,e,"Must supply a valid resource lib")}catch(o){r.default.reportError(o)}try{r.default.PAssert(452,i,"Must supply a valid options obj")}catch(o){r.default.reportError(o)}var n;return"text/plain"===a?n=this._parsePlain(t,e,i):"text/html"===a?n=this._parseHTML(t,e,i):r.default.reportError("Unknown email mimeType: "+a),n?n.parsed=this._escapeHTMLEntities(n.parsed):n={parsed:void 0,missingResourceData:!0},n},_escapeHTMLEntities:function(t){return t.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(/[\x01-\t\x0B\f\x0E-\x1F\x7F\x81\x8D\x8F\x90\x9D\xA0-\uFFFF]/g,function(t){return"&#x"+t.charCodeAt(0).toString(16).toUpperCase()+";"})},getAttachmentLinks:function(t,e){var i=[],a=this._createDoc(t);if(a){var n=this._findLinkElements(a),o=this._findQuoteElements(a);try{i=this._findSpecialLinks(n,o,e).attachments}catch(u){r.default.reportError(u)}}return i},generatePlaintext:function(t,e){return this._createDoc(t).body.innerText},replaceSignature:function(t,e){var i,a=this._createDoc(t),n=this._findActiveSignature(a);if(n){var o=!!n.innerHTML;if(n.innerHTML=e||"",e)o||(n.parentNode.insertBefore(document.createElement("br"),n),n.parentNode.insertBefore(document.createElement("br"),n),n.parentNode.insertBefore(document.createTextNode("--"),n),n.parentNode.insertBefore(document.createElement("br"),n));else{var u=n.previousSibling;if(u&&"BR"===u.tagName){var s=u.previousSibling;if(s&&r.default.isTextNode(s)&&"--"===s.textContent){var h=s.previousSibling;if(h){var d=h.previousSibling;"BR"===h.tagName&&(h.parentElement.removeChild(h),d&&"BR"===d.tagName&&d.parentElement.removeChild(d))}u.parentElement.removeChild(u),s.parentElement.removeChild(s)}}}i=a.body.outerHTML}else i=t;return i},_ensurePartDoc:function(t){var e;switch(t.mimeType){case"text/plain":e=this._createDoc(this._parsePlain(t.decoded).parsed);break;case"text/html":e=this._createDoc(t.decoded);break;default:try{r.default.PAssert(453,!1,"Unknown display part mimeType: "+t.mimeType)}catch(i){r.default.reportError(i)}}return e},_mergeDocs:function(t,e){if(t.body){var i=e.adoptNode(t.body),a=e.createElement("div");try{for(var n=0,o=0;o<i.attributes.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=i.attributes[o];a.setAttribute(u.name,u.value)}}catch(h){r.default.reportError(h)}try{for(var s=0;i.childNodes.length>0;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;a.appendChild(i.firstChild)}}catch(h){r.default.reportError(h)}try{e.body.appendChild(a)}catch(h){r.default.reportError(h)}}},combineParts:function(t){try{r.default.PAssert(454,r.default.isArray(t)&&t.length>0,"Must always supply a valid part list with contents")}catch(o){r.default.reportError(o)}var e=this._createDoc("<body></body>");try{r.default.PAssert(455,e,"Must always be able to create a valid document for first part in list")}catch(o){r.default.reportError(o)}if(e)for(var i=0,a=0;a<t.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=this._ensurePartDoc(t[a]);if(n)try{this._mergeDocs(n,e)}catch(u){r.default.reportError(u)}}return e?e.body.outerHTML:" "},removeElementById:function(t,e){try{r.default.PAssert(456,r.default.isString(t),"Must pass in a valid decoded HTML email string")}catch(n){r.default.reportError(n)}try{r.default.PAssert(457,r.default.isString(e),"Must provide a valid item ID")}catch(n){r.default.reportError(n)}var i=!1;try{var a=this._createDoc(t);a&&(i=this._removeElementById(a,e))}catch(o){r.default.reportError(o)}return i?a.body.outerHTML:t},_removeElementById:function(t,e){var i=!1,r=t.getElementById(e);return r&&(r.parentNode.removeChild(r),i=!0),i},removeElementsByAttribute:function(t,e,i){try{r.default.PAssert(458,r.default.isString(t),"Must pass in a valid decoded HTML email string")}catch(o){r.default.reportError(o)}try{r.default.PAssert(459,r.default.isString(e),"Must provide a valid item ID")}catch(o){r.default.reportError(o)}var a=!1;try{var n=this._createDoc(t);n&&(a=this._removeElementsByAttribute(n,e,i))}catch(u){r.default.reportError(u)}return a?n.body.outerHTML:t},_removeElementsByAttribute:function(t,e,i){var r,a=0,n=!1;r=void 0!==i&&null!==i?t.querySelectorAll("["+e+'="'+i+'"]'):t.querySelectorAll("["+e+"]");for(var o=0;o<r.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var u=r[o];u.parentNode.removeChild(u),n=!0}return n},_createFragment:function(){return{lines:[],isQuote:!1}},_createPlainFragments:function(t){var e=0,i=[],r=t.split("\n"),a=this._createFragment();i.push(a);for(var n=0;n<r.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=r[n].trim(),u=new RegExp(/^>+/).test(o);a.lines.length>0&&u!==a.isQuote&&""!==o&&(a=this._createFragment(),i.push(a)),a.lines.push(o),a.isQuote=a.isQuote||u}return i},_getFragmentText:function(t){var e,i,r=0,a="";if(t.isQuote){var n=this._generatePlaceholderID();e='<div id="'+n+'" place="true"></div><p quote="collapsed" group="'+n+'">',i="</p>"}else e="",i="";for(var o=0;o<t.lines.length;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;a+=t.lines[o]+"\n"}return e+a+i},_joinPlainFragments:function(t){for(var e=0,i="",r=0;r<t.length;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=t[r];i+=this._getFragmentText(a)}return i},_parsePlain:function(t,e,i){var a,n=this._escapeHTMLEntities(t),o=this._createPlainFragments(n);try{a=this._joinPlainFragments(o);a=a.replace(/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gm,'<a mlink="true" href="$1">$1</a>')}catch(u){r.default.reportError(u),a="There was an error loading this message."}return{parsed:'<html><head></head><body style="white-space: pre-wrap;">'+a+"</body><html>"}},_parseHTML:function(t,e,i){var a={parsed:void 0},n=this._createDoc(t),o=this._findQuoteElements(n);if(o=this._cleanupDocQuotes(n,o,e),this._isFullQuote(n,o)||this._collapseAndMarkQuotes(n,o,!!i.collapseQuotes),i.createLinksFromText)try{this._createLinksFromText(n)}catch(h){r.default.reportError(h)}var u=this._findLinkElements(n);this._markLinks(u);try{a.specialLinks=this._findSpecialLinks(u,o,i)}catch(h){r.default.reportError(h)}try{a.parsedMetadata=this._parseMetadata(n)}catch(h){r.default.reportError(h)}try{var s=this._updateResourceImages(n,e);a.missingResourceData=s.missingResourceData}catch(h){r.default.reportError(h)}return this._trimTrailingWhitespace(n),this._trimQuoteWhitespace(o),a.parsed=n.body.outerHTML,a},_traverseNode:function(t,e){if(!1!==e(t))for(var i=0,r=t.childNodes.length-1;r>=0;r--){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._traverseNode(t.childNodes[r],e)}},_sanitizeInputDoc:function(t,e){var i=u[e];t.body&&this._traverseNode(t.body,function(t){if(t.nodeType===Node.COMMENT_NODE){try{r.default.PAssert(460,0===t.childNodes.length,"A comment node should never have children")}catch(h){r.default.reportError(h)}t.parentNode.removeChild(t)}else if(t.nodeType===Node.TEXT_NODE)   ;else if(i.bannedTags.indexOf(t.tagName.toLowerCase())>=0)t.parentNode.removeChild(t);else if(t.attributes.length>0){for(var e=0,a=i.allowedTagAttributes[t.tagName],n=t.attributes.length-1;n>=0;n--){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=t.attributes[n].name;if(i.allowedAttributes.indexOf(o)<0&&(!a||a.indexOf(o)<0))t.removeAttribute(o);else{var u=t.getAttribute(o);u&&u.startsWith("javascript:")&&(console.log("Remove Inline JS: ",t.tagName,o),t.removeAttribute(o))}}var s=t.getAttribute("height");s&&s.indexOf("%")>=0&&(t.removeAttribute("height"),console.log("Remove Height: ",t.tagName,s))}})},sanitizeContent:function(t){var e;if(t){var i=this._createDoc(t);try{this._traverseNode(i.body,function(t){t.nodeType===Node.TEXT_NODE?t.textContent=new Array(t.textContent.length+1).join("#"):"A"===t.nodeName&&t.removeAttribute("href")}),e=i.body.outerHTML}catch(a){r.default.reportError(a),e="<<SANITIZED>>"}}else e="<<NO HTML CONTENT>>";return e},sanitizePlaintext:function(t){return t?r.default.isWhiteSpace(t)?"":"<<NonHTML-Sanitized: "+t.length+">>":"<<NO CONTENT>>"},getComposeBody:function(t,e){var i=!1;try{var a=this._createDoc(t);if(a){i=this._removeElementsByAttribute(a,"moodoAttach","true");var n=this._updateResourceImages(a,e);i=i||n.didUpdate}}catch(o){r.default.reportError(o)}return i?a.body.outerHTML:t},_createDoc:function(t){var e,i=new DOMParser;try{if(e=i.parseFromString(t,"text/html")){var a=this._parseJSONLD(e);this._sanitizeInputDoc(e,"Default"),a&&a.length>0&&this._reportMetadata(e,a)}}catch(n){r.default.reportError(n);try{e=i.parseFromString("Error parsing email message","text/html")}catch(o){r.default.reportError(o)}}return e},_updateResourceImages:function(t,e){for(var i=0,r={missingData:!1,didUpdate:!1},a=this._findImageElements(t),n=0;n<a.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var o=a[n];if(o.src.startsWith("cid:")){var u=o.src.substr(4);if(u){o.setAttribute("cid",u);var s=e.getByCID(u);if(s&&s.data){var h="data:"+s.mimeType+";base64,"+s.data;o.src=h,r.didUpdate=!0}else o.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",r.didUpdate=!0,s||(r.missingData=!0)}else o.src="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",r.didUpdate=!0}}return r},_findImageElements:function(t){return t.querySelectorAll("img")},_findLinkElements:function(t){return Array.prototype.slice.call(t.querySelectorAll("a"))},_sanitizeLink:function(t){if(t&&t.hasAttribute("href")){t.setAttribute("mlink",!0);var e=t.getAttribute("href");if(e.startsWith("file:"))t.setAttribute("href","");else n.exec(e)||t.setAttribute("href","https://"+e)}},_createLinksFromText:function(t){this._traverseNode(t.body,function(e){var i=!0;if(e.nodeType===Node.TEXT_NODE){var r=e.textContent;if(r.indexOf("http")>=0||r.indexOf("www.")>=0){var a=/\b((?:(https?):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?\xab\xbb\u201c\u201d\u2018\u2019]))/gm,n=e.textContent.replace(a,'<a href="$1">$1</a>'),o=t.createElement("div");o.innerHTML=n;var u=o.childNodes.length;if(u>1||1===u&&"A"===o.childNodes[0].tagName){for(var s=0;o.firstChild;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;e.parentNode.insertBefore(o.firstChild,e)}e.parentNode.removeChild(e)}}}else"A"===e.tagName&&(i=!1);return i})},_markLinks:function(t){for(var e=0,i=0;i<t.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this._sanitizeLink(t[i])}},_isAttachmentURL:function(t){return!!/^https:\/\/drive.google.com\/file\/d\/.*\/view/g.exec(t)},_findSpecialLinks:function(t,e,i){for(var r=0,a={unsubscribe:[],twitter:[],attachments:[]},n=0;n<t.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=t[n];o.href&&this._isAttachmentURL(o.href)&&(i.ignoreQuotedAttachments&&this._isInsideQuote(o,e)||a.attachments.push({href:o.href,cid:o.id,name:o.innerText,type:"application/octet-stream"}))}return a},_parseMetadata:function(t){var e=this._parseMicrodata(t);return e&&e.length>0&&this._reportMetadata(t,e),e},_reportMetadata:function(t,e){},_parseJSONLD:function(t){for(var e=0,i=[],a=t.getElementsByTagName("script"),n=0;n<a.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=a[n];if("application/ld+json"===o.getAttribute("type")){var u=o.innerText.trim();if(u)try{var s=JSON.parse(u);i.push(s)}catch(h){r.default.reportError(new Error("Invalid JSONLD Schema String"),u)}}}return i},_parseMicrodata:function(t){var e=t.querySelectorAll("[itemscope]");return Array.prototype.map.call(e,function(t){if(!t.hasAttribute("itemprop"))return this._parseMicrodataScope(t)}.bind(this)).filter(function(t){return!!t})},_parseMicrodataScope:function(t){var e={type:t.getAttribute("itemtype"),properties:{}};return this._recurseMicrodataScope(e,t),e},_recurseMicrodataScope:function(t,e){for(var i=0,r=0;r<e.children.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var a=e.children[r];if(a.hasAttribute("itemprop")){var n,o=a.getAttribute("itemprop");if(a.hasAttribute("itemscope"))n=this._parseMicrodataScope(a);else switch(a.tagName.toLowerCase()){case"a":case"area":case"link":n=a.getAttribute("href");break;case"meta":n=a.getAttribute("content");break;case"img":n=a.getAttribute("src");break;case"data":case"meter":n=a.getAttribute("value");break;case"time":n=a.getAttribute("datetime");break;default:n=a.hasAttribute("content")?a.getAttribute("content"):a.textContent}o&&n&&(t.properties[o]=n)}else this._recurseMicrodataScope(t,a)}},_cleanupDocQuotes:function(t,e,i){return e.filter(function(t){var e=!1;"BLOCKQUOTE"===t.nodeName&&"cite"===t.getAttribute("type")&&(function(t){var e;a.lastIndex=0;var i=a.exec(t);return i&&i[1]&&(e=i[1]),e}(t.innerText)&&t&&t.parentNode&&(t.parentNode.removeChild(t),e=!0));return!e})},_generatePlaceholderID:function(){return r.default.generateTempId()},_createQuotePlaceholder:function(t){var e=t.createElement("div");return e.id=this._generatePlaceholderID(),e.setAttribute("place",!0),e},_findFirstSiblingQuote:function(t,e){for(var i=0,r=t;r.previousElementSibling&&e.indexOf(r.previousElementSibling)>=0;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;r=r.previousElementSibling}return r},_markAdjacentQuotes:function(t,e,i,r){for(var a=0;t&&i.indexOf(t)>=0;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t.setAttribute("quote",r),t.setAttribute("group",e),t=t.nextElementSibling}},_collapseAndMarkQuotes:function(t,e,i){for(var r=0,a=0;a<e.length;++a){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=e[a];if(!n.getAttribute("quote")){var o=this._findFirstSiblingQuote(n,e),u=this._createQuotePlaceholder(t),s=0===a&&i?"collapsed":"uncollapsed";this._markAdjacentQuotes(o,u.id,e,s),o.parentNode.insertBefore(u,n)}}},_removeQuote:function(t){t&&t.parentNode&&t.parentNode.removeChild(t)},_removeQuotes:function(t,e){for(var i=0,r=0;r<e.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this._removeQuote(e[r])}},_isFullQuote:function(t,e){for(var i=0,r=!0,a=0;a<t.body.childNodes.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=t.body.childNodes[a];if(""!==n.textContent.trim()&&e.indexOf(n)<0&&e.indexOf(n.firstElementChild)<0){r=!1;break}}return r},_findQuoteElements:function(t){var e=this._findGmailQuotes(t),i=this._findOffice365Quotes(t),r=this._findBlockquoteQuotes(t),a=[];return a.pushOnlyUniques(e),a.pushOnlyUniques(i),a.pushOnlyUniques(r),a=this._cleanupGmail(a),a=this._removeEmptyQuotes(a)},_cleanupGmail:function(t){return t.filter(function(e){var i=!1;if("BLOCKQUOTE"===e.nodeName&&r.default.hasClass(e,"gmail_quote"))for(var a=0,n=0;n<t.length;++n){var o=0;if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;for(var u=e.parentNode;u;){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(r.default.hasClass(u,"gmail_quote")){"DIV"===u.nodeName&&(i=!0);break}u=u.parentNode}}return!i})},_removeEmptyQuotes:function(t){return t},_findGmailQuotes:function(t){return Array.prototype.slice.call(t.querySelectorAll(".gmail_quote"))},_findOffice365Quotes:function(t){var e=Array.prototype.slice.call(t.querySelectorAll("#divRplyFwdMsg, #OLK_SRC_BODY_SECTION")),i=t.getElementById('3D"divRplyFwdMsg"');return i&&e.push(i),e=e.map(function(t){return t.previousElementSibling&&"HR"===t.previousElementSibling.nodeName?t.parentElement:t})},_findBlockquoteQuotes:function(t){return Array.prototype.slice.call(t.querySelectorAll("blockquote"))},_findGmailSignatures:function(t){return Array.prototype.slice.call(t.querySelectorAll(".gmail_signature"))},_findActiveSignature:function(t){for(var e,i=0,a=this._findGmailSignatures(t),n=this._findQuoteElements(t),o=a.length-1;o>=0&&!e;o--){var u=0;if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;for(var s=a[o],h=!0,d=0;d<n.length;++d){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;if(r.default.isAncestor(s,n[d])){h=!1;break}}h&&(e=s)}return e},_trimTrailingWhitespace:function(t){for(var e=0,i=t.body.childNodes,r=[],a=i.length-1;a>=0;a--){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=i[a],o=i[a-1];if(!n||"BR"!==n.nodeName||!o||"BR"!==o.nodeName)break;r.push(n)}this._removeElements(r)},_trimQuoteWhitespace:function(t){for(var e=0,i=[],r=0;r<t.length;++r){var a=0;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;for(var n=t[r].previousElementSibling;n;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;"BR"===n.nodeName&&n.previousElementSibling&&"BR"===n.previousElementSibling.nodeName&&i.push(n),n=n.previousElementSibling}}this._removeElements(i)},_removeElements:function(t){for(var e=0,i=0;i<t.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t[i];try{r.parentNode&&r.parentNode.removeChild(r)}catch(a){}}},_isInsideQuote:function(t,e){for(var i=0;t.parentNode;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e.indexOf(t.parentNode)>=0)return!0;t=t.parentNode}return!1}},e.a=new o},,,function(t,e,i){"use strict";var r=i(66),a=i.n(r),n=i(75),o=i.n(n),u=i(7),s=i.n(u),h=i(8),d=i.n(h),c=i(17),v=i.n(c),y=i(9),g=i.n(y),l=i(18),p=i.n(l),m=i(0),f=i(3),k=i(2),A=i.n(k),S=function(t){function e(){return s()(this,e),v()(this,g()(e).apply(this,arguments))}return p()(e,t),d()(e,[{key:"onMount",value:function(){f.a.isMobile&&(this.props.onClick||this.props.onMouseDown)&&m.default.setupClick(this.refs.element,this,{onStart:this.onTapStart,onMove:this.onTapMove,onClick:this.onTapClick,onEnd:this.onTapEnd})}},{key:"getElement",value:function(){return this.refs.element}},{key:"onMouseDown",value:function(t){this.lastX=t.clientX,this.lastY=t.clientY,this.moveX=0,this.moveY=0,this.isDown=!0,this.startSrc=t.target,this.props.onMouseDown&&this.props.onMouseDown(t),!f.a.isMobile&&this.props.globalEvents&&(document.addEventListener("mousemove",this.onMouseMove),document.addEventListener("mouseup",this.onMouseUp))}},{key:"onMouseMove",value:function(t){if(this.isDown){this.moveX+=Math.abs(t.clientX-this.lastX),this.moveY+=Math.abs(t.clientY-this.lastY),this.lastX=t.clientX,this.lastY=t.clientY;var e={startSrc:this.startSrc,target:t.target,clientX:t.clientX,clientY:t.clientY,eventX:t.clientX,eventY:t.clientY,preventDefault:m.default.emptyFn,stopPropagation:m.default.emptyFn,stopImmediatePropagation:m.default.emptyFn};this.props.onMouseMove&&this.props.onMouseMove(e)}}},{key:"onClick",value:function(t){this.moveX<m.default.ClickThreshold&&this.moveY<m.default.ClickThreshold&&this.props.onClick&&this.props.onClick(t)}},{key:"onMouseUp",value:function(t){this.isDown=!1,this.props.onMouseUp&&this.props.onMouseUp(t),document.removeEventListener("mousemove",this.onMouseMove),document.removeEventListener("mouseup",this.onMouseUp)}},{key:"onTapStart",value:function(t){this.onMouseDown(t),t.stopPropagation()}},{key:"onTapClick",value:function(t){this.props.onClick&&(this.props.onClick(t),t.stopPropagation())}},{key:"onTapMove",value:function(t){this.props.onMouseMove&&this.props.onMouseMove(t),t.stopPropagation()}},{key:"onTapEnd",value:function(t){this.onMouseUp(t),t.stopPropagation()}},{key:"render",value:function(){var t=this.props,e=(t.onClick,t.globalEvents),i=o()(t,["onClick","globalEvents"]);return A.a.createElement("div",a()({},i,{onMouseDown:f.a.isMobile?void 0:this.onMouseDown,onMouseMove:e?void 0:this.onMouseMove,onClick:f.a.isMobile?void 0:this.onClick,onMouseUp:f.a.isMobile||e?void 0:this.onMouseUp,ref:"element"}),this.props.children)}}]),e}(i(20).a);e.a=S},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(0);i(389);var s=function(){function t(){a()(this,t)}return o()(t,[{key:"ab2str",value:function(t){var e="";try{var i=new Uint8Array(t);if(i.length>1e5){var r,a,n,o=0;for(r=0,a=i.length;r<a;r+=1e5){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;n=i.slice(r,r+1e5),e+=String.fromCharCode.apply(null,n)}}else e=String.fromCharCode.apply(null,i)}catch(s){u.default.reportError(s)}return e}},{key:"str2ab",value:function(t){for(var e=0,i=new ArrayBuffer(t.length),r=new Uint8Array(i),a=0,n=t.length;a<n;a++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;r[a]=t.charCodeAt(a)}return r}},{key:"unicode2ab",value:function(t){return(new TextEncoder).encode(t)}},{key:"ab2unicode",value:function(t){return(new TextDecoder).decode(t)}}]),t}();e.a=new s},function(t,e,i){"use strict";var r=i(0),a=i(1),n=i(4),o=i(7),u=i.n(o),s=i(8),h=i.n(s),d=i(17),c=i.n(d),v=i(9),y=i.n(v),g=i(18),l=i.n(g),p=i(86),m=i(5),f=function(t){function e(t){var i;u()(this,e);var r={title:"Archived",paneClass:"paneArchived",contextMenuMode:a.a.ContextMenuMode.Archived,isWriteable:!0,isEditable:!1,isDraggable:!1,isDropTarget:!1,canAddItem:!1,supportCollapsing:!0,supportCompleting:!1,supportCheckbox:!1,isArchiveView:!0,supportPerformArchive:!1,supportIndent:!1,supportClone:!1,hasMoreButtons:!1,searchFilters:["project","task","starred","priority","showOnlyMatches"]};return(i=c()(this,y()(e).call(this,t,r))).type=a.a.PaneMode.Archived,i._blocks=[],i._blocksById={},i.initArchived(),i}return l()(e,t),h()(e,[{key:"initArchived",value:function(){this.showArchived.set(!0)}},{key:"getItemSearchParams",value:function(){return{item:this.getItem(),comparator:this.search.isMatched,includeArchived:!0,includeNotes:!0,noCollapsed:!0,pane:this}}},{key:"getHeaderSearchParams",value:function(){return{item:this.getItem(),comparator:this.search.isMatched,includeArchived:!0,noCollapsed:!0,collapseAfterDepth:1,headers:!0,overview:!0,pane:this}}},{key:"getStatusMessage",value:function(){return"No archived items"}},{key:"handleRightSideTap",value:function(t){this.runUnarchive(t)}},{key:"runUnarchive",value:function(t){t.unArchiveIntoItem(t.getDocumentOwner().getRootItem(),a.a.ChangeType.Local),m.a.reset()}},{key:"getRootItem",value:function(){return this.document.get().getRootArchivedItem()}}]),e}(p.a),k=i(24),A=i.n(k),S=i(37),w=i.n(S),L=i(3),F=i(14),C=i(19),I=a.a.TaskSortMode,P=function(){function t(e){for(var i in u()(this,t),e)e.hasOwnProperty(i)&&(this[i]=e[i]);this.id=e.id,this.text=e.name,this.search=this.pane.search,this.items=[],this.numInstancesOfItem={},C.a.binder(this,"toggleCollapsed","heightOfHeader","compareItemsAgenda","compareItemsCreated","compareItemsCompleted");try{r.default.PAssert(1691,this.id,"Added an agenda block without an id")}catch(a){r.default.reportError(a)}}return h()(t,[{key:"shouldShowTime",value:function(){return!this.isOverdue&&this.isDate}},{key:"heightOfHeader",value:function(){return 32}},{key:"heightOfSpaceBetween",value:function(){return 16}},{key:"heightOfAddButton",value:function(){return this.heightOfHeader()+this.heightOfSpaceBetween()}},{key:"numItems",value:function(){return this.items.length}},{key:"getLastItem",value:function(){var t=this.items[this.items.length-1];return t&&t.isNote()&&(t=t.parent()),t}},{key:"comparePriority",value:function(t,e){var i=t.getPriority(),r=e.getPriority();return i>r?-1:i<r?1:0}},{key:"compareDate",value:function(t,e){try{r.default.PAssert(1692,this.date,"This block does not have a date",this.text)}catch(v){r.default.reportError(v)}var i=this.pane,a=t.getDate(i)||t.getNextDate(),n=e.getDate(i)||e.getNextDate();if(t.isComplete()&&!e.isComplete())return-1;if(!t.isComplete()&&e.isComplete())return 1;if(t.isComplete()&&e.isComplete())return t.dateCompleted>e.dateCompleted?1:-1;if(a&&!n)return-1;if(!a&&n)return 1;if(!a&&!n)return 0;if(t.getDuration(i)>0){var o=t.getDisplayDateWithDuration(this.date);o&&(a=o)}if(e.getDuration(i)>0){var u=e.getDisplayDateWithDuration(this.date);u&&(n=u)}var s=a.clone().clearTime(),h=n.clone().clearTime();if(!s.equals(h))return s<h?-1:1;if(a.hasTimeOfDay()&&n.hasTimeOfDay()){var d=a.getTimeOfDay(),c=n.getTimeOfDay();return d===c?0:d<c?-1:1}return a.hasTimeOfDay()?1:n.hasTimeOfDay()?-1:0}},{key:"compareOrder",value:function(t,e){return t.index-e.index}},{key:"compareItemsAgenda",value:function(t,e){var i=t.item,a=e.item;r.default.DAssert(i,"Must have a valid left item to compare"),r.default.DAssert(a,"Must have a valid right item to compare"),r.default.DAssert(!i||i.parent(),"Must have a valid left parent item"),r.default.DAssert(!a||a.parent(),"Must have a valid right parent item"),i.isNote()&&(i=i.parent()),a.isNote()&&(a=a.parent());var n=this.isStarred||this.isImportant?0:this.compareDate(i,a);if(0===n){var o=this.isStarred?0:this.comparePriority(i,a);return 0===o?this.compareOrder(t,e):o}return n}},{key:"compareItemsCreated",value:function(t,e){return this.pane.compareDate(t.dateCreated,e.dateCreated)}},{key:"compareItemsCompleted",value:function(t,e){return this.pane.compareDate(t.dateCompleted,e.dateCompleted)}},{key:"addItem",value:function(t){try{r.default.PAssert(1693,t&&r.default.isVMLI(t),"Must be adding a valid item: "+r.default.getObjectInfo(t))}catch(e){r.default.reportError(e)}this.items.indexOf(t)<0&&this.items.push(t)}},{key:"toggleCollapsed",value:function(){this.pane.setBlockCollapsed(this,!this.isCollapsed())}},{key:"isCollapsed",value:function(){return this.pane.isBlockCollapsed(this)}},{key:"getItemID",value:function(t){var e=this.numInstancesOfItem[t.id]||0;return this.numInstancesOfItem[t.id]=e+1,t.id+"_"+this.id+(e?"_"+e:"")}},{key:"sort",value:function(){var t;if(this.pane.isViewAgenda()){var e=this.pane.getSortModeBlocks();e===I.Date?t=this.compareItemsAgenda:e===I.Created?t=this.compareItemsCreated:e===I.Completed&&(t=this.compareItemsCompleted)}else this.pane.isViewCalendarMonth()?t=this.compareItemsAgenda:this.sortMode&&this.sortMode!==I.None&&(t=this.pane.getItemComparator());if(t){var i=this.items.map(function(t,e){return{item:t,index:e}});i.sort(t),this.items=i.map(function(t){return t.item})}}}]),t}(),N=i(10),H=i(21),M=i(6),z=i(77),D=a.a.TaskViewMode,V=a.a.TaskSortMode,G="__block_nokey",T={};T[D.Groups_Project]={Default:V.None,Available:[V.None,V.Alphabetical,V.NumItems,V.Date,V.Priority,V.Created]},T[D.Groups_Tag]=T[D.Groups_Contact]={Default:V.Alphabetical,Available:[V.Alphabetical,V.NumItems]},T[D.Agenda_Today]=T[D.Agenda_Week]=T[D.Agenda_All]={Default:V.Date,Available:[V.Date,V.Created,V.Completed]};var q=function(t){function e(t){var i;u()(this,e);var o=n.default.pluginManager.getPlugin(a.a.PluginID.GCalendar).isActive()&&!r.default.isDemoMode();t.document||(t.document=F.a.getDefaultDocument());var s={isWriteable:!0,hasNonVMLIs:!0,supportCollapsing:!0,supportCompleting:!0,supportIndent:!1,supportOffline:!0,supportMenuIcon:!0,supportViewMenu:!0,supportMultiselect:!1,supportDataRefresh:o,supportClickOverviewScroll:!1,isDraggable:!0,overviewTracksScroll:!1,overviewCanTrackScroll:!0,combineOverdue:!0,searchFilters:["project","task","starred","complete","priority","showOnlyMatches","showOnlyAgendaDates","showOnlyMatchingTags","showChildProjects"]};(i=c()(this,y()(e).call(this,t,s))).type=a.a.PaneMode.Task,i.paneClass="paneTask",C.a.binder(w()(w()(i)),"getDayWidth","updateAllDay","scrollToToday","openViewMenu","setViewMode","compareBlockDate","compareBlockName","compareBlockItemPriority","compareBlockItemCreated","compareItemDate","compareItemName","_itemSearchComparator","onScroll","checkFlatListMode","addFnProject","addFnTag","addFnDate","onGCalendarActiveChanged","onGmailActiveChanged","onCalendarCustomDaysChanged","switchToOutline","_onSelectionChanged"),i.dragHoveredBlock=new N.a;var h=t.viewState||{};if(h.viewMode=h.viewMode||D.Groups_Project,h.sortModeBlocks=h.sortModeBlocks||{mode:V.None},h.sortModeItems=h.sortModeItems||{mode:V.None},r.default.isString(h.sortModeBlocks)&&(h.sortModeBlocks={mode:h.sortModeBlocks}),r.default.isString(h.sortModeItems)&&(h.sortModeItems={mode:h.sortModeItems}),i.viewState=new N.a(h,i.onViewStateChanged.bind(w()(w()(i)))),i._allPaneItems=[],i._isViewHelper={},i.topBoxHeight.set(0,!1),i.blocksCollapsed=t.blocksCollapsed,!i.blocksCollapsed){var d=i.blocksCollapsed={};d[G+"_"+D.Groups_Project]=!0,d[G+"_"+D.Groups_Tag]=!0,d[G+"_"+D.Groups_Contact]=!0,d[G+"_"+D.Groups_Priority]=!0}return i.search.getFilterObs("showOnlyMatches").listen(i.checkFlatListMode),i.dropEffect=function(t){var e=a.a.DropEffect.Move;return i.isCalendarItem(t)&&(e=a.a.DropEffect.Copy),e},i.displayLocalItems=new N.a(void 0===t.displayLocalItems||t.displayLocalItems),i.displayCalendars=new N.a(t.displayCalendars||{}),i.numAllDay=new N.a(0),i.setupViewState(),i.initBlocks(),i}return l()(e,t),h()(e,[{key:"initBlocks",value:function(){this.blocks=[],this.blockImportant=void 0,this.blockStarred=void 0,this.days={},this.datesByItem={},this.starredItems={},this.priorityItems={},this.blocksByKey={},this.preventUpdateItemsForItem=void 0,this.itemAnimationTimeout=void 0;var t=n.default.pluginManager.getPlugin(a.a.PluginID.GCalendar);t.isActive()&&this.useItemStore(t.getDefaultItemStore());var e=n.default.pluginManager.getPlugin(a.a.PluginID.Gmail);e.isActive()&&this.useItemStore(e.getDefaultItemStore()),n.default.pluginManager.listen("pluginActiveChanged",a.a.PluginID.GCalendar,this.onGCalendarActiveChanged),n.default.pluginManager.listen("pluginActiveChanged",a.a.PluginID.Gmail,this.onGmailActiveChanged),H.a.listen("selectionChanged",this._onSelectionChanged),n.default.settings.dayWeekStart.listen(this.scrollToToday),n.default.settings.calendarCustomDays.listen(this.onCalendarCustomDaysChanged)}},{key:"destroy",value:function(){H.a.unlisten("selectionChanged",this._onSelectionChanged),n.default.settings.dayWeekStart.unlisten(this.scrollToToday),n.default.settings.calendarCustomDays.unlisten(this.onCalendarCustomDaysChanged),this._onAfterLoadedRAF||this.removeScrollListener(this.onScroll),n.default.pluginManager.unlisten("pluginActiveChanged",a.a.PluginID.GCalendar,this.onGCalendarActiveChanged),n.default.pluginManager.unlisten("pluginActiveChanged",a.a.PluginID.Gmail,this.onGmailActiveChanged),A()(y()(e.prototype),"destroy",this).call(this)}},{key:"getPaneIcon",value:function(){return"icon-calendar"}},{key:"keydown",value:function(t){return m.a.isValid()&&m.a.getStartIndex()===m.a.getEndIndex()&&!M.e.undoRedoActive&&(this.preventUpdateItemsForItem=m.a.getStartObject(),this.search.stickMatch(m.a.getStartObject())),A()(y()(e.prototype),"keydown",this).call(this,t)}},{key:"handleLeftSideTap",value:function(t,i){return this.clearPreventUpdate(),A()(y()(e.prototype),"handleLeftSideTap",this).call(this,t,i)}},{key:"clearPreventUpdate",value:function(){var t=this,e=this.preventUpdateItemsForItem;if(e&&n.default.DragDrop.isDragging){H.a.listen("endDrag",function e(){H.a.unlisten("endDrag",e),t.clearPreventUpdate()})}else{var i=!1;e&&(i=i||this.search.unstickMatch(e),this.preventUpdateItemsForItem=void 0),i&&(this.itemsWillBeDirty=void 0,this.setItemsDirty(),n.default.PaneUpdateBatcher.updateAllItems())}}},{key:"_onSelectionChanged",value:function(t){m.a.getPane()===this&&this.preventUpdateItemsForItem&&!M.e.undoRedoActive?m.a.isValid()?m.a.getStartObject().id!==this.preventUpdateItemsForItem.id&&(n.default.PaneUpdateBatcher.beginUpdateItems(),this.clearPreventUpdate(),L.a.isMobile?setTimeout(this.updateItems,0):(r.default.setItemAnimationMode(a.a.ItemAnimationMode.Move),n.default.PaneUpdateBatcher.updateAllItems(),t&&this.restoreSelection(t),clearTimeout(this.itemAnimationTimeout),this.itemAnimationTimeout=setTimeout(function(){r.default.resetItemAnimationMode()},300)),n.default.PaneUpdateBatcher.commitUpdateItems()):(this.clearPreventUpdate(),this.updateItems()):this.clearPreventUpdate()}},{key:"isCalendarItem",value:function(t){return t.belongsToItemStore(n.default.pluginManager.getPlugin(a.a.PluginID.GCalendar).getDefaultItemStore())}},{key:"isEmailItem",value:function(t){return t.belongsToItemStore(n.default.pluginManager.getPlugin(a.a.PluginID.Gmail).getDefaultItemStore())}},{key:"_itemSearchComparator",value:function(t){var e=this.search.isMatched(t)||t.isNote()&&this.search.isMatched(t.parent()),i=!1,r=!1;if(this.isCalendarItem(t)){var o=t.getAttachmentByPlugin(a.a.PluginID.GCalendar);o&&("cancelled"===o.getField("status")?r=!0:o.forEachItem(void 0,function(t){t.belongsToItemStore(n.default.pluginManager.getPlugin(a.a.PluginID.GCalendar).getDefaultItemStore())||(i=!0)}))}else if(this.isEmailItem(t)){var u=t.getAttachmentByPlugin(a.a.PluginID.Gmail);if(u){var s=n.default.pluginManager.getPluginGmail();if(s.isItemArchived(t))e=!1;else s.getAttachmentPriority(u)!==a.a.VMLIFlag.None&&(e=!0)}}return e&&!i&&!r}},{key:"getItemSearchParams",value:function(){return{itemStoreFilter:this.search.itemStoreFilter,item:this.item.get(),comparator:this._itemSearchComparator,noCollapsed:this.isViewOutline(),includeArchived:this.showArchived.get(),includeNotes:!0,pane:this}}},{key:"_setItems",value:function(t,e){this.updateBlockItems()}},{key:"onTapViewArchived",value:function(){n.default.PaneUpdateBatcher.beginUpdateItems(),this.showArchived.set(!this.showArchived.get()),n.default.PaneUpdateBatcher.commitUpdateItems(),n.default.PaneManager.updatePaneStateForPane(this),r.default.sendEvent("Menu","ShowArchivedTimeline")}},{key:"onLoad",value:function(){isNaN(this.initialOffset)&&this.isViewDates()&&(this.initialOffset=this.getScrollOffsetOfToday(),this._infiniteList.setInitialScrollOffset(this.initialOffset)),A()(y()(e.prototype),"onLoad",this).call(this)}},{key:"onAfterLoaded",value:function(){this.orientation.get()===a.a.Orientation.Horizontal&&(this.paneContent.scrollTop=this.getDayViewY()),this.setIgnoreRestoreScroll(),A()(y()(e.prototype),"onAfterLoaded",this).call(this),this.addScrollListener(this.onScroll)}},{key:"getScrollOffsetOfToday",value:function(){var t;this.getViewMode();if(this.isViewCalendarMonth())t=this.heightWeek()*(a.a.CalendarMonthViewNumWeeksPad+1);else if(this.isViewCalendarHoriz())t=this.getDayWidth()*a.a.CalendarDayViewNumDaysPad+1;else if(this.isViewAgenda())for(var e=0,i=this.items.get(),r=0;r<i.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=i[r];if((n.isOverdue||n.isToday)&&"blockHeader"===n.type){t=this.topOfIndex(r)-16;break}}return t}},{key:"_getDateInMiddle",value:function(){return(new Date).clearTime()}},{key:"scrollToTop",value:function(t){this.isViewDates()?this.scrollToToday(t):A()(y()(e.prototype),"scrollToTop",this).call(this,t)}},{key:"scrollToToday",value:function(t){var e=this.getScrollOffsetOfToday();t=isNaN(t)?a.a.ScrollDuration.Default:t,this.setIgnoreRestoreScroll(t+100),this.setScrollOffset(e,t),this.orientation.get()===a.a.Orientation.Horizontal&&(this.paneContent.scrollTop=this.getDayViewY(),this.scrollElement.scrollTop=0)}},{key:"weekCount",value:function(t,e,i){var r=new Date(t,e,1),a=i?new Date(t,e,i):new Date(t,e+1,0),n=r.getDay()+a.getDate();return Math.ceil(n/7)}},{key:"scrollJump",value:function(t,e){e=isNaN(e)?a.a.ScrollDuration.Default:e;var i,r,o=this.getViewMode(),u=this._infiniteList.getScrollOffset(),s=this._infiniteList.indexOfTop(),h=this._infiniteList.objectAtIndex(s),d=u-this.topOfIndex(s);if(o===D.Calendar_Month){var c=h.date;if(t<0){var v=c.clone().addMonths(-1);i=this.weekCount(c.getFullYear(),c.getMonth(),c.getDate())-1,r=this.weekCount(v.getFullYear(),v.getMonth()),u-=this.heightWeek()*(r+i)+d}else r=this.weekCount(c.getFullYear(),c.getMonth()),i=this.weekCount(c.getFullYear(),c.getMonth(),c.getDate())-1,u+=this.heightWeek()*(r-i)-d}else if(o===D.Calendar_Custom){var y=n.default.settings.calendarCustomDays.get();u+=this.getDayWidth()*y*t-d+1}else if(o===D.Calendar_Week){var g,l=h.date.getDay(),p=n.default.settings.dayWeekStart.get();g=t<0?l>p?-l+p:-7:7-l+p,u+=this.getDayWidth()*g-d+1}else o===D.Calendar_Day&&(t<0&&d>200?u-=d:u+=this.getDayWidth()*t-d+1);this.setIgnoreRestoreScroll(),this.setScrollOffset(u,e)}},{key:"compareDate",value:function(t,e){return t||e?t?e?t.compareTo(e):-1:1:0}},{key:"compareText",value:function(t,e){return t.localeCompare(e)}},{key:"comparePriority",value:function(t,e){var i=t.getPriority(this),r=e.getPriority(this);return r>i?1:r<i?-1:0}},{key:"compareBlockBase",value:function(t,e,i){try{r.default.PAssert(1371,t,"Comparator was invalid")}catch(s){r.default.reportError(s)}var a,n=this.getSortOrderBlocks()||1;if(t&&(a=this.compareNoKey(e,i)*n||t(e,i)),0===a||void 0===a){var o=T[this.getViewMode()].Default,u=this._getBlockSortComparator(o);if(u!==t)return u(e,i)}return a*n}},{key:"compareBlockPriority",value:function(t,e){return e.priority-t.priority}},{key:"compareNoKey",value:function(t,e){return t.id===this.blockNoKey?1:e.id===this.blockNoKey?-1:void 0}},{key:"compareNone",value:function(t,e){return t.originalIndex-e.originalIndex}},{key:"compareBlockDate",value:function(t,e){return this.compareDate(t.date,e.date)}},{key:"compareBlockName",value:function(t,e){return this.compareText(t.name,e.name)}},{key:"compareBlockNumItems",value:function(t,e){return e.items.length-t.items.length}},{key:"compareBlockItemPriority",value:function(t,e){return this.comparePriority(t.item,e.item)}},{key:"compareBlockItemCreated",value:function(t,e){return this.compareDate(t.item.dateCreated,e.item.dateCreated)}},{key:"_getBlockSortComparator",value:function(t){return t===V.Alphabetical&&this.compareBlockName||t===V.Date&&this.compareBlockDate||t===V.NumItems&&this.compareBlockNumItems||t===V.Priority&&this.compareBlockItemPriority||t===V.Created&&this.compareBlockItemCreated||t===V.None&&this.compareNone}},{key:"getBlockComparator",value:function(){var t=this.getSortModeBlocks();return this.compareBlockBase.bind(this,this._getBlockSortComparator(t))}},{key:"compareItemBase",value:function(t,e,i){try{r.default.PAssert(1372,t,"Comparator was invalid")}catch(o){r.default.reportError(o)}var a,n=this.getSortOrderItems();return t&&(a=t(e,i)*n),0===a||void 0===a?this.compareItemNone(e,i):a}},{key:"compareItemNone",value:function(t,e){return t.index-e.index}},{key:"compareItemDate",value:function(t,e){return this.compareDate(t.item.getDate(this),e.item.getDate(this))}},{key:"compareItemName",value:function(t,e){return this.compareText(t.item.getSearchText(this),e.item.getSearchText(this))}},{key:"compareItemNumItems",value:function(t,e){return e.item.numItems()-t.item.numItems()}},{key:"_getItemSortComparator",value:function(t){return t===V.Alphabetical&&this.compareItemName||t===V.Date&&this.compareItemDate||t===V.NumItems&&this.compareItemNumItems||t===V.Priority&&this.compareBlockItemPriority||t===V.Created&&this.compareBlockItemCreated||t===V.None&&this.compareItemNone}},{key:"getItemComparator",value:function(){var t=this.getSortModeItems();return this.compareItemBase.bind(this,this._getItemSortComparator(t))}},{key:"getItemsOnDate",value:function(t){var e=0,i=[];for(var r=0;r<this._itemsWithDates.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this._itemsWithDates[r];a.getMooDate().isOnDate(t)&&i.push(a)}return i}},{key:"findIndexOfNextBlock",value:function(){for(var t=0,e=new Date,i=this.items.get(),r=0;r<i.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=i[r];if("blockHeader"===a.type){var n=a.block;if(n.isOverdue||n.isNow||n.isToday||n.isStarred||n.isImportant||n.date>=e)return r}}return-1}},{key:"_keyHelper",value:function(t,e){var i=t["get"+e](this);if(i){if(i=i.map(function(t){return{value:t,lower:t.toLowerCase()}}),this.search.showOnlyMatchingTags()){var a=this.search["get"+e]();a&&a.length>0&&(a=a.map(r.default.toLowerCase),i=i.filter(function(t){for(var e=0,i=0;i<a.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(t.lower===a[i])return!0}}))}return i}if(!t.hasVisibleChildren(this)){for(var n=0,o=!0,u=t.parent();void 0!==u&&u!==this.getItem();){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=u["get"+e](this);if(s)for(var h=0,d=0;d<s.length;d++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(this.blocksByKey[s[d].toLowerCase()]){o=!1;break}}u=u.parent()}if(o)return[this.blockNoKey]}}},{key:"_getKeysForItem",value:function(t){var e=this.getViewMode();if(this.isViewAgenda()||this.isViewCalendar()){var i=!0;if(this.isViewAgenda()&&t.hasAttachmentType(a.a.PluginType.Calendar)&&t.getDate()<Date.today()){var r=t.getAttachmentByType(a.a.PluginType.Calendar);r.getPlugin().shouldDisplayOverdueInAgenda()&&r.getPlugin().hasWritePermissionForAttach(r)||(i=!1)}if(i){var o=this._getDatesForItem(t);if(this.isViewAgenda()&&this.getSortModeBlocks()===V.Date&&!this.search.showOnlyAgendaDates()){var u=[];if(!t.isComplete()){if(t.isStarred(this)){var s="starred";n.default.timeline.getDateForKey(s)&&u.push(s)}if(t.isImportant(this)){s="important";n.default.timeline.getDateForKey(s)&&u.push(s)}}var h=t.getTagsLower();if(h)for(var d=0,c=0;h&&c<h.length;c++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var v="#"+h[c];n.default.timeline.getDateForKey(v)&&u.push(v)}u.length>0&&(o=o?o.concat(u):u)}return o}}else if(e===D.Groups_Project){var y=t.parent();if(y===this.getItem()&&!t.isPrefixHeader(this))return[this.blockNoKey];if(y&&y.isPrefixHeader()&&y!==this.getItem()&&(this.search.showChildProjects()||y.parent()===this.getItem()))return[y.id]}else{if(e===D.Groups_Tag)return this._keyHelper(t,"Tags");if(e===D.Groups_Contact)return this._keyHelper(t,"Contacts");if(e===D.Groups_Priority){var g=t.getPriority(this);if(g)return[g];if(!t.hasVisibleChildren(this)){for(var l=0,p=(i=!0,t.parent());void 0!==p&&p!==this.getItem();){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;if(p.getPriority(this)){i=!1;break}p=p.parent()}if(i)return[this.blockNoKey]}}}}},{key:"isOkOnAgenda",value:function(t){return!!this._getKeysForItem(t)||this.search.showHierarchy()&&t.parent()&&this.isOkOnAgenda(t.parent())}},{key:"_getDatesForItem",value:function(t){var e,i=this,r=this.getSortModeBlocks();if(this.isViewCalendar()||r===V.Date){var a=t.getMooDate();if(t.isComplete()&&this.isViewAgenda())t.dateCompleted>=Date.today()&&(e=t.dateCompleted);else if(a){var n=a.getAllDates();return n.length>10&&a.isRepeatDate()&&!a.isRange()&&(n=n.slice(0,10)),n.filter(function(t){return i.isDateWithinRange(t)})}}else if(r===V.Created||r===V.Completed){var o=r===V.Created?t.dateCreated:t.dateCompleted;(!this.startDate||o>=this.startDate)&&(e=o)}if(e&&this.isDateWithinRange(e))return[e]}},{key:"isDateWithinRange",value:function(t){return t&&(!this.endDate||t<this.endDate)}},{key:"_getKeyForDate",value:function(t){var e=Date.today();if(!(this.combineOverdue&&t<e)){var i=a.a.DFormat.MonthDayYearLong,r=n.default.International.getFormat(i);return t.toString(r)}return"overdue".toLowerCase()}},{key:"updateBlockItems",value:function(){var t,e=this.getViewMode();if(this.isViewOutline())this.updateOutline(this._allPaneItems,this.supportsSortItems()&&this.getItemComparator());else if(this.isViewCalendar()){var i=0;this._itemsWithDates=[];for(var r=0;r<this._allPaneItems.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=this._allPaneItems[r];if(n.getMooDate()){var o=n.getAttachmentByType(a.a.PluginType.Calendar),u=o&&o.getField("calendarID");(u?!1!==this.displayCalendars.get()[u]:this.displayLocalItems.get())&&this._itemsWithDates.push(n)}}e===D.Calendar_Month?this.updateCalendarMonth():this.isViewCalendarHoriz()&&(this.updateCalendarWeek(),t=!0)}else this.updateBlocks(),this.updatePaneObjects();t&&this.updateAllDay()}},{key:"updateBlocks",value:function(){var t,e=0;this.blocks=[],this.blocksByKey={},this.isViewAgenda()&&this.getBlock(Date.today());for(var i=0;i<this._allPaneItems.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=this._allPaneItems[i],o=!r.isNote();if(o)if(r.getMooDate()){var u=r.getAttachmentByType(a.a.PluginType.Calendar),s=u&&n.default.pluginManager.getPluginGCalendar().isReady()&&u.getField("calendarID");o=s?!1!==this.displayCalendars.get()[s]:this.displayLocalItems.get()}o&&this.addToBlock(this._allPaneItems[i])}this.isViewAgenda()?t=this.compareBlockDate:this.isViewPriority()?t=this.compareBlockBase.bind(this,this.compareBlockPriority):this.supportsSortBlocks()&&(t=this.getBlockComparator()),t&&this.blocks.sort(t)}},{key:"addItemToPaneObjects",value:function(t,e,i,r,a){r=r||0;var n=new z.a({type:"blockItem",item:i,id:e.getItemID(i)+(a?"_"+a.id:""),block:e,parentObject:a,index:t.length,levelsDeep:r,sizeInPane:i.sizeInPane});if(this.addPaneObject(t,n),i.hasNote()&&this.addItemToPaneObjects(t,e,i.getNote(),r,a),!i.isCollapsed(this)){var o=i.getVisibleChildren(this);if(o)for(var u=0,s=0;s<o.length;s++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;this.addItemToPaneObjects(t,e,o[s],r+1,n)}}return n}},{key:"updatePaneObjects",value:function(){var t,e,i,r,a=0,n=[];for(i=0;i<this.blocks.length;i++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=this.blocks[i],u=this.isBlockCollapsed(o)&&(i===this.blocks.length-1||!this.isBlockCollapsed(this.blocks[i+1]));if(o.sort(),o.item?(e=o.item,r=new z.a({type:"blockItem",item:e,id:e.id+"_"+o.id,block:o,index:n.length,levelsDeep:0,sizePad:u?o.heightOfSpaceBetween():o.isCollapsed()?0:4,sizeInPane:e.sizeInPane,isBlockHeader:!0}),this.addPaneObject(n,r),e.hasNote()&&!this.isBlockCollapsed(o)&&this.addItemToPaneObjects(n,o,e.getNote(),0,r)):this.isViewProjectNoBlocks()||this.addPaneObject(n,new z.a({type:"blockHeader",block:o,id:o.id,index:n.length,isToday:o.isToday,isOverdue:o.isOverdue,isFirstCollapsed:t&&o.isCollapsed()&&!t.isCollapsed(),sizePad:u?o.heightOfSpaceBetween():this.isViewProject()||this.isViewAgenda()&&o.isDate?4:0,sizeInPane:o.heightOfHeader})),1===this.blocks.length&&this.isViewProject()||!this.isBlockCollapsed(o)){for(var s=0,h=!1,d=0;d<o.items.length;d++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;e=o.items[d],r=this.addItemToPaneObjects(n,o,e),!h&&this.isViewAgenda()&&this.shouldShowTime(r)&&!e.getTime()&&(r.showAllDay=!0,h=!0)}this.addPaneObject(n,new z.a({type:"blockAddItem",id:o.id+"_add",block:o,index:n.length,sizeInPane:o.noAddButton?o.heightOfSpaceBetween():o.heightOfAddButton(),addFn:o.addItem}))}t=o}this.isViewProject()&&!this.isViewProjectNoBlocks()&&((o=this.getBlock("newProject")).isNewProject=!0,this.addPaneObject(n,new z.a({type:"blockHeader",block:o,id:o.id,index:n.length,sizeInPane:o.heightOfHeader}))),this.items.set(n)}},{key:"addToBlock",value:function(t){this.isViewProject()&&t.isPrefixHeader(this)&&(this.search.showChildProjects()||t.parent()===this.getItem())&&this.getBlock(t.id,t);var e=this._getKeysForItem(t);if(e)for(var i=0,r=0;r<e.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var a=this.getBlock(e[r],t);a&&a.addItem(t)}}},{key:"_addFnBase",value:function(t,e,i,o,u){var s=this;t=n.default.settings.getDefaultItemText(o)+t,this.clearPreventUpdate(),n.default.PaneUpdateBatcher.beginUpdateItems(),M.e.beginAction();var h={text:t};u&&(h=r.default.extend(h,u));var d=this.createVMLI(h,{parent:i,changeType:a.a.ChangeType.AllLocal,isEditable:!0});i.insertItem(d),M.e.performAction(M.c.Create,{itemID:d.id,parent:i.id,position:i.numItems(),text:t}),M.e.endAction(),n.default.PaneUpdateBatcher.commitUpdateItems();var c=this.indexOfItem(d,e);c>=0&&(m.a.selectIndex(c,0),L.a.isMobile&&r.default.openKeyboardOnIndex(void 0,this,c,function(){s.setFocused(!0)}))}},{key:"addFnProject",value:function(t){return this._addFnBase("",t,t.id===this.blockNoKey?this.getItem():F.a.getItem(t.id))}},{key:"addFnTag",value:function(t){return this._addFnBase(t.id===this.blockNoKey?"":" "+t.text,t,this.getItem())}},{key:"addFnDate",value:function(t){var e,i="";return t.isDate?(i=" "+a.a.CharDate,e={date:t.date}):t.isStarred?e={isStarred:!0}:t.isImportant?e={priority:a.a.VMLIFlag.P2}:i=" "+t.id,this._addFnBase(i,t,this.getItem(),void 0,e)}},{key:"addFnContact",value:function(t){return this._addFnBase(t.id===this.blockNoKey?"":" "+t.text,t,this.getItem())}},{key:"addFnPriority",value:function(t){return this._addFnBase("",t,this.getItem(),void 0,{priority:t.priority})}},{key:"getDateForSoftDate",value:function(t){var e=n.default.timeline.getDateForKey(t.toLowerCase());if(!isNaN(e)){var i=100*Math.round(e/100),r={days:Math.round(i/100),minutes:Math.round(e-i)};return Date.today().add(r)}}},{key:"getBlock",value:function(t,e){var i,o=this.isViewDates(),u=this.isViewAgenda(),s=t;if(o&&!r.default.isString(t))i=t,s=t=this._getKeyForDate(i),"overdue"===t&&(!e.isComplete()&&n.default.timeline.getDateForKey(t)||(t=void 0),i=void 0);else if(r.default.isObject(t)){try{r.default.PAssert(1373,t.value&&t.lower,"If key is object it should have this form")}catch(g){r.default.reportError(g)}s=t.lower,t=t.value}if(t){var h,d=this.isViewAutoBlocks()?void 0:F.a.getItem(t),c=this.getViewMode(),v=this.blocksByKey[s];if(!v)if(void 0!==(h=d?d.getStyledTextAsOneLine(!0):this.isViewPriority()?t===a.a.VMLIFlag.P0?"High":t===a.a.VMLIFlag.P1?"Medium":t===a.a.VMLIFlag.P2?"Low":"(No priority)":t)){var y={pane:this,id:t,name:h,sortMode:this.supportsSortItems()&&this.getSortModeItems(),addFn:this.isViewProject()&&this.addFnProject.bind(this)||this.isViewTag()&&this.addFnTag.bind(this)||this.isViewContact()&&this.addFnContact.bind(this)||this.isViewPriority()&&this.addFnPriority.bind(this)||u&&this.addFnDate};this.isViewTag()?(y.name=t===this.blockNoKey?"(No tag)":"#"+y.name,y.isTag=!0):this.isViewContact()?(y.name=t===this.blockNoKey?"(No contact)":"+"+y.name,y.isContact=!0):this.isViewPriority()&&(y.isPriority=!0,y.priority=t),c===D.Groups_Project&&(y.name=t===this.blockNoKey?"(No project)":y.name,y.item=d,y.isEditable=!0,y.date=d&&d.getDate(this)),t===this.blockNoKey&&(y.isNoKey=!0),o&&(i?(y.date=i.clone().clearTime(),y.isDate=!0,y.date.equals(Date.today())&&(y.isToday=!0)):(y.date=this.getDateForSoftDate(t),y.name=y.name.toUpperCase(),"now"===t?y.isNow=!0:"starred"===t?y.isStarred=!0:"important"===t?y.isImportant=!0:"overdue"===t&&(y.isOverdue=!0,y.noAddButton=!0))),v=new P(y),this.blocksByKey[s]=v,v.originalIndex=this.blocks.length,this.blocks.push(v)}}return v}},{key:"closestIndexOfObject",value:function(t){return this.indexOfItem(t,t.block,t.index)}},{key:"onGCalendarActiveChanged",value:function(t,e){this.supportDataRefresh=e;var i=t.getDefaultItemStore();e?this.useItemStore(i):this.stopUsingItemStore(i)}},{key:"onGmailActiveChanged",value:function(t,e){var i=t.getDefaultItemStore();e?this.useItemStore(i):this.stopUsingItemStore(i)}},{key:"refreshPaneData",value:function(){var t=n.default.pluginManager.getPluginGCalendar();t.isActive()&&t.forceRemoteEventSync()}},{key:"viewModeIcon",value:function(){var t=this.getViewMode();return a.a.TaskViewModeIcon[t]}},{key:"viewModeColor",value:function(){return this.isViewOutline()?"#09d":"#a30"}},{key:"isViewDates",value:function(){return this._isViewHelper.dates}},{key:"isViewAgenda",value:function(){return this._isViewHelper.agenda}},{key:"isViewCalendar",value:function(){return this._isViewHelper.calendar}},{key:"isViewCalendarHoriz",value:function(){return this._isViewHelper.calendarHoriz}},{key:"isViewCalendarMonth",value:function(){return this._isViewHelper.calendarMonth}},{key:"isViewProject",value:function(){return this._isViewHelper.project}},{key:"isViewProjectNoBlocks",value:function(){return this._isViewHelper.project&&(0===this.blocks.length||1===this.blocks.length&&this.blocks[0].id===this.blockNoKey)}},{key:"isViewGroups",value:function(){return this._isViewHelper.groups}},{key:"isViewOutline",value:function(){return this._isViewHelper.outline}},{key:"isViewFlatList",value:function(){return this._isViewHelper.flatList}},{key:"isViewTag",value:function(){return this._isViewHelper.tag}},{key:"isViewContact",value:function(){return this._isViewHelper.contact}},{key:"isViewPriority",value:function(){return this._isViewHelper.priority}},{key:"isViewAutoBlocks",value:function(){return this._isViewHelper.autoBlocks}},{key:"isViewText",value:function(){return this._isViewHelper.text}},{key:"canScrollToItem",value:function(){return!this.isViewCalendar()}},{key:"isViewPremiumBlocked",value:function(){return!1}},{key:"shouldShowAddBox",value:function(){return this.isViewOutline()||this.isViewProject()}},{key:"isCalFilterActive",value:function(){var t=this.displayCalendars.get(),e=!this.displayLocalItems.get();for(var i in t)if(t.hasOwnProperty(i)&&!1===t[i]){e=!0;break}return e}},{key:"becomeReal",value:function(){A()(y()(e.prototype),"becomeReal",this).call(this),this.onViewStateChanged()}},{key:"onViewStateChanged",value:function(){var t=this;this.isFakePane?this.setupViewStateMinor():(r.default.setItemAnimationMode(a.a.ItemAnimationMode.None),this.setIgnoreRestoreScroll(void 0,function(){t._infiniteList.saveScrollOfTop()}),this.setupViewState(!0),this._infiniteList.clearCache(),this._infiniteList.alwaysRenderScroll=!0,this.isViewCalendar()||this._infiniteList.setInitialScrollOffset(0),this.updateItemsImmediate(!0,void 0,void 0,!0),n.default.PaneManager.updatePaneStateForPane(this),this.isViewDates()?(this.scrollToToday(a.a.ScrollDuration.Snap),requestAnimationFrame(function(){t.isViewDates()&&(t.scrollToToday(a.a.ScrollDuration.Snap),r.default.resetItemAnimationMode(),requestAnimationFrame(function(){this._infiniteList.alwaysRenderScroll=!1}.bind(t)))})):this.setScrollOffset(0,a.a.ScrollDuration.Snap),r.default.resetItemAnimationMode(),this.hasCollapsedObs.set(this.hasCollapsed()))}},{key:"setupViewStateMinor",value:function(){var t=this.getViewMode(),e=this.getSortModeBlocks(),i={agenda:t===D.Agenda_Today||t===D.Agenda_Week||t===D.Agenda_All,calendar:t===D.Calendar_Day||t===D.Calendar_Week||t===D.Calendar_Month||t===D.Calendar_Custom,calendarHoriz:t===D.Calendar_Day||t===D.Calendar_Week||t===D.Calendar_Custom,calendarMonth:t===D.Calendar_Month,project:t===D.Groups_Project,groups:t===D.Groups_Project||t===D.Groups_Tag||t===D.Groups_Contact||t===D.Groups_Priority,outline:t===D.Outline||t===D.List_Flat,flatList:t===D.List_Flat,tag:t===D.Groups_Tag,contact:t===D.Groups_Contact,priority:t===D.Groups_Priority};i.dates=i.agenda||i.calendar,i.autoBlocks=i.agenda||i.tag||i.contact||i.priority,i.text=!i.calendar,this._isViewHelper=i,this.supportsSortBlocks()&&(this.supportsSortBlocksMode(e)||this.setSortModeBlocks(T[t].Default,1,!1),(e=this.getSortModeBlocks())===V.Completed&&0===this.search.getFilterValue("completeOption")&&this.search.setFilter("completeOption",1)),this.search.setFilterEnabled("showOnlyAgendaDates",this.isViewAgenda()),this.search.setFilterEnabled("showOnlyMatchingTags",this.isViewTag()||this.isViewContact()),this.search.setFilterEnabled("showChildProjects",this.isViewProject()),(this.isViewTag()||this.isViewContact())&&this.search.setFilterTooltip("showOnlyMatchingTags","Show only matching "+(this.isViewTag()?"Tag":"Contact")+" blocks")}},{key:"setupViewState",value:function(t){this.setupViewStateMinor();var e,i=this.getViewMode(),o=this.getSortModeBlocks(),u=this.isViewOutline(),s=this.isViewCalendar()||r.default.activeDisplayMode&a.a.DisplayMode.NoPaneTop?0:(L.a.isMobile||!this.isViewAgenda()&&!this.isViewProject()?!L.a.isMobile&&36:48)||L.a.isMobile&&16;if(this.blockNoKey=G+"_"+i,this.supportIndent=u,this.supportMultiselect=u,this.overviewTracksScroll=u,this.supportSearchFlat=u,this.supportCheckbox=!this.isViewCalendar(),this.topBoxHeight.set(s,!1),this.paneClass=this.getPaneClass(),this.paneEmptyMessage=(this.isViewAgenda()?"Nothing on the agenda":this.isViewOutline()&&"Write some things here to get started")||"",this.collapsedFieldName=a.a.PerPaneStateField.Collapsed+(this.viewState?i:""),this._isSearchedFlat=!(this.isViewCalendar()||!this.search)&&!this.search.showHierarchy(),this.isViewPremiumBlocked()?this.toast.set({text:"The "+a.a.TaskViewModeText[i]+" view is a Premium feature",actionText:"GO TO OUTLINE",doAction:this.switchToOutline}):this.toast.set(void 0),(this.isViewCalendar()||this.isViewAgenda())&&(e=a.a.ItemStoreFilter.Dates,(this.isViewCalendar()||this.getSortModeBlocks()===V.Date)&&(e|=a.a.ItemStoreFilter.Priority)),this.search.itemStoreFilter=e,this.search.onlyMatchDates=this.isViewDates(),this.shouldUpdateOnTextChanged=this.isViewAgenda()||this.isViewTag(),this.combineOverdue=this.isViewAgenda()&&o===V.Date,this.showScrollbars.set(!this.isViewCalendar()),this.isViewAgenda()){var h,d;if(i!==D.Agenda_All)i===D.Agenda_Today?d=1:i===D.Agenda_Week&&(d=7),h=Date.today().addDays(o===V.Date?d:-(d-1));o===V.Date?this.endDate=h:(this.startDate=h,this.endDate=Date.today().addDays(1))}this.isEditable=this.supportSel=!this.isViewCalendar(),this.orientation.set(this.isViewCalendarHoriz()?a.a.Orientation.Horizontal:a.a.Orientation.Vertical),i===D.Calendar_Week||i===D.Calendar_Month?(this.minWidthFlex=700,this.maxWidthFlex=1200,this.maxWidthSingle=1600,this.minWidth=600,this.maxWidth=1600):(this.minWidth=a.a.StdPaneWidthMin,this.minWidthFlex=a.a.StdPaneWidthMin,this.maxWidth=a.a.PaneWidthMax,this.maxWidthFlex=this.maxWidthSingle=a.a.StdPaneWidthMax),this.dateInMiddle=this._getDateInMiddle(),n.default.PaneManager.updatePaneRects()}},{key:"getPaneClass",value:function(){return"paneTask pane"+((this.isViewCalendar()?"Calendar":this.isViewAgenda()&&"Agenda")||this.isViewProject()&&"Project"||this.isViewTag()&&"Tag"||this.isViewContact()&&"Contact"||this.isViewPriority()&&"Priority"||this.isViewOutline()&&"Outline")}},{key:"onScroll",value:function(){this.getViewMode();this.isViewCalendarHoriz()&&(clearTimeout(this._timeoutUpdateAllDay),this._timeoutUpdateAllDay=setTimeout(this.updateAllDay,50))}},{key:"_handleDragOverPane",value:function(t,e,i,a,o,u,s){if(t&&r.default.findParent(i,"paneContent")&&!r.default.hasClass(i,"paneContent")&&!r.default.hasClass(i,"paneTopBox")&&o&&"blockHeader"===o.type&&(this.isViewAgenda()&&t.supportDates||this.isViewAutoBlocks())){var h,d=r.default.getListCellForElement(i);return d&&d.props.cell&&(h=d.props.cell.paneObject.block,this.isViewAgenda()&&h.isOverdue&&(h=void 0)),this.dragHoveredBlock.set(h),n.default.DragDrop.setBlockTarget(h),{block:h}}if(!o||"blockItem"===o.type)return this.dragHoveredBlock.set(void 0),this.isViewCalendar()||n.default.DragDrop.setBlockTarget(void 0),this._handleDragOverTasks(t,e,i,a,o,u,s)}},{key:"_handleDragOverTasks",value:function(t,e,i,n,o,u,s){var h,d,c,v,y,g,l=!1,p=a.a.DragDropPosition.Below,m=!1,f=0;if(o){h=o.item,g=o.index,h.isNote()&&(g--,o=this.objectAtIndex(g),n=this.elementAtIndex(g),h=h.parent()),h.hasNote()&&(f=this.sizeOfItem(h.getNote(),g+1));var k=n.getBoundingClientRect(),A=k.height+f;if(L.a.isMobile)p=s<k.top+A/2?a.a.DragDropPosition.Above:a.a.DragDropPosition.Below;else p=this.isSearchedFlat()&&this.search.isFlatSearchResult(h)||this.isViewAgenda()||this.isViewAutoBlocks()?a.a.DragDropPosition.On:s<k.top+.38*A&&(!this.isViewProject()||0!==o.levelsDeep)?a.a.DragDropPosition.Above:s>k.top+.62*A?a.a.DragDropPosition.Below:a.a.DragDropPosition.On;c=n,l=!0}else if(0===this.numItems())h=this.getItem(),m=!0;else if(L.a.isMobile||!this.isSearchedFlat()&&r.default.findParent(i,"paneScroller")&&!this.isViewProject()){var S=this.indexOfLastItem();if(!l&&S>=0&&this.isIndexMounted(S))if(s>=(y=this.elementAtIndex(S)).getBoundingClientRect().bottom)h=this.getLastItem(),o=this.getLastObject(),c=y,p=a.a.DragDropPosition.Below,l=!0}else h=this.getItem(),m=!0,v=!0;if(!l&&!this.isSearchedFlat()){var w=this&&this.indexOfFirstItem();if(this&&w>=0&&this.isIndexMounted(w))if(s<(y=this.elementAtIndex(w)).getBoundingClientRect().top)h=this.getFirstItem(),o=this.getFirstObject(),c=y,p=this.isViewProject()&&0===o.levelsDeep?a.a.DragDropPosition.On:a.a.DragDropPosition.Above,l=!0}if(l){var F=c.getBoundingClientRect(),C=p!==a.a.DragDropPosition.Below?F.top:F.top+F.height+f,I=p===a.a.DragDropPosition.On?F.height:void 0;if(C>this.contentTop()){var P;p===a.a.DragDropPosition.Below&&g+1<this.numItems()&&h.hasChildren()&&((P=this.objectAtIndex(g+1)).item||(P=void 0)),P=P||o;var N=this.getPaddingForPaneObject(P);d={left:F.left+N,top:C,width:F.right-F.left-N,height:I}}}return this.scrollFromMousePosition(u,s,this.orientation.get()===a.a.Orientation.Horizontal),{position:p,targetElement:c,targetItem:h,linePosition:d,overview:!1,dropOnPane:m,atEnd:v}}},{key:"handleDragDrop",value:function(t,i,r,a){n.default.DragDrop.blockTarget?(n.default.DragDrop.startPane.applyDropOnBlock(n.default.DragDrop.blockTarget,t,this,i.dataTransfer.block),this.revertDrag()):this.isViewAutoBlocks()||A()(y()(e.prototype),"handleDragDrop",this).call(this,t,i,r,a)}},{key:"revertDrag",value:function(){A()(y()(e.prototype),"revertDrag",this).call(this),this.dragHoveredBlock.get()&&this.dragHoveredBlock.set(null)}},{key:"getSaveInfo",value:function(){var t=A()(y()(e.prototype),"getSaveInfo",this).call(this);return t.viewState=this.viewState.get(),t.displayCalendars=this.displayCalendars.get(),t.displayLocalItems=this.displayLocalItems.get(),t.blocksCollapsed=this.blocksCollapsed,t}},{key:"isBlockCollapsed",value:function(t){return t.item?t.item.isCollapsed(this):!0===this.blocksCollapsed[t.id]}},{key:"setBlockCollapsed",value:function(t,e){m.a.reset(),this.blocksCollapsed[t.id]=e,this.hasCollapsedObs.set(this.hasCollapsed()),this.updateBlockItems(),n.default.PaneManager.savePaneState()}},{key:"onInfiniteListLoaded",value:function(){!this.initialOffset&&this.isViewCalendar()&&(this.initialOffset=this.getScrollOffsetOfToday()||0,this._infiniteList.setInitialScrollOffset(this.initialOffset))}},{key:"addProject",value:function(t,e,i){return this.addItemWithPrefix(t,a.a.Prefix.Header,e,i)}},{key:"addItemWithPrefix",value:function(t,e,i,r){t=t||0,n.default.PaneUpdateBatcher.beginUpdateItems(),m.a.reset(),this.setIgnoreRestoreScroll();var o=r?this.getRootItem():this.getItem(),u=(e?e+" ":"")+(i||""),s=n.default.settings.getDefaultItemText(),h=o.addItemAtIndex({text:u},t,this);this.isViewProject()&&e===a.a.Prefix.Header&&h.addItemAtIndex({text:s},t,this),n.default.PaneUpdateBatcher.commitUpdateItems();var d=this.indexOfItem(h);return this.scrollIndexIntoView(d),m.a.selectIndex(d,u.length),h}},{key:"setDisplayLocal",value:function(t){this.displayLocalItems.set(t),this.updateItems()}},{key:"setDisplayCalendar",value:function(t,e){var i=r.default.clone(this.displayCalendars.get());i[t.id]=e,this.displayCalendars.set(i),this.updateItems()}},{key:"getCollapsedDefault",value:function(t,e,i){return e?t.parent()!==this.getRootItem():(i=i||this.getViewMode(),!(this.isViewOutline()||this.isViewProject()&&t.isPrefixHeader()&&this.isItemTopLevel(void 0,t)))}},{key:"getWidth",value:function(){var t=A()(y()(e.prototype),"getWidth",this).call(this);return this.isViewCalendar()&&!this.isViewCalendarMonth()&&(t-=50),t}},{key:"getMonthStart",value:function(t){return t.clone().clearTime().addDays(1-t.getDate())}},{key:"getWeekStart",value:function(t){return t.clone().clearTime().addDays(-t.getDay()+n.default.settings.dayWeekStart.get())}},{key:"doesWeekCrossMonth",value:function(t){if(t.clone().addDays(6).getDate()<t.getDate())return!0}},{key:"updateCalendarMonth",value:function(){var t,e,i,r=0,n=0,o=[],u=this.dateInMiddle,s=this.getWeekStart(u),h=a.a.CalendarMonthViewNumWeeksPad;for(i=-1;o.length<h;i--){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;t=s.clone().addWeeks(i),e=this.doesWeekCrossMonth(t),o.splice(0,0,this.updateCalendarMonthWeek(t,!1,e)),e&&o.length<h&&o.splice(0,0,this.updateCalendarMonthWeek(t,!0,!1))}for(h=2*a.a.CalendarMonthViewNumWeeksPad+1,i=0;o.length<h;i++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t=s.clone().addWeeks(i),(e=this.doesWeekCrossMonth(t))&&o.length<h&&o.push(this.updateCalendarMonthWeek(t,!0,!1)),o.push(this.updateCalendarMonthWeek(t,!1,e))}this.items.set(o)}},{key:"updateCalendarMonthWeek",value:function(t,e,i){for(var r,a,n=0,o=[],u=1===t.getDate(),s=0;s<7;s++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var h=t.clone().addDays(s);r&&h.getDate()<r.getDate()&&(u=!0),!u&&i||u&&e||(o[s]={date:h,items:this.getItemsOnDate(h)},a||(a=h)),r=h}return new z.a({type:"calendarWeek",id:"week_"+t+(e?"_end":""),date:a,dates:o,sizeInPane:this.heightWeek()})}},{key:"heightWeek",value:function(){return a.a.CalendarMonthViewWeekHeight}},{key:"updateCalendarWeek",value:function(){for(var t=0,e=[],i=a.a.CalendarDayViewNumDaysPad,r=this.dateInMiddle,n=this.getViewMode(),o=-i;o<i;o++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var u=r.clone().addDays(o),s=(this._getKeyForDate(u),this.getItemsOnDate(u));e.push(new z.a({type:"calendarDay",id:n+"_day_"+(o+i),date:u,items:s,sizeInPane:this.getDayWidth}))}this.items.set(e)}},{key:"getItemPlacementOnDate",value:function(t,e){var i=!t.getDate(),r=t.getNextDate(e),n=t.getDuration()&&r&&t.getEndDate();if(r&&r.hasTimeOfDay()&&(i||r.isSameDay(e))){var o=r.getHours()+r.getMinutes()/60,u=t.getDuration()?t.getDuration()/a.a.MSPerHour:1;if(u=Math.round(10*Math.min(u,24-r.getHours()))/10,o>0||u<24)return{time:o,duration:u}}else if(r&&r.hasTimeOfDay()&&n&&!r.isSameDay(e)&&n.isSameDay(e)){return{time:0,duration:n.getHours()+n.getMinutes()/60}}return!1}},{key:"updateAllDay",value:function(){if(!this._destroyed){for(var t=0,e=this.indexOfTop(),i=this.inViewCount(),r=1,a=e;a<e+i;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=this.items.get()[a];if(n){for(var o=0,u=0,s=n.items||[],h=0;h<s.length;h++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var d=s[h];this.getItemPlacementOnDate(d,n.date)||u++}u>r&&(r=u)}}this.numAllDay.set(r)}}},{key:"getContentHeight",value:function(){return 1224+this.getHeightAllDay()+2}},{key:"getHeightAllDay",value:function(){return Math.min(a.a.CalendarDayViewMaxAllDayHeight,26*this.numAllDay.get())+1}},{key:"getDayViewY",value:function(){return 409}},{key:"getDayWidth",value:function(){var t=this.getWidth(),e=this.getViewMode(),i=(e===D.Calendar_Day?1:e===D.Calendar_Week&&7)||e===D.Calendar_Custom&&n.default.settings.calendarCustomDays.get();return Math.max(t/i,40)}},{key:"getPaddingForPaneObject",value:function(t,i){var r=A()(y()(e.prototype),"getPaddingForPaneObject",this).call(this,t,i);return i||(r+=this.extraPaddingForPaneObject(t)),r}},{key:"extraPaddingForPaneObject",value:function(t){return this.isViewAgenda()?a.a.PaddingAgendaTime:0}},{key:"shouldShowTime",value:function(t){var e="blockItem"===t.type&&t.item;return e&&!e.isNote()&&0===t.levelsDeep&&t.block&&t.block.shouldShowTime()}},{key:"isSearchedFlat",value:function(){return this._isSearchedFlat}},{key:"isItemTopLevel",value:function(t,i){var r=!0;if(this.isViewProject()){if(t)return t.isBlockHeader;r=i.isPrefixHeader(this)}return this.isViewProject()&&this.search.showChildProjects()||(r=A()(y()(e.prototype),"isItemTopLevel",this).call(this,t,i)),r}},{key:"openViewMenu",value:function(t){n.default.menus.openContextMenu({componentName:"ReactContextMenuPanes",element:t.target,pane:this,positionOffset:{left:45},subset:a.a.PaneMode.Task})}},{key:"hasCollapsed",value:function(t){if(!t&&this.isViewAutoBlocks()){for(var i=0,r=0;this.blocks&&r<this.blocks.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(this.isBlockCollapsed(this.blocks[r]))return!0}return!1}return A()(y()(e.prototype),"hasCollapsed",this).call(this,t)}},{key:"toggleCollapseAll",value:function(){var t=!this.hasCollapsed();if(this.isViewAutoBlocks()){for(var i=0,r=0;r<this.blocks.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this.blocksCollapsed[this.blocks[r].id]=t}t||(t=void 0)}A()(y()(e.prototype),"collapseAll",this).call(this,this.item.get(),t,void 0,this.isViewAutoBlocks())}},{key:"supportsSortBlocks",value:function(t){return t=t||this.getViewMode(),e.viewModeSupportsSortBlocks(t)}},{key:"supportsSortBlocksMode",value:function(t,i){return i=i||this.getViewMode(),e.viewModeSupportsSortBlocksMode(t,i)}},{key:"supportsSortItems",value:function(t){return t=t||this.getViewMode(),e.viewModeSupportsSortItems(t)||this.isViewOutline()&&this.isSearchedFlat()}},{key:"getSortModeBlocks",value:function(){if(this.supportsSortBlocks())return this.viewState.get().sortModeBlocks.mode}},{key:"getSortOrderBlocks",value:function(){if(this.supportsSortBlocks())return this.viewState.get().sortModeBlocks.order||1}},{key:"isSortedBlocks",value:function(){var t=this.getSortModeBlocks();return t&&t!==V.None}},{key:"setSortModeBlocks",value:function(t,e,i){this.setViewProp("sortModeBlocks",{mode:t,order:e},i)}},{key:"getSortModeItems",value:function(){if(this.supportsSortItems())return this.viewState.get().sortModeItems.mode}},{key:"getSortOrderItems",value:function(){if(this.supportsSortItems())return this.viewState.get().sortModeItems.order||1}},{key:"setSortModeItems",value:function(t,e,i){this.setViewProp("sortModeItems",{mode:t,order:e},i)}},{key:"isSortedItems",value:function(){var t=this.getSortModeItems();return t&&t!==V.None}},{key:"getViewMode",value:function(){return this.viewState.get().viewMode}},{key:"setViewMode",value:function(t){this.setViewProp("viewMode",t)}},{key:"setViewProp",value:function(t,e,i){var r=this.viewState.get();r[t]!==e&&(r[t]=e,this.viewState.set(r,!1!==i))}},{key:"createVMLI",value:function(t,i){var r=this.search.getTags();if(!this.isViewTag()&&r)for(var a=0,n=0;n<r.length;n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=r[n],u="#"+o;if(t.text.indexOf(u)<0){for(var s=0,h=!1,d=i&&i.parent;d;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var c=d.getTags();if(c&&c.indexOf(o)>=0){h=!0;break}d=d.parent()}h||(t.text+=" "+u)}}return A()(y()(e.prototype),"createVMLI",this).call(this,t,i)}},{key:"getItemDisplayTime",value:function(t){var e=this.getSortModeBlocks(),i=t.item;return e===V.Date?i.getTime()||(t.showAllDay?"All day":""):e===V.Created?i._formatDateTime(i.dateCreated):e===V.Completed?i.dateCompleted?i._formatDateTime(i.dateCompleted):"no time":void 0}},{key:"checkFlatListMode",value:function(){var t=this.getViewMode();t===D.List_Flat&&0===this.search.getFilterValue("showOnlyMatches")&&this.setViewMode(D.Outline),t===D.Outline&&1===this.search.getFilterValue("showOnlyMatches")&&this.setViewMode(D.List_Flat)}},{key:"onCalendarCustomDaysChanged",value:function(){this.getViewMode()===D.Calendar_Custom&&this.onViewStateChanged()}},{key:"switchToOutline",value:function(){this.setViewMode(D.Outline)}},{key:"shouldRenderPrefix",value:function(t){return t.item.hasPrefix()&&!(this.isViewProject()&&t.isBlockHeader)}},{key:"bottomListMessage",value:function(){var t;if(!(this.numItems()>0)){var e=this.search.numUnmatchedItems();e&&(t=this.isSearched()?e+" items hidden by search / filters. Click the search box above to clear your search / filters, or click to add new items.":e+" completed items hidden by filter. Click the search box above and click the checkbox filter to show completed items.")}return{text:t,clickable:!1}}},{key:"needsUpdateForDate",value:function(t){return this.isViewDates()}},{key:"_anyTagHasKey",value:function(t){return t&&t.some(function(t){return n.default.timeline.getDateForKey("#"+t)})}},{key:"needsUpdateForTags",value:function(t,e){return this.isViewAgenda()&&this._anyTagHasKey(e)}},{key:"handleItemChanged",value:function(t,i){var r=!1;return i[a.a.ItemProp.Text]&&(this.isViewTag()||this.isViewContact())&&(r=!0),A()(y()(e.prototype),"handleItemChanged",this).call(this,t,i,r)}}],[{key:"viewModeSupportsSortBlocks",value:function(t){return!!T[t]}},{key:"viewModeSupportsSortBlocksMode",value:function(t,e){return T[e]&&T[e].Available.indexOf(t)>=0}},{key:"viewModeSupportsSortItems",value:function(t){return t===D.Groups_Project||t===D.Groups_Tag||t===D.Groups_Contact||t===D.Groups_Priority}}]),e}(p.a),j=i(33),Y=a.a.TaskViewMode;function X(){this._inactivePaneTypes={},this.activePaneTypes=new j.a,this._registeredTypes={},this.numInactivePanes=new N.a(0),this.registerPaneType(void 0,a.a.PaneMode.Task,"Task",q,"icon-align-left",99),this.registerPaneType(void 0,a.a.PaneMode.Archived,"Archived",f,"icon-inbox",90)}X.prototype={paneSortCompare:function(t,e){return t.priority<e.priority?1:-1},registerPaneType:function(t,e,i,r,a,n){this._registeredTypes[e]={plugin:t,constructor:r};var o={type:e,name:i,icon:a,text:i,priority:n,tooltip:"Add "+i+" Pane"};!t||t.isActive()?this.activePaneTypes.insertSorted(o,this.paneSortCompare):(this._inactivePaneTypes[e]=o,this.numInactivePanes.set(this.numInactivePanes.get()+1))},activatePaneType:function(t){var e=this._inactivePaneTypes[t];try{r.default.PAssert(734,e,"Must have previously registered pane type")}catch(i){r.default.reportError(i)}this._inactivePaneTypes[t]=void 0,this.activePaneTypes.insertSorted(e,this.paneSortCompare),this.numInactivePanes.set(this.numInactivePanes.get()-1)},deactivatePaneType:function(t){var e=this.activePaneTypes.get().find(function(e){return e.type===t});this.activePaneTypes.remove(function(e){return e.type===t});try{r.default.PAssert(735,e,"Must have previously activated pane type")}catch(i){r.default.reportError(i)}n.default.PaneManager.removePanesByType(t),this._inactivePaneTypes[t]=e,this.numInactivePanes.set(this.numInactivePanes.get()+1)},canCreatePane:function(t){var e=this._registeredTypes[t];return!(e.plugin&&(!e.plugin.isActive()||e.plugin.isPluginBlocked()))},createPane:function(t,e){(e=e||{}).id||(e.id=n.default.PaneManager.getNextPaneID()),"PaneTimeline"===t?(t=a.a.PaneMode.Task,e.viewState={viewMode:Y.Agenda_All}):"PaneOutline"===t&&(t=a.a.PaneMode.Task,e.viewState={viewMode:Y.Outline});var i=this._registeredTypes[t];if(i){if(!i.plugin||i.plugin.isActive()&&!i.plugin.isPluginBlocked())try{n.default.PaneUpdateBatcher.beginUpdateItems();var o=new i.constructor(e);return n.default.PaneUpdateBatcher.commitUpdateItems(),o}catch(u){return void r.default.reportError(u)}}else try{r.default.PAssert(736,!1,"Invalid pane type requested")}catch(s){r.default.reportError(s)}},isPaneTypeActive:function(t){var e=!!this._registeredTypes[t],i=!!this._inactivePaneTypes[t];return e&&!i},getRegisteredPanes:function(){return this.activePaneTypes.get()},_getTaskView:function(t,e,i,r){for(var o=0,u=[],s=0;s<i.length;s++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var h=i[s],d=a.a.TaskViewModeText[h];h===Y.Calendar_Custom&&(d=d.replace("#",n.default.settings.calendarCustomDays.get())),u.push({text:d,type:a.a.PaneMode.Task,viewMode:h,icon:a.a.TaskViewModeIcon[h],premium:!!a.a.TaskViewModesPremium[h],canZoom:!0})}t.push({text:e,viewModes:u,border:!r})},getAvailablePanes:function(t){var e=this.activePaneTypes.get(),i=this.numInactivePanes.get(),r=[];if(this._getTaskView(r,"List",[Y.Outline,Y.List_Flat]),this._getTaskView(r,"Grouped by",[Y.Groups_Project,Y.Groups_Tag,Y.Groups_Contact,Y.Groups_Priority]),this._getTaskView(r,"Agenda",[Y.Agenda_Today,Y.Agenda_Week,Y.Agenda_All]),this._getTaskView(r,"Calendar",[Y.Calendar_Day,Y.Calendar_Custom,Y.Calendar_Week,Y.Calendar_Month],t),!t){for(var n=0,o=0;o<e.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=e[o];if(u.type!==a.a.PaneMode.Task){var s=u.type===a.a.PaneMode.Gmail;r.push({text:u.text,type:u.type,icon:u.icon,canZoom:s,border:!0})}}r[r.length-1].border=!1,i>0&&r.push({enableMore:!0})}return r}};e.a=new X},,function(t,e,i){"use strict";var r=i(66),a=i.n(r),n=i(75),o=i.n(n),u=i(7),s=i.n(u),h=i(8),d=i.n(h),c=i(17),v=i.n(c),y=i(9),g=i.n(y),l=i(18),p=i.n(l),m=i(0),f=i(2),k=i.n(f),A=i(71),S=i.n(A),w=i(3),L=i(20),F=function(t){function e(){return s()(this,e),v()(this,g()(e).apply(this,arguments))}return p()(e,t),d()(e,[{key:"init",value:function(){this.createObservables({ripples:[]}),this.rippleNum=0}},{key:"onMount",value:function(){w.a.isMobile&&this.props.onClick&&m.default.setupClick(this.refs.element,this,{onStart:this.onTapStart,onClick:this.onTapClick})}},{key:"getElement",value:function(){return S.a.findDOMNode(this)}},{key:"onMouseDown",value:function(t){var e=this.props;if(!1!==e.enabled){if(this.props.onMouseDown&&this.props.onMouseDown(t),this.props.children&&!t.defaultPrevented&&!1!==e.ripple){var i,r,a=this.refs.element,n=a.offsetWidth,o=a.offsetHeight,u=Math.min(n,o);if(this.props.center)i="50%",r="50%";else{var s=m.default.offset(a);i=t.clientX-s.left,r=t.clientY-s.top}var h={id:this.rippleNum++,left:i,top:r,width:u,height:u};this.ripples.push(h),setTimeout(this.removeRipple,1e3)}t.stopPropagation()}}},{key:"onRightClick",value:function(t){t.preventDefault(),t.stopPropagation(),this.props.onRightClick(t)}},{key:"onTapStart",value:function(t){!1===this.props.enabled||m.default.findParent(t.target,"fancyInput")||(this.onMouseDown(t),t.stopPropagation())}},{key:"onTapClick",value:function(t){!1===this.props.enabled||m.default.findParent(t.target,"fancyInput")||(this.props.onClick(t),t.preventDefault(),t.stopPropagation())}},{key:"removeRipple",value:function(){this.ripples.removeAt(0)}},{key:"render",value:function(){for(var t=0,e=this.state,i=this.props,r=[],n=0;n<e.ripples.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var u=e.ripples[n],s={left:u.left,top:u.top,width:u.width,height:u.height,marginLeft:-u.width/2,marginTop:-u.height/2};r.push(k.a.createElement("div",{key:"ripple_"+u.id,className:"fancyRipple",style:s}))}var h=m.default.classNames(this.props.className,"fancyRippler",{rippleCenter:this.props.center}),d=(i.center,i.onClick),c=(i.enabled,i.ripple,i.onRightClick),v=o()(i,["center","onClick","enabled","ripple","onRightClick"]);return k.a.createElement("div",a()({},v,{className:h,onMouseDown:this.onMouseDown,onClick:d,onContextMenu:c?this.onRightClick:void 0,ref:"element"}),this.props.children,r.length>0&&k.a.createElement("div",{className:"fancyRipples"},r))}}]),e}(L.a);e.a=F},function(t,e,i){"use strict";var r=i(7),a=i.n(r);e.a=function t(e){var i=this;a()(this,t),Object.keys(e).forEach(function(t){return i[t]=e[t]})}},function(t,e,i){"use strict";var r=i(66),a=i.n(r),n=i(75),o=i.n(n),u=i(7),s=i.n(u),h=i(8),d=i.n(h),c=i(17),v=i.n(c),y=i(9),g=i.n(y),l=i(18),p=i.n(l),m=i(0),f=i(1),k=i(3),A=i(2),S=i.n(A),w=i(20),L=function(t){function e(){return s()(this,e),v()(this,g()(e).apply(this,arguments))}return p()(e,t),d()(e,[{key:"init",value:function(){var t=this.props;this.thumbExtraHeight=0;try{m.default.PAssert(1231,!(t.noOwnScroll&&t.onScroll),"FancyScroller can not have onScroll prop if it does not own its own scroll")}catch(i){m.default.reportError(i)}if(!k.a.isMobile){var e={isVisible:!1,isDragging:!1,thumbTop:0,thumbHeight:0};this.props.trackHasScrolled&&(e.hasScrolled=!1),this.createObservables(e)}}},{key:"onMount",value:function(){this.refs.thumb&&m.default.setupClick(this.refs.thumb,this,{onStart:this.onTapThumbStart,onMove:this.onTapThumbMove,onEnd:this.onTapThumbEnd})}},{key:"onUnmount",value:function(){this.timeoutShow&&(clearTimeout(this.timeoutShow),this.timeoutShow=void 0),this.timeoutHide&&(clearTimeout(this.timeoutHide),this.timeoutHide=void 0)}},{key:"getScrollSize",value:function(){var t=this.props.orientation!==f.a.Orientation.Horizontal?"Height":"Width";return this.props.getScrollSize?this.props.getScrollSize():this.refs.scroller["scroll"+t]}},{key:"getClientHeight",value:function(){var t=this.props.orientation!==f.a.Orientation.Horizontal?"Height":"Width";return this.props.getClientHeight?this.props.getClientHeight():this.refs.scroller["client"+t]}},{key:"getScrollTop",value:function(){var t=this.props.orientation!==f.a.Orientation.Horizontal?"Top":"Left";return this.props.getScrollTop?this.props.getScrollTop():this.refs.scroller["scroll"+t]}},{key:"calculateThumb",value:function(){this.props;var t,e=this.getScrollSize(),i=this.getClientHeight(),r=this.getScrollTop(),a=this.props.thumbHeight;(a||(e===i?a=i:(a=i/e*i,this.thumbExtraHeight=a<30?30-a:0,a=Math.floor(Math.max(a,30)))),e===i)?t=0:t=r/(e-i)*(i-a);t=Math.floor(t);var n=a!==this.thumbHeight.get()||t!==this.thumbTop.get();this.thumbHeight.set(a,!1),this.thumbTop.set(t,n)}},{key:"onScroll",value:function(t){this.handleScroll(),this.props.onScroll&&this.props.onScroll(t)}},{key:"handleScroll",value:function(){this.isMouseDown||(this.calculateThumb(),this.isVisible.set(!0),this.hideTimeout()),this.props.trackHasScrolled&&this.hasScrolled.set(this.getScrollTop()>0)}},{key:"onMouseMove",value:function(t){this.timeoutHide&&(clearTimeout(this.timeoutHide),this.timeoutHide=void 0)}},{key:"onMouseEnter",value:function(t){var e=this.refs.scroller;e.scrollHeight>e.clientHeight&&(this.timeoutShow&&clearTimeout(this.timeoutShow),this.timeoutShow=setTimeout(this.showScrollbar,100))}},{key:"onMouseLeave",value:function(t){this.timeoutShow&&(clearTimeout(this.timeoutShow),this.timeoutShow=void 0),this.isMouseDown||this.hideTimeout()}},{key:"onTapThumbStart",value:function(t){t.button===f.a.ButtonCode.Left&&(this.isMouseDown=!0,this.lastY=this.props.orientation===f.a.Orientation.Horizontal?t.clientX:t.clientY,m.default.disableMouseMove=!0,this.isDragging.set(!0)),t.stopPropagation()}},{key:"onTapThumbMove",value:function(t){if(this.isMouseDown){var e=this.refs.scroller,i=this.props.orientation===f.a.Orientation.Horizontal,r=i?t.clientX:t.clientY,a=i?"Left":"Top",n=i?"Width":"Height",o=r-this.lastY;this.lastY=r;var u=m.default.clamp(this.thumbTop.get()+o,0,e["client"+n]-this.thumbHeight.get());this.thumbTop.set(u);var s=u/(e["client"+n]-this.thumbExtraHeight)*e["scroll"+n];e["scroll"+a]=s,t.preventDefault()}}},{key:"onTapThumbEnd",value:function(t){this.isMouseDown&&t.button===f.a.ButtonCode.Left&&(this.isMouseDown=!1,m.default.disableMouseMove=!1,this.isDragging.set(!1),this.hideTimeout())}},{key:"hideTimeout",value:function(){this.timeoutHide&&clearTimeout(this.timeoutHide),this.timeoutHide=setTimeout(this.hideScrollbar,500)}},{key:"hideScrollbar",value:function(){this.isVisible.set(!1),this.timeoutHide=void 0}},{key:"showScrollbar",value:function(){this.calculateThumb(),this.isVisible.set(!0),this.timeoutShow=void 0}},{key:"getElement",value:function(){return this.refs.element}},{key:"getScrollElement",value:function(){return k.a.isMobile?this.getElement():this.refs.scroller}},{key:"scrollTo",value:function(t,e,i){isNaN(i)&&(i=f.a.ScrollDuration.Default),m.default.scrollTo(t,e,i,this.refs.scroller)}},{key:"scrollToBottom",value:function(){var t=this.getClientHeight();this.scrollTo(0,t)}},{key:"render",value:function(){var t=this.state,e=this.props,i=(e.getScrollSize,e.getClientHeight,e.getScrollTop,e.noOwnScroll),r=e.showScrollbars,n=(e.trackHasScrolled,e.scrollable),u=(e.orientation,e.tinyMode),s=(e.onScroll,o()(e,["getScrollSize","getClientHeight","getScrollTop","noOwnScroll","showScrollbars","trackHasScrolled","scrollable","orientation","tinyMode","onScroll"])),h=e.orientation===f.a.Orientation.Horizontal,d=!1!==n&&!m.default.noScrollbars,c=m.default.classNames("fancyScroller",e.className,{flexbox:!k.a.isMobile},{"flexvert horizontal":h},{vertical:!h},{trackHasScrolled:e.trackHasScrolled},{scrolled:t.hasScrolled},{tinyMode:u}),v=m.default.classNames("fancyScrollbar",{"visible c-border":t.isVisible},{dragging:t.isDragging}),y=m.default.classNames("fancyScrollbarThumb c-bg-scrollthumb",{dragging:t.isDragging}),g={};h?(g.width=t.thumbHeight,g[k.a.transform.react]="translate3d("+t.thumbTop+"px,0,0)"):(g.height=t.thumbHeight,g[k.a.transform.react]="translate3d(0,"+t.thumbTop+"px,0)");var l=m.default.classNames("fancyScrollContent",{hideScrollbar:void 0!==e.showScrollbars},{scrollable:d}),p={};return p[e.orientation===f.a.Orientation.Horizontal?"overflowX":"overflowY"]="auto",k.a.isMobile?S.a.createElement("div",a()({},s,{className:c,ref:"element","data-moo-id":this.getUniqueID()}),e.children):S.a.createElement("div",a()({},s,{className:c,ref:"element"}),S.a.createElement("div",{className:l,style:p,ref:"scroller",onScroll:i?void 0:this.onScroll,"data-moo-id":this.getUniqueID()},e.children),!k.a.isFirefox&&d&&r&&S.a.createElement("div",{className:v,ref:"scrollbar",onMouseMove:this.onMouseMove,onMouseEnter:this.props.tinyMode?void 0:this.onMouseEnter,onMouseLeave:this.props.tinyMode?void 0:this.onMouseLeave},S.a.createElement("div",{className:y,style:g,ref:"thumb"})))}}]),e}(w.a);e.a=L},function(t,e,i){"use strict";var r,a=i(7),n=i.n(a),o=i(8),u=i.n(o),s=i(17),h=i.n(s),d=i(9),c=i.n(d),v=i(18),y=i.n(v),g=i(15),l=i.n(g),p=i(0),m=i(10),f=i(16),k=(r=function(t){function e(t,i,r){var a,o=0;n()(this,e),(a=h()(this,c()(e).call(this,void 0,r)))._destroyed=!1;for(var u=0;u<t.length;u++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;t[u].listen(a.onChanged)}return a._observables=t,i&&p.default.isFunction(i)?a.checkFn=i:a.checkFn="or"===i?a.checkFnOr:a.checkFnAnd,a._value=a.checkFn(),a}return y()(e,t),u()(e,[{key:"checkFnOr",value:function(){for(var t=0,e=!1,i=0;!e&&i<this._observables.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e=e||this._observables[i].get()}return e}},{key:"checkFnAnd",value:function(){for(var t=0,e=!0,i=0;e&&i<this._observables.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e=e&&this._observables[i].get()}return e}},{key:"onChanged",value:function(t,e,i){var r=this._value,a=this.checkFn();(a!==r||i)&&this.set(a,i)}},{key:"destroy",value:function(){var t=0;this._destroyed=!0;for(var e=0;e<this._observables.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this._observables[e].unlisten(this.onChanged)}}}]),e}(m.a),l()(r.prototype,"onChanged",[f.a],Object.getOwnPropertyDescriptor(r.prototype,"onChanged"),r.prototype),r);e.a=k},,,,,,,function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(15),s=i.n(u),h=i(0),d=i(19),c=i(1),v=i(4),y=i(14),g=i(6),l=i(3),p=i(10),m=i(17),f=i.n(m),k=i(9),A=i.n(k),S=i(18),w=i.n(S),L=i(33),F=i(5),C=i(55),I=function(){function t(){a()(this,t),this.isLive=!1,this.wasLive=!1,this.seenInPass=!1,this.deadNeedsNotify=!1,this.index=-1,this.width=0,this.height=0,this.offset=0,this.paneObject=void 0,this.cellChanged=new C.a,this.offsetX=new p.a(0),this.isAnimatingOffsetX=!1}return o()(t,[{key:"kill",value:function(t){this.isLive=!1,this.index=-1,this.isAnimatingOffsetX=!1,t?(this.deadNeedsNotify=!1,this.cellChanged.notify()):this.deadNeedsNotify=!0}},{key:"update",value:function(t,e,i,r,a,n){this.seenInPass=!0,this.wasLive=this.isLive,this.deadNeedsNotify=!1,this.isAnimatingOffsetX=!1,this.isLive&&t===this.index&&e===this.width&&i===this.height&&r===this.offset&&n===this.paneObject||(this.isLive=!0,this.index=t,this.width=e,this.height=i,this.paneObject=n,this.offset=r,this.prevOffset=a,this.cellChanged.notify())}},{key:"getState",value:function(){return{item:this.paneObject&&this.paneObject.id,index:this.index,height:this.height,offset:this.offset,prevOffset:this.prevOffset,deadNeedsNotify:this.deadNeedsNotify,isLive:this.isLive}}}]),t}(),P=i(68),N=i(21),H={None:0,OnScroll:1},M=function(t){function e(t){var i;return a()(this,e),(i=f()(this,A()(e).call(this)))._pane=t.pane,i._isOverview=t.isOverview,i._itemsObs=t.itemsObs,i._getItemsList=t.itemsFn,i.getHeight=t.heightFn,i.getWidth=t.widthFn,i.minItemSize=t.minItemSize,i.hasSetHeightOnce=!1,i.scrollHandler=void 0,i._mobilePadBottom=!1,i.contentSize=new p.a(0),i.paddingBottom=new p.a(0),i._timeoutPointerEvents=void 0,i.disablePointerEvents=new p.a(!1),i._direction=c.a.Direction.None,i._scrollTop=0,i._lastProcessedScrollTop=0,i._itemInfoById={},i._savedScrollOfTop={},i._indexOfTop=0,i._inViewCount=0,i._reactList=void 0,i._isMounted=!1,i._panePadding=0,i.useCustomScroller=l.a.useCustomScroller,i.cellsObs=new L.a([]),i.cells=i.cellsObs.get(),i.cellsNew=[],i._tops=[],i.scrollListeners=[],i.offscreenScrollPadding=400,i._phase=H.None,i.init(),i}return w()(e,t),o()(e,[{key:"_validateCells",value:function(){}},{key:"init",value:function(){d.a.binder(this,"_onListChanged","_onSettingChanged","_onResize","_onScroll","_handleScroll","handleItemTextChanged","handleItemNoteSet","_onTimeoutPointerEvents","_computeRenderItemsBatched","_onSetScrollComplete","_onSetScrollCompleteTimeout","_afterSetScrollComplete","reMount","onImageLoaded")}},{key:"getID",value:function(){return this._pane.id+(this._isOverview?"_o":"")}},{key:"notifyInit",value:function(t){this._pane.setIgnoreRestoreScroll();try{h.default.PAssert(1725,!this._isMounted,"Should not initialize a pane twice")}catch(e){h.default.reportError(e)}this.clearCache(),this.allocateCells(),this._onListChanged(),this._isMounted=!0,this._reactList=t,this._listenToItemsList(this._onListChanged),this._pane.rect.listen(this._onResize),v.default.settings.ui.listen(this._onSettingChanged),this._isOverview||(this._pane.topBoxHeight.listen(this._onListChanged),N.a.listen("imageLoaded",this.onImageLoaded))}},{key:"notifyUnmounted",value:function(){d.a.destroy(this),this._isMounted=!1,this.isDelayingMounts=!1,this._unlistenToItemsList(this._onListChanged),this._pane.rect.unlisten(this._onResize),v.default.settings.ui.unlisten(this._onSettingChanged),this._isOverview||(this._pane.topBoxHeight.unlisten(this._onListChanged),N.a.unlisten("imageLoaded",this.onImageLoaded)),clearTimeout(this._timeoutPointerEvents),this._timeoutPointerEvents=void 0,this.removeNativeScrollListener(this._onScroll),this._reactList=void 0,h.default.clearTimeoutOnce("afterScroll"+this.getID()),h.default.clearTimeoutOnce("listSettingChanged_"+this.getID()),l.a.isMobile||this._isOverview||(this._pane=void 0)}},{key:"allocateCells",value:function(){var t=this.cells.length,e=Math.ceil((l.a.windowHeight()+2*this.offscreenScrollPadding)/this.minItemSize())+4;if(e>t){for(var i=0,r=this.cells,a=t;a<e;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=new I;r.push(n)}this.cellsObs.set(r),this.cells=this.cellsObs.get()}}},{key:"setupScroller",value:function(t,e){this.scrollElement=t,l.a.isMobile&&this.useCustomScroller&&this.setupCustomScroller(t,e),this.addNativeScrollListener(this._onScroll),l.a.isMobile&&this.useCustomScroller&&setTimeout(this.refreshScrollListener.bind(this))}},{key:"setupCustomScroller",value:function(t,e){}},{key:"clearItemInfoForItem",value:function(t){var e=this._pane.getPaneObjectsForItem(t),i=this._itemInfoById;if(e)for(var r=0,a=0;a<e.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=e[a];i[n.id]&&(i[n.id].needsUpdate=!0)}}},{key:"handleItemNoteSet",value:function(t){this.clearItemInfoForItem(t.item)}},{key:"handleItemTextChanged",value:function(t){try{h.default.PAssert(1726,!this._isOverview,"Overviews should never listen to text changes")}catch(a){h.default.reportError(a)}var e=this._pane,i=!1;if(e&&e.isViewText())if(e.isItemInPane(t)){var r=this.indexOfItem(t);this.checkHeightChanged(t,r)&&(this.clearItemInfoForItem(t),i=!0)}else this.clearItemInfoForItem(t);return i}},{key:"getElementAtIndex",value:function(t){return this._reactList.getElementAtIndex(t)}},{key:"isIndexMounted",value:function(t){return this._reactList.isIndexMounted(t)}},{key:"hasItems",value:function(){return this._getItemsList().length>0}},{key:"numItems",value:function(){return this._getItemsList().length}},{key:"indexOfTop",value:function(){return this._indexOfTop}},{key:"inViewCount",value:function(){return this._inViewCount}},{key:"objectAtTop",value:function(){var t=this._getItemsList(),e=this.indexOfTop(),i=e>=0&&e<t.length;try{h.default.PAssert(1727,i,"Item at top is not in range",e,t.length)}catch(r){h.default.reportError(r)}return t[e]}},{key:"itemAtTop",value:function(){var t=this.objectAtTop();return t&&(h.default.isVMLI(t)?t:t.item)}},{key:"indexPageUp",value:function(t){for(var e=0,i=this.size.height,r=0,a=t-1;a>=0;--a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if((r+=this._sizes[a])>i)return a+1}return 0}},{key:"indexPageDown",value:function(t){for(var e=0,i=this.size.height,r=0,a=this._sizes.length,n=t;n<a;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if((r+=this._sizes[n])>i)return n}return Math.max(a-1,0)}},{key:"_listenToItemsList",value:function(t){this._itemsObs.listen(t)}},{key:"_unlistenToItemsList",value:function(t){this._itemsObs.unlisten(t)}},{key:"objectAtIndex",value:function(t){var e=this._getItemsList();try{h.default.PAssert(1728,t>=0&&t<e.length,"Invalid item index: "+t,e.length,this._pane.type)}catch(i){h.default.reportError(i)}return e[t]}},{key:"itemAtIndex",value:function(t){var e=this._getItemsList();try{h.default.PAssert(1729,t>=0&&t<e.length,"Invalid item index: "+t,e.length,this._pane.type)}catch(r){h.default.reportError(r)}var i=e[t];return i&&(h.default.isVMLI(i)?i:i.item)}},{key:"sizeAtIndex",value:function(t){return this._pane.sizeAtIndex(t,this._isOverview)}},{key:"addPadding",value:function(){this.useCustomScroller?(this._panePadding=l.a.windowHeight()-2*h.default.topBarHeight,this.refreshScrollListener()):(this._mobilePadBottom=!0,this._computeContentSize(!0))}},{key:"removePadding",value:function(){this._mobilePadBottom=!1,this._computeContentSize(!0)}},{key:"addNativeScrollListener",value:function(t){l.a.addPassiveListener(this.scrollElement,"scroll",t)}},{key:"removeNativeScrollListener",value:function(t){this.scrollElement&&this.scrollElement.removeEventListener("scroll",t)}},{key:"addScrollListener",value:function(t){this.scrollListeners.push(t)}},{key:"removeScrollListener",value:function(t){try{h.default.PAssert(1730,this.hasScrollListener(t),"Removing a listener that does not exist")}catch(e){h.default.reportError(e)}this.scrollListeners.remove(t)}},{key:"hasScrollListener",value:function(t){return this.scrollListeners.indexOf(t)>=0}},{key:"refreshScrollListener",value:function(){}},{key:"getScrollOffset",value:function(){if(this._isMounted){if(this.scrollElement){var t=this._pane.orientation.get()===c.a.Orientation.Vertical?"scrollTop":"scrollLeft";return this.scrollElement[t]}return 0}return 0}},{key:"getScrollSize",value:function(){return Math.max(this.contentSize.get()+(l.a.isMobile||h.default.noPanePadding?0:200),0)}},{key:"getMaxScrollOffset",value:function(){var t=this._pane.orientation.get()===c.a.Orientation.Vertical?this.getHeight():this.getWidth();return Math.max(this.getScrollSize()-t,0)}},{key:"setScrollOffset",value:function(t,e,i){var r=this;try{h.default.PAssert(1731,this.scrollElement,"Pane must have loaded a scrollable element")}catch(d){h.default.reportError(d)}try{h.default.PAssert(1732,h.default.isNumber(t),"Must supply a valid scroll offset")}catch(d){h.default.reportError(d)}if(this.scrollElement&&this._pane){if(this._pane.isFakePane)return;e=e||c.a.ScrollDuration.Snap;var a=this.getScrollOffset(),n=this.getMaxScrollOffset();if(l.a.isMobile&&(n+=l.a.getKBSize()+c.a.KeyboardToolbarHeight),t<0?t=0:t>n&&(t=n),t=Math.floor(t),this._isMounted&&this._scrollingTo!==t){this._scrollingTo=e?t:void 0,this._isSettingScroll=!0;var o,u,s=this._pane.orientation.get()===c.a.Orientation.Vertical;o=s?void 0:t,u=s?t:void 0,h.default.scrollTo(o,u,e,this.scrollElement,function(){r._onSetScrollComplete(),i&&i()})}else h.default.timeoutOnce("setScrollComplete_"+this.getID(),this._onSetScrollComplete,0),i&&i();return t-a}}},{key:"_onSetScrollComplete",value:function(){this._restoringScroll?this._afterSetScrollComplete():h.default.timeoutOnce("scrollCompleteTimeout_"+this.getID(),this._onSetScrollCompleteTimeout,60)}},{key:"_onSetScrollCompleteTimeout",value:function(){this._isMounted&&this.saveScrollOfTop(!0,!0),this._afterSetScrollComplete()}},{key:"_afterSetScrollComplete",value:function(){this._scrollingTo=void 0,this._isSettingScroll=!1}},{key:"_computeContentSize",value:function(t){var e=0,i=this.getPaddingTop(),r=i,a=this._getItemsList(),n=this._pane.getItem().levelsDeep.get();this._sizes=[],this._tops=[];for(var o=0;o<a.length;++o){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var u,s=a[o],d=a[o].item||s,c=h.default.isVMLI(d),v=this._itemInfoById[s.id],y=c?d.levelsDeep.get()-n:void 0;v&&!v.needsUpdate&&v.levelsDeep===y&&void 0===s.sizePad?u=v.size:(u=this.sizeAtIndex(o),v=this._itemInfoById[s.id]={size:u,levelsDeep:y,paneObject:s,needsUpdate:!1}),this._sizes[o]=u,this._tops[o]=o>0?this._tops[o-1]+this._sizes[o-1]:i,v.previousTop=v.top,v.top=this._tops[o],r+=v.size}if(l.a.isMobile){var g=2*this.minItemSize();this._mobilePadBottom&&(g+=l.a.getKBSize()),this.paddingBottom.set(g)}return this.contentSize.set(r,t),this.useCustomScroller&&this.refreshScrollListener(),r}},{key:"flushTimeoutPointerEvents",value:function(){this._timeoutPointerEvents&&(clearTimeout(this._timeoutPointerEvents),this._timeoutPointerEvents=void 0,this._onTimeoutPointerEvents())}},{key:"_onTimeoutPointerEvents",value:function(){this._pane.isDestroyed()||(this.disablePointerEvents.set(!1),this.killAllDeadCells(),this._isSettingScroll||this._wasSettingScroll||this.saveScrollOfTop(),this._scrollingTo=void 0,this._wasSettingScroll=!1)}},{key:"reMount",value:function(){this.isDelayingMounts=!1,this.fireEvent("reMount",[])}},{key:"_onScroll",value:function(t){var e=0;if(!t||!h.default.findParent(t.target,"preventScrollPropagate")){this._restoringScroll&&!this._isSettingScroll||(this._prevScrollTop=this._scrollTop,this._scrollTop=this.getScrollOffset(),this._handleScroll());for(var i=0;i<this.scrollListeners.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.scrollListeners[i](t)}}}},{key:"_handleScroll",value:function(){if(this._phase=H.OnScroll,l.a.isMobile&&l.a.useCustomScroller||F.a.isMouseDown()||(this._prevScrollTop!==this._scrollTop&&this.disablePointerEvents.set(!0),this._timeoutPointerEvents&&clearTimeout(this._timeoutPointerEvents),this._wasSettingScroll=this._isSettingScroll,this._timeoutPointerEvents=setTimeout(this._onTimeoutPointerEvents,50),0===this._scrollTop&&0!==this._prevScrollTop&&this.saveScrollOfTop()),F.a.isMouseDown()||(this.isDelayingMounts=!0,h.default.timeoutOnce("afterScroll"+this.getID(),this.reMount,150)),l.a.isMobile||v.default.tooltip.hideTip(),F.a.hoveredItem&&F.a.setHovered(this,null,null),this._scrollTop!==this._prevScrollTop){this._direction=this._scrollTop>this._prevScrollTop?c.a.Direction.Down:c.a.Direction.Up;var t=Math.abs(this._scrollTop-this._lastProcessedScrollTop);if(this.alwaysRenderScroll||t>=this.offscreenScrollPadding/2)this._lastProcessedScrollTop=this._scrollTop,this._computeRenderItems();else this.updateTopIndex()}this.scrollHandler&&this.scrollHandler(this._scrollTop),this._phase=H.None}},{key:"_updateSize",value:function(){this.size={width:this._pane.getWidth(),height:this._pane.getHeight()}}},{key:"_onListChanged",value:function(){if(this._needsResize)return this._needsResize=!1,void this._onResize(void 0,void 0,!0);this.rect=this._pane.rect.get(),this._updateSize(),this.killAllDeadCells(),this._computeContentSize(!1),this._computeRenderItems(this._isMounted)}},{key:"_onSettingChanged",value:function(){this._needsResize=!0,h.default.timeoutOnce("listSettingChanged_"+this.getID(),this._onResize,0,void 0,void 0,!0)}},{key:"_onResize",value:function(t,e,i){if(!v.default.PaneManager.isResizingPane){h.default.clearTimeoutOnce("listSettingChanged_"+this.getID()),this._needsResize=!1;var r=this.rect?this.rect.width:-1,a=this.rect?this.rect.height:-1;i||t&&(t.width!==r||t.height!==a)?(this.saveScrollOfTop(),this._updateSize(),this.clearCache(),this.allocateCells(),h.default.setItemAnimationMode(c.a.ItemAnimationMode.None),this._onListChanged(),h.default.resetItemAnimationMode(),F.a.getPane()===this._pane&&F.a.updateCaret()):this._updateSize()}}},{key:"saveScrollOfTop",value:function(t,e){this._savedScrollOfTop;if(this.numItems()>0&&(e||!this._pane.isIgnoringRestoreScroll())){for(var i,r,a=0,n=[],o=this.numItems(),u=t?this.getScrollOffset():this._scrollTop,s=this._indexOfTop;s<Math.min(this._indexOfTop+this._inViewCount-1,o);s++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i=this.objectAtIndex(s),(r=u-this.topOfIndex(s))-this._sizes[s]<-this.getPaddingTop()&&n.push({index:s,paneObject:i,scrollOffset:r})}this._savedScrollOfTop.inView=n}}},{key:"restoreScrollOfTop",value:function(){var t=this._savedScrollOfTop;if(!this._pane.isIgnoringRestoreScroll()&&this._pane._didInitialScroll){if(t&&!h.default.isEmpty(t)){var e=t.inView;if(e)for(var i=0,r=0;r<e.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var a=e[r];if(this.restoreScroll(a))break}this._restoringScroll||this._pane.scrollToTop(c.a.ScrollDuration.Snap)}this._restoringScroll=!1}}},{key:"restoreScroll",value:function(t){var e=this.indexOfItem(t.paneObject);if(e>=0){var i=Math.max(this.topOfIndex(e)+(t.scrollOffset||0),0),r=this.getMaxScrollOffset();return i>r&&(i=r),this._restoringScroll=!0,this._scrollTop=i,this.setScrollOffset(i,c.a.ScrollDuration.Snap),h.default.animFrameOnce("restoreScroll_"+this.getID(),function(){this.setScrollOffset(i,c.a.ScrollDuration.Snap)}.bind(this)),!0}return!1}},{key:"clearCache",value:function(){var t=0;this._itemInfoById={};for(var e=0;e<this.cells.length;e++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.cells[e];i.isLive&&(i.width=i.height=void 0)}}},{key:"_isInBounds",value:function(t,e){var i=!1;return t>this._getPVRBottom()+this.offscreenScrollPadding||e<this._getPVRTop()-this.offscreenScrollPadding||(i=!0),i}},{key:"getScrollTop",value:function(){return this._scrollTop}},{key:"_getPVRTop",value:function(){return this._scrollTop}},{key:"_getPVRBottom",value:function(){return this._scrollTop+(this._pane.orientation.get()===c.a.Orientation.Vertical?this.size.height:this.size.width)}},{key:"killAllDeadCells",value:function(){for(var t=0,e=0;e<this.cells.length;e++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.cells[e];!i.isLive&&i.deadNeedsNotify&&i.kill(!0)}}},{key:"_startCellPassOnCell",value:function(t){t.seenInPass=!1}},{key:"startCellPass",value:function(){var t=0;this.cellsCurrent={};for(var e=0;e<this.cells.length;e++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.cells[e];i.isLive&&(this.cellsCurrent[i.paneObject.id]=i,this._startCellPassOnCell(i))}}},{key:"_pruneCellPassOnCell",value:function(t,e){if(!t.seenInPass||e){var i,r=t.index;(this._phase!==H.OnScroll||this._isInBounds(this._tops[r],this._tops[r]+this._sizes[r]))&&(i=!0),t.kill(i)}}},{key:"pruneCellPass",value:function(){for(var t=0,e=0;e<this.cells.length;e++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.cells[e];i.isLive&&this._pruneCellPassOnCell(i)}}},{key:"updateCell",value:function(t){var e=this._pane,i=this._getItemsList()[t],r=i.id,a=this.cellsCurrent[r],n=this._isOverview||this._pane.orientation.get()===c.a.Orientation.Vertical,o=this._sizes[t],u=n?e.getContentWidth():o,s=n?o:e.getContentHeight(),h=this._tops[t],d=this._itemInfoById[r],v=d&&d.previousTop;a&&!a.seenInPass?a.update(t,u,s,h,v,i):!a&&this.cellsNew.indexOfWithProperty("index",t)<0&&this.cellsNew.push({index:t,width:u,height:s,offset:h,paneObject:i,prevOffset:v})}},{key:"_addPassOnCell",value:function(t){for(var e,i=0,r=0;r<this.cells.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(!this.cells[r].isLive){e=this.cells[r];break}}try{h.default.PAssert(1733,e,"Must always have additional cells to use",l.a.windowHeight())}catch(a){h.default.reportError(a)}e||(e=new I,this.cells.push(e)),e.update(t.index,t.width,t.height,t.offset,t.prevOffset,t.paneObject)}},{key:"addCellPass",value:function(){for(var t=0,e=0;e<this.cellsNew.length;e++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.cellsNew[e];this._addPassOnCell(i)}this.cellsNew=[]}},{key:"_isIndexSeen",value:function(t){var e=this._getItemsList()[t].id,i=this.cellsCurrent[e];return i&&i.seenInPass}},{key:"_computeRenderItems",value:function(t){h.default.batchRenderUpdates(this._computeRenderItemsBatched,t)}},{key:"_computeRenderItemsBatched",value:function(t){var e,i,r,a,n=0,o=this._getItemsList(),u=0;this.startCellPass(),t&&this.restoreScrollOfTop();for(var s=0;s<o.length;++s){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;if(e=this._tops[s],i=this._sizes[s],this._isInBounds(e,e+i))isNaN(r)&&e+i>this._getPVRTop()&&(r=s),this.updateCell(s),!isNaN(r)&&Math.round(e)<this._getPVRBottom()-2&&u++;else if(e>this._getPVRBottom())break}isNaN(r)&&(r=0),this._indexOfTop=r,this._inViewCount=u,F.a.isValid()&&(!l.a.isMobile||l.a.isMobile&&h.default.isKeyboardOpen)&&this._pane===F.a.getPane()&&(a=F.a.getStartIndex())<this._sizes.length&&!this._isIndexSeen(a)&&this.updateCell(a),l.a.isMobile&&v.default.DragDrop.isDragging&&(a=this._pane.indexOfItem(v.default.DragDrop.dragItem))>=0&&!this._isIndexSeen(a)&&this.updateCell(a),this.pruneCellPass(),this.addCellPass(),this._isSettingScroll||this._phase===H.OnScroll||this.saveScrollOfTop()}},{key:"updateTopIndex",value:function(){for(var t,e,i=0,r=this._getItemsList(),a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(t=this._tops[a],e=this._sizes[a],this._isInBounds(t,t+e)&&t+e>this._getPVRTop()){this._indexOfTop=a;break}}}},{key:"getItemInfo",value:function(t){return this._itemInfoById[t]}},{key:"getItemInfosForItem",value:function(t){var e=this._itemInfoById,i=[];if(e[t.id])i.push(e[t.id]);else for(var r in this._itemInfoById)e.hasOwnProperty(r)&&e[r].paneObject.item===t&&i.push(e[r]);return i}},{key:"indexOfItem",value:function(t,e,i){for(var r,a=0,n=h.default.isVMLI(t),o=this._getItemsList(),u=0;u<o.length;u++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var s=o[u];if(n){if((s===t||s.item===t)&&(!s.type||"blockItem"===s.type)&&(!e||!s.block||s.block.id===e.id))return u}else{if(s.id===t.id)return u;s.item&&s.item===t.item&&(r||(r=[]),r.push({index:u,item:s}))}}if(r){if(i){var d,c,v=0;for(u=0;u<r.length;u++){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;var y=Math.abs(r[u].index-i);(isNaN(c)||y<d)&&(c=u,d=y)}return r[c].index}return r[0].index}return-1}},{key:"topOfItem",value:function(t){try{h.default.PAssert(1734,t,"Must provide a valid item to measure")}catch(i){h.default.reportError(i)}var e=this.indexOfItem(t);try{h.default.PAssert(1735,e>=0,"Must supply a valid item that is in this pane")}catch(i){h.default.reportError(i)}return this.topOfIndex(e)}},{key:"topOfIndex",value:function(t){try{h.default.PAssert(1736,t>=0,"Must supply a valid index")}catch(e){h.default.reportError(e)}return this._tops[t]}},{key:"scrollIndexToTop",value:function(t,e,i){var r=this.topOfIndex(t),a=this.getScrollOffset();if(r<a||r-a>200)return this.setScrollOffset(r-16,e,i);i&&i()}},{key:"scrollItemToTop",value:function(t,e,i){try{h.default.PAssert(1737,h.default.isVMLI(t),"Must be a valid VMLI instance")}catch(a){h.default.reportError(a)}try{h.default.PAssert(1738,h.default.isNumber(e),"Must have a valid scroll duration")}catch(a){h.default.reportError(a)}var r=this.indexOfItem(t);try{h.default.PAssert(1739,r>=0,"Must supply a valid item that is in this pane")}catch(a){h.default.reportError(a)}return this.scrollIndexToTop(r,e,i)}},{key:"scrollIndexToMiddle",value:function(t,e,i){if(this._isMounted){var r=this.topOfIndex(t),a=this._sizes[t],n=Math.floor(r+a/2-this.getHeight()/2);return this.setScrollOffset(n,e,i)}i&&i()}},{key:"scrollItemToMiddle",value:function(t,e,i){if(this._isMounted){var r=this.indexOfItem(t);if(r>=0)return this.scrollIndexToMiddle(r,e,i)}else i&&i()}},{key:"scrollItemIntoView",value:function(t,e,i){if(this._isMounted){var r=this.indexOfItem(t);return this.scrollIndexIntoView(r,e,i)}i&&i()}},{key:"scrollIndexIntoView",value:function(t,e,i){e=isNaN(e)?c.a.ScrollDuration.Default:e;try{h.default.PAssert(1740,h.default.isNumber(t),"Must supply a valid index")}catch(A){h.default.reportError(A)}try{h.default.PAssert(1741,!i||h.default.isFunction(i),"Must supply a valid callback function")}catch(A){h.default.reportError(A)}var r=this.itemAtIndex(t);try{h.default.PAssert(1742,r,"Item does not exist to scroll to",t,this.numItems())}catch(A){h.default.reportError(A)}if(this._isMounted&&r){var a,n,o,u=l.a.getKBSize(),s=this.topOfIndex(t),d=this.getHeight();l.a.isMobile?a=d-u-c.a.KeyboardToolbarHeight:(a=d,v.default.PaneManager.hasScrollbar()&&(a-=c.a.HorizScrollbarHeight)),o=l.a.isMobile?(n=this.getScrollOffset())+a:(n=this.getScrollOffset())+d;var y=this._sizes[t],g=s+y,p=g>o,m=s<n;m&&y>a&&g>=o&&(m=!1);var f,k=0;return m?f=0===s?0:s:p&&(f=g-a),m||p?(k=f-n,this.setScrollOffset(f,e,function(){i&&setTimeout(i,0)})):i&&i(),k}return!1}},{key:"getPaddingTop",value:function(){return this._isOverview?l.a.isMobile?8:0:this._pane.topBoxHeight.get()+(l.a.isMobile?c.a.PaneHeaderRow2Height:0)}},{key:"notifyDragStart",value:function(){}},{key:"notifyDragEnd",value:function(){}},{key:"notifySwappedIn",value:function(t){isNaN(t)||this.setScrollOffset(t)}},{key:"addScrollDelta",value:function(t){try{h.default.PAssert(1743,this.scrollElement,"Pane must have loaded a scrollable element")}catch(e){h.default.reportError(e)}return this.setScrollOffset(this.getScrollOffset()+t)}},{key:"setScrollHandler",value:function(t){this.scrollHandler=t}},{key:"setInitialScrollOffset",value:function(t){this._scrollTop=t||0}},{key:"checkHeightChanged",value:function(t,e){if(l.a.isMobile&&!l.a.isMobileWeb)return this.clearItemInfoForItem(t),!0;try{var i=this._pane,r=this.objectAtIndex(e),a=t.sizeInPane(i,e,!1)+(r.sizePad||0),n=this.getItemInfosForItem(t);if(n.length>0&&a!==n[0].size)return this.clearItemInfoForItem(t),!0}catch(o){h.default.reportError(o)}}},{key:"onImageLoaded",value:function(t){if(this._pane.isItemInPane(t)){var e=this.indexOfItem(t);(e<0||this.checkHeightChanged(t,e))&&(this._pane.setIgnoreRestoreScroll(),this.clearItemInfoForItem(t),this._pane.setItemsDirty(),v.default.PaneUpdateBatcher.updateAllItems())}}}]),e}(P.a);if(l.a.isMobile)var z=i(44).default;var D,V=function(){function t(e,i,r){a()(this,t),this.pane=e,this.root=e.getRootItem(),this.contentElement=void 0,this._scrollListenerAttached=!1,this.isVisible=new p.a(i),this.isShowingContents=new p.a(r);var n=l.a.isMobile?0:-1;this.transform=new p.a(n),this.cursor=new p.a,this.topItem=void 0,this.dragHoverItem=void 0,this.onTap={onStart:this.onTapStart,onMove:this.onTapMove,onClick:this.onTapClick,onEnd:this.onTapEnd},this._infiniteList=new M({pane:e,isOverview:!0,itemsObs:e.headers,itemsFn:e.getHeaders,widthFn:e.getWidth,heightFn:e.getHeight,minItemSize:this.getMinItemSize}),this.init()}return o()(t,[{key:"init",value:function(){l.a.isMobile?d.a.forceBind("refreshScrollListener",this):(d.a.forceBind("onPaneScroll",this),d.a.forceBind("onPaneItemsUpdated",this),N.a.listen("itemsUpdated",this.onPaneItemsUpdated))}},{key:"destroy",value:function(){this.pane=void 0,l.a.isMobile||N.a.unlisten("itemsUpdated",this.onPaneItemsUpdated),d.a.destroy(this)}},{key:"onPaneLoad",value:function(){!l.a.isMobile&&this.pane.overviewCanTrackScroll&&this.isVisible.get()&&this._attachScrollListener()}},{key:"getInfiniteList",value:function(){return this._infiniteList}},{key:"getContentElement",value:function(){return this.contentElement}},{key:"getScrollOffset",value:function(){this._infiniteList.getScrollOffset()}},{key:"refreshScrollListener",value:function(){this._infiniteList.refreshScrollListener()}},{key:"onTapStart",value:function(t){if(l.a.isMobile&&l.a.useCustomScroller&&t.preventDefault(),!h.default.hasClass(t.target,"overviewList")&&h.default.findParent(t.target,"overviewList")){var e=h.default.getItemForElement(t.target);e&&(v.default.DragDrop.startDragItem=e)}}},{key:"onTapMove",value:function(t){if(!l.a.isMobile){var e=v.default.DragDrop.startDragItem||v.default.DragDrop.dragItem;e&&e.checkDragOnMove(t,!0)}}},{key:"onTapClick",value:function(t){var e,i=this.pane,r=h.default.getItemForElement(t.target),a=h.default.getElementParent(t.target);if(a&&r!==i&&r!==this&&h.default.findParent(t.target,"overviewList")){e=h.default.getPaneObjectForElement(t.target),r=h.default.getItemForElement(t.target);try{h.default.PAssert(1716,r,"Element in overview was text but was not an item")}catch(n){h.default.reportError(n)}}if(r){try{h.default.PAssert(1717,a,"Item must have an overview element: "+(r.getRawText?r.getRawText():"not an item"))}catch(n){h.default.reportError(n)}if(a)t.clientX-h.default.offset(a).left<i.getPaddingForPaneObject(r,!0)?i.setPaneObjectCollapsed(!i.isPaneObjectCollapsed(e,!0),e,!0):h.default.hasClass(t.target,"overviewOptions")?(v.default.menus.openContextMenu({componentName:"ReactContextMenuOverviewOptions",key:"menu"+r.id+t.clientX+t.clientY,element:t.target,item:r,pane:i,pos:{left:t.pageX,top:t.pageY}}),h.default.preventAndStop(t)):this.pane.allowZoom(r)?(l.a.isMobile||!this.pane.canScrollToItem()||l.a.mac&&t.metaKey||!l.a.mac&&t.ctrlKey||!this.pane.isOverviewVisibleInPane(r)?(this.pane.zoomIn(r),z&&z.setOverviewVisibility(this.pane,!1)):this.scrollItemIntoView(r),h.default.sendEvent("Menu","OverviewZoom")):this.pane.performOverviewAction(r)}h.default.preventDefault(t)}},{key:"onTapEnd",value:function(t){if(!l.a.isMobile){var e=v.default.DragDrop.startDragItem||v.default.DragDrop.dragItem;e&&e.checkDragOnEnd(t)}}},{key:"scrollItemIntoView",value:function(t){var e=0;this._disablePaneScrollListener=!0;for(var i=t;i&&i!==this.pane.getItem();){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(this.pane.indexOfItem(i)>=0){this.pane.scrollItemToTop(i,c.a.ScrollDuration.Default);break}i=i.parent()}this.updateTopPaneItem(t),setTimeout(function(){this._disablePaneScrollListener=!1}.bind(this),2*c.a.ScrollDuration.Default)}},{key:"setVisibility",value:function(t){t&&(F.a.reset(),this._infiniteList.setInitialScrollOffset(0)),t!==this.isVisible.get()&&(this.isVisible.set(t),N.a.fireEvent("panesChanged",[]),l.a.isMobile||(v.default.PaneManager.updatePaneStateForPane(this),this.pane.overviewCanTrackScroll&&(t?this._attachScrollListener():this._detachScrollListener()))),l.a.isMobile&&(t&&h.default.isKeyboardOpen&&!h.default.getActiveSearch().isFocused.get()&&h.default.blurActiveElement(),g.e.miscAction({type:g.c.Misc,misc:g.a.ToggleOverview,data:{value:t,pane:this.pane}}),this.pane.onOverviewToggled(t))}},{key:"setShowingContents",value:function(t){this.isShowingContents.set(t),v.default.PaneManager.updatePaneStateForPane(this)}},{key:"_attachScrollListener",value:function(){try{h.default.PAssert(1718,!this._scrollListenerAttached,"Must not double attach scroll listener")}catch(t){h.default.reportError(t)}this._scrollListenerAttached||(this.pane.addScrollListener(this.onPaneScroll),this.onPaneScroll(),this._scrollListenerAttached=!0)}},{key:"_detachScrollListener",value:function(){try{h.default.PAssert(1719,this._scrollListenerAttached,"Must only detach overview listener when already attached")}catch(t){h.default.reportError(t)}this._scrollListenerAttached&&(this.pane.removeScrollListener(this.onPaneScroll),this._scrollListenerAttached=!1)}},{key:"toggleDesktop",value:function(){this.isVisible.get()?this.setVisibility(!1):this.setVisibility(!0),g.e.miscAction({type:g.c.Misc,misc:g.a.ToggleOverview,data:{value:this.isVisible.get(),pane:this.pane}})}},{key:"onPaneScroll",value:function(){if(!this._disablePaneScrollListener){try{h.default.PAssert(1720,this.isVisible.get(),"Should not be tracking scroll if overview is not open")}catch(e){h.default.reportError(e)}var t=this.findTopPaneItem();t&&(this.updateTopPaneItem(t),this._infiniteList.scrollItemToMiddle(t,c.a.ScrollDuration.Default))}}},{key:"findTopPaneItem",value:function(){var t=this.pane;if(this.pane.numItems()>0){for(var e,i,r=0,a=this.pane.indexOfTop();a>=0&&a<t.numItems()&&!i;){var n=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(e=this.pane.itemAtIndex(a);e&&e!==this.root&&!i;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;this._infiniteList.indexOfItem(e)<0?e=e.parent():i=e}i||a++}return!i&&this._infiniteList.numItems()>0&&(i=this._infiniteList.itemAtIndex(0)),i}}},{key:"updateTopPaneItem",value:function(t){var e=this.topItem;this.topItem=t,e&&e.itemChanged.notify(),t.itemChanged.notify()}},{key:"updateDragHoverItem",value:function(t){var e=this.dragHoverItem;this.dragHoverItem=t,e&&e.itemChanged.notify(),t&&t.itemChanged.notify()}},{key:"onPaneItemsUpdated",value:function(t){if(t===this.pane&&this.isVisible.get()&&this.pane.overviewTracksScroll){var e=this.findTopPaneItem();e&&this.updateTopPaneItem(e)}}},{key:"isItemAtTop",value:function(t){return t===this.topItem}},{key:"isItemDragHovered",value:function(t){return t===this.dragHoverItem}},{key:"getMinItemSize",value:function(){return v.default.DisplaySettings.itemLineHeight()+2*v.default.DisplaySettings.itemPadding()}}]),t}(),G=i(89),T=i.n(G),q=i(56),j=i(44),Y=i(51),X=c.a.MatchState,Q=function(){function t(e,i,r){var n=0;a()(this,t),this.callback=r,this.pane=e,this.searchArr=[],this.matches={},this.previousSearch="",this._stickyMatches={},this._stickyMatchesAwaitingClear=[],this.itemStoreFilter=void 0,this._needsBatchedSearch=!1,this.UI=void 0,this.isFocused=new p.a,this._destroyed=!1,d.a.binder(this,"isMatched","checkChildrenParams","hideNonMatches","handleItemTextChanged","update");var o={priority:{name:"priority",matchFn:this._matchFnPriority.bind(this)},starred:{name:"starred",initialValue:1,icon:"icon-star",tooltip:"starred items",matchFn:this._matchFnStarred.bind(this)},project:{name:"project",initialValue:1,icon:"icon-project",tooltip:"projects",matchFn:this._matchFnProject.bind(this)},task:{name:"task",initialValue:1,icon:"prefixTask",tooltip:"tasks",matchFn:this._matchFnTask.bind(this)},complete:{name:"complete",text:"Completed Items",initialValue:-1,defaultValue:-1,icon:"icon-check",tooltip:"completed items",matchFn:this._matchFnComplete.bind(this)},showOnlyMatches:{name:"showOnlyMatches",initialValue:1,icon:"icon-reorder",tooltip:"Flat mode: Show only matching items",canBeNegated:!1,isOption:!0},showOnlyAgendaDates:{name:"showOnlyAgendaDates",initialValue:1,icon:"icon-at",tooltip:"Show only dates on the Agenda",canBeNegated:!1,isOption:!0},showOnlyMatchingTags:{name:"showOnlyMatchingTags",initialValue:1,icon:"icon-short_text",tooltip:"Show only matching tag blocks",canBeNegated:!1,isOption:!0},showChildProjects:{name:"showChildProjects",initialValue:1,icon:"icon-project_half",tooltip:"Show all projects from anywhere in the hierarchy",canBeNegated:!1,isOption:!0}};if(i){!1===i.showHierarchy&&(i.showOnlyMatches=1);var u=i.completeOption;!isNaN(u)&&isNaN(i.complete)&&(i.complete=u<0?1:u-1),0===i.showOnlyTopLevelProjects&&(i.showChildProjects=1)}for(var s=[],c=0;c<e.searchFilters.length;c++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var v=e.searchFilters[c];h.default.isString(v)?s.push(o[v]):s.push(v)}if(this.setupFilters(s,i),this.value=i&&i.text||"",this.onChanged=new C.a(r),this._updateSearchArr(),this.value){var y=q.a.parseText(this.value,Y.a.getContacts(),!0,!0,!0);y&&this.onParsed(y)}}return o()(t,[{key:"destroy",value:function(){this._destroyed=!0,this.onChanged.unlisten(this.callback),this.pane=void 0,this.UI=void 0,d.a.destroy(this)}},{key:"setFilterTooltip",value:function(t,e){this.getFilter(t).tooltip=e}},{key:"getFilterTooltip",value:function(t){var e=t.value.get();return e?t.isOption?"<b>Click</b> to clear this option":(e>0?"Showing only":"Hiding")+" "+t.tooltip+".\n<b>Click</b> to clear this "+(t.isOption?"option":"filter."):t.isOption?t.tooltip:"<b>Click</b> to "+(t.initialValue>0?"show only ":"hide ")+t.tooltip+(e!==-t.initialValue?".\n<b>"+l.a.priModKey+" + click</b> to "+(t.initialValue<0?"show only ":"hide ")+t.tooltip+".":"")}},{key:"setupFilters",value:function(t,e){for(var i=0,r=[],a=0;a<t.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=t[a],o=n.name,u=e?e[o]:void 0;n.value=new p.a(isNaN(u)?n.defaultValue||0:u),n.enabled=new p.a(void 0===n.enabled||n.enabled);try{h.default.PAssert(1721,!this.hasOwnProperty("filter_"+o),"Should not double define filter properties")}catch(s){h.default.reportError(s)}this["filter_"+o]=n,r.push(n)}this.filters=r}},{key:"setFilterEnabled",value:function(t,e){var i=this.filters.indexOfWithProperty("name",t);i>=0&&this.filters[i].enabled.set(e)}},{key:"getValue",value:function(){return this.value}},{key:"isFiltered",value:function(){for(var t=0,e=0;e<this.filters.length;e++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;if(this.filters[e].value.get())return!0}return!1}},{key:"getRemoteValue",value:function(){for(var t=0,e=this.value,i=0;i<this.filters.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.filters[i];if(r.remoteStringFn&&r.enabled.get()){var a=r.remoteStringFn(r.value.get());a&&(e+=" "+a)}}return e.trim()}},{key:"getState",value:function(){for(var t=0,e={text:this.getValue(),showHierarchy:this.showHierarchy()},i=0;i<this.filters.length;i++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var r=this.filters[i];e[r.name]=r.value.get()}return e}},{key:"focus",value:function(){this.UI.focus()}},{key:"blur",value:function(){this.UI.blur()}},{key:"onParsed",value:function(t){this.tags=t.tags,this.contacts=t.contacts}},{key:"setValue",value:function(t){this.updatingValue=this.value!==t,this.updatingValue&&this.pane.clearPerPaneStateSearch(),this.value=t,this._updateSearchArr(),this.pane.getItemStore().numItems>5e3?this._needsBatchedSearch||(setTimeout(this.update,150,!0),this._needsBatchedSearch=!0):this.update(!0),t&&g.e.miscAction({type:g.c.Misc,misc:g.a.SearchChanged,data:this.getState()}),this.updatingValue=!1}},{key:"addToValue",value:function(t){var e=this.getSelectionOffset(),i=this.value;"-"!==i[i.length-1]&&"!"!==i[i.length-1]&&(t=" "+t),i+=t,this.setValue(i),this.setSelectionOffset(e+t.length)}},{key:"toggleText",value:function(t,e){var i=this.value.trim(),r="\\B(-*)("+h.default.escapeRegExp(t.toLowerCase())+")\\b",a=i.toLowerCase().match(r);a?(!a[1]&&e||a[1],i=(i.substr(0,a.index)+i.substr(a.index+a[0].length)).replace(/  +/g," ")):i+=" "+(e?"-":"")+t;i=i.trim(),this.setValue(i),l.a.isMobile&&!h.default.isKeyboardOpen||this.setSelectionOffset(i.length)}},{key:"getSelectionOffset",value:function(){return this.UI.getSelectionOffset()}},{key:"setSelectionOffset",value:function(t){this.UI.setSelectionOffset(t)}},{key:"getSearchBox",value:function(){return this.UI.refs.searchBox}},{key:"isSearched",value:function(){var t=0;if(this.value.length>0)return!0;for(var e=0;e<this.filters.length;e++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var i=this.filters[e];if(i.enabled.get()&&i.value.get())return!0}}},{key:"reset",value:function(){this.setValue("")}},{key:"resetFilters",value:function(){for(var t=0,e=0;e<this.filters.length;e++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.filters[e].value.set(0)}this.update(!0,!0)}},{key:"numUnmatchedItems",value:function(){var t=this,e=0,i={item:this.pane.getItem(),each:function(i){var r=i.id,a=t.matches[r];a!==X.No&&a!==X.Negated||e++}};return v.default.searchVMLIs(i),e}},{key:"isFlatSearchResult",value:function(t){return!this.showHierarchy()&&this.matches[t.id]===X.Yes}},{key:"isMatchStateMatch",value:function(t){return void 0===t||t===X.Yes||t===X.ChildYes||t===X.Unknown}},{key:"isMatched",value:function(t,e){if(this.pane.supportLocalSearch){var i=this.matches[t.id];return e||void 0!==i||!t.hasText()||this.pane.isSettingText||this.pane===h.default.focusedPane||(i=this.checkItem(t)),this.isMatchStateMatch(i)}return X.Yes}},{key:"handleItemChanged",value:function(t){if(v.default.PaneManager.isPaneActive(this.pane.id)){var e=this.isMatched(t,!0);this.checkItem(t);var i=this.isMatched(t);if(!i&&e&&(this.isMatchStuck(t)||this.stickMatchAfterSearch(t,!0)),i!=e)return!0}}},{key:"handleItemTextChanged",value:function(t){if(this.getValue()||this.isFiltered())return this.handleItemChanged(t)}},{key:"_updateSearchArr",value:function(){var t=0,e=this.value.toLowerCase().trim().split(/\s+/);this.searchArr=[],this.searchWords=[];for(var i=0,r=0;r<e.length;++r){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=e[r].startsWith("-"),n=a?e[r].substr(1):e[r];n&&"and"!==n&&"-"!==n&&"$"!==n&&(r>0&&("or"===n||"|"===n||"||"===n)?i++:(this.searchArr[i]||(this.searchArr[i]=[]),this.searchArr[i].push({text:n,isNegated:a}),a||this.searchWords.push(n)))}}},{key:"toggleFilterDefault",value:function(t){var e=this["filter_"+t],i=e.value.get();i=i?0:e.initialValue,this.setFilter(t,i)}},{key:"toggleFilter",value:function(t,e){var i=e?-1:1,r=this["filter_"+t].value.get();r=r===i?0:i,this.setFilter(t,r)}},{key:"getFilter",value:function(t){return this["filter_"+t]}},{key:"getFilterObs",value:function(t){var e=this["filter_"+t];return e?e.value:void 0}},{key:"getFilterValue",value:function(t){var e=this["filter_"+t];return e?e.value.get():void 0}},{key:"setFilter",value:function(t,e,i){"showOnlyMatches"===t&&this.clearListCache(),this["filter_"+t].value.set(e,i),this.update(!0,!0),g.e.miscAction({type:g.c.Misc,misc:g.a.SearchChanged,data:this.getState()})}},{key:"update",value:function(t,e,i){var r=this;this._needsBatchedSearch&&(this._needsBatchedSearch=!1),this.isRunningSearch=!0,v.default.PaneUpdateBatcher.beginUpdateItems(),(t||e)&&this.clearStickyMatches(),this.pane.supportLocalSearch&&(this.prevMatches=this.matches,this.matches={},this.isAnimatingSearch=i&&!t&&h.default.focusedPane===this.pane,this.checkChildren(),this.prevMatches={}),this.isUpdatingSearch=!0,this.pane.isLoaded&&t&&this.onChanged.notify(e),v.default.PaneUpdateBatcher.commitUpdateItems(),setTimeout(function(){r.isUpdatingSearch=!1},0),this.isRunningSearch=!1}},{key:"clearStickyMatches",value:function(){this._stickyMatchesAwaitingClear=[],this._stickyMatches={},clearTimeout(this._timeoutHideNonMatches)}},{key:"_checkMatch",value:function(t,e,i){var r=!0;return i===c.a.SearchDates.Overdue||i.startsWith(c.a.SearchDates.Before)||i.startsWith(c.a.SearchDates.After)||i.startsWith(c.a.SearchDates.Date)?r=this._matchDate(t,i):i.length>0&&r&&(r=!1,h.default.isPrefixTask(i)?r=t.isPrefixTask():i!==c.a.Prefix.Bullet&&i!==c.a.Prefix.Bullet2&&i!==c.a.Prefix.Bullet3||(r=t.isPrefixBullet()),r=r||e.indexOf(i)>=0),r}},{key:"_isMatchStateOk",value:function(t){return t===X.Yes||t===X.Unknown||t===X.ChildYes}},{key:"_matchFilter",value:function(t,e){if(t)return e?t>0?X.Unknown:X.Negated:t>0?X.No:X.Unknown}},{key:"_matchFilters",value:function(t){for(var e=0,i=X.Unknown,r=0;r<this.filters.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.filters[r];if(a.matchFn){var n=a.matchFn(a.value.get(),t);n===X.Unknown||n!==X.Negated&&!this._isMatchStateOk(i)||(i=n)}}return i===X.Yes&&(i=X.Unknown),i}},{key:"_matchFnComplete",value:function(t,e){return 1===t?e.isComplete()?X.Unknown:X.No:-1===t&&e.isComplete()?X.Negated:X.Unknown}},{key:"_matchFnStarred",value:function(t,e){return this._matchFilter(t,e.isStarred())}},{key:"_matchFnProject",value:function(t,e){return this._matchFilter(t,e.isPrefixHeader())}},{key:"_matchFnTask",value:function(t,e){return this._matchFilter(t,e.isPrefixTask())}},{key:"_matchFnPriority",value:function(t,e){var i=e.getPriority();return t>0?i>=t?X.Yes:X.No:X.Unknown}},{key:"_matchFnEmail",value:function(t,e,i){var r=e.getAttachments(),a=r&&r[0],n=a&&a.getPlugin()===h.default.vmMain.getDefaultEmailPlugin();return this._matchFilter(t,n)}},{key:"_matchDate",value:function(t,e){var i=t.getNextDate();if(i){var r=e.split(":"),a=T()(r,2),n=a[0],o=a[1];if("date"===n&&"overdue"===o)return i<new Date;var u=Date.parse(o);return!u||"before"===n&&i<u||"date"===n&&i.clearTime().equals(u.clearTime())||"after"===n&&i>u}}},{key:"checkItem",value:function(t,e){var i,r=e&&e.searchExtras,a=r?r.root:this.pane.getRootItem(),n=r?r.showHierarchy:this.showHierarchy(),o=this.matches,u=t.isNote(),s=t.parent();if(t.isDestroyed())return i=X.No;try{h.default.PAssert(1722,s||t.isRootItem(),"Item parent does not exist while being searched",t===a)}catch(M){h.default.reportError(M)}if(this._stickyMatches[t.id])i=X.ChildYes;else if(t.isRootItem())i=X.Yes;else if(s)if(o[s.id]===X.Negated)i=X.Negated;else{var d,v,y,g,l,p,m=[],f=t.getSearchText(this.pane),k=(i=this._matchFilters(t))===X.Negated;if(!k&&this.searchArr.length){var A=0,S=0;for(v=0;v<this.searchArr.length;v++){var w=0;if(A++>5e3&&__infLoop&&__infLoop(A))throw new RangeError;for(p=this.searchArr[v],y=0;y<p.length;y++){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;if((l=p[y]).isNegated){g=l.text;try{h.default.PAssert(1723,g,"Each value in the search array should be valid at this point")}catch(M){h.default.reportError(M)}if(this._checkMatch(t,f,g)){m[v]=X.Negated,k=!0,S++;break}}}}S===this.searchArr.length&&(i=X.Negated)}if(this.isMatchStateMatch(i)){var L=0,F=0;for(v=0;v<this.searchArr.length;v++){if(L++>5e3&&__infLoop&&__infLoop(L))throw new RangeError;if(m[v]!==X.Negated){var C=0;for(p=this.searchArr[v],y=0;y<p.length;y++){if(C++>5e3&&__infLoop&&__infLoop(C))throw new RangeError;g=(l=p[y]).text;try{h.default.PAssert(1724,g,"Each value in the search array should be valid at this point")}catch(M){h.default.reportError(M)}if(!l.isNegated)if(this._checkMatch(t,f,g))m[v]=X.Yes;else if(n){var I=0;for(d=t;d;){if(I++>5e3&&__infLoop&&__infLoop(I))throw new RangeError;if(!(d=d.parent())||d===a){m[v]=X.No;break}if(this._checkMatch(d,d.getSearchText(),g))break}}else m[v]=X.No;if(m[v]===X.No)break}}}var P=!1;for(v=0;v<m.length;v++){if(F++>5e3&&__infLoop&&__infLoop(F))throw new RangeError;if(P=m[v]===X.Yes,i===X.Unknown&&m[v]===X.Negated)i=X.Negated;else if(i!==X.Yes&&m[v]===X.No)i=X.No;else if(m[v]===X.Yes||m[v]===X.Unknown){i=X.Yes;break}}if(P&&this.updatingValue&&this.getValue()){var N=0;for(d=s;d;){if(N++>5e3&&__infLoop&&__infLoop(N))throw new RangeError;d.isCollapsed(this.pane,!1,!0)&&this.pane.setPerPaneState(d.id,c.a.PerPaneStateField.CollapsedSearch,!1),d=d.parent()}}i===X.Unknown&&(i=X.Yes)}if(!k&&this.pane.shouldSearchMatchParents&&s!==a&&n&&o[s.id]===X.Yes)return o[t.id]=X.Yes,o[t.id];i===X.No&&u&&(i=o[s.id])}else i=X.No;if(this.isMatchStateMatch(i)&&this.onlyMatchDates&&!this.pane.isOkOnAgenda(t)&&(i=X.No),i===X.Yes){if(n){var H=0;for(d=s;d&&!d.isRootItem()&&o[d.id]!==X.Negated&&o[d.id]!==X.Yes;){if(H++>5e3&&__infLoop&&__infLoop(H))throw new RangeError;o[d.id]=X.ChildYes,d.hasNote()&&(o[d.getNote().id]=X.Yes),d=d.parent()}}u&&(o[s.id]=X.Yes)}return o[t.id]=i,o[t.id]}},{key:"checkChildrenParams",value:function(t,e){return this.checkItem(t,e)!==X.Negated}},{key:"checkChildren",value:function(){var t={includeArchived:this.pane.showArchived.get(),includeNotes:!0,comparator:this.checkChildrenParams,searchExtras:{root:this.pane.getRootItem(),showHierarchy:this.showHierarchy()}};if(this.itemStoreFilter&&(t.itemStoreFilter=this.itemStoreFilter),this.pane.getItemStore()!==v.default.itemStoreManager.getDefaultItemStore()?t.itemStore=this.pane.getItemStore():t.item=this.pane.getItem(),v.default.searchVMLIs(t),this.isAnimatingSearch)for(var e in this.matches)if(this.matches.hasOwnProperty(e)&&void 0!==this.prevMatches[e]&&this.isMatchStateMatch(this.prevMatches[e])&&!this.isMatchStateMatch(this.matches[e])){var i=y.a.getItem(e);i&&!this.isMatchStuck(i)&&this.stickMatchAfterSearch(i,this.prevMatches[i.id])}}},{key:"_getMatchedItem",value:function(t){return this._stickyMatches[t.id]||t}},{key:"getItemDate",value:function(t){var e=this._stickyMatches[t.id];return e&&e.date}},{key:"getItemRepeatDate",value:function(t){var e=this._stickyMatches[t.id];return e&&e.repeatDate}},{key:"getItemDateText",value:function(t){var e=this._stickyMatches[t.id];return e&&e.dateText}},{key:"getItemDuration",value:function(t){var e=this._stickyMatches[t.id];return e&&e.duration}},{key:"getItemTagsLower",value:function(t){var e=this._stickyMatches[t.id];return e&&e.tagsLower}},{key:"getItemContacts",value:function(t){var e=this._stickyMatches[t.id];return e&&e.contacts}},{key:"getItemSearchText",value:function(t){var e=this._stickyMatches[t.id];return e&&e.searchText}},{key:"getItemPrefix",value:function(t){var e=this._stickyMatches[t.id];return e&&e.prefix}},{key:"getItemPriority",value:function(t){var e=this._stickyMatches[t.id];return e&&e.priority}},{key:"getItemStarred",value:function(t){var e=this._stickyMatches[t.id];return e&&e.isStarred}},{key:"stickMatch",value:function(t,e){var i=h.default.isVMLI(t)?t:t.item;if(!this._stickyMatches[i.id]){this.matches[i.id]=X.Yes;var r=i.getStickySearchInfo();e&&(r.isHiding=!0),h.default.isInCompleteAction()&&(r.wasCompleted=!0),this._stickyMatches[i.id]=r}}},{key:"isMatchStuck",value:function(t){var e=h.default.isVMLI(t)?t:t.item;return!!this._stickyMatches[e.id]}},{key:"unstickMatch",value:function(t){var e=h.default.isVMLI(t)?t:t.item,i=this._stickyMatches[e.id];if(i){var r=e.getStickySearchInfo();return delete this._stickyMatches[e.id],!h.default.areObjectsEqual(i,r)}return!1}},{key:"isMatchStuckHiding",value:function(t){var e=h.default.isVMLI(t)?t:t.item,i=this._stickyMatches[e.id];return i&&i.isHiding}},{key:"stickMatchAfterSearch",value:function(t,e){this.stickMatch(t,!0),e&&(this._timeoutHideNonMatches&&clearTimeout(this._timeoutHideNonMatches),this._stickyMatchesAwaitingClear.push(t),l.a.isMobile&&j.default.isInMultiselect()||(this._timeoutHideNonMatches=setTimeout(this.hideNonMatches,1500)))}},{key:"hideNonMatches",value:function(){var t=this;if(!this._destroyed){var e=this.pane,i=this._stickyMatchesAwaitingClear,r=i.length,a=0;if(r>0){for(var n=0,o=0;o<r;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=i[o],s=this._stickyMatches[u.id];s&&s.wasCompleted&&a++,this.unstickMatch(u)}var d=r+(r>1?" items":" item"),y={hold:!1};this.pane===h.default.focusedPane&&(a!==r?(y.text=d+" hidden because "+(r>1?"they do":"it does")+" not match search",y.actionText="UNHIDE",y.action=function(){if(e&&e.setIgnoreRestoreScroll){var a=0,n=F.a.save();e.setIgnoreRestoreScroll();for(var o=0;o<r;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var u=i[o];t.stickMatch(u),t._stickyMatchesAwaitingClear.push(u)}t.pane.updateItemsImmediate(!0,void 0,void 0,!0),F.a.restore(n)}}):(y.text=d+" completed",y.actionText="UNDO",y.action=function(){var a=0,n=F.a.save();e.setIgnoreRestoreScroll();for(var o=0;o<r;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;i[o].setComplete(!1,c.a.ChangeType.Local)}t.pane.updateItemsImmediate(!0,void 0,void 0,!0),F.a.restore(n)}),v.default.toasts.pushMessage(y));var g=F.a.save();this._stickyMatchesAwaitingClear=[],e.setIgnoreRestoreScroll(),e.updateItemsImmediate(!0,void 0,void 0,!0),!l.a.isMobile&&g&&g.pane===this.pane&&F.a.restore(g)}}}},{key:"showHierarchy",value:function(){return this.pane.type!==c.a.PaneMode.Task||this.pane.getViewMode()!==c.a.TaskViewMode.List_Flat&&1!==this.getFilterValue("showOnlyMatches")}},{key:"setShowHierarchy",value:function(t){this.pane.supportSearchFlat&&this.setFilter("showOnlyMatches",t?0:1)}},{key:"showOnlyAgendaDates",value:function(){return this.pane.type===c.a.PaneMode.Task&&this.getFilterValue("showOnlyAgendaDates")}},{key:"showOnlyMatchingTags",value:function(){return this.pane.type===c.a.PaneMode.Task&&this.getFilterValue("showOnlyMatchingTags")}},{key:"showChildProjects",value:function(){return this.pane.type===c.a.PaneMode.Task&&this.getFilterValue("showChildProjects")}},{key:"clearListCache",value:function(){this.pane.getInfiniteList().clearCache()}},{key:"getTags",value:function(){return this.tags}},{key:"getContacts",value:function(){return this.contacts}},{key:"getSearchWords",value:function(){return this.searchWords}},{key:"shouldHighlightSearch",value:function(){return this.isFocused.get()&&this.getValue()}}]),t}(),J=i(23),Z=i(45),B=i(77),$=i(50),U=i(118),R=i(59),E=i(22),K=i(42),x=i(16),b=i(34);if(l.a.isMobile)var O=i(44).default;var W=0,_=["collapser","itemParents","itemCheckbox","agendaTime","itemMenuIcon","vertLines","itemTime"],tt=(D=function(){function t(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a()(this,t),this.__ISPANE=!0,d.a.binder(this,"getItems","getHeaders","updateItems","getWidth","getHeight","compositionStart","compositionEnd","onShowArchivedChanged","onTouchHoldTimeout","zoomInOnSwipe","collapseOnSwipe","deleteOnSwipe","completeOnSwipe","onClickRefreshData","getMinItemSize"),this.bindExtra&&this.bindExtra(),this.title=i.title,this.contextMenuMode="contextMenuMode"in i?i.contextMenuMode:c.a.ContextMenuMode.Default,this.paneEmptyMessage="paneEmptyMessage"in i?i.paneEmptyMessage:"Start typing to get started",this.paneEmptySearchMessage="paneEmptySearchMessage"in i?i.paneEmptySearchMessage:"No search results",this.titleContextMenuHeader="titleContextMenuHeader"in i?i.titleContextMenuHeader:"Zoom to item",this.searchFilters="searchFilters"in i?i.searchFilters:[],this.dropEffect="dropEffect"in i?i.dropEffect:function(){return c.a.DropEffect.Move},this.isWriteable=!("isWriteable"in i)||i.isWriteable,this.isEditable="isEditable"in i&&i.isEditable,this.isDraggable=!("isDraggable"in i)||i.isDraggable,this.isDropTarget=!("isDropTarget"in i)||i.isDropTarget,this.hasNonVMLIs="hasNonVMLIs"in i&&i.hasNonVMLIs,this.canAddItem=!("canAddItem"in i)||i.canAddItem,this.overrideCopyBehavior=!("overrideCopyBehavior"in i)||i.overrideCopyBehavior,this.supportMenuIcon="supportMenuIcon"in i&&i.supportMenuIcon,this.supportCollapsing=!("supportCollapsing"in i)||i.supportCollapsing,this.supportCompleting=!("supportCompleting"in i)||i.supportCompleting,this.supportCheckbox="supportCheckbox"in i&&i.supportCheckbox,this.isArchiveView="isArchiveView"in i&&i.isArchiveView,this.supportIndent=!("supportIndent"in i)||i.supportIndent,this.supportOffline=!("supportOffline"in i)||i.supportOffline,this.supportPerformArchive=!("supportPerformArchive"in i)||i.supportPerformArchive,this.supportDataRefresh="supportDataRefresh"in i&&i.supportDataRefresh,this.supportReportError="supportReportError"in i&&i.supportReportError,this.supportCompose="supportCompose"in i&&i.supportCompose,this.supportPagination="supportPagination"in i&&i.supportPagination,this.supportVertLines=!("supportVertLines"in i)||i.supportVertLines,this.supportStarClick="supportStarClick"in i&&i.supportStarClick,this.supportSearchItemAutocomplete=!("supportSearchItemAutocomplete"in i)||i.supportSearchItemAutocomplete,this.supportSearchListenTextChanges=!("supportSearchListenTextChanges"in i)||i.supportSearchListenTextChanges,this.supportSearchFlat=!("supportSearchFlat"in i)||i.supportSearchFlat,this.supportLocalSearch=!("supportLocalSearch"in i)||i.supportLocalSearch,this.supportClone=!("supportClone"in i)||i.supportClone,this.supportDates=!("supportDates"in i)||i.supportDates,this.supportMultiselect=!("supportMultiselect"in i)||i.supportMultiselect,this.supportDeferredItemLoad="supportDeferredItemLoad"in i&&i.supportDeferredItemLoad,this.supportCellTransition=!("supportCellTransition"in i)||i.supportCellTransition,this.supportViewMenu="supportViewMenu"in i&&i.supportViewMenu,this.useLineCache=!("useLineCache"in i)||i.useLineCache,this.supportSel=!("supportSel"in i)||i.supportSel,this.shouldSearchMatchParents=!("shouldSearchMatchParents"in i)||i.shouldSearchMatchParents,this.shouldUpdateOnTextChanged=!("shouldUpdateOnTextChanged"in i)||i.shouldUpdateOnTextChanged,this.noOverviewStyle="noOverviewStyle"in i&&i.noOverviewStyle,this.supportClickOverviewScroll="supportClickOverviewScroll"in i?i.supportClickOverviewScroll:!l.a.isMobile,this.overviewTracksScroll=!("overviewTracksScroll"in i)||i.overviewTracksScroll,this.overviewHasPaneItems=!("overviewHasPaneItems"in i)||i.overviewHasPaneItems,this.overviewPadLevels="overviewPadLevels"in i?i.overviewPadLevels:0,this.minWidth="minWidth"in i?i.minWidth:c.a.StdPaneWidthMin,this.minWidthFlex="minWidthFlex"in i?i.minWidthFlex:c.a.StdPaneWidthMin,this.maxWidth="maxWidth"in i?i.maxWidth:c.a.PaneWidthMax,this.maxWidthFlex="maxWidthFlex"in i?i.maxWidthFlex:c.a.StdPaneWidthMax,this.maxWidthSingle="maxWidthSingle"in i?i.maxWidthSingle:c.a.StdPaneWidthMax,this.widthBiggerInSingle=!("widthBiggerInSingle"in i)||i.widthBiggerInSingle,this.collapsedFieldName="collapsedFieldName"in i?i.collapsedFieldName:c.a.PerPaneStateField.Collapsed,this.hasMoreButtons=!("hasMoreButtons"in i)||i.hasMoreButtons,this.supportsDocuments=!("supportsDocuments"in i)||i.supportsDocuments,this._topBoxHeight=void 0!==i._topBoxHeight?i._topBoxHeight:h.default.activeDisplayMode&c.a.DisplayMode.NoPaneTop?0:l.a.isMobile?16:36,this.blockNoKey="",this.topBoxHeight=new p.a(this._topBoxHeight),this.rect=new p.a(e.rect),this.isExpanded=new p.a(!1);try{h.default.PAssert(1643,void 0!==e.id,"Must supply a valid pane id")}catch(r){h.default.reportError(r)}this.id=e.id,this.uniquePaneID=W++,this.isFakePane=e.isFakePane,this.plugin=e.plugin,e.document&&h.default.isString(e.document)&&(e.document=y.a.getDocumentById(e.document)),this.document=new p.a(e.document),this.documentSortMode=new p.a(e.documentSortMode||c.a.DocumentSortMode.Modified,this.saveState),e.item||(this.supportDeferredItemLoad?(e.item=this.getDefaultDisplayItem(),this.deferredItemState={itemID:e.deferredItemID,search:e.search,offset:0}):(e.item=this.getDefaultDisplayItem(),e.search=e.search||"")),this.name=new p.a(e.name),this.item=new p.a(e.item),this.items=new L.a,this.headers=new L.a,this.paneObjectsByItem={},this.isDefaultPane=e.isDefaultPane,this.initialOffset=e.offset,this.itemsDirtyState=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.reloading=!1,this.onDestroyed=new C.a,this.showArchived=new p.a(!1),this._panePadding=0,this.paneTopText=new p.a,this.toast=new p.a,this.isInitialized=!1,this.isLoaded=!1,this._didInitialScroll=!1,this.isLoading=new p.a(!1),this.isFocused=new p.a(!1),this.caretPosition=new p.a,this.widthManual=e.widthManual,this.widthManualExpanded=e.widthManualExpanded,this.isReady=new p.a(!this.plugin||this.plugin.isReady()),this.isActive=new p.a(!l.a.isMobile),this.hasBeenActive=this.isActive.get(),this.hasCollapsedObs=new p.a,this._infiniteList=new M({pane:this,offset:e.offset||0,isOverview:!1,itemsObs:this.items,itemsFn:this.getItems,widthFn:this.getWidth,heightFn:this.getHeight,intialOffset:this.initialOffset,minItemSize:this.getMinItemSize}),this.useCustomScroller=this._infiniteList.useCustomScroller,this.isLoadingNewPage=new p.a(!1),this.orientation=new p.a(c.a.Orientation.Vertical),this.showScrollbars=new p.a(!0),this._perPaneState={},this._destroyed=!1,this._numItemComputes=0,this._numHeaderComputes=0,this._numItemSets=0,this.isAnimatingOffset=!1,this._ignoreRestoreScroll=!1,this._activeItemStores={},l.a.isMobile?(this.defaultOffset=Math.max(this.topBoxHeight.get()-16,0),this.offsetX=new p.a(0),this.swipeMenuItems=this.getSwipeMenuItems()):(this.defaultOffset=0,this.onTap={onStart:this.onTapStart,onMove:this.onTapMove,onClick:this.onTapClick,onEnd:this.onTapEnd,onDoubleClick:this.onTapDoubleClick,onRightClick:this.onTapRightClick}),this.showArchived.listen(this.onShowArchivedChanged),this.search=new Q(this,e.search,this.onSearchChanged.bind(this)),this.overview=new V(this,e.isOverviewVisible,e.isOverviewShowingContents)}return o()(t,[{key:"init",value:function(){this.getItem()&&this.setItem(this.getItem(),!1),this.plugin&&this.plugin.notifyPaneCreated()}},{key:"isDestroyed",value:function(){return this._destroyed}},{key:"getStats",value:function(){return{numItemComputes:this._numItemComputes,numHeaderComputes:this._numHeaderComputes,numItemSets:this._numItemSets}}},{key:"becomeReal",value:function(){}},{key:"activate",value:function(){try{h.default.PAssert(1644,l.a.isMobile,"Activating panes should only ever happen on mobile devices")}catch(t){h.default.reportError(t)}this.isActive.set(!0),this.hasBeenActive=!0,this.updateItemsImmediate(!0,!1)}},{key:"deactivate",value:function(){try{h.default.PAssert(1645,l.a.isMobile,"Deactivating panes should only ever happen on mobile devices")}catch(t){h.default.reportError(t)}this.isActive.set(!1)}},{key:"unload",value:function(){this._isUnloaded=!0}},{key:"isUnloaded",value:function(){return this._isUnloaded}},{key:"destroy",value:function(){this._destroyed=!0,this.plugin&&this.plugin.notifyPaneDestroyed(),this.showArchived.unlisten(this.onShowArchivedChanged),this.search.destroy(),this.search=void 0,this.overview.destroy(),this.overview=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.hiddenInput=void 0,this._onAfterLoadedRAF&&(cancelAnimationFrame(this._onAfterLoadedRAF),this._onAfterLoadedRAF=void 0),this.isLoaded&&this.getItemStore()===v.default.itemStoreManager.getDefaultItemStore()&&N.a.unlisten("itemNoteSet",this._infiniteList.handleItemNoteSet),this._infiniteList=void 0;try{h.default.PAssert(1646,h.default.focusedPane!==this,"Globally focused pane should never be the one destroyed")}catch(t){h.default.reportError(t)}try{h.default.PAssert(1647,F.a.getPane()!==this,"Selection focused pane should never be the one destroyed")}catch(t){h.default.reportError(t)}try{h.default.PAssert(1648,!v.default.PaneManager.isPaneActive(this.id),"Pane manager has reference to pane in map to destroyed pane")}catch(t){h.default.reportError(t)}this.onDestroyed.notify()}},{key:"notifyPluginLoaded",value:function(){try{h.default.PAssert(1649,!1,"Plugin load notification not supported by pane type: ",this.type)}catch(t){h.default.reportError(t)}}},{key:"getContextMenuMode",value:function(){return this.contextMenuMode}},{key:"isItemDraggable",value:function(){return this.isDraggable}},{key:"isOkOnAgenda",value:function(t){return!1}},{key:"getInfiniteList",value:function(t){var e;if(t){var i=this.getOverview();try{h.default.PAssert(1650,i,"Trying to get infinite list for overview that doesnt exist.")}catch(r){h.default.reportError(r)}i&&(e=i.getInfiniteList())}else e=this._infiniteList;return e}},{key:"getItemStore",value:function(){return this.getRootItem().getItemStore()}},{key:"usesItemStore",value:function(t){return t===this.getItemStore()||!!this._activeItemStores[t.id]}},{key:"useItemStore",value:function(t){try{h.default.PAssert(1651,!this._activeItemStores[t.id],"Should never use the same store twice")}catch(e){h.default.reportError(e)}this._activeItemStores[t.id]=t}},{key:"stopUsingItemStore",value:function(t){try{h.default.PAssert(1652,this._activeItemStores[t.id],"Must be using item store to stop using it")}catch(e){h.default.reportError(e)}delete this._activeItemStores[t.id]}},{key:"getOverview",value:function(){return this.overview}},{key:"isOverviewVisible",value:function(){return this.overview.isVisible.get()}},{key:"isOverviewShowingContents",value:function(){return this.overview.isShowingContents.get()}},{key:"numItems",value:function(){return this.getItems().length}},{key:"numHeaders",value:function(){return this.getHeaders().length}},{key:"getItems",value:function(){return v.default.PaneUpdateBatcher.flushItemsUpdate(this),this.items.get()}},{key:"getHeaders",value:function(){return this.headers.get()}},{key:"itemAtIndex",value:function(t){return this._infiniteList.itemAtIndex(t)}},{key:"objectAtIndex",value:function(t){return this._infiniteList.objectAtIndex(t)}},{key:"indexOfItem",value:function(t,e,i){return this._infiniteList.indexOfItem(t,e,i)}},{key:"indexOfObject",value:function(t){return this._infiniteList.indexOfItem(t)}},{key:"topOfItem",value:function(t){return this._infiniteList.topOfItem(t)}},{key:"topOfIndex",value:function(t){return this._infiniteList.topOfIndex(t)}},{key:"indexOfTop",value:function(){return this._infiniteList.indexOfTop()}},{key:"inViewCount",value:function(){return this._infiniteList.inViewCount()}},{key:"itemAtTop",value:function(){return this._infiniteList.itemAtTop()}},{key:"elementAtIndex",value:function(t){return this._infiniteList.getElementAtIndex(t)}},{key:"isIndexMounted",value:function(t){return this._infiniteList.isIndexMounted(t)}},{key:"notifyDragStart",value:function(){return this._infiniteList.notifyDragStart()}},{key:"notifyDragEnd",value:function(){return this._infiniteList.notifyDragEnd()}},{key:"notifySwappedIn",value:function(t){return this._infiniteList.notifySwappedIn(t)}},{key:"getScrollOffset",value:function(){return this._infiniteList.getScrollOffset()}},{key:"addScrollListener",value:function(t){return this._infiniteList.addScrollListener(t)}},{key:"removeScrollListener",value:function(t){return this._infiniteList.removeScrollListener(t)}},{key:"refreshScrollListener",value:function(){return this._infiniteList.refreshScrollListener()}},{key:"setScrollOffset",value:function(t,e,i){return this._infiniteList.setScrollOffset(t,e,i)}},{key:"scrollIndexIntoView",value:function(t,e,i){return this._infiniteList.scrollIndexIntoView(t,e,i)}},{key:"scrollItemIntoView",value:function(t,e,i){return this._infiniteList.scrollItemIntoView(t,e,i)}},{key:"scrollIndexToTop",value:function(t,e,i){return this._infiniteList.scrollIndexToTop(t,e,i)}},{key:"scrollItemToTop",value:function(t,e,i){return this._infiniteList.scrollItemToTop(t,e,i)}},{key:"scrollItemToMiddle",value:function(t,e,i){return this._infiniteList.scrollItemToMiddle(t,e,i)}},{key:"scrollIndexToMiddle",value:function(t,e,i){return this._infiniteList.scrollIndexToMiddle(t,e,i)}},{key:"addScrollDelta",value:function(t){return!!this._infiniteList&&this._infiniteList.addScrollDelta(t)}},{key:"addPadding",value:function(){return this._infiniteList.addPadding()}},{key:"removePadding",value:function(){return this._infiniteList.removePadding()}},{key:"getScrollTop",value:function(){return this._infiniteList.getScrollTop()}},{key:"closestIndexOfObject",value:function(t){return this.indexOfObject(t)}},{key:"sizeAtIndex",value:function(t,e){var i=0,r=e?this.overview._infiniteList:this._infiniteList;try{h.default.PAssert(1654,r,"Must have a valid owner")}catch(n){h.default.reportError(n)}if(r){var a=r.objectAtIndex(t);try{h.default.PAssert(1655,a,"Must have found a valid item")}catch(n){h.default.reportError(n)}a&&(i=this.sizeOfItem(a,t,e))}return i}},{key:"sizeOfItem",value:function(t,e,i){try{h.default.PAssert(1656,t,"Must provide a valid item to measure")}catch(n){h.default.reportError(n)}var r=0,a=t.sizeInPane;return void 0!==a&&(r=isNaN(a)?t.sizeInPane(this,e,i):a,t.sizePad&&(r+=t.sizePad)),r}},{key:"handleStatusClick",value:function(){}},{key:"_getLoadingMessage",value:function(){return"Loading..."}},{key:"getStatusMessage",value:function(t){var e;return t||(this.isLoading.get()?e=this._getLoadingMessage():0===this.numItems()?e=this.isSearched()&&this._allPaneItems.length>0?this.paneEmptySearchMessage:this.paneEmptyMessage:this.isReady.get()||(e=this._getNotReadyStatus())),e}},{key:"_getNotReadyStatus",value:function(){return"Pane data is only available while online."}},{key:"getSaveInfoForClone",value:function(){var t=this.getSaveInfo();for(var e in delete t.id,t)t.hasOwnProperty(e)&&h.default.isObject(t[e])&&(t[e]=h.default.clone(t[e]));return t}},{key:"getSaveInfo",value:function(){var t=this.document.get();return{id:this.id,name:this.name.get(),item:this.getItem().id,document:t?t.id:void 0,type:this.type,showarch:this.showArchived.get(),search:this.search.getState(),offset:this.getScrollOffset(),itemState:this.getSaveInfoItemState(),isOverviewVisible:!l.a.isMobile&&this.overview.isVisible.get(),isOverviewShowingContents:!l.a.isMobile&&this.overview.isShowingContents.get(),isExpanded:!l.a.isMobile&&this.isExpanded.get(),widthManual:this.widthManual,widthManualExpanded:this.widthManualExpanded,documentSortMode:this.documentSortMode.get()}}},{key:"getSaveInfoItemState",value:function(){var t=this._perPaneState,e={};for(var i in t)if(t.hasOwnProperty(i)){var r=y.a.getItem(i);if(r){var a=t[i];for(var n in a)if(a.hasOwnProperty(n)&&n.startsWith(c.a.PerPaneStateField.Collapsed)){var o=a[n];if(void 0!==o){var u=n.replace(c.a.PerPaneStateField.Collapsed,"");if("Search"===u||o!==this.getCollapsedDefault(r,"Overview"===u,u)||!o&&r.isDemandLoad()){var s=(a[n]?"":"un")+n;e[s]||(e[s]=[]),e[s].push(i)}}}}else delete t[i]}return e}},{key:"saveState",value:function(){v.default.PaneManager.updatePaneStateForPane(this)}},{key:"getPerPaneState",value:function(t,e){var i=this._perPaneState[t];if(i)return i[e]}},{key:"setPerPaneState",value:function(t,e,i){this._perPaneState[t]||(this._perPaneState[t]={}),this._perPaneState[t][e]=i}},{key:"clearPerPaneStateSearch",value:function(){var t=this._perPaneState;for(var e in t)t.hasOwnProperty(e)&&(t[e][c.a.PerPaneStateField.CollapsedSearch]=void 0)}},{key:"deletePerPaneState",value:function(t){this._perPaneState[t]=void 0}},{key:"isSearched",value:function(){try{h.default.PAssert(1657,this.search,"Pane must be initialized: ",this._destroyed)}catch(t){h.default.reportError(t)}return!!this.search&&this.search.isSearched()}},{key:"isSearchedText",value:function(){try{h.default.PAssert(1658,this.search,"Pane must be initialized: ",this._destroyed)}catch(t){h.default.reportError(t)}return!!this.search&&this.search.getValue()}},{key:"isSearchedFlat",value:function(){return!1}},{key:"onSearchChanged",value:function(t){var e=F.a.isValid();if(e&&F.a.reset(),this.updateItems(),e&&this.numItems()>0){var i=this.indexOfFirstItem();i>=0&&F.a.selectIndex(i,0)}this.saveState()}},{key:"refreshSearchResults",value:function(){this.updateItems(!0)}},{key:"_applyItemStateArr",value:function(t,e,i){if(t)for(var r=0,a=0;a<t.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=t[a];this.setPerPaneState(n,e,i)}}},{key:"applyItemState",value:function(t){if(t)for(var e in t)if(t.hasOwnProperty(e)){var i=e.startsWith("un"+c.a.PerPaneStateField.Collapsed)?e.slice(2):e;if(i.startsWith(c.a.PerPaneStateField.Collapsed)){var r=t[e];this._applyItemStateArr(r,i,!e.startsWith("un"))}}}},{key:"requestDemandLoadData",value:function(t){try{h.default.PAssert(1659,!1,"SubClass must override - by default demand load is not supported")}catch(e){h.default.reportError(e)}}},{key:"requestDataPage",value:function(t){try{h.default.PAssert(1660,!1,"SubClass must override - by default data pagination is not supported")}catch(e){h.default.reportError(e)}}},{key:"getDefaultDisplayItem",value:function(t){return this.getRootItem()}},{key:"getRootItem",value:function(){return this.document.get().getRootItem()}},{key:"setRootItem",value:function(t,e){try{h.default.PAssert(1661,void 0===t.parent(),"Root should never have a parent")}catch(i){h.default.reportError(i)}try{h.default.PAssert(1662,this.getItem()!==t,"Should not be setting root to the same value")}catch(i){h.default.reportError(i)}this.setItem(t,e)}},{key:"scrollFromMousePosition",value:function(t,e,i){var r=i?this.getWidth():this.getHeight(),a=h.default.clamp(.1*r,20,40),n=a,o=i?this.getWidth():this.getHeight()-(l.a.isMobile?c.a.MobileBottomHeight:this.headerHeight()),u=o-a,s=i?t-this.scrollElement.getBoundingClientRect().left:e-this.contentTop(),d=0;s<n?d=h.default.computeScrollSpeed(0,n,s,4,-1):s>u&&(d=h.default.computeScrollSpeed(u,o,s,4)),0!==d?h.default.repeatScroll("pane",d,this,!1):h.default.cancelRepeatScroll("pane")}},{key:"getContentElement",value:function(){return this.paneContent}},{key:"getPaneIcon",value:function(){return"icon-align-left"}},{key:"itemHasChildren",value:function(){return this.getItem().numItems()>0}},{key:"getItem",value:function(){return this.item.get()}},{key:"allowZoom",value:function(t){return!0}},{key:"performOverviewAction",value:function(t){}},{key:"setItem",value:function(t,e){this._numItemSets++;var i=this.getItem();this.item.set(t,!1),this.updateItemsImmediate(!0,!1,!0),i&&i.parent()&&i._updateStylePadding(i.parent().levelsDeep.get(),!0),e&&(t.itemChanged.notify(),i&&t!==i&&i.itemChanged.notify(),this.item.notify(t,i))}},{key:"getItemSearchParams",value:function(){return{item:this.getItem(),comparator:this.search.isMatched,noCollapsed:!0,includeNotes:!0,pane:this}}},{key:"getHeaderSearchParams",value:function(){return{item:this.getRootItem(),comparator:this.search.isMatched,noCollapsed:!0,collapseAfterDepth:1,headers:!0,overview:!0,pane:this}}},{key:"setItemsWillBeDirty",value:function(){this.itemsWillBeDirty=!0}},{key:"setItemsDirty",value:function(){this._setDirtyState(!1,!1)}},{key:"isItemsDirty",value:function(){return!!this.itemsDirtyState}},{key:"_setDirtyState",value:function(t,e){this.itemsDirtyState?(this.itemsDirtyState.updateSearch=t||this.itemsDirtyState.updateSearch,this.itemsDirtyState.forceNotify=e||this.itemsDirtyState.forceNotify):this.itemsDirtyState={updateSearch:t,forceNotify:e}}},{key:"updateItems",value:function(t,e){this._setDirtyState(t,e),v.default.PaneUpdateBatcher.updateAllItems()}},{key:"updateItemsImmediate",value:function(t,e,i,r){this.itemsDirtyState&&(!0,e=!0,this.itemsDirtyState=void 0),h.default.shouldLog(c.a.LogLevels.React)&&h.default.log("update items"),this.search.isRunningSearch||this.search.update(void 0,void 0,!r);var a=this.item.get(),n=[],o=this.getItemSearchParams(),u=o.each,s=this.hasCollapsed();o.each=function(t){t.isNote()&&t.parent()===a||(n.push(t),u&&u(t))},this.runItemSearch(o),this._numItemComputes++,this.setItems(n,e),this.updateHeaders(e||i),this.hasCollapsedObs.set(s),this.isInitialized||(this.isInitialized=!0),N.a.fireEvent("itemsUpdated",[this])}},{key:"runItemSearch",value:function(t){v.default.searchVMLIs(t)}},{key:"updateOutline",value:function(t,e){var i,r=0,a=[],n={},o=this.getItem().levelsDeep.get();if(e){var u=0,s=0,h=[];for(i=0;i<t.length;i++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;t[i].isNote()||h.push({item:t[i],index:h.length})}for(h.sort(e),t=[],i=0;i<h.length;i++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var d=h[i].item;t.push(d),d.hasNote()&&t.push(d.getNote())}}for(i=0;i<t.length;i++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var c=t[i],v=new B.a({type:"blockItem",item:c,id:c.id,index:i,parentObject:n[c.parent().id],levelsDeep:(c.isNote()?c.parent():c).levelsDeep.get()-o-1,sizeInPane:c.sizeInPane});n[c.id]=v,this.addPaneObject(a,v)}this.items.set(a)}},{key:"_setItems",value:function(t,e){this.updateOutline(t)}},{key:"setItems",value:function(t,e){!e&&this._searchShowHierarchy===this.search.showHierarchy()&&t.equals(this._allPaneItems)||(this._allPaneItems=t,this.paneObjectsByItem={},this._setItems(t,e),F.a.getPane()===this&&F.a.checkValid())}},{key:"updateHeaders",value:function(t){var e=[],i=this.getHeaderSearchParams();i.each=function(t){e.push(t)},v.default.searchVMLIs(i),this._numHeaderComputes++,this.setHeaders(e,t)}},{key:"setHeaders",value:function(t,e){!e&&t.equals(this.headers.get())||this.headers.set(t)}},{key:"clearItems",value:function(t){this.items.set([],t)}},{key:"onLoad",value:function(){this.isLoaded=!0,this.getItemStore()===v.default.itemStoreManager.getDefaultItemStore()&&N.a.listen("itemNoteSet",this._infiniteList.handleItemNoteSet),this._onAfterLoadedRAF=requestAnimationFrame(this.onAfterLoaded.bind(this))}},{key:"onInfiniteListLoaded",value:function(){}},{key:"onInfiniteListMounted",value:function(){}},{key:"onAfterLoaded",value:function(){this._onAfterLoadedRAF=void 0,this._didInitialScroll||this.isDestroyed()||(isNaN(this.initialOffset)&&(this.initialOffset=this.defaultOffset),0!==this.initialOffset&&this.setScrollOffset(this.initialOffset),this._didInitialScroll=!0,this._infiniteList.saveScrollOfTop()),this.isFakePane&&(this.isFakePane=!1,this.becomeReal())}},{key:"getSize",value:function(){return{width:this.getWidth(),height:this.getHeight()}}},{key:"getWidth",value:function(){var t=this.rect.get().width;try{h.default.PAssert(1663,t>100,"Pane width is not set",this.rect.get())}catch(e){h.default.reportError(e)}return t>100?t:l.a.isMobile?l.a.windowWidth():void 0}},{key:"getHeight",value:function(){return this.rect.get().height-this.headerHeight()}},{key:"getLeft",value:function(){return this.rect.get().left}},{key:"toggleOverviewVisibility",value:function(){this.overview.toggleDesktop()}},{key:"notifyDropFrom",value:function(t,e){}},{key:"notifyDropFromToEdit",value:function(t,e){if(!t.hasChildren()&&t.hasAttachmentType(c.a.PluginType.Storage))return t.getAttachmentByType(c.a.PluginType.Storage).getPlugin().notifyDropFromToEdit(t,e);var i=document.createElement("ul");return i.innerHTML=U.a.toDropHtml(t),i}},{key:"dropEffectCopyBehavior",value:function(t,e){return t.clone(e,c.a.ChangeType.Local)}},{key:"_isNodeTextParent",value:function(t){return _.every(function(e){return!t.classList.contains(e)})}},{key:"convertElementToText",value:function(t){var e="";if("TEXTAREA"===t.nodeName)e+=t.value;else if(t.nodeType===Node.TEXT_NODE)e+=t.nodeValue;else if(t.classList.contains("plugin"))e+=c.a.AttachChar;else if(this._isNodeTextParent(t))for(var i=0,r=0;r<t.childNodes.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e+=this.convertElementToText(t.childNodes[r])}return e}},{key:"onFinishedEditingAndroid",value:function(t){setTimeout(this.updateItems,0)}},{key:"setDetectedEnterAndroid",value:function(){var t=this;this._hasDetectedEnterAndroid=!0,setTimeout(function(){t._hasDetectedEnterAndroid=!1},0)}},{key:"compositionStart",value:function(){F.a.isComposing=!0}},{key:"compositionEnd",value:function(t){F.a.isComposing=!1}},{key:"addItemToPane",value:function(t,e){var i=this.getItem();t.text||(t.text=""),this.setIgnoreRestoreScroll();var r=i.addItemAtIndex(t,e,this);return J.a.setSelected([e],this),r}},{key:"archiveItem",value:function(t,e){return e.archiveSelf(c.a.ChangeType.Local)}},{key:"archiveSelected",value:function(t){var e=this,i=0,r=this.indexOfPrevVMLI(F.a.getStartIndex(),!0,!0);if(this.applyToSelection(function(t){e.archiveItem(!0,t)&&i++}),i>0){if(r<0&&this.numItems()>0&&(r=this.indexOfFirstItem()),r>=0){var a=this.itemAtIndex(r).getParsedText().length;F.a.selectIndex(r,a)}var n=i>1?" items.":" item.";v.default.toasts.pushMessage({text:"Archived "+i+n,action:c.a.MessageAction.Undo,hold:l.a.isMobile,timeout:l.a.isMobile?void 0:8e3})}}},{key:"deleteSelected",value:function(t,e){var i=this.indexOfPrevVMLI(F.a.getStartIndex(),!0,!0),r=0;if(this.applyToSelection(function(e){t&&!t(e)||e.isDeleted()||(r+=e.numChildrenRecursive()+1,e.deleteSelf(c.a.ChangeType.Local))}),i<0&&this.numItems()>0&&(i=this.indexOfFirstItem()),i>=0){var a=this.itemAtIndex(i);if(a){var n=a.getParsedText().length;F.a.selectIndex(i,n)}else F.a.reset()}var o=r>1?" items.":" item.";v.default.toasts.pushMessage({text:"Deleted "+r+o,action:c.a.MessageAction.Undo,timeout:c.a.ToastTimeoutDefault})}},{key:"handleLeftSideTap",value:function(t,e){var i=t.item;if(this.supportCollapsing)if(l.a.mac&&e.metaKey||!l.a.mac&&e.ctrlKey)this.zoomIn(i);else if(i.isCollapsible()){var r=F.a.save(),a=!this.isPaneObjectCollapsed(t);e.shiftKey?this.collapseAll(i,a,!0):this.setPaneObjectCollapsed(a,t),r&&(l.a.isMobile?r.startItem&&!r.startItem.isDescendantOf(i)||F.a.closeKeyboard():this.restoreSelectionAfterCollapse(r,i))}}},{key:"handleRightSideTap",value:function(t,e){this.supportCompleting&&(h.default.beginCompleteAction(),t.setComplete(!t.isComplete(),c.a.ChangeType.Local),h.default.endCompleteAction())}},{key:"onClickTitle",value:function(t){this.zoomOut(t),h.default.sendEvent("Menu","Title")}},{key:"onDoubleClickTitle",value:function(){this.toggleCollapseAll()}},{key:"onTapStart",value:function(t){if(!h.default.findParent(t.target,"itemNotInPane")&&!h.default.hasClass(t.target,"androidInput")){var e,i;if(this.getInfiniteList(!1).reMount(),this.getInfiniteList(!0).reMount(),l.a.isMobile&&(l.a.useCustomScroller&&h.default.preventDefault(t),h.default.touchHoldTimeout&&clearTimeout(h.default.touchHoldTimeout),O.isInMultiselect()||this.isOverviewVisible()||(i=h.default.getItemForElement(t.target))&&(h.default.touchHoldTimeout=setTimeout(this.onTouchHoldTimeout,h.default.isKeyboardOpen?h.default.iOSDragTimeKeyboardOpen:h.default.iOSDragTime,t))),!l.a.isMobile||!O.start(t)){F.a.setFocusedPane(this),i=h.default.getItemForElement(t.target);var r=h.default.getIndexForElement(t.target);if(l.a.isMobile&&!i)h.default.getPaneForElement(t.target)===this&&this.indexOfLastItem()>=0&&(i=this.getLastItem(),r=this.indexOfLastItem());if(i&&i.onStart&&i&&i.onStart){var a=this.objectAtIndex(r);(e=i.onStart(r,a,t))&&h.default.preventAndStop(t)}}this._startPrevented=e}}},{key:"onTapMove",value:function(t){if(h.default.isAttachedToDoc(t.target)&&!h.default.findParent(t.target,"itemNotInPane")&&!h.default.hasClass(t.target,"androidInput")){if(l.a.isMobile&&h.default.touchHoldTimeout&&(clearTimeout(h.default.touchHoldTimeout),h.default.touchHoldTimeout=void 0),l.a.isMobile&&Z.a.hide(),!l.a.isMobile||!O.update(t)){var e=h.default.getItemForElement(t.startSrc),i=!1;if(l.a.isMobile&&!e)h.default.getPaneForElement(t.target)===this&&this.indexOfLastItem()>=0&&(e=this.getLastItem(),i=!0);v.default.DragDrop.isDragging&&(e=v.default.DragDrop.dragItem),e&&e.onMove&&e.onMove(t,i)}return!1}}},{key:"onTapClick",value:function(t){if(!h.default.findParent(t.target,"itemNotInPane")&&!h.default.hasClass(t.target,"androidInput")&&(!l.a.isMobile||!O.onClickPane(t))&&!this._startPrevented){var e,i=h.default.getItemForElement(t.startSrc);if(l.a.isMobile&&!i&&h.default.hasClass(t.startSrc,"paneScroller")&&(i=this.getLastItem(),e=this.numItems()-1,(i&&t.clientX<i.getPadding(this)||t.clientX>this.getWidth()-h.default.SPThresholdRight)&&(i=void 0)),i&&(t.targetItem=i),i&&i.onClick){void 0===e&&(e=h.default.getIndexForElement(t.startSrc));var r=this.objectAtIndex(e);this.onClickItem(e,i,r,t)}else h.default.hasClass(t.startSrc,"paneDataPageLoad")||t.startSrc.parentElement&&h.default.hasClass(t.startSrc.parentElement,"paneDataPageLoad")?this.getItem().hasPaginationToken()&&this.requestDataPage(this.getItem()):h.default.hasClass(t.startSrc,"agendaCollapser")||l.a.isMobile&&h.default.hasClass(t.startSrc,"dateHeader")||(this.isWriteable&&0===this.numItems()&&this.canAddItem&&!h.default.hasClass(this.paneContent,"loading")?this.addItem(t):h.default.preventDefault(t))}}},{key:"onTapEnd",value:function(t){F.a._isMouseDown=!1,l.a.isMobile&&h.default.touchHoldTimeout&&(clearTimeout(h.default.touchHoldTimeout),h.default.touchHoldTimeout=void 0),l.a.isMobile&&!this.isOverviewVisible()&&O.end(t);var e=t.targetItem||h.default.getItemForElement(t.startSrc);l.a.isMobile&&!e&&this.indexOfLastItem()>=0&&(e=this.getLastItem()),v.default.DragDrop.isDragging&&(e=v.default.DragDrop.dragItem),e&&("paneContent"===t.startSrc.id&&h.default.preventDefault(t),e&&e.onEnd&&e.onEnd(t))}},{key:"onTapDoubleClick",value:function(t){if(!h.default.findParent(t.target,"itemNotInPane")){var e=h.default.getItemForElement(t.startSrc);if(e&&e.onDoubleClick){var i=h.default.getIndexForElement(t.startSrc);this.onDoubleClickItem(i,e,t)}}}},{key:"onTapRightClick",value:function(t){if(!h.default.findParent(t.target,"itemNotInPane")&&!h.default.isDisplayModeActive(c.a.DisplayMode.NoRightClick)){F.a.setFocusedPane(this);var e=h.default.getItemForElement(t.target);if(e&&e.onRightClick){var i=h.default.getIndexForElement(t.target);this.onRightClickItem(i,e,t)}g.e.miscAction({type:g.c.Misc,misc:g.a.RightClick,data:{element:void 0,pane:this}})}}},{key:"onClickItem",value:function(t,e,i,r){!l.a.isMobile&&e.isNote()||e.onClick(t,i,r)}},{key:"onRightClickItem",value:function(t,e,i){e.onRightClick(t,i)}},{key:"onDoubleClickItem",value:function(t,e,i){e.onDoubleClick(t,i)}},{key:"addItem",value:function(t,e){var i=this;v.default.PaneUpdateBatcher.beginUpdateItems(),e||(e={text:""}),e.text=v.default.settings.getDefaultItemText()+e.text,F.a.reset();var r=this.addItemToPane(e,0),a=this.indexOfItem(r);if(l.a.isMobile&&J.a.setSelected([0],this),this.paneContent&&(F.a.focusPane(this),a>=0)){var n=l.a.isMobile?0:e.text.length;F.a.selectIndex(a,n)}v.default.PaneUpdateBatcher.commitUpdateItems(),l.a.isMobile&&t&&setTimeout(function(){h.default.openKeyboardOnIndex(t,i,a,function(){i.setFocused(!0)},function(){})},0),h.default.sendEvent("Menu","AddItemButton")}},{key:"onClose",value:function(){}},{key:"onTapAddItem",value:function(t){var e=this;l.a.isMobile?this.isOverviewVisible()||(F.a.setFocusedPane(this),this.getScrollOffset()>this.topBoxHeight.get()?this.setScrollOffset(0,c.a.ScrollDuration.Default,function(){e._infiniteList.saveScrollOfTop(),e.onTapAddItem(t)}):this.addItem(t,{text:"",date:this.isViewAgenda()?(new Date).clearTime():void 0})):this.addItem(t)}},{key:"onTapOverviewButton",value:function(){this.toggleOverviewVisibility(),this.isOverviewVisible()?h.default.sendEvent("Menu","OpenOverview"):h.default.sendEvent("Menu","CloseOverview")}},{key:"onTapClosePane",value:function(){var t=v.default.PaneManager.removePane(this);if(t){try{h.default.PAssert(1664,t===this.id,"Pane IDs must match")}catch(e){h.default.reportError(e)}g.e.performAction(g.c.UIAction,{type:g.d.RemovePane,data:t}),h.default.sendEvent("Menu","ClosePane"),v.default.tooltip.hideTip(),this.onClose()}}},{key:"onClickArchiveCompleted",value:function(t){this.archiveCompleted(),h.default.preventAndStop(t),h.default.sendEvent("Menu","ArchiveCompleted")}},{key:"onClickRefreshData",value:function(t){try{h.default.PAssert(1665,this.supportDataRefresh,"How did this pane try to perform a data refresh if it is not supported",this.type)}catch(e){h.default.reportError(e)}this.refreshPaneData(),h.default.sendEvent("Menu","PaneDataRefresh"),h.default.preventAndStop(t)}},{key:"onClickReportError",value:function(t){try{h.default.PAssert(1666,this.supportReportError,"Pane does not support error reporting")}catch(e){h.default.reportError(e)}this.reportPaneError(),h.default.sendEvent("Menu","PaneReportError"),h.default.preventAndStop(t)}},{key:"refreshPaneData",value:function(){}},{key:"reportPaneError",value:function(){}},{key:"getItemsToArchive",value:function(){var t=[];return v.default.searchVMLIs({item:this.getItem(),each:function(e){e.isComplete()&&!e.isNote()&&t.push(e)}}),t}},{key:"archiveCompleted",value:function(){var t,e,i,r=0;if(F.a.isValid()){var a=0;for(e=F.a.getEndIndex();e<this.items.length();){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;if((i=this.itemAtIndex(e))&&!this.itemAtIndex(e).hasCompletedAncestor()){t=this.objectAtIndex(e);break}e++}}var n=this.getItemsToArchive();for(g.e.beginAction(),v.default.PaneUpdateBatcher.beginUpdateItems(),e=n.length-1;e>=0;e--){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;i=n[e],h.default.shouldLog(c.a.LogLevels.Data)&&h.default.log("Archive Item: ",i.getParsedText()),i.archiveSelf(c.a.ChangeType.Local)}if(v.default.PaneUpdateBatcher.commitUpdateItems(),g.e.endAction(),n.length>0){var o=n.length>1?" items.":" item.";v.default.toasts.pushMessage({text:"Archived "+(n.length+o),action:c.a.MessageAction.Undo,hold:l.a.isMobile,timeout:l.a.isMobile?void 0:8e3})}else v.default.toasts.pushMessage({text:"No completed items to archive"});if(!l.a.isMobile&&t){var u=this.indexOfObject(t);if(u>=0){i=this.itemAtIndex(u);try{h.default.PAssert(1667,i,"Could not restore selection to item")}catch(d){h.default.reportError(d)}if(i){var s=i.getParsedText().length;F.a.selectIndex(u,s)}}}else F.a.reset()}},{key:"updatePosition",value:function(t,e){this.isAnimatingOffset=e,t=Math.round(t),this.offsetX.set(t)}},{key:"updatePositionMobile",value:function(){l.a.isMobile&&this.updatePosition(this.isOverviewVisible()?O.overviewWidth():0)}},{key:"bottomListMessage",value:function(){}},{key:"isSearchingRemote",value:function(){return!1}},{key:"getTitleList",value:function(){return this.getItem().parents().concat(this.getItem())}},{key:"itemTitle",value:function(){return this.getItem().parent()?this.getItem().getParsedText():this.titleOfFirstItem()}},{key:"titleOfFirstItem",value:function(){return this.getDocument().text.get()}},{key:"onShowArchivedChanged",value:function(){this.showArchived.get()&&N.a.fireEvent("showArchived",[]),this.updateItems()}},{key:"indexOfFirstItem",value:function(){return this.indexOfNextVMLI(-1)}},{key:"indexOfLastItem",value:function(){return this.indexOfPrevVMLI(this.numItems(),!1,!0)}},{key:"getFirstItem",value:function(){var t=this.indexOfFirstItem();if(t>=0){var e=this.getItems()[t];return e?e.item:void 0}}},{key:"getFirstObject",value:function(){return this.objectAtIndex(this.indexOfFirstItem())}},{key:"getLastItem",value:function(){return this.itemAtIndex(this.indexOfLastItem())}},{key:"getLastObject",value:function(){return this.objectAtIndex(this.indexOfLastItem())}},{key:"setFocused",value:function(t){t&&this.paneContent&&this.paneContent.focus(),this.isFocused.set(t)}},{key:"headerHeight",value:function(){return l.a.isMobile?0:68}},{key:"handleUndo",value:function(){$.a.undo()}},{key:"handleRedo",value:function(){$.a.redo()}},{key:"contentTop",value:function(){return v.default.DesktopUI.topBarHeight()+this.headerHeight()}},{key:"indexPageUp",value:function(t){return t=this._infiniteList.indexPageUp(t),this.itemAtIndex(t)||(t=this.indexOfNextVMLI(t)),t}},{key:"indexPageDown",value:function(t){return t=this._infiniteList.indexPageDown(t),this.itemAtIndex(t)||(t=this.indexOfPrevVMLI(t)),t}},{key:"adjustSelectionFromPaneObject",value:function(t){try{h.default.PAssert(1668,t,"Must pass in a valid saved selection")}catch(i){h.default.reportError(i)}var e=t;return t.startItem&&t.endItem&&(t.startIndex=this.indexOfObject(t.startObject),t.endIndex=this.indexOfObject(t.endObject),(t.startIndex<0||t.endIndex<0)&&(e=void 0)),e}},{key:"restoreSelection",value:function(t){try{h.default.PAssert(1669,t,"Must always have a valid saved selection")}catch(u){h.default.reportError(u)}if(t){var e=this.indexOfObject(t.startObject),i=this.indexOfObject(t.endObject);if(e>=0&&i>=0){var r=t.startOffset,a=t.endOffset,n=t.startItem.getParsedText(),o=t.endItem.getParsedText();(r<0||r>n.length||a<0||a>o.length)&&(r=-1,a=-1),F.a.selectIndices(e,r,i,a)}else F.a.reset()}else F.a.reset()}},{key:"restoreSelectionAfterCollapse",value:function(t,e){if(t){var i,r,a=t.startItem,n=this.indexOfItem(t.startItem),o=this.indexOfItem(t.endItem);if(n>=0&&o>=0)F.a.selectIndices(n,t.startOffset,o,t.endOffset),i=t.startItem;else if(n>=0)F.a.selectIndex(n,t.startOffset),i=t.startItem,r=!0;else if(o>=0)F.a.selectIndex(o,t.endOffset),i=t.endItem,r=!0;else if(!0===e){var u=0;for(i=a;i;){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var s=i.parent();if(s===h.default.focusedPane.item.get()){F.a.selectItem(i,i===a?F.a.getStartOffset():-1),r=!0;break}i=s}}else F.a.reset();i&&r&&h.default.focusedPane.scrollItemToMiddle(i,c.a.ScrollDuration.Snap)}}},{key:"setCollapsedRecursive",value:function(t,e,i){var r=0,a=t.numChildren(),n=t.getItems();!i||this.isSearchedFlat()&&!this.search.isMatched(t)||t.setCollapsed(e,this,!1,!1);for(var o=0;o<a;++o){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var u=n[o];u.hasChildren()&&(this.isSearchedFlat()||this.search.isMatched(u))&&this.setCollapsedRecursive(u,e,!0)}}},{key:"collapseAll",value:function(t,e,i,r){try{h.default.PAssert(1670,this.supportCollapsing,"Should not be collapsing all")}catch(o){h.default.reportError(o)}var a=t||this.item.get(),n=F.a.save();this.setIgnoreRestoreScroll(),v.default.PaneUpdateBatcher.beginUpdateItems(),void 0!==e&&this.setCollapsedRecursive(a,e,!!i),this.saveState(),(r||this.isSearchedFlat())&&this.updateItems(),v.default.PaneUpdateBatcher.commitUpdateItems(),this.restoreSelectionAfterCollapse(n,e)}},{key:"toggleCollapseAll",value:function(){if(this.supportCollapsing){var t=!this.hasCollapsed();this.collapseAll(this.item.get(),t)}}},{key:"hasCollapsed",value:function(t){for(var e=0,i=(t=t||this.item.get()).numChildren(),r=t.getItems(),a=0;a<i;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=r[a];if(n.hasChildren()&&(this.isSearchedFlat()||this.search.isMatched(n))){if(n.isCollapsed(this,!1))return!0;if(this.hasCollapsed(n))return!0}}return!1}},{key:"onOverviewToggled",value:function(t){}},{key:"onTouchHoldTimeout",value:function(t){l.a.isMobile&&(h.default.touchHoldTimeout=void 0,O.disable(),N.a.fireEvent("touchHoldTimeout",[t]))}},{key:"getPaddingForPaneObject",value:function(t,e){var i=t.levelsDeep,r=e?t:t.item,a=!e&&this.isSearchedFlat()?v.default.DisplaySettings.itemIndentStart():r.getPadding(this,e,i);return a>this.getWidth()-h.default.SPThresholdRight&&(a=this.getWidth()-h.default.SPThresholdRight-8),a}},{key:"maxWidthOfPaneObject",value:function(t){var e=this.getPaddingForPaneObject(t,!1);return this.getWidth()-e-h.default.SPThresholdRight-(t.item.hasPrefix()?this.shouldRenderPrefix(t)?c.a.PrefixWidth:5:0)}},{key:"prevPaneObjectAtSameLevel",value:function(t){var e=0;try{h.default.PAssert(1671,t>=0,"Must supply a valid selection index: "+t)}catch(o){h.default.reportError(o)}try{h.default.PAssert(1672,t<this.numItems()+1,"Must supply a valid selection index: "+t)}catch(o){h.default.reportError(o)}for(var i=this.objectAtIndex(t),r=t-1;r>=0;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=this.objectAtIndex(r),n=this.itemAtIndex(r);if(n&&i.item!==n&&!n.isNote()&&a.levelsDeep===i.levelsDeep)return a;r--}}},{key:"indexOfPrevVMLI",value:function(t,e,i){var r=0;try{h.default.PAssert(1673,t>=0,"Must supply a valid selection index: "+t)}catch(u){h.default.reportError(u)}try{h.default.PAssert(1674,t<this.numItems()+1,"Must supply a valid selection index: "+t)}catch(u){h.default.reportError(u)}for(var a=e?this.itemAtIndex(t):void 0,n=t-1;n>=0;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=this.itemAtIndex(n);if(o&&a!==o&&(!i||!o.isNote()))return n;n--}return-1}},{key:"indexOfNextVMLI",value:function(t,e,i){var r=0;try{h.default.PAssert(1675,t>=-1,"Must supply a valid selection index: "+t)}catch(u){h.default.reportError(u)}try{h.default.PAssert(1676,t<this.numItems(),"Must supply a valid selection index: "+t)}catch(u){h.default.reportError(u)}for(var a=e?this.itemAtIndex(t):void 0,n=t+1;n<this.numItems();){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=this.itemAtIndex(n);if(o&&a!==o&&(!i||!o.isNote()))return n;n++}return-1}},{key:"indexOfNextSibling",value:function(t){var e=0;try{h.default.PAssert(1677,t>=-1,"Must supply a valid selection index: "+t)}catch(r){h.default.reportError(r)}try{h.default.PAssert(1678,t<this.numItems(),"Must supply a valid selection index: "+t)}catch(r){h.default.reportError(r)}var i=this.itemAtIndex(t);for(t=this.indexOfNextVMLI(t);t>=0;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;if(!this.itemAtIndex(t).isDescendantOf(i))break;t=this.indexOfNextVMLI(t)}return t>=0?t:-1}},{key:"_getPrevNextItem",value:function(t,e,i){var r=i?this.indexOfNextVMLI:this.indexOfPrevVMLI,a=r.call(this,t);if(e)for(var n=0,o=this.itemAtIndex(t);a>=0;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=this.itemAtIndex(a);if(o.parent()===u.parent())return u;if(o.parent()===u||u.parent()===o.parent().parent()){a=-1;break}a=r.call(this,a)}else if(a>=0)return this.itemAtIndex(a)}},{key:"getPreviousItem",value:function(t,e){return this._getPrevNextItem(t,e,!1)}},{key:"getNextItem",value:function(t,e){return this._getPrevNextItem(t,e,!0)}},{key:"getFirstSelectedItem",value:function(){var t;return this.applyToSelection(function(e){return t=e,!1}),t}},{key:"getFirstSelectedIndex",value:function(){return F.a.getStartIndex()}},{key:"applyToSelection",value:function(t,e){if(l.a.isMobile&&O.isInMultiselect())J.a.applyFnToSelected(t,this);else{var i=0;try{h.default.PAssert(1679,!e||!e.restoreSelection,"restoreSelection is no longer a valid option")}catch(n){h.default.reportError(n)}g.e.beginAction(),$.a.beginAction();var r=F.a.getSelectedObjects();v.default.PaneUpdateBatcher.beginUpdateItems();for(var a=0;a<r.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(!1===t(r[a].item,a,r.length,r[a]))break}v.default.PaneUpdateBatcher.commitUpdateItems(),$.a.endAction(),g.e.endAction()}}},{key:"applyFnToSelection",value:function(t,e){var i=F.a.save(),r=e&&e.toggle,a=!e||void 0===e.value||e.value,n=e&&void 0!==e.value2?e.value2:void 0;if(this.applyToSelection(function(e){r&&e[r]()!==a&&(r=void 0),r||e[t](a,n)}),r){var o=o=!(!e||void 0===e.emptyValue)&&e.emptyValue;this.applyToSelection(function(e){e[t](o,n)})}i&&!e.noRestoreSel&&this.restoreSelection(i)}},{key:"applyPriorityToSelection",value:function(t,e){e?this.applyFnToSelection("setPriority",{toggle:"getPriority",value:t,value2:c.a.ChangeType.Local,emptyValue:c.a.VMLIFlag.None}):this.applyFnToSelection("setPriority",{value:t,value2:c.a.ChangeType.Local})}},{key:"autocompleteTag",value:function(){this._autocompletePopup({mode:"tag",text:"Add tag",buttonText:"Add"},function(t,e){var i=e.value.trim(),r=t.getParsedText()+" "+c.a.TagPrefix+i;t.setText(r,c.a.ChangeType.Local)})}},{key:"autocompleteMove",value:function(t,e){var i=this;(t=t||{}).mode=c.a.AutocompleteMode.Move,t.text="Select item to move to",t.documentSelector=!this.supportsDocuments,t.buttonText="MOVE",this._autocompletePopup(t,function(t,e){var r;e.subItemText?(r=i.createVMLI({text:e.subItemText},{parent:e.item,changeType:c.a.ChangeType.AllLocal}),e.item.insertItem(r,0)):e.item===t||e.item.isDescendantOf(t)||(r=e.item),r&&i.moveItem(t,r)},function(){e&&e(),F.a.updateCaret()})}},{key:"autocompleteJump",value:function(t,e){var i=this;(t=t||{}).mode=c.a.AutocompleteMode.Jump,t.text="Select item to jump to",t.buttonText="JUMP",this._autocompletePopup(t,function(){},function(t){t.item&&i.indexOfItem(t.item)>=0&&(F.a.selectItem(t.item,0,0),i.scrollItemToTop(t.item,c.a.ScrollDuration.Default)),e&&e(),F.a.updateCaret()})}},{key:"autocompleteSnooze",value:function(t,e,i){var r,a=this,n=v.default.pluginManager.getPlugin(c.a.PluginID.Gmail);if(!e){var o=t&&t.item||this.getFirstSelectedItem();o&&(r=o.getAttachmentByPlugin(n.id))&&(e=r.getField("accountID"))}b.a.isLoaded?(v.default.toasts.clearMessage(c.a.MessageID.SnoozeOffline),(t=t||{}).mode="snooze",t.text="Snooze until date",t.buttonText="SNOOZE",t.allowCustom=!0,this._autocompletePopup(t,function(e,i){n.beginAction();var o=i.value.trim(),u=v.default.International.parseDateDefaultFormat(o);if(r=e.getAttachmentByPlugin(n.id))if(h.default.isDateValid(u))if(b.a.isAuthorizedForScopes(r.getField("accountID"),[c.a.GScope.GmailModify])){var s=u.getTime()-Date.now();s<h.default.weeks(1)?n.performAction(c.a.PluginAction.Gmail.Snooze,!1,r,s):v.default.toasts.pushMessage({text:"Maximum snooze delay is one week. Please enter a date less than a week from now.",action:c.a.MessageAction.Okay})}else v.default.menus.closeContextMenu(),function(){var e=t&&t.elementDisplay;if(!e){var i=a.getFirstSelectedIndex();e=a.elementAtIndex(i)}v.default.menus.openContextMenu({componentName:"ReactContextMenuAuthorize",element:e,message:"Your account needs additional authorization to Snooze. Please update your authorization to enable Snooze."})}();else v.default.toasts.pushMessage({text:"Unable to read date. Please try a different option.",action:c.a.MessageAction.Okay});else v.default.toasts.pushMessage(c.a.MessageID.ReselectEmail);n.endAction()},i)):v.default.toasts.pushMessage(c.a.MessageID.SnoozeOffline)}},{key:"autocompleteSchedule",value:function(t,e){(t=t||{}).mode="date",t.text="Add event on date",t.buttonText="Add",t.allowCustom=!0;var i=v.default.pluginManager.getPlugin(c.a.PluginID.Gmail);this._autocompletePopup(t,function(t,e){g.e.beginAction();var r=e.value.trim(),a=v.default.International.parseDateDefaultFormat(r);h.default.isDateValid(a)?i.scheduleEmail(t,a):v.default.toasts.pushMessage({text:"Unable to read date. Please try a different option.",action:c.a.MessageAction.Okay}),g.e.endAction()},e)}},{key:"autocompleteLabel",value:function(t,e){var i,r=this,a=v.default.pluginManager.getPlugin(c.a.PluginID.Gmail),n=function(t){var e=t.getAttachmentByPlugin(a.id),r=e.getPlugin().getDisplayTags(e);i=i?h.default.arrayIntersection(i,r):r};(t=t||{}).item?n(t.item):this.applyToSelection(n),t.tokens=(i||[]).map(function(t){return{text:t}}),t.mode=c.a.AutocompleteMode.GmailLabel,t.text="Select a label",t.buttonText="LABEL",t.allowCustom=!0,t.allowEmpty=!0,t.onTokenRemoved=function(i){var n=i.text;a.beginAction();var o=function(t){var e=t.getAttachmentByPlugin(a.id);if(e)if(a.attachmentHasLabel(e,n))a.performAction(c.a.PluginAction.Gmail.RemoveLabel,!1,e,n);else try{h.default.PAssert(1680,!1,"Tried to remove a tag from an attachment without a tag")}catch(i){h.default.reportError(i)}else v.default.toasts.pushMessage(c.a.MessageID.ReselectEmail)};t.item?o(t.item):r.applyToSelection(o),a.endAction(),e&&e(i)},this._autocompletePopup(t,function(t,e){var i=e.value.trim();try{h.default.PAssert(1681,t.hasPluginAttachment(a.id),"Must have valid plugin attachment")}catch(o){h.default.reportError(o)}var r=t.getAttachmentByPlugin(a.id);if(r){if(i){var n=a.createLabelString(i);n?a.attachmentHasLabel(r,n)||a.performAction(c.a.PluginAction.Gmail.AddLabel,!1,r,n):v.default.toasts.pushMessage({text:"Cannot create a label with a reserved named.",action:c.a.MessageAction.Okay})}}else v.default.toasts.pushMessage(c.a.MessageID.ReselectEmail)})}},{key:"_autocompletePopup",value:function(t,e,i){var r=this;if(!l.a.isMobile&&!t.elementDisplay){var a=F.a.getStartIndex(),n=this.elementAtIndex(a);t.elementDisplay=n}var o=t.item,u=t;u.pane=this,u.item||(u.item=this.getRootItem()),u.onSelected=function(t){o?e(o,t):r.applyToSelection(function(i){e(i,t)}),i&&i(t)},Z.a.showPopup(u)}},{key:"moveItem",value:function(t,e,i){if(g.e.beginAction(),v.default.PaneUpdateBatcher.beginUpdateItems(),e.belongsToSameItemStore(t))t.moveTo({parent:e,index:0},c.a.ChangeType.Local);else{var r=this.dropEffectCopyBehavior(t,e);r.setParent(e),e.insertItem(r)}v.default.PaneUpdateBatcher.commitUpdateItems(),g.e.endAction()}},{key:"setPropDefault",value:function(t,e){void 0===this[t]&&(this[t]=e)}},{key:"setExpanded",value:function(t,e){var i=this.isExpanded.get()!==t;this.isExpanded.set(t),i&&!1!==e&&(N.a.fireEvent("panesChanged",[]),this.saveState(),v.default.PaneManager.ensurePaneInView(this))}},{key:"modifyTextOnDropBasedOnSearch",value:function(t,e,i,r,a,n){var o=0;if(!i||!i.search)return t;var u,s,h=i.search,d=this.search,c=e[n](),v=h[n](),y=d[n](),g=[],l=[];for(u=0;y&&u<y.length;u++){var p=0;if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;s=y[u];for(var m=r,f=!c||c.indexOf(s)<0;f&&m;){if(p++>5e3&&__infLoop&&__infLoop(p))throw new RangeError;var k=m[n]();k&&k.indexOf(s)>=0&&(f=!1),m=m.parent()}f&&g.push(a+s)}if(g.length){var A=0;for(u=0;c&&v&&u<v.length;u++){if(A++>5e3&&__infLoop&&__infLoop(A))throw new RangeError;s=v[u],c.indexOf(s)>=0&&y.indexOf(s)<0&&l.push(a+s)}var S=g.join(" ");if(l.length>0){var w=0;for(u=0;u<l.length;u++){if(w++>5e3&&__infLoop&&__infLoop(w))throw new RangeError;s=l[u],t=0===u?t.replace(s,S):t.replace(s,"")}}else t=t+" "+S;t=t.replace(/  +/g," ")}return t}},{key:"canAcceptDragOver",value:function(t,e,i,r){return this.isDropTarget}},{key:"handleDragOver",value:function(t,e,i,r,a){var n=h.default.getElementParent(i),o=n&&h.default.getItemForElement(n),u=(n||h.default.findParent(i,"blockHeader"))&&h.default.getPaneObjectForElement(i),s={};return n&&h.default.findParent(n,"overviewList")?(this.overview.updateDragHoverItem(o),s={overview:!0,targetItem:o,targetElement:n}):(this.overview.updateDragHoverItem(null),s=this._handleDragOverPane(t,e,i,n,u,r,a)),s}},{key:"_handleDragOverPane",value:function(t,e,i,r,a,n,o){}},{key:"handleDragDrop",value:function(t,e,i,r){i&&t!==i.targetItem&&i.targetItem&&this._handleDragDrop(t,e.dataTransfer,i,e,r),this.revertDrag()}},{key:"_handleDragDrop",value:function(t,e,i,r,a){for(var n=0,o=i.overview,u=!0,s=e.pane,d=t,v=i.targetItem,y=v.parent();y&&u;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;y===t&&(u=!1),y=y.parent()}if(u){var p,m=-1;if(o)m=(p=v).numChildren();else if(i.dropOnPane)p=v,m=i.atEnd?v.numItems():0;else if(i.position===c.a.DragDropPosition.Above)p=v.parent(),m=v.getIndex();else if(i.position===c.a.DragDropPosition.On){p=v,m=l.a.mac&&r.ctrlKey||!l.a.mac&&r.altKey?0:v.numItems()}else{var f=this.indexOfItem(v),k=this.getNextItem(f);k&&k.parent()===v&&!k.isNote()?(p=v,m=0):(p=v.parent(),m=v.getIndex()+1)}g.e.beginAction();try{h.default.PAssert(1682,p,"Trying to move without a target")}catch(F){h.default.reportError(F)}try{h.default.PAssert(1683,!isNaN(m),"Trying to move without a target index")}catch(F){h.default.reportError(F)}var A=!0;if(e.dropEffect===c.a.DropEffect.Move){var S=t.parent();if(S){var w=t.getIndex();if(S.belongsToSameItemStore(p)){t.moveTo({parent:p,index:m},c.a.ChangeType.Local),g.e.performAction(g.c.Move,{itemID:t.id,oldParent:S.id,oldPosition:w,newParent:p.id,newPosition:m});var L=t.getRawText();L=this.modifyTextOnDropBasedOnSearch(L,t,s,p,c.a.TagPrefix,"getTags"),(L=this.modifyTextOnDropBasedOnSearch(L,t,s,p,c.a.ContactPrefix,"getContacts"))!==t.getRawText()&&t.setText(L,c.a.ChangeType.Local)}else t=t.clone(p,c.a.ChangeType.Local),p.insertItem(t,m),S.removeChildAtIndex(w,c.a.ChangeType.Local)}else t=t.clone(p,c.a.ChangeType.Local),p.insertItem(t,m)}else a||(t=e.pane?e.pane.dropEffectCopyBehavior(t,p):t.clone(p,c.a.ChangeType.Local)),t?(t.setParent(p),p.insertItem(t,m)):A=!1;A&&(N.a.fireEvent("droppedItem",[d,this,e.pane]),g.e.miscAction({type:g.c.Misc,misc:g.a.DropItem,data:{itemID:t.id,toPane:this,fromPane:e.pane}})),g.e.endAction(),A&&e.pane&&e.pane.notifyDropFrom(t,this)}}},{key:"revertDrag",value:function(){this.overview&&this.overview.updateDragHoverItem(null)}},{key:"isItemHeader",value:function(t,e){return e?t.hasHeaderChildren():t.hasVisibleChildren(this)}},{key:"onNotePopupClosed",value:function(){}},{key:"openNoteContextMenu",value:function(){var t=F.a.getStartItem(),e=F.a.getStartIndex(),i=e-1,r=F.a.getStartOffset(),a=F.a.getEndOffset(),n=this.elementAtIndex(e);if(n){try{h.default.PAssert(1684,n.firstChild,"Opening a note should have a firstChild",h.default.getElementPath(n))}catch(s){h.default.reportError(s)}n.firstChild&&(n=n.firstChild),void 0!==r&&void 0===a&&(a=r);var o={componentName:"ReactNotePopup",onClosed:this.onNotePopupClosed.bind(this),element:n,item:t.parent(),note:t,pane:this,noBackdrop:l.a.isMobile,index:e,position:"fill",selectionStart:r,selectionEnd:a};if(v.default.menus.isContextMenuOpen()&&v.default.menus.closeContextMenu(),l.a.isMobile){this._editingNote={note:t,index:e,itemIndex:i};var u=t.parent();o.bottom=l.a.getKBSize(),o.positionOffset={top:-12},this.scrollItemToTop(u,0,function(){v.default.menus.openContextMenu(o),O.setTopBarMode(c.a.TopBarMode.Note)})}else F.a.clearSelection(!0),o.positionOffset={left:-4,top:-18},v.default.menus.openContextMenu(o)}}},{key:"closeNoteContextMenu",value:function(){if(v.default.menus.isContextMenuOpen()){if(l.a.isMobile&&l.a.ios){var t=this._editingNote,e=t.note,i=t.itemIndex,r=e.parent().getParsedText().length;F.a.selectIndex(i,r),this._editingNote=void 0}v.default.menus.closeContextMenu()}}},{key:"canResetMultiselect",value:function(){return!0}},{key:"replaceTextOnDropOnBlock",value:function(t,e,i,r){var a=e.isNoKey?"":e.name,n=i&&i.name.replace(r,""),o=t.getRawText();(""===a||o.indexOf(a)<0)&&(n?o=o.replace(r+n,a):o+=" "+a,t.setText(o,c.a.ChangeType.Local))}},{key:"applyDropOnBlock",value:function(t,e,i,r){var a,n=t;if(F.a.setFocusedPane(i),n.isStarred||n.isImportant)n.isStarred?e.setStarred(!0,c.a.ChangeType.Local):n.p0||n.isImportant?a=c.a.VMLIFlag.P0:n.p1?a=c.a.VMLIFlag.P1:n.p2&&(a=c.a.VMLIFlag.P2),a&&e.setPriority(a,c.a.ChangeType.Local);else if(t.isTag)this.replaceTextOnDropOnBlock(e,t,r&&r.isTag?r:void 0,"#");else if(t.isContact)this.replaceTextOnDropOnBlock(e,t,r&&r.isContact?r:void 0,"+");else if(t.isPriority)e.setPriority(t.priority,c.a.ChangeType.Local);else{var o=v.default.pluginManager.getPluginGCalendar(),u=!0;if(e.hasAttachmentType(c.a.PluginType.Calendar)){var s=e.getAttachmentByType(c.a.PluginType.Calendar);s&&s.getField("recurringEventId")&&e.getCalendarParsedText()===s.getField("summary")?(v.default.toasts.pushMessage({text:"Moo.do does not currently support modifying repeated events.",actionText:"OKAY"}),u=!1):o.isEnabled()?o.hasWritePermissionForAttach(s)||(v.default.toasts.pushMessage({text:"This event is on a read-only calendar",actionText:"OKAY"}),u=!1):(v.default.toasts.pushMessage({text:"Cannot modify this event if the calendar plugin is disabled. Please enable the Google Calendar plugin.",action:c.a.MessageAction.OpenSettings}),u=!1)}if(u)if(e.setDate(t.date,t.duration||c.a.DefaultEventDuration,c.a.ChangeType.Local),h.default.isDateValid(n.date)&&o&&i!==this&&!e.hasAttachmentType(c.a.PluginType.Calendar))if(o.getDefaultExportCalendarID()){var d=v.default.pluginManager,y=c.a.PluginSettingsID.GCalendar.SyncDraggedEvents,g=function(){d.getSetting(c.a.PluginID.GCalendar,y)&&o.createEventForItem(e)};v.default.settings.shouldShowHelp("syncNewEvents")?v.default.menus.confirm("Add events to Google Calendar when dropping onto the Calendar pane?",function(t){v.default.settings.closeHelp("syncNewEvents"),d.setSetting(c.a.PluginID.GCalendar,y,t),g()}):g()}}if(i.isEditable){var l=i.indexOfItem(e,t);l>=0&&F.a.selectIndex(l,e.getParsedText().length)}}},{key:"setIgnoreRestoreScroll",value:function(t,e){var i=this;this._ignoreRestoreScroll=!0,this._ignoreRestoreScrollTimeout&&clearTimeout(this._ignoreRestoreScrollTimeout),this._ignoreRestoreScrollTimeout=setTimeout(function(){i._ignoreRestoreScroll=!1,e&&e()},t||100)}},{key:"isIgnoringRestoreScroll",value:function(){return this._ignoreRestoreScroll}},{key:"zoomInOnSwipe",value:function(t){var e=this,i=this.item.get();this.zoomIn(t),v.default.toasts.pushMessage({text:"<b>Zoomed in to:</b><br>"+t.getParsedText(),action:function(){e.zoomIn(i)},hold:!1,actionText:"UNDO"})}},{key:"collapseOnSwipe",value:function(t){this.supportCollapsing&&t.isCollapsible()&&t.toggleCollapsed(this)}},{key:"deleteOnSwipe",value:function(t){var e;(t.deleteSelf(c.a.ChangeType.Local),t.hasAttachmentType(c.a.PluginType.Email))?e=t.getAttachmentByType(c.a.PluginType.Email).getField("subject"):e=t.getParsedText();v.default.toasts.pushMessage({text:"<b>Deleted:</b><br>"+e,action:function(){g.e.undoAction()},hold:!1,actionText:"UNDO"})}},{key:"completeOnSwipe",value:function(t){this.supportCompleting&&(h.default.beginCompleteAction(),t.setComplete(!t.isComplete(),c.a.ChangeType.Local),h.default.endCompleteAction())}},{key:"getSwipeMenuItems",value:function(){var t=this;return{leftOuter:{text:"Zoom",icon:"icon-zoom-in",color:"#09d",fn:this.zoomInOnSwipe},leftInner:{text:function(e){return t.supportCollapsing&&e.isCollapsible()?e.isCollapsed(t,!1)?"Expand":"Collapse":"Zoom"},icon:function(e){return t.supportCollapsing&&e.isCollapsible()?"icon-"+(e.isCollapsed(t,!1)?"caret-down":"caret-right"):"icon-zoom-in"},color:function(e){return t.supportCollapsing&&e.isCollapsible()?"#777":"#09d"},fn:function(e){t.supportCollapsing&&e.isCollapsible()?(e.toggleCollapsed(t),F.a.closeKeyboard()):t.zoomInOnSwipe(e)}},rightInner:{text:function(t){return t.isComplete()?"Uncomplete":"Complete"},icon:"icon-check",color:"#0c0",fn:function(e){t.supportCompleting&&(h.default.beginCompleteAction(),e.setComplete(!e.isComplete(),c.a.ChangeType.Local),h.default.endCompleteAction())}},rightOuter:{text:"Delete",icon:"icon-delete",color:"#a30",fn:function(t){var e;(t.deleteSelf(c.a.ChangeType.Local),t.hasAttachmentType(c.a.PluginType.Email))?e=t.getAttachmentByType(c.a.PluginType.Email).getField("subject"):e=t.getParsedText();v.default.toasts.pushMessage({text:"<b>Deleted:</b><br>"+e,action:function(){g.e.undoAction()},hold:!1,actionText:"UNDO"})}}}}},{key:"getSwipeMenuItem",value:function(t,e){var i=l.a.windowWidth(),r=.16*i,a=.45*i,n=this.swipeMenuItems;return e>a?n.leftOuter:e>r?n.leftInner:e<-a?n.rightOuter:e<-r?n.rightInner:{color:"#ddd"}}},{key:"getSwipeMenuItemsNew",value:function(t){return{left:{text:t.isComplete()?"Uncomplete":"Complete",color:"#0c0",cb:this.completeOnSwipe},right:[{text:"Collapse",icon:t.isCollapsed(this)?"keyboard-arrow-up":"keyboard-arrow-down",color:"#777",cb:this.collapseOnSwipe},{text:"Zoom",icon:"zoom-in",color:"#09d",cb:this.zoomInOnSwipe},{text:"Delete",icon:"delete",color:"#a30",cb:this.deleteOnSwipe}]}}},{key:"_openSelectedInMode",value:function(t){var e=F.a.getStartItem();e&&this.openEmailByItem(e,t)}},{key:"replySelected",value:function(){this._openSelectedInMode(c.a.EmailResponseMode.Reply)}},{key:"replyAllSelected",value:function(){this._openSelectedInMode(c.a.EmailResponseMode.ReplyAll)}},{key:"forwardSelected",value:function(){this._openSelectedInMode(c.a.EmailResponseMode.Forward)}},{key:"openEmailByItem",value:function(t,e){if(t){var i=t.getAttachmentByPlugin(c.a.PluginID.Gmail);(i&&i!==v.default.EmailPreview.getThreadAttach()||!v.default.EmailPreview.isOpenOnPane(this)||e)&&i.getPlugin().openEmailByItem(t,this,e)}}},{key:"markItemRead",value:function(t,e){var i=h.default.vmMain.getDefaultEmailPlugin(),r=e.getAttachmentByPlugin(i.id),a=t?c.a.PluginAction.Gmail.MarkRead:c.a.PluginAction.Gmail.MarkUnread;try{h.default.PAssert(1686,r,"Must be able to get a valid attachment")}catch(n){h.default.reportError(n)}(t&&i.isItemUnread(e)||!t&&!i.isItemUnread(e))&&i.performAction(a,!1,r)}},{key:"markReadSelected",value:function(t){var e=h.default.vmMain.getDefaultEmailPlugin();e.beginAction(),this.applyToSelection(this.markItemRead.bind(this,t)),e.endAction()}},{key:"toggleStarSelected",value:function(){var t,e=h.default.vmMain.getDefaultEmailPlugin();e.beginAction(),this.applyToSelection(function(i){var r=i.getAttachmentByPlugin(e.id);try{h.default.PAssert(1687,r,"Must be able to get a valid attachment")}catch(n){h.default.reportError(n)}var a=e.isItemStarred(i);void 0===t&&(t=a?c.a.PluginAction.Gmail.Unstar:c.a.PluginAction.Gmail.Star),(a&&t===c.a.PluginAction.Gmail.Unstar||!a&&t===c.a.PluginAction.Gmail.Star)&&e.performAction(t,!1,r)}),e.endAction()}},{key:"selectIndex",value:function(t,e){F.a.selectIndex(t,e||0)}},{key:"onAdded",value:function(){this.isEditable&&this.isWriteable&&setTimeout(this.selectFirstItem.bind(this),0)}},{key:"selectFirstItem",value:function(){var t=this.indexOfFirstItem();t>=0&&F.a.selectIndex(t,0)}},{key:"isOverviewVisibleInPane",value:function(t){var e=this.item.get();return t===e||t.isDescendantOf(e)}},{key:"getContentWidth",value:function(){return this.getWidth()}},{key:"getContentHeight",value:function(){return this.getHeight()}},{key:"getMinItemSize",value:function(){return Math.ceil(v.default.DisplaySettings.itemLineHeight()+2*v.default.DisplaySettings.itemPadding()+(v.default.DisplaySettings.noteLineHeight()+v.default.DisplaySettings.itemPadding()))/2}},{key:"onZoom",value:function(){this.setScrollOffset(this.defaultOffset)}},{key:"widthOfDrag",value:function(t){}},{key:"getSubItems",value:function(t,e){var i=[],r={item:t,comparator:this.search.isMatched,pane:this,each:function(t){e&&t.isComplete()||i.push(t)}};return this.runItemSearch(r),i}},{key:"getMetricsForPaneObject",value:function(t,e,i){var r;try{r=v.default.Measure.measurePaneObject(t,this,v.default.settings.showMarkdown.get()&&i)}catch(a){h.default.reportError(a)}return r}},{key:"getStyledLinesForPaneObject",value:function(t,e,i){var r=t.item;if(r.isNote())return[r.getNotePreviewText()];var a=this.getMetricsForPaneObject(t,e,i);return a?a.styledLines:[r.getParsedText()]}},{key:"isItemInPane",value:function(t){return this.indexOfItem(t)>=0}},{key:"isItemTopLevel",value:function(t,e){return e.levelsDeep.get()-this.item.get().levelsDeep.get()===1}},{key:"checkHeightChanged",value:function(t,e){return this._infiniteList.checkHeightChanged(t,e)}},{key:"getCollapsedDefault",value:function(t,e,i){return!1}},{key:"isViewProject",value:function(){return!1}},{key:"isViewDates",value:function(){return!1}},{key:"isViewAgenda",value:function(){return!1}},{key:"isViewCalendar",value:function(){return!1}},{key:"isViewOutline",value:function(){return!1}},{key:"isViewGroups",value:function(){return!1}},{key:"isViewText",value:function(){return!0}},{key:"isViewFlatList",value:function(){return!1}},{key:"shouldShowAddBox",value:function(){return!1}},{key:"isViewAutoBlocks",value:function(){return!1}},{key:"isViewTag",value:function(){return!1}},{key:"canScrollToItem",value:function(){return!1}},{key:"getSortModeBlocks",value:function(){}},{key:"getSortModeItems",value:function(){}},{key:"isCalFilterActive",value:function(){return!1}},{key:"viewModeIcon",value:function(){return""}},{key:"viewModeColor",value:function(){return""}},{key:"extraPaddingForPaneObject",value:function(t){return 0}},{key:"createVMLI",value:function(t,e){e.documentOwner=this.getDocument();var i=y.a.createVMLI(t,e);return this.search.stickMatch(i),i}},{key:"createTempVMLI",value:function(t,e){e.documentOwner=this.getDocument();var i=y.a.createVMLI(t,e);return this.search.stickMatch(i),i}},{key:"selectNearestItem",value:function(t){var e=this.indexOfNextSibling(t);e>=0&&F.a.selectIndex(e,0)}},{key:"supportsSortBlocks",value:function(){return!1}},{key:"supportsSortBlocksMode",value:function(t,e){return!1}},{key:"supportsSortItems",value:function(){return!1}},{key:"getViewMode",value:function(){return""}},{key:"scrollToTop",value:function(t){this.setScrollOffset(0,t)}},{key:"setName",value:function(t){this.name.set(t),v.default.PaneManager.savePaneState()}},{key:"setWidthManual",value:function(t,e){isNaN(t)?this.widthManual=this.widthManualExpanded=t:e?(t=h.default.clamp(t,c.a.EmailPreviewSizeMin,c.a.EmailPreviewSizeMax),this.widthManualExpanded=t):(t=h.default.clamp(t,this.minWidth,this.maxWidth),this.widthManual=t),this.saveState(),v.default.PaneManager.updatePaneRects(!isNaN(t))}},{key:"isPaneObjectCollapsed",value:function(t,e){return(h.default.isVMLI(t)?t:t.item).isCollapsed(this,e)}},{key:"setPaneObjectCollapsed",value:function(t,e,i,r){return(h.default.isVMLI(e)?e:e.item).setCollapsed(t,this,i,r)}},{key:"shouldRenderPrefix",value:function(t){return!0}},{key:"needsUpdateForDate",value:function(t){return!1}},{key:"needsUpdateForTags",value:function(t,e){return!1}},{key:"handleItemChanged",value:function(t,e,i){var r=this.getInfiniteList();if(i=i||!1,e[c.a.ItemProp.Items]&&(v.default.DisplaySettings.boldHeaders()&&r.clearItemInfoForItem(t),i=!0),e[c.a.ItemProp.Text]){var a=r.handleItemTextChanged(t);if(i=i||a,this.supportSearchListenTextChanges){var n=this.search.handleItemTextChanged(t);i=i||n}}if(e[c.a.ItemProp.Search]){var o=this.search.handleItemChanged(t);i=i||o}if(e[c.a.ItemProp.Date]&&(i=i||this.needsUpdateForDate(t)),e[c.a.ItemProp.Tags]&&(i=i||this.needsUpdateForTags(t,e[c.a.ItemProp.Tags])),i)return this.preventUpdateItemsForItem&&this.preventUpdateItemsForItem.item===t?this.setItemsWillBeDirty():this.setItemsDirty(),!0}},{key:"addPaneObject",value:function(t,e){var i=e.item;t.push(e),i&&(this.paneObjectsByItem[i.id]?this.paneObjectsByItem[i.id].push(e):this.paneObjectsByItem[i.id]=[e])}},{key:"getPaneObjectsForItem",value:function(t){return this.paneObjectsByItem[t.id]}},{key:"_zoom",value:function(t,e){try{h.default.PAssert(1688,t,"Must supply a valid item to zoom to")}catch(r){h.default.reportError(r)}var i=this.item.get();i&&i.id===t.id||(F.a.reset(),this.setItem(t,!0),h.default.focusedItem=t,e||this.saveState())}},{key:"zoomIn",value:function(t,e,i,r){var a=this;try{h.default.PAssert(1689,t,"Must supply a valid item to zoom to")}catch(u){h.default.reportError(u)}var n=this.item.get();if(this._zoom(t,e),t.isDemandLoad()&&t.notifyDemandLoadUpdate(!0,this),e||h.default.sendEvent("Menu","ZoomIn"),!l.a.isMobile&&this.paneContent&&this.isWriteable&&!r){var o=this.indexOfFirstItem();o>=0?F.a.selectIndex(o,0,0):F.a.reset()}this.isLoaded&&this.onZoom(),e||g.e.performAction(g.c.Zoom,{itemID:t.id,oldItemID:n&&n.id,zoomIn:!0,time:h.default.zoomTime,pane:this}),i&&v.default.toasts.pushMessage({text:"Zoomed into "+t.getParsedTextWithoutPrefix(),actionText:"UNDO",hold:!1,action:function(){a.zoomIn(n)}})}},{key:"zoomOut",value:function(t,e){try{h.default.PAssert(1690,t,"Must supply a valid item to zoom to")}catch(d){h.default.reportError(d)}var i=this.item.get(),r=F.a.save()||F.a.getPreviousSelection();if(this._zoom(t,!1),h.default.sendEvent("Menu","ZoomOut"),!l.a.isMobile&&this.isWriteable&&r){for(var a=0,n=r.startItem,o=r.startOffset,u=r.endItem,s=r.endOffset;n&&this.indexOfItem(n)<0;){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;n=n.parent(),o=0}n&&(this.indexOfItem(r.endItem)<0&&(u=n,s=o),F.a.selectItems(n,o,u,s),this.scrollItemToMiddle(n,c.a.ScrollDuration.Snap))}e||g.e.performAction(g.c.Zoom,{itemID:t.id,oldItemID:i.id,zoomOut:!0,time:h.default.zoomTime,pane:this})}},{key:"getDocument",value:function(){return this.document.get()}},{key:"setDocument",value:function(t,e){t!==this.document.get()&&(this.document.set(t),this.zoomIn(t?this.getRootItem():void 0,e))}},{key:"openItemEditor",value:function(t){t.pane=this,v.default.menus.openItemEditor(t)}},{key:"clearPreventUpdate",value:function(){}}]),t}(),s()(D.prototype,"saveState",[x.a],Object.getOwnPropertyDescriptor(D.prototype,"saveState"),D.prototype),s()(D.prototype,"onClickReportError",[x.a],Object.getOwnPropertyDescriptor(D.prototype,"onClickReportError"),D.prototype),s()(D.prototype,"archiveCompleted",[x.a],Object.getOwnPropertyDescriptor(D.prototype,"archiveCompleted"),D.prototype),D);d.a.extendClass(tt,function(){return function(t){function e(){return a()(this,e),f()(this,A()(e).apply(this,arguments))}return w()(e,t),o()(e,[{key:"bindExtra",value:function(){d.a.binder(this,"onInputAndroid","onInput","onInputSetText")}},{key:"onInputAndroid",value:function(t){if(t.target&&h.default.findParent(t.target,"item")===F.a.getStartElement()){var e=this.convertElementToText(t.target),i=E.default.getSelectOffsetsInElement(t.target),r=F.a.getStartIndex(),a=e.indexOf("\n");if(!this._hasDetectedEnterAndroid)if(a>=0)a===i.start&&(h.default.clearTimeoutOnce("androidInputSetText"),this.setDetectedEnterAndroid(),F.a.fireKeyEvent(void 0,{normCode:c.a.KeyCode.Enter}));else{var n=F.a.getStartItem();h.default.timeoutOnce("androidInputSetText",this.onInputSetText,0,n,e,r,i.start,i.end)}}}},{key:"onInput",value:function(t){if(F.a.isValid()){var e=F.a.getStartItem(),i=this.convertElementToText(t.target),r=E.default._getSelectionRange(),a=h.default.getElementParent(t.target),n=E.default.getSelectOffsetsInElement(a,r),o=F.a.getStartIndex();this.onInputSetText(e,i,o,n.start,n.end,t)}}},{key:"onInputSetText",value:function(t,e,i,r,a,n){if(!this._hasDetectedEnterAndroid){e=e.replace(new RegExp(c.a.TextSpace,"g"),"");var o=q.a.checkMultiplePrefixes(e);if(o!==e){var u=e.length-o.length;r-=u,a-=u,e=o}v.default.settings.showMarkdown.get()||(h.default.shouldLog(c.a.LogLevels.Edit)&&console.log("check end",r-2,e[r-2]),r===a&&r>2&&")"===e[r-2]&&K.a.isInsideMarkup(t,r-2,!1,"mdMarkupEnd")&&(e=e.substr(0,r-1)+" "+e.substr(r-1),r++,a++,h.default.shouldLog(c.a.LogLevels.Edit)&&console.log("spacing eend",r)),h.default.shouldLog(c.a.LogLevels.Edit)&&console.log("check start",r,e[r]),r===a&&"["===e[r]&&K.a.isInsideMarkup(t,r-1,!1,"mdMarkupStart")&&(e=e.substr(0,r)+" "+e.substr(r),h.default.shouldLog(c.a.LogLevels.Edit)&&console.log("spacing start",r))),this.isSettingText=!0,t.setText(e,c.a.ChangeType.Local),e.length>0&&(l.a.ios?F.a.selectIndex(i,r,a):l.a.android||F.a.selectIndex(i,a)),this.isSettingText=!1,R.default.updateAutocomplete(n)}this._hasDetectedEnterAndroid=!1}},{key:"updateSelectionAndroid",value:function(t){if(l.a.isMobile&&l.a.android&&!this._hasDetectedEnterAndroid){var e=h.default.hasClass(t.target,"item")&&t.target.firstElementChild||h.default.hasClass(t.target,"androidInput")&&t.target;if(e){var i=F.a.getStartIndex(),r=E.default.getSelectOffsetsInElement(e);F.a.setSelection(i,r.start,i,r.end)}}}},{key:"keydown",value:function(t){if(t.handled)return!0;if(this.updateSelectionAndroid(t),v.default.tooltip.hideTip(),this.isWriteable&&0===this.numItems()&&this.canAddItem&&!h.default.hasClass(this.paneContent,"loading")&&c.a.KeyCodesModifiers.indexOf(t.normCode)<0&&c.a.KeyCodesArrows.indexOf(t.normCode)<0&&this.addItem(t),F.a.isValid()){this.getInfiniteList(!1).reMount(),l.a.isMobile||0!==this.numItems()||h.default.hasClass(this.paneContent,"loading")||this.addItem(t);try{R.default.keydown(this,t)||(h.default.preventDefault(t),h.default.stopPropagation(t))}catch(e){h.default.reportError(e,t)}}}},{key:"keypress",value:function(t){if(F.a.isValid()){l.a.isMobile&&l.a.android&&t.normCode===c.a.KeyCode.Enter&&this.setDetectedEnterAndroid();try{R.default.keypress(this,t)||(h.default.preventDefault(t),h.default.stopPropagation(t))}catch(e){h.default.reportError(e,t)}}}},{key:"keyup",value:function(t){if(h.default.vmMain.notifyActivity(),F.a.isValid())try{R.default.keyup(this,t)||(h.default.preventDefault(t),h.default.stopPropagation(t))}catch(e){h.default.reportError(e,t)}}}]),e}(arguments.length>0&&void 0!==arguments[0]?arguments[0]:et)}(tt),!0);var et=e.a=tt},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=function(){function t(e){a()(this,t),this._limit=e,this._offset=0,this._buffer=[]}return o()(t,[{key:"get",value:function(t){return this._buffer[t]}},{key:"push",value:function(t){this._buffer[this._offset]=t,this._offset=(this._limit+this._offset+1)%this._limit}},{key:"peek",value:function(){var t=(this._limit+this._offset-1)%this._limit;return this._buffer[t]}},{key:"pop",value:function(){var t=(this._limit+this._offset-1)%this._limit,e=this._buffer[t];return e&&(this._buffer[t]=void 0,this._offset=t),e}},{key:"hasData",value:function(){return!!this.peek()}},{key:"reset",value:function(){this._offset=0,this._buffer=[]}},{key:"buffer",value:function(){return this._buffer}},{key:"limit",value:function(t){this._limit=t}},{key:"ordered",value:function(){return this._buffer.slice(this._offset).concat(this._buffer.slice(0,this._offset))}},{key:"entries",value:function(){for(var t=0,e=this.ordered(),i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;console.log("---- Entry ["+i+"] ----"),console.log(e[i])}}}]),t}();e.a=u},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(17),o=i.n(n),u=i(9),s=i.n(u),h=i(18),d=i.n(h),c=i(35),v=function(t){function e(){var t;a()(this,e),(t=o()(this,s()(e).call(this,"moodonew"))).version(1).stores({documents:"id",items:"id",settings:"id",boards:"id",localStorage:"id",contacts:"id"}),t.tableNames=["documents","items","settings","boards","localStorage","contacts","plugins","gmail","drive","gcal"];var i={};return t.tableNames.forEach(function(t){return i[t]="id"}),t.version(2).stores(i),t}return d()(e,t),e}(i(286).a),y=function(t,e,i){var r=function(t,e,i){for(var r=0,a=0,n=t.length-1;a<=n;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=a+n>>1,u=i(t[o],e);if(u<0)a=o+1;else{if(!(u>0))return o;n=o-1}}return a}(t,e,i);return t.splice.apply(t,[r,0,e]),r},g=function(t){for(var e=0,i=0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a={},n={},o=0;o<t.length;o++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var u=t[o];a[u.id]=u,u.isRoot&&(n[u.docId]=u)}for(var s=0;s<t.length;s++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var h=t[s],d=h.parent,v=a[d]||r[d];if(!h.isDeleted){if(!v&&!h.isRoot){console.log("Item without a parent",h.text,h.parent,h.docId);var g=n[h.docId];if(!g){console.log("Uh oh, can't find root",h.text),t.splice(s,1),s--;continue}h.parent=g.id,v=g}0,v&&(32===(32&h.flags)?v.note=h.id:h.isArchived&&v.isRoot?(v.archivedItems||(v.archivedItems=[]),v.archivedItems.push(h)):void 0!==h.text&&void 0!==h.index&&(v.items||(v.items=[]),y(v.items,h,c.a.compareItemIndex)))}}return a},l=function(t){for(var e=0,i=0;i<t.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t[i]=c.a.itemIn(t[i])}return g(t)},p=function(){return new v};e.a={load:function(t,e){t||(t=p());var i={},r=t.tableNames.length;t.tableNames.forEach(function(t){return i[t]=void 0});var a=function(t,a){if(i[t]=a,"documents"===t){for(var n=0,o=a,u={},s={},h=0;h<o.length;h++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var d=c.a.documentIn(o[h]);u[o[h].id]=d,d.pendingSync&&(s[d.id]=!0)}i.documentsPending=s,i.documents=u}else if("items"===t){var v=function(t){var e={};return t=l(t),Object.keys(t).forEach(function(i){var r=t[i],a=r.items;if(r.pendingSync&&(e[r.id]=r.pendingSync),a&&(Number.NEGATIVE_INFINITY,a.find(function(t){32!==(32&t.flags)&&t.index})))for(var n=0,o=0;o<a.length;o++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var u=a[o];u.pendingSync={index:u.index},u.index=o,e[u.id]=!0}}),{items:t,itemsPending:e}}(a),y=v.items,g=v.itemsPending;i.items=y,i.itemsPending=g}else if("settings"===t||"boards"===t){var p=function(t){var e={},i={};return t.forEach(function(t){e[t.id]=t,t.pendingSync&&(i[t.id]=t.pendingSync)}),{values:e,pending:i}}(a),m=p.values,f=p.pending;i[t]=m,i[t+"Pending"]=f,"boards"===t&&Object.keys(m).forEach(function(t){m[t]=c.a.boardIn(m[t])})}else if("localStorage"===t){var k={};a.forEach(function(t){return k[t.id]=t.value}),i[t]=k}else if("plugins"===t){var A={};a.forEach(function(t){A[t.plugin]||(A[t.plugin]={}),A[t.plugin][t.id]=t}),i[t]=A}0===--r&&e(i)};for(var n in i)t[n]&&t[n].toArray(a.bind(t[n],n))},transformItems:l,createItemHierarchy:g,createDB:p}},,function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(17),s=i.n(u),h=i(9),d=i.n(h),c=i(18),v=i.n(c),y=i(0),g=i(1),l=i(3),p=i(2),m=i.n(p),f=i(10),k=i(20),A=function(t){function e(){return a()(this,e),s()(this,d()(e).apply(this,arguments))}return v()(e,t),o()(e,[{key:"init",value:function(){var t={animCheck:!1};this.props.checked instanceof f.a?(this.checked=this.props.checked,this.trackObservable=!0):t.checked=this.props.checked||this.props.initialChecked,this.createObservables(t)}},{key:"getState",value:function(){return this.trackObservable?{checked:this.checked}:{}}},{key:"onClick",value:function(){var t=this.props;if(!t.disabled){this.animCheck.set(!0),setTimeout(function(){this.animCheck.set(!1)}.bind(this),300);var e=!this.checked.get();this.trackObservable&&!t.setObs||this.checked.set(e),t.onChange&&t.onChange(e)}t.onClick&&t.onClick(e)}},{key:"getValue",value:function(){return this.checked.get()}},{key:"setValue",value:function(t){return this.checked.set(t)}},{key:"resetValue",value:function(){void 0!==this.props.initialChecked&&this.checked.set(this.props.initialChecked)}},{key:"onKeyDown",value:function(t){t.keyCode===g.a.KeyCode.Enter&&this.onClick()}},{key:"onChangeInput",value:function(){}},{key:"componentWillReceiveProps",value:function(t){this.trackObservable||void 0===t.checked||t.checked===this.state.checked||this.checked.set(t.checked)}},{key:"getElement",value:function(){return this.refs.element}},{key:"getChildren",value:function(){return this.props.children}},{key:"render",value:function(){var t=this.props,e=this.state.checked,i={background:e&&t.checkedColor,width:t.size,height:t.size,lineHeight:t.size&&t.size-1+"px",fontSize:t.size&&t.size-4+"px"},r=y.default.classNames("fancyCheckbox",{flexbox:l.a.isMobile},{checked:e},{disabled:t.disabled},{animate:this.state.animCheck},{radio:t.radio},{error:t.error},{noBG:t.noBG},t.className),a=y.default.classNames("fancyCheckboxText",{f1:l.a.isMobile}),n=y.default.classNames("fancyCheckboxCheck",{"c-button-raised-primary":e&&!t.disabled}),o=m.a.createElement("span",{className:n,style:i});return m.a.createElement("span",{className:r,onClick:!1!==t.canChange?this.onClick:void 0,id:t.id,style:t.style,tabIndex:t.tabIndex,onKeyDown:this.onKeyDown,ref:"element"},m.a.createElement("input",{className:"fancyCheckboxInput",type:"checkbox",checked:e||!1,onChange:this.onChangeInput}),!l.a.isMobile&&o,this.props.children&&m.a.createElement("span",{className:a},this.props.children),l.a.isMobile&&o)}}]),e}(k.a);e.a=A},,,function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(17),s=i.n(u),h=i(9),d=i.n(h),c=i(18),v=i.n(c),y=i(0),g=i(1),l=i(4),p=i(3),m=i(2),f=i.n(m),k=i(20),A=i(22),S=i(45),w=i(72),L=i(51),F=function(t){function e(){return a()(this,e),s()(this,d()(e).apply(this,arguments))}return v()(e,t),o()(e,[{key:"init",value:function(){var t=this.props,e=t.item;t.renderLikePane&&!isNaN(t.paneObject.index)&&(this.styleProps=e.styleProps(t.paneObject,t.pane),this.metrics=t.pane.getMetricsForPaneObject(t.paneObject))}},{key:"onMount",value:function(){var t=this.props,e=t.item;this.listenTo(e.itemChanged);try{y.default.PAssert(1361,t.pane||!t.renderLikePane&&!t.padded,"Should not use these props if no pane")}catch(i){y.default.reportError(i)}this.props.editable&&(this._needsSelect=isNaN(t.selectIndex)?e.getParsedText().length:t.selectIndex,A.default.selectElement(this.getEditable(),this._needsSelect))}},{key:"getEditable",value:function(){return this.refs.editable}},{key:"getElement",value:function(){return this.refs.element.getElement()}},{key:"getState",value:function(){var t=this.props,e=t.pane,i=t.item,r={flags:i.flags,renderLikePane:t.renderLikePane&&!isNaN(t.paneObject.index),styleProps:this.styleProps,priorityProps:t.showPriority&&i.getPriorityProps(),isComplete:i.isComplete(),hasPrefix:i.hasPrefix(),date:i.getMooDate()};return t.allowDrag&&(r.draggedInPane=i.draggedInPane,r.isBeingDragged=i.draggedInPane.get()===e||p.a.isMobile&&e===y.default.focusedPane&&y.default.vmMain.dropBucket.hasItemEntry(i)),r.renderLikePane?(r.metrics=this.metrics,r.lines=r.metrics.styledLines):r.lines=[i.getStyledTextAsOneLine()],r}},{key:"focus",value:function(){var t=this.props.item.getParsedText().length;A.default.selectElement(this.getEditable(),t)}},{key:"onKeyDown",value:function(t){var e=this.props,i=e.item;t.keyCode===g.a.KeyCode.Backspace&&this.state.hasPrefix&&""===i.getParsedTextWithoutPrefix()&&i.setText("",!1!==e.shouldSave?g.a.ChangeType.Local:g.a.ChangeType.Auto),e.onKeyDown&&e.onKeyDown(t)}},{key:"onKeyPress",value:function(t){var e=this.props;if(e.onKeyPress&&(e.onKeyPress(t),!t.defaultPrevented)){var i=this.props.item,r=A.default._getSelectionRange(),a=A.default.getSelectOffsetsInElement(t.target,r);if(this._needsSelect=void 0,a.start!==a.end){var n=i.getParsedText(),o=n.substr(0,a.start)+n.substr(a.end);i.setText(o,!1!==e.shouldSave?g.a.ChangeType.Local:g.a.ChangeType.Auto),this._needsSelect=a.start}}}},{key:"componentDidUpdate",value:function(){if(!isNaN(this._needsSelect)){var t=this.getEditable(),e=t.innerHTML;(e.indexOf("<br")>=0||e.indexOf("></span>")>0||""===e)&&(t.innerHTML=this.getRenderedHtml()),A.default.selectElement(t,Math.min(t.textContent.length,this._needsSelect)),this._needsSelect=void 0}}},{key:"convertElementToText",value:function(t){var e="";if(t.nodeType===Node.TEXT_NODE)e+=t.nodeValue;else if(t.classList.contains("plugin"))e+=g.a.AttachChar;else for(var i=0,r=0;r<t.childNodes.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e+=this.convertElementToText(t.childNodes[r])}return e}},{key:"stopResizing",value:function(){this.isResizing=!1}},{key:"onInput",value:function(t){t.target.innerHTML.indexOf("<br")>=0&&(t.target.innerHTML=t.target.innerHTML.replace("<br/>","").replace("<br>",""));var e=this.props.item,i=this.convertElementToText(t.target).replace(new RegExp(g.a.TextSpace,"g"),""),r=A.default._getSelectionRange();if(r){var a=A.default.getSelectOffsetsInElement(t.target,r);this._needsSelect=a.start}e.setText(i,g.a.ChangeType.Local),this.updateAutocomplete(),t.preventDefault()}},{key:"updateAutocomplete",value:function(){var t=this.getEditable(),e=this.props.autocompleteMode;if(e&&(!p.a.isMobile||"snooze"===e||"move"===e||"email"===e||"gmailLabel"===e||"item"===e)){var i=A.default.getSelectionInElement(t);p.a.isMobile&&!i&&(i={start:0,end:0}),i&&i.start===i.end&&S.a.update({mode:e,text:this.convertElementToText(t).replace(new RegExp(g.a.TextSpace,"g"),""),offset:i.start,item:this.props.item,owner:this,pane:this.props.pane,parsedEls:this.parsedEls,positionOffset:this.props.positionOffset,elementDisplay:t,elementInput:t,onDatePickerClosed:this.onDatePickerClosed.bind(this),supportSearchItemAutocomplete:this.props.supportSearchItemAutocomplete})}}},{key:"onDatePickerClosed",value:function(){var t=this;if(this.props.item.getRawText().includes(g.a.CharDate)){var e=this.props.item.getParsedText();e.length>0&&e!==g.a.TextSpace&&(this.getEditable().focus(),A.default.selectElement(this.getEditable(),e.length),setTimeout(function(){t.getEditable().focus(),A.default.selectElement(t.getEditable(),e.length)},0))}}},{key:"onAutocompleteSelected",value:function(t){var e=this;void 0!==t.value&&(this.props.item.setText(t.value,g.a.ChangeType.Local),A.default.selectElement(this.getEditable(),t.offset),setTimeout(function(){A.default.selectElement(e.getEditable(),t.offset)},0))}},{key:"onClick",value:function(t){if(!this.isResizing){var e=this.props;if(l.default.menus.isContextMenuOpen("ReactContextMenuContactDetails")&&l.default.menus.closeContextMenu("ReactContextMenuContactDetails"),e.editOnClick)t.preventDefault(),t.stopPropagation(),l.default.menus.isContextMenuOpen()&&l.default.menus.closeContextMenu(),l.default.menus.openContextMenu({componentName:"ReactItemDetailsPopup",element:t.target,item:e.item,pane:e.pane});else{var i=!0;if((e.editable||e.inItemDetails)&&e.pane&&(i=!l.default.pluginManager.handleTapClick(e.item,e.pane,t)),i&&!e.inItemDetails&&y.default.hasClass(t.target,"contact")){var r=t.target.textContent,a=L.a.findMatchExact(r[0]===g.a.ContactPrefix?r.substr(1):r);a&&l.default.menus.openContextMenu({componentName:"ReactContextMenuContactDetails",position:"bottom",element:t.target,contact:a})}}}}},{key:"onMouseDown",value:function(t){if(!p.a.isMobile&&t.button===g.a.ButtonCode.Left){var e=this.props,i=e.item,r=e.resizable;if(r){var a=this.getEditable().getBoundingClientRect(),n=Math.min(g.a.CalendarResizeHandleHeight,a.height/3);r=t.clientY-a.top<n?e.onItemResizeStart(i,this,!1):a.bottom-t.clientY<n&&e.onItemResizeStart(i,this,!0)}this.isResizing=r,!r&&e.allowDrag&&i.checkDragOnStart(t)}}},{key:"onMouseMove",value:function(t){!this.isResizing&&this.props.allowDrag&&this.props.item.checkDragOnMove(t,!1)}},{key:"onMouseUp",value:function(t){!this.isResizing&&this.props.allowDrag&&this.props.item.checkDragOnEnd(t)}},{key:"onClickDate",value:function(){l.default.menus.openContextMenu({componentName:"ReactContextMenuDate",element:this.getEditable(),item:this.props.item,pane:this.props.pane})}},{key:"onRightClick",value:function(t){var e=this.props;e.pane&&!1!==e.allowDrag&&(l.default.menus.openContextMenu({componentName:"ReactContextMenuItem",key:"contextMenuItem"+this.props.item.id,element:t.target,item:this.props.item,pane:this.props.pane,pos:{left:t.clientX,top:t.clientY}}),t.preventDefault(),t.stopPropagation())}},{key:"getRenderedHtml",value:function(){for(var t,e=0,i=this.props,r=i.paneObject,a=this.props.item,n=this.state.lines,o="",u=0;u<n.length;++u){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;t=i.renderLikePane?"padding-top: "+(0===u?l.default.DisplaySettings.paddingForItemTop(r,a)+"px":0)+"; padding-bottom: "+(u===n.length-1?(i.noNotes?l.default.DisplaySettings.paddingForItemTop(r,a):l.default.DisplaySettings.paddingForItemBottom(r,a))+"px":0)+";":"padding-top: 2px; padding-bottom: 2px",o+='<span class="line'+(u===n.length-1?" last":"")+'" style="'+t+'">'+(n[u]||g.a.TextSpace)+"</span>"}return o}},{key:"render",value:function(){var t=this.props,e=t.item,i=this.state,r=(i.lines,t.editable&&l.default.pluginManager.allowTextEditing(e)),a=y.default.classNames("reactItemWrapper flexbox",t.className,t.coloredInCalendar&&"colored"),n=y.default.classNames("item itemNotInPane f1",i.styleProps,i.priorityProps,{hasPrefix:i.hasPrefix},{"itemBeingDragged c-bg-light":i.isBeingDragged},{autoSelect:r},{complete:i.isComplete},{"c-bg-dark":i.isComplete&&t.coloredInCalendar}),o={};i.renderLikePane&&t.padding&&(o.paddingLeft=t.padding);var u,s=this.getRenderedHtml();if(t.style&&(o=y.default.extend(t.style,o)),t.coloredInCalendar&&!i.isBeingDragged){i.isComplete||(o.backgroundColor=e.getCalendarColor());var h=e.getCalendarDisplayProps();if(h)for(var d in h.style)if(h.hasOwnProperty(d)){try{y.default.PAssert(1362,!o[d],"Calendar display prop overwriting default styling")}catch(A){y.default.reportError(A)}o[d]=h.style[d]}}if(this.state.date&&t.inItemDetails&&!this.props.item.getRawText().includes(g.a.CharDate)){var c=this.state.date,v=c.isRepeatDate(),m=c.toText(!0),k=y.default.classNames("itemTime c-date pointer");u=f.a.createElement("div",{className:k,style:{},onClick:this.onClickDate},c.getGCalId()&&f.a.createElement("i",{className:"icon-calendar"}),v&&f.a.createElement("i",{className:"icon-spinner"}),m)}return f.a.createElement(w.a,{"data-moo-id":this.getUniqueID(),className:a,ref:"element"},f.a.createElement("span",{className:n,style:o,contentEditable:r,onClick:t.editOnClick||r||t.inItemDetails?this.onClick:void 0,onKeyDown:r?this.onKeyDown:void 0,onKeyPress:r?this.onKeyPress:void 0,onInput:r?this.onInput:void 0,onMouseDown:p.a.isMobile||r?void 0:this.onMouseDown,onMouseMove:p.a.isMobile||r?void 0:this.onMouseMove,onMouseUp:p.a.isMobile||r?void 0:this.onMouseUp,onContextMenu:p.a.isMobile?void 0:this.onRightClick,tabIndex:t.tabIndex,dangerouslySetInnerHTML:{__html:s},ref:"editable"}),u)}}]),e}(k.a);e.a=F},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(17),s=i.n(u),h=i(9),d=i.n(h),c=i(18),v=i.n(c),y=i(0),g=i(2),l=i.n(g),p=function(t){function e(){return a()(this,e),s()(this,d()(e).apply(this,arguments))}return v()(e,t),o()(e,[{key:"render",value:function(){var t=this.props,e=y.default.classNames("fancyContextMenuItem fancyContextMenuHeader flexbox c-foreground-very-faded",t.className,{"border c-border-light":!1!==t.border},{topHeader:t.topHeader}),i=y.default.classNames("fancyContextMenuHotkey c-foreground-faded",{centered:t.hotkeyCentered}),r={padding:isNaN(t.padding)?void 0:t.padding};return l.a.createElement("div",{className:e,style:r},l.a.createElement("span",{className:"f1"},t.children),t.hotkey&&l.a.createElement("span",{className:i},t.hotkey))}}]),e}(i(20).a);e.a=p},,,,function(t,e,i){"use strict";i.r(e);var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(17),s=i.n(u),h=i(9),d=i.n(h),c=i(24),v=i.n(c),y=i(18),g=i.n(y),l=i(37),p=i.n(l),m=i(0),f=i(1),k=i(4),A=i(3),S=i(6),w=i(19),L=i(39),F=i(10),C=i(5),I=i(21),P=function(){function t(){a()(this,t),this.activePane=void 0,this.startPane=void 0,this.previousEventTarget=void 0,this.previousDropTarget=void 0,this.previousHighlightElement=void 0,this.previousAbove=void 0,this.dataTransfer=void 0,this.startInfo=void 0,this.startDragItem=void 0,this.externalData=void 0,this.isDragging=!1,this.dragItem=void 0,this.draggingItems=[],this.position=void 0,this.isVisible=new F.a(!1),this.isInDrag=new F.a(!1),this.transform=new F.a({left:0,top:0}),this.linePosition=new F.a,this.isDraggingPane=new F.a(!1),this.draggingToOutline=new F.a,this.dragTargetHovered=new F.a,w.a.binder(this,"handleEscapeKey")}return o()(t,[{key:"stop",value:function(){var t=0;this.__hotkeyEscape&&(L.a.popStack(this.__hotkeyEscape),this.__hotkeyEscape=void 0),this.activePane&&!this.activePane.isDestroyed()?this.activePane.notifyDragEnd():k.default.PaneManager.runForEachPane(function(t){t.notifyDragEnd()});for(var e=this.draggingItems,i=0;i<e.length;++i){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e[i].item.draggedInPane.set(void 0)}this.draggingItems=[],this.isDragging=!1,this.dragItem=void 0,this.position=void 0,this.externalData=void 0}},{key:"finish",value:function(){this.isVisible.set(!1),this.isInDrag.set(!1),this.blockTarget=void 0,I.a.fireEvent("endDrag",[])}},{key:"start",value:function(t,e,i,r,a,n,o,u){var s=0;this.isDragging&&(this.stop(),this.finish()),this.__hotkeyEscape=L.a.pushStackEscape(this.handleEscapeKey),m.default.setItemAnimationMode(f.a.ItemAnimationMode.None),this.isDragging=!0,this.activePane=a,this.dragInfo=null,this.startPane=a,this.startInfo=n,this.dataTransfer=o,this.dragItem=t,this.startDragitem=t,this.fromOverview=u,this.externalData=void 0,this.draggingItems=e,this.position={left:i,top:r},this.transform.set({left:0,top:0},!1),C.a.reset();for(var h=0;h<e.length;++h){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;e[h].item.draggedInPane.set(m.default.focusedPane)}this.isInDrag.set(!0),this.isVisible.set(!0),this.activePane.notifyDragStart(),S.e.miscAction({type:S.c.Misc,misc:S.a.DragItem,data:{itemID:t.id,fromPane:a}})}},{key:"startExternal",value:function(t){this.isDragging=!0,this.activePane=t,this.startPane=t,this.draggingItems=[],this.isVisible.set(!0),this.isInDrag.set(!0),this.activePane.notifyDragStart()}},{key:"setExternalData",value:function(t){this.externalData=t}},{key:"setTransform",value:function(t,e){this.isVisible.set(!0,!1),this.isInDrag.set(!0,!1),this.transform.set({left:t,top:e})}},{key:"handleDragOver",value:function(t){var e=m.default.elementFromPoint(t.clientX,t.clientY),i=m.default.getPaneForElement(e);if(this.activePane&&i!==this.activePane&&this.revertDrag(),A.a.isMobile){var r=m.default.findParent(e,"dragTarget",3);r&&(r=r.id),this.dragTargetHovered.set(r)}if(m.default.vmMain.checkDragForScroll(t),i){this.isDragging||this.startExternal(i),this.activePane=i;var a=!!m.default.findParent(e,"paneOverviewScroller");i.canAcceptDragOver(t.dataTransfer.pane,t.item,e,a)?this.dragInfo=i.handleDragOver(t.dataTransfer.pane,t.item,e,t.clientX,t.clientY):this.revertDrag()}return this.linePosition.set(this.dragInfo&&this.dragInfo.linePosition),this.dragInfo&&this.dragInfo.targetElement||m.default.cancelRepeatScrolls(),!1}},{key:"revertDrag",value:function(){this.dragInfo=null,this.activePane.revertDrag()}},{key:"handleDropItem",value:function(t,e,i){var r,a=t,n=this.activePane;this.isDropping=!0,m.default.cancelRepeatScrolls();var o=A.a.isMobile?document.elementFromPoint(e.clientX,e.clientY):e.target;return o&&m.default.findParent(o,"mobileDropBucket")?(m.default.vmMain.dropBucket.addItemEntry(t,n),this.dragTargetHovered.set(void 0),r=a):A.a.isMobile&&o&&m.default.findParent(o,"mobileDragToOutline")?(this.draggingToOutline.set({item:t,pane:this.activePane}),m.default.vmMain.switchPaneMobile(f.a.PaneMode.Task,f.a.TaskViewMode.Outline,!0),this.dragTargetHovered.set(void 0),r=a):this.dragInfo&&n&&(k.default.PaneUpdateBatcher.beginUpdateItems(),this.startInfo&&0===this.startInfo.items[0].index&&this.startPane.setIgnoreRestoreScroll(),n.handleDragDrop(t,e,this.dragInfo,i),k.default.PaneUpdateBatcher.commitUpdateItems(),r=a),this.isDropping=!1,r}},{key:"handleDrop",value:function(t){var e=this,i=this.activePane;if(i&&(m.default.elementInPane(t.target)||t.fromDropBucket)){var r=t.dataTransfer.item;if(this.isDragging=!1,this.isVisible.set(!1),r)return this.handleDropItem(r,t),!0;k.default.pluginManager.handleDropEvent(t,function(r,a){S.e.beginAction();var n=i.createVMLI({text:r},{changeType:f.a.ChangeType.AllLocal,noParentOkay:!0});return n=e.handleDropItem(n,t,a),S.e.endAction(),!!n})}else m.default.isNonPaneDropTarget(t.target)&&t.dataTransfer.item&&this.handleDropItem(t.dataTransfer.item,t);this.isInDrag.set(!1),m.default.resetItemAnimationMode(),t.stopPropagation(),t.preventDefault()}},{key:"handleDragLeave",value:function(t){t.clientX||t.clientY||(this.isDragging=!1,this.isVisible.set(!1),this.isInDrag.set(!1))}},{key:"setBlockTarget",value:function(t){this.blockTarget=t}},{key:"stopDraggingToOutline",value:function(){var t=this.draggingToOutline.get();t&&t.pane&&setTimeout(function(){m.default.vmMain.switchPaneMobile(t.pane.type,f.a.TaskViewMode.Outline,!0)},300),this.dragTargetHovered.set(void 0),this.draggingToOutline.set(void 0)}},{key:"handleEscapeKey",value:function(){this.escapedDragging=!0,this.dragItem.dragEnd()}}]),t}(),N=i(22),H=function(t){function e(){var t;return a()(this,e),t=s()(this,d()(e).call(this)),window.addEventListener("dragover",t.handleDragOver.bind(p()(p()(t)))),window.addEventListener("dragleave",t.handleDragLeave.bind(p()(p()(t)))),window.addEventListener("drop",t.handleDrop.bind(p()(p()(t)))),t}return g()(e,t),o()(e,[{key:"handleDrop",value:function(t){if(!v()(d()(e.prototype),"handleDrop",this).call(this,t)){var r=this.activePane;if(t.dataTransfer.getData(A.a.ie?"Text":"text/plain")||t.dataTransfer.getData("text/html")){var a=N.default.getCursorSelectionRange(t);try{m.default.PAssert(357,a,"Range should always be properly set")}catch(h){m.default.reportError(h)}C.a.setFocusedPane(r),S.e.beginAction();var n=r.createVMLI({text:""},{changeType:f.a.ChangeType.AllLocal,noParentOkay:!0});return n=this.handleDropItem(n,t,!0),C.a.selectItem(n,0),i(138).default.insert(t.dataTransfer,t,f.a.DataSource.Drop),S.e.endAction(),!0}if(this.externalData){var o=this.externalData;this.externalData=void 0;var u=o.split(":"),s=(u.removeAt(0),"["+u.removeAt(0)+"]("+u.join(":")+")");S.e.beginAction();n=r.createVMLI({text:s},{changeType:f.a.ChangeType.AllLocal});return n=this.handleDropItem(n,t,!0),S.e.endAction(),!0}}}},{key:"handleDropItem",value:function(t,i,r){var a=v()(d()(e.prototype),"handleDropItem",this).call(this,t,i,r);if(!a&&m.default.isNonPaneDropTarget(i.target)){var n,o=i.dataTransfer.pane;if(o){n=o.notifyDropFromToEdit(t,i.target);try{m.default.PAssert(358,!n||m.default.isDOMNode(n),"Must always return DOM elements to insert")}catch(s){m.default.reportError(s)}}if(n){var u=N.default._getCursorSelectionRange(i.clientX,i.clientY);N.default.setSelectionRange(u),N.default.insertNode(n)}}return a}}]),e}(P);e.default=H},,function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(15),s=i.n(u),h=i(0),d=i(1),c=i(4),v=i(14),y=i(63),g=i(49),l=i(3),p=i(35),m=i(58),f=i(65),k=d.a.DEBUG_DATE;if(k)var A=function(t,e){for(var i in t)if(t[i]===e)return i;return null};var S,w,L,F,C=new Date(9e12).getTime(),I=new Date(1401606e6),P=", . ? ! ) ( : ; [ ] ' \"".split(" "),N=/^(next|today|tomorrow|yesterday|(?:sun|mon|tue(?:s)?|wed(?:nes)?|thu(?:rs)?|fri|sat(?:ur)?)(?:day)?)/i,H=/^(?:(?:([0]?[1-9]|1[0-2])(?::([0-5]\d))?(?:\s)?(am?|pm?|\b))|(?:([0]?\d|1\d|2[0-3]):([0-5]\d)))$/i,M=/(?:^(?:[\*_]*?)@|[\(\s](?:[\*_]*?)@)([^\s\)\*_]{2,})(\s[^\s\)@\u2001\u2003\*_]{1,})?(\s[^\s\)@\u2001\u2003\*_]{1,})?/g,z={repeat:/^(ev(ery)?|after)\b/i,recur:/^(other|first|second|third|fourth|1st|2nd|3rd|4th|last)$/i,day:/^(((sun|mon|tue(s)?|wed(nes)?|thu(rs)?|fri|sat(ur)?)(day)?)(?:,|\sand\s)?)$/i,daysOfWeek:/^(weekday|weekend)$/i,len:/^(day|week|month|year|morning|afternoon|night)$/i,count:/^((\d{1,2})|one|two|three|four|five|six|seven|eight|nine|ten)$/i,month:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(l|n|ly|ne)|aug(ust)?|oct(ober)?|(sep(t)?|nov|dec)(ember)?)$/i,at:/^at$/i,of:/^of$/i,in:/^in$/i,delim:/^and$/i,date:/^((\d{1,2})|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?)(?:,|\sand\s)?)$/i,year:/^((\d\d)|(\d\d\d\d))$/i,time:H,from:/^(from|starting)$/i,until:/^(until)$/i,measure:/^(days|weeks|months|years)$/i},D={"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,fou:4,sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,days:d.a.RepeatFreq.Daily,weeks:d.a.RepeatFreq.Weekly,months:d.a.RepeatFreq.Monthly,years:d.a.RepeatFreq.Yearly},V={h:1,hr:1,hrs:1,hour:1,hours:1,Hours:1,m:2,min:2,mins:2,Minutes:2,d:3,day:3,days:3,Days:3,"-":1,until:1,to:1,till:1,EndDate:1,for:2,Duration:2},G={duration:/^(-\s|(?:for|until|to|till)\b)/i,len:/^(\d{0,3}(?:\.\d{1,2})?)(h(?:(?:ou)?r(?:s)?)?|m(?:in(?:s)?)?|d(?:ay(?:s)?)?)$/i},T=0,q=0,j=1,Y=new(function(){function t(){a()(this,t)}return o()(t,[{key:"translateItemDate",value:function(t){var e,i,r,a=t.text,n=t.date,o=t.repeatDate,u=t.dateFormat||c.default.settings.dateFormat.get(),s=t.completedTime,v=0,y=M;for(y.lastIndex=0;null!==(e=y.exec(a));){var g=0;if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;for(var l=e[0].indexOf("@"),p=(e[1],!1),m=1;m<e.length&&e[m];++m){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;if(p)e[m]=void 0;else{var f=e[m][e[m].length-1];P.indexOf(f)>=0&&(e[m]=e[m].slice(0,-1),p=!0)}}var k,A=this.parseRepeatDate(o,void 0,u,s,0,a.substr(e.index+l+1));if(A||e[1].startsWith("every")||"in"===e[1]){if(A){k=e.index+l,A.replacedDate&&(a=a.substr(0,k+1)+A.text+a.substr(k+A.repLength+1)),i?i.push(A):i=[A];var S=new Date(A.startDate);if(S.hasTimeOfDay()){I=k+A.text.length+1,N=a.substr(I);if(C=this.parseDuration(S,N,u)){A.oldText.length;r?r.push(C):r=[C]}}break}}else{var w=[e[1]?e[1]:"",e[2]?e[2]:"",e[3]?e[3]:""],L=this.computeDateInfo(n,void 0,u,c.default.International.getCurrentDateFormat(),0,w);if(L.isValid){var F;k=e.index+l,L.replacedDate?(a=a.substr(0,k+1)+L.text+a.substr(k+L.oldText.length+1),F={type:d.a.DateType.Once,date:L.date,dateFormat:L.format,origText:L.oldText,text:L.text,explicitTime:L.date.hasTimeOfDay()}):F={type:d.a.DateType.Once,date:L.date,dateFormat:L.format,origText:L.oldText,text:L.text,explicitTime:L.date.hasTimeOfDay()},i?i.push(F):i=[F];var C,I=k+L.text.length+1,N=a.substr(I);(C=this.parseDuration(L.date,N,u))&&(F.explicitTime||C.duration%h.default.days(1)===0||(F.explicitTime=!0),r?r.push(C):r=[C]);break}}}return{date:i?i[0]:void 0,duration:r?r[0]:void 0}}},{key:"getDurationLength",value:function(t){var e=G.len.exec(t),i=parseFloat(e[1]),r=0;switch(V[e[2].toLowerCase()]){case V.Hours:r=h.default.hours(i);break;case V.Minutes:r=h.default.minutes(i);break;case V.Days:r=h.default.days(i);break;default:try{h.default.PAssert(1367,!1,"Invalid duration length: "+e[2])}catch(a){h.default.reportError(a)}}return r}},{key:"parseDuration",value:function(t,e,i){this.setDateTokens(e);var r,a=0;if(this.checkAndParse(G.duration)){if(V[S.toLowerCase()]===V.EndDate)if(this.checkAndParse(H,2)){var n=this.getTimeFromString(S),o=t.clone();o.setHours(n.hour),o.setMinutes(n.min),a=+o-+t}else this.checkAndParseDate(i)&&(a=L?+L-+t:0);else if(V[S.toLowerCase()]===V.Duration){for(var u=0;this.checkAndParse(G.len);){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;a+=this.getDurationLength(S)}a--}}else{for(var s=0;this.checkAndParse(G.len);){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;a+=this.getDurationLength(S)}a--}return a>0&&(r={durationText:e.substr(1,T).trim(),duration:a}),r}},{key:"getSoftText",value:function(t,e){return e<0?e>=-864e5?"yesterday":t.toString(c.default.International.getFormat(d.a.DFormat.MonthDayYear)):e<=864e5&&t.isToday()?"today":e<1728e5?"tomorrow":void 0}},{key:"runDateParse",value:function(t,e){var i=t.join(""),r=c.default.International.parseDate(i,e);return!r&&t[1]&&(i=t[0]+t[1],r=c.default.International.parseDate(i,e)),!r&&t[0]&&(i=t[0],r=c.default.International.parseDate(i,e)),{dt:r,dateString:i}}},{key:"computeDateInfo",value:function(t,e,i,r,a,n){var o,u,s,v,y=new Date(t).clearTime(),g=(new Date).clearTime(),l=+y-+g,p=e||n.join(""),m=p,f=!1;if(k&&(h.default.log("Prev Date Time: ",y),h.default.log("Curr Date Time: ",g),h.default.log("RawDiff: ",l),h.default.log("DiffDays: ",l/864e5)),this.isFlagSet(a,d.a.ChangeType.Auto)||this.isFlagSet(a,d.a.ChangeType.Remote)&&this.isFlagSet(a,d.a.ChangeType.DocLoad)){if(o=new Date(t),void 0!==t&&(l<0||l>=0&&l<1728e5)){if(N.lastIndex=0,null!==(s=N.exec(p))){if("NEXT"!==p.toUpperCase()&&(u=this.getSoftText(o,l))&&!p.toUpperCase().startsWith(u.toUpperCase())){if(void 0===e)p=(S=this.runDateParse(n,i)).dateString;m=p.replace(s[0],u),f=!0}}else if(null!==(s=H.exec(p))){if((u=this.getSoftText(o,l))&&"today"!==u){if(void 0===e)p=(S=this.runDateParse(n,i)).dateString;m=u+" "+p,f=!0}}else if(void 0===t||void 0===e){(S=this.runDateParse(n,i)).dateString!==e&&(o=S.dt,p=S.dateString,m=S.dateString)}}else if(void 0===t||void 0===e){if(h.default.isDemoMode()||!this.isFlagSet(a,d.a.ChangeType.Auto))o=(S=this.runDateParse(n,i)).dt,m=S.dateString,p=S.dateString;else void 0===t&&(o=void 0)}}else if(this.isFlagSet(a,d.a.ChangeType.Local)||this.isFlagSet(a,d.a.ChangeType.Remote)){if(this.isFlagSet(a,d.a.ChangeType.PluginLoad))o=t?new Date(t):void 0;else o=(S=this.runDateParse(n,i)).dt,p=S.dateString,m=S.dateString}else{var S;o=(S=this.runDateParse(n,i)).dt,p=S.dateString,m=S.dateString}k&&(h.default.log(">>> Date Rollver <<<"),h.default.log(">>> Change Type:  ",A(d.a.ChangeType,a)),h.default.log(">>> Prev Date:    ",new Date(t)),h.default.log(">>> New Date:     ",o),h.default.log(">>> Prev String:  ",p),h.default.log(">>> Trans String: ",u),h.default.log(">>> New String:   ",m),h.default.log("--------------------"));try{h.default.PAssert(1368,!o||!isNaN(o.getTime()),"Must be a valid parsed date")}catch(w){h.default.reportError(w)}return i!==r?(v=c.default.International.convertDateFormat(m,i,r),f=!0):v=m,{isValid:!!o,oldText:p,text:v,date:o,format:i,replacedDate:f}}},{key:"getRepeatStartDate",value:function(t){if(t&&"string"===typeof t){var e=t.split("|");if(e.length>3&&"1"===e[0])return new Date(parseInt(e[1]))}}},{key:"setDateTokens",value:function(t){S="",w=t.split(" "),j=1,T=w[0].length,q=0,L=void 0}},{key:"checkAndParse",value:function(t,e){var i=!1;if(k&&void 0===t&&h.default.log("INVALID TOKEN TYPE"),void 0===(e=void 0!==e&&e>1?Math.min(w.length-j,e):e)||1===e)j<w.length&&(i=w[j].match(t))&&(S=w[j],j++,T+=S.length+1);else if(e>1&&j+e<=w.length)for(var r=0,a=e;a>0;a--){var n=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var o="",u=0;u<a;++u){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;o+=w[j+u],u+1!==a&&(o+=" ")}if(i=!!o.match(t)){S=o,j+=a,T+=o.length+1;break}}return i}},{key:"checkAndParseDate",value:function(t){var e=!1;if(j+1<w.length&&!w[j+1].match(z.at)){var i=c.default.International.parseDate(w[j]+" "+w[j+1],t);i&&(e=!0,S=w[j]+w[j+1],L=i,j+=2,T+=S.length+2)}if(!e&&j<w.length){var r=c.default.International.parseDate(w[j],t);r&&(e=!0,S=w[j],L=r,j++,T+=S.length+1)}return e}},{key:"computeStartDate",value:function(t,e,i,r,a,n){var o=n||new Date,u=(n?new Date(n):new Date).clearTime();(void 0!==r&&u.setMonth(r),void 0!==i)&&(i>0&&i<=31&&((Date.getDaysInMonth(u.getFullYear(),u.getMonth())<i||i<u.getDate())&&void 0===r&&u.addMonths(1),u.setDate(i)));return void 0!==e?(u.moveToNthOccurrence(t,e),u.isBefore(o)&&(u.addMonths(1),u.moveToNthOccurrence(t,e))):void 0!==t&&u.getDay()!==t&&(u.moveToDayOfWeek(t,-1),u.isBefore(o)&&u.moveToDayOfWeek(t)),void 0!==r&&u.isBefore(o)&&(u.addYears(1),u.setMonth(r)),a&&this.updateDateWithTime(u,a),u}},{key:"updateDateWithTime",value:function(t,e){var i=this.getTimeFromString(e);t.setHours(i.hour),t.setMinutes(i.min),t.setMilliseconds(1)}},{key:"getTimeFromString",value:function(t){var e,i,r,a,n=H.exec(t),o=0;void 0!==n[1]?(i=(e=n[3].toUpperCase())===Date.CultureInfo.pmDesignator[0]||e===Date.CultureInfo.pmDesignator,o=h.default.parseInt(n[1])+(i?12:0),r=n[2]?h.default.parseInt(n[2]):0,a=n[1]):void 0!==n[4]&&void 0!==n[5]&&(o=h.default.parseInt(n[4]),r=h.default.parseInt(n[5]),a=n[4]);var u=!1;if(a){var s=h.default.parseInt(a);(a.startsWith("0")||0===s||s>12)&&(u=!0)}return e||u?e&&!u&&(i||12!==o?i&&24===o&&(o=12):o=0):o<8&&(o+=12),{hour:o,min:r}}},{key:"parseRepeatDate",value:function(t,e,i,r,a,n){var o,u,s,v,y,g,l,p,m=!1,f=Date.today(),A=d.a.RepeatFreq.Daily,w=1;if(n.match(z.repeat)){this.setDateTokens(n);var F=!1;if(this.checkAndParse(z.recur)){switch(S){case"other":w=2;break;case"last":A=d.a.RepeatFreq.NthMonthInst,g=-1;break;default:A=d.a.RepeatFreq.NthMonthInst,g=D[S.substr(0,3).toLowerCase()]}F=!0,k&&h.default.log("Parse Recur: ",S)}if(F&&"other"!==S||!this.checkAndParse(z.date))if(!F&&this.checkAndParse(z.count)){var P=h.default.parseInt(S);isNaN(P)&&(P=D[S]),this.checkAndParse(z.measure)&&(A=D[S.toLowerCase()],w=P,m=!0,k&&h.default.log("Parse Measure: ",S))}else if(this.checkAndParse(z.day)){var N,H=0;for(A!==d.a.RepeatFreq.NthMonthInst&&(A=d.a.RepeatFreq.Weekly),y=D[S.substr(0,3).toLowerCase()],k&&h.default.log("Parse Day: ",S);(S.endsWith(",")||this.checkAndParse(z.delim))&&this.checkAndParse(z.day);){if(H++>5e3&&__infLoop&&__infLoop(H))throw new RangeError;var M=D[S.substr(0,3).toLowerCase()];N?N.push(M):N=[y,M],k&&h.default.log("Parse Day: ",S)}N&&(N.sort(),s=N),m=!0}else if(this.checkAndParse(z.daysOfWeek))A=d.a.RepeatFreq.Weekly,"weekday"===S?s=[1,2,3,4,5]:"weekend"===S&&(s=[0,6]),m=!0;else if(this.checkAndParse(z.month)){var V=S;if(k&&h.default.log("Parse Month: ",S),this.checkAndParse(z.date)){var G=parseInt(S);G>0&&G<=31&&(l=G,p=D[V.substr(0,3).toLowerCase()],A=d.a.RepeatFreq.Yearly,m=!0,k&&h.default.log("Parse Date: ",S))}}else if(F&&"other"!==S||!this.checkAndParse(z.len))if(F&&"last"!==S||!this.checkAndParse(z.len))F&&"other"!==S&&(A=d.a.RepeatFreq.DayOfMonth,l=g,g=void 0,m=!0);else switch(S){case"day":m=!0,A=d.a.RepeatFreq.EndOfMonthOffset}else{switch(S){case"day":A=d.a.RepeatFreq.Daily;break;case"week":A=d.a.RepeatFreq.Weekly;break;case"month":A=d.a.RepeatFreq.Monthly;break;case"year":A=d.a.RepeatFreq.Yearly;break;case"morning":A=d.a.RepeatFreq.Daily,v="9:00am";break;case"afternoon":A=d.a.RepeatFreq.Daily,v="2:00pm";break;case"night":A=d.a.RepeatFreq.Daily,v="7:00pm"}m=!0,k&&h.default.log("Parese Length: ",S)}else{var j,Y=0,X=h.default.parseInt(this.trimPunc(S));for(k&&h.default.log("Parse Date: ",S);(S.endsWith(",")||this.checkAndParse(z.delim))&&this.checkAndParse(z.date);){if(Y++>5e3&&__infLoop&&__infLoop(Y))throw new RangeError;var Q=h.default.parseInt(this.trimPunc(S));Q>0&&Q<=31&&(j?j.push(Q):j=[X,Q],k&&h.default.log("Parse Date: ",S))}j&&j.length>1?(j.sort(h.default.numberComparator),A=d.a.RepeatFreq.DayOfMonth,l=j[0],s=j,m=!0):X>0&&X<=31&&(isNaN(X)||(A=d.a.RepeatFreq.DayOfMonth,l=X,m=!0),this.checkAndParse(z.measure)?(A=D[S.toLowerCase()],w=X,l=void 0,m=!0,k&&h.default.log("Parse Measure: ",S)):(this.checkAndParse(z.of),this.checkAndParse(z.month)&&(l=X,p=D[S.substr(0,3).toLowerCase()],A=d.a.RepeatFreq.Yearly,m=!0,k&&h.default.log("Parse Month: ",S))))}var J=!1;this.checkAndParse(z.at)&&(J=!0,k&&h.default.log("Parse At: ",S)),this.checkAndParse(z.time,2)&&(v=S,m=!0,k&&h.default.log("Parse Time: ",S));var Z,B,$,U=!1,R=!1;if(this.checkAndParse(z.in))R=!0,this.checkAndParse(z.month)&&(B=D[S.substr(0,3).toLowerCase()]),this.checkAndParse(z.year)&&($=parseInt(S)),void 0===B&&void 0===$||(u=new Date,Z=new Date,U=!0,$&&(u.setYear($),u.setMonth(11),Z.setYear($),Z.setMonth(0)),void 0!==B&&(void 0!==$&&(u.getMonth()>B&&u.addYears(1),Z.getMonth()>B&&Z.addYears(1)),u.setMonth(B),Z.setMonth(B)),u.moveToLastDayOfMonth(),Z.setDate(1));var E=T+1,K=T;this.checkAndParse(z.from)?(E=T+1,this.checkAndParseDate(i)&&(U&&!L.isAfter(Z)||(Z=L),U=!1,q=T,k&&h.default.log("Parse From: ",S))):q=T;var x=!1;J||v||(this.checkAndParse(z.at)&&(J=!0,x=!0,k&&h.default.log("Parse Post-At: ",S)),this.checkAndParse(z.time,2)&&(v=S,x=!0,k&&h.default.log("Parse Post-Time: ",S))),R||this.checkAndParse(z.until)&&this.checkAndParseDate(i)&&(u=L,x=!0,k&&h.default.log("Parse until: ",S)),u&&u.isBefore(Z)&&(m=!1)}else"everyday"===n&&(this.setDateTokens(n),m=!0,A=d.a.RepeatFreq.Daily,w=1);if(m){var b=this.getRepeatStartDate(t),O=this.isFlagSet(a,d.a.ChangeType.Remote)?b:Z;if(s&&A===d.a.RepeatFreq.Weekly)for(var W=0,_=(O||new Date).getDay(),tt=0;tt<s.length;++tt){if(W++>5e3&&__infLoop&&__infLoop(W))throw new RangeError;if(s[tt]>=_){y=s[tt];break}}var et=!!(f=this.computeStartDate(y,g,l,p,v,O));if(f&&(f.isBefore(I)&&(et=!1),u&&u.isBefore(f)&&(et=!1)),et){var it,rt,at=!1,nt=n.substr(0,T);if(!r&&Z&&t&&!U){rt=n.substr(E,q);var ot=this.computeDateInfo(b,void 0,i,i,a,[rt]);ot.replacedDate&&(rt=ot.text)}else r&&r!==C&&(this.isFlagSet(a,d.a.ChangeType.Text)||(rt=c.default.International.formatDate(new Date(r),d.a.DFormat.MonthDayYear,i)));if(rt){var ut=n.substr(E,q);if(ut.toUpperCase()!==rt.toUpperCase()){k&&h.default.log("Replaced From Date: ",ut,"->",rt);var st=c.default.International.parseDate(rt,i);st&&(v&&this.updateDateWithTime(st,v),nt=nt.substr(0,K)+" from "+rt+(x?nt.substr(q):""),it=st.getTime(),at=!0)}}var ht,dt=n.substr(0,T),ct=c.default.International.getCurrentDateFormat();i!==ct?(ht=c.default.International.convertDateFormat(nt,i,ct),at=!0):ht=nt,o={type:d.a.DateType.Repeat,repLength:T,oldText:dt,text:ht,dateFormat:i,startDate:it||f,endDate:u,frequency:A,separation:w,offsets:s,replacedDate:at},k&&(h.default.log("Start: ",it||f),h.default.log("End: ",u),h.default.log("Freq: ",A),h.default.log("Sep: ",w),h.default.log("Offsets: ",s?s.toString():void 0))}}return o}},{key:"getNowRelativeDate",value:function(t){var e;switch(t.toUpperCase()){case"NOW":e=Date.today().add({hours:11});break;case"NEXT":e=Date.today().add({hours:12});break;case"SOON":e=Date.today().add({days:2});break;case"LATER":e=Date.today().add({days:5});break;case"SOMEDAY":e=Date.today().add({days:14});break;default:try{h.default.PAssert(1369,!1,"Must supply a valid now relative date string")}catch(i){h.default.reportError(i)}}return e}},{key:"isDateSoft",value:function(t){if(t)switch(t.toUpperCase()){case"NEXT":case"SOON":case"LATER":case"SOMEDAY":case"NOW":return!0}return!1}},{key:"trimPunc",value:function(t){return t.replace(/[:,\.\'\"\)\]\*_]*$/g,"")}},{key:"isFlagSet",value:function(t,e){return!1}}]),t}()),X=i(57),Q=i(56),J=i(10),Z=i(34),B=i(64),$=i(16),U=h.default.invertObject({isArchived:"a",dateCreated:"c",date:"d",duration:"e",formats:"f",durationText:"g",favorites:"h",items:"i",isNote:"k",modifiedOffline:"l",isCollapsed:"m",note:"n",modifiedOfflineText:"o",priority:"p",dateFormat:"q",repeatDate:"r",dateText:"s",text:"t",versionText:"u",version:"v",isDeleted:"x",isComplete:"z",archivedItems:"ai",allDayDate:"ad",id:"id",isStarred:"*",dateCompleted:"^"}),R={docSharing:"docSharing",paneState:"paneState",noSounds:"noSounds",lastMessageSync:"lastMessageSync",shownInstallInfo:"shownInstall",lastCalendarSync:"lastCalendarSync",lastEventSync:"lastEventSync",lastEventFullSync:"lastEventFullySync",calendarsImport:"calendarsImport",calendarExport:"calendarExport",syncGoogle:"syncGoogle",searchExpandsCollapsed:"searchExpandsCollapsed",pluginDrive:"pluginDrive",pluginGmail:"pluginGmail",layoutTheme:"layoutTheme",bulletColor:"bulletColor",bullerColor:"bullerColor",showBullets:"showBullets",verticalLinesColor:"verticalLinesColor",boards:"boards",enableOfflineAuth:"enableOfflineAuth"},E={grayscale:"grayscale",boldHeaders:"boldHeaders",indentSize:"indentSize",itemPadding:"itemPadding",itemIndentSize:"itemIndentSize",showVerticalLines:"showVerticalLines",fontSize:"fontSize",itemLineHeight:"itemLineHeight",paneHistoryMobile:"paneHistoryMobile"},K=h.default.invertObject({theme:"theme",syncContacts:"syncContacts",lastContactSync:"lastContactSync",lastTaskSync:"lastTaskSync",lastQuickAddSync:"lastQuickAddSync",disableNotifications:"disableNotifications",notificationDelay:"notificationTime",rootFolderId:"rootFolderId",attachFolderId:"attachFolderId",backupFolderId:"backupFolderId",authScopes:"authScopes",localIntegrity:"localIntegrity",localDataVersion:"localDataVersion",localRecoverVersion:"localRecoverVersion",shownTutorial:"shownTutorial",gdocId:"gdocId",gdocTitle:"gdocTitle",activeUser:"activeUser",userId:"userId",displayName:"displayName",lastServerVersion:"lastServerVersion",helpPaneState:"helpPaneState",closedImport:"closedImport",closedHelps:"closedHelps",oauthScheme:"oauthScheme",premiumStatus:"zzp",enableOfflineAuth:"enableOfflineAuth",trialStart:"pzs",trialDuration:"pzd",trialExtended:"pze",premiumEndDate:"ped",notifiedTrialOver:"notifiedTrialOver",notifiedTrialEndSoon:"notifiedTrialEndSoon",inTooltipIntro:"inTooltipIntro",keyboardToolbarScroll:"keyboardToolbarScroll",defaultItemPrefix:"defaultItemPrefix",showMarkdown:"showMarkdown",calendarCustomDays:"calendarCustomDays",selectFullItems:"selectFullItems",showFormattingToolbar:"showFormattingToolbar",showImagesInline:"showImagesInline",dayWeekStart:"dayWeekStart",trialOverHidden:"trialOverHidden",bulletOpacity:"bulletOpacity",projectOpacity:"projectOpacity",checkboxOpacity:"checkboxOpacity",checkboxBackgroundOpacity:"checkboxBackgroundOpacity",showVerticalLines:"showVerticalLines",verticalLinesOpacity:"verticalLinesOpacity",boldHeaders:"boldHeaders",itemPadding:"itemPadding",notePadding:"notePadding",itemLineHeight:"itemLineHeight",noteLineHeight:"noteLineHeight",itemIndentSize:"itemIndentSize",fontSize:"fontSize",fontSizeHeader:"fontSizeHeader",fontSizeHeaderTopLevel:"fontSizeHeaderTopLevel",noteFontSize:"noteFontSize",tagColor:"tagColor",dateColor:"dateColor",contactColor:"contactColor",linkColor:"linkColor",underlineP:"underlineP",displaySpacing:"displaySpacing",displayPrefixes:"displayPrefixes",grayscale:"grayscale",helpState:"helpState",localPaneState:"localPaneState",selectedBoard:"selectedBoard",paneHistoryMobile:"paneHistoryMobile",cacheSizeRatio:"cacheSizeRatio",monthlyInvoice:"monthlyInvoice",invoiceEmail:"invoiceEmail",invoiceCompany:"invoiceCompany",invoiceAddress:"invoiceAddress",isUnsubscribed:"isUnsubscribed",showSidebar:"showSidebar",sidebarWidth:"sidebarWidth",openEvernoteApp:"openEvernoteApp",closedVideo:"closedVideo",agendaSort:"agendaSort",dateFormat:"dateFormat",lastBackup:"lastBackup",needsBackup:"needsBackup",backupFrequency:"backupFrequency",encryptionKey:"encryptionKey",DefaultGroup:"Default",UISettingsGroup:"UISettings"}),x=(F=function(){function t(){a()(this,t),this.backing=m.a,this.waitingText=new J.a,this.documentsObs=new J.a({}),this.errorGapiImport=new J.a,this.showTryAgain=new J.a(!0)}return o()(t,[{key:"authAndImportDocuments",value:function(){this.authAndOpenModal(!0,this.listDocuments)}},{key:"authAndImportServer",value:function(t){var e=this;this.authAndOpenModal(!1,function(){e.doAuth().then(function(i){e.showTryAgain.set(!1),e.importServer(i,function(e,i){c.default.menus.closeModal(d.a.Modals.ImportMoodo),t(e)})})})}},{key:"authAndOpenModal",value:function(t,e){this.waitingText.set("Waiting for authentication...<br><br>You should see a popup window asking you to sign into your Moo.do account. If the popup doesn't open, please try again or contact support if it doesn't work."),e(),c.default.menus.openModal(d.a.Modals.ImportMoodo,{importer:this,backdropClose:!1,withDocuments:t,tryAgain:e})}},{key:"doAuth",value:function(){return new Promise(function(t,e){Z.a.ensureGapi(function(){if(window.gapi&&window.gapi.auth){var i={client_id:"597847337936.apps.googleusercontent.com",scope:[d.a.GScope.Drive,"https://www.googleapis.com/auth/drive.appdata"].join(" "),immediate:!1,include_granted_scopes:!0,response_type:"token id_token",authuser:-1,prompt:"consent"};window.gapi.client.init({apiKey:"AIzaSyCgYrT1vXClB5Y9lRl0iOTtM4W4aBvLn50"}).then(function(){window.gapi.auth.authorize(i,function(i){i&&!i.error?t(i):e("Error authorizing Google: "+i.error)})})}else e("Could not load Google APIs")})})}},{key:"listDocuments",value:function(){var t=this;this.doAuth().then(function(e){t.showTryAgain.set(!1),t.importServer(e,function(i,r){!0===i?(t.dateTime=Date.now(),t.waitingText.set("Getting documents list..."),t.getDataFromGapi(e,function(i,r){window.gapi.client.init({client_id:"597847337936.apps.googleusercontent.com"}).then(function(){t.token=e,t.settings=i,t.documents=r,t.waitingText.set("",!1),t.documentsObs.set(r)})})):c.default.toasts.pushMessage({text:"Error importing: ".concat(i,": ").concat(r),hold:!0})})}).catch(function(e){return t.errorGapiImport.set(e)})}},{key:"importWithDocuments",value:function(t){var e=this,i={};t.forEach(function(t){i[t]=e.documents[t]});try{h.default.PAssert(660,this.settings,"No settings")}catch(r){h.default.reportError(r)}this.settings&&this.importSettings(),c.default.DisplaySettings.init(),this.importDocuments(i),this.boards&&(this.importBoardsToFirebase(this.boards,i),g.a.setSelectedIndex(0,!0))}},{key:"getDataFromGapi",value:function(t,e){var i=this,r={maxPageResults:999,maxPages:12,token:t};h.default.vmMain.remoteAPI().driveFilesList("mimeType='application/vnd.google-apps.drive-sdk.597847337936'",function(r){var a,n={};Promise.all(r.map(function(e){return new Promise(function(r){i.getDocument(t,e,function(t){if(t)if(e.appDataContents){a=i.parseNode(t.data.value.settings);try{h.default.PAssert(661,a,"Failed to parse settings",t.data.value.settings)}catch(u){h.default.reportError(u)}}else if(!e.labels.trashed&&t.data){var o=i.translateDocument(i.parseNode(t.data),!0);o.id=e.id,o.text=e.title,o.date=new Date(e.createdDate),n[e.id]=o}r()})})})).then(function(){e(a,n)}).catch(function(t){return h.default.reportError(t)})},function(t){e()},r)}},{key:"parseNode",value:function(t){var e,i=this;if("Map"===t.type){var r=t.value;e={id:t.id},Object.keys(r).forEach(function(t){e[t]=i.parseNode(r[t])})}else"List"===t.type?(e=[],t.value.forEach(function(t,r){e[r]=i.parseNode(t)})):t.json&&(e=void 0!==t.json.value||t.json.ver?t.json.value:t.json);return e}},{key:"getDocument",value:function(t,e,i){var r={token:t};h.default.vmMain.remoteAPI().realtimeFileGet(e.id,function(t){i(t)},function(t){i()},r)}},{key:"importDocuments",value:function(t){var e=this;Object.keys(t).forEach(function(i){var r=t[i],a=y.a.create({id:i,text:r.text,rootData:r.root,backing:e.backing});v.a.addDocument(a)})}},{key:"importSettings",value:function(){var t=this;Object.keys(this.settings).forEach(function(e){var i=t.settings[e];"id"!==e&&Object.keys(i).forEach(function(r){var a=("UISettings"===e?"ui":"Default"!==e&&e)||"";"theme"===r&&(a="ui");var n=i[r];if("workspaces"===r)t.boards=JSON.parse(n);else if("id"!==r){var o="Default"===e||"UISettings"===e?K[r]:r;if(!R[r]&&("Default"!==e||!E[r])&&o){var u=a?c.default.settings[a]:c.default.settings;if(u){var s=u[o];0,s&&(("syncContacts"===o||"syncAccounts"===o||e.startsWith("plugin")&&"isEnabled"===o)&&(n=!1),s.set(n,!1),c.default.settings._save(o,a,n))}}}})})}},{key:"importBoardsToFirebase",value:function(t,e){var i=[],r=0;Object.keys(t).forEach(function(a){e[a]&&t[a].workspaces.forEach(function(t){t.index=r++,t.panes.forEach(function(t){t.document=a}),v.a.saveBoard(t),i.push(t)})}),g.a.setBoards(i)}},{key:"translateDocument",value:function(t,e){var i=t.root||t.docRoot;return t.root=this.translateItem(i,e,i,!1),t}},{key:"translateItem",value:function(t,e,i,r,a){var n=this,o=d.a.VMLIFlag.None,u={index:a};if(t===i&&(u.isRoot=!0,i=u),Object.keys(t).forEach(function(a){var o=t[a],s=e?U[a]:a;h.default.isArray(o)?o=o.length>0?o.map(function(t,r){return n.translateItem(t,e,i,"archivedItems"===s,r)}):void 0:h.default.isObject(o)&&(o=n.translateItem(o,e,i,!1)),"archivedItems"===s&&o&&(r?s="items":(i.archivedItems||(i.archivedItems=[]),o.forEach(function(t){t.isArchived=!0,t.parent=i.id}),i.archivedItems.pushArray(o),o=void 0)),s&&o&&(u[s]=o),u.undefined}),u.isComplete&&(o|=d.a.VMLIFlag.Complete,delete u.isComplete),u.isStarred&&(o|=d.a.VMLIFlag.Starred,delete u.isStarred),u.priority&&(o|=u.priority,delete u.priority),u.isNote)o|=d.a.VMLIFlag.Note,delete u.isNote;else try{this.translateItemDate(u)}catch(s){h.default.reportError(s,u.text)}return u.dateFormat||(u.dateFormat="mdy"),delete u.version,delete u.versionText,u.flags=o,u}},{key:"replaceText",value:function(t,e,i){return e&&(e="@"+e+(i?" "+i.durationText:""),t=t.replace(e,d.a.CharDate)),t}},{key:"translateItemDate",value:function(t){if(t.text&&(t.date||t.repeatDate)){var e=Y.translateItemDate(t),i=e.date,r=e.duration;if(i){var a;if(t.text=t.text.replace(/@(next|soon|later|someday|now)/i,"#$1"),t.text=this.replaceText(t.text,i.text,r),t.text=this.replaceText(t.text,i.origText,r),t.text=this.replaceText(t.text,i.oldText,r),t.text=h.default.trimRight(t.text.replace(/  /g," ")),Y.isDateSoft(i.text))delete t.date;else{if(i.type===d.a.DateType.Repeat){var n=i.text||i.origText;a=f.a.parseText(n)}else a=new X.a(new Date(t.date));if(r){var o=Math.round(r.duration);a.setDuration(o)}if(t.text.indexOf("p:GCalendar")>=0){var u=Q.a.parseText(t.text),s=u.attachments;u.parsedText;if(s.length>0){var c=s[0];a.gcalId=c.id;var v="\u2001p:"+c.p+",id:"+c.id+(c.calendarID?"(?:,calendarID:"+c.calendarID+")":"")+"\u2001";t.text=t.text.replace(new RegExp(v),"")}}try{h.default.PAssert(662,a,"Was not able to import date",i)}catch(y){h.default.reportError(y)}a&&(t.date=a.toData())}delete t.dateText,delete t.dateFormat,delete t.repeatDate}}}},{key:"importServer",value:function(t,e){var i,r;if(this.waitingText.set("Importing user data..."),t&&t.id_token){var a=t.id_token,n=a.split(".");try{h.default.PAssert(663,n&&3===n.length&&n[0]&&n[1]&&n[2],"A valid JWT should always have three parts: "+a)}catch(y){h.default.reportError(y)}try{var o=JSON.parse(h.default.b64_to_utf8(n[1]));i=o.email.toLowerCase(),r=o.sub}catch(g){h.default.reportError(g,t.id_token)}}if(i&&r){var u={email:i,gid:r},s={gid:r,id_token:t.id_token,token:t},c=l.a.getDeployVar(d.a.DeployVariable.APIHost),v=["billingID","gid","inviteCode","invoiceAddress","invoiceCompany","invoiceEmail","joinDate","monthlyInvoice","nextBillingDate","planID","premiumCode","premiumSignupDate","premiumEndDate","premiumStatus","subscriptionID","trialDuration","trialStart","earlyAdopter","isUnsubscribed"];h.default.XHR({type:"POST",url:"https://".concat(c,"/private/v1/billing/getFullInfo"),data:u,headers:s,requireAuth:!0,autoRetry:!0,maxRetries:6,cb:function(t){if(200===t.status)try{var i=JSON.parse(t.response);if(i){var r=i.data;Object.keys(r).forEach(function(t){v.indexOf(t)<0&&delete r[t]}),r=p.a.userOut(r),B.a.createURL("user/migrateUser",{}).then(function(t){fetch(t,{method:"POST",body:JSON.stringify(r)}).then(function(t){200===t.status?e(!0):e(t.status,t.statusText)})})}else e(!1,t.response)}catch(g){e(!1,g)}else e(t.status,t.statusText)}})}}}]),t}(),s()(F.prototype,"listDocuments",[$.a],Object.getOwnPropertyDescriptor(F.prototype,"listDocuments"),F.prototype),F);e.a=x},function(t,e,i){"use strict";var r=i(38),a=i.n(r),n=i(7),o=i.n(n),u=i(8),s=i.n(u),h=i(1),d=i(0),c=i(4),v=i(27),y=function(){function t(){o()(this,t),this.FOLDER_MIMETYPE="application/vnd.google-apps.folder",this.folders={root:{type:"root",title:"_Moo.do Files (Do not delete)",id:void 0,prop:"MooDoDefaultRoot"},attach:{type:"attach",title:"Shared Attachments",id:void 0,prop:"MooDoDefaultAttach",parent:"root"},backup:{type:"backup",title:"Moo.do Backups",id:void 0,prop:"MooDoDefaultBackup",parent:"root"}}}return s()(t,[{key:"createFolderStructure",value:function(t,e){var i=t.type;try{d.default.PAssert(1232,!d.default.isDemoMode(),"Should not be creating "+i+"folder in demo mode")}catch(n){d.default.reportError(n)}try{d.default.PAssert(1233,void 0===t.id,"Must not already have a "+i+"folder")}catch(n){d.default.reportError(n)}t.parent&&(this.folders[t.parent].id||this.getFolder(this.folders[t.parent],this.createFolderStructure.bind(this,t)));try{d.default.PAssert(1235,e,"Must supply a valid callback when done creating the "+i+" file structure")}catch(n){d.default.reportError(n)}var r=v.a.fns("drive").files.insert.packedFn,a={resource:{mimeType:this.FOLDER_MIMETYPE,title:t.title,writersCanShare:!1,folderColorRgb:"#FF7537",properties:[{key:t.prop,value:"TRUE",visibility:"PRIVATE"}]}};t.parent&&(a.resource.parents=[{id:this.folders[t.parent].id}]);d.default.vmMain.remoteAPI().runRemoteSingleRequest(r,a,function(t){return d.default.shouldLog(h.a.LogLevels.Folders)&&d.default.log("Successfully created "+i+" folder",t),e(t.id)},function(t){return d.default.shouldLog(h.a.LogLevels.Folders)&&d.default.log("Error creating "+i+" folder",t),e()})}},{key:"getSetting",value:function(t){var e=c.default.settings.driveFolders.get();return e?e[t]:void 0}},{key:"setSetting",value:function(t,e){var i=Object.assign({},c.default.settings.driveFolders.get(),a()({},t,e));c.default.settings.driveFolders.set(i)}},{key:"getFolderByType",value:function(t,e){return this.getFolder(this.folders[t],e)}},{key:"getFolder",value:function(t,e){var i=this;d.default.isString(t)&&(t=this.folders[t]);try{d.default.PAssert(1236,t,"Trying to get invalid folder")}catch(a){d.default.reportError(a)}try{d.default.PAssert(1237,!d.default.isDemoMode(),"Should not be creating file structure in demo mode")}catch(a){d.default.reportError(a)}try{d.default.PAssert(1238,e,"Must provide a valid callback when getting the root folder")}catch(a){d.default.reportError(a)}if(t){if(t.id)return e(t.id);var r=function(){var r=i.getSetting(t.type),n=function(){i.createFolderStructure(t,function(r){return r?(t.id=r,i.setSetting(t.type,r),e(r)):e(void 0)})};if(r){d.default.vmMain.remoteAPI().driveFilesGet(r,function(i){if(i)return t.id=r,e(r);n()},function(r){if(i.setSetting(t.type,void 0),!r||!r.error||404!==r.error.code)return e(void 0);n()})}else{var o="properties has {key='"+t.prop+"' and value='TRUE' and visibility='PRIVATE'} and 'me' in owners and trashed=false";d.default.vmMain.remoteAPI().driveFilesList(o,function(r){if(r.length>0){try{d.default.PAssert(1239,1===r.length,"Must have a single root folder present")}catch(a){d.default.reportError(a)}return d.default.shouldLog(h.a.LogLevels.Folders)&&d.default.log("Successfully found root folder",r),t.id=r[0].id,i.setSetting(t.type,t.id),e(t.id)}n()},function(t){return d.default.shouldLog(h.a.LogLevels.Folders)&&d.default.log("Error getting root folder",t),e(void 0)},{getAllPages:!0})}};t.parent?this.getFolderByType(t.parent,r):r()}else e(void 0)}},{key:"copyFileToFolder",value:function(t,e,i){d.default.vmMain.remoteAPI().driveParentsInsert(t,e,function(t){d.default.shouldLog(h.a.LogLevels.Folders)&&d.default.log("Error sharing file ",t),i(!0,t)},function(t){d.default.shouldLog(h.a.LogLevels.Folders)&&d.default.log("Successfully shared file ",t),i(!1,t)})}},{key:"getAttachFolder",value:function(t){return this.getFolderByType(h.a.DriveFolder.Attach,t)}},{key:"getRootFolder",value:function(t){return this.getFolderByType(h.a.DriveFolder.Root,t)}},{key:"getBackupFolder",value:function(t){return this.getFolderByType(h.a.DriveFolder.Backup,t)}},{key:"getDocumentFolder",value:function(t,e){var i={type:t,title:t,id:void 0,parent:h.a.DriveFolder.Root,prop:t};this.getFolder(i,e)}}]),t}();e.a=new y},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(0),s=i(1),h=i(6),d=i(14),c=i(100),v=i(88),y=i(35),g=function(){function t(){a()(this,t)}return o()(t,[{key:"_setSectionValue",value:function(t,e,i){t.hasOwnProperty(e)||(t[e]=i)}},{key:"_parseSection",value:function(t,e){for(var i=0,r={},a=e;a<t.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=t[a];if(n){var o=n.indexOf(":"),s=[n.substr(0,o),n.substr(o+1)],h=s[0].split(";");switch(h[0]){case"BEGIN":var d=this._parseSection(t,a+1);a+=d.size,r[s[1]]=d.section;break;case"END":return{section:r,size:a-e+1};default:if(h.length>1){for(var c=0,v={value:s[1]},y=1;y<h.length;++y){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var g=h[y].split("=");try{u.default.PAssert(484,!v.hasOwnProperty(g[0]),"Should never overwrite line values")}catch(l){u.default.reportError(l)}v[g[0]]=g[1]}this._setSectionValue(r,h[0],v)}else this._setSectionValue(r,h[0],s[1]);break;case void 0:case null:try{u.default.PAssert(485,!1,"Invalid ICS format: "+n)}catch(l){u.default.reportError(l)}}}}return r}},{key:"parseICS",value:function(t){for(var e=0,i=t.split("\n"),r=[],a=0;a<i.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=i[a];n.startsWith(" ")?r[r.length-1]+=n.trim():r.push(n.trim())}return this._parseSection(r,0)}},{key:"parseHead",value:function(t){for(var e=0,i={},r=0;r<t.childElementCount;++r){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=t.children[r],n=a.nodeName;if(a.firstChild){var o=a.firstChild.textContent;i[n]=o}}return i}},{key:"parseOPML",value:function(t,e){var i=function(t,r){var a,n=!0;switch(t.nodeName){case"#document":case"body":case"opml":break;case"head":n=!1;this.parseHead(t);break;case"outline":r||e&&(r=e);var o=t.attributes.text,h=o?o.value:"",c=t.attributes.complete||t.attributes._complete,v=!(!c||"true"!==c.value),y=t.attributes.note||t.attributes._note||t.attributes.Notes,g={text:u.default.stripFormattingTags(h).replace(/[\r\n\t]/g," "),isComplete:v};if(a=d.a.createVMLI(g,{parent:r,changeType:s.a.ChangeType.AllLocal}),r.insertItem(a),y){var l={text:y.value,isNote:!0},p=d.a.createVMLI(l,{parent:a,changeType:s.a.ChangeType.AllLocal});a.setNote(p,s.a.ChangeType.AllLocal)}break;default:u.default.log("Unknown OPML Node: ",t)}if(n)for(var m=0,f=0;f<t.childElementCount;++f){if(m++>5e3&&__infLoop&&__infLoop(m))throw new RangeError;i(t.children[f],a)}return a}.bind(this);return h.e.beginAction(),i(t),h.e.endAction(),!0}},{key:"createItemsFromTree",value:function(t,e){}},{key:"parseJSON",value:function(t){if(void 0!==t.moodoVer&&(void 0!==t.moodoRoot||void 0!==t.items))try{var e;u.default.parseInt(t.moodoVer);if(t.doc){var i={},r=t.items.map(y.a.itemIn).map(function(t){var e=i[t.id];if(e||(e=d.a.generateID(),i[t.id]=e),t.id=e,t.parent){t.parent=i[t.parent];try{u.default.PAssert(486,t.parent,"Imported item has no parent")}catch(r){u.default.reportError(r)}}return t});v.a.createItemHierarchy(r),e={rootData:r[0],root:r[0],items:r}}else(e=(new c.a).translateDocument({root:t.moodoRoot},!1))&&(e.rootData=e.root);return e&&(e.root.id=d.a.generateID()),e}catch(a){u.default.reportError(a)}return!1}},{key:"_findLineParent",value:function(t,e,i){for(var r,a=0,n=Math.min(t.length-1,e-1);n>=0;--n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var o=t[n];if(o&&o.indentLevel===i-1){r=o;break}}return r}},{key:"parseText",value:function(t){for(var e=0,i={items:[]},r=[],a=0;a<t.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var n=this._parseTextLine(t[a]);if(n){r.push(n);var o=this._findLineParent(r,a,n.indentLevel)||i;n.parent=o,o.items.push(n)}}return i}},{key:"_parseTextLine",value:function(t){if(t&&t.length>0)return{indentLevel:Math.floor(t.search(/\S|$/)/4),text:u.default.trimString(t.replace(/[\ud800-\udfff]+/g,"")),items:[]}}},{key:"_addMulti",value:function(t,e,i){return t[e]||(t[e]=i),t[e]}},{key:"_getReference",value:function(t,e){var i;return"Evernote"!==e.type&&(i=t[e.value]),i}},{key:"_hasReference",value:function(t,e){var i=!0;return"Evernote"!==e.type&&(i=!!t[e.value]),i}},{key:"_lookupNode",value:function(t,e){return t[u.default.hashString(e)]}},{key:"_storeNode",value:function(t,e,i){t[u.default.hashString(e)]=i}},{key:"_beginImport",value:function(t){this._reportedImportError=!1,this._rawImportData=t}},{key:"_endImport",value:function(){this._reportedImportError=!1,this._rawImportData=void 0}},{key:"_reportRecursiveImport",value:function(){this._reportRecursiveImport||u.default.reportError(new Error("Recursive import failure"),this._rawImportData)}},{key:"_parseEntries",value:function(t){var e=[];if(t){for(var i=0,r=0,a=t.split(", "),n=["Organization","Contact","Prospect","Email","Evernote","Project","Sub-Project","Subtask","Action"],o=[],u=a.length-1;u>=0;u--){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=a[u],h=/^([^:]*):\s(.*)/.exec(s);(!h||!h[1]||n.indexOf(h[1])<0)&&u>0?(a[u-1]+=", "+a[u],a.removeAt(u)):o.push(s)}for(u=0;u<o.length;++u){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var d=o[u],c=d.indexOf(":");if(c>0){var v=d.substr(0,c),y=d.substr(c+2);e.push({type:v,value:y})}}}return e}},{key:"stripParents",value:function(t){if(t.parent=void 0,t.items)for(var e=0,i=0;i<t.items.length;i++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;this.stripParents(t.items[i])}}},{key:"parseClassName",value:function(t,e){if(t)return t.indexOf("high")>=0?e.priority=s.a.VMLIFlag.P0:t.indexOf("medium")>=0?e.priority=s.a.VMLIFlag.P1:t.indexOf("low")>=0&&(e.priority=s.a.VMLIFlag.P2),t.indexOf("complete")>=0&&(e.isComplete=!0),t.indexOf("starred")>=0&&(e.isStarred=!0),t.indexOf("note")>=0&&(e.isNote=!0),e}},{key:"traverseDOM",value:function(t){var e,i,r,a,n,o=this,s=0,h=t.root,d=t.stripParents,c=t.shouldPrint,v=t.preserveWhitespace,y=h.firstChild,g={text:"",parent:void 0,items:[]},l=g,p=!1,m=!1,f=!1,k=function(t){var a=t;if(t.nodeType===Node.TEXT_NODE){(m||p)&&(v||(l.text=l.text.replace(/^ +/g,"").replace(/ +$/g,"")),""===l.text&&f||(f||(f=!0,l={text:"",parent:l,date:void 0}),e={text:"",parent:l.parent,date:r},o.parseClassName(i,e),u.default.hasClass(t.parentNode,"note")?(e.isNote=!0,l._note=e):l.parent.items.push(e),l=e,r=void 0)),m=!1,p=!1;var n=t.nodeValue.replace(/[\ud800-\udfff]+/g,"");""===l.text&&(n=v?n.replace(/^[\r\n\t]+/g,""):n.replace(/^[ \r\n\t]+/g,"")),o.parseClassName(i,l),r&&(l.date=r),l.text+=u.default.stripFormattingTags(n)}else t.nodeType===Node.COMMENT_NODE||("BR"===a.tagName||"P"===a.tagName||"LI"===a.tagName||"DIV"===a.tagName?(p=!0,i=a.className,r=a.getAttribute("data-date")):"A"===a.tagName?l.text+="[":"UL"!==a.tagName&&"OL"!==a.tagName||(f=!0,l.text=l.text.replace(/^ +/g,"").replace(/ +$/g,""),e={text:"",parent:l},o.parseClassName(i,e),l.items?l.items.push(e):l.items=[e],l=e,p=!1,i="",r=void 0))},A=function(t){t.nodeType!==Node.TEXT_NODE&&("UL"===t.tagName||"OL"===t.tagName?(l=l.parent,m=!0):"DIV"===t.tagName||"P"===t.tagName?(p=!0,i="",r=void 0):"A"===t.tagName&&(l.text+="]("+t.getAttribute("href")+")"))};do{if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(k(y),"note"===y.className?(n=y,l.text=n.innerHTML,l.parent._note=l,l.isNote=!0,l={text:"",parent:l.parent},m=!0,p=!0,a=void 0):a=y.firstChild,a)y=a;else if(a=y.nextSibling)y=a;else{var S=0;do{if(S++>5e3&&__infLoop&&__infLoop(S))throw new RangeError;(a=y.parentNode.nextSibling)?(A(y.parentNode),y=a):A(y=y.parentNode)}while(!a&&y&&y.parentNode);if(!a)break}}while(y);if(d&&this.stripParents(g),c){!function t(e,i){var r=0;isNaN(i)&&(i=0);for(var a="",n=0;n<i;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;a+="--"}if(i&&console.log(a,e.text),e.items){var o=0;for(n=0;n<e.items.length;n++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;t(e.items[n],i+1)}}}(g)}return g.items&&g.items.length||(g={items:[g]}),g.items&&g.items.length&&!g.items[g.items.length-1].text&&g.items.splice(g.items.length-1,1),g}}]),t}();e.a=new g},,function(t,e,i){"use strict";var r,a=i(30),n=i.n(a),o=i(48),u=i.n(o),s=i(38),h=i.n(s),d=i(7),c=i.n(d),v=i(8),y=i.n(v),g=i(15),l=i.n(g),p=i(0),m=i(1),f=i(4),k=i(3),A=i(119),S=i(14),w=i(16),L=i(34),F=i(26),C=i(58),I=10*m.a.MSPerMinute,P=(r=function(){function t(){c()(this,t)}return y()(t,[{key:"init",value:function(){this.timeoutCheckBackupDrive=0,f.default.settings.backupFrequency.listen(this.onTimeChanged),p.default.isBoolean(f.default.settings.needsBackup.get())&&f.default.settings.needsBackup.set({}),this.needsBackupDrive=f.default.settings.needsBackup.get()||{},F.a.onAuthed(this.checkBackupAuto),f.default.settings.backupFrequency.get()>0&&L.a.onLoaded(this.checkBackupDrive),this.setupTimeouts()}},{key:"docNeedsBackup",value:function(t){var e=f.default.settings.needsBackup.get();return e&&e[t.id]&&Date.now()-e[t.id]>I}},{key:"setNeedsBackup",value:function(t,e){var i=Date.now();if(e){var r=f.default.settings.needsBackup.get();r&&r[t.id]||(this.needsBackupDrive&&(this.needsBackupDrive[t.id]=i),f.default.settings.needsBackup.set(Object.assign(h()({},t.id,i),f.default.settings.needsBackup.get())))}else{var a=p.default.clone(f.default.settings.needsBackup.get());delete a[t.id],f.default.settings.needsBackup.set(a)}}},{key:"onTimeChanged",value:function(){this.needsBackupDrive={},this.timeoutCheckBackupDrive&&clearTimeout(this.timeoutCheckBackupDrive),this.checkBackupDrive(),this.setupTimeouts()}},{key:"setupTimeouts",value:function(){clearTimeout(this.timeoutCheckBackupAuto),clearTimeout(this.timeoutCheckBackupDrive),this.timeoutCheckBackupAuto||(this.timeoutCheckBackupAuto=setTimeout(this.checkBackupAuto,I/2)),!this.timeoutCheckBackupDrive&&f.default.settings.backupFrequency.get()>0&&!k.a.isMobile&&(p.default.log("Scheduling backup in",f.default.settings.backupFrequency.get()/1e3,"seconds"),this.timeoutCheckBackupDrive=setTimeout(this.checkBackupDrive,I/2))}},{key:"onDataSaved",value:function(t){this.setNeedsBackup(t,!0)}},{key:"checkBackupAutoDoc",value:function(t){this.docNeedsBackup(t)&&this.backupDocumentAuto(t)}},{key:"checkBackupAuto",value:function(){this.setupTimeouts(),S.a.getDocumentsArray().map(this.checkBackupAutoDoc)}},{key:"checkBackupDriveDoc",value:function(t){var e=t.getLastBackup();if(!isNaN(e)&&Date.now()-e>f.default.settings.backupFrequency.get())return this.backupDocumentDrive(t),!0}},{key:"checkBackupDrive",value:function(){f.default.settings.backupFrequency.get()>0&&(clearTimeout(this.timeoutCheckBackupDrive),this.timeoutCheckBackupDrive=void 0,S.a.getDocumentsArray().map(this.checkBackupDriveDoc))}},{key:"backupDrive",value:function(){var t=u()(n.a.mark(function t(){return n.a.wrap(function(t){for(var e=0;;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;switch(t.prev=t.next){case 0:return clearTimeout(this.timeoutCheckBackupDrive),t.abrupt("return",Promise.all(S.a.getDocumentsArray().map(this.backupDocumentDrive)));case 2:case"end":return t.stop()}}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"backupAuto",value:function(){var t=u()(n.a.mark(function t(){return n.a.wrap(function(t){for(var e=0;;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;switch(t.prev=t.next){case 0:return clearTimeout(this.timeoutCheckBackupAuto),t.abrupt("return",Promise.all(S.a.getDocumentsArray().map(this.backupDocumentAuto)));case 2:case"end":return t.stop()}}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"backupAll",value:function(){var t=u()(n.a.mark(function t(){return n.a.wrap(function(t){for(var e=0;;){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;switch(t.prev=t.next){case 0:return t.abrupt("return",Promise.all([this.backupAuto(),this.backupDrive()]));case 1:case"end":return t.stop()}}},t,this)}));return function(){return t.apply(this,arguments)}}()},{key:"backupDocumentAll",value:function(){var t=u()(n.a.mark(function t(e){return n.a.wrap(function(t){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(t.prev=t.next){case 0:return t.abrupt("return",Promise.all([this.backupDocumentAuto(e),this.backupDocumentDrive(e)]));case 1:case"end":return t.stop()}}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"backupDocumentStorage",value:function(){var t=u()(n.a.mark(function t(e){var i,r,a;return n.a.wrap(function(t){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(t.prev=t.next){case 0:return i=Date.now(),r=this.getCloudBackupFilename(e,i),t.next=3,e.toJSON({exportArchived:!0,includeNotes:!0,encrypt:!0});case 3:return a=t.sent,t.prev=4,t.next=7,f.default.cloudStorage.uploadString(r,a);case 7:t.sent&&(e.addBackup(i),C.a.getAPIForDocument(e).addBackup(i),this.setNeedsBackup(e,!1)),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(4),p.default.reportError(t.t0);case 14:case"end":return t.stop()}}},t,this,[[4,11]])}));return function(e){return t.apply(this,arguments)}}()},{key:"backupDocumentAuto",value:function(){var t=u()(n.a.mark(function t(e){return n.a.wrap(function(t){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(t.prev=t.next){case 0:return k.a.isNativeApp()&&e.toJSON({exportArchived:!0,includeNotes:!0,encrypt:!1}).then(function(t){var i=(new Date).toString("yy-MM-dd h-mm tt"),r=e.text.get()+" "+i+".json";f.default.ElectronBridge.saveFile("backups/".concat(r),t,function(t){1!==+t&&p.default.reportError("Backup error",t)})}),t.abrupt("return",this.backupDocumentStorage(e));case 2:case"end":return t.stop()}}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"backupDocumentDrive",value:function(){var t=u()(n.a.mark(function t(e){return n.a.wrap(function(t){for(var i=0;;){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;switch(t.prev=t.next){case 0:if(!(f.default.settings.backupFrequency.get()>0)){t.next=4;break}return t.next=3,e.toJSON({exportArchived:!0,includeNotes:!0,encrypt:!1}).then(function(t){var i=new Blob([t],{type:"application/json"}),r=(new Date).toString("yy/MM/dd h:mm tt");return i.name=e.text.get()+" "+r,new Promise(function(t){new A.a(i,"me",m.a.DriveFolder.Backup,{docId:e.id},function(){},function(){t()},function(e){p.default.reportError(e,"Backup error"),t()}).upload()})});case 3:delete this.needsBackupDrive[e.id];case 4:case"end":return t.stop()}}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"downloadBackup",value:function(){var t=u()(n.a.mark(function t(e,i){var r,a;return n.a.wrap(function(t){for(var n=0;;){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;switch(t.prev=t.next){case 0:return r=this.getCloudBackupFilename(e,i),t.next=3,f.default.cloudStorage.getString(r);case 3:if(!(a=t.sent)){t.next=12;break}return t.prev=5,t.abrupt("return",JSON.parse(a));case 9:t.prev=9,t.t0=t.catch(5),p.default.reportError(t.t0);case 12:case"end":return t.stop()}}},t,this,[[5,9]])}));return function(e,i){return t.apply(this,arguments)}}()},{key:"getCloudBackupFilename",value:function(t,e){return"users/".concat(F.a.getUid(),"/documents/").concat(t.id,"/").concat(e,".json")}},{key:"isDriveBackupAuthorized",value:function(){return L.a.isAuthorizedForScopes(F.a.getDefaultAccountID(),[m.a.GScope.Drive])}},{key:"authorize",value:function(t){L.a.authAccount(F.a.getDefaultAccountID(),[m.a.GScope.Drive],function(e){t(e)})}},{key:"enable",value:function(){var t=this;this.authorize(function(e){e&&(f.default.settings.backupFrequency.set(m.a.DefaultBackupFrequency),t.backupDrive())})}},{key:"getLastBackup",value:function(){return S.a.getDocumentsArray().reduce(function(t,e){return Math.max(t,e.getLastBackup())},0)}}]),t}(),l()(r.prototype,"onTimeChanged",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"onTimeChanged"),r.prototype),l()(r.prototype,"checkBackupAutoDoc",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"checkBackupAutoDoc"),r.prototype),l()(r.prototype,"checkBackupAuto",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"checkBackupAuto"),r.prototype),l()(r.prototype,"checkBackupDriveDoc",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"checkBackupDriveDoc"),r.prototype),l()(r.prototype,"checkBackupDrive",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"checkBackupDrive"),r.prototype),l()(r.prototype,"backupDocumentStorage",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"backupDocumentStorage"),r.prototype),l()(r.prototype,"backupDocumentAuto",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"backupDocumentAuto"),r.prototype),l()(r.prototype,"backupDocumentDrive",[w.a],Object.getOwnPropertyDescriptor(r.prototype,"backupDocumentDrive"),r.prototype),r);e.a=new P},,function(t,e,i){"use strict";i.r(e);var r=i(43),a=i.n(r),n=i(0),o=i(19),u=i(1),s=i(4),h=i(109),d=i.n(h),c=i(3),v=i(51),y=i(14),g={pendingRemoteUpdates:{},itemCache:{},dbDataCache:{},loadedItemCount:0,hasLocalData:!1,freezeUpdates:!1,hasMadeInMemoryOnlyUpdate:!1,dbClosed:!1,overQuota:!1,dbi:void 0};function l(t,e){var i=n.default.fieldMapValidators[t];return i&&i(e)||void 0===e||null===e}g.forEachModel=function(t){try{n.default.PAssert(1128,t,"Must pass a valid function to iterate on")}catch(i){n.default.reportError(i)}for(var e in g.itemCache)g.itemCache[e]&&t(g.itemCache[e])},g.getModel=function(t){try{n.default.PAssert(1129,n.default.isString(t),function(){return"ID must be a valid string: "+n.default.getObjectInfo(t)})}catch(e){n.default.reportError(e)}try{n.default.PAssert(1130,t,"Tried to get a model with an invalid id")}catch(e){n.default.reportError(e)}return g.itemCache[t]},g.setModel=function(t){try{n.default.PAssert(1131,t,"Tried to set an invalid model")}catch(e){n.default.reportError(e)}try{n.default.PAssert(1132,t.id,"Tried to set a model with an invalid id")}catch(e){n.default.reportError(e)}try{n.default.PAssert(1133,n.default.isString(t.id),function(){return"ID must be a valid string: "+n.default.getObjectInfo(t.id)})}catch(e){n.default.reportError(e)}try{n.default.PAssert(1134,void 0===g.itemCache[t.id],"Must not be replacing a model with another copy")}catch(e){n.default.reportError(e)}g.itemCache[t.id]=t},g.clearModel=function(t){try{n.default.PAssert(1135,n.default.isString(t),function(){return n.default.getObjectInfo(t)})}catch(e){n.default.reportError(e)}try{n.default.PAssert(1136,void 0!==g.itemCache[t],"Must not clear a model that does not exist")}catch(e){n.default.reportError(e)}g.itemCache[t]=void 0},g.getItem=function(t){try{n.default.PAssert(1137,n.default.isString(t),function(){return"ID must be a valid string:"+n.default.getObjectInfo(t)})}catch(e){n.default.reportError(e)}try{n.default.PAssert(1138,t,"Tried to get an item that doesn't exist")}catch(e){n.default.reportError(e)}return g.dbDataCache[t]},g.setItem=function(t,e){try{n.default.PAssert(1139,n.default.isString(t),function(){return"ID must be a valid string: "+n.default.getObjectInfo(t)})}catch(i){n.default.reportError(i)}try{n.default.PAssert(1140,t,"Tried to set an item with an invalid id")}catch(i){n.default.reportError(i)}try{n.default.PAssert(1141,void 0===g.dbDataCache[t]||void 0===e,"Must not be replacing an item with another copy")}catch(i){n.default.reportError(i)}g.dbDataCache[t]=e},g.validateItemData=function(t){try{for(var e in t){var i=l(e,t[e])||!1;try{n.default.PAssert(1142,i,"Invalid data set in item: ",e,"=",t[e],a()(t[e]))}catch(r){n.default.reportError(r)}i||g.fixItemData(t,e)}}catch(o){n.default.reportError(o)}},g.fixItemData=function(t,e){var i=!1,r=n.default.fieldMapFixer[e];if(r){var a=r(t[e]);n.default.log("Value Fixed: ",t[e],"->",a),t[e]=a;try{n.default.PAssert(1143,l(e,a),"Fixed field must always be valid")}catch(o){n.default.reportError(o)}i=!0}return i},g.clearItems=function(){g.dbDataCache={},g.itemCache={}},g.clearPlugins=function(){s.default.pluginManager.onClearData()},g.getRootItem=function(){return g.rootId?g.getItem(g.rootId):void 0},g.getRootModel=function(){return g.rootId?g.getModel(g.rootId):void 0},g.createVMLI=function(t,e){return s.default.itemStoreManager.getDefaultItemStore().createItemRaw(t,e)},g.createTempVMLI=function(t,e){return e.noSave=!0,e.canDestroy=!0,s.default.itemStoreManager.getTempItemStore().createItemRaw(t,e)},g.destroyTempVMLI=function(t){s.default.itemStoreManager.getTempItemStore().destroyItem(t)},g.initializeIndexedDB=function(t){var e=3;function i(i){i&&d.a?d.a.open({server:"duchess",version:e,schema:{items:{key:{keyPath:"id"}},settings:{},caches:{key:{keyPath:"cid"}}}}).done(function(e){g.dbi=e;try{e.handleDisconnect(function(t){n.default.log("DB Disconnect Event: ",t)})}catch(r){n.default.reportError(r)}for(var i=0;i<p.length;++i)p[i](!0);p=[],t()}).fail(function(e){try{n.default.log("Error loading local DB client - "+e.target.error.name+": "+e.target.error.message)}catch(i){n.default.log("Error loading local DB client - Invalid Error Message")}n.default.preventLocalWrites(u.a.LocalWriteReason.Generic),"Firefox"===c.a.browser?e.target&&e.target.error&&"InvalidStateError"===e.target.error.name||n.default.reportError(new Error("DB Load Failure"),e):"Safari"===c.a.browser&&e.target&&e.target.error&&"DBOpenError"===e.target.error.name||n.default.reportError(new Error("DB Load Failure"),e),"VersionError"===e.target.error.name&&(o.a.hasURLParam("versionError")||s.default.AppCache.runOnFinish(function(){o.a.insertURLParam("versionError",!0)},!0)),t()}):(n.default.preventLocalWrites(u.a.LocalWriteReason.Generic),t())}window.indexedDB&&void 0!==window.indexedDB.onIsReady&&null!==window.indexedDB.onIsReady?window.indexedDB.onIsReady(i):setTimeout(function(){i(!0)},0)},g.getDBState=function(t){t.dbClosedUnexpected=g.dbClosed,t.hasLocalData=g.hasLocalData,t.hasMadeInMemoryOnlyUpdate=g.hasMadeInMemoryOnlyUpdate};var p=[];g.onCachesAvailable=function(t){g.dbi?t(!0):n.default.shouldWriteLocal()?p.push(t):t(!1)},g.openCacheDatabase=function(t,e,i,r){var a=function(){d.a?d.a.open({server:t,version:e,schema:i}).done(function(t){r(t)}).fail(function(t){r(void 0)}):r(void 0)};window.indexedDB&&void 0!==window.indexedDB.onIsReady&&null!==window.indexedDB.onIsReady?a():setTimeout(a,0)};var m={};g.openCacheTable=function(t){if(g.dbi)return m[t]=void 0===m[t]?1:m[t]+1,g.dbi.caches},g.closeCacheTable=function(t){try{n.default.PAssert(1144,m[t]>0,"Must have previously opened the cache to close it")}catch(e){n.default.reportError(e)}m[t]--};var f,k=!1;function A(){}function S(t,e){if(e&&e.target){var i=e.target.error;if(i){n.default.log("Transaction Error Info: ",i.type,i.name,i.code,i.message);var r="QuotaExceededError"===i.name||4===i.code;"InvalidStateError"===i.name||r?g.notifyDBUnexpectedClose(r):n.default.reportError(new Error("IDB Transaction Error"),i)}else n.default.reportError(new Error("Unexpected transaction error A"),e)}else n.default.reportError(new Error("Unexpected transaction error B"),e)}g.localDataLoaded=function(){return k},g.loadFromIndexedDB=function(t){try{n.default.PAssert(1146,!k,"Should never load local data twice")}catch(d){n.default.reportError(d)}if(n.default.shouldLog(u.a.LogLevels.Timing)&&n.default.log("Loading DB: ",log.now()),g.dbDataCache={},n.default.shouldWriteLocal())if(g.dbi&&g.dbi.items){var e,i,r=!1,a=!1,o=window.__preload,s=function(e){try{n.default.PAssert(1147,!a,"Should only process load results once")}catch(d){n.default.reportError(d)}a=!0,n.default.shouldLog(u.a.LogLevels.Timing)&&n.default.log("Loaded DB: ",log.now()),g.loadedItemCount=0;for(var i=0;i<e.length;++i){var s=r?e[i]:n.default.translateObjOut(e[i]);e[i]&&e[i].id&&s&&(g.setItem(e[i].id,s),g.loadedItemCount++)}if(g.dbi.settings){var h=function(e){if(!n.default.criticalErrorReported()){if(k=!0,e){try{n.default.PAssert(1148,g.getItem(e.root),"If there is a root item defined there should be a corresponding local item")}catch(d){n.default.reportError(d)}g.rootId=e.root}t&&t()}};o.settingsPreload&&o.settingsPreload.root?h(o.settingsPreload.root):g.dbi.settings.get("root").done(h).fail(t)}else n.default.log("Unable to load local settings DB"),t&&t()};o?o.mainLoaded=!0:o=window.__preload={mainLoaded:!0};var h=function(t){i=Date.now(),e&&n.default.log("Time preload blocked: ",i-e),clearTimeout(o.mainTimeout),o.mainTimeout=void 0,o.dataResults=void 0,t?s(t):(r=!1,o.onDataLoaded=void 0,g.dbi.items.query().all().fastExecute().done(s))};o.runDataLoad?(r=!0,o.dataResults?(console.log("Preload data available"),h(o.dataResults)):(console.log("Blocked on preload"),e=Date.now(),o.onDataLoaded=h,o.mainTimeout=setTimeout(function(){n.default.reportError(new Error("Preload timeout"));try{n.default.PAssert(1149,!o.dataResults,"Should not have results defined")}catch(d){n.default.reportError(d)}r=!1,o.onDataLoaded=void 0,g.dbi.items.query().all().fastExecute().done(s)},15e3))):(console.log("Preload skipped"),g.dbi.items.query().all().fastExecute().done(s))}else n.default.log("Unable to load local items DB - db not connected"),k=!0,n.default.preventLocalWrites(u.a.LocalWriteReason.Generic),t&&t();else n.default.log("Unable to load local items DB - already disabled"),k=!0,t&&t()},g.beginTransaction=function(){n.default.shouldWriteLocal()&&(f={})},g.transactionUpdate=function(t,e){try{n.default.PAssert(1150,n.default.shouldWriteLocal(),"Should never be writing during a transaction if local writes are disabled")}catch(r){n.default.reportError(r)}if(f[t])for(var i in e)f[t][i]=e[i];else f[t]=e},g.notifyDBUnexpectedClose=function(t){var e;t?(s.default.toasts.pushMessage(u.a.MessageID.QuotaError),g.overQuota=!0,e=u.a.LocalWriteReason.QuotaError):(s.default.toasts.pushMessage(u.a.MessageID.LocalWritesDisabled),e=u.a.LocalWriteReason.Generic),n.default.preventLocalWrites(e),g.dbClosed=!0;try{n.default.PAssert(1151,n.default.vmMain&&s.default.pluginManager,"Should always have a plugin manager when reporting DB quota error")}catch(i){n.default.reportError(i)}n.default.vmMain&&s.default.pluginManager&&t&&s.default.pluginManager.onCacheLimitExceeded()},g.endTransaction=function(){if(n.default.shouldWriteLocal()&&g.dbi&&g.dbi.items)try{g.dbi.items.updateObject(f).done(A).fail(S)}catch(t){n.default.reportError(t),S()}else void 0!==f&&n.default.reportError(new Error("Started a transaction and stopped writes halfway through"));f=void 0},g.hasPendingDBTransaction=function(){return!!f},g.dbUpdateItem=function(t){if(!g.freezeUpdates){g.hasLocalData||n.default.isLoadingRemote||t.skipLocalModification||(g.hasLocalData=!0);var e=t.changes||{},i=t.id?t.id:e.id,r=t.callback,a=t.saveFlags;try{n.default.PAssert(1152,a===u.a.SaveFlag.None||a===u.a.SaveFlag.Prop||a===u.a.SaveFlag.Text||a===u.a.SaveFlag.All)}catch(c){n.default.reportError(c)}var o=g.getItem(i);if(n.default.shouldWriteLocal()){var s;try{n.default.PAssert(1153,!a||void 0===e.modifiedOffline&&void 0===e.modifiedOfflineText,"Shouldn't be setting a modified flag while passing them in with changes")}catch(c){n.default.reportError(c)}if(n.default.isFlagSet(a,u.a.SaveFlag.Prop)){try{n.default.PAssert(1154,void 0===e.modifiedOffline,"Shouldnt be passing in a value and assigning "+e.modifiedOffline)}catch(c){n.default.reportError(c)}n.default.shouldLog(u.a.LogLevels.Verbose|u.a.LogLevels.Data)&&n.default.log("Marking Item Modified Offline:",o?o.text:e.text),e.modifiedOffline=!0,(h=g.getModel(i))&&(h.modifiedOffline=!0)}if(n.default.isFlagSet(a,u.a.SaveFlag.Text)){try{n.default.PAssert(1155,void 0===e.modifiedOfflineText,"Shouldnt be passing in a value and assigning "+e.modifiedOfflineText)}catch(c){n.default.reportError(c)}var h;n.default.shouldLog(u.a.LogLevels.Verbose|u.a.LogLevels.Data)&&n.default.log("Marking Text Modified Offline:",o?o.text:e.text),e.modifiedOfflineText=!0,(h=g.getModel(i))&&(h.modifiedOfflineText=!0)}if(o){for(var d in e){if(e.hasOwnProperty(d))o[d]=e[d]}g.validateItemData(o),s=n.default.translateObjIn(o)}else{try{n.default.PAssert(1156,e.id,"Item being modified does not already exist as expected",e)}catch(c){n.default.reportError(c)}g.setItem(i,e),s=n.default.translateObjIn(e)}if(n.default.shouldLog(u.a.LogLevels.Verbose)&&n.default.log("Local Update: ",JSON.stringify(e,null,4)),f){try{n.default.PAssert(1158,!r,"Callbacks not supported for updates inside of a transaction")}catch(c){n.default.reportError(c)}g.transactionUpdate(i,s)}else try{r?g.dbi.items.update(s).done(r).fail(r):g.dbi.items.update(s)}catch(v){"InvalidStateError"===v.name?g.notifyDBUnexpectedClose(!1):n.default.reportError(v)}}else{if(o)for(var d in e)e.hasOwnProperty(d)&&(o[d]=e[d]);else g.setItem(i,e);g.hasMadeInMemoryOnlyUpdate=!0,r&&r()}}},g.dbDeleteItem=function(t,e){if(!g.freezeUpdates&&(g.setItem(t,void 0),n.default.shouldWriteLocal()))try{e?g.dbi.items.remove(t).done(e).fail(e):g.dbi.items.remove(t)}catch(i){n.default.reportError(i)}},g.setRoot=function(t){if(!g.freezeUpdates){if(n.default.shouldWriteLocal())try{g.dbi.settings.update({key:"root",item:{root:t}})}catch(e){n.default.reportError(e)}return g.rootId=t,g.getRootItem()}},g.setPluginData=function(t){var e=Object.keys(t),r=i(151).default;r.clearGapiData();for(var a=0;a<e.length;++a){var n=e[a],o=s.default.pluginManager.getPlugin(n),u=t[n].data;u&&(r.setGapiData(n,u),o&&o.forceLoad())}};var w=!1;function L(t){var e=g.getItem(t);if(e){var i=e.items;if(i)for(var r=0;r<i.length;++r)L(i[r]);g.dbDeleteItem(e.id)}}function F(t,e,i,r){try{n.default.PAssert(1162,t,"Must provide a valid item")}catch(o){n.default.reportError(o)}try{n.default.PAssert(1163,t.shouldSave(),"Item must be marked as saveable")}catch(o){n.default.reportError(o)}var a=n.default.isLocalChange(r)?u.a.SaveFlag.Prop:u.a.SaveFlag.None;y.a.saveItemLocal(t,{items:t.getItemsArrayForSave()},a),y.a.saveItemLocal(e,{isArchived:i},a)}function C(t,e,i){var r=t[e];return r?',"'+e+'":'+(i?i(r):r):""}g.initData=function(t){if(w)return!1;w=!0,n.default.shouldLog(u.a.LogLevels.Timing)&&n.default.log("Initializing User Item Data",log.now());try{n.default.isDemoMode()?setTimeout(function(){var e=o.a.getURLParam("data");g.loadDemoData(e,!1,t)},0):(n.default.checkpoint(u.a.Checkpoint.InitData),g.initializeIndexedDB(function(){g.loadFromIndexedDB(function(){n.default.checkpoint(u.a.Checkpoint.DBLoaded),g.checkLocalIntegrity(function(e){v.a.loadContacts(),e&&e.error&&n.default.reportError(new Error("Error during local integrity check")),t()})})}))}catch(e){n.default.reportError(e)}return!0},g.initializeItem=function(t){try{n.default.PAssert(1159,t.shouldSave(),"Item must be marked as saveable")}catch(v){n.default.reportError(v)}var e=t.id,i=!e||n.default.isLocalItem(t)||!t.data;if(i){var r=gdata.createNewItem(t,t.hasChildren(),t.hasArchivedChildren());n.default.shouldLog(u.a.LogLevels.Data)&&n.default.log("Initializing",t.id,t.getParsedText()),e&&e!==r&&g.modifyItemId(e,r);for(var a=!1,o=t.numItems(),s=0;s<o;++s){var h=g.initializeItem(t.itemAtIndex(s));a=a||h}if(t.hasArchivedChildren()){var d=t.archivedItems(!0);for(s=0;s<d.length;++s){h=g.initializeItem(d[s]);a=a||h}}if(t.hasNote()){h=g.initializeItem(t.getNote());a=a||h}if(gdata.initializeNewItem(t),e&&e!==r){var c=t.parent();c&&y.a.saveItemLocal(c,null,u.a.SaveFlag.None)}}return i},g.checkLocalIntegrity=function(t){n.default.shouldLog(u.a.LogLevels.Timing)&&n.default.log("Checking Local: ",log.now());var e=!1;g.ensureLocalCache(function(){n.default.shouldLog(u.a.LogLevels.Timing)&&n.default.log("Verifying Local Data",log.now());var i=!1,r={};for(var a in g.dbDataCache)if(g.dbDataCache.hasOwnProperty(a)&&g.getItem(a)){((l=g.getItem(a)).i||l.t)&&(n.default.log("%cInvalid local properties on item: ","color: red",l),e=!0),r[l.id]?r[l.id].exist?(n.default.log(l.id,": Duplicated IDs in the local database",l),e=!0):(r[l.id].exist=!0,r[l.id].del=!!l.isDeleted):r[l.id]={exist:!0,ref:!1,del:!!l.isDeleted},l.id===g.rootId&&(i&&(n.default.log(l.id,": Multiple roots present locally",l),e=!0),i=!0,r[l.id].isRoot=!0),void 0===l.text&&(n.default.log("Found item with no text",l.id),l.text="",g.dbUpdateItem({id:a,changes:{text:""},saveFlags:u.a.SaveFlag.None})),l.note&&(r[l.note]?r[l.note].ref?(n.default.log(l.id,": Item note is used twice - ",l.note),e=!0):r[l.note].ref=l.id:r[l.note]={exist:!1,ref:l.id});for(var o=0;l.items&&o<l.items.length;++o){var s=-1;if(l.items[o]){var h=l.items[o],d=g.getItem(h);if(d){if(d.isArchived&&(s=o),s>=0&&!d.isArchived){n.default.log(h,": Unarchived child found after an archived one"),n.default.log("   ",l.id,": Parent with incorrectly ordered children"),e=!0;var c=l.items.removeAt(s);l.items.insert(o,c),s=o,g.dbUpdateItem({id:l.id,changes:{items:l.items},saveFlags:u.a.SaveFlag.None})}}else n.default.log(h,": Child does not have a valid reference on our local database"),e=!0;if(r[h])if(r[h].ref)n.default.log(h,": Item is referenced locally multiple times: ",d?g.getItem(h).id:"UNDEFINED"),n.default.log("   ",r[h].ref,": ",g.getItem(r[h].ref).id),n.default.log("   ",l.id,": <CLIENTDATA>"),e=!0,(p=l.items).removeAt(o),g.dbUpdateItem({id:a,changes:{items:p},saveFlags:u.a.SaveFlag.None});else r[h].ref=l.id;else r[h]={exist:!1,ref:l.id}}else n.default.log(l.id,": Invalid item in local items array"),e=!0}}for(var v in!i&&g.hasLocalData&&(n.default.log("No root present"),e=!0),r){var y=r[v];if(!y.exist){n.default.log(v,": Item is referenced locally as a child but does not exist in the database");var l=g.getItem(y.ref);try{n.default.PAssert(1160,l,"Parent of item must exist")}catch(m){n.default.reportError(m)}if(l)(p=l.items)?p.remove(v):p=[],g.dbUpdateItem({id:l.id,changes:{items:p},saveFlags:u.a.SaveFlag.None})}if(y.ref||y.isRoot||y.del||(n.default.log(v,": Item exists locally but is not referenced by a parent"),L(v)),y.ref&&y.del){n.default.log(v,": Item is referenced locally by a parent but has been deleted");var p;l=g.getItem(y.ref);try{n.default.PAssert(1161,l)}catch(m){n.default.reportError(m)}(p=l.items)?p.remove(v):p=[],g.dbUpdateItem({id:l.id,changes:{items:p},saveFlags:u.a.SaveFlag.None})}if(y.isRoot&&y.ref&&(n.default.log(v,": Local root has a parent"),e=!0),y.del&&!y.ref){l=g.getItem(v);n.default.isLocalItem(l)&&(n.default.log("Deleting Unreferenced Local Item: ",v),g.dbDeleteItem(v))}}n.default.shouldLog(u.a.LogLevels.Timing)&&n.default.log("Done Verifying Local Data",log.now()),t({error:e,local:!1})})},g.removeDeletedItems=function(t){for(var e in g.dbDataCache){var i=g.getItem(e);i&&i.isDeleted&&(t[e]||(n.default.shouldLog(u.a.LogLevels.Verbose)&&n.default.log("Deleting Removed Local Item: ",e),g.dbDeleteItem(e)))}},g.addDefaultSkipSetting=function(t,e){g.defaultSkipSettings[e]||(g.defaultSkipSettings[e]=[]),g.defaultSkipSettings[e].push(t)},g.clearDataAndReload=function(t){o.a.hasURLParam("sinfo")&&o.a.removeURLParam("sinfo"),g.clearData(function(){setTimeout(n.default.reload,0)},g.defaultSkipSettings,t)},g.clearData=function(t,e,i){g.freezeUpdates=!0,n.default.shouldWriteLocal()||n.default.isLocalWriteReason(u.a.LocalWriteReason.QuotaError)?setTimeout(function(){if(n.default.pageDataCleared(),g.dbi)if(g.dbi.settings)try{g.dbi.settings.clear().done(function(){a()}).fail(function(){n.default.log("Failed to reset settings!"+arguments),a()})}catch(u){n.default.reportError(u),a()}else a();else g.initializeIndexedDB(function(){g.clearData(t,e)});function r(){i||(v.a.clearLocalContacts(),n.default.isArray(e));n.default.vmMain&&s.default.cacheManager&&(i?s.default.cacheManager.clearPerDocCaches(!0):s.default.cacheManager.clearLocalCaches(!0)),setTimeout(function(){t&&t()},0)}function a(){if(g.dbi.items)try{g.dbi.items.clear().done(function(){o()}).fail(function(){n.default.log("Failed to reset items!"+arguments),o()})}catch(u){n.default.reportError(u),o()}else o()}function o(){if(g.dbi.caches)try{g.dbi.caches.clear().done(function(){r()}).fail(function(){n.default.log("Failed to reset items!"+arguments),r()})}catch(u){n.default.reportError(u),r()}else r()}},0):t&&setTimeout(t,0)},g.archiveItem=function(t,e,i,r){try{n.default.PAssert(1164,t,"Must provide a valid item")}catch(a){n.default.reportError(a)}try{n.default.PAssert(1165,t.shouldSave(),"Item must be marked as saveable")}catch(a){n.default.reportError(a)}try{n.default.PAssert(1166,e>=0,"Must have a valid index to remove from")}catch(a){n.default.reportError(a)}F(t,i,!0,r),n.default.isLocalChange(r)&&gdata.itemArchived(t,i,e)},g.unarchiveItem=function(t,e,i,r){try{n.default.PAssert(1167,t,"Must provide a valid item")}catch(a){n.default.reportError(a)}try{n.default.PAssert(1168,t.shouldSave(),"Item must be marked as saveable")}catch(a){n.default.reportError(a)}try{n.default.PAssert(1169,e>=0,"Must have a valid index to remove from")}catch(a){n.default.reportError(a)}F(t,i,!1,r),n.default.isLocalChange(r)&&gdata.itemUnarchived(t,i,e,t.numItems()-1)},g.modifyItemId=function(t,e,i){n.default.shouldLog(u.a.LogLevels.Data)&&n.default.log("modifying",t,"into",e);var r=g.getItem(t),a=g.getModel(t);try{n.default.PAssert(1170,a.shouldSave(),"Item must be marked as saveable")}catch(d){n.default.reportError(d)}if(s.default.itemStoreManager.getDefaultItemStore().manualModifyItemID(t,e),r.id=e,a.id=e,g.pendingRemoteUpdates[t]&&(g.pendingRemoteUpdates[t]=void 0,g.pendingRemoteUpdates[e]=!0),r.version=-1,r.versionText=-1,"root"===t)for(var o=r.items.length-1;o>=0;o--){var h=g.getItem(r.items[o]);if(n.default.isLocalItem(h)&&!h.modifiedOffline&&!h.modifiedOfflineText){r.items.removeAt(o);try{n.default.PAssert(1171,a.itemAtIndex(o).id===h.id,"Item arrays should match")}catch(d){n.default.reportError(d)}a.getItems().removeAt(o)}}try{n.default.PAssert(1172,!g.itemCache[e],"Should not be overwriting an item in the d.itemCache")}catch(d){n.default.reportError(d)}try{n.default.PAssert(1173,!g.dbDataCache[e],"Should not be overwriting an item in the d.dbDataCache")}catch(d){n.default.reportError(d)}g.itemCache[e]=g.itemCache[t],g.dbDataCache[e]=r,g.dbDeleteItem(t),g.dbUpdateItem({changes:r,callback:i,skipLocalModification:!0,saveFlags:u.a.SaveFlag.None}),g.dbDataCache[t]=void 0,delete g.dbDataCache[t],g.itemCache[t]=void 0,delete g.itemCache[t]},g.deleteItem=function(t,e){try{n.default.PAssert(1174,t,"Must provide a valid item")}catch(i){n.default.reportError(i)}try{n.default.PAssert(1175,t.shouldSave(),"Item must be marked as saveable")}catch(i){n.default.reportError(i)}try{n.default.PAssert(1176,!t.isDeleted(),"Should never try to delete an item that has already been deleted")}catch(i){n.default.reportError(i)}if(n.default.shouldLog(u.a.LogLevels.Data)&&n.default.log("Deleting item",t.id,t.getParsedText()),g.getItem(t.id))t.setDeleted(!0,e),g.dbUpdateItem({id:t.id,changes:{isDeleted:!0},saveFlags:u.a.SaveFlag.Prop});else try{n.default.PAssert(1177,"Expected local item, didnt find one",t.id)}catch(i){n.default.reportError(i)}},g.undeleteItem=function(t,e){if(g.getItem(t.id))t.setDeleted(!1,e),g.dbUpdateItem({id:t.id,changes:{isDeleted:void 0},saveFlags:u.a.SaveFlag.Prop});else try{n.default.PAssert(1178,"Expected local item, didnt find one",t.id)}catch(i){n.default.reportError(i)}},g.saveChanges=function(t,e,i){if(t){try{n.default.PAssert(1180,t.shouldSave(),"Item must be marked as saveable")}catch(r){n.default.reportError(r)}e||(e={}),g.dbUpdateItem({id:t.id,changes:e,saveFlags:i})}else{n.default.log("Incoming item to save has no item!",t,e);try{n.default.PAssert(1179,!1,"Incoming item to save has no item!")}catch(r){n.default.reportError(r)}}},g.addPendingUpdate=function(t){try{n.default.PAssert(1181,t,"Invalid ID")}catch(e){n.default.reportError(e)}try{n.default.PAssert(1182,n.default.isString(t),"Must provide a valid id string")}catch(e){n.default.reportError(e)}n.default.shouldLog(u.a.LogLevels.Version)&&n.default.log("Add Pending Update: ",t),g.pendingRemoteUpdates[t]||(g.pendingRemoteUpdates[t]=!0)},g.clearPendingUpdate=function(t){delete g.pendingRemoteUpdates[t]},g.clearPendingUpdates=function(){for(var t in g.pendingRemoteUpdates){try{n.default.PAssert(1183,g.pendingRemoteUpdates.hasOwnProperty(t))}catch(s){n.default.reportError(s)}(n.default.shouldLog(u.a.LogLevels.Version)||n.default.shouldLog(u.a.LogLevels.Data))&&n.default.log("Clear Pending Update: ",t);var e=g.getModel(t),i=g.getItem(t);if(i&&i.isDeleted)n.default.shouldLog(u.a.LogLevels.Data)&&n.default.log("%cDB delete item","color: red",t,i.text),g.dbDeleteItem(t);else if(e&&e.data){var r={id:t,modifiedOffline:!1};e.modifiedOffline=!1,gdata.hasDeferredAction(e.id)||(e.modifiedOfflineText=!1,r.modifiedOfflineText=!1);var a=gdata.getVersion(e.data,u.a.VersionType.Structure),o=gdata.getVersion(e.data,u.a.VersionType.Text);a!=e.getVersion(u.a.VersionType.Structure)&&(r.version=a,e.setVersion(u.a.VersionType.Structure,a)),o!=e.getVersion(u.a.VersionType.Text)&&(r.versionText=o,e.setVersion(u.a.VersionType.Text,o)),g.dbUpdateItem({id:t,changes:r,saveFlags:u.a.SaveFlag.None})}}g.pendingRemoteUpdates={},setTimeout(function(){!function t(e){try{n.default.PAssert(1184,e&&e.data,"Item must have valid remote data associated with it to be in the tree")}catch(s){n.default.reportError(s)}if(!e||!e.data)return;if(!g.pendingRemoteUpdates[e.id]){var i=e.getVersion(u.a.VersionType.Structure)===gdata.getVersion(e.data,u.a.VersionType.Structure),r=e.getVersion(u.a.VersionType.Text)===gdata.getVersion(e.data,u.a.VersionType.Text),a={};i||(a.version=gdata.getVersion(e.data,u.a.VersionType.Structure),e.setVersion(u.a.VersionType.Structure,gdata.getVersion(e.data,u.a.VersionType.Structure))),r||(a.versionText=gdata.getVersion(e.data,u.a.VersionType.Text),e.setVersion(u.a.VersionType.Text,gdata.getVersion(e.data,u.a.VersionType.Text))),n.default.isEmpty(a)||(a.id=e.id,g.dbUpdateItem({id:e.id,changes:a,saveFlags:u.a.SaveFlag.None}))}var o=e.getItems();for(var h=0;h<o.length;++h)t(o[h]);if(e.hasArchivedChildren())for(var d=e.archivedItems(!0),h=0;h<d.length;++h)t(d[h])}(this.getRootModel())}.bind(this),0)},g.toDropHtml=function(t){var e="";if(!t.isArchived()&&(e+="<li>"+n.default.escape(t.getParsedText())+"</li>",t.hasChildren())){e+="<ul>";for(var i=0;i<t.numChildren();++i)e+=g.toDropHtml(t.getChild(i));e+="</ul>"}return e},g.toHtml=function(t,e,i,r){var a="<ul>";if(t.items)for(var o=0;o<t.items.length;o++){var u=g.getItem(t.items[o]),s=g.getModel(u.id),h=n.default.escape((r?s.getPrefix():"")+s.generateTitleText());if(!u.isArchived||u.isArchived&&e){if(a+="<li>"+h,u.note&&i){a+="<li>";var d=g.getModel(u.note);a+=n.default.escape(d.getParsedText()),a+="</li>"}u.items&&u.items.length>0&&(a+=g.toHtml(u,e,i,r)),a+="</li>"}}return a+="</ul>"},g.toPlainText=function(t,e,i,r,a){isNaN(e)&&(e=0);var o="";if(t.items)for(var u=0;u<t.items.length;u++){var s=g.getItem(t.items[u]),h=g.getModel(s.id);if(!s.isArchived||s.isArchived&&i){for(var d=0;d<e;d++)o+="\t";if(o+=n.default.escape((a?h.getPrefix():"")+h.generateTitleText())+"\n",s.note&&r)o+=g.getModel(s.note).getParsedText()+"\n";s.items&&s.items.length>0&&(o+=g.toPlainText(s,e+1,i,r,a))}}return o};var I=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,P={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function N(t){var e;try{var i=new Date(t);n.default.isDateValid(i)&&(e=i.getTime())}catch(r){n.default.reportError(r)}return e}function H(t,e,i,r,a){var o="";e&&(o+=",");var u=g.getModel(t.id);if(o+='{"text":"'+function(t){return I.lastIndex=0,I.test(t)?t.replace(I,function(t){var e=P[t];return n.default.isString(e)?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}):t}(u.generateSaveText(a?u.getParsedText():u.getParsedTextWithoutPrefix()))+'"'+C(t,"date",N)+C(t,"dateCompleted",N)+C(t,"priority")+C(t,"isComplete")+C(t,"isStarred")+C(t,"isArchived")+C(t,"isNote"),(t=g.getItem(t.id)).note&&r&&(o+=',"note":'+H(g.getItem(t.note),!1,i,r,a)),t.items&&t.items.length>0){o+=',"items":[';for(var s=0;s<t.items.length;s++){var h=g.getItem(t.items[s]);(!h.isArchived||h.isArchived&&i)&&(o+=H(h,s>0,i,r,a))}o+="]"}return o+="}"}g.toJSON=function(t,e,i,r,a){var o=H(t,e,i,r,a),u='{"moodoVer":'+(s.default.settings.localDataVersion.get()||gdata.currentVersion())+',"moodoRoot":'+o+"}";try{var h=JSON.parse(u),d=JSON.stringify(h);try{n.default.PAssert(1189,d===u,u)}catch(c){n.default.reportError(c)}u=JSON.stringify(h,null,2)}catch(v){n.default.reportError(v)}return u},g.createRootItem=function(t){g.setRoot(t),g.dbUpdateItem({changes:{id:t,text:u.a.RootItemName,items:[]},skipLocalModification:!0,saveFlags:u.a.SaveFlag.None,callback:function(){}})},g.ensureLocalCache=function(t){g.getRootItem()?(g.loadedItemCount>1&&(g.hasLocalData=!0),t()):t()},g.printIndexedDB=function(){if(n.default.shouldLog(u.a.LogLevels.Data|u.a.LogLevels.Verbose)){try{n.default.PAssert(1197,g.dbi,"Must have connected to local indexeddb")}catch(r){n.default.reportError(r)}for(var t=Array.prototype.slice.call(arguments),e=0;e<t.length;e++)t[e]=n.default.translateFieldIn(t[e]);var i=0===t.length;g.dbi.items.query().all().execute().done(function(e){n.default.log("---- Local DB ----");for(var r=0;r<e.length;r++)if(i)n.default.log(e[r]);else{for(var a=[],o=0;o<t.length;o++)a[o]=e[r][t[o]];log.apply(this,a)}n.default.log("------------------")})}},e.default=g},,,,,,,function(t,e,i){"use strict";var r=i(0),a=i(1),n=i(4),o=i(3),u=i(2),s=i.n(u),h=i(20),d=i(5),c=i(69),v=i(22),y=i(39),g=i(123),l=i(67),p=i(284),m=i(13),f=i(34),k=h.b.createClass({displayName:"ReactEmailCompose",componentDisplay:a.a.ComponentDisplay.Everywhere,init:function(){var t=this.props;this._dragEnterCounter=0,this._escapedFromDrag=!1,this.to=this._createTokensFromAddressText(t.message.to),this.cc=this._createTokensFromAddressText(t.message.cc);var e=!!t.message.cc&&t.message.cc.length>0;if(this.createObservables({showSubject:t.showSubject||o.a.isMobile,showCc:e,showBcc:!1,isSending:!1,isDragOver:!1}),this.listenTo(f.a.onAccountsUpdated),this.props.message.inReplyTo){var i=this.props.threadAttach.getData().messages,a=i.indexOfWithProperty("messageID",this.props.message.inReplyTo);if(a>=0){var n=i[a];try{r.default.PAssert(1710,n.initializedForDisplay,"Message must be ready to display if being replied to")}catch(u){r.default.reportError(u)}n&&n.responseMode&&(this.modeListener=n.responseMode.listen(this.onReplyModeChanged))}}r.default.isDemoMode()&&(r.default.reactEmailCompose=this)},onReplyModeChanged:function(){this.to=this._createTokensFromAddressText(this.props.message.to),this.cc=this._createTokensFromAddressText(this.props.message.cc),this.cc&&this.cc.tokens&&this.cc.tokens.length>0&&this.showCc.set(!0),this.updateState()},_getHotkeys:function(){return[y.a.create(a.a.KeyCode.Escape,!0,a.a.Primary.Either,a.a.Shift.Either,this.onEscape),y.a.create(a.a.KeyCode.Enter,!0,a.a.Primary.Yes,a.a.Shift.Either,this.send),y.a.create(a.a.KeyCode.K,!0,a.a.Primary.Yes,a.a.Shift.No,this.insertLinkHotkey)]},getState:function(){return{attachments:this.props.threadAttach.getPlugin().getMessageDisplayAttachments(this.props.message),fromAccounts:this.getSendingAccounts()}},onMount:function(){var t=this._getComposeBody(this.props.message);t&&this.refs.body.setValue(t),this.refs.container.addEventListener("cdrop",this.onItemDrop);var e=this;this.refs.picker.addEventListener("change",function(){return e.props.threadAttach.getPlugin().notifyAttachFiles(e.props.threadAttach,e.props.message,this.files,e.onAttachUpdated),this.value=null,!1},!1),this.refs.container.addEventListener("paste",function(t){var i=t&&t.clipboardData?t.clipboardData:t.synthetic?t.data:window.clipboardData;if(i&&i.items&&i.items.length>0){for(var r=0,a=[],n=0;n<i.items.length;++n){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;"file"===i.items[n].kind&&a.push(i.items[n].getAsFile())}if(a.length>0)return e.props.threadAttach.getPlugin().notifyAttachFiles(e.props.threadAttach,e.props.message,a,e.onAttachUpdated),!1}},!1),o.a.isMobile||(document.addEventListener("mouseup",this.onMouseUp),document.addEventListener("keydown",this.onKeyDown))},onUnmount:function(){this.modeListener&&(this.modeListener.dispose(),this.modeListener=void 0),this._clearDraftDebounce(!0,!0),o.a.isMobile||document.removeEventListener("mouseup",this.onMouseUp)},discard:function(){this.close(!1,!0,!0)},onEscape:function(){this.isDragOver.get()||(this.refs.to.getTokens().length>0||this.refs.body.getValue()||this.state.attachments.length>0?n.default.menus.confirm("Do you want to discard this draft?",function(t){t&&this.discard()}.bind(this)):this.discard())},send:function(){this.onClickSend()},onFocus:function(){this.__hotkeys||(this.__hotkeys=y.a.pushStack(this._getHotkeys())),d.a.clearSelection()},onBlur:function(){this.__hotkeys&&(y.a.popStack(this.__hotkeys),this.__hotkeys=void 0)},onClickAttach:function(){this.refs.picker.click()},onAttachUpdated:function(t){this._isMounted&&(this.onDraftChanged(),t&&this._clearDraftDebounce(!0,!0),this.updateState())},onDragEnter:function(t){t.preventDefault(),this._escapedFromDrag||(this._dragEnterCounter++,this.isDragOver.set(!0))},onDragLeave:function(){this._dragEnterCounter--,0===this._dragEnterCounter&&this.isDragOver.set(!1)},onMouseUp:function(){this._escapedFromDrag=!1,this.isDragOver.set(!1)},onKeyDown:function(t){t.keyCode===a.a.KeyCode.Escape&&this.isDragOver.get()&&(this._escapedFromDrag=!0,this.isDragOver.set(!1))},onFileDrop:function(t){if(!this._escapedFromDrag){this.isDragOver.set(!1);var e=t.dataTransfer;if(e.files&&e.files.length>0)this.props.threadAttach.getPlugin().notifyAttachFiles(this.props.threadAttach,this.props.message,e.files,this.onAttachUpdated.bind(this)),t.preventDefault(),t.stopPropagation(),n.default.DragDrop.stop(),n.default.DragDrop.finish()}},onItemDrop:function(t){if(t.item&&t.item.hasAttachmentType(a.a.PluginType.Storage)){var e=t.item.getAttachmentByType(a.a.PluginType.Storage);this.props.threadAttach.getPlugin().notifyAttachLinkedFile(this.props.threadAttach,this.props.message,e,this.onAttachUpdated.bind(this))}},close:function(t,e,i){try{r.default.PAssert(1711,r.default.isBoolean(t),"Must supply a valid value for sendDraft")}catch(n){r.default.reportError(n)}try{r.default.PAssert(1712,r.default.isBoolean(e),"Must supply a valid value for discardDraft")}catch(n){r.default.reportError(n)}try{r.default.PAssert(1713,r.default.isBoolean(i),"Must supply a valid value for forceFlush")}catch(n){r.default.reportError(n)}r.default.shouldLog(a.a.LogLevels.Compose)&&r.default.log("Compose Close: ",t,e,i),this._clearDraftDebounce(t,i),this.props.onClose(),!t&&e&&this._discardDraftUpdates()},_clearDraftDebounce:function(t,e){this._draftUpdateDebounce&&(clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0,this._saveDraftUpdates(t,e))},openSubject:function(){this.showSubject.set(!0),setTimeout(function(){this._setFocus(this.refs.subject),this.refs.subject.selectEnd()}.bind(this),0)},openCc:function(){this.showCc.set(!0),setTimeout(function(){this._setFocus(this.refs.cc)}.bind(this),0)},openBcc:function(){this.showBcc.set(!0),setTimeout(function(){this._setFocus(this.refs.bcc)}.bind(this),0)},focusTo:function(){this._setFocus(this.refs.to)},focusBody:function(){this._setFocus(this.refs.body)},_setFocus:function(t){t.isFocused.get()||t.focus()},_createTokensFromAddressText:function(t){var e=[];if(t)for(var i=0,r=0;r<t.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var a=t[r];a.text?e.push(a):a.email&&e.push({email:a.email,text:a.email})}return{tokens:e}},onClickSend:function(){var t=this.props,e=this.refs,i=function(e,i){e?this.close(!1,!1,!0):(r.default.isHTTPStatusCode(i,a.a.HTTPStatusCode.Network)?n.default.toasts.pushMessage({text:"You are offline. Your message will be sent when Moo.do is open and you are online.",action:a.a.MessageAction.Okay,hold:!0}):i&&n.default.toasts.pushMessage({text:"There was an error sending your message. Please try again in a minute.",action:a.a.MessageAction.Okay}),this.isSending.set(!1)),n.default.EmailPreview.ensureDisplayMessages(t.threadAttach)}.bind(this),o=function(e){e&&(this._clearDraftDebounce(!1,!1),v.default.clearSelection(),this.isSending.set(!0),t.threadAttach.getPlugin().sendDraft(t.threadAttach,t.message.id,t.message.draftID,void 0,i)||this.isSending.set(!1))}.bind(this);e.subject&&!e.subject.getValue()?n.default.menus.confirm("There is no email subject, send anyway?",o):e.body.getValue()?o(!0):n.default.menus.confirm("There is no email body, send anyway?",o)},onDraftChanged:function(){clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0,this._isMounted&&(this._draftUpdateDebounce=setTimeout(this._saveDraftUpdates.bind(this,!0,!1),1e3))},_saveDraftUpdates:function(t,e){if(r.default.shouldLog(a.a.LogLevels.Compose)&&r.default.log("Queue Save Draft: ",this.props.threadAttach.id,this.props.message.id,this.props.message.draftID,this._isMounted),this._isMounted){var i=this.refs,n=this.props,o=i.to.getTokens(),u=i.cc&&i.cc.getTokens(),s=i.bcc&&i.bcc.getTokens(),h=i.subject&&i.subject.getValue()||this.props.message.subject,d=i.body.getValue()||"(no text)",c=i.body.getTextValue()||"(no text)",v={to:o,cc:u,bcc:s,subject:h,body:d};n.threadAttach.getPlugin().updateDraft(n.threadAttach,n.message.id,n.message.draftID,v,c,t,e,function(t){try{r.default.PAssert(1714,t,"Should always be able to update a draft")}catch(e){r.default.reportError(e)}}),clearTimeout(this._draftUpdateDebounce),this._draftUpdateDebounce=void 0}},_discardDraftUpdates:function(){this.props.threadAttach.getPlugin().discardDraft(this.props.threadAttach,this.props.message.id,this.props.message.draftID,function(t){try{r.default.PAssert(1715,t,"Should always be able to delete a draft")}catch(e){r.default.reportError(e)}})},_getComposeBody:function(t){var e;return t&&t.decoded&&(e=c.a.getComposeBody(t.decoded,t.resources)),e},onChangeFrom:function(){var t=this.refs.from.value,e=this.props.threadAttach,i=e.getPlugin(),r=i.getSyncAccount(t),a=i.getSendingAccountInfo(t),o=!!this.props.message.inReplyTo;o?this._clearDraftDebounce(!1,!1):this.close(!1,!1,!1);var u=i.changeMessageAccount(e,this.props.message.id,this.props.message.draftID,r,t,a),s=u?u.threadID:e.id;o||n.default.menus.openComposeEmail(i,s),this.refs.body.setValue(this._getComposeBody(this.props.message))},getSendingAccounts:function(){var t,e=this.props.threadAttach.getPlugin();return this.props.message.inReplyTo&&(t=this.props.threadAttach.getField("accountID")),e.getSendingAccounts(t)},getFromAccount:function(){var t=this.state.fromAccounts;return t.length<2?t[0]:this.refs.from.value},insertLinkHotkey:function(){this.refs.body.hasFocus()&&this.insertLink()},insertLink:function(){var t=v.default.getSelectedText(),e=this.refs.buttonLink.getElement();this.savedSel=v.default.getSelectionRange(),n.default.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:e,onClosed:this.onInsertLinkClosed,onInsertLink:this.onInsertLink,text:t})},onInsertLinkClosed:function(){this.savedSel&&(this.refs.body.focus(),v.default.setSelectionRange(this.savedSel))},onInsertLink:function(t){var e=document.createElement("a");e.href=t.url,e.innerText=t.text,this.refs.body.insertNode(e)},render:function(){var t=this.state,e=this.props,i=this.to,a=this.cc,n="(no subject)"===e.message.subject?"":e.message.subject,u=this.state.showCc||this.cc&&this.cc.length>0,h=(o.a.isMobile?16:8)+(u?0:28)+(t.showBcc?0:34),d=e.message.from.email,c=t.fromAccounts.slice(0),v=t.fromAccounts.length>1,y={},f=r.default.classNames("emailCompose validDropTarget flexbox flexvert",e.className);c.remove(d),c.unshift(d);var k,A=r.default.classNames("composeHeader c-border-heavy",{showingFrom:t.fromAccounts.length>1});return o.a.isMobile&&(k={paddingBottom:o.a.getKBSize()}),e.hidden&&(y.height=0,y.paddingTop=0,y.overflow="hidden"),s.a.createElement("div",{className:f,style:y,ref:"container",onFocus:this.onFocus,onBlur:this.onBlur,onDrop:this.onFileDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave},s.a.createElement("div",{className:A},s.a.createElement("div",{className:"composeButtons"},!t.showSubject&&s.a.createElement(m.a,{height:24,padding:6,onClick:this.openSubject},"Subject"),!u&&s.a.createElement(m.a,{height:24,padding:6,onClick:this.openCc},"Cc"),!t.showBcc&&s.a.createElement(m.a,{height:24,padding:6,onClick:this.openBcc},"Bcc")),s.a.createElement(l.a,{className:"toBox",height:50,floatingText:"To",display:"block",ref:"to",tokens:i.tokens,focused:"to"===this.props.focus,autocompleteMode:"email",padding:{right:0},margin:{right:h},onChange:this.onDraftChanged,onEscape:e.onEscape}),u&&s.a.createElement(l.a,{height:50,floatingText:"Cc",display:"block",ref:"cc",tokens:a.tokens,autocompleteMode:"email",padding:e.paddingInput,onChange:this.onDraftChanged,onEscape:e.onEscape}),t.showBcc&&s.a.createElement(l.a,{height:50,floatingText:"Bcc",display:"block",ref:"bcc",autocompleteMode:"email",padding:e.paddingInput,onChange:this.onDraftChanged,onEscape:e.onEscape}),t.showSubject&&s.a.createElement(l.a,{height:50,floatingText:"Subject",display:"block",ref:"subject",value:n,padding:e.paddingInput,onChange:this.onDraftChanged,onEscape:e.onEscape}),v&&s.a.createElement("div",{className:"composeFrom"},s.a.createElement("span",null,"From"),s.a.createElement("select",{ref:"from",onChange:this.onChangeFrom},c.map(function(t){return s.a.createElement("option",{key:t,value:t},t)})))),s.a.createElement(p.a,{className:"emailComposeTextarea c-border-heavy f1",ref:"body",style:k,onChange:this.onDraftChanged,spellCheck:!0,onEscape:e.onEscape,editable:!t.isSending,richText:!0}),s.a.createElement(g.a,{onUpdate:this.onAttachUpdated,threadAttach:e.threadAttach,message:e.message,editable:!0}),!o.a.isMobile&&s.a.createElement("div",{className:"composeFooter"},s.a.createElement(m.a,{className:"discardDraft",icon:"icon-delete",iconSize:20,onClick:this.discard,tooltip:"Discard Draft"}),s.a.createElement(m.a,{className:"attachFile",icon:"icon-attach_file",iconSize:20,marginLeft:8,onClick:this.onClickAttach,tooltip:"Attach File"}),s.a.createElement(m.a,{className:"insertLink",icon:"icon-link",iconSize:20,marginLeft:8,onClick:this.insertLink,ref:"buttonLink",tooltip:"Insert Link"}),s.a.createElement(m.a,{className:"buttonSend",primary:!0,marginLeft:16,onClick:this.onClickSend},"SEND")),s.a.createElement("input",{type:"file",ref:"picker",className:"hidden",multiple:!0}),t.isDragOver&&s.a.createElement("div",{className:"dropNotice flexbox flex-center"},s.a.createElement("div",{className:"dropBg absFull"}),s.a.createElement("div",{className:"f1 center"},s.a.createElement("div",{className:"icon-attach_file"}),s.a.createElement("div",null,"Drop to attach"))),t.isSending&&s.a.createElement("div",{className:"clickBlocker flexbox flex-center c-bg-faded"},s.a.createElement("div",{className:"f1 center c-foreground"},"Sending...")))}});e.a=k},,,,function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=function(){function t(e,i){a()(this,t),this.target=e,this.cb=i,this._disposed=!1}return o()(t,[{key:"dispose",value:function(){this._disposed=!0,this.target.unlisten(this.cb)}},{key:"isDisposed",value:function(){return this._disposed}}]),t}();e.a=u},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(0),s=i(1),h=i(4),d=i(35),c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,v={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},y=function(){function t(){a()(this,t)}return o()(t,[{key:"makePropString",value:function(t,e,i){return e?',"'+t+'":'+(i?i(e):e):""}},{key:"safeJSONText",value:function(t){return c.lastIndex=0,c.test(t)?t.replace(c,function(t){var e=v[t];return u.default.isString(e)?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)}):t}},{key:"_addItemToArray",value:function(t,e,i,r){var a=e.getFullSaveData();if(!r&&a.note&&delete a.note,t.push(a),e.hasChildren())for(var n=0,o=e.getItems(),u=0;u<o.length;u++){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;var s=o[u];this._addItemToArray(t,s,i,r)}r&&e.hasNote()&&t.push(e.getNote().getFullSaveData())}},{key:"getBestEncryptionOut",value:function(){var t=h.default.settings.encryptionKeys.get();return t&&t[s.a.EncryptionKeys.UserPassword]?s.a.EncryptionKeys.UserPassword:s.a.EncryptionKeys.Global}},{key:"getItemsData",value:function(t,e){var i=e.exportArchived,r=e.includeNotes,a=e.encrypt,n=e.encryptionKey,o=[];if(this._addItemToArray(o,t,i,r),a){try{u.default.PAssert(251,n,"getItemsData missing encryptionKey")}catch(s){u.default.reportError(s)}return Promise.all(o.map(function(t){return d.a.encryptItemOut(t,h.default.crypto,n)}))}return Promise.resolve(o.map(function(t){return d.a.itemOut(t)}))}},{key:"toDropHtml",value:function(t){var e="";if(!t.isArchived()&&(e+="<li>"+u.default.escape(t.getParsedText())+"</li>",t.hasChildren())){var i=0;e+="<ul>";for(var r=0;r<t.numChildren();++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;e+=this.toDropHtml(t.getChild(r))}e+="</ul>"}return e}},{key:"toHtml",value:function(t,e,i,r){var a="<ul>",n=t.getItems();if(n)for(var o=0,s=0;s<n.length;s++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var h=n[s],d=u.default.escape((r?h.getPrefix():"")+h.generateTitleText());if(!h.isArchived()||h.isArchived()&&e){if(a+="<li>"+d,i){var c=h.hasNote()&&h.getNote();c&&(a+="<li>",a+=u.default.escape(c.getParsedText()),a+="</li>")}h.numItems()>0&&(a+=this.toHtml(h,e,i,r)),a+="</li>"}}return a+="</ul>"}},{key:"toPlainText",value:function(t,e,i,r,a){isNaN(e)&&(e=0);var n="",o=t.getItems();if(o)for(var s=0,h=0;h<o.length;h++){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var d=o[h];if(!d.isArchived()||d.isArchived()&&i){for(var c=0,v=0;v<e;v++){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;n+="\t"}if(n+=u.default.escape((a?d.getPrefix():"")+d.generateTitleText())+"\n",r){var y=d.hasNote()&&d.getNote();y&&(n+=y.getParsedText()+"\n")}d.numItems()>0&&(n+=this.toPlainText(d,e+1,i,r,a))}}return n}}]),t}();e.a=new y},function(t,e,i){"use strict";var r=i(0),a=i(1),n=i(101),o=i(34);function u(t,e,i,a,n,o,u){this.file=t,this.properties=a,this.contentType=t.type,this.accountID=e,this.folder=i,this.onComplete=o||r.default.emptyFn,this.onError=u||r.default.emptyFn,this.onProgress=n||r.default.emptyFn,this._callbacks=[],this.offset=0,this.chunkSize=1048576,this._isDone=!1,this._isRunning=!1,this._hasStarted=!1,this._isCanceled=!1,this._hasError=!1;this.url=this._buildURL(void 0,{uploadType:"resumable"}),this._percent=0}u.prototype={upload:function(){var t=this;this._hasStarted=!0,r.default.isDemoMode()?setTimeout(function(){t.onComplete()},2e3):o.a.getDefaultAuthToken([a.a.GScope.Drive],function(e){if(e){var i={Authorization:"Bearer "+e.access_token,"Content-Type":"application/json","X-Upload-Content-Length":t.file.size,"X-Upload-Content-Type":t.contentType};n.a.getFolder(t.folder,function(e){var n,o={title:t.file.name,mimeType:t.contentType,parents:e?[{id:e}]:[]};t.properties&&(o.properties=Object.keys(t.properties).map(function(e){return{key:e,value:t.properties[e],visibility:"PRIVATE"}}));try{n=JSON.stringify(o)}catch(u){r.default.reportError(u)}n?r.default.XHR({url:t.url,type:"POST",headers:i,data:n,autoRetry:!0,cb:function(e){if(e.status<a.a.HTTPStatusCode.BadRequest){var i=e.getResponseHeader("Location");t.url=i,t._runUpload()}else t._onError(e)}}):t._onError()})}})},_runUpload:function(){try{r.default.PAssert(625,this.url,"Must have a valid remote URL to run upload")}catch(n){r.default.reportError(n)}this._isRunning=!0;var t=Math.min(this.offset+this.chunkSize,this.file.size),e=this.file.slice(this.offset,t),i={"Content-Type":this.contentType,"Content-Range":"bytes "+this.offset+"-"+(t-1)+"/"+this.file.size,"X-Upload-Content-Type":this.contentType};r.default.XHR({url:this.url,type:"PUT",headers:i,data:e,autoRetry:!0,cb:function(t){if(t.status===a.a.HTTPStatusCode.Success||t.status===a.a.HTTPStatusCode.Created)this.isCanceled()||this._onComplete(t);else if(t.status===a.a.HTTPStatusCode.PermRedirect){var e=this._extractRange(t.getResponseHeader("Range"));this.offset=e,this._onProgress(this.offset/this.file.size),this.isCanceled()||this._runUpload()}else this._onError(t)}.bind(this)})},resume:function(){try{r.default.PAssert(626,!this.isDone(),"Should not resume a completed upload")}catch(e){r.default.reportError(e)}try{r.default.PAssert(627,this._hasStarted,"Must have started an upload to resume it")}catch(e){r.default.reportError(e)}try{r.default.PAssert(628,this.url,"Must have a valid remote URL to resume upload")}catch(e){r.default.reportError(e)}if(this._hasError=!1,this._isCanceled=!1,this._isRunning)0;else if(this._isRunning=!0,this._hasStarted&&this.url){var t={"Content-Range":"bytes */"+this.file.size,"X-Upload-Content-Type":this.contentType};r.default.XHR({url:this.url,type:"PUT",headers:t,autoRetry:!0,cb:function(t){if(t.status===a.a.HTTPStatusCode.PermRedirect){var e=this._extractRange(t.getResponseHeader("Range"));this.offset=e,this._onProgress(this.offset/this.file.size),this._runUpload()}else this._onError(t)}.bind(this)})}else this.upload()},cancel:function(){try{r.default.PAssert(629,!this._isDone,"Cannot cancel an upload that is already complete")}catch(t){r.default.reportError(t)}this._isCanceled=!0,this._isRunning=!1},_onError:function(t){this._hasError=!0,this._isRunning=!1,this.onError()},_onComplete:function(t){var e=0;try{r.default.PAssert(630,!this._isDone,"Should not call the complete CB twice")}catch(n){r.default.reportError(n)}try{r.default.PAssert(631,!this._isCanceled,"Should not be able to complete a canceled upload")}catch(n){r.default.reportError(n)}this._isDone=!0,this._isRunning=!1;var i={};if(t&&t.response)try{i=JSON.parse(t.response)}catch(o){r.default.reportError(o)}this._onProgress(1),this.onComplete(i);for(var a=0;a<this._callbacks.length;++a){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;try{this._callbacks[a](i)}catch(o){r.default.reportError(o)}}this._callbacks=[]},_onProgress:function(t){try{r.default.PAssert(632,!this._hasError,"Should not make forward progress when an error has occurred")}catch(e){r.default.reportError(e)}this._percent=t,this.onProgress(t)},_extractRange:function(t){return r.default.parseInt(t.match(/\d+/g).pop())+1},_buildQueryString:function(t){return t=t||{},Object.keys(t).map(function(e){return encodeURIComponent(e)+"="+encodeURIComponent(t[e])}).join("&")},_buildURL:function(t,e){var i="https://www.googleapis.com/upload/drive/v2/files/";t&&(i+=t);var r=this._buildQueryString(e);return r&&(i+="?"+r),i},notifyOnComplete:function(t){try{r.default.PAssert(633,this._callbacks.indexOf(t)<0,"Should not include fn twice")}catch(e){r.default.reportError(e)}try{r.default.PAssert(634,!this.isDone(),"Should not notify on complete after done")}catch(e){r.default.reportError(e)}try{r.default.PAssert(635,!this.hasError(),"Should not notify on complete after error")}catch(e){r.default.reportError(e)}this._callbacks.push(t)},isCanceled:function(){return this._isCanceled},isDone:function(){return this._isDone},isRunning:function(){return this._isRunning},hasError:function(){return this._hasError},getPercent:function(){return this._percent}},e.a=u},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(0),s=i(14),h=i(6),d=i(1),c=i(25),v=function(){function t(){a()(this,t)}return o()(t,[{key:"onRemoteChange",value:function(t,e,i,r){var a=s.a.getItem(i),n=d.a.ChangeType.Remote;try{u.default.PAssert(636,e!==d.a.CrudActions.Modified||a,"Item should not be modified if it does not exist")}catch(g){u.default.reportError(g)}if(!a&&e===d.a.CrudActions.Modified){e=d.a.CrudActions.Added;var o=c.a.getItemData(i);o&&delete(r=Object.assign({},o,r)).isDeleted}if(e===d.a.CrudActions.Added){var v=s.a.getItem(r.parent);if(v){if(h.e.beginAction(),a?(a.isDeleted()?(a.setDeleted(!1,n),a.onChangeRemote(e,r,n)):a.isArchived(),a.setParent(v)):a=s.a.createVMLI(r,{parent:v,changeType:n,documentOwner:t}),v){var y=v.indexInItemFromStringIndex(r.index);v.insertItem(a,y,!0)}h.e.endAction()}}else e===d.a.CrudActions.Removed?(a&&(a.isDeleted()||a.deleteSelf(n)),c.a.deleteItem(i)):a.onChangeRemote(e,r,n)}}]),t}();e.a=new v},function(t,e,i){"use strict";i.d(e,"a",function(){return n});i(89);var r=i(0),a=function(t,e){return"string"===typeof t&&(t=t.split(",")),t[t.length-1]=""+(+t[t.length-1]+e),t.join(",")},n=function(t,e){"number"===typeof t&&(t=""+t),"number"===typeof e&&(e=""+e);var i="0";if("string"===typeof t&&"string"===typeof e)i=function(t,e){var i=t.split(","),r=e.split(","),n=i.length,o=r.length;return n<o?+i[n-1]+1<+r[n-1]?a(i,1):a(r,-1):n>o?a(i,1):+i[n-1]+1<+r[o-1]?a(i,1):(i.push("0"),i.join(","))}(t,e);else if("string"===typeof t){var n=+t.split(",")[0];try{r.default.PAssert(582,!isNaN(n),"Index is not valid string",t)}catch(u){r.default.reportError(u)}i=""+Math.floor(n+1)}else if("string"===typeof e){var o=+e.split(",")[0];try{r.default.PAssert(583,!isNaN(o),"Index is not valid string",e)}catch(u){r.default.reportError(u)}i=""+Math.ceil(o-1)}return i}},,function(t,e,i){"use strict";var r=i(0),a=i(1),n=i(4),o=i(3),u=i(2),s=i.n(u),h=i(20),d=i(38),c=i.n(d),v=i(7),y=i.n(v),g=i(8),l=i.n(g),p=i(17),m=i.n(p),f=i(9),k=i.n(f),A=i(18),S=i.n(A),w=function(t){function e(){return y()(this,e),m()(this,k()(e).apply(this,arguments))}return S()(e,t),l()(e,[{key:"render",value:function(){var t=this.props,e={height:t.height},i=c()({},o.a.transform.react,"scale("+t.percent+", 1)"),r={lineHeight:t.height-2+"px"};return s.a.createElement("div",{className:"fancyProgressBar",style:e},!t.error&&s.a.createElement("div",{className:"fancyProgressInside",style:i}),t.error&&s.a.createElement("div",{className:"fancyProgressError",style:r},t.errorMsg))}}]),e}(h.a),L=i(13),F=h.b.createClass({displayName:"ReactMessageAttachments",componentDisplay:a.a.ComponentDisplay.Everywhere,init:function(){this.props.threadAttach.subscribe(this)},onUnmount:function(){this.props.threadAttach.unsubscribe(this)},onAttachmentUpdate:function(){this.updateState()},onAttachmentIDChange:function(){},getState:function(){return{attachments:this.props.threadAttach.getPlugin().getMessageDisplayAttachments(this.props.message)}},isAttachImage:function(t){var e=t.mimeType;return"image/png"===e||"image/jpg"===e||"image/jpeg"===e||"image/gif"===e},onClickAttach:function(t,e){if(t.error)t.uploader&&!t.uploader.isDone()&&t.uploader.resume();else if(!t.uploader||t.uploader.isDone()){var i=this._getURL(t);this.props.editable?r.default.openUrl(i):t.attID?o.a.mac&&e.metaKey||!o.a.mac&&e.ctrlKey||!this.isAttachImage(t)||o.a.isMobile?r.default.downloadFile(i,t.cid):n.default.menus.openLightbox(i,"Download",function(){r.default.downloadFile(i,t.cid)}):r.default.openUrl(i)}e.stopPropagation()},onClickDelete:function(t,e){var i=this.props.threadAttach.getPlugin().removeAttachFiles(this.props.threadAttach,this.props.message,t);this.props.onUpdate&&this.props.onUpdate(i),e.stopPropagation()},onAttachDragStart:function(t){var e=t.target.getAttribute("data-downloadurl");t.stopPropagation(),t.dataTransfer.setData("DownloadURL",e),n.default.DragDrop.setExternalData(e)},_getURL:function(t){return this.props.editable||!t.attID?n.default.EmailPreview.getPreviewURL(t):n.default.EmailPreview.getAttachmentURL(this.props.threadAttach.getField("accountID"),this.props.message.id,t.attID)},_renderAttachment:function(t){var e=t.mimeType+":"+t.cid+":"+this._getURL(t),i=t.uploader?r.default.clamp(t.uploader.getPercent(),.05,1):1,a=this.isAttachImage(t)?"Click to open image.\n"+o.a.priModKey+" click to download image.":"Click to download image";return s.a.createElement("div",{key:t.id,className:"messageAttachment flexbox c-button-raised",draggable:!0,"data-downloadurl":e,onClick:this.onClickAttach.bind(this,t),onDragStart:this.onAttachDragStart,"data-tooltip":a},s.a.createElement("div",{className:"attachmentIcon icon-drive-file"}),s.a.createElement("div",{className:"attachmentText"},t.cid),s.a.createElement("div",{className:"f1"}),i<1&&s.a.createElement(w,{percent:i,height:22,error:t.error,errorMsg:"Click to retry"}),1===i&&t.error&&s.a.createElement("div",null,"ERROR"),s.a.createElement("div",{className:"attachmentSize"},r.default.toFileSize(t.size)),this.props.editable&&s.a.createElement(L.a,{className:"attachmentClose",icon:"icon-close",onClick:this.onClickDelete.bind(this,t),tooltip:"Remove"}))},render:function(){var t=null,e=this.state.attachments;if(e.length>0){for(var i=0,r=[],a=0;a<e.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=e[a];r.push(this._renderAttachment(n))}t=s.a.createElement("div",{className:"messageAttachments c-border"},r)}return t}});e.a=F},,,,,,,,,,,,,,function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(17),s=i.n(u),h=i(9),d=i.n(h),c=i(18),v=i.n(c),y=i(0),g=i(1),l=i(4),p=i(3),m=i(68),f=i(14),k=i(10),A=i(73),S=function(t){function e(){var t;return a()(this,e),(t=s()(this,d()(e).call(this)))._oldSettings={c:!0,u:!0,aA:!0},t.init(),t}return v()(e,t),o()(e,[{key:"init",value:function(){var t=this;this._allSettings=[],this._allGroups=[],this._groupAbbrevs={},this._groupAbbrevsIn={},this.registerGroup(this,""),this.registerGroup("ui","u");var e=[["agendaSort","a",this.createDefaultAgendaSort()],["backupFrequency","d",0],["calendarCustomDays","e",3],["closedImport","f"],["closedHelps","g"],["closedVideo","h"],["dateFormat","i",g.a.DateFormat.MDY],["dayWeekStart","j",0],["defaultItemPrefix","k",""],["helpPaneState","l"],["helpState","m"],["inTooltipIntro","n"],["lastBackup","o"],["needsBackup","p"],["notificationDelay","q",30],["openEvernoteApp","r"],["panesMobile","s"],["selectFullItems","t",!1],["showFormattingToolbar","v",1],["showMarkdown","w"],["showImagesInline","x",!0],["shownTutorial","y"],["syncContacts","z"],["trialOverHidden","A"],["userEncryptionSentinel","aE"],["encryptBackup","aH"],["driveFolders","aI"],["fixedMissingCalendars","aJ"]],i=[["activeUser","b"],["cacheSizeRatio","B",1],["disableNotifications","C"],["displayName","D"],["lastContactSync","I"],["lastServerVersion","J"],["lastTaskSync","K"],["lastQuickAddSync","L"],["localDataVersion","M",7],["localIntegrity","N"],["localPaneState","O"],["localRecoverVersion","P"],["notifiedTrialOver","R"],["notifiedTrialEndSoon","S"],["selectedBoard","V"],["showSidebar","W",!1],["sidebarWidth","X",g.a.DesktopMenuWidthDefault],["userId","ab"],["encryptionKeys","aD"],["lastSync","aF"],["userProperties","aG"]],r=[["boldHeaders","ac",!1],["bulletOpacity","ad",30],["checkboxOpacity","ae",30],["checkboxBackgroundOpacity","af",0],["contactColor","ag","#22AA66"],["dateColor","ah","#AA3300"],["displayPrefixes","ai",g.a.DisplayTheme.PrefixesFaded],["displaySpacing","aj",g.a.DisplayTheme.SpacingComfortable],["fontSize","ak",14],["fontSizeHeader","al",16],["fontSizeHeaderTopLevel","am",18],["grayscale","an",!1],["itemIndentSize","ao",30],["itemLineHeight","ap",18],["itemPadding","aq",5],["linkColor","ar","#3333BB"],["noteFontSize","as",12],["noteLineHeight","at",18],["notePadding","au",0],["projectOpacity","av",30],["showVerticalLines","aw",!0],["tagColor","ax","#0099DD"],["theme","ay","light"],["underlineP","az",!1],["verticalLinesOpacity","aC",6]];this.registerSettings(e,this,!0),this.registerSettings(i,this,!1),this.registerSettings(r,this.ui,!0),y.default.isDemoMode()&&this.activeUser.set("demo"),this.encryptionKeys.listen(function(e){t._encryptionKeyInfo={};var i={};Object.keys(e).forEach(function(t){i[t]=e[t]}),l.default.crypto.importKeys(i).then(function(e){t._encryptionKeyInfo=e})})}},{key:"load",value:function(t,e){var i=this;this._isLoading=!0;var r=[];Object.keys(t).forEach(function(e){var a=i.getSettingInfoFromAbbrev(e),n=a.group,o=a.key,u=t[e].v;n&&n[o]&&("isEnabled"===o?r.push({group:n,key:o,value:u}):(void 0!==u&&null!==u||(u=n._settingsDefault[o]),n[o].set(u)))}),r.forEach(function(t){var e=t.group,i=t.key,r=t.value;e[i].set(r)}),e&&(this._allSettings.forEach(function(e){if(!t[e.path]){var i=e.group._settingsDefault[e.key];e.setting.get()!==i&&e.setting.set(i)}}),!this.userEncryptionSentinel.get()&&l.default.crypto.getKeyInfo(g.a.EncryptionKeys.UserPassword)&&this.removeEncryptionKey(g.a.EncryptionKeys.UserPassword)),l.default.DisplaySettings.init(),this._isLoading=!1}},{key:"registerGroup",value:function(t,e){var i,r=this,a=[];y.default.isString(t)&&(y.default.shouldLog(g.a.LogLevels.Settings)&&y.default.log("SETTINGS: Registered Group - ",t),i=t,this[t]={},t=this[t]),t.listen=function(t){a.push(t)},t.unlisten=function(t){a.remove(t)},t.onChange=function(t,e,n){var o=0;r._isLoading||r._save(t,i,e);for(var u=0;u<a.length;u++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;a[u](e,n)}},t._settingsDefault||(t._settingsRemote={},t._settingsDefault={},t._settingsAbbrevs={},t._settingsAbbrevsIn={}),this._allGroups.push({id:e,group:t}),i&&(this._groupAbbrevs[i]=e,this._groupAbbrevsIn[e]=i)}},{key:"registerSettings",value:function(t,e,i){for(var r=0,a=0;a<t.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=t[a],o=n[0],u=n[1],s=n[2];this.registerSetting(o,u,e,i,s)}}},{key:"registerSetting",value:function(t,e,i,r,a){if(y.default.isString(i)&&(i=this[i]),r&&(i._settingsRemote[t]=!0),void 0!==a&&(i._settingsDefault[t]=a),i._settingsAbbrevs[t]=e,i._settingsAbbrevsIn[e]=t,i[t]=new k.a(a,i.onChange.bind(this,t)),r){var n=this._allGroups.indexOfWithProperty("group",i);if(n>=0){var o=this._allGroups[n].id;this._allSettings.push({path:(o?o+"\\":"")+e,group:i,key:t,abbrev:e,setting:i[t]})}else 0}}},{key:"getDefaultItemText",value:function(t){return(t=t||this.defaultItemPrefix.get())?t+" ":""}},{key:"getSettingAbbrev",value:function(t,e){return(e?this[e]:this)._settingsAbbrevs[t]}},{key:"getSettingInfoFromAbbrev",value:function(t){var e,i,r=t.split("\\");if(r.length>1?(i=this[i=this._groupAbbrevsIn[r[0]]],e=r[1]):(i=this,e=r[0]),!this._oldSettings[e]){e=i._settingsAbbrevsIn[e];try{y.default.PAssert(258,i&&i[e],"Missing group for setting",t)}catch(a){y.default.reportError(a)}}return{group:i,key:e}}},{key:"getValueFromAbbrev",value:function(t){var e=this.getSettingInfoFromAbbrev(t),i=e.group,r=e.key;if(i&&i[r])return i[r].get()}},{key:"_save",value:function(t,e,i){var r=e?this[e]:this,a=r._settingsRemote[t],n=r._settingsDefault[t],o=r._settingsAbbrevs[t];i===n&&(i=null);var u=(e?this._groupAbbrevs[e]+"\\":"")+o;f.a.setSetting(u,i,a)}},{key:"getEncryptionKey",value:function(t){var e=this._encryptionKeyInfo;return e&&e[t]?e[t].key:void 0}},{key:"removeEncryptionKey",value:function(t){var e=Object.assign({},l.default.settings.encryptionKeys.get());l.default.crypto.removeKey(t),delete e[t],l.default.settings.encryptionKeys.set(e)}},{key:"addEncryptionKey",value:function(t,e){var i=Object.assign({},l.default.settings.encryptionKeys.get());i[t]=e,p.a.isMobile?l.default.crypto.exportKey(e).then(function(e){i[t]=A.a.ab2str(e),l.default.settings.encryptionKeys.set(i)}):l.default.settings.encryptionKeys.set(i)}},{key:"shouldShowHelp",value:function(t){var e=this.closedHelps.get();return!e||!e[t]}},{key:"closeHelp",value:function(t){var e=y.default.clone(this.closedHelps.get())||{};e[t]=!0,this.closedHelps.set(e)}},{key:"uncloseHelp",value:function(t){var e=y.default.clone(this.closedHelps.get())||{};delete e[t],this.closedHelps.set(e)}},{key:"isBackupEnabled",value:function(){return this.backupFrequency.get()>0}},{key:"hasUserPassword",value:function(){var t=l.default.settings.encryptionKeys.get();return t&&!!t[g.a.EncryptionKeys.UserPassword]}},{key:"getBestUserEncryption",value:function(){var t=l.default.settings.encryptionKeys.get();return t&&t[g.a.EncryptionKeys.UserPassword]?g.a.EncryptionKeys.UserPassword:g.a.EncryptionKeys.Global}},{key:"createDefaultAgendaSort",value:function(){return{overdue:-2,"#now":-1,starred:1,important:2,"#next":3,"#soon":101,"#later":301,"#someday":1401}}},{key:"getUserIdentifier",value:function(){return y.default.isDemoMode()?"demouser":this.activeUser.get()}}]),e}(m.a);e.a=S},function(t,e,i){"use strict";i.r(e);var r,a=i(105),n=i.n(a),o=i(7),u=i.n(o),s=i(8),h=i.n(s),d=i(15),c=i.n(d),v=i(0),y=i(1),g=i(4),l=i(3),p=i(59),m=i(6),f=i(102),k=i(5),A=i(57),S=i(16),w=y.a.Regexp.Prefix,L=(r=function(){function t(){u()(this,t)}return h()(t,[{key:"init",value:function(){try{v.default.PAssert(1598,"complete"===document.readyState||"interactive"===document.readyState,"Setting up copy/paste too early")}catch(t){v.default.reportError(t)}document.body.addEventListener("paste",this.handlepaste,!1),document.body.addEventListener("cut",this.handlecut,!1),document.body.addEventListener("copy",this.handlecopy,!1)}},{key:"parseTextForPrefix",value:function(t){var e,i;return w.lastIndex=0,null!==(e=w.exec(t))&&(i=e[1],t=t.substr(e[0].length)),{prefix:i,text:t}}},{key:"insertToNote",value:function(t,e,i){try{v.default.PAssert(1599,t,"Must have a valid start item")}catch(n){v.default.reportError(n)}try{v.default.PAssert(1600,e,"Must have a valid end item")}catch(n){v.default.reportError(n)}var r,a=t.getParsedText();m.e.beginAction(),r=e===t?a.substring(0,k.a.getStartOffset())+i+a.substring(k.a.getEndOffset()):a.substring(0,k.a.getStartOffset())+i,t.setText(r,y.a.ChangeType.Local),m.e.endAction()}},{key:"insert",value:function(t,e,i){if(!k.a.isValid()||v.default.elementInNonPaneEdit(e.target))return!1;var r,a,n,o="",u=v.default.focusedPane,s=l.a.ie?"Text":"text/plain";if(i===y.a.DataSource.Plugin)n={items:[{text:t}]};else if(t&&t.getData){if(m.e.miscAction({type:m.c.Misc,misc:m.a.Paste}),v.default.preventAndStop(e),o=l.a.ie?void 0:t.getData("moodo/html")||t.getData("text/html"),!l.a.ie&&o){if(v.default.shouldLog(y.a.LogLevels.Input)&&v.default.log(o),!o)return void(v.default.shouldLog(y.a.LogLevels.Input)&&v.default.log("Paste buffer is empty"));var h,d=document.createElement("div"),c=o.replace(/[\n\t]/g," ").replace(/[\r]|<head(.|\s)*?\/head>|<script(.|\s)*?\/script>|<style(.|\s)*?\/style>/g,"").replace(/[ ]+/g," ").replace(/\u2022/g,"").replace(/onload/gi,"never");if((h=/<body(.|\s)*?\/body>/g.exec(c))&&(c=h[0]),d.innerHTML=c,k.a.isValid()&&k.a.getStartItem().isNote())this.insertToNote(k.a.getStartItem(),k.a.getEndItem(),d.innerText);else{var S=d.children[0];2===d.children.length&&"A"===S.nodeName&&v.default.isOneNoteLink(S.href)&&(d.innerHTML=S.outerHTML),1===(n=f.a.traverseDOM({root:d,shouldPrint:!1,stripParents:!0,preserveWhitespace:!l.a.ie&&t.getData("moodo/html")})).items.length&&""===n.items[0].text&&(n=n.items[0])}}else if(o=t.getData(s)){v.default.shouldLog(y.a.LogLevels.Input)&&v.default.log(o);var w,L=o.startsWith("<?xml "),F=o.startsWith("<?opml ")||o.startsWith("<opml ")||L&&o.indexOf("<opml ")>=0;if((L||F)&&(w=v.default.loadXML(o)),w){if(L&&!F)return g.default.toasts.pushMessage({text:"We currently do not support pasting XML, please contact support@moo.do.",action:y.a.MessageAction.Contact,hold:!0}),!1;if(F){var C=k.a.getStartItem(),I=C.parent(),P=u.createVMLI({text:"OPML Import"},{parent:I,changeType:y.a.ChangeType.AllLocal});return I.insertItem(P,C.getIndex()+1),f.a.parseOPML(w,P),!1}}else{var N=v.default.parseEvernoteLink(o),H=v.default.isBearLink(o);if(N||H){var M=k.a.save(),z="Enter title of "+(N?"Evernote":H&&"Bear")+" document";return void g.default.menus.prompt(z,function(t){t&&(o="["+t+"]("+o+")"),k.a.restore(M),this.insert(o,e,y.a.DataSource.Plugin)}.bind(this))}v.default.isUrlImage(o)&&g.default.settings.showImagesInline.get()&&(o="!"+o);c=o.replace(/[\t]/g,"    ");if(k.a.getStartItem().isNote())this.insertToNote(k.a.getStartItem(),k.a.getEndItem(),c);else{var D=c.split("\n");n=f.a.parseText(D)}}}else{if(t&&t.items&&t.items.length>0)return g.default.pluginManager.handleDropEvent(e,function(t){m.e.beginAction();var e=k.a.getStartItem(),i=e.parent(),r=u.createVMLI({text:t},{parent:i,changeType:y.a.ChangeType.AllLocal});i.insertItem(r,e.getIndex()+1),m.e.endAction()}),!1;v.default.shouldLog(y.a.LogLevels.Input)&&v.default.log("Paste buffer is empty");try{v.default.PAssert(1601,!1,"Paste with unexpected data type",t.types)}catch(W){v.default.reportError(W)}}if(!n||!n.items||0===n.items.length)return!1}if(n){m.e.beginAction(),g.default.PaneUpdateBatcher.beginUpdateItems();var V=!0,G=k.a.getStartOffset(),T=k.a.getStartItem(),q=k.a.getEndItem(),j=k.a.getStartItem().parent(),Y=k.a.getStartItem().getIndex(),X=k.a.getStartItem().getParsedText(),Q=k.a.getEndItem().getParsedText();if(T!==q&&(q.isNote()&&(q=q.parent()),T!==q&&p.default.handleMultiselect({normCode:y.a.KeyCode.Backspace,preventDefault:v.default.emptyFn,stopPropagation:v.default.emptyFn,stopImmediatePropagation:v.default.emptyFn})),r=T,1!==n.items.length||n.items[0].items&&0!==n.items[0].items.length)if(u.isViewAgenda())g.default.toasts.pushMessage({text:"Pasting multiple items into the agenda is not supported. Please try pasting into an Outline pane.",actionText:"OKAY"}),V=!1;else{var J=0,Z=0;v.default.shouldLog(y.a.LogLevels.Timing)&&console.time("paste"),u.clearPreventUpdate(),k.a.getStartOffset()>0&&Y++;for(var B=0;n&&B<n.items.length;++B){if(J++>5e3&&__infLoop&&__infLoop(J))throw new RangeError;var $=n.items[B];this.parseTextForPrefix($.text);if(""!==$.text||$.items){var U=void 0;$.isNote?(U=u.createVMLI({text:$.text,isNote:!0},{parent:j,changeType:y.a.ChangeType.AllLocal}),j.setNote(U,y.a.ChangeType.Local)):(0===B&&0===T.getRawText().length&&0===T.numChildren()&&T.parent().removeChild(T,y.a.ChangeType.Auto),U=u.createVMLI($,{parent:j,changeType:y.a.ChangeType.AllLocal}),j.insertItem(U,Y++,!1),r=U),U&&m.e.performAction(m.c.Create,{itemID:U.id,parent:j.id,position:Y-1,text:U.getParsedText()})}}for(;r.hasChildren();){if(Z++>5e3&&__infLoop&&__infLoop(Z))throw new RangeError;r=r.getLastChild()}a=r.getParsedText().length}else{var R=n.items[0],E=R.text,K=G>0?this.parseTextForPrefix(E).text:E,x=X.substring(0,G),b=Q.substring(k.a.getEndOffset());!x.length||x.endsWith(" ")||K.startsWith(" ")||(K=" "+K),!b.length||K.endsWith(" ")||b.startsWith(" ")||(K+=" ");var O=x+K+b;if(m.e.performAction(m.c.Remove,{itemID:T.id,position:0,text:T.getParsedText()}),R.date)try{T.setMooDate(A.a.fromData(R.date),y.a.ChangeType.Local)}catch(_){v.default.reportError(_,"Error parsing MooDate in paste")}T.setText(O,y.a.ChangeType.Local),m.e.performAction(m.c.Insert,{itemID:T.id,position:0,text:O}),a=k.a.getStartOffset()+K.length}g.default.PaneUpdateBatcher.commitUpdateItems(),m.e.endAction(),v.default.shouldLog(y.a.LogLevels.Timing)&&console.timeEnd("paste")}return V&&r&&(k.a.selectItem(r,a),v.default.focusedPane.scrollItemIntoView(r,y.a.ScrollDuration.Snap)),!1}},{key:"handlepaste",value:function(t){var e=t&&t.clipboardData?t.clipboardData:t.synthetic?t.data:window.clipboardData;return this.insert(e,t,y.a.DataSource.Paste)}},{key:"handlecut",value:function(t){var e=!0;if(k.a.isValid()){var i=k.a.getStartIndex(),r=k.a.getStartItem(),a=i===k.a.getEndIndex()&&k.a.getStartOffset()===k.a.getEndOffset();g.default.PaneUpdateBatcher.beginUpdateItems(),a&&k.a.setSelection(i,0,i,r.getParsedText().length),!this.handlecopy(t)&&(a?v.default.focusedPane.deleteSelected():p.default.keydown(void 0,{normCode:y.a.KeyCode.Backspace,preventDefault:v.default.emptyFn,stopPropagation:v.default.emptyFn,stopImmediatePropagation:v.default.emptyFn}),e=!1),g.default.PaneUpdateBatcher.commitUpdateItems()}return e}},{key:"padText",value:function(t,e){for(var i=0,r=0;r<e;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;t="    "+t}return t}},{key:"printLI",value:function(t,e,i){var r,a,n=t.getParsedText(),o=t.getPrefix(),u=[],s=t.getPriority();if(e=e||0,n=isNaN(i)?n.substring(e):n.substr(e,i-e),e>=o.length&&(n=o+n),t.hasAttachments()){var h=0;if(!isNaN(e)&&e>0)for(var d=0,c=t.getParsedText(),v=0;v<e;++v){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;c[v]===y.a.AttachChar&&h++}r=t.generateSaveText(n,h),n=t.getPrefix()+t.generateTitleText()}else t.isNote()?(u.push("note"),r=n):r=n;if(s&&(s===y.a.VMLIFlag.P0?u.push("high"):s===y.a.VMLIFlag.P1?u.push("medium"):s===y.a.VMLIFlag.P2&&u.push("low")),t.isComplete()&&u.push("complete"),t.isStarred()&&u.push("starred"),n.indexOf(y.a.CharDate)){var g=t.getMooDate();g&&(a=g.toData())}var l=o.length?n.substr(o.length):n,p=function(t){return"<li"+(u.length>0?' class="'+u.join(" ")+'"':"")+(a?' data-date="'.concat(a,'"'):"")+">"+t+"</li>"};return{html:p(l),plain:l,moodo:p(r)}}},{key:"handlecopy",value:function(t){var e=v.default.focusedPane,i=l.a.ie?"Text":"text/plain",r=t&&t.clipboardData?t.clipboardData:window.clipboardData;if(r){var a=v.default.findParent(t.target,"exportedArea",10);if(!l.a.isMobile&&a)return!0;var o=0,u=0,s=0;if(!k.a.isValid())return!0;if(!k.a.getPane().overrideCopyBehavior)return!0;var h=k.a.getStartItem(),d=k.a.getStartIndex(),c=k.a.getEndItem(),y=k.a.getEndIndex();try{v.default.PAssert(1602,h&&c,"Must have valid item selections")}catch(Q){v.default.reportError(Q)}try{v.default.PAssert(1603,v.default.isVMLI(h)&&v.default.isVMLI(c),"Items must be valid VMLIs")}catch(Q){v.default.reportError(Q)}var g,p,f=!l.a.ie,A="<ul>",S="",w="<ul>",L=1,F=[],C=h,I=d,P=h;do{if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;if(P!==p&&(F.push({index:I,item:P}),I!==y&&P.isCollapsed(e))){var N=0;P.hasNote()&&(p=P.getNote(),F.push({item:p,index:I+1}));for(var H=P.getItems().slice(0);H.length>0;){if(N++>5e3&&__infLoop&&__infLoop(N))throw new RangeError;var M=H.shift(),z=M.getItems();F.push({item:M}),M.hasNote()&&F.push({item:M.getNote()}),H.splice.apply(H,[0,0].concat(n()(z)))}}(I=e.indexOfNextVMLI(I))>=0&&(P=e.itemAtIndex(I))}while(I>=0&&I<=y);for(var D=0;D<F.length;D++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var V=F[D],G=(V.index,V.item);if(G){var T,q,j=0;if(C){var Y=G.levelsDeep.get()-C.levelsDeep.get();G.parent()===C&&Y>0&&(A+="<ul>",w+="<ul>",L++)}for(var X=0;X<Math.min(L,-Y);X++){if(j++>5e3&&__infLoop&&__infLoop(j))throw new RangeError;A+="</ul>",w+="</ul>",L--}L<=0&&(A+="<ul>",w+="<ul>",L++),(F.length>1||k.a.getStartOffset()!==k.a.getEndOffset())&&(T=0===D?k.a.getStartOffset():0,q=D===F.length-1?k.a.getEndOffset():void 0),g=this.printLI(G,T,q),S+=(S?"\r\n":"")+this.padText(g.plain,L-1),A+=g.html,w+=g.moodo}C=G}for(A+="</ul>",w+="</ul>",L--;L>0;){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;A+="</ul>",w+="</ul>",L--}f&&A&&r.setData("text/html",A),f&&w&&r.setData("moodo/html",w),r.setData(i,S)}return l.a.ios||v.default.preventAndStop(t),m.e.miscAction({type:m.c.Misc,misc:m.a.Copy}),!1}}]),t}(),c()(r.prototype,"handlepaste",[S.a],Object.getOwnPropertyDescriptor(r.prototype,"handlepaste"),r.prototype),c()(r.prototype,"handlecut",[S.a],Object.getOwnPropertyDescriptor(r.prototype,"handlecut"),r.prototype),c()(r.prototype,"handlecopy",[S.a],Object.getOwnPropertyDescriptor(r.prototype,"handlecopy"),r.prototype),r);e.default=new L},function(t,e,i){"use strict";var r,a=i(7),n=i.n(a),o=i(8),u=i.n(o),s=i(15),h=i.n(s),d=i(0),c=i(1),v=i(4),y=i(14),g=i(3),l=i(10),p=i(16),m=(r=function(){function t(){n()(this,t),this.useServiceWorker="serviceWorker"in navigator,this.notifiedOfNew=!1,this.isFinished=!1,this.startStatus=window.applicationCache?window.applicationCache.status:-2,this.fnToRun=[],this.hasUpdate=new l.a,this.ignoreUpdate=new l.a,setInterval(this.update,c.a.MSPerHour)}return u()(t,[{key:"init",value:function(){var t=this;window.applicationCache&&this.startStatus===window.applicationCache.OBSOLETE&&this.onCacheObsolete(),this.useServiceWorker?navigator.serviceWorker.addEventListener("message",function(e){"ServiceWorker_Activated"===e.data?t.onUpdateReady():"ServiceWorker_Installed"===e.data&&setTimeout(t.onUpdateReady,2e3)}):d.default.log("Cache Status: "+this.startStatus),window.applicationCache?(window.applicationCache.addEventListener("noupdate",this.onCacheLoadFinished.bind(this)),window.applicationCache.addEventListener("cached",this.onFirstUpdateReady.bind(this)),window.applicationCache.addEventListener("downloading",this.onUpdateDownloading.bind(this)),window.applicationCache.addEventListener("updateready",this.onUpdateReady.bind(this)),window.applicationCache.addEventListener("obsolete",this.onCacheObsolete.bind(this)),window.applicationCache.addEventListener("error",this.onUpdateError.bind(this)),window.applicationCache.status>=window.applicationCache.UPDATEREADY||document.documentElement.attributes.getNamedItem("manifest")||this.onCacheLoadFinished()):this.onCacheLoadFinished()}},{key:"update",value:function(t){if(!this.hasUpdate.get())try{if(this.useServiceWorker){var e=window.__registeredServiceWorker;e&&e.update().then(function(){t&&t(!!e.installing)})}else window.applicationCache&&window.applicationCache.status===window.applicationCache.IDLE&&window.applicationCache.update()}catch(i){}}},{key:"runOnFinish",value:function(t){try{d.default.PAssert(229,0===this.fnToRun.length,"Only a single callback is allowed to be run at this point.")}catch(e){d.default.reportError(e)}this.isFinished?setTimeout(t,0):this.fnToRun.push(t)}},{key:"onUpdateReady",value:function(){d.default.log("Cache: New version available"),this.useServiceWorker?d.default.log("Service worker has update"):window.applicationCache&&this.startStatus===window.applicationCache.UNCACHED&&d.default.log("Cache Update from UNCACHED state. ERROR."),this.onCacheLoadFinished(),this.updateAction()}},{key:"onFirstUpdateReady",value:function(){d.default.log("Cache: first update")}},{key:"onUpdateError",value:function(t){!g.a.demo&&y.a.isOnline()&&(d.default.log("Update Error: ",t),"quota"===t.reason&&v.default.toasts.pushMessage({text:"A new version of Moo.do is available but you do not have enough free disk space to update. You may want to clear up some disk space.",actionText:"OKAY"})),this.onCacheLoadFinished()}},{key:"onUpdateDownloading",value:function(){d.default.log("Cache: New version downloading")}},{key:"onCacheObsolete",value:function(){this.onUpdateReady()}},{key:"onCacheLoadFinished",value:function(){if(!this.isFinished){var t=0;this.isFinished=!0;for(var e=0;e<this.fnToRun.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;this.fnToRun[e]()}}}},{key:"updateAction",value:function(){this.hasUpdate.set(!0)}}]),t}(),h()(r.prototype,"update",[p.a],Object.getOwnPropertyDescriptor(r.prototype,"update"),r.prototype),h()(r.prototype,"onUpdateReady",[p.a],Object.getOwnPropertyDescriptor(r.prototype,"onUpdateReady"),r.prototype),r);e.a=m},function(t,e,i){"use strict";i.r(e);var r=i(0),a=i(1),n=i(4),o=i(2),u=i.n(o),s=i(20),h=i(13),d=s.b.createClass({displayName:"ReactMobileFilterBar",componentDisplay:a.a.ComponentDisplay.Everywhere,onMount:function(){this.listenTo(this.props.pane.search.onChanged)},getState:function(){for(var t=0,e=this.props.pane.search,i={},r=0;r<e.filters.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=e.filters[r];i[a.name]=a.value}return i},openMobileFilterMenu:function(){n.default.menus.toggleContextMenu({componentName:"ReactContextMenuMobileFilter",position:"search-right",pane:this.props.pane})},renderSearchButton:function(t){var e=this.state[t.name],i=r.default.classNames("searchFilterButton selected",t.icon,{yes:e>0},{no:e<0});return u.a.createElement("div",{key:t.name,className:i})},renderSearchPriorityButton:function(t){var e=this.state[t.name],i=r.default.classNames("searchPriorityButton",{p0:e===a.a.VMLIFlag.P0},{p1:e===a.a.VMLIFlag.P1},{p2:e===a.a.VMLIFlag.P2}),n={height:a.a.PaneHeaderRow2ButtonHeight,lineHeight:a.a.PaneHeaderRow2ButtonHeight+"px"};return u.a.createElement("div",{key:t.name,className:i,style:n})},render:function(){for(var t=0,e=this.props.pane.search,i=[],r=0;r<e.filters.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e.filters[r];n.enabled.get()&&this.state[n.name]&&(n.icon?i.push(this.renderSearchButton(n)):"priority"===n.name&&i.push(this.renderSearchPriorityButton(n)))}var o=i.length>0;return u.a.createElement("div",{className:"mobileFilterBar flexbox"},u.a.createElement(h.a,{icon:o?null:"icon-filter_list",iconSize:17,fontSize:14,height:a.a.PaneHeaderRow2ButtonHeight,paddingLeft:0,paddingRight:0,onClick:this.openMobileFilterMenu,ripple:!o},i))}});e.default=d},,,function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(1),s=i(0),h=i(4),d=i(19),c=i(3),v=i(26),y=i(14),g=i(6),l=i(5),p=i(21),m=i(10),f=i(45);function k(){var t=this;this.hasSelection=!1,this.isTyping=!1,this.isRunning=!1,this.isDisabled=!1,this.isPaused=!1,this.stoppedFromPause=!1,this.activeScript=void 0,this.index=0,this.repeat=!1,this.onScriptDone=void 0,this.selectedItem=void 0,this.lastLoadedData=void 0,this.savedItems={},this.typingSpeed=30,this._scriptQueue=[],this.startText={},this.demoCaption=new m.a,s.default.isDemoMode()&&window.addEventListener("message",function(t){if(t.data&&s.default.isString(t.data)&&t.data.indexOf("{")<0)for(var e=0,i=t.data.split("&"),r=0;r<i.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var a=i[r].split("=");try{s.default.PAssert(534,a.length>=0,"Invalid number of params in message")}catch(n){s.default.reportError(n)}switch(a[0]){case"script":this.runScript(a[1]);break;case"start":this.start();break;case"stop":this.stop();break;case"pause":this.pause();break;case"resume":this.resume();break;case"restart":this.restart();break;case"alertDemo":h.default.menus.alert({text:'Click anywhere to try this <b class="blue">live demo</b>',callback:s.default.emptyFn});break;case"help":"1"===a[1]?s.default.vmMain.showHelp(u.a.HelpMode.Normal):h.default.intro.close();break;case"panes":this.loadPanes(a[1])}}}.bind(this),!1),window.pauseScript=function(){t.isDisabled||(s.default.log("pause script"),t.isDisabled=!0)}}var A=function(t,e,i,r,a,n){this.queue.apply(this,arguments)},S=function(t,e,i,r){if(A("createItemAfter",void 0,e),void 0!==i&&0!==i)for(var a=0,n=0;n<Math.abs(i);n++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;A("indent",i<0)}A(r?"setText":"typeString",void 0,t)},w=function(t){A("delay",t)};k.prototype={runScript:function(t){if(!this.isDisabled){0;var e=this.createScript(t);switch(this.activeScript=e,t){case"wait":this.demoEmpty(e);break;case"introEmail":this.demoEmail(e);break;case"introStyle":this.demoStyle(e);break;case"press":this.demoPress(e);break;case"none":return void this.notify("demoReady")}if(e.runQueue.length>0)this._scriptQueue.push(e);else try{s.default.PAssert(535,!1,"Invalid script request: ",t)}catch(i){s.default.reportError(i)}this.repeat=!1,this.activeScript=this._scriptQueue[0],!this.isRunning&&this.activeScript&&this.start()}},start:function(){h.default.toasts.clearMessage(u.a.MessageID.ThisIsDemo),this.onScriptStart(this.activeScript),this.run()},restart:function(){this.activeScript=this._scriptQueue[0],this.activeScript.index=0,this.start()},stop:function(){this._scriptQueue=[],this.isRunning=!1,this.activeScript=void 0,clearTimeout(this.timeoutDelay),this.timeoutDelay=void 0,clearTimeout(this.timeout),this.timeout=void 0,clearTimeout(this.timeoutMessage),this.timeoutMessage=void 0,f.a.hide(),h.default.DragDrop.stop(),h.default.DragDrop.finish()},pause:function(){this.isPaused=!0},resume:function(){this.isPaused=!1,this.wasResumed=!0,this.stoppedFromPause&&(this.stoppedFromPause=!1,this.run())},demoReady:function(t){this.wasResumed||this.pause(),this.notify("demoReady"),t()},switchDemo:function(t){this.stop(),s.default.isDemoRunning=!0;var e=this[t]();this.resetData(function(){this._scriptQueue.push(e),this.activeScript=e,this.start()}.bind(this))},loadPanes:function(t){h.default.PaneManager.loadDemoPanes(t.split(":"))},onScriptStart:function(t){t&&window.parent.postMessage(t.getName(),"*")},createScript:function(){var t={_nextId:0,owner:this,index:0,_repeat:!1,noDelay:!1,runQueue:[],_activeQueue:function(){return this.runQueue},queue:function(t){var e=Array.prototype.slice.call(arguments,1),i=this.runQueue;return i.push({id:this._nextId++,name:t,args:e}),i},repeat:function(t){this._repeat=t},nextStep:function(){return this.runQueue[this.index++]},getName:function(){return this._name}};return A=A.bind(t),S=S.bind(t),t},run:function(){if(!this.isDisabled&&this.activeScript)if(this.isPaused)this.stoppedFromPause=!0;else{try{s.default.PAssert(537,this.activeScript,"Must have a script active to be running")}catch(i){s.default.reportError(i)}var t=this.activeScript.nextStep();if(t){var e=t.args;e.push(this.run.bind(this)),this.isRunning=!0,clearTimeout(this.timeout),this.timeout=setTimeout(function(){try{this[t.name].apply(this,e)}catch(i){s.default.reportError(i),this.onDisable()}}.bind(this),0)}}},onDisable:function(){this.isDisabled=!0},setSelection:function(t,e,i,r,a){try{s.default.PAssert(538,t,"Must provide a valid item to select")}catch(o){s.default.reportError(o)}s.default.isNumber(t)&&(t=h.default.PaneManager.getPaneAtIndex(e).itemAtIndex(t));t=this.getItemIfString(t);var n=e>=0?h.default.PaneManager.getPaneAtIndex(e):s.default.focusedPane;s.default.focusedPane&&s.default.focusedPane.id===n.id||l.a.focusPane(n),void 0===i||null===i?i=0:i<0&&(i=t.getParsedText().length+i+1),l.a.selectItem(t,i,i+r),this.hasSelection=!0,this.selectedItem=t,a&&a()},clearSelection:function(t){l.a.reset(),this.hasSelection=!1,this.selectedItem=void 0,t&&t()},scrollTo:function(t,e,i){var r=h.default.PaneManager.getPaneAtIndex(t);try{s.default.PAssert(539,r,"Must have selected a valid pane")}catch(a){s.default.reportError(a)}r.setScrollOffset(e),i&&i()},scrollMain:function(t,e,i){s.default.vmMain.setScrollOffset(t,e),setTimeout(i,e)},setText:function(t,e,i){(t=t||this.selectedItem).setText(e,u.a.ChangeType.Local),i&&i()},appendText:function(t,e,i){t.setText(t.getParsedText()+e,!0),i&&i()},setPriority:function(t,e,i){(t=this.getItemIfString(t)||this.selectedItem).setPriority(e,u.a.ChangeType.Local),i&&i()},setStarred:function(t,e,i){(t=t||this.selectedItem).setStarred(e,u.a.ChangeType.Local),i&&i()},setComplete:function(t,e,i,r){(t=this.getItemIfString(t)||this.selectedItem).dateCompleted=i,t.isComplete(e,u.a.ChangeType.Local),r&&r()},removeItem:function(t,e){(t=this.getItemIfString(t)||this.selectedItem).deleteSelf(u.a.ChangeType.Local),e()},setStarredEmail:function(t,e,i){var r=h.default.PaneManager.getPaneAtIndex(t),a=r.itemAtIndex(e);r.toggleStar(a),i()},setPriorityEmail:function(t,e,i,r){var a=h.default.PaneManager.getPaneAtIndex(t).itemAtIndex(e),n=h.default.pluginManager.getPluginGmail();a&&n.setAttachmentPriority(a.getAttachmentByPlugin(u.a.PluginID.Gmail),i),r()},indent:function(t,e){var i={normCode:u.a.KeyCode.Tab,shiftKey:t};l.a.fireKeyEvent(void 0,i),e&&e()},collapse:function(t,e,i){var r=h.default.PaneManager.getPaneAtIndex(e);(t=this.getItemIfString(t)||this.selectedItem).setCollapsed(!0,r),i&&i()},backspace:function(t,e,i,r){var a=this;try{s.default.PAssert(544,r,"typeString should always have a callback")}catch(v){s.default.reportError(v)}t=this.getItemIfString(t)||this.selectedItem;try{s.default.PAssert(545,t,"Must be an item")}catch(v){s.default.reportError(v)}try{s.default.PAssert(546,this.hasSelection,"Must set selection before typing")}catch(v){s.default.reportError(v)}try{s.default.PAssert(547,!this.isTyping,"Must wait until previous typing is finished")}catch(v){s.default.reportError(v)}var n=0,o=function(){a.intervalTyping&&(clearInterval(a.intervalTyping),a.intervalTyping=void 0),a.isTyping=!1},h=this.activeScript,d=t.getParsedText();function c(){this.isTyping=!0,this.activeScript===h?(d=d.substr(0,i-1)+d.substr(i,d.length-i),i--,t.setText(d,u.a.ChangeType.Local),++n>=e&&(o(),r&&r())):o()}c.apply(this),e>1&&(clearInterval(this.intervalTyping),this.intervalTyping=setInterval(c.bind(this),this.typingSpeed))},typeString:function(t,e,i){try{s.default.PAssert(548,i,"typeString should always have a callback")}catch(h){s.default.reportError(h)}t=this.getItemIfString(t)||this.selectedItem;try{s.default.PAssert(549,t,"Must be an item")}catch(h){s.default.reportError(h)}try{s.default.PAssert(550,this.hasSelection,"Must set selection before typing")}catch(h){s.default.reportError(h)}try{s.default.PAssert(551,!this.isTyping,"Must wait until previous typing is finished")}catch(h){s.default.reportError(h)}try{s.default.PAssert(552,void 0!==e,"Must supply a string to be typed")}catch(h){s.default.reportError(h)}var r=0,a=function(){this.intervalTyping&&(clearInterval(this.intervalTyping),this.intervalTyping=void 0),this.isTyping=!1}.bind(this),n=this.activeScript;function o(){if(this.isTyping=!0,this.activeScript===n){var o=e.charCodeAt(r);if(o===u.a.KeyCode.Delete&&(o=u.a.KeyCode.Period),o===u.a.KeyCode.End){var s=l.a.getStartOffset(),h=t.getParsedText(),d=h.substr(0,s)+e.charAt(r)+h.substr(s);t.setText(d,u.a.ChangeType.Local),l.a.selectItem(t,s+1)}else l.a.fireKeyEvent(void 0,{normCode:o});++r>=e.length&&(a(),i&&i())}else a()}e&&(o.apply(this),e.length>1&&(clearInterval(this.intervalTyping),this.intervalTyping=setInterval(o.bind(this),this.typingSpeed)))},typeIntoEmail:function(t,e,i){var r=s.default.reactEmailCompose.refs.body,a=0,n=function(){this.intervalTyping&&(clearInterval(this.intervalTyping),this.intervalTyping=void 0),this.isTyping=!1}.bind(this),o=this.activeScript;clearInterval(this.intervalTyping),this.intervalTyping=setInterval(function(){if(this.activeScript===o){var e=t[a];r.insertCharAtIndex(e,a),++a>=t.length&&(n(),i&&i())}else n()}.bind(this),e)},setSearch:function(t,e,i){h.default.PaneManager.getPaneAtIndex(e).search.setValue(t),i&&i()},createItemAfter:function(t,e,i){var r=this;t=t||this.selectedItem,this.setSelection(t,void 0,t.getParsedText().length,0),l.a.fireKeyEvent(void 0,{normCode:u.a.KeyCode.Enter}),requestAnimationFrame(function(){r.clearSelection(function(){var a;a=t.isHeader()?t.getChild(0):t.parent().getChild(t.getIndex()+1);try{s.default.PAssert(557,a,"Error getting new item: ",e)}catch(n){s.default.reportError(n)}e&&(r.savedItems[e]=a),r.selectedItem=a,r.setSelection(a,void 0,-1,0,i)})})},zoomPane:function(t,e,i){var r=h.default.PaneManager.getPaneAtIndex(t);e=this.getItemIfString(e),r.setItem(e,!0),i&&i()},zoomGmailPane:function(t,e,i){var r=h.default.PaneManager.getPaneAtIndex(t),a=h.default.pluginManager.getPluginGmail(),n=a._getLabelByName("me",e);try{s.default.PAssert(562,n,"Must be able to get a valid label if clicking a valid label")}catch(u){s.default.reportError(u)}var o=a.getVMLIForLabel("me",n);r.setItem(o,!0),r.selectIndex(-1),i&&i()},delay:function(t,e){var i=this;e&&(0===t?e&&e():(this.delayCb=e,clearTimeout(this.timeoutDelay),this.timeoutDelay=setTimeout(function(){i.delayCb=i.timeoutDelay=void 0,e()},t)))},addPane:function(t,e,i,r,a,n){var o={};if(i)o.item=this.getItemIfString(i);else{var u=y.a.getDefaultDocument();o.item=u.getRootItem()}r&&(o.search=r);h.default.PaneManager.createPaneAtIndex(t,e,o,a);n()},removePane:function(t,e,i){h.default.PaneManager.removePaneAtIndex(t,e),i&&i()},cullPanes:function(t,e){var i=h.default.PaneManager.paneCount();i>t?(this.removePane(i-1),setTimeout(this.cullPanes.bind(this,t,e),60)):e()},selectItemInPane:function(t,e,i){var r=h.default.PaneManager.getPaneAtIndex(t).itemAtIndex(e);this.selectedItem=r,i()},dragTo:function(t,e,i,r,a,n){var o=h.default.PaneManager.getPaneAtIndex(t),d=h.default.PaneManager.getPaneAtIndex(e),c=o.itemAtIndex(i),v=o.elementAtIndex(i),y=-1===r;y&&(r=d.numItems()-1);var g,p,m=d.elementAtIndex(r),f=d.itemAtIndex(r),k=d.objectAtIndex(r),A=v.getBoundingClientRect(),S=m.getBoundingClientRect(),w=o.dragMarginTop||0,L=A.top+(w||10),F=S.left-A.left,C=S.top-L+(y?h.default.DisplaySettings.lineItemHeight(k,f,1):0);l.a.focusPane(o);var I=null;var P=this,N=this.activeScript;h.default.DragDrop.startDragItem=c,c.dragStart({startSrc:v,eventX:A.left+10,eventY:L}),requestAnimationFrame(function t(e){if(P.activeScript===N){I||(I=e);var i,r=(i=(e-I)/a)<.5?4*i*i*i:(i-1)*(2*i-2)*(2*i-2)+1;if(g=F*r+A.left+10,p=C*r+L,r>=1){var o,h=document.getElementById("preventInteraction");h&&(o=h.parentElement).removeChild(h)}c.dragMove({eventX:g,eventY:p,diffY:C>A.top?1:-1,preventDefault:s.default.emptyFn,stopPropagation:s.default.emptyFn}),h&&o.appendChild(h),r>=1?(c.dragEnd({clientX:g,clientY:p,target:v}),n&&n()):requestAnimationFrame(t)}else l.a.fireMouseUp(v,u.a.ButtonCode.Left)})},getItemIfString:function(t){var e;if(s.default.isString(t)){e=y.a.getItem(t)||this.savedItems[t];try{s.default.PAssert(569,e,"Item was not saved correctly")}catch(i){s.default.reportError(i)}}else if(t){try{s.default.PAssert(570,s.default.isVMLI(t),"Must supply a valid VMLI: ",s.default.getObjectInfo(t))}catch(i){s.default.reportError(i)}e=t}return e},pushMessage:function(t,e){if(this._currentToast)return h.default.toasts.clearMessage(this._currentToast),this._currentToast=void 0,void setTimeout(this.pushMessage.bind(this),100,t,e);var i;if(i=s.default.isString(t)?h.default.toasts.pushMessage({text:t,hold:!0}):h.default.toasts.pushMessage(t),this._currentToast=i,t===u.a.MessageID.ThisIsDemo){p.a.listen("tapMain",function t(){h.default.toasts.clearMessage(i),p.a.unlisten("tapMain",t)})}e&&e()},notify:function(t,e){window.parent.postMessage(t,"*"),e&&e()},demoDone:function(t){l.a.reset(),this.notify("done"),s.default.isDemoRunning=!1;var e=document.getElementById("preventInteraction");e&&e.parentElement.removeChild(e),t()},addClass:function(t,e){s.default.addClass(document.documentElement||document.body,t),e&&e()},removeClass:function(t,e){s.default.removeClass(document.documentElement||document.body,t),e&&e()},switchClass:function(t,e,i){this.removeClass(t),this.addClass(e),i()},selectEmail:function(t,e,i){var r=h.default.PaneManager.getPaneAtIndex(t);try{s.default.PAssert(571,r,"Must have selected a valid pane")}catch(a){s.default.reportError(a)}l.a.focusPane(r),r.selectIndex(e),i&&i()},openEmail:function(t,e,i){var r=h.default.PaneManager.getPaneAtIndex(t);try{s.default.PAssert(572,r,"Must have selected a valid pane")}catch(n){s.default.reportError(n)}r.selectIndex(e);var a=r.itemAtIndex(e);r.openEmailByItem(a),i&&i()},closeEmail:function(t){h.default.EmailPreview.close(),t&&t()},sendEmail:function(t){s.default.reactEmailCompose.onClickSend(),t()},toggleMessageExpanded:function(t,e){s.default.reactEmailPreview.toggleExpanded(t),e()},replyToMessage:function(t){h.default.EmailPreview.setLastMessageResponseMode(u.a.EmailResponseMode.Reply),t()},archiveEmail:function(t,e,i){var r=h.default.PaneManager.getPaneAtIndex(t),a=r.itemAtIndex(e);r.archiveItem(!0,a),i()},addEmail:function(t,e){h.default.pluginManager.getPluginGmail().refreshThreadCacheData("me",t,void 0,function(){},e)},waitPaneItems:function(t,e){var i=h.default.PaneManager.getPaneAtIndex(t);try{s.default.PAssert(573,i,"Must have selected a valid pane")}catch(r){s.default.reportError(r)}if(i.items.length()>0)e();else{i.items.listen(function t(r){r.length>0&&(i.items.unlisten(t),e())})}},displaySetting:function(t,e){h.default.DisplaySettings.changeTheme(t,t),e()},caption:function(t,e,i){this.demoCaption.set({text:t,opacity:1,center:e,light:t.indexOf("<b>")>=0}),i()},captionFade:function(t){var e=this.demoCaption.get();this.demoCaption.set({text:e.text,opacity:0,center:e.center,light:e.light}),t()},waitAction:function(t,e){this._waitTracker={check:t,cb:e}},onTrackerAction:function(t){var e=this._waitTracker;e&&e.check(t)&&e.cb()},demoEmail:function(t){return s.default.isDemoRunning=!0,A("waitPaneItems",0),A("zoomGmailPane",1,"Needs Reply"),A("zoomGmailPane",2,"Starred"),A("removeClass","invisible"),A("demoReady"),w(1e3),A("dragTo",0,1,0,-1,1e3),w(200),A("dragTo",0,1,0,-1,1e3),w(800),A("setStarredEmail",0,1),w(500),A("setStarredEmail",0,3),w(800),A("setPriorityEmail",2,0,u.a.VMLIFlag.P0),w(500),A("setPriorityEmail",2,2,u.a.VMLIFlag.P2),w(1200),A("selectEmail",0,0),w(200),A("openEmail",0,0),A("pushMessage",u.a.MessageID.ThisIsDemo),A("demoDone"),t},demoStyle:function(t){var e=0,i=0;s.default.isDemoRunning=!0,this.collapse("ideas",0),this.collapse("todo",0),this.collapse("testing",0),A("removeClass","invisible"),A("demoReady"),w(500),A("dragTo",0,1,1,1,1e3),w(1e3),A("setSelection","tracking",0,-1,0),A("typeString",void 0," #Android"),w(800),A("typeString",void 0," @tomorrow "),w(800),A("setSelection","tracking",0,0,0),A("typeString",void 0,"+Grant "),w(1500),A("zoomPane",1,"release"),w(1500);for(var r="#Android",a=r.length;a>=0;a--){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;A("setSearch",r.substr(0,a),2),w(40)}w(800),r="+Grant";for(a=0;a<=r.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;A("setSearch",r.substr(0,a),2),w(40)}A("pushMessage",u.a.MessageID.ThisIsDemo),A("demoDone")},demoPress:function(t){g.e.addListener(this.onTrackerAction.bind(this)),A("pushMessage",{text:"Try dragging an email onto the Outline.",hold:!0,big:!0}),A("waitAction",function(t){return t.type===g.e.TrackerType.Misc&&t.misc===g.a.DropItem&&t.data.fromPane&&t.data.fromPane.type===u.a.PaneMode.Gmail}),A("pushMessage",{text:"Schedule an item by typing @ then a date.<br><br>Or drag it right onto the Agenda.",hold:!0,big:!0}),A("waitAction",function(t){return t.type===g.c.Misc&&t.misc===g.a.ChangeDate||t.type===g.c.Insert&&"@"===t.data[0].text}),A("pushMessage",{text:"Learn more on our homepage.",hold:!0,action:u.a.MessageAction.OpenURL,actionText:"https://moo.do",data:{url:"https://www.moo.do"}})},demoEmpty:function(t){s.default.isDemoRunning=!0,A("demoReady"),A("pushMessage",u.a.MessageID.ThisIsDemo),A("demoDone")}};var L,F=k;!function(t){t.Normal="Sign in with Google",t.Connecting="Connecting...",t.LoggingIn="Logging In...",t.Loading="Loading...",t.Offline="Offline"}(L||(L={}));var C=function(){function t(){var e;a()(this,t),e=navigator.onLine?L.Normal:L.Offline,this.loginStatus=new m.a(e),this.popupClosedError=new m.a,this.gapiFailedToLoad=new m.a,this.loggedOutByAuthFailure=new m.a,this.downloadIcon=this.getDownloadIcon(),this.downloadText="Download "+this.getDownloadText()+" app",this.showDownload=c.a.mobile&&!c.a.app||c.a.canDownloadNativeApp(),this.showLogin=!c.a.mobile||c.a.app||c.a.isDevURL,this.loginRequested=!1,this.loginRequestTimer=void 0}return o()(t,[{key:"getDownloadIcon",value:function(){return c.a.getPlatformIcon()}},{key:"getDownloadText",value:function(){return c.a.getPlatformName()}},{key:"userLogin",value:function(){var t=this;v.a.onAuthed(function(){s.default.authUserLoggedIn=!0,t.loginRequested=!1,t.loginStatus.set(L.Normal),h.default.settings.localIntegrity.set(!0),t.popupClosedError.set(void 0),h.default.PaneManager.setupInitialTimeout()}),this.loginStatus.set(L.LoggingIn),v.a.signIn()}},{key:"shouldShowLogin",value:function(){return this.loginStatus.get()===L.Normal||this.loginStatus.get()===L.LoggingIn}},{key:"logout",value:function(){h.default.settings.activeUser.get()&&(s.default.log("Logging out"),y.a.clearLocalData().then(function(){v.a.signOut(function(){s.default.log("Logged out",c.a.app),setTimeout(function(){d.a.hasURLParam("login")?d.a.removeURLParam("login"):d.a.hasURLParam("user")&&d.a.removeURLParam("user"),c.a.app?(h.default.nativeBridge.sendToApp("logout"),c.a.isFeatureEnabled(u.a.Feature.OAuth)&&s.default.reload()):s.default.reload()},0)})}))}},{key:"logoutClicked",value:function(){var t=this;s.default.isDemoMode()?d.a.removeURLParam("demo"):y.a.hasPendingRemoteUpdates()?h.default.menus.confirm("You have unsaved changes which will be lost if you log out. Are you sure?",function(e){e&&t.logout()}):this.logout()}},{key:"initDemo",value:function(){s.default.AScript||(s.default.AScript=new F)}},{key:"runScript",value:function(t){s.default.AScript.runScript(t)}},{key:"_reportLoginTapSkip",value:function(t){}},{key:"closeConnectionError",value:function(){h.default.tooltip.hideSticky(this.textErrorConnecting)}}]),t}();e.a=C},,,,,,,,function(t,e,i){"use strict";i.r(e);var r=i(0),a=i(21),n=i(27),o=function(){},u=function(){return{}},s=function(){return{then:o,execute:o}};function h(){this.cache={},this.loadedGapiData={},this._isRemoteHooked=!1,this.resetListener=void 0}h.prototype={setGapiData:function(t,e){try{r.default.PAssert(1609,r.default.isObject(e)&&!r.default.isArray(e),"Setting malformed data",t)}catch(a){r.default.reportError(a)}for(var i in this.loadedGapiData[t]=[],e)e[i].id=i,this.loadedGapiData[t].push(e[i])},setGapiDataDirect:function(t,e){try{r.default.PAssert(1610,r.default.isArray(e),"Setting malformed data",t)}catch(i){r.default.reportError(i)}this.loadedGapiData[t]||(this.loadedGapiData[t]=e)},clearGapiData:function(){this.loadedGapiData={}},loadRemoteData:function(t,e){var i=this;try{r.default.PAssert(1611,t&&e,"Must supply valid remote load info as well as a cb when data is loaded")}catch(u){r.default.reportError(u)}var a=t.split(":");if(this.cache[a[0]])e(JSON.parse(JSON.stringify(this.cache[a[0]][a[1]])));else{var n=!a[0].endsWith(".txt"),o=n?a[0]+".json":a[0];r.default.XHR({type:"GET",url:window.location.protocol+"//"+window.location.host+"/data/"+o,cb:function(t){if(200===t.status)if(n){var o=JSON.parse(t.responseText);i.cache[a[0]]=o,a[1]||(a[1]="0");var u=o[a[1]];if(u){var s=JSON.parse(JSON.stringify(u));e(s)}else r.default.log("Invalid data slot")}else{var h=t.responseText.split("\n");h="tags"===a[1]?h.map(function(t){if(t.length>0){for(var e=0,i=t.split(" "),r=0;r<i.length;r++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;Math.random()<.8&&(i[r]="#"+i[r])}t=i.join(" ")}return{text:t}}):h.map(function(t){return{text:t}}),e([{text:"Outline",items:h}])}else r.default.log("Error getting demo data",t.status,t.responseText)}})}},stubGapi:function(){try{r.default.PAssert(1612,!window.gapi,"Should not have loaded gapi when stubbing")}catch(i){r.default.reportError(i)}var t=[];a.a.listen("resetEverything",function(){for(var e=0,i=0;i<t.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;clearTimeout(t[i])}t=[]});var e=function(e,i){var r=setTimeout(function(){t.remove(r),e({success:!0})},0);t.push(r)};window.gapi={auth:{getToken:function(){return{expires_in:3600,expires_at:Math.floor((Date.now()+r.default.minutes(60))/1e3),access_token:"InvalidToken",id_token:"InvalidIDToken",scope:[C.GScope.UserInfoEmail,C.GScope.Calendar,C.GScope.GmailCompose,C.GScope.GmailModify]}}},client:{request:function(t){return{then:function(e,i,r){return n.a.getAPIForRequest(t)(t.__rawParams).then(e,i,r)},execute:function(){}}},load:o,setApiKey:o,newBatch:function(){return{add:o,then:e}},drive:{files:{get:s,list:s,trash:s,insert:s,patch:s},permissions:{list:s,insert:s,delete:s},properties:{insert:s},parents:{insert:s},changes:{list:s}},gmail:{users:{threads:{list:s,get:s,modify:s,trash:s,untrash:s},labels:{list:s,create:s},history:{list:s},messages:{get:s,send:s,trash:s,untrash:s},drafts:{create:s,update:s,send:s,delete:s,list:s},settings:{sendAs:{list:s}}}},calendar:{settings:{list:s},events:{get:s,list:s,patch:s,insert:s,delete:s},calendars:{insert:s},calendarList:{list:s}}}}},areRemoteFunctionsHooked:function(){return this._isRemoteHooked},hookRemoteFunctions:function(){try{r.default.PAssert(1613,!this._isRemoteHooked,"Should not hook remote functions more than once")}catch(v){r.default.reportError(v)}function t(t,e){var i=0;try{r.default.PAssert(1614,t,"Must load local or remote data to perform queries")}catch(v){r.default.reportError(v)}for(var a=0;a<t.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(t[a].id===e)return t[a]}}function e(t,e,i){try{r.default.PAssert(1616,t,"Must load local or remote data to perform queries")}catch(v){r.default.reportError(v)}var a=[];if(r.default.isArray(i))   ;else if(t)for(var n=0,o=0;o<t.length;++o){if(n++>5e3&&__infLoop&&__infLoop(n))throw new RangeError;t[o][e]===i&&a.push(t[o])}return a}function i(t,e,i){var a=0;try{r.default.PAssert(1617,t,"Must load local or remote data to perform queries")}catch(v){r.default.reportError(v)}for(var n=[],o=0;o<t.length;++o){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;t[o][e].indexOf(i)>=0&&n.push(t[o])}return n}this.stubGapi(),this._isRemoteHooked=!0;var n=0,o=[],s=this;function h(t){return function(e,i,a){var u;try{u=t(a)}catch(h){r.default.reportError(h)}var s=setTimeout(function(){o.remove(s),u?e.call(a,{result:u}):i.call(a,{error:!0})},n);o.push(s)}}function d(t){return function(e,i,r){var a=t(r),u=setTimeout(function(){o.remove(u),a?e(a):i({error:!0})},n);o.push(u)}}function c(t){return{then:h(t),execute:d(t)}}a.a.listen("resetEverything",function(){for(var t=0,e=0;e<o.length;++e){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;clearTimeout(o[e])}o=[]}),gapi.client.drive.files.get=function(e){return c(function(i){return t(s.loadedGapiData.Drive,e.fileId)})},gapi.client.drive.files.list=function(t){return c(function(e){if("mimeType='application/vnd.google-apps.drive-sdk.597847337936' and trashed=false"===t.q)return{items:s.loadedGapiData.documents};var a=/\'(.*)\' in parents/g.exec(t.q),n=/title contains \'([^\']*)\'/g.exec(t.q),o=/mimeType contains \'([^\']*)\'/g.exec(t.q),u=s.loadedGapiData.Drive;return a&&(u=function(t,e){var i=0;try{r.default.PAssert(1615,t,"Must load local or remote data to perform queries")}catch(v){r.default.reportError(v)}for(var a=[],n=0;n<t.length;++n){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;(t[n].parents[0].id===e||"root"===e&&t[n].parents[0].isRoot)&&a.push(t[n])}return a}(u,a[1])),n&&(u=i(u,"title",n[1])),o&&(u=i(u,"mimeType",o[1])),{items:u}})},gapi.client.drive.files.trash=function(t){return c(u)},gapi.client.drive.files.insert=function(t){return c(u)},gapi.client.drive.files.patch=function(t){return c(u)},gapi.client.drive.permissions.list=function(t){return c(function(t){return{items:s.loadedGapiData.permissions}})},gapi.client.drive.permissions.insert=function(t){return c(u)},gapi.client.drive.permissions.delete=function(t){return c(u)},gapi.client.drive.properties.insert=function(t){return c(u)},gapi.client.gmail.users.threads.list=function(t){return c(function(i){return{threads:e(s.loadedGapiData.Gmail,"hideInPane",void 0).filter(function(e){return"me"===t.userId||e.accountID===t.userId})}})},gapi.client.gmail.users.threads.modify=function(e){return c(function(i){var r=t(s.loadedGapiData.Gmail,e.id)[0];if(!r)return{};if(r.labelIds||(r.labelIds=[]),e.removeLabelIds)for(var a=0,n=0;n<e.removeLabelIds.length;++n){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;r.labelIds.remove(e.removeLabelIds[n])}e.addLabelIds&&r.labelids.pushOnlyUniques(e.addLabelIds)})},gapi.client.gmail.users.threads.get=function(e){return c(function(i){return t(s.loadedGapiData.Gmail,e.id)})},gapi.client.gmail.users.messages.get=function(t){return c(function(e){return function(t,e){var i=0;try{r.default.PAssert(1618,t,"Must load local or remote data to perform queries")}catch(v){r.default.reportError(v)}for(var a=0;a<t.length;++a){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var n=e(t[a]);if(n)return n}}(s.loadedGapiData.Gmail,function(e){for(var i=0,r=0;r<e.messages.length;++r){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(e.messages[r].id===t.id)return e.messages[r]}})})},gapi.client.gmail.users.messages.send=function(t){return c(function(e){return{id:r.default.generateTempId(),threadId:t.resource.threadId||r.default.generateTempId().substr(3),labelIds:["SENT","UNREAD"]}})},gapi.client.gmail.users.labels.list=function(t){return c(function(t){return{labels:s.loadedGapiData.Gmail_Labels}})},gapi.client.gmail.users.labels.create=function(t){return c(function(i){var a=e(s.loadedGapiData.Gmail_Labels,"name",t.resource.name)[0];if(a)return a;var n=r.default.generateTempId().substr(3);return a={name:t.resource.name,id:n},s.loadedGapiData.Gmail_Labels||(s.loadedGapiData.Gmail_Labels=[]),s.loadedGapiData.Gmail_Labels.push(a),a})},gapi.client.gmail.users.settings.sendAs.list=function(t){return c(function(t){return{sendAs:[{displayName:"Demo User",isDefault:!0,isPrimary:!0,replyToAddress:"",sendAsEmail:"demo@moo.do",signature:""}]}})},gapi.client.calendar.calendarList.list=function(t){return c(function(t){return{items:s.loadedGapiData.calendarList}})},gapi.client.calendar.events.get=function(e){return c(function(i){return t(s.loadedGapiData.GCalendar,e.eventId)})}}},e.default=new h},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){"use strict";i.r(e);var r=i(26),a=i(0),n=i(19),o=i(1),u=i(4),s=(i(137),i(14)),h=i(3),d=i(7),c=i.n(d),v=i(8),y=i.n(v),g=i(15),l=i.n(g),p=i(21),m=i(25),f=i(138),k=i(6),A=i(74),S=i(5),w=i(10);function L(){this.isVisible=new w.a(!1),this.mode=new w.a,this.aboutToShow=void 0,this.bottomPosition=new w.a(0),this.scrollVal=0,this.topBarHidden=!1,this.init()}L.prototype={init:function(){p.a.listen("closeKeyboard",this.hide.bind(this))},preShow:function(){a.default.shouldLog(o.a.LogLevels.Toolbar)&&a.default.log("Pre-Show Keyboard Menu"),this.aboutToShow=!0,setTimeout(function(){this.aboutToShow=!1}.bind(this),100)},show:function(t){this.aboutToShow=!1,a.default.shouldLog(o.a.LogLevels.Toolbar)&&a.default.log("Show Keyboard Menu"),this.updatePosition(),this.mode.set(t),a.default.isKeyboardOpen=!0,(!h.a.ie||h.a.ie&&(h.a.mobro||h.a.winphone))&&this.isVisible.set(!0),setTimeout(function(){k.e.miscAction({type:k.c.Mobile,misc:k.b.OpenKeyboard})},0)},hide:function(){!this.aboutToShow&&a.default.isKeyboardOpen?(a.default.shouldLog(o.a.LogLevels.Toolbar)&&a.default.log("Hide Keyboard Menu"),a.default.isKeyboardOpen=!1,a.default.focusedPane.removePadding(),a.default.onCloseKeyboard(),this.hideTopBarIfLandscape(),this.isVisible.set(!1),k.e.miscAction({type:k.c.Mobile,misc:k.b.CloseKeyboard})):a.default.shouldLog(o.a.LogLevels.Toolbar)&&a.default.log("Hide Keyboard Menu [SKIPPED]")},shouldHideTopBar:function(){return h.a.orientation===o.a.Orientation.Landscape&&(a.default.isKeyboardOpen||this.aboutToShow)&&!a.default.getActiveSearch().UI.isFocused},hideTopBarIfLandscape:function(){this.shouldHideTopBar()?(a.default.setTransform(a.default.element("outerWrapper"),0,-a.default.topBarHeight),this.topBarHidden=!0):this.topBarHidden&&(this.topBarHidden=!1,a.default.setTransform(a.default.element("outerWrapper"),0,0))},updatePosition:function(){var t=h.a.getKBSize()-(this.shouldHideTopBar()?a.default.topBarHeight:0);t!==this.bottomPosition.get()&&this.bottomPosition.set(t),a.default.isKeyboardOpen&&a.default.focusedPane.addPadding()},getScroll:function(){return this.scrollVal},setScroll:function(t){this.scrollVal=t}};var F=new L,C=i(22),I=i(33),P=i(34);function N(){var t=this;this._items=new I.a,this._remoteItems=void 0,this._localLoaded=!1,this._cache=u.default.cacheManager.registerLocalCache("QuickAdd","QuickAdd",o.a.StorageType.IndexedDB),this._itemStore=u.default.itemStoreManager.registerItemStore("QuickAdd",this,{isReadonly:!0}),this._itemStore.createRoot("QuickAddRoot","Quick Add"),this._cache.onCacheReady(function(){t._cache.loadAll(function(e,i){e&&t._notifyLocalItems(i)})})}N.prototype={notifyRemoteItems:function(t){u.default.settings.lastQuickAddSync.set(new Date),this._localLoaded?(this._remoteItems=void 0,this._cache.onCacheReady(function(){var e=0;u.default.PaneUpdateBatcher.beginUpdateItems();for(var i=0;i<t.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t[i];if(r.dateConsumed)!!this.removeTextEntry(r.quickAddID)&&this._cache.removeEntry(r.quickAddID);else this.addTextEntry(r.quickAddID,r.text,r.note)&&this._cache.cacheEntry(r.quickAddID,{id:r.quickAddID,isPersisted:!0,text:r.text,note:r.note})}u.default.PaneUpdateBatcher.commitUpdateItems()}.bind(this))):this._remoteItems=t},_notifyLocalItems:function(t){var e=0;u.default.PaneUpdateBatcher.beginUpdateItems();for(var i=0;t&&i<t.length;++i){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var r=t[i];this.addTextEntry(r.id,r.text,r.note),r.isPersisted||this.persistTextEntry(r.id,!0)}this._localLoaded=!0,this._remoteItems&&this.notifyRemoteItems(this._remoteItems),u.default.PaneUpdateBatcher.commitUpdateItems()},runQuickAddSync:function(t){a.default.XHR_PrivateAPI({type:"POST",path:"/quick/list",data:{lastQuickAddSync:this.getLastSyncDate()},requireAuth:!0,cb:function(e){if(e.status===o.a.HTTPStatusCode.Success)try{var i=JSON.parse(e.response).data;if(i.quickAddItems){try{a.default.PAssert(1604,a.default.isArray(i.quickAddItems),"Must be an array of items")}catch(r){a.default.reportError(r)}this.notifyRemoteItems(i.quickAddItems)}}catch(n){a.default.reportError(n)}t&&t()}.bind(this)})},getLastSyncDate:function(){var t=u.default.settings.lastQuickAddSync.get();try{a.default.PAssert(1605,!t||a.default.isString(t),"Must have a valid string sync date")}catch(e){a.default.reportError(e)}return t},addItemEntry:function(t,e){this.hasItemEntry(t)||this._items.push({id:t.id,item:t,pane:e})},addTextEntry:function(t,e,i){var r=!1;if(!this.hasTextEntry(t)){var a=this._itemStore.getRoot(),n=this._itemStore.createItem(t,e,a.id,o.a.ChangeType.Local);a.insertItem(n,0),this._items.push({id:t,isText:!0,item:n,text:e,note:i}),r=!0}return r},removeItemEntry:function(t){var e=this._items.indexOfWithProperty("id",t.id);if(e>=0)return this._items.splice(e,1)[0]},removeTextEntry:function(t){var e=this._items.indexOfWithProperty("id",t);if(e>=0)return this._items.splice(e,1)[0]},hasItemEntry:function(t){var e=this.getItemEntry(t);return!(!e||e.isText)},hasTextEntry:function(t){var e=this.getTextEntry(t);return!(!e||!e.isText)},getItemEntry:function(t){var e=this._items.indexOfWithProperty("id",t.id);return this._items.get()[e]},getTextEntry:function(t){var e=this._items.indexOfWithProperty("id",t);return this._items.get()[e]},getItems:function(){return this._items},_notifyPersisted:function(t){var e=this.getTextEntry(t);e&&this._cache.onCacheReady(function(){this._cache.cacheEntry(t,{id:t,text:e.text,note:e.note,isPersisted:!0})}.bind(this))},_notifyConsumed:function(t){this._cache.onCacheReady(function(){this._cache.removeEntry(t)}.bind(this))},persistTextEntry:function(t,e){var i=this;P.a.onLoaded(function(){i._persistTextEntry(t,e)})},_persistTextEntry:function(t,e){try{a.default.PAssert(1606,this.hasTextEntry(t),"Must be persisting a valid text entry")}catch(n){a.default.reportError(n)}var i=this.getTextEntry(t);if(i){e||this._cache.onCacheReady(function(){this._cache.cacheEntry(t,{id:t,text:i.text,note:i.note,isPersisted:!1})}.bind(this));var r={quickAddID:t,text:i.text};i.note&&(r.note=i.note),a.default.XHR_PrivateAPI({type:"POST",path:"/quick/add",data:r,requireAuth:!0,cb:function(e){if(e.status===o.a.HTTPStatusCode.Success)this._notifyPersisted(t);else if(e.status===o.a.HTTPStatusCode.BadRequest)try{JSON.parse(e.responseText).code===o.a.PrivateAPIErrorCodes.AlreadyExists&&this._notifyPersisted(t)}catch(i){a.default.reportError(i)}}.bind(this)})}},consumeTextEntry:function(t){try{a.default.PAssert(1607,this.hasTextEntry(t),"Must be persisting a valid text entry")}catch(i){a.default.reportError(i)}this.removeTextEntry(t),this._cache.onCacheReady(function(){this._cache.removeEntry(t)}.bind(this));var e={quickAddID:t};a.default.XHR_PrivateAPI({type:"POST",path:"/quick/consume",data:e,requireAuth:!0,cb:function(e){e.status===o.a.HTTPStatusCode.Success&&this._notifyConsumed(t)}.bind(this)})},hasItems:function(){return this._items.get().length>0}};var H,M=N,z=i(61),D=i(54),V=i(16),G=(H=function(){function t(){c()(this,t),this.isLoaded=!1,this.isRendered=new w.a(!1),this.isInit=!1,this.isPhone=h.a.phone,this.help=void 0,this.lastActivity=Date.now(),this.paneFactory=A.a,this._itemAnimationMode=o.a.ItemAnimationMode.Normal,this.isDisplaySettingsOpen=new w.a(!1),this.failedInitialDocLoad=new w.a(!1),this.activeInput=new w.a(null),this.cursor=new w.a,this.loadedImages={},this.activityThreshold=a.default.seconds(5),this.lastDateRollover=0,a.default.vmMain=this,Rollbar.configure({payload:{environment:h.a.getDeployVar(o.a.DeployVariable.Environment),person:{id:u.default.settings.getUserIdentifier()},client:{javascript:{source_map_enabled:!0,code_version:o.a.__jsVersion,guess_uncaught_frames:!0}}},maxItems:o.a.__MAX_ERRORS_REPORTED,checkIgnore:a.default.rollbarIgnoreFn}),a.default.element("outerWrapper").addEventListener("mousemove",this.mousemove),a.default.isDemoMode()||(this.setupPageVisibility(),this.checkLowActivity()),u.default.PaneManager.onResize(),this.checkLastCodeVersion(),this.init()}return y()(t,[{key:"remoteAPI",value:function(){return u.default.pluginManager.getPlugin(o.a.PluginID.Moodo)}},{key:"loadPlugins",value:function(){}},{key:"getDefaultEmailPlugin",value:function(){return u.default.pluginManager.getPlugin(o.a.PluginID.Gmail)}},{key:"onlineText",value:function(){var t=s.a.onlineStatus.get();return(a.default.isDemoMode()?"DEMO":t===o.a.OnlineStatus.Connecting&&"Syncing")||t===o.a.OnlineStatus.Offline&&"OFFLINE"||t===o.a.OnlineStatus.Online&&!h.a.isMobile&&"Online"||""}},{key:"init",value:function(){try{a.default.PAssert(1108,!this.isInit,"Should never double init VMMain, may cause severe issues")}catch(t){a.default.reportError(t)}this.isInit=!0,f.default.init(),z.a.init(),this.loadPlugins(),this.dropBucket=new M,h.a.isMobile||u.default.intro.init(),p.a.fireEvent("VMMainLoaded",[]),h.a.demo||(window.onbeforeunload=this.onUnload)}},{key:"parseAll",value:function(t){var e=this;s.a.runOnAllDocumentRoots(function(i){e.parseSubtree(i,t)})}},{key:"parseSubtree",value:function(t,e){var i=0;try{a.default.PAssert(1109,t,"Must supply a valid item to parse")}catch(o){a.default.reportError(o)}this.runSingleParse(t,e);for(var r=t.getItems(),n=0;n<r.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this.parseSubtree(r[n],e)}}},{key:"runFnOnSubtree",value:function(t,e){var i=0;e(t);for(var r=t.getItems(),a=0;a<r.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this.runFnOnSubtree(r[a],e)}}},{key:"runSingleParse",value:function(t,e){try{a.default.PAssert(1110,t,"Must have a valid item to parse")}catch(r){a.default.reportError(r)}var i={};t.parseText("",e,i)&&s.a.saveItemLocal(t,i,o.a.SaveFlag.None)}},{key:"runDateRollover",value:function(){try{a.default.PAssert(1111,a.default.isLoaded,"Expect that we have fully loaded the page before performing rollover")}catch(r){a.default.reportError(r)}var t=+this.scheduledDateRollover-Date.now();a.default.log("---- Running Date Rollover: "+t+" ----"),this.lastDateRollover=Date.now(),this.scheduledDateRollover=0,clearTimeout(this.dateRolloverTimeout),this.dateRolloverTimeout=void 0,this.setupDateRollover();var e=function(){u.default.Measure.clearItemCache(),u.default.Measure.clearLineCache(),u.default.PaneUpdateBatcher.updateAllItems(!1,!0),u.default.timeline.updateNotifications(),a.default.log("-------------------------------")};if(Date.Parsing.Normalizer.buildReplaceData(),u.default.timeline.clearDailyCaches(),u.default.settings.syncContacts.get()){var i=setTimeout(function(){e()},1e4);clearTimeout(i),i=void 0,e()}else e();p.a.fireEvent("dateChanged",[])}},{key:"setupDateRollover",value:function(){try{a.default.PAssert(1112,!this.dateRolloverTimeout,"Should never reschedule a date rollover over another one")}catch(i){a.default.reportError(i)}var t=new Date,e=+t.clone().addDays(1).clearTime();try{a.default.PAssert(1113,e>+t,"Rollover time must be in the future")}catch(i){a.default.reportError(i)}try{a.default.PAssert(1114,e>this.lastDateRollover,"Rollover time must be after the last rollover")}catch(i){a.default.reportError(i)}this.dateRolloverTimeout=setTimeout(this.runDateRollover,e-+t),this.scheduledDateRollover=e}},{key:"ensureDateRollover",value:function(){var t=this;setTimeout(function(){var e=Date.now();t.scheduledDateRollover-e<0&&t.runDateRollover()},1e4)}},{key:"loadData",value:function(){if(a.default.shouldLog(o.a.LogLevels.Timing))var t=performance.now();a.default.shouldLog(o.a.LogLevels.Profile)&&console.profile("Load Local Data"),a.default.checkpoint(o.a.Checkpoint.LocalDocLoad),a.default.shouldLog(o.a.LogLevels.Profile)&&console.profileEnd(),a.default.isLoaded=!0,u.default.setup.initDemo(),a.default.isDemoMode()&&setTimeout(function(){h.a.script&&u.default.setup.runScript(n.a.getURLParam("script")),window.parent.postMessage("loaded","*")},0),this.afterLoaded(),a.default.shouldLog(o.a.LogLevels.Profile)&&console.profile("Apply Bindings"),this.isRendered.set(!0),a.default.isDemoMode()&&h.a.script&&a.default.setupClick(document.getElementById("container"),this,{onStart:function(){p.a.fireEvent("tapMain",[])},onClick:function(){try{a.default.PAssert(1115,a.default.isDemoMode()&&h.a.script,"Tap handler should only be active on demo page")}catch(t){a.default.reportError(t)}window.parent.postMessage("click","*")}}),a.default.shouldLog(o.a.LogLevels.Profile)&&console.profileEnd(),h.a.app&&u.default.nativeBridge.sendToApp("localLoaded"),a.default.shouldLog(o.a.LogLevels.Timing)&&(a.default.log("DONE LOCALLY",performance.now()),setTimeout(function(){var e=performance.now();a.default.log("time react:",e-t,e)},0))}},{key:"afterLoaded",value:function(){h.a.isMobile&&(a.default.keyboardToolbar=F),h.a.app&&(document.onreadystatechange=function(){h.a.isMobile&&u.default.nativeBridge.sendToApp("kbsize"),u.default.nativeBridge.sendToApp("loaded")},document.onreadystatechange()),u.default.timeline.updateNotifications()}},{key:"switchPaneMobile",value:function(t,e,i){C.default.clearSelection(),u.default.DragDrop.stop(),u.default.DragDrop.finish(),u.default.PaneUpdateBatcher.beginUpdateItems();var r=u.default.PaneManager.swapToPane(t,e,i);a.default.keyboardToolbar.hide(),S.a.setFocusedPane(r),u.default.PaneUpdateBatcher.commitUpdateItems()}},{key:"applyFormatToSelection",value:function(t){var e,i,r=!1;a.default.setItemAnimationMode(o.a.ItemAnimationMode.None),a.default.focusedPane.applyToSelection(function(a,n,u){var s=0===n?S.a.getStartOffset():0,h=n===u-1?S.a.getEndOffset():a.getParsedText().length,d=a.applyFormatToSelection(t,s,h,0===n?o.a.SetMode.Toggle:r?o.a.SetMode.Yes:o.a.SetMode.No);0===n&&(r=d.didSet,e=d.selStart),n===u-1&&(i=d.selEnd)}),S.a.selectIndices(S.a.getStartIndex(),e,S.a.getEndIndex(),i),a.default.resetItemAnimationMode()}},{key:"applyPrefixToSelection",value:function(t,e){var i,r;if(S.a.isValid()&&(i=S.a.getStartItem().getPrefixLength(),r=S.a.getEndItem().getPrefixLength()),e)t=e.prefix===t?null:t,e.setPrefix(t);else{var n=!0;a.default.focusedPane.applyToSelection(function(e){if(e.prefix!==t)return n=!1,!1}),n&&(t=null),a.default.focusedPane.applyFnToSelection("setPrefix",{value:t,noRestoreSel:!0})}if(!isNaN(i)){var o=S.a.getStartItem().getPrefixLength()-i,u=S.a.getEndItem().getPrefixLength()-r;o||u?S.a.selectIndices(S.a.getStartIndex(),S.a.getStartOffset()+o,S.a.getEndIndex(),S.a.getEndOffset()+u):S.a.updateCaret()}}},{key:"updateCursorFromEvent",value:function(t){if(this.prevMove){var e=this.prevMove.target;if(e&&a.default.isAttachedToDoc(e)){var i=a.default.getPaneForElement(e);if(i){var r=a.default.elementFromPoint(this.prevMove.clientX,this.prevMove.clientY);if(r){var n=a.default.getItemForElement(r);this.updateCursor(t,i,r,n)}}}}}},{key:"getCursorForClass",value:function(t,e,i){for(var r=0,a=t.classList,n=0;n<a.length;n++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;switch(a[n]){case"link":case"date":case"plugin":return h.a.mac&&e.metaKey||!h.a.mac&&e.ctrlKey?"cursor-pointer":null}}if(i)return"cursor-pointer"}},{key:"updateCursor",value:function(t,e,i,r){var n;if(e&&i){if(r&&a.default.isVMLI(r)){var u=a.default.findParentInItem(i,"plugin");u&&(i=u)}var s=!!a.default.findParent(i,"paneOverviewScroller");if(!S.a.isMouseDown()&&!(n=this.getCursorForClass(i,t,s))){var h=a.default.findParent(i,"itemInCalendarResizable");if(h){var d=h.getBoundingClientRect(),c=Math.min(o.a.CalendarResizeHandleHeight,d.height/3);(t.clientY-d.top<c||d.bottom-t.clientY<c)&&(n="cursor-row-resize")}}}this.cursor.set(n)}},{key:"redoLastMouseMove",value:function(){var t=this.prevMove,e={target:document.elementFromPoint(t.clientX,t.clientY),clientX:t.clientX,clientY:t.clientY};this.mousemove(e,!0)}},{key:"mousemove",value:function(t,e){if(this.notifyActivity(),!(a.default.disableMouseMove&&!t.target||u.default.PaneManager.isResizingPane||!e&&this.prevMove&&t.clientX===this.prevMove.clientX&&t.clientY===this.prevMove.clientY||u.default.DragDrop.isDragging)){var i,r,n,o=a.default.ensureDOMNode(t.target);if(o)(a.default.findParent(o,"paneRoot")||a.default.findParent(o,"paneOverviewScroller"))&&(n=a.default.getPaneForElement(o))&&(i=a.default.getItemForElement(o))&&(r=a.default.getListCellForElement(o)),this.updateCursor(t,n,o,i),S.a.setHovered(n,i,r),this.prevMove&&this.prevMove.target===o||(this.prevMove&&this.prevMove.target&&p.a.fireEvent("mouseout",[{target:this.prevMove.target}]),o&&p.a.fireEvent("mouseover",[{clientX:t.clientX,clientY:t.clientY,target:o}])),this.prevMove={clientX:t.clientX,clientY:t.clientY,target:o};else try{a.default.PAssert(1116,!o,"Target should be defined",a.default.getElementPath(t.target))}catch(s){a.default.reportError(s)}}}},{key:"showHelp",value:function(t){u.default.intro.show(t)}},{key:"runAfterWelcome",value:function(){u.default.intro.runTooltipIntro()}},{key:"setupPageVisibility",value:function(){var t=this;h.a.pageVisibilityChange&&document.addEventListener(h.a.pageVisibilityChange,function(){h.a.isPageVisible()?(t.updateTimeout&&(clearTimeout(t.updateTimeout),t.updateTimeout=void 0),t.whenLowImpactEnd()):t.updateTimeout=setTimeout(function(){t.whenLowImpactBegin()},5e3)})}},{key:"notifyActivity",value:function(){this.lastActivity=Date.now(),this.lowActivityTimer||(this.lowActivityTimer=setTimeout(this.checkLowActivity,2*this.activityThreshold)),this.whenLowImpactEnd()}},{key:"checkLowActivity",value:function(){Date.now()-this.lastActivity>this.activityThreshold&&this.whenLowImpactBegin(),this.lowActivityTimer=void 0}},{key:"whenLowImpactBegin",value:function(){this._isLowImpact||(this._isLowImpact=!0,p.a.fireEvent("lowImpactBegin",[]))}},{key:"whenLowImpactEnd",value:function(){this._isLowImpact&&(p.a.fireEvent("lowImpactEnd",[]),this._isLowImpact=!1)}},{key:"isLowImpact",value:function(){return this._isLowImpact}},{key:"checkLastCodeVersion",value:function(){if(a.default.shouldWriteLocal()){var t="version"+(h.a.isMobile?"Mobile":"Desktop"),e=+m.a.getValue(t),i=h.a[t];if(isNaN(e)&&(e=+m.a.getLegacyLocalStorage(t),isNaN(e)||(m.a.deleteLegacyLocalStorage(t),m.a.setValue(t,i))),!a.default.isDemoMode()&&e>0&&i>e)for(var r=0,n=h.a.getUpdateMessages(e),s=0;s<n.length;++s){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(a.default.isString(n[s]))u.default.toasts.pushMessage({text:n[s],hold:!0});else{try{a.default.PAssert(1117,a.default.isFunction(n[s]),"Must supply a valid getter fn for the message")}catch(c){a.default.reportError(c)}var d=n[s]();d.isPremiumOnly&&!u.default.billingManager.hasPremium()||u.default.toasts.pushMessage({text:d.text,hold:!0,action:d.action||o.a.MessageAction.Blog,actionText:d.actionText})}}e!==i&&m.a.setValue(t,i)}}},{key:"getScrollOffset",value:function(){return this.panesContainer.scrollLeft}},{key:"setScrollOffset",value:function(t,e){a.default.scrollTo(t,0,e||o.a.ScrollDuration.Default,this.panesContainer)}},{key:"onUnload",value:function(){a.default.log("Unloading the page");try{var t,e=a.default.getAggregateEvents();for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];a.default.sendEvent(r.category,r.action,r.count),r.count=0}if(p.a.fireEvent("onUnload",[]),a.default.hasPageDataBeenCleared()?u.default.pluginManager&&(t=u.default.pluginManager.onShutdown()):self&&u.default.pluginManager&&(t=u.default.pluginManager.onShutdown()),a.default.UIAction("PageUnload"),a.default.isLoadingRemote)return"We are still syncing your changes. Do you still want to quit?";if(a.default.isSendingEmail)return"Some emails have not been sent. Closing Moo.do will stop them from sending. Do you still want to quit?";if(a.default.isSavingDrafts)return"Your drafts are still being saved. Do you still want to quit?";if(t)return t[0]}catch(n){a.default.reportError(n)}}},{key:"getAppInfo",value:function(t){var e=Date.now(),i=window;t.user={name:u.default.settings.displayName.get(),email:u.default.settings.activeUser.get()},t.gapiTimeout=i.gapiTimeout,t.sessionID=i.__SESSION_ID,t.sessionStart=i.__SESSION_BEGIN,t.reportTime=e,t.runningTime=e-i.__SESSION_BEGIN,t.appCacheUpdated=a.default.wasAppCacheUpdated,t.realtimeLoadStatus=this.computeRealtimeLoadStatus(),h.a.getPlatformInfo(t),this.getRunningState(t),this.getAppStats(t),this.getPremiumInfo(t);try{t.cacheState=u.default.cacheManager.getInfo()}catch(r){t.cacheState="ERROR"}}},{key:"getRunningState",value:function(t){var e,i=window;try{u.default.PaneManager.hasLoadedPaneState()&&(e=u.default.PaneManager.getPaneState())}catch(r){a.default.log("Failed to get paneState")}t.isDebug=!1,t.isDemo=a.default.isDemoMode(),t.localWrites=a.default.shouldWriteLocal(),t.authUserLoggedIn=a.default.authUserLoggedIn,t.isReconnected=a.default.isReconnected,t.url=a.default.sanitizeURL(window.location.href),t.paneState=e?a.default.sanitizePaneState(e):"Missing Pane State",t.checkpoints=i.__checkpoints,t.gapiLoadError=i.gapiLoadError,t.gapiTimeout=i.gapiTimeout,t.gapiClientLoadError=i.gapiClientLoadError,t.gapiClientTimeout=i.gapiClientTimeout,t.DOMReadyState=document.readyState,t.isKeyboardOpen=a.default.isKeyboardOpen,t.jsVersion=o.a.__jsVersion,t.htmlVersion=document&&document.body?document.body.getAttribute("ver"):"UNKNOWN",t.windowWidth=window.innerWidth,t.windowHeight=window.innerHeight,t.eventStream=a.default.getEventStream(),t.trackerStream=k.e.stringifyGroups(),t.criticalErrorReported=a.default.criticalErrorReported(),a.default.getLoadedScripts(t);try{t.nativesel=a.default.parseExtra(window.getSelection())}catch(r){t.nativesel="Error: "+r.message}try{t.customsel=S.a.dumpState()}catch(r){t.customsel="Error: "+r.message}try{t.errorPlatformInfo=JSON.stringify(a.default.errorPlatformInfo)}catch(r){t.errorPlatformInfo="Error: "+r.message}try{t.validScreens=JSON.stringify(i.Screens)}catch(r){t.validScreens="Error: "+r.message}t.lastActivity=this.lastActivity}},{key:"getPremiumInfo",value:function(t){if(u.default.billingManager){var e={premiumStatus:u.default.billingManager.getPremiumStatus(),billingIdentifier:u.default.billingManager.getBillingIdentifier(),lastSignupError:u.default.billingManager._lastSignupError};t.premiumInfo=e}else t.premiumInfo="Billing Manager Not Loaded"}},{key:"computeRealtimeLoadStatus",value:function(){return{gapi:!!window.gapi,auth:!(!window.gapi||!window.gapi.auth),client:!(!window.gapi||!window.gapi.client),drive:!(!window.gapi||!window.gapi.drive),realtime:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime),load:!!(window.gapi&&window.gapi.drive&&window.gapi.drive.realtime&&a.default.isFunction(window.gapi.drive.realtime.load))}}},{key:"getAppStats",value:function(t){var e=window;if(t.numPanes=e.__TOTAL_PANES,t.numItems=a.default.totalItems,t.numArchivedItems=a.default.totalArchivedItems,t.numArchiveParents=a.default.totalArchivedParents,t.parseTextCalls=e.__PARSE_STATS,t.notificationUpdatesFull=a.default.__FULL_NOTIFICATION_UPDATES,t.notificationUpdatesSingle=a.default.__SINGLE_NOTIFICATION_UPDATES,t.XHRStats=a.default.getXHRStats(),u.default.pluginManager){try{t.pluginStats=u.default.pluginManager.getStats()}catch(i){t.pluginStats="Error: "+i.message}try{t.pluginState=u.default.pluginManager.getState()}catch(i){t.pluginState="Error: "+i.message}}if(u.default.recurringTaskManager)try{t.taskStats=u.default.recurringTaskManager.getStats()}catch(i){t.taskStats="Error: "+i.message}o.a.DETAILED_STATS;try{t.measureStats=u.default.Measure.getMeasureStats()}catch(i){t.measureStats="Error: "+i.message}}},{key:"XHR_PrivateAPI",value:function(t){console.log("private api temporarily disabled")}},{key:"onImageLoaded",value:function(t,e,i){var r=t.id+a.default.hashCode(e);this.loadedImages[r]||(this.loadedImages[r]=!0,u.default.Measure.measureImage(i.target),D.a.beginBatch(t),u.default.Measure.clearCacheForItem(t.id),p.a.fireEvent("imageLoaded",[t]))}},{key:"checkDragForScroll",value:function(t){var e=document.getElementById("panes");if(e){var i=e.scrollLeft,r=e.clientWidth,n=r-80,o=0;t.clientX<80&&i>0?o=a.default.computeScrollSpeed(0,80,t.clientX,4,-1):t.clientX>=n&&i<e.scrollWidth-e.clientWidth&&(o=a.default.computeScrollSpeed(n,r,t.clientX,4)),0!==o?a.default.repeatScroll("panes",o,void 0,!0):a.default.cancelRepeatScroll("panes")}}}]),t}(),l()(H.prototype,"runDateRollover",[V.a],Object.getOwnPropertyDescriptor(H.prototype,"runDateRollover"),H.prototype),l()(H.prototype,"mousemove",[V.a],Object.getOwnPropertyDescriptor(H.prototype,"mousemove"),H.prototype),l()(H.prototype,"checkLowActivity",[V.a],Object.getOwnPropertyDescriptor(H.prototype,"checkLowActivity"),H.prototype),l()(H.prototype,"onUnload",[V.a],Object.getOwnPropertyDescriptor(H.prototype,"onUnload"),H.prototype),H),T=(i(143),i(139),i(45)),q=i(2),j=i.n(q),Y=i(71),X=i.n(Y),Q=i(66),J=i.n(Q),Z=i(92),B=i(20),$=i(44),U=i(17),R=i.n(U),E=i(9),K=i.n(E),x=i(18),b=i.n(x),O=i(72),W=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"getState",value:function(){return a.default.clone(this.props.observe)}},{key:"render",value:function(){var t=this.props,e=this.state;if(t.render)return t.render(e,t);var i=t.component||"div";return t=a.default.extend({style:t.renderStyle(e,t)},t),j.a.createElement(i,t,t.children)}}]),e}(B.a),_=i(23),tt=i(49),et=i(39),it=B.b.createClass({displayName:"ReactSearchButton",componentDisplay:o.a.ComponentDisplay.Desktop,init:function(){var t=this.props.filter;this.firstValue=this.props.filterValue||t.initialValue},onMouseDown:function(t){a.default.preventAndStop(t)},onClickIcon:function(t){var e=this.props.filter,i=this.props.filterValue;i=!1!==e.canBeNegated&&(!h.a.mac&&t.ctrlKey||h.a.mac&&t.metaKey)&&!isNaN(e.initialValue)&&i!==-e.initialValue?-e.initialValue:i?0:e.initialValue,this.props.search.setFilter(e.name,i,!0)},render:function(){var t=this.props,e=t.filter,i=t.filterValue,r=this.firstValue===i,n=t.noClick?void 0:this.props.search.getFilterTooltip(e),o=a.default.classNames("searchButton",{"c-border-super-light":t.hasBorder},{"c-button":!i},{selected:!!i},e.icon,e.isOption&&(1===i?"yes":-1===i?"only":""),!e.isOption&&((i?this.firstValue>0&&r||this.firstValue<0&&!r:this.firstValue>0)?"yes":"no"));return j.a.createElement("div",{className:o,"data-tooltip":n,onMouseDown:this.onMouseDown,onClick:t.noClick?void 0:this.onClickIcon})}}),rt=i(67),at=i(13),nt=B.b.createClass({displayName:"ReactSearch",componentDisplay:o.a.ComponentDisplay.Everywhere,onMount:function(){this.props.pane.search.UI=this,this.listenTo(this.props.pane.search.onChanged),h.a.isMobile?this.addTap("searchInnerWrap",this,this.onTapBox):this.forceUpdate()},getState:function(){for(var t=0,e=this.props.pane,i=e.search,r={search:i.value,calendars:z.a.GCalendarsAvailable,displayCalendars:e.displayCalendars,displayLocalItems:e.displayLocalItems},a=0;a<i.filters.length;a++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=i.filters[a];r[n.name]=n.value,r[n.name+"Enabled"]=n.enabled}return r},onChange:function(t){this.props.pane.search.setValue(t)},onParsed:function(t){this.props.pane.search.onParsed(t)},setSearch:function(t,e){this.props.pane.search.setValue(t),h.a.isMobile||!1===e||this.setSelectionOffset(t.length)},getSelectionOffset:function(){return this.refs.input.getSelectionOffset()},setSelectionOffset:function(t){this.refs.input.setSelectionOffset(t)},onFocus:function(){var t=this.props.pane,e=t.search;e&&(this._selectionBeforeBlur=S.a.save(),S.a.reset(),e.isFocused.set(!0),T.a.hide(),h.a.isMobile?(a.default.keyboardToolbar.show(o.a.KeyboardToolbarMode.Search),a.default.sendEvent("SearchFocus","Mobile")):(a.default.sendEvent("SearchFocus","Desktop"),e.filters.length>0&&!u.default.menus.isContextMenuOpen("ReactContextMenuSearch")&&u.default.menus.openContextMenu({componentName:"ReactContextMenuSearch",key:"search"+t.id+(t.viewMode?t.getViewMode():""),element:this.refs.searchBox,positionOffset:{top:4},noBackdrop:!0,pane:t,showFilters:this.props.showFilters,onClosed:this.blur})))},onBlur:function(){var t=this.props.pane.search;t&&t.isFocused.set(!1),h.a.isMobile&&a.default.keyboardToolbar.hide()},focus:function(){this.refs.input.focus(),this.refs.input.selectEnd()},blur:function(){this.refs.input&&this.refs.input.blur()},onTapBox:function(t){h.a.isMobile&&(a.default.keyboardToolbar.preShow(),this.focus()),h.a.isMobile&&(a.default.keyboardToolbar.show(o.a.KeyboardToolbarMode.Search),t.preventDefault())},onTapX:function(t){var e=this.props.pane,i=h.a.isMobile;if(this.state.search.length>0){if(!i)var r=S.a.save();this.setSearch("",!1),!i&&r&&e.restoreSelection(r),a.default.preventDefault(t),a.default.sendEvent("Menu","ClearSearch")}else i?this.onTapBox(t):this.focus(),a.default.sendEvent("Menu","FocusSearch")},onKeyDown:function(t){if(this.saveScrollOfTop(),!h.a.isMobile){if(h.a.mac&&t.ctrlKey&&t.keyCode===o.a.KeyCode.T)return a.default.preventDefault(t),this.blur(),void et.a.hotkeyAddPane();var e=this.props.pane;if(t.keyCode===o.a.KeyCode.Enter)e.search.update(!0,!0),this.setSelectionOffset(this.state.search.length);if(t.keyCode===o.a.KeyCode.Tab||t.keyCode===o.a.KeyCode.Enter){var i=e.indexOfFirstItem();if(i>=0){var r=i,n=this._selectionBeforeBlur;n&&(S.a.restore(n)?(this._selectionBeforeBlur=void 0,r=n.startIndex):n=null),n||(this.blur(),e.selectIndex(i,0),setTimeout(function(){e.selectIndex(i,0)},0)),S.a.focusPane(e),r>=0&&a.default.focusedPane.scrollIndexIntoView(r,o.a.ScrollDuration.Default)}else e.type===o.a.PaneMode.Task&&e.addItem(t);t.preventDefault(),t.stopPropagation()}}},onAutocompleteSelected:function(t){if(t.item){var e=this.props.pane.search,i=e.getValue(),r=i.indexOf(o.a.PrefixItemAutocomplete);i=i.substr(0,r),e.setValue(i),this.props.pane.zoomIn(t.item,!1,!1,!0),this.setSelectionOffset(i.length)}this.refs.input.updateAutocomplete(),this.focus()},onClickFilters:function(){this.focus()},onClickPriority:function(){this.props.pane.search.setFilter("priority",0)},onClickText:function(t){if(t.altKey){var e,i,r;if(a.default.hasClass(t.target,"fancyInputInput")){var n=C.default.getSelectionRange().getNativeRange();if(n){var o=(e=n.cloneRange()).startContainer.nodeValue;if(a.default.isString(o)){for(var s=0,h=0,d=0,c=o.length,v=e.startOffset;v>=0;v--){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;if(" "===o[v]||160===o.charCodeAt(v)){d=v+1;break}}for(v=e.endOffset;v<o.length;v++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;if(" "===o[v]||160===o.charCodeAt(v)){c=v;break}}i=c-d,r=d}}}else(e=C.default.createSelectionRange()).selectNodeContents(t.target),r=e.startOffset,i=e.toString().length;if(e&&!isNaN(r)&&i){e.setEnd(e.startContainer,r),e.setStart(e.startContainer.parentNode,0);var y=e.toString().length,g=this.props.pane.search,l=g.getValue();u.default.PaneUpdateBatcher.beginUpdateItems(),l=(l.substr(0,y)+l.substr(y+i)).replace(/  +/g," ").trim(),g.setValue(l),u.default.PaneUpdateBatcher.commitUpdateItems(),this.setSelectionOffset(y)}}},saveScrollOfTop:function(){this.props.pane.getInfiniteList().saveScrollOfTop(!0)},renderSearchButton:function(t){var e=this.props.pane;return j.a.createElement(it,{key:t.name,filter:t,filterValue:t.value.get(),search:e.search})},renderSearchPriority:function(){var t=this.props.pane.search.filter_priority.value.get(),e=t===o.a.VMLIFlag.P0?0:t===o.a.VMLIFlag.P1?1:t===o.a.VMLIFlag.P2&&2,i=a.default.classNames("searchPriority searchP"+e+" selected");return j.a.createElement("span",{key:"priority",className:i,onClick:this.onClickPriority})},render:function(){var t=this.props,e=this.state,i=t.pane,r=i.search,a=e.search,n=a.length>0?"icon-close":"",u=h.a.isMobile?40:o.a.SearchHeight,s=[];if(!h.a.isMobile&&!1!==t.showFilters){for(var d=0,c=0;c<r.filters.length;c++){if(d++>5e3&&__infLoop&&__infLoop(d))throw new RangeError;var v=r.filters[c];v.enabled.get()&&v.value.get()&&(v.icon?s.push(this.renderSearchButton(v)):"priority"===v.name&&s.push(this.renderSearchPriority()))}i.isViewDates()&&i.isCalFilterActive()&&s.push(j.a.createElement("div",{key:"dateFilter",className:"searchButton icon-calendar selected yes",onClick:this.onClickFilters}))}var y=j.a.createElement(at.a,{className:"searchX c-button noShrink",width:24,height:u,icon:n,onClick:this.onTapX}),g=j.a.createElement("div",{className:"searchInnerWrap",ref:"searchInnerWrap"},j.a.createElement(rt.a,{ref:"input",className:"search",id:"search",height:h.a.isMobile?30:u,value:a,onClick:this.onClickText,onChange:this.onChange,onKeyDown:this.onKeyDown,onFocus:this.onFocus,onBlur:this.onBlur,onParsed:this.onParsed,parse:!0,placeholder:"Search",autocompleteMode:"all",border:!1,autocompleteElementDisplay:this.refs.searchBox,padding:{left:0,right:0},onAutocompleteSelected:this.onAutocompleteSelected,supportSearchItemAutocomplete:i.supportSearchItemAutocomplete,canAutocompleteItems:i.type===o.a.PaneMode.Task,noShowAutocomplete:!0,isSearch:!0,pane:i}));return h.a.isMobile?j.a.createElement("div",{className:"searchWrap c-background flexbox f1"},g,y):j.a.createElement(j.a.Fragment,null,j.a.createElement("div",{className:"searchWrap"},j.a.createElement("div",{className:"searchBox c-bg-light flexbox",ref:"searchBox"},j.a.createElement("div",{className:"searchBoxInner flexbox"},g,y),s.length>0&&j.a.createElement("div",{className:"searchButtons noShrink"},s))))}}),ot=i(94),ut=i(60),st=i(41),ht=i(76);if(h.a.isMobile)var dt=i(44).default;var ct=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"getState",value:function(t){var e=t.item,i=t.pane,r={customName:i.name,rootText:i.titleOfFirstItem,viewState:i.viewState,viewMode:i.getViewMode(),text:""};if(t.viewMode)if(i.name.get())r.text=i.name.get();else{r.text=o.a.TaskViewModeTextSimple[r.viewMode];var a=i.getSortModeBlocks(),n=i.getSortModeItems(),u=a&&a!==o.a.TaskSortMode.None;u&&(r.text+=": "+o.a.TaskSortModeText[a]),n&&n!==o.a.TaskSortMode.None&&(r.text+=(u?", ":": ")+o.a.TaskSortModeText[n])}else t.paneName?r.text=i.title:(r.text=this.getTextForItem(e),r.jsx=this.getJSXForItem(e),e.els&&e.els.length&&(r.html=this.getHTMLForItem(e)));return r}},{key:"init",value:function(){this._onMount()}},{key:"_onMount",value:function(t){(t=t||this.props).viewMode||(this.listenTo(t.pane.document),this.listenTo(t.item.itemChanged),t.pane.getDocument()&&this.listenTo(t.pane.getDocument().text))}},{key:"componentWillReceiveProps",value:function(t){t.viewMode===this.props.viewMode&&this.props.item===t.item||(this.refreshListeners(),this._onMount(t),this.updateState(t))}},{key:"onMouseDown",value:function(t){h.a.isMobile||(this._holdTimeout=setTimeout(this.openContextMenu,150,{target:t.target}))}},{key:"onMouseUp",value:function(){this.clearHoldTimeout()}},{key:"onClick",value:function(t){if(h.a.isMobile)dt.toggleOverviewVisibility(this.props.pane);else{var e=this.props;a.default.isString(e.item)||(e.isLast?this.openContextMenu(t):e.pane.onClickTitle(e.item))}}},{key:"onRightClick",value:function(t){t.preventDefault(),this.openContextMenu(t)}},{key:"onDoubleClick",value:function(t){var e=this.props.pane;a.default.isString(this.props.item)||e.onDoubleClickTitle()}},{key:"onClickMenuItem",value:function(t){this.props.pane.onClickTitle(t)}},{key:"onClickDocument",value:function(t){this.props.pane.setDocument(t)}},{key:"clearHoldTimeout",value:function(){clearTimeout(this._holdTimeout),this._holdTimeout=void 0}},{key:"getTextForItem",value:function(t){return t.generateTitleText(this.props.pane)}},{key:"getHTMLForItem",value:function(t){return t.getStyledTextAsOneLine(!1,!1)}},{key:"getJSXForItem",value:function(t){var e=this.getTextForItem(t),i=u.default.pluginManager.getPluginGmail();if(i.isLabelItem(t)){var r=i.getIconForLabel(t),n=a.default.classNames("labelText",{hasIcon:!!r});return j.a.createElement("span",{className:n},j.a.createElement("i",{className:r&&"c-foreground-light icon-"+r}),e)}return e}},{key:"openContextMenu",value:function(t){var e=this.props,i=e.pane,r=e.item;!r.parent()&&i.supportsDocuments?u.default.menus.openContextMenu({fn:this.renderContextMenuDocuments,element:t.target,doc:i.getDocument(),pane:i,documents:s.a.getDocumentsArray()}):u.default.menus.openContextMenu({fn:this.renderContextMenuHold,element:t.target,item:i.getItem(),pane:i,titles:r.parent()?r.parent().items.get():r.items.get()}),this.clearHoldTimeout()}},{key:"renderContextMenuDocuments",value:function(t){var e=this;return j.a.createElement(ut.a,{key:"contextMenuTitle",id:"contextMenuTitle",element:t.element,maxHeight:400},j.a.createElement(ot.a,{topHeader:!0},"Select document"),t.documents.map(function(i){return j.a.createElement(st.a,{key:i.id,active:i===t.doc,onClick:e.onClickDocument.bind(e,i)},i.text.get())}))}},{key:"renderContextMenuHold",value:function(t){var e=this;return j.a.createElement(ut.a,{key:"contextMenuTitle",id:"contextMenuTitle",element:t.element,maxHeight:400},j.a.createElement(ot.a,{topHeader:!0},this.props.pane.titleContextMenuHeader),t.titles.map(function(i){var r=e.getJSXForItem(i);return j.a.createElement(st.a,{key:i.id,active:i===t.item,onClick:e.onClickMenuItem.bind(e,i)},r)}))}},{key:"render",value:function(){var t,e=this.props,i=this.state,r=e.item,n=(!e.viewMode&&r.parent(),i.text,a.default.classNames("titleWrapper",e.className,{"c-foreground":e.isLast},{"c-foreground-very-faded c-color-hover":!h.a.isMobile&&!e.isLast&&!e.viewMode&&!e.paneName},{last:e.isLast},{firstRow:e.viewMode||e.paneName},{viewMode:e.viewMode})),o=a.default.classNames("title");return t=e.viewMode?"<b>Click</b> to change view mode or name this pane":"<b>Click</b> to zoom to item\n<b>Press and hold</b> to zoom to select a "+(i.siblingMode?"sibling":"parent")+" to zoom to",j.a.createElement(ht.a,{className:n,"data-tooltip":t,onClick:this.onClick,onDoubleClick:this.onDoubleClick,onMouseDown:e.viewMode?e.pane.openViewMenu:this.onMouseDown,onMouseUp:this.onMouseUp,onContextMenu:this.onRightClick,ripple:!1},(i.jsx||!i.html)&&j.a.createElement("span",{className:o},i.jsx||i.text),!(i.jsx||!i.html)&&j.a.createElement("span",{className:o,dangerouslySetInnerHTML:{__html:i.html}}))}}]),e}(B.a);if(h.a.isMobile)var vt=i(44).default;if(h.a.isMobile)var yt=i(140).default;var gt=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"init",value:function(){h.a.isMobile&&(this.paneScrollOffset=0,this.createObservables({headerRow2Position:0}))}},{key:"getState",value:function(){var t=this.props.pane,e=u.default.pluginManager.getPluginGmail(),i={accounts:e.getSettingObs(e.Settings.SyncAccounts),isOverviewVisible:t.overview.isVisible,item:t.item,showingArchived:t.showArchived,isSearchFocused:t.search.isFocused,isFocused:t.isFocused,titles:t.getTitleList()};return h.a.isMobile&&(i.topBarMode=vt.topBarMode,i.numSelected=_.a.numSelected),i}},{key:"onMount",value:function(t){h.a.isMobile&&(this.props.pane.addScrollListener(this.onPaneScroll),setTimeout(function(){var t=this.props.pane.getScrollOffset();this.paneScrollOffset=t}.bind(this),0))}},{key:"onUnmount",value:function(t){h.a.isMobile&&this.props.pane.removeScrollListener(this.onPaneScroll)}},{key:"onBeforeChanged",value:function(t,e){this.refs;h.a.isMobile&&t.item!==e.item&&(this.headerRow2Position.set(0,!1),t.headerRow2Position=0)}},{key:"onPaneScroll",value:function(t){var e=this.props.pane.getScrollOffset();if(void 0===this.paneScrollOffset&&(this.paneScrollOffset=e),e!==this.paneScrollOffset&&e>0){var i=this.headerRow2Position.get()+this.paneScrollOffset-e;this.headerRow2Position.set(a.default.clamp(i,-o.a.PaneHeaderRow2Height,0))}this.paneScrollOffset=e}},{key:"onMouseDown",value:function(t){h.a.isMobile||t.button!==o.a.ButtonCode.Left||this.props.startDragging(t)}},{key:"onMouseDownMore",value:function(t){u.default.menus.openContextMenu({fn:this.renderContextMenu,element:t.target})}},{key:"numComplete",value:function(){return this.props.pane.getItemsToArchive().length}},{key:"cloneBoard",value:function(t){tt.a.cloneBoard(void 0,t)}},{key:"_clonePane",value:function(t){var e=u.default.PaneManager.getPaneIndex(t),i=t.getSaveInfoForClone();u.default.PaneManager.createPaneAtIndex(i.type,e+1,i)}},{key:"onClickClonePane",value:function(){this._clonePane(this.props.pane)}},{key:"onTapOverviewButtonMobile",value:function(){h.a.isMobile&&vt.toggleOverviewVisibility(this.props.pane)}},{key:"onTapMoreButtonMobile",value:function(){h.a.isMobile&&u.default.menus.toggleContextMenu({fn:this.renderContextMenuMobile})}},{key:"onTapMultiselectMobile",value:function(){h.a.isMobile&&vt.setMultiselectVisibility(!0)}},{key:"onTapCloseTopStatus",value:function(){h.a.isMobile&&vt.resetTopBarMode()}},{key:"onTapClearMultiselect",value:function(){_.a.setSelected([],this.props.pane)}},{key:"onTapUndoMobile",value:function(){k.e.undoAction()}},{key:"onClickStar",value:function(){this.cloneBoard(this.props.pane)}},{key:"onClickArchiveCompleted",value:function(){var t=this.props.pane,e=this.numComplete();u.default.menus.confirm("Are you sure you want to archive "+e+" completed item"+(e>1?"s":"")+"?",function(e){e&&t.archiveCompleted()})}},{key:"onDoubleClickHeader",value:function(t){a.default.hasClass(t.target,"paneDraggable")&&this.props.pane.scrollToTop(o.a.ScrollDuration.Default)}},{key:"onClickCollapseAll",value:function(){var t=this.props.pane;t.collapseAll(void 0,!0),t.setScrollOffset(t.defaultOffset)}},{key:"onClickExpandAll",value:function(){var t=this.props.pane;t.collapseAll(void 0,!1),t.setScrollOffset(t.defaultOffset)}},{key:"renderContextMenuMobile",value:function(){if(h.a.isMobile){this.state;var t=this.props.pane;return q.createElement(ut.a,{key:"contextMenuMobileOptions",position:"top-right",className:"contextMenuMobile"},t.supportMultiselect&&q.createElement(st.a,{icon:"icon-done_all",onClick:this.onTapMultiselectMobile},"Multiselect"),q.createElement(st.a,{icon:"icon-reply",onClick:this.onTapUndoMobile},"Undo"),t.supportCollapsing&&q.createElement(st.a,{icon:"icon-minus",onClick:this.onClickCollapseAll},"Collapse All Items"),t.supportCollapsing&&q.createElement(st.a,{icon:"icon-add",onClick:this.onClickExpandAll},"Expand All Items"),t.supportPerformArchive&&q.createElement(st.a,{icon:"icon-task",disabled:0===this.numComplete(),onClick:t.onClickArchiveCompleted},"Archive Completed"),t.supportDataRefresh&&q.createElement(st.a,{icon:"icon-spinner",onClick:t.onClickRefreshData},"Force refresh"))}}},{key:"renderContextMenu",value:function(t){var e=this.props.pane,i=e.supportDataRefresh||e.supportReportError;return q.createElement(ut.a,{key:"contextMenuPaneHeader",element:t.element},q.createElement(q.Fragment,null,q.createElement(st.a,{icon:"icon-close",onClick:e.onTapClosePane.bind(e)},"Close"),q.createElement("hr",null)),q.createElement(st.a,{icon:"icon-star_border",onClick:this.onClickStar},"Open pane in new board"),e.supportClone&&h.a.isFeatureEnabled(o.a.Feature.ClonePane)&&q.createElement(st.a,{icon:"icon-align-left",onClick:this.onClickClonePane},"Clone Pane"),e.supportPerformArchive&&q.createElement(st.a,{icon:"icon-task",disabled:0===this.numComplete(),onClick:this.onClickArchiveCompleted},"Archive Completed Items"),i&&q.createElement("hr",null),e.supportDataRefresh&&q.createElement(st.a,{icon:"icon-spinner",onClick:e.onClickRefreshData},"Force refresh"),e.supportReportError&&q.createElement(st.a,{icon:"icon-warning",onClick:e.onClickReportError},"Report Error"),e.widthManual&&q.createElement("hr",null),e.widthManual&&q.createElement(st.a,{icon:"icon-arrows-h",onClick:e.setWidthManual.bind(e,void 0)},"Auto-size pane"))}},{key:"renderTopStatus",value:function(t,e){if(h.a.isMobile){return q.createElement("div",{className:"paneHeader"},q.createElement(at.a,{className:"topLeftButton",icon:"icon-close",color:"#444",iconSize:24,width:a.default.topBarHeight,height:a.default.topBarHeight,onClick:this.onTapCloseTopStatus}),q.createElement("div",{className:"topStatus"},t),e)}}},{key:"render",value:function(){var t=this.state,e=this.props.pane,i=this.getChildByKey("headerButtons");if(h.a.isMobile){if(t.topBarMode===o.a.TopBarMode.Normal){var r=a.default.classNames("titles f1",{multiline:t.titles.length>1}),n={};return n[h.a.transform.react]="translate3d(0,"+t.headerRow2Position+"px,0)",q.createElement("div",{className:"paneHeader"},q.createElement("div",{className:"paneHeaderRow paneHeaderRow1 flexbox"},q.createElement("div",{className:"leftButtons"},q.createElement(at.a,{icon:"icon-menu",iconSize:24,width:a.default.topBarHeight,height:a.default.topBarHeight,onClick:this.onTapOverviewButtonMobile})),q.createElement("span",{className:r},t.titles.length>1&&q.createElement("div",{className:"titlesParents"},t.titles.map(function(i,r){if(r<t.titles.length-1)return q.createElement(ct,{key:"title_"+r,isLast:!1,pane:e,item:i})})),q.createElement(ct,{className:"currentTitle",isLast:!0,pane:e,item:t.titles[t.titles.length-1]})),q.createElement("div",{className:"rightButtons"},q.createElement(at.a,{icon:"icon-more_horiz",color:"#666",iconSize:24,width:a.default.topBarHeight,height:a.default.topBarHeight,onClick:this.onTapMoreButtonMobile}))),q.createElement("div",{className:"paneHeaderRow paneHeaderRow2 flexbox",style:n},i&&q.Children.map(i.props.children,function(t){return t}),!t.isOverviewVisible&&q.createElement(nt,{pane:e}),h.a.isMobile&&!t.isOverviewVisible&&q.createElement(yt,{pane:e})))}return t.topBarMode===o.a.TopBarMode.Multiselect?this.renderTopStatus(t.numSelected+" Selected",q.createElement(at.a,{className:"abs",style:{right:0},enabled:t.numSelected>0,height:44,fontSize:16,primary:!0,fontWeight:"normal",onClick:this.onTapClearMultiselect},"Clear")):this.renderTopStatus(t.topBarMode)}var u=o.a.PaneHeaderButtonWidth,s=o.a.PaneHeaderButtonHeight,d=a.default.classNames("paneHeader c-background c-border twoRows",{focused:t.isFocused});return q.createElement("div",{className:d,onDoubleClick:this.onDoubleClickHeader},q.createElement("div",{className:"paneHeaderRow paneHeaderRow1 flexbox",onMouseDown:this.onMouseDown},q.createElement(at.a,{className:"overviewButton",icon:"icon-menu",iconSize:15,width:u,height:s,onClick:e.onTapOverviewButton.bind(e),tooltip:(t.isOverviewVisible?"Close":"Open")+" Overview"}),q.createElement("div",{className:"f1",style:{maxWidth:4}}),q.createElement("span",{className:"titles titlesRow1"},e.supportViewMenu&&q.createElement(ct,{pane:e,item:t.titles[t.titles.length-1],viewMode:!0,row1:!0}),!e.supportViewMenu&&q.createElement(ct,{pane:e,item:t.titles[0],paneName:!0,row1:!0})),q.createElement(nt,{pane:e}),q.createElement("div",{className:"f1 paneDraggable"}),i&&q.Children.map(i.props.children,function(t){return t}),q.createElement(at.a,{className:"paneCloseButton",icon:"icon-more_vert",iconSize:17,width:u,height:s,onMouseDown:this.onMouseDownMore,tooltip:"Pane Options"})),q.createElement("div",{className:"paneHeaderRow paneHeaderRow2 flexbox paneDraggable",onMouseDown:this.onMouseDown},q.createElement(ct,{key:"title_0",pane:e,item:t.titles[0],isLast:1===t.titles.length}),q.createElement("div",{className:"paneHeaderRow2Inner f1"},q.createElement("div",{className:"paneHeaderRow2Inner2 paneDraggable"},t.titles.map(function(i,r){if(r>0)return q.createElement(ct,{key:"title_"+r,pane:e,item:i,isLast:r===t.titles.length-1})})))))}}]),e}(B.a),lt=B.b.createClass({displayName:"ReactHiddenInput",componentDisplay:o.a.ComponentDisplay.Desktop,getState:function(){return{position:this.props.pane.caretPosition}},getElement:function(){return this.refs.hiddenInput},render:function(){this.state;var t=this.state.position,e={};return t&&(e.left=t.left,e.top=t.top),j.a.createElement("div",{style:e,contentEditable:!0,className:"paneHiddenInput",ref:"hiddenInput",suppressContentEditableWarning:!0},o.a.TextSpace)}}),pt=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"init",value:function(){this.props.pane.onInfiniteListLoaded(),this.props.owner.notifyInit(this)}},{key:"onMount",value:function(){this.props.hiddenInput&&(this.props.pane.hiddenInput=this.refs.hiddenInput.getElement())}},{key:"onUnmount",value:function(){this.props.owner.notifyUnmounted()}},{key:"getState",value:function(){var t=this.props,e=t.pane,i=t.owner,r=t.overview;return{cells:i.cellsObs,paddingBottom:i.paddingBottom,contentSize:i.contentSize,bottomListMessage:!r&&e.bottomListMessage(),isLoadingNewPage:e.isLoadingNewPage,isLoading:e.isLoading,statusMessage:e.getStatusMessage(this.props.overview),disablePointerEvents:i.disablePointerEvents,rect:this.props.pane.rect,items:i._itemsObs}}},{key:"isIndexMounted",value:function(t){return t>=0&&!!this._getElementAtIndex(t)}},{key:"getElement",value:function(){return this.refs.contentElement}},{key:"_getElementAtIndex",value:function(t){for(var e,i=0,r=this.props,a=this.state,n=0;n<a.cells.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;if(a.cells[n].index===t){e=n;break}}var o=this.getChildByKey("topBox"),u=e+(r.hiddenInput?1:0)+(o?1:0);return this.refs.contentElement.children[u]}},{key:"getElementAtIndex",value:function(t){var e=this._getElementAtIndex(t);try{a.default.PAssert(1621,e,"Must have a valid mounted item at index",t)}catch(i){a.default.reportError(i)}return e}},{key:"handleClick",value:function(){this.props.pane.isLoading.get()&&this.state.statusMessage&&this.props.pane.handleStatusClick()}},{key:"renderItems",value:function(){for(var t=0,e=[],i=this.state.cells,r=0;r<i.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;e.push(this.props.renderCell(r,i[r]))}return e}},{key:"render",value:function(){var t,e=this.state,i=this.props,r=i.pane,n=a.default.classNames(i.contentClass,{noClickItems:e.disablePointerEvents}),u=e.statusMessage,s=e.contentSize+e.paddingBottom;if(!i.isLoading)if(e.bottomListMessage&&e.bottomListMessage.text&&!i.overview){var d=e.bottomListMessage,c={};c[h.a.transform.react]="translateY("+e.contentSize+"px)",t=j.a.createElement("div",{className:"paneBottomMessage c-border-light",style:c},d.clickable?j.a.createElement(at.a,{className:"paneDataPageLoad"},d.text):j.a.createElement("div",{className:"paneDataPageLoad c-foreground-very-faded"},d.text)),s+=40}else i.owner.hasItems()||(n+=" noItems"+(u?" displayStatus":""));var v={};i.orientation===o.a.Orientation.Horizontal?(v.width=(s||200)+"px",v.height="100%"):(v.height=(s||200)+"px",v.width="100%");var y=null;return i.hiddenInput&&(y=j.a.createElement(lt,{ref:"hiddenInput",pane:r})),j.a.createElement("ul",{className:n,style:v,onClick:this.handleClick,spellCheck:!1,draggable:!1,ref:"contentElement","data-pane-status":u},y,this.getChildByKey("topBox"),this.renderItems(),t)}}]),e}(B.a),mt=B.b.createClass({displayName:"ReactCaret",componentDisplay:o.a.ComponentDisplay.Desktop,init:function(){this.createObservables({isOn:!1})},onMount:function(){document.addEventListener("mousedown",this.startAnim),document.addEventListener("mouseup",this.startAnim)},onUnmount:function(){document.removeEventListener("mouseup",this.startAnim),document.removeEventListener("mousedown",this.startAnim),clearTimeout(this.animTimeout)},getState:function(){var t=this.props.pane;return{info:t.caretPosition,isWindowFocused:S.a.isWindowFocused,activePane:S.a.pane,contextMenus:u.default.menus.contextMenuStack,isPaneActive:S.a.isWindowFocused.get()&&S.a.getPane()===t&&0===u.default.menus.contextMenuStack.get().length}},onAfterChanged:function(t,e){t.isPaneActive&&t.info&&(t.isPaneActive!==e.isPaneActive||t.info!==e.info)&&this.startAnim(t)},startAnim:function(t){this.animTick(!0,t)},animTick:function(t,e){(e=e||this.state).isPaneActive&&e.info&&(clearTimeout(this.animTimeout),this.isOn.set(t||!this.isOn.get()),this.animTimeout=setTimeout(this.animTick,500))},render:function(){var t=this.state,e=this.state.info,i=e&&e.item,r=e&&e.pane,a=e&&e.paneObject,n={height:"18px"};return e&&t.isPaneActive&&S.a.isValid()&&S.a.getStartItem()?(e.isVisible&&(n.height=i&&r&&u.default.DisplaySettings.fontSizeForItem(a,i,r)+"px",n.opacity=t.isOn?1:0),n[h.a.transform.react]="translate3d("+e.left+"px, "+e.top+"px, 0)"):n[h.a.transform.react]="translate3d(-1000px, -1000px, 0)",j.a.createElement("div",{className:"caret c-bg-caret",style:n})}}),ft=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"render",value:function(){var t=this.props,e=t.style,i=t.size,r=t.left,n=t.top,o=t.center,u=t.inline,s=t.color,h=t.children;e=Object.assign({},e);var d=(i=i||20)||20,c={fontSize:i,height:d,width:d,lineHeight:d+"px",color:s};(n||r)&&(e.position="absolute",e.left=r||"50%",e.top=n||"50%",c.marginLeft=-i/2,c.marginTop=-i/2+20);var v=a.default.classNames("fancyLoader",{center:o},{inline:u}),y={color:s};return j.a.createElement("div",{className:v,style:e},j.a.createElement("div",{className:"icon-spinner",style:c}),h&&j.a.createElement("div",{className:"fancyLoaderText",style:y},h))}}]),e}(B.a),kt=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"init",value:function(){this.createObservables({draggedWidth:void 0})}},{key:"onMouseDownResize",value:function(t){var e=this.props,i=e.line,r=this.refs.image.getBoundingClientRect(),n=u.default.Measure.getImageOriginalSize(i.src,i.srcDataUrl);this.maxWidth=Math.min(n.width,e.pane.maxWidthOfPaneObject(e.paneObject)+(e.item.hasPrefix()?o.a.PrefixWidth:0)),this.draggedWidth.set(e.line.maxWidth||r.width,!1),this.leftPos=r.left,this.rightOffset=r.right-t.clientX,e.onStartResize(),a.default.preventAndStop(t),a.default.isDraggingImage=!0}},{key:"onMouseMoveResize",value:function(t){var e=t.clientX-this.leftPos+this.rightOffset;this.draggedWidth.set(a.default.clamp(e,40,this.maxWidth)),a.default.preventAndStop(t)}},{key:"onMouseUpResize",value:function(){var t=this.draggedWidth.get();this.props.onEndResize(t),a.default.isDraggingImage=!1}},{key:"render",value:function(){var t=this.props,e=t.line,i=t.style,r=t.isHovered,n=t.item,o=t.hasSelection,s=e.srcDataUrl&&e.src!==e.srcDataUrl,h=e.isDriveImage||!u.default.settings.showMarkdown.get()||!o,d=a.default.classNames({mdImage:!e.isDriveImage},{driveImage:e.isDriveImage}),c=a.default.classNames(d,{none:s}),v=a.default.classNames("mdMarkup",{driveImageMarkup:e.isDriveImage}),y={maxWidth:!this.state.draggedWidth&&h&&e.maxWidth,width:this.state.draggedWidth},g=e.attach&&e.attach.isLocalOnlyAttachment();return j.a.createElement("span",{className:"line",style:i},e.previousText&&j.a.createElement("span",{dangerouslySetInnerHTML:{__html:e.previousText}}),j.a.createElement("span",{className:v},e.originalText),h&&j.a.createElement("div",{className:"mdImageWrapper rel ib",style:y},j.a.createElement("img",{key:a.default.hashCode(e.src),className:c,src:e.src,onLoad:a.default.vmMain.onImageLoaded.bind(a.default.vmMain,n,e.src),"data-original-text":e.originalText,ref:"image"}),s&&j.a.createElement("img",{key:a.default.hashCode(e.srcDataUrl),className:d,src:e.srcDataUrl,onLoad:a.default.vmMain.onImageLoaded.bind(a.default.vmMain,n,e.srcDataUrl),"data-original-text":e.originalText}),g&&j.a.createElement(ft,{style:{background:"rgba(0,0,0,0.5)"},color:"#eee",center:!0},"Uploading..."),r&&j.a.createElement(O.a,{className:"mdImageResizer flexbox flexvert",onMouseDown:this.onMouseDownResize,onMouseMove:this.onMouseMoveResize,onMouseUp:this.onMouseUpResize,globalEvents:!0})),e.nextText&&j.a.createElement("span",{dangerouslySetInnerHTML:{__html:e.nextText}}))}}]),e}(B.a);if(h.a.isMobile)var At=i(44).default;var St=function(t,e,i){var r=e.overview,a=e.pane;return i.isHeader&&(a.supportCollapsing||r)&&(r||!a.isSearchedFlat())&&!t.isNote()&&!(r&&0===i.levelsDeep)},wt=function(t,e,i,r){return t=t||o.a.TextSpace},Lt=function(t,e){var i=t.item||t;return!e.isViewAgenda()&&i.isNote()&&i.parent().getPrefix()&&(!t.block||t.block.item!==i.parent())&&o.a.PrefixWidth+o.a.LineLeftPad},Ft=function(){this.setState({draggingImage:!0})},Ct=function(t,e,i){var r=this;if(t.isDriveImage){var a=t.attach;a.getPlugin().setAttachWidth(e,a,i)}else{var n,u=e.getRawText();o.a.Regexp.MDLink.lastIndex=0,null!==(n=o.a.Regexp.MDLink.exec(u))&&(u="!["+n[2]+"]("+n[3]+" ="+i+"x)"),e.setText(u,o.a.ChangeType.Local)}setTimeout(function(){r.setState({draggingImage:!1})},o.a.ItemTransitionTime)},It=function(t,e,i,r,n){var s=[],d=i.pane,c=i.cell.paneObject,v=d.maxWidthOfPaneObject(c)+(e.hasPrefix()?o.a.PrefixWidth:0);if(r.selected||e.isNote()){var y={top:0,width:v,height:r.height};y[h.a.transform.react]="translateX("+n+"px)",s.push(j.a.createElement("span",{key:"selStart",className:"textSelected",style:y}))}else if(void 0!==r.selectedStart){var g,l=r.lines.reduce(function(t,e){return t+a.default.unescape(e).length},0),p=r.selectedStart,m=r.selectedEnd;p<0&&(p=0),m<0&&(m=l,g=!0);var f=u.default.Measure.getCaretOffset(c,d,p,!0),k=u.default.Measure.getCaretOffset(c,d,m,S.a.preferLineStart),A=u.default.DisplaySettings.paddingForItemTop(c,e),w=u.default.DisplaySettings.paddingForItemBottom(c,e,d),L=u.default.DisplaySettings.lineHeightForItem(c,e,d),F=!e.isNote()&&k.line>f.line,C=e.shouldShowParents(c,d)?o.a.HeightAgendaParents:0,I=L+(0===f.line?A:0)+(f.line===r.lines.length-1?w:0),P=function(t,e,i,r,a){var n=a.refs.li,o=0;if(n){for(var u=0,s=n.getElementsByClassName("line"),h=0;h<t&&h<s.length;h++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;o+=s[h].getBoundingClientRect().height}0===o&&(o+=r)}return o}(f.line,0,0,C,t);if(f.lineOffset<f.lineLength||!F){var N=F||g?v-f.left:k.left-f.left,H=f.left<0?f.left:0,M={top:P,width:Math.min(N+H,v),height:I,marginLeft:Lt(c,d)};P+=I,M[h.a.transform.react]="translateX("+(f.left-H+n)+"px)",s.push(j.a.createElement("span",{key:"selStart",className:"textSelected textSelectedStart",style:M}))}if(F){var z=k.line-f.line,D=L+(k.line===r.lines.length-1?w:0),V=g?v:k.left;if(z>1){var G=L*(z-1),T={top:P,width:v,height:G};P+=G,T[h.a.transform.react]="translateX("+n+"px)",s.push(j.a.createElement("span",{key:"selMid",className:"textSelected textSelectedMid",style:T}))}var q={top:P,width:V,height:D};q[h.a.transform.react]="translateX("+n+"px)",s.push(j.a.createElement("span",{key:"selEnd",className:"textSelected textSelectedEnd",style:q}))}}return s},Pt=function(t,e,i){return u.default.DisplaySettings.paddingForItemTop(e,t)+(t.shouldShowParents(e,i)?o.a.HeightAgendaParents:0)},Nt=function(t){return t.overview||t.cell.paneObject.levelsDeep>0?u.default.DisplaySettings.itemIndentSize()-1:20},Ht={onMount:function(t,e,i,r,a){var n=r.pane,o=r.overview;t.listenTo(e.itemChanged),t.listenToDispatcher("numListChanged"),t.listenToDispatcher("EmailPreview","onClosed"),t.listenToDispatcher("EmailPreview","openThreadChanged"),n&&!o&&e.onLoad(n)},onUnmount:function(t){t.disposeDispatcherListeners()},onBeforeChanged:function(t,e,i){if(h.a.isMobile&&h.a.android)if(e.isEditable===i.isEditable||e.isEditable){if(e.isEditable===i.isEditable&&e.isEditable)return!1}else t.props.pane.onFinishedEditingAndroid()},onUpdate:function(t,e,i,r,a,n){if(h.a.isMobile&&r.isEditable&&n.lines!==r.lines)if(h.a.android)t.refs.androidInput.value=e.getParsedText();else for(var o=0,u=t.state.lines,s=t.refs.li.getElementsByClassName("line"),d=0;d<s.length;d++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;s[d].innerHTML=wt(u[d])}},getState:function(t,e,i,r){var n=r.pane,s=r.cell.paneObject,d=r.overview;if(n.isDestroyed())return{};var c=S.a.isSelected(i,n),v={flags:e.flags,levelsDeep:e.levelsDeep,styleProps:e.styleProps(s,n),isHovered:S.a.isReactCellHovered(t),showVerticalLines:!h.a.isMobile&&!d&&n.supportVertLines&&u.default.settings.ui.showVerticalLines.get(),isSelected:!d&&n===a.default.focusedPane&&_.a.isSelected(i,n),hasSelection:!!c,hasNote:e.hasNote(),isCollapsed:n.isPaneObjectCollapsed(s,d),isHighlighted:e.isHighlighted,dropBucketItems:h.a.isMobile&&!r.isInDragDrop&&n===a.default.focusedPane&&a.default.vmMain.dropBucket.getItems(),numListNumber:e.isPrefixNumList()&&e.numListNumber(),draggedInPane:e.draggedInPane,isSearchFocused:n.search.isFocused,isBeingDragged:e.draggedInPane.get()===n||h.a.isMobile&&n===a.default.focusedPane&&a.default.vmMain.dropBucket.hasItemEntry(e),isMatchStuckHiding:n.search.isMatchStuckHiding(e)};if(d){if(v.paneItem=n.item,v.lines=[e.getStyledTextAsOneLine(!1,!1)],n.type===o.a.PaneMode.Gmail){var y=u.default.pluginManager.getPluginGmail(),g=e.getParsedText(),l=y.getIconForLabel(e);l&&(v.lines[0]='<span class="labelText hasIcon"><i class="c-foreground-light icon-'+l+'"></i>'+g+"</span>")}h.a.isMobile||(v.isOverviewAtTop=n.getOverview().isItemAtTop(e),v.isOverviewDragHover=n.getOverview().isItemDragHovered(e)),v.isOverviewVisibleInPane=n.type===o.a.PaneMode.Task?n.getItem()!==n.getRootItem()&&n.isOverviewVisibleInPane(e):e===n.getItem(),v.isOverviewFocused=n.getItem()===e,v.isOverviewRoot=n.getRootItem()===e}else{var p=e.getAttachmentByPlugin(o.a.PluginID.Gmail);if(v.isEmailOpen=p&&(n.type===o.a.PaneMode.Gmail&&v.isSelected||p===u.default.EmailPreview.getThreadAttach()&&u.default.EmailPreview.isOpenOnPane(n)),e.isNote())v.lines=n.getStyledLinesForPaneObject(s,d,v.hasSelection);else{var m=n.getMetricsForPaneObject(s,d,v.hasSelection);v.lines=n.search.shouldHighlightSearch()&&m.searchHighlightedLines||m.styledLines}if(h.a.isMobile)h.a.isMobile&&(v.isEditable=e.isEditable,v.isMultiselected=v.isSelected&&At.isInMultiselect());else if(v.selected=v.selectedText=v.selectedStart=v.selectedEnd=void 0,c){var f=S.a.getSelectionAtIndex(i);!0===f?v.selected=!0:f.start!==f.end&&(v.selectedStart=f.start,v.selectedEnd=f.end)}else v.selectedText=void 0;e.isNote()&&(v.parentFlags=e.parent().flags,v.parentStyleProps=e.parent().styleProps(s,n))}return v.isHeader=n.isItemHeader(e,d),v},render:function(t,e,i,r,n,s,d,c,v){var y=n.pane,g=n.cell.paneObject,l=n.overview,p=!!(y.isWriteable&&h.a.isMobile&&s.isEditable)||null,m=y.getPaddingForPaneObject(g,l),f=a.default.classNames("item c-foreground",c,s.styleProps,{"c-border-light ":!l},{"c-background":!l&&!i.isNote()},{"overviewItem c-button-overview":l},{overviewAncestor:l&&s.isOverviewAncestor},{overviewFocused:l&&s.isOverviewFocused},{"c-background-overview-selected":l&&s.isOverviewVisibleInPane},{overviewRoot:l&&s.isOverviewRoot},{overviewAtTop:l&&s.isOverviewAtTop},{overviewDragHover:l&&s.isOverviewDragHover},{collapsed:s.isCollapsed},{itemBeingDragged:s.isBeingDragged},{faded:s.faded},{selected:h.a.isMobile&&s.isSelected&&s.isMultiselected},{"c-background-item-selected":!h.a.isMobile&&s.isEmailOpen},{editable:p},{highlighted:s.isHighlighted&&y!==a.default.focusedPane},{"c-bg-faded":!l&&s.isHovered},{firstItem:0===r},{hasSelection:s.hasSelection},{hasNote:s.hasNote},{hasPrefix:!!i.getPrefixLength()},{blockHeader:g.isBlockHeader},{"c-foreground-very-faded":g.isBlockHeader&&s.isCollapsed},{stuckMatch:s.isMatchStuckHiding},{checked:i.isComplete()},{swiping:!!v});if(l||(d=a.default.extend({fontSize:u.default.DisplaySettings.fontSizeForItem(g,i,y),lineHeight:u.default.DisplaySettings.lineHeightForItem(g,i,y)+"px",zIndex:s.draggingImage?1:void 0},d)),h.a.isMobile&&h.a.android&&p){var k={paddingLeft:m,height:d.height,paddingTop:u.default.DisplaySettings.paddingForItemTop(g,i),paddingRight:h.a.windowWidth()-y.maxWidthOfPaneObject(g)-m};return j.a.createElement("li",{"data-moo-id":e,className:f,style:d,ref:"li",contentEditable:p,suppressContentEditableWarning:!0},j.a.createElement("textarea",{className:"androidInput",ref:"androidInput",style:k,defaultValue:i.getParsedText(),onInput:y.onInputAndroid,onChange:a.default.emptyFn}))}return j.a.createElement("li",{"data-moo-id":e,className:f,style:d,ref:"li",contentEditable:p,suppressContentEditableWarning:!0},function(t,e,i,r,n){var s=r.lines,d=i.pane,c=i.overview,v=i.cell.paneObject,y=!c&&d.maxWidthOfPaneObject(v),g=[];try{a.default.PAssert(1744,s,"If an item is being rendered it must have styled lines")}catch(w){a.default.reportError(w)}if(s){var l=0;try{a.default.PAssert(1745,!isNaN(n),"Should always have a valid number for padding")}catch(w){a.default.reportError(w)}var p={width:y};h.a.isFirefox||i.padInsteadOfTransformLines?p.marginLeft=n:c?p.paddingLeft=n:p[h.a.transform.react]="translateX("+n+"px)",c||e.isNote()?s=[s[0]||o.a.TextSpace]:y<a.default.MinItemWidth&&(s=["..."]);for(var m=0;m<s.length;++m){if(l++>5e3&&__infLoop&&__infLoop(l))throw new RangeError;var f=s[m];if(f.isImage){var k=a.default.extend({paddingTop:!c&&(0===m?Pt(e,v,d):u.default.DisplaySettings.paddingForItemTop(v,e)),paddingBottom:!c&&u.default.DisplaySettings.paddingForItemBottom(v,e,d)},p);c?g.push(j.a.createElement("span",{className:"line",style:k,key:"line_"+m},f.originalText)):g.push(j.a.createElement(kt,{line:f,item:e,paneObject:v,pane:d,key:"line_"+m,style:k,isHovered:r.isHovered,hasSelection:r.hasSelection,onStartResize:Ft.bind(t),onEndResize:Ct.bind(t,f,e)}))}else{var A=a.default.classNames("line",{"c-bg-light":r.isBeingDragged},{first:0===m},{blockHeaderText:m===s.length-1&&v.isBlockHeader},{last:m===s.length-1}),S=a.default.extend({paddingTop:!c&&0===m&&Pt(e,v,d),paddingBottom:!c&&m===s.length-1&&u.default.DisplaySettings.paddingForItemBottom(v,e,d),height:!c&&u.default.DisplaySettings.lineHeightForItem(v,e,d)+"px",paddingLeft:Lt(v,d)},p);f=wt(f),!h.a.isMobile&&!i.overview&&d.isViewOutline()&&r.isHovered&&e.isPrefixHeader()&&!d.isSearchedFlat()&&m===s.length-1&&(f+='<span data-tooltip="Add new item to project" class="itemAddButton itemIgnoreText icon-add c-button" />'),!h.a.isMobile&&d.isViewProject()&&v.isBlockHeader&&m===s.length-1&&(f+='<span class="blockHeaderNumItems itemIgnoreText ns c-foreground-faded" data-num-items="'+v.block.items.length+'" />'),g.push(j.a.createElement("span",{className:A,key:"line_"+m,style:S,dangerouslySetInnerHTML:{__html:f}}))}}}return g}(t,i,n,s,m),function(t,e,i,r,a){if(e.hasPrefix()){var n=e.els[0],o=i.cell.paneObject,u=a-5,s={paddingTop:Pt(e,o,i.pane)};return h.a.isFirefox||i.padInsteadOfTransformLines||i.overview?s.marginLeft=u:s[h.a.transform.react]="translateX("+u+"px)",j.a.createElement("div",{className:n.getClassString(),style:s,"data-listnum":e.isPrefixNumList()?r.numListNumber:void 0})}}(0,i,n,s,m),function(t,e,i,r,a){var n=i.pane;if(!i.overview&&e.shouldShowParents(i.cell.paneObject,n)){var o=e.parents(n.getItem()),s=i.cell.paneObject,h=o.map(function(t,e){return t.generateTitleText()}).join(" > "),d={paddingTop:u.default.DisplaySettings.paddingForItemTop(s,e),marginLeft:a};return h&&j.a.createElement("div",{className:"itemParents c-foreground-very-faded",style:d,"data-tooltip":h},h)}}(0,i,n,0,m),function(t,e,i,r,a){if(r.showVerticalLines&&a>u.default.DisplaySettings.itemIndentStart()){var n=i.pane.extraPaddingForPaneObject(i.cell.paneObject),o=u.default.DisplaySettings.itemIndentStart()+n+6,s=a-o;if(s>0){var h={left:o,width:s};return j.a.createElement("div",{className:"vertLines",style:h})}}}(0,0,n,s,m),function(t,e,i,r,n){var o=i.pane,s=i.cell.paneObject,d=Nt(i);if(!i.overview&&o.supportMenuIcon&&r.isHovered&&!e.isNote()&&""!==e.getParsedText()&&(!o.isViewAgenda()||!o.shouldShowTime(i.cell.paneObject))){var c={width:n-5-(St(e,i,r)?d:0),paddingRight:d-20,height:u.default.DisplaySettings.lineHeightForItem(s,e,o)+"px",marginTop:Pt(e,s,o)+"px"},v=a.default.classNames("itemMenuIcon",{"c-foreground-super-faded c-color-hover":h.a.isMobile||!r.isEmailOpen},{"c-background-item-selected":!h.a.isMobile&&r.isEmailOpen}),y="<b>Drag</b> to move.<br><b>Click</b> to open menu.<br><b>"+h.a.priModKey+" + Click</b> to zoom in.";return j.a.createElement("div",{className:v,style:c,"data-tooltip":y},j.a.createElement("i",{className:"icon-drag-handle"}))}}(0,i,n,s,m),function(t,e,i,r,n){var o=i.overview,s=i.cell.paneObject,d=i.pane;if(r.isHovered&&""===e.getParsedText()&&!e.hasChildren()){var c=a.default.classNames("emptyItemAddButton icon-add c-background c-shadow-light"),v={marginLeft:1===r.levelsDeep?-4:-12};return v[h.a.transform.react]="translateX("+(n-24)+"px)",j.a.createElement("div",{className:c,style:v})}if(St(e,i,r)){var y=a.default.classNames("collapser c-foreground-super-faded c-color-hover",{"collapsed icon-angle-right":r.isCollapsed},{"icon-angle-down":!r.isCollapsed}),g={left:Math.max(n-5-Nt(i),0),lineHeight:!o&&u.default.DisplaySettings.lineHeightForItem(s,e,d)+"px",paddingTop:!o&&Pt(e,s,d)+"px"},l=(h.a.secModKey,"<b>Click</b> to "+(r.isCollapsed?"expand":"collapse")+" item.<br><b>Shift + Click</b> to "+(r.isCollapsed?"expand":"collapse")+" item recursively.<br><b>"+h.a.priModKey+" + Click</b> to zoom in.");return j.a.createElement("div",{className:y,style:g,"data-tooltip":l})}}(0,i,n,s,m),function(t,e,i){var r=i.pane,n=i.cell.paneObject,u=e.getMooDate();if(u&&!e.getRawText().includes(o.a.CharDate)&&!r.isViewDates()){var s=u.isRepeatDate(),h=u.toText(!0),d=a.default.classNames("itemTime c-date pointer"),c={paddingTop:Pt(e,n,r)+"px"};return j.a.createElement("div",{className:d,style:c},u.getGCalId()&&j.a.createElement("i",{className:"icon-calendar"}),s&&j.a.createElement("i",{className:"icon-spinner"}),h)}}(0,i,n),function(t,e,i,r){var n=i.overview,o=i.cell.paneObject,u=i.pane;if(!h.a.isMobile){var s,d,c={paddingTop:Pt(e,o,u)};return n||e.isNote()?n&&r.isHovered&&u.supportClickOverviewScroll&&r.isOverviewVisibleInPane&&!r.isOverviewFocused&&(s=a.default.classNames("itemCheckbox c-button","itemOverviewZoom","icon-unfold_less"),d="Scroll to item"):u.supportCheckbox&&r.isHovered?s=a.default.classNames("itemCheckbox c-button","icon-check",{checked:e.isComplete()}):u.isArchiveView&&(s=a.default.classNames("itemCheckbox c-button","itemUnarchive","icon-task"),d="Unarchive"),s&&j.a.createElement("div",{"data-tooltip":d,className:s,style:c})}}(0,i,n,s),l&&s.isHovered&&function(t,e,i,r){if(!h.a.isMobile)return j.a.createElement("div",{className:"overviewOptions icon-more_horiz c-button"})}(),!l&&y.isViewAgenda()&&function(t,e,i){var r=i.pane,n=i.cell.paneObject;if(r.shouldShowTime(n)){var o=r.getItemDisplayTime(n),u=o.indexOf("<div")>=0,s=a.default.classNames("agendaTime cursor-grab",{twoLines:u},{allDay:"All day"===o},{hasParents:e.shouldShowParents(i.cell.paneObject,r)}),h={paddingTop:Pt(e,n,r)+"px"};return j.a.createElement("div",{className:s,style:h,dangerouslySetInnerHTML:{__html:o}})}}(0,i,n),!l&&(s.selected||void 0!==s.selectedStart)&&It(t,i,n,s,m),v)}},Mt={onMount:function(t,e,i,r){t.listenTo(r.pane.dragHoveredBlock)},getState:function(t,e,i,r){return{isHovered:r.cell.paneObject.block===r.pane.dragHoveredBlock.get()}},onClickNewProject:function(t,e){var i=e.pane,r=i.getItem().numItems(),a=i.addItemToPane({text:o.a.Prefix.Header+" "},r),n=i.indexOfItem(a);S.a.selectIndex(n,0)},render:function(t,e,i,r,n,o,s,d){var c,v=i.block,y=v.isCollapsed(),g=a.default.classNames(d,"blockHeader noItem c-border-light flexbox",{blockHeaderDate:v.isDate},{"c-tag":n.pane.isViewTag()},{"c-contact":n.pane.isViewContact()},{agendaBlockRed:!y&&v.isOverdue},{dragHovered:o.isHovered},{"collapsed c-foreground-very-faded":y},{firstBlock:0===r}),l=a.default.classNames("blockCollapser c-foreground-super-faded",{"icon-angle-down":!y&&!v.isNewProject},{"icon-angle-right":y&&!v.isNewProject}),p={paddingBottom:u.default.DisplaySettings.paddingForBlockHeader()},m=j.a.createElement("span",{className:"blockHeaderNumItems c-foreground-faded"},v.numItems());if(v.isDate){var f,k=v.date,A=Date.today(),S=k.isToday()?"Today":k.isSameDay((new Date).clearTime().addDays(1))?"Tomorrow":k.toString("dddd"),w=a.default.classNames("blockHeaderText blockHeaderDayName f1 ib",{"c-foreground-light":!y});k.getMonth()===A.getMonth()&&k.getYear()===A.getYear()||(f=k.toString("MMMM"),w+=" diffMonth"),k.getYear()!==A.getYear()&&(f+=", "+k.toString("yyyy")),c=j.a.createElement(j.a.Fragment,null,j.a.createElement("span",{className:"blockHeaderDateNum"},k.getDate()),j.a.createElement("span",{className:w,style:p},S&&j.a.createElement("div",null,S,m),f&&j.a.createElement("div",{className:"blockHeaderMonth"},f)))}else if(v.isNewProject)c=j.a.createElement("span",{className:"blockHeaderText pointer f1 c-foreground-very-faded",style:p,onClick:this.onClickNewProject.bind(this,t,n)},"New project");else{var L=v.isStarred&&j.a.createElement("i",{className:"icon-star"})||v.isImportant&&j.a.createElement("i",null,"!");c=j.a.createElement("span",{className:"blockHeaderText f1",style:p},L,v.text,m)}return h.a.isMobile?j.a.createElement(O.a,{ref:"li","data-moo-id":e,className:g,style:s,onClick:v.toggleCollapsed},j.a.createElement("span",{className:l}),c):j.a.createElement("li",{ref:"li","data-moo-id":e,className:g,style:s},j.a.createElement("span",{className:l,onClick:v.toggleCollapsed}),c)}},zt={render:function(t,e,i,r,n,o,u){var s=a.default.classNames("hr c-border-heavy",n.className);return j.a.createElement("li",{"data-moo-id":e,className:s,style:u},i.text)}},Dt={onClick:function(t,e){var i=e.block;i.addFn(i)},render:function(t,e,i,r,n,o,u,s){s=a.default.classNames(s,"taskAddButton");var d=i.block,c=a.default.classNames(h.a.isMobile?"c-foreground-faded":"c-foreground-ultra-faded");return j.a.createElement("li",{ref:"li","data-moo-id":e,className:s,style:u},!d.noAddButton&&j.a.createElement(O.a,{className:c,onClick:this.onClick.bind(this,t,i,r)},j.a.createElement("i",{className:"icon-add"}),"Add item"))}},Vt=i(57),Gt=i(93),Tt=B.b.createClass({displayName:"ReactMonthDay",componentDisplay:o.a.ComponentDisplay.Desktop,init:function(){p.a.listen("endDrag",this.onDragEnd),this.createObservables({isHovered:!1}),this.listenToDispatcher("dateChanged")},arePropsEqual:function(t,e,i){return"items"===t?e===i||e&&i&&e.length===i.length:"date"===t?e===i||e&&i&&e.equals(i):void 0},areStatesEqual:function(t,e,i){if("items"===t){var r=0;if(!e||!i||e.length!==i.length)return!1;for(var a=0;a<e.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(e[a].time!==i[a].time||e[a].item!==i[a].item)return!1}return!0}},componentWillReceiveProps:function(t){t.items!==this.props.items&&this.updateState(t)},getState:function(t){var e={};if(t.items){for(var i=0,r=[],a=[],n=0;n<t.items.length;n++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;var s=t.items[n];if(!s.isNote()){var h=s.getNextDate(this.props.date),d=h.hasTimeOfDay()&&h.toString(u.default.International.getFormat(o.a.DFormat.ShortTime));d?a.push({time:d,item:s}):r.push({item:s})}}e.items=r.concat(a)}return e},onMouseDown:function(t){t.preventDefault()},onMouseEnter:function(){if(u.default.DragDrop.isDragging){this.isHovered.set(!0);var t=u.default.DragDrop.dragItem.getDate();u.default.DragDrop.setBlockTarget({date:this.props.date,dateTime:t&&t.hasTimeOfDay()&&t,isDate:!0})}},onDragEnd:function(){this.isHovered.set(!1)},onMouseLeave:function(){this.isHovered.set(!1)},onDoubleClick:function(t){var e=this.props,i=e.pane,r=e.date,a=i.item.get(),n=new Vt.a(r,{duration:o.a.DefaultEventDuration});i.openItemEditor({element:t.target,text:" "+o.a.CharDate,parent:a,selectIndex:0,mooDate:n,pos:{top:t.clientY},showCalendarButtons:!0,addOnSave:!0})},render:function(){var t,e=this.props,i=this.state,r=e.date,n=0===r.getDay()||6===r.getDay(),u=r.getDate(),s=Date.getDaysInMonth(r.getFullYear(),r.getMonth()),h=a.default.classNames("dateBlock c-border",{firstDay:1===r.getDate()},{lastDay:r.getDate()===s},{"weekend c-bg-faded":n},{"c-background":!n},{hoveredInDrag:i.isHovered},{today:r.isToday()}),d={left:e.left-1,width:e.width+1},c=a.default.classNames("dateBlockDay");if(i.items){for(var v=0,y=0,g=[],l=!1,p=0;p<i.items.length;p++){if(v++>5e3&&__infLoop&&__infLoop(v))throw new RangeError;var m=i.items[p];m.time&&m.item.hasAttachmentType(o.a.PluginType.Calendar)&&(l=!0)}for(var f=0;f<i.items.length;f++){if(y++>5e3&&__infLoop&&__infLoop(y))throw new RangeError;var k=i.items[f],A=k.time,S=k.item,w=l&&A,L=a.default.classNames("dateBlockItem flexbox",{hasCircle:w}),F=null;if(w){var C={background:S.hasAttachmentType(o.a.PluginType.Calendar)&&S.getCalendarColor()};F=j.a.createElement("div",{className:"monthItemColorCircle",style:C})}g.push(j.a.createElement("div",{className:L,key:S.id},F,j.a.createElement(Gt.a,{className:"itemInCalendar",item:S,pane:e.pane,coloredInCalendar:!A&&S.getCalendarColor(),showPriority:!0,allowDrag:!0,editOnClick:!0}),A&&e.width>100&&j.a.createElement("span",{className:"itemTime"},A)))}t=(e.items||i.isHovered)&&j.a.createElement("div",{className:"dateBlockItems"},g)}return j.a.createElement("div",{className:h,style:d,onMouseDown:this.onMouseDown,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onDoubleClick:this.onDoubleClick},j.a.createElement("div",{className:c},u),t)}}),qt={getState:function(t,e,i,r){return{paneRect:r.pane.rect}},render:function(t,e,i,r,n,o,u){var s,h=0,d=n.pane,c=a.default.classNames("calendarWeek c-bg-app","flexbox",n.className),v=d.getWidth()+1,y=Math.floor(v/7),g=v-7*y,l=0,p=0;g>0&&(l=Math.ceil(g/2),p=g-l),u.height+=1;for(var m=0;m<i.dates.length;m++){if(h++>5e3&&__infLoop&&__infLoop(h))throw new RangeError;var f=i.dates[m];f&&1===(f=f.date).getDate()&&(s=f.toString("MMMM"),f.getYear()!==Date.today().getYear()&&(s+=f.toString(" yyyy")))}return j.a.createElement("li",{"data-moo-id":e,className:c,style:u},i.dates.map(function(t,e){var i=y+(0===e?l:0)+(6===e?p:0);return j.a.createElement(Tt,{key:t.date.getTime(),pane:d,date:t.date,items:t.items,index:e,left:e*y+(e>0?l:0),width:i})}),s&&j.a.createElement("div",{className:"calendarMonthTitle c-bg-app"},s))}},jt=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"init",value:function(){this.createObservables({hoveredTime:void 0,hoveredDuration:void 0,isResizing:!1}),this.listenToDispatcher("dateChanged"),this.listenToDispatcher("endDrag")}},{key:"arePropsEqual",value:function(t,e,i){return"items"===t?e===i||e&&i&&e.length===i.length:"date"===t?e===i||e&&i&&e.equals(i):void 0}},{key:"areStatesEqual",value:function(t,e,i){if("items"===t){var r=0;if(!e||!i||e.length!==i.length)return!1;for(var a=0;a<e.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;if(!e[a].date||!i[a].date||!e[a].date.equals(i[a].date)||e[a].item!==i[a].item||e[a].duration!==i[a].duration)return!1}return!0}}},{key:"componentWillReceiveProps",value:function(t){t.date.equals(this.props.date)&&t.items===this.props.items||this.updateState(t)}},{key:"getState",value:function(t){var e=t.date.isToday(),i={isToday:e,todayTime:e&&new Date,numAllDay:t.pane.numAllDay};if(i.heightHeader=t.pane.getHeightAllDay(),t.items){var r=0;i.items=[];for(var a=0;a<t.items.length;a++){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var n=t.items[a];if(!n.isNote()){var o=n.getNextDate(this.props.date);i.items.push({date:o,duration:n.getDuration(),item:n})}}}return i}},{key:"onMount",value:function(){this.state.isToday&&this.runTimeTimer()}},{key:"onUnmount",value:function(){clearTimeout(this.timeTimeout)}},{key:"componentDidUpdate",value:function(t){this.props.date.equals(t.date)||(this.hoveredDuration.set(void 0,!1),this.hoveredTime.set(void 0))}},{key:"onBeforeChanged",value:function(t,e){return t.isToday?this.runTimeTimer():e.isToday&&!t.isToday&&clearTimeout(this.timeTimeout),!e.hoveredTime||u.default.DragDrop.isDragging||this.resizing||(this.hoveredTime.set(void 0,!1),this.hoveredDuration.set(void 0,!1),t.hoveredTime=void 0,t.hoveredDuration=void 0),t}},{key:"runTimeTimer",value:function(){clearTimeout(this.timeTimeout),this.timeTimeout=setTimeout(this.updateState,3e5)}},{key:"resetHovered",value:function(){this.resizing&&(this.resizing.component&&this.resizing.component.stopResizing(),this.resizing=void 0,this.isResizing.set(!1)),this.mouseDownAtTime=void 0,this.hoveredDuration.set(void 0,!1),this.hoveredTime.set(void 0)}},{key:"onMouseUp",value:function(t){document.removeEventListener("mouseup",this.onMouseUp),this.resizing&&this.resizing.placeholder?this.addTime(this.hoveredTime.get(),this.hoveredDuration.get(),t):this.resetHovered()}},{key:"onMouseLeave",value:function(){this.resizing||this.resetHovered()}},{key:"getTimeFromMouseEvent",value:function(t){var e=t.clientY;return u.default.DragDrop.isDragging&&u.default.DragDrop.startPane&&u.default.DragDrop.startPane.isViewDates()&&u.default.DragDrop.startInfo&&(e+=12-(u.default.DragDrop.startInfo.y-u.default.DragDrop.position.top)),e-=a.default.findParent(t.target,"calendarDayTimes").getBoundingClientRect().top,Math.floor(e/(o.a.CalendarDayViewBlockHeight+1)*4)/4}},{key:"onMouseDown",value:function(t){document.addEventListener("mouseup",this.onMouseUp),a.default.hasClass(t.target,"calendarDayTimes")&&(this.mouseDownAtTime=this.getTimeFromMouseEvent(t)),t.preventDefault()}},{key:"onMouseMove",value:function(t){if(void 0!==this.mouseDownAtTime&&(this.resizing={placeholder:!0,pivot:this.mouseDownAtTime},this.mouseDownAtTime=void 0),u.default.DragDrop.isDragging){var e=this.getTimeFromMouseEvent(t);if(!isNaN(e)){var i=1,r=u.default.DragDrop.dragItem;r&&r.getDuration()&&(i=r.getDuration()/o.a.MSPerHour),this.hoveredDuration.set(i,!1),this.hoveredTime.set(e),(d=this.props.date.clone()).setHours(Math.floor(e)),d.setMinutes(60*(e-Math.floor(e))),u.default.DragDrop.setBlockTarget({date:d,dateTime:d,duration:1!==i?i*o.a.MSPerHour:null,isDate:!0})}}else if(this.resizing){e=this.getTimeFromMouseEvent(t);if(!isNaN(e)){var a=this.resizing,n=a.pivot,s=e>=n?n:e,h=Math.floor(4*(e>=n?e-n+.5:n-e))/4;if(!isNaN(s)&&h>=.25)if(a.item){var d,c={isDate:!0};(d=this.props.date.clone()).setHours(Math.floor(s)),d.setMinutes(Math.round(60*(s-Math.floor(s)))),c.duration=h*o.a.MSPerHour,c.date=c.dateTime=d,u.default.PaneUpdateBatcher.beginUpdateItems();var v=this.props.pane;v.applyDropOnBlock(c,a.item,v),u.default.PaneUpdateBatcher.commitUpdateItems()}else a.placeholder&&(h===this.hoveredDuration.get()&&s===this.hoveredTime.get()||(this.hoveredDuration.set(h,!1),this.hoveredTime.set(s,!0)))}}}},{key:"onMouseEnterAllDay",value:function(){if(u.default.DragDrop.isDragging){var t=this.props.date;this.hoveredDuration.set(1,!1),this.hoveredTime.set(-1),u.default.DragDrop.setBlockTarget({date:t,isDate:!0,allDay:!0})}}},{key:"onDoubleClickTimes",value:function(t){var e=this.getTimeFromMouseEvent(t);this.addTime(e,1,t)}},{key:"addTime",value:function(t,e,i){var r=this.props,a=r.pane,n=r.date,u=a.item.get();t&&(n=n.addHours(t));var s=new Vt.a(n,{duration:e*o.a.MSPerHour});a.openItemEditor({element:i.target,text:" "+o.a.CharDate,parent:u,selectIndex:0,mooDate:s,pos:{left:i.clientX,top:i.clientY},addOnSave:!0,onClosed:this.resetHovered})}},{key:"onItemResizeStart",value:function(t,e,i){if(t.hasTime()){var r=t.getTimeOfDay(),n=t.getDuration()/o.a.MSPerHour||1,u=a.default.round(r/o.a.MSPerHour,4),s=i?u:u+n;return this.resizing={item:t,component:e,pivot:s},this.isResizing.set(!0),!0}}},{key:"addToDay",value:function(t,e,i,r){t.push({t:e,dur:i,item:r,top:e,bottom:e+i,obj:r})}},{key:"packItems",value:function(t){var e=0;t=t.sort(function(t,e){return t.top<e.top?-1:t.top>e.top?1:t.bottom<e.bottom?-1:t.bottom>e.bottom?1:0});for(var i=[],r=[],a=null,n=0;n<t.length;n++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var o=t[n];if(o.isPlaceholder)r=r.concat.apply(r,this.packEvents([[o]]));else{var u=0;null!==a&&o.top>=a&&(this.packEvents(i),r=r.concat.apply(r,i),i=[],a=null);for(var s=!1,h=0;h<i.length;h++){if(u++>5e3&&__infLoop&&__infLoop(u))throw new RangeError;var d=i[h];if(!this.collidesWith(d[d.length-1],o)){d.push(o),s=!0;break}}s||i.push([o]),(null===a||o.bottom>a)&&(a=o.bottom)}}return i.length>0&&(this.packEvents(i),r=r.concat.apply(r,i)),r}},{key:"packEvents",value:function(t){for(var e=0,i=t.length,r=0;r<i;r++){var a=0;if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;for(var n=t[r],o=0;o<n.length;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var u=n[o],s=this.expandEvent(u,r,t);u.pos=r/i*100,u.width=100*s/i}}return t}},{key:"collidesWith",value:function(t,e){return t.bottom>e.top&&t.top<e.bottom}},{key:"expandEvent",value:function(t,e,i){for(var r=0,a=1,n=e+1;n<i.length;n++){var o=0;if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;for(var u=i[n],s=0;s<u.length;s++){if(o++>5e3&&__infLoop&&__infLoop(o))throw new RangeError;var h=u[s];if(this.collidesWith(t,h))return a}a++}return a}},{key:"renderItems",value:function(){var t,e=0,i=this.props,r=this.state,n=r.items,u=[],s=r.hoveredTime,h=r.hoveredDuration;for(t=0;t<n.length;t++){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var d=n[t].item,c=i.pane.getItemPlacementOnDate(d,i.date);c&&this.addToDay(u,c.time,c.duration,d)}isNaN(s)||isNaN(h)||u.push({t:s,dur:h,top:s,bottom:s+h,isPlaceholder:!0});var v,y=this.packItems(u);if(y.length){var g=0;for(v=[],t=0;t<y.length;t++){if(g++>5e3&&__infLoop&&__infLoop(g))throw new RangeError;var l=y[t],p=l.isPlaceholder,m=this.props.pane,f={height:l.dur*o.a.CalendarDayViewBlockHeight+Math.ceil(l.dur)-1,left:p?0:l.pos+"%",width:p?"95%":l.width+"%",top:Math.floor(l.t*(o.a.CalendarDayViewBlockHeight+1))},k=a.default.classNames("dayTimeBlock abs",{placeholder:p});v.push(j.a.createElement("div",{className:k,key:p?"placeholder":l.item.id,style:f},l.item&&j.a.createElement(Gt.a,{className:"itemInCalendar itemInCalendarResizable",item:l.item,pane:m,coloredInCalendar:!0,showPriority:!0,resizable:!0,allowDrag:!0,onItemResizeStart:this.onItemResizeStart,editOnClick:!0})))}}return v}},{key:"renderItemsAllDay",value:function(){for(var t=0,e=this.props,i=this.state,r=i.items,a=e.pane,n=[],o=i.hoveredTime,u={},s=0;s<r.length;s++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var h=r[s].item;e.pane.getItemPlacementOnDate(h,e.date)||n.push(j.a.createElement("div",{className:"dayTimeBlock",key:h.id,style:u},j.a.createElement(Gt.a,{className:"itemInCalendar",item:h,pane:a,coloredInCalendar:!0,showPriority:!0,resizable:!0,allowDrag:!0,onItemResizeStart:this.onItemResizeStart,editOnClick:!0})))}return!isNaN(o)&&o<0&&n.push(j.a.createElement("div",{className:"dayTimeBlock placeholder",key:"placeholder"})),n}},{key:"render",value:function(){var t,e,i,r,n,u,s=this.props,d=this.state,c=(s.pane,s.date),v=0===c.getDay()||6===c.getDay(),y=this.renderItemsAllDay();if(d.isToday){var g=d.todayTime,l={top:Math.floor((g.getHours()+g.getMinutes()/60)*(o.a.CalendarDayViewBlockHeight+1))};u=j.a.createElement("div",{className:"calendarDayTimeLine",style:l})}t={width:s.width},e={top:d.heightHeader+30+3,height:s.height-d.heightHeader,width:s.width},i={height:d.heightHeader,minHeight:d.heightHeader},t[h.a.transform.react]=e[h.a.transform.react]=s.transform;var p=a.default.classNames("allDay c-border-heavy f1 preventScrollPropagate",{"c-bg-faded weekend":v}),m=a.default.classNames("calendarDayTimes c-border-heavy",{"c-bg-faded":v});r=j.a.createElement("ul",{className:p,style:i,onMouseEnter:this.onMouseEnterAllDay,onDoubleClick:this.addTime.bind(this,void 0,void 0),onMouseLeave:this.onMouseLeave},y),n=j.a.createElement("div",{className:m,style:e,onMouseDown:this.onMouseDown,onMouseMove:this.onMouseMove,onDoubleClick:this.onDoubleClickTimes,onMouseLeave:this.onMouseLeave},j.a.createElement("div",{className:"calendarDayGradient"}),j.a.createElement("div",{className:"calendarDayItems"},this.renderItems()),u);var f,k={className:a.default.classNames("calendarDay",{"weekend c-bg-faded":v},{today:d.isToday},{resizing:d.isResizing},s.className),"data-moo-id":s["data-moo-id"]};return c.getYear()!==Date.today().getYear()&&(f=c.toString(", yyyy")),j.a.createElement(s.component,k,j.a.createElement("div",{className:"calendarDayHeader c-background c-border-heavy flexbox flexvert",style:t},j.a.createElement("div",{className:"dayTitle"},j.a.createElement("span",null,c.toString("ddd MMM ")),j.a.createElement("span",{className:"dayTitleDay"},c.getDate()),f&&j.a.createElement("span",null,f)),r),n)}}]),e}(B.a),Yt={getState:function(t,e,i,r){return{numAllDay:r.pane.numAllDay}},render:function(t,e,i,r,n,o,u){var s=n.pane,d=a.default.classNames("calendarDay",n.className);return j.a.createElement(jt,{"data-moo-id":e,component:"li",className:d,date:i.date,items:i.items,pane:s,height:u.height,transform:u[h.a.transform.react],width:s.getDayWidth()})}},Xt=B.b.createClass({displayName:"ReactCell",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){this.DISABLE_LISTENER_ASSERT=!0,this.allowTransition=this.props.pane.supportCellTransition&&this.props.cell.isLive,this.createObservables({isHoveredLong:!1}),this.props.list.listen("reMount",this.reMount)},areStatesEqual:function(t,e,i){var r=this.props.cell.isLive&&this._getRenderer();if(r&&r.areStatesEqual)return r.areStatesEqual(t,e,i)},getState:function(t){var e,i=t.cell,r=i.paneObject,n=r;i.isLive&&(e=this._getRenderer(),n=this._getRenderObj());var o={isLive:i.isLive,item:n,id:r&&r.id,index:i.index,height:i.height,offset:i.offset,prevOffset:i.prevOffset,renderer:e,offsetX:i.offsetX,isAnimatingOffsetX:i.isAnimatingOffsetX,faded:!1};return i.isLive&&e&&e.getState&&(o=a.default.extend(o,e.getState(this,n,i.index,this.props))),o},onMount:function(){this.listenTo(this.props.cell.cellChanged,!1),this._onMount()},onBeforeChanged:function(t,e){var i=this;if(this.allowTransition=this.props.pane.supportCellTransition&&t.isLive&&this.props.cell.wasLive,h.a.isMobile&&h.a.android){if(t.renderer&&t.renderer===e.renderer&&t.renderer.onBeforeChanged)return t.renderer.onBeforeChanged(this,t,e)}else h.a.isMobile||this.props.pane.isViewDates()&&t.isHovered!==e.isHovered&&(t.isHovered?setTimeout(function(){i.state.isHovered&&i.isHoveredLong.set(!0)},o.a.TooltipDelay):(this.isHoveredLong.set(!1,!1),t.isHoveredLong=!1))},componentDidUpdate:function(t,e){var i=this.state.item,r=e.item,a=this.state.renderer;a!==e.renderer&&e.renderer&&e.renderer.onUnmount&&e.renderer.onUnmount(this,r),i!==r&&(this.needsRefresh={prevState:e},this.props.list.isDelayingMounts||this.reMount()),a&&a.onUpdate&&a.onUpdate(this,i,this.props,this.state,t,e)},_onMount:function(){var t=this.state.item,e=this.state.renderer;t&&e&&e.onMount&&e.onMount(this,t,this.state.index,this.props,this.state)},onUnmount:function(){var t=this.state.item,e=this.state.renderer;t&&e&&e.onUnmount&&e.onUnmount(this,t,this.state.index,this.props,this.state)},reMount:function(){if(this.needsRefresh){var t=this.needsRefresh.prevState,e=t.item;this.refreshListeners(),e&&t.renderer&&t.renderer.onUnmount&&t.renderer.onUnmount(this,e),this._onMount(),this.needsRefresh=void 0}},_getRenderer:function(){var t,e=this.props.cell.paneObject;return a.default.isVMLI(e)?t=Ht:"blockItem"===e.type?t=Ht:"blockHeader"===e.type?t=Mt:"hr"===e.type?t=zt:"calendarWeek"===e.type?t=qt:"calendarDay"===e.type?t=Yt:"blockAddItem"===e.type&&(t=Dt),t},_getRenderObj:function(){var t=this.props.cell.paneObject;return"blockItem"===t.type?t.item:t},_getCellState:function(){var t=this.state,e={cell:this.props.cell.getState(),reactCell:{item:t.item.id,index:t.index,height:t.height,offset:t.offset,prevOffset:t.prevOffset,isLive:t.isLive}};return this.refs.li&&(e.element=a.default.getElementPath(this.refs.li)),e},getIndex:function(){try{a.default.PAssert(1619,this.state.isLive,"Should never get the index of a dead cell",this.state.isLive?void 0:this._getCellState())}catch(t){a.default.reportError(t)}return this.state.index},getItem:function(){try{a.default.PAssert(1620,this.state.isLive,"Should never get the index of a dead cell",this.state.isLive?void 0:this._getCellState())}catch(t){a.default.reportError(t)}return this.state.item},getCell:function(){return this.props.cell},getPaneObject:function(){return this.props.cell.paneObject},renderSwipeMenu:function(t,e,i){var r=this.props.pane,n={left:(i>0?"-":"")+"100%"},o={},u=r.sizeOfItem(t,e),s=r.getSwipeMenuItem(t,i);if(s){o[i>0?"right":"left"]=16;var h=a.default.isFunction(s.icon)?s.icon(t):s.icon,d=a.default.isFunction(s.color)?s.color(t):s.color,c=a.default.isFunction(s.text)?s.text(t):s.text;n.background=d,u<44&&(n.height=44,n.marginTop=-(44-u)/2);var v={float:i<0?"right":"left",padding:i<0?"0 0 0 16px":"0 16px 0 0"};return j.a.createElement("div",{className:"itemSwipeMenu",style:n},h&&j.a.createElement("div",{className:"itemSwipeIcon",style:o},j.a.createElement("i",{className:h}),j.a.createElement("span",{style:v},c)))}},onClick:function(){},render:function(){var t=this.props,e=this.state,i=e.isLive?e.offset:-1e3,r=this.getUniqueID(),n=e.renderer,u=a.default.getItemAnimationMode(),s={height:e.height},d=a.default.classNames("cell",{transition:this.allowTransition&&u!==o.a.ItemAnimationMode.None});if(e.offsetX?s[h.a.transform.react]="translate3d("+e.offsetX+"px,"+i+"px,0)":(e.isAnimatingOffsetX&&(s[h.a.transition.react]=h.a.transform.style+" 0.15s"),t.orientation===o.a.Orientation.Horizontal?s[h.a.transform.react]="translate("+i+"px,0)":s[h.a.transform.react]="translate(0,"+i+"px)"),n&&e.isLive){var c=!!e.offsetX;return n.render(this,r,e.item,e.index,t,e,s,d,c&&this.renderSwipeMenu(e.item,e.index,e.offsetX))}return j.a.createElement("li",{"data-moo-id":r,className:"itemdead",style:s})}}),Qt=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"getState",value:function(t){return{text:t.toast.text}}},{key:"componentWillReceiveProps",value:function(t){this.updateState(t)}},{key:"render",value:function(){var t=this.props.toast,e=this.state.text,i=a.default.classNames("toast noSelect",{hasAction:!!t.actionText},{big:t.isBig});return j.a.createElement("div",{className:i,onClick:t.onTapIgnore},j.a.createElement(at.a,{width:40,height:40,icon:"icon-close",className:"messageClose",onClick:t.onTapIgnore&&t.onTapIgnore}),j.a.createElement("span",{className:"messageText f1",dangerouslySetInnerHTML:{__html:e}}),j.a.createElement(at.a,{primary:!0,className:"messageAction",onClick:t.doAction.bind(t)},t.actionText))}}]),e}(B.a),Jt=B.b.createClass({displayName:"ReactFormattingToolbar",componentDisplay:o.a.ComponentDisplay.Desktop,init:function(){},getState:function(){return{showFormattingToolbar:u.default.settings.showFormattingToolbar,position:S.a.itemHighlightPosition,pane:S.a.getPane(),numSelected:S.a.getSelectedItems().length,isCollapsed:0===u.default.settings.showFormattingToolbar.get()}},onClickFormat:function(t){a.default.vmMain.applyFormatToSelection(t)},onClickPrefix:function(t){a.default.vmMain.applyPrefixToSelection(t)},onClickNote:function(){var t=S.a.getStartItem();t&&S.a.editNote(t)},onClickLink:function(){S.a.getStartItem().insertLinkAtSelection()},onClickToggleShow:function(){var t=u.default.settings.showFormattingToolbar.get();t=0===t?1:0,u.default.settings.showFormattingToolbar.set(t)},render:function(){var t=this.state,e=this.props,i=t.position,r=t.position&&t.pane===e.pane,a=t.isCollapsed;if(r){var n=a?24:32,u=a?24:36,s=a?24:329,d=Math.min(Math.max(Math.floor(i.x),s/2+4),t.pane.getWidth()-s/2-4),c={height:u,width:s,marginLeft:-s/2,marginTop:-u-4};return c[h.a.transform.react]="translate3d("+d+"px,"+Math.floor(i.y)+"px,0)",a?j.a.createElement("div",{className:"formattingToolbar collapsed c-popup c-bg-sidebar c-shadow-popup",style:c},j.a.createElement(at.a,{icon:"icon-more_horiz",width:s,height:s,iconSize:14,tooltip:"Show formatting toolbar",onClick:this.onClickToggleShow})):j.a.createElement("div",{className:"formattingToolbar c-popup c-bg-sidebar c-shadow-popup",style:c},j.a.createElement(at.a,{icon:"icon-format_bold",width:n,height:u,iconSize:19,onClick:this.onClickFormat.bind(this,"**"),tooltip:"Bold",tooltipHotkey:{name:"Bold"}}),j.a.createElement(at.a,{icon:"icon-format_italic",width:n,height:u,iconSize:19,onClick:this.onClickFormat.bind(this,"*"),tooltip:"Italic",tooltipHotkey:{name:"Italic"}}),j.a.createElement(at.a,{icon:"icon-format_underlined",width:n,height:u,iconSize:18,onClick:this.onClickFormat.bind(this,"__"),tooltip:"Underline",tooltipHotkey:{name:"Underline"}}),j.a.createElement("div",{className:"divider"}),j.a.createElement(at.a,{icon:"icon-project",width:n,height:u,iconSize:18,onClick:this.onClickPrefix.bind(this,o.a.Prefix.Header),tooltip:"Project",tooltipHotkey:o.a.Prefix.Header+"&nbsp;&nbsp; Space"}),j.a.createElement(at.a,{icon:"prefixTask",width:n,height:u,iconSize:20,onClick:this.onClickPrefix.bind(this,o.a.Prefix.Task),tooltip:"Task",tooltipHotkey:o.a.Prefix.Task+"&nbsp;&nbsp; Space"}),j.a.createElement(at.a,{icon:"icon-bullet",width:n,height:u,iconSize:22,onClick:this.onClickPrefix.bind(this,o.a.Prefix.Bullet),tooltip:"Bulleted list",tooltipHotkey:o.a.Prefix.Bullet+"&nbsp;&nbsp; Space"}),j.a.createElement(at.a,{icon:"icon-numlist",width:n,height:u,iconSize:14,onClick:this.onClickPrefix.bind(this,o.a.Prefix.NumList),tooltip:"Numbered list",tooltipHotkey:o.a.Prefix.NumList+"&nbsp;&nbsp; Space"}),j.a.createElement("div",{className:"divider"}),j.a.createElement(at.a,{icon:"icon-link",enabled:1===t.numSelected,width:n,height:u,iconSize:18,onClick:this.onClickLink,tooltip:"Create link",tooltipHotkey:{name:"InsertLink"}}),j.a.createElement(at.a,{icon:"icon-sticky-note-o",enabled:1===t.numSelected,width:n,height:u,iconSize:14,onClick:this.onClickNote,tooltip:"Add note",tooltipHotkey:{name:"EditNote"}}),j.a.createElement("div",{className:"divider"}),j.a.createElement(at.a,{icon:"icon-minus",width:n,height:u,iconSize:10,tooltip:"Hide formatting toolbar",onClick:this.onClickToggleShow}))}return null}}),Zt=i(78);if(h.a.isMobile)var Bt=i(44).default;var $t=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"init",value:function(){this.createObservables({dragOffset:0,isDragging:!1})}},{key:"onMount",value:function(){var t=this.props.pane,e=t.scrollElement=this.refs.scroller.getScrollElement(),i=t.rootElement=this.refs.rootElement,r=t.paneContent=this.refs.contentElement.getElement(),n=t.getInfiniteList(!1);t.element=this.refs.pane,n.setupScroller(e,r),h.a.isMobile||n.setScrollHandler(this.onScroll),i.addEventListener("compositionstart",t.compositionStart),i.addEventListener("compositionend",t.compositionEnd),h.a.android||i.addEventListener("input",t.onInput),a.default.setupClick(e,t,{onStart:t.onTapStart,onMove:t.onTapMove,onClick:t.onTapClick,onEnd:t.onTapEnd,onDoubleClick:t.onTapDoubleClick,onRightClick:t.onTapRightClick}),t.onLoad(),t.getOverview().onPaneLoad(),p.a.fireEvent("paneAdded",[t])}},{key:"getState",value:function(){var t,e=this.props.pane;return e.isDestroyed()?t={}:(t={rect:e.rect,left:e.getLeft(),isExpanded:!h.a.isMobile&&e.isExpanded,isActive:e.isActive,isOverviewVisible:e.overview.isVisible,isHelpVisible:!!u.default.intro&&u.default.intro.isVisible,item:e.item,paneTopText:e.paneTopText,orientation:e.orientation,titles:e.getTitleList(),showScrollbars:e.showScrollbars,toast:e.toast,_showFormattingToolbar:u.default.settings.showFormattingToolbar,showFormattingToolbar:u.default.settings.showFormattingToolbar.get()>0},h.a.isMobile?t.bottomBarHeight=Bt.bottomBarHeight:t.parents=e.getItem().parents()),t}},{key:"getPane",value:function(){return this.props.pane}},{key:"itemsObs",value:function(){return this.props.pane.items}},{key:"getScrollSize",value:function(){return this.props.pane.getInfiniteList(!1).getScrollSize()}},{key:"getClientHeight",value:function(){return this.props.pane.getHeight()}},{key:"getScrollTop",value:function(){return this.props.pane.getInfiniteList(!1).getScrollTop()}},{key:"onScroll",value:function(){this.refs.scroller&&this.refs.scroller.handleScroll()}},{key:"startDragging",value:function(t){a.default.hasClass(t.target,"paneDraggable")&&u.default.PaneManager.paneCount()>1&&(this.hasMovedDrag=!1,this.dragStartX=t.clientX-this.props.pane.rect.get().left,document.addEventListener("mousemove",this.onDragMove),document.addEventListener("mouseup",this.onDragUp))}},{key:"onDragMove",value:function(t){this.hasMovedDrag||(this.hasMovedDrag=!0,u.default.DragDrop.isDraggingPane.set(!0),this.isDragging.set(!0));var e=this.props.pane.rect.get(),i=t.clientX-this.dragStartX-e.left;this.updateDragOffset(i),u.default.PaneManager.dragPaneTo(this.props.pane,e.left+i,e.right+i)&&this.updateDragOffset(t.clientX-this.dragStartX-this.props.pane.rect.get().left)}},{key:"onDragUp",value:function(){this.isDragging.set(!1),u.default.DragDrop.isDraggingPane.set(!1),document.removeEventListener("mousemove",this.onDragMove),document.removeEventListener("mouseup",this.onDragUp),this.updateDragOffset(0)}},{key:"updateDragOffset",value:function(t){this.dragOffset.set(t)}},{key:"renderScrollerWrapper",value:function(t,e){if(h.a.isMobile){var i={position:"relative"},r=t.offsetX;return r&&(i[h.a.transform.react]="translate3d("+r+"px,0,0)"),this.props.pane.isAnimatingOffset&&(i[h.a.transition.react]=h.a.transform.style+" 0.15s"),j.a.createElement("div",{className:"paneScrollerWrapper f1 flexbox flexvert",style:i},e.children)}return j.a.createElement(j.a.Fragment,null,e.children)}},{key:"onTouchMove",value:function(t){}},{key:"onMouseMovePaneBlocker",value:function(t){h.a.isMobile&&Bt.update(t)}},{key:"onMouseUpPaneBlocker",value:function(t){h.a.isMobile&&Bt.end(t)}},{key:"onClickPaneBlocker",value:function(t){h.a.isMobile&&Bt.onClickPane(t)}},{key:"onMouseDownDrag",value:function(t){this._onMouseDownDrag(t,!1)}},{key:"onMouseDownDragExpanded",value:function(t){this._onMouseDownDrag(t,!0)}},{key:"_onMouseDownDrag",value:function(t,e){var i=this.state.rect;this.resizingInfo={startPos:t.clientX,startOffset:t.clientX-a.default.offset(this.refs.pane).left-i.width-(e?i.widthExpanded:0),startWidth:this.state.rect.width,isExpanded:e},document.addEventListener("mousemove",this.onMouseMoveResize),document.addEventListener("mouseup",this.onMouseUpResize),a.default.preventDefault(t)}},{key:"onMouseMoveResize",value:function(t){var e=this.resizingInfo;if(e){var i=a.default.offset(this.refs.pane),r=t.clientX-i.left-e.startOffset;e.isExpanded&&(r-=this.state.rect.width),this.props.pane.setWidthManual(r,e.isExpanded)}}},{key:"onMouseUpResize",value:function(){this.resizingInfo=void 0,u.default.PaneManager.updatePaneRects(),document.removeEventListener("mousemove",this.onMouseMoveResize),document.removeEventListener("mouseup",this.onMouseUpResize)}},{key:"onDoubleClickDrag",value:function(t,e){this.props.pane.widthManual&&this.props.pane.setWidthManual(void 0,e)}},{key:"onDoubleClickDragExpanded",value:function(t){this.onDoubleClickDrag(t,!0)}},{key:"renderCell",value:function(t,e){var i=this.props.pane;return j.a.createElement(Xt,{key:t,list:i.getInfiniteList(!1),pane:i,orientation:this.state.orientation,cell:e})}},{key:"render",value:function(){var t,e=this.props,i=this.state,r=e.pane,n=a.default.classNames("pane c-border",r.paneClass,e.className,{overviewOpen:i.isOverviewVisible},{expanded:i.isExpanded},{none:!i.isActive},{hasTitles:!h.a.isMobile&&i.parents.length>0},{horizontal:i.orientation===o.a.Orientation.Horizontal},{vertical:i.orientation!==o.a.Orientation.Horizontal},{"flexbox flexvert":h.a.isMobile},{firstPane:i.rect.isFirst},{transition:!u.default.PaneManager.isResizingPane&&!i.isDragging},{dragging:i.isDragging}),s=a.default.classNames("paneScroller belowHeader c-background",{overviewOpen:i.isOverviewVisible},{customScroller:r.useCustomScroller},"f1"),d=a.default.classNames("paneRoot"),c=a.default.classNames("paneContent",{editable:r.isWriteable});r.topBoxHeight.get()>0&&(t=i.paneTopText?j.a.createElement("span",{className:"loadingText"},i.paneTopText):this.getChildByKey("topBox"));var v,y=j.a.createElement(pt,{owner:r.getInfiniteList(!1),pane:r,overview:!1,renderCell:this.renderCell,hiddenInput:!h.a.isMobile,contentClass:c,orientation:i.orientation,ref:"contentElement"},r.topBoxHeight.get()>0&&j.a.createElement("div",{key:"topBox",className:"paneTopBox c-background"},t)),g=!h.a.isMobile&&r.isWriteable?j.a.createElement(mt,{pane:r}):null,l=i.rect,p={width:l.width},m={left:l.width},f={left:l.width+l.widthExpanded};if(h.a.isMobile)p.left=i.left,v={marginBottom:i.bottomBarHeight};else{var k="translate3d("+Math.round(i.left+(i.dragOffset||0))+"px,0,0)";h.a.isFirefox&&!a.default.isRunningScript()?(p.left=i.left,i.dragOffset&&(p[h.a.transform.react]="translate3d("+i.dragOffset+"px,0,0)")):p[h.a.transform.react]=k,m[h.a.transform.react]=k,f[h.a.transform.react]=k}var A={};return h.a.isMobile&&(A.offsetX=r.offsetX),j.a.createElement(j.a.Fragment,null,j.a.createElement("div",{key:"pane","data-moo-id":this.getUniqueID(),ref:"pane",className:n,style:p},j.a.createElement(W,{observe:A,render:this.renderScrollerWrapper},j.a.createElement(gt,{pane:r,startDragging:this.startDragging},this.getChildByKey("headerButtons")),j.a.createElement(Zt.a,{className:s,style:v,getScrollSize:this.getScrollSize,getClientHeight:this.getClientHeight,getScrollTop:this.getScrollTop,noOwnScroll:!0,orientation:i.orientation,showScrollbars:i.showScrollbars,ref:"scroller"},j.a.createElement("div",{className:d,ref:"rootElement",onTouchMove:this.onTouchMove},y,g,!h.a.isMobile&&i.showFormattingToolbar&&j.a.createElement(Jt,{pane:r}))),h.a.isMobile&&i.isOverviewVisible&&j.a.createElement(O.a,{className:"paneClickBlocker",onMouseMove:this.onMouseMovePaneBlocker,onClick:this.onClickPaneBlocker,onMouseUp:this.onMouseUpPaneBlocker})),this.getChildByKey("overlay"),i.toast&&j.a.createElement("div",{className:"paneToasts"},j.a.createElement(Qt,{toast:i.toast}))),!h.a.isMobile&&j.a.createElement("div",{className:"paneDragHandle cursor-ew-resize",onMouseDown:this.onMouseDownDrag,style:m,onDoubleClick:this.onDoubleClickDrag}),!h.a.isMobile&&i.isExpanded&&j.a.createElement("div",{className:"paneDragHandle cursor-ew-resize",onMouseDown:this.onMouseDownDragExpanded,style:f,onDoubleClick:this.onDoubleClickDragExpanded}))}}]),e}(B.a),Ut=B.b.createClass({displayName:"ReactPaneList",componentDisplay:o.a.ComponentDisplay.Everywhere,getState:function(){var t=this.props.pane;return{rect:t.rect,hasCollapsed:t.hasCollapsedObs,_allowCollapsingObs:t.search.getFilterObs("showOnlyMatches"),allowCollapsing:!t.search.getFilterValue("showOnlyMatches")}},render:function(){var t=this.state,e=this.props.pane,i=t.hasCollapsed,r=(i?"Expand":"Collapse")+" all items in view",a=h.a.isMobile?44:o.a.PaneHeaderButtonWidth,n=(h.a.isMobile,o.a.PaneHeaderButtonHeight);return j.a.createElement($t,{pane:e},j.a.createElement("div",{className:"f1",key:"headerButtons"},e.supportCollapsing&&!h.a.isMobile&&j.a.createElement(at.a,{icon:i?"icon-angle-down":"icon-angle-right",iconSize:16,width:a,height:n,onClick:e.toggleCollapseAll.bind(e),tooltip:r,tooltipHotkey:{name:"CollapseAll",group:"Pane"},enabled:t.allowCollapsing})))}}),Rt=B.b.createClass({displayName:"ReactCalendarTimes",componentDisplay:o.a.ComponentDisplay.Desktop,init:function(){this.scrollTop=void 0},getState:function(){var t=this.props.pane;return{numAllDay:t.numAllDay,heightAllDay:t.getHeightAllDay()}},onMount:function(){this.props.trackPane&&setTimeout(function(){var t=this.props.pane.paneContent;t&&t.addEventListener("scroll",this.onPaneScroll)}.bind(this),0)},onUnmount:function(){var t=this.props.pane.paneContent;t&&t.removeEventListener("scroll",this.onPaneScroll)},onPaneScroll:function(t){var e=t.target.scrollTop;e!==this.scrollTop&&this.refs.scroller&&(this.scrollTop=this.refs.scroller.scrollTop=e)},render:function(){for(var t=0,e=this.props,i=this.state,r={height:e.height},a={height:i.heightAllDay+2},n={top:i.heightAllDay+30+2},o=[],u=0;u<24;u++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var s;12===u?s="Noon":(s=0===u?12:u%12,s+=" "+(u>=12?"pm":"am")),o.push(j.a.createElement("div",{key:u,className:"time"},s))}return j.a.createElement("div",{className:"calendarTimes belowHeader c-background",style:r},j.a.createElement("div",{className:"calendarTimesInner hideScrollbar c-border-heavy",style:n,ref:"scroller"},o),e.showAllDay&&j.a.createElement("div",{className:"calendarTimesAllDay c-border-heavy",style:a},"All day"))}}),Et=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"render",value:function(){return j.a.createElement(at.a,J()({},this.props,{className:"fancyCalendarDayButton",iconSize:16,padding:0,tooltip:"Jump to Today",icon:"icon-calendar-o",center:!0}),this.props.day)}}]),e}(B.a),Kt=o.a.TaskViewMode,xt=B.b.createClass({displayName:"ReactPaneTask",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){this.listenToDispatcher("dateChanged");var t=u.default.pluginManager.getPlugin(o.a.PluginID.GCalendar);t.onSettingChanged(t.Settings.IsEnabled,this.onSettingChanged)},getState:function(){var t=this.props.pane,e=u.default.pluginManager.getPlugin(o.a.PluginID.GCalendar);return{item:t.item,rect:t.rect,hasCollapsed:t.hasCollapsedObs,_allowCollapsingObs:t.search.getFilterObs("showOnlyMatches"),allowCollapsing:!t.search.getFilterValue("showOnlyMatches"),viewState:t.viewState,viewMode:t.getViewMode(),isCalendarView:t.isViewCalendar(),hasPremiumFeatures:u.default.billingManager.hasPremiumFeaturesObservable,date:(new Date).getDate(),isGCalEnabled:e.isEnabled(),calendarCustomDays:u.default.settings.calendarCustomDays,dayWeekStart:u.default.settings.dayWeekStart}},onSettingChanged:function(){this._isMounted&&this.updateState()},onClickToday:function(){this.props.pane.scrollToToday(o.a.ScrollDuration.Default)},onClickJumpBack:function(){this.props.pane.scrollJump(-1,o.a.ScrollDuration.Default)},onClickJumpForward:function(){this.props.pane.scrollJump(1,o.a.ScrollDuration.Default)},onClickAddItem:function(t){this.props.pane.addItemWithPrefix(0,t)},onClickAddFile:function(t,e){var i=this.props,r=i.pane,a=i.paneObject;u.default.menus.openContextMenu({componentName:"ReactContextMenuDropZone",element:e.target,pane:r,itemParent:r.getItem(),insertIndex:0,image:t,paneObject:a})},onClickAddItemPopup:function(t){this.props.pane.openItemEditor({element:t.target,addOnSave:!0})},onClickViewMode:function(t){this.props.pane.setViewMode(t)},renderPaneBox:function(){var t=this.props.pane,e=t.isViewOutline()||t.isViewProjectNoBlocks();return j.a.createElement("div",{className:"flexbox flex-center addItemButton c-foreground-faded"},j.a.createElement(at.a,{icon:"icon-project",iconSize:16,width:44,onClick:this.onClickAddItem.bind(this,o.a.Prefix.Header),tooltip:"Add project"}),e&&j.a.createElement(at.a,{icon:"icon-edit",iconSize:12,width:44,onClick:this.onClickAddItem.bind(this,""),tooltip:"Add item"}),e&&j.a.createElement(at.a,{icon:"icon-check",iconSize:14,width:44,onClick:this.onClickAddItem.bind(this,o.a.Prefix.Task),tooltip:"Add task"}),e&&j.a.createElement(at.a,{icon:"icon-bullet",iconSize:22,width:44,onClick:this.onClickAddItem.bind(this,o.a.Prefix.Bullet),tooltip:"Add bullet"}),e&&j.a.createElement(at.a,{icon:"icon-numlist",iconSize:12,width:44,onClick:this.onClickAddItem.bind(this,o.a.Prefix.NumList),tooltip:"Add numbered list"}),e&&j.a.createElement(at.a,{icon:"icon-drive-file",iconSize:14,width:44,onClick:this.onClickAddFile.bind(this,!1),tooltip:"Add file"}),e&&j.a.createElement(at.a,{icon:"icon-image",iconSize:14,width:44,onClick:this.onClickAddFile.bind(this,!0),tooltip:"Add image"}))},render:function(){var t,e,i,r=this.state,n=this.props.pane,u=this.state.viewMode,s=o.a.TaskViewModeText[u],d=r.rect.width>550,c=o.a.PaneHeaderButtonWidth,v=o.a.PaneHeaderButtonHeight,y=a.default.classNames(r.isCalendarView?"calendar"+o.a.TaskViewModeText[u]+"View c-background":"",{showingButtons:r.isCalendarView},{premiumBlocked:n.isViewPremiumBlocked()});if(!h.a.isMobile){var g=r.hasCollapsed,l=o.a.SearchHeight,p=(g?"Expand":"Collapse")+" all items in view",m=n.isViewAgenda()&&[Kt.Agenda_Today,Kt.Agenda_Week,Kt.Agenda_All]||n.isViewCalendar()&&[Kt.Calendar_Day,Kt.Calendar_Custom,Kt.Calendar_Week,Kt.Calendar_Month],f=j.a.createElement(Et,{day:this.state.date,height:l,width:l,onClick:this.onClickToday});i=j.a.createElement("div",{key:"headerButtons"},n.isViewDates()&&j.a.createElement("div",{className:"calendarButtons"},n.isViewCalendar()&&j.a.createElement("div",{className:"borderButtons ib c-border-light"},j.a.createElement(at.a,{icon:"icon-caret-left",width:d?20:14,height:l,onClick:this.onClickJumpBack,enabled:r.isCalendarView,tooltip:"Previous "+s}),f,j.a.createElement(at.a,{icon:"icon-caret-right",width:d?20:14,height:l,onClick:this.onClickJumpForward,enabled:r.isCalendarView,tooltip:"Next "+s})),n.isViewAgenda()&&f,d&&j.a.createElement("div",{className:"viewModeButtons borderButtons ib c-border-light"},m.map(function(t){var e=o.a.TaskViewModeText[t];return t===Kt.Calendar_Custom&&(e=e.replace("#",r.calendarCustomDays)),j.a.createElement(at.a,{height:l,selected:r.viewMode===t,onClick:this.onClickViewMode.bind(this,t),key:t},e)}.bind(this)))),n.supportCollapsing&&!n.isViewCalendar()&&j.a.createElement(at.a,{icon:g?"icon-angle-down":"icon-angle-right",iconSize:16,width:c,height:v,onClick:n.toggleCollapseAll.bind(n),tooltip:p,tooltipHotkey:{name:"CollapseAll",group:"Pane"},enabled:r.allowCollapsing})),n.isViewCalendar()?t=u===Kt.Calendar_Month?j.a.createElement("div",{className:"calendarMonthDays belowHeader c-background c-border-heavy flexbox",key:"overlay"},0===r.dayWeekStart&&j.a.createElement("div",null,"SUN"),j.a.createElement("div",null,"MON"),j.a.createElement("div",null,"TUE"),j.a.createElement("div",null,"WED"),j.a.createElement("div",null,"THU"),j.a.createElement("div",null,"FRI"),j.a.createElement("div",null,"SAT"),1===r.dayWeekStart&&j.a.createElement("div",null,"SUN")):j.a.createElement(Rt,{pane:n,key:"overlay",trackPane:!0,showAllDay:!0}):n.isViewAgenda()?e=j.a.createElement("div",{className:"flexbox flex-center addItemButton c-foreground-faded"},j.a.createElement(at.a,{onClick:this.onClickAddItemPopup},"Add Item")):n.shouldShowAddBox()&&(e=this.renderPaneBox("top"))}return j.a.createElement($t,{pane:n,itemsObs:this.itemsObs,className:y},t,e&&j.a.createElement("div",{key:"topBox"},e),i)}}),bt=B.b.createClass({displayName:"ReactPaneGmail",componentDisplay:o.a.ComponentDisplay.Everywhere,onMount:function(){this.listenTo(this.props.pane.search.onChanged)},getState:function(){var t=this.props.pane;return t.isDestroyed()?{}:{rootItem:t.item,messages:u.default.EmailPreview.messages,isActivePane:u.default.EmailPreview.activePane===t,viewState:t.viewState,viewMode:t.getViewMode()}},onHoldViewButton:function(t){u.default.menus.openContextMenu({fn:this.renderContextMenuSort,element:t.target})},onClickViewButton:function(){var t=this.state.viewMode===o.a.GmailViewMode.Priority?o.a.GmailViewMode.Date:o.a.GmailViewMode.Priority;this.setViewMode(t),u.default.menus.closeContextMenu()},renderContextMenuSort:function(t){return j.a.createElement(ut.a,{key:"contextMenuGmailSort",id:"contextMenuGmailSort",element:t.element},j.a.createElement(ot.a,null,"Sort by"),j.a.createElement(st.a,{icon:"icon-access_time",onClick:this.setViewMode.bind(this,o.a.GmailViewMode.Date)},o.a.GmailViewMode.Date),j.a.createElement(st.a,{icon:"icon-exclamation",onClick:this.setViewMode.bind(this,o.a.GmailViewMode.Priority)},o.a.GmailViewMode.Priority))},setViewMode:function(t){this.props.pane.setViewMode(t)},renderViewButton:function(){var t=this.state.viewMode===o.a.GmailViewMode.Date?"icon-access_time":"icon-exclamation";return j.a.createElement(at.a,{key:"sort",className:"emailViewButton",tooltip:"Sort Order",icon:t,iconSize:14,width:o.a.PaneHeaderButtonWidth,height:o.a.PaneHeaderButtonHeight,onClick:this.onClickViewButton,onHold:this.onHoldViewButton})},render:function(){this.props.pane;return j.a.createElement($t,{key:"pane",pane:this.props.pane},j.a.createElement("div",{key:"headerButtons"},this.renderViewButton()))}}),Ot=B.b.createClass({displayName:"ReactDragDrop",componentDisplay:o.a.ComponentDisplay.Everywhere,getState:function(){var t=u.default.DragDrop;u.default.PaneManager;return{items:t.draggingItems,activePane:t.activePane,pane:t.startPane,position:t.position,transform:t.transform,isDragging:t.isInDrag,linePosition:t.linePosition,fromOverview:t.fromOverview,dropBucketItems:a.default.vmMain.dropBucket.getItems(),onlineText:a.default.vmMain.onlineText(),contextMenus:u.default.menus.contextMenuStack}},onBeforeChanged:function(t,e){if(t.items!==e.items){var i=0;this.paddings=[];for(var r=0;r<t.items.length;r++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this.paddings[r]=t.pane.getPaddingForPaneObject(t.items[r])-8}}},onClickDropBucket:function(){this.state.dropBucketItems.length>0&&u.default.menus.toggleContextMenu({componentName:"ReactContextMenuDropBucket",position:"bottom",pane:a.default.focusedPane})},onClickCancelDragToOutline:function(){u.default.DragDrop.stopDraggingToOutline()},render:function(){var t,e,i,r,n=this.state,s=n.pane,d=n.items;if(s&&n.isDragging){if(d&&d.length>0&&n.position&&n.transform){for(var c=0,v=[],y=Math.min(d.length,10),g=0;g<y;++g){if(c++>5e3&&__infLoop&&__infLoop(c))throw new RangeError;var l=this.paddings[g];v.push(j.a.createElement(Gt.a,{key:"drag_"+g,pane:s,item:d[g].item,paneObject:d[g],renderLikePane:!0,noNotes:n.fromOverview,padding:l}))}var p=d.length-y;p>0&&v.push(j.a.createElement("div",{className:"dotdotdot",key:"dotdotdot"},"... plus "+p+" more ..."));var m=n.position,f={left:h.a.isMobile?0:m.left+8,top:m.top,width:s.widthOfDrag(d[0]),maxWidth:s.getWidth()},k=n.transform;f[h.a.transform.react]="translate3d("+k.left+"px, "+k.top+"px, 0)",t=j.a.createElement("ul",{id:"dragUL",style:f,className:"popup c-shadow-popup c-background"},v)}if(n.linePosition&&n.activePane){var A=n.linePosition,S={width:A.width,height:A.height},w=a.default.classNames({isLine:!A.height});S[h.a.transform.react]="translate("+A.left+"px, "+A.top+"px)",e=j.a.createElement("div",{id:"dragLine",style:S,className:w})}r=a.default.classNames("from_"+s.type,n.activePane.paneClass)}var L,F,C=h.a.isMobile&&n.isDragging&&!u.default.menus.isContextMenuOpen(),I=n.pane===a.default.focusedPane,P=n.dropBucketItems,N=n.onlineText?60:44,H={top:n.dropBucketTop,bottom:!n.dropBucketTop&&N+24},M=a.default.classNames("dragTarget mobileDropBucket",{showIcon:!C},{hovered:"dragToSave"===n.dragTargetHovered}),z=a.default.classNames("dragTarget mobileDragToOutline",{hovered:"dragToOutline"===n.dragTargetHovered});C?I&&(L=j.a.createElement(at.a,{id:"dragToSave",width:50,height:50,color:"white",iconSize:20,style:H,key:"bucket",className:M,onClick:this.onClickDropBucket},j.a.createElement("span",{className:"buttonText"},"Drag",j.a.createElement("br",null),"here",j.a.createElement("br",null),"to",j.a.createElement("br",null),"save")),s.type===o.a.PaneMode.Gmail&&(F=j.a.createElement("div",{id:"dragToOutline",className:z,style:H},"Drag",j.a.createElement("br",null),"to",j.a.createElement("br",null),"outline"))):P.length>0&&!u.default.menus.isContextMenuOpen()&&(L=j.a.createElement(at.a,{width:50,height:50,color:"white",iconSize:20,style:H,key:"bucket",className:M,onClick:this.onClickDropBucket,enabled:a.default.focusedPane&&a.default.focusedPane.type===o.a.PaneMode.Task},j.a.createElement("span",{className:"bucketIcon"},j.a.createElement("i",{className:"icon-content_paste"}),P.length>0&&j.a.createElement("div",null,P.length)))),i=j.a.createElement("div",{className:"dragTargets"},L,F);var D=n.draggingToOutline&&j.a.createElement("div",{className:"draggingToOutlineArea flexbox"},j.a.createElement("div",{className:"f1"},"Tap a destination for this email"),j.a.createElement(at.a,{color:"white",height:60,onClick:this.onClickCancelDragToOutline},"CANCEL"));return j.a.createElement("div",{id:"dragdrop",className:r},t,e,D,i)}}),Wt=i(113),_t=i(75),te=i.n(_t),ee=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"render",value:function(){var t=this.props,e=t.className,i=t.minimized,r=t.minimize,n=t.close,o=t.title,u=t.children,s=te()(t,["className","minimized","minimize","close","title","children"]),h=a.default.classNames(e,"fancyOverlayPopup popup c-shadow-popup c-background",{minimized:i}),d=r&&a.default.classNames("popupMinimize",{minimized:i});return j.a.createElement("div",J()({},s,{className:h}),j.a.createElement("div",{className:"overlayTitleBar c-foreground c-border-heavy c-bg-popup-title flexbox"},j.a.createElement("div",{className:"displayTitle f1"},o),r&&j.a.createElement(at.a,{className:d,icon:"icon-minus",iconSize:14,width:36,height:36,onClick:r,tooltip:i?"Restore":"Minimize"}),j.a.createElement(at.a,{icon:"icon-close",width:36,height:36,onClick:n,tooltip:"Close"})),u)}}]),e}(B.a),ie=B.b.createClass({displayName:"ReactEmailComposeWindow",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){this.listenToDispatcher("windowResize"),this.createObservables({minimized:!1})},getState:function(){var t=h.a.windowWidth(),e=h.a.windowHeight();return{width:Math.min(Math.max(Math.min(.4*t,800),500),t-20),height:Math.min(Math.max(Math.min(.4*e,800),500),e)}},minimize:function(){this.minimized.set(!this.minimized.get())},close:function(){this.refs.compose.close(!0,!1,!0)},onClose:function(){p.a.fireEvent("EmailCompose","onClosed",[]),u.default.menus.closeComposeEmail(this.props.threadAttach,this.props.message)},onMouseDown:function(){S.a.reset()},openCc:function(){this.cc.set(!0)},openBcc:function(){this.bcc.set(!0)},onMount:function(){var t=this.refs.compose;t.focusTo(),requestAnimationFrame(function(){t.focusTo()})},render:function(){var t=this.state,e={height:t.minimized?36:t.height,width:t.width};return j.a.createElement(ee,{title:"New Message",minimized:t.minimized,minimize:this.minimize,close:this.close,className:"composeEmail flexbox flexvert",ref:"element",style:e,onMouseDown:this.onMouseDown},j.a.createElement(Wt.a,{className:"f1",threadAttach:this.props.threadAttach,message:this.props.message,showSubject:!0,onClose:this.onClose,ref:"compose",focus:"to",hidden:t.minimized}))}}),re=B.b.createClass({displayName:"ReactEmailComposes",componentDisplay:o.a.ComponentDisplay.Everywhere,getState:function(){return{emailComposes:u.default.menus.emailComposeStack}},render:function(){for(var t=0,e=this.state,i=[],r=0;r<e.emailComposes.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var a=e.emailComposes[r];i.push(j.a.createElement(ie,{key:a.draftMsg.id,threadAttach:a.attach,message:a.draftMsg}))}return j.a.createElement("div",{className:"emailComposes flexbox"},i)}}),ae=i(140),ne=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"init",value:function(){this.createObservables({addingItem:void 0})}},{key:"onMount",value:function(){var t=this.props.pane,e=t.getOverview(),i=e.scrollElement=this.refs.overviewScroller.getScrollElement(),r=e.contentElement=this.refs.overviewContentElement.getElement();t.getInfiniteList(!0).setupScroller(i,r),a.default.setupClick(i,t.getOverview(),t.getOverview().onTap)}},{key:"getState",value:function(){var t=this.props.pane,e=t.getOverview(),i=u.default.pluginManager.getPluginGmail(),r={accounts:i.getSettingObs(i.Settings.SyncAccounts),isVisible:e.isVisible,activeDoc:t.document,showDocuments:t.supportsDocuments,zoomed:t.item};return h.a.isMobile?r.offsetX=t.offsetX:(r.cursor=e.cursor,r.isAtRoot=t.getItem()===t.getRootItem()),t.type===o.a.PaneMode.Gmail&&(r.overviewAccount=t._overviewAccount),r}},{key:"getPane",value:function(){return this.props.pane}},{key:"renderCell",value:function(t,e){var i=this.props.pane;return j.a.createElement(Xt,{key:t,list:i.getInfiniteList(!0),pane:i,cell:e,overview:!0})}},{key:"sizeAtIndex",value:function(t){var e=this.props.pane;return e.headers.get()[t].sizeInPane(e,!0)}},{key:"itemsObs",value:function(){return this.props.pane.headers}},{key:"onClickAddTop",value:function(){this.addingItem.set("top")}},{key:"onClickAddBottom",value:function(){this.addingItem.set("bottom"),this.refs.overviewScroller.scrollToBottom()}},{key:"onClickAll",value:function(){var t=this.props.pane;t.zoomOut(t.getRootItem()),h.a.isMobile&&$.default.setOverviewVisibility(t,!1)}},{key:"onAddItem",value:function(t){var e=this.refs.inputAddItem.getValue();this.addingItem.set(void 0);var i=this.props.pane,r=i.getRootItem(),a="top"===t?0:r.numItems(),n=i.addProject(a,e,!0);setTimeout(function(){i.getItem()!==r&&i.zoomOut(r),i.scrollItemToTop(n,o.a.ScrollDuration.Default)},0),h.a.isMobile&&$.default.setOverviewVisibility(i,!1)}},{key:"onClickCancel",value:function(){this.addingItem.set(void 0)}},{key:"onClickGmailAccount",value:function(t){var e=this.props.pane;e.setOverviewAccount(t),e.zoomIn(e.getDefaultDisplayItem(t))}},{key:"renderAddProjectInput",value:function(t){var e=this.onAddItem.bind(this,t),i=this.onClickCancel.bind(this,t);return j.a.createElement("div",{className:"addProjectInput"},j.a.createElement(rt.a,{ref:"inputAddItem",focused:!0,height:32,placeholder:"Name project",onEscape:i,onEnter:e}),j.a.createElement("div",{className:"addProjectButtons"},j.a.createElement(at.a,{primary:!0,onClick:e},"Add Project"),j.a.createElement(at.a,{onClick:i},"Cancel")))}},{key:"renderShowAllButton",value:function(t){return j.a.createElement(at.a,{className:"overviewHeaderButton",icon:"icon-visibility",height:30,iconSize:15,onClick:this.onClickAll,enabled:!this.state.isAtRoot},"Show all "+t)}},{key:"renderDocuments",value:function(){var t=h.a.isMobile?"#ddd":"c-foreground",e=h.a.isMobile?"#999":"c-foreground-very-faded c-color-hover";if(this.state.showDocuments)return j.a.createElement("div",{className:"paneOverviewTop c-border",style:{color:t}},j.a.createElement(at.a,{color:e,onClick:this.props.onClickViewDocuments},"Documents"),j.a.createElement("span",{className:h.a.isMobile?void 0:e,style:{lineHeight:"36px",verticalAlign:"top",color:h.a.isMobile?e:void 0}},">"),j.a.createElement(at.a,{color:t,onClick:this.props.onClickViewDocuments},"Overview"))}},{key:"renderHeader",value:function(){var t=this.state,e=this.props.pane;switch(e.type){case o.a.PaneMode.Task:var i=e.isViewOutline()||e.isViewProject();return j.a.createElement("div",{className:"overviewHeader"},this.renderShowAllButton("projects"),i&&"top"!==t.addingItem&&j.a.createElement(at.a,{className:"overviewHeaderButton",icon:"icon-project",iconSize:15,height:30,onClick:this.onClickAddTop},"Add project"),i&&"top"===t.addingItem&&this.renderAddProjectInput("top"),j.a.createElement("hr",null));case o.a.PaneMode.Archived:return j.a.createElement("div",{className:"overviewHeader"},this.renderShowAllButton("projects"),j.a.createElement("hr",null));case o.a.PaneMode.Drive:return j.a.createElement("div",{className:"overviewHeader"},j.a.createElement("div",{className:"overviewHeaderTitle"}),this.renderShowAllButton("folders"),j.a.createElement("hr",null));case o.a.PaneMode.Gmail:var r=u.default.pluginManager.getPluginGmail(),n=t.overviewAccount,s=r.getSyncAccounts(),h=a.default.classNames("overviewHeader",{"c-border":s.length>1});return j.a.createElement("div",{className:h},s.length>1&&s.map(function(t){return j.a.createElement(at.a,{className:"overviewHeaderButton",key:t,selected:t===n,height:30,onClick:this.onClickGmailAccount.bind(this,t)},t)}.bind(this)))}}},{key:"renderFooter",value:function(){var t=this.state,e=this.props.pane;switch(e.type){case o.a.PaneMode.Task:return(e.isViewOutline()||e.isViewProject())&&e.numHeaders()>0?j.a.createElement("div",{className:"overviewFooter"},j.a.createElement("hr",null),"bottom"===t.addingItem&&this.renderAddProjectInput("bottom"),"bottom"!==t.addingItem&&j.a.createElement(at.a,{className:"overviewHeaderButton",icon:"icon-project",iconSize:15,height:30,onClick:this.onClickAddBottom},"Add project")):null}}},{key:"render",value:function(){this.state;var t=this.props.pane,e=a.default.classNames("paneOverview",t.type+"Overview"),i=a.default.classNames(this.props.className,"paneOverviewScroller scroller",{customScroller:t.useCustomScroller},{transition:!u.default.PaneManager.isResizingPane}),r=this.renderHeader(),n=this.renderFooter();return j.a.createElement("div",{className:"paneOverviewOutside f1","data-moo-id":this.getUniqueID()},this.renderDocuments(),j.a.createElement(Zt.a,{className:i,ref:"overviewScroller",showScrollbars:!0},j.a.createElement("div",{className:e,ref:"overview"},r,j.a.createElement(pt,{owner:t.getInfiniteList(!0),pane:t,overview:!0,renderCell:this.renderCell,contentClass:"overviewList noSelect mat-list",ref:"overviewContentElement"}),n)))}}]),e}(B.a),oe=i(65),ue=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"init",value:function(){this.createObservables({isEditing:""===this.props.doc.text.get()})}},{key:"getState",value:function(){var t=this.props.doc;return{text:t.text,contentPreview:t.contentPreview,docTimeText:oe.a.toHumanText(new Date(t.dateModified.get()),!0),docTime:t.dateModified}}},{key:"onBeforeChanged",value:function(t,e){t.text&&!e.text&&t.isEditing&&(t.isEditing=!1,this.isEditing.set(!1,!1))}},{key:"onEscape",value:function(){this.isEditing.set(!1)}},{key:"onFinishEdit",value:function(){s.a.renameDocument(this.props.doc,this.refs.inputAddDocument.getValue()),this.isEditing.set(!1)}},{key:"onClick",value:function(){this.props.onSelectDocument(this.props.doc)}},{key:"onClickOverview",value:function(){this.props.onSelectDocument(this.props.doc,!0)}},{key:"onRightClick",value:function(t){u.default.menus.openContextMenu({fn:this.renderContextMenu,element:t.target})}},{key:"onClickRename",value:function(){this.isEditing.set(!0)}},{key:"onClickShare",value:function(){u.default.menus.openModal(o.a.Modals.ShareDoc,{doc:this.props.doc})}},{key:"onClickDelete",value:function(){if(s.a.getDocumentsArray().length>1){var t=this.props,e=t.pane,i=t.doc;u.default.menus.confirm("Are you sure you want to delete ".concat(i.text.get(),"?"),function(t){t&&(i.delete(),e.document.get()===i&&e.setDocument(s.a.getDefaultDocument()))})}else u.default.menus.alert({text:"Deleting the last document is not supported.",actionText:"OKAY"})}},{key:"onClickRevisionHistory",value:function(){u.default.menus.openModal(o.a.Modals.Backups,{doc:this.props.doc})}},{key:"renderContextMenu",value:function(t){var e=this.props.doc.isAdmin();return q.createElement(ut.a,{key:"contextMenuDocument",id:"contextMenuDocument",element:t.element},e&&q.createElement(q.Fragment,null,q.createElement(st.a,{onClick:this.onClickRename},"Rename"),q.createElement(st.a,{onClick:this.onClickShare},"Share"),q.createElement(st.a,{onClick:this.onClickRevisionHistory},"Revision History"),q.createElement("hr",null),q.createElement(st.a,{onClick:this.onClickDelete},"Delete")),!e&&q.createElement("div",{style:{padding:"12px 16px"}},"Please request Admin privelege on this document to modify it."))}},{key:"render",value:function(){var t=this.props,e=t.isSelected,i=t.pane,r=this.state,n=r.text,o=r.isEditing,u=r.contentPreview,s=r.docTimeText,d=a.default.classNames("paneSidebarDocument flexbox borderBottom c-background c-border noSelect",{borderLeft:i.rect.get()&&i.rect.get().isFirst},{selected:e});return q.createElement(ht.a,{className:d,onClick:this.onClick,onRightClick:this.onRightClick},e&&q.createElement("div",{className:"selectedIndicator c-border-blue"}),o?q.createElement(rt.a,{ref:"inputAddDocument",focused:!0,height:32,placeholder:"Name document",buttonText:"SAVE",onButtonClick:this.onFinishEdit,onEscape:this.onEscape}):q.createElement(q.Fragment,null,q.createElement("div",{className:"mw0 f1"},q.createElement("div",{className:"documentName f1 bold"},n),q.createElement("div",{className:"documentExtra c-foreground-faded"},u),q.createElement("div",{className:"documentExtra documentTime c-foreground-faded"},s)),!h.a.isMobile&&q.createElement(at.a,{className:"buttonDocumentOverview",icon:"icon-format_list_bulleted",onClick:this.onClickOverview})))}}]),e}(B.a),se=i(58),he=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"init",value:function(){}},{key:"getState",value:function(){var t=this.props.docInfo;return{text:t.t,encryptionSentinel:t.s}}},{key:"onClick",value:function(){var t=this,e=this.props.docInfo;u.default.menus.openModal(o.a.Modals.EnterCode,{isPassword:!0,text:"Please enter the password for this document: ".concat(this.state.text),onSelect:function(i){return new Promise(function(r,a){i&&u.default.crypto.addKey({name:e.id,password:i,sentinelSalt:e.id}).then(function(i){e.s===i.sentinel?(r(),u.default.settings.addEncryptionKey(e.id,i.key),se.a.loadSingleDocument(e).then(function(e){e&&t.props.onSelectDocument(e)})):(u.default.crypto.removeKey(e.id),a("The password was invalid. Please try again."))})})}})}},{key:"onRightClick",value:function(t){u.default.menus.openContextMenu({fn:this.renderContextMenu,element:t.target})}},{key:"onClickDelete",value:function(){u.default.menus.alert({text:"Deleting encrypted documents is not supported yet. Please contact support if this is important to you.",actionText:"OKAY"})}},{key:"renderContextMenu",value:function(t){return q.createElement(ut.a,{key:"contextMenuDocument",id:"contextMenuDocument",element:t.element},q.createElement(st.a,{onClick:this.onClickDelete},"Delete"))}},{key:"render",value:function(){var t=this.state.text,e=a.default.classNames("paneSidebarDocument flexbox borderBottom borderLeft c-background c-border noSelect");return q.createElement(ht.a,{className:e,onClick:this.onClick,onRightClick:this.onRightClick},q.createElement("div",{className:"mw0 f1"},q.createElement("div",{className:"documentName f1 bold"},t),q.createElement("div",{className:"documentExtra c-foreground-faded"},"Encrypted")))}}]),e}(B.a),de=i(63),ce=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"getState",value:function(){var t=this.props.pane,e={rect:t.rect,_documents:s.a.documentsArray,documentsEncrypted:s.a.documentsEncryptedArray,paneDoc:t.document,documentSortMode:t.documentSortMode};return e.documents=s.a.documentsArray.get().slice().sort(de.a.getCompareFn(t.documentSortMode.get())),e}},{key:"getPane",value:function(){return this.props.pane}},{key:"onClickAdd",value:function(){var t=s.a.addEmptyDocument("",!0);h.a.isMobile||this.props.onSelectDocument(t,!1)}},{key:"onMouseDownSort",value:function(t){u.default.menus.openContextMenu({fn:this.renderContextMenuSort,element:t.target})}},{key:"setSortMode",value:function(t){this.props.pane.documentSortMode.set(t)}},{key:"renderContextMenuSort",value:function(t){var e=this,i=Object.keys(o.a.DocumentSortMode);return j.a.createElement(ut.a,{key:"contextMenuTitle",id:"contextMenuTitle",element:t.element,maxHeight:400},j.a.createElement(ot.a,{topHeader:!0},"Sort mode"),i.map(function(t){return j.a.createElement(st.a,{key:t,active:e.state.documentSortMode===t,onClick:e.setSortMode.bind(e,t)},t)}))}},{key:"renderDocument",value:function(t){return j.a.createElement(ue,{key:t.id,doc:t,pane:this.props.pane,isSelected:t===this.state.paneDoc,onSelectDocument:this.props.onSelectDocument})}},{key:"renderDocumentEncrypted",value:function(t){return j.a.createElement(he,{key:t.id,docInfo:t,onSelectDocument:this.props.onSelectDocument})}},{key:"render",value:function(){var t=this.state,e=h.a.isMobile?"#ddd":"c-foreground";return j.a.createElement("div",{className:"paneSidebarDocuments f1"},!h.a.isMobile&&j.a.createElement("div",{className:"paneSidebarDocumentsButtons flexbox"},j.a.createElement(at.a,{fontSize:17,color:e,onClick:this.props.onClickViewDocuments},"Documents"),j.a.createElement("div",{className:"flex-spacer"}),!h.a.isMobile&&j.a.createElement(at.a,{icon:"icon-add",onClick:this.onClickAdd}),j.a.createElement(at.a,{icon:"icon-filter_list",style:{marginRight:6},onMouseDown:this.onMouseDownSort})),j.a.createElement("div",{className:"borderTop c-border"},t.documentsEncrypted.map(this.renderDocumentEncrypted),t.documents.map(this.renderDocument)),h.a.isMobile&&j.a.createElement(at.a,{onClick:this.onClickAdd,height:50},"Add Document"))}}]),e}(B.a),ve=B.b.createClass({displayName:"ReactMobileOverview",componentDisplay:o.a.ComponentDisplay.Mobile,init:function(){this.createObservables({mode:"overview"})},getState:function(){var t=this.props.pane,e=u.default.pluginManager.getPluginGmail(),i={accounts:e.getSettingObs(e.Settings.SyncAccounts),mounted:this._isMounted};return h.a.isMobile&&(i.rect=t.rect,i.left=t.rect.get().left,i.overviewWidth=$.default.overviewWidth()),i},onTapSettings:function(){u.default.menus.openModal(o.a.Modals.MobileSettings)},onClickDocuments:function(){this.mode.set("documents")},onClickOverview:function(){this.mode.set("overview")},onSelectDocument:function(t,e){var i=this.props.pane;i.setDocument(t),$.default.setOverviewVisibility(i,!1)},render:function(){var t=this.state,e=this.props.pane,i=o.a.MobileBottomHeight,r={left:t.left,width:Math.floor(t.overviewWidth)},a={height:i,lineHeight:i+"px"};return j.a.createElement("div",{className:"mobileOverview flexbox flexvert",style:r},j.a.createElement("div",{className:"mobileOverviewSearchBar flexbox"},j.a.createElement(nt,{pane:e}),j.a.createElement(ae.default,{pane:e})),j.a.createElement("div",{className:"overviewSelectButtons flexbox"},j.a.createElement(at.a,{selected:"documents"===t.mode,className:"f1",onClick:this.onClickDocuments},"DOCUMENTS"),j.a.createElement(at.a,{selected:"overview"===t.mode,className:"f1",onClick:this.onClickOverview},"OVERVIEW")),"documents"===t.mode&&j.a.createElement(ce,{pane:e,onSelectDocument:this.onSelectDocument}),"overview"===t.mode&&j.a.createElement(ne,{pane:e,className:"f1"}),j.a.createElement("div",{className:"mobileOverviewBottom flexbox",style:a},j.a.createElement(at.a,{icon:"icon-settings",iconSize:24,height:i,onClick:this.onTapSettings},"Settings")))}}),ye=i(123),ge=B.b.createClass({displayName:"ReactMessagePreview",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){this._initializedFrame=!1,this.createObservables({hovered:!1})},onMount:function(){this.props.isLastMessage&&this.props.index>0&&(this.needsScrollIntoView=!0),this.checkIsHovered(),this._initializeFrame()},_initializeFrame:function(){if(!this._initializedFrame&&this.refs.frame){this._initializedFrame=!0;var t=this.refs.frame.contentWindow.document;h.a.supportBlobURLIFrame||(t.open(),t.write(this.props.message.blob),t.close())}},getState:function(){var t=this.props.message;return{responseMode:t.responseMode,height:t.height,width:t.width}},onAfterChanged:function(t,e){this._initializeFrame(),t.height!==e.height&&t.height>0&&(this.checkIsHovered(),this.needsScrollIntoView&&(this.needsScrollIntoView=!1,this.scrollIntoView()))},checkIsHovered:function(){if(!h.a.isMobile){var t=S.a.getMousePos(),e=document.elementFromPoint(t.x,t.y);if(e)a.default.findParent(e,"emailMessageWrapper")===this.refs.message&&this.hovered.set(!0)}},scrollIntoView:function(){var t=this.refs.message,e=a.default.findParent(t,h.a.isMobile?"fancyScroller":"fancyScrollContent"),i=0;i=t.clientHeight>e.clientHeight?t.offsetTop:e.scrollHeight-e.clientHeight,a.default.scrollTo(0,i,o.a.ScrollDuration.Snap,e)},onClickHeader:function(){this.props.toggleExpanded()},onMouseEnterMessage:function(){this.hovered.set(!0)},onMouseLeaveMessage:function(){this.hovered.set(!1)},onClickReply:function(t){u.default.EmailPreview.setMessageResponseMode(this.props.message.id,o.a.EmailResponseMode.Reply),t.stopPropagation()},onClickReplyAll:function(t){u.default.EmailPreview.setMessageResponseMode(this.props.message.id,o.a.EmailResponseMode.ReplyAll),t.stopPropagation()},onClickForward:function(t){u.default.EmailPreview.setMessageResponseMode(this.props.message.id,o.a.EmailResponseMode.Forward),t.stopPropagation()},onClickReport:function(){u.default.menus.openModal(o.a.Modals.ReportProblem,{accountID:this.props.threadAttach.getField("accountID"),threadID:this.props.threadAttach.id,msgID:this.props.message.id})},_generateParticipantText:function(t){return t.text?t.text:t.email},isExpanded:function(){return this.props.expanded||this.props.isLastMessage||this.state.responseMode!==o.a.EmailResponseMode.None},openEmailDetails:function(t){var e=this.refs.messageHeaderText;u.default.menus.openContextMenu({componentName:"ReactContextMenuEmailDetails",element:e,message:this.props.message,accountID:this.props.threadAttach.getField("accountID")}),t.stopPropagation()},render:function(){var t,e=this.props,i=this.state,r=e.message,n=this.isExpanded(),s={height:i.height},d=u.default.International.formatDate(r.date,o.a.DFormat.MonthDay),c=u.default.International.formatDate(r.date,o.a.DFormat.ShortTime),v=!h.a.isMobile&&(e.isLastMessage||i.responseMode!==o.a.EmailResponseMode.None),y=!h.a.isMobile||n,g=h.a.windowWidth()>1080&&!h.a.isMobile&&!a.default.isDemoMode(),l={},p={},m={};if(h.a.isMobile||n||(l.opacity=i.hovered?"1":"0"),g&&(p.opacity=i.hovered?"1":"0"),h.a.ios){var f=Math.max(o.a.MinEmailScale,(h.a.windowWidth()-32)/i.width);f<1&&(s[h.a.transform.react]="scale("+f+")",m.height=i.height*f,m.overflow="hidden")}var k,A,S={cursor:n?"pointer":null};if(k=j.a.createElement("span",{className:"from",onClick:n&&!h.a.isMobile?this.openEmailDetails:void 0,style:S},this._generateParticipantText(r.from)),n){var w=(r.to?r.to:[]).concat(r.cc?r.cc:[]).map(this._generateParticipantText).join(", ");A=j.a.createElement("span",{className:"to c-foreground-faded",onClick:h.a.isMobile?void 0:this.openEmailDetails,style:{cursor:"pointer"}},h.a.isMobile&&"To ",!h.a.isMobile&&j.a.createElement("i",{className:"icon-long-arrow-right"}),j.a.createElement("span",null,w))}else A=j.a.createElement("span",{className:"snippet",dangerouslySetInnerHTML:{__html:r.snippet}});var L,F=j.a.createElement("span",{className:"emailDate c-foreground-faded"},j.a.createElement("div",{className:"emailDateDate"},d),j.a.createElement("div",{className:"emailDateTime"},c)),C=h.a.isMobile?22:16,I=h.a.isMobile?50:40;t=j.a.createElement(O.a,{className:"messageHeader flexbox",onClick:this.onClickHeader},j.a.createElement("span",{className:"messageHeaderText f1",ref:"messageHeaderText"},k,A,h.a.isMobile&&n&&F),y&&j.a.createElement("span",{className:"headerButtons",style:l},g&&j.a.createElement(at.a,{height:40,className:"reportEmail",style:p,onClick:this.onClickReport},"Report Problem"),j.a.createElement(at.a,{iconSize:C,width:I,height:I,icon:"icon-reply",tooltip:"Reply",onClick:this.onClickReply}),j.a.createElement(at.a,{iconSize:C,width:I,height:I,icon:"icon-reply-all",tooltip:"Reply All",onClick:this.onClickReplyAll}),j.a.createElement(at.a,{iconSize:C,width:I,height:I,icon:"icon-forward",tooltip:"Forward",onClick:this.onClickForward})),!h.a.isMobile&&F),L=h.a.supportBlobURLIFrame?j.a.createElement("iframe",{key:"ep_"+this.props.message.id,ref:"frame",sandbox:"allow-scripts allow-same-origin",seamless:!0,id:"emailPreview_"+this.props.message.id,className:"emailPreviewFrame",src:r.blobURL,style:s,scrolling:"no"}):j.a.createElement("iframe",{key:"ep_"+this.props.message.id,ref:"frame",sandbox:"allow-scripts allow-same-origin",seamless:!0,id:"emailPreview_"+this.props.message.id,className:"emailPreviewFrame",style:s,scrolling:h.a.ios?"no":void 0});var P=a.default.classNames("emailMessage emailBox c-border",{collapsed:!n},{prevCollapsed:!e.prevExpanded},{nextCollapsed:!e.nextExpanded}),N=a.default.classNames("emailMessageWrapper",{replying:i.responseMode!==o.a.EmailResponseMode.None});return j.a.createElement("div",{className:N,onMouseEnter:this.onMouseEnterMessage,onMouseLeave:this.onMouseLeaveMessage,ref:"message"},j.a.createElement("div",{className:P},t,n&&j.a.createElement("div",{className:"messageContent",style:m},L,j.a.createElement(ye.a,{threadAttach:e.threadAttach,message:e.message,editable:!1}))),v&&j.a.createElement("div",{className:"replyPlaceholder flexbox flex-center",ref:"placeholder"},j.a.createElement("div",{className:"replyPlaceholderInner c-background c-shadow-light"},j.a.createElement(at.a,{iconSize:C,width:I,height:I,icon:"icon-reply",tooltip:"Reply",onClick:this.onClickReply,selected:i.responseMode===o.a.EmailResponseMode.Reply,padding:24}),j.a.createElement(at.a,{iconSize:C,width:I,height:I,icon:"icon-reply-all",tooltip:"Reply All",onClick:this.onClickReplyAll,selected:i.responseMode===o.a.EmailResponseMode.ReplyAll,padding:24}),j.a.createElement(at.a,{iconSize:C,width:I,height:I,icon:"icon-forward",tooltip:"Forward",onClick:this.onClickForward,selected:i.responseMode===o.a.EmailResponseMode.Forward,padding:24}))))}}),le=B.b.createClass({displayName:"ReactEmailReplyBox",componentDisplay:o.a.ComponentDisplay.Everywhere,componentDidUpdate:function(){this._updateFocus()},onMount:function(){this.refs.message&&(this.scrollIntoView(),this._updateFocus())},getState:function(){var t=this.props.inReplyToMessage;return{responseMode:t.responseMode,replytoMessageHeight:t.height}},onAfterChanged:function(t,e){t.replytoMessageHeight!==e.replytoMessageHeight&&this.scrollIntoView()},scrollIntoView:function(){var t=this.refs.message;if(t){var e=a.default.findParent(t,h.a.isMobile?"fancyScroller":"fancyScrollContent"),i=t.offsetTop+t.offsetHeight-e.clientHeight+16;a.default.scrollTo(0,i,o.a.ScrollDuration.Default,e)}},_updateFocus:function(){var t=this.state.responseMode;switch(t){case o.a.EmailResponseMode.None:break;case o.a.EmailResponseMode.Reply:case o.a.EmailResponseMode.ReplyAll:case o.a.EmailResponseMode.Other:this.focusBody();break;case o.a.EmailResponseMode.Forward:this.focusTo();break;default:try{a.default.PAssert(1230,!1,"Unknown response mode for reply box",t)}catch(e){a.default.reportError(e)}}},focusTo:function(){this.refs.compose.focusTo()},focusBody:function(){this.refs.compose.focusBody()},onClose:function(){u.default.EmailPreview.setMessageResponseMode(this.props.inReplyToMessage.id,o.a.EmailResponseMode.None)},render:function(){return this.state.responseMode!==o.a.EmailResponseMode.None?j.a.createElement("div",{className:"emailReplyBox emailBox c-shadow-popup",ref:"message"},j.a.createElement(Wt.a,{threadAttach:this.props.threadAttach,message:this.props.message,ref:"compose",onClose:this.onClose,responseMode:this.state.responseMode,closeOnEscape:!0})):null}});if(h.a.isMobile)var pe=i(44).default;var me,fe=B.b.createClass({displayName:"ReactEmailPreview",componentDisplay:o.a.ComponentDisplay.Everywhere,init:function(){this.listenToDispatcher("windowResize"),this.createObservables({expandedMessages:[]}),a.default.isDemoMode()&&(a.default.reactEmailPreview=this)},onBeforeChanged:function(t,e){if(t.thread!==e.thread){var i=t.messages,r=[];if(i.length>0)for(var a=0,n=this.getLastMessage(t),o=0;o<i.length;o++){if(a++>5e3&&__infLoop&&__infLoop(a))throw new RangeError;var u=i[o];(u===n||this.isMessageUnread(u))&&r.push(u.id)}this.expandedMessages.set(r,!1),t.expandedMessages=r}},getState:function(){return{rect:this.props.pane.rect,pane:u.default.EmailPreview.openOnPane,isLoading:u.default.EmailPreview.isLoading,thread:u.default.EmailPreview.threadAttach,threadItem:u.default.EmailPreview.threadItem,messages:u.default.EmailPreview.messages,errorMessage:u.default.EmailPreview.errorMessage,messagesLoaded:u.default.EmailPreview.messagesLoaded,bottomBarHeight:h.a.isMobile&&pe.bottomBarHeight}},getLastMessage:function(t){var e=(t=t||this.state).messages,i=t.thread,r=e.length-1;return this.isMessageDraft(e[r])&&!i.getPlugin().getAttachField(i,"pendingSend")&&r--,e[r]},onEscapeKey:function(){u.default.EmailPreview.close()},isMessageDraft:function(t){return t.labelIds.indexOf("DRAFT")>=0},isMessageUnread:function(t){return t.labelIds.indexOf("UNREAD")>=0},onClickClose:function(){u.default.EmailPreview.close()},onClickArchive:function(){this.state.pane.archiveItem(!0,this.state.threadItem)},onClickLabel:function(t){this.state.pane.autocompleteLabel({elementDisplay:t.target,item:this.state.threadItem})},onClickMove:function(t){this.state.pane.autocompleteMove({elementDisplay:t.target,item:this.state.threadItem})},onClickSchedule:function(t){this.state.pane.autocompleteSchedule({elementDisplay:t.target,item:this.state.threadItem})},onClickSnooze:function(t){var e=this.state.thread.getField("accountID");this.state.pane.autocompleteSnooze({elementDisplay:t.target,item:this.state.threadItem},e)},onClickUnread:function(){this.state.pane.markItemRead(!1,this.state.threadItem)},onClickDelete:function(){var t,e=this.state,i=e.pane,r=a.default.vmMain.getDefaultEmailPlugin();if(i.type===o.a.PaneMode.Gmail)this.state.pane.deleteSelected(r.isGmailItem,!0);else if(S.a.getStartItem()===e.threadItem&&(t=i.indexOfPrevVMLI(S.a.getStartIndex(),!0,!0)),e.threadItem.deleteSelf(o.a.ChangeType.Local),u.default.EmailPreview.reset(),t){var n=i.itemAtIndex(t);if(n){var s=n.getParsedText().length;S.a.selectIndex(t,s)}}},onClickPrint:function(){var t=a.default.vmMain.getDefaultEmailPlugin().createPrintURLForThread(this.state.thread);a.default.printPage(t)},onClickViewInGmail:function(){var t=a.default.vmMain.getDefaultEmailPlugin().createURLForThread(this.state.thread);a.default.openUrl(t)},onClickReply:function(t){var e=this.getLastMessage();u.default.EmailPreview.setMessageResponseMode(e.id,o.a.EmailResponseMode.Reply)},onClickReplyAll:function(t){var e=this.getLastMessage();u.default.EmailPreview.setMessageResponseMode(e.id,o.a.EmailResponseMode.ReplyAll)},onClickForward:function(t){var e=this.getLastMessage();u.default.EmailPreview.setMessageResponseMode(e.id,o.a.EmailResponseMode.Forward)},toggleExpanded:function(t){var e=this.state.messages,i=e[t];this.expandedMessages.indexOf(i.id)>=0?!(e.length>1&&t<e.length-1)||e[t+1]&&this.isMessageDraft(e[t+1])||this.expandedMessages.remove(i.id):this.expandedMessages.push(i.id)},onClickDown:function(){this.props.pane.keyMoveDown()},onClickUp:function(){this.props.pane.keyMoveUp()},onClickMobileReply:function(){u.default.menus.openContextMenu({fn:this.renderContextMenuReply})},renderContextMenuReply:function(t){return j.a.createElement(ut.a,{key:"contextMenuGmailReply",id:"contextMenuGmailReply",className:"contextMenuMobile",element:t.element,position:"bottom"},j.a.createElement(st.a,{icon:"icon-reply",onClick:this.onClickReply},"Reply"),j.a.createElement(st.a,{icon:"icon-reply-all",onClick:this.onClickReplyAll},"Reply All"),j.a.createElement(st.a,{icon:"icon-forward",onClick:this.onClickForward},"Forward"))},render:function(){var t,e=this.state,i=this.props.pane.type===o.a.PaneMode.Gmail,r=e.thread,n=e.messages||[];if(n.length>0){for(var s=0,d=n[0],c=(r.getPlugin().getDisplayParticipants(r),d.subject||"(no subject)"),v=[],y=this.expandedMessages.get(),g=this.getLastMessage(),l=0;l<n.length;++l){if(s++>5e3&&__infLoop&&__infLoop(s))throw new RangeError;var p,m=n[l];if(this.isMessageDraft(m)){try{a.default.PAssert(624,l>0,"Should never have a draft as the first message in the list")}catch(N){a.default.reportError(N)}var f=n[l-1];p=h.a.isMobile?null:j.a.createElement(le,{key:f.id+"_draft",threadAttach:r,message:m,inReplyToMessage:f})}else{var k=y.indexOf(m.id)>=0,A=n[l-1],S=n[l+1],w=0===l||y.indexOf(A.id)>=0||this.isMessageDraft(A),L=l>=n.length-2||y.indexOf(S.id)>=0||this.isMessageDraft(S);p=j.a.createElement(ge,{key:m.id,index:l,threadAttach:r,message:m,toggleExpanded:this.toggleExpanded.bind(this,l),expanded:k,isLastMessage:m===g,prevExpanded:w,nextExpanded:L})}v.push(p)}t=j.a.createElement("div",{className:"emailMessages c-background c-border c-foreground",style:{opacity:e.messagesLoaded?1:0}},v)}else t=e.isLoading?j.a.createElement(ft,{center:!0},"Loading messages..."):e.errorMessage?j.a.createElement("div",{className:"noMessages center"},e.errorMessage):j.a.createElement("div",{className:"noMessages center"},"No conversation selected");var F=a.default.classNames("emailPreview c-background c-border",{noClick:u.default.PaneManager.isResizingPane},{transition:!u.default.PaneManager.isResizingPane}),C={};h.a.isMobile?C.left=e.rect.left:(C.width=e.rect.widthExpanded,C[h.a.transform.react]="translate("+(e.rect.left+e.rect.width)+"px,0)");var I=h.a.isMobile?"#444":void 0,P=a.default.classNames("emailPreviewTop c-foreground c-background c-border-light",{hasBorder:n.length>0});return h.a.isMobile?j.a.createElement("div",{className:F,style:C},j.a.createElement("div",{className:"emailPreviewTop c-border c-foreground"},j.a.createElement(at.a,{className:"closeButton",icon:"icon-angle-left",iconSize:24,width:a.default.topBarHeight,height:a.default.topBarHeight,color:I,onClick:this.onClickClose,tooltip:"Close"}),i&&j.a.createElement(at.a,{icon:"icon-angle-up",iconSize:24,width:a.default.topBarHeight,height:a.default.topBarHeight,onClick:this.onClickUp}),i&&j.a.createElement(at.a,{icon:"icon-angle-down",iconSize:24,width:a.default.topBarHeight,height:a.default.topBarHeight,onClick:this.onClickDown})),j.a.createElement(Zt.a,{className:"emailMessagesScroller"},j.a.createElement("div",{className:"emailHeaderMobile"},j.a.createElement("div",{className:"emailSubject bold"},c)),t),j.a.createElement("div",{className:"emailPreviewBottom flexbox",style:{height:o.a.MobileBottomHeight}},j.a.createElement(at.a,{icon:"icon-tag",iconSize:19,width:36,height:o.a.MobileBottomHeight,onClick:this.onClickLabel}),j.a.createElement(at.a,{icon:"icon-align-left",iconSize:19,width:36,height:o.a.MobileBottomHeight,onClick:this.onClickMove}),j.a.createElement(at.a,{icon:"icon-access_time",iconSize:21,width:36,height:o.a.MobileBottomHeight,onClick:this.onClickSnooze}),j.a.createElement(at.a,{icon:"icon-check",iconSize:24,width:36,height:o.a.MobileBottomHeight,onClick:this.onClickArchive}),j.a.createElement(at.a,{icon:"icon-delete",iconSize:24,width:36,height:o.a.MobileBottomHeight,onClick:this.onClickDelete})),j.a.createElement(at.a,{className:"mobileAddButton emailReply",icon:"icon-reply",iconSize:24,width:50,height:50,style:{bottom:e.bottomBarHeight+24},onClick:this.onClickMobileReply})):j.a.createElement("div",{className:F,style:C},j.a.createElement("div",{className:P},n.length>0&&j.a.createElement(j.a.Fragment,null,j.a.createElement("div",{className:"emailHeaderRow"},j.a.createElement("div",{className:"emailButtons"},j.a.createElement(at.a,{icon:"icon-check",iconSize:17,width:36,height:36,tooltip:"Archive (E)",onClick:this.onClickArchive}),j.a.createElement(at.a,{icon:"icon-access_time",iconSize:17,width:36,height:36,tooltip:"Snooze (D)",onClick:this.onClickSnooze}),j.a.createElement(at.a,{icon:"icon-unread icon-unread-header",iconSize:15,width:36,height:36,tooltip:"Mark Unread (U)",onClick:this.onClickUnread}),j.a.createElement(at.a,{icon:"icon-tag",iconSize:15,width:36,height:36,tooltip:"Label (L)",onClick:this.onClickLabel}),j.a.createElement(at.a,{icon:"icon-align-left",iconSize:15,width:36,height:36,tooltip:"Add to Outline (M)",onClick:this.onClickMove}),j.a.createElement(at.a,{icon:"icon-calendar",iconSize:15,width:36,height:36,tooltip:"Add to Calendar (C)",onClick:this.onClickSchedule}),j.a.createElement(at.a,{icon:"icon-delete",iconSize:18,width:36,height:36,tooltip:"Delete (Backspace)",onClick:this.onClickDelete}),!h.a.app&&j.a.createElement(at.a,{icon:"icon-print",iconSize:18,width:36,height:36,tooltip:"Print (P)",onClick:this.onClickPrint}),j.a.createElement(at.a,{icon:"icon-gmail",iconSize:15,width:36,height:36,tooltip:"Open in Gmail (G)",onClick:this.onClickViewInGmail}))),j.a.createElement("div",{className:"emailHeaderRow emailSubject"},c)),j.a.createElement(at.a,{className:"closeButton",icon:"icon-close",iconSize:18,width:40,height:40,color:I,onClick:this.onClickClose,tooltip:"Close"})),j.a.createElement(Zt.a,{className:"emailMessagesScroller"},t))}}),ke=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"getState",value:function(){return{toasts:u.default.toasts.queue}}},{key:"render",value:function(){for(var t=0,e=this.state,i=[],r=0;r<e.toasts.length;r++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var n=e.toasts[r];a.default.classNames("toast noSelect",{hasAction:!!n.actionText},{big:n.isBig});i.push(j.a.createElement(Qt,{key:n.id,toast:n}))}return j.a.createElement(Z.CSSTransitionGroup,{id:"toasts",transitionName:"reactFade",transitionEnterTimeout:800,transitionLeaveTimeout:100},i)}}]),e}(B.a),Ae=B.b.createClass({displayName:"ReactMobileKeyboardToolbar",componentDisplay:o.a.ComponentDisplay.Mobile,init:function(){this.createObservables({isPriorityVisible:!1})},getState:function(){var t=F;return{panes:u.default.PaneManager.displayPanes,position:t.bottomPosition,mode:t.mode,pane:a.default.focusedPane}},onMount:function(){this.refs.toolbarButtons&&(this.refs.toolbarButtons.scrollLeft=F.getScroll())},onUnmount:function(){this.refs.toolbarButtons&&F.setScroll(this.refs.toolbarButtons.scrollLeft)},openAutocomplete:function(t){S.a.isValid()&&T.a.startMobileAutocomplete({owner:S.a.getStartItem(),pane:S.a.getPane(),index:S.a.getStartIndex(),start:S.a.getStartOffset(),element:S.a.getStartElement(),mode:t})},insertCharacter:function(t,e){u.default.menus.isContextMenuOpen()||S.a.isValid()&&S.a.insertTextAtCaret(t,e)},onClickOutdent:function(){u.default.menus.isContextMenuOpen()||S.a.fireKeyEvent(void 0,{normCode:o.a.KeyCode.Tab,shiftKey:!0})},onClickIndent:function(){u.default.menus.isContextMenuOpen()||S.a.fireKeyEvent(void 0,{normCode:o.a.KeyCode.Tab,shiftKey:!1})},onClickOpenPriority:function(){this.state.mode===o.a.KeyboardToolbarMode.Search?a.default.getActiveSearch().addToValue("!"):this.isPriorityVisible.set(!this.isPriorityVisible.get())},onClickNote:function(){if(S.a.isValid()){var t=S.a.getStartItem();h.a.ios&&u.default.menus.isContextMenuOpen()&&a.default.focusedPane.closeNoteContextMenu(),t&&(k.e.beginAction(),(t.hasNote()||t.isNote())&&u.default.menus.isContextMenuOpen()&&u.default.menus.closeContextMenu(),S.a.editNote(t),k.e.endAction())}},onClickDate:function(){this.state.mode===o.a.KeyboardToolbarMode.Search||(u.default.menus.openContextMenu({componentName:"ReactContextMenuDate",item:S.a.getStartItem(),pane:a.default.focusedPane}),k.e.miscAction({type:k.c.Mobile}))},onClickContact:function(){this.state.mode===o.a.KeyboardToolbarMode.Search?a.default.getActiveSearch().addToValue(o.a.ContactPrefix):this.openAutocomplete("contact")},onClickTag:function(){this.state.mode===o.a.KeyboardToolbarMode.Search?a.default.getActiveSearch().addToValue(o.a.TagPrefix):this.openAutocomplete("tag")},onClickPrefix:function(t){if(!u.default.menus.isContextMenuOpen()&&S.a.isValid()){var e=S.a.getStartItem();t=e.prefix===t?null:t,e.setPrefix(t)}},onClickClose:function(){S.a.closeKeyboard(),F.hide()},onClickMove:function(){this.state.pane.autocompleteMove({position:"autocomplete"})},onClickClosePriority:function(){this.isPriorityVisible.set(!1)},onClickP0:function(){this.state.pane.applyPriorityToSelection(o.a.VMLIFlag.P0,!0)},onClickP1:function(){this.state.pane.applyPriorityToSelection(o.a.VMLIFlag.P1,!0)},onClickP2:function(){this.state.pane.applyPriorityToSelection(o.a.VMLIFlag.P2,!0)},onClickStar:function(){a.default.focusedPane.applyFnToSelection("setStarred",{toggle:"isStarred",value2:o.a.ChangeType.Local})},render:function(){var t=this.state,e=t.mode,i=o.a.KeyboardToolbarMode,r=this.state.pane,n=o.a.KeyboardToolbarHeight,s={bottom:t.position},d=h.a.windowWidth()-n,c=Math.floor(d/n),v=d-c*n,y=c<12?n-Math.round((n/2-v)/c):n,g=e!==i.Modal?j.a.createElement("div",{id:"mobileToolbarButtons",className:"flexbox"},j.a.createElement("div",{className:"f1"}),j.a.createElement("div",{className:"toolbarButtonsLeft",ref:"toolbarButtons"},e===i.Item&&r.type===o.a.PaneMode.Task&&r.isViewOutline()&&j.a.createElement(at.a,{icon:"icon-format_indent_decrease",width:y,height:n,iconSize:18,onClick:this.onClickOutdent}),e===i.Item&&r.type===o.a.PaneMode.Task&&r.isViewOutline()&&j.a.createElement(at.a,{icon:"icon-format_indent_increase",width:y,height:n,iconSize:18,onClick:this.onClickIndent}),e!==i.Search&&j.a.createElement(at.a,{id:"keyboardButtonHeader",icon:"icon-project",width:y,height:n,iconSize:20,onClick:this.onClickPrefix.bind(this,o.a.Prefix.Header)}),e!==i.Search&&j.a.createElement(at.a,{icon:"prefixTask",width:y,height:n,iconSize:24,onClick:this.onClickPrefix.bind(this,o.a.Prefix.Task)}),e!==i.Search&&j.a.createElement(at.a,{icon:"icon-bullet",width:y,height:n,iconSize:30,onClick:this.onClickPrefix.bind(this,o.a.Prefix.Bullet)}),e!==i.Search&&j.a.createElement(at.a,{icon:"icon-numlist",width:y,height:n,iconSize:16,onClick:this.onClickPrefix.bind(this,o.a.Prefix.NumList)}),e!==i.Search&&j.a.createElement(at.a,{icon:"icon-align-left",color:a.default.colorBlue,width:y,height:n,iconSize:18,onClick:this.onClickMove}),e!==i.Search&&j.a.createElement(at.a,{icon:"icon-sticky-note-o",width:y,height:n,iconSize:18,onClick:this.onClickNote}),j.a.createElement(at.a,{icon:"icon-calendar",color:u.default.DisplaySettings.dateColor(),width:y,height:n,iconSize:20,onClick:this.onClickDate}),j.a.createElement(at.a,{icon:"icon-user",color:u.default.DisplaySettings.contactColor(),width:y,height:n,iconSize:24,onClick:this.onClickContact}),j.a.createElement(at.a,{className:"tagIcon",color:u.default.DisplaySettings.tagColor(),width:y,height:n,fontSize:22,onClick:this.onClickTag},"#"),e!==i.Search&&j.a.createElement(at.a,{className:"exclamationIcon",width:y,height:n,fontSize:22,onClick:this.onClickOpenPriority},"!")),j.a.createElement("div",{className:"toolbarButtonsRight"},j.a.createElement("div",{className:"keyboardButtonSkew"}),h.a.isMobile&&(h.a.iphone||h.a.android)&&j.a.createElement(at.a,{id:"closeKeyboardButton",icon:"icon-angle-down",width:n,height:n,iconSize:24,onClick:this.onClickClose}))):j.a.createElement("div",{id:"mobileToolbarButtons",className:"flexbox"},j.a.createElement("div",{className:"f1"}),j.a.createElement(at.a,{icon:"icon-angle-down",width:n,height:n,iconSize:26,onClick:this.onClickClose}));return!(e===i.Modal&&h.a.ipad)&&j.a.createElement("div",{id:"mobileKeyboardToolbar",style:s},t.isPriorityVisible&&j.a.createElement("div",{id:"priorityMenu"},j.a.createElement(at.a,{className:"priorityButton",width:n,height:n,onClick:this.onClickP2},j.a.createElement("div",{className:"p2Button"})),j.a.createElement(at.a,{className:"priorityButton",width:n,height:n,onClick:this.onClickP1},j.a.createElement("div",{className:"p1Button"})),j.a.createElement(at.a,{className:"priorityButton",width:n,height:n,onClick:this.onClickP0},j.a.createElement("div",{className:"p0Button"})),j.a.createElement(at.a,{icon:"icon-star",width:n,height:n,iconSize:22,onClick:this.onClickStar}),j.a.createElement(at.a,{icon:"icon-angle-down",width:n,height:n,iconSize:24,onClick:this.onClickClosePriority})),g)}}),Se=B.b.createClass({displayName:"ReactMobileMultiselect",componentDisplay:o.a.ComponentDisplay.Mobile,init:function(){this.createObservables({inc:0})},getState:function(){var t=$.default;return{offset:t.multiselectOffset,isAnimating:t.multiselectAnimate,isOpen:t.isInMultiselect(),numSelected:_.a.numSelected}},applyFn:function(t,e,i){var r=this.props.pane;"gmailDelete"===e?r.deleteSelected(r.plugin.isGmailItem,!0):"gmailUndelete"===e?r.deleteSelected(r.plugin.isGmailItem,!1):"gmailArchive"===e?r.archiveSelected(!0):"gmailUnarchive"===e?r.archiveSelected(!1):"markRead"===e?r.markReadSelected(!0):"markUnread"===e?r.markReadSelected(!1):"gmailStar"===e?r.toggleStarSelected():"move"===e?r.autocompleteMove({position:"autocomplete"},_.a.reset):"snooze"===e?r.autocompleteSnooze({position:"autocomplete"}):"label"===e?r.autocompleteLabel({position:"autocomplete"}):(u.default.PaneUpdateBatcher.beginUpdateItems(),k.e.beginAction(),_.a.applyFnToSelected(function(t){t.isNote()||(void 0!==i?t[e](i,o.a.ChangeType.Local):t[e](o.a.ChangeType.Local))},this.props.pane),k.e.endAction(),u.default.PaneUpdateBatcher.commitUpdateItems(),"deleteSelf"===e&&_.a.reset())},checkComplete:function(t){return!t.isComplete()},checkStarred:function(t){return!t.isStarred()},checkP0:function(t){return t.getPriority()===o.a.VMLIFlag.P0?o.a.VMLIFlag.None:o.a.VMLIFlag.P0},checkP1:function(t){return t.getPriority()===o.a.VMLIFlag.P1?o.a.VMLIFlag.None:o.a.VMLIFlag.P1},checkP2:function(t){return t.getPriority()===o.a.VMLIFlag.P2?o.a.VMLIFlag.None:o.a.VMLIFlag.P2},onClick:function(t,e){var i=this.props.pane;if(_.a.getSelected(i).length>0){var r,a=_.a.getFirstSelectedItem(i);if(a)t&&this[t]&&(r=this[t](a)),this.applyFn(a,e,r),this.inc.set(this.inc.get()+1)}},renderButton:function(t,e,i,r,a){return j.a.createElement("div",{key:e,className:"f1 multiselectButton flexbox"},j.a.createElement(at.a,{icon:e,width:o.a.RightMenuWidth,enabled:this.state.numSelected>0&&!1!==a,iconSize:24,onClick:this.onClick.bind(this,r,i)},t))},renderPriorityButton:function(){var t=a.default.classNames("f1 priorityButtons flexbox flexvert",{disabled:this.state.numSelected<1});return j.a.createElement("div",{key:"priority",className:t,style:{justifyContent:"center"}},j.a.createElement("div",null,j.a.createElement(at.a,{icon:"priorityButton p0Button",width:30,height:30,iconSize:24,onClick:this.onClick.bind(this,"checkP0","priority")}),j.a.createElement(at.a,{icon:"priorityButton p1Button",width:30,height:30,iconSize:24,onClick:this.onClick.bind(this,"checkP1","priority")}),j.a.createElement(at.a,{icon:"priorityButton p2Button",width:30,height:30,iconSize:24,onClick:this.onClick.bind(this,"checkP2","priority")})),j.a.createElement("div",{className:"fancyButtonText"},"Priority"))},render:function(){var t,e=this.state,i=this.props.pane,r=e.numSelected,n=a.default.classNames("flexbox flexvert",{open:e.isOpen}),u={top:a.default.topBarHeight,bottom:this.props.bottom},s=[];if(e.isAnimating||(u[h.a.transform.react]="translate3d("+(e.offset+100)+"px,0,0)"),r&&(t=_.a.getFirstSelectedItem(i)),i.type===o.a.PaneMode.Gmail){var d=i.plugin,c=t&&d.isItemUnread(t),v=t&&d.isItemStarred(t),y=t&&d.isItemArchived(t),g=t&&d.isItemFullTrashed(t),l=t&&t.getAttachmentByPlugin(d.id),p=t&&l&&P.a.isAuthorizedForScopes("accountID",[o.a.GScope.GmailModify]);s=[this.renderButton(y?"Unarchive":"Archive","icon-check",y?"gmailUnarchive":"gmailArchive"),this.renderButton("Mark "+(c?"Read":"Unread"),"icon-unread",c?"markRead":"markUnread"),this.renderButton(v?"Unstar":"Star","icon-star","gmailStar"),this.renderPriorityButton(),this.renderButton("Label","icon-tag","label"),this.renderButton("Move","icon-align-left","move"),this.renderButton("Snooze","icon-access_time","snooze",null,p),this.renderButton(g?"Undelete":"Delete","icon-delete",g?"gmailUndelete":"gmailDelete")]}else{var m=t&&t.isComplete();v=t&&t.isStarred();s=[this.renderButton(m?"Uncomplete":"Complete","icon-check","setComplete","checkComplete"),this.renderButton(v?"Unstar":"Star","icon-star","setStarred","checkStarred"),this.renderPriorityButton(),this.renderButton("Move","icon-align-left","move"),this.renderButton("Delete","icon-delete","deleteSelf")]}return j.a.createElement(Z.CSSTransitionGroup,{id:"mobileUIMultiselectWrapper",transitionName:"reactAnimMultiselect",transitionEnterTimeout:150,transitionLeaveTimeout:150},e.isOpen&&j.a.createElement("div",{id:"mobileUIMultiselect",className:n,style:u},s))}}),we=B.b.createClass({displayName:"ReactMobileUI",componentDisplay:o.a.ComponentDisplay.Mobile,init:function(){this.DISABLE_LISTENER_ASSERT=!0,this.listenToDispatcher(u.default.pluginManager,"pluginActiveChanged");var t=u.default.pluginManager.getPlugin(o.a.PluginID.Gmail);t.onSettingChanged(t.Settings.IsEnabled,this.updateState)},getState:function(){var t=a.default.vmMain,e=S.a.pane.get(),i={pane:S.a.pane,paneExpanded:e.isExpanded,hasPremiumFeatures:u.default.billingManager.hasPremiumFeaturesObservable,canAddItem:e.canAddItem,multiselectOffset:$.default.multiselectOffset,isGmailPaneEnabled:u.default.pluginManager.isGmailPaneEnabled(),isDragging:u.default.DragDrop.isVisible,bottomBarHeight:$.default.bottomBarHeight};return i.showAddButton=!$.default.isInMultiselect()&&!u.default.DragDrop.isVisible.get()&&!u.default.menus.isContextMenuOpen()&&!e.isExpanded.get(),i.onlineText=t.onlineText(),i},switchPane:function(t,e){var i=this.state.pane;i.type===t&&i.getViewMode()===e||(a.default.vmMain.switchPaneMobile(t,e),u.default.menus.closeContextMenu(),$.default.setMultiselectVisibility(!1)),this.refreshListeners()},onClickAdd:function(t){this.state.pane.onTapAddItem(t)},renderButton:function(t,e,i,r,a){var n=this.state.pane;return j.a.createElement(at.a,{className:"f1",icon:r,primary:n.type===t&&(t!==o.a.PaneMode.Task||n.getViewMode()===e),iconSize:a,width:o.a.MobileBottomHeight,height:o.a.MobileBottomHeight,ripple:!1,onClick:this.switchPane.bind(this,t,e)},i)},render:function(){var t=this.state,e=this.state.pane,i=t.bottomBarHeight,r={bottom:i&&i+24},n=a.default.classNames("mobileAddButton",{outline:e.type===o.a.PaneMode.Task},{email:e.type===o.a.PaneMode.Gmail}),u={height:i,display:t.paneExpanded?"none":void 0};return j.a.createElement("div",{id:"mobileUI"},j.a.createElement(Se,{pane:e,bottom:i}),j.a.createElement("div",{id:"mobileUIBottom",className:"mobileUIBottom",style:u},t.onlineText&&j.a.createElement("div",{className:"mobileOnlineStatus"},t.onlineText),j.a.createElement("div",{id:"mobileBottomBar",className:"flexbox"},t.isGmailPaneEnabled&&this.renderButton(o.a.PaneMode.Gmail,void 0,"Gmail","icon-mail_outline",18),this.renderButton(o.a.PaneMode.Task,o.a.TaskViewMode.Outline,"Tasks","icon-align-left",19),this.renderButton(o.a.PaneMode.Task,o.a.TaskViewMode.Agenda_All,"Agenda","icon-calendar",20))),t.showAddButton&&j.a.createElement(at.a,{icon:"icon-add",className:n,width:50,height:50,color:"white",iconSize:24,style:r,onClick:this.onClickAdd}))}}),Le=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"init",value:function(){this.listenToDispatcher("windowResize")}},{key:"getState",value:function(){var t=this.updatePosition();return{left:t.left,top:t.top}}},{key:"onMount",value:function(){h.a.isMobile||this.updateState()}},{key:"updatePosition",value:function(){var t,e=this.props.tip,i=document.documentElement.getBoundingClientRect(),r=this.refs.element;if(e.element)t=e.element.getBoundingClientRect();else try{a.default.PAssert(1229,!1,"Adjust bounds had no valid tip for determining an offset",e)}catch(v){a.default.reportError(v)}if(t){if(r){var n,o,s=a.default.width(r),h=a.default.height(r),d=t.left+t.width/2-s/2,c=e&&e.offset;return e&&(e.onRight||a.default.findParentID(e.element,"desktopMenu",8))&&(o=!0,c={left:8+u.default.DesktopUI.getSidebarWidth()+((c?c.left:0)||0)}),n=o?t.top+(t.height-h)/2:e&&e.above||t.bottom+h>i.bottom?t.top-h:t.bottom,c?(c.x?d+=c.x:c.right?d=i.right-s-c.right:c.left&&(d=c.left),c.y?n+=c.y:c.top&&(n+=c.top)):e&&e.above?n-=5:n+=5,d+s>i.right?d=i.right-s-4:d<0&&(d=4),n<0&&(n=4),{left:d=Math.round(d),top:n=Math.round(n)}}return{left:t.left,top:t.top}}}},{key:"onClick",value:function(){u.default.tooltip.hideSticky(this.props.tip.text)}},{key:"render",value:function(){var t=this.state,e=this.props.tip,i=e.text+(e.hotkey?'<div class="tooltipHotkey">'+e.hotkey+"</div>":""),r=a.default.classNames("tooltip flexbox flexvert",{blue:e.blue},{sticky:e.sticky},{hasHotkey:e.hotkey},{noFormat:i.indexOf("<b>")<0},{arrowDirection:e.arrowDirection}),n=a.default.classNames("tooltipArrow c-tooltip c-shadow-popup",e.arrowClass),o={maxWidth:e.maxWidth};return o[h.a.transform.react]="translate3d("+t.left+"px,"+t.top+"px,0)",j.a.createElement("div",{className:r,style:o,onClick:this.onClick,ref:"element"},j.a.createElement("div",{className:n}),j.a.createElement("div",{className:"tooltipText c-tooltip c-shadow-popup",dangerouslySetInnerHTML:{__html:i}}))}}]),e}(B.a),Fe=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"getState",value:function(){return{tooltip:u.default.tooltip.tooltip,tooltipsSticky:u.default.tooltip.tooltipsSticky}}},{key:"render",value:function(){var t=this.state,e=t.tooltip?t.tooltipsSticky.concat(t.tooltip):t.tooltipsSticky;return e.length>0?j.a.createElement("div",{className:"tooltips"},e.map(function(t){return j.a.createElement(Le,{key:t.text,tip:t})})):null}}]),e}(B.a),Ce=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"init",value:function(){this.useFirebaseLogin=!h.a.isMobile}},{key:"getState",value:function(){var t=u.default.setup;return{loginStatus:t.loginStatus,popupClosedError:t.popupClosedError,shouldShowLogin:t.shouldShowLogin(),gapiFailedToLoad:t.gapiFailedToLoad,loggedOutByAuthFailure:t.loggedOutByAuthFailure}}},{key:"onClickLogin",value:function(){u.default.setup.userLogin()}},{key:"onClickLanding",value:function(t){(h.a.isMobile||a.default.hasClass(t.target,"link"))&&a.default.openUrl("https://www.moo.do",t)}},{key:"onClickDownloadApp",value:function(){a.default.openUrl(h.a.getAppDownloadURL())}},{key:"onClickPrivacy",value:function(t){(h.a.isMobile||a.default.hasClass(t.target,"link"))&&a.default.openUrl("https://www.moo.do/privacy/",t)}},{key:"render",value:function(){var t=this.state,e=t.popupClosedError,i=t.loggedOutByAuthFailure,r=u.default.setup;return j.a.createElement("div",{id:"setupWrapper",className:"flexbox flexvert"},j.a.createElement("div",{id:"setupInner"},j.a.createElement("div",{id:"loginInfo"},j.a.createElement("div",{id:"setupLogo"})),j.a.createElement("div",{id:"setupBox"},j.a.createElement("div",{id:"login"},r.showLogin&&j.a.createElement("div",{id:"loginArea"},j.a.createElement("div",{className:"loginButton google",onClick:this.onClickLogin}),!h.a.ios&&j.a.createElement("div",{id:"learnButton",onClick:this.onClickLanding},"Learn more at ",j.a.createElement("b",{className:"link"},"https://moo.do"))),e&&j.a.createElement("div",{className:"popupClosedError red"},e),i&&j.a.createElement("div",{className:"popupClosedError"},"Logged out due to an error connecting to Google. If you are using a privacy plugin such as Ghostery or Privacy Badger, please disable them or download the app below."),r.showLogin&&r.showDownload&&j.a.createElement("div",{className:"textInLine"},j.a.createElement("div",null,"or")),r.showDownload&&j.a.createElement("div",{id:"setupDownloadArea"},j.a.createElement("div",{className:"loginButton black",onClick:this.onClickDownloadApp},j.a.createElement("span",{className:h.a.getPlatformIcon()}),j.a.createElement("span",{className:"signInText"},r.downloadText)))))))}}]),e}(B.a),Ie=i(90),Pe=i(100);!function(t){t[t.PluginSelect=0]="PluginSelect",t[t.Encrypt=1]="Encrypt",t[t.ImportData=2]="ImportData"}(me||(me={}));var Ne,He,Me=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"init",value:function(){var t=h.a.isMobile?me.Encrypt:me.PluginSelect;t===me.Encrypt&&u.default.settings.userEncryptionSentinel.get()&&t++,this.createObservables({page:t,colorTheme:o.a.ColorTheme.Light,errorGapiImport:"",modal:void 0,errorEncrypt:""}),P.a.ensureGapi(),n.a.removeURLParam("ispremium",!0)}},{key:"getState",value:function(){return{modalStack:u.default.menus.modalStack,isGapiLoaded:P.a.isGapiLoaded,loadState:s.a.loadState}}},{key:"onAfterChanged",value:function(t,e){t.modal?t.modal&&0===t.modalStack.length&&this.modal.set(void 0):this.getModal(t)}},{key:"getModal",value:function(t){var e=this,r=t.modalStack;r&&r.length>0&&(r[0].id===o.a.Modals.EnterCode?Promise.all([i.e(0),i.e(2)]).then(i.bind(null,454)).then(function(t){e.modal.set(t.default)}):r[0].id===o.a.Modals.ImportMoodo?Promise.all([i.e(0),i.e(2)]).then(i.bind(null,466)).then(function(t){e.modal.set(t.default)}):r[0].id===o.a.Modals.ConfirmEncrypt&&Promise.all([i.e(0),i.e(2)]).then(i.bind(null,467)).then(function(t){e.modal.set(t.default)}))}},{key:"nextPage",value:function(){var t=this.page.get()+1;(h.a.isMobile&&t===me.Encrypt||t===me.Encrypt&&u.default.settings.userEncryptionSentinel.get())&&t++,this.page.set(t)}},{key:"onClickEnable",value:function(){var t=this,e=(this.state.page,[o.a.PluginID.Contacts,o.a.PluginID.GCalendar,o.a.PluginID.Gmail,o.a.PluginID.Drive].filter(function(e){return t.refs[e].getValue()})),i=e.map(function(e){return e===o.a.PluginID.Drive?{id:e,shared:t.refs.DriveShared.getValue()}:{id:e}});z.a.enablePlugins(i,!1,function(i){i&&(u.default.billingManager.hasPremiumFeatures()||(e.indexOf(o.a.PluginID.Drive)>=0||e.indexOf(o.a.PluginID.GCalendar)>=0)&&u.default.billingManager.startTrial(),t.nextPage())})}},{key:"onChangeDrive",value:function(t){this.onChangeFeature(t),t||this.refs.DriveShared.setValue(!1)}},{key:"onChangeDriveShared",value:function(t){this.onChangeFeature(t),t&&this.refs[o.a.PluginID.Drive].setValue(!0)}},{key:"onChangeFree",value:function(t){this.refs[o.a.PluginID.Contacts].setValue(t),this.refs[o.a.PluginID.Gmail].setValue(t)}},{key:"onChangePremium",value:function(t){this.refs[o.a.PluginID.GCalendar].setValue(t),this.refs[o.a.PluginID.Drive].setValue(t),this.refs.DriveShared.setValue(t)}},{key:"checkTier",value:function(t,e){for(var i=0,r=0,a=0;a<e.length;a++){if(i++>5e3&&__infLoop&&__infLoop(i))throw new RangeError;this.refs[e[a]].getValue()?r++:r--}r===e.length&&t.setValue(!0),r===-e.length&&t.setValue(!1)}},{key:"onChangeFeature",value:function(t){this.checkTier(this.refs.free,[o.a.PluginID.Contacts,o.a.PluginID.Gmail]),this.checkTier(this.refs.premium,[o.a.PluginID.GCalendar,o.a.PluginID.Drive,"DriveShared"])}},{key:"onClickImport",value:function(t){this.startFresh(),u.default.menus.openModal(o.a.Modals.ImportData,{importer:t})}},{key:"startFresh",value:function(){h.a.isMobile?u.default.PaneManager.loadPanesFromState(!0,!0):tt.a.createDefaultState()}},{key:"onClickImportMoodo",value:function(t,e){(new Pe.a).authAndImportDocuments()}},{key:"onClickSkipEncryption",value:function(){this.nextPage()}},{key:"onClickSaveEncrypt",value:function(){var t=this,e=this.refs.pass1.getValue(),i=this.refs.pass2.getValue(),a=o.a.EncryptionKeys.UserPassword;e?e!==i?this.errorEncrypt.set("Passwords do not match"):e.length<5?this.errorEncrypt.set("Password is too short. Please enter a longer password to make it secure."):u.default.menus.confirmEncrypt(e,function(i){i&&(t.nextPage(),u.default.crypto.addKey({name:a,password:e,sentinelSalt:r.a.getEncryptionUid()}).then(function(t){se.a.updateUserEncryption(t)}))}):this.errorEncrypt.set("No password entered")}},{key:"renderModal",value:function(t){var e=this.state.modalStack[0];return j.a.createElement(this.state.modal,J()({noBackdrop:!0},e))}},{key:"renderPage",value:function(t){switch(t){case me.PluginSelect:return this.renderPagePluginSelect();case me.Encrypt:return this.renderPageEncryptionKey();case me.ImportData:return this.renderPageImportData();default:try{a.default.PAssert(623,!1,"Invalid intro page requested: "+t)}catch(e){a.default.reportError(e)}}}},{key:"renderConnecting",value:function(){return j.a.createElement("div",{key:"content"},j.a.createElement("div",{className:"flexbox flex-center",style:{margin:"64px 0"}},j.a.createElement(ft,{center:!0},"Connecting...")))}},{key:"renderPagePluginSelect",value:function(){return j.a.createElement("div",{key:"content",className:"pageConnect"},j.a.createElement("div",{className:"setupTitle"},"Connect with Google Services"),j.a.createElement("div",{className:"setupFeatures featureCheckboxes"},j.a.createElement("div",{className:"featureTier c-border"},j.a.createElement("div",{className:"tierTitleWrapper"},j.a.createElement(Ie.a,{ref:"free",className:"tierTitle c-background",checked:!0,onChange:this.onChangeFree},"Free Features")),j.a.createElement("div",{className:"flexbox"},j.a.createElement("div",{className:"setupFeatureHalf"},j.a.createElement(Ie.a,{ref:o.a.PluginID.Contacts,checked:!0,onChange:this.onChangeFeature},j.a.createElement("img",{src:"/img/plugin-gcontacts.png"}),"Google Contacts")),j.a.createElement("div",{className:"setupFeatureHalf"},j.a.createElement(Ie.a,{ref:o.a.PluginID.Gmail,checked:!0,onChange:this.onChangeFeature},j.a.createElement("img",{src:"/img/plugin-gmail.png"}),"Gmail")))),j.a.createElement("div",{className:"featureTier c-border"},j.a.createElement("div",{className:"tierTitleWrapper"},j.a.createElement(Ie.a,{ref:"premium",className:"tierTitle c-background",checked:!0,onChange:this.onChangePremium},"Premium Features")),!u.default.billingManager.hasPremiumFeatures()&&j.a.createElement("div",{className:"featureTierDesc c-foreground-light",style:{marginTop:-8}},"Enabling Premium features will start a free "+o.a.TrialDuration+" day trial of Moo.do Premium."),j.a.createElement("div",{className:"flexbox"},j.a.createElement("div",{className:"setupFeature setupFeatureHalf"},j.a.createElement(Ie.a,{ref:o.a.PluginID.GCalendar,checked:!0,onChange:this.onChangeFeature},j.a.createElement("img",{src:"/img/plugin-gcal.png"}),"Google Calendar")),j.a.createElement("div",{className:"setupFeature setupFeatureHalf"},j.a.createElement(Ie.a,{ref:o.a.PluginID.Drive,checked:!0,onChange:this.onChangeDrive},j.a.createElement("img",{src:"/img/plugin-gdrive.png"}),"Google Drive"),j.a.createElement(Ie.a,{ref:"DriveShared",checked:!0,className:"subcheckbox",onChange:this.onChangeDriveShared},"Share files with collaborators")))),j.a.createElement("div",{className:"setupSubtext"},j.a.createElement("b",null,"Moo.do")," interacts with your Google services only client-side and your data is never sent to any server or shared with anyone. See our ",j.a.createElement("span",{className:"link"},"Privacy Policy")," for more details."),j.a.createElement("div",{className:"setupButtons center"},j.a.createElement(at.a,{raised:!0,primary:!0,onClick:this.onClickEnable},"NEXT"))))}},{key:"renderPageEncryptionKey",value:function(){var t=this.state.errorEncrypt,e={marginTop:8,width:240};return j.a.createElement("div",{key:"content"},j.a.createElement("div",{className:"setupTitle"},"Password protect your data"),j.a.createElement("div",{className:"welcomeEncryption"},j.a.createElement("div",{className:"modal-subtext c-foreground-faded"},"Your data is encrypted client-side before sending it to the database. Enter your own password for the encryption to make it even more secure. This is totally optional. Your data is already encrypted, but this makes it so that even the developers cannot read your data."),j.a.createElement("div",{style:{marginTop:24}},j.a.createElement(rt.a,{type:"password",placeholder:"Password",ref:"pass1",style:e}),j.a.createElement(rt.a,{type:"password",placeholder:"Confirm Password",ref:"pass2",style:e})),j.a.createElement("div",{className:"modal-warning flexbox c-warning"},j.a.createElement("i",{className:"icon-warning"}),j.a.createElement("div",null,"For your security, Moo.do cannot recover your password, so keep your password safe!")),t&&j.a.createElement("div",{className:"error",style:{marginTop:8}},t),j.a.createElement("div",{style:{marginTop:24}},j.a.createElement(at.a,{raised:!0,onClick:this.onClickSkipEncryption},"SKIP"),j.a.createElement(at.a,{raised:!0,primary:!0,marginLeft:24,onClick:this.onClickSaveEncrypt},"SAVE"))))}},{key:"renderPageImportData",value:function(){var t=this;return h.a.isMobile?j.a.createElement("div",{key:"content",className:"flexbox flexvert",style:{height:"100%"}},j.a.createElement("div",null,j.a.createElement("div",{className:"setupTitle"},"Coming from the old Moo.do?"),j.a.createElement("div",{className:"modal-subtext c-foreground-faded",style:{marginTop:16}},"You will be able to import your Premium status, billing data, and files from the old database using the desktop version of Moo.do."),j.a.createElement("div",{style:{marginTop:48}},j.a.createElement(at.a,{raised:!0,onClick:this.startFresh},"OKAY")))):j.a.createElement("div",{key:"content"},j.a.createElement("div",{className:"setupTitle"},"Coming from the old Moo.do?"),j.a.createElement("div",{className:"modal-subtext c-foreground-faded",style:{marginTop:12}},"Please import your Premium status, billing data, and files from the old database"),j.a.createElement("div",{style:{margin:"32px 0"}},j.a.createElement(at.a,{raised:!0,enabled:this.state.isGapiLoaded,onClick:this.onClickImportMoodo},"Import from Moo.do")),j.a.createElement("hr",{style:{width:600,margin:"32px auto"}}),j.a.createElement("div",{className:"setupTitle"},"Import from another app"),j.a.createElement("div",{className:"modal-subtext c-foreground-faded",style:{marginTop:12}},"Copy your data from another app into Moo.do"),j.a.createElement("div",{className:"flexbox flex-center importWrapper",style:{marginTop:32}},j.a.createElement("div",{className:"welcomeImporters"},["Wunderlist","Workflowy","Trello","Google Tasks","Todoist"].map(function(e,i){return j.a.createElement(at.a,{key:i,raised:!0,onClick:t.onClickImport.bind(t,e)},e)}))),j.a.createElement("hr",{style:{width:200,margin:"32px auto"}}),j.a.createElement("div",{className:"setupTitle"},"Just start fresh"),j.a.createElement("div",{className:"modal-subtext c-foreground-faded",style:{marginTop:12}},"Start from scratch with an empty document. You can always import your data later."),j.a.createElement("div",{style:{marginTop:32}},j.a.createElement(at.a,{raised:!0,onClick:this.startFresh},"Get Started")))}},{key:"render",value:function(){var t=this.state.loadState,e=a.default.classNames("welcome c-background",{"flexbox flexvert flex-center":!h.a.isMobile}),i=t!==o.a.LoadState.Connected,r=this.state.modal,n=h.a.isMobile?{height:"100%"}:{width:720};return j.a.createElement("div",{className:e},j.a.createElement("div",{style:n},r&&this.renderModal(r),!r&&(i?this.renderConnecting():this.renderPage(this.state.page))))}}]),e}(B.a),ze=function(t){function e(){return c()(this,e),R()(this,K()(e).apply(this,arguments))}return b()(e,t),y()(e,[{key:"getState",value:function(){return{hasUpdate:u.default.AppCache.hasUpdate,ignoreUpdate:u.default.AppCache.ignoreUpdate}}},{key:"onClickClose",value:function(){u.default.AppCache.ignoreUpdate.set(!0)}},{key:"onClickLog",value:function(){a.default.openUrl("https://www.moo.do/changelog/")}},{key:"onClickUpdate",value:function(){a.default.reload()}},{key:"render",value:function(){if(this.state.hasUpdate&&!this.state.ignoreUpdate){var t=h.a.isMobile?50:32,e=h.a.isMobile?void 0:11,i={lineHeight:t+"px"};return h.a.isMobile?i.bottom=o.a.MobileBottomHeight+6:u.default.settings.showSidebar.get()?(i.bottom=6,i.left=u.default.settings.sidebarWidth.get()+6):(i.top=o.a.DesktopToolbarHeight+6,i.right=6),j.a.createElement("div",{id:"updateMessage",className:"flexbox",style:i},j.a.createElement(at.a,{color:"white",height:t,icon:"icon-close",onClick:this.onClickClose}),j.a.createElement("div",{className:"updateMessageText f1"},"A new update is available"),j.a.createElement(at.a,{color:"white",height:t,fontSize:e,padding:12,onClick:this.onClickLog},"LOG"),j.a.createElement(at.a,{color:"white",height:t,fontSize:e,padding:12,onClick:this.onClickUpdate},"UPDATE"))}return null}}]),e}(B.a),De=B.b.createClass({displayName:"ReactMainMobile",componentDisplay:o.a.ComponentDisplay.Mobile,init:function(){var t=this;this.createObservables({modulesLoaded:!1,disablePointerEvents:!1,ReactModalEnterCode:void 0}),setTimeout(function(){var e=2;Promise.all([i.e(0),i.e(2)]).then(i.bind(null,468)).then(function(i){Ne=i.default,0===--e&&t.modulesLoaded.set(!0)}),Promise.all([i.e(0),i.e(2)]).then(i.bind(null,465)).then(function(i){He=i.default,0===--e&&t.modulesLoaded.set(!0)})},100);var e=h.a.blockClient();if(void 0!==e){a.default.errorPlatformInfo=e;var r,n=e.platform;n?e.update?"iOS App"===n?r="Please update your iOS app to the latest version in the App Store.":"Android App"===n?r="Please update your Android app to the latest version in the Play Store.":"Native Android"===n?r="Please update your Android device to use Moo.do. Moo.do requires at least Android 2.1.":"Internet Explorer"===n?r='Please update your Internet Explorer browser to use Moo.do. Moo.do requires at least Internet Explorer 10. See <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie">http://windows.microsoft.com/en-us/internet-explorer/download-ie</a> for more information.':"Safari"===n&&h.a.isMobile&&(r="Please update your "+h.a.OSName+" to use Moo.do. Moo.do requires at least iOS 6."):r="Sorry, we don't support "+n+" yet. Please let us know that you're interested in using "+n+" and we will make it a higher priority. Thanks!":!e.needsApp||a.default.isDemoMode()||h.a.isDevURL?e.version?r="Please update your app to the latest version of Moo.do.":e.cacheUpdate&&(r="There was an issue while updating the app, "+h.a.actionVerb()+" to try again.",u.default.AppCache.update()):r="Moo.do cannot be run inside the browser. Please download the Moo.do app from the "+(h.a.ios?"App":"Play")+" store.",h.a.app&&u.default.nativeBridge.sendToApp("localLoaded"),r&&(this.platformError=r)}},onMount:function(){$.default.init(),this.setPanesContainer(),document.addEventListener("keydown",this.keydown),document.addEventListener("keypress",this.keypress),document.addEventListener("keyup",this.keyup),this.listenToDispatcher("panesChanged")},componentDidUpdate:function(){this.setPanesContainer()},setPanesContainer:function(){var t=this.props.main;t.panesContainer||(t.panesContainer=this.refs.panes)},_isOkToSendKey:function(t){return!t.defaultPrevented&&S.a.getPane()&&!(u.default.menus.isContextMenuOpen()&&!u.default.menus.isAutocompleteOpen())&&!u.default.menus.isModalOpen()&&!this.props.main.activeInput.get()},keydown:function(t){if(this._isOkToSendKey(t)&&S.a.getPane().keydown(t),t.target===document.body&&t.normCode===o.a.KeyCode.Backspace)return t.handled=!0,t.preventDefault(),!1},keypress:function(t){this._isOkToSendKey(t)&&S.a.getPane().keypress(t)},keyup:function(t){this._isOkToSendKey(t)&&S.a.getPane().keyup(t)},onMouseDownPanes:function(t){"panes"===t.target.id&&S.a.reset()},getState:function(){var t=this.props.main,e=u.default.PaneManager,i=S.a.pane.get(),r={panes:e.displayPanes,documents:s.a.documentsArray,failedInitialDocLoad:t.failedInitialDocLoad,isDragging:u.default.DragDrop.isVisible,isDraggingPane:u.default.DragDrop.isDraggingPane,isLoading:e.isLoading,isKeyboardOpen:F.isVisible,activeUser:u.default.settings.activeUser,isMainRendered:t.isRendered,showMarkdown:u.default.settings.showMarkdown,modalStack:u.default.menus.modalStack,pane:S.a.pane},a=i?i.type:o.a.PaneMode.Task,n=i?i.getViewMode():o.a.TaskViewMode.Outline,d=e.indexOfPaneType(a,n);return r.mobilePaneOffset=d*h.a.windowWidth(),r},onAfterChanged:function(t,e){var r=this;this.getEnterCodeModal(t)&&!t.ReactModalEnterCode&&Promise.all([i.e(0),i.e(2)]).then(i.bind(null,454)).then(function(t){r.ReactModalEnterCode.set(t.default)})},getEnterCodeModal:function(t){var e=t.modalStack;if(e&&e.length>0&&e[0].id===o.a.Modals.EnterCode)return e[0]},onClickErrorRefresh:function(){u.default.AppCache.runOnFinish(function(){a.default.reload(!u.default.AppCache.useServiceWorker)})},onClickErrorDownload:function(){a.default.openUrl(h.a.getAppDownloadURL())},render:function(){for(var t,e=0,i=this.state,r=[],n=0;n<i.panes.length;++n){if(e++>5e3&&__infLoop&&__infLoop(e))throw new RangeError;var s=i.panes[n],d=s.type,c=s.pane;if("overview"===d)r.push(j.a.createElement(ve,{key:"overview"+c.id,pane:c})),c.isActive.get()&&(t=!0);else if("pane"===d)switch(c.type){case o.a.PaneMode.Task:r.push(j.a.createElement(xt,{key:"pane"+c.id,pane:c}));break;case o.a.PaneMode.Archived:case o.a.PaneMode.Drive:r.push(j.a.createElement(Ut,{key:"pane"+c.id,pane:c}));break;case o.a.PaneMode.Gmail:r.push(j.a.createElement(bt,{key:"pane"+c.id,pane:c}));break;default:try{a.default.PAssert(238,!1,"Invalid pane mode requested"+c.type)}catch(k){a.default.reportError(k)}}else"emailPreview"===d&&r.push(j.a.createElement(fe,{key:"emailPreview"+c.id,pane:c}))}var v,y,g,l=a.default.classNames("renderedContent c-foreground",{draggingItems:!!i.isDragging||i.isDraggingPane},{draggingPane:i.isDraggingPane},{overviewOpen:t},{hideMDMarkup:!i.showMarkdown});if(u.default.settings.activeUser.get()){if(this.platformError)y=j.a.createElement("div",{className:"centerVHFlex",style:{width:"100%",lineHeight:1.5}},j.a.createElement("div",null,j.a.createElement("div",{dangerouslySetInnerHTML:{__html:this.platformError}}),j.a.createElement("br",null),j.a.createElement("br",null),j.a.createElement(at.a,{display:"block",onClick:this.onClickErrorRefresh},"Reload"),j.a.createElement("br",null),j.a.createElement(at.a,{display:"block",onClick:this.onClickErrorDownload},"Download app")));else if(i.isMainRendered)if(!i.isLoading||a.default.isDemoMode()||i.failedInitialDocLoad)if(0===i.documents.length||0===i.panes.length)y=j.a.createElement("div",{id:"container"},j.a.createElement(Me,null));else{var p={},m=a.default.classNames("panes",{transition:i.animatePaneSwap});p[h.a.transform.react]="translate("+-i.mobilePaneOffset+"px,0)",g=j.a.createElement(Z.CSSTransitionGroup,{className:m,id:"panes",ref:"panes","data-moo-id":"panes",transitionName:"reactMobilePaneAnim",transitionEnterTimeout:o.a.EmailOpenTimeMobile,transitionLeaveTimeout:o.a.EmailOpenTimeMobile,style:p},r),y=j.a.createElement("div",{id:"container",key:"renderedContent",className:l},j.a.createElement("div",{id:"measureText"},j.a.createElement("div",{id:"measureTextItem"})),g,this.props.main.getDefaultEmailPlugin()&&j.a.createElement(re,null),Ne&&j.a.createElement(Ne,null),He&&j.a.createElement(He,null),j.a.createElement(Ot,null),j.a.createElement(ke,null),j.a.createElement(Fe,null),i.panes.length>0&&j.a.createElement(we,null),j.a.createElement(ze,null),i.isKeyboardOpen&&j.a.createElement(Ae,null))}else if(i.ReactModalEnterCode&&i.modalStack.length>0){var f=this.state.ReactModalEnterCode&&this.getEnterCodeModal(this.state);y=j.a.createElement(i.ReactModalEnterCode,J()({isPassword:!0,noBackdrop:!0},f))}else v=j.a.createElement("div",{key:"loadingRemote",id:"loadingRemote",className:"centerVH"},j.a.createElement("div",{className:"loading loading20"}),j.a.createElement("div",{className:"loadingText"},"Loading file"))}else y=j.a.createElement(Ce,null);return j.a.createElement(Z.CSSTransitionGroup,{transitionName:"reactFadeMain",transitionEnterTimeout:800,transitionLeaveTimeout:100},y,v)}});e.default=function(){var t,e,i,n,d,c;a.default.checkpoint(o.a.Checkpoint.RequireLoaded),a.default.isDemoMode()||r.a.init(),u.default.init(),s.a.init();try{var v=function(){h.a.updateOrientation(),h.a.isMobile&&(a.default.keyboardToolbar&&a.default.keyboardToolbar.isVisible.get()&&a.default.keyboardToolbar.updatePosition(!0),document.body.scrollTop=0,a.default.keyboardToolbar&&a.default.keyboardToolbar.hideTopBarIfLandscape())};0,window.__ERRORINMAINHEADER&&a.default.reportError(window.__ERRORINMAINHEADER);try{a.default.PAssert(108,-1===navigator.userAgent.indexOf("Electron")||h.a.appPlatform===o.a.AppPlatform.Electron,"Electron app missing app platform set")}catch(k){a.default.reportError(k)}a.default.checkpoint(o.a.Checkpoint.PageLoad);try{a.default.PAssert(109,"loading"!==document.readyState,"Should only be calling mainjs after document is loaded"+document.readyState)}catch(k){a.default.reportError(k)}if("loading"===document.readyState){var y="ERROR: MainJS running before document load! "+document.readyState;a.default.shouldLog(o.a.LogLevels.Error)&&a.default.log(y),a.default.reportError(new Error(y))}for(var g in window.scriptErrors)window.scriptErrors.hasOwnProperty(g)&&a.default.fireCustomEvent("scriptLoadError",{src:g,id:window.scriptErrors[g],firstChance:!0});if(window.scriptErrors=window.scriptErrors||{},window.handleLoadError=function(t){try{window.scriptErrors[t.target.src]=t.target.id,a.default.fireCustomEvent("scriptLoadError",{src:t.target.src,id:t.target.id,firstChance:!1})}catch(e){a.default.reportError(e)}},window.oncontextmenu=function(t){a.default.isKeyboardInputElement(t.target)||t.preventDefault()},a.default.isDemoMode()||h.a.offline)   ;else t=window,e=document,i="script",n="ga",t.GoogleAnalyticsObject=n,t.ga=t.ga||function(){(t.ga.q=t.ga.q||[]).push(arguments)},t.ga.l=1*new Date,d=e.createElement(i),c=e.getElementsByTagName(i)[0],d.async=1,d.src="//www.google-analytics.com/analytics.js",c.parentNode.insertBefore(d,c),ga("create","UA-37740918-2",{cookieDomain:"auto"}),ga("send","pageview");h.a.updateBodyClass();var l=function(t){document.documentElement.addEventListener(t,function(t){a.default.reportEvent(t)},!0)};0,l("keydown"),l("keyup"),l("keypress"),l("MSPointerDown"),l("MSPointerUp"),l("MSPointerHover"),l("MSPointerCancel"),l("mousedown"),l("mouseup"),l("touchstart"),l("touchend"),u.default.AppCache.init(),a.default.localDocChangeRequested=!1;var m=function t(e){var i=h.a.getActualWindowWidth(),n=h.a.getActualWindowHeight();try{a.default.PAssert(111,0!==i&&!isNaN(i)&&0!==n&&!isNaN(n),"Window size is 0",i,n)}catch(k){a.default.reportError(k)}var o=h.a.windowWidth(!0),u=h.a.windowHeight(!0);h.a.ipad&&!h.a.app&&!0!==e&&!1!==e&&setTimeout(t,0,!0),i===o&&n===u||(h.a.setWindowSize(i,n),h.a.onResize.notify(),a.default.documentHeight=n,r.a.onActiveUser(function(){var t=n-u,r=(h.a.android||h.a.mobileie)&&n>u&&(!h.a.app||t<=h.a.getKBSize())&&a.default.vmMain&&a.default.isLoaded;r&&a.default.blurActiveElement(),r&&T.a.hide(),o!==i&&e&&h.a.isMobile&&a.default.focusedPane&&(h.a.isMobile&&a.default.focusedPane&&a.default.focusedPane.updatePositionMobile(),a.default.isKeyboardOpen&&a.default.focusedPane.addPadding()),h.a.isMobile||p.a.fireEvent("windowResize",[])}))};m(!1),v(),a.default.shouldLog(o.a.LogLevels.Timing)&&a.default.log("Running main.js: ",log.now()),window.onblur=function(){a.default.hasFocus=!1},window.onfocus=function(){a.default.hasFocus=!0};new G;if(h.a.isMobile&&!h.a.android){window.addEventListener("resize",function(){a.default.animFrameOnce("windowResize",m)})}else window.addEventListener("resize",m);window.addEventListener("orientationchange",v),window.addEventListener("dragstart",function(t){return t.preventDefault(),!1}),window.addEventListener("dragover",function(t){return t.preventDefault(),!1});var f=!1;s.a.loadLocal(function(t){f||(f=!0,a.default.checkpoint(o.a.Checkpoint.InitializeMain),a.default.registerEvent("ItemCreated","ItemAction","Create"),a.default.registerEvent("ItemCompleted","ItemAction","Complete"),function(){try{!0,a.default.checkpoint(o.a.Checkpoint.OnInitializedData),a.default.isDemoMode()||(a.default.vmMain.setupDateRollover(),window.addEventListener("focus",a.default.vmMain.ensureDateRollover)),a.default.vmMain.loadData(),a.default.shouldLog(o.a.LogLevels.Timing)&&a.default.log("Data done loading: ",log.now())}catch(t){a.default.reportError(t)}}())}),!a.default.isDemoMode()&&h.a.app&&u.default.nativeBridge.sendToApp("loaded"),X.a.render(j.a.createElement(De,{main:a.default.vmMain}),document.getElementById("outerWrapper"))}catch(A){console.log(A),a.default.handleCriticalError(),a.default.reportError(A,"Critical Error")}}},function(t,e,i){"use strict";var r=i(7),a=i.n(r),n=i(8),o=i.n(n),u=i(17),s=i.n(u),h=i(9),d=i.n(h),c=i(18),v=i.n(c),y=i(0),g=i(1),l=i(4),p=i(3),m=i(2),f=i.n(m),k=i(20),A=i(22),S=i(13),w=i(5),L=i(60),F=["#4D4D4D","#999999","#CCCCCC","#FFFFFF","#F44E3B","#FE9200","#FCDC00","#A4DD00","#68CCCA","#73D8FF","#AEA1FF","#FDA1FF","#333333","#808080","#BBBBBB","#EEEEEE","#D33115","#E27300","#FCC400","#22AA66","#16A5A5","#0099DD","#7B64FF","#FA28FF","#000000","#666666","#AAAAAA","#DDDDDD","#AA3300","#C45100","#FB9E00","#194D33","#0C797D","#0062B1","#653294","#AB149E"],C={hex3:/^(#)([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^(#)([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/},I=function(t){function e(){return a()(this,e),s()(this,d()(e).apply(this,arguments))}return v()(e,t),o()(e,[{key:"init",value:function(){this.createObservables({color:this.props.color,value:this.props.color,isValid:!0}),w.a.reset()}},{key:"parseColor",value:function(t){var e;return(e=C.hex3.exec(t))?"#"+e[2]+e[2]+e[3]+e[3]+e[4]+e[4]:(e=C.hex6.exec(t))?t:void 0}},{key:"onClickColor",value:function(t){this.color.set(t),this.value.set(t),this.props.onChange(t)}},{key:"onChangeInputColor",value:function(t){var e=t.target.value.toUpperCase();0!==e.indexOf("#")&&(e="#"+e);var i=this.parseColor(e);i&&(this.color.set(i),this.props.onChange(i)),e.length<8&&this.value.set(e),this.isValid.set(!!this.parseColor(this.value.get()))}},{key:"onChangeInputComponent",value:function(){var t=this.refs,e=+t.r.value,i=+t.g.value,r=+t.b.value;if(e>=0&&e<=255&&i>=0&&i<=255&&r>=0&&r<=255){var a="#"+y.default.rgbToHex(e,i,r);this.value.set(a),this.color.set(a),this.props.onChange(a)}}},{key:"render",value:function(){for(var t=0,e=this.state,i=this.state.color,r=y.default.hexToRgb(i),a=[],n=0;n<F.length;n++){if(t++>5e3&&__infLoop&&__infLoop(t))throw new RangeError;var o=F[n],u=y.default.classNames("fancyColor",{selected:o===i},{isWhite:"#FFFFFF"===o.toUpperCase()}),s={background:o};a.push(f.a.createElement("div",{key:o,className:u,style:s,onClick:this.onClickColor.bind(this,o)}))}var h=y.default.classNames("fancyColorInputColor",{invalid:!e.isValid});return f.a.createElement(L.a,{id:"fancyColorPicker",element:this.props.element,positionOffset:{left:-120,top:4}},f.a.createElement("div",{className:"fancyColors"},a),f.a.createElement("div",{className:"fancyColorText"},f.a.createElement("div",{key:i,className:"fancyColor",style:{background:i}}),f.a.createElement("input",{type:"text",className:h,value:e.value,onChange:this.onChangeInputColor}),f.a.createElement("span",null,"R"),f.a.createElement("input",{type:"text",ref:"r",className:"fancyColorInputComponent",value:r.r,onChange:this.onChangeInputComponent}),f.a.createElement("span",null,"G"),f.a.createElement("input",{type:"text",ref:"g",className:"fancyColorInputComponent",value:r.g,onChange:this.onChangeInputComponent}),f.a.createElement("span",null,"B"),f.a.createElement("input",{type:"text",ref:"b",className:"fancyColorInputComponent",value:r.b,onChange:this.onChangeInputComponent})))}}]),e}(k.a),P=function(t){function e(){return a()(this,e),s()(this,d()(e).apply(this,arguments))}return v()(e,t),o()(e,[{key:"init",value:function(){this.createObservables({color:this.props.color})}},{key:"componentWillReceiveProps",value:function(t){t.color!==this.props.color&&this.color.set(t.color)}},{key:"openMenu",value:function(t){l.default.menus.openContextMenu({fn:this.renderContextMenu,element:t.target})}},{key:"onChange",value:function(t){this.color.set(t),this.props.onChange(t)}},{key:"renderContextMenu",value:function(t){return f.a.createElement(I,{key:"fancyColorPicker",color:this.state.color,onChange:this.onChange,element:t.element})}},{key:"render",value:function(){var t=y.default.extend({background:this.state.color,border:"1px solid #666"},this.props.style),e=y.default.classNames("fancyColor",{isWhite:"#FFFFFF"===this.state.color.toUpperCase()});return f.a.createElement("div",{className:e,style:t,onClick:this.openMenu})}}]),e}(k.a),N=/(^|\s|&nbsp;|<div>|<span>|<p>)((?:(?:((https?|ftps?):\/\/)|www)[^"<\s]+)(?![^<>]*>|[^"]*?<\/a))/gi,H=[g.a.KeyCode.LeftArrow,g.a.KeyCode.RightArrow,g.a.KeyCode.UpArrow,g.a.KeyCode.DownArrow,g.a.KeyCode.Enter,g.a.KeyCode.Escape,g.a.KeyCode.PageUp,g.a.KeyCode.PageDown],M=function(t){function e(){return a()(this,e),s()(this,d()(e).apply(this,arguments))}return v()(e,t),o()(e,[{key:"init",value:function(){this.createObservables({isFocused:this.props.focused||!1})}},{key:"onMount",value:function(){var t=this,e=this.props;if(e.value){var i=this.replaceHTMLLinks(e.value.replace(/\r?\n/g,"<br>"));this.setValue(i)}e.focused&&requestAnimationFrame(function(){t.refs.div&&t.refs.div.focus()})}},{key:"onUnmount",value:function(){this.isFocused.get()&&this.onBlur()}},{key:"focus",value:function(){y.default.isDemoRunning||this.refs.div.focus()}},{key:"blur",value:function(){this.refs.div.blur()}},{key:"setValue",value:function(t){this.refs.div.innerHTML=t}},{key:"getValue",value:function(){return this.refs.div.textContent.length>0?this.refs.div.innerHTML:""}},{key:"getTextValue",value:function(){return this.refs.div.textContent}},{key:"getElement",value:function(){return this.refs.div}},{key:"insertCharAtIndex",value:function(t,e){var i=this.refs.div,r=i.innerHTML;r=r.substr(0,e)+t+r.substr(e,r.length),i.innerHTML=r,A.default.selectElement(i,e+1),this.props.onChange&&this.props.onChange()}},{key:"onFocus",value:function(t){y.default.vmMain.activeInput.set(this),this.isFocused.set(!0),this.props.onFocus&&this.props.onFocus(t)}},{key:"onBlur",value:function(t){y.default.vmMain.activeInput.set(null),this.isFocused.set(!1),this.props.onBlur&&this.props.onBlur(t)}},{key:"hasFocus",value:function(){return this.isFocused.get()}},{key:"onEscapeKey",value:function(){this.props.onEscape&&this.props.onEscape()}},{key:"onDrop",value:function(t){this.props.onDrop&&this.props.onDrop(t.dataTransfer)}},{key:"onDragEnter",value:function(){this.props.onDrop&&y.default.addClass(this.refs.div,"dragTarget")}},{key:"onDragLeave",value:function(){this.props.onDrop&&y.default.removeClass(this.refs.div,"dragTarget")}},{key:"onKeyDown",value:function(t){if(p.a.mac&&t.metaKey||!p.a.mac&&t.ctrlKey)t.keyCode===g.a.KeyCode.U?this.onClickToolbarButton("underline"):t.keyCode===g.a.KeyCode.K?this.insertLink({target:this.refs.link.getElement()}):t.keyCode===g.a.KeyCode.H?(this.makeHeading(),y.default.preventDefault(t)):t.keyCode===g.a.KeyCode.V&&(this.__pasteWithShift=t.shiftKey);else if(!H.includes(t.keyCode)){var e=A.default._getSelectionRange();if(e){var i=e.startContainer,r=i.parentElement;"A"===r.nodeName&&r.textContent===r.getAttribute("href")&&e.startOffset===e.endOffset&&e.startOffset===r.textContent.length&&(r.replaceWith(i),A.default.selectAfterNode(i))}}this.props.onKeyDown&&this.props.onKeyDown(t)}},{key:"insertNode",value:function(t){this.focus(),A.default.deleteRangeContents(),A.default.insertNode(t),A.default.selectAfterNode(t)}},{key:"insertLink",value:function(t){var e=A.default.getSelectedText(),i=t.target;this.savedSel=A.default.getSelectionRange(),l.default.menus.openContextMenu({componentName:"ReactContextMenuInsertLink",element:i,onClosed:this.onInsertLinkClosed,onInsertLink:this.onInsertLink,text:e})}},{key:"onInsertLinkClosed",value:function(){this.savedSel&&(this.focus(),A.default.setSelectionRange(this.savedSel))}},{key:"onInsertLink",value:function(t){var e=document.createElement("a");e.href=t.url,e.innerText=t.text,this.insertNode(e)}},{key:"makeHeading",value:function(t){for(var e,i,r=0,a=window.getSelection(),n=a.rangeCount;n--;){if(r++>5e3&&__infLoop&&__infLoop(r))throw new RangeError;var o=a.getRangeAt(n),u=o.startContainer,s=o.startContainer.parentElement,h=A.default.getSelectOffsetsInElement(this.refs.div,o);if("H2"===s.nodeName)i=void 0,s.parentElement.replaceChild(u,s),A.default.selectElement(u,0,u.textContent.length);else if(h){if(!t&&h.start===h.end)return A.default.selectElement(u,0,u.textContent.length),this.makeHeading(!0);(i=document.createElement("h2")).appendChild(o.extractContents()),o.insertNode(i),e=i.textContent.length}}i&&e&&A.default.selectElement(i,0,e)}},{key:"onClickToolbarButton",value:function(t,e){y.default.isString(t)?"heading"===t?this.makeHeading():document.execCommand(t):t(e),y.default.preventAndStop(e)}},{key:"onClick",value:function(t){"A"===t.target.nodeName?y.default.openUrl(t.target.href):this.props.onClick&&this.props.onClick(t)}},{key:"onPaste",value:function(t){if(this.__pasteWithShift){var e=document.queryCommandSupported("insertText"),i=document.queryCommandSupported("paste");if(e||i){t.preventDefault();var r="";t.clipboardData||t.originalEvent.clipboardData?r=(t.originalEvent||t).clipboardData.getData("text/plain"):window.clipboardData&&(r=window.clipboardData.getData("Text")),r=r.trim();var a=e?"insertText":"paste";document.execCommand(a,!1,r)}}}},{key:"replaceHTMLLinks",value:function(t){return t.replace(N,function(t,e,i){return e+'<a href="'+i+'">'+i+"</a>"})}},{key:"onSetColor",value:function(t){document.execCommand("forecolor",!1,t)}},{key:"onChange",value:function(t){var e=t.target.innerHTML,i=this.replaceHTMLLinks(e);if(e!==i){var r=A.default._getSelectionRange(),a={start:0,end:0};r&&(a=A.default.getSelectOffsetsInElement(t.target,r)),t.target.innerHTML=i,A.default.selectElement(t.target,a.start,a.end)}this.props.onChange&&this.props.onChange(t)}},{key:"renderToolbarButton",value:function(t,e,i,r,a,n){var o=p.a.priModKey;return a="Escape"===a?a:o+" + "+a,f.a.createElement(S.a,{className:"button_"+r,icon:t,width:36,height:36,iconSize:e,onClick:this.onClickToolbarButton.bind(this,i),tooltip:r,tooltipHotkey:a,ref:n})}},{key:"render",value:function(){var t,e=this.props,i=y.default.classNames("fancyContenteditableWrapper flexbox flexvert",e.className),r=y.default.classNames("fancyContenteditable f1 c-background",{richText:e.richText}),a=!!e.spellCheck||null;return e.richText&&(t=f.a.createElement("div",{className:"fancyContenteditableToolbar c-bg-faded c-border-light"},this.renderToolbarButton("icon-format_bold",19,"bold","Bold","B"),this.renderToolbarButton("icon-format_italic",19,"italic","Italic","I"),this.renderToolbarButton("icon-format_underlined",18,"underline","Underline","U"),this.renderToolbarButton("icon-header",14,"heading","Heading","H","H1"),f.a.createElement("div",{className:"divider c-bg-autocomplete-highlight"}),this.renderToolbarButton("icon-numlist",14,"insertOrderedList","Numbered list","L"),this.renderToolbarButton("icon-bullet",26,"insertUnorderedList","Bulleted list","Option + L"),f.a.createElement("div",{className:"divider c-bg-autocomplete-highlight"}),f.a.createElement(P,{color:"#000000",onChange:this.onSetColor,style:{marginTop:11,verticalAlign:"top"}}),this.renderToolbarButton("icon-link",18,this.insertLink,"Link","K","link"),!p.a.isMobile&&e.onClickClose&&this.renderToolbarButton("icon-close",18,e.onClickClose,"Close","Escape"))),f.a.createElement("div",{className:i},t,f.a.createElement("div",{contentEditable:!1!==e.editable,className:r,style:this.props.style,ref:"div",spellCheck:a,onInput:this.onChange,onClick:this.onClick,onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onDrop:this.onDrop,onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onPaste:this.onPaste}))}}]),e}(k.a);e.a=M},,,,,,,,,,,,,,,,,function(t,e,i){"use strict";i.r(e);i(302);var r=i(25),a=i(3);function n(){document.removeEventListener("DOMContentLoaded",n,!1),window.removeEventListener("load",n,!1),a.a.demo?i(283).default():r.a.preload(function(){i(283).default()})}window.__isLoaded=!0,"complete"===document.readyState||"interactive"===document.readyState?n():(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1))},function(t,e,i){"http:"===window.location.protocol&&(window.location.hash.indexOf("state=")<0||window.location.hash.indexOf("app")<0&&window.location.hash.indexOf("appv")<0)&&(window.location=window.location.href.replace(/^http:/,"https:"));try{window.__checkpoints|=1,window.__SESSION_ID=Math.round(1e4*Math.random())+"|"+Date.now(),window.__SESSION_BEGIN=Date.now();var r=function(){};window.appEvents=window.appEvents||{kbsize:r,enterBackground:r,enterForeground:r,statusBarTap:r,closeKeyboard:r,undo:r,redo:r,notifyOAuth:r,features:r,reportLowMemory:r,pokeBackground:r},window.console||(window.console={log:function(){},error:function(){}});window.log=window.console.log.bind(window.console),window.__log=window.console.log.bind(window.console),window.__warn=window.console.warn.bind(window.console),window.__error=window.console.error.bind(window.console),window.performance&&window.performance.now?(window.log.start=window.performance.now(),window.log.now=function(){return window.performance.now()-window.log.start}):(window.log.start=Date.now(),window.performance={now:function(){return Date.now()-window.log.start}},window.log.now=window.performance.now),window.console.timeStamp||(Object.defineProperty?Object.defineProperty(window.console,"timeStamp",{value:function(){}}):window.console.timeStamp=function(){}),window.console.time||(Object.defineProperty?Object.defineProperty(console,"time",{value:function(){}}):window.console.time=function(){}),window.console.timeEnd||(Object.defineProperty?Object.defineProperty(window.console,"timeEnd",{value:function(){}}):window.console.timeEnd=function(){}),window.console.trace||(Object.defineProperty?Object.defineProperty(window.console,"trace",{value:function(){}}):window.console.trace=function(){})}catch(a){console.log("Error in main header",a),window.__ERRORINMAINHEADER=a}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(t,e,i){var r={"./af":152,"./af.js":152,"./ar":153,"./ar-dz":154,"./ar-dz.js":154,"./ar-kw":155,"./ar-kw.js":155,"./ar-ly":156,"./ar-ly.js":156,"./ar-ma":157,"./ar-ma.js":157,"./ar-sa":158,"./ar-sa.js":158,"./ar-tn":159,"./ar-tn.js":159,"./ar.js":153,"./az":160,"./az.js":160,"./be":161,"./be.js":161,"./bg":162,"./bg.js":162,"./bm":163,"./bm.js":163,"./bn":164,"./bn.js":164,"./bo":165,"./bo.js":165,"./br":166,"./br.js":166,"./bs":167,"./bs.js":167,"./ca":168,"./ca.js":168,"./cs":169,"./cs.js":169,"./cv":170,"./cv.js":170,"./cy":171,"./cy.js":171,"./da":172,"./da.js":172,"./de":173,"./de-at":174,"./de-at.js":174,"./de-ch":175,"./de-ch.js":175,"./de.js":173,"./dv":176,"./dv.js":176,"./el":177,"./el.js":177,"./en-au":178,"./en-au.js":178,"./en-ca":179,"./en-ca.js":179,"./en-gb":180,"./en-gb.js":180,"./en-ie":181,"./en-ie.js":181,"./en-il":182,"./en-il.js":182,"./en-nz":183,"./en-nz.js":183,"./eo":184,"./eo.js":184,"./es":185,"./es-do":186,"./es-do.js":186,"./es-us":187,"./es-us.js":187,"./es.js":185,"./et":188,"./et.js":188,"./eu":189,"./eu.js":189,"./fa":190,"./fa.js":190,"./fi":191,"./fi.js":191,"./fo":192,"./fo.js":192,"./fr":125,"./fr-ca":193,"./fr-ca.js":193,"./fr-ch":194,"./fr-ch.js":194,"./fr.js":125,"./fy":195,"./fy.js":195,"./gd":196,"./gd.js":196,"./gl":197,"./gl.js":197,"./gom-latn":198,"./gom-latn.js":198,"./gu":199,"./gu.js":199,"./he":200,"./he.js":200,"./hi":201,"./hi.js":201,"./hr":202,"./hr.js":202,"./hu":203,"./hu.js":203,"./hy-am":204,"./hy-am.js":204,"./id":205,"./id.js":205,"./is":206,"./is.js":206,"./it":207,"./it.js":207,"./ja":208,"./ja.js":208,"./jv":209,"./jv.js":209,"./ka":210,"./ka.js":210,"./kk":211,"./kk.js":211,"./km":212,"./km.js":212,"./kn":213,"./kn.js":213,"./ko":214,"./ko.js":214,"./ky":215,"./ky.js":215,"./lb":216,"./lb.js":216,"./lo":217,"./lo.js":217,"./lt":218,"./lt.js":218,"./lv":219,"./lv.js":219,"./me":220,"./me.js":220,"./mi":221,"./mi.js":221,"./mk":222,"./mk.js":222,"./ml":223,"./ml.js":223,"./mn":224,"./mn.js":224,"./mr":225,"./mr.js":225,"./ms":226,"./ms-my":227,"./ms-my.js":227,"./ms.js":226,"./mt":228,"./mt.js":228,"./my":229,"./my.js":229,"./nb":230,"./nb.js":230,"./ne":231,"./ne.js":231,"./nl":232,"./nl-be":233,"./nl-be.js":233,"./nl.js":232,"./nn":234,"./nn.js":234,"./pa-in":235,"./pa-in.js":235,"./pl":236,"./pl.js":236,"./pt":237,"./pt-br":238,"./pt-br.js":238,"./pt.js":237,"./ro":239,"./ro.js":239,"./ru":240,"./ru.js":240,"./sd":241,"./sd.js":241,"./se":242,"./se.js":242,"./si":243,"./si.js":243,"./sk":244,"./sk.js":244,"./sl":245,"./sl.js":245,"./sq":246,"./sq.js":246,"./sr":247,"./sr-cyrl":248,"./sr-cyrl.js":248,"./sr.js":247,"./ss":249,"./ss.js":249,"./sv":250,"./sv.js":250,"./sw":251,"./sw.js":251,"./ta":252,"./ta.js":252,"./te":253,"./te.js":253,"./tet":254,"./tet.js":254,"./tg":255,"./tg.js":255,"./th":256,"./th.js":256,"./tl-ph":257,"./tl-ph.js":257,"./tlh":258,"./tlh.js":258,"./tr":259,"./tr.js":259,"./tzl":260,"./tzl.js":260,"./tzm":261,"./tzm-latn":262,"./tzm-latn.js":262,"./tzm.js":261,"./ug-cn":263,"./ug-cn.js":263,"./uk":264,"./uk.js":264,"./ur":265,"./ur.js":265,"./uz":266,"./uz-latn":267,"./uz-latn.js":267,"./uz.js":266,"./vi":268,"./vi.js":268,"./x-pseudo":269,"./x-pseudo.js":269,"./yo":270,"./yo.js":270,"./zh-cn":271,"./zh-cn.js":271,"./zh-hk":272,"./zh-hk.js":272,"./zh-tw":273,"./zh-tw.js":273};function a(t){var e=n(t);return i(e)}function n(t){var e=r[t];if(!(e+1)){var i=new Error("Cannot find module '"+t+"'");throw i.code="MODULE_NOT_FOUND",i}return e}a.keys=function(){return Object.keys(r)},a.resolve=n,t.exports=a,a.id=332}]);
