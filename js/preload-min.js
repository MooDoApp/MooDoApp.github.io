!function(){function HelperFnsWrapper(){var e={fieldMapOut:{a:"isArchived",c:"dateCreated",d:"date",e:"duration",f:"formats",g:"durationText",h:"favorites",i:"items",k:"isNote",l:"modifiedOffline",m:"isCollapsed",n:"note",o:"modifiedOfflineText",p:"priority",r:"repeatDate",s:"dateText",t:"text",u:"versionText",v:"version",x:"isDeleted",z:"isComplete",ai:"archivedItems",ad:"allDayDate",id:"id","*":"isStarred","^":"dateCompleted"},getMapping:function(e,t){var a={};for(var r in e)if(void 0!==e[r]&&null!==e[r]){var n=t[r];n?a[n]=e[r]:a[r]=e[r]}return a},translateObjOut:function(e){return this.getMapping(e,this.fieldMapOut)}};return e}function WorkerLoaderWrapper(){function e(e,t){postMessage({id:e,done:!1,data:void 0,msg:t})}onmessage=function(t){try{var a=indexedDB.open("duchess");a.onupgradeneeded=function(r){e(t.data.id,"No pre-existing DB"),a.transaction.abort()},a.onerror=function(a){e(t.data.id,"Error opening DB: "+a.target.errorCode)},a.onsuccess=function(a){var r=a.target.result,n=[],o=r.transaction("items","readwrite");o.oncomplete=function(){r.close();try{for(var a=new Array(n.length),o=0;o<n.length;++o)a[o]=HelperFnsWrapper_.translateObjOut(n[o]);postMessage({id:t.data.id,done:!0,data:a})}catch(i){e(t.data.id,i)}close()},o.onerror=function(){e(t.data.id,"Transaction error")},o.onabort=function(){e(t.data.id,"Transaction abort")};var i=o.objectStore("items");i?i.openCursor().onsuccess=function(e){var t=e.target.result;t&&(n.push(t.value),t["continue"]())}:e(t.data.id,"No items store present")}}catch(r){e(t.data.id,r)}}}function shouldRunWorkerPreload(){var e=!1,t=navigator.userAgent,a=-1!==t.indexOf("Chrome")||-1!==t.indexOf("CriOS");return a&&-1===t.indexOf("Edge")&&(e=!0),e}function shouldRunSyncPreload(){var e=!1,t=navigator.userAgent;return-1===t.indexOf("iPad")&&-1===t.indexOf("iPhone")||(e=!0),e}function runPreload(){function e(e){console.timeStamp("Local Cache Loaded"),t.onDataLoaded?t.onDataLoaded(e):t.dataResults=e}var t=window.__preload;if(console.timeStamp("Preload Started"),!t.mainLoaded)if(shouldRunWorkerPreload()){var a=WorkerFns.createWorkerFromFnList([HelperFnsWrapper,WorkerLoaderWrapper],function(t){e(t.data.data)},function(e){console.log("Error in worker: ",e,e.message)});a&&(a.postMessage({id:1}),t.runDataLoad=!0)}else if(shouldRunSyncPreload()){t.runDataLoad=!0;try{WorkerFns.syncLoad(function(t){e(t.data)})}catch(r){t.runDataLoad=!1}}}window.Sca=function(){return{decycle:function(object,callback){function checkForCompletion(){0===queuedObjects.length&&returnCallback(derezObj)}function readBlobAsDataURL(e,t){var a=new FileReader;a.onloadend=function(a){var r=a.target.result,n="Blob";e instanceof File,updateEncodedBlob(r,t,n)},a.readAsDataURL(e)}function updateEncodedBlob(dataURL,path,blobtype){var encoded=queuedObjects.indexOf(path);path=path.replace("$","derezObj"),eval(path+'.$enc="'+dataURL+'"'),eval(path+'.$type="'+blobtype+'"'),queuedObjects.splice(encoded,1),checkForCompletion()}function derez(e,t){var a,r,n;if(!("object"!=typeof e||null===e||e instanceof Boolean||e instanceof Date||e instanceof Number||e instanceof RegExp||e instanceof Blob||e instanceof String)){for(a=0;a<objects.length;a+=1)if(objects[a]===e)return{$ref:paths[a]};if(objects.push(e),paths.push(t),"[object Array]"===Object.prototype.toString.apply(e))for(n=[],a=0;a<e.length;a+=1)n[a]=derez(e[a],t+"["+a+"]");else{n={};for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=derez(e[r],t+"["+JSON.stringify(r)+"]"))}return n}return e instanceof Blob?(queuedObjects.push(t),readBlobAsDataURL(e,t)):e instanceof Boolean?e={$type:"Boolean",$enc:e.toString()}:e instanceof Date?e={$type:"Date",$enc:e.getTime()}:e instanceof Number?e={$type:"Number",$enc:e.toString()}:e instanceof RegExp?e={$type:"RegExp",$enc:e.toString()}:"number"==typeof e?e={$type:"number",$enc:e+""}:void 0===e&&(e={$type:"undefined"}),e}var objects=[],paths=[],queuedObjects=[],returnCallback=callback,derezObj=derez(object,"$");checkForCompletion()},retrocycle:function retrocycle($){function dataURLToBlob(e){var t,a,r,n=";base64,";if(-1===e.indexOf(n))return a=e.split(","),t=a[0].split(":")[1],r=a[1],new Blob([r],{type:t});a=e.split(n),t=a[0].split(":")[1],r=window.atob(a[1]);for(var o=r.length,i=new Uint8Array(o),c=0;o>c;++c)i[c]=r.charCodeAt(c);return new Blob([i.buffer],{type:t})}function rez(value){var i,item,name,path;if(value&&"object"==typeof value)if("[object Array]"===Object.prototype.toString.apply(value))for(i=0;i<value.length;i+=1)item=value[i],item&&"object"==typeof item&&(path=item.$ref,"string"==typeof path&&px.test(path)?value[i]=eval(path):value[i]=rez(item));else if(void 0!==value.$type)switch(value.$type){case"Blob":case"File":value=dataURLToBlob(value.$enc);break;case"Boolean":value=Boolean("true"===value.$enc);break;case"Date":value=new Date(value.$enc);break;case"Number":value=Number(value.$enc);break;case"RegExp":value=eval(value.$enc);break;case"number":value=parseFloat(value.$enc);break;case"undefined":value=void 0}else for(name in value)"object"==typeof value[name]&&(item=value[name],item&&(path=item.$ref,"string"==typeof path&&px.test(path)?value[name]=eval(path):value[name]=rez(item)));return value}var px=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;return rez($)},encode:function(e,t){function a(e){t(JSON.stringify(e))}this.decycle(e,a)},decode:function(e){return this.retrocycle(JSON.parse(e))}}}();var WorkerFns={createWorkerFromObj:function(e,t,a){var r;try{r=new Worker(e),r.onmessage=t,r.onerror=a}catch(n){console.log("Exception during worker create: ",n)}return r},createWorkerFromFnList:function(e,t,a){var r=[];try{for(var n=0;n<e.length;++n)r.push(e[n].toString()),r.push(e[n].name+"_ = "+e[n].name+"();");return this.createWorkerFromStrings(r,t,a)}catch(o){console.log("Exception during worker source gen: ",o)}},createWorkerFromStrings:function(e,t,a){var r=window.URL||window.webkitURL,n=r.createObjectURL(new Blob(e,{type:"text/javascript"}));return this.createWorkerFromObj(n,t,a)},syncLoad:function(e){var t=2097152;try{var a=HelperFnsWrapper(),r=window.openDatabase("duchess",1,"duchess",t);r.readTransaction(function(t){t.executeSql("SELECT * FROM items",[],function(t,r){try{for(var n=new Array(r.rows.length),o=0;o<r.rows.length;++o)n[o]=a.translateObjOut(Sca.decode(r.rows.item(o).value));e({done:!0,data:n})}catch(i){e({done:!1,data:void 0,msg:i})}})})}catch(n){e({done:!1,data:void 0,msg:n})}}};window.__preload||(window.__preload={mainLoaded:!1}),runPreload()}();