function dateWrapper(e){this.dateLibLoaded=!0,Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"am",pmDesignator:"pm",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^sun(day)?/i,mon:/^mon(day)?/i,tue:/^tue(s(day)?)?/i,wed:/^wed(nesday)?/i,thu:/^thu(rsday)?/i,fri:e?/^friday/i:/^fri(day)?/i,sat:/^sat(urday)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,yesterday:/^yesterday/i,today:/^today/i,tomorrow:e?/^tomorrow/i:/^tom(orrow)?/i,soon:/^soon/i,later:/^later/i,now:/^now/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]},function(){var e=Date,t=e.prototype,n=e.CultureInfo,i=function(e,t){return t||(t=2),("000"+e).slice(-1*t)};t.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},t.setTimeToNow=function(){var e=new Date;return this.setHours(e.getHours()),this.setMinutes(e.getMinutes()),this.setSeconds(e.getSeconds()),this.setMilliseconds(e.getMilliseconds()),this},e.today=function(){return(new Date).clearTime()},e.compare=function(e,t){if(isNaN(e)||isNaN(t))throw new Error(e+" - "+t);if(e instanceof Date&&t instanceof Date)return t>e?-1:e>t?1:0;throw new TypeError(e+" - "+t)},e.equals=function(e,t){return 0===e.compareTo(t)},e.getDayNumberFromName=function(e){for(var t=n.dayNames,i=n.abbreviatedDayNames,o=n.shortestDayNames,r=e.toLowerCase(),a=0;a<t.length;a++)if(t[a].toLowerCase()==r||i[a].toLowerCase()==r||o[a].toLowerCase()==r)return a;return-1},e.getMonthNumberFromName=function(e){for(var t=n.monthNames,i=n.abbreviatedMonthNames,o=e.toLowerCase(),r=0;r<t.length;r++)if(t[r].toLowerCase()==o||i[r].toLowerCase()==o)return r;return-1},e.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0},e.getDaysInMonth=function(t,n){return[31,e.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][n]},e.getTimezoneAbbreviation=function(e){for(var t=n.timezones,i=0;i<t.length;i++)if(t[i].offset===e)return t[i].name;return null},e.getTimezoneOffset=function(e){for(var t=n.timezones,i=0;i<t.length;i++)if(t[i].name===e.toUpperCase())return t[i].offset;return null},t.clone=function(){var e=new Date(this.getTime());return e._explicitTime=this._explicitTime,e},t.compareTo=function(e){return Date.compare(this,e)},t.equals=function(e){return Date.equals(this,e||new Date)},t.between=function(e,t){return this.getTime()>=e.getTime()&&this.getTime()<=t.getTime()},t.isAfter=function(e){return 1===this.compareTo(e||new Date)},t.isBefore=function(e){return-1===this.compareTo(e||new Date)},t.isToday=function(){return this.isSameDay(new Date)},t.isSameDay=function(e){return this.clone().clearTime().equals(e.clone().clearTime())},t.addMilliseconds=function(e){return this.setMilliseconds(this.getMilliseconds()+e),this},t.addSeconds=function(e){return this.addMilliseconds(1e3*e)},t.addMinutes=function(e){return this.addMilliseconds(6e4*e)},t.addHours=function(e){return this.addMilliseconds(36e5*e)},t.addDays=function(e){return this.setDate(this.getDate()+e),this},t.addWeeks=function(e){return this.addDays(7*e)},t.addMonths=function(t){var n=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+t),this.setDate(Math.min(n,e.getDaysInMonth(this.getFullYear(),this.getMonth()))),this},t.addYears=function(e){return this.addMonths(12*e)},t.add=function(e){if("number"==typeof e)return this._orient=e,this;var t=e;return t.millisecond&&this.addMilliseconds(t.millisecond),t.second&&this.addSeconds(t.second),t.minute&&this.addMinutes(t.minute),t.hour&&this.addHours(t.hour),t.week&&this.addWeeks(t.week),t.month&&this.addMonths(t.month),t.years&&this.addYears(t.years),t.days&&this.addDays(t.days),t.setExplicitTime&&(this._explicitTime=!0),this};var o,r,a;t.getWeek=function(){var e,t,n,i,s,d,c,l,u,h;return o=o?o:this.getFullYear(),r=r?r:this.getMonth()+1,a=a?a:this.getDate(),2>=r?(e=o-1,t=(e/4|0)-(e/100|0)+(e/400|0),n=((e-1)/4|0)-((e-1)/100|0)+((e-1)/400|0),u=t-n,s=0,d=a-1+31*(r-1)):(e=o,t=(e/4|0)-(e/100|0)+(e/400|0),n=((e-1)/4|0)-((e-1)/100|0)+((e-1)/400|0),u=t-n,s=u+1,d=a+(153*(r-3)+2)/5+58+u),c=(e+t)%7,i=(d+c-s)%7,l=d+3-i|0,h=0>l?53-((c-u)/5|0):l>364+u?1:(l/7|0)+1,o=r=a=null,h},t.getISOWeek=function(){return o=this.getUTCFullYear(),r=this.getUTCMonth()+1,a=this.getUTCDate(),i(this.getWeek())},t.setWeek=function(e){return this.moveToDayOfWeek(1).addWeeks(e-this.getWeek())},e._validate=function(e,t,n,i){if("undefined"==typeof e)return!1;if("number"!=typeof e)throw new TypeError(e+" is not a Number.");if(t>e||e>n)throw new RangeError(e+" is not a valid value for "+i+".");return!0},e.validateMillisecond=function(t){return e._validate(t,0,999,"millisecond")},e.validateSecond=function(t){return e._validate(t,0,59,"second")},e.validateMinute=function(t){return e._validate(t,0,59,"minute")},e.validateHour=function(t){return e._validate(t,0,23,"hour")},e.validateDay=function(t,n,i){return e._validate(t,1,e.getDaysInMonth(n,i),"day")},e.validateMonth=function(t){return e._validate(t,0,11,"month")},e.validateYear=function(t){return e._validate(t,0,9999,"year")},t.set=function(t){return e.validateMillisecond(t.millisecond)&&this.addMilliseconds(t.millisecond-this.getMilliseconds()),e.validateSecond(t.second)&&this.addSeconds(t.second-this.getSeconds()),e.validateMinute(t.minute)&&this.addMinutes(t.minute-this.getMinutes()),e.validateHour(t.hour)&&this.addHours(t.hour-this.getHours()),e.validateMonth(t.month)&&this.addMonths(t.month-this.getMonth()),e.validateYear(t.year)&&this.addYears(t.year-this.getFullYear()),e.validateDay(t.day,this.getFullYear(),this.getMonth())&&this.addDays(t.day-this.getDate()),t.timezone&&this.setTimezone(t.timezone),t.timezoneOffset&&this.setTimezoneOffset(t.timezoneOffset),t.week&&e._validate(t.week,0,53,"week")&&this.setWeek(t.week),t.setExplicitTime&&(this._explicitTime=!0),this},t.moveToFirstDayOfMonth=function(){return this.set({day:1})},t.moveToLastDayOfMonth=function(){return this.set({day:e.getDaysInMonth(this.getFullYear(),this.getMonth())})},t.moveToNthOccurrence=function(e,t){var n=0;if(t>0)n=t-1;else if(-1===t)return this.moveToLastDayOfMonth(),this.getDay()!==e&&this.moveToDayOfWeek(e,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(e,1).addWeeks(n)},t.moveToDayOfWeek=function(e,t){var n=(e-this.getDay()+7*(t||1))%7;return this.addDays(0===n?n+=7*(t||1):n)},t.moveToMonth=function(e,t){var n=(e-this.getMonth()+12*(t||1))%12;return this.addMonths(0===n?n+=12*(t||1):n)},t.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1},t.getTimezone=function(){return e.getTimezoneAbbreviation(this.getUTCOffset())},t.setTimezoneOffset=function(e){var t=this.getTimezoneOffset(),n=-6*Number(e)/10;return this.addMinutes(n-t)},t.setTimezone=function(t){return this.setTimezoneOffset(e.getTimezoneOffset(t))},t.hasDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset()},t.isDaylightSavingTime=function(){return this.hasDaylightSavingTime()&&(new Date).getTimezoneOffset()===Date.today().set({month:6,day:1}).getTimezoneOffset()},t.getUTCOffset=function(){var e,t=-10*this.getTimezoneOffset()/6;return 0>t?(e=(t-1e4).toString(),e.charAt(0)+e.substr(2)):(e=(t+1e4).toString(),"+"+e.substr(1))},t.getElapsed=function(e){return(e||new Date)-this},t.toISOString||(t.toISOString=function(){function e(e){return 10>e?"0"+e:e}return'"'+this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+'Z"'}),t._toString=t.toString,t.toString=function(e){var t=this;if(e&&1==e.length){var o=n.formatPatterns;switch(t.t=t.toString,e){case"d":return t.t(o.shortDate);case"D":return t.t(o.longDate);case"F":return t.t(o.fullDateTime);case"m":return t.t(o.monthDay);case"r":return t.t(o.rfc1123);case"s":return t.t(o.sortableDateTime);case"t":return t.t(o.shortTime);case"T":return t.t(o.longTime);case"u":return t.t(o.universalSortableDateTime);case"y":return t.t(o.yearMonth)}}var r=function(e){switch(1*e){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};return e?e.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(e){if("\\"===e.charAt(0))return e.replace("\\","");switch(t.h=t.getHours,e){case"hh":return i(t.h()<13?0===t.h()?12:t.h():t.h()-12);case"h":return t.h()<13?0===t.h()?12:t.h():t.h()-12;case"HH":return i(t.h());case"H":return t.h();case"mm":return i(t.getMinutes());case"m":return t.getMinutes();case"ss":return i(t.getSeconds());case"s":return t.getSeconds();case"yyyy":return i(t.getFullYear(),4);case"yy":return i(t.getFullYear());case"dddd":return n.dayNames[t.getDay()];case"ddd":return n.abbreviatedDayNames[t.getDay()];case"dd":return i(t.getDate());case"d":return t.getDate();case"MMMM":return n.monthNames[t.getMonth()];case"MMM":return n.abbreviatedMonthNames[t.getMonth()];case"MM":return i(t.getMonth()+1);case"M":return t.getMonth()+1;case"t":return t.h()<12?n.amDesignator.substring(0,1):n.pmDesignator.substring(0,1);case"tt":return t.h()<12?n.amDesignator:n.pmDesignator;case"S":return r(t.getDate());default:return e}}):this._toString()}}(),function(){var e=Date,t=e.prototype,n=e.CultureInfo,i=Number.prototype;t._orient=1,t._nth=null,t._is=!1,t._same=!1,t._explicitTime=!1,t._isSecond=!1,i._dateElement="day",t.next=function(){return this._orient=1,this},e.next=function(){return e.today().next()},t.last=t.prev=t.previous=function(){return this._orient=-1,this},e.last=e.prev=e.previous=function(){return e.today().last()},t.is=function(){return this._is=!0,this},t.same=function(){return this._same=!0,this._isSecond=!1,this},t.today=function(){return this.same().day()},t.weekday=function(){return this._is?(this._is=!1,!this.is().sat()&&!this.is().sun()):!1},t.at=function(t){return"string"==typeof t?e.parse(this.toString("d")+" "+t):this.set(t)},i.fromNow=i.after=function(e){var t={};return t[this._dateElement]=this,(e?e.clone():new Date).add(t)},i.ago=i.before=function(e){var t={};return t[this._dateElement]=-1*this,(e?e.clone():new Date).add(t)};var o,r="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),a="january february march april may june july august september october november december".split(/\s/),s=[],d=[],c="final first second third fourth fifth".split(/\s/);t.toObject=function(){for(var e={},t=0;t<s.length;t++)e[s[t].toLowerCase()]=this["get"+d[t]]();return e},e.fromObject=function(e){return e.week=null,Date.today().set(e)};for(var l=function(t){return function(){if(this._is)return this._is=!1,this.getDay()==t;if(null!==this._nth){this._isSecond&&this.addSeconds(-1*this._orient),this._isSecond=!1;var n=this._nth;this._nth=null;var i=this.clone().moveToLastDayOfMonth();if(this.moveToNthOccurrence(t,n),this>i)throw new RangeError(e.getDayName(t)+" does not occur "+n+" times in the month of "+e.getMonthName(i.getMonth())+" "+i.getFullYear()+".");return this}return this.moveToDayOfWeek(t,this._orient)}},u=function(t){return function(){var i=e.today(),o=t-i.getDay();return(0===t&&1===n.firstDayOfWeek&&0!==i.getDay()||0>o)&&(o+=7),i.addDays(o)}},h=0;h<r.length;h++)e[r[h].toUpperCase()]=e[r[h].toUpperCase().substring(0,3)]=h,e[r[h]]=e[r[h].substring(0,3)]=u(h),t[r[h]]=t[r[h].substring(0,3)]=l(h);for(var p=function(e){return function(){return this._is?(this._is=!1,this.getMonth()===e):this.moveToMonth(e,this._orient)}},f=function(t){return function(){return e.today().set({month:t,day:1})}},m=0;m<a.length;m++)e[a[m].toUpperCase()]=e[a[m].toUpperCase().substring(0,3)]=m,e[a[m]]=e[a[m].substring(0,3)]=f(m),t[a[m]]=t[a[m].substring(0,3)]=p(m);for(var g=function(e){return function(){if(this._isSecond)return this._isSecond=!1,this;if(this._same){this._same=this._is=!1;for(var t=this.toObject(),n=(arguments[0]||new Date).toObject(),i="",o=e.toLowerCase(),r=s.length-1;r>-1;r--){if(i=s[r].toLowerCase(),t[i]!=n[i])return!1;if(o==i)break}return!0}return"s"!=e.substring(e.length-1)&&(e+="s"),this["add"+e](this._orient)}},v=function(e){return function(){return this._dateElement=e,this}},y=0;y<s.length;y++)o=s[y].toLowerCase(),t[o]=t[o+"s"]=g(s[y]),i[o]=i[o+"s"]=v(o);t._ss=g("Second");for(var b=function(e){return function(t){return this._same?this._ss(arguments[0]):t||0===t?this.moveToNthOccurrence(t,e):(this._nth=e,2!==e||void 0!==t&&null!==t?this:(this._isSecond=!0,this.addSeconds(this._orient)))}},S=0;S<c.length;S++)t[c[S]]=b(0===S?-1:S)}(),function(){Date.Parsing={Exception:function(e){this.message="Parse error at '"+e.substring(0,10)+" ...'"}};for(var e=Date.Parsing,t=e.Operators={rtoken:function(t){return function(n){var i=n.match(t);if(i)return[i[0],n.substring(i[0].length)];throw new e.Exception(n)}},token:function(){return function(e){return t.rtoken(new RegExp("^s*"+e+"s*"))(e)}},stoken:function(e){return t.rtoken(new RegExp("^"+e))},until:function(e){return function(t){for(var n=[],i=null;t.length;){try{i=e.call(this,t)}catch(o){n.push(i[0]),t=i[1];continue}break}return[n,t]}},many:function(e){return function(t){for(var n=[],i=null;t.length;){try{i=e.call(this,t)}catch(o){return[n,t]}n.push(i[0]),t=i[1]}return[n,t]}},optional:function(e){return function(t){var n=null;try{n=e.call(this,t)}catch(i){return[null,t]}return[n[0],n[1]]}},not:function(t){return function(n){try{t.call(this,n)}catch(i){return[null,n]}throw new e.Exception(n)}},ignore:function(e){return e?function(t){var n=null;return n=e.call(this,t),[null,n[1]]}:null},product:function(){for(var e=arguments[0],n=Array.prototype.slice.call(arguments,1),i=[],o=0;o<e.length;o++)i.push(t.each(e[o],n));return i},cache:function(t){var n={},i=null;return function(o){try{i=n[o]=n[o]||t.call(this,o)}catch(r){i=n[o]=r}if(i instanceof e.Exception)throw i;return i}},any:function(){var t=arguments;return function(n){for(var i=null,o=0;o<t.length;o++)if(null!=t[o]){try{i=t[o].call(this,n)}catch(r){i=null}if(i)return i}throw new e.Exception(n)}},each:function(){var t=arguments;return function(n){for(var i=[],o=null,r=0;r<t.length;r++)if(null!=t[r]){try{o=t[r].call(this,n)}catch(a){throw new e.Exception(n)}i.push(o[0]),n=o[1]}return[i,n]}},all:function(){var e=arguments,t=t;return t.each(t.optional(e))},sequence:function(n,i,o){return i=i||t.rtoken(/^\s*/),o=o||null,1==n.length?n[0]:function(t){for(var r=null,a=null,s=[],d=0;d<n.length;d++){try{r=n[d].call(this,t)}catch(c){break}s.push(r[0]);try{a=i.call(this,r[1])}catch(l){a=null;break}t=a[1]}if(!r)throw new e.Exception(t);if(a)throw new e.Exception(a[1]);if(o)try{r=o.call(this,r[1])}catch(u){throw new e.Exception(r[1])}return[s,r?r[1]:t]}},between:function(e,n,i){i=i||e;var o=t.each(t.ignore(e),n,t.ignore(i));return function(e){var t=o.call(this,e);return[[t[0][0],r[0][2]],t[1]]}},list:function(e,n,i){return n=n||t.rtoken(/^\s*/),i=i||null,e instanceof Array?t.each(t.product(e.slice(0,-1),t.ignore(n)),e.slice(-1),t.ignore(i)):t.each(t.many(t.each(e,t.ignore(n))),px,t.ignore(i))},set:function(n,i,o){return i=i||t.rtoken(/^\s*/),o=o||null,function(r){for(var a=null,s=null,d=null,c=null,l=[[],r],u=!1,h=0;h<n.length;h++){d=null,s=null,a=null,u=1==n.length;try{a=n[h].call(this,r)}catch(p){continue}if(c=[[a[0]],a[1]],a[1].length>0&&!u)try{d=i.call(this,a[1])}catch(f){u=!0}else u=!0;if(u||0!==d[1].length||(u=!0),!u){for(var m=[],g=0;g<n.length;g++)h!=g&&m.push(n[g]);s=t.set(m,i).call(this,d[1]),s[0].length>0&&(c[0]=c[0].concat(s[0]),c[1]=s[1])}if(c[1].length<l[1].length&&(l=c),0===l[1].length)break}if(0===l[0].length)return l;if(o){try{d=o.call(this,l[1])}catch(v){throw new e.Exception(l[1])}l[1]=d[1]}return l}},forward:function(e,t){return function(n){return e[t].call(this,n)}},replace:function(e,t){return function(n){var i=e.call(this,n);return[t,i[1]]}},process:function(e,t){return function(n){var i=e.call(this,n);return[t.call(this,i[0]),i[1]]}},min:function(t,n){return function(i){var o=n.call(this,i);if(o[0].length<t)throw new e.Exception(i);return o}}},n=function(e){return function(){var t=null,n=[];if(arguments.length>1?t=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(t=arguments[0]),!t)return e.apply(null,arguments);for(var i=0,o=t.shift();i<o.length;i++)return t.unshift(o[i]),n.push(e.apply(null,t)),t.shift(),n}},i="optional not ignore cache".split(/\s/),o=0;o<i.length;o++)t[i[o]]=n(t[i[o]]);for(var a=function(e){return function(){return arguments[0]instanceof Array?e.apply(null,arguments[0]):e.apply(null,arguments)}},s="each any all".split(/\s/),d=0;d<s.length;d++)t[s[d]]=a(t[s[d]])}(),function(){var e=Date,t=(e.prototype,e.CultureInfo),n=function(e){for(var t=[],i=0;i<e.length;i++)e[i]instanceof Array?t=t.concat(n(e[i])):e[i]&&t.push(e[i]);return t};e.Grammar={},e.Translator={hour:function(e){return function(){this.hour=Number(e),this.setExplicitTime=!0}},minute:function(e){return function(){this.minute=Number(e),this.setExplicitTime=!0}},second:function(e){return function(){this.second=Number(e),this.setExplicitTime=!0}},meridian:function(e){return function(){this.meridian=e.slice(0,1).toLowerCase()}},timezone:function(e){return function(){var t=e.replace(/[^\d\+\-]/g,"");t.length?this.timezoneOffset=Number(t):this.timezone=e.toLowerCase()}},day:function(e){var t=e[0];return function(){this.day=Number(t.match(/\d+/)[0])}},month:function(e){return function(){this.month=3==e.length?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(e)/4:Number(e)-1}},year:function(e){return function(){var n=Number(e);this.year=e.length>2?n:n+(n+2e3<t.twoDigitYearMax?2e3:1900)}},rday:function(e){return function(){(new Date).getDate();switch(e){case"yesterday":this.days=-1;break;case"later":this.days=5;break;case"soon":this.days=2;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(t){t=t instanceof Array?t:[t];for(var n=0;n<t.length;n++)t[n]&&t[n].call(this);var i=new Date;if(!this.hour&&!this.minute||this.month||this.year||this.day||(this.day=i.getDate()),this.year||(this.year=i.getFullYear(),this.month<i.getMonth()&&this.year++),this.month||0===this.month||(this.month=i.getMonth()),this.day||(this.day=1),this.hour||(this.hour=0),this.minute||(this.minute=0),this.second||(this.second=0),this.meridian&&this.hour&&("p"==this.meridian&&this.hour<12?this.hour=this.hour+12:"a"==this.meridian&&12==this.hour&&(this.hour=0)),this.day>e.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");var o=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);return o._explicitTime=this.setExplicitTime,this.timezone?o.set({timezone:this.timezone}):this.timezoneOffset&&o.set({timezoneOffset:this.timezoneOffset}),o},finish:function(t){if(t=t instanceof Array?n(t):[t],0===t.length)return null;for(var i=0;i<t.length;i++)"function"==typeof t[i]&&t[i].call(this);var o=e.today();if(this.now&&!this.unit&&!this.operator)return new Date;this.now&&(o=new Date);var r,a,s,d=!!this.year,c=!!(this.days&&null!==this.days||this.orient||this.operator);if(s="past"==this.orient||"subtract"==this.operator?-1:1,this.now||-1=="hour minute second".indexOf(this.unit)||o.setTimeToNow(),(this.month||0===this.month)&&-1!="year day hour minute second".indexOf(this.unit)&&(this.value=this.month+1,this.month=null,c=!0),!c&&this.weekday&&!this.day&&!this.days){var l=Date[this.weekday]();this.day=l.getDate(),this.month||(this.month=l.getMonth()),this.year=l.getFullYear()}if(c&&this.weekday&&"month"!=this.unit&&(this.unit="day",r=e.getDayNumberFromName(this.weekday)-o.getDay(),a=7,this.days=r?(r+s*a)%a:s*a),this.month&&"day"==this.unit&&this.operator&&(this.value=this.month+1,this.month=null),null!=this.value&&null!=this.month&&null!=this.year&&(this.day=1*this.value),this.month&&!this.day&&this.value&&(o.set({day:1*this.value}),c||(this.day=1*this.value)),this.month||!this.value||"month"!=this.unit||this.now||(this.month=this.value,c=!0),c&&(this.month||0===this.month)&&"year"!=this.unit&&(this.unit="month",r=this.month-o.getMonth(),a=12,this.months=r?(r+s*a)%a:s*a,this.month=null),this.unit||(this.unit="day"),!this.value&&this.operator&&null!==this.operator&&this[this.unit+"s"]&&null!==this[this.unit+"s"]?this[this.unit+"s"]=this[this.unit+"s"]+("add"==this.operator?1:-1)+(this.value||0)*s:(null==this[this.unit+"s"]||null!=this.operator)&&(this.value||(this.value=1),this[this.unit+"s"]=this.value*s),this.meridian&&this.hour&&("p"==this.meridian&&this.hour<12?this.hour=this.hour+12:"a"==this.meridian&&12==this.hour&&(this.hour=0)),this.weekday&&!this.day&&!this.days){var l=Date[this.weekday]();this.day=l.getDate(),l.getMonth()!==o.getMonth()&&(this.month=l.getMonth())}return!this.month&&0!==this.month||this.day||(this.day=1),this.orient||this.operator||"week"!=this.unit||!this.value||this.day||this.month?(c&&this.timezone&&this.day&&this.days&&(this.day=this.days),!d&&this.month<o.getMonth()&&(this.year=o.getFullYear()+1),c?o.add(this):o.set(this)):Date.today().setWeek(this.value)}};var i,o=e.Parsing.Operators,r=e.Grammar,a=e.Translator;r.datePartDelimiter=o.rtoken(/^([\s\-\.\,\/\x27]+)/),r.timePartDelimiter=o.stoken(":"),r.whiteSpace=o.rtoken(/^\s*/),r.generalDelimiter=o.rtoken(/^(([\s\,]|at|@|on)+)/);var s={};r.ctoken=function(e){var n=s[e];if(!n){for(var i=t.regexPatterns,r=e.split(/\s+/),a=[],d=0;d<r.length;d++)a.push(o.replace(o.rtoken(i[r[d]]),r[d]));n=s[e]=o.any.apply(null,a)}return n},r.ctoken2=function(e){return o.rtoken(t.regexPatterns[e])},r.h=o.cache(o.process(o.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),a.hour)),r.hh=o.cache(o.process(o.rtoken(/^(0[0-9]|1[0-2])/),a.hour)),r.H=o.cache(o.process(o.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),a.hour)),r.HH=o.cache(o.process(o.rtoken(/^([0-1][0-9]|2[0-3])/),a.hour)),r.m=o.cache(o.process(o.rtoken(/^([0-5][0-9]|[0-9])/),a.minute)),r.mm=o.cache(o.process(o.rtoken(/^[0-5][0-9]/),a.minute)),r.s=o.cache(o.process(o.rtoken(/^([0-5][0-9]|[0-9])/),a.second)),r.ss=o.cache(o.process(o.rtoken(/^[0-5][0-9]/),a.second)),r.hms=o.cache(o.sequence([r.H,r.m,r.s],r.timePartDelimiter)),r.t=o.cache(o.process(r.ctoken2("shortMeridian"),a.meridian)),r.tt=o.cache(o.process(r.ctoken2("longMeridian"),a.meridian)),r.z=o.cache(o.process(o.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),a.timezone)),r.zz=o.cache(o.process(o.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),a.timezone)),r.zzz=o.cache(o.process(r.ctoken2("timezone"),a.timezone)),r.timeSuffix=o.each(o.ignore(r.whiteSpace),o.set([r.tt,r.zzz])),r.time=o.each(o.optional(o.ignore(o.stoken("T"))),r.hms,r.timeSuffix),r.d=o.cache(o.process(o.each(o.rtoken(/^([0-2]\d|3[0-1]|\d)/),o.optional(r.ctoken2("ordinalSuffix"))),a.day)),r.dd=o.cache(o.process(o.each(o.rtoken(/^([0-2]\d|3[0-1])/),o.optional(r.ctoken2("ordinalSuffix"))),a.day)),r.rday=o.cache(o.process(r.ctoken("yesterday tomorrow soon later today now"),a.rday)),r.ddd=r.dddd=o.cache(o.process(r.ctoken("sun mon tue wed thu fri sat"),function(e){return function(){this.weekday=e}})),r.M=o.cache(o.process(o.rtoken(/^(1[0-2]|0\d|\d)/),a.month)),r.MM=o.cache(o.process(o.rtoken(/^(1[0-2]|0\d)/),a.month)),r.MMM=r.MMMM=o.cache(o.process(r.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),a.month)),r.y=o.cache(o.process(o.rtoken(/^(\d\d?)/),a.year)),r.yy=o.cache(o.process(o.rtoken(/^(\d\d)/),a.year)),r.yyy=o.cache(o.process(o.rtoken(/^(\d\d?\d?\d?)/),a.year)),r.yyyy=o.cache(o.process(o.rtoken(/^(\d\d\d\d)/),a.year)),e.refreshPatternsForVideo=function(){s={},r.rday=o.cache(o.process(r.ctoken("yesterday tomorrow soon later today now"),a.rday)),r.ddd=r.dddd=o.cache(o.process(r.ctoken("sun mon tue wed thu fri sat"),function(e){return function(){this.weekday=e}}))},i=function(){return o.each(o.any.apply(null,arguments),o.not(r.ctoken2("timeContext")))},r.day=i(r.d,r.dd,r.rday),r.month=i(r.M,r.MMM),r.year=i(r.yyyy,r.yy),r.orientation=o.process(r.ctoken("past future"),function(e){return function(){this.orient=e}}),r.value=o.process(o.rtoken(/^\d\d?(st|nd|rd|th)?/),function(e){return function(){this.value=e.replace(/\D/g,"")}}),r.expression=o.set([r.rday,r.value,r.orientation,r.ddd,r.MMM]),i=function(){return o.set(arguments,r.datePartDelimiter)},r.mdy=i(r.ddd,r.month,r.day,r.year),r.ymd=i(r.ddd,r.year,r.month,r.day),r.dmy=i(r.ddd,r.day,r.month,r.year),r.date=function(e){return(r[t.dateElementOrder]||r.mdy).call(this,e)},r.format=o.process(o.many(o.any(o.process(o.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(t){if(r[t])return r[t];throw e.Parsing.Exception(t)}),o.process(o.rtoken(/^[^dMyhHmstz]+/),function(e){return o.ignore(o.stoken(e))}))),function(e){return o.process(o.each.apply(null,e),a.finishExact)});var d={},c=function(e){return d[e]=d[e]||r.format(e)[0]};r.formats=function(e){if(e instanceof Array){for(var t=[],n=0;n<e.length;n++)t.push(c(e[n]));return o.any.apply(null,t)}return c(e)};var l=["M/d H","M-d H","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy"];r._formats=r.formats(l),r._start=o.process(o.set([r.date,r.time,r.expression],r.generalDelimiter,r.whiteSpace),a.finish),r.start=function(e){try{var t=r._formats.call({},e);if(0===t[1].length)return t}catch(n){}return r._start.call({},e)},e._parse=e.parse,e.parse=function(t){var n=null;if(!t)return null;if(t instanceof Date)return t;try{n=e.Grammar.start.call({},t.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(i){return null}return 0===n[1].length?n[0]:null},e.getParseFunction=function(t){var n=e.Grammar.formats(t);return function(e){var t=null;try{t=n.call({},e)}catch(i){return null}return 0===t[1].length?t[0]:null}},e.parseExact=function(t,n){return e.getParseFunction(n)(t)}}()}function DuchessHelpersWrapper(e){function t(e){return String(e).replace(/[&\"<>]/g,function(e){return a[e]})}function n(e){var t=e.replace(/[:,\.\'\"\)\]]$/g,"");return t}this.helperLibLoaded=!0;var i="@",o="+",r=-1==navigator.userAgent.indexOf("Mac")?"ctrl":"⌘";String.prototype.insertTag=function(e,t,n,i){return this.substr(0,e)+t+this.substr(e,n)+i+this.substr(e+n)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)});var a={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"},s=["YESTERDAY","TODAY","TOMORROW","MONDAY","TUESDAY","WEDNESDAY","THURSDAY","FRIDAY","SATURDAY","SUNDAY"],d=/(^#|[\(\s]#)([^\s\),]+)/g,c=/(?:^@|[\(\s]@)([^\s\)]{2,})(\s[^\s\)@]{2,})?(\s[^\s\)@]{2,})?/g,l=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/g,u=/(?:^|[\s\(\[])([^\(\[@\s]+\.(?:com|org|net))/gi;e.parseText=function(a,s,h,p){var f=!1,m=a,g=[];if(0===a.length)return{parsedText:void 0};var v=a,y=!1,b=a.length;a=t(a),b!==a.length&&(y=!0);var S,T,w,M=[];if(p&&p.___info___.count>0&&a.indexOf(o)>=0){for(var C=a.split(" "),x=0,I=0;I<C.length;I++){if(0===C[I].indexOf(o)){for(var E=void 0,k=C[I].substring(1),D=1;4>D;D++){var P=n(k);if(""===p[P]&&(E=P),!(I+D<C.length))break;k+=" "+C[I+D]}E&&g.push({name:E,lineIndex:x})}x+=C[I].length+1}if(g.length>0)for(var I=g.length-1;I>=0;I--)a=a.insertTag(g[I].lineIndex,'<p class="contact">',g[I].name.length+1,"</p>"),y=!0}for(d.lastIndex=0;S=d.exec(a);){var L=S.index+S[1].length-1,O=S[2].length+1;":"==S[2].charAt(S[2].length-1)&&O--,a=a.insertTag(L,'<p class="tag" title="'+r+'+click to search">',O,"</p>"),y=!0}for(c.lastIndex=0;S=c.exec(a);){for(var A,R=S[0].indexOf(i),_=!1,I=1;I<S.length&&S[I];++I)if(_)S[I]=void 0;else{var N=S[I][S[I].length-1];(":"===N||","===N||"."===N)&&(S[I]=S[I].slice(0,-1),_=!0)}A=S[1]+(S[2]?S[2]:"")+(S[3]?S[3]:"");var F=Date.parse(A);if(!F&&S[3]&&(A=S[1]+(S[2]?S[2]:""),F=Date.parse(A)),!F&&S[2]&&(A=S[1],F=Date.parse(A)),F){var V=e.computeDateInfo(s,h,F,A);if(V.replacedDate){dateLength=V.text.length+1;var B=S.index+R+1;a=a.substr(0,B)+V.text+a.substr(B+A.length),a=a.insertTag(S.index+R,'<p class="date">',dateLength,"</p>");var U=m.indexOf(A);m=m.substr(0,U)+V.text+m.substr(U+A.length),f=!0,M.push({date:V.date,text:V.text,explicitTime:F._explicitTime})}else dateLength=A.length+1,a=a.insertTag(S.index+R,'<p class="date">',dateLength,"</p>"),M.push({date:V.date,text:A,explicitTime:F._explicitTime});y=!0;break}}if(l.lastIndex=0,S=l.exec(a)){var q=S[0].startsWith("http")?S[0]:"http://"+S[0];T="<a target='_blank' href='"+q+"' title='"+r+"+click to navigate'>",w="</a>",a=a.insertTag(S.index,T,S[0].length,w),y=!0}else if(u.lastIndex=0,S=u.exec(a)){var R=S[0].length-S[1].length,q=S[1].startsWith("http")?S[1]:"http://"+S[1];T="<a target='_blank' href='"+q+"' title='"+r+"+click to navigate'>",w="</a>",a=a.insertTag(S.index+R,T,S[1].length,w),y=!0}return{text:v,styledText:a,parsedText:f?m:void 0,dates:M,hasStyle:y,numContacts:g.length}},e.computeDateInfo=function(e,t,n,i){function o(e){var t=864e5,n=new Date(e).clearTime()-(new Date).clearTime();return 0>n?n>=-t?"yesterday":e.toString("M/d"):t>=n&&e.isToday()?"today":2*t>n?"tomorrow":void 0}var r,a=i,d=!1;if(t)r=n;else if(r=new Date(e),void 0!==e&&n.getTime()!==e){if(s.indexOf(i.toUpperCase())>=0){var c=n._explicitTime;r=new Date(e);var l=o(r);l&&(a=l,c&&(a+=" "+r.toString("h:mmtt")),d=!0)}}else void 0===e&&(r=n);return{text:a,date:r,replacedDate:d}}}function parseWorkerWrapper(){DuchessHelpersWrapper&&!this.helperLibLoaded&&DuchessHelpersWrapper(this.DuchessHelpers=this.DuchessHelpers||{}),dateWrapper&&!this.dateLibLoaded&&dateWrapper(),log=postMessage;var e;onmessage=function(t){if(t.data.contacts&&(e=t.data.contacts),t.data.items){for(var n=Date.now(),i=new Array(t.data.items.length),o=0;o<t.data.items.length;o++){var r=t.data.items[o];i[o]=DuchessHelpers.parseText(r.text,r.prevDate,r.isUpdate,e)}postMessage({id:t.data.id,styles:i,done:!0,start:n,end:Date.now()})}else postMessage({id:t.data.id,done:!1,msg:"ERROR: No items passed to the worker"})}}function GoogleApiLoaded(){if(!gapiCalled){if(gapiCalled=!0,gapi.auth.init(),window.location.hash.indexOf("offline=true")>=0||window.location.hash.indexOf("offline%22:true")>=0||window.location.hash.indexOf('offline":true')>=0||window.location.hash.indexOf("demo=true")>=0)return void log("%cOffline","color: pink");gapi.client.setApiKey(window.gapiKey),gapi.client.load("drive","v2",function(){}),gapi.load("drive-realtime",function(){if(gapi&&gapi.drive&&gapi.drive.realtime)require(["globals","goog"],function(e,t){t.loadClientDefaultFile(),e.removeDOM("blockedError")});else{require(["globals","platform"],function(e,t){var n;n=gapi?gapi.drive?gapi.drive.realtime?"all exist":"gapi.drive.realtime":"gapi.drive":"gapi",gapiCalled=!1,gapiLoadError=!0,e.reportError(new Error("Drive returned load, but unable to load "+n));
var i=document.getElementById("blockedMessage");i.innerText=t.app?"There was an error loading the Google APIs, "+t.actionVerb()+" to try again.":"You may be running an extension that blocked drive.google.com from loading, Moo.do requires access to function correctly. Please re-load the page if you are not using an extension and the issue will resolve itself.",document.getElementById("blockedError").classList.remove("none"),e.vmMain&&e.vmMain.gdriveStatus(DriveStatus.Offline)})}}),require(["globals","util","platform","goog","VMSetup"],function(e,t,n,i){var o=!1;(!n.ie||n.mobile)&&(o=i.checkTokenInHash());var r=o||t.hasURLParam("login","true")||e.getLoginState()==LoginState.LOGGED_IN;i.runAuthenticate(i.requestScopes,!0,!1,function(n){t.removeURLParam("login",!0),n&&!n.error?(r&&(e.vmSetup?e.vmSetup.setLoginState(LoginState.LOGGED_IN):e.setLoginState(LoginState.LOGGED_IN),i.loadClientDefaultFile(),e.openMainPage()),i.ensureRequiredScopesAreRequested()):i.requiredScopes!==i.requestScopes?(e.settings.reset(Settings.authScopes),i.runAuthenticate(i.requiredScopes,!0,!1,function(t){t&&!t.error?r&&(e.vmSetup?e.vmSetup.setLoginState(LoginState.LOGGED_IN):e.setLoginState(LoginState.LOGGED_IN),i.loadClientDefaultFile(),e.openMainPage()):(e.vmSetup?e.vmSetup.setLoginState(LoginState.LOGGED_OUT):e.setLoginState(LoginState.LOGGED_OUT),e.openSetupPage())})):(e.vmSetup?e.vmSetup.setLoginState(LoginState.LOGGED_OUT):e.setLoginState(LoginState.LOGGED_OUT),e.openSetupPage())})})}}var requirejs,require,define;if(function(e){function t(e,t){return v.call(e,t)}function n(e,t){var n,i,o,r,a,s,d,c,l,u,h=t&&t.split("/"),p=m.map,f=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(h=h.slice(0,h.length-1),e=h.concat(e.split("/")),c=0;c<e.length;c+=1)if(u=e[c],"."===u)e.splice(c,1),c-=1;else if(".."===u){if(1===c&&(".."===e[2]||".."===e[0]))break;c>0&&(e.splice(c-1,2),c-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||f)&&p){for(n=e.split("/"),c=n.length;c>0;c-=1){if(i=n.slice(0,c).join("/"),h)for(l=h.length;l>0;l-=1)if(o=p[h.slice(0,l).join("/")],o&&(o=o[i])){r=o,a=c;break}if(r)break;!s&&f&&f[i]&&(s=f[i],d=c)}!r&&s&&(r=s,a=d),r&&(n.splice(0,a,r),e=n.join("/"))}return e}function i(t,n){return function(){return l.apply(e,y.call(arguments,0).concat([t,n]))}}function o(e){return function(t){return n(t,e)}}function r(e){return function(t){p[e]=t}}function a(n){if(t(f,n)){var i=f[n];delete f[n],g[n]=!0,c.apply(e,i)}if(!t(p,n)&&!t(g,n))throw new Error("No "+n);return p[n]}function s(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(e){return function(){return m&&m.config&&m.config[e]||{}}}var c,l,u,h,p={},f={},m={},g={},v=Object.prototype.hasOwnProperty,y=[].slice;u=function(e,t){var i,r=s(e),d=r[0];return e=r[1],d&&(d=n(d,t),i=a(d)),d?e=i&&i.normalize?i.normalize(e,o(t)):n(e,t):(e=n(e,t),r=s(e),d=r[0],e=r[1],d&&(i=a(d))),{f:d?d+"!"+e:e,n:e,pr:d,p:i}},h={require:function(e){return i(e)},exports:function(e){var t=p[e];return"undefined"!=typeof t?t:p[e]={}},module:function(e){return{id:e,uri:"",exports:p[e],config:d(e)}}},c=function(n,o,s,d){var c,l,m,v,y,b,S=[];if(d=d||n,"function"==typeof s){for(o=!o.length&&s.length?["require","exports","module"]:o,y=0;y<o.length;y+=1)if(v=u(o[y],d),l=v.f,"require"===l)S[y]=h.require(n);else if("exports"===l)S[y]=h.exports(n),b=!0;else if("module"===l)c=S[y]=h.module(n);else if(t(p,l)||t(f,l)||t(g,l))S[y]=a(l);else{if(!v.p)throw new Error(n+" missing "+l);v.p.load(v.n,i(d,!0),r(l),{}),S[y]=p[l]}m=s.apply(p[n],S),n&&(c&&c.exports!==e&&c.exports!==p[n]?p[n]=c.exports:m===e&&b||(p[n]=m))}else n&&(p[n]=s)},requirejs=require=l=function(t,n,i,o,r){return"string"==typeof t?h[t]?h[t](n):a(u(t,n).f):(t.splice||(m=t,n.splice?(t=n,n=i,i=null):t=e),n=n||function(){},"function"==typeof i&&(i=o,o=r),o?c(e,t,n,i):setTimeout(function(){c(e,t,n,i)},4),l)},l.config=function(e){return m=e,m.deps&&l(m.deps,m.callback),l},define=function(e,n,i){n.splice||(i=n,n=[]),t(p,e)||t(f,e)||(f[e]=[e,n,i])},define.amd={jQuery:!0}}(),define("lib/almond",function(){}),function(){!function(e){var t=this||(0,eval)("this"),n=t.document,i=t.navigator,o=t.jQuery,r=t.JSON;!function(e){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(module.exports||exports):"function"==typeof define&&define.amd?define("ko",["exports"],e):e(t.ko={})}(function(a){function s(e,t,n,i){c.d[e]={init:function(e){return c.a.f.set(e,p,{}),{controlsDescendantBindings:!0}},update:function(e,o,r,a,s){r=c.a.f.get(e,p),o=c.a.c(o()),a=!n!=!o;var d=!r.gb;(d||t||a!==r.wb)&&(d&&(r.gb=c.a.Pa(c.e.childNodes(e),!0)),a?(d||c.e.S(e,c.a.Pa(r.gb)),c.Ka(i?i(s,o):s,e)):c.e.ca(e),r.wb=a)}},c.g.V[e]=!1,c.e.N[e]=!0}function d(e,t,n){n&&t!==c.i.n(e)&&c.i.X(e,t),t!==c.i.n(e)&&c.o.P(c.a.Ha,null,[e,"change"])}var c="undefined"!=typeof a?a:{};c.b=function(e,t){for(var n=e.split("."),i=c,o=0;o<n.length-1;o++)i=i[n[o]];i[n[n.length-1]]=t},c.q=function(e,t,n){e[t]=n},c.version="2.3.0",c.b("version",c.version),c.a=function(){function a(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}function s(e,t){if("input"!==c.a.u(e)||!e.type||"click"!=t.toLowerCase())return!1;var n=e.type;return"checkbox"==n||"radio"==n}var d={},l={};d[i&&/Firefox\/2/i.test(i.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],d.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),a(d,function(e,t){if(t.length)for(var n=0,i=t.length;i>n;n++)l[t[n]]=e});var u={propertychange:!0},h=n&&function(){for(var t=3,i=n.createElement("div"),o=i.getElementsByTagName("i");i.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",o[0];);return t>4?t:e}(),p={__proto__:[]}instanceof Array;return{Ua:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],r:function(e,t){for(var n=0,i=e.length;i>n;n++)t(e[n])},k:function(e,t){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t);for(var n=0,i=e.length;i>n;n++)if(e[n]===t)return n;return-1},Ma:function(e,t,n){for(var i=0,o=e.length;o>i;i++)if(t.call(n,e[i]))return e[i];return null},la:function(e,t){var n=c.a.k(e,t);n>=0&&e.splice(n,1)},Na:function(e){e=e||[];for(var t=[],n=0,i=e.length;i>n;n++)0>c.a.k(t,e[n])&&t.push(e[n]);return t},$:function(e,t){e=e||[];for(var n=[],i=0,o=e.length;o>i;i++)n.push(t(e[i]));return n},Z:function(e,t){e=e||[];for(var n=[],i=0,o=e.length;o>i;i++)t(e[i])&&n.push(e[i]);return n},U:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var n=0,i=t.length;i>n;n++)e.push(t[n]);return e},ka:function(e,t,n){var i=e.indexOf?e.indexOf(t):c.a.k(e,t);0>i?n&&e.push(t):n||e.splice(i,1)},extend:function(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},w:a,pa:function(e){for(;e.firstChild;)c.removeNode(e.firstChild)},Ob:function(e){e=c.a.Q(e);for(var t=n.createElement("div"),i=0,o=e.length;o>i;i++)t.appendChild(c.J(e[i]));return t},Pa:function(e,t){for(var n=0,i=e.length,o=[];i>n;n++){var r=e[n].cloneNode(!0);o.push(t?c.J(r):r)}return o},S:function(e,t){if(c.a.pa(e),t)for(var n=0,i=t.length;i>n;n++)e.appendChild(t[n])},fb:function(e,t){var n=e.nodeType?[e]:e;if(0<n.length){for(var i=n[0],o=i.parentNode,r=0,a=t.length;a>r;r++)o.insertBefore(t[r],i);for(r=0,a=n.length;a>r;r++)c.removeNode(n[r])}},ib:function(e,t){7>h?e.setAttribute("selected",t):e.selected=t},H:function(t){return null===t||t===e?"":t.trim?t.trim():t.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},Yb:function(e,t){for(var n=[],i=(e||"").split(t),o=0,r=i.length;r>o;o++){var a=c.a.H(i[o]);""!==a&&n.push(a)}return n},Vb:function(e,t){return e=e||"",t.length>e.length?!1:e.substring(0,t.length)===t},zb:function(e,t){if(t.compareDocumentPosition)return 16==(16&t.compareDocumentPosition(e));for(;null!=e;){if(e==t)return!0;e=e.parentNode}return!1},ba:function(e){return c.a.zb(e,e.ownerDocument)},qb:function(e){return!!c.a.Ma(e,c.a.ba)},u:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},p:function(e,t,n){var i=h&&u[t];if(i||"undefined"==typeof o)if(i||"function"!=typeof e.addEventListener){if("undefined"==typeof e.attachEvent)throw Error("Browser doesn't support addEventListener or attachEvent");var r=function(t){n.call(e,t)},a="on"+t;e.attachEvent(a,r),c.a.F.ja(e,function(){e.detachEvent(a,r)})}else e.addEventListener(t,n,!1);else{if(s(e,t)){var d=n;n=function(e,t){var n=this.checked;t&&(this.checked=!0!==t.tb),d.call(this,e),this.checked=n}}o(e).bind(t,n)}},Ha:function(e,i){if(!e||!e.nodeType)throw Error("element must be a DOM node when calling triggerEvent");if("undefined"!=typeof o){var r=[];s(e,i)&&r.push({tb:e.checked}),o(e).trigger(i,r)}else if("function"==typeof n.createEvent){if("function"!=typeof e.dispatchEvent)throw Error("The supplied element doesn't support dispatchEvent");r=n.createEvent(l[i]||"HTMLEvents"),r.initEvent(i,!0,!0,t,0,0,0,0,0,!1,!1,!1,!1,0,e),e.dispatchEvent(r)}else{if("undefined"==typeof e.fireEvent)throw Error("Browser doesn't support triggering events");s(e,i)&&(e.checked=!0!==e.checked),e.fireEvent("on"+i)}},c:function(e){return c.W(e)?e():e},za:function(e){return c.W(e)?e.t():e},ha:function(e,t,n){if(t){var i=/\S+/g,o=e.className.match(i)||[];c.a.r(t.match(i),function(e){c.a.ka(o,e,n)}),e.className=o.join(" ")}},jb:function(t,i){var o=c.a.c(i);(null===o||o===e)&&(o="");var r=c.e.firstChild(t);!r||3!=r.nodeType||c.e.nextSibling(r)?c.e.S(t,[n.createTextNode(o)]):r.data=o,c.a.Cb(t)},hb:function(e,t){if(e.name=t,7>=h)try{e.mergeAttributes(n.createElement("<input name='"+e.name+"'/>"),!1)}catch(i){}},Cb:function(e){h>=9&&(e=1==e.nodeType?e:e.parentNode,e.style&&(e.style.zoom=e.style.zoom))},Ab:function(e){if(h){var t=e.style.width;e.style.width=0,e.style.width=t}},Sb:function(e,t){e=c.a.c(e),t=c.a.c(t);for(var n=[],i=e;t>=i;i++)n.push(i);return n},Q:function(e){for(var t=[],n=0,i=e.length;i>n;n++)t.push(e[n]);return t},Wb:6===h,Xb:7===h,da:h,Va:function(e,t){for(var n=c.a.Q(e.getElementsByTagName("input")).concat(c.a.Q(e.getElementsByTagName("textarea"))),i="string"==typeof t?function(e){return e.name===t}:function(e){return t.test(e.name)},o=[],r=n.length-1;r>=0;r--)i(n[r])&&o.push(n[r]);return o},Pb:function(e){return"string"==typeof e&&(e=c.a.H(e))?r&&r.parse?r.parse(e):new Function("return "+e)():null},Da:function(e,t,n){if(!r||!r.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return r.stringify(c.a.c(e),t,n)},Qb:function(e,t,i){i=i||{};var o=i.params||{},r=i.includeFields||this.Ua,s=e;if("object"==typeof e&&"form"===c.a.u(e))for(var s=e.action,d=r.length-1;d>=0;d--)for(var l=c.a.Va(e,r[d]),u=l.length-1;u>=0;u--)o[l[u].name]=l[u].value;t=c.a.c(t);var h=n.createElement("form");h.style.display="none",h.action=s,h.method="post";for(var p in t)e=n.createElement("input"),e.name=p,e.value=c.a.Da(c.a.c(t[p])),h.appendChild(e);a(o,function(e,t){var i=n.createElement("input");i.name=e,i.value=t,h.appendChild(i)}),n.body.appendChild(h),i.submitter?i.submitter(h):h.submit(),setTimeout(function(){h.parentNode.removeChild(h)},0)},I:function(e,t){return p?(e.__proto__=t,!0):!1}}}(),c.b("utils",c.a),c.b("utils.arrayForEach",c.a.r),c.b("utils.arrayFirst",c.a.Ma),c.b("utils.arrayFilter",c.a.Z),c.b("utils.arrayGetDistinctValues",c.a.Na),c.b("utils.arrayIndexOf",c.a.k),c.b("utils.arrayMap",c.a.$),c.b("utils.arrayPushAll",c.a.U),c.b("utils.arrayRemoveItem",c.a.la),c.b("utils.extend",c.a.extend),c.b("utils.fieldsIncludedWithJsonPost",c.a.Ua),c.b("utils.getFormFields",c.a.Va),c.b("utils.peekObservable",c.a.za),c.b("utils.postJson",c.a.Qb),c.b("utils.parseJson",c.a.Pb),c.b("utils.registerEventHandler",c.a.p),c.b("utils.stringifyJson",c.a.Da),c.b("utils.range",c.a.Sb),c.b("utils.toggleDomNodeCssClass",c.a.ha),c.b("utils.triggerEvent",c.a.Ha),c.b("utils.unwrapObservable",c.a.c),c.b("utils.objectForEach",c.a.w),c.b("utils.addOrRemoveItem",c.a.ka),c.b("unwrap",c.a.c),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,n=Array.prototype.slice.call(arguments);return e=n.shift(),function(){return t.apply(e,n.concat(Array.prototype.slice.call(arguments)))}}),c.a.f=new function(){var t=0,n="__ko__"+(new Date).getTime(),i={};return{get:function(t,n){var i=c.a.f.qa(t,!1);return i===e?e:i[n]},set:function(t,n,i){(i!==e||c.a.f.qa(t,!1)!==e)&&(c.a.f.qa(t,!0)[n]=i)},qa:function(o,r){var a=o[n];if(!a||"null"===a||!i[a]){if(!r)return e;a=o[n]="ko"+t++,i[a]={}}return i[a]},clear:function(e){var t=e[n];return t?(delete i[t],e[n]=null,!0):!1}}},c.b("utils.domData",c.a.f),c.b("utils.domData.clear",c.a.f.clear),c.a.F=new function(){function t(t,n){var o=c.a.f.get(t,i);return o===e&&n&&(o=[],c.a.f.set(t,i,o)),o}function n(e){var i=t(e,!1);if(i)for(var i=i.slice(0),r=0;r<i.length;r++)i[r](e);if(c.a.f.clear(e),"function"==typeof o&&"function"==typeof o.cleanData&&o.cleanData([e]),a[e.nodeType])for(i=e.firstChild;e=i;)i=e.nextSibling,8===e.nodeType&&n(e)}var i="__ko_domNodeDisposal__"+(new Date).getTime(),r={1:!0,8:!0,9:!0},a={1:!0,9:!0};return{ja:function(e,n){if("function"!=typeof n)throw Error("Callback must be a function");t(e,!0).push(n)},eb:function(n,o){var r=t(n,!1);r&&(c.a.la(r,o),0==r.length&&c.a.f.set(n,i,e))},J:function(e){if(r[e.nodeType]&&(n(e),a[e.nodeType])){var t=[];c.a.U(t,e.getElementsByTagName("*"));for(var i=0,o=t.length;o>i;i++)n(t[i])}return e},removeNode:function(e){c.J(e),e.parentNode&&e.parentNode.removeChild(e)}}},c.J=c.a.F.J,c.removeNode=c.a.F.removeNode,c.b("cleanNode",c.J),c.b("removeNode",c.removeNode),c.b("utils.domNodeDisposal",c.a.F),c.b("utils.domNodeDisposal.addDisposeCallback",c.a.F.ja),c.b("utils.domNodeDisposal.removeDisposeCallback",c.a.F.eb),function(){c.a.ya=function(e){var i;if("undefined"!=typeof o){if(o.parseHTML)i=o.parseHTML(e)||[];else if((i=o.clean([e]))&&i[0]){for(e=i[0];e.parentNode&&11!==e.parentNode.nodeType;)e=e.parentNode;e.parentNode&&e.parentNode.removeChild(e)}}else{var r=c.a.H(e).toLowerCase();for(i=n.createElement("div"),r=r.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!r.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!r.indexOf("<td")||!r.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],e="ignored<div>"+r[1]+e+r[2]+"</div>","function"==typeof t.innerShiv?i.appendChild(t.innerShiv(e)):i.innerHTML=e;r[0]--;)i=i.lastChild;i=c.a.Q(i.lastChild.childNodes)}return i},c.a.ga=function(t,n){if(c.a.pa(t),n=c.a.c(n),null!==n&&n!==e)if("string"!=typeof n&&(n=n.toString()),"undefined"!=typeof o)o(t).html(n);else for(var i=c.a.ya(n),r=0;r<i.length;r++)t.appendChild(i[r])}}(),c.b("utils.parseHtmlFragment",c.a.ya),c.b("utils.setHtml",c.a.ga),c.s=function(){function t(e,n){if(e)if(8==e.nodeType){var i=c.s.ab(e.nodeValue);null!=i&&n.push({yb:e,Mb:i})}else if(1==e.nodeType)for(var i=0,o=e.childNodes,r=o.length;r>i;i++)t(o[i],n)}var n={};return{wa:function(e){if("function"!=typeof e)throw Error("You can only pass a function to ko.memoization.memoize()");var t=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return n[t]=e,"<!--[ko_memo:"+t+"]-->"},nb:function(t,i){var o=n[t];if(o===e)throw Error("Couldn't find any memo with ID "+t+". Perhaps it's already been unmemoized.");try{return o.apply(null,i||[]),!0}finally{delete n[t]}},ob:function(e,n){var i=[];t(e,i);for(var o=0,r=i.length;r>o;o++){var a=i[o].yb,s=[a];n&&c.a.U(s,n),c.s.nb(i[o].Mb,s),a.nodeValue="",a.parentNode&&a.parentNode.removeChild(a)}},ab:function(e){return(e=e.match(/^\[ko_memo\:(.*?)\]$/))?e[1]:null}}}(),c.b("memoization",c.s),c.b("memoization.memoize",c.s.wa),c.b("memoization.unmemoize",c.s.nb),c.b("memoization.parseMemoText",c.s.ab),c.b("memoization.unmemoizeDomNodeAndDescendants",c.s.ob),c.Ta={throttle:function(e,t){e.throttleEvaluation=t;var n=null;return c.h({read:e,write:function(i){clearTimeout(n),n=setTimeout(function(){e(i)},t)}})},notify:function(e,t){return e.equalityComparer="always"==t?function(){return!1}:c.l.fn.equalityComparer,e}},c.b("extenders",c.Ta),c.lb=function(e,t,n){this.target=e,this.ma=t,this.xb=n,c.q(this,"dispose",this.D)},c.lb.prototype.D=function(){this.Jb=!0,this.xb()},c.A=function(){this.B={},c.a.I(this,c.A.fn)||c.a.extend(this,c.A.fn),c.q(this,"subscribe",this.Ea),c.q(this,"extend",this.extend),c.q(this,"getSubscriptionsCount",this.Eb)},c.A.fn={Ea:function(e,t,n){n=n||"change";var i=new c.lb(this,t?e.bind(t):e,function(){c.a.la(this.B[n],i)}.bind(this));return this.B[n]||(this.B[n]=[]),this.B[n].push(i),i},notifySubscribers:function(e,t){if(t=t||"change",this.Fb(t))try{c.o.Oa();for(var n,i=this.B[t].slice(0),o=0;n=i[o];++o)n&&!0!==n.Jb&&n.ma(e)}finally{c.o.end()}},Fb:function(e){return this.B[e]&&this.B[e].length},Eb:function(){var e=0;return c.a.w(this.B,function(t,n){e+=n.length}),e},extend:function(e){var t=this;return e&&c.a.w(e,function(e,n){var i=c.Ta[e];"function"==typeof i&&(t=i(t,n))}),t}},c.a.I(c.A.fn,Function.prototype),c.Xa=function(e){return null!=e&&"function"==typeof e.Ea&&"function"==typeof e.notifySubscribers},c.b("subscribable",c.A),c.b("isSubscribable",c.Xa),c.o=function(){var e=[];return{Oa:function(t){e.push(t&&{ma:t,Sa:[]})},end:function(){e.pop()},cb:function(t){if(!c.Xa(t))throw Error("Only subscribable things can act as dependencies");if(0<e.length){var n=e[e.length-1];!n||0<=c.a.k(n.Sa,t)||(n.Sa.push(t),n.ma(t))}},P:function(t,n,i){try{return e.push(null),t.apply(n,i||[])}finally{e.pop()}}}}();var l={undefined:!0,"boolean":!0,number:!0,string:!0};c.l=function(e){function t(){return 0<arguments.length?(t.equalityComparer&&t.equalityComparer(n,arguments[0])||(t.M(),n=arguments[0],t.L()),this):(c.o.cb(t),n)}var n=e;return c.A.call(t),t.t=function(){return n},t.L=function(){t.notifySubscribers(n)},t.M=function(){t.notifySubscribers(n,"beforeChange")},c.a.I(t,c.l.fn)||c.a.extend(t,c.l.fn),c.q(t,"peek",t.t),c.q(t,"valueHasMutated",t.L),c.q(t,"valueWillMutate",t.M),t},c.l.fn={equalityComparer:function(e,t){return null===e||typeof e in l?e===t:!1}};var u=c.l.Rb="__ko_proto__";c.l.fn[u]=c.l,c.a.I(c.l.fn,c.A.fn),c.ra=function(t,n){return null===t||t===e||t[u]===e?!1:t[u]===n?!0:c.ra(t[u],n)},c.W=function(e){return c.ra(e,c.l)},c.Ya=function(e){return"function"==typeof e&&e[u]===c.l||"function"==typeof e&&e[u]===c.h&&e.Gb?!0:!1},c.b("observable",c.l),c.b("isObservable",c.W),c.b("isWriteableObservable",c.Ya),c.K=function(e){if(e=e||[],"object"!=typeof e||!("length"in e))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return e=c.l(e),c.a.I(e,c.K.fn)||c.a.extend(e,c.K.fn),e},c.K.fn={remove:function(e){for(var t=this.t(),n=[],i="function"==typeof e?e:function(t){return t===e},o=0;o<t.length;o++){var r=t[o];i(r)&&(0===n.length&&this.M(),n.push(r),t.splice(o,1),o--)}return n.length&&this.L(),n},removeAll:function(t){if(t===e){var n=this.t(),i=n.slice(0);return this.M(),n.splice(0,n.length),this.L(),i}return t?this.remove(function(e){return 0<=c.a.k(t,e)}):[]},destroy:function(e){var t=this.t(),n="function"==typeof e?e:function(t){return t===e};this.M();for(var i=t.length-1;i>=0;i--)n(t[i])&&(t[i]._destroy=!0);this.L()},destroyAll:function(t){return t===e?this.destroy(function(){return!0}):t?this.destroy(function(e){return 0<=c.a.k(t,e)}):[]},indexOf:function(e){var t=this();return c.a.k(t,e)},replace:function(e,t){var n=this.indexOf(e);n>=0&&(this.M(),this.t()[n]=t,this.L())}},c.a.r("pop push reverse shift sort splice unshift".split(" "),function(e){c.K.fn[e]=function(){var t=this.t();return this.M(),t=t[e].apply(t,arguments),this.L(),t}}),c.a.r(["slice"],function(e){c.K.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}}),c.a.I(c.K.fn,c.l.fn),c.b("observableArray",c.K),c.h=function(t,n,i){function o(){c.a.r(y,function(e){e.D()}),y=[]}function r(){var e=s.throttleEvaluation;e&&e>=0?(clearTimeout(b),b=setTimeout(a,e)):a()}function a(){if(!h)if(u&&g())v();else{h=!0;try{var t=c.a.$(y,function(e){return e.target});c.o.Oa(function(n){var i;0<=(i=c.a.k(t,n))?t[i]=e:y.push(n.Ea(r))});for(var i=n?p.call(n):p(),o=t.length-1;o>=0;o--)t[o]&&y.splice(o,1)[0].D();u=!0,s.notifySubscribers(l,"beforeChange"),l=i,s.notifySubscribers(l)}finally{c.o.end(),h=!1}y.length||v()}}function s(){if(0<arguments.length){if("function"!=typeof f)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return f.apply(n,arguments),this}return u||a(),c.o.cb(s),l}function d(){return!u||0<y.length}var l,u=!1,h=!1,p=t;if(p&&"object"==typeof p?(i=p,p=i.read):(i=i||{},p||(p=i.read)),"function"!=typeof p)throw Error("Pass a function that returns the value of the ko.computed");var f=i.write,m=i.disposeWhenNodeIsRemoved||i.aa||null,g=i.disposeWhen||i.Ra||function(){return!1},v=o,y=[],b=null;if(n||(n=i.owner),s.t=function(){return u||a(),l},s.Db=function(){return y.length},s.Gb="function"==typeof i.write,s.D=function(){v()},s.ua=d,c.A.call(s),c.a.I(s,c.h.fn)||c.a.extend(s,c.h.fn),c.q(s,"peek",s.t),c.q(s,"dispose",s.D),c.q(s,"isActive",s.ua),c.q(s,"getDependenciesCount",s.Db),!0!==i.deferEvaluation&&a(),m&&d()){v=function(){c.a.F.eb(m,v),o()},c.a.F.ja(m,v);var S=g,g=function(){return!c.a.ba(m)||S()}}return s},c.Ib=function(e){return c.ra(e,c.h)},a=c.l.Rb,c.h[a]=c.l,c.h.fn={},c.h.fn[a]=c.h,c.a.I(c.h.fn,c.A.fn),c.b("dependentObservable",c.h),c.b("computed",c.h),c.b("isComputed",c.Ib),function(){function t(o,r,a){if(a=a||new i,o=r(o),"object"!=typeof o||null===o||o===e||o instanceof Date||o instanceof String||o instanceof Number||o instanceof Boolean)return o;var s=o instanceof Array?[]:{};return a.save(o,s),n(o,function(n){var i=r(o[n]);switch(typeof i){case"boolean":case"number":case"string":case"function":s[n]=i;break;case"object":case"undefined":var d=a.get(i);s[n]=d!==e?d:t(i,r,a)}}),s}function n(e,t){if(e instanceof Array){for(var n=0;n<e.length;n++)t(n);"function"==typeof e.toJSON&&t("toJSON")}else for(n in e)t(n)}function i(){this.keys=[],this.Ia=[]}c.mb=function(e){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return t(e,function(e){for(var t=0;c.W(e)&&10>t;t++)e=e();return e})},c.toJSON=function(e,t,n){return e=c.mb(e),c.a.Da(e,t,n)},i.prototype={save:function(e,t){var n=c.a.k(this.keys,e);n>=0?this.Ia[n]=t:(this.keys.push(e),this.Ia.push(t))},get:function(t){return t=c.a.k(this.keys,t),t>=0?this.Ia[t]:e}}}(),c.b("toJS",c.mb),c.b("toJSON",c.toJSON),function(){c.i={n:function(t){switch(c.a.u(t)){case"option":return!0===t.__ko__hasDomDataOptionValue__?c.a.f.get(t,c.d.options.xa):7>=c.a.da?t.getAttributeNode("value")&&t.getAttributeNode("value").specified?t.value:t.text:t.value;case"select":return 0<=t.selectedIndex?c.i.n(t.options[t.selectedIndex]):e;default:return t.value}},X:function(t,n){switch(c.a.u(t)){case"option":switch(typeof n){case"string":c.a.f.set(t,c.d.options.xa,e),"__ko__hasDomDataOptionValue__"in t&&delete t.__ko__hasDomDataOptionValue__,t.value=n;break;default:c.a.f.set(t,c.d.options.xa,n),t.__ko__hasDomDataOptionValue__=!0,t.value="number"==typeof n?n:""}break;case"select":""===n&&(n=e),(null===n||n===e)&&(t.selectedIndex=-1);for(var i=t.options.length-1;i>=0;i--)if(c.i.n(t.options[i])==n){t.selectedIndex=i;break}1<t.size||-1!==t.selectedIndex||(t.selectedIndex=0);break;default:(null===n||n===e)&&(n=""),t.value=n}}}}(),c.b("selectExtensions",c.i),c.b("selectExtensions.readValue",c.i.n),c.b("selectExtensions.writeValue",c.i.X),c.g=function(){function e(e,n){for(var i=null;e!=i;)i=e,e=e.replace(t,function(e,t){return n[t]});return e}var t=/\@ko_token_(\d+)\@/g,n=["true","false","null","undefined"],i=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;return{V:[],ea:function(t){var n=c.a.H(t);if(3>n.length)return[];"{"===n.charAt(0)&&(n=n.substring(1,n.length-1)),t=[];for(var i,o=null,r=0;r<n.length;r++){var a=n.charAt(r);if(null===o)switch(a){case'"':case"'":case"/":o=r,i=a}else if(a==i&&"\\"!==n.charAt(r-1)){a=n.substring(o,r+1),t.push(a);var s="@ko_token_"+(t.length-1)+"@",n=n.substring(0,o)+s+n.substring(r+1),r=r-(a.length-s.length),o=null}}i=o=null;for(var d=0,l=null,r=0;r<n.length;r++){if(a=n.charAt(r),null===o)switch(a){case"{":o=r,l=a,i="}";break;case"(":o=r,l=a,i=")";break;case"[":o=r,l=a,i="]"}a===l?d++:a===i&&(d--,0===d&&(a=n.substring(o,r+1),t.push(a),s="@ko_token_"+(t.length-1)+"@",n=n.substring(0,o)+s+n.substring(r+1),r-=a.length-s.length,o=null))}for(i=[],n=n.split(","),o=0,r=n.length;r>o;o++)d=n[o],l=d.indexOf(":"),l>0&&l<d.length-1?(a=d.substring(l+1),i.push({key:e(d.substring(0,l),t),value:e(a,t)})):i.push({unknown:e(d,t)});return i},fa:function(e){var t="string"==typeof e?c.g.ea(e):e,o=[];e=[];for(var r,a=0;r=t[a];a++)if(0<o.length&&o.push(","),r.key){var s;e:{s=r.key;var d=c.a.H(s);switch(d.length&&d.charAt(0)){case"'":case'"':break e;default:s="'"+d+"'"}}r=r.value,o.push(s),o.push(":"),o.push(r),r=c.a.H(r),0<=c.a.k(n,c.a.H(r).toLowerCase())?r=!1:(d=r.match(i),r=null===d?!1:d[1]?"Object("+d[1]+")"+d[2]:r),r&&(0<e.length&&e.push(", "),e.push(s+" : function(__ko_value) { "+r+" = __ko_value; }"))}else r.unknown&&o.push(r.unknown);return t=o.join(""),0<e.length&&(t=t+", '_ko_property_writers' : { "+e.join("")+" } "),t},Lb:function(e,t){for(var n=0;n<e.length;n++)if(c.a.H(e[n].key)==t)return!0;return!1},ia:function(e,t,n,i,o){e&&c.W(e)?!c.Ya(e)||o&&e.t()===i||e(i):(e=t()._ko_property_writers)&&e[n]&&e[n](i)}}}(),c.b("expressionRewriting",c.g),c.b("expressionRewriting.bindingRewriteValidators",c.g.V),c.b("expressionRewriting.parseObjectLiteral",c.g.ea),c.b("expressionRewriting.preProcessBindings",c.g.fa),c.b("jsonExpressionRewriting",c.g),c.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",c.g.fa),function(){function e(e){return 8==e.nodeType&&(r?e.text:e.nodeValue).match(a)}function t(e){return 8==e.nodeType&&(r?e.text:e.nodeValue).match(s)}function i(n,i){for(var o=n,r=1,a=[];o=o.nextSibling;){if(t(o)&&(r--,0===r))return a;a.push(o),e(o)&&r++}if(!i)throw Error("Cannot find closing comment tag to match: "+n.nodeValue);return null}function o(e,t){var n=i(e,t);return n?0<n.length?n[n.length-1].nextSibling:e.nextSibling:null}var r=n&&"<!--test-->"===n.createComment("test").text,a=r?/^\x3c!--\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*--\x3e$/:/^\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*$/,s=r?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,d={ul:!0,ol:!0};c.e={N:{},childNodes:function(t){return e(t)?i(t):t.childNodes},ca:function(t){if(e(t)){t=c.e.childNodes(t);for(var n=0,i=t.length;i>n;n++)c.removeNode(t[n])}else c.a.pa(t)},S:function(t,n){if(e(t)){c.e.ca(t);for(var i=t.nextSibling,o=0,r=n.length;r>o;o++)i.parentNode.insertBefore(n[o],i)}else c.a.S(t,n)},bb:function(t,n){e(t)?t.parentNode.insertBefore(n,t.nextSibling):t.firstChild?t.insertBefore(n,t.firstChild):t.appendChild(n)},Wa:function(t,n,i){i?e(t)?t.parentNode.insertBefore(n,i.nextSibling):i.nextSibling?t.insertBefore(n,i.nextSibling):t.appendChild(n):c.e.bb(t,n)},firstChild:function(n){return e(n)?!n.nextSibling||t(n.nextSibling)?null:n.nextSibling:n.firstChild},nextSibling:function(n){return e(n)&&(n=o(n)),n.nextSibling&&t(n.nextSibling)?null:n.nextSibling},pb:function(t){return(t=e(t))?t[1]:null},$a:function(n){if(d[c.a.u(n)]){var i=n.firstChild;if(i)do if(1===i.nodeType){var r;r=i.firstChild;var a=null;if(r)do if(a)a.push(r);else if(e(r)){var s=o(r,!0);s?r=s:a=[r]}else t(r)&&(a=[r]);while(r=r.nextSibling);if(r=a)for(a=i.nextSibling,s=0;s<r.length;s++)a?n.insertBefore(r[s],a):n.appendChild(r[s])}while(i=i.nextSibling)}}}}(),c.b("virtualElements",c.e),c.b("virtualElements.allowedBindings",c.e.N),c.b("virtualElements.emptyNode",c.e.ca),c.b("virtualElements.insertAfter",c.e.Wa),c.b("virtualElements.prepend",c.e.bb),c.b("virtualElements.setDomNodeChildren",c.e.S),function(){c.O=function(){this.sb={}},c.a.extend(c.O.prototype,{nodeHasBindings:function(e){switch(e.nodeType){case 1:return null!=e.getAttribute("data-bind");case 8:return null!=c.e.pb(e);default:return!1}},getBindings:function(e,t){var n=this.getBindingsString(e,t);return n?this.parseBindingsString(n,t,e):null},getBindingsString:function(e){switch(e.nodeType){case 1:return e.getAttribute("data-bind");case 8:return c.e.pb(e);default:return null}},parseBindingsString:function(e,t,n){try{var i,o=this.sb;if(!(i=o[e])){var r,a="with($context){with($data||{}){return{"+c.g.fa(e)+"}}}";r=new Function("$context","$element",a),i=o[e]=r}return i(t,n)}catch(s){throw s.message="Unable to parse bindings.\nBindings value: "+e+"\nMessage: "+s.message,s}}}),c.O.instance=new c.O}(),c.b("bindingProvider",c.O),function(){function n(e,t,n){for(var o=c.e.firstChild(t);t=o;)o=c.e.nextSibling(t),i(e,t,n)}function i(e,t,i){var r=!0,a=1===t.nodeType;a&&c.e.$a(t),(a&&i||c.O.instance.nodeHasBindings(t))&&(r=o(t,null,e,i).Ub),r&&n(e,t,!a)}function o(t,n,i,o){function a(e){return function(){return d[e]}}function s(){return d}var d,l,u=0,h=c.a.f.get(t,r);if(!n){if(h)throw Error("You cannot apply bindings multiple times to the same element."+t.id+" "+t.className);c.a.f.set(t,r,!0)}return c.h(function(){var r=i&&i instanceof c.C?i:new c.C(c.a.c(i)),p=r.$data;!h&&o&&c.kb(t,r),(d=("function"==typeof n?n(r,t):n)||c.O.instance.getBindings(t,r))&&(0===u&&(u=1,c.a.w(d,function(n){var i=c.d[n];if(i&&8===t.nodeType&&!c.e.N[n])throw Error("The binding '"+n+"' cannot be used with virtual elements");if(i&&"function"==typeof i.init&&(i=i.init(t,a(n),s,p,r))&&i.controlsDescendantBindings){if(l!==e)throw Error("Multiple bindings ("+l+" and "+n+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");l=n}}),u=2),2===u&&c.a.w(d,function(e){var n=c.d[e];n&&"function"==typeof n.update&&n.update(t,a(e),s,p,r)}))},null,{aa:t}),{Ub:l===e}}c.d={},c.C=function(e,t,n){t?(c.a.extend(this,t),this.$parentContext=t,this.$parent=t.$data,this.$parents=(t.$parents||[]).slice(0),this.$parents.unshift(this.$parent)):(this.$parents=[],this.$root=e,this.ko=c),this.$data=e,n&&(this[n]=e)},c.C.prototype.createChildContext=function(e,t){return new c.C(e,this,t)},c.C.prototype.extend=function(e){var t=c.a.extend(new c.C,this);return c.a.extend(t,e)};var r="__ko_boundElement";c.kb=function(e,t){return 2!=arguments.length?c.a.f.get(e,"__ko_bindingContext__"):void c.a.f.set(e,"__ko_bindingContext__",t)},c.La=function(e,t,n){return 1===e.nodeType&&c.e.$a(e),o(e,t,n,!0)},c.Ka=function(e,t){1!==t.nodeType&&8!==t.nodeType||n(e,t,!0)},c.Ja=function(e,n){if(n&&1!==n.nodeType&&8!==n.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");n=n||t.document.body,i(e,n,!0)},c.oa=function(t){switch(t.nodeType){case 1:case 8:var n=c.kb(t);if(n)return n;if(t.parentNode)return c.oa(t.parentNode)}return e},c.vb=function(t){return(t=c.oa(t))?t.$data:e},c.b("bindingHandlers",c.d),c.b("applyBindings",c.Ja),c.b("applyBindingsToDescendants",c.Ka),c.b("applyBindingsToNode",c.La),c.b("contextFor",c.oa),c.b("dataFor",c.vb)}();var h={"class":"className","for":"htmlFor"};c.d.attr={update:function(t,n){var i=c.a.c(n())||{};c.a.w(i,function(n,i){i=c.a.c(i);var o=!1===i||null===i||i===e;o&&t.removeAttribute(n),8>=c.a.da&&n in h?(n=h[n],o?t.removeAttribute(n):t[n]=i):o||t.setAttribute(n,i.toString()),"name"===n&&c.a.hb(t,o?"":i.toString())})}},c.d.checked={init:function(e,t,n){c.a.p(e,"click",function(){var i;if("checkbox"==e.type)i=e.checked;else{if("radio"!=e.type||!e.checked)return;i=e.value}var o=t(),r=c.a.c(o);"checkbox"==e.type&&r instanceof Array?c.a.ka(o,e.value,e.checked):c.g.ia(o,n,"checked",i,!0)}),"radio"!=e.type||e.name||c.d.uniqueName.init(e,function(){return!0})},update:function(e,t){var n=c.a.c(t());"checkbox"==e.type?e.checked=n instanceof Array?0<=c.a.k(n,e.value):n:"radio"==e.type&&(e.checked=e.value==n)}},c.d.css={update:function(e,t){var n=c.a.c(t());"object"==typeof n?c.a.w(n,function(t,n){n=c.a.c(n),c.a.ha(e,t,n)}):(n=String(n||""),c.a.ha(e,e.__ko__cssValue,!1),e.__ko__cssValue=n,c.a.ha(e,n,!0))
}},c.d.enable={update:function(e,t){var n=c.a.c(t());n&&e.disabled?e.removeAttribute("disabled"):n||e.disabled||(e.disabled=!0)}},c.d.disable={update:function(e,t){c.d.enable.update(e,function(){return!c.a.c(t())})}},c.d.event={init:function(e,t,n,i){var o=t()||{};c.a.w(o,function(o){"string"==typeof o&&c.a.p(e,o,function(e){var r,a=t()[o];if(a){var s=n();try{var d=c.a.Q(arguments);d.unshift(i),r=a.apply(i,d)}finally{!0!==r&&(e.preventDefault?e.preventDefault():e.returnValue=!1)}!1===s[o+"Bubble"]&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())}})})}},c.d.foreach={Za:function(e){return function(){var t=e(),n=c.a.za(t);return n&&"number"!=typeof n.length?(c.a.c(t),{foreach:n.data,as:n.as,includeDestroyed:n.includeDestroyed,afterAdd:n.afterAdd,beforeRemove:n.beforeRemove,afterRender:n.afterRender,beforeMove:n.beforeMove,afterMove:n.afterMove,templateEngine:c.G.ta}):{foreach:t,templateEngine:c.G.ta}}},init:function(e,t){return c.d.template.init(e,c.d.foreach.Za(t))},update:function(e,t,n,i,o){return c.d.template.update(e,c.d.foreach.Za(t),n,i,o)}},c.g.V.foreach=!1,c.e.N.foreach=!0,c.d.hasfocus={init:function(e,t,n){function i(i){e.__ko_hasfocusUpdating=!0;var o=e.ownerDocument;if("activeElement"in o){var r;try{r=o.activeElement}catch(a){r=o.body}i=r===e}o=t(),c.g.ia(o,n,"hasfocus",i,!0),e.__ko_hasfocusLastValue=i,e.__ko_hasfocusUpdating=!1}var o=i.bind(null,!0),r=i.bind(null,!1);c.a.p(e,"focus",o),c.a.p(e,"focusin",o),c.a.p(e,"blur",r),c.a.p(e,"focusout",r)},update:function(e,t){var n=!!c.a.c(t());e.__ko_hasfocusUpdating||e.__ko_hasfocusLastValue===n||(n?e.focus():e.blur(),c.o.P(c.a.Ha,null,[e,n?"focusin":"focusout"]))}},c.d.hasFocus=c.d.hasfocus,c.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){c.a.ga(e,t())}};var p="__ko_withIfBindingData";s("if"),s("ifnot",!1,!0),s("with",!0,!1,function(e,t){return e.createChildContext(t)}),c.d.options={init:function(e){if("select"!==c.a.u(e))throw Error("options binding applies only to SELECT elements");for(;0<e.length;)e.remove(0);return{controlsDescendantBindings:!0}},update:function(t,i,o){function r(e,t,n){var i=typeof t;return"function"==i?t(e):"string"==i?e[t]:n}function a(e,t){if(h){var n=0<=c.a.k(h,c.i.n(t[0]));c.a.ib(t[0],n)}}var s=0==t.length,l=!s&&t.multiple?t.scrollTop:null;i=c.a.c(i());var u,h,p=o(),f=p.optionsIncludeDestroyed,m={};if(t.multiple?h=c.a.$(t.selectedOptions||c.a.Z(t.childNodes,function(e){return e.tagName&&"option"===c.a.u(e)&&e.selected}),function(e){return c.i.n(e)}):0<=t.selectedIndex&&(h=[c.i.n(t.options[t.selectedIndex])]),i){"undefined"==typeof i.length&&(i=[i]);var g=c.a.Z(i,function(t){return f||t===e||null===t||!c.a.c(t._destroy)});"optionsCaption"in p&&(u=c.a.c(p.optionsCaption),null!==u&&u!==e&&g.unshift(m))}else i=[];o=a,p.optionsAfterRender&&(o=function(t,n){a(0,n),c.o.P(p.optionsAfterRender,null,[n[0],t!==m?t:e])}),c.a.Ba(t,g,function(t,i,o){return o.length&&(h=o[0].selected&&[c.i.n(o[0])]),i=n.createElement("option"),t===m?(c.a.ga(i,u),c.i.X(i,e)):(o=r(t,p.optionsValue,t),c.i.X(i,c.a.c(o)),t=r(t,p.optionsText,o),c.a.jb(i,t)),[i]},null,o),h=null,s&&"value"in p&&d(t,c.a.za(p.value),!0),c.a.Ab(t),l&&20<Math.abs(l-t.scrollTop)&&(t.scrollTop=l)}},c.d.options.xa="__ko.optionValueDomData__",c.d.selectedOptions={init:function(e,t,n){c.a.p(e,"change",function(){var i=t(),o=[];c.a.r(e.getElementsByTagName("option"),function(e){e.selected&&o.push(c.i.n(e))}),c.g.ia(i,n,"selectedOptions",o)})},update:function(e,t){if("select"!=c.a.u(e))throw Error("values binding applies only to SELECT elements");var n=c.a.c(t());n&&"number"==typeof n.length&&c.a.r(e.getElementsByTagName("option"),function(e){var t=0<=c.a.k(n,c.i.n(e));c.a.ib(e,t)})}},c.d.style={update:function(e,t){var n=c.a.c(t()||{});c.a.w(n,function(t,n){n=c.a.c(n),e.style[t]!==n&&(e.style[t]=n||"")})}},c.d.submit={init:function(e,t,n,i){if("function"!=typeof t())throw Error("The value for a submit binding must be a function");c.a.p(e,"submit",function(n){var o,r=t();try{o=r.call(i,e)}finally{!0!==o&&(n.preventDefault?n.preventDefault():n.returnValue=!1)}})}},c.d.text={update:function(e,t){c.a.jb(e,t())}},c.e.N.text=!0,c.d.uniqueName={init:function(e,t){if(t()){var n="ko_unique_"+ ++c.d.uniqueName.ub;c.a.hb(e,n)}}},c.d.uniqueName.ub=0,c.d.value={init:function(e,t,n){function i(){a=!1;var i=t(),o=c.i.n(e);c.g.ia(i,n,"value",o)}var o=["change"],r=n().valueUpdate,a=!1;r&&("string"==typeof r&&(r=[r]),c.a.U(o,r),o=c.a.Na(o)),!c.a.da||"input"!=e.tagName.toLowerCase()||"text"!=e.type||"off"==e.autocomplete||e.form&&"off"==e.form.autocomplete||-1!=c.a.k(o,"propertychange")||(c.a.p(e,"propertychange",function(){a=!0}),c.a.p(e,"blur",function(){a&&i()})),c.a.r(o,function(t){var n=i;c.a.Vb(t,"after")&&(n=function(){setTimeout(i,0)},t=t.substring(5)),c.a.p(e,t,n)})},update:function(e,t){var n="select"===c.a.u(e),i=c.a.c(t()),o=c.i.n(e);i!==o&&(o=function(){c.i.X(e,i)},o(),n&&setTimeout(o,0)),n&&0<e.length&&d(e,i,!1)}},c.d.visible={update:function(e,t){var n=c.a.c(t()),i="none"!=e.style.display;n&&!i?e.style.display="":!n&&i&&(e.style.display="none")}},function(e){c.d[e]={init:function(t,n,i,o){return c.d.event.init.call(this,t,function(){var t={};return t[e]=n(),t},i,o)}}}("click"),c.v=function(){},c.v.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")},c.v.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")},c.v.prototype.makeTemplateSource=function(e,t){if("string"==typeof e){t=t||n;var i=t.getElementById(e);if(!i)throw Error("Cannot find template with ID "+e);return new c.m.j(i)}if(1==e.nodeType||8==e.nodeType)return new c.m.T(e);throw Error("Unknown template type: "+e)},c.v.prototype.renderTemplate=function(e,t,n,i){return e=this.makeTemplateSource(e,i),this.renderTemplateSource(e,t,n)},c.v.prototype.isTemplateRewritten=function(e,t){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(e,t).data("isRewritten")},c.v.prototype.rewriteTemplate=function(e,t,n){e=this.makeTemplateSource(e,n),t=t(e.text()),e.text(t),e.data("isRewritten",!0)},c.b("templateEngine",c.v),c.Fa=function(){function e(e,t,n,i){e=c.g.ea(e);for(var o=c.g.V,r=0;r<e.length;r++){var a=e[r].key;if(o.hasOwnProperty(a)){var s=o[a];if("function"==typeof s){if(a=s(e[r].value))throw Error(a)}else if(!s)throw Error("This template engine does not support the '"+a+"' binding within its templates")}}return n="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+c.g.fa(e)+" } })()},'"+n.toLowerCase()+"')",i.createJavaScriptEvaluatorBlock(n)+t}var t=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,n=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{Bb:function(e,t,n){t.isTemplateRewritten(e,n)||t.rewriteTemplate(e,function(e){return c.Fa.Nb(e,t)},n)},Nb:function(i,o){return i.replace(t,function(t,n,i,r,a){return e(a,n,i,o)}).replace(n,function(t,n){return e(n,"<!-- ko -->","#comment",o)})},rb:function(e,t){return c.s.wa(function(n,i){var o=n.nextSibling;o&&o.nodeName.toLowerCase()===t&&c.La(o,e,i)})}}}(),c.b("__tr_ambtns",c.Fa.rb),function(){c.m={},c.m.j=function(e){this.j=e},c.m.j.prototype.text=function(){var e=c.a.u(this.j),e="script"===e?"text":"textarea"===e?"value":"innerHTML";if(0==arguments.length)return this.j[e];var t=arguments[0];"innerHTML"===e?c.a.ga(this.j,t):this.j[e]=t},c.m.j.prototype.data=function(e){return 1===arguments.length?c.a.f.get(this.j,"templateSourceData_"+e):void c.a.f.set(this.j,"templateSourceData_"+e,arguments[1])},c.m.T=function(e){this.j=e},c.m.T.prototype=new c.m.j,c.m.T.prototype.text=function(){if(0==arguments.length){var t=c.a.f.get(this.j,"__ko_anon_template__")||{};return t.Ga===e&&t.na&&(t.Ga=t.na.innerHTML),t.Ga}c.a.f.set(this.j,"__ko_anon_template__",{Ga:arguments[0]})},c.m.j.prototype.nodes=function(){return 0==arguments.length?(c.a.f.get(this.j,"__ko_anon_template__")||{}).na:void c.a.f.set(this.j,"__ko_anon_template__",{na:arguments[0]})},c.b("templateSources",c.m),c.b("templateSources.domElement",c.m.j),c.b("templateSources.anonymousTemplate",c.m.T)}(),function(){function t(e,t,n){var i;for(t=c.e.nextSibling(t);e&&(i=e)!==t;)e=c.e.nextSibling(i),1!==i.nodeType&&8!==i.nodeType||n(i)}function n(e,n){if(e.length){var i=e[0],o=e[e.length-1];t(i,o,function(e){c.Ja(n,e)}),t(i,o,function(e){c.s.ob(e,[n])})}}function i(e){return e.nodeType?e:0<e.length?e[0]:null}function o(e,t,o,a,s){s=s||{};var d=e&&i(e),d=d&&d.ownerDocument,l=s.templateEngine||r;if(c.Fa.Bb(o,l,d),o=l.renderTemplate(o,a,s,d),"number"!=typeof o.length||0<o.length&&"number"!=typeof o[0].nodeType)throw Error("Template engine must return an array of DOM nodes");switch(d=!1,t){case"replaceChildren":c.e.S(e,o),d=!0;break;case"replaceNode":c.a.fb(e,o),d=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+t)}return d&&(n(o,a),s.afterRender&&c.o.P(s.afterRender,null,[o,a.$data])),o}var r;c.Ca=function(t){if(t!=e&&!(t instanceof c.v))throw Error("templateEngine must inherit from ko.templateEngine");r=t},c.Aa=function(t,n,a,s,d){if(a=a||{},(a.templateEngine||r)==e)throw Error("Set a template engine before calling renderTemplate");if(d=d||"replaceChildren",s){var l=i(s);return c.h(function(){var e=n&&n instanceof c.C?n:new c.C(c.a.c(n)),r="function"==typeof t?t(e.$data,e):t,e=o(s,d,r,e,a);"replaceNode"==d&&(s=e,l=i(s))},null,{Ra:function(){return!l||!c.a.ba(l)},aa:l&&"replaceNode"==d?l.parentNode:l})}return c.s.wa(function(e){c.Aa(t,n,a,e,"replaceNode")})},c.Tb=function(t,i,r,a,s){function d(e,t){n(t,u),r.afterRender&&r.afterRender(t,e)}function l(e,n){u=s.createChildContext(c.a.c(e),r.as),u.$index=n;var i="function"==typeof t?t(e,u):t;return o(null,"ignoreTargetNode",i,u,r)}var u;return c.h(function(){var t=c.a.c(i)||[];"undefined"==typeof t.length&&(t=[t]),t=c.a.Z(t,function(t){return r.includeDestroyed||t===e||null===t||!c.a.c(t._destroy)}),c.o.P(c.a.Ba,null,[a,t,l,r,d])},null,{aa:a})},c.d.template={init:function(e,t){var n=c.a.c(t());return"string"==typeof n||n.name||1!=e.nodeType&&8!=e.nodeType||(n=1==e.nodeType?e.childNodes:c.e.childNodes(e),n=c.a.Ob(n),new c.m.T(e).nodes(n)),{controlsDescendantBindings:!0}},update:function(t,n,i,o,r){n=c.a.c(n()),i={},o=!0;var a,s=null;"string"!=typeof n&&(i=n,n=c.a.c(i.name),"if"in i&&(o=c.a.c(i["if"])),o&&"ifnot"in i&&(o=!c.a.c(i.ifnot)),a=c.a.c(i.data)),"foreach"in i?s=c.Tb(n||t,o&&i.foreach||[],i,t,r):o?(r="data"in i?r.createChildContext(a,i.as):r,s=c.Aa(n||t,r,i,t)):c.e.ca(t),r=s,(a=c.a.f.get(t,"__ko__templateComputedDomDataKey__"))&&"function"==typeof a.D&&a.D(),c.a.f.set(t,"__ko__templateComputedDomDataKey__",r&&r.ua()?r:e)}},c.g.V.template=function(e){return e=c.g.ea(e),1==e.length&&e[0].unknown||c.g.Lb(e,"name")?null:"This template engine does not support anonymous templates nested within its templates"},c.e.N.template=!0}(),c.b("setTemplateEngine",c.Ca),c.b("renderTemplate",c.Aa),c.a.Qa=function(){function e(e,t,n,i,o){var r,a,s,d,c,l=Math.min,u=Math.max,h=[],p=e.length,f=t.length,m=f-p||1,g=p+f+1;for(r=0;p>=r;r++)for(d=s,h.push(s=[]),c=l(f,r+m),a=u(0,r-1);c>=a;a++)s[a]=a?r?e[r-1]===t[a-1]?d[a-1]:l(d[a]||g,s[a-1]||g)+1:a+1:r+1;for(l=[],u=[],m=[],r=p,a=f;r||a;)f=h[r][a]-1,a&&f===h[r][a-1]?u.push(l[l.length]={status:n,value:t[--a],index:a}):r&&f===h[r-1][a]?m.push(l[l.length]={status:i,value:e[--r],index:r}):(l.push({status:"retained",value:t[--a]}),--r);if(u.length&&m.length){e=10*p;var v;for(t=n=0;(o||e>t)&&(v=u[n]);n++){for(i=0;h=m[i];i++)if(v.value===h.value){v.moved=h.index,h.moved=v.index,m.splice(i,1),t=i=0;break}t+=i}}return l.reverse()}return function(t,n,i){return t=t||[],n=n||[],t.length<=n.length?e(t,n,"added","deleted",i):e(n,t,"deleted","added",i)}}(),c.b("utils.compareArrays",c.a.Qa),function(){function t(e){for(;e.length&&!c.a.ba(e[0]);)e.splice(0,1);if(1<e.length){for(var t=e[0],n=e[e.length-1],i=[t];t!==n;){if(t=t.nextSibling,!t)return;i.push(t)}Array.prototype.splice.apply(e,[0,e.length].concat(i))}return e}function n(n,i,o,r,a){var s=[];return n=c.h(function(){var e=i(o,a,t(s))||[];0<s.length&&(c.a.fb(s,e),r&&c.o.P(r,null,[o,e,a])),s.splice(0,s.length),c.a.U(s,e)},null,{aa:n,Ra:function(){return!c.a.qb(s)}}),{R:s,h:n.ua()?n:e}}c.a.Ba=function(i,o,r,a,s){function d(e,n){S=h[n],v!==n&&(M[e]=S),S.sa(v++),t(S.R),m.push(S),b.push(S)}function l(e,t){if(e)for(var n=0,i=t.length;i>n;n++)t[n]&&c.a.r(t[n].R,function(i){e(i,n,t[n].Y)})}o=o||[],a=a||{};var u=c.a.f.get(i,"setDomNodeChildrenFromArrayMapping_lastMappingResult")===e,h=c.a.f.get(i,"setDomNodeChildrenFromArrayMapping_lastMappingResult")||[],p=c.a.$(h,function(e){return e.Y}),f=c.a.Qa(p,o,a.dontLimitMoves),m=[],g=0,v=0,y=[],b=[];o=[];for(var S,T,w,M=[],p=[],C=0;T=f[C];C++)switch(w=T.moved,T.status){case"deleted":w===e&&(S=h[g],S.h&&S.h.D(),y.push.apply(y,t(S.R)),a.beforeRemove&&(o[C]=S,b.push(S))),g++;break;case"retained":d(C,g++);break;case"added":w!==e?d(C,w):(S={Y:T.value,sa:c.l(v++)},m.push(S),b.push(S),u||(p[C]=S))}l(a.beforeMove,M),c.a.r(y,a.beforeRemove?c.J:c.removeNode);for(var x,C=0,u=c.e.firstChild(i);S=b[C];C++){for(S.R||c.a.extend(S,n(i,r,S.Y,s,S.sa)),g=0;f=S.R[g];u=f.nextSibling,x=f,g++)f!==u&&c.e.Wa(i,f,x);!S.Hb&&s&&(s(S.Y,S.R,S.sa),S.Hb=!0)}l(a.beforeRemove,o),l(a.afterMove,M),l(a.afterAdd,p),c.a.f.set(i,"setDomNodeChildrenFromArrayMapping_lastMappingResult",m)}}(),c.b("utils.setDomNodeChildrenFromArrayMapping",c.a.Ba),c.G=function(){this.allowTemplateRewriting=!1},c.G.prototype=new c.v,c.G.prototype.renderTemplateSource=function(e){var t=(9>c.a.da?0:e.nodes)?e.nodes():null;return t?c.a.Q(t.cloneNode(!0).childNodes):(e=e.text(),c.a.ya(e))},c.G.ta=new c.G,c.Ca(c.G.ta),c.b("nativeTemplateEngine",c.G),function(){c.va=function(){var e=this.Kb=function(){if("undefined"==typeof o||!o.tmpl)return 0;try{if(0<=o.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(e){}return 1}();this.renderTemplateSource=function(t,i,r){if(r=r||{},2>e)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var a=t.data("precompiled");return a||(a=t.text()||"",a=o.template(null,"{{ko_with $item.koBindingContext}}"+a+"{{/ko_with}}"),t.data("precompiled",a)),t=[i.$data],i=o.extend({koBindingContext:i},r.templateOptions),i=o.tmpl(a,t,i),i.appendTo(n.createElement("div")),o.fragments={},i},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){n.write("<script type='text/html' id='"+e+"'>"+t+"</script>")},e>0&&(o.tmpl.tag.ko_code={open:"__.push($1 || '');"},o.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},c.va.prototype=new c.v;var e=new c.va;0<e.Kb&&c.Ca(e),c.b("jqueryTmplTemplateEngine",c.va)}()})}()}(),define("util",[],function(){function e(e,t){e===URLPart.Search?window.location.search=t:e===URLPart.Hash&&(window.location.hash=t)}function t(e){return e===URLPart.Search?window.location.search:e===URLPart.Hash?window.location.hash:void 0}function n(e){return r[e]}function i(){}var o={};window.URLPart={Search:1,Hash:2};var r={demo:URLPart.Hash,login:URLPart.Hash,access_token:URLPart.Hash,error:URLPart.Hash,expires_in:URLPart.Hash,scope:URLPart.Hash,token_type:URLPart.Hash,data:URLPart.Hash,script:URLPart.Hash,dmode:URLPart.Hash,jasmine:URLPart.Hash,touch:URLPart.Hash,file:URLPart.Hash,panes:URLPart.Hash,offline:URLPart.Hash,live:URLPart.Hash,test:URLPart.Hash,nolocal:URLPart.Hash,nosync:URLPart.Hash,rdebug:URLPart.Hash,rsession:URLPart.Hash,cacheError:URLPart.Hash,state:URLPart.Search};return o.hasURLParam=function(e,i){var o=e+"=";i&&(o+=i);var r=n(e);r||log("Invalid URL Part");var a=t(r);return a.indexOf(o)>=0},o.getURLParam=function(e,t){var i=t?t:n(e);if(i===URLPart.Search){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var o="[\\?&]"+e+"=([^&#]*)",r=new RegExp(o),a=r.exec(window.location.href);return null===a?void 0:decodeURIComponent(a[1].replace(/\+/g," "))}if(i===URLPart.Hash){for(var s,d=window.location.hash.substring(1),r=/([^&=]+)=([^&]*)/g;s=r.exec(d);)if(decodeURIComponent(s[1])===e)return decodeURIComponent(s[2]);return void 0}log("Invalid URL part")},o.insertURLParam=function(i,o,r){i=encodeURIComponent(i),o=encodeURIComponent(o);for(var a=n(i),s=t(a),d=s.substr(1).split("&"),c=d.length-1;c>=0;c--){var l=d[c].split("=");if(l[0]==i){l[1]=o,d[c]=l.join("=");break}}0>c&&(d[d.length]=[i,o].join("=")),e(a,d.join("&")),a!==URLPart.Hash||r||window.location.reload()},o.removeURLParam=function(i,o){i=encodeURIComponent(i);for(var r=n(i),a=t(r),s=a.substr(1).split("&"),d=s.length-1;d>=0;d--){var c=s[d].split("=");if(c[0]==i){s.splice(d,1);break}}e(r,s.join("&")),r!==URLPart.Hash||o||window.location.reload()},o.__storage=window.localStorage,o.storage={getItem:(o.__storage.getItem||function(e,t){return this.get(e,t||i)}).bind(o.__storage),setItem:(o.__storage.setItem||function(e,t){var n={};n[e]=t,o.__storage.set(n)}).bind(o.__storage),removeItem:(o.__storage.removeItem||function(e,t){this.remove(e,t)}).bind(o.__storage)},o}),define("platform",["ko","util"],function(e,t){function n(){this.versionRequired=[],this.versionRequired[AppPlatform.iOS]=4,this.versionRequired[AppPlatform.Android]=4,this.versionRequired[AppPlatform.WinPhone]=1,this.versionRequired[AppPlatform.Chrome]=1,this.appStoreLinks=[],this.appStoreLinks[AppPlatform.iOS]="http://itunes.com/apps/moodoorganizeyourway",this.appStoreLinks[AppPlatform.Android]="https://play.google.com/store/apps/details?id=moo.do",this.appStoreLinks[AppPlatform.WinPhone]=void 0,this.appStoreLinks[AppPlatform.Chrome]="https://chrome.google.com/webstore/detail/moodo/iffimmolghilclfndeiebgppddmagofk",this.appReviewLinks=[],this.appReviewLinks[AppPlatform.iOS]=void 0,this.appReviewLinks[AppPlatform.Android]=void 0,this.appReviewLinks[AppPlatform.WinPhone]=void 0,this.appReviewLinks[AppPlatform.Chrome]=void 0,this.appPlatform=void 0,this.appStoreLink=void 0,this.appReviewLink=void 0,this.requireCustomRedirect=!1,this.b=document.documentElement||document.body,this.orientation=Orientation.Portrait,this.windowWidth=e.observable(0),this.windowHeight=e.observable(0),this.kbsize=void 0,this.kbsizePortrait=void 0,this.kbsizeLandscape=void 0,this.hasBeenPortrait=!1,this.iframeApp=void 0,this.appState=void 0,this.isPhantom=!1,this.isDevURL="dev.moo.do"===window.location.hostname,this.init();var t=!1||this.isDevURL||this.app&&this.debugApp||!this.app&&this.standalone;this.customRedirectString=window.location.protocol+"//"+(t?window.location.host:"www.moo.do")+"/app/",this.app&&(this.customRedirectState={app:!0,appv:this.versionRequired[this.appPlatform]}),this.keyboardOpenTime=this.app||this.android?200:this.winphone?200:this.mobileie?600:0}return window.Orientation={Portrait:0,Landscape:1},window.AppPlatform={iOS:0,Android:1,WinPhone:2,Chrome:3},n.prototype={getKBTop:function(){return!this.app&&this.android?0:this.getKBSize()},getKBSize:function(){return this.kbsize?this.kbsize:Math.ceil(window.innerHeight/2.5)},setKBSize:function(e){this.kbsize=parseInt(e)},getPlatformInfo:function(e){e.os=this.OSName,e.browser=this.browser,e.appVersionRequired=this.versionRequired[this.appPlatform],e.app=this.app,e.appPlatform=this.appPlatform,e.standalone=this.standalone,e.packagedApp=this.packagedApp,e.requireCustomRedirect=this.requireCustomRedirect,e.isMobile=this.mobile,e.isPhone=this.phone,e.isTouch=this.touch,e.isTouchDevice=this.isTouchDevice,e.usePointerEvents=this.usePointerEvents,e.kbsize=this.kbsize,e.appState=this.appState,e.bodyClass=this.b.className,e.rawUA=navigator.userAgent},init:function(){this.initAppState();var e=navigator.userAgent,i="";if(this.app&&(i+=" app"),-1!==e.indexOf("Win")?(this.OSName="Windows",this.windows=!0,-1!==e.indexOf("Windows Phone")&&(this.phone=!0,this.touch=!0,this.mobile=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.WinPhone],this.app&&(this.appPlatform=AppPlatform.WinPhone))):-1!==e.indexOf("iPad")?(this.OSName="iPad",this.ios=!0,this.ipad=!0,this.phone=!0,this.touch=!0,this.mobile=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.iOS],this.app&&(this.appPlatform=AppPlatform.iOS)):-1!==e.indexOf("iPhone")?(this.OSName="iPhone",this.ios=!0,this.iphone=!0,this.phone=!0,this.mobile=!0,this.touch=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.iOS],this.app&&(this.appPlatform=AppPlatform.iOS)):-1!==e.indexOf("iPod")?(this.OSName="iPod",this.ios=!0,this.ipod=!0,this.phone=!0,this.mobile=!0,this.touch=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.iOS],this.app&&(this.appPlatform=AppPlatform.iOS)):-1!==e.indexOf("Mac")?(this.OSName="MacOS",this.mac=!0):-1!==e.indexOf("X11")?(this.OSName="UNIX",this.unix=!0):-1!==e.indexOf("Android")?(this.OSName="Android",this.android=!0,this.touch=!0,this.mobile=!0,this.phone=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.Android],this.app&&(this.appPlatform=AppPlatform.Android),i+=" android"):-1!==e.indexOf("Linux")&&(this.OSName="Linux",this.linux=!0),this.ios&&(this.ios7=-1!==e.indexOf("OS 7"),this.ios70=-1!==e.indexOf("OS 7_0"),this.ios71=-1!==e.indexOf("OS 7_1"),this.ios7&&(i+=" ios7")),this.appReviewLink=this.appReviewLinks[this.appPlatform],this.majorVersion=1e3,this.minorVersion=1e3,-1!==e.indexOf("MSIE")||-1!==e.indexOf("Trident")){this.browser="Trident",this.ie=!0,this.winphone=!!e.match(/IEMobile/i);var o;if(o=new RegExp(this.winphone||"Microsoft Internet Explorer"===navigator.appName?"MSIE ([0-9]{1,}[.0-9]{0,})":"Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!=o.exec(e))this.majorVersion=parseFloat(RegExp.$1);else{var r=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");null!=r.exec(e)&&(this.majorVersion=parseFloat(RegExp.$1))}}else if(-1!==e.indexOf("Chrome")||-1!==e.indexOf("CriOS")){this.browser="Chrome",this.isChrome=!0;var o=new RegExp("Chrome/([0-9]{1,}).");null!=o.exec(e)&&(this.majorVersion=parseFloat(RegExp.$1))}else if(-1!==e.indexOf("Android")){this.browser="Native Android";var o=new RegExp("Linux; Android ([0-9]{1,}).([0-9]{1,}).");null!=o.exec(e)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))}else if(-1!==e.indexOf("Firefox")){this.browser="Firefox";var o=new RegExp("Firefox/([0-9]{1,}).");null!=o.exec(e)&&(this.majorVersion=parseFloat(RegExp.$1))}else if(-1!==e.indexOf("Safari")||"iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName){this.browser="Safari";var o;o=new RegExp(this.mobile?"OS ([0-9]{1,})_([0-9]{1,})":"Version/([0-9]{1,}).([0-9]{1,})."),null!=o.exec(e)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))}else-1!==e.indexOf("Opera")&&(this.browser="Opera");this.isTouchDevice=!!("ontouchstart"in window||window.navigator.msMaxTouchPoints),this.usePointerEvents=!!window.navigator.msPointerEnabled,log("Touch Device: "+this.isTouchDevice+" Pointer Events: "+this.usePointerEvents),log("Browser: "+this.browser+"  Major Version: "+this.majorVersion+"  Minor Version: "+this.minorVersion),this.isTouchDevice&&(this.usePointerEvents?(this.touchStartEvent="MSPointerDown",this.touchMoveEvent="MSPointerMove",this.touchEndEvent="MSPointerUp",this.touchCancelEvent="MSPointerCancel"):(this.touchStartEvent="touchstart",this.touchMoveEvent="touchmove",this.touchEndEvent="touchend",this.touchCancelEvent="touchcancel")),this.usePointerEvents?(this.downEvent="MSPointerDown",this.moveEvent="MSPointerMove",this.upEvent="MSPointerUp"):(this.downEvent="mousedown",this.moveEvent="mousemove",this.upEvent="mouseup");try{var a=!!t.storage.getItem("forceFullUI")}catch(s){}t.hasURLParam("touch","false")||a?(this.touch=!1,this.phone=!1,this.mobile=!1,this.ios=!1,this.android=!1):(this.isTouchDevice||t.hasURLParam("touch","true"))&&(this.touch=!0,this.phone=!0,this.mobile=!0),this.windows&&(i+=" windows",this.ie?(i+=" ie",this.demo||(this.mobro=this.isMobro())):"Firefox"===this.browser&&(i+=" firefox")),this.phone&&(i+=" phone"),this.ipad&&(i+=" ipad"),this.mobileie=this.ie&&this.mobile,this.mobile&&!this.app&&this.calcKeyboardSize(),this.isChrome&&this.app&&(window.addEventListener("message",this.onChromeMessage.bind(this)),this.isPackagedApp=!0),this.cmdChar=this.mac?"⌘":"ctrl",this.cmdCharC=this.mac?"⌘":"Ctrl",this.cmdCharP=this.mac?"⌘":"Ctrl+",this.noErrorStacks="iPad"===n.OSName||"iPhone"===n.OSName||"iPod"===n.OSName,this.standalone=!!window.navigator.standalone||window.navigator.userAgent.indexOf("FluidApp")>=0,(this.standalone||this.app||this.mobro)&&(this.requireCustomRedirect=!0),i&&i.length>0&&(this.b.className+=i),this.transition=this.addPrefix("transition"),this.animation=this.addPrefix("animation"),this.transform=this.addPrefix("transform"),this.transformOrigin=this.addPrefix("transformOrigin"),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},this.ie&&(document.documentElement.addEventListener("MSHoldVisual",function(e){e.preventDefault()},!1),document.documentElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1)),document.documentElement.addEventListener("keydown",this.normalizeKeys,!0),document.documentElement.addEventListener("keypress",this.normalizeKeys,!0),document.documentElement.addEventListener("keyup",this.normalizeKeys,!0)},isMobro:function(){var e=null;try{new ActiveXObject("")}catch(t){errorName=t.name}try{e=!!new ActiveXObject("htmlfile")}catch(t){e=!1}return e="ReferenceError"!=errorName&&0==e?!1:!0,!e},calcKeyboardSize:function(){this.ios?this.iphone||this.ipod?(this.kbsizePortrait=216,this.kbsizeLandscape=162,this.ios71&&(this.kbsizePortrait+=44,this.kbsizeLandscape+=44)):this.ipad&&(this.kbsizePortrait=264,this.kbsizeLandscape=352,this.kbsizePortrait+=44,this.kbsizeLandscape+=44):this.android?(this.kbsizePortrait=Math.ceil(window.innerHeight/2.5),this.kbsizeLandscape=Math.ceil(window.innerWidth/2)):this.mobileie&&(this.kbsizePortrait=226,this.kbsizeLandscape=200)},normalizeKeys:function(e){void 0===e.normCode&&(e.normCode=null===e.keyCode||0===e.keyCode?null!=e.charCode?e.charCode:e.which:e.keyCode)},initAppState:function(){var e=location.hash.substring(1);if(e)for(var n,i=/([^&=]+)=([^&]*)/g;n=i.exec(e);)if("state"===decodeURIComponent(n[1])){var o=decodeURIComponent(n[2]);if(o){try{e=JSON.parse(o)}catch(r){log("Error parsing AppState: ",o),e=void 0}e&&(this.app=e.app===!0,this.appv=e.appv,this.debugApp=e.debug,this.live=e.live,this.offline=e.offline,this.syncContacts=e.syncContacts,this.test=e.test,this.appState=e)}break}this.live=this.live||t.hasURLParam("live","true"),this.test=!1,this.offline=this.offline||this.test||t.hasURLParam("offline","true")||!1,this.demo=t.hasURLParam("demo","true")||!1,this.script=t.hasURLParam("script")},addPrefix:function(e){var t="",n=["ms","webkit","moz","o"],i=this.b.style;if("string"==typeof i[e])t="";else for(var o=0;o<n.length;o++)if("string"==typeof i["-"+n[o]+"-"+e]){t=n[o];break}var r=t.length>0?e.charAt(0).toUpperCase()+e.slice(1):e;return t?{prop:"-"+t+"-"+e,style:t+r}:{prop:e,style:r}},blockClient:function(){switch(this.browser){case"Firefox":if(this.majorVersion<16)return{platform:"Firefox",browser:this.browser,update:!0};break;case"Chrome":if(this.majorVersion<26)return{platform:"Chrome",browser:this.browser,update:!0};break;case"Native Android":if(2===this.majorVersion&&this.minorVersion<1||this.majorVersion<2)return{platform:"Native Android",browser:"NativeAndroid",update:!0};break;case"Opera":return{platform:this.browser,browser:this.browser,update:!1};case"Trident":if(this.majorVersion<10)return{platform:"Internet Explorer",browser:this.browser,update:!0};break;case"Safari":if(this.mobile&&this.majorVersion<6)return{platform:"Safari",browser:this.browser,update:!0};if(!this.mobile&&(6==this.majorVersion&&this.minorVersion<1||this.majorVersion<6))return{platform:"Safari",browser:this.browser,update:!0}}if(this.app){if(this.appv<this.versionRequired[this.appPlatform])return log("App Version out of date."),{version:this.versionRequired[this.appPlatform]};if(this.appv>this.versionRequired[this.appPlatform])return log("App is newer than the javascript, forcing an app cache update"),{cacheUpdate:!0,error:!1}}if("1410556436454"!==document.body.getAttribute("ver")){var e=t.hasURLParam("cacheError");if(require(["globals"],function(t){t.reportError(new Error("VersionMismatch, CacheError: "+e))}),!e)return this.sendToApp("resetCache"),{cacheUpdate:!0,error:!0}}},actionVerb:function(){return this.touch?"tap":"click"},actionVerbCaps:function(){return this.touch?"Tap":"Click"},updateOrientation:function(){var e=90==Math.abs(window.orientation)?Orientation.Landscape:Orientation.Portrait;return this.orientation==Orientation.Portrait&&(this.hasBeenPortrait=!0),this.orientation=e,this.app||(this.kbsize=this.orientation==Orientation.Portrait?this.kbsizePortrait:this.kbsizeLandscape),this.orientation},sendToApp:function(e,t){if(this.app)if(this.ios){var n=!1;this.iframeApp||(this.iframeApp=document.createElement("IFRAME"),this.iframeApp.setAttribute("height","1px"),this.iframeApp.setAttribute("width","1px"),this.iframeApp.id="appComm",n=!0);var i="duchess://"+e;void 0!==t&&(i+="//"+t),this.iframeApp.src=i,n&&document.documentElement.appendChild(this.iframeApp)}else this.android&&void 0!==AppInterface?void 0!==AppInterface.sendAppMessage&&null!==AppInterface.sendAppMessage?AppInterface.sendAppMessage(e,t):require(["globals"],function(e){e.reportError(new Error("Missing AppInterface.sendAppMessage from app"))}):this.isChrome&&this.appWindow&&(log("send to chrome",e),this.appWindow.postMessage(e+":"+(void 0!==t?t:""),"*"))},onChromeMessage:function(e){if(0===e.origin.indexOf("chrome")){log("chrome message",e);var t=e.data.split(":");this.appWindow&&this.appOrigin||(this.appWindow=event.source,this.appOrigin=event.origin);var t=e.data.split(":"),n=t[1];switch(n){case"start":this.sendToApp("loaded");break;default:log("Unhandled Chrome Message: ",n,t)}}}},new n}),this.document&&(window.dateWrapper=dateWrapper),!this.dateLibLoaded&&this.document){var isDemoVideo=!1;dateWrapper(isDemoVideo)}define("date",function(){}),define("globals",["ko","platform","util","date"],function(e,t,n){function i(e,t){var n,i,o,r,a,s,d,c;for(n=3&e.length,i=e.length-n,o=t,a=3432918353,s=461845907,c=0;i>c;)d=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,d=(65535&d)*a+(((d>>>16)*a&65535)<<16)&4294967295,d=d<<15|d>>>17,d=(65535&d)*s+(((d>>>16)*s&65535)<<16)&4294967295,o^=d,o=o<<13|o>>>19,r=5*(65535&o)+((5*(o>>>16)&65535)<<16)&4294967295,o=(65535&r)+27492+(((r>>>16)+58964&65535)<<16);switch(d=0,n){case 3:d^=(255&e.charCodeAt(c+2))<<16;case 2:d^=(255&e.charCodeAt(c+1))<<8;case 1:d^=255&e.charCodeAt(c),d=(65535&d)*a+(((d>>>16)*a&65535)<<16)&4294967295,d=d<<15|d>>>17,d=(65535&d)*s+(((d>>>16)*s&65535)<<16)&4294967295,o^=d}return o^=e.length,o^=o>>>16,o=2246822507*(65535&o)+((2246822507*(o>>>16)&65535)<<16)&4294967295,o^=o>>>13,o=3266489909*(65535&o)+((3266489909*(o>>>16)&65535)<<16)&4294967295,o^=o>>>16,o>>>0}function o(e){try{for(var t=JSON.parse(JSON.stringify(e)),n=0;n<t.length;++n)""!==t[n].search&&(t[n].search="HasSearch");return JSON.stringify(t)}catch(i){return"Failed to sanitize pane state"}}function r(e){try{var t=JSON.parse(e);return delete t.paneState,delete t.gdocTitle,JSON.stringify(t)}catch(n){return"Failed to parse settings"}}function a(e){switch(e){case KeyCode.BackSpace:return"BACKSPACE";case KeyCode.Delete:return"DELETE";case KeyCode.Enter:return"ENTER";case KeyCode.Escape:return"ESCAPE";default:return"CHAR"}}function s(){var e=C.settings.get("activeUser");return e?"MooDoRDebug"+(new Date).getTime()+"_"+e:"Unknown"}function d(e){return function(){try{if(e)return e.apply(void 0,arguments)}catch(t){C.reportError(t,arguments)}}}function c(e,t){e.onloadDone=!1,e.onload=function(){e.onloadDone=!0,t&&t()},e.onReadystatechange=function(){"loaded"!==e.readyState||e.onloadDone||(e.onloadDone=!0,t&&t())}}function l(e){for(var t="",n=0;n<e.length;++n)t+=" "+C.safeStringify(e[n]);
return t}function u(e){function t(e){if(e)if(e.nodeType===Node.TEXT_NODE)n.push(e);else for(var i=0;i<e.childNodes.length;++i){var o=e.childNodes[i];t(o)}}var n=[];return t(e),n}function h(e){function t(e){if(e){if(e.nodeType===Node.TEXT_NODE)return e;for(var n=0;n<e.childNodes.length;++n){var i=t(e.childNodes[n]);if(i)return i}}}return t(e)}function p(e,t){for(var n=0,i=u(e),o=0;o<i.length;++o){var r=i[o].length;if(n+r>=t)return{element:i[o],offset:t-n};n+=r}return void 0}function f(e){for(var t=u(e),n=0,i=0;i<t.length;++i)n+=t[i].length;return n}function m(e){return C.hasClass(e,"text")||"androidInput"===e.id&&I.isEnabled()}function g(){var e=2,t=12,n=Q.pane.getScroller(),i=e+t*Q.speed;n.scrollTop+=i,Z&&requestAnimationFrame(g)}function v(e,t,n,i){var o,r,a,s;e.nodeType===Node.TEXT_NODE||e.nodeType===Node.COMMENT_NODE?(o=e,r=t):t<e.childNodes.length?(o=h(e.childNodes[t]),r=0):(o=h(e.childNodes[t-1]),r=o.textContent.length),n.nodeType===Node.TEXT_NODE||n.nodeType===Node.COMMENT_NODE?(a=n,s=i):i<n.childNodes.length?(a=h(n.childNodes[i]),s=0):(a=h(n.childNodes[i-1]),s=a.textContent.length),C.selectMultiline(o,r,a,s)}function y(e,t){for(var n=0;n<t.length;++n)e.comparator?e.comparator(t[n])&&e.action(t[n]):e.each&&e.each(t[n]),e.item=t[n],C.searchVMLIs(e)}function b(e,t){var n={};for(var i in e)if(void 0!==e[i]&&null!==e[i]){var o=t[i];o?n[o]=e[i]:n[i]=e[i]}return n}function S(e,t,n){if(!e){var i=C.getSelectionInfo();i?e=i.node:I.isEnabled()&&(e=I.getCurrentSpan())}if(document.createEvent&&e){var o=document.createEvent("Event");o.normCode=n.normCode,o.shiftKey=!!n.shiftKey,o.synthetic=!0,o.initEvent(t,!0,!0),e.dispatchEvent(o)}}function T(e,t,n,i){if(!e){var o=C.getSelectionInfo();o&&(e=o.node)}if(document.createEvent&&e){var r=document.createEvent("Event");if(r.button=n,r.synthetic=!0,i)for(var a in i)r[a]=i[a];r.initEvent(t,!0,!0),e.dispatchEvent(r)}}function w(){document.removeEventListener("DOMContentLoaded",w,!1),window.removeEventListener("load",w,!1);for(var e=0;e<tt.length;++e)tt[e]();tt=void 0}function M(e){var t="";if("object"==typeof e){var n=[];for(key in e)n[n.length]=encodeURIComponent(key)+"="+encodeURIComponent(e[key]);t=n.join("&").replace(/%20/g,"+")}else t=e;return t}var C={vmMain:void 0,vmDebug:void 0,topBarHeight:t.android?48:40,topBoxHeight:t.phone?50:150,keyboardToolbarHeight:40,hasFocus:!0,zoomTime:0,demoMode:!1,intro:void 0,focusedPaneID:void 0,focusedPane:void 0,focusedItem:void 0,isScrolling:!1,ClickThreshold:5,topLevelInitId:void 0,isReconnected:!1,noLocalWrites:!1,isLoadingRemote:!1,canRevealMenu:!0,revealingMenu:!1,isKeyboardOpen:!1,dragging:void 0,draggingHidden:void 0,dragStartInfo:{x:0,y:0},dragStartTimeout:void 0,startDrag:void 0,itemMenuOpenedOn:void 0,tempUL:document.getElementById("tempUL"),elements:{}},x=C,I={isEnabled:function(){return!!t.android}};require(["android"],function(e){I=e});var E;require(["VMLI"],function(e){E=e});var k;require(["VMPane"],function(e){k=e}),window.KeyCode={BackSpace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,Hash:35,Home:36,LeftArrow:37,UpArrow:38,RightArrow:39,DownArrow:40,Delete:46,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D8:56,LAngle:60,RAngle:62,At:64,A:65,B:66,E:69,F:70,G:71,I:73,N:78,O:79,S:83,U:85,V:86,Y:89,Z:90,LeftMeta:91,RightMeta:93,NumPlus:107,F4:115,Equals:187,Comma:188,Dash:189,Period:190,Slash:191,Tilde:192,LBracket:219,RBracket:221,Apos:222},window.ButtonCode={None:-1,Left:0,Middle:1,Right:2},window.TextSpace="﻿",C.PhoneWidth=480,window.DriveStatus={Offline:0,Connecting:1,Saving:2,Saved:3,Reconnecting:4},window.PaneMode={Normal:1,Timeline:2},window.MessageAction={Default:0,Reload:1,Login:2,Demo:3,ResetClient:4,None:5,SyncContacts:6,OpenURL:7},window.MessageType={Info:0,Warning:1,Error:2,Fatal:3,Subtitle:4,Intro:5,RequiredUpdate:6,InfoGray:7,MobileOffline:8,MobileConnecting:9},window.MessageID={Undefined:0,ConnectionError:1,OfflineUndo:2,FatalError:3,DocChange:4,OfflineWarn:5,OnlineInfo:6,CacheReset:7,RequiredUpdate:8,Updated:9,MobileOffline:10,SyncContacts:11,MobileConnecting:12},window.VMLIFlag={None:0,Header:1,Collapsed:2,Selected:4,Highlighted:8,NumList:16,Complete:4096,P2:8192,P1:16384,P0:32768,Starred:65536},window.VersionType={Structure:1,Text:2},window.SaveFlag={None:0,Prop:1,Text:2,All:3},window.PropChangeType={None:0,Date:2,Complete:4,Archive:8,Starred:16,Priority:32,All:63},window.LoginState={NONE:0,LOGGED_OUT:1,LOGGED_IN:2},window.ReturnValue={Success:0,Error:1,FatalError:2},C.isFlagSet=function(e,t){return(e&t)===t},C.isAtLeastOneFlagSet=function(e,t){return 0!==(e&t)},C.PCFMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2|VMLIFlag.Complete|VMLIFlag.Starred,C.PCMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2|VMLIFlag.Complete,C.PFMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2|VMLIFlag.Starred,C.PMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2,C.fieldMapIn={id:"id",items:"i",archivedItems:"ai",text:"t",modifiedOffline:"l",modifiedOfflineText:"o",versionText:"u",version:"v",formats:"f",isArchived:"a",isDeleted:"x",isCollapsed:"m",date:"d",dateText:"s",allDayDate:"ad",dateCreated:"c",dateCompleted:"^",priority:"p",isComplete:"z",isStarred:"*"},C.priorityMapOut={},C.priorityMapOut[VMLIFlag.None]=" ",C.priorityMapOut[VMLIFlag.P0]=" p0",C.priorityMapOut[VMLIFlag.P1]=" p1",C.priorityMapOut[VMLIFlag.P2]=" p2",window.NumListPrefix="#.",window.NumListPrefixOther="1.",window.DatePrefix="@",window.ContactPrefix="+",C.getTransitionClass=function(e){var t;switch(e){case 50:t="trans05";break;case 100:t="trans1";break;case 200:t="trans2";break;case 300:t="trans3";break;case 400:t="trans4";break;case 500:t="trans5";break;case 1e3:t="trans10";break;default:console.log("ERROR: no time for ",e)}return t},C.setTransformStyle=function(e,n,i){e&&(e.style[t.transform.style]=t.ie?"translate("+n+"px, "+i+"px)":"translate3d("+n+"px, "+i+"px, 0px)")},C.setTransitionStyle=function(e,n,i,o){e&&(o=o||"ease",e.style[t.transition.style]=n+" "+i+"ms "+o,setTimeout(function(){e.style[t.transition.style]=""},i))};var D=!1;C.setTransform=function(e,n,i,o,r){o>0?D?C.setTransformStyle(e,n,i):(C.setTransitionStyle(e,t.transform.prop,o,r),C.setTransformStyle(e,n,i)):n||i?C.setTransformStyle(e,n,i):e.style[t.transform.style]="none"},C.reload=function(){L&&C.reportError(new Error("Page requesting reload while waiting for AppCache update.")),window.location.reload()},C.isSetupPageOpen=!1,C.isMainPageOpen=!1,C.openMainPage=function(){C.isSetupPageOpen&&(C.isSetupPageOpen=!1),C.isMainPageOpen||(C.isMainPageOpen=!0);var e=document.getElementById("outerWrapper"),n=document.getElementById("setupWrapper");e&&n&&(C.removeClass(e,"none"),C.addClass(n,"none")),t.mobile&&setTimeout(function(){C.ScreenManager.computeSnapPoints(),t.mobileie&&C.ScreenManager.scrollToScreen(Screens.List,0)}.bind(this),0)},C.openSetupPage=function(){C.isMainPageOpen&&(C.isMainPageOpen=!1),C.addClass(document.getElementById("outerWrapper"),"none"),C.removeClass(document.getElementById("setupWrapper"),"none")};var P=!1,L=!1;C.setAppCacheUpdateState=function(e){L=e,e&&(P=!0)},C.isEmpty=function(e){for(var t in e)return!1;return!0},C.isEmail=function(e){var t=new RegExp(/.+@.+\..+/i),n=t.exec(e);return!!n},C.removeDOM=function(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)},C.isRunningScript=function(){return C.AScript&&C.AScript.isRunning};var O=!1;C.goOnline=function(){C.noLocalWrites&&!C.isDemoMode()&&(C.messageQueue.clearMessage(MessageID.OfflineWarn),C.messageQueue.pushMessage(MessageID.OnlineInfo)),O=!1},C.goOffline=function(){C.noLocalWrites&&!C.isDemoMode()&&(C.messageQueue.clearMessage(MessageID.OnlineInfo),C.messageQueue.pushMessage(MessageID.OfflineWarn)),O=!0},C.isOffline=function(){return O},C.preventLocalWrites=function(){ShouldLog(LogLevels.Warning)&&log("---- WARNING: Local Writes Disabled ----"),O&&!C.isDemoMode()&&(C.messageQueue.clearMessage(MessageID.OnlineInfo),C.messageQueue.pushMessage(MessageID.OfflineWarn)),C.noLocalWrites=!0},C.shouldWriteLocal=function(){return!C.noLocalWrites},C.enableDemoMode=function(){C.demoMode=!0;var e=n.getURLParam("dmode");e&&C.enableMinMode(e),t.mobile||t.script||C.activeDisplayMode&DisplayMode.NoDemoSidebar||C.messageQueue.pushMessage({text:"You are in demo mode, so your information is not being saved. Click here to leave the demo.",type:MessageType.Info,action:MessageAction.Login}),C.preventLocalWrites()},C.isDemoMode=function(){return C.demoMode},window.DisplayMode={Default:0,NoTopBar:1,NoPaneHeaders:2,ForceTwoPane:4,NoScrollbars:8,NoBackground:16,NoPaneTop:32,NoInteraction:64,NoPanePadding:128,NoPaneStyle:256,NoRightClick:512,ShowBanner:1024,NoDemoSidebar:2048,FullMin:4095},C.activeDisplayMode=DisplayMode.Default,C.isDisplayModeActive=function(e){return(C.activeDisplayMode&e)===e},C.enableMinMode=function(e){try{if(C.addClass(document.body,"minMode"),e=parseInt(e),!t.touch){if(e&DisplayMode.NoTopBar){var n=document.getElementById("desktopMenu");n&&C.addClass(n,"none");var i=document.getElementById("container");i&&(i.style.top="0px");for(var o=document.getElementsByClassName("pane"),r=0;r<o.length;++r)o[r]&&(o[r].style.marginTop="0px",o[r].style.height="100%")}e&DisplayMode.NoPaneHeaders&&C.addClass(document.body,"noPaneHeaders"),e&DisplayMode.NoPaneTop&&C.addClass(document.body,"noPaneTopBox"),e&DisplayMode.NoPaneStyle&&C.addClass(document.body,"noPaneStyle")}if(e&DisplayMode.NoPaneTop&&C.addClass(document.body,"noPanePadding"),e&DisplayMode.NoScrollbars&&C.addClass(document.body,"noScrollbars"),e&DisplayMode.NoBackground){var a=document.getElementsByTagName("html")[0];a&&C.addClass(a,"noBackground")}if(e&DisplayMode.NoInteraction){var s=document.getElementById("preventInteraction");s&&(C.removeClass(s,"none"),s.addEventListener("mousewheel",function(e){return e.stopImmediatePropagation(),!1},!0),s.addEventListener("mousedown",function(e){return e.preventDefault(),e.stopImmediatePropagation(),!1},!0),s.addEventListener("keydown",function(e){return e.preventDefault(),e.stopImmediatePropagation(),!1},!0))}C.activeDisplayMode=parseInt(e)}catch(d){C.reportError(d)}},C.sendEvent=function(e,t,n){window.ga&&!C.isDemoMode()&&ga("send","event",e,t,C.getAnonUserIdentifier(),n)},C.sendTimeEvent=function(e,t,n){window.ga&&!C.isDemoMode()&&ga("send","timing",e,t,n,C.getAnonUserIdentifier())};var A=void 0;C.startTimeEvent=function(e,t){log&&log.now&&(A={startTime:log.now(),category:e,variable:t})},C.endTimeEvent=function(){if(log&&log.now){var e=log.now()-A.startTime;C.sendTimeEvent(A.category,A.variable,e),A=void 0}};var R={};C.registerEvent=function(e,t,n){var i={category:t,action:n,label:C.getAnonUserIdentifier(),count:0};R[e]=i},C.aggregateEvent=function(e,t){void 0===t&&(t=1),R[e]&&(R[e].count+=t)};var _=!1;C.pageDataCleared=function(){_=!0},C.onunload=function(){log("Unloading the page");try{for(var e in R){var t=R[e];C.sendEvent(t.category,t.action,t.count),t.count=0}if(C.vmMain&&C.vmMain.failedGapiLoad?C.sendEvent("ScriptLoad","GapiFailed"):gapiCalled||C.sendEvent("ScriptLoad","GapiNotLoaded"),C.vmMain&&C.vmMain.updatePaneScrollState(),!_)try{var n=require("gdata");n&&C.settings.set(Settings.lastServerVersion,n.getServerVersion())}catch(i){}if(C.isLoadingRemote)return"We are still syncing your changes, are you sure you want to exit?"}catch(o){C.reportError(o)}},t.demo||(window.onbeforeunload=C.onunload);var N=LoginState.LOGGED_OUT;C.getLoginState=function(){var e=N;if(C.shouldWriteLocal())try{var t=n.storage.getItem("loginState");null!==t&&void 0!==t&&(e=parseInt(t))}catch(i){C.reportError(i)}return e},C.setLoginState=function(e){if(N=e,C.shouldWriteLocal())try{(isNaN(e)||null===e||void 0===e)&&(e=LoginState.LOGGED_OUT),n.storage.setItem("loginState",e)}catch(t){C.reportError(t)}},window.Settings={theme:"theme",syncContacts:"syncContacts",lastContactSync:"lastContactSync",disableNotifications:"disableNotifications",docSharing:"docSharing",authScopes:"authScopes",localIntegrity:"localIntegrity",paneState:"paneState",localDataVersion:"localDataVersion",shownTutorial:"shownTutorial",gdocId:"gdocId",gdocTitle:"gdocTitle",activeUser:"activeUser",noSounds:"noSounds",noLocalWrites:"noLocalWrites",lastMessageSync:"lastMessageSync",lastServerVersion:"lastServerVersion",helpPaneState:"helpPaneState",shownInstallInfo:"shownInstall"};var F=[Settings.localIntegrity,Settings.paneState,Settings.authScopes,Settings.localDataVersion,Settings.shownTutorial,Settings.lastContactSync,Settings.disableNotifications,Settings.gdocId,Settings.gdocTitle,Settings.activeUser,Settings.noSounds,Settings.lastMessageSync,Settings.lastServerVersion,Settings.noLocalWrites,Settings.lastMessageSync,Settings.helpPaneState,Settings.shownInstallInfo];C.settings={settings:{},prefix:"V~",init:function(){try{n.storage.setItem("poke",0)}catch(e){C.preventLocalWrites()}this.ensureLocalCopy()},initEvents:function(e){C.shouldWriteLocal()&&window.addEventListener("storage",function(t){if(t||(t=window.event),e(t),"localSettings"===t.key)try{this.settings=t.newValue?JSON.parse(t.newValue):{}}catch(n){C.reportError(n),this.settings={}}}.bind(this),!1)},ensureLocalCopy:function(e){if(C.shouldWriteLocal()&&(e||C.isEmpty(this.settings)))try{var t=n.storage.getItem("localSettings");this.settings=t?JSON.parse(t):{}}catch(i){C.reportError(i),this.settings={}}},flushLocalCopy:function(){if(C.shouldWriteLocal())try{n.storage.setItem("localSettings",JSON.stringify(this.settings))}catch(e){C.reportError(e)}},set:function(e,t,n){this.ensureLocalCopy(),null===n&&(n=0);var i=this.settings[e],o=this.getVersion(e),r=!1;if(i!==t||"object"==typeof t){if(void 0===n){if(r=!0,o>=0&&F.indexOf(e)<0){var a=this.getVersion(e);this.settings[this.prefix+e]=-(a+1)}}else r=this.isPropertyNewer(e,n),r&&(this.settings[this.prefix+e]=n);r&&(this.settings[e]=t,F.indexOf(e)<0&&(C.fireCustomEvent("settingsChange",{property:this.prefix+e,value:this.settings[this.prefix+e],isRemote:void 0!==n}),C.fireCustomEvent("settingsChange",{property:e,value:t,isRemote:void 0!==n}))),this.flushLocalCopy()}return r},get:function(e,t){return this.ensureLocalCopy(t),this.settings[e]},getVersion:function(e,t){return this.ensureLocalCopy(t),this.settings[this.prefix+e]||0},setVersion:function(e,t,n){this.ensureLocalCopy(n),this.settings[e]=t},reset:function(e){if(e)this.ensureLocalCopy(),delete this.settings[e],this.flushLocalCopy();else if(this.settings={},C.shouldWriteLocal())try{n.storage.setItem("localSettings","{}")}catch(t){C.reportError(t)}},resetAll:function(e){var t={};if(e)for(var i=0;i<e.length;++i)t[e[i]]=this.settings[e[i]];if(this.settings=t,e)this.flushLocalCopy();else if(C.shouldWriteLocal())try{n.storage.setItem("localSettings","{}")}catch(o){C.reportError(o)}},isPropertyNewer:function(e,t){var n=this.getVersion(e);return Math.abs(n)<Math.abs(t)},getRawSettings:function(){var e;if(C.shouldWriteLocal())try{e=n.storage.getItem("localSettings")}catch(t){C.reportError(t)}else try{return JSON.stringify(this.settings)}catch(t){return C.reportError(t),'{m: "Invalid Settings"}'}return e}};C.applyBindings=function(t,n){var i=document.getElementById(n);if(i&&t)try{e.applyBindings(t,i)}catch(o){throw o.message+=" | Binding on: "+C.elementToString(i),C.reportError(o),o}else{var r="Invalid model or element passed to applyBindings | ";r+=i?"NoModel - Elem: "+C.elementToString(i):t?"NoElem - Elem: #"+n:"NoModelNoElem - Elem: #"+n,C.reportError(new Error(r))}},e.observable.fn.toString=function(){return"observable: "+e.toJSON(this(),null,2)},e.computed.fn.toString=function(){return"computed: "+e.toJSON(this(),null,2)},e.bindingHandlers.load={init:function(e,t,n,i,o){var r,a=o.$parents.length-2;a>=0&&(r=o.$parents[a]),i&&i.onLoad&&i.onLoad(e,r)}},e.bindingHandlers.check={init:function(e,t,n,i){var o=t();o()&&C.addClass(e,"checked"),C.setupClick(e,i,{onClick:function(t){o(!o()),o()?C.addClass(e,"checked"):C.removeClass(e,"checked"),t.preventDefault(),t.stopPropagation()}})},update:function(e,t){var n=t();n()?C.addClass(e,"checked"):C.removeClass(e,"checked")}},e.bindingHandlers.tap={init:function(e,t,n,i){C.setupClick(e,i,t())}},e.bindingHandlers.stopBinding={init:function(){return{controlsDescendantBindings:!0}}},e.bindingHandlers.possHTML={init:function(){return{controlsDescendantBindings:!0}},update:function(t,n,i,o){o.isStyled?t.innerHTML=e.utils.unwrapObservable(n()):t.textContent=e.utils.unwrapObservable(n())}},e.bindingHandlers.tooltip={init:function(n,i){t.mobile||C.setupMouseOver(n,e.utils.unwrapObservable(i()),!1)},update:function(n,i){t.mobile||C.setupMouseOver(n,e.utils.unwrapObservable(i()),!0)}},C.setupMouseOver=function(e,t,n){C.tooltip?n?C.tooltip.update(e,t):C.tooltip.register(e,t):C.reportError(new Error("Tooltips registered before VMTooltip created"))},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),e.bindingHandlers.css2=e.bindingHandlers.css,C.findFirstDiff=function(e,t,n){if(!e)return t.length;if(!t)return e.length;for(var i=Math.min(e.length,t.length),o=0;i>o;++o)if(n){if(e.charAt(o).toLowerCase()!==t.charAt(o).toLowerCase())return o}else if(e.charAt(o)!==t.charAt(o))return o;return Math.max(e.length,t.length)},C.findMatchingLength=function(e,t,n){if(!e||!t)return 0;for(var i=Math.min(e.length,t.length),o=0;i>o;++o)if(n){if(e.charAt(o).toLowerCase()!==t.charAt(o).toLowerCase())return o}else if(e.charAt(o)!==t.charAt(o))return o;return i},C.TEMP_PREFIX="~T^";var V=0;C.generateTempId=function(){return C.TEMP_PREFIX+Date.now()+ ++V},C.isLocalItem=function(e){return e.id[0]===C.TEMP_PREFIX[0]&&e.id[1]===C.TEMP_PREFIX[1]&&e.id[2]===C.TEMP_PREFIX[2]},C.getClientInfo=function(e){C.XHR({type:"GET",url:"http://api.hostip.info/get_json.php",cb:function(t){if(200===t.status){var n=JSON.parse(t.responseText);e(n)}else e({ip:"Unknown"})}})},C.requestNotification=function(e){var t=document.forms.requestNotification,n=document.getElementById("notificationResult"),i=t.email.value;return void 0===i||null===i||i.length<5?n.innerText="Please enter a valid email address.":C.XHR({type:"POST",url:window.location.protocol+"//api.moo.do/requestNotification",data:{email:i,platform:e},cb:function(e){200===e.status?(t.email.value="",n.innerText="Thanks for your interest!"):n.innerText="There was an error processing your request, please try again in a few minutes."}}),!1};var B=void 0;C.getUserIdentifier=function(){if(!B){var e=require("goog"),t=e.authenticatedUserEmail()||C.settings.get("activeUser");if(!t)return"Unknown";B=t}return B};var U=void 0;C.getAnonUserIdentifier=function(){if(!U){var e=C.getUserIdentifier();U=e[0]+e[1]+e[2]+i(e,17124123)}return U},C.introHash=function(e){return i(e,347236113)},C.getRunningState=function(e){try{var t=C.settings.get(Settings.paneState)}catch(n){log("Failed to get paneState")}e.isDebug=!1,e.isDemo=C.isDemoMode(),e.localWrites=C.shouldWriteLocal(),e.isReconnected=C.isReconnected,e.url=window.location.href,e.paneState=o(t),e.localSettings=r(C.settings.getRawSettings()),e.loginState=C.getLoginState(),e.checkpoints=window.__checkpoints,e.gapiLoadError=gapiLoadError,e.windowWidth=window.innerWidth,e.windowHeight=window.innerHeight,e.selection=C.parseExtra(window.getSelection()),e.eventStream=C.getEventStream(),e.trackerStream=C.getTrackerStream(),e.screenManager=C.ScreenManager?C.ScreenManager.activeScreen:"UNDEFINED";try{e.validScreens=JSON.stringify(window.Screens)}catch(n){}e.rootId=C.vmMain?C.vmMain.root()?C.vmMain.root().id:"Undefined Root":"VMMain Not Initialized"},C.getAppInfo=function(e){var n="Loaded";C.vmMain&&C.vmMain.failedGapiLoad?n="ErrorLoading":gapiCalled||(n="NotLoaded"),e.gapiStatus=n,e.sessionID=window.__SESSION_ID,e.appCacheUpdated=P,t.getPlatformInfo(e),C.getRunningState(e),require("gdata").getState(e)},C.reportSignup=function(e,t){C.XHR({type:"POST",url:window.location.protocol+"//api.moo.do/reportSignup",data:{email:e,name:t},cb:function(e){200!==e.status&&ShouldLog(LogLevels.Error)&&log("Failed to report signup",e.responseText,e)}})};var q=!1;C.criticalErrorReported=function(){return q},C.handleCriticalError=function(){if(q=!0,C.isDemoMode())C.reload();else{var e=document.createElement("div");e.id="criticalError",e.textContent="There was a critical error while loading the app, "+t.actionVerb()+" to reload.",t.isTouchDevice?e.addEventListener(t.touchStartEvent,function(){C.reload()},!0):e.addEventListener(t.upEvent,function(){C.reload()},!0),C.prependChild(document.body,e),C.removeDOM("outerWrapper"),C.removeDOM("setupWrapper"),C.removeDOM("templates")}},C.safeStringify=function(e){try{return JSON.stringify(e)}catch(t){log("Error stringify object: "+t.message)}},C.reportEvent=function(e){if(!C.isDemoMode()){var t=C.parseExtra(e);C.eventStream.push(t)}},C.getEventStream=function(){return C.safeStringify(C.eventStream.ordered())},window.__getEventStream=C.getEventStream,C.getTrackerStream=function(){try{var e=require("tracker");return e.stringifyGroups()}catch(t){log("Error getting tracker stream: ",t.message)}},C.parseExtra=function(e){var t;if(e)try{var n;if(e instanceof KeyboardEvent)n={type:e.type,currentTarget:C.elementToString(e.currentTarget),target:C.elementToString(e.target||e.srcElement),keyCode:a(e.keyCode),normCode:a(e.normCode),ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,tstamp:Date.now()};else if(e instanceof window.MouseEvent)n={type:e.type,currentTarget:C.elementToString(e.currentTarget),relatedTarget:C.elementToString(e.relatedTarget),target:C.elementToString(e.target||e.srcElement),clientX:e.clientX,clientY:e.clientY,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,which:e.which,button:e.button,tstamp:Date.now()};else if(window.TouchEvent&&e instanceof window.TouchEvent){n={type:e.type,currentTarget:C.elementToString(e.currentTarget),relatedTarget:C.elementToString(e.relatedTarget),target:C.elementToString(e.target||e.srcElement),tstamp:Date.now()};var i=e.touches[0];i&&(n.clientX=i.clientX,n.clientY=i.clientY)}else if(window.PointerEvent&&e instanceof window.PointerEvent)n={type:e.type,currentTarget:C.elementToString(e.currentTarget),relatedTarget:C.elementToString(e.relatedTarget),target:C.elementToString(e.target||e.srcElement),clientX:e.clientX,clientY:e.clientY,tstamp:Date.now()};else if(e instanceof window.Event)n={type:e.type,currentTarget:C.elementToString(e.currentTarget),relatedTarget:C.elementToString(e.relatedTarget),target:C.elementToString(e.target||e.srcElement),tstamp:Date.now()};else if(e instanceof Selection)if(0===e.rangeCount)n={rangeCount:0};else{var o=x.getSelectionRange(),r=o.startContainer,s=!1,d=0,c=o.endContainer,l=!1,u=0;r.nodeType===Node.TEXT_NODE&&(d=r.length,r=r.parentNode,s=!0),C.hasClass(r,"text")&&(d=f(r)),c.nodeType===Node.TEXT_NODE&&(u=c.length,c=c.parentNode,l=!0),C.hasClass(c,"text")&&(d=f(c)),n={rangeCount:e.rangeCount,startContainer:C.getElementPath(r),startWasTextNode:s,startOffset:o.startOffset,startElementLength:d,endContainer:C.getElementPath(c),endWasTextNode:l,endOffset:o.endOffset,endElementLength:u}}else n=e;t=C.safeStringify(n)}catch(h){log("Error parsing extra "+h.message)}return t},window.__jsVersion="1410556436454",C.handleJSError=function(e,t,n,i){function o(){var n={};C.getAppInfo(n),C.XHR({type:"POST",url:window.location.protocol+"//api.moo.do/debug/reportError",data:{msg:e,url:window.location.href,stack:t,logs:r,info:JSON.stringify(n),user:a,extra:s,jsVersion:window.__jsVersion,htmlVersion:document.body.getAttribute("ver")},cb:function(e){200!==e.status?log("Failed to report remote error",e.responseText,e):log("Reported Remote Error: ",e.responseText)}})}if(i||console.error("JS Error: "+e,"  Stack: ",t,"  Extra: ",n),e||t)try{var r=r=__LOG_BUFFER.ordered().join("\r\n"),a=C.getUserIdentifier(),s=C.parseExtra(n);"Unknown"!==a?o():C.getClientInfo(function(e){e&&(a=e.ip),o()})}catch(d){log("Badness happened reporting errors to server: ",d)}else;},window.onerror=function(e,t,n,i,o){o?(log("Reported Global OnError: "+e+" Script: "+t+" Line: "+n+" Column: "+i),C.reportError(o)):(log("Unreported Global OnError: "+e+" Script: "+t+" Line: "+n+" Column: "+i),C.reportError(e))},C.reportError=function(e,t){!e||t||e.message||e.stack?e&&e.e&&C.isString(e.e)&&(e={message:e.e,stack:C.getCurrentStack("")}):(t=e,e=void 0),e||(e={message:"Undefined error passed to reporter",stack:C.getCurrentStack("")}),C.handleJSError(e.message,e.stack,t)},window.__SendInfo=function(e){return C.handleJSError("Remote Client Info",void 0,e,!0),"Thank you for providing your client info!"},window.__CreateDebugSession=function(e){if(window.remote)return"Debug session already started";var t=e||s();window.rcon=window.console,C.handleJSError("Remote Debug Session",void 0,t,!0),C.addScript("http://jsconsole.com/remote.js?"+t,"rDebugScript");var n=!1,i=0,o="";return window.rdbg={startProfile:function(e){try{return n?"Profiler already running":(o=e?e:"RDBGProfile_"+i,window.rcon.profile(o),n=!0,"Profiler Started: "+o)}catch(t){return"Error starting profile: "+t.message}},stopProfile:function(){try{if(n){window.rcon.profileEnd(o),n=!1;var e="Profile Completed: "+o;return o="",i++,e}return"Profiler not running, use startProfile()"}catch(t){return"Error stopping profile: "+t.message}}},"Your remote debug session has started: "+t},(n.hasURLParam("rsession")||n.hasURLParam("rdebug","true"))&&setTimeout(function(){var e=n.getURLParam("rsession")||s();window.__CreateDebugSession(e),log("%c---- REMOTE DEBUGGING ENABLED: "+e+" ----","color: green")},2e3),t.demo||console.log('%cIf you have been asked to send us your client information or have been seeing issues, please use __SendInfo("MESSAGE") to give us your information.',"color: green"),window.Checkpoint={MainRun:1,RequireLoaded:2,PageLoad:4,LocalDocLoad:8,InitData:16,DBLoaded:32,OnInitializedData:64,InitializeMain:128,LoadDefaultFile:256,MaskRequired:511},C.checkpoint=function(e){window.__checkpoints|=e},C.hasSentLowMemoryWarning=e.observable(!1),C.handleLowMemory=function(e){C.hasSentLowMemoryWarning()||(C.hasSentLowMemoryWarning(!0),log("Low Memory Event: ",e),C.handleJSError("DeviceLowMemory: "+e,void 0))};var H=/function\s+([^(]*?)\s*\(([^)]*)\)/,W=!1;C.getCurrentStack=function(e){if(W||t.noErrorStacks)try{var n=JSON.stringify(e)}catch(i){log("Error stringifying stack message",i,e)}if(W){var i=new Error(n||e);if(i.stack)return i.stack}W=!1;try{for(var o=["GenError: "+(n||e)],r=arguments.callee.caller,a=75,s=0;r&&s++<a;){var d,c=r.toString(),l=H.exec(c);d=l&&3===l.length&&""!==l[1]&&void 0!==l[1]?"at "+l[1]+"("+l[2].replace(/[\r\n]/g,"")+")":l&&3===l.length?"at <anonymous> ("+l[2].replace(/[\r\n]/g,"")+")":"at <anonymous> (<unknown>)",o.push(d),r=r.caller}return o.join("\n")}catch(i){log("Error generating stack trace",i)}return""};var K=12e5,j=0;C.checkForRemoteChanges=function(){var e=Date.now();if(j-e>=K)try{C.AppCache.checkForUpdate(),C.messageQueue.updateRemoteMessages()}catch(t){C.reportError(t)}finally{j=e}},C.createRingBuffer=function(e){var t=0,n=[],i=e;return{get:function(e){return n[e]},push:function(e){n[t]=e,t=(i+t+1)%i},count:function(){return t},reset:function(){t=0,n=[]},buffer:function(){return n},limit:function(e){i=e},ordered:function(){return n.slice(t).concat(n.slice(0,t))},entries:function(){for(var e=this.ordered(),t=0;t<e.length;++t)console.log("---- Entry ["+t+"] ----"),console.log(e[t])}}},C.wrapFn=function(e){function t(){try{return e.apply(this,arguments)}catch(t){var n;try{n=JSON.stringify(arguments)}catch(i){log("Unable to stringify args: ",arguments)}finally{C.reportError(t,n)}}}return t},function(){var e=function(e){var t=window[e];window[e]=function(){var e=Array.prototype.slice.call(arguments),n=e[0];return"function"==typeof n&&(e[0]=C.wrapFn(n)),t.apply?t.apply(this,e):t(e[0],e[1])}};e("setTimeout"),e("setInterval")}();var z=t.mobile?30:50;window.__LOG_BUFFER=C.createRingBuffer(z);var G=window.log;C.isDemoMode()||(window.log=function(){__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," ")),console.log.apply(console,arguments)});for(var Y in G)window.log[Y]=G[Y];C.isFunction=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},C.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},C.isString=function(e){return"string"==typeof e},C.isObject=function(e){return"object"==typeof e&&null!==e},C.enumToString=function(e,t){for(var n in e)if(e[n]==t)return n;return null},C.elementToString=function(e,t){if(e){var n=e.nodeName;return e.id&&(n+="#"+e.id),e.className&&(n+="."+e.className),t&&e.innerText&&(n+=":"+e.innerText.length),"["+n+"]"}return"[UNDEFINED]"},C.getElementPath=function(e,t){var n=!0,i=[];try{for(;e!==document.documentElement&&e!==document.body;)i.push(n?C.elementToString(e,t):C.elementToString(e)),n=!1,e=e.nodeType===Node.TEXT_NODE?e.parentNode:e.parentElement}catch(o){i.push(o.message)}return i},C.highlightElement=function(e,t,n){if(e){var i=t||.5,o=n||1,r=e.getBoundingClientRect(),a=r.top+r.height*o,s=r.left+r.width*i;C.showArrowAt(a,s)}},C.showArrowAt=function(e,n){var i=document.getElementById("iarrow");i.style.display="block";var o=t.mobile?-35:0;i.style.top=e+o+"px",i.style.left=n+"px"},C.hideHighlightElement=function(){var e=document.getElementById("iarrow");e.style.display="none"};var X=500;C.setupClick=function(e,n,i){function o(e){var t=e.eventX-this.lastX,o=e.eventY-this.lastY;if(0!==t||0!==o){var r=!this.moved;if(this.lastX=e.eventX,this.lastY=e.eventY,e.distanceX=this.distanceX=this.distanceX+Math.abs(t),e.distanceY=this.distanceY=this.distanceY+Math.abs(o),(this.moved||e.distanceX>C.ClickThreshold||e.distanceY>C.ClickThreshold)&&(this.moved=!0,e.moved=this.moved),(i.onMove||i.onFirstMove)&&(e.diffX=e.eventX-this.startX,e.diffY=e.eventY-this.startY,e.xThisFrame=t,e.yThisFrame=o,e.startX=this.startX,e.startY=this.startY,e.startClientX=this.startClientX,e.startClientY=this.startClientY,e.startSrc=this.startSrc,r&&i.onFirstMove&&i.onFirstMove.call(n,e),i.onMove)){var a=!1;a=i.onMove.call(n,e),a&&e.stopImmediatePropagation()}}}function r(e){e.srcElement||(e.srcElement=e.target);var t=Date.now(),o=this.lastTouch||t,r=Math.max(0,t-o);this.numClicks?this.numClicks++:this.numClicks=1,e.eventX=this.lastX,e.eventY=this.lastY,e.moved=this.moved,e.timeDelta=r,e.diffX=this.lastX-this.startX,e.diffY=this.lastY-this.startY,e.startX=this.startX,e.startY=this.startY,e.startSrc=this.startSrc,X>r&&r>0&&i.onDblClick&&!this.moved&&i.onDblClick.call(n,e),isNaN(e.button)||0===e.button?(this.lastTouch=t,i.onClick&&!this.moved&&i.onClick.call(n,e)):1==e.button&&i.onMiddleClick&&!this.moved&&i.onMiddleClick.call(n,e),(isNaN(e.button)||0===e.button)&&i.onEnd&&i.onEnd.call(n,e),setTimeout(function(){this.lastTouch=void 0,this.numClicks=void 0}.bind(this),X)}function a(e){i.onCancel&&i.onCancel.call(n,e)}function s(e){e.timeStart=this.timeStart=Date.now(),e.srcElement||(e.srcElement=e.target),this.startSrc=e.srcElement,this.moved=!1,e.startX=this.startX=e.eventX,e.startY=this.startY=e.eventY,e.startClientX=this.startClientX=e.clientX,e.startClientY=this.startClientY=e.clientY,this.lastX=e.eventX,this.lastY=e.eventY,this.distanceX=0,this.distanceY=0,(isNaN(e.button)||0===e.button)&&i.onStart&&i.onStart.call(n,e),isNaN(e.changeLastY)||(this.lastY+=e.changeLastY)}function c(n){var i=t.ie?n:n.touches[0];return n.eventX=i.pageX,n.eventY=i.pageY,n.clientX=i.clientX,n.clientY=i.clientY,o.call(e,n),n.returnFalse?!1:void 0}function l(n){return document.removeEventListener(t.touchMoveEvent,b,v),document.removeEventListener(t.touchEndEvent,S,v),document.removeEventListener(t.touchCancelEvent,T,v),w&&w.stop(),r.call(e,n),n.returnFalse?!1:void 0}function u(n){return document.removeEventListener(t.touchMoveEvent,b,v),document.removeEventListener(t.touchEndEvent,S,v),document.removeEventListener(t.touchCancelEvent,T,v),w&&w.stop(),a.call(e,n),n.returnFalse?!1:void 0}function h(n){if(!n.handled){this.lastInputTouch=!0;var i=t.ie?n:n.touches[0];return n.eventX=i.pageX,n.eventY=i.pageY,n.clientX=i.clientX,n.clientY=i.clientY,s.call(e,n),n.ignore||(document.addEventListener(t.touchMoveEvent,b,v),document.addEventListener(t.touchEndEvent,S,v),document.addEventListener(t.touchCancelEvent,T,v),w&&(log("Add Gesture Pointer: ",n.id,C.elementToString(n.target),C.elementToString(e)),w.addPointer(n.pointerId))),n.returnFalse?!1:void 0
}}function p(t){return this.lastInputTouch?void 0:(t.eventX=t.pageX,t.eventY=t.pageY,o.call(e,t),t.returnFalse?!1:void 0)}function f(n){return n.handled||this.lastInputTouch?void 0:(document.removeEventListener(t.moveEvent,x,v),document.removeEventListener(t.upEvent,E,v),0===n.button&&r.call(e,n),n.returnFalse?!1:void 0)}function m(n){return n.handled||this.lastInputTouch?void 0:(this.lastInputTouch=!1,n.eventX=n.pageX,n.eventY=n.pageY,s.call(e,n),n.ignore||(0===n.button&&document.addEventListener(t.moveEvent,x,v),document.addEventListener(t.upEvent,E,v)),n.returnFalse?!1:void 0)}function g(e){e.handled||this.lastInputTouch||(e.srcElement||(e.srcElement=e.target),i.onRightClick&&i.onRightClick.call(n,e))}if(!e)return void log("Skipping setupClick because no valid DOM object was provided to bind to");n||(n=e);var v=!1;C.isFunction(i)?i={onClick:i}:i&&i.useCapture&&(v=i.useCapture);var y=d(h),b=d(c),S=d(l),T=d(u),w=void 0,M=d(m),x=d(p),E=d(f),k=d(g);return t.isTouchDevice?e.addEventListener(t.touchStartEvent,y,v):e.addEventListener(t.downEvent,M,v),t.usePointerEvents&&t.mobile&&e.addEventListener("mousedown",function(e){return I.isEnabled()&&I.isTargetBox(e)||(e.preventDefault(),e.stopImmediatePropagation()),!1},v),i.onRightClick&&!t.mobile&&e.addEventListener("contextmenu",k,v),this};var J=!1;C.StartSpinner=function(){t.mobile&&!J&&(J=!0,C.removeClass(document.getElementById("loading"),"hidden"))},C.StopSpinner=function(){var e=document.getElementById("loading");J&&e&&C.addClass(document.getElementById("loading"),"hidden")},Array.prototype.pushOnlyUniques=function(e,t){if(!e)return this;for(var n=0,i=e.length;i>n;++n){for(var o=!0,r=0,a=this.length;a>r;++r)if(t&&t(e[n],this[r])||!t&&e[n]==this[r]){o=!1;break}o&&this.push(e[n])}return this},Array.prototype.pushArray=function(e){return this.push.apply(this,e)},Array.prototype.removeAt=function(e){return this.splice(e,1)[0]},Array.prototype.remove=function(e){var t=this.indexOf(e);return t>=0&&this.removeAt.call(this,t),t},Array.prototype.findInsertIndex=function(e,t){for(var n=0,i=this.length-1;i>=n;){var o=n+i>>1,r=t(this[o],e);if(0>r)n=o+1;else{if(!(r>0))return o;i=o-1}}return n},Array.prototype.insertSorted=function(e,t){var n=this.findInsertIndex(e,t);this.splice.apply(this,[n,0,e])},e.observableArray.fn.insertSorted=function(e,t){this.peek().insertSorted(e,t),this.valueHasMutated()},C.clamp=function(e,t,n){return Math.max(t,Math.min(n,e))},C.randParam=function(){return"?t="+Date.now()},C.createPath=function(e){return window.location.protocol+"//"+window.location.host+"/"+e},C.addScript=function(e,t,n){var i=document.createElement("script");i.type="text/javascript",i.src=e,t&&(i.id=t),n&&c(i,n),"undefined"!=typeof i&&document.getElementsByTagName("head")[0].appendChild(i)},C.addStylesheet=function(e,t){var n=document.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,t&&c(n,t),"undefined"!=typeof n&&document.getElementsByTagName("head")[0].appendChild(n)},C.PAssert=function(e,t){if(!t){var n={isAssert:!0,tag:e};try{var i=l(Array.prototype.slice.call(arguments,2));log(arguments.length>2?"Assert Failure "+e+": "+i:"Assert Failure "+e),C.reportError(new Error("Assert Failure: "+i),n)}catch(o){log("Exception in PAssert "+e+": ",o),C.reportError(o,n)}}},C.getSelectionInfo=function(){var e=window.getSelection(),t=e.anchorNode;return t?{node:t.nodeType===Node.TEXT_NODE?t.parentNode:t,selection:e}:void 0},C.getSelectionRange=function(){var e=window.getSelection();return e.rangeCount>0?e.getRangeAt(0):void 0},C.getItemForElement=function(t){if(I.isEnabled()){var n=I.getCurrentVMLI();if(n)return n}if(t&&t!==document.body){t.nodeType===Node.TEXT_NODE&&(t=t.parentNode);var i=e.dataFor(t);return i instanceof E?i:void 0}return void 0},C.getSelectedItem=function(){var e=window.getSelection();return C.getItemForElement(e.anchorNode)},C.clearSelection=function(){window.getSelection().removeAllRanges()},C.selectElement=function(e,t){if(e.textContent.length>0&&e.textContent!==TextSpace){var n=window.getSelection(),i=document.createRange(),o=t?e.textContent.length:0;i.setStart(e.childNodes[0],o),i.setEnd(e.childNodes[0],e.textContent.length),n.removeAllRanges(),n.addRange(i)}else e.focus()},C.selectChildren=function(e,t,n){if(e&&e instanceof E){if(I.isEnabled())return void I.updateInput(e,t);var i=e.getParsedText().length-e.styleLength,t=Math.min(t,i),o=Math.min(t+n,i),r=window.getSelection(),a=document.createRange(),s=void 0,d=-1,c=void 0,l=-1,h=0,p=e.getSpan();if(p){for(var f=u(p),m=0;m<f.length;++m){var g=f[m].length;if(-1===d&&h+g>=t&&(s=f[m],d=t-h),h+g>=o){c=f[m],l=o-h;break}h+=g}d=0>d?0:d,l=0>l?0:l,a.setStart(s,d),a.setEnd(c,l),r.removeAllRanges(),r.addRange(a)}}},C.getOffsetOfSubNode=function(e,t){for(var n=0,i=u(e),o=u(t),r=0;r<i.length&&i[r]!=o[0];++r)n+=i[r].length;return n},C.selectMultiline=function(e,t,n,i){var o=!1,r=window.getSelection(),a=document.createRange(),s=p(e,t),d=p(n,i);return s&&s.element&&d&&d.element&&(a.setStart(s.element,s.offset),a.setEnd(d.element,d.offset),r.removeAllRanges(),r.addRange(a),o=!0),o},C.saveSelectionItem=function(e){if(!e&&(e=C.getSelectionRange(),!e))return void 0;var t=!0;if(e&&e.startContainer&&e.endContainer)try{var n=C.getItemForElement(e.startContainer),i=C.getItemForElement(e.endContainer);if(n&&i&&n!=C.vmMain.root())var o=C.getSelectOffsetsInSpan(n,n.getSpan(),e),r=C.getSelectOffsetsInSpan(i,i.getSpan(),e),a=C.getPaneForElement(n.getSpan());else t=!1}catch(s){C.reportError(s),t=!1}else t=!1;var d=void 0;return t&&(d={start:o,end:r,startItem:n,endItem:i,pane:a}),d};var $={};C.saveSelection=function(e,t){$[e]=C.saveSelectionItem(t,e)},C.clearSavedSelection=function(e){$[e]=void 0},C.restoreSavedSelection=function(e,t){var n=$[e],i=void 0;if(n&&(!t||t===n.pane)){try{i=C.restoreSelectionItem(n),i&&C.scrollIntoView(i.getSpan(),0)}catch(o){C.reportError(o)}C.clearSavedSelection(e)}return!!i},C.restoreSelectionItem=function(e){var t=C.hasClass(e.startItem.getElement(),"hidden"),n=C.hasClass(e.endItem.getElement(),"hidden");if(t&&!n){var i=C.selectMultiline(e.endItem.getSpan(),e.end.end,e.endItem.getSpan(),e.end.end);return i?e.endItem:void 0}if(!t&&n){var i=C.selectMultiline(e.startItem.getSpan(),e.start.start,e.startItem.getSpan(),e.start.start);return i?e.startItem:void 0}var i=C.selectMultiline(e.startItem.getSpan(),e.start.start,e.endItem.getSpan(),e.end.end);return i?e.startItem:void 0},C.getSelectOffsetsInSpan=function(e,t,n,i){var o=e?e.styleLength:0,r={start:0,startText:o,end:0,endText:o,total:0,totalText:o};if(I.isEnabled()&&!i)r.start=I.getSelectionStart(),r.startText=r.start+o,r.end=I.getSelectionEnd(),r.endText=r.end+o,r.total=I.getInputText().length,r.totalText=r.total+o;else if(t&&t.textContent!==TextSpace&&(!I.isEnabled()||""!==t.textContent)){var a=n.startContainer,s=n.startOffset,d=n.endContainer,c=n.endOffset,l=0,h=u(t);"SPAN"===a.tagName&&C.hasClass(a,"text")&&(a=h[0]);for(var p=0;p<h.length;++p)h[p]===a&&(r.start=l+s,r.startText=l+s+o),h[p]===d&&(r.end=l+c,r.endText=l+c+o),l+=h[p].length;r.total=l,r.totalText=l+o}return r},C.getSpanParent=function(e){if(I.isEnabled())return I.getInputBox();if(C.hasClass(e,"noItems"))return void 0;for(;e&&("SPAN"!==e.tagName||!m(e));)e=e.parentNode;return e&&m(e)?e:void 0},C.getLIParent=function(e){for(;e&&"LI"!==e.tagName;)e=e.parentNode;return e&&!C.hasClass(e,"item")?null:e},C.getPreviousItem=function(e,t,n){if(!e)return void 0;var i=void 0,o=(n&&n.isTest,n&&n.ignoreSearch),r=e.parent();if(!r)return void 0;var a=r.getChildIndex(e);if(a>0)for(;!i;){for(var s=!1,d=a-1;d>=0;d--){var c=r.getChild(d);if(c.hasChildren()&&!c.isCollapsed()){if(o||!t||!C.hasClass(c.getElement(t.id),"hidden")){r=c,a=c.numChildren(),s=!0;break}}else if(o||!t||!C.hasClass(c.getElement(t.id),"hidden")){i=c,s=!0;break}}s||(i=r)}else i=e.parent();return i},C.getNextItem=function(e,t,n){if(!e)return void 0;var i=void 0,o=(n&&n.isTest,n&&n.ignoreSearch);if(e.hasChildren()&&!e.isCollapsed())for(var r=e.numChildren(),a=0;r>a;++a){var s=e.getChild(a);if(o||!t||!C.hasClass(s.getElement(t.id),"hidden")){i=s,n&&n.numLevels++;break}}for(var d=e;!i;){var c=d.parent();if(!c)break;var l=c.getChildIndex(d),r=c.numChildren();if(!c.isCollapsed())for(var a=l+1;r>a;++a){var s=c.getChild(a);if(o||!t||!C.hasClass(s.getElement(t.id),"hidden")){i=s;break}}if(d=c,n&&!i&&n.numLevels--,t&&d===t.item())break}return i},C.getFirstPaneItem=function(e){return e?C.getNextItem(e.item()):void 0},C.getLastPaneItem=function(e){for(var t=e.item().getLastChild();t.hasChildren();t=t.getLastChild());return t},C.getItemCounts=function(e,t,n){var i=0,o=0,r=e;do r=C.getNextItem(r,n),r.parent()===n.item()&&r.isHeader()&&o++,i++;while(r!==t);return{fscount:o,icount:i}},C.getItemsBetween=function(e,t,n){for(var i=[e],o=e;o!==t;)o=C.getNextItem(o,n),i.push(o);return i},C.getFirstItem=function(e,t){if(e.id==t.id||t.parent().id==e.id)return e;if(e.parent().id==t.id)return t;var n=e,i=void 0;do{var o=t,r=void 0;do{if(n.id==o.id)return void 0===i?e:void 0===r?t:i.getIndex()<r.getIndex()?e:t;r=o}while(void 0!==(o=o.parent()));i=n}while(void 0!==(n=n.parent()));return void 0},C.animateTransform=function(e,n){function i(){n.clearTransform&&(e.style[t.transform.style]="",e.style[t.transformOrigin.style]=""),n.onComplete&&n.onComplete()}if(e){var o=n.transform;if(!isNaN(n.delay)){var r=n.delay;return n.delay=void 0,void setTimeout(C.animateTransform,r,e,n)}if(n.time){var a=C.getTransitionClass(n.time);C.addClass(e,a),setTimeout(function(){C.removeClass(e,a),i()},n.time)}else i();isNaN(n.opacity)||(e.style.opacity=n.opacity),o||isNaN(n.left)||isNaN(n.top)||(o="translate3d("+left+"px,"+top+"px,0)"),n.origin&&(e.style[t.transformOrigin.style]=n.origin),e.style[t.transform.style]=o}},C.easeOut=function(e,t,n){return-n*e*(e-2)+t},C.scrollTo=function(e,n,i,o,r){function a(e){d||(d=e-20);var o=Math.min((e-d)/n,1),u=C.easeOut(o,c,l);return i[s]=u,1==o?(C.isScrollingIntoView=!1,t.ios&&C.setSelectionToWhatItAlreadyIs(),void(r&&r())):void requestAnimationFrame(a)}i=i||C.focusedPane.rootElement;var s=o?"scrollLeft":"scrollTop";if(n>0){C.isScrollingIntoView=!0;var d,c=i[s],l=e-c;requestAnimationFrame(a)}else i&&(i[s]=e),r&&r()},C.computeScrollSpeed=function(e,t,n){return(t-e-(t-n))/(t-e)};var Q={speed:0,pane:void 0},Z=!1;C.repeatScroll=function(e,t){Q.speed=e,Q.pane=t,Z||(Z=!0,requestAnimationFrame(g))},C.cancelRepeatScroll=function(){Z=!1},C.getPaneForElement=function(t){if(t){var n;n=e.contextFor(I&&I.isEnabled()&&"androidInput"==t.id?I.getCurrentVMLI().getSpan():t);var i=n?n.$parents[n.$parents.length-2]:void 0;if(!i&&n&&1===n.$parents.length&&(i=n.$data),i instanceof k)return i}return void 0},C.elementInPane=function(t){if(t){var n=e.contextFor(t);if(n){var i=n.$parents[n.$parents.length-2];if(i)return C.hasClass(i.element,"pane")}}return!1},C.scrollToTop=function(e,n,i){if(e){var o=(i&&i.callback,C.findParent(e,"scroller"));if(o){var r=e.getBoundingClientRect().top,a=o.scrollTop,s=r-C.topBoxHeight+(t.orientation==Orientation.Landscape?C.topBarHeight:0),d=a+s;return C.scrollTo(d,n,o),s||!0}}return!1},C.scrollIntoView=function(n,i,o){var r=o&&o.callback,a=o&&o.noToolbar,s=o&&o.extraAmt;isNaN(i)&&(i=200);var d=!1;if(n){var c=C.findParent(n,"scroller");if(c){var l,u=c.getBoundingClientRect(),h=u.bottom,p=n.getBoundingClientRect(),f=s||10,m=c.scrollTop;if(t.mobile&&(a||(h-=C.keyboardToolbarHeight),t.ios&&!t.ios71&&C.isKeyboardOpen||(t.kbsize?(!t.android||t.app)&&(h-=t.kbsize):h-=t.android?Math.ceil(window.innerHeight/2.5):248)),p.top<u.top){var g=e.dataFor(n);l=t.mobile||g!==C.getFirstPaneItem(C.focusedPane)?m+p.top-u.top-f:0}else p.bottom>h&&(l=m+p.bottom-h+f);void 0!==l&&(C.scrollTo(l,i,c),r&&(i>0?setTimeout(r,i):r()),d=!0)}}return d},C.isKeyboardInputElement=function(e){return"checkbox"===e.type?!1:"INPUT"==e.nodeName||"textarea"==e.type?!0:!1},C.openKeyboardOn=function(n,i,o,r,a,s){var d=C.findParent(i,"scroller"),c=d?d.scrollTop:0,l=!1;if(o&&C.keyboardToolbar.preShow(),C.isKeyboardOpen)log("keyboard open");else if(t.app||t.android||t.mobileie){var u=function(){o?C.keyboardToolbar.show(r):C.isKeyboardOpen=!0,a&&a(),C.enforceScroll()},h=e.dataFor(d);h&&h.addPadding&&h.addPadding(),l=C.scrollIntoView(i,t.keyboardOpenTime,{callback:u,noToolbar:!o})}else l=C.scrollIntoView(i,t.keyboardOpenTime);l&&t.app&&!t.android||(a&&a(),o&&C.keyboardToolbar.show(r)),C.onCloseKeyboard=function(){if(C.isKeyboardOpen){var n=e.dataFor(d);n&&n.addPadding&&n.addPadding(),C.scrollTo(c,t.keyboardOpenTime,d,!1,function(){n&&n.removePadding&&n.removePadding()}),C.isKeyboardOpen=!1,s&&s()}C.onCloseKeyboard=void 0},t.ios&&C.preventClick(),n.preventDefault(),n.stopImmediatePropagation(),n.returnFalse=!0,C.enforceScroll()},C.blurActiveElement=function(e){C.ignoreSelectionChange=!!e,C.fireCustomEvent("closeKeyboard"),document.activeElement.blur(),setTimeout(function(){C.ignoreSelectionChange=!1},100)},C.preventScrollPropagation=function(e){return e.scrollHeight===e.clientHeight?!1:(0===e.scrollTop?e.scrollTop=1:e.scrollTop+e.offsetHeight>=e.scrollHeight&&(e.scrollTop=e.scrollHeight-e.offsetHeight-1),!0)},C.setSelectionToWhatItAlreadyIs=function(){var e=window.getSelection();if(e.rangeCount>0){var t=C.getSelectionRange();e.removeAllRanges(),e.addRange(t)}},C.setSelection=function(e,t,n){if(0>t||0>n)return!1;if(!e)return!1;var i,o=!0;try{var r=u(e),a=document.createRange();i=r.length>0?r[0]:e,a.setStart(i,t),a.setEnd(i,n);var s=window.getSelection();s.removeAllRanges(),s.addRange(a)}catch(d){C.reportError(d,{element:C.elementToString(e,!0),select:C.elementToString(i,!0),start:t,end:n,children:r.length>0?C.elementToString(e,!0):void 0}),o=!1}return o},C.restrictSelectionToText=function(){if(!I||!I.isEnabled()){var t,n,i,o,r,a,s=function(){return t=C.getSelectionInfo(),t&&0!==t.rangeCount?(n=C.getSelectionRange(),i=n.startContainer,o=n.endContainer,r=n.startOffset,void(a=n.endOffset)):!0};if(s(),t){if("SPAN"===i.nodeName)v(i,r,o,a),s();else if("LI"===i.tagName){var d=i.firstElementChild;C.selectMultiline(d,d.textContent.length,d,d.textContent.length),s()}else if("UL"===i.tagName){var d=i.previousElementSibling;C.selectMultiline(d,d.textContent.length,d,d.textContent.length),s()}if("#text"===i.nodeName&&i.previousSibling&&"#comment"===i.previousSibling.nodeName&&(C.selectChildren(C.getSpanParent(i),0,a),s()),i!==o&&0===a&&"P"===o.nodeName){o=o.parentNode.parentNode;var c=o.previousElementSibling;if(c){if(c.children.length>1){var l=c.children[1].children;c=l[l.length-1]}}else c=o.parentNode.parentNode;var u=e.dataFor(c).getParsedText().length;C.selectMultiline(i,r,c,u)}else if("LI"===o.tagName){var c=o.previousElementSibling;if(c){if(c.children.length>1){var l=c.children[1].children;c=l[l.length-1]}}else c=o.parentNode.parentNode,console.log(c);var h=c.firstChild;C.selectChildren(e.dataFor(h),0,h.textContent.length)}else"UL"===o.nodeName&&v(i,r,o,a)}}},C.trimString=function(e){for(var e=e.replace(/^\s\s*/,""),t=/\s/,n=e.length;t.test(e.charAt(--n)););return e.slice(0,n+1)},C.enforceScroll=function(e,n){(e||(t.ios||t.android)&&(!t.app||t.ios71))&&(setTimeout(function(){window.scrollTo(0,n||0)},0),requestAnimationFrame(function(){window.scrollTo(0,n||0)}),window.scrollTo(0,n||0),document.body.scrollTop=0)},C.preventDefault=function(e){e&&e.preventDefault&&e.preventDefault()},C.preventClick=function(){C.addClass(C.element("outerWrapper"),"noClick"),window.ontouchstart=C.preventDefault,requestAnimationFrame(function(){window.ontouchstart=void 0,C.removeClass(C.element("outerWrapper"),"noClick")})},C.searchVMLIs=function(e){var t=e.item;t||(t=C.vmMain.root()),e.headers?y(e,t.headers()):y(e,t.items()),e.includeArchived&&t.hasArchivedChildren()&&y(e,t.archivedItems(!0))},C.getLastVisibleItem=function(e){for(var t=e.items(),n=t.length-1;n>=0;n--)if(!C.vmSearchPhone.hiddenItems[t[n].id]){var i=C.getLastVisibleItem(t[n]);return i?i:t[n]}return void 0},C.invertObject=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t},C.fieldMapOut=C.invertObject(C.fieldMapIn),C.translateFieldIn=function(e){return C.fieldMapIn[e]||e},C.translateFieldOut=function(e){return C.fieldMapOut[e]||e},C.translateObjIn=function(e){return b(e,C.fieldMapIn)},C.translateObjOut=function(e){return b(e,C.fieldMapOut)};var et={};C.addCustomEventListener=function(e,t,n){if(void 0!==n){var i=et[e],o={fn:t,pri:n};i?et[e].insertSorted(o,function(e,t){return t>e?1:-1}):(et[e]=[o],window.addEventListener(e,function(t){for(var n=0;n<et[e].length;++n){var i=et[e][n],o=i.fn(t);if(o===!1)break}}))}else window.addEventListener(e,t)},C.removeCustomEventListener=function(e,t,n){if(n){for(var i=et[e],o=!1,r=0;r<i.length;++r)if(i[r].fn===t){o=!0,i.removeAt(r);break}}else window.removeEventListener(e,t)},C.fireCustomEvent=function(e,t,n){if(document.createEvent){var i=document.createEvent("Event");return t&&(i.data=t),i.initEvent(e,!0,!0),(n||window).dispatchEvent(i)}},C.fireKeyEvent=function(e,t){S(e,"keydown",t),S(e,"keypress",t),S(e,"keyup",t)},C.fireClickEvent=function(e,t){T(e,"mousedown",t),T(e,"mouseup",t),T(e,"mouseclick",t)},C.fireDragStart=function(e){T(e,"mousedown",ButtonCode.Left,{offsetX:10,offsetY:10})},C.fireDragMove=function(e,t,n){if(!e){var i=C.getSelectionInfo();i&&(e=i.node)}if(document.createEvent){var o=document.createEvent("Event");o.pageX=t,o.pageY=n,o.synthetic=!0,o.initEvent("mousemove",!0,!0),e.dispatchEvent(o)}},C.fireDragEnd=function(e){T(e,"mouseup",ButtonCode.Left)},C.clone=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},C.alias=function(){for(var e=Array.prototype.slice.call(arguments),t=e[0],n=1;n<e.length;n++){var i=e[n];t[i]=t["_"+i]}},C.extend=function(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},C.loadXML=function(e){try{if("undefined"!=typeof window.DOMParser)return(new window.DOMParser).parseFromString(e,"text/xml");if("undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")){var t=new window.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}return void 0}catch(n){return void C.reportError(n)}},C.adjustOriginToBeInsideBounds=function(e,t,n,i,o,r){var a={x:t.left,y:t.top};return n=n||0,i=i||0,o=o||0,r=r||0,t.bottom+r>e.bottom&&(a.y=Math.max(i,t.top-(t.bottom+r-e.bottom))),t.top-r<e.top&&(a.y=Math.max(i,t.top)),t.right+o>e.right&&(a.x=Math.max(n,t.left-(t.right+o-e.right))),a},C.adjustHeightToBeInsideBounds=function(e,t,n,i,o){if(t.bottom+o>e.bottom&&(t.bottom=e.bottom-o,t.bottom-t.top<n)){var r=25,a=Math.max(0,t.top-r),s=Math.max(0,a-n);t.bottom=a,t.top=s}return Math.min(i,t.bottom-t.top)},C.setOrigin=function(e,t,n){var i=e.left-t,o=e.top-n;e.left-=i,e.right-=i,e.top-=o,e.bottom-=o},C.copyStyles=function(e,t,n){var i=window.getComputedStyle(e);if(i){for(var o=[],r=0;r<n.length;++r)o[r]=i[n[r]];for(var r=0;r<o.length;++r)t.style[n[r]]=o[r]}},C.hasClass=function(e,t){return e&&e.classList?e.classList.contains(t):void 0},C.removeClass=function(e,t){e&&e.classList&&e.classList.remove(t)},C.addClass=function(e,t){e&&e.classList&&e.classList.add(t)},C.toggleClass=function(e,t){e&&e.classList&&e.classList.toggle(t)},C.css=function(e,t){if(e)for(var n in t)if(t.hasOwnProperty(n)){var i=t[n];"number"==typeof i&&(i+="px"),e.style[n]=i}},C.findChild=function(e,t){if(e)for(var n=0;n<e.childElementCount;++n)if(C.hasClass(e.children[n],t))return e.children[n];return void 0},C.findParent=function(e,t,n){if(n||(n=1e4),e)for(var i=e,o=0;n>o&&i;++o,i=i.parentNode)if(C.hasClass(i,t))return i;return void 0},C.findParentID=function(e,t,n){if(n||(n=1e4),e)for(var i=e,o=0;n>o&&i;++o,i=i.parentNode)if(i.id==t)return i;return void 0},C.isAncestor=function(e,t){for(;e&&e!==t;)e=e.parentNode;return!!e},C.firstChildTag=function(e,t){if(e)for(var n=t.toUpperCase(),i=0;i<e.childElementCount;++i)if(e.children[i].tagName===n)return e.children[i];return void 0},C.insertAfter=function(e,t){e.parentNode.insertBefore(t,e.nextSibling)},C.prependChild=function(e,t){e.insertBefore(t,e.firstChild)},C.offset=function(e){var t=e.getBoundingClientRect(),n=e.ownerDocument,i=e.ownerDocument.documentElement,o=n.defaultView,r={top:t.top+o.pageYOffset-i.clientTop,left:t.left+o.pageXOffset-i.clientLeft};return r},C.height=function(e){var t=e.offsetHeight,n=window.getComputedStyle(e);return n?("border-box"!==n.boxSizing&&(t-=parseFloat(n.paddingTop)+parseFloat(n.paddingBottom)),t-=parseFloat(n.borderTopWidth)+parseFloat(n.borderBottomWidth)):ShouldLog(LogLevels.Error)&&log("GetComputedStyle failed in globals::height"),t},C.width=function(e){var t=e.offsetWidth,n=window.getComputedStyle(e);return n?("border-box"!==n.boxSizing&&(t-=parseFloat(n.paddingLeft)+parseFloat(n.paddingRight)),t-=parseFloat(n.borderLeftWidth)+parseFloat(n.borderRightWidth)):ShouldLog(LogLevels.Error)&&log("GetComputedStyle failed in globals::width"),t};var tt=void 0;return C.runOnLoad=function(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e):(tt||(tt=[],document.addEventListener("DOMContentLoaded",w,!1),window.addEventListener("load",w,!1)),tt[tt.length]=e)},C.XHR=function(e){var t=e.url,n=e.type,i=e.cb,o=e.data,r=e.headers,a=e.username,s=e.password,d=new XMLHttpRequest;if(d.onreadystatechange=function(){4===d.readyState&&i(d)},a&&s?d.open(n.toUpperCase(),t,!0,a,s):d.open(n.toUpperCase(),t,!0),r)for(var c in r)d.setRequestHeader(c,r[c]);if(o){d.setRequestHeader("Accept","*/*"),d.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");var l=M(o);d.send(l)}else d.send()},C.element=function(e,t){return(!C.elements[e]||t)&&(C.elements[e]=document.getElementById(e)),C.elements[e]},C.waitingList={},C._waitForElement=function(e,t){var n=document.getElementById(e);return n?(t(n),delete C.waitingList[e],n):void setTimeout(C._waitForElement,100,e,t)},C.waitForElement=function(e,t){var n=C._waitForElement(e,t);n||(C.waitingList[e]=t)},C.getElementByClassName=function(e,t){if(!t)return document.getElementsByClassName(e)[0];for(var n=t.children.length,i=0;n>i;i++)if(t.children[i].className.indexOf(e)>=0)return t.children[i]},C.getElementsByClassName=function(e,t){if(t){for(var n=[],i=t.children.length,o=0;i>o;o++)t.children[o].className.indexOf(e)>=0&&n.push(t.children[o]);return n}return document.getElementsByClassName(e)},C.openUrl=function(e,n){if(!e)return!1;if(t.standalone){var i=document.createElement("a");i.setAttribute("href",e),i.setAttribute("target","_blank");var o=document.createEvent("HTMLEvents");o.initEvent("click",!0,!0),i.dispatchEvent(o)}else if(t.app){e.startsWith("http://")||e.startsWith("https://")?e=e.replace("http://","").replace("https://",""):e.startsWith("/")&&(e=window.location.host+e),t.sendToApp("openURL",e),n&&C.handlerPreventStop(n)}else open(e,"_blank");return!0},C.isDateSoft=function(e){if(e)switch(e.toUpperCase()){case"NEXT":case"SOON":case"LATER":case"NOW":return!0}return!1},C.sendJSMessage=function(e,t){try{appEvents[e]?appEvents[e](t):C.reportError(new Error("Calling invalid JS method from native: "+e))}catch(n){C.reportError(n)}},window._SENDJSMESSAGE_=C.sendJSMessage,C.handlerPreventStop=function(e){e.preventDefault(),e.stopImmediatePropagation()},C.fFalse=function(){return!1},C.fTrue=function(){return!0},C.emptyFn=function(){},n.hasURLParam("nolocal","true")&&(C.noLocalWrites=!0),C.settings.init(),C.eventStream=C.createRingBuffer(100),C}),define("gdata",["ko","globals","data","platform"],function(e,t,n,i){function o(e){function t(e){if(e)for(var t=0;t<e.length;++t){var o=e.get(t),r=v.get(o,"text");if(r.indexOf("@")>=0)for(var a=r.split(" "),s=0,t=0;t<a.length;++t){if(0===a[t].indexOf("@")){for(var d=void 0,c=a[t].substring(1),l=1;4>l;l++){var u=-1!==c.indexOf(":",c.length-1)?c.substr(0,c.length-1):c;if(n.contactsByName[u]&&(d=u),!(t+l<a.length))break;c+=" "+a[t+l]}if(d){var h=r.substr(0,s)+"+"+r.substr(s+1);v.set(o,"text",h),p(o)}}s+=a[t].length+1}i(o)}}function i(e){var n=v.get(e,"items");n&&t(n);var i=v.get(e,"archivedItems");i&&t(i)}if(v.beginWriteAction(),0===n.contacts.length)return void log("Skipping remote data migration four");var o=e.get("root");return o?(i(o),!0):!1}function r(e){function t(e){if(e)for(var t=0;t<e.length;++t){var i=e.get(t),o=v.get(i,"text");o.startsWith("!")?(v.set(i,"priority",VMLIFlag.P0),v.set(i,"text",o.substr(1)),p(i)):o.startsWith("*")?(v.set(i,"isStarred",!0),v.set(i,"text",o.substr(1)),p(i)):o.startsWith("^")&&(v.set(i,"isComplete",!0),v.set(i,"text",o.substr(1)),p(i)),n(i)}}function n(e){var n=v.get(e,"items");n&&t(n);var i=v.get(e,"archivedItems");i&&t(i)}v.beginWriteAction();var i=e.get("root");return i?(n(i),!0):!1}function a(e){function n(e){if(e)for(var t=0;t<e.length;++t){var n=e.get(t);i(n)}}function i(e){var i=v.get(e,"text");t.isString(i)||(v.set(e,"text",i.getText()),log("Updated Text: ",v.get(e,"text")));var o=v.get(e,"items");o&&n(o);var r=v.get(e,"archivedItems");r&&n(r)}v.beginWriteAction();var o=e.get("root");return o?(i(o),!0):!1}function s(e){function t(e){var t=[];if(e)for(var i=0;i<e.length;++i){var r=e.get(i),a=o.get(r);t.push(a),n(a)}return t}function n(e){var n=v.get(e,"items");if(n){var i=t(n);i.length>0&&n.replaceRange(0,i)}var o=v.get(e,"archivedItems");if(o){var r=t(o);r.length>0&&o.replaceRange(0,r)}}v.beginWriteAction();var i=e.get("root").id,o=e.get("items");if(i&&o){var r=o.get(i);if(r)return n(r),e.set("root",r),!0}return!1}function d(){if(v.inCompoundOperation){try{v.inCompoundOperation=!1,v.wantCompoundOperation=!1,t.vmMain.notifyDriveOperationError(),v.model.endCompoundOperation()}catch(e){t.reportError(e)}t.reportError(new Error("Compound operation open after sync block finished"))}T=void 0}function c(e){e.data.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,e.onObjectChanged.bind(e))}function l(e){v.beginWriteAction();var t=v.get(e.data,"items");return t||(t=v.model.createList(),v.set(e.data,"items",t)),t}function u(e){v.beginWriteAction();var t=v.get(e.data,"archivedItems");return t||(t=v.model.createList(),v.set(e.data,"archivedItems",t)),t}function h(e){v.beginWriteAction();var t=v.getVersion(e,VersionType.Structure);t=t?t+1:1;v.set(e,"version",t)}function p(e){v.beginWriteAction();var t=v.getVersion(e,VersionType.Text);t=t?t+1:1;v.set(e,"versionText",t)}function f(e,i){var o=v.canSave(e);if(o){if(t.isEmpty(i))return void(ShouldLog(LogLevels.Warning)&&log("Skipped remote saving an empty object"));v.beginWriteAction(),n.addPendingUpdate(e.id);for(var r in i)if(i.hasOwnProperty(r))switch(r){case"text":v.set(o,"text",i.text);break;case"date":v.set(o,"date",i.date);break;case"dateCreated":v.set(o,"dateCreated",i.dateCreated);break;case"dateCompleted":v.set(o,"dateCompleted",i.dateCompleted);break;case"allDayDate":case"priority":case"isComplete":case"isStarred":v.set(o,r,i[r]);break;case"isCollapsed":case"isArchived":v.set(o,r,i[r]);break;case"modifiedOfflineText":case"dateText":}p(o)}}function m(){log("Try Reconnect: ",E,k),k=void 0,t.goog.reconnectToActiveDocument()}function g(e){for(var n=!1,i=0;i<e.events.length;++i){var o=e.events[i];o.isLocal||(o.property.startsWith(t.settings.prefix)||(n=!0),v.settingsLocal[o.property]=o.newValue,t.fireCustomEvent("settingsChange_"+o.property,o.newValue))}n&&v.onRemoteSettingsLoad()}var v={isClosed:!0,isInitialized:!0,wantCompoundOperation:!1,inCompoundOperation:!1,flushingDeferredActions:!1,deferredActionsCommitted:!1,hasPendingDeferredActions:!1,authenticatedUser:e.observable()};v.offlineTimeoutMS=i.mobile?12e3:8e3;var y=5;v.currentVersion=function(){return y};var b={};v.cacheItem=function(e){b[e.id]=e},v.getState=function(e){try{var t={};if(v.doc)try{var n=v.doc.getModel();t.isReadOnly=n.isReadOnly,t.serverVersion=n.serverVersion,t.size=n.bytesUsed}catch(i){e.docAccessError=!0}t.lastPending=L,t.lastSaving=O,t.isClosed=v.isClosed,t.initialized=v.initialized,e.gState=t}catch(o){log("Error getting information in gdata::getState()"+o.message)}};var n,S;v.checkRemoteIntegrity=function(){function e(e,n){if(e)for(var o=0;o<e.length;++o){var r=e.get(o).id;r||(log(r,": Child does not have a valid reference in our remote database"),t=!0),i[r]?i[r].ref?(log(r,": Item is referenced remotely multiple times"),log("   ",i[r].ref),log("   ",a.id),t=!0,v.beginWriteAction(),e.remove(o)):i[r].ref=a.id:i[r]={exist:!1,arch:n,ref:a.id}}}v.beginAction();var t=!1,i={},o=!1;for(var r in b){var a=b[r];i[a.id]?i[a.id].exist?(log(a.id,": Duplicated IDs in the remote database",a),t=!0):i[a.id].exist=!0:i[a.id]={exist:!0,ref:!1},a.id==v.rootID&&(o&&(log(a.id,": Multiple roots present remotely",a),t=!0),o=!0,i[a.id].isRoot=!0);var s=v.get(a,"items");e(s,!1);var d=v.get(a,"archivedItems");e(d,!0)}o||(log("No root present"),localDataError=!0);for(var c in i){var l=i[c];if(!l.exist){log(c,": Item is referenced remotely as a child but does not exist in the database");var u=b[l.ref],h=v.getItemList(u,l.arch);if(h){var p=h.indexOf(c);p>=0&&(v.beginWriteAction(),h.remove(p))}}l.ref||l.isRoot||(log(c,": Item exists remotely but is not referenced by a parent"),log("   : ",v.get(b[c],"text")),delete b[c]),l.isRoot&&l.ref&&(log(c,": Remote root has a parent"),localDataError=!0)}n.removeDeletedItems(i),v.endAction()},v.migrateData=function(){function e(){p++,2===p&&t.reload()}var i=!1,d=!1,c=!1,l=v.root.get("dataVersion");if(y>l){v.beginAction(),log("Migrating to latest version: ",l);try{switch(l){case 1:s(v.root);case 2:a(v.root);case 3:r(v.root),c=!0;case 4:o(v.root);default:log("Remote Migration Completed")}}catch(u){c=!0,t.reportError(u)}v.endAction(),v.model.getRoot().set("dataVersion",y),log("Done Migrating Remote Data!",y)}else l>y&&(d=!0,i=!0);if(n.hasLocalData){var h=t.settings.get(Settings.localDataVersion)||0;if(y>h){try{switch(h){case 0:n.migrateLocalData_One(),d=!0,i=!0;case 4:n.migrateLocalData_Two();default:log("Local Migration Completed")}}catch(u){d=!0,t.reportError(u)}t.settings.set(Settings.localDataVersion,y),log("Done Migrating Local Data!",y)}}else t.settings.set(Settings.localDataVersion,l);if(d||c)if(d&&!c)t.AppCache.runOnFinish(function(){t.reload()},!0);else if(c&&!d)v.registerSaveNotify(function(){t.reload()});else{var p=0;t.AppCache.runOnFinish(e,!0),v.registerSaveNotify(e)}return i},v.beginAction=function(){v.model&&(v.wantCompoundOperation=!0)};var T=void 0;v.beginWriteAction=function(){if(v.model&&!v.flushingDeferredActions&&!v.inCompoundOperation&&v.wantCompoundOperation)try{v.deferredActionsCommitted&&v.flushDeferredActions(),T=setTimeout(d,0),v.model.beginCompoundOperation(),v.inCompoundOperation=!0,v.wantCompoundOperation=!1,v.deferredActionsCommitted||v.executeDeferredActions()}catch(e){t.reportError(e)}},v.endAction=function(){if(v.model)try{v.hasPendingDeferredActions&&(v.deferredActionsCommitted=!0),v.inCompoundOperation&&v.model.endCompoundOperation()}catch(e){t.goog.recoverFromError(e)}finally{v.inCompoundOperation=!1,v.wantCompoundOperation=!1,clearTimeout(T),T=void 0}};var w=800,M={},C=void 0;v.performDeferredAction=function(e,t){if(v.model){if(M[e.id])for(var n in t)M[e.id].changes[n]=t[n];else M[e.id]={item:e,changes:t};v.hasPendingDeferredActions=!0,clearTimeout(C),C=setTimeout(v.flushDeferredActions,w)}},v.executeDeferredActions=function(){v.flushingDeferredActions=!0;try{for(var e in M)f(M[e].item,M[e].changes)}catch(n){t.reportError(err)}finally{v.flushingDeferredActions=!1,v.hasPendingDeferredActions=!1,M={},v.deferredActionsCommitted=!1}},v.flushDeferredActions=function(){if(v.model&&!v.isClosed&&v.hasPendingDeferredActions){clearTimeout(C),C=void 0;try{v.model.beginCompoundOperation(),v.executeDeferredActions(),v.model.endCompoundOperation()}catch(e){t.reportError(e)}}},v.createNewItem=function(e,t,n){v.beginWriteAction();var i=v.model.createMap();if(e.data=i,v.set(i,"text",e.getRawText()),t){var o=v.model.createList();v.set(i,"items",o)}if(n){var r=v.model.createList();v.set(i,"archivedItems",r)}return v.set(i,"dateCreated",e.dateCreated.getTime()),e.id=i.id,b[i.id]||(b[i.id]=i),i.id},v.initializeNewItem=function(e){if(v.beginWriteAction(),e.hasChildren())for(var t=e.items(),n=l(e),i=0;i<t.length;++i)n.push(t[i].data);
if(e.hasArchivedChildren())for(var o=e.archivedItems(!0),r=u(e),i=0;i<o.length;++i)r.push(o[i].data);c(e)},v.attachEventsToItem=function(e){c(e)};var x;v.registerForUndoRedoStateChange=function(e){v.model?(v.model.addEventListener(gapi.drive.realtime.EventType.UNDO_REDO_STATE_CHANGED,e.stateChangeForUndoRedo),e.stateChangeForUndoRedo({canUndo:v.model.canUndo,canRedo:v.model.canRedo})):x=e},v.registerForSaveStateChange=function(e){v.doc.addEventListener(gapi.drive.realtime.EventType.DOCUMENT_SAVE_STATE_CHANGED,e)},v.loadCollaborators=function(){for(var e=v.doc.getCollaborators(),t=void 0,n=0;n<e.length;++n){var i=e[n];i.isMe&&(t=i)}v.authenticatedUser(t)},v.undoAction=function(){v.flushDeferredActions(),v.model.undo()},v.redoAction=function(){v.flushDeferredActions(),v.model.redo()},v.getItemList=function(e,t){return v.beginWriteAction(),t?v.get(e,"archivedItems"):v.get(e,"items")},v.ensureItemList=function(e,t){return v.beginWriteAction(),t?u(e):l(e)},v.canSave=function(e){if(v.initialized){var t=e instanceof S?e.data:e;return t&&!v.isClosed?t:!1}},v.deleteTree=function(e){v.beginWriteAction();var t=v.get(e,"items");if(t)for(var n=0;n<t.length;n++){var i=t.get(n);v.deleteTree(i)}delete b[e.id]},v.itemAdded=function(e){v.beginWriteAction();var i=e.item,o=e.addedItem,r=e.index,a=e.isArchived,s=e.noVersion;try{var d=v.canSave(i);if(!d)return ReturnValue.Error;var c=o.data;n.addPendingUpdate(i.id),n.addPendingUpdate(o.id);var l=v.ensureItemList(i,a);0>r||isNaN(r)||r>l.length?l.push(c):l.insert(r,c),s||h(o.data)}catch(u){throw t.reportError(u),u}return ReturnValue.Success},v.itemsAdded=function(e){v.beginWriteAction();var i=e.item,o=e.addedItems,r=e.index,a=e.isArchived,s=e.noVersion;try{var d=v.canSave(i);if(!d)return ReturnValue.Error;for(var c=v.ensureItemList(i,a),l=new Array(o.length),u=0;u<o.length;++u)l[u]=o[u].data,n.addPendingUpdate(o[u].id),!s&&l[u]&&h(l[u]);n.addPendingUpdate(i.id),0>r||isNaN(r)?c.pushAll(l):c.insertAll(r,l)}catch(p){throw t.reportError(p),p}return ReturnValue.Success},v.itemRemoved=function(e){v.beginWriteAction();var i=e.item,o=e.index,r=e.numToRemove,a=e.isArchived,s=e.noDelete,d=e.noVersion;try{var c=v.canSave(i);if(!c)return ReturnValue.Error;isNaN(r)&&(r=1);for(var l=v.getItemList(c,a),u=o;o+r>u;u++){var p=l.get(u);n.addPendingUpdate(p.id),d||h(p),s||v.deleteTree(p)}n.addPendingUpdate(i.id),1===r?l.remove(o):l.removeRange(o,o+r)}catch(f){throw t.reportError(f),f}return ReturnValue.Success},v.itemMoved=function(e){v.beginWriteAction();var i=e.item,o=e.newInfo,r=e.oldParent,a=e.oldInfo,s=e.noVersion;try{var d=v.canSave(i);if(!d)return ReturnValue.Error;var c=v.canSave(r);if(!c)return ReturnValue.Error;var l=v.canSave(i.parent());if(!l)return ReturnValue.Error;var u=v.getItemList(c,a.isArchived),p=v.ensureItemList(i.parent(),o.isArchived),f=o.index;(o.index<0||isNaN(o.index)||o.index>p.length)&&(f=p.length),u.moveToList(a.index,p,f),n.addPendingUpdate(i.id),n.addPendingUpdate(r.id),n.addPendingUpdate(i.parent().id),s||h(d)}catch(m){throw t.reportError(m),m}return ReturnValue.Success},v.itemArchived=function(e,i,o){v.beginWriteAction();try{var r=v.canSave(e);if(!r)return ReturnValue.Error;n.addPendingUpdate(e.id),n.addPendingUpdate(i.id);var a=v.get(r,"items"),s=u(e);a.remove(o),s.push(i.data),h(i.data)}catch(d){throw t.reportError(d),d}return ReturnValue.Success},v.itemUnarchived=function(e,i,o,r){v.beginWriteAction();try{var a=v.canSave(e);if(!a)return ReturnValue.Error;n.addPendingUpdate(e.id),n.addPendingUpdate(i.id);var s=v.get(a,"items"),d=v.get(a,"archivedItems");d.remove(o),s.insert(r,i.data),h(i.data)}catch(c){throw t.reportError(c),c}return ReturnValue.Success},v.saveChanges=function(e,t){v.inCompoundOperation?f(e,t):v.performDeferredAction(e,t)};var I=3e4,E=0,k=void 0;v.setupReconnect=function(){if(log("Setup Reconnect: ",E,k),!k){var e=0===E?500:I;E++,k=setTimeout(m,e)}},v.resetDriveData=function(){b={},v.initialized=!1,v.doc=void 0,v.model=void 0,v.root=void 0,v.rootItem=void 0,v.rootID=void 0,window.__remoteDoc=void 0,n.forEachModel(function(e){e&&e.resetDriveData()}),t.vmMain.notifyDriveDisconnect(),v.inCompoundOperation=!1,v.wantCompoundOperation=!1,v.flushingDeferredActions=!1,v.deferredActionsCommitted=!1,clearTimeout(T),T=void 0,clearTimeout(C),C=void 0,v.hasPendingDeferredActions=!1,M={}},v.close=function(e){if(v.doc&&!v.isClosed){log("---- Closing Remote Document! ----",e),v.isClosed=!0,t.vmMain.setGDriveStatus(DriveStatus.Offline);try{v.doc.close()}catch(n){log("Error Closing Doc: ",n)}v.resetDriveData()}else t.vmMain.isReconnecting()&&t.vmMain.setGDriveStatus(DriveStatus.Offline);v.setupReconnect()},v.onInitialized=function(e){log("Initializing",e),n||(n=require("data")),S||(S=require("VMLI"));var t=e.createMap(),i=e.createList();v.set(t,"text","Home"),v.set(t,"items",i),v.set(t,"archivedItems",e.createList()),v.set(t,"dateCreated",Date.now());var o=e.getRoot();o.set("dataVersion",y),o.set("root",t)},v.saveSetting=function(e){if(v.flushDeferredActions(),!e.data.isRemote){var n=e.data.value,i=e.data.property;i.startsWith(t.settings.prefix)&&(n=Math.abs(n),t.settings.setVersion(i,n)),v.settingsLocal[i]!==n&&(v.settingsLocal[i]=n,v.isConnected()&&v.settingsRemote.set(i,n))}},v.onRemoteSettingsLoad=function(){t.settings.set(Settings.syncContacts,v.settingsLocal[Settings.syncContacts],v.settingsLocal[t.settings.prefix+Settings.syncContacts])&&t.goog.authAndLoadContacts(),t.settings.set(Settings.docSharing,v.settingsLocal[Settings.docSharing],v.settingsLocal[t.settings.prefix+Settings.docSharing])&&t.goog.authDocSharing(),window.addEventListener("settingsChange",v.saveSetting)},v.loadSettings=function(){v.settingsLocal={},v.settingsRemote=v.root.get("settings"),v.settingsRemote||(v.settingsRemote=v.model.createMap(),v.root.set("settings",v.settingsRemote));try{v.settingsLocal[Settings.syncContacts]=v.settingsRemote.get(Settings.syncContacts);var e=t.settings.prefix+Settings.syncContacts;v.settingsLocal[e]=v.settingsRemote.get(e),v.settingsLocal[Settings.docSharing]=v.settingsRemote.get(Settings.docSharing);var n=t.settings.prefix+Settings.docSharing;v.settingsLocal[n]=v.settingsRemote.get(n),v.settingsLocal[Settings.theme]=v.settingsRemote.get(Settings.theme);var i=t.settings.prefix+Settings.theme;v.settingsLocal[i]=v.settingsRemote.get(i),v.settingsRemote.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,g.bind(v))}catch(o){t.reportError(o)}},v.poke=function(){if(v.root&&!v.isClosed)try{var e=v.root.get("poke");e?v.root.set("poke",e+1):v.root.set("poke",1)}catch(t){v.close()}},window.__poke=v.poke,v.rootChanged=function(e){if(e.ocHandled||e.isLocal||v.root.id!==e.target.id)return!1;for(var n=0;n<e.events.length;++n)switch(e.events[n].type){case gapi.drive.realtime.EventType.VALUES_ADDED:case gapi.drive.realtime.EventType.VALUES_REMOVED:break;case gapi.drive.realtime.EventType.VALUE_CHANGED:"dataVersion"===e.property&&(e.newValue>y?t.AppCache.checkForUpdate(!0):e.newVersion<y&&t.reportError(new Error("Remote setting dataVersion to invalid value"+e.newVersion)));break;case gapi.drive.realtime.EventType.TEXT_DELETED:case gapi.drive.realtime.EventType.TEXT_INSERTED:case gapi.drive.realtime.EventType.VALUES_SET:}},v.isConnected=function(){return v.initialized&&!v.isClosed&&!!v.model},v.onLoad=function(e){try{v.initialized=!0,n||(n=require("data")),S||(S=require("VMLI")),v.doc=e,v.model=e.getModel(),v.root=v.model.getRoot(),v.root.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,v.rootChanged),v.isClosed=!1,v.registerForSaveStateChange(v.onSaveStateChange),E>0&&(log("Reconnect Successful: "+E),clearTimeout(k),k=void 0,E=0);var o=v.migrateData();return o?(log("---- Skipping Document Load! ----"),v.isClosed=!0,v.initialized=!1,v.doc=void 0,v.model=void 0,v.root=void 0,!1):(v.loadSettings(),v.rootItem=v.root.get("root"),v.rootItem?(v.rootID=v.rootItem.id,window.__remoteDoc=e,x&&(v.registerForUndoRedoStateChange(x),x=void 0),t.vmMain&&t.vmMain.root()?t.vmMain.loadGDriveData():t.requireGDriveDataCallback=!0,v.loadCollaborators(),!0):void t.messageQueue.pushMessage({text:"Document is corrupted. Please "+i.actionVerbCaps()+" to reload. If the problem persists, please contact support.",type:MessageType.Fatal,action:MessageAction.ResetClient}))}catch(r){t.reportError(r)}},v.getServerVersion=function(){return v.model&&!v.isClosed?v.model.serverVersion:void 0};var D=[];v.registerSaveNotify=function(e){D.push(e)};var P,L=!1,O=!1;return v.onSaveStateChange=function(e){if(L!==e.isPending||O!==e.isSaving){if(e.isSaving||e.isPending)navigator.onLine?e.isSaving&&(e.isPending||t.vmMain.setGDriveStatus(DriveStatus.Saving),clearTimeout(P),P=setTimeout(v.onErrorSaving,v.offlineTimeoutMS)):t.vmMain.setGDriveStatus(DriveStatus.Offline);else{t.vmMain.setGDriveStatus(DriveStatus.Saved),n.clearPendingUpdates(),clearTimeout(P),P=void 0,t.messageQueue.clearMessage(MessageID.ConnectionError);for(var i=0;i<D.length;++i)D[i]()}L=e.isPending,O=e.isSaving}},v.onErrorSaving=function(){t.vmMain.setGDriveStatus(DriveStatus.Offline),P=void 0},v.getVersion=function(e,n){var i;switch(n){case VersionType.Structure:i=e.get(t.translateFieldIn("version"));break;case VersionType.Text:i=e.get(t.translateFieldIn("versionText"));break;default:i=-2}return i?i:0},v.get=function(e,n){return e.get(t.translateFieldIn(n))},v.set=function(e,n,i){return v.beginWriteAction(),void 0===i&&(i=null),e.set(t.translateFieldIn(n),i)},v.delete=function(e,n){return v.beginWriteAction(),e.delete(t.translateFieldIn(n))},v.findInTree=function(e,t){function n(n,i){if(!n)return!1;for(var o=0;o<n.length;o++){var r=n.get(o);if(r.id==e.id)return{parent:t,index:o,isArchived:i};var a=v.findInTree(e,r);if(a)return a}return void 0}t||(t=v.rootItem);var i=v.get(t,"items"),o=n(i,!1);if(!o){var r=v.get(t,"archivedItems");o=n(r,!0)}return o},v});var idbModules={},cleanInterface=!1;!function(){var e={test:!0};if(Object.defineProperty)try{Object.defineProperty(e,"test",{enumerable:!1}),e.test&&(cleanInterface=!0)}catch(t){}}(),function(e){function t(e,t,n,i){n.target=t,"function"==typeof t[e]&&t[e].apply(t,[n]),"function"==typeof i&&i()}function n(e,t){var n=new DOMException.prototype.constructor(0,t);throw n.name=e,n.message=t,n}var i=function(){this.length=0,this._items=[],cleanInterface&&Object.defineProperty(this,"_items",{enumerable:!1})};if(i.prototype={contains:function(e){return-1!==this._items.indexOf(e)},item:function(e){return this._items[e]},indexOf:function(e){return this._items.indexOf(e)},push:function(e){this._items.push(e),this.length+=1;for(var t=0;t<this._items.length;t++)this[t]=this._items[t]},splice:function(){this._items.splice.apply(this._items,arguments),this.length=this._items.length;for(var e in this)e===String(parseInt(e,10))&&delete this[e];for(e=0;e<this._items.length;e++)this[e]=this._items[e]}},cleanInterface)for(var o in{indexOf:!1,push:!1,splice:!1})Object.defineProperty(i.prototype,o,{enumerable:!1});e.util={throwDOMException:n,callback:t,quote:function(e){return"'"+e+"'"},StringList:i}}(idbModules),function(idbModules){var Sca=function(){return{decycle:function(object,callback){function checkForCompletion(){0===queuedObjects.length&&returnCallback(derezObj)}function readBlobAsDataURL(e,t){var n=new FileReader;n.onloadend=function(e){var n=e.target.result,i="blob";updateEncodedBlob(n,t,i)},n.readAsDataURL(e)}function updateEncodedBlob(dataURL,path,blobtype){var encoded=queuedObjects.indexOf(path);path=path.replace("$","derezObj"),eval(path+'.$enc="'+dataURL+'"'),eval(path+'.$type="'+blobtype+'"'),queuedObjects.splice(encoded,1),checkForCompletion()}function derez(e,t){var n,i,o;if(!("object"!=typeof e||null===e||e instanceof Boolean||e instanceof Date||e instanceof Number||e instanceof RegExp||e instanceof Blob||e instanceof String)){for(n=0;n<objects.length;n+=1)if(objects[n]===e)return{$ref:paths[n]};if(objects.push(e),paths.push(t),"[object Array]"===Object.prototype.toString.apply(e))for(o=[],n=0;n<e.length;n+=1)o[n]=derez(e[n],t+"["+n+"]");else{o={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(o[i]=derez(e[i],t+"["+JSON.stringify(i)+"]"))}return o}return e instanceof Blob?(queuedObjects.push(t),readBlobAsDataURL(e,t)):e instanceof Boolean?e={$type:"bool",$enc:e.toString()}:e instanceof Date?e={$type:"date",$enc:e.getTime()}:e instanceof Number?e={$type:"num",$enc:e.toString()}:e instanceof RegExp&&(e={$type:"regex",$enc:e.toString()}),e}var objects=[],paths=[],queuedObjects=[],returnCallback=callback,derezObj=derez(object,"$");checkForCompletion()},retrocycle:function retrocycle($){function dataURLToBlob(e){var t,n,i,o=";base64,";if(-1===e.indexOf(o))return n=e.split(","),t=n[0].split(":")[1],i=n[1],new Blob([i],{type:t});n=e.split(o),t=n[0].split(":")[1],i=window.atob(n[1]);for(var r=i.length,a=new Uint8Array(r),s=0;r>s;++s)a[s]=i.charCodeAt(s);return new Blob([a.buffer],{type:t})}function rez(value){var i,item,name,path;if(value&&"object"==typeof value)if("[object Array]"===Object.prototype.toString.apply(value))for(i=0;i<value.length;i+=1)item=value[i],item&&"object"==typeof item&&(path=item.$ref,value[i]="string"==typeof path&&px.test(path)?eval(path):rez(item));else if(void 0!==value.$type)switch(value.$type){case"blob":case"file":value=dataURLToBlob(value.$enc);break;case"bool":value=Boolean("true"===value.$enc);break;case"date":value=new Date(value.$enc);break;case"num":value=Number(value.$enc);break;case"regex":value=eval(value.$enc)}else for(name in value)"object"==typeof value[name]&&(item=value[name],item&&(path=item.$ref,value[name]="string"==typeof path&&px.test(path)?eval(path):rez(item)));return value}var px=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;return rez($),$},encode:function(e,t){function n(e){t(JSON.stringify(e))}this.decycle(e,n)},decode:function(e){return this.retrocycle(JSON.parse(e))}}}();idbModules.Sca=Sca}(idbModules),function(e){var t=["","number","string","boolean","object","undefined"],n=function(){return{encode:function(e){return t.indexOf(typeof e)+"-"+JSON.stringify(e)},decode:function(e){return"undefined"==typeof e?void 0:JSON.parse(e.substring(2))}}},i={number:n("number"),"boolean":n(),object:n(),string:{encode:function(e){return t.indexOf("string")+"-"+e},decode:function(e){return""+e.substring(2)}},undefined:{encode:function(){return t.indexOf("undefined")+"-undefined"},decode:function(){return void 0}}},o=function(){return{encode:function(e){return i[typeof e].encode(e)},decode:function(e){return i[t[e.substring(0,1)]].decode(e)}}}();e.Key=o}(idbModules),function(e){var t=function(e,t){return{type:e,debug:t,bubbles:!1,cancelable:!1,eventPhase:0,timeStamp:new Date}};e.Event=t}(idbModules),function(e){var t=function(){this.onsuccess=this.onerror=this.result=this.error=this.source=this.transaction=null,this.readyState="pending"},n=function(){this.onblocked=this.onupgradeneeded=null};n.prototype=t,e.IDBRequest=t,e.IDBOpenRequest=n}(idbModules),function(e,t){var n=function(e,t,n,i){this.lower=e,this.upper=t,this.lowerOpen=n,this.upperOpen=i};n.only=function(e){return new n(e,e,!1,!1)},n.lowerBound=function(e,i){return new n(e,t,i,t)},n.upperBound=function(e){return new n(t,e,t,open)},n.bound=function(e,t,i,o){return new n(e,t,i,o)},e.IDBKeyRange=n}(idbModules),function(e,t){function n(n,i,o,r,a,s){this.__range=n,this.source=this.__idbObjectStore=o,this.__req=r,this.key=t,this.direction=i,this.__keyColumnName=a,this.__valueColumnName=s,this.__valueDecoder="value"===s?e.Sca:e.Key,this.source.transaction.__active||e.util.throwDOMException("TransactionInactiveError - The transaction this IDBObjectStore belongs to is not active."),this.__offset=-1,this.__lastKeyContinued=t,this["continue"]()}n.prototype.__find=function(n,i,o,r,a){a=a||1;var s=this,d=["SELECT * FROM ",e.util.quote(s.__idbObjectStore.name)],c=[];d.push("WHERE ",s.__keyColumnName," NOT NULL"),s.__range&&(s.__range.lower||s.__range.upper)&&(d.push("AND"),s.__range.lower&&(d.push(s.__keyColumnName+(s.__range.lowerOpen?" >":" >= ")+" ?"),c.push(e.Key.encode(s.__range.lower))),s.__range.lower&&s.__range.upper&&d.push("AND"),s.__range.upper&&(d.push(s.__keyColumnName+(s.__range.upperOpen?" < ":" <= ")+" ?"),c.push(e.Key.encode(s.__range.upper)))),"undefined"!=typeof n&&(s.__lastKeyContinued=n,s.__offset=0),s.__lastKeyContinued!==t&&(d.push("AND "+s.__keyColumnName+" >= ?"),c.push(e.Key.encode(s.__lastKeyContinued))),d.push("ORDER BY ",s.__keyColumnName),d.push("LIMIT "+a+" OFFSET "+s.__offset),s.__prefetchedData=null,i.executeSql(d.join(" "),c,function(e,n){n.rows.length>1?(s.__prefetchedData=n.rows,s.__prefetchedIndex=0,s.__decode(n.rows.item(0),o)):1===n.rows.length?s.__decode(n.rows.item(0),o):o(t,t)},function(e,t){r(t)})},n.prototype.__decode=function(t,n){var i=e.Key.decode(t[this.__keyColumnName]),o=this.__valueDecoder.decode(t[this.__valueColumnName]),r=e.Key.decode(t.key);n(i,o,r)},n.prototype["continue"]=function(n){var i=e.cursorPreloadPackSize||1e4,o=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(e,r,a,s){o.__offset++;var d=function(e,n,i){o.key=e,o.value=n,o.primaryKey=i,a("undefined"!=typeof o.key?o:t,o.__req)};return o.__prefetchedData&&(o.__prefetchedIndex++,o.__prefetchedIndex<o.__prefetchedData.length)?void o.__decode(o.__prefetchedData.item(o.__prefetchedIndex),d):void o.__find(n,e,d,s,i)})},n.prototype.advance=function(n){0>=n&&e.util.throwDOMException("Type Error - Count is invalid - 0 or negative",n);var i=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(e,o,r,a){i.__offset+=n,i.__find(t,e,function(e,n){i.key=e,i.value=n,r("undefined"!=typeof i.key?i:t,i.__req)},a)})},n.prototype.update=function(n){var i=this,o=this.__idbObjectStore.transaction.__createRequest(function(){});return e.Sca.encode(n,function(n){i.__idbObjectStore.transaction.__pushToQueue(o,function(o,r,a,s){i.__find(t,o,function(t,r,d){var c="UPDATE "+e.util.quote(i.__idbObjectStore.name)+" SET value = ? WHERE key = ?";o.executeSql(c,[n,e.Key.encode(d)],function(e,n){1===n.rowsAffected?a(t):s("No rows with key found"+t)},function(e,t){s(t)})},s)})}),o},n.prototype["delete"]=function(){var n=this;return this.__idbObjectStore.transaction.__addToTransactionQueue(function(i,o,r,a){n.__find(t,i,function(o,s,d){var c="DELETE FROM  "+e.util.quote(n.__idbObjectStore.name)+" WHERE key = ?";i.executeSql(c,[e.Key.encode(d)],function(e,i){1===i.rowsAffected?(n.__offset--,r(t)):a("No rows with key found"+o)},function(e,t){a(t)})},a)})},e.IDBCursor=n}(idbModules),function(idbModules,undefined){function IDBIndex(e,t){this.indexName=this.name=e,this.__idbObjectStore=this.objectStore=this.source=t;var n=t.__storeProps&&t.__storeProps.indexList;n&&(n=JSON.parse(n)),this.keyPath=n&&n[e]&&n[e].keyPath||e,["multiEntry","unique"].forEach(function(t){this[t]=!!(n&&n[e]&&n[e].optionalParams&&n[e].optionalParams[t])},this)}IDBIndex.prototype.__createIndex=function(indexName,keyPath,optionalParameters){var me=this,transaction=me.__idbObjectStore.transaction;transaction.__addToTransactionQueue(function(tx,args,success,failure){me.__idbObjectStore.__getStoreProps(tx,function(){function error(){idbModules.util.throwDOMException(0,"Could not create new index",arguments)}2!==transaction.mode&&idbModules.util.throwDOMException(0,"Invalid State error, not a version transaction",me.transaction);var idxList=JSON.parse(me.__idbObjectStore.__storeProps.indexList);"undefined"!=typeof idxList[indexName]&&idbModules.util.throwDOMException(0,"Index already exists on store",idxList);var columnName=indexName;idxList[indexName]={columnName:columnName,keyPath:keyPath,optionalParams:optionalParameters},me.__idbObjectStore.__storeProps.indexList=JSON.stringify(idxList);var sql=["ALTER TABLE",idbModules.util.quote(me.__idbObjectStore.name),"ADD",columnName,"BLOB"].join(" ");tx.executeSql(sql,[],function(tx,data){tx.executeSql("SELECT * FROM "+idbModules.util.quote(me.__idbObjectStore.name),[],function(tx,data){!function initIndexForRow(i){if(i<data.rows.length)try{var value=idbModules.Sca.decode(data.rows.item(i).value),indexKey=eval("value['"+keyPath+"']");tx.executeSql("UPDATE "+idbModules.util.quote(me.__idbObjectStore.name)+" set "+columnName+" = ? where key = ?",[idbModules.Key.encode(indexKey),data.rows.item(i).key],function(){initIndexForRow(i+1)},error)}catch(e){initIndexForRow(i+1)}else tx.executeSql("UPDATE __sys__ set indexList = ? where name = ?",[me.__idbObjectStore.__storeProps.indexList,me.__idbObjectStore.name],function(){me.__idbObjectStore.__setReadyState("createIndex",!0),success(me)},error)}(0)},error)},error)},"createObjectStore")})},IDBIndex.prototype.openCursor=function(e,t){{var n=new idbModules.IDBRequest;new idbModules.IDBCursor(e,t,this.source,n,this.indexName,"value")}return n},IDBIndex.prototype.openKeyCursor=function(e,t){{var n=new idbModules.IDBRequest;new idbModules.IDBCursor(e,t,this.source,n,this.indexName,"key")}return n},IDBIndex.prototype.__fetchIndexData=function(e,t){var n=this;return n.__idbObjectStore.transaction.__addToTransactionQueue(function(i,o,r,a){var s=["SELECT * FROM ",idbModules.util.quote(n.__idbObjectStore.name)," WHERE",n.indexName,"NOT NULL"],d=[];"undefined"!=typeof e&&(s.push("AND",n.indexName," = ?"),d.push(idbModules.Key.encode(e))),i.executeSql(s.join(" "),d,function(e,n){var i;i="count"===t?n.rows.length:0===n.rows.length?undefined:"key"===t?idbModules.Key.decode(n.rows.item(0).key):idbModules.Sca.decode(n.rows.item(0).value),r(i)},a)})},IDBIndex.prototype.get=function(e){return this.__fetchIndexData(e,"value")},IDBIndex.prototype.getKey=function(e){return this.__fetchIndexData(e,"key")},IDBIndex.prototype.count=function(e){return this.__fetchIndexData(e,"count")},idbModules.IDBIndex=IDBIndex}(idbModules),function(idbModules){var IDBObjectStore=function(e,t,n){this.name=e,this.transaction=t,this.__ready={},this.__setReadyState("createObjectStore","undefined"==typeof n?!0:n),this.indexNames=new idbModules.util.StringList};IDBObjectStore.prototype.__setReadyState=function(e,t){this.__ready[e]=t},IDBObjectStore.prototype.__waitForReady=function(e,t){var n=!0;if("undefined"!=typeof t)n="undefined"==typeof this.__ready[t]?!0:this.__ready[t];else for(var i in this.__ready)this.__ready[i]||(n=!1);if(n)e();else{var o=this;window.setTimeout(function(){o.__waitForReady(e,t)},100)}},IDBObjectStore.prototype.__getStoreProps=function(e,t,n){var i=this;this.__waitForReady(function(){i.__storeProps?t(i.__storeProps):e.executeSql("SELECT * FROM __sys__ where name = ?",[i.name],function(e,n){1!==n.rows.length?t():(i.__storeProps={name:n.rows.item(0).name,indexList:n.rows.item(0).indexList,autoInc:n.rows.item(0).autoInc,keyPath:n.rows.item(0).keyPath},t(i.__storeProps))},function(){t()})},n)},IDBObjectStore.prototype.__deriveKey=function(tx,value,key,callback){function getNextAutoIncKey(){tx.executeSql("SELECT * FROM sqlite_sequence where name like ?",[me.name],function(e,t){callback(1!==t.rows.length?0:t.rows.item(0).seq)},function(e,t){idbModules.util.throwDOMException(0,"Data Error - Could not get the auto increment value for key",t)})}var me=this;me.__getStoreProps(tx,function(props){if(props||idbModules.util.throwDOMException(0,"Data Error - Could not locate defination for this table",props),props.keyPath)if("undefined"!=typeof key&&idbModules.util.throwDOMException(0,"Data Error - The object store uses in-line keys and the key parameter was provided",props),value)try{var primaryKey=eval("value['"+props.keyPath+"']");primaryKey?callback(primaryKey):"true"===props.autoInc?getNextAutoIncKey():idbModules.util.throwDOMException(0,"Data Error - Could not eval key from keyPath")}catch(e){idbModules.util.throwDOMException(0,"Data Error - Could not eval key from keyPath",e)}else idbModules.util.throwDOMException(0,"Data Error - KeyPath was specified, but value was not");else"undefined"!=typeof key?callback(key):"false"===props.autoInc?idbModules.util.throwDOMException(0,"Data Error - The object store uses out-of-line keys and has no key generator and the key parameter was not provided. ",props):getNextAutoIncKey()})},IDBObjectStore.prototype.__insertData=function(tx,encoded,value,primaryKey,success,error){var paramMap={};"undefined"!=typeof primaryKey&&(paramMap.key=idbModules.Key.encode(primaryKey));var indexes=JSON.parse(this.__storeProps.indexList);for(var key in indexes)try{paramMap[indexes[key].columnName]=idbModules.Key.encode(eval("value['"+indexes[key].keyPath+"']"))}catch(e){error(e)}var sqlStart=["INSERT INTO ",idbModules.util.quote(this.name),"("],sqlEnd=[" VALUES ("],sqlValues=[];for(key in paramMap)sqlStart.push(key+","),sqlEnd.push("?,"),sqlValues.push(paramMap[key]);sqlStart.push("value )"),sqlEnd.push("?)"),sqlValues.push(encoded);var sql=sqlStart.join(" ")+sqlEnd.join(" ");tx.executeSql(sql,sqlValues,function(){success(primaryKey)},function(e,t){error(t)})},IDBObjectStore.prototype.add=function(e,t){var n=this,i=n.transaction.__createRequest(function(){});return idbModules.Sca.encode(e,function(o){n.transaction.__pushToQueue(i,function(i,r,a,s){n.__deriveKey(i,e,t,function(t){n.__insertData(i,o,e,t,a,s)})})}),i},IDBObjectStore.prototype.put=function(e,t){var n=this,i=n.transaction.__createRequest(function(){});return idbModules.Sca.encode(e,function(o){n.transaction.__pushToQueue(i,function(i,r,a,s){n.__deriveKey(i,e,t,function(t){var r="DELETE FROM "+idbModules.util.quote(n.name)+" where key = ?";i.executeSql(r,[idbModules.Key.encode(t)],function(i){n.__insertData(i,o,e,t,a,s)},function(e,t){s(t)})})})}),i},IDBObjectStore.prototype.get=function(e){var t=this;return t.transaction.__addToTransactionQueue(function(n,i,o,r){t.__waitForReady(function(){var i=idbModules.Key.encode(e);n.executeSql("SELECT * FROM "+idbModules.util.quote(t.name)+" where key = ?",[i],function(e,t){try{if(0===t.rows.length)return o();o(idbModules.Sca.decode(t.rows.item(0).value))}catch(n){o(void 0)}},function(e,t){r(t)})})})},IDBObjectStore.prototype["delete"]=function(e){var t=this;return t.transaction.__addToTransactionQueue(function(n,i,o,r){t.__waitForReady(function(){var i=idbModules.Key.encode(e);n.executeSql("DELETE FROM "+idbModules.util.quote(t.name)+" where key = ?",[i],function(){o()},function(e,t){r(t)})})})},IDBObjectStore.prototype.clear=function(){var e=this;return e.transaction.__addToTransactionQueue(function(t,n,i,o){e.__waitForReady(function(){t.executeSql("DELETE FROM "+idbModules.util.quote(e.name),[],function(){i()},function(e,t){o(t)})})})},IDBObjectStore.prototype.count=function(e){var t=this;return t.transaction.__addToTransactionQueue(function(n,i,o,r){t.__waitForReady(function(){var i="SELECT * FROM "+idbModules.util.quote(t.name)+("undefined"!=typeof e?" WHERE key = ?":""),a=[];"undefined"!=typeof e&&a.push(idbModules.Key.encode(e)),n.executeSql(i,a,function(e,t){o(t.rows.length)},function(e,t){r(t)})})})},IDBObjectStore.prototype.openCursor=function(e,t){{var n=new idbModules.IDBRequest;new idbModules.IDBCursor(e,t,this,n,"key","value")}return n},IDBObjectStore.prototype.index=function(e){var t=new idbModules.IDBIndex(e,this);return t},IDBObjectStore.prototype.createIndex=function(e,t,n){var i=this;n=n||{},i.__setReadyState("createIndex",!1);var o=new idbModules.IDBIndex(e,i);return i.__waitForReady(function(){o.__createIndex(e,t,n)},"createObjectStore"),i.indexNames.push(e),o},IDBObjectStore.prototype.deleteIndex=function(e){var t=new idbModules.IDBIndex(e,this,!1);return t.__deleteIndex(e),t},idbModules.IDBObjectStore=IDBObjectStore}(idbModules),function(e){var t=0,n=1,i=2,o=function(i,o,r){if("number"==typeof o)this.mode=o;else if("string"==typeof o)switch(o){case"readwrite":this.mode=n;break;case"readonly":this.mode=t;break;default:this.mode=t}this.storeNames="string"==typeof i?[i]:i;for(var a=0;a<this.storeNames.length;a++)r.objectStoreNames.contains(this.storeNames[a])||e.util.throwDOMException(0,"The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.",this.storeNames[a]);this.__active=!0,this.__running=!1,this.__requests=[],this.__aborted=!1,this.db=r,this.error=null,this.onabort=this.onerror=this.oncomplete=null};o.prototype.__executeRequests=function(){if(!this.__running||this.mode===i){this.__running=!0;var t=this;window.setTimeout(function(){2===t.mode||t.__active||e.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",t.__active),t.db.__db.transaction(function(n){function i(t,n){n&&(a.req=n),a.req.readyState="done",a.req.result=t,delete a.req.error;var i=e.Event("success");e.util.callback("onsuccess",a.req,i),s++,r()}function o(){a.req.readyState="done",a.req.error="DOMError";var t=e.Event("error",arguments);e.util.callback("onerror",a.req,t),s++,r()}function r(){return s>=t.__requests.length?(t.__active=!1,void(t.__requests=[])):(a=t.__requests[s],void a.op(n,a.args,i,o))}t.__tx=n;var a=null,s=0;try{r()}catch(d){"function"==typeof t.onerror&&t.onerror()}},function(){"function"==typeof t.onerror&&t.onerror()},function(){"function"==typeof t.oncomplete&&t.oncomplete()})},1)}},o.prototype.__addToTransactionQueue=function(t,n){this.__active||this.mode===i||e.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished.",this.__mode);var o=this.__createRequest();return this.__pushToQueue(o,t,n),o},o.prototype.__createRequest=function(){var t=new e.IDBRequest;return t.source=this.db,t.transaction=this,t},o.prototype.__pushToQueue=function(e,t,n){this.__requests.push({op:t,args:n,req:e}),this.__executeRequests()},o.prototype.objectStore=function(t){return new e.IDBObjectStore(t,this)},o.prototype.abort=function(){!this.__active&&e.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",this.__active)},o.prototype.READ_ONLY=0,o.prototype.READ_WRITE=1,o.prototype.VERSION_CHANGE=2,e.IDBTransaction=o}(idbModules),function(e){var t=function(t,n,i,o){this.__db=t,this.version=i,this.__storeProperties=o,this.objectStoreNames=new e.util.StringList;for(var r=0;r<o.rows.length;r++)this.objectStoreNames.push(o.rows.item(r).name);this.name=n,this.onabort=this.onerror=this.onversionchange=null};t.prototype.createObjectStore=function(t,n){var i=this;n=n||{},n.keyPath=n.keyPath||null;var o=new e.IDBObjectStore(t,i.__versionTransaction,!1),r=i.__versionTransaction;return r.__addToTransactionQueue(function(r,a,s){function d(){e.util.throwDOMException(0,"Could not create new object store",arguments)}i.__versionTransaction||e.util.throwDOMException(0,"Invalid State error",i.transaction);var c=["CREATE TABLE",e.util.quote(t),"(key BLOB",n.autoIncrement?", inc INTEGER PRIMARY KEY AUTOINCREMENT":"PRIMARY KEY",", value BLOB)"].join(" ");r.executeSql(c,[],function(e){e.executeSql("INSERT INTO __sys__ VALUES (?,?,?,?)",[t,n.keyPath,n.autoIncrement?!0:!1,"{}"],function(){o.__setReadyState("createObjectStore",!0),s(o)},d)},d)}),i.objectStoreNames.push(t),o},t.prototype.deleteObjectStore=function(t){var n=function(){e.util.throwDOMException(0,"Could not delete ObjectStore",arguments)},i=this;!i.objectStoreNames.contains(t)&&n("Object Store does not exist"),i.objectStoreNames.splice(i.objectStoreNames.indexOf(t),1);var o=i.__versionTransaction;o.__addToTransactionQueue(function(){i.__versionTransaction||e.util.throwDOMException(0,"Invalid State error",i.transaction),i.__db.transaction(function(i){i.executeSql("SELECT * FROM __sys__ where name = ?",[t],function(i,o){o.rows.length>0&&i.executeSql("DROP TABLE "+e.util.quote(t),[],function(){i.executeSql("DELETE FROM __sys__ WHERE name = ?",[t],function(){},n)},n)})})})},t.prototype.close=function(){},t.prototype.transaction=function(t,n){var i=new e.IDBTransaction(t,n||1,this);return i},e.IDBDatabase=t}(idbModules),function(e){var t,n,i=2097152,o=!1,r=!1,o=!1,t=void 0,a={loadShim:function(){window.openDatabase&&(n=window.openDatabase("__sysdb__",1,"System Database",i),n.transaction(function(t){t.executeSql("SELECT * FROM dbVersions",[],function(){a.notifyIsReady(!0)
},function(){n.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS dbVersions (name VARCHAR(255), version INT);",[],function(){a.notifyIsReady(!0)},function(){a.notifyIsReady(!1),e.util.throwDOMException("Could not create table __sysdb__ to save DB versions")})})})},function(){}))},notifyIsReady:function(e){if(o=!0,r=e,t){for(var n=0;n<t.length;++n)t[n](r);t=void 0}},onIsReady:function(e){o?setTimeout(function(){e(r)},0):t?t.push(e):t=[e]},open:function(t,o){function r(){if(!d){var t=e.Event("error",arguments);s.readyState="done",s.error="DOMError",e.util.callback("onerror",s,t),d=!0}}function a(a){var d=window.openDatabase(t,1,t,i);s.readyState="done","undefined"==typeof o&&(o=a||1),(0>=o||a>o)&&e.util.throwDOMException(0,"An attempt was made to open a database using a lower version than the existing version.",o),d.transaction(function(i){i.executeSql("CREATE TABLE IF NOT EXISTS __sys__ (name VARCHAR(255), keyPath VARCHAR(255), autoInc BOOLEAN, indexList BLOB)",[],function(){i.executeSql("SELECT * FROM __sys__",[],function(i,c){var l=e.Event("success");s.source=s.result=new e.IDBDatabase(d,t,o,c),o>a?n.transaction(function(n){n.executeSql("UPDATE dbVersions set version = ? where name = ?",[o,t],function(){var t=e.Event("upgradeneeded");t.oldVersion=a,t.newVersion=o,s.transaction=s.result.__versionTransaction=new e.IDBTransaction([],2,s.source),e.util.callback("onupgradeneeded",s,t,function(){var t=e.Event("success");e.util.callback("onsuccess",s,t)})},r)},r):e.util.callback("onsuccess",s,l)},r)},r)},r)}var s=new e.IDBOpenRequest,d=!1;return n.transaction(function(e){e.executeSql("SELECT * FROM dbVersions where name = ?",[t],function(e,n){0===n.rows.length?e.executeSql("INSERT INTO dbVersions VALUES (?,?)",[t,o||1],function(){a(0)},r):a(n.rows.item(0).version)},r)},r),s},deleteDatabase:function(t){function o(t){if(!s){a.readyState="done",a.error="DOMError";var n=e.Event("error");n.message=t,n.debug=arguments,e.util.callback("onerror",a,n),s=!0}}function r(){n.transaction(function(n){n.executeSql("DELETE FROM dbVersions where name = ? ",[t],function(){a.result=void 0;var t=e.Event("success");t.newVersion=null,t.oldVersion=d,e.util.callback("onsuccess",a,t)},o)},o)}var a=new e.IDBOpenRequest,s=!1,d=null;return n.transaction(function(n){n.executeSql("SELECT * FROM dbVersions where name = ?",[t],function(n,s){if(0===s.rows.length){a.result=void 0;var c=e.Event("success");return c.newVersion=null,c.oldVersion=d,void e.util.callback("onsuccess",a,c)}d=s.rows.item(0).version;var l=window.openDatabase(t,1,t,i);l.transaction(function(t){t.executeSql("SELECT * FROM __sys__",[],function(t,n){var i=n.rows;!function a(n){n>=i.length?t.executeSql("DROP TABLE __sys__",[],function(){r()},o):t.executeSql("DROP TABLE "+e.util.quote(i.item(n).name),[],function(){a(n+1)},function(){a(n+1)})}(0)},function(){r()})},o)})},o),a},cmp:function(t,n){return e.Key.encode(t)>e.Key.encode(n)?1:t===n?0:-1}};e.shimIndexedDB=a}(idbModules),function(e,t){"undefined"!=typeof e.openDatabase&&(e.shimIndexedDB=t.shimIndexedDB,e.shimIndexedDB&&(e.shimIndexedDB.__useShim=function(){console.log("---- Using SQL Shim ----"),t.shimIndexedDB.loadShim(),e.dbProvider=t.shimIndexedDB,e.IDBDatabase=t.IDBDatabase,e.IDBTransaction=t.IDBTransaction,e.IDBCursor=t.IDBCursor,e.IDBKeyRange=t.IDBKeyRange,e.dbProvider!==t.shimIndexedDB&&Object.defineProperty&&Object.defineProperty(e,"indexedDB",{value:t.shimIndexedDB})},e.shimIndexedDB.__debug=function(){})),e.dbProvider=e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.oIndexedDB||e.msIndexedDB;var n=!1;(navigator.userAgent.match(/Android 2/)||navigator.userAgent.match(/Android 3/)||navigator.userAgent.match(/Android 4\.[0-3]/))&&(navigator.userAgent.match(/Chrome/)||(n=!0));var i=e.location.hash.indexOf("forcesql=true")>=0;if(i||("undefined"==typeof e.indexedDB||null===e.indexedDB||n)&&"undefined"!=typeof e.openDatabase)e.shimIndexedDB.__useShim();else{e.IDBDatabase=e.IDBDatabase||e.webkitIDBDatabase,e.IDBTransaction=e.IDBTransaction||e.webkitIDBTransaction,e.IDBCursor=e.IDBCursor||e.webkitIDBCursor,e.IDBKeyRange=e.IDBKeyRange||e.webkitIDBKeyRange,e.IDBTransaction||(e.IDBTransaction={});try{e.IDBTransaction.READ_ONLY=e.IDBTransaction.READ_ONLY||"readonly",e.IDBTransaction.READ_WRITE=e.IDBTransaction.READ_WRITE||"readwrite"}catch(o){}}}(window,idbModules),define("IndexedDBShim",function(){}),define("db",["IndexedDBShim"],function(){var e=window.dbProvider,t=window.IDBKeyRange||window.webkitIDBKeyRange,n={readonly:"readonly",readwrite:"readwrite"},i=Object.prototype.hasOwnProperty;if(!e)return void console.log("IndexedDB is not available");var o=function(e){return e},r=function(){var e,t=[],n=function(n,i){if(t){i=i||[],e=e||[n,i];for(var o=0,r=t.length;r>o;o++)t[o].apply(e[0],e[1]);t=[]}};this.add=function(){for(var i=0,o=arguments.length;o>i;i++)t.push(arguments[i]);return e&&n(),this},this.execute=function(){return n(this,arguments),this}},a=function(e){var t="progress",n=[["resolve","done",new r,"resolved"],["reject","fail",new r,"rejected"],["notify","progress",new r]],i={},o={state:function(){return t},then:function(){var e=arguments;return a(function(t){n.forEach(function(n,o){var r=e[o];i[n[1]]("function"==typeof r?function(){var e=r.apply(this,arguments);e&&"function"==typeof e.promise&&e.promise().done(t.resolve).fail(t.reject).progress(t.notify)}:t[n[0]])})}).promise()},promise:function(e){return e?(Object.keys(o).forEach(function(t){e[t]=o[t]}),e):o}};return n.forEach(function(e){var n=e[2],r=e[3];o[e[1]]=n.add,r&&n.add(function(){t=r}),i[e[0]]=n.execute}),o.promise(i),e&&e.call(i,i),i},s=function(e,t){var o=this,r=!1;this.add=function(t){if(r)throw"Database has been closed";for(var i=[],s=0,d=0;d<arguments.length-1;d++)if(Array.isArray(arguments[d+1]))for(var c=0;c<arguments[d+1].length;c++)i[s]=arguments[d+1][c],s++;else i[s]=arguments[d+1],s++;var l=e.transaction(t,n.readwrite),u=l.objectStore(t),h=a();return i.forEach(function(e){var t;if(e.item&&e.key){var n=e.key;e=e.item,t=u.add(e,n)}else t=u.add(e);t.onsuccess=function(t){var n=t.target,i=n.source.keyPath;null===i&&(i="__id__"),Object.defineProperty(e,i,{value:n.result,enumerable:!0}),h.notify()}}),l.oncomplete=function(){h.resolve(i,o)},l.onerror=function(e){h.reject(i,e)},l.onabort=function(e){h.reject(i,e)},h.promise()},this.update=function(t){if(r)throw"Database has been closed";for(var i=[],s=0;s<arguments.length-1;s++)i[s]=arguments[s+1];var d=e.transaction(t,n.readwrite),c=d.objectStore(t),l=a();return i.forEach(function(e){var t;if(e.item&&e.key){var n=e.key;e=e.item,t=c.put(e,n)}else t=c.put(e);t.onsuccess=function(){l.notify()}}),d.oncomplete=function(){l.resolve(i,o)},d.onerror=function(e){l.reject(i,e)},d.onabort=function(e){l.reject(i,e)},l.promise()},this.updateObject=function(t){if(r)throw"Database has been closed";var i=e.transaction(t,n.readwrite),s=i.objectStore(t),d=a(),c=arguments[1];for(var l in c)s.put(c[l]);return i.oncomplete=function(){d.resolve(c,o)},i.onerror=function(e){d.reject(c,e)},i.onabort=function(e){d.reject(c,e)},d.promise()},this.remove=function(t,i){if(r)throw"Database has been closed";{var o=e.transaction(t,n.readwrite),s=o.objectStore(t),d=a();s.delete(i)}return o.oncomplete=function(){d.resolve(i)},o.onerror=function(e){d.reject(e)},d.promise()},this.clear=function(t){if(r)throw"Database has been closed";{var i=e.transaction(t,n.readwrite),o=i.objectStore(t),s=a();o.clear()}return i.oncomplete=function(){s.resolve()},i.onerror=function(e){s.reject(e)},s.promise()},this.close=function(){if(r)throw"Database has been closed";e.close(),r=!0,delete u[t]},this.get=function(t,n){if(r)throw"Database has been closed";var i=e.transaction(t),o=i.objectStore(t),s=a(),d=o.get(n);return d.onsuccess=function(e){s.resolve(e.target.result)},i.onerror=function(e){s.reject(e)},s.promise()},this.query=function(t,n){if(r)throw"Database has been closed";return new d(t,e,n)};for(var s=0,c=e.objectStoreNames.length;c>s;s++)!function(e){o[e]={};for(var t in o)i.call(o,t)&&"close"!==t&&(o[e][t]=function(t){return function(){var n=[e].concat([].slice.call(arguments,0));return o[t].apply(o,n)}}(t))}(e.objectStoreNames[s])},d=function(e,i,r){var s=this,d=!1,c=function(o,s,c,l,u,h,p){var f=i.transaction(e,d?n.readwrite:n.readonly),m=f.objectStore(e),g=r?m.index(r):m,v=o?t[o].apply(null,s):null,y=[],b=a(),S=[v],u=u?u:null,h=h?h:void 0,T=0;"count"!==c&&S.push(l||"next");var w=d?Object.keys(d):!1,M=function(e){for(var t=0;t<w.length;t++){var n=w[t],i=d[n];i instanceof Function&&(i=i(e)),e[n]=i}return e};return g[c].apply(g,S).onsuccess=function(e){var t=e.target.result;if("number"==typeof t)y=t;else if(t)if(null!==u&&u[0]>T)T=u[0],t.advance(u[0]);else if(null!==u&&T>=u[0]+u[1]);else{var n=!0,i="value"in t?t.value:t.key;h&&h.forEach(function(e){e&&e.length&&(n=2===e.length?i[e[0]]===e[1]:e[0].apply(void 0,[i]))}),n&&(T++,y.push(p(i)),d&&(i=M(i),t.update(i))),t.continue()}},f.oncomplete=function(){b.resolve(y)},f.onerror=function(e){b.reject(e)},f.onabort=function(e){b.reject(e)},b.promise()},l=function(e,t){var n="next",i="openCursor",r=[],a=null,s=o,l=!1,u=function(){return c(e,t,i,l?n+"unique":n,a,r,s)},h=function(){return a=Array.prototype.slice.call(arguments,0,2),1==a.length&&a.unshift(0),{execute:u}},p=function(){return n=null,i="count",{execute:u}},f=function(){return i="openKeyCursor",{desc:g,execute:u,filter:m,distinct:v,map:b}},m=function(){return r.push(Array.prototype.slice.call(arguments,0,2)),{keys:f,execute:u,filter:m,desc:g,distinct:v,modify:y,limit:h,map:b}},g=function(){return n="prev",{keys:f,execute:u,filter:m,distinct:v,modify:y,map:b}},v=function(){return l=!0,{keys:f,count:p,execute:u,filter:m,desc:g,modify:y,map:b}},y=function(e){return d=e,{execute:u}},b=function(e){return s=e,{execute:u,count:p,keys:f,filter:m,desc:g,distinct:v,modify:y,limit:h,map:b}};return{execute:u,count:p,keys:f,filter:m,desc:g,distinct:v,modify:y,limit:h,map:b}};"only bound upperBound lowerBound".split(" ").forEach(function(e){s[e]=function(){return new l(e,arguments)}}),this.filter=function(){var e=new l(null,null);return e.filter.apply(e,arguments)},this.all=function(){return this.filter()}},c=function(e,t,n){"function"==typeof t&&(t=t());for(var o in t){var r,a=t[o];r=!i.call(t,o)||n.objectStoreNames.contains(o)?e.currentTarget.transaction.objectStore(o):n.createObjectStore(o,a.key);for(var s in a.indexes)if(!r.indexNames.contains(s)){var d=a.indexes[s];r.createIndex(s,d.key||s,Object.keys(d).length?d:{unique:!1})}}},l=function(e,t){var n=e.target.result,i=new s(n,t),o=a();return o.resolve(i),u[t]=n,o.promise()},u={},h={version:"0.9.0",open:function(t){var n,i=a();return u[t.server]?l({target:{result:u[t.server]}},t.server,t.version,t.schema).done(i.resolve).fail(i.reject).progress(i.notify):(n=e.open(t.server,t.version),n.onsuccess=function(e){l(e,t.server,t.version,t.schema).done(i.resolve).fail(i.reject).progress(i.notify)},n.onupgradeneeded=function(e){c(e,t.schema,e.target.result)},n.onerror=function(e){i.reject(e)}),i.promise()}};return h}),define("demo",["globals","util"],function(e){var t={cache:{}};return t.loadRemoteData=function(n,i){var o=n.split(".");t.cache[o[0]]?i(JSON.parse(JSON.stringify(t.cache[o[0]][o[1]]))):e.XHR({type:"GET",url:window.location.protocol+"//"+window.location.host+"/data/"+o[0]+".json",cb:function(e){if(200===e.status)try{var n=JSON.parse(e.responseText);t.cache[o[0]]=n;var r=n[o[1]];if(r){var a=JSON.parse(JSON.stringify(r));i(a)}else log("Invalid data slot")}catch(s){log("Error parsing demo data: "+s.message)}else log("Error getting demo data",e.status,e.responseText)}})},t}),define("data",["globals","util","gdata","db","demo","platform"],function(e,t,n,i,o,r){function a(){}function s(){log("Transaction Error: ",arguments)}function d(e){var t=f.getItem(e);if(t){var n=t.items;if(n)for(var i=0;i<n.length;++i)d(n[i]);f.dbDeleteItem(t.id)}}function c(e,t,n){e.save({items:e.getItemsArrayForSave()},SaveFlag.None),t.save({isArchived:n},SaveFlag.None)}function l(e,t){var n=e[t];return n?',"'+t+'":'+n:""}function u(e,t,n){var i="";t&&(i+=",");var o=f.getModel(e.id),r=String(o.getParsedText()).replace(/[\"]/g,function(e){return w[e]}),e=f.getItem(e.id),a=l(e,"dateCompleted"),s=l(e,"priority"),d=l(e,"isComplete"),c=l(e,"isStarred"),h=l(e,"isArchived");if(i+='{"text": "'+r+'"'+a+s+d+c+h,e.items&&e.items.length>0){i+=',"items":[';for(var p=0;p<e.items.length;p++){var m=f.getItem(e.items[p]);(!m.isArchived||m.isArchived&&n)&&(i+=u(m,p>0))}i+="]"}return i+="}"}var h="ctcs",p={___info___:{count:0}},f={contacts:[],contactsByName:{},contactNames:p,pendingRemoteUpdates:{},itemsById:{},loadedItemCount:0,hasLocalData:!1,freezeUpdates:!1,dbi:void 0};f.forEachModel=function(e){for(var t in f.itemsById)f.itemsById[t]&&e(f.itemsById[t].model)},f.getModel=function(e){var t=f.itemsById[e];return t?t.model:void 0},f.setModel=function(e,t){f.itemsById[e]?f.itemsById[e].model=t:f.itemsById[e]={model:t,data:void 0}},f.getItem=function(e){var t=f.itemsById[e];return t?t.data:void 0},f.setItem=function(e,t){f.itemsById[e]?f.itemsById[e].data=t:f.itemsById[e]={model:void 0,data:t}},f.clearItems=function(){f.itemsById={}},f.getRootItem=function(){return f.rootId?f.getItem(f.rootId):void 0},f.getRootModel=function(){return f.rootId?f.getModel(f.rootId):void 0},f.initializeIndexedDB=function(t){function n(n){n?i.open({server:"duchess",version:o,schema:{items:{key:{keyPath:"id"}},settings:{}}}).done(function(e){f.dbi=e,t()}).fail(function(n){log("Error loading local DB client",n),e.preventLocalWrites(),e.reportError(n),t()}):(log("Shim failed to init."),e.preventLocalWrites(),t())}var o=1;window.indexedDB&&void 0!==window.indexedDB.onIsReady&&null!==window.indexedDB.onIsReady?window.indexedDB.onIsReady(n):setTimeout(function(){n(!0)},0)},f.migrateLocalData_One=function(){for(var e in f.itemsById){var t=!1,n={},i=f.getItem(e);if(i){var o=i.text;o.startsWith("!")?(n.priority=VMLIFlag.P0,n.text=o.substr(1),t=!0):o.startsWith("*")?(n.isStarred=!0,n.text=o.substr(1),t=!0):o.startsWith("^")&&(n.isComplete=!0,n.text=o.substr(1),t=!0),t&&f.dbUpdateItem({id:e,changes:n,saveFlags:SaveFlag.None})}}},f.migrateLocalData_Two=function(){if(0===f.contacts.length)return void log("Skipping local data migration two");for(var e in f.itemsById){var t=!1,n={},i=f.getItem(e);if(i&&i.text.indexOf("@")>=0)for(var o=i.text.split(" "),r=0,a=0;a<o.length;++a){if(0===o[a].indexOf("@")){for(var s=void 0,d=o[a].substring(1),c=1;4>c;c++){var l=-1!==d.indexOf(":",d.length-1)?d.substr(0,d.length-1):d;if(f.contactsByName[l]&&(s=l),!(a+c<o.length))break;d+=" "+o[a+c]}if(s){var u=i.text.substr(0,r)+"+"+i.text.substr(r+1);n.text=u,t=!0;var h=f.getModel(e);h&&(h.setRawText(u),h.parseText(!0))}}r+=o[a].length+1}t&&f.dbUpdateItem({id:e,changes:n,saveFlags:SaveFlag.None})}};var m=!1;f.localDataLoaded=function(){return m},f.loadFromIndexedDB=function(t){f.itemsById={},e.shouldWriteLocal()&&f.dbi&&f.dbi.items?f.dbi.items.query().all().execute().done(function(n){f.loadedItemCount=n.length;for(var i=0;i<n.length;++i)f.setItem(n[i].id,e.translateObjOut(n[i]));m=!0,f.dbi.settings?f.dbi.settings.get("root").done(function(n){e.criticalErrorReported()||(n&&(f.rootId=n.root),log("Root Item: ",f.rootId),t&&t())}).fail(t):(log("Unable to load local settings DB"),t&&t())}):(log("Unable to load local items DB"),m=!0,e.preventLocalWrites(),t&&t())};var g=void 0;f.beginTransaction=function(){e.shouldWriteLocal()&&(g={})},f.transactionUpdate=function(e,t){if(g[e])for(var n in t)g[e][n]=t[n];else g[e]=t},f.endTransaction=function(){e.shouldWriteLocal()&&f.dbi&&f.dbi.items?f.dbi.items.updateObject(g).done(a).fail(s):void 0!==g&&e.reportError(new Error("Started a transaction and stopped writes halfway through")),g=void 0},f.dbUpdateItem=function(t){if(!f.freezeUpdates){f.hasLocalData||e.isLoadingRemote||t.skipLocalModification||(f.hasLocalData=!0);var n=t.changes||{},i=t.id?t.id:n.id,o=t.callback,r=t.saveFlags,a=f.getItem(i);if(e.shouldWriteLocal()){var s;if(e.isFlagSet(r,SaveFlag.Prop)){n.modifiedOffline=!0;var d=f.getModel(i);d&&(d.modifiedOffline=!0)}if(e.isFlagSet(r,SaveFlag.Text)){n.modifiedOfflineText=!0;var d=f.getModel(i);d&&(d.modifiedOfflineText=!0)}if(a){for(var c in n)if(n.hasOwnProperty(c)){a[c]=n[c]}s=e.translateObjIn(a)}else{f.setItem(i,n),s=e.translateObjIn(n)}g?f.transactionUpdate(i,s):o?f.dbi.items.update(s).done(o).fail(o):f.dbi.items.update(s)}else{if(a)for(var c in n)n.hasOwnProperty(c)&&(a[c]=n[c]);else f.setItem(i,n);o&&o()}}},f.dbDeleteItem=function(t,n){f.freezeUpdates||(f.setItem(t,void 0),e.shouldWriteLocal()&&(n?f.dbi.items.remove(t).done(n).fail(n):f.dbi.items.remove(t)))},f.setRoot=function(t){return f.freezeUpdates?void 0:(e.shouldWriteLocal()&&f.dbi.settings.update({key:"root",item:{root:t}}),f.rootId=t,f.getRootItem())};var v=0,y={};f.loadDemoData=function(e,t,n){function i(e){e.id||(e.id="demo"+v++),f.setItem(e.id,e);var t=e.items;if(t){for(var n=[],o=0;o<t.length;++o)t[o].id||(t[o].id="demo"+v++),n.push(t[o].id),i(t[o]);e.items=n}}function r(o){var r;o&&(r=o[0]),r&&(t&&f.clearItems(),i(r),f.setRoot(r.id),y[e]=r,m=!0,n&&n(r.id))}if(void 0===e&&(e="demo.5"),t||void 0===e||""===e||void 0===y[e])""===e?o.loadRemoteData("demo.5",r):o.loadRemoteData(e,r);else{log("Use Preloaded demo data: ",e);var a=y[e];f.setRoot(a.id),n&&n(a.id)}};var b=!1;f.initData=function(n){if(b)return!1;b=!0;try{e.isDemoMode()?setTimeout(function(){var e=t.getURLParam("data");f.loadDemoData(e,!1,n)},0):(e.checkpoint(Checkpoint.InitData),f.initializeIndexedDB(function(){f.loadFromIndexedDB(function(){e.checkpoint(Checkpoint.DBLoaded),f.checkLocalIntegrity(function(){f.loadLocalContacts(),n(),f.hasLocalData||r.offline||!navigator.onLine||e.vmMain.isLoadingDoc(!0)})})}))}catch(i){e.reportError(i)}return!0},f.initializeItem=function(t){var i=t.id,o=!i||e.isLocalItem(t)||!t.data;if(o){var r=n.createNewItem(t,t.hasChildren(),t.hasArchivedChildren());i&&i!==r&&f.modifyItemId(i,r);for(var a=!1,s=t.items(),d=0;d<s.length;++d)a|=f.initializeItem(s[d]);if(t.hasArchivedChildren())for(var c=t.archivedItems(!0),d=0;d<c.length;++d)a|=f.initializeItem(c[d]);if(n.initializeNewItem(t),i&&i!==r){var l=t.parent();l&&l.save(null,SaveFlag.None)}}return o},f.checkLocalIntegrity=function(t){var n=!1,i=!1;f.ensureLocalCache(function(){var o=!1,r={};for(var a in f.itemsById)if(f.itemsById.hasOwnProperty(a)&&f.getItem(a)){var s=f.getItem(a);(s.i||s.t)&&(log("%cInvalid local properties on item: ","color: red",s),n=!0),r[s.id]?r[s.id].exist?(log(s.id,": Duplicated IDs in the local database",s),n=!0):(r[s.id].exist=!0,r[s.id].del=!!s.isDeleted):r[s.id]={exist:!0,ref:!1,del:!!s.isDeleted},s.id==f.rootId&&(o&&(log(s.id,": Multiple roots present locally",s),n=!0),o=!0,r[s.id].isRoot=!0),void 0==s.text&&(log("Found item with no text",s.id),s.text="",f.dbUpdateItem({id:a,changes:{text:""},saveFlags:SaveFlag.None}));for(var c=void 0,l=0;s.items&&l<s.items.length;++l)if(s.items[l]){var u=s.items[l],h=f.getItem(u);if(h?(h.isArchived&&(c=u),c&&!h.isArchived&&(log(u,": Unarchived child found after an archived one"),log("   ",s.id,": Parent with incorrectly ordered children"),n=!0)):(log(u,": Child does not have a valid reference on our local database"),n=!0),r[u])if(r[u].ref){log(u,": Item is referenced locally multiple times: ",h?f.getItem(u).id:"UNDEFINED"),log("   ",r[u].ref,": ",f.getItem(r[u].ref).id),log("   ",s.id,": <CLIENTDATA>"),n=!0;var p=s.items;p.removeAt(l),f.dbUpdateItem({id:a,changes:{items:p},saveFlags:SaveFlag.None})}else r[u].ref=s.id;else r[u]={exist:!1,ref:s.id}}else log(s.id,": Invalid item in local items array"),n=!0}o||(log("No root present"),n=!0);for(var m in r){var g=r[m];if(!g.exist){log(m,": Item is referenced locally as a child but does not exist in the database");var s=f.getItem(g.ref);if(s){var p=s.items;p?p.remove(m):p=[],f.dbUpdateItem({id:s.id,changes:{items:p},saveFlags:SaveFlag.None})}}if(g.ref||g.isRoot||g.del||(log(m,": Item exists locally but is not referenced by a parent"),d(m)),g.ref&&g.del){log(m,": Item is referenced locally by a parent but has been deleted");var s=f.getItem(g.ref),p=s.items;p?p.remove(m):p=[],f.dbUpdateItem({id:s.id,changes:{items:p},saveFlags:SaveFlag.None})}if(g.isRoot&&g.ref&&(log(m,": Local root has a parent"),n=!0),g.del&&!g.ref){var s=f.getItem(m);e.isLocalItem(s)&&(log("Deleting Unreferenced Local Item: ",m),f.dbDeleteItem(m))}}t({error:n,local:i})})},f.removeDeletedItems=function(e){for(var t in f.itemsById){var n=f.getItem(t);n&&n.isDeleted&&(e[t]||(log("Deleting Removed Local Item: ",t),f.dbDeleteItem(t)))}},f.clearData=function(t,n){f.freezeUpdates=!0,setTimeout(function(){function i(){f.clearContacts(),e.settings.resetAll(n),t&&t()}function o(){f.dbi.items&&f.dbi.items.clear().done(function(){i()}).fail(function(){log("Failed to reset items!",arguments),i()})}return e.pageDataCleared(),f.dbi?void(f.dbi.settings&&f.dbi.settings.clear().done(function(){o()}).fail(function(){log("Failed to reset settings!",arguments),o()})):void f.initializeIndexedDB(function(){f.clearData(t,n)})},0)},f.contactComparator=function(e,t){return e.text.localeCompare(t.text)},f.contactEmailComparator=function(e,t){return e.address==t.address},f.contactPhoneComparator=function(e,t){return e.number==t.number},f.sortContacts=function(){f.contacts.sort(f.contactComparator)},f.addContact=function(e,t){var n=f.contactsByName[e.text];n?(e.emails&&(n.emails||(n.emails=[]),n.emails.pushOnlyUniques(e.emails,f.contactEmailComparator)),e.phoneNumbers&&(n.phoneNumbers||(n.phoneNumbers=[]),n.phoneNumbers.pushOnlyUniques(e.phoneNumbers,f.contactPhoneComparator))):(t?f.contacts.insertSorted(e,f.contactComparator):f.contacts.push(e),e.text&&(f.contactNames[e.text]="",f.contactsByName[e.text]=e),f.contactNames.___info___.count=f.contacts.length)},f.updateContact=function(e,t){for(var n=!1,i=0;i<f.contacts.length;++i)if(f.contacts[i].id===e.id){f.contacts[i].text=e.text,f.contacts[i].emails=f.contacts[i].phoneNumbers=void 0,f.addContact(e,t),n=!0;break}return n?void 0:(f.addContact(e),!0)};var S=!1;f.clearLocalContacts=function(){if(S=!1,e.shouldWriteLocal())try{t.storage.setItem(h,"[]")}catch(n){e.reportError(n)}f.contacts=[],e.settings.set(Settings.lastContactSync,void 0)},f.loadLocalContacts=function(){if(!S&&(S=!0,e.shouldWriteLocal()))try{f.loadContacts(JSON.parse(t.storage.getItem(h)),!1)}catch(n){e.reportError(n)}},f.loadContacts=function(e,t){if(f.contacts=e,f.contacts){for(var n=!1,i=0;i<f.contacts.length;i++){var o=f.contacts[i];o.name&&(o.text=o.name,f.contacts[i].text=o.name,delete f.contacts[i].name,n=!0),!t&&o.isDemo||o.text&&!o.phoneNumbers&&!o.emails?(f.contacts.removeAt(i--),n=!0):o.text&&(f.contactNames[o.text]="",f.contactsByName[o.text]=o)}n&&f.saveContacts(),f.contactNames.___info___.count=f.contacts.length}else f.contacts=[],f.contactsByName={},f.contactNames=p;log("Contacts Loaded: ",f.numContacts())},f.saveContacts=function(){e.shouldWriteLocal()&&t.storage.setItem(h,JSON.stringify(f.contacts))},f.clearContacts=function(){e.settings.reset(Settings.lastContactSync),e.shouldWriteLocal()&&t.storage.removeItem(h,void 0)},f.contactRelevanceComparator=function(e,t){return e.index!=t.index?e.index<t.index?-1:1:e.object.text.localeCompare(t.object.text)},f.findContactsLike=function(e){for(var t=e.toLowerCase(),n=[],i=r.mobile?25:35,o=0;o<f.contacts.length;++o){var a=f.contacts[o].text.toLowerCase().indexOf(t);if(a>=0&&(n.push({index:a,object:f.contacts[o]}),n.length>=i))break}return n.sort(f.contactRelevanceComparator),n},f.findContactsExact=function(e){return f.contactsByName[e]},f.findContactByEmail=function(e){for(var t=0;t<f.contacts.length;++t){var n=f.contacts[t];if(n.emails)for(var i=0;i<n.emails.length;++i)if(n.emails[i].address==e)return n}},f.getContacts=function(){return f.contactNames},f.numContacts=function(){return f.contacts.length},f.areLocalContactsLoaded=function(){return S},f.insertItems=function(e,t,i){e.save({items:e.getItemsArrayForSave()},SaveFlag.Prop),1===t.length?n.itemAdded({item:e,addedItem:t[0],index:i,isArchived:!1}):n.itemsAdded({item:e,addedItems:t,index:i,isArchived:!1})},f.removeItem=function(e,t,i,o){e.save({items:e.getItemsArrayForSave()},SaveFlag.Prop),i&&i.data&&n.itemRemoved({item:e,index:t,numToRemove:1,isArchived:o})},f.moveItem=function(e){var t=e.item,i=e.newInfo,o=e.oldParent,r=e.oldInfo,a=e.isRemoteChange,s=e.noVersion,d=a?SaveFlag.None:SaveFlag.Prop;o.save({items:o.getItemsArrayForSave()},d),t.parent().save({items:t.parent().getItemsArrayForSave()},d),r.isArchived!==i.isArchived&&(t.isArchived(i.isArchived),t.save({isArchived:i.isArchived},d)),a||(f.saveChanges(t,{},d),n.itemMoved({item:t,newInfo:i,oldParent:o,oldInfo:r,noVersion:s}))},f.archiveItem=function(e,t,i){c(e,i,!0),i.data&&n.itemArchived(e,i,t)},f.unarchiveItem=function(e,t,i){c(e,i,!1),i.data&&n.itemUnarchived(e,i,t,e.items().length-1)},f.modifyItemId=function(t,n,i){var o=f.getItem(t),r=f.getModel(t);if(o.id=n,r.id=n,f.pendingRemoteUpdates[t]&&(f.pendingRemoteUpdates[t]=void 0,f.pendingRemoteUpdates[n]=!0),o.version=-1,o.versionText=-1,"root"===t)for(var a=o.items.length-1;a>=0;a--){var s=f.getItem(o.items[a]);!e.isLocalItem(s)||s.modifiedOffline||s.modifiedOfflineText||(o.items.removeAt(a),r.items().removeAt(a))}f.itemsById[n]={data:o,model:f.itemsById[t].model},f.dbDeleteItem(t),f.dbUpdateItem({changes:o,callback:i,skipLocalModification:!0,saveFlags:SaveFlag.None}),f.itemsById[t]=void 0,delete f.itemsById[t]},f.deleteItem=function(e){var t=f.getItem(e.id);t&&(e.isDeleted=!0,f.dbUpdateItem({id:e.id,changes:{isDeleted:!0},saveFlags:SaveFlag.Prop}))},f.undeleteItem=function(e){var t=f.getItem(e.id);t&&(e.isDeleted=!1,f.dbUpdateItem({id:e.id,changes:{isDeleted:void 0},saveFlags:SaveFlag.Prop}))},f.saveChanges=function(e,t,n){return e?(t||(t={}),void f.dbUpdateItem({id:e.id,changes:t,saveFlags:n})):void log("Incoming item to save has no item!",e,t)},f.addPendingUpdate=function(e){f.pendingRemoteUpdates[e]||(f.pendingRemoteUpdates[e]=!0)},f.clearPendingUpdates=function(){for(var e in f.pendingRemoteUpdates){var t=f.getModel(e),i=f.getItem(e);if(i&&i.isDeleted)f.dbDeleteItem(e);else if(t&&t.data){var o={modifiedOffline:!1,modifiedOfflineText:!1};t.modifiedOffline=!1,t.modifiedOfflineText=!1;var r=n.getVersion(t.data,VersionType.Structure),a=n.getVersion(t.data,VersionType.Text);r!=t.getVersion(VersionType.Structure)&&(o.version=r,t.setVersion(VersionType.Structure,r)),a!=t.getVersion(VersionType.Text)&&(o.versionText=a,t.setVersion(VersionType.Text,a)),f.dbUpdateItem({id:e,changes:o,saveFlags:SaveFlag.None})}}f.pendingRemoteUpdates={},f.printIndexedDB("id","text","version","versionText","modifiedOffline","isArchived")};var T={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"},w={'"':'\\"'};return f.toHtml=function(e,t){var n="<ul>";if(e.items)for(var i=0;i<e.items.length;i++){var o=f.getItem(e.items[i]),r=f.getModel(o.id),a=String(r.getParsedText()).replace(/[&\"<>]/g,function(e){return T[e]});(!o.isArchived||o.isArchived&&t)&&(n+="<li>"+a,o.items&&o.items.length>0&&(n+=f.toHtml(o)),n+="</li>")}return n+="</ul>"},f.toPlainText=function(e,t,n){isNaN(t)&&(t=0);var i="";if(e.items)for(var o=0;o<e.items.length;o++){var r=f.getItem(e.items[o]),a=f.getModel(r.id);if(!r.isArchived||r.isArchived&&n){for(var s=0;t>s;s++)i+="	";i+=a.getParsedText()+"\n",r.items&&r.items.length>0&&(i+=f.toPlainText(r,t+1))}}return i},f.toJSON=function(t,i,o){var r=u(t,i,o);return'{"moodoVer":'+(e.settings.get(Settings.localDataVersion)||n.currentVersion())+',"moodoRoot":'+r+"}"},f.ensureLocalCache=function(t){var n=f.getRootItem();if(n)f.loadedItemCount>1&&(f.hasLocalData=!0),t();else{{var i=f.hasLocalData;e.generateTempId()}f.dbUpdateItem({changes:{id:"root",text:"Home",items:[]},skipLocalModification:!0,saveFlags:SaveFlag.None,callback:function(){f.setRoot("root"),f.hasLocalData=i,t()}})}},f.printIndexedDB=function(){},f}),define("goog",["ko","data","globals","util","gdata","platform"],function(e,t,n,i,o,r){function a(){var e=void 0;if(!window.gapi||!window.gapi.auth)return void 0;try{var t=gapi.auth.getToken();t&&(e=t.access_token)}catch(n){M.recoverFromError(n)}return e}function s(){n.messageQueue.pushMessage({text:"There was an internal error in Google Drive. Please refresh to try again.",type:MessageType.Error,action:MessageAction.Reload}),n.vmMain.setGDriveStatus(DriveStatus.Offline)}function d(e){n.vmMain.setGDriveStatus(DriveStatus.Connecting),gapi.client.load("drive","v2",function(){if(!gapi.client.drive)return void s();var t="(title='"+M.LEGACY_DefaultDriveDocTitle+"' or properties has {key='"+M.DefaultProperty+"' and value='"+M.DefaultPropertyValue+"' and visibility='PRIVATE'}) and 'me' in owners and trashed=false";gapi.client.drive.files.list({fields:k,q:t}).execute(function(t){t&&t.items?e(t.items[0],!1):t&&200!==t.code&&t.error?s():c(e)})})}function c(e){gapi.client.load("drive","v2",function(){gapi.client.drive.files.insert({resource:{mimeType:M.REALTIME_MIMETYPE,title:M.DefaultDocTitle,writersCanShare:!1,properties:[{key:M.DefaultProperty,value:M.DefaultPropertyValue,visibility:"PRIVATE"}]}}).execute(function(t){if(200!==t.code&&t.error)s();else{var o=i.getURLParam("file");if(o)try{i.removeURLParam("file"),gapi.drive.realtime.load(o,h,u,p)}catch(r){n.reportError(r)}else e(t,!0)}})})}function l(e){if(log("First Run Drive Document"),u(e),M.authenticatedUserEmail())n.sendEvent("Subscribe","NewUser"),n.reportSignup(M.authenticatedUserEmail(),M.authenticatedUser());else var t=M.authenticatedUserEmail.subscribe(function(e){t.dispose(),t=void 0,n.sendEvent("Subscribe","NewUser"),n.reportSignup(e,M.authenticatedUser())})}function u(e){if(log("Drive Document Initialized"),o.onInitialized(e),M.authenticatedUserEmail())n.sendEvent("Documents","CreateNew");else var t=M.authenticatedUserEmail.subscribe(function(){t.dispose(),t=void 0,n.sendEvent("Documents","CreateNew")})}function h(e){n.vmMain.setGDriveStatus(DriveStatus.Saved);var t=o.onLoad(e);t&&(o.onRemoteSettingsLoad(),M.startWatchdog(),M.isLoaded=!0,n.fireCustomEvent("docLoaded"))}function p(e){switch(ShouldLog(LogLevels.Error)&&log("Doc Load Error - ",JSON.stringify(e)),e.type){case gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED:M.recoverFromError();break;case gapi.drive.realtime.ErrorType.INVALID_COMPOUND_OPERATION:ShouldLog(LogLevels.Error)&&log("RealtimeAPI Error: ["+e.type+"] Fatal: "+e.isFatal),n.reportError(new Error("Invalid Compound Operation: "+n.safeStringify(e)));break;case gapi.drive.realtime.ErrorType.CONCURRENT_CREATION:case gapi.drive.realtime.ErrorType.CLIENT_ERROR:ShouldLog(LogLevels.Error)&&log("RealtimeAPI Error: ["+e.type+"] Fatal: "+e.isFatal),n.reportError(new Error("Client Error: "+n.safeStringify(e))),M.clearDocInfo(),m();break;case gapi.drive.realtime.ErrorType.FORBIDDEN:case gapi.drive.realtime.ErrorType.NOT_FOUND:ShouldLog(LogLevels.Error)&&log("Unable to access or find the requested document"),n.reportError(new Error("DocError Forbidden/NotFound: "+n.safeStringify(e))),r.app?n.reload():t.clearData(function(){n.reload()});break;case gapi.drive.realtime.ErrorType.SERVER_ERROR:n.vmMain.setGDriveStatus(DriveStatus.Offline);break;default:ShouldLog(LogLevels.Error)&&log("Unkown Doc Error - ",n.safeStringify(e)),n.reportError(new Error("Unknown Doc Error: "+n.safeStringify(e)))}e.isFatal&&o.close(e)}function f(e){var t=M.getDocId();if(t)try{var n=e?l:u;gapi.drive.realtime.load(t,h,n,p)}catch(i){M.recoverFromError(i)}else m()}function m(){d(function(e,t){e&&e.id?(M.setDocInfo(e.id,e.title),f(t)):n.reportError(new Error("We should always find a valid document with a defined id")),t&&n.fireCustomEvent("firstRun")})}function g(){for(var e=[],t=0;t<E.length;++t){var i=M.scopes.indexOf(E[t]),o=I.indexOf(E[t])>=0;i>=0&&!o&&e.push(i)}var r=JSON.stringify(e);n.settings.set(Settings.authScopes,r)}function v(e){e>0&&n.vmMain.runParseWorkerNewContacts()}function y(e){return parseInt(e.id.split("_")[1])}function b(t,i){if(t&&!t.error){n.isString(t.scope)&&(t.scope=t.scope.split(" "));var r=E,a=e.utils.arrayGetDistinctValues(t.scope);
E=a,(r.length!==a.length||r!==a)&&g();var s=1e3*(parseInt(t.expires_in)-600);log("Token expires in",s/1e3),A=Date.now()+s,clearTimeout(O),O=setTimeout(function(){S()},s),_=C,o.poke(),setTimeout(function(){for(var e=document.getElementsByTagName("iframe"),t=0;t<e.length;++t)if(e[t].src.startsWith("https://accounts.google.com/o/oauth2/auth?"))if(""===e[t].id)e[t].id="auth_"+F++;else{var n=y(e[t]);n!==F&&n!==F-1&&e[t].parentElement.removeChild(e[t])}},0)}else log("Error authorizing token"+(t?t.error:""));i&&i(t)}function S(e){if(!gapi||!gapi.auth||!gapi.auth.authorize)return e(void 0),!1;R=!0;var t=M.authenticatedUserEmail()||n.settings.get("activeUser"),i={client_id:M.CLIENT_ID,scope:E,immediate:!0,user_id:t};return gapi.auth.authorize(i,function(t){V=!0,R=!1,b(t,e)}),!0}function T(){if(M.isRealtimeAPILoaded())q=!1;else{var e=document.getElementById("gapiScript");e&&e.parentNode.removeChild(e),n.addScript("https://apis.google.com/js/client.js?onload=GoogleApiLoaded","gapiScript",function(){q=!1}),U-->0?setTimeout(T,B):q=!1}}function w(e){V?(n.vmMain.setGDriveStatus(DriveStatus.Saved),n.messageQueue.clearMessage(MessageID.ConnectionError),e()):(S(),setTimeout(function(){w(e)},B))}var M={CLIENT_ID:"597847337936.apps.googleusercontent.com",exportID:void 0,calendars:e.observable({}),eventSubscribers:[],authenticatedUserEmail:e.observable(void 0),authenticatedUser:e.observable(void 0),gapiLoaded:!1};n.goog=M;var C=1e4,x=16e4;M.APP_ID="597847337936",M.REALTIME_MIMETYPE="application/vnd.google-apps.drive-sdk",window.GScope={Calendar:"https://www.googleapis.com/auth/calendar",CalendarRO:"https://www.googleapis.com/auth/calendar.readonly",Contacts:"https://www.googleapis.com/auth/contacts.readonly",Drive:"https://www.googleapis.com/auth/drive.file",UserInfoEmail:"https://www.googleapis.com/auth/userinfo.email",DriveFull:"https://www.googleapis.com/auth/drive",TasksRO:"https://www.googleapis.com/auth/tasks.readonly",UserInfoProfile:"https://www.googleapis.com/auth/userinfo.profile",DriveInstall:"https://www.googleapis.com/auth/drive.install",DriveAppData:"https://www.googleapis.com/auth/drive.appdata"};var I=[GScope.TasksRO];M.LEGACY_DefaultDriveDocTitle="DuchessBeta",M.DefaultDocTitle="Moo.do Personal Document",M.DefaultProperty="MooDoDefault",M.DefaultPropertyValue="TRUE",M.requiredScopes=[GScope.Drive,GScope.UserInfoEmail,GScope.DriveInstall],M.requestScopes=[],M.scopes=[GScope.Calendar,GScope.CalendarRO,GScope.Contacts,GScope.Drive,GScope.UserInfoEmail,GScope.DriveFull,GScope.UserInfoProfile,GScope.DriveInstall,GScope.DriveAppData];var E=[],k="items(id,title)";M.isLoaded=!1,M.init=function(){var t=n.settings.get(Settings.authScopes);if(t){var o;try{o=JSON.parse(t)}catch(a){n.reportError(a)}if(o){for(var s=0;s<o.length;++s)o[s]>=0&&M.requestScopes.push(M.scopes[o[s]]);M.requestScopes=e.utils.arrayGetDistinctValues(M.requestScopes)}}else M.requestScopes=M.requiredScopes;E=M.requestScopes,r.syncContacts&&i.getURLParam("access_token")&&!i.hasURLParam("error")&&(E.indexOf(GScope.Contacts)<0&&(E.push(GScope.Contacts),g()),n.settings.set(Settings.syncContacts,!0));var d=M.authenticatedUserEmail.subscribe(function(e){void 0!==e&&(window.ga&&ga("set","&uid",n.getAnonUserIdentifier()),d.dispose(),d=void 0)})},M.ensureRequiredScopesAreRequested=function(){for(var e=!1,t=0;t<M.requiredScopes.length;++t)if(E.indexOf(M.requiredScopes[t])<0){e=!0;break}e&&M.runAuthenticate(M.requiredScopes,!0,!1,function(e){(!e||e.error)&&n.messageQueue.pushMessage({text:"We need additional permissions to give you the best experience, so please "+r.actionVerb()+" here to authenticate.",type:MessageType.Warning,action:function(){M.runAuthenticate(M.requiredScopes,!1,!1,function(e){(!e||e.error)&&n.messageQueue.pushMessage({text:"There was an error authenticating, so please "+r.actionVerb()+" here to try again.",type:MessageType.Error,action:M.ensureRequiredScopesAreRequested})})}})})};var D=96e4,P=void 0;M.startWatchdog=function(){P||(P=setInterval(M.watchdogFn,D))},M.stopWatchdog=function(){clearInterval(P),P=void 0};var L=0;M.watchdogFn=function(){var e=Date.now();if(L-e>=D){try{var t=gapi.auth.getToken();if(t){var i=1e3*parseInt(t.expires_at);e>i?(ShouldLog(LogLevels.Error)&&log("Active token is no longer valid: "+e+" vs. "+i),S(),n.reportError(new Error("Watchdog found expired token on client"))):o.poke()}else ShouldLog(LogLevels.Error)&&log("No active token on client!"),S(),n.reportError(new Error("Watchdog found client with no token set"))}catch(r){n.reportError(r)}finally{L=e}n.checkForRemoteChanges()}},M.hasPermission=function(e){return E.indexOf(e)>-1};var O=void 0,A=void 0,R=!0;M.onFocusHandler=function(){A&&Date.now()>A&&S()},M.onBlurHandler=function(){O&&clearTimeout(O)},M.getAccessToken=function(){var e=a();return e||M.recoverFromError(),e},M.getContactInfo=function(e,i){function o(e){if(200!==e.status)i();else{var t=JSON.parse(e.responseText);try{n.settings.set(Settings.lastContactSync,new Date(t.feed.updated.$t))}catch(o){n.reportError(o)}i(t)}}var r=M.getAccessToken();if(!r)return void i(void 0);var a=void 0,s="https://www.google.com/m8/feeds/contacts/default/full?v=3.0&alt=json";e?s+='&q="'+e+'"':a=n.settings.get(Settings.lastContactSync);var d=t.areLocalContactsLoaded()&&0===t.numContacts();if(a&&!d){var c=new Date(a);s+="&updated-min="+c.toString("yyyy-MM-ddTHH:mm:ss")}s+="&max-results=10000",s+="&access_token="+r,n.XHR({type:"GET",url:s,cb:o})},M.loadedContacts=!1,M.loadContacts=function(e){if(!M.loadedContacts){M.loadedContacts=!0,t.loadLocalContacts();var i=t.numContacts();M.getContactInfo(void 0,function(o){if(!o)return void e(-1);log("Loading Remote Contacts!",parseInt(o.feed.openSearch$totalResults.$t));var r=0,a=!1;if(o&&o.feed&&o.feed.entry&&o.feed.entry.length){n.vmMain.notifyContactsUpdated(),r=o.feed.entry.length;for(var s=o.feed.entry,d=0;d<s.length;d++){var c=s[d],l={id:/\/([^\s\/]+$)/gi.exec(c.id.$t)[1],text:""};if(c.gd$name&&c.gd$name.gd$fullName){var u=c.gd$name.gd$fullName.$t;l.text=u,"'"==l.text[0]&&(l.text=l.text.substr(1))}if(c.gd$email){var h=c.gd$email;l.emails=h;for(var p=0;p<h.length;p++)delete l.emails[p].rel,!l.text&&l.emails[p].primary&&(l.text=l.emails[p].address);!l.text&&h.length>0&&(l.text=l.emails[0].address)}if(c.gd$phoneNumber){var f=c.gd$phoneNumber;l.phoneNumbers=[];for(var p=0;p<f.length;p++){var m={number:f[p].$t};m.type=f[p].rel?f[p].rel.replace("http://schemas.google.com/g/2005#",""):f[p].label,l.phoneNumbers.push(m)}}if(l.text){if(c.link)for(var g=c.link,p=0;p<g.length;p++)if(g[p].type.startsWith("image")&&void 0!==g[p].gd$etag){var v=g[p].href;l.avatar=v}0===i?(t.addContact(l,!1),a=!0):a=t.updateContact(l,!1)||a}}}r>0&&t.saveContacts(),a&&t.sortContacts(),e&&e(r)})}},M.setDocInfo=function(e,t){n.settings.set(Settings.gdocId,e),n.settings.set(Settings.gdocTitle,t)},M.getDocId=function(){return n.settings.get(Settings.gdocId)},M.clearDocInfo=function(){n.settings.reset(Settings.gdocId),n.settings.reset(Settings.gdocTitle)};var _=C;M.recoverFromError=function(e){e&&(ShouldLog(LogLevels.Error)&&log("GDrive Error: ",e),n.reportError(e)),n.vmMain.setGDriveStatus(DriveStatus.Connecting),S(function(e){if(!e||e.error){n.messageQueue.pushMessage(MessageID.ConnectionError),n.vmMain.setGDriveStatus(DriveStatus.Offline);var t="Unable to refresh authentication token - ",i=!0;e?(t+=e.error,"immediate_failed"===e.error&&(i=!1)):t+="No Token",i&&n.reportError(new Error(t)),x>_&&(setTimeout(M.recoverFromError,_),_*=2)}})},M.getActiveUser=function(e){if(M.getAccessToken())if(M.authenticatedUserEmail())e&&e(M.authenticatedUserEmail());else{var t="https://www.googleapis.com/oauth2/v2/userinfo?alt=json&access_token="+M.getAccessToken();n.XHR({type:"GET",url:t,cb:function(t){if(200===t.status){var n=JSON.parse(t.responseText);M.authenticatedUser(n.name),M.authenticatedUserEmail(n.email)}e&&e(M.authenticatedUserEmail())}})}else e&&e(M.authenticatedUserEmail())};var N=!1;M.loadClientDefaultFile=function(){var e=!!n.vmMain,i=!!window.gapi&&!!window.gapi.drive&&!!window.gapi.drive.realtime;if(!N&&e&&i){var o=a();if(o&&n.getLoginState()==LoginState.LOGGED_IN)return n.checkpoint(Checkpoint.LoadDefaultFile),N=!0,n.vmMain.setGDriveStatus(DriveStatus.Connecting),M.getActiveUser(function(e){var i=n.settings.get(Settings.activeUser);i&&e&&e!==i?t.clearData(function(){n.reload()}):!i&&e&&n.settings.set(Settings.activeUser,e)}),f(),M.loadCalendarAndContacts(),!0}return!1},M.reconnectToActiveDocument=function(){var e=!!n.vmMain,t=!!window.gapi&&!!window.gapi.drive&&!!window.gapi.drive.realtime,i=n.getLoginState()==LoginState.LOGGED_IN,r=a();e&&t&&i&&r&&!o.isConnected()&&!n.vmMain.isReconnecting()&&(n.vmMain.setGDriveStatus(DriveStatus.Reconnecting),n.isReconnected=!0,f())},M.authAndLoadContacts=function(e){n.settings.get(Settings.syncContacts)&&(E.indexOf(GScope.Contacts)<0?M.runAuthenticate([GScope.Contacts],!0,!0,function(t){!t||t.error?(E.push(GScope.Contacts),g(),n.messageQueue.pushMessage({text:"Contact sync is enabled but permissions have been lost. Please "+r.actionVerbCaps()+" here to find it again.",type:MessageType.Error,action:M.authAndLoadContacts}),e&&e(!1)):M.loadContacts(function(t){v(t),e&&t>0&&e(!0)})}):M.loadContacts(function(t){v(t),e&&t>0&&e(!0)}))},M.authDocSharing=function(){},M.loadCalendarAndContacts=function(){window.gapi&&M.authAndLoadContacts()},M.checkTokenInHash=function(){var e=!1;if(i.hasURLParam("access_token"))try{var t=i.getURLParam("scope"),o={access_token:i.getURLParam("access_token"),expires_in:i.getURLParam("expires_in"),scope:t.split("+")};gapi.auth.setToken(o),e=!0,i.removeURLParam("access_token",!0),i.removeURLParam("expires_in",!0),i.removeURLParam("scope",!0),i.removeURLParam("token_type",!0)}catch(r){n.reportError(r)}return e},M.runAuthenticate=function(e,t,o,a){if(!window.gapi||!window.gapi.auth)return a&&a(),!1;M.gapiLoaded||(n.fireCustomEvent("gapiLoaded"),M.gapiLoaded=!0);var s=void 0;try{s=gapi.auth.getToken()}catch(d){n.reportError(d)}var c;if(s){if(c=s.scope,!n.isArray(c)&&n.isString(c))try{c=s.scope.split(" ")}catch(d){n.reportError(d)}var l=0;if(s.scope)for(var u=0;u<e.length;++u)s.scope.indexOf(e[u])<0&&(c.push(e[u]),l++);else c=e,l=requiredScopes.length;0===l&&(c=[])}else c=e;if(c.length>0){c.indexOf(GScope.DriveFull)>=0&&c.remove(GScope.Drive);var h=M.authenticatedUserEmail()||n.settings.get("activeUser"),p={client_id:M.CLIENT_ID,scope:c,immediate:t,user_id:h,authuser:t?0:-1};r.requireCustomRedirect&&!t&&(p.redirect_uri=r.customRedirectString,r.customRedirectState&&(c.indexOf(GScope.Contacts)>=0&&(r.customRedirectState.syncContacts=!0),p.state=JSON.stringify(r.customRedirectState))),R=!0;gapi.auth.authorize(p,function(e){R=!1,(!e||e.error)&&t&&o?M.runAuthenticate(c,!1,!1,a):(e&&!e.error&&(r.app||i.hasURLParam("login","true"))&&(n.vmSetup?n.vmSetup.setLoginState(LoginState.LOGGED_IN):n.setLoginState(LoginState.LOGGED_IN),M.loadClientDefaultFile()),b(e,a))})}else ShouldLog(LogLevels.Error)&&log("Authorization request with no scopes: ",c),a&&a(s);return!0};var F=0,V=!1;M.isDriveAPILoaded=function(){return window.gapi&&window.gapi.client&&window.gapi.client.drive},M.isRealtimeAPILoaded=function(){return window.gapi&&window.gapi.client&&window.gapi.drive&&window.gapi.drive.realtime};var B=1e4,U=0,q=!1;return M.goOnline=function(e){return U=2,M.isRealtimeAPILoaded()?(V=!1,setTimeout(function(){w(e)},2e3),!0):(q||(q=!0,setTimeout(T,2e3)),!1)},M.ensureDocConnection=function(){M.isRealtimeAPILoaded()?w(function(){N?o.isConnected()||M.reconnectToActiveDocument():M.loadClientDefaultFile()}):M.goOnline()},M.init(),M}),define("android",["ko","globals","platform"],function(e,t,n){function i(e){f.setBoxValue(e)}function o(e){var t=new RegExp(S,"g");return e.replace(t,"")}var r,a,s,d,c,l,u,h,p,f={},m=!1,g=!1,v=!0,y=!1,b=2,S="​",T=!1;f.isEnabled=function(){return T},f.getCurrentVMLI=function(){return c},f.isCurrentVMLI=function(e){return c===e},f.isVisible=function(){return C},f.getCurrentSpan=function(){return c?c.getSpan():void 0},f.isTargetBox=function(e){return d===(e.target||e.srcElement)},f.getInputBox=function(){return d},f.getSelectionStart=function(){return d.selectionStart<b?0:d.selectionStart-b},f.getSelectionEnd=function(){return d.selectionEnd<b?0:d.selectionEnd-b},f.setSelection=function(e,t){d.selectionStart=e+b,d.selectionEnd=t+b},f.setPaneRoot=function(e){function i(){d.selectionStart<b&&(d.selectionStart=b),d.selectionEnd<b&&(d.selectionEnd=b)}return void 0===e.rootElement?void(T=!1):(T=!0,void(e.rootElement!==r&&(r=e.rootElement,a=e.scrollElement,s=e.paneContent,n.mobileie&&s.removeAttribute("contenteditable"),d=document.createElement("textarea"),d.id="androidInput",d.style.visibility="hidden",r.appendChild(d),d.addEventListener("focus",function(e){t.dragging||t.isKeyboardOpen||t.keyboardToolbar.show(!1)}),n.mobileie||d.addEventListener("blur",function(e){e.relatedTarget&&"searchPhone"!==e.relatedTarget.id||(f.finishInput(),t.keyboardToolbar.hide())}),d.addEventListener("input",function(e){if(c){if(u=u||require("edit"),g){if(g=!1,p=p||require("copypaste"),document.createEvent){var t=document.createEvent("Event");t.synthetic=!0,t.data={types:["text/plain"],getData:function(){return f.getBoxValue()}},t.initEvent("paste",!0,!0),f.setSelection(0,f.getBoxValue().length),d.dispatchEvent(t)}}else{var n=!f.getBoxHasTextSpace();n?(h=h||require("tracker"),h.beginAction(),u.handleBackspace(e,c.getSpan(),void 0),h.endAction()):f.handleChacterTyped(e)}f.ensureLinePadding(),u.updateAutocomplete(e)}}),n.ie||(d.ontouchend=function(){setTimeout(i,30)}),m=null!==d.selectionStart&&void 0!==d.selectionStart&&null!==d.selectionEnd&&void 0!==d.selectionEnd,log("---- Android Editing Enabled ----"))))},f.notifyStarred=function(e){y!==e&&(y=e,y?t.addClass(d,"pStar"):t.removeClass(d,"pStar"))},f.handleChacterTyped=function(){var e=f.getSelectionStart(),t=f.getSelectionEnd();if(e===t)if(1===e){if(v){var n=f.getBoxValue();if(1===n.length){var i=n.toUpperCase();f.setBoxValue(i)}}}else 0===e&&(v=!1);u=u||require("edit"),u.scrollTextIntoView()};var w=void 0,M=!1,C=!1;f.updateInput=function(e,i){w&&(clearTimeout(w),w=void 0);var o=void 0,a=t.getSelectionRange();void 0===i&&a&&a.startContainer.nodeType===Node.TEXT_NODE&&(o=t.getSelectOffsetsInSpan(e,e.getSpan(),a,!0)),n.mobileie&&(o={start:e.getParsedText().length,end:e.getParsedText().length});var s=!1;C||(C=!0,s=!0,d.style.visibility="visible",(null===d.parentElement||void 0===d.parentElement)&&r.appendChild(d)),t.isKeyboardOpen||t.keyboardToolbar.show();var u=e!==c;if((u||e&&e.isHeader()!==M)&&(c&&u&&f.finishInput(!0),l=c,c=e,M=e.isHeader(),f.notifyStarred(e.isStarred()),f.updateInputText(e),f.updateInputBounds(e)),s&&d.focus(),m)try{var h,p;if(void 0!==o)d.selectionStart=h=o.start+1,d.selectionEnd=p=o.end+1;else if(void 0!==i)d.selectionStart=h=i+1,d.selectionEnd=p=i+1;else{var g=0;if(c&&c.getParsedText()){var v=c.getParsedText().length;g=v}d.selectionStart=h=g+1,d.selectionEnd=p=g+1}d.selectionStart=h+b,d.selectionEnd=p+b}catch(y){if(t.reportError(y),d.setSelectionRange)if(void 0!==o)d.setSelectionRange(o.start+b,o.end+b);else if(void 0!==i)d.setSelectionRange(i+b,i+b);else{var g=0;if(c&&c.getParsedText()){var v=c.getParsedText().length;g=v+b}d.setSelectionRange(g,g)}}},f.updateInputText=function(e){if(e&&c&&e.id===c.id){var t=c.getParsedText();v=0===t.length,f.setBoxValue(t)}},f.insertText=function(e,n){var i=f.getBoxValue(),o=i.substr(0,e)+n+i.substr(e);f.setBoxValue(o),m&&(d.selectionStart=e+n.length+b,d.selectionEnd=e+n.length+b,t.autocomplete&&t.autocomplete.update({item:c,start:f.getSelectionStart(),fromArrows:!1}))},f.getInputText=function(){return c?f.getBoxValue():""};var x=0;return f.updateInputBounds=function(e){if(e&&c&&e.id===c.id){var i=e.getSpan();if(i){var o=i.getBoundingClientRect(),r=8,s=n.orientation===Orientation.Portrait?t.topBarHeight:0,l=a.scrollTop;t.copyStyles(i,d,["paddingLeft","paddingTop","paddingRight","paddingBottom","width","height","fontSize","lineHeight"]),d.style.top=Math.ceil(o.top+l-s)+"px",d.style.marginLeft=r+"px",d.style.paddingLeft=parseInt(d.style.paddingLeft)-r+"px",x=d.scrollHeight}}},f.checkAndroidBounds=function(){var e=d.scrollHeight;if(e!==x){var t=f.getBoxValue();if(T=!1,c){c.getRawText()!==t&&c.setText(t,!0,!0);var n=window.getComputedStyle(c.getSpan());d.style.height=n?n.height:"16px"}T=!0,x=e}},f.flushInput=function(){var e=f.getBoxValue();c&&c.getRawText()!==e&&c.setText(e,!0,!0)},f.finishInput=function(e){c&&(C&&!e&&(C=!1,d.style.visibility="hidden",t.blurActiveElement()),f.flushInput(),l=c,c=void 0)},f.handlePaste=function(){g=!0},f.ensureLinePadding=function(){var e=d.value;if(e.length<b)return i(e),!1;for(var t=0;b>t;++t)if(e[t]!==S)return i(e),!1;return!0},f.getBoxHasTextSpace=function(){var e=d.value;if(e.length<b)return!1;for(var t=0,n=0;n<e.length&&b>t;++n)e[n]===S&&t++;return t===b},f.getBoxValue=function(){var e=d.value,t=o(e);return t},f.setBoxValue=function(e){e||(e="");for(var t="",n=0;b>n;++n)t+=S;t+=o(e),d.value=t},f.passKeypress=function(e){return c&&(e.normCode===KeyCode.Enter||e.synthetic)?!0:!1},f.passKeydown=function(e){return c&&(e.normCode===KeyCode.Tab||e.synthetic)?!0:!1},f}),define("VMLI_TapHandlers",["ko","globals","platform","android","tracker"],function(e,t,n,i){var o=18,r=36,a=void 0,s={dragStart:function(e){t.tempUL||(t.tempUL=document.getElementById("tempUL")),t.clearSelection(),i.isEnabled()&&i.finishInput();var o=t.startDrag.getElement();t.startDrag=void 0,t.draggingHidden=o,t.dragging=o.cloneNode(!0),t.tempUL.appendChild(t.dragging);var r=t.offset(o),a=t.width(o),s=r.left-1,d=r.top-1;window.__IS_DEMO_VIDEO&&(s-=window.__DRAG_SCALE-1,d-=window.__DRAG_SCALE-1),(n.mobile||n.ios)&&(d-=t.topBarHeight),t.dragStartInfo={x:e.eventX,y:e.eventY},t.tempUL.style.display="block",t.tempUL.style.left=s+"px",t.tempUL.style.top=d+"px",t.tempUL.style.width=a+"px",t.addClass(t.draggingHidden,"itemBeingDragged"),t.disableMouseMove=!0},dragMove:function(e){e.preventDefault();var i=n.mobile?0:e.eventX-t.dragStartInfo.x,o=e.eventY-t.dragStartInfo.y,r="translate3d("+i+"px, "+o+"px, 0)";window.__IS_DEMO_VIDEO&&(r+=" scale("+window.__DRAG_SCALE+")"),t.tempUL.style[n.transform.style]=r;var s=document.elementFromPoint(e.eventX,e.eventY);a||(a={dropEffect:"move",item:this}),t.vmMain.handleDragOver({srcElement:s,dataTransfer:a,diffY:e.diffY,offsetY:e.eventY,preventDefault:t.emptyFn,stopPropagation:t.emptyFn,stopImmediatePropagation:t.emptyFn})},dragEnd:function(e){n.ios&&t.preventClick(),t.disableMouseMove=!1;var i=t.dragging,o=t.draggingHidden;t.dragging=void 0,t.draggingHidden=void 0,t.removeClass(o,"itemBeingDragged"),i.parentNode.removeChild(i),t.tempUL.style.display="none",a||(a={dropEffect:"move",item:this}),t.vmMain.handleDrop({srcElement:e.srcElement,dataTransfer:a,preventDefault:t.emptyFn,stopPropagation:t.emptyFn,stopImmediatePropagation:t.emptyFn}),a=void 0,n.ios&&t.preventClick(),t.disableMouseMove=!1},onStart:function(e){t.dragStartTimeout&&(clearTimeout(t.dragStartTimeout),t.dragStartTimeout=void 0),t.scrollAtTouchStart=t.focusedPane.getScrollOffset(),t.canRevealMenu=!0,t.isKeyboardOpen&&(t.revealTimeout=setTimeout(function(){t.canRevealMenu=!1},400)),!n.mobile||n.ie||"UL"===e.srcElement.tagName||t.isKeyboardOpen||t.focusedPane.isTimeline()?"SPAN"===e.srcElement.tagName&&e.offsetX<=o&&(t.clearSelection(),t.startDrag=this,e.preventDefault(),e.stopImmediatePropagation()):t.dragStartTimeout=setTimeout(function(){t.clearSelection(),t.startDrag=this,this.dragStart(e),this.dragMove(e)}.bind(this),500)},onMove:function(e,i){t.revealTimeout&&(clearTimeout(t.revealTimeout),t.revealTimeout=void 0),this.isItemMenuOpen?e.preventDefault():t.startDrag&&(!n.touch||Math.abs(e.distanceY)>t.ClickThreshold&&Math.abs(e.distanceX)<t.ClickThreshold)&&t.startDrag===this&&this.dragStart(e),t.dragging?this.dragMove(e):n.touch&&t.canRevealMenu&&!t.focusedPane.isTimeline()&&(t.revealingMenu||e.distanceY<t.ClickThreshold&&Math.abs(e.diffX)>t.ClickThreshold)&&((!i||t.phoneMenu.multiSelectMode())&&(t.revealingMenu||t.menus.revealGestureMenu(this,e),t.menus.updateRevealGestureMenu(e)),e.preventDefault())},onClick:function(e){if(n.mobile&&t.phoneMenu.multiSelectMode())t.menus.multiSelect(this);else if("SPAN"===e.srcElement.tagName&&e.offsetX<=o)this.isComplete(!this.isComplete());else if("LI"===e.srcElement.tagName&&this.isCollapsed()&&e.offsetX>=t.focusedPane.getWidth()-r)this.toggleCollapsed();else if(t.hasClass(e.srcElement,"tag")&&!n.mobile){if(n.mac&&e.metaKey||!n.mac&&e.ctrlKey){var a=e.srcElement.textContent;e.shiftKey?t.focusedPane.vmSearch.setSearch(a):t.focusedPane.vmSearch.addToSearch(a)}}else if(t.hasClass(e.srcElement,"contact")&&!i.isEnabled()){if(!n.mobile||!t.isKeyboardOpen){var s=t.getOffsetOfSubNode(this.getSpan(),e.srcElement);t.autocomplete.update({item:this,start:s+1}),t.autocomplete.show(this,e.srcElement),e.preventDefault(),n.ios&&t.preventClick()}}else if("A"===e.srcElement.tagName)(n.mac&&e.metaKey||!n.mac&&e.ctrlKey||n.app)&&t.openUrl(e.srcElement.href,e);else{if(t.autocomplete&&t.autocomplete.hide(),n.ios||n.android||n.mobileie){var d=document.activeElement,c=t.focusedPane.getScrollOffset(),l=Math.abs(c-t.scrollAtTouchStart)>0;if(t.isKeyboardOpen&&d&&"searchPhone"!=d.id||l||t.focusedPane.isTimeline())n.mobileie&&i.isEnabled()&&!t.focusedPane.isTimeline()&&(i.updateInput(this),e.preventDefault(),e.stopPropagation());else{var u=this;n.mobile&&this==t.focusedPane.item()&&(u=t.getLastVisibleItem(t.focusedPane.item())),n.ios&&t.vmMain.setSelected([u]),t.openKeyboardOn(e,u.getSpan(),!0,!1,function(){if(i.isEnabled()){if(i.updateInput(u),t.hasClass(e.srcElement,"contact")){var n=t.getOffsetOfSubNode(this.getSpan(),e.srcElement);t.autocomplete.update({item:this,start:n+1}),t.autocomplete.show(this,e.srcElement),e.preventDefault()}}else t.selectChildren(u,u.getParsedText().length,0)}.bind(this))}}else!n.mobile;if(t.focusedPane.isTimeline()&&t.hasClass(e.srcElement,"text")){for(var h=0;h<this.elements.length;++h){var p=(this.getSpan(h),t.vmMain.panes()[h]);p&&p.vmSearch.isVisible(this)&&t.scrollIntoView(this.getSpan(h),200)}this.highlight(),t.sendEvent("Menu","GoTo")}}},onDblClick:function(e){if(t.hasClass(e.srcElement,"text")&&n.mobile){t.phoneMenu.toggleMode(),e.preventDefault();for(var i=0;i<this.elements.length;++i)t.scrollIntoView(this.getSpan(i),200);this.highlight(),t.sendEvent("PhoneMenu","GoTo")}},onEnd:function(e){t.dragStartTimeout&&(clearTimeout(t.dragStartTimeout),t.dragStartTimeout=void 0),t.startDrag=void 0,t.itemMenuOpenedOn==this&&t.menus.menuItemSelected(e.srcElement),(t.revealingMenu||t.phoneMenu&&t.phoneMenu.multiSelectMode())&&(e.preventDefault(),e.stopImmediatePropagation(),e.returnFalse=!0,n.ios&&t.preventClick()),t.revealingMenu&&t.menus.stopRevealGestureMenu(e);t.dragging&&this.dragEnd(e)},onRightClick:function(e){!e.stopPropagation||!e.preventDefault,t.menus.openItemMenu(this,e),e.preventDefault(),e.stopPropagation()},onAutocompleteTapped:function(e,n){if(i.isEnabled()){var o=i.getInputText(),r=o.substr(0,n.index)+e+o.substr(n.index+n.length);this.setText(r,!0),i.updateInputText(this);var a=n.index+e.length;i.setSelection(a,a)}else{var r=this.getParsedText().substr(0,n.index)+e+this.getParsedText().substr(n.index+n.length);this.setText(r,!0),t.selectChildren(this,n.index+e.length,0)}}};return s}),this.document&&(window.helperWrapper=DuchessHelpersWrapper),this.helperLibLoaded||DuchessHelpersWrapper(this.DuchessHelpers=this.DuchessHelpers||{}),define("DuchessHelpers",function(){}),define("VMLI_Text",["ko","data","gdata","globals","tracker","android","DuchessHelpers"],function(e,t,n,i,o,r){var a={_runAndGetSaveData:function(e,t){var n=this.getMetaTextSaveData();this.setRawText(e),this.parseText(t);var i=this.getMetaTextSaveData(),o={};for(var r in i)n[r]!==i[r]&&(o[r]=i[r]);return o},setText:function(e,t,i){var o=this._runAndGetSaveData(e,t);o.text=e,n.saveChanges(this,o),o.dateText=this.dateText,this.save(o,SaveFlag.Text),t&&!i&&r.isEnabled()&&r.updateInputText(this)},parseText:function(e){var n=void 0;e&&(n=DuchessHelpers.parseText(this.getRawText(),this.getDateTime(),this.isLoaded,t.getContacts()),n.numContacts>0&&o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.AddContact,data:[{itemID:this.id}]})),this.styleText(n,e)},styleText:function(e,t,n){var i,o=!1;if(e){if(i=void 0!==e.styledText?e.styledText:void 0!==e.text?e.text:this.getRawText(),t&&this.setParsedText(e.parsedText),e.dates){0===e.dates.length&&this.date()&&this.date()&&(this.allDayDate=void 0,this.dateText=void 0,this.date(null),n&&(o=!0,n.date=void 0,n.dateText=void 0,n.allDayDate=void 0));for(var r=0;r<e.dates.length;r++){var a=e.dates[r];this.dateText!==a.text&&(this.dateText=a.text,n&&(o=!0,n.dateText=a.text)),a.date&&this.date()&&a.date==this.date()||(!!a.date^!!this.date()||this.date()&&a.date.getTime()!==this.date().getTime())&&(a.explicitTime&&(a.date._explicitTime=a.explicitTime),this.allDayDate=!a.date._explicitTime,this.date(a.date),n&&(o=!0,n.date=a.date,n.allDayDate=a.date._explicitTime))}}else this.date()&&t&&(this.dateText=void 0,this.allDayDate=void 0,this.date(null),n&&(o=!0,n.date=void 0,n.dateText=void 0,n.allDayDate=void 0));this.isStyled=e.hasStyle}else i=this.getRawText();return 0===i.length&&(i=TextSpace,t=!0),this.setStyledText(i),o},checkFormats:function(e,t,n){return!1},toggleFormat:function(e,t){return!1},clearFormats:function(){return!1},areFormatsEqual:function(e,t){return!0},setFormats:function(e,t){return!1},appendFormats:function(e,t){return!1},getFormatsAfter:function(e){return!1},removeFormatsAfter:function(e){return!1},transformFormats:function(e,t){return!1},saveFormats:function(e){return!1}};return a}),define("VMLI_Drive",["globals","data","gdata","tracker"],function(e,t,n,i){var o=function(o){function r(e){n.cacheItem(e),a(n.get(e,"items")),a(n.get(e,"archivedItems"))}function a(e){if(e)for(var n=0;n<e.length;++n){var i=e.get(n);if(i){var o=t.getModel(i.id);o?o.linkToGDrive(i):r(i)}else e.remove(n),n--}}return{linkToGDrive:function(e,t){this.data||(this.data=e,n.cacheItem(e),this.setRemoteVersion(VersionType.Structure,n.getVersion(e,VersionType.Structure)),this.setRemoteVersion(VersionType.Text,n.getVersion(e,VersionType.Text)),t&&(this.setVersion(VersionType.Structure,this.getRemoteVersion(VersionType.Structure)),this.setVersion(VersionType.Text,this.getRemoteVersion(VersionType.Text))),a(n.get(e,"items")),a(n.get(e,"archivedItems")))},resetModified:function(){var e,t=!1,n={};if(!this.modifiedOffline&&this.isRemoteVersionNewer(VersionType.Structure)){var i=this.getRemoteVersion(VersionType.Structure);this.setVersion(VersionType.Structure,i),n.version=i,t=!0}else this.modifiedOffline&&(n.modifiedOffline=!1,t=!0);if(!this.modifiedOfflineText&&this.isRemoteVersionNewer(VersionType.Text)){var o=this.getRemoteVersion(VersionType.Text);this.setVersion(VersionType.Text,o),n.versionText=o,t=!0}else this.modifiedOfflineText&&(n.modifiedOfflineText=!1,t=!0);t&&this.save(n,SaveFlag.None),this.setRemoteVersion(VersionType.Structure,void 0),this.setRemoteVersion(VersionType.Text,void 0);var r=this.items();for(e=0;e<r.length;++e)r[e].resetModified();if(this.hasArchivedChildren()){var a=this.archivedItems(!0);for(e=0;e<a.length;++e)a[e].resetModified()}},initFromGDrive:function(t,i){if(!t)return void e.reportError(new Error("FATAL ERROR - No remote data for item"));this.data=t;var o=void 0===this.id||this.forceModifiedItems,r=o?void 0:{},a=!1;this.id=t.id,e.topLevelInitId||(e.topLevelInitId=this.id);try{a=this.resolveText(r)||a,a=this.resolveMisc(r)||a,a&&(e.vmMain.addParseItem(this,!0),e.vmMain.addModifiedItem(this)),this.resolveItems(r,i)}catch(s){e.reportError(s)}e.topLevelInitId===this.id&&(e.topLevelInitId=void 0),o?(this.setVersion(VersionType.Structure,this.getRemoteVersion(VersionType.Structure)),this.setVersion(VersionType.Text,this.getRemoteVersion(VersionType.Text)),this.save(null,SaveFlag.None)):e.isEmpty(r)||(r.isDeleted!==!0&&(r.isDeleted=void 0),this.save(r,SaveFlag.None)),n.attachEventsToItem(this)},resolveText:function(e){var t=!1;if(this.modifiedOfflineText&&!this.forceModifiedItems)if(this.isLocalVersionNewer(VersionType.Text))n.saveChanges(this,{text:this.getParsedText()});else{var i=n.get(this.data,"text"),r=this.getRawText(),a=!1;if(r!==i&&(a=!0),a){var s=this.getIndex(),d=new o({text:this.getParsedText()},{parent:this.parent(),forceSave:!0});this.parent().insertItem(d,s+1),this.setText(i,!0),e&&(e.text=this.getParsedText()),t=!0}else e&&(e.modifiedOfflineText=!1);e&&(e.versionText=this.getRemoteVersion(VersionType.Text))}else if(this.isRemoteVersionNewer(VersionType.Text)){var i=n.get(this.data,"text");this.getRawText()!=i&&(this.setRawText(i),e&&(e.text=this.getRawText()),t=!0),e&&this.getVersion(VersionType.Text)!==this.getRemoteVersion(VersionType.Text)&&(e.versionText=this.getRemoteVersion(VersionType.Text))}return t},resolveMisc:function(e){var t=this.modifiedOfflineText&&this.isLocalVersionNewer(VersionType.Text),i=!1,o=!1;if(t||this.isRemoteVersionNewer(VersionType.Structure)||this.isRemoteVersionNewer(VersionType.Text)){var r={},a=n.get(this.data,"allDayDate");a&&this.allDayDate!==a&&(t?(r.allDayDate=this.allDayDate,o=!0):(this.allDayDate=a,e&&(e.allDayDate=a)));var s=n.get(this.data,"date");(s||this.date())&&(this.date()&&this.date().getTime()===s||(t&&this.date()?(r.date=this.date().getTime(),o=!0):(this.date(new Date(s),!0),this.date()._explicitTime=!!this.allDayDate,e&&(e.date=this.date().getTime()),i=!0)));var d=n.get(this.data,"dateCreated");if(!this.dateCreated||!d||this.dateCreated.getTime()!==d)if(t)r.dateCreated=this.dateCreated?this.dateCreated.getTime():void 0,o=!0;else{var c=d;this.dateCreated=new Date(c),e&&(e.dateCreated=c)}var l=n.get(this.data,"dateCompleted");if(!(!l&&!this.dateCompleted||this.dateCompleted&&l&&this.dateCompleted.getTime()===l))if(t)r.dateCompleted=this.dateCompleted?this.dateCompleted.getTime():void 0,o=!0;else{var c=l;this.dateCompleted=new Date(c),e&&(e.dateCompleted=c)}var u=n.get(this.data,"priority");(u||this.priority())&&this.priority()!==u&&(t?(r.priority=this.priority(),o=!0):(null===u&&(u=VMLIFlag.None),this.priority(u,!0)));var h=n.get(this.data,"isStarred");(h||this.isStarred())&&this.isStarred()!==h&&(t?(r.isStarred=this.isStarred(),o=!0):(null===h&&(h=!1),this.isStarred(h,!0)));var p=n.get(this.data,"isComplete");(p||this.isComplete())&&this.isComplete()!==p&&(t?(r.isComplete=this.isComplete(),o=!0):(null===p&&(p=!1),this.isComplete(p,!0))),t&&o===!0&&n.saveChanges(this,r)}return i},resolveItemsHelper:function(i,r,a){var s,d,c,l,u,h,p,f=n.getItemList(this.data,i);for(p=i?this.hasArchivedChildren()?this.archivedItems(!0):[]:this.items(),s=0;f&&s<f.length;s++)if(d=f.get(s)){n.loadSeen[d.id]=this.id;var c=this.getIndexOf(d.id,i);if(c>=0)u=p[c],u.initFromGDrive(d);else if(l=t.getItem(d.id),u=t.getModel(d.id),l)if(l.isDeleted)if(n.getVersion(d,VersionType.Structure)==l.version){n.itemRemoved({item:this,index:s,numToRemove:1,isArchived:i});s--}else t.undeleteItem(l),u=new o({data:d,isArchived:i},{parent:this,parse:a,forceSave:!0}),p.splice(s,0,u),h=!0,e.vmMain.addModifiedItem(u);else u&&u.modifiedOffline?u.isLocalVersionNewer(VersionType.Structure)?n.loadSeen[d.id]=!1:(u.moveTo({parent:this,index:s,isRemoteChange:!0,shouldBeArchived:i}),u.initFromGDrive(d),h=!0,e.vmMain.addModifiedItem(u)):u?(u.moveTo({parent:this,index:s,isRemoteChange:!0,shouldBeArchived:i}),u.initFromGDrive(d),h=!0,e.vmMain.addModifiedItem(u)):e.reportError(new Error("Local model does not exist for local item that was not deleted."));else u=new o({data:d,isArchived:i},{parent:this,parse:a}),p.splice(s,0,u),h=!0,e.vmMain.addModifiedItem(u)}if(t.hasLocalData){for(s=0;s<p.length;s++)if(u=p[s],n.loadSeen[u.id]!==this.id)if(d=u.data){if(u.modifiedOffline&&u.isLocalVersionNewer(VersionType.Structure)){var m=n.findInTree(d);if(m){n.itemMoved({item:u,newInfo:{index:s,isArchived:i},oldParent:m.parent,oldInfo:m})}u.initFromGDrive(d)}}else if(u.modifiedOfflineText){var g,v=[];if(i?u.hasArchivedChildren()&&(g=u.archivedItems(!0)):g=u.items(),g)for(var y=0;y<g.length;++y)if(g[y].data&&g[y].isLocalVersionNewer(VersionType.Structure)){var m=n.findInTree(g[y].data);
m&&v.push({parent:m.parent,child:g[y]})}t.initializeItem(u),n.itemAdded({item:this,addedItem:u,index:s,isArchived:i});for(var y=0;y<v.length;++y){var b=v[y],S=b.child.isArchived(),T=n.getItemList(b.parent,S),w=T.indexOf(b.child.data);n.itemRemoved({item:b.parent,index:w,numToRemove:1,isArchived:S})}u.initFromGDrive(u.data)}else this.deleteChild(u),s--,h=!0,e.vmMain.addModifiedItem(u);if(!i&&f&&(f.length>0||p.length>0)){var M=[],C=void 0,x=[],I=f.asArray(),E=!1;for(s=0;s<I.length;++s){var k=I[s].id,D=t.getModel(k),c=this.getIndexOf(k);D&&D.modifiedOffline&&D.isLocalVersionNewer(VersionType.Structure)?c>=0?M.push(c):(C||(C=[]),log(this.id+": Item in remote array not found in local array: ",k),C.push(k)):c>=0?(x.push(k),c!==s&&(E=!0)):(C||(C=[]),log(this.id+": Item in remote array not found in local array: ",k),C.push(k))}if(E||M.length>0){for(M.sort(),s=0;s<M.length;s++){var l=p[M[s]];l&&x.splice(M[s],0,l.id)}C&&C.length>0&&(x=x.concat(C));for(s=0;s<x.length;++s)for(var P=x[s],y=s;y<f.length;++y){var L=f.get(y);if(P===L.id){if(s!==y){var O=t.getModel(L.id),A={index:y,isArchived:!1},R={index:s,isArchived:!1};n.itemMoved({item:O,newInfo:R,oldParent:this,oldInfo:A}),h=!0,e.vmMain.addModifiedItem(O)}break}}for(s=0;s<x.length;++s)for(var P=x[s],y=s;y<p.length;++y){var L=p[y];if(P===L.id){if(s!==y){L.moveTo({parent:this,index:s,isRemoteChange:!0,shouldBeArchived:!1}),h=!0,e.vmMain.addModifiedItem(L)}break}}}}}h&&(i?this.hasArchivedChildren()&&this.archivedItems().valueHasMutated():this.items.valueHasMutated(),i&&!this.hasArchivedChildren()&&this.archivedItems()(p),r&&(r.items=this.getItemsArrayForSave()))},resolveItems:function(e,t){this.resolveItemsHelper(!1,e,t),this.resolveItemsHelper(!0,e,t)},onValueChanged:function(t){if(!t.isLocal||i.undoRedoActive){var o=e.translateFieldOut(t.property);if(this.id===t.target.id)switch(o){case"version":case"versionText":var r=n.get(this.data,o);if(r>this[o]||void 0===this[o]){var a={modifiedOffline:!1};a[o]=this[o]=r,this.save(a,SaveFlag.None)}break;case"formats":var s=JSON.parse(JSON.stringify(n.get(this.data,"formats")));s||(s=[]),this.setFormats(s,!0);break;case"priority":this.priority(t.newValue,!0);break;case"isComplete":this.isComplete(t.newValue,!0);break;case"isStarred":this.isStarred(t.newValue,!0);break;case"dateCompleted":this.dateCompleted=new Date(t.newValue),this.save({dateCompleted:t.newValue},SaveFlag.None);break;case"isArchived":this.isArchived(t.newValue),this.save({isArchived:t.newValue},SaveFlag.None);break;case"date":this.date(new Date(t.newValue)),this.save({date:t.newValue},SaveFlag.None);break;case"allDayDate":this.allDayDate=t.newValue,this.save({allDayDate:t.newValue},SaveFlag.None);break;case"items":case"archivedItems":var d=!("items"===o);if(t.newValue){for(var c=0;c<t.newValue.length;++c)this.addRemoteItem(t.newValue.get(c),c,d);n.attachEventsToItem(this)}else this.removeAllRemoteItems(d);this.save({items:this.getItemsArrayForSave()},SaveFlag.None);break;case"dateCreated":break;case"text":this.onTextChanged(t);break;default:ShouldLog(LogLevels.Error)&&log("Unhandled value changed remotely: ",o,t)}}},onTextChanged:function(t){if(!t.isLocal||i.undoRedoActive){var o=n.get(this.data,"text");if(o!=this.getRawText()&&(this.setRawText(o),this.parseText(!0),this.save({text:this.getRawText()},SaveFlag.None),i.undoRedoActive)){var r=TrackerType.SetText;i.notifyStateChangedFromUndoRedo(r,{itemID:this.id,position:e.findFirstDiff(t.newValue,t.oldValue),text:t.newValue})}}},addRemoteItem:function(r,a,s){var d=r.id;n.cacheItem(r);var c=s?this.archivedItems():this.items;if(a<c().length&&c()[a].id===d)return void log("Skipping addRemoteItem - "+a+" vs. "+c().length);var l=t.getModel(d);l||(l=new o({data:r},{parent:this,parse:!0})),l.isDeleted&&(l.isDeleted=!1,l.save(null,SaveFlag.None)),l.isArchived()!==s&&(l.isArchived(s),l.save({isArchived:s},SaveFlag.None)),l.parent(this),c.splice(a,0,l),e.fireCustomEvent("itemAdded",{item:l,force:!0}),e.timeline.notifyStateChanged(l),i.undoRedoActive&&i.notifyStateChangedFromUndoRedo(TrackerType.Create,{itemID:l.id,parent:this.id,position:a,text:n.get(r,"text")})},removeAllRemoteItems:function(e){e?this.hasArchivedChildren()&&this.archivedItems()([]):this.items([])},removeRemoteItem:function(n,o,r,a){var s;s=r?this.archivedItems():this.items;var d=s()[o];d&&d.id===n.id&&(i.undoRedoActive&&i.notifyStateChangedFromUndoRedo(TrackerType.Delete,{itemID:d.id,parent:this.id,position:o,previous:e.getPreviousItem(d).id}),s.splice(o,1),a&&(t.deleteItem(this),e.timeline.notifyStateChanged(this)))},onListAdded:function(e){if(!e.isLocal||i.undoRedoActive){var t=!1,o=!0,r=n.get(this.data,"items");if(r&&e.target.id===r.id)o=e.target.id===r.id;else{var a=n.get(this.data,"archivedItems");a&&e.target.id===a.id&&(t=!0),o=a&&e.target.id===a.id}if(!o)return void log("Skipping list add due to invalid target");var s,d,c;e.values.length>0?(d=e.index,c=d+e.values.length,s=function(t){return e.values[t]}):(d=0,c=e.target.length,s=function(t){return e.target.get(t)});for(var l=d;c>l;++l){var u=l-d,h=s(u);this.addRemoteItem(h,l,t)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None)}},onListRemoved:function(e){if(!e.isLocal||i.undoRedoActive){var t,o=!1,r=!0,a=n.get(this.data,"items");if(a&&e.target.id===a.id)r=e.target.id===a.id;else{var s=n.get(this.data,"archivedItems");s&&e.target.id===s.id&&(o=!0),r=s&&e.target.id===s.id}if(!r)return void log("Skipping list remove due to invalid target");for(var d=e.index,c=d+e.values.length,l=c-1;l>=d;l--){var u=l-d,t=e.values[u],h=void 0===e.movedToList;this.removeRemoteItem(t,l,o,h)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None)}},onListSet:function(){},onObjectChanged:function(e){if(e.ocHandled)return ShouldLog(LogLevels.Warning|LogLevels.Verbose)&&log("Event Already Handled: ",e.ocHandled,"-",this.id,e.events[0].type),!1;e.ocHandled=this.id,e.stopPropagation();var t;if(e.isLocal&&!i.undoRedoActive)return!1;for(var t=0;t<e.events.length;++t)if(e.events[t].ocHandled)log("Sub-Event Already Handled: ",e.events[t].ocHandled,"-",this.id,e.events[t].type);else switch(e.events[t].ocHandled=this.id,e.events[t].type){case gapi.drive.realtime.EventType.TEXT_DELETED:this.onTextChanged(e.events[t]);break;case gapi.drive.realtime.EventType.TEXT_INSERTED:this.onTextChanged(e.events[t]);break;case gapi.drive.realtime.EventType.VALUES_ADDED:this.onListAdded(e.events[t]);break;case gapi.drive.realtime.EventType.VALUES_REMOVED:this.onListRemoved(e.events[t]);break;case gapi.drive.realtime.EventType.VALUE_CHANGED:this.onValueChanged(e.events[t]);break;case gapi.drive.realtime.EventType.VALUES_SET:}return!1}}};return o}),define("sounds",["globals","platform"],function(e){function t(e,t){var n=document.createElement("source");n.src=t,e.appendChild(n)}var n={},i={};return n.add=function(e){if(n[e]=e,!i[e]){var o=document.createElement("audio");t(o,"sounds/"+e+".mp3"),o.preload="auto",i[e]=o}},n.play=function(t){if(!e.settings.get(Settings.noSounds)){if(!i[t])return log("Tried to play a sound that has not been loaded:",t),void console.trace();try{i[t].play()}catch(n){log("Failed to play audio",n)}}},n}),define("VMLI",["ko","globals","platform","data","gdata","android","VMLI_TapHandlers","VMLI_Text","VMLI_Drive","tracker","sounds"],function(e,t,n,i,o,r,a,s,d,c){function l(t,n){if(!t.id&&t.data&&t.data.id?t.id=t.data.id:t.id&&t.data,t.id&&i.getModel[t.id])return ShouldLog(LogLevels.Warning)&&log("Attempting to create an already created VMLI: ",t.id),i.getModel[t.id];this._parent=n?n.parent:void 0,this._rawText=t.data?"":t.text,this._searchText=t.data?"":t.text?t.text.toLowerCase():"",this._parsedText=void 0,this._styledText=e.observable(""),this._isArchived=t.isArchived||!1,this.items=e.observableArray(),this._archivedItems=void 0,this._date=e.observable(void 0);var o=VMLIFlag.None;t.isCollapsed&&(o|=VMLIFlag.Collapsed),t.isComplete&&(o|=VMLIFlag.Complete),t.isStarred&&(o|=VMLIFlag.Starred),t.priority&&(o|=t.priority),this._flags=e.observable(o),this.styleLength=0,this.dateText=t.dateText,this.allDayDate=void 0,this.dateCreated=t.dateCreated?new Date(t.dateCreated):new Date,this.dateCompleted=t.dateCompleted?new Date(t.dateCompleted):void 0,this.elements=[],this.outlineElements=[],this.isLoaded=!1,this.isDeleted=t.isDeleted||!1,this.isStyled=!1,this.modifiedOffline=void 0,this.modifiedOfflineText=void 0,this.highlightTimeout=void 0,this.data=void 0,this._version=-1,this._versionText=-1,this._versionRemote=void 0,this._versionRemoteText=void 0,this.levelsDeep=e.observable(this._parent?this._parent.levelsDeep()+1:0),__TOTAL_ITEMS++,t.isArchived&&__TOTAL_ARCHIVED_ITEMS++,this._needsParse=!1,this.init(t,n)}return window.__TOTAL_ITEMS=0,window.__TOTAL_ARCHIVED_ITEMS=0,window.__TOTAL_ARCHIVE_PARENTS=0,l.prototype={_getLineStyle:function(){return this._flags()&t.LSMask},_getPriority:function(){return this._flags()&t.PMask},stylePadding:function(e){var t,i;if(e){t=n.phone?15:24;var o=e.$parents[e.$parents.length-2],r=o.item.peek().levelsDeep.peek();i=this.levelsDeep()-r-1}else t=n.phone?40:25,i=this.levelsDeep()-1;return t+20*i+"px"},_updateStylePadding:function(e,t){var n=e+1,i=this.levelsDeep.peek()!==n;if(i||t){i?this.levelsDeep(n):this.levelsDeep.valueHasMutated();for(var o=this.items.peek(),r=0;r<o.length;++r)o[r]._updateStylePadding(n,t)}},styleProps:function(){var e=this._flags(),n=e&VMLIFlag.Header?"pHeader ":"";return e&VMLIFlag.Collapsed&&(n+="collapsed "),e&VMLIFlag.Selected&&(n+="selected "),e&VMLIFlag.Highlighted&&(n+="highlight "),e&VMLIFlag.NumList&&(n+="pNumList "),this.isArchived()&&(n+="archived "),n+=e&VMLIFlag.Complete?"pComplete ":e&t.PMask?t.priorityMapOut[e&t.PMask]+" ":"pNormal ",e&VMLIFlag.Starred&&(n+="pStar "),n},copyProperties:function(e){this.isStarred(e.isStarred()),this.isComplete(e.isComplete()),this.priority(e.priority())},parent:function(){return 1===arguments.length&&(this._parent=arguments[0],void 0!==arguments[0]&&this._updateStylePadding(this._parent.levelsDeep(),!1)),this._parent},archivedItems:function(t){return this._archivedItems||(this._archivedItems=e.observableArray(),window.__TOTAL_ARCHIVE_PARENTS++),t?this._archivedItems():this._archivedItems},hasArchivedChildren:function(){return void 0!==this._archivedItems?this._archivedItems().length>0:!1},headers:function(){for(var e=[],t=this.items(),n=0;n<t.length;++n)t[n].isHeader()&&e.push(t[n]);return e},isArchived:function(){if(1===arguments.length){var e=this._isArchived;this._isArchived=arguments[0],arguments[0]!==e&&t.timeline.notifyStateChanged(this,PropChangeType.Archive)}return this._isArchived},getRawText:function(){return this._rawText},getParsedText:function(){return this._parsedText?this._parsedText:this._rawText},getStyledText:function(){return this._styledText()},getSearchText:function(){return this._searchText},setRawText:function(e){(void 0===e||null===e)&&(e=""),this._rawText=e,e&&(this._searchText=e.toLowerCase()),this._parsedText=void 0,this._needsParse=!0},setParsedText:function(e){this._parsedText===e||void 0===e;this._parsedText=e,e&&(this._searchText=e.toLowerCase()),this._needsParse=!1},setStyledText:function(e){this._styledText(e)},priority:function(e,n){if(void 0===e)return this._getPriority();var i=this._getPriority();if(e!==i){var r=this._flags()&~t.PCMask|e;if(this._flags(r),this.isLoaded){var a={priority:e};n||(o.saveChanges(this,a),a=t.clone(a));var s=n?SaveFlag.None:SaveFlag.Text;this.save(a,s),t.timeline.notifyStateChanged(this,PropChangeType.Priority|PropChangeType.Complete),c.performAction(TrackerType.Update,{itemID:this.id,field:"priority",newValue:e,oldValue:i})}}},date:function(e,n){return void 0!==e&&e!==this._date()&&(null===e&&(e=void 0),this._date(e),this.allDayDate=e?!e._explicitTime:!1,t.timeline.notifyStateChanged(this,PropChangeType.Date),this.isLoaded&&!n&&c.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ChangeDate,data:[{itemID:this.id,date:e}]})),this._date()},_isFlagHelper:function(e,t){if(void 0!==t){var n=t?this._flags()|e:this._flags()&~e;return void this._flags(n)}return!!(this._flags()&e)},isImportant:function(){return this._getPriority()},isComplete:function(e,n){if(void 0===e)return this._isFlagHelper(VMLIFlag.Complete);var i={isComplete:e};if(e!==this._isFlagHelper(VMLIFlag.Complete)&&(this._isFlagHelper(VMLIFlag.Complete,e),this.isLoaded)){e?(this.dateCompleted||(this.dateCompleted=new Date,i.dateCompleted=this.getDateCompletedTime()),t.vmMain.isLoaded&&t.aggregateEvent("ItemCompleted")):(this.dateCompleted=void 0,i.dateCompleted=void 0),n||(o.saveChanges(this,i),i=t.clone(i));var r=n?SaveFlag.None:SaveFlag.Text;this.save(i,r),t.timeline.notifyStateChanged(this,PropChangeType.Complete),c.performAction(TrackerType.Update,{itemID:this.id,field:"isComplete",newValue:e,oldValue:!e})}},isStarred:function(e,n){if(void 0===e)return this._isFlagHelper(VMLIFlag.Starred);if(e!==this._isFlagHelper(VMLIFlag.Starred)){var i=e?this._flags()&~VMLIFlag.Complete:this._flags(),a=e?i|VMLIFlag.Starred:i&~VMLIFlag.Starred;if(this._flags(a),this.isLoaded){var s={isStarred:e};n||(o.saveChanges(this,s),s=t.clone(s)),r.isEnabled()&&r.isCurrentVMLI(this)&&r.notifyStarred(e);var d=n?SaveFlag.None:SaveFlag.Text;this.save(s,d),t.timeline.notifyStateChanged(this,PropChangeType.Starred|PropChangeType.Complete)}c.performAction(TrackerType.Update,{itemID:this.id,field:"isStarred",newValue:e,oldValue:!e})}},isHeader:function(){var e=this.items().length>0,t=this._flags();if(!!(t&VMLIFlag.Header)!==e){var n=e?t|VMLIFlag.Header:t&~VMLIFlag.Header;this._flags(n),this._parent&&this._parent.isFullscreen()&&this._updateStylePadding(this._parent.levelsDeep(),!0)}return e},isCollapsed:function(e){return this._isFlagHelper(VMLIFlag.Collapsed,e)},isSelected:function(e){return n.mobile?this._isFlagHelper(VMLIFlag.Selected,e):!1},isHighlighted:function(e){return this._isFlagHelper(VMLIFlag.Highlighted,e)},isNumList:function(e){return this._isFlagHelper(VMLIFlag.NumList,e)},hasCompletedAncestor:function(){for(var e=this.parent();e;){if(e.isComplete())return!0;e=e.parent()}},hasTime:function(){return this.date()?"12:00am"!==this.date().toString("h:mmtt"):this.dateCompleted},time:function(){return this.date()?"12:00am"==this.date().toString("h:mmtt")?"Any Time":this.date().toString("h:mm tt"):this.dateCompleted?this.dateCompleted.toString("h:mmtt"):""},createDateString:function(e){return e.toString(e.isBefore(Date.today().addWeeks(1))?"dddd h:mm tt":"MM/dd h:mm tt")},fullTime:function(){var e=this.date();return e?void this.createDateString(e):""},setVersion:function(e,t){switch(e){case VersionType.Structure:this._version=t;break;case VersionType.Text:this._versionText=t}},getVersion:function(e){var t;switch(e){case VersionType.Structure:t=this._version;break;case VersionType.Text:t=this._versionText;break;default:t=-2}return t?t:0},setRemoteVersion:function(e,t){switch(e){case VersionType.Structure:this._versionRemote=t;break;case VersionType.Text:this._versionRemoteText=t}},getRemoteVersion:function(e){var t;switch(e){case VersionType.Structure:t=this._versionRemote;break;case VersionType.Text:t=this._versionRemoteText;break;default:t=-2}return t?t:0},isLocalVersionNewer:function(e){return this.getVersion(e)==this.getRemoteVersion(e)},isRemoteVersionNewer:function(e){return!this.isLocalVersionNewer(e)},init:function(e,n){if(e.data){var r=o.getVersion(e.data,VersionType.Structure),a=o.getVersion(e.data,VersionType.Text);this.setRemoteVersion(VersionType.Structure,r),this.setRemoteVersion(VersionType.Text,a),c.beginAction(),this.initFromGDrive(e.data,n&&n.parse),c.endAction(),this.setRemoteVersion(VersionType.Structure,void 0),this.setRemoteVersion(VersionType.Text,void 0)}else this.setVersion(VersionType.Structure,e.version),this.setVersion(VersionType.Text,e.versionText),this.modifiedOffline=e.modifiedOffline,this.modifiedOfflineText=e.modifiedOfflineText,this.modifiedOffline,this.modifiedOfflineText,t.vmMain.isLoaded&&o.isConnected()?i.initializeItem(this):this.id=e.id||t.generateTempId(),e.date&&(this.date(new Date(e.date)),this.allDayDate=e.allDayDate,this.date()._explicitTime=!e.allDayDate),e.dateCompleted&&(this.dateCompleted=new Date(e.dateCompleted)),e.items&&this.updateItems(e.items,n&&n.forceSave,n&&n.parse);this.parseText(n&&n.parse),n&&n.forceSave&&(this.save(void 0,SaveFlag.Prop),this.date()&&o.saveChanges(this,this.getMetaTextSaveData())),t.vmMain.isLoaded&&t.aggregateEvent("ItemCreated"),i.setModel(this.id,this)},onLoad:function(e,i){if(n.mobile&&(i=t.focusedPane),i&&i.trackDOM&&i.trackDOM()){var o=i.id;this.isLoaded=!0,t.hasClass(e,"outlineItem")?(this.outlineElements[o]=e,i.vmSearch.checkItem(this,!0,!1)):(this.elements[o]=e,(!t.vmMain.isLoaded||i!=t.focusedPane||i.reloading)&&i.vmSearch.checkItem(this,!1,!0))}},resetDriveData:function(){this._versionRemote=void 0,this._versionRemoteText=void 0,this.data=void 0},isFullscreen:function(){return t.focusedItem===this},findItem:function(e){var t=this.getIndexOf(e,!1);return t>=0?{index:t,arr:this.items,isArchived:!1}:this.hasArchivedChildren()&&(t=this.getIndexOf(e,!0),t>=0)?{index:t,arr:this.archivedItems(),isArchived:!0}:void 0},updateItems:function(e,t,n){var r,a;this.data&&(r=o.get(this.data,"items"),a=o.get(this.data,"archivedItems"));for(var s=!1,d=!1,c=0;c<e.length;++c){var u=e[c],h=i.getModel(u);if(h){var p=i.getItem(h.parent().id),f=(p.items.indexOf(h.id),h.getIndex());f>-1&&h.parent().removeChildAtIndex(f),h.parent(this)}else if("object"!=typeof u){var m=i.getItem(u);m&&(h=new l(m,{parent:this,forceSave:t,parse:n}))}else u&&(h=new l(u,{parent:this,forceSave:t,parse:n}));h&&(h.isArchived()?(d=!0,this.archivedItems(!0).push(h),!a&&this.data&&(a=o.ensureItemList(this,!0)),a&&a.push(h.data)):(s=!0,this.items().push(h),!r&&this.data&&(r=o.ensureItemList(this,!1)),r&&r.push(h.data)))}s&&this.items.valueHasMutated(),d&&this.archivedItems().valueHasMutated()},insertItem:function(e,n,o){var r=o?this.items():this.items;isNaN(n)?r.push(e):r.splice(n,0,e),i.insertItems(this,[e],n),t.fireCustomEvent("itemAdded",{item:e,force:!1})},moveTo:function(e){var t=e.parent,n=e.index,o=e.isRemoteChange,r=e.shouldBeArchived,a=e.noVersion,s=e.underlying;void 0===n&&(n=-1),void 0===o&&(o=!1),void 0===r&&(r=!1);var d=this.parent(),c=d.findItem(this);if(c){var l=n,u=n;if(d===t){if(c.index===l)return;c.index<l&&l--}s&&(c.arr=c.arr()),c.arr.splice(c.index,1),this.parent(t);var h=r?t.archivedItems():t.items;s&&(h=h()),0>l?h.push(this):h.splice(l,0,this);var p={index:u,isArchived:r};i.moveItem({item:this,newInfo:p,oldParent:d,oldInfo:c,isRemoteChange:o,noVersion:a})}},getItemsArrayForSave:function(){for(var e=[],t=this.items(),n=0;n<t.length;++n)e.push(t[n].id);if(this.hasArchivedChildren())for(var i=this.archivedItems(!0),n=0;n<i.length;++n)e.push(i[n].id);return e},getDateTime:function(){return this.date()?this.date().getTime():void 0},getDateCompletedTime:function(){return this.dateCompleted?this.dateCompleted.getTime():void 0},getMetaTextSaveData:function(){var e,t,n=this.date();return void 0!==n&&(e=n.getTime(),t=!n._explicitTime),{date:e,allDayDate:t,dateCompleted:this.getDateCompletedTime()}},getBasicJSON:function(){if(this.allDayDate)return"";var e,t=this.date().toJSON();return e=this.allDayDate?this.date().addDays(-1).setHours(17).toJSON():this.date().addMinutes(-30).toJSON(),'{"id":"'+this.id+'","text":"'+this.getRawText()+'","date":"'+t+'","alertDate":"'+e+'"}'},getDebugData:function(){var e={id:this.id,parent:this._parent?this._parent.id:void 0,items:this.getItemsArrayForSave(),text:this.getRawText(),isArchived:this.isArchived(),isDeleted:this.isDeleted,version:this.getVersion(VersionType.Structure),versionText:this.getVersion(VersionType.Text),modifiedOffline:this.modifiedOffline,modifiedOfflineText:this.modifiedOfflineText};return e},getFullSaveData:function(){var e={id:this.id,text:this.getRawText(),date:this.getDateTime(),dateCreated:this.dateCreated.getTime(),dateCompleted:this.getDateCompletedTime(),priority:this._getPriority()||void 0,isComplete:this.isComplete()||void 0,isStarred:this.isStarred()||void 0,isCollapsed:this.isCollapsed()||void 0,allDayDate:this.allDayDate||void 0,isArchived:this.isArchived()||void 0,isDeleted:void 0,version:this.getVersion(VersionType.Structure),versionText:this.getVersion(VersionType.Text),modifiedOffline:this.modifiedOffline,modifiedOfflineText:this.modifiedOfflineText};return e.items=this.getItemsArrayForSave(),e},save:function(e,n){if(e){var o=i.getItem(this.id);o||e.id?(e.items&&(e.items=this.getItemsArrayForSave()),e.date&&!e.allDayDate&&(e.allDayDate=this.allDayDate||void 0),e.text&&t.fireCustomEvent("itemTextChanged",{item:this,force:n===SaveFlag.None})):e=this.getFullSaveData()}else e=this.getFullSaveData();i.saveChanges(this,e,n)},toggleCollapsed:function(){function e(){c.performAction(TrackerType.Update,{itemID:i.id,field:"isCollapsed",newValue:!i.isCollapsed(),oldValue:i.isCollapsed()}),i.isCollapsed(!i.isCollapsed()),i.save({isCollapsed:i.isCollapsed()},SaveFlag.Text)}if(!(this.items().length<=0)){var n=this.isCollapsed(),i=this,o=t.firstChildTag(this.getElement(),"ul");n?(e(),t.animateTransform(o,{time:200,delay:0,transform:"scale(1, 1) translate3d(0,0,0)",clearTransform:!0,origin:"50% 0"})):t.animateTransform(o,{time:200,transform:"scale(1, 0)",origin:"50% 0",onComplete:function(){e()}})}},highlight:function(){var e=this;this.highlightTimeout?(this.isHighlighted(!1),clearTimeout(this.highlightTimeout),this.highlightTimeout=0,setTimeout(function(){e.isHighlighted(!0)},0)):this.isHighlighted(!0),this.highlightTimeout=setTimeout(function(){e.isHighlighted(!1)},2e3)},getElement:function(e){return void 0===e&&(e=t.focusedPaneID),this.elements[e]},getSpan:function(e){var t=this.getElement(e);return t?t.firstElementChild:void 0},getOutlineElement:function(e){return void 0===e&&(e=t.focusedPaneID),this.outlineElements[e]},removeChild:function(e){var t;return e.isArchived()?this.hasArchivedChildren()&&(t=this.archivedItems(!0).remove(e),i.removeItem(this,t,e,!0),this.archivedItems().valueHasMutated()):(t=this.items().remove(e),i.removeItem(this,t,e,!1),this.items.valueHasMutated()),t},removeChildAtIndex:function(e){var t=this.items().removeAt(e);return i.removeItem(this,e,t,!1),this.items.valueHasMutated(),t},archiveChild:function(e){var t=!1;if(!e.isArchived()){c.beginAction(),e.isArchived(!0),this.archivedItems().push(e);var n=this.items().remove(e);i.archiveItem(this,n,e),this.items.valueHasMutated(),c.endAction(),t=!0}return t},unarchiveChild:function(e){var t=!1;if(e.isArchived()){c.beginAction(),e.isArchived(!1);var n=this.archivedItems(!0).remove(e);this.items.push(e),i.unarchiveItem(this,n,e),this.archivedItems().valueHasMutated(),c.endAction(),t=!0}return t},_moveChildrenHelper:function(e){var t=e.newParent,n=e.index,i=e.isArchived,o=i?this.archivedItems():this.items,r=o();if(r.length>0){var a=i?t.archivedItems():t.items;!i&&(isNaN(n)||0>n)&&(n=a().length);for(var s=0;r.length>0;){var d=r[0];r[0].moveTo({parent:t,index:n+s,shouldBeArchived:i,underlying:!0}),c.performAction(TrackerType.Move,{itemID:d,oldParent:this.id,oldPosition:s,newParent:t.id,newPosition:n+s}),s++}o.valueHasMutated(),a.valueHasMutated()}},moveChildren:function(e,t){if(e.parent()===this){var n=this.removeChild(e);c.performAction(TrackerType.Delete,{itemID:e.id,parent:this.id,position:n})}this._moveChildrenHelper({newParent:e,index:t,isArchived:!1}),this._moveChildrenHelper({newParent:e,index:t,isArchived:!0})},deleteSelf:function(){this.parent().deleteChild(this),this.parent(void 0)},deleteChild:function(e,n,o){if(c.beginAction(),e.hasChildren()||e.hasArchivedChildren())if(n)e.moveChildren(n,o);else for(var r=e.items(),a=r.length-1;a>=0;a--)e.deleteChild(r[a]);if(!e.isDeleted){var s=this.removeChild(e);c.performAction(TrackerType.Delete,{itemID:e.id,parent:this.id,position:s}),i.deleteItem(e)}t.timeline.notifyStateChanged(e),c.endAction()},replaceChild:function(e,t){var n=e.getIndex();this.items().removeAt(n),c.performAction(TrackerType.Delete,{itemID:e.id,parent:this.id,position:n}),i.deleteItem(e),t.moveTo({parent:this,index:n}),i.removeItem(this,n+1,e,!1),e.moveChildren(t,t.numChildren());var o=t.parent().id;if(o!==this.id){var r=t.parent().items().remove(t);c.performAction(TrackerType.Move,{itemID:t.id,oldParent:o,oldPosition:r,newParent:this.id,newPosition:n})}this.items.valueHasMutated()},getChild:function(e){return this.items()[e]},getFirstChild:function(){return this.hasChildren()?this.items()[0]:void 0},isFirstChild:function(){return this.parent()?this.parent().getFirstChild()===this:!1},getLastChild:function(){return this.hasChildren()?this.items()[this.items().length-1]:void 0},isLastChild:function(){return this.parent()?this.parent().getLastChild()===this:!1},getChildIndex:function(e){return this.getIndexOf(e.id,e.isArchived())},getIndexOf:function(e,t){e.id&&(e=e.id);var n,i=-1;if(t?this.hasArchivedChildren()&&(n=this.archivedItems(!0)):n=this.items(),n)for(var o=0;o<n.length;++o)if(n[o].id===e){i=o;break}return i},getRemoteIndexOf:function(e,t){var n=o.getItemList(this.data,t),i=-1;return n&&(i=n.indexOf(e)),i},getIndex:function(){return this.parent().getChildIndex(this)},hasChildren:function(){return this.items().length>0},numChildren:function(){return this.items().length},canZoom:function(){return this.numChildren()>0||this.getParsedText().length>0},parents:function(){for(var e=[],t=this;t;)e.splice(0,0,t),t=t.parent();return e},getSiblings:function(e){e=e||0;var t=[];if(this.parent())for(var n=this.parent().items(),i=0,o=n.length;o>i;i++)n[i]!==this&&t.push(n[i]);return t},outline:function(e){if(e)for(var n=e.$parents.length-1;n>0;n--)if(e.$parents[n]instanceof t.VMOutline)return e.$parents[n];return t.focusedPane.outline}},t.extend(l.prototype,a),t.extend(l.prototype,s),t.extend(l.prototype,d(l)),l}),define("tracker",["globals","platform","data","gdata","VMLI"],function(e,t,n,i){function o(){return _.groupID+1}function r(){return++_.groupID}function a(){return _.groups[_.cursor]}function s(){return _.groups[_.cursor].events[_.groups[_.cursor].events.length-1]}function d(e){for(var t=0;t<e.events.length;++t){var n=e.events[t];switch(n.type){case TrackerType.Insert:break;case TrackerType.Remove:break;case TrackerType.Create:break;case TrackerType.Delete:break;case TrackerType.Move:break;case TrackerType.Update:break;case TrackerType.Format:break;case TrackerType.Zoom:break;case TrackerType.UIAction:}}}function c(){var e=r();return _.groups.push({id:e,events:[],persisted:!1}),_.cursor<N-1&&_.cursor++,_.groups.length>N&&d(_.groups.shift()),e}function l(e,t){var n=a(),i={type:e,data:t};switch(e){case TrackerType.Insert:i.cb={undo:f,redo:m};break;case TrackerType.Remove:i.cb={undo:g,redo:v};break;case TrackerType.Create:i.cb={undo:y,redo:b};break;case TrackerType.Delete:i.cb={undo:S,redo:T};break;case TrackerType.Move:i.cb={undo:w,redo:M};break;case TrackerType.Update:i.cb={undo:C,redo:x};break;case TrackerType.Format:i.cb={undo:I,redo:E};break;case TrackerType.Zoom:i.cb={undo:k,redo:D};break;case TrackerType.UIAction:i.cb={undo:P,redo:L}}n.events.push(i)}function u(e,t){log("Tracker Action Merged: ",e,t);s();switch(e){case TrackerType.Insert:break;case TrackerType.Remove:break;case TrackerType.Create:break;case TrackerType.Delete:break;case TrackerType.Move:break;case TrackerType.Update:break;case TrackerType.Format:break;case TrackerType.Zoom:break;case TrackerType.UIAction:}}function h(e){var t=!1,n=a();return n&&n.events.length>0&&(n.events[n.events.length-1].type===e?e===TrackerType.Insert&&(t=!0):t=!1),t}function p(e,t){var n=a();return n&&(n.id===t||0===n.events.length)}function f(t){for(var i=0;i<t.length;++i){var o=t[i],r=n.getModel(o.itemID),a=r.getParsedText(),s=0;"﻿"==a[0]&&(s=1);var d=a.slice(s,o.position)+a.slice(o.position+o.text.length);r.setText(d,!0),e.selectChildren(r,o.position,0)}}function m(t){for(var i=0;i<t.length;++i){var o=t[i],r=n.getModel(o.itemID),a=r.getParsedText(),s=a.slice(0,o.position)+o.text+a.slice(o.position);0===s.length&&(s="﻿"),r.setText(s,!0),e.selectChildren(r,o.position,o.text.length)}}function g(t){for(var i=0;i<t.length;++i){var o=t[i],r=n.getModel(o.itemID),a=r.getParsedText(),s=0;"﻿"==a[0]&&(s=1);var d=a.slice(s,o.position)+o.text+a.slice(o.position);r.setText(d,!0),e.selectChildren(r,o.position,o.text.length)}}function v(t){for(var i=0;i<t.length;++i){var o=t[i],r=n.getModel(o.itemID),a=r.getParsedText(),s=a.slice(0,o.position)+a.slice(o.position+o.text.length);0===s.length&&(s="﻿"),r.setText(s,!0),e.selectChildren(r,o.position,0)}}function y(t){for(var i=0;i<t.length;++i){var o=t[i],r=n.getModel(o.parent),a=r.removeChildAtIndex(o.position);a.parent(void 0),n.deleteItem(a);var s=r;o.position>0&&(s=r.getChild(o.position-1)),e.selectChildren(s,s.getParsedText().length,0),r.save({items:r.getItemsArrayForSave()},SaveFlag.None)}}function b(t){for(var i=0;i<t.length;++i){var o=t[i],r=n.getModel(o.parent),a=n.getModel(o.itemID);n.undeleteItem(a),r.items.splice(o.position,0,a),a.parent(r),e.selectChildren(a,0,0),r.save({items:r.getItemsArrayForSave()},SaveFlag.None)}}function S(t){for(var i=0;i<t.length;++i){var o=t[i],r=n.getModel(o.parent),a=n.getModel(o.itemID);n.undeleteItem(a),r.items.splice(o.position,0,a),a.parent(r),e.selectChildren(a,0,0),r.save({items:r.getItemsArrayForSave()},SaveFlag.None)}}function T(t){for(var i=0;i<t.length;++i){var o=t[i],r=n.getModel(o.parent),a=r.removeChildAtIndex(o.position);a.parent(void 0),n.deleteItem(a);var s=r;o.position>0&&(s=r.getChild(o.position-1)),e.selectChildren(s,s.getParsedText().length,0),r.save({items:r.getItemsArrayForSave()},SaveFlag.None)}}function w(t){for(var i=0;i<t.length;++i){var o=t[i],r=n.getModel(o.oldParent),a=n.getModel(o.newParent),s=a.removeChildAtIndex(o.newPosition);s.parent(r),r.items.splice(o.oldPosition,0,s),e.selectChildren(s,0,0),a.save({items:a.getItemsArrayForSave()},SaveFlag.None),r.save({items:r.getItemsArrayForSave()},SaveFlag.None)}}function M(t){for(var i=0;i<t.length;++i){var o=t[i],r=n.getModel(o.oldParent),a=n.getModel(o.newParent),s=r.removeChildAtIndex(o.oldPosition);s.parent(a),a.items.splice(o.newPosition,0,s),e.selectChildren(s,0,0),a.save({items:a.getItemsArrayForSave()},SaveFlag.None),r.save({items:r.getItemsArrayForSave()},SaveFlag.None)}}function C(e){for(var t=0;t<e.length;++t){var i=e[t],o=n.getModel(i.itemID);o[i.field](i.oldValue)}}function x(e){for(var t=0;t<e.length;++t){var i=e[t],o=n.getModel(i.itemID);o[i.field](i.newValue)}}function I(e){for(var t=0;t<e.length;++t){var i=e[t];n.getModel(i.itemID)}}function E(e){for(var t=0;t<e.length;++t){var i=e[t];n.getModel(i.itemID)}}function k(e){var t=e[0],i=n.getModel(t.oldItemID);t.zoomIn?i.zoomOut(t.time):t.zoomOut&&i.zoomin({time:t.time})}function D(e){var t=e[0],i=n.getModel(t.itemID);t.zoomIn?i.zoomin({time:t.time}):t.zoomOut&&i.zoomOut(t.time)}function P(e){var t=e[0];switch(t.type){case TrackerUIAction.RemovePane:break;case TrackerUIAction.SwitchPaneMode:}}function L(){}function O(){return!e.vmMain.isLoaded||e.isLoadingRemote}function A(t){for(var i=void 0,o=0,r=0,a=0;a<t.length;++a){var s=t[a],d=s.data,c=n.getModel(d.itemID);switch(s.type){case TrackerType.Insert:i=c,o=d.position,r=d.text.length;break;case TrackerType.Remove:i=c,o=d.position,r=0;break;case TrackerType.SetText:i=c,o=d.position,r=0;break;case TrackerType.Create:i=c,o=0,r=0;break;case TrackerType.Delete:var l=n.getModel(d.previous);i=l,o=l.getParsedText().length,r=0}}i&&(e.selectChildren(i,o,r),e.scrollIntoView(i.getSpan(),200)),U=[]}function R(){return _.groups.slice(_.cursor).concat(_.groups.slice(0,_.cursor))}var _={disabled:!1,allowOfflineUndo:!1,cursor:-1,groupID:0,groups:[],externalUndoRedo:!1,undoRedoActive:!1,canRedo:!1,canUndo:!1};window.TrackerType={Insert:1,Remove:2,SetText:3,Create:4,Delete:5,Move:6,Update:7,Format:8,Zoom:9,UIAction:10,Misc:11,Mobile:12},window.TrackerMisc={ToggleOutline:1,RightClick:2,CloseMessage:3,ChangeDate:4,AddContact:5,DropItem:6,SyncContacts:7,OpenContact:8,SearchChanged:10,ToggleSidebar:11,AddDocument:12,OpenDocument:13,OpenDocSharing:14,Copy:15,Paste:16,OpenImport:17,OpenExport:18,UndoRedo:19},window.TrackerMiscMobile={OpenKeyboard:1,CloseKeyboard:2,PaneAgenda:3,PaneNormal:4,OpenAutocomplete:5,CloseAutocomplete:6,AtButton:7,OpenMultiselect:8,CloseMultiselect:9},window.TrackerUIAction={AddPane:1,RemovePane:2,SwitchPaneMode:3};
var N=75,F=!1;_.performActions=function(t){if(F=!0,t&&t.length>0){if(!_.disabled){var n=void 0;_.cursor!=_.groups.length-1?(_.groups.splice(_.cursor+1,_.groups.length-(_.cursor+1)),n=c()):n=o()}for(var i=0;i<t.length;++i){var r=t[i];e.intro&&e.intro.onAction(r),_.disabled||(p(r.type,n)?h(r.type)?u(r.type,r.data):l(r.type,r.data):(n=c(),l(r.type,r.data)))}}F=!1};var V=[],B=0;_.beginAction=function(){0===B&&i.beginAction(),B++},_.performAction=function(t,n){var i=O();_.disabled?e.intro&&(i||_.performActions([{type:t,data:[n]}])):B?V.push({type:t,data:[n]}):_.performActions([{type:t,data:[n]}])},_.endAction=function(){1===B&&((!_.disabled||e.intro)&&_.performActions(V),V.length=0,i.endAction()),B=Math.max(0,B-1)},_.resetAggregateActionCount=function(){B=0};var U=[];return _.notifyStateChangedFromUndoRedo=function(e,t){U.push({type:e,data:t})},_.undoAction=function(){if(e.vmMain.isOnline()||_.allowOfflineUndo||e.messageQueue.pushMessage(MessageID.OfflineUndo),_.undoRedoActive=!0,!_.disabled&&_.allowOfflineUndo){if(_.cursor>=0)for(var t=_.groups[_.cursor--],n=t.events.length-1;n>=0;n--){var o=t.events[n];o.cb.undo(o.data)}}else _.canUndo&&i.undoAction();_.undoRedoActive=!1,A(U),_.miscAction({type:TrackerType.Misc,misc:TrackerMisc.UndoRedo,data:[{undo:!0}]})},_.redoAction=function(){if(e.vmMain.isOnline()||_.allowOfflineUndo||e.messageQueue.pushMessage(MessageID.OfflineUndo),_.undoRedoActive=!0,!_.disabled&&_.allowOfflineUndo){if(_.cursor>=-1&&_.cursor<_.groups.length-1)for(var t=_.groups[++_.cursor],n=0;n<t.events.length;++n){var o=t.events[n];o.cb.redo(o.data)}}else _.canRedo&&i.redoAction();_.undoRedoActive=!1,A(U),_.miscAction({type:TrackerType.Misc,misc:TrackerMisc.UndoRedo,data:[{redo:!0}]})},_.miscAction=function(t){e.intro&&e.intro.onAction(t)},_.resetState=function(){F=!1,U=[],V=[],_.undoRedoActive=!1,_.cursor=-1,_.groupID=0,_.groups=[]},_.stringifyGroups=function(){var e=R();return"Tracker: "+e.length},_.stateChangeForUndoRedo=function(e){_.externalUndoRedo=!0,_.disabled=!0,_.canRedo=e.canRedo,_.canUndo=e.canUndo},i.registerForUndoRedoStateChange(_),_}),define("edit",["ko","globals","platform","android","VMLI","tracker"],function(e,t,n,i,o,r){function a(){if(i.isEnabled()){if(!i.getCurrentVMLI())return!0;s={},d=void 0,c=l=i.getCurrentSpan(),u=i.getSelectionStart(),h=i.getSelectionEnd()}else{if(s=t.getSelectionInfo(),!s||0===s.rangeCount)return!0;d=t.getSelectionRange(),c=d.startContainer,l=d.endContainer,u=d.startOffset,h=d.endOffset}}var s,d,c,l,u,h,p,f,m={},g=[KeyCode.Tab,KeyCode.BackSpace,KeyCode.Delete,KeyCode.Period],v=[KeyCode.UpArrow,KeyCode.DownArrow,KeyCode.LeftArrow,KeyCode.RightArrow,KeyCode.Home,KeyCode.End],y={},b=String.fromCharCode(10);return m.updateAutocomplete=function(n){var o=n.normCode&&v.indexOf(n.normCode)>=0;if(t.autocomplete)if(i.isEnabled()){var r=i.getCurrentSpan();r?t.autocomplete.update({item:i.getCurrentVMLI(),start:i.getSelectionStart(),fromArrows:o}):t.autocomplete.hide()}else{var a=t.getSelectionInfo();if(a&&a.selection.rangeCount>0){var s=t.getSelectionRange(),d=t.getLIParent(s.startContainer),c=t.getLIParent(s.endContainer);if(d&&d===c&&s.startOffset===s.endOffset&&"UL"!==s.startContainer.tagName){var l=e.dataFor(d),r=l.getSpan();if(r){var u=t.getSelectOffsetsInSpan(l,r,s);u.start===u.end&&t.autocomplete.update({item:l,start:u.start,fromArrows:o})}else t.autocomplete.hide()}}}},m.onTextInput=function(e){if(y.item&&y.waitAutocorrect&&" "!=e.data&&e.data!=b){var n=y.item,i="enter"==y.waitAutocorrect?p:n.getSpan(),o=n.getParsedText();a();var r=t.getSelectOffsetsInSpan(n,i,d),s=r.endText-r.startText,c="space"==y.waitAutocorrect?" ":"";y.text=o.substr(0,r.startText)+e.data+c+o.substr(r.endText),y.start+=e.data.length-s,y.waitAutocorrect=void 0}},m.keyup=function(e,n){return y.item&&(r.beginAction(),void 0!=y.text&&y.item.setText(y.text,!0),y.nextItem?t.selectChildren(y.nextItem,0,0):t.selectChildren(y.item,y.start,0),window.__IS_DEMO_VIDEO||m.updateAutocomplete(n),r.endAction()),y.item=void 0,y.nextItem=void 0,y.text=void 0,y.start=void 0,y.waitAutocorrect=void 0,(n.normCode===KeyCode.Enter||n.normCode===KeyCode.PageUp||n.normCode===KeyCode.PageDown)&&m.scrollTextIntoView(),n.stopImmediatePropagation&&n.stopImmediatePropagation(),n.preventDefault&&n.preventDefault(),n.handled?!0:void 0},m.scrollTextIntoView=function(n){if(isNaN(n)&&(n=200),!t.isScrolling&&(a(),l&&"UL"!==l.tagName&&"LI"!==l.tagName&&!t.hasClass(l,"search"))){var o=t.getSpanParent(l);if(o){var r=i.isEnabled()?i.getCurrentVMLI():e.dataFor(o);if(r){var s,d=s?s.getSpan():r.getSpan();t.scrollIntoView(d,n,{extraAmt:50})}}}},m.handleSelectAll=function(e){a();var n=t.getFirstPaneItem(e),i=t.getLastPaneItem(e);return t.selectMultiline(n.getSpan(),0,i.getSpan(),i.getParsedText().length),!1},m.handleArrows=function(i,o){if(t.restrictSelectionToText(),a(),n.mac&&o.metaKey&&o.normCode===KeyCode.UpArrow||!n.mac&&o.ctrlKey&&o.normCode===KeyCode.Home){var r=t.getFirstPaneItem(t.focusedPane);return o.shiftKey?t.selectMultiline(r.getSpan(),0,l,h):t.selectChildren(r,0,0),t.scrollIntoView(r.getSpan()),!1}if(n.mac&&o.metaKey&&o.normCode===KeyCode.DownArrow||!n.mac&&o.ctrlKey&&o.normCode===KeyCode.End){var s=t.getLastPaneItem(t.focusedPane);return o.shiftKey?t.selectMultiline(c,u,s.getSpan(),s.getParsedText().length):t.selectChildren(s,s.getParsedText().length,0),t.scrollIntoView(s.getSpan()),!1}if(!n.mac&&o.ctrlKey&&o.normCode===KeyCode.UpArrow&&c){var d,p=e.dataFor(t.getSpanParent(c));if(p.parent()===t.focusedItem)p.isFirstChild()||(d=p.parent().getChild(p.getIndex()-1));else{for(;p.parent()!==t.focusedItem;)p=p.parent();d=p}return void 0!==d&&(t.selectChildren(d,d.getParsedText().length,0),t.scrollIntoView(d.getSpan())),!1}if(!n.mac&&o.ctrlKey&&o.normCode===KeyCode.DownArrow&&l){var d,p=e.dataFor(t.getSpanParent(l));if(p.parent()===t.focusedItem)p.isLastChild()||(d=p.parent().getChild(p.getIndex()+1));else{for(;p.parent()!==t.focusedItem;)p=p.parent();p.isLastChild()||(d=p.parent().getChild(p.getIndex()+1))}return void 0!==d&&(t.selectChildren(d,d.getParsedText().length,0),t.scrollIntoView(d.getSpan())),!1}if(void 0===c||void 0===l)return!0;if(o.normCode===KeyCode.LeftArrow||o.normCode===KeyCode.RightArrow){a();var f=t.getLIParent(c),g=t.getLIParent(l);if(f==g){var p=e.dataFor(f);if(0===p.getParsedText().length){if(o.normCode===KeyCode.LeftArrow){var v=t.getPreviousItem(p,t.focusedPane);v&&t.selectChildren(v,v.getParsedText().length,0)}else if(o.normCode===KeyCode.RightArrow){var y=t.getNextItem(p,t.focusedPane);y&&t.selectChildren(y,0,0)}return!1}}}else if(n.ie&&(o.normCode===KeyCode.UpArrow||o.normCode===KeyCode.DownArrow)){a();var b=e.dataFor(t.getLIParent(c)),S=e.dataFor(t.getLIParent(l));if(o.normCode===KeyCode.UpArrow)var T=t.getPreviousItem(b,t.focusedPane);else if(o.normCode===KeyCode.DownArrow)var T=t.getNextItem(S,t.focusedPane);if(T&&0===T.getParsedText().length)return t.selectChildren(T,0,0),t.scrollIntoView(T.getSpan(),0),!1}return m.updateAutocomplete(o),!0},m.keydown=function(e,t){var i=!0;if(g.indexOf(t.normCode)>=0)i=m.keypress(e,t,!0);else if(v.indexOf(t.normCode)>=0)i=m.handleArrows(e,t);else if(n.mac&&t.metaKey||!n.mac&&t.ctrlKey){if(t.normCode===KeyCode.A)return m.handleSelectAll(e,t);if(t.normCode===KeyCode.Y||t.normCode===KeyCode.Z)return m.keypress(e,t,!0)}switch(t.normCode){case KeyCode.Enter:n.mobile||m.scrollTextIntoView();break;case KeyCode.UpArrow:n.mac&&!t.metaKey&&m.scrollTextIntoView(100);break;case KeyCode.DownArrow:n.mac&&!t.metaKey&&m.scrollTextIntoView(100);break;default:var o=t.normCode>=32&&t.normCode<=90&&t.normCode!==KeyCode.Period||t.normCode===KeyCode.Enter;!o||n.mac&&t.metaKey||!n.mac&&t.ctrlKey||m.scrollTextIntoView()}return i},m.keypress=function(u,h,p){var g=[KeyCode.Enter];h.stopPropagation&&h.stopPropagation();var v=!0,b=h.normCode>=32&&h.normCode!==KeyCode.Period||g.indexOf(h.normCode)>=0,S=n.mobile&&h.normCode===KeyCode.Delete||0===h.which;if(!S&&(p||b)){if(a(),!s&&!i.isEnabled())return!0;if(n.mac&&h.metaKey||!n.mac&&h.ctrlKey){if(h.normCode===KeyCode.Y||h.normCode===KeyCode.Z)return h.normCode!==KeyCode.Z||h.shiftKey?(r.redoAction(),t.sendEvent("Hotkey","Redo")):(r.undoAction(),t.sendEvent("Hotkey","Undo")),h.handled=!0,h.preventDefault&&h.preventDefault(),!0;var T=String.fromCharCode(h.normCode);switch(T){case"c":case"C":return h.handled=!0,!0;case"v":case"V":return h.handled=!0,!0;case"r":case"R":case"a":case"A":return h.handled=!0,!0}}var w;if("UL"==c.nodeName){var M=e.dataFor(c);M instanceof o||(w=M.addItemToPane("",0),E=w.getSpan(),t.selectChildren(w,0,0))}t.restrictSelectionToText(),a();var C=t.getSpanParent(c),x=t.getSpanParent(l);if(!C||!x)return h.stopPropagation(),h.preventDefault(),!1;r.beginAction(),C!=x&&h.normCode!==KeyCode.Tab&&(v=v&&m.handleMultiselect(h,C,x,d));var I=[KeyCode.Tab,KeyCode.Enter,KeyCode.BackSpace,KeyCode.Delete];if(v&&I.indexOf(h.normCode)>=0){var E=t.getSpanParent(s.node);if(E){var k=!1;if(h.shiftKey&&h.normCode===KeyCode.BackSpace){var D=t.getSelectOffsetsInSpan(void 0,E,d);0===D.start&&(k=!0)}h.normCode===KeyCode.Tab||k?v=v&&m.handleTab(h,d):h.normCode===KeyCode.Enter?v=v&&m.handleEnter(h,E,d):h.normCode===KeyCode.BackSpace?(v=v&&m.handleBackspace(h,E,d),y.item||m.updateAutocomplete(h)):h.normCode===KeyCode.Delete&&(v=v&&m.handleDelete(h,E,d))}}var P=h.normCode;h.normCode===KeyCode.Period&&(P=h.shiftKey?KeyCode.RAngle:KeyCode.Delete);var L=String.fromCharCode(P);if(v&&L&&h.normCode!==KeyCode.BackSpace&&h.normCode!==KeyCode.Enter&&!h.ctrlKey){a();var E=t.getSpanParent(s.node);w||(w=t.getItemForElement(E));var O,A=t.getSelectOffsetsInSpan(w,E,d);O=i.isEnabled()?i.getInputText():w.getParsedText();var R=!0,_=O.substr(0,A.startText)+L+O.substr(A.endText);A.startText!==A.endText&&(R=!1,r.performAction(TrackerType.Remove,{itemID:w.id,position:A.startText,text:O.slice(A.startText,A.endText)})),r.performAction(TrackerType.Insert,{itemID:w.id,position:A.startText,text:L}),n.ios?(y.text=_,y.start=A.start+1,y.waitAutocorrect=" "==L?"space":void 0,y.item=w,v=!0):(t.clearSelection(),w.setText(_,!0),t.selectChildren(w,A.start+1,0),v=!1,h.preventDefault&&h.preventDefault(),m.updateAutocomplete(h))}r.endAction()}return f=h.normCode,v},m.handleMultiselect=function(i,o,a,s){var d=[],c=0,l=!0,u=o.parentNode,h=a.parentNode,p=e.dataFor(u),f=e.dataFor(h),m=p,g=t.getSelectOffsetsInSpan(p,o,s),v=t.getSelectOffsetsInSpan(f,a,s),y=0;do{var b={numLevels:0};m=t.getNextItem(m,t.focusedPane,b),m&&(m.parent()===t.focusedPane.item()&&m.isHeader()&&y++,c+=b.numLevels,(m!==f||v.end===v.total)&&d.push(m))}while(m&&m!==f);var S=!0;if(d.length>=16&&y>=2&&n.isPackagedApp&&(S=confirm("You have selected a large number of items to delete, please confirm you want to perform this action.")),S){var T;if(g.start>0||v.end<v.total){var w=p.getParsedText(),M=f.getParsedText().substring(v.endText);T=w.substring(0,g.startText)+M,r.performAction(TrackerType.Remove,{itemID:p.id,position:g.startText,text:w.slice(g.startText)}),r.performAction(TrackerType.Insert,{itemID:p.id,position:g.startText,text:M}),d.indexOf(f)<0&&d.push(f),0===g.start&&p.copyProperties(f)}else r.performAction(TrackerType.Remove,{itemID:p.id,position:0,text:p.getParsedText()}),T="";if((i.normCode===KeyCode.BackSpace||i.normCode===KeyCode.Delete||i.normCode===KeyCode.Enter)&&(l=!1),f.moveChildren(p,0),c>0){var C,x=[];C=h.children.length>1?h.children[1].children[0]:h.nextElementSibling;for(var I=C;c>0&&I;){for(c--;void 0!==I&&null!==I;)x.push(I),I=I.nextElementSibling;C=C.parentElement.parentElement,I=C.nextElementSibling}if(x.length>0)for(var E=p,k=0,D=0;D<x.length;D++){var P=e.dataFor(x[D]),L=P.parent();if(d.indexOf(L)>=0){P.moveTo({parent:E,index:k});var O=P.parent().getIndexOf(P);r.performAction(TrackerType.Move,{itemID:P.id,oldParent:L.id,oldPosition:O,newParent:E.id,newPosition:k}),k++}}}for(var D=0;D<d.length;D++){var P=d[D];P.isDeleted||P.parent().deleteChild(P)}p.setText(T,!0),t.selectChildren(p,g.start,0)}else l=!1;return l},m.handleTab=function(n,o){if(i.isEnabled())var a=i.getCurrentVMLI(),s=i.getCurrentVMLI();else var d=t.getSpanParent(o.startContainer),c=t.getSpanParent(o.endContainer),l=t.getSelectOffsetsInSpan(void 0,d,o),u=t.getSelectOffsetsInSpan(void 0,c,o),a=e.dataFor(d.parentNode),s=e.dataFor(c.parentNode);var h,p,f=a,m={},g=[a],v={},y={};if(y[a.id]=!0,a!==s)do{var b={numLevels:0,ignoreSearch:!0};f=t.getNextItem(f,void 0,b),h=f.parent(),g.push(f),y[f.id]=!0}while(f!==s);var S,T,w;if(n.shiftKey)var M=function(){S=g.length-1},T=function(){return S>=0},w=function(){S--};else var M=function(){S=0},T=function(){return S<g.length},w=function(){S++};for(M();T();w()){var C,x,I=g[S],h=I.parent(),E=h.items().indexOf(I);if(n.shiftKey){if(C=I.parent()!=t.focusedItem){p=I.parent().parent();{var k=h.items();k.length-E-1}for(x=E+1;k[E+1];){var D=k[E+1];y[D.id]||t.hasClass(D.getElement(),"hidden")?E++:(m[D.parent().id]=D.parent(),m[I.id]=I,D.moveTo({parent:I,underlying:!0}),v[D.id]=!0,r.performAction(TrackerType.Move,{itemID:D.id,oldParent:h.id,oldPosition:x,newParent:I.id,newPosition:I.items().length-1})),x++}if(y[h.id]>=0&&(!h.parent()||h.parent()!=t.focusedItem))continue;var P=p.items().indexOf(h);m[I.parent().id]=I.parent(),m[p.id]=p,I.moveTo({parent:p,index:P+1,underlying:!0}),v[I.id]=!0,r.performAction(TrackerType.Move,{itemID:I.id,oldParent:h.id,oldPosition:E,newParent:p.id,newPosition:P+1})}}else{if(C=E>0){for(p=h.items()[E-1];t.hasClass(p.getElement(),"hidden");){if(E--,0>=E)return!1;p=h.items()[E-1]}v[h.id]||(m[I.parent().id]=I.parent(),m[p.id]=p,I.moveTo({parent:p,underlying:!0})),v[I.id]=!0,r.performAction(TrackerType.Move,{itemID:I.id,oldParent:h.id,oldPosition:E,newParent:p.id,newPosition:p.items().length-1})}else p=h,v[I.id]=v[h.id];for(var L=!1,O=I;O;){if(v[O.id]){L=!0;break}O=O.parent()}var A=I.getIndex()+1;if(L){var R=I.items(),_=0;for(x=0;x<R.length;x++){var N=R[x];if(!y[N.id]){if(t.hasClass(N.getElement(),"hidden"))continue;m[N.parent().id]=N.parent(),m[I.parent().id]=I.parent();var F=A+_;N.moveTo({parent:I.parent(),index:F,underlying:!0}),v[N.id]=!0,r.performAction(TrackerType.Move,{itemID:N.id,oldParent:I.id,oldPosition:x,newParent:I.parent().id,newPosition:F}),_++,x--}}}}}for(var V in m)m[V].items.valueHasMutated();return i.isEnabled()?i.updateInputBounds(a):(a||s)&&t.selectMultiline(a.getSpan(),l.start,s.getSpan(),u.end),n.handled=!0,n.preventDefault&&n.preventDefault(),!1},m.handleEnter=function(e,a,s){var d=t.getItemForElement(a),c=d.parent(),l=c.items().indexOf(d),u=t.getSelectOffsetsInSpan(d,a,s);i.isEnabled()&&i.finishInput(!0);var h,f=d.getParsedText(),g=!1,v=c,b=!0;if(0===u.end&&""!==f)h=d.isNumList()?new o({text:NumListPrefix},{parent:v,forceSave:!0}):new o({text:""},{parent:v,forceSave:!0}),l--,b=!1;else if(u.start>=u.total){g=!e.shiftKey&&!d.isCollapsed()&&(d.items().length>0||d.isHeader()),g&&(v=d);var S="";d.isNumList()&&(S=NumListPrefix),h=new o({text:S},{parent:v,forceSave:!0})}else if(0===u.start&&u.end===u.total)h=new o({text:""},{parent:v,forceSave:!0}),d.setText("",!0),r.performAction(TrackerType.Remove,{itemID:d.id,position:0,text:f});else{var T=u.start>0?f.substring(0,u.startText):"";secondText=u.endText<f.length?f.substring(u.endText):"",d.isNumList()&&(secondText=NumListPrefix+secondText),h=new o({text:T},{parent:v,forceSave:!0}),d.setText(secondText,!0),r.performAction(TrackerType.Remove,{itemID:d.id,position:u.startText,text:f.substring(u.startText)}),h.copyProperties(d),l--,b=!1}h.parseText(!0),g?(d.insertItem(h,0),r.performAction(TrackerType.Create,{itemID:h.id,parent:d.id,position:0,text:h.getParsedText()})):(v.insertItem(h,l+1),r.performAction(TrackerType.Create,{itemID:h.id,parent:v.id,position:l+1,text:h.getParsedText()}));var w=b?h:d;return n.ios?(y.start=u.start,y.waitAutocorrect="enter",y.item=b?d:h,y.nextItem=b?h:d,p||(p=t.element("tempInput")),p.innerHTML=y.item.getStyledText(),t.selectMultiline(p,u.start,p,u.start),!0):i.isEnabled()?(i.updateInput(w,0),e.preventDefault&&e.preventDefault(),m.scrollTextIntoView(),!1):(t.selectChildren(w,0,0),e.preventDefault&&e.preventDefault(),!1)},m.handleBackspace=function(e,o,a){var s=t.getItemForElement(o),d=s.parent(),c=t.getSelectOffsetsInSpan(s,o,a);i.isEnabled()&&i.finishInput(!0),n.ie&&(e.preventDefault(),e.stopImmediatePropagation());var l=s.getParsedText(),u=(s.getSpan(),""),h=0;if(0===c.startText&&0===c.endText||""===l){var p=t.getPreviousItem(s,t.focusedPane),g=t.getNextItem(s,t.focusedPane);if(p&&(!p.isFullscreen()||""===l&&g)){var v=p.getParsedText().length;d.deleteChild(s,p,0),l.length>0&&""!==l&&(0===p.getParsedText().length&&p.copyProperties(s),p.setText(p.getParsedText()+l,!0),r.performAction(TrackerType.Insert,{itemID:p.id,position:v,text:l}));var b=p.isFullscreen()?p.getFirstChild():p,S=p.isFullscreen()?0:v;return t.selectChildren(b,S,0),i.isEnabled()&&m.scrollTextIntoView(),!1}return i.isEnabled()&&i.updateInput(s,c.startText),!1}if(e.metaKey&&c.startText===l.length||0===c.startText&&c.endText===l.length)r.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:s.getParsedText()}),u="",h=0;else if(e.metaKey)u=l.substring(c.startText),r.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:l.slice(0,c.startText)}),h=0;else if((n.mac&&e.altKey||!n.mac&&e.ctrlKey)&&c.start===c.end){for(var T=l.substring(c.startText),w=!1,M=!1,C=c.startText-1;C>=0&&!M;C--)if(w=w||" "!==l[C],!(" "==l[C]&&" "==l[C-1]||0!==C&&" "!==l[C]&&"@"!==l[C])){var x=0===C||C===c.startText-1?C:C+1;(w||" "!==l[C])&&(r.performAction(TrackerType.Remove,{itemID:s.id,position:x,text:l.slice(x,c.startText)}),u=l.substring(0,x)+T,h=x,M=!0)}M||(c.startText===l.length?0===c.start&&(u="",r.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:l})):(r.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:l.slice(0,c.startText)}),u=T),h=0)}else if(1===c.start&&1===c.end&&1===l.length&&""!=l[0])r.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:s.getParsedText()}),u="",h=0;else if(c.start!=c.end)r.performAction(TrackerType.Remove,{itemID:s.id,position:c.startText,text:l.slice(c.startText,c.endText)}),u=l.substr(0,c.startText)+l.substr(c.endText),h=c.start;else{var I=1;l.length>1&&""==l[c.startText-1]&&I++,u=l.substr(0,c.startText-I)+l.substr(c.startText),r.performAction(TrackerType.Remove,{itemID:s.id,position:c.startText-I,text:l.slice(c.startText-I,c.startText)}),h=c.startText-I}return n.phone&&!i.isEnabled()&&f!==KeyCode.BackSpace?(y.text=u,y.start=h,y.item=s,0===u.length&&(s.setStyledText(TextSpace+" ",!0),t.selectChildren(s,1,0)),!0):(s.setText(u,!0),t.selectChildren(s,h,0),!1)},m.handleDelete=function(i,o,a){{var s=e.dataFor(o.parentNode),d=t.getSelectOffsetsInSpan(s,o,a),c=s.parent(),l=s.getIndex(),u=s.getParsedText();s.getSpan()}if(""===u){var h=t.getNextItem(s,t.focusedPane),p=0;h||(h=t.getPreviousItem(s,t.focusedPane),p=h.getParsedText().length),h&&!h.isFullscreen()&&(s.hasChildren()?c.replaceChild(s,s.getFirstChild()):c.deleteChild(s,c,l),t.selectChildren(h,p,p))}else if(d.start===d.total&&d.end===d.total||d.start===d.total-1&&d.end===d.total-1&&""===o.textContent[d.endText]){var f=t.getNextItem(s,t.focusedPane);f&&(s.setText(u+f.getParsedText(),!0),r.performAction(TrackerType.Insert,{itemID:s.id,position:u.length,text:f.getParsedText()}),f.parent().deleteChild(f,s,0),t.selectChildren(s,d.total,0))}else if(0===d.start&&0===d.end&&1===u.length&&""!=u[0])s.setText("",!0),r.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:u});else if((n.mac&&i.altKey||!n.mac&&i.ctrlKey)&&d.start===d.end){for(var m=u.substring(0,d.startText),g=!1,v=!1,y=d.startText;y<u.length&&!v;y++)if(g=g||" "!==u[y],y===u.length-1||" "===u[y]){var b=" "===u[y]&&" "==u[d.startText]?y:y+1;if(g||" "!==u[y]){var S=m+u.substring(b);s.setText(S,!0),r.performAction(TrackerType.Remove,{itemID:s.id,position:b,text:S}),t.selectChildren(s,d.start,0),v=!0}}}else if(d.start!=d.end){var S=u.substr(0,d.startText)+u.substr(d.endText);s.setText(S,!0),r.performAction(TrackerType.Remove,{itemID:s.id,position:d.startText,text:u.slice(d.startText,d.endText)}),t.selectChildren(s,d.start,0)}else{var S=u.substr(0,d.startText)+u.substr(d.startText+1);s.setText(S,!0),r.performAction(TrackerType.Remove,{itemID:s.id,position:d.startText,text:u.slice(d.startText,d.startText+1)}),t.selectChildren(s,d.start,0)}return!1},m}),define("AScript",["globals","platform","data","tracker","VMLI","edit"],function(e,t,n){function i(){this.queueDebug=!1,this.videoPhone=!1,this.hasSelection=!1,this.isTyping=!1,this.isRunning=!1,this.isDisabled=!1,this.activeScript=void 0,this.index=0,this.repeat=!1,this.onScriptDone=void 0,this.selectedItem=void 0,this.needsFinish=!1,this.lastLoadedData=void 0,this.savedItems={},this._scriptQueue=[],this.startText={},window.addEventListener("message",function(e){if(e.data.indexOf("{")<0){var t=e.data.split(":");switch(t[0]){case"script":this.finishAndRunScript(t[1]);break;case"data":this.loadScriptData(t[1]);break;case"start":this.start();break;case"restart":this.restart()}}}.bind(this),!1),window.pauseScript=function(){this.isDisabled||(log("pause script"),this.isDisabled=!0)}.bind(this)}var o={Run:1,Reset:2};return i.prototype={runScript:function(e,t){var n=!0;if(!this.isDisabled){switch(e){case"search":this._scriptQueue.push(this.demoSearch(e));break;case"p0":case"p1":case"p2":case"p3":case"p4":case"p5":var i=parseInt(e.replace("p",""),10);this._scriptQueue.push(this.demoPrioritize(e,i)),t=!1;break;case"f0":case"f1":case"f2":case"f3":case"f4":case"f5":var i=parseInt(e.replace("f",""),10);this._scriptQueue.push(this.demoFocus(e,i)),t=!1;break;case"test":this._scriptQueue.push(this.demoTest(e)),t=!1;break;case"indent":this._scriptQueue.push(this.demoIndent(e));break;case"travel":this._scriptQueue.push(this.demoTravel()),t=!1;break;case"video":this._scriptQueue.push(this.demoVideo()),t=!1;break;case"videoPhone":this._scriptQueue.push(this.demoVideo(!0)),t=!1,n=!1;break;case"none":return}this.repeat=t,this.activeScript=this._scriptQueue[0],!this.isRunning&&this.activeScript&&n&&this.start()}},start:function(){this.onScriptStart(this.activeScript),this.reset(),this.run()},restart:function(){this.activeScript=this._scriptQueue[0],this.activeScript.index=0,this.start()},forceFinish:function(e){this.isRunning?(this.needsFinish=!0,this.delayTimeout&&(clearTimeout(this.delayTimeout),this.delayCb(),this.delayCb=this.delayTimeout=void 0),this.onScriptDone=function(){this.needsFinish=!1,e(),this.onScriptDone=void 0}.bind(this)):e()},finishAndRunScript:function(e){this._scriptQueue=[],this.repeat=!1,this.forceFinish(function(){this.runScript(e,!1)}.bind(this))},loadScriptData:function(t){log("Load Script Data: ",t),this._scriptQueue=[],this.repeat=!1,this.lastLoadedData!==t&&(this.lastLoadedData=t,e.vmMain.resetScrollOffsets(),n.loadDemoData(t,!1,e.vmMain.changeRoot))},onScriptStart:function(e){e&&window.parent.postMessage(e.getName(),"*")},getRoot:function(){return n.getRootModel()},getFirstItem:function(){return n.getRootModel().getChild(0)},setSelection:function(t,n,i,o,r){e.isString(t)&&(t=this.savedItems[t]),e.focusedPaneID!==n&&e.vmMain.setFocusedPane(e.vmMain.panes[n]),void 0===i||null===i?i=0:0>i&&(i=t.getParsedText().length+i+1),e.selectChildren(t,i,o),this.hasSelection=!0,this.selectedItem=t,r&&r()},selectEndOfLine:function(e,t,n){this.setSelection(e,t,-1,0,n)},clearSelection:function(t){e.clearSelection(),this.hasSelection=!1,this.selectedItem=void 0,t&&t()},scrollTo:function(t,n,i){var o=e.vmMain.panes()[t];o.setScrollOffset(n),i&&i()},setText:function(e,t,n){e=e||this.selectedItem,e.setText(t,!0),n&&n()},appendText:function(e,t,n){e.setText(e.getRawText()+t,!0),n&&n()},removeText:function(e,t,n){var i=e.getRawText().replace(t,"");e.setText(i,!0),n&&n()},setPriority:function(e,t,n){e=e||this.selectedItem,e.priority(t),n&&n()},setStarred:function(e,t,n){e=e||this.selectedItem,e.isStarred(t),n&&n()},setComplete:function(e,t,n,i){e=e||this.selectedItem,e.dateCompleted=n,e.isComplete(t),i&&i()},indent:function(t,n){var i={normCode:KeyCode.Tab,shiftKey:t};e.fireKeyEvent(void 0,i),n&&n()},_deleteChildren:function(e){for(;e.items().length>0;)this._deleteChildren(e.items()[0]),e.items()[0].deleteSelf()},clearChildren:function(e,t){this._deleteChildren(e),t&&t()},scrollToTop:function(t,n,i){t=t||this.selectedItem,e.scrollToTop(t.getSpan(),n),setTimeout(i,n)},repeatBackspace:function(e,t,n,i){function o(){s=s.substr(0,s.length-1),e.setText(s,!0),++a>=t&&(r&&clearInterval(r),this.isTyping=!1,i&&i())}this.needsFinish&&(n=0),this.selectEndOfLine(e||this.selectedItem,0),this.isTyping=!0;var r,a=0,s=e.getRawText();r=setInterval(o.bind(this),n)},typeString:function(t,n,i,o){function r(){this.videoPhone&&this.setSelection(t,0,-1,0);var i=n.charCodeAt(s);i===KeyCode.Delete&&(i=KeyCode.Period),e.fireKeyEvent(void 0,{normCode:i}),++s>=n.length&&(a&&clearInterval(a),this.isTyping=!1,o&&o())}this.needsFinish&&(i=0),t=t||this.selectedItem,this.isTyping=!0;{var a,s=0;t.getRawText()}r.apply(this),a=setInterval(r.bind(this),i)},resetSearch:function(t){for(var n=0;n<e.vmMain.panes().length;n++)e.vmMain.panes()[n].vmSearch.setSearch("");t&&t()},hideAutoComplete:function(t){e.autocomplete&&e.autocomplete.hide(),t&&t()},setSearch:function(t,n,i){e.vmMain.panes()[n].vmSearch.setSearch(t),i&&i()},searchString:function(t,n,i,o,r){this.isTyping=!0;var a=e.vmMain.panes()[o].vmSearch,s=i?"":a.search(),d=0,c=setInterval(function(){a.setSearch(s+t.substr(0,d+1)),++d>=t.length&&(clearInterval(c),this.isTyping=!1,r&&r())}.bind(this),n)},createItemAfter:function(t,n,i){t=t||this.selectedItem,this.setSelection(t,0,t.getParsedText().length,0),e.fireKeyEvent(void 0,{normCode:KeyCode.Enter}),this.clearSelection(function(){var e;e=t.isHeader()?t.getChild(0):t.parent().getChild(t.getIndex()+1),n&&(this.savedItems[n]=e),this.selectedItem=e,this.setSelection(e,0,-1,0,i)}.bind(this))},clickElement:function(t,n){e.fireClickEvent(t,ButtonCode.Left),n&&n()},clickContact:function(t,n){e.isString(t)&&(t=this.savedItems[t]);var i=this.getContactForItem(t);i&&this.clickElement(i,n)},getContactForItem:function(t){e.isString(t)&&(t=this.savedItems[t]);var n=t.getSpan();if(n)for(var i=0;i<n.childElementCount;++i){var o=n.children[i];if(e.hasClass(o,"contact"))return o}return void 0},clickPhone:function(e,t){var n=document.getElementsByClassName("contactNumber")[0];this.showTapIndicator(n,.4,-.2,e),t()},zoomItem:function(t,n){e.vmMain.zoomin(t,!1),n&&n()},openOutline:function(t,n){var i=e.vmMain.panes()[t];i.outlineVisible()||i.toggleOutlineVisibility(),n&&n()},closeOutline:function(t,n){var i=e.vmMain.panes()[t];i.outlineVisible()&&i.toggleOutlineVisibility(),n&&n()},openContextMenu:function(t,n){var i=t.getElement().getBoundingClientRect(),o=i.left+150,r=i.top+10;e.menus.openItemMenu(t,{x:o,y:r}),n&&n()},closeContextMenu:function(t){e.menus.closeItemMenu(),t&&t()},hoverMenuItem:function(t,n){e.addClass(t,"menuHover"),n&&n()},unhoverMenuItem:function(t,n){e.removeClass(t,"menuHover"),n&&n()},delay:function(e,t){t&&(this.needsFinish||0===e?t&&t():(this.delayCb=t,this.delayTimeout=setTimeout(function(){this.delayCb=this.delayTimeout=void 0,t()}.bind(this),e)))},setPaneModeAnim:function(e,t,n){var i=document.getElementsByClassName("paneOptionsButton")[e];this.clickElement(i),this.delay(function(){var i=t===PaneMode.Timeline?"paneTimelineView":"paneListView",o=document.getElementsByClassName(i)[e];this.hoverMenuItem(o),this.delay(function(){this.clickElement(o),this.unhoverMenuItem(o),n&&n()}.bind(this),800)}.bind(this),300)},setPaneModeInstant:function(t,n,i){var o=e.vmMain.panes()[t];o.mode(n),i&&i()},addPane:function(t,n){e.vmMain.addPaneToRight(t),n&&n()},removePaneAnim:function(e,t){var n=document.getElementsByClassName("paneOptionsButton")[e];this.clickElement(n),this.delay(function(){var n=document.getElementsByClassName("paneClose")[e];this.hoverMenuItem(n),this.delay(function(){this.clickElement(n),this.unhoverMenuItem(n),t&&t()}.bind(this),800)}.bind(this),300)},removePaneInstant:function(t,n){var i=e.vmMain.panes()[t];e.vmMain.removePane(i),n&&n()},setSubtitle:function(t,n,i){var o=e.messageQueue.pushMessage({text:t,type:MessageType.Subtitle});setTimeout(function(){e.messageQueue.clearMessage(o),i&&i()}.bind(this),n)},dragTo:function(t,n,i,o,r){function a(e){return.5>e?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1}function s(t){g||(g=t);var h=a((t-g)/o);d=f*h,c=m*h,e.fireDragMove(e.dragging?e.dragging:l,d,c),h>=1?(e.vmMain.setDropInfo(n.getChild(i),u,!1,"itemDraggingAbove"),e.fireDragEnd(l),r&&r()):requestAnimationFrame(s)}e.isString(t)&&(t=this.savedItems[t]),e.isString(n)&&(n=this.savedItems[n]);var d,c,l=t.getSpan(),u=n.getChild(i).getSpan(),h=l.getBoundingClientRect(),p=u.getBoundingClientRect(),f=p.left-h.left,m=p.top-h.top,g=null;e.fireDragStart(l),requestAnimationFrame(s)},showTapIndicator:function(t,n,i,o,r){e.isString(t)?t=this.savedItems[t].getSpan():e.isFunction(t)&&(t=t());var a=t.getBoundingClientRect(),s=a.top+a.height*i,d=a.left+a.width*n,c=document.getElementById("tapind");c.style.display="block",c.style.top=s+"px",c.style.left=d+"px",c.style.opacity=1,setTimeout(function(){c.style.opacity=0,setTimeout(function(){c.style.display="none"},o/2)},o/2),r&&r()},debug:function(){},enableQueueDebug:function(){this.queueDebug=!0},disableQueueDebug:function(){this.queueDebug=!1},createScript:function(e){var t={owner:this,_name:e,index:0,isResetting:!1,_repeat:!1,noDelay:!1,runQueue:[],resetQueue:[],_activeQueue:function(){return this.isResetting?this.resetQueue:this.runQueue},queue:function(e,t){var n=Array.prototype.slice.call(arguments,2),i=e==o.Run?this.runQueue:this.resetQueue;return i.push({name:t,args:n}),i},repeat:function(e){this._repeat=e},reset:function(){this.index=0;for(var e=0;e<this.resetQueue.length;e++){var t=this.resetQueue[e];this.owner[t.name].apply(this.owner,t.args)}},nextStep:function(){var e=this.runQueue;return e[this.index++]},getName:function(){return this._name}};return t},reset:function(){this.index=0;for(var e=0;e<this._scriptQueue.length;e++)this._scriptQueue[e].reset()},run:function(){if(!this.isDisabled){var t=this.activeScript.nextStep();if(!t){if(this.index++,this.index>=this._scriptQueue.length){if(!this.repeat)return this.isRunning=!1,void(this.onScriptDone&&this.onScriptDone());this.reset()}this.activeScript=this._scriptQueue[this.index],this.activeScript.reset(),this.onScriptStart(this.activeScript),t=this.activeScript.nextStep()}var n=t.args;n.push(this.run.bind(this)),n.push(this.activeScript),this.isRunning=!0,setTimeout(function(){try{this.queueDebug,this[t.name].apply(this,n)}catch(i){e.reportError(i),this.onDisable()}}.bind(this),0)}},onDisable:function(){this.isDisabled=!0},transform:function(n,i,o,r){return this.videoPhone?void r():(e.element("main").style[t.transition.style]="all "+o+"ms ease-in-out",e.element("main").style[t.transformOrigin.style]=i,e.element("main").style[t.transform.style]="scale("+n+")",setTimeout(function(){e.element("main").style.display="none",e.element("main").offsetHeight,e.element("main").style.display=""},o),void(r&&r()))},transformAutocomplete:function(n,i){return this.videoPhone?void i():(e.element("autocomplete").style[t.transformOrigin.style]="0 0",e.element("autocomplete").style[t.transform.style]="scale("+n+")",void i())},blur:function(e,t){e=e||this.selectedItem,e.getSpan().style["-webkit-filter"]="blur(5px)",t&&t()},flash:function(e){var t=document.getElementsByClassName("paneContent")[0];t.style.background="red",setTimeout(function(){t.style.background="",e()},500)},clearFromIs:function(t,n){var i=e.getLastPaneItem(e.focusedPane);i=e.getPreviousItem(i,e.focusedPane),e.selectMultiline(t.getSpan(),10,i.getSpan(),i.getRawText().length),setTimeout(function(){e.fireKeyEvent(void 0,{normCode:KeyCode.BackSpace}),this.selectedItem=t,n&&setTimeout(n,500)}.bind(this),500)},notify:function(e,t){window.parent.postMessage(e,"*"),t()},addClass:function(t,n){e.addClass(document.documentElement||document.body,t),n()},removeClass:function(t,n){e.removeClass(document.documentElement||document.body,t),n()
},demoVideo:function(t){function i(e,t,n,i){c.queue(o.Run,"createItemAfter",d,t),-1===n?c.queue(o.Run,"indent",!0):1===n&&c.queue(o.Run,"indent",!1),i?c.queue(o.Run,"setText",d,e):c.queue(o.Run,"typeString",d,e,u)}function r(e,t){e="_____________",c.queue(o.Run,"createItemAfter",d,e),-1===t?c.queue(o.Run,"indent",!0):1===t&&c.queue(o.Run,"indent",!1),c.queue(o.Run,"setText",d,e),c.queue(o.Run,"setSelection",e,0,-1,0)}function a(e){c.queue(o.Run,"setText",l,"Moo.do is "+(e?e:"")),c.queue(o.Run,"clearChildren",l),c.queue(o.Run,"createItemAfter",l,d),c.queue(o.Run,"indent",!1),c.queue(o.Run,"setSelection",l,0,-1,0)}function s(e){c.queue(o.Run,"delay",e)}this.videoPhone=t,window.__IS_DEMO_VIDEO=!0;var d=void 0,c=this.createScript("travel"),l=n.itemsById.itemFirst.model;e.element("container").style["padding-top"]="10px",e.addClass(document.documentElement||document.body,"demoVideo");var u=40,h=50,p=1e3,f=1e3,m=400,g=!0,v=!0,y=!0,b=!0,S=!0,T=!0,w=!0;if(this.videoPhone&&(g=v=y=b=S=!1),g?(a("organized"),c.queue(o.Run,"transform",5.5,"20px 85px",0),this.videoPhone||c.queue(o.Run,"notify","video_started"),s(3*f)):(a("organized"),c.queue(o.Run,"notify","video_started")),v&&(c.queue(o.Run,"clearFromIs",l),c.queue(o.Run,"transform",3.2,"35px 115px",p),c.queue(o.Run,"typeString",d,"a notepad",h),s(f),c.queue(o.Run,"createItemAfter",d,d),c.queue(o.Run,"indent",!1),c.queue(o.Run,"delay",500),c.queue(o.Run,"typeString",d,"It's easier than writing on paper",u),s(f),i("And it's much smarter"),s(f)),y&&(c.queue(o.Run,"clearFromIs",l),window.__DRAG_SCALE=2.6,s(f/4),c.queue(o.Run,"transform",2.6,"26px 130px",p),s(f/2),c.queue(o.Run,"typeString",d,"a todo list",h),s(f),i("Complete items when they're done"),s(f/4),c.queue(o.Run,"setComplete",d,!0,new Date),s(f),i("Mark items as high priority","priority"),c.queue(o.Run,"setPriority",d,VMLIFlag.P0),s(f/2),c.queue(o.Run,"setSelection","priority",0,14,4),s(f/2),c.queue(o.Run,"typeString",d,"medium",2*u),c.queue(o.Run,"setPriority",d,VMLIFlag.P1),s(f/2),c.queue(o.Run,"setSelection","priority",0,14,6),s(f/2),c.queue(o.Run,"typeString",d,"low",2*u),c.queue(o.Run,"setPriority",d,VMLIFlag.P2),s(f),i("Highlight for emphasis"),s(200),c.queue(o.Run,"setStarred",d,!0),s(f),i("Quickly re-order your lists","dragger"),s(f/2),c.queue(o.Run,"dragTo","dragger",l,0,1e3),s(f)),b){c.queue(o.Run,"clearFromIs",l);var M=80;s(f/4),c.queue(o.Run,"transform",1.7,"0px 210px",p),s(f/2),c.queue(o.Run,"typeString",d,"an outliner",u),s(f),i("Create as many projects and lists as you want",d,1),s(f),r("A header of a project",1,!0),s(M),r("Some words",d,!0),s(M),r("Blah blah",1,!0),s(M),r("A thing to do",d,!0),s(M),r("This project",1,!0),s(M),i("Focus on what's relevant right now",0,d,!0),s(M),r("Am I right?",1,!0),s(M),r("Something that's super serial",-1,!0),s(M),r("A thing on a list",-1,!0),s(M),r("I should probably do this",d,!0),s(f),c.queue(o.Run,"transform",1.5,"-40px 0px",800),s(f),c.queue(o.Run,"searchString","relevant",200,!1,0),s(2*f)}if(S){var C=100;a(),c.queue(o.Run,"setSearch","",0),s(f/4),c.queue(o.Run,"transform",1.15,"0px 0px",p),s(f/2),c.queue(o.Run,"typeString",d,"a planner",u),s(f),i("Schedule appointments @"),s(f),c.queue(o.Run,"typeString",d,"tomorrow 4:30pm",C),s(f),i("Get a task done by @","task"),s(500),c.queue(o.Run,"typeString",d,"friday",C),s(f),i("Remember a date @"),s(500),c.queue(o.Run,"typeString",d,Date.today().addDays(4).toString("M/dd"),C),s(f),i("Prioritize into buckets like @"),s(500),c.queue(o.Run,"typeString",d,"soon",C),s(f),i("See "),c.queue(o.Run,"setPriority",d,VMLIFlag.P0),c.queue(o.Run,"typeString",d,"important tasks on your agenda",u),s(2e3)}return T&&(this.videoPhone||c.queue(o.Run,"notify","video_connected"),c.queue(o.Run,"clearFromIs",l),c.queue(o.Run,"transform",1.4,"40px 0px",p),c.queue(o.Run,"transformAutocomplete",1.3),s(f/2),c.queue(o.Run,"typeString",d,"connected",u),s(f),i("Reference contacts to easily call or email +","contact"),s(f),c.queue(o.Run,"typeString",d,"Jane Johnson",100),s(1.5*f),i("Everything is synchronized "),this.videoPhone||c.queue(o.Run,"notify","video_synchronized"),s(2*f),c.queue(o.Run,"typeString",d,"in realtime",100),s(f),i("Use your computer, tablet, and ","ctp"),this.videoPhone?(s(f),c.queue(o.Run,"showTapIndicator","ctp",.8,.05,m),s(30),c.queue(o.Run,"addClass","demoVideoSelect"),s(f)):s(2*f+1600),c.queue(o.Run,"typeString",d,"phone",200),s(f),c.queue(o.Run,"notify","video_zoom"),s(1.75*f),this.videoPhone&&(c.queue(o.Run,"showTapIndicator",function(){return this.getContactForItem("contact")}.bind(this),.4,.1,m),s(m),c.queue(o.Run,"clickContact","contact")),s(1.75*f),this.videoPhone&&(c.queue(o.Run,"clickPhone",m),s(300),c.queue(o.Run,"notify","video_phone")),s(1.75*f)),w&&this.videoPhone&&c.queue(o.Run,"notify","video_conclusion"),c},demoTravel:function(){var e=void 0,t=this.createScript("travel"),i=n.itemsById.itemFirst.model;return t.queue(o.Run,"delay",500),t.queue(o.Run,"typeString",i,"Vacation!",50),t.queue(o.Run,"createItemAfter",e,e),t.queue(o.Run,"indent",!1),t.queue(o.Run,"typeString",e,"Where to go",50),t.queue(o.Run,"createItemAfter",e,"sf"),t.queue(o.Run,"indent",!1),t.queue(o.Run,"typeString",e,"San Francisco",50),t.queue(o.Run,"createItemAfter",e,"lv"),t.queue(o.Run,"typeString",e,"Las Vegas",50),t.queue(o.Run,"createItemAfter",e,"sd"),t.queue(o.Run,"typeString",e,"San Diego",50),t.queue(o.Run,"createItemAfter",e,"sea"),t.queue(o.Run,"typeString",e,"Seattle",50),t.queue(o.Run,"setSelection","sf",0,-1,0),t.queue(o.Run,"createItemAfter",e,e),t.queue(o.Run,"indent",!1),t.queue(o.Run,"typeString",e,"http://balls",50),t.queue(o.Run,"setSelection","lv",0,-1,0),t.queue(o.Run,"createItemAfter",e,e),t.queue(o.Run,"indent",!1),t.queue(o.Run,"typeString",e,"http://balls",50),t.queue(o.Run,"setSelection","sd",0,-1,0),t.queue(o.Run,"createItemAfter",e,e),t.queue(o.Run,"indent",!1),t.queue(o.Run,"typeString",e,"http://balls",50),t.queue(o.Run,"setSelection","sea",0,-1,0),t.queue(o.Run,"createItemAfter",e,e),t.queue(o.Run,"indent",!1),t.queue(o.Run,"typeString",e,"http://balls",50),t},demoTest:function(t){for(var n=this.createScript(t),i=this.getFirstItem();i;)n.queue(o.Run,"showTapIndicator",i.getSpan(),1*Math.random(),0,400),i=e.getNextItem(i);return n},demoIndent:function(e){var t=this.createScript(e),i=n.itemsById.itemIndent.model;return t.queue(o.Run,"delay",2e3),t.queue(o.Run,"setSelection",i,0,0,0),t.queue(o.Run,"indent",!1),t.queue(o.Run,"delay",2e3),t.queue(o.Run,"setSelection",i,0,0,0),t.queue(o.Run,"indent",!0),t},demoSearch:function(e){var t=this.createScript(e),i=2e3,r=n.itemsById.searchItem.model;return t.queue(o.Run,"delay",i),t.queue(o.Run,"setSearch","#tag",0),t.queue(o.Run,"delay",i),t.queue(o.Run,"resetSearch"),t.queue(o.Run,"delay",i),t.queue(o.Run,"setSearch","!",0),t.queue(o.Run,"delay",i),t.queue(o.Run,"setSearch","!!!",0),t.queue(o.Run,"delay",i),t.queue(o.Run,"resetSearch"),t.queue(o.Run,"delay",i),t.queue(o.Run,"zoomItem",r),t.queue(o.Run,"delay",i),t.queue(o.Run,"setSearch","#tag",0),t.queue(o.Run,"delay",i),t.queue(o.Run,"zoomItem",this.getRoot()),t.queue(o.Run,"resetSearch"),t.queue(o.Run,"delay",i),t.queue(o.Run,"setSearch","+Jane",0),t.queue(o.Run,"delay",i),t.queue(o.Reset,"resetSearch"),t},loadItemAndReset:function(e,t){var i,r=n.itemsById[e].model;return i=this.startText[e]?this.startText[e]:this.startText[e]=n.itemsById[e].data.text,log("reset text = ",i),t.queue(o.Reset,"setText",r,i),t.queue(o.Reset,"setPriority",r,VMLIFlag.None),t.queue(o.Reset,"setStarred",r,!1),t.queue(o.Reset,"setComplete",r,!1,void 0),r},demoPrioritize:function(e,t){var n=this.createScript(e),i=this.loadItemAndReset("yard",n),r=this.loadItemAndReset("roof",n),a=this.loadItemAndReset("vacation",n),s=this.loadItemAndReset("chips",n),d=this.loadItemAndReset("present",n),c=this.loadItemAndReset("shorts",n),l=this.loadItemAndReset("laptop",n),u=this.loadItemAndReset("app",n);return 0===t?(n.queue(o.Run,"appendText",i," @later"),n.queue(o.Run,"appendText",r," @soon"),n.queue(o.Run,"appendText",a," @later"),n.queue(o.Run,"appendText",s," @now"),n.queue(o.Run,"appendText",d," @now"),n.queue(o.Run,"appendText",c," @later"),n.queue(o.Run,"appendText",l," @soon"),n.queue(o.Run,"appendText",u," @now")):1===t?(n.queue(o.Run,"appendText",i," @next friday"),n.queue(o.Run,"appendText",r," @tomorrow"),n.queue(o.Run,"appendText",a," @"+Date.today().addDays(42).toString("M/dd")),n.queue(o.Run,"appendText",s," @today 6pm"),n.queue(o.Run,"appendText",d," @today 3pm"),n.queue(o.Run,"appendText",c," @"+Date.today().addDays(4).toString("M/dd")),n.queue(o.Run,"appendText",l," @"+Date.today().addDays(3).toString("M/dd")),n.queue(o.Run,"appendText",u," @today "+(new Date).toString("h:mmtt"))):2===t?(n.queue(o.Run,"setPriority",i,VMLIFlag.P2),n.queue(o.Run,"setPriority",r,VMLIFlag.P1),n.queue(o.Run,"setPriority",a,VMLIFlag.P2),n.queue(o.Run,"setPriority",s,VMLIFlag.P0),n.queue(o.Run,"setPriority",d,VMLIFlag.P0),n.queue(o.Run,"setPriority",c,VMLIFlag.P2),n.queue(o.Run,"setPriority",l,VMLIFlag.P1),n.queue(o.Run,"setPriority",u,VMLIFlag.P0)):3===t?(n.queue(o.Run,"setStarred",s,!0),n.queue(o.Run,"setStarred",d,!0),n.queue(o.Run,"setStarred",u,!0)):4===t?(n.queue(o.Run,"setComplete",r,!0,(new Date).addDays(-2)),n.queue(o.Run,"setComplete",s,!0,(new Date).addMinutes(-10)),n.queue(o.Run,"setComplete",d,!0,(new Date).addMinutes(-10)),n.queue(o.Run,"setComplete",l,!0,(new Date).addDays(-11)),n.queue(o.Run,"setComplete",u,!0,new Date)):5===t&&(n.queue(o.Run,"appendText",i," @later"),n.queue(o.Run,"setPriority",r,VMLIFlag.P1),n.queue(o.Run,"appendText",a," @tomorrow"),n.queue(o.Run,"appendText",s," @today 6pm"),n.queue(o.Run,"appendText",d," @today 3pm"),n.queue(o.Run,"setPriority",d,VMLIFlag.P0),n.queue(o.Run,"setPriority",c,VMLIFlag.P2),n.queue(o.Run,"setComplete",l,!0,(new Date).addDays(-1)),n.queue(o.Run,"setStarred",u,!0),n.queue(o.Run,"appendText",u," @now")),n},demoFocus:function(e,t){var n=this.createScript(e);return 0===t?n.queue(o.Run,"setSearch","#out",1):1===t?(n.queue(o.Run,"setSearch","!",1),n.queue(o.Run,"delay",2e3),n.queue(o.Run,"setSearch","!!!",1)):2===t?n.queue(o.Run,"setSearch","+Miller Harris",1):3===t?n.queue(o.Run,"setSearch","-//",1):4===t?n.queue(o.Run,"setSearch","Japan",1):5===t&&(n.queue(o.Run,"setSearch","!",1),n.queue(o.Run,"delay",1e3),n.queue(o.Run,"setSearch","! todo",1),n.queue(o.Run,"delay",1e3),n.queue(o.Run,"setSearch","! todo app",1),n.queue(o.Run,"delay",1e3),n.queue(o.Run,"setSearch","! todo app -jap",1)),n}},i}),define("VMSetup",["ko","data","globals","util","platform","goog","AScript"],function(e,t,n,i,o,r,a){function s(){this.loginState=e.observable(LoginState.NONE),this.loginEnabled=e.observable(!0);var t="Sign in with Google";this.loginStatus=e.observable(t),r.gapiLoaded||(this.loginDisableTimeout=setTimeout(function(){this.loginEnabled(!1),this.loginStatus("Must be online to login")}.bind(this),1e3),window.addEventListener("gapiLoaded",function(){clearTimeout(this.loginDisableTimeout),this.loginEnabled(!0),this.loginStatus(t)}.bind(this),!0))}return s.prototype={init:function(){if(n.isDemoMode())return LoginState.LOGGED_OUT;var e=n.getLoginState();return this.setLoginState(e),n.applyBindings(this,"setup"),window.addEventListener("offline",function(){log("Browser going offline."),n.vmMain.setGDriveStatus(DriveStatus.Offline)}),window.addEventListener("online",function(){if(log("Browser going online."),n.getLoginState()==LoginState.LOGGED_IN&&!o.offline){n.vmMain.setGDriveStatus(DriveStatus.Connecting);var e=r.ensureDocConnection();log("Coming online. Already online:",e)}}),e},logoutButtonText:function(){return n.isDemoMode()?"Leave Introduction":"Logout"},setLoginState:function(e){e!=this.loginState()&&(n.setLoginState(e),this.loginState(e))},userLogin:function(){r.runAuthenticate(r.requiredScopes,!1,!0,function(e){e&&!e.error?(n.settings.set(Settings.localIntegrity,!0),this.setLoginState(LoginState.LOGGED_IN),gapi.load("drive-realtime",function(){r.loadClientDefaultFile()})):log("Invalid token returned when calling userLogin")}.bind(this))},openLogin:function(){this.loginState(LoginState.NONE),n.StopSpinner()},logout:function(){n.settings.reset(),this.setLoginState(LoginState.LOGGED_OUT),t.clearData(function(){i.hasURLParam("login")?i.removeURLParam("login"):o.app?o.app&&o.sendToApp("logout"):n.reload()})},logoutClicked:function(){if(n.isDemoMode())i.removeURLParam("demo");else{var e=!0;for(var r in t.pendingRemoteUpdates)if(t.pendingRemoteUpdates.hasOwnProperty(r)){o.isPackagedApp&&(e=confirm("You have unsaved changes which will be lost if you log out. Are you sure?"));break}e&&this.logout()}},isLocal:function(){return"localhost"==window.location.hostname},onlineStatusToggle:function(){o.offline?i.removeURLParam("offline"):i.insertURLParam("offline","true")},runScript:function(e){n.AScript||(n.AScript=new a),n.AScript.runScript(e,!0)},onTapLogin:function(){n.vmMain.isOnline()&&this.userLogin()},onTapInput:{onClick:function(e){o.ios&&(e.srcElement.focus(),n.enforceScroll())}},onTap:{onMove:function(e){e.preventDefault()}},onTapLanding:function(e){n.openUrl("/",e)},onPrivacyPolicy:function(e){n.openUrl("/privacy",e)}},s}),define("parse",["globals","VMLI","tracker","data"],function(e,t,n,i){function o(e){for(var t={},n=0;n<e.childElementCount;++n){var i=e.children[n],o=i.nodeName;if(i.firstChild){var r=i.firstChild.textContent;t[o]=r}}return t}function r(e){if(e.parent=void 0,e.items)for(var t=0;t<e.items.length;t++)r(e.items[t])}var a={};return a.parseOPML=function(e,r){function a(e,n){var d=!0,c=void 0;switch(e.nodeName){case"#document":case"body":case"opml":break;case"head":d=!1;var l=o(e);l&&l.title&&!s&&(s=new t({text:l.title},{parent:i.getRootModel(),parse:!0,forceSave:!0}),i.getRootModel().insertItem(s));break;case"outline":n||(s?n=s:(n=s=new t({text:r},{parent:i.getRootModel(),parse:!0,forceSave:!0}),i.getRootModel().insertItem(s))),c=new t({text:e.attributes.text.value},{parent:n,parse:!0,forceSave:!0}),n.insertItem(c);break;default:log("Unknown OPML Node: ",e)}if(d)for(var u=0;u<e.childElementCount;++u)a(e.children[u],c);return c}var s;return n.beginAction(),a(e),n.endAction(),!0},a.parseJSON=function(e,o){function r(e,n){var a=n||o||i.getRootModel(),s={text:e.text,dateCompleted:e.dateCompleted,priority:e.priority,isComplete:e.isComplete,isStarred:e.isStarred},d=new t(s,{parent:a,parse:!0,forceSave:!0});if(a.insertItem(d),e.items)for(var c=0;c<e.items.length;++c)r(e.items[c],d)}var a;if(void 0!==e.moodoVer&&void 0!==e.moodoRoot)try{return a=parseInt(e.moodoVer),n.beginAction(),r(e.moodoRoot),n.endAction(),!0}catch(s){}else if(void 0!==e.text&&void 0!==e.items)try{return n.beginAction(),r(e),n.endAction(),!0}catch(s){}return!1},a.traverseDOM=function(e){function t(e){if(e.nodeType===Node.TEXT_NODE){(f||p)&&(u.text=u.text.trim(),""!==u.text&&(h={text:"",parent:u.parent},u.parent.items.push(h),u=h)),f=!1,p=!1;var t=e.nodeValue.replace(/[^\x20-\x7E]+/g,"");""===u.text&&(t=e.nodeValue.replace(/^\s+/g,"")),u.text+=t}else e.nodeType===Node.COMMENT_NODE||("BR"==e.tagName||"P"==e.tagName||"LI"==e.tagName||"DIV"==e.tagName?p=!0:("UL"==e.tagName||"OL"==e.tagName)&&(p=!1,u.text=u.text.trim(),h={text:"",parent:u},u.items?u.items.push(h):u.items=[h],u=h))}function n(e){e.nodeType!==Node.TEXT_NODE&&("UL"==e.tagName||"OL"==e.tagName?(u=u.parent,f=!0):("DIV"==e.tagName||"P"==e.tagName)&&(p=!0))}function i(e,t){isNaN(t)&&(t=0);for(var n="",o=0;t>o;o++)n+="--";if(t&&console.log(n,e.text),e.items)for(var o=0;o<e.items.length;o++)i(e.items[o],t+1)}var o=e.root,a=e.stripParents,s=e.shouldPrint,d=o.firstChild,l={items:[]},u={text:"",parent:l};l.items.push(u);var h,p=!1,f=!1;do if(t(d),c=d.firstChild)d=c;else if(c=d.nextSibling)d=c;else{do c=d.parentNode.nextSibling,c?(n(d.parentNode),d=c):(d=d.parentNode,n(d));while(!c&&d&&d.parentNode);if(!c)break}while(d);return a&&r(l),s&&i(l),l},a}),define("copypaste",["ko","globals","platform","android","edit","VMLI","tracker","parse"],function(e,t,n,i,o,r,a,s){function d(e){e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()}function c(c){if(c.srcElement||(c.srcElement=c.target),!c.synthetic&&i.isEnabled())return void i.handlePaste();var l=c&&c.clipboardData?c.clipboardData:c.synthetic?c.data:window.clipboardData,u=n.ie?"Text":"text/plain",h="",p=t.getSelectionInfo();if(p&&p.selection){var f=t.getSelectionRange(),m=t.getPaneForElement(c.srcElement);if(t.hasClass(c.srcElement,"search"))return(/text\/plain/.test(l.types)||n.ie)&&(c.srcElement.textContent=l.getData(u).replace(/[\r\n\t]/g,""),t.selectElement(c.srcElement,!0)),c.preventDefault(),!1;if(m){if(m.mode()!==PaneMode.Normal)return!1;var g=t.getSpanParent(f.startContainer),v=t.getSpanParent(f.endContainer);if(!g||!v){if(f.startContainer!=m.paneContent&&f.endContainer!=m.paneContent)return;var y=m.addItemToPane("",0);g=v=y.getSpan(),t.selectChildren(y,0,0)}if(l&&l.getData){a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.Paste,data:[{value:!0}]}),d(c);var b;if(/text\/html/.test(l.types)){if(h=l.getData("text/html"),!h)return;var S,T=document.createElement("div"),w=h.replace(/[\n\t]/g," ").replace(/[\r]|<head(.|\s)*?\/head>|<script(.|\s)*?\/script>|<style(.|\s)*?\/style>/g,"").replace(/\s+/g," ").replace(/onload/gi,"never"),M=/<body(.|\s)*?\/body>/g;(S=M.exec(w))&&(w=S[0]),T.innerHTML=w,b=s.traverseDOM({root:T,shouldPrint:!1,stripParents:!0}),1===b.items.length&&""===b.items[0].text&&(b=b.items[0])}else if(/text\/plain/.test(l.types)||n.ie){h=l.getData(u).trim();var C,x=h.startsWith("<?xml "),I=h.startsWith("<?opml ");if((x||I)&&(C=t.loadXML(h)),C){if(x)return t.messageQueue.pushMessage({text:"We currently do not support pasting generic XML documents, so please try converting to OPML. If you need to import XML send us a message and we will work through your scenario with you.",type:MessageType.Error}),!1;if(I)return s.parseOPML(C,"OPML Import"),!1}else{if(h.startsWith("{")&&h.endsWith("}"))try{var E=JSON.parse(h),k=e.dataFor(g.parentElement),D=s.parseJSON(E,k);if(D)return!1}catch(P){}var w=h.replace(/[\t]/g," "),L=w.split("\n");b={items:[]};for(var O=0;O<L.length;O++)if(0!==L[O].length){var A=t.trimString(L[O].replace(/[^\x20-\x7E]+/g,""));b.items.push({text:A,parent:b})}}}if(!b||0===b.items.length)return!1;a.beginAction();var R,_,N=i.isEnabled()?i.getCurrentVMLI():e.dataFor(g),F=i.isEnabled()?i.getCurrentVMLI():e.dataFor(v),V=t.getSelectOffsetsInSpan(N,g,f),B=t.getSelectOffsetsInSpan(F,v,f),U=N.parent(),q=N.getIndex(),H=N.getParsedText(),W=F.getParsedText();N!=F&&o.handleMultiselect({},g,v,f);var K=N;if(b&&1===b.items.length&&!b.items[0].items){var j=b.items[0].text.trim(),A=H.substring(0,V.startText)+j+W.substring(B.endText);R=N.getSpan(),a.performAction(TrackerType.Remove,{itemID:N.id,position:0,text:N.getParsedText()}),N.setText(A,!0),a.performAction(TrackerType.Insert,{itemID:N.id,position:0,text:A}),_=V.start+j.length,t.selectChildren(N,_,0)}else{for(var z=(U.items(),[]),O=0;b&&O<b.items.length;++O){var G=b.items[O];if(G.text=G.text.trim(),""!==G.text||G.items)if(0===O){if(G.text[0]==H&&(G.text=G.text.substr(1)),G.text=H.substring(0,V.startText)+G.text,N.setText(G.text,!0),a.performAction(TrackerType.Insert,{itemID:N.id,position:0,text:G.text}),q++,G.items){for(var Y=0;Y<G.items.length;++Y){var X=G.items[Y];(""!==X.text||X.items)&&N.insertItem(new r(X,{parent:N,parse:!0,forceSave:!0}))}-1==z.indexOf(N)&&z.push(N)}}else{var J=new r(G,{parent:U,parse:!0,forceSave:!0});U.insertItem(J,q++,!0),-1==z.indexOf(U)&&z.push(U),a.performAction(TrackerType.Create,{itemID:J.id,parent:U.id,position:q-1,text:J.getParsedText()})}}for(O=0;O<z.length;O++)z[O].items.valueHasMutated();for(K=U.getChild(q-1);K.hasChildren();)K=K.getLastChild();_=K.getParsedText().length,K.setText(K.getParsedText()+W.substring(B.endText),!0),t.vmMain.runParseWorker(U,function(){setTimeout(function(){t.selectChildren(K,_,0)},0)})}a.endAction()}return K&&!i.isEnabled()&&t.scrollIntoView(K.getSpan(),200),!1}}}function l(e){var n=!u(e);return n?(o.keydown(void 0,{normCode:KeyCode.BackSpace,preventDefault:t.emptyFn,stopPropagation:t.emptyFn,stopImmediatePropagation:t.emptyFn}),d(e),!1):!0}function u(o){if(!i.isEnabled()){var r=o&&o.clipboardData?o.clipboardData:window.clipboardData;if(r){o.srcElement||(o.srcElement=o.target);var s=t.getSelectionInfo();if(!s)return!0;if("exportedArea"===o.srcElement.id||"exportedContent"===o.srcElement.id){var c=n.ie?"Text":"text/plain";r.setData(c,o.srcElement.textContent)}else{var l=t.getSelectionRange().startContainer;if("#text"==l.nodeName&&(l=l.parentNode),!l)return!0;if(!i.isEnabled()){var u=t.elementInPane(l);if(!u||"searchDiv"===s.node.id||t.hasClass(s.node,"search"))return!0;if(u){var h=t.getPaneForElement(l);if(h.isTimeline())return!0}}t.restrictSelectionToText();var p,f,m=t.getSelectionRange(),g=t.getSpanParent(m.startContainer),v=t.getSpanParent(m.endContainer),y=i.isEnabled()?i.getCurrentVMLI():e.dataFor(g),b=i.isEnabled()?i.getCurrentVMLI():e.dataFor(v),S=t.getSelectOffsetsInSpan(y,g,m),T=!n.ie,w=y.getParsedText().substring(S.startText);if(y===b)w=S.start===S.end?y.getParsedText():y.getParsedText().substr(S.startText,S.endText-S.startText),T&&(p=w),f=w;else{var M=0;M++,T&&(p="<ul><li>"+w+"</li>"),f=w;do{var C={numLevels:0};for(y=t.getNextItem(y,t.focusedPane,C),C.numLevels>0&&(T&&(p+="<ul>"),M++);C.numLevels<0&&M>=0;)T&&(p+="</ul>"),M--,C.numLevels++;if(0>=M&&(T&&(p+="<ul>"),M++),y!==b)w=y.getParsedText(),T&&(p+="<li>"+w+"</li>");else{var x=t.getSelectOffsetsInSpan(y,y.getSpan(),m);w=y.getParsedText().substring(0,x.endText),T&&(p+="<li>"+w+"</li></ul>"),M--}f+="\r\n"+w}while(y!==b);for(;M>0;)T&&(p+="</ul>"),M--}T&&p&&r.setData("text/html",p);var c=n.ie?"Text":"text/plain";r.setData(c,f)}}return d(o),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.Copy,data:[{value:!0}]}),!1}}var h={};return h.init=function(){document.body.addEventListener("paste",c,!1),document.body.addEventListener("cut",l,!1),document.body.addEventListener("copy",u,!1)},h}),define("VMSearch",["ko","globals","platform","android","data","VMLI","tracker"],function(e,t,n,i,o,r,a){function s(t,n){this.elSearch=void 0,this.search=e.observable(n||""),this.isFocused=e.observable(!1),this.placeholderActive=e.observable(!0),this.searchLoaded=!1,this.pane=t,this.searchArr=[],this.matches={},this.hiddenItems={},this.numMatches=e.observable(0),this.previousSearch="",this.titles=e.observableArray(),this.initialized=!1,this.isPaneTimeline=t.mode()==PaneMode.Timeline,this.isSearchBoxSmall=e.observable(),this.onUpdated=e.observable()}return s.prototype={getSearchBox:function(){return this.elSearch},init:function(){if(!this.initialized){if(this.pane.showArchived.subscribe(function(){this.updateSearch()}.bind(this)),this.pane.mode.subscribe(function(){this.isPaneTimeline=this.pane.isTimeline()}.bind(this)),window.addEventListener("itemAdded",function(e){if(e.data.force||t.focusedPane.id!==this.pane.id){var n=this.checkItem(e.data.item);n===!0&&this.updateNumMatches(e.data.item,!0)}else t.focusedPane.id===this.pane.id&&this.updateNumMatches(e.data.item,!0)}.bind(this),!0),window.addEventListener("itemTextChanged",function(e){if(e.data.force||t.focusedPane.id!==this.pane.id){var n=e.data.item,i=this.matches[n.id],o=this.checkItem(n);(o===!0&&i!==!0||o!==!0&&i===!0)&&this.updateNumMatches(n,o===!0),this.checkChildren(n,!1,!0)}}.bind(this),!0),n.mobile||window.addEventListener("windowResize",this.checkSearchBoxSize.bind(this)),this.search())this.updateSearch();else{var e=0,i=this.isPaneTimeline&&this.pane.showArchived();t.searchVMLIs({item:this.pane.item(),includeArchived:i,each:function(t){var n=this.amountIncrementNumMatches(t,!0);n&&(e+=n)}.bind(this)}),this.setNumMatches(e)}this.initialized=!0}},onLoad:function(e){this.elSearch=e,this.elSearchWrap=e.parentNode,this.elAutocomplete=t.getElementByClassName("searchAutocomplete",this.elSearchWrap),this.elSearch.addEventListener("focus",this.onfocus.bind(this),!1),this.elSearch.addEventListener("blur",this.onblur.bind(this),!1),n.android&&this.elSearch.addEventListener("input",function(e){var t=this.getDisplayText().replace(TextSpace,"").replace("\n",""),n=this.search();t.length<n.length&&(e.normCode=KeyCode.BackSpace,this.keydown(void 0,e),this.keyup(void 0,e))}.bind(this)),this.search()?setTimeout(function(){this.setDisplayText(this.search()),this.searchLoaded=!0}.bind(this),0):(this.checkPlaceholder(),setTimeout(function(){this.searchLoaded=!0}.bind(this),0))},checkSearchBoxSize:function(){if(this.isFocused()){var e=this.elAutocomplete.getBoundingClientRect(),t=this.elSearchWrap.getBoundingClientRect(),n=this.pane.scrollElement.getBoundingClientRect();n.right-t.left-10<e.width?(this.elAutocomplete.style.right=0,this.elAutocomplete.style.left=""):t.left<n.left+40-2?(this.elAutocomplete.style.left="-2px",this.elAutocomplete.style.right=""):(this.elAutocomplete.style.left="",this.elAutocomplete.style.right="")}},onfocus:function(){this.isFocused(!0),t.vmMain.setFocusedPane(this.pane),n.phone?t.sendEvent("SearchFocus","Mobile"):(this.clearPlaceholder(),this.checkSearchBoxSize(),t.sendEvent("SearchFocus","Desktop"))},onblur:function(){this.isFocused(!1),t.fireCustomEvent("closeKeyboard"),this.checkPlaceholder(),t.clearSavedSelection("StoredSearch")},checkPlaceholder:function(){""===this.getDisplayText()&&this.setDisplayText(TextSpace),this.getDisplayText()===TextSpace&&this.setDisplayToPlaceholder()},focusBox:function(){t.vmMain.setFocusedPane(this.pane),t.keyboardToolbar&&t.keyboardToolbar.preShow(),this.getSearchBox().focus(),t.enforceScroll(),t.keyboardToolbar&&t.keyboardToolbar.show(!1)},blurBox:function(){this.getSearchBox().blur()},focusAndSelectEnd:function(){this.focusBox(),t.selectElement(this.elSearch,!0)},resetSearch:function(){this.search(""),this.setDisplayText(TextSpace);for(var e in this.matches)this.updateMatchState(o.getModel(e),void 0,void 0);this.matches[this.pane.item().id]=!1,this.updateSearch()},setSearch:function(e){this.setDisplayText(e||TextSpace),this.search(e),this.updateSearch()},addToSearch:function(e){if(e){var t=this.search()+" "+e;this.setDisplayText(t||TextSpace),this.search(t),this.updateSearch()}},isSearching:function(){return this.search().length>0},isShowing:function(){return this.isFocused()||this.isSearching()},isMatched:function(e){return(void 0===this.matches[e.id]||!!this.matches[e.id])&&-1!==this.matches[e.id]},isVisible:function(e){return!this.hiddenItems[e.id]},hideItem:function(e,n){if(n){var i=e.getOutlineElement(this.pane.id);i&&t.addClass(i,"hidden")}else{var o=e.getElement(this.pane.id);o&&(t.addClass(o,"hidden"),this.hiddenItems[e.id]=!0)}},showItem:function(e,n){if(n){var i=e.getOutlineElement(this.pane.id);i&&t.removeClass(i,"hidden")}else{var o=e.getElement(this.pane.id);o&&(this.hiddenItems[e.id]=!1,t.removeClass(o,"hidden"))}},updateMatchState:function(e,n){var i=!1;if(e!=this.pane.item.peek()&&e!=t.vmMain.root.peek()){if(e){var o=this.matches[e.id];this.matches[e.id]=n,o===n||void 0===o&&n===!0||(i=!0,this.isPaneTimeline&&this.pane.notifySearchStateChanged(e,n))}return i}},amountIncrementNumMatches:function(e,n){return e==this.pane.item.peek()||e==t.vmMain.root.peek()?0:n?1:-1},updateNumMatches:function(e,t){var n=this.amountIncrementNumMatches(e,t);n&&this.setNumMatches(this.numMatches()+n)},setNumMatches:function(e){var t=this.numMatches();t!==e&&(this.numMatches(e),this.pane.paneContent&&!!t!=!!e&&this.pane.setNoItems(!!e))},isMatch:function(e,t,n){var i=!0;return n.indexOf("!")>=0&&(i=e.priority()>=VMLIFlag.P2,n.indexOf("!!")>=0&&(i=e.priority()>=VMLIFlag.P1,n.indexOf("!!!")>=0&&(i=e.priority()>=VMLIFlag.P0)),n=n.replace(/!/g,"")),n.indexOf("*")>=0&&i&&(i=e.isStarred()&&!e.isComplete(),n=n.replace(/\*/g,"")),n.indexOf("//")>=0&&i&&(i=e.isComplete(),n=n.replace(/\//g,"")),n.length>0&&i&&(i=t.indexOf(n)>=0),i},checkItem:function(e,n,i){for(var r,a=n?t.vmMain.root.peek():this.pane.item.peek(),s=!0,d=e.getSearchText(),c=0;c<this.searchArr.length;c++){var l=this.searchArr[c],u=l.isNegated;if(u){var h=l.text,p=this.isMatch(e,d,h);if(p){s=-1;break}}}if(s===!0)for(var c=0;c<this.searchArr.length;c++){var l=this.searchArr[c],u=l.isNegated,h=l.text;if(!u){var p=this.isMatch(e,d,h);if(!p)for(r=e;r;){if(r=r.parent(),!r||r==o.getRootModel()){s=!1;break}if(this.isMatch(r,r.getSearchText(),h))break}}if(s!==!0)break}if(s===!0&&e.isLoaded){var f=e,m=this.matches[e.id];for(this.updateMatchState(e,!0,n);f;){if(-1===this.matches[f.id]){this.matches[e.id]=!1;break}if(f.isLoaded&&this.showItem(f,n),f==a)break;if(f=f.parent()){if(this.matches[f.id]===!0)break;m=this.matches[f.id]}}i&&!n&&this.search()&&this.updateNumMatches(e,!0)}else if(e.isLoaded){{this.updateMatchState(e,s,n)}this.hideItem(e,n)}return this.matches[e.id]},checkChildren:function(e,n,i){var o=this.numMatches();n&&(o=0);var r=this.isPaneTimeline&&this.pane.showArchived();t.searchVMLIs({item:e,includeArchived:r,each:function(e){var t=this.matches[e.id],r=this.checkItem(e);if(n&&r===!0||i&&(r===!0&&t!==!0||r!==!0&&t===!0)){var a=this.amountIncrementNumMatches(e,r===!0);a&&(o+=a)}}.bind(this)}),this.setNumMatches(o)},checkChildrenOutline:function(){this.isPaneTimeline&&this.pane.showArchived();t.searchVMLIs({headers:!0,each:function(e){this.checkItem(e,!0)}.bind(this)})},updateSearch:function(e){if(e===!0||this.search()!=this.previousSearch){this.searchLoaded&&t.vmMain.updatePaneState(this.pane);var i=this.search().toLowerCase().trim().split(/\s+/);i=i.filter(function(e){return!(!e||"-"===e)}),this.searchArr=[];for(var o=0;o<i.length;++o){var r=i[o].startsWith("-"),a=r?i[o].substr(1):i[o];this.searchArr.push({text:a,isNegated:r})}this.search()?(this.pane.isSearching=!0,n.mobile&&this.clearPlaceholder()):(this.pane.isSearching=!1,n.mobile&&this.setDisplayToPlaceholder()),this.previousSearch=this.search(),this.matches[this.pane.item().id]=!1,this.initialized&&(this.checkChildren(this.pane.item(),!0),this.checkChildrenOutline()),this.onUpdated.valueHasMutated()}},keydown:function(e,n){if(n.normCode===KeyCode.Enter)return!1;if(n.normCode===KeyCode.BackSpace){var i=this.getDisplayText();if(""===i||i===TextSpace)return!1;if(n.metaKey)this.setDisplayText(TextSpace);else{var o=t.getSelectionRange();0===o.startOffset&&o.endOffset===i.length&&this.setDisplayText(TextSpace)}}return!0},keyup:function(e,i){var o=this.getDisplayText();if(n.mobile||""!==o||this.setDisplayText(TextSpace),i.normCode===KeyCode.Escape)t.selectElement(this.elSearch,!1);else{var r=o.replace(TextSpace,"").replace("\n","");this.search(r),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SearchChanged,data:[{pane:this.pane.id,text:r}]});var s=i.normCode===KeyCode.Enter;if(this.updateSearch(s),n.mobile||this.checkSearchBoxSize(),i.normCode===KeyCode.Enter)if(n.android&&t.keyboardToolbar)t.clearSavedSelection("StoredSearch"),t.clearSelection();else if(!t.restoreSavedSelection("StoredSearch",t.focusedPane)){var d=t.focusedItem.getFirstChild();d&&(t.selectChildren(d,0,0),t.scrollIntoView(d.getSpan(),0))}}return!0},insert:function(e,n){var i=t.getSelectionRange();if(i){var o=i.startOffset;1===o&&this.getDisplayText()===TextSpace&&o--;var r=this.search().replace(TextSpace,"");if(n&&r.length>0){var s=r[o-1];" "!==s&"-"!==s&&(e=" "+e)}var d=e.length,c=r.substr(0,i.startOffset)+e+r.substr(i.endOffset);this.search(c),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SearchChanged,data:[{pane:this.pane.id,text:c}]}),this.setDisplayText(c),this.updateSearch();var l=Math.min(this.elSearch.textContent.length,o+d);t.setSelection(this.elSearch,l,l)}},onTapAutocomplete:{onStart:function(e){e.preventDefault()}},onTapSearchInsert:{onStart:function(e){e.preventDefault()},onClick:function(e){var n=e.srcElement.className;switch(0!==n.indexOf("search")&&(n=e.srcElement.parentNode.className),n){case"searchNegate":var i=t.getSelectionRange();if(i.startOffset!==i.endOffset){var o=i.startOffset,r=i.endOffset;this.getDisplayText[0]===TextSpace&&(o>0&&o--,r--);var a=this.search();if("-"!==a[o]){var s=a.substring(0,o)+"-"+a.substring(o);this.setSearch(s),t.setSelection(this.elSearch,o,r+1)
}else{var s=a.substring(0,o)+a.substring(o+1);this.setSearch(s),t.setSelection(this.elSearch,o,Math.max(0,r-1))}}else this.insert("-",!0);break;case"searchP2":this.insert("!",!0);break;case"searchP1":this.insert("!!",!0);break;case"searchP0":this.insert("!!!",!0);break;case"searchStarred":this.insert("*",!0);break;case"searchComplete":this.insert("//",!0)}t.sendEvent("Menu",n)}},requestFocusBoxForEvent:function(e){var t=document.activeElement;t&&"searchPhone"==t.id||(this.open(),e.preventDefault())},onTapBox:{onClick:function(e){n.mobile&&(t.phoneMenu.activeScreen()!==Screens.Settings&&t.phoneMenu.mode()==t.phoneMenu.Modes.Normal&&this.open()&&e.stopImmediatePropagation(),e.preventDefault())}},onTapX:{onStart:function(e){e.handled=!0,e.preventDefault()},onClick:function(e){this.isSearchActive()?(this.resetSearch(),e.preventDefault(),t.sendEvent("Menu","ClearSearch")):(this.requestFocusBoxForEvent(e),t.sendEvent("Menu","FocusSearch"))}},isSearchActive:function(){return 0!==this.search().length},getTitleText:function(){return this.isSearchActive()?"Clear Search":"Search"},getSearchIcon:function(){return this.isSearchActive()?"icon-remove":"icon-search"},open:function(){return this.isFocused()?void 0:(n.mobile?this.focusAndSelectEnd():this.focusBox(),!0)},getDisplayText:function(){return this.elSearch.textContent},setDisplayText:function(e){this.elSearch.textContent=e,this.placeholderActive(e===TextSpace&&n.mobile?!0:!1)},setDisplayToPlaceholder:function(){this.placeholderActive(!0),this.elSearch.textContent=TextSpace},clearPlaceholder:function(){this.placeholderActive(!1)}},s}),define("VMTitle",["ko","globals","data","tracker","platform"],function(e,t){function n(t){this.text=t.text,this.item=t.item,this.home=t.home,this.isTruncated=e.observable(!1),this.pane=t.pane,this.init(t)}return n.prototype={init:function(){this.text=this.item.getParsedText(),this.text.length>25&&(this.text=this.text.substr(0,25),this.isTruncated(!0))},onTap:{onStart:function(e){e.handled=!0,t.vmMain.setFocusedPane(this.pane)},onClick:function(e){t.focusedPane.onTapTitle.onClick.call(t.focusedPane,e,this.item)}}},n}),define("VMTimelineBlock",["ko","globals","data","VMLI"],function(e,t){function n(t){this.owner=t.owner,this.date=t.date,this.dateKey=t.dateKey,this.text=t.text,this.name=t.name,this.searchProvider=void 0,this.items=e.observableArray(),this.searchCount=e.observable(0),this.hasDeferredUpdate=!1,this.element=void 0,this.timeCount=e.observable(0),this.isStarred=t.isStarred,this.isImportant=t.isImportant,this.isToday=!1,this.init(t)}return n.prototype={showBlock:function(){return this.items().length>0&&this.searchCount()>0},specialClass:function(){return this.isStarred?"starredBlock":this.isImportant?"importantBlock":this.isToday||this.isNow?"todayBlock":void 0},showTime:function(e){var t=e.$data,n=e.$index;if(this.isNow)return!1;this.searchProvider.onUpdated();if(0===this.timeCount()||this.isStarred||this.isImportant||!this.searchProvider.isVisible(t))return!1;for(var i=n()-1;i>0&&!this.searchProvider.isVisible(this.items()[i]);)i--;if(0>i)return!0;var o=this.items()[i];if(t.hasTime()){if(0===this.compareDate(o,t))return!1}else if(!o.hasTime())return!1;return!0},processDeferredUpdates:function(){this.hasDeferredUpdate&&(this.hasDeferredUpdate=!1)},init:function(e){if(this.dateKey||(this.dateKey=this.date.clone().clearTime().getTime(),e.name&&(this.dateKey=this.dateKey+e.name)),this.name)this.text=this.name.toUpperCase(),"NOW"==this.name&&(this.isNow=!0);else{if(this.text="",this.date){var t=Math.floor((this.date-Date.today())/864e5);switch(t){case-1:this.text="YESTERDAY ";break;case 0:this.text="TODAY ",this.isToday=!0;break;case 1:this.text="TOMORROW ";break;default:this.text=this.date.toString("dddd").toUpperCase()}}this.text=this.text+" "+this.date.toString("M/d")}},comparePriority:function(e,t){var n=e.priority(),i=t.priority();return n>i?-1:i>n?1:0},compareDate:function(e,t){if(e.isComplete()&&!t.isComplete())return-1;if(!e.isComplete()&&t.isComplete())return 1;if(e.isComplete()&&t.isComplete())return e.dateCompleted>t.dateCompleted?1:-1;if(e.date()&&!t.date())return-1;if(!e.date()&&t.date())return 1;var n=new Date(e.date()),i=n.toString("h:mmtt"),o=new Date(t.date()),r=o.toString("h:mmtt");return"12:00am"!=i&&"12:00am"!=r?isNaN(n.getYear())||isNaN(o.getYear())?0:Date.compare(n,o):"12:00am"!=i?-1:"12:00am"!=r?1:0},compareOrder:function(e,n){var i=t.getFirstItem(e,n);return i.id==e.id?-1:1},compareItems:function(e,t){var n=this.isStarred||this.isImportant?0:this.compareDate(e,t);if(0===n){var i=this.isStarred?0:this.comparePriority(e,t);if(0===i){var o=this.compareOrder(e,t);return o}return i}return n},addItem:function(e){return this.items.indexOf(e)>=0?void this.updateItem(e):(this.searchProvider.isMatched(e)&&(this.searchCount(this.searchCount()+1),e.hasTime()&&this.timeCount(this.timeCount()+1)),void(this.owner.deferModelUpdates?(this.items().insertSorted(e,this.compareItems.bind(this)),this.hasDeferredUpdate=!0):this.items.insertSorted(e,this.compareItems.bind(this))))},removeItem:function(e){this.searchProvider.isMatched(e)&&(this.searchCount(this.searchCount()-1),e.hasTime()&&this.timeCount(this.timeCount()-1)),this.owner.deferModelUpdates?(this.items().remove(e),this.hasDeferredUpdate=!0):this.items.remove(e)},updateItem:function(e){this.owner.deferModelUpdates?(this.items().remove(e),this.items().insertSorted(e,this.compareItems.bind(this)),this.hasDeferredUpdate=!0):(this.items.remove(e),this.items.insertSorted(e,this.compareItems.bind(this)));for(var t=0,n=0;n<this.items().length;n++)this.items()[n].hasTime()&&t++;this.timeCount(t)},onLoad:function(e){this.element=e},notifySearchStateChanged:function(e,t){void 0===t&&(t=this.searchProvider.isMatched(e)),t===!0?(this.searchCount(this.searchCount()+1),e.hasTime()&&this.timeCount(this.timeCount()+1)):(this.searchCount(this.searchCount()-1),e.hasTime()&&this.timeCount(this.timeCount()-1))},setSearchProvider:function(e){this.searchProvider=e}},n}),define("VMPane_Timeline",["ko","globals","data","VMTimelineBlock"],function(e,t,n,i){var o={initTimeline:function(){this.blocks=e.observableArray(),this.blockImportant=void 0,this.blockStarred=void 0,this.days={},this.updateNextTimeout=0,this.datesByItem={},this.starredItems={},this.priorityItems={},this.isLoading=!1,this.deferModelUpdates=0;var t=this;this.showArchived.subscribe(function(e){t.reloadTimeline()})},hasBlocks:function(){for(var e=0,t=0;t<this.blocks().length;t++)e+=this.blocks()[t].searchCount();return e>0},reasonEmpty:function(){return this.vmSearch&&this.vmSearch.search().length>0?"No search results":"Nothing on the agenda"},blockCompare:function(e,t){return e.isNow&&t.isToday?-1:e.isToday&&t.isNow?1:Date.compare(e.date,t.date)},removeDate:function(e){var t=this.datesByItem[e.id];t.removeItem(e),this.datesByItem[e.id]=void 0},addBlock:function(e){e.setSearchProvider(this.vmSearch),this.deferModelUpdates?this.blocks().insertSorted(e,this.blockCompare):this.blocks.insertSorted(e,this.blockCompare)},dumpBlocks:function(){log("Dump Timeline Blocks:");for(var e=0;e<this.blocks().length;++e){var t=this.blocks()[e];log("  Block: ",t.text),log("  Count: ",t.searchCount);for(var n=0;n<t.items().length;++n){var i=t.items()[n];log("    Item: ",i.getParsedText())}}},findNextBlock:function(){for(var e=new Date,t=0;t<this.blocks().length;t++){var n=this.blocks()[t];if(n.isToday||n.isStarred||n.isImportant||n.date>e)return n}},hideDescendants:function(e){for(var t=0;t<e.items().length;t++){var n=e.items()[t];this.datesByItem[n.id]&&this.removeDate(n),this.starredItems[n.id]&&(this.blockStarred.removeItem(n),this.starredItems[n.id]=void 0),this.priorityItems[n.id]&&(this.blockImportant.removeItem(n),this.priorityItems[n.id]=void 0),n.items().length>0&&this.hideDescendants(n)}},notifyDescendants:function(e){for(var t=0;t<e.items().length;t++){var n=e.items()[t];this.notifyStateChanged(n),n.items().length>0&&this.notifyDescendants(n)}},notifyPositionChanged:function(e){this.mode()===PaneMode.Timeline&&(this.isLoading||(this.datesByItem[e.id]&&this.datesByItem[e.id].updateItem(e),this.starredItems[e.id]&&this.blockStarred.updateItem(e),this.priorityItems[e.id]&&this.blockImportant.updateItem(e)))},notifySearchStateChanged:function(e,t){this.mode()===PaneMode.Timeline&&(this.isLoading||(this.datesByItem[e.id]&&this.datesByItem[e.id].notifySearchStateChanged(e,t),this.starredItems[e.id]&&this.blockStarred.notifySearchStateChanged(e,t),this.priorityItems[e.id]&&this.blockImportant.notifySearchStateChanged(e,t)))},notifyStateChanged:function(e,i){if(this.mode()===PaneMode.Timeline&&!this.isLoading&&!e.hasCompletedAncestor()){var o=n.getItem(e.id);if(this.vmSearch.checkItem(e),o&&o.isDeleted){var r=this.datesByItem[e.id];r&&r.removeItem(e),e.isImportant()&&this.updateSpecialBlock(e,this.priorityItems,this.blockImportant,!1),e.isStarred()&&this.updateSpecialBlock(e,this.starredItems,this.blockStarred,!1)}else{if(!i||t.isAtLeastOneFlagSet(i,PropChangeType.Date|PropChangeType.Complete|PropChangeType.Archive))if(e.date()||e.isComplete()){var a=e.date()?e.date():e.dateCompleted;this.dateUpdated(e,a)}else{var s=this.datesByItem[e.id];s&&this.removeDate(e)}t.isAtLeastOneFlagSet(i,PropChangeType.Complete|PropChangeType.Archive)&&(e.isComplete()||e.isArchived()?this.hideDescendants(e):this.notifyDescendants(e)),(!i||t.isAtLeastOneFlagSet(i,PropChangeType.Priority|PropChangeType.Complete|PropChangeType.Archive))&&this.updateSpecialBlock(e,this.priorityItems,this.blockImportant,e.isImportant()&&!e.isComplete()),(!i||t.isAtLeastOneFlagSet(i,PropChangeType.Starred|PropChangeType.Complete|PropChangeType.Archive))&&this.updateSpecialBlock(e,this.starredItems,this.blockStarred,e.isStarred()&&!e.isComplete())}}},updateSpecialBlock:function(e,t,n,i){!i||e.isDeleted||e.isArchived()&&!this.showArchived()?t[e.id]&&(n.removeItem(e),t[e.id]=void 0):t[e.id]?n.updateItem(e):(n.addItem(e),t[e.id]=e)},dateUpdated:function(e,n,o){if(this.mode()===PaneMode.Timeline&&!this.isLoading){if(e.isArchived()&&!this.showArchived())return void(this.datesByItem[e.id]&&this.removeDate(e));if(this.vmSearch.checkItem(e),n){var r,a=t.isDateSoft(e.dateText);r=a?e.dateText.toUpperCase():n.clone().clearTime().getTime();var s=this.days[r];if(!s&&!this.days[r]){var d={owner:this,date:n.clone().clearTime(),dateKey:r};a&&(d.name=r);var s=new i(d);this.days[r]=s,this.addBlock(s,o)}if(s){var c=this.datesByItem[e.id];c?c.dateKey!==r&&(this.removeDate(e),this.datesByItem[e.id]=s):this.datesByItem[e.id]=s,this.days[r].addItem(e)}}else this.datesByItem[e.id]&&this.removeDate(e)}},ensureSpecialBlocks:function(){this.blockStarred||(this.blockStarred=new i({owner:this,name:"Starred",date:Date.today().add({hour:1}),isStarred:!0}),this.addBlock(this.blockStarred)),this.blockImportant||(this.blockImportant=new i({owner:this,name:"Important",date:Date.today().add({hour:2}),isImportant:!0}),this.addBlock(this.blockImportant))},loadTimeline:function(){this.setDeferUpdates(!0),this.ensureSpecialBlocks(),t.searchVMLIs({item:this.item(),includeArchived:this.showArchived(),each:this.notifyStateChanged.bind(this)}),this.setDeferUpdates(!1),this.vmSearch.onUpdated.valueHasMutated()},unloadTimeline:function(){this.datesByItem={},this.starredItems={},this.priorityItems={},this.days={},this.deferModelUpdates?this.blocks().splice(0,this.blocks().length):this.blocks([]),this.blockStarred=void 0,this.blockImportant=void 0},reloadTimeline:function(){this.mode()===PaneMode.Timeline&&(this.reloading=!0,this.unloadTimeline(),this.loadTimeline(),this.reloading=!1)},setDeferUpdates:function(e){if(this.deferModelUpdates+=e?1:-1,0===this.deferModelUpdates){for(var t=this.blocks().length,n=0;t>n;++n)this.blocks()[n].processDeferredUpdates();this.blocks.valueHasMutated()}},startLoading:function(){this.mode()===PaneMode.Timeline&&(this.isLoading=!0)},endLoading:function(){this.mode()===PaneMode.Timeline&&(this.isLoading=!1,this.setDeferUpdates(!0),this.reloadTimeline(),this.setDeferUpdates(!1))}};return o}),define("VMOutline",["ko","globals","data","gdata","VMSearch","platform","tracker"],function(e,t,n,i,o,r,a){function s(n){this.pane=n,this.root=t.vmMain.root(),r.mobile||(this.isVisible=e.observable(!1)),this.init()}return s.prototype={init:function(){t.outline=this,r.mobile&&t.ScreenManager.addScreen(this,Screens.Outline)},getTopElement:function(){return document.getElementsByClassName("paneOutline")[0]},onTap:{onStart:function(e){t.ScreenManager.checkSwipeStart(e)},onMove:function(e){t.ScreenManager.checkSwipeMove(e)},onClick:function(n){if(!(r.mobile&&t.ScreenManager.checkSwipeClick(n)||!t.hasClass(n.srcElement,"outlineText")&&!t.hasClass(n.srcElement.parentElement,"outlineText"))){var i=e.dataFor(n.srcElement);r.mobile||t.vmMain.setFocusedPane(this.pane),t.vmMain.zoomin(i),r.mobile?t.ScreenManager.scrollToScreen(Screens.List):t.focusedPane.toggleOutlineVisibility(),n.preventDefault(),t.sendEvent("Menu","OutlineZoom")}},onEnd:function(e){t.ScreenManager.checkSwipeEnd(e)}},onTapCollapse:{onStart:function(e){if(t.hasClass(e.srcElement,"outlineArrow")){var n=e.srcElement.parentNode;t.hasClass(n,"collapsed")?(t.removeClass(n,"collapsed"),t.sendEvent("Menu","OutlineMinimize")):(t.addClass(n,"collapsed"),t.sendEvent("Menu","OutlineMaximize")),e.handled=!0,e.preventDefault()}}},onScreenStartOpen:function(){},onScreenOpen:function(){t.isKeyboardOpen&&!t.vmSearchPhone.isFocused()&&t.blurActiveElement(),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleOutline,data:{element:this.getTopElement(),value:!0}})},onScreenUpdate:function(){},onScreenClose:function(){a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleOutline,data:{element:this.getTopElement(),value:!1}})},toggleDesktop:function(){var e=t.width(this.pane.element),n=150;this.isVisible()?(t.setTransform(this.pane.outlineElement,1*-e,0,n,"ease-out"),t.setTransform(this.pane.paneContent,0,0,n,"ease-out"),setTimeout(function(){this.isVisible(!this.isVisible()),this.pane.outlineElement.style.visibility="hidden"}.bind(this),n)):(this.isVisible(!this.isVisible()),this.pane.outlineElement.style.visibility="visible",t.setTransform(this.pane.outlineElement,1*-e,0),requestAnimationFrame(function(){t.setTransform(this.pane.outlineElement,0,0,n,"ease-in-out"),t.setTransform(this.pane.paneContent,e,0,n,"ease-in-out")}.bind(this))),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleOutline,data:{element:this.getTopElement()}})}},t.VMOutline=s,s}),define("VMPane",["ko","globals","android","data","gdata","VMSearch","VMTitle","edit","VMLI","tracker","VMPane_Timeline","VMOutline","platform"],function(e,t,n,i,o,r,a,s,d,c,l,u,h){function p(n){this.id=n.id,this.item=e.observable(n.item),this.mode=e.observable(n.mode||PaneMode.Normal),this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.titleMenu=void 0,this.vmSearch=void 0,this.titles=e.observableArray(),this.showArchived=e.observable(!1),this.reloading=!1,this.width=-1,this.initialOffset=n.offset,this.defaultOffset=h.mobile?50:0,h.mobile?(t.vmSearchPhone=this.vmSearch=new r(this,n.search),this.outline=t.vmMain.outline=new u(this)):(this.vmSearch=new r(this,n.search),this.outline=new u(this)),this.initTimeline(),this.init(n)}return p.prototype={init:function(){this.vmSearch.init(),this.mode.subscribe(this.onModeChanged,this),h.mobile&&t.ScreenManager.addScreen(this,Screens.List),this.updateContents()},getScroller:function(){return this.scrollElement},getScrollOffset:function(){var e=0;return this.scrollElement&&(e=this.scrollElement.scrollTop),e},setScrollOffset:function(e){void 0===e&&(e=this.defaultOffset),t.scrollTo(e,0,this.scrollElement)},setMode:function(e){this.mode(e),t.sendEvent("Menu","PaneModeSwitchTo",e),modeChanged=!0,t.vmMain.updatePaneState(this),this.vmSearch.updateSearch(!0)},addPadding:function(){var e=300;h.android&&(e=h.getKBSize()+20),this.paneContent.style.paddingBottom=e+"px"},removePadding:function(){this.paneContent.style.paddingBottom=""},getTopElement:function(){return this.element},trackDOM:function(){return!0},templateName:function(e){return e.mode()===PaneMode.Normal?"template-pane-normal":e.mode()===PaneMode.Timeline?"template-pane-timeline":void 0},itemHasChildren:function(){return this.item().items().length>0},isTimeline:function(){return this.mode()==PaneMode.Timeline},onModeChanged:function(e){e===PaneMode.Timeline?this.loadTimeline():this.unloadTimeline(),(h.ios||h.ie)&&this.setupFocusEvents()},setupFocusEvents:function(){h.phone&&h.ios&&this.paneContent.addEventListener("textInput",s.onTextInput,!1)},onLoad:function(e){t.hasClass(e,"pane")?(this.element=e,h.mobile&&(this.itemMenuPhone=t.element("itemMenuPhone"),this.rightMenuPhone=t.element("rightMenuPhone"))):(this.paneContent=e,this.rootElement=e.parentElement,this.scrollElement=this.rootElement.parentElement,this.outlineElement=this.scrollElement.previousElementSibling,!h.android&&!h.mobileie||h.script||n.setPaneRoot(this),window.addEventListener("windowResize",function(){this.width=t.width(this.element)}.bind(this)),setTimeout(function(){if(this.width=t.width(this.element),(h.ios||h.ie)&&this.setupFocusEvents(),this.mode()===PaneMode.Normal&&isNaN(this.initialOffset))this.initialOffset=this.defaultOffset;else if(this.mode()===PaneMode.Timeline){var e=this.findNextBlock();this.initialOffset=e&&e.element?h.mobile?e.element.getBoundingClientRect().top:e.element.getBoundingClientRect().top-this.scrollElement.getBoundingClientRect().top-25:0}0!==this.initialOffset&&this.setScrollOffset(this.initialOffset)}.bind(this),0),h.ios&&(this.scrollElement.onscroll=function(e){return Math.abs(this.scrollElement.scrollTop-t.scrollAtTouchStart)>100&&(t.dragStartTimeout&&(clearTimeout(t.dragStartTimeout),t.dragStartTimeout=void 0),t.startDrag=void 0),0===this.scrollElement.scrollTop?(e.preventDefault(),e.stopImmediatePropagation(),!1):!0}.bind(this)),this.setNoItems(!!this.vmSearch.numMatches()))},setNoItems:function(e){e?t.removeClass(this.paneContent,"noItems"):t.addClass(this.paneContent,"noItems")},getWidth:function(){return this.width},toggleOutlineVisibility:function(){this.outline.toggleDesktop()},updateContents:function(){this.mode()==PaneMode.Normal||this.mode()===PaneMode.Timeline&&this.reloadTimeline(),this.updateTitles()},notifyOfZoom:function(){this.updateContents(),this.vmSearch.updateSearch(!0)},updateTitles:function(){var e=this.item().parents();this.titles.removeAll();for(var t=0;t<e.length;t++){var n=new a({item:e[t],pane:this});this.titles.push(n)}},keydown:function(e,i){if(n.isEnabled()&&!n.passKeydown(i))return!0;if(t.autocomplete&&!t.autocomplete.onkeydown(i))return!1;h.mobile||n.isEnabled()||!t.hasClass(this.paneContent,"noItems")||t.hasClass(this.paneContent,"loading")||this.addItem(i);try{return s.keydown(e,i)}catch(o){t.reportError(o,i)}},keypress:function(e,i){if(n.isEnabled()&&!n.passKeypress(i))return!0;try{return s.keypress(e,i)}catch(o){t.reportError(o,i)}},keyup:function(e,i){if(n.isEnabled())return n.checkAndroidBounds(),!0;try{return s.keyup(e,i)}catch(o){t.reportError(o,i)}},addItemToPane:function(e,t){var n=this.item();e||(e=""),c.beginAction();var i=new d({text:e},{parent:n,forceSave:!0});return n.insertItem(i,t),c.performAction(TrackerType.Create,{itemID:i.id,parent:n.id,position:isNaN(t)?n.items().length-1:t,text:e}),c.endAction(),i},onTapTitle:{onClick:function(e,n){var i=t.focusedItem;return h.ios||n==this.item()&&this.vmSearch.resetSearch(),this.titles().length<=1?void(this.outline.isVisible()&&this.toggleOutlineVisibility()):(t.vmMain.zoomout(n,i),void t.sendEvent("Menu","Title"))}},onTap:{onStart:function(i){if(!h.mobile||!t.ScreenManager.checkSwipeStart(i)){if(h.phone,t.menus&&t.phoneMenu&&(t.menus.startedInMultiSelectMode=t.phoneMenu.multiSelectMode()),t.vmMain.setFocusedPane(this),h.isTouchDevice&&!h.app&&(!h.ie||h.mobileie)){var o=this.scrollElement;if(!t.preventScrollPropagation(o))return i.preventDefault(),!1}if(!n.isEnabled()||!n.isTargetBox(i)){var r=e.dataFor(i.srcElement);h.mobile&&r===this&&(r=t.getLastVisibleItem(t.focusedPane.item())),r&&r.onStart&&r.onStart(i)}}},onMove:function(i){t.autocomplete&&h.mobile&&t.autocomplete.hide(),t.dragStartTimeout&&(clearTimeout(t.dragStartTimeout),t.dragStartTimeout=void 0);var o=!0;if(h.mobile&&(t.menus.startedInMultiSelectMode||t.dragging||(o=!t.ScreenManager.checkSwipeMove(i))),o&&(!n.isEnabled()||!n.isTargetBox(i))){var r=e.dataFor(i.startSrc),a=!1;h.mobile&&r===this&&(r=t.getLastVisibleItem(t.focusedPane.item()),a=!0),r&&r.onMove&&r.onMove(i,a)}return!1},onClick:function(i){if(!(h.mobile&&t.ScreenManager.checkSwipeClick(i)||n.isEnabled()&&n.isTargetBox(i))){var o=e.dataFor(i.startSrc);h.mobile&&o===this&&(o=t.getLastVisibleItem(t.focusedPane.item())),o&&o.onClick?o.onClick(i):t.hasClass(this.paneContent,"noItems")&&!t.hasClass(this.paneContent,"loading")?this.addItem(i):i.preventDefault()}},onEnd:function(i){if(!(h.mobile&&t.ScreenManager.checkSwipeEnd(i)||n.isEnabled()&&n.isTargetBox(i))){var o=e.dataFor(i.startSrc);if(h.mobile&&o==this&&(o=t.getLastVisibleItem(t.focusedPane.item())),!o)return;"paneContent"===i.startSrc.id&&(i.preventDefault(),h.ios&&t.preventClick()),o&&o.onEnd&&o.onEnd(i)}},onDblClick:function(t){if(this.isTimeline()){var n=e.dataFor(t.startSrc);n&&n.onDblClick&&n.onDblClick(t)}},onRightClick:function(i){if(!t.isDisplayModeActive(DisplayMode.NoRightClick)){if(t.vmMain.setFocusedPaneFromElement(i.srcElement),!n.isEnabled()||!n.isTargetBox(i)){var o=e.dataFor(i.srcElement);o&&o.onRightClick&&o.onRightClick(i)}c.miscAction({type:TrackerType.Misc,misc:TrackerMisc.RightClick,data:{element:void 0}})}}},addItem:function(e){var i=this.addItemToPane("",0);h.mobileie&&n.isEnabled()?n.updateInput(i):t.selectChildren(i,0,0),h.mobile&&t.openKeyboardOn(e,i.getSpan(),!0,!1),t.sendEvent("Menu","AddItemButton")},onTapAddItem:{onStart:function(e){e.preventDefault(),e.stopImmediatePropagation()},onClick:function(e){this.addItem(e)}},onTapOutlineButton:function(){this.toggleOutlineVisibility(),this.outline.isVisible()?t.sendEvent("Menu","OpenOutline"):t.sendEvent("Menu","CloseOutline")},onTapSwitchList:function(){var e=this.setMode(PaneMode.Normal);c.performAction(TrackerType.UIAction,{type:TrackerUIAction.SwitchPaneMode,data:{from:e,to:PaneMode.Normal}}),t.sendEvent("Menu","SwitchPaneMode")},onTapSwitchTimeline:function(){var e=this.setMode(PaneMode.Timeline);c.performAction(TrackerType.UIAction,{type:TrackerUIAction.SwitchPaneMode,data:{from:e,to:PaneMode.Timeline}}),t.sendEvent("Menu","SwitchPaneMode")},onTapClosePane:function(){if(t.vmMain.panes().length>1){var e=t.vmMain.removePane(this);c.performAction(TrackerType.UIAction,{type:TrackerUIAction.RemovePane,data:e}),t.sendEvent("Menu","ClosePane"),t.tooltip.hideTip()}},onTapArchiveCompleted:{onStart:t.handlerPreventStop,onClick:function(){this.archiveCompleted(),t.sendEvent("Menu","ArchiveCompleted")}},archiveCompleted:function(){var e=[];t.searchVMLIs({item:this.item(),includeArchived:!1,comparator:function(e){return e.isComplete()},action:function(t){e.push(t)}}),c.beginAction();for(var n=e.length-1;n>=0;n--){var i=e[n];i.parent().archiveChild(i)}if(c.endAction(),e.length>0){var o=e.length>1?" items.":" item.";t.messageQueue.pushMessage({text:"Successfully archived "+e.length+o,type:MessageType.Info,action:MessageAction.Default,timeout:2e3})}t.sendEvent("Menu","ArchiveCompleted")},onTapViewArchived:function(){if(this.mode()===PaneMode.Timeline)this.showArchived(!this.showArchived()),t.vmMain.updatePaneState(this),t.sendEvent("Menu","ShowArchivedTimeline");else if(this.mode()===PaneMode.Normal){var e=[];t.searchVMLIs({item:this.item(),includeArchived:!0,comparator:function(e){return e.isArchived()},action:function(t){e.push(t)}});for(var n=0;n<e.length;++n){var i=e[n];i.parent().unarchiveChild(i)}t.sendEvent("Menu","UnarchiveItems")}},onScreenOpen:function(){},onScreenClose:function(){}},t.extend(p.prototype,l),p}),define("VMMain_DragDrop",["ko","globals","platform","tracker","VMPane","VMLI"],function(e,t,n,i,o,r){var a=function(a){function s(){p&&(t.removeClass(p,"itemDraggingAbove"),t.removeClass(p,"itemDraggingBelow"))}function d(e){log(e.target.result)}function c(e){var t=e.dataTransfer.files[0],n=new FileReader;n.onload=d,n.readAsDataURL(t)}var l=void 0,u=void 0,h=void 0,p=void 0,f=void 0,m=!1;a.setDropInfo=function(e,t,n,i){h=e,u=t,m=n,f=i},a.handleDragOver=function(i){if(u!==i.srcElement){i.srcElement&&(l=t.getPaneForElement(i.srcElement));var d=i.srcElement;if(!d||!l||"SPAN"!==d.tagName&&"P"!==d.tagName&&"LI"!==d.tagName&&"UL"!==d.tagName&&"DIV"!==d.tagName);else{s();var c=t.getPaneForElement(d),g=e.dataFor(d),v=void 0,y=!1;g instanceof o?(y=!0,g=h?h:t.getLastPaneItem(g),highLightAbove=i.diffY<0?!0:!1):g instanceof r?c.isTimeline()||!g.isFullscreen()&&"LI"!==d.tagName?v=!0:h&&(g=h,v=i.diffY<0||m?!0:!1):g=a.getDropItem(i),p=c.isTimeline()?void 0:g.getSpan(c.id),f=v?"itemDraggingAbove":"itemDraggingBelow",!c.isTimeline()&&p&&t.addClass(p,f),h=g,u=d,m=y}}if(l){var b=70,S=110,T=n.windowHeight()-40,w=n.windowHeight()+40;if(i.offsetY<S){var M=-(1-t.computeScrollSpeed(b,S,i.offsetY));t.repeatScroll(M,l)}else if(i.offsetY>T&&i.offsetY<w){var M=t.computeScrollSpeed(T,w,i.offsetY);t.repeatScroll(M,l)}else t.cancelRepeatScroll()}else t.cancelRepeatScroll();return!1},a.handleDropItem=function(e){if(t.cancelRepeatScroll(),e!==h){for(var n=h.parent();n;){if(n===e)return;n=n.parent()}if(t.getNextItem(e,t.focusedPane)===h&&"itemDraggingAbove"===f)return;var o=t.getPaneForElement(u);if(!o.isTimeline()){var r=e.parent(),a=e.getIndex(),s=void 0,d=-1;h.isFullscreen()?(s=h,d=s.numChildren()):(s=h.parent(),d="itemDraggingAbove"===f?h.getIndex():h.getIndex()+1),i.beginAction(),e.moveTo({parent:s,index:d}),i.performAction(TrackerType.Move,{itemID:e.id,oldParent:r.id,oldPosition:a,newParent:s.id,newPosition:d}),i.miscAction({type:TrackerType.Misc,misc:TrackerMisc.DropItem,data:[{itemID:e.id}]}),i.endAction(),t.timeline.reloadTimelines()}}},a.getDropItem=function(e){return e.dataTransfer.item},a.handleDrop=function(t){if(t.stopPropagation(),u){s();var n=a.getDropItem(t);if(n)a.handleDropItem(n,t);else{var i=t.dataTransfer.getData("itemid");if(i){var o=e.dataFor(document.getElementById(i));a.handleDropItem(o,t)}else t.dataTransfer.files&&t.dataTransfer.files.length>0&&(c(t),t.stopPropagation(),t.preventDefault())}}}};return a}),define("VMDocument",["ko","globals","platform","data","goog","tracker"],function(e,t,n,i,o,r){function a(t){this.file=t,this.id=t&&t.id,this.title=e.observable(t&&t.title||""),this.shared=t&&t.shared,this.isOpen=void 0,this.isOwned=e.observable(!1),this.init()}return a.prototype={init:function(){this.file&&"me"===this.file.userPermission.id&&"owner"===this.file.userPermission.role&&this.isOwned(!0)},onTapMenu:function(){this.openSharing(),t.sendEvent("Menu","OpenSharing"),r.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenDocSharing,data:[{value:!0}]})},openSharing:function(e){t.menus.openModal("shareDoc",this,e)},closeMenu:function(){t.menus.closeContextMenu(t.element("contextMenuDocument"))},onTapContextMenu:function(e){var t=e.srcElement.id;switch(t||(t=e.srcElement.parentNode.id),t){case"documentDelete":break;case"documentShare":}this.closeMenu()}},a}),define("VMMenus",["ko","globals","data","gdata","VMSearch","VMTitle","edit","VMLI","tracker","platform","VMDocument"],function(e,t,n,i,o,r,a,s,d,c){function l(){this.linkAddress=e.observable(),this.linkTitle=e.observable("temporary title"),this.itemMenuPhoneWidth=-240,this.rightMenuWidth=50,this.phoneLastTop=0,this.itemMenuPhone=void 0,this.itemMenuBG=void 0,this.itemMenuPhoneMode=e.observable(0),this.rightMenuPhone=void 0,this.rightMenuPhoneBG=void 0,this.lastSwipeMove=0,this.lastSwipeMoveTime=0,this.canClosePane=e.observable(!1),this.showArchivedMenuOption=e.observable(!1),this.archivedMenuText=e.observable(""),this.itemIsHeader=e.observable(!1),this.itemHasChildren=e.observable(!1),this.itemIsCollapsed=e.observable(!1),this.itemIsArchived=e.observable(!1),this.itemCanIndent=e.observable(!1),this.itemCanUnindent=e.observable(!1),this.itemCanZoom=e.observable(!1),this.lastZIndex=37,this.contextMenuOpenedOn=e.observable(void 0),this.isModalVisible=e.observable(!1),this.isModalOpen=e.observable(!1),this.modalOpened=void 0,this.modalOpenedBound=void 0,this.modalsBound=!1,this.menusBound=!1,this.init()}return l.prototype={init:function(){window.addEventListener("closeKeyboard",this.onCloseKeyboard.bind(this)),t.addCustomEventListener("keyEscape",this.onEscapeKey.bind(this),100),c.mobile||this.isModalOpen.subscribe(function(e){requestAnimationFrame(e?function(){requestAnimationFrame(function(){t.addClass(t.element("main"),"modalOpen"),t.addClass(t.element("desktopMenu"),"modalOpen"),t.addClass(t.element("desktopSidebar"),"modalOpen")})}:function(){t.removeClass(t.element("main"),"modalOpen"),t.removeClass(t.element("desktopMenu"),"modalOpen"),t.removeClass(t.element("desktopSidebar"),"modalOpen")})})},bind:function(){this.menusBound||(this.menusBound=!0,t.applyBindings(this,"contextMenus"),c.mobile&&(this.itemMenuPhone=t.element("itemMenuPhone"),this.rightMenuPhoneBG=t.element("rightMenuPhoneBG"),this.rightMenuPhone=t.element("rightMenuPhone"),this.rightMenuPhoneItems=t.element("rightMenuPhoneItems"),this.itemMenuBG=t.element("itemMenuBG"),t.applyBindings(this,"itemMenuPhone"),t.applyBindings(this,"rightMenuPhoneItems")))},onEscapeKey:function(){return this.isModalOpen()?this.closeModalInternal(!1):void 0},itemMenuPhoneClass:function(){var e=this.itemMenuPhoneMode();return 0===e?"complete completeDisabled":1==e?"complete":2==e?"notVisible":void 0},selectionHasChildren:function(){for(var e=0;e<t.vmMain.selected().length;e++)if(t.vmMain.selected()[e].hasChildren())return!0;return!1},selectionIsHeader:function(){return 1===t.vmMain.selected().length&&t.vmMain.selected()[0].isHeader()},openLinkMenu:function(e,n,i,o){this.linkAddress(n),t.menuOnItem=e;var r=document.getElementById("contextMenuLink");r.style.left=i+"px",r.style.top=o+"px",r.style.display="block",t.vmMain.handleFullscreenClick(function(){this.closeLinkMenu()}.bind(this))},closeLinkMenu:function(){t.menuOnItem=void 0,this.linkAddress("");var e=document.getElementById("contextMenuLink");e.style.display="none",t.vmMain.cancelFullscreenClick()},onTapLink:{onClick:function(){this.closeLinkMenu()}},closeAllMenus:function(){this.linkAddress("");var e=document.getElementById("contextMenuLink");e.style.display="none",t.menuOnItem=void 0},setupItemMenu:function(){t.element("menuGoto").style.display=t.focusedPane.isSearching?"block":"none"},onTapHover:{onStart:function(e){e.preventDefault()},onClick:function(e){var n=e.srcElement.id;t.sendEvent("Menu",n)}},multiSelect:function(e){e.isSelected(!e.isSelected()),e.isSelected()?t.vmMain.selected.push(e):t.vmMain.selected.splice(t.vmMain.selected.indexOf(e),1)},revealGestureMenu:function(e){t.revealingMenu=!0,this.startedInMultiSelectMode=t.phoneMenu.multiSelectMode(),t.menuOnItem=e;var n=e.getSpan(),i=40,o=t.offset(n).top,r=o-t.topBarHeight,a=t.height(n)+8;r+=(a-i)/2;var s=r;this.phoneLastTop!==s&&(this.phoneLastTop=s),this.startedInMultiSelectMode||(this.itemMenuPhone.style[c.transition.style]="",t.setTransformStyle(this.itemMenuPhone,0,this.phoneLastTop),t.setTransformStyle(this.rightMenuPhone,0,0),this.rightMenuThresh=this.rightMenuWidth/200*c.windowWidth.peek())},updateRevealGestureMenu:function(e){var n=e.diffX;if(this.lastSwipeMove=e.xThisFrame,this.lastSwipeMoveTime=e.timeStamp,this.startedInMultiSelectMode){n-=this.rightMenuWidth;var i=t.clamp(n,-this.rightMenuWidth,0);t.setTransformStyle(this.rightMenuPhone,i,0)}else{var o=t.clamp(n,-this.rightMenuWidth,0);t.setTransformStyle(this.itemMenuPhone,c.windowWidth.peek()+o,this.phoneLastTop);var r=-this.rightMenuWidth-this.rightMenuThresh,a=t.clamp((-n-this.rightMenuWidth)/this.rightMenuThresh,0,1);this.itemMenuBG.style[c.transform.style]="scale3d(1,"+a+", 1)";var i=t.clamp(n+this.rightMenuWidth+this.rightMenuThresh,-this.rightMenuWidth,0);
t.setTransformStyle(this.rightMenuPhone,i,0);var s=t.clamp((-n+r)/(.75*this.rightMenuWidth),0,1);this.itemMenuPhone.style.opacity=1-s,t.isKeyboardOpen||t.vmMain.setSelected([t.menuOnItem]),n<=-this.rightMenuWidth?1!==this.itemMenuPhoneMode.peek()&&this.itemMenuPhoneMode(1):0!==this.itemMenuPhoneMode.peek()&&this.itemMenuPhoneMode(0)}},stopRevealGestureMenu:function(e){var n=200,i=e.diffX;t.revealingMenu=!1;e.timeStamp-this.lastSwipeMoveTime;if(this.startedInMultiSelectMode){i-=this.rightMenuWidth;var o=t.clamp(i,-this.rightMenuWidth,0);o<=-this.rightMenuWidth/2?t.setTransform(this.rightMenuPhone,-this.rightMenuWidth,0,200,"ease-out"):(this.closeMultiSelect(),t.vmMain.clearSelected())}else i<=-this.rightMenuWidth-this.rightMenuThresh?(t.setTransform(this.rightMenuPhone,-this.rightMenuWidth,0,200,"ease-out"),t.phoneMenu.multiSelectMode(!0),t.blurActiveElement(!0),t.vmMain.setSelected([t.menuOnItem])):(i<=-this.rightMenuWidth&&t.menuOnItem.isComplete(!t.menuOnItem.isComplete()),t.setTransform(this.rightMenuPhone,0,0,200,"ease-out"),t.isKeyboardOpen||t.vmMain.clearSelected());this.closePhoneMenu(n)},closeMultiSelect:function(){t.setTransform(this.rightMenuPhone,0,0,200,"ease-out"),t.phoneMenu.multiSelectMode(!1),t.vmMain.clearSelected()},closePhoneMenu:function(){var e=200;t.setTransform(this.itemMenuPhone,c.windowWidth(),this.phoneLastTop,e,"ease-out"),t.menuOnItem=void 0},onResize:function(){t.menuOnItem||t.setTransform(this.itemMenuPhone,c.windowWidth(),this.phoneLastTop)},onTapMenuPhone:{onStart:t.handlerPreventStop,onClick:function(e){if(0!==t.vmMain.selected().length){var n,i,o=e.srcElement.id;switch(o){case"phoneMenuComplete":n="isComplete",i=!t.vmMain.getFirstSelectedItem().isComplete();break;case"phoneMenuStar":n="isStarred",i=!t.vmMain.getFirstSelectedItem().isStarred();break;case"phoneMenuPriorityNone":n="priority",i=VMLIFlag.None;break;case"phoneMenuPriorityHigh":n="priority",i=t.vmMain.getFirstSelectedItem().priority()==VMLIFlag.P0?VMLIFlag.None:VMLIFlag.P0;break;case"phoneMenuPriorityMed":n="priority",i=t.vmMain.getFirstSelectedItem().priority()==VMLIFlag.P1?VMLIFlag.None:VMLIFlag.P1;break;case"phoneMenuPriorityLow":n="priority",i=t.vmMain.getFirstSelectedItem().priority()==VMLIFlag.P2?VMLIFlag.None:VMLIFlag.P2;break;case"phoneMenuZoom":t.vmMain.zoomin(t.vmMain.getFirstSelectedItem()),this.closeMultiSelect();break;case"phoneMenuDelete":n="deleteSelf";break;case"phoneMenuCollapse":if(this.selectionHasChildren())for(var r=0;r<t.vmMain.selected().length;r++)t.vmMain.selected()[r].hasChildren()&&(i||(i=!t.vmMain.selected()[r].isCollapsed()),t.vmMain.selected()[r].isCollapsed(i))}if(n)for(var r=0;r<t.vmMain.selected().length;r++)t.vmMain.selected()[r][n](i);"phoneMenuDelete"===o&&t.vmMain.clearSelected()}}},onTapComplete:{onClick:function(){t.menuOnItem.isComplete(!t.menuOnItem.isComplete())}},onTapPriority:{onClick:function(){var e=t.menuOnItem.priority(),n=e!==VMLIFlag.None?VMLIFlag.None:VMLIFlag.P0;t.menuOnItem.priority(n)}},onTapCollapse:{onClick:function(){t.menuOnItem.toggleCollapsed()}},onTapDelete:{onClick:function(){d.beginAction(),t.menuOnItem.deleteSelf(),d.endAction()}},paneTapped:function(){t.menuOnItem&&this.closePhoneMenu(100)},openContextMenu:function(e,n,i){t.autocomplete&&t.autocomplete.hide();var o={visibility:"visible",top:e.top},r=t.width(n);i||e.left+r>c.windowWidth()&&(i=!0),o.left=i?e.left-r-2:e.left+2;var a=t.height(n);e.top+a>c.windowHeight()&&(o.top-=a),t.css(n,o);var s=document.documentElement.getBoundingClientRect(),d=n.getBoundingClientRect(),l={left:d.left,right:d.right,top:d.top,bottom:d.bottom},u=t.adjustOriginToBeInsideBounds(s,l);(u.x!==l.left||u.y!==l.top)&&(n.style.left=u.x+"px",n.style.top=u.y+"px"),t.vmMain.handleFullscreenClick(function(){this.closeContextMenu(n)}.bind(this))},closeContextMenu:function(e){t.css(e,{visibility:"hidden"}),t.vmMain.cancelFullscreenClick()},registerModal:function(t,n,i,o){this[t+"Item"]=e.observable(n),this[t+"Visible"]=e.observable(!1),this[t+"Loading"]=e.observable(!1),i&&(this[t+"OpenFn"]=i),o&&(this[t+"CloseFn"]=o)},openModal:function(e){this[e+"OpenFn"]&&this[e+"OpenFn"].apply(this[e+"Item"](),Array.prototype.slice.call(arguments,1)),this.modalsBound||(t.applyBindings(this,"modals"),this.modalsBound=!0);var n=this[e+"Visible"];this.modalOpened=e,this.modalOpenedBound=this[e+"Item"](),n(!0),this.isModalVisible(!0),this.isModalOpen(!0)},closeModal:function(){this.modalOpened&&(arguments.length>1?this.closeModalInternal.apply(this,Array.prototype.slice.call(arguments,1)):this.closeModalInternal())},closeModalInternal:function(){if(this.modalOpened){var e=this[this.modalOpened+"Visible"],n=this.modalOpened;return e(!1),this.isModalOpen(!1),this.isModalVisible(!1),this.modalOpened=void 0,this.modalOpenedBound=void 0,this.modalInputOn=void 0,t.fireCustomEvent("closeKeyboard"),this[n+"CloseFn"]&&this[n+"CloseFn"].apply(this[n+"Item"](),arguments),!1}},focusModalInputMobile:function(e,n){this.modalInputOn?this.modalInputOn!=n?(n.focus(),this.modalOpenedBound.onKeyboardOpened&&requestAnimationFrame(function(){this.modalOpenedBound.onKeyboardOpened(e)}.bind(this)),e.preventDefault(),e.stopPropagation(),t.enforceScroll()):t.enforceScroll():t.openKeyboardOn(e,n,!0,!0,function(){c.app?(this.modalOpenedBound.onKeyboardOpened(e),requestAnimationFrame(function(){requestAnimationFrame(function(){n.focus(),t.enforceScroll()})})):n.focus()}.bind(this))},onTapModal:{onStart:function(e){c.mobile&&e.srcElement!=this.modalInputOn&&(t.isKeyboardInputElement(e.srcElement)||t.hasClass(e.srcElement,"input"))&&(log("start",t.isKeyboardOpen),t.isKeyboardOpen||(e.preventDefault(),e.stopPropagation()))},onClick:function(e){var n=!0;"modals"==e.srcElement.id?(this.closeModal(),this.modalInputOn=void 0):e.srcElement==this.modalInputOn?n=!1:t.isKeyboardInputElement(e.srcElement)||t.hasClass(e.srcElement,"input")?(c.mobile&&this.focusModalInputMobile(e,e.srcElement),this.modalInputOn=e.srcElement):this.modalInputOn=void 0,n&&c.mobile&&(e.preventDefault(),e.stopPropagation())}},onCloseKeyboard:function(){this.modalInputOn=void 0},paneIsTimeline:function(){return this.contextMenuOpenedOn()?this.contextMenuOpenedOn().isTimeline&&this.contextMenuOpenedOn().isTimeline():!1},openItemMenu:function(e,n){this.openContextMenu({left:n.pageX,top:n.pageY},t.element("contextMenuItem"),!1),this.contextMenuOpenedOn(t.getPaneForElement(n.srcElement));var i,o=!1;t.vmMain.applyToSelection(function(e,n,r){return e&&0===n&&(i=e,this.itemIsHeader(e.isHeader()),this.itemHasChildren(e.isHeader()||e.hasChildren()),this.itemIsCollapsed(e.isCollapsed()),this.itemIsArchived(e.isArchived()),this.itemCanIndent(0!==e.getIndex()),this.itemCanUnindent(e.parent()!==t.focusedItem)),o||e.canZoom()&&(o=!0,this.itemCanZoom(!0)),o||n!==r-1||this.itemCanZoom(!1),!o}.bind(this),{passExtraInfo:!0})},closeItemMenu:function(){this.closeContextMenu(t.element("contextMenuItem")),this.contextMenuOpenedOn(void 0)},itemContextText:function(){return this.itemIsCollapsed()?"Expand":"Collapse"},itemArchivedText:function(){return this.itemIsArchived()?"Unarchive":"Archive"},hotkeyText:function(e){return c.windows?c.cmdChar+"+"+e:c.cmdChar+""+e},onTapItemMenu:{onStart:t.handlerPreventStop,onClick:function(e){var n=e.srcElement.id;switch(n||(n=e.srcElement.parentNode.id),n){case"itemComplete":t.vmMain.applyFnToSelection("isComplete",!0);break;case"itemStar":t.vmMain.applyFnToSelection("isStarred",!0);break;case"itemIndent":t.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!1});break;case"itemUnindent":t.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!0});break;case"contextMenuPriority":break;case"itemPriorityNone":t.vmMain.applyPriorityToSelection(VMLIFlag.None);break;case"itemPriorityLow":t.vmMain.applyPriorityToSelection(VMLIFlag.P2);break;case"itemPriorityMed":t.vmMain.applyPriorityToSelection(VMLIFlag.P1);break;case"itemPriorityHigh":t.vmMain.applyPriorityToSelection(VMLIFlag.P0);break;case"itemCollapse":t.vmMain.applyToSelection(function(e){e.toggleCollapsed()});break;case"itemZoom":t.vmMain.applyToSelection(function(e){return e.canZoom()?(t.vmMain.zoomin(e),!1):!0});break;case"itemCopy":break;case"itemPaste":break;case"itemUndo":break;case"itemRedo":break;case"itemArchive":{var i=0;t.vmMain.applyToSelection(function(e){this.itemIsArchived()?e.parent().unarchiveChild(e)&&i++:e.parent().archiveChild(e)&&i++}.bind(this))}if(i>0){var o=i>1?" items.":" item.",r=this.itemIsArchived()?"unarchived":"archived";t.messageQueue.pushMessage({text:"Successfully "+r+" "+i+o,type:MessageType.Info,action:MessageAction.Default,timeout:2e3})}break;case"itemDelete":t.vmMain.applyToSelection(function(e){e.deleteSelf()});break;case"contextMenuItem":break;case"fullscreenClickGrabber":}t.sendEvent("ContextMenu",n),this.closeItemMenu()}}},l}),define("VMDocSharing",["ko","globals","platform","data","goog"],function(e,t,n,i,o){function r(){this.doc=e.observable({isOwned:function(){return!1}}),this.isLoading=e.observable(!1),this.isCreating=e.observable(!1),this.permissions=e.observableArray(),this.permissionsNew=e.observableArray(),this.permissionsRemove=[],this.newEmail=e.observable(""),this.errorGlobal=e.observable(!1),this.errorName=e.observable(!1),this.errorInvite=e.observable(!1),this.isSaving=e.observable(!1),this.editing=e.observable(""),this.closeCallback=void 0,this.justCreated=!1}return r.prototype={open:function(e,t){this.doc(e),this.closeCallback=t,this.permissions.removeAll(),this.permissionsNew.removeAll(),this.permissionsRemove=[],this.newEmail(""),this.editing(""),this.isLoading(!0),this.errorGlobal(!1),this.errorName(!1),this.errorInvite(!1),this.isSaving(!1),this.isCreating(!this.doc().file),this.justCreated=!1,this.inputName=document.getElementById("shareNameInput"),this.inputName.value=this.doc().title(),this.shareLink=document.getElementById("shareLinkInput"),this.shareLink&&(this.shareLink.value="http://moo.do/#file="+this.doc().id),n.mobile||setTimeout(function(){this.inputName.focus()}.bind(this),0),this.isCreating()?this.isLoading(!1):gapi.client.drive.permissions.list({fileId:this.doc().id}).execute(this.permissionHandler.bind(this))},addPadding:function(){var e=300;n.android&&(e=n.getKBSize()+20),document.getElementById("shareScroller").style.paddingBottom=e+"px"},removePadding:function(){document.getElementById("shareScroller").style.paddingBottom=""},permissionHandler:function(e){if(!e.error){this.isLoading(!1);for(var n=[],i=0;i<e.items.length;++i){var o=e.items[i];o.emailAddress!==t.getUserIdentifier()&&(o.onRemove=this.onRemove.bind(this,o),"anyone"!=o.id&&(o.emailAddress||(o.emailAddress="owner"===o.role?"Owner":""),"owner"===o.role?n.splice(0,0,o):n.push(o)),o.emailDisplay="("+o.emailAddress+")")}this.permissions(n)}},isOwned:function(){return this.doc().isOwned&&this.doc().isOwned()},saveText:function(){return this.isCreating()?this.isSaving()?"Creating...":"Create":n.mobile&&this.editing()?"Close":this.newEmail().length>0?"Invite":this.isSaving()?"Saving...":"Save"},titleText:function(){return n.mobile&&this.editing()?this.editing():this.isCreating()?"Create Document":"Edit Document"},onkeydown:function(e,i){return n.normalizeKeys(i),i.normCode==KeyCode.Escape?(this.newEmail(""),i.preventDefault(),i.stopImmediatePropagation(),!1):i.normCode==KeyCode.Enter?(this.inviteUser(),t.scrollIntoView(t.element("inputShareInvite"),0),i.preventDefault(),i.stopImmediatePropagation(),!1):!0},onKeyboardOpened:function(e){this.editing(e.srcElement.title)},inviteUser:function(){if(0===this.newEmail().length)return void this.errorInvite("");if(!t.isEmail(this.newEmail()))return this.errorInvite("Please enter a valid email address."),!1;var n={emailAddress:this.newEmail(),error:e.observable(!1)},o=i.findContactByEmail(n.emailAddress.toLowerCase());return n.name=o?o.text:n.emailAddress,n.onRemove=this.onRemoveNew.bind(this,n),this.permissionsNew.push(n),this.newEmail(""),this.errorInvite(!1),!0},checkName:function(){var e=this.inputName.value.trim();return e.length>0&&e.length<255?(this.errorName(!1),!0):(this.errorName("Error: Document name must be >0 and <255 characters."),!1)},rename:function(){var e=this.inputName.value.trim();e!=this.doc().title()&&(this.doc().title(e),gapi.client.drive.files.patch({fileId:this.doc().id,resource:{title:e}}).execute(function(t){t.error?this.errorName("Error: Unable to update name on remote server."):log("File renamed to",e)}.bind(this)))},create:function(e){this.justCreated=!0,this.isSaving(!0);var t=this.inputName.value.trim();this.tooltip=t,this.isSaving(!0),gapi.client.drive.files.insert({resource:{mimeType:o.REALTIME_MIMETYPE,title:t,writersCanShare:!1}}).execute(function(t){t.error?this.errorGlobal("Error: Unable to create new document."):(this.doc().id=t.id,this.doc().file=t,this.isCreating(!this.doc().file),this.isSaving(!1),e&&e())}.bind(this))},save:function(){function e(e,o){o.error?(console.error("UH OH",o),this.permissionsNew()[i].error(!0),this.errorInvite("Some people could not be invited."),this.isSaving(!1)):(n--,0>=n&&t.menus.closeModal("shareDoc",!1))}if(!this.isSaving()||this.justCreated){if(this.editing())return t.blurActiveElement(),void this.editing("");if(!o.isDriveAPILoaded())return void this.errorGlobal("Error communicating with Google Drive. Please reconnect and try again.");if(this.checkName()){if(this.isCreating())return void this.create(this.save.bind(this));if(this.newEmail().length>0){if(!this.inviteUser())return}else this.errorInvite(!1);this.rename();for(var n=0,i=0;i<this.permissionsNew().length;i++){var r=this.permissionsNew()[i];if(!r.error()){n++;var a={value:r.emailAddress,type:"user",role:"writer",withLink:!1},s="Come collaborate with me at Moo.do!\r\nhttp://www.moo.do/app/#login=true&file="+this.doc().id;gapi.client.drive.permissions.insert({fileId:this.doc().id,emailMessage:s,resource:a}).execute(e.bind(this,i))}}for(var i=0;i<this.permissionsRemove.length;i++){var d=this.permissionsRemove[i];gapi.client.drive.permissions.delete({fileId:this.doc().id,permissionId:d.id}).execute(function(e){})}this.errorInvite()||this.errorName()||(0===n?t.menus.closeModal("shareDoc",!0):(this.isSaving(!0),this.onClose(!0)))}}},onClose:function(e){this.closeCallback&&(this.closeCallback(e),this.closeCallback=void 0),t.blurActiveElement()},onTapInviteMessage:{onStart:t.handlerPreventStop,onClick:function(e){var i=t.element("inputShareInvite");n.mobile?t.menus.focusModalInputMobile(e,i):i.focus()}},onTapSave:{onStart:t.handlerPreventStop,onClick:function(){this.save(),t.sendEvent("Menu","SharingSave")}},onTapCancel:{onStart:t.handlerPreventStop,onClick:function(){t.menus.closeModal("shareDoc",!1),t.sendEvent("Menu","SharingCancel")}},onTapDelete:{onStart:t.handlerPreventStop,onClick:function(){t.sendEvent("Menu","SharingDelete"),setTimeout(function(){var e=prompt("This will delete the file. Type DELETE to confirm.");e&&"delete"==e.trim().toLowerCase()&&(gapi.client.drive.files.delete({fileId:this.doc().id}).execute(function(e){log("Document Delete Response: ",e),e.error&&t.messageQueue.pushMessage({text:"Unable to delete document on the remote server.",type:MessageType.Error})}.bind(this)),t.vmMain.vmPicker.removeFile(this.doc()),t.menus.closeModal("shareDoc",!1))}.bind(this),0)}},onRemove:function(e){this.permissionsRemove.push(e),this.permissions.remove(e),t.sendEvent("Menu","SharingRemoveUser")},onRemoveNew:function(e){this.permissionsNew.remove(e)}},r}),define("VMPicker",["ko","globals","util","platform","data","goog","VMDocument","VMDocSharing","tracker"],function(e,t,n,i,o,r,a,s,d){function c(){this.files=e.observableArray(),this.permissions=e.observableArray(),this.isPublic=e.observable(),this.fileMap={},this.isLoading=e.observable(!1),this.needPermission=e.observable(!1),this.showError=e.observable(!1),this.filePageRequests=0,this.loadCallbacks=[],this.init()}var l=5,u=r.REALTIME_MIMETYPE+"."+r.APP_ID;return c.prototype={init:function(){var e=new s;t.menus.registerModal("shareDoc",e,e.open.bind(e),e.onClose.bind(e))},refreshFiles:function(){this.runOnFileLoad(this.markFileProperties.bind(this)),this.loadFileList()},clearFiles:function(){this.files.removeAll()},setFiles:function(e,t){this.clearFiles(),this.addFiles(e,t)},addFiles:function(e,t){for(var n=0;n<e.length;n++){var i=e[n],o=new a(i);o.isOpen=i.id===t,this.files.push(o),this.fileMap[i.id]=i}this.setMinHeight()},runLoad:function(e){gapi.client.drive.files.list({fields:"items(appDataContents,createdDate,description,editable,etag,exportLinks,iconLink,id,indexableText,kind,labels,md5Checksum,mimeType,ownerNames,owners,parents,permissions,properties,quotaBytesUsed,shared,sharedWithMeDate,sharingUser,title,userPermission,version,writersCanShare),kind,nextLink,nextPageToken",maxResults:999,pageToken:e,q:"trashed=false and mimeType contains '"+u+"'"}).execute(function(e){e.error||!e.items&&0===this.files().length&&!e.nextPageToken?this.showError("Load Documents"):e.items&&this.addFiles(e.items,r.getDocId()),this.filePageRequests++,e.error||!e.nextPageToken||this.filePageRequests>=l?(this.isLoading(!1),this.onFilesLoaded(e)):this.runLoad(e.nextPageToken)}.bind(this))},loadFileList:function(){this.isLoading()||(this.isLoading(!0),this.showError(!1),this.clearFiles(),this.filePageRequests=0,gapi&&gapi.client.drive?this.runLoad():gapi.client.load("drive","v2",this.runLoad.bind(this)))},markFileProperties:function(e){if(e&&e.items)for(var t=0;t<e.items.length;++t){var n=e.items[t];if(!n.properties&&n.title===r.LEGACY_DefaultDriveDocTitle&&"me"===n.userPermission.id&&"owner"===n.userPermission.role){gapi.client.drive.properties.insert({fileId:n.id,resource:{key:r.DefaultProperty,value:r.DefaultPropertyValue,visibility:"PRIVATE"}}).execute(function(e){(e.error||"drive#property"!==e.kind)&&ShouldLog(LogLevels.Error)&&log("Error adding default file property: ",e)});break}}},onFilesLoaded:function(e){if(this.loadCallbacks.length>0){for(var t=0;t<this.loadCallbacks.length;++t)this.loadCallbacks[t]&&this.loadCallbacks[t](e);this.loadCallbacks=[]}},runOnFileLoad:function(e){this.loadCallbacks.push(e)},requestOpenDocument:function(e){var t=this.getFile(e);t?this.openDocument(t):this.needPermission()?this.doRequestPermission(function(){this.openDocumentFromId(e)}.bind(this)):this.openDocumentFromId(e)},openDocumentFromId:function(e,i){var a=r.getDocId();if(a!==e){var s=[Settings.docSharing,Settings.authScopes,Settings.shownTutorial,Settings.lastMessageSync,Settings.helpPaneState];o.clearData(function(){r.setDocInfo(e,i),n.hasURLParam("file")?n.removeURLParam("file",!0):n.hasURLParam("state")&&n.removeURLParam("state",!0),setTimeout(function(){t.reload()},500)},s)}},openDocument:function(e){t.localDocChangeRequested=!0,this.openDocumentFromId(e.id,e.title)},doRequestPermission:function(){},onRequestPermission:function(){this.doRequestPermission()},onTapReloadDocuments:function(){this.loadFileList()},onTapDocument:{onClick:function(n){var i=e.dataFor(n.srcElement);t.hasClass(n.srcElement,"documentTitle")?(this.openDocument(i),d.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenDocument,data:[{value:!0}]})):i instanceof a?(i.onTapMenu(),n.stopImmediatePropagation()):t.reportError("Incorrect document type: "+t.elementToString(n.srcElement)),n.preventDefault(),n.stopImmediatePropagation()}},onTapAdd:{onStart:t.handlerPreventStop,onClick:function(){if(t.vmMain&&t.vmMain.isOnline()){var e=new a;e.isOwned(!0),this.files.push(e),this.setMinHeight(),t.sendEvent("Menu","AddDocument"),e.openSharing(function(t){t||(this.files.remove(e),this.setMinHeight())}.bind(this)),d.miscAction({type:TrackerType.Misc,misc:TrackerMisc.AddDocument,data:[{value:!0}]})}else t.messageQueue.pushMessage({text:"You must be online to create a new document",type:MessageType.Warning,timeout:8e3})}},onTapRefresh:{onStart:t.handlerPreventStop,onClick:function(){t.vmMain&&t.vmMain.isOnline()&&!this.isLoading()&&this.refreshFiles()}},getFile:function(e){return this.fileMap[e]},removeFile:function(e){this.files.remove(e),this.setMinHeight(),e.isOpen&&o.clearData(function(){setTimeout(function(){t.reload()},0)})},setMinHeight:function(){if(!i.mobile){var e=document.getElementById("documentsList");if(!e)return void setTimeout(this.setMinHeight.bind(this),0);var n=e.clientHeight;t.element("sidebarDocumentContainer").style.minHeight=n+50+"px"}}},c}),define("VMSettings",["ko","data","globals","util","goog","platform","tracker","VMPicker"],function(e,t,n,i,o,r,a){function s(){this.enabledSyncContacts=e.observable(!1),this.enabledSounds=e.observable(!1),this.enabledNotifications=e.observable(!1),this.enabledMobileUI=e.observable(!1),this.syncContactsEnabledOnOpen=e.observable(!1),this.refreshingContacts=!1,this.refreshContactsSuccess=e.observable(void 0),this.init()}return s.prototype={init:function(){if(n.menus.registerModal("settings",this,this.open.bind(this),this.close.bind(this)),this.loadSettings(),r.mobile){var e=this.save.bind(this);this.enabledSyncContacts.subscribe(e),this.enabledSounds.subscribe(e),this.enabledNotifications.subscribe(e),this.enabledMobileUI.subscribe(e)}if(r.isTouchDevice&&!r.app){var t=document.getElementById("paneSettings");t&&t.addEventListener(r.touchStartEvent,function(e){return n.preventScrollPropagation(t)||"paneSettings"!=e.srcElement.id?void 0:(e.preventDefault(),!1)})}r.mobile&&n.ScreenManager.addScreen(this,Screens.Settings),window.addEventListener("settingsChange_"+Settings.syncContacts,this.onSyncContactsChange.bind(this))},isLocal:function(){return"localhost"===window.location.hostname},showMobileAppReview:function(){return!1},showMobileUIOptionOnDesktop:function(){try{return!!i.storage.getItem("forceFullUI")}catch(e){return!1}},showMobileUIOptionOnMobile:function(){return parseInt(window.innerWidth)>767},onEnableNotificationsChange:function(){this.enabledNotifications()?n.timeline.updateNotifications():n.timeline.clearNotifications()},onSyncContactsChange:function(e){this.enabledSyncContacts(e.data)},getTopElement:function(){return document.getElementById("paneSettings")},open:function(){this.isClosing||(this.refreshContactsSuccess(void 0),this.loadSettings(),this.syncContactsEnabledOnOpen(this.enabledSyncContacts()))},close:function(e){if(e)this.save();else{var t=!!n.settings.get(Settings.syncContacts);this.enabledSyncContacts(t),this.enabledSounds(!n.settings.get(Settings.noSounds))}},onScreenStartOpen:function(){this.loadSettings()},enableSyncContacts:function(e){function t(t){0>t?(n.messageQueue.pushMessage({text:'There was an error syncing your contacts. Please try again using the "Refresh Contacts" button in settings.',type:MessageType.Error}),e&&e(!1)):t>0&&(n.vmMain.runParseWorker(),e&&e(!0))}n.sendEvent("Settings","EnableContacts"),o.runAuthenticate([GScope.Contacts],!1,!1,function(i){i&&!i.error?(o.loadContacts(t),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SyncContacts,data:[{value:!0}]}),this.enabledSyncContacts(!0),n.settings.set(Settings.syncContacts,!0)):(this.enabledSyncContacts(!1),n.settings.set(Settings.syncContacts,!1),n.messageQueue.pushMessage({text:"If you would like to sync your contacts we need permission to access them. Please enable access to your Google contacts.",type:MessageType.Error,timeout:1e4}),e&&e(!1))}.bind(this))},loadSettings:function(){this.enabledSyncContacts(!!n.settings.get(Settings.syncContacts)),this.enabledSounds(!n.settings.get(Settings.noSounds)),this.enabledNotifications(!n.settings.get(Settings.disableNotifications));try{this.enabledMobileUI(!i.storage.getItem("forceFullUI"))}catch(e){this.enabledMobileUI(!1)}},save:function(){var e,r=this.enabledSyncContacts()!==!!n.settings.get(Settings.syncContacts),a=this.enabledSounds()!==!n.settings.get(Settings.noSounds),s=this.enabledNotifications()!==!n.settings.get(Settings.disableNotifications);try{e=this.enabledMobileUI()!==!i.storage.getItem("forceFullUI")}catch(d){e=!1}r&&(n.settings.set(Settings.syncContacts,this.enabledSyncContacts()),this.enabledSyncContacts()?this.enableSyncContacts():(n.sendEvent("Settings","DisableContacts"),o.loadedContacts=!1,t.clearContacts())),a&&n.settings.set(Settings.noSounds,!this.enabledSounds()),s&&n.settings.set(Settings.disableNotifications,!this.enabledNotifications()),e&&n.shouldWriteLocal()&&(this.enabledMobileUI()?i.storage.removeItem("forceFullUI"):i.storage.setItem("forceFullUI",!0))},isDemo:function(){return n.isDemoMode()},onTapSave:function(){n.menus.closeModal("settings",!0)},onTapCancel:function(){n.menus.closeModal("settings",!1)},onScreenOpen:function(){n.isKeyboardOpen&&n.blurActiveElement()},onScreenClose:function(){this.save()},onTapLogout:function(e){n.vmSetup.logoutClicked(),n.sendEvent("Menu","Logout"),e.preventDefault()},onTapRunPicker:function(){},onTapFeedback:function(e){n.menus.openModal("reportBug"),n.sendEvent("Menu","GiveFeedback"),e.preventDefault()},onTapLeaveDemo:function(){i.removeURLParam("demo")},onTapRestartClient:function(e){n.reload(),e.preventDefault()},onTapPromptResetClient:function(e){n.messageQueue.pushMessage(MessageID.CacheReset),e.preventDefault()},onTapResetClient:function(){t.clearData(function(){n.reload()}),n.sendEvent("Menu","ResetClient")},onForceReloadDoc:function(){var e=[Settings.docSharing,Settings.authScopes,Settings.shownTutorial,Settings.gdocId,Settings.gdocTitle,Settings.helpPaneState];t.clearData(function(){n.reload()},e),n.sendEvent("Menu","ReloadDoc")},onTapSettings:function(){n.menus.openModal("settings"),n.vmMain.cancelFullscreenClick(),n.sendEvent("Menu","Settings")},onTapHelp:function(){n.vmMain.showHelp(HelpMode.Normal),n.sendEvent("Menu","HelpSidebar")},onlineStatusToggle:function(){r.offline?i.removeURLParam("offline"):i.insertURLParam("offline","true")},logoutButtonText:function(){return n.vmSetup.logoutButtonText()},isLoggedIn:function(){return n.vmSetup.loginState()==LoginState.LOGGED_IN},showAppDebugInfo:function(){return r.debugApp},getHostName:function(){return"Host: "+window.location.host},getAppDebugText:function(){return"LowMem: "+(n.hasSentLowMemoryWarning()?"TRUE":"FALSE")},onTapRefreshContacts:function(){this.refreshingContacts||(this.refreshingContacts=!0,this.refreshContactsSuccess(void 0),t.clearLocalContacts(),o.loadedContacts=!1,o.authAndLoadContacts(function(e){this.refreshContactsSuccess(e),setTimeout(function(){this.refreshingContacts=!1}.bind(this),1e3)}.bind(this)),n.sendEvent("Menu","RefreshContacts"))},contactsRefreshSuccessTest:function(){return void 0===this.refreshContactsSuccess()?"":this.refreshContactsSuccess()===!0?"Success!":this.refreshContactsSuccess()===!1?"Failure!":void 0},onTapImport:function(){n.menus.openModal("importData"),n.sendEvent("Menu","ImportData"),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenImport,data:[{value:!0}]})},onTapExport:function(){n.menus.openModal("exportData"),n.sendEvent("Menu","ExportData"),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenExport,data:[{value:!0}]})},onTapRestartIntro:function(){n.intro?(n.intro.clearState(),n.intro.init()):n.vmMain.showHelp()},onTapSendToAppReview:function(){r.appReviewLink&&n.openUrl(r.appReviewLink)}},s}),define("VMPhoneMenu",["ko","globals","data","platform","tracker","gdata"],function(e,t,n,i,o,r){function a(){this.searchScale="",this.searchTranslate="",this.search=t.vmSearchPhone,this.mode=e.observable(this.Modes.Normal),this.multiSelected=t.vmMain.selected,this.activeScreen=e.observable(Screens.List),this.init()}return a.prototype={Modes:{Normal:0,Multiselect:1,Contact:2,Date:3},init:function(){t.applyBindings(this,"phoneMenu"),window.appEvents=this.appEvents,i.app&&(document.onreadystatechange=function(){i.sendToApp("kbsize"),i.sendToApp("loaded")},document.onreadystatechange()),this.mode.subscribe(function(e){e==this.Modes.Multiselect?(t.addClass(t.focusedPane.element,"multiSelectMode"),o.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.OpenMultiselect})):(t.removeClass(t.focusedPane.element,"multiSelectMode"),o.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.CloseMultiselect}))}.bind(this)),window.addEventListener("screenScroll",function(){this.activeScreen(t.ScreenManager.activeScreen)}.bind(this))},_modeHelper:function(e,t){return void 0!==e&&this.mode(e?t:this.Modes.Normal),this.mode()===t},activeScreenClass:function(){var e=this.activeScreen(),t="";return e==Screens.List?t="listActive":e==Screens.Outline?t="outlineActive":e==Screens.Settings&&(t="settingsActive"),this.search.isShowing()&&(t+=" searchShowing"),this.search.isFocused()&&(t+=" searchFocused"),t},normalMode:function(e){return this._modeHelper(e,this.Modes.Normal)},multiSelectMode:function(e){return this._modeHelper(e,this.Modes.Multiselect)},contactMode:function(e){return this._modeHelper(e,this.Modes.Contact)},dateMode:function(e){return this._modeHelper(e,this.Modes.Date)},isSaved:function(){return log("IsSaved DriveStatus: ",t.vmMain.gdriveStatus()),i.offline||t.vmMain.gdriveStatus()===DriveStatus.Saved},showSearchSeparator:function(){return this.search.showSearchSeparator()},isTimeline:function(){return t.focusedPane.mode()==PaneMode.Timeline},titleText:function(){var e=t.focusedPane.item(),n=e.getParsedText();return n},isMenuMain:function(){return t.ScreenManager.isScreenOpen(Screens.List)},isMenuContext:function(){return t.ScreenManager.isScreenOpen(Screens.Outline)},isMenuSettings:function(){return t.ScreenManager.isScreenOpen(Screens.Settings)},updateSearchDOM:function(){},onTapMultiSelectCancel:{onClick:function(e){t.menus.closeMultiSelect(),t.handlerPreventStop(e)}},onTapAutocompleteClose:{onClick:function(e){t.autocomplete.hide(),t.handlerPreventStop(e)}},onTapList:{onClick:function(e){t.ScreenManager.scrollToScreen(Screens.List),t.handlerPreventStop(e),t.sendEvent("PhoneMenu","CloseOutline")}},onTapOutline:{onClick:function(e){t.ScreenManager.scrollToScreen(Screens.Outline),t.handlerPreventStop(e),t.sendEvent("PhoneMenu","OpenOutline")}},onTapSettings:{onClick:function(e){log("tap settings"),t.ScreenManager.scrollToScreen(t.ScreenManager.activeScreen==Screens.Settings?Screens.Outline:Screens.Settings),t.handlerPreventStop(e),t.sendEvent("PhoneMenu","OpenSettings")}},onTapMode:{onClick:function(e){this.toggleMode(),t.focusedPane.mode()==PaneMode.Timeline?o.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.PaneAgenda}):t.focusedPane.mode()==PaneMode.Normal&&o.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.PaneNormal}),o.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.OpenKeyboard}),t.handlerPreventStop(e),t.sendEvent("PhoneMenu","SwitchMode")}},onTapArchive:{onClick:function(e){t.focusedPane.archiveCompleted(),t.sendEvent("PhoneMenu","ArchiveCompleted"),t.handlerPreventStop(e)}},onTapHeader:{onStart:function(e){t.ScreenManager.checkSwipeStart(e)},onMove:function(e){t.ScreenManager.checkSwipeMove(e)},onEnd:function(e){t.ScreenManager.checkSwipeEnd(e)}},paneTapped:function(){},updateSearchTransform:function(){t.element("searchDivPhone").style[i.transform.style]=this.searchTranslate+" "+this.searchScale},toggleMode:function(){t.blurActiveElement(),t.focusedPane.initialOffset=void 0,t.focusedPane.mode()==PaneMode.Normal?(t.vmMain.clearSelected(),t.focusedPane.mode(PaneMode.Timeline)):t.focusedPane.mode(PaneMode.Normal),t.focusedPane.vmSearch.updateSearch(!0),t.vmMain.updatePaneState(t.focusedPane)},appEvents:{undo:function(){log("shake to undo"),o.undoAction()},redo:function(){log("shake to redo"),o.redoAction()},kbsize:function(e){e>0&&e!==i.kbsize&&(i.setKBSize(e),t.keyboardToolbar&&t.keyboardToolbar.updatePosition())},closeKeyboard:function(){t.blurActiveElement(),t.vmMain.clearSelected()},enterBackground:function(){t.onunload()},enterForeground:function(){r.poke(),t.checkForRemoteChanges()},reportLowMemory:function(e){t.handleLowMemory(e)},statusBarTap:function(){var e=t.getFirstPaneItem(t.focusedPane);t.scrollToTop(e.getSpan(),200)}}},a}),define("VMKeyboardToolbar",["ko","globals","data","edit","platform","tracker"],function(e,t,n,i,o,r){function a(){this.buttons=e.observableArray(),this.priorityVisible=e.observable(),this.isVisible=e.observable(!1),this.element=void 0,this.aboutToShow=void 0,this.bottomPosition=void 0,this.topBarHidden=!1,this.init()
}return a.prototype={init:function(){this.element=t.element("mobileKeyboardToolbar"),t.applyBindings(this,"mobileKeyboardToolbar"),window.addEventListener("closeKeyboard",this.hide.bind(this))},onTap:{onStart:t.handlerPreventStop,onClick:function(e){var n=e.srcElement.id;if("mobileKeyboardToolbar"==n&&(e.preventDefault(),e.returnFalse=!0),"closeKeyboardButton"==n)t.blurActiveElement(),t.vmMain.clearSelected();else if(t.vmSearchPhone.isFocused()){var i;"priorityButton"==n?i="!":"dateButton"==n?i="@":"contactButton"==n?i="+":"tagButton"==n&&(i="#"),t.vmSearchPhone.insert(i)}else"outdentButton"==n?t.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!0}):"indentButton"==n?t.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!1}):"priorityButton"==n?this.priorityVisible(!this.priorityVisible()):"pNoneButton"==n?t.vmMain.applyPriorityToSelection(VMLIFlag.None,!1):"p0Button"==n?t.vmMain.applyPriorityToSelection(VMLIFlag.P0,!0):"p1Button"==n?t.vmMain.applyPriorityToSelection(VMLIFlag.P1,!0):"p2Button"==n?t.vmMain.applyPriorityToSelection(VMLIFlag.P2,!0):"pStarButton"==n?t.vmMain.applyFnToSelection("isStarred",!0):"dateButton"==n?(t.vmMain.insertCharacter("@",!0),r.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.AtButton})):"contactButton"==n?t.vmMain.insertCharacter("+",!0):"tagButton"==n&&t.vmMain.insertCharacter("#",!0);t.handlerPreventStop(e)}},preShow:function(){this.aboutToShow=!0,this.priorityVisible(!1),setTimeout(function(){this.aboutToShow=!1}.bind(this),100)},show:function(e){this.aboutToShow=!1,this.updatePosition(),t.isKeyboardOpen=!0,(!o.ie||o.ie&&(o.mobro||o.winphone))&&this.isVisible(!0),this.hideTopBarIfLandscape(),t.vmSearchPhone.isFocused()?(t.addClass(this.element,"kbsearch"),t.removeClass(this.element,"kbmodal")):e?(t.addClass(this.element,"kbmodal"),t.removeClass(this.element,"kbsearch")):(t.removeClass(this.element,"kbmodal"),t.removeClass(this.element,"kbsearch")),setTimeout(function(){r.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.OpenKeyboard}),t.fireCustomEvent("keyboardOpened")},0)},hide:function(){!this.aboutToShow&&t.isKeyboardOpen&&(this.priorityVisible(!1),t.onCloseKeyboard&&t.onCloseKeyboard(),t.isKeyboardOpen=!1,this.hideTopBarIfLandscape(),this.isVisible(!1),r.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.CloseKeyboard}))},hideTopBarIfLandscape:function(){if(o.orientation===Orientation.Landscape&&t.isKeyboardOpen){if(t.setTransform(t.element("container"),0,-t.topBarHeight),t.setTransform(t.element("phoneMenuTopWrapper"),0,-t.topBarHeight),this.topBarHidden=!0,t.vmMain.selected().length>0){var e=t.vmMain.selected()[0];t.scrollToTop(e.getSpan())}}else this.topBarHidden&&(this.topBarHidden=!1,t.setTransform(t.element("container"),0,0),t.setTransform(t.element("phoneMenuTopWrapper"),0,0))},updatePosition:function(){o.app||(o.kbsize=o.orientation==Orientation.Portrait?o.kbsizePortrait:o.kbsizeLandscape);var e=o.kbsize;e!==this.bottomPosition&&(this.bottomPosition=e,t.element("mobileKeyboardToolbar").style.bottom=o.getKBTop()+"px",t.isKeyboardOpen&&t.focusedPane.addPadding())}},a}),this.document||(importScripts("lib/date.js"),importScripts("DuchessHelpers.js")),this.document?window.parseWorkerWrapper=parseWorkerWrapper:parseWorkerWrapper(),define("parseWorker",function(){}),define("VMIntroSection",["ko","globals","platform","data"],function(e,t,n){function i(t,n){this.text=t,this.note=n,this.items=[],this.inOrder=!1,this.enforceOrder=!1,this.owner=void 0,this.numComplete=0,this.next=0,this.isComplete=e.observable(!1)}return i.prototype={getHash:function(){return t.introHash(this.text)},getStepHash:function(e){return t.introHash(this.items[e].text)},defaultShow:function(){this.isDisabled(!1)},loadFromSaveData:function(e){if(e===!0){for(var n=0;n<this.items.length;++n)this.items[n].isComplete(!0);this.numComplete=this.items.length,this.isComplete(!0)}else{for(var n=0;n<e.length;++n)for(var i=0;i<this.items.length;++i)e[n]===this.getStepHash(i)&&(this.items[i].isComplete(!0),this.numComplete++,this.inOrder&&(this.next=Math.max(this.next,i+1)));this.numComplete===this.items.length&&this.isComplete(!0)}this.inOrder&&0!==this.next&&(this.items[this.next].show(),!t.isKeyboardOpen&&this.owner.needsKeyboardOpen&&t.tooltip.hideTip())},addStep:function(i){return i.isComplete||(i.isComplete=e.observable(!1)),this.inOrder&&!n.mobile?i.isDisabled||(i.isDisabled=e.observable(this.items.length>0)):i.isDisabled=t.fFalse,i.show||(i.show=this.defaultShow.bind(i)),this.items.push(i),i},complete:function(e){e.isComplete()||(this.numComplete++,e.isComplete(!0),this.numComplete===this.items.length&&this.isComplete(!0),this.owner.notifyOfChange(e))},check:function(e){for(var t=0;t<this.items.length&&(this.items[t].isComplete()||((e===!0||this.items[t].check(e))&&(this.complete(this.items[t]),this.inOrder&&t===this.next&&(this.next++,this.next<this.items.length&&this.items[this.next].show())),!this.enforceOrder));t++);this.numComplete===this.items.length&&this.isComplete(!0)},showFirstIncomplete:function(){for(var e=0;e<this.items.length;e++)if(!this.items[e].isComplete()){this.items[e].show();break}}},i}),define("VMIntro",["ko","globals","util","platform","data","VMIntroSection"],function(e,t,n,i,o,r){function a(n){this.mode=e.observable(),this.sections=e.observableArray(),this.introSection=void 0,this.needsKeyboardOpen=!1,this.ModeClassIntro="helpIntro",this.ModeClassNormal="helpNormal",this.init(n),t.intro=this}return window.HelpMode={None:0,Normal:1,Intro:2},a.prototype={init:function(e){this.sections.removeAll(),this.setMode(e),i.mobile?this.initMobile():(this.initItemsDesktop(),this.isIntroMode()?this.initIntro():this.initHelp()),this.loadState()},initItemsDesktop:function(){this.itemAddItem={text:"Write a list header and press enter to add a new item",check:this.checkAddItem},this.itemIndent={text:"Press the Tab key to add an item into a list",check:this.checkIndent},this.itemOutdent={text:"Press Shift+Tab to remove an item out of a list",check:this.checkOutdent},this.itemDateTime={text:"Add a date/time by typing @ in the text of an item",check:function(e){return e.type===TrackerType.Insert&&"@"===e.data[0].text}},this.itemRightClick={text:"Right click an item to explore more options",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.RightClick}},this.itemAddAgenda={text:'Click <i class="icon-calendar2 f22 gd"></i> in the top right to add an Agenda pane',check:function(e){if(e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.AddPane){var n=t.vmMain.panes()[e.data[0].data];if(n.mode()===PaneMode.Timeline)return!0}}}},setMode:function(e){this.mode(e),t.settings.set(Settings.helpPaneState,e),t.vmMain.helpButtonHidden(e===HelpMode.Intro)},isIntroMode:function(){return this.mode()===HelpMode.Intro},modeClass:function(){return this.isIntroMode()?this.ModeClassIntro:this.ModeClassNormal},loadState:function(){if(t.shouldWriteLocal())try{var e=n.storage.getItem(this.modeClass());if(e){var i=JSON.parse(e);if(i)for(var o=0;o<this.sections().length;++o){var r=this.sections()[o],a=r.getHash();i[a]&&r.loadFromSaveData(i[a])}}else n.storage.setItem(this.modeClass(),"{}")}catch(s){t.reportError(s)}},saveState:function(){if(t.shouldWriteLocal())try{var e=this.getState();n.storage.setItem(this.modeClass(),JSON.stringify(e))}catch(i){t.reportError(i)}},getState:function(){for(var e={},t=0;t<this.sections().length;++t){var n=this.sections()[t];if(n.isComplete())e[n.getHash()]=!0;else{for(var i=[],o=0;o<n.items.length;++o)if(n.items[o].isComplete()){var r=n.getStepHash(o);i.push(r)}i.length>0&&(e[n.getHash()]=i)}}return e},clearState:function(){n.storage.setItem(this.ModeClassIntro,""),n.storage.setItem(this.ModeClassNormal,"")},notifyOfChange:function(){this.saveState()},addSection:function(e){e.owner=this,this.sections.push(e)},initIntro:function(){this.introSection=new r("Welcome to Moo.do!","We'll walk you through the basics to get you started."),this.introSection.inOrder=!0,this.introSection.addStep(this.itemAddItem),this.introSection.addStep(this.itemIndent),this.introSection.addStep(this.itemOutdent),this.introSection.addStep(this.itemDateTime),this.introSection.addStep(this.itemRightClick),this.introSection.addStep(this.itemAddAgenda),this.addSection(this.introSection)},checkAddItem:function(e){if(e.type===TrackerType.Create){var t=o.itemsById[e.data[0].itemID].model;return t.parent()!=o.getRootModel()||0!==e.data[0].position?!0:!1}},checkIndent:function(e){if(e.type===TrackerType.Move){var t=o.itemsById[e.data[0].oldParent].data;if(t.items.indexOf(e.data[0].newParent)>=0)return!0}},checkOutdent:function(e){if(e.type===TrackerType.Move){var t=o.itemsById[e.data[0].newParent].data;if(t.items.indexOf(e.data[0].oldParent)>=0)return!0}},checkSearch:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged},checkComplete:function(e){if(e.type===TrackerType.Update){var t=e.data[0];return"isComplete"===t.field&&t.newValue}},checkOutline:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.ToggleOutline},initHelp:function(){this.sections.removeAll();var e=new r("Organization","Moo.do works like a text editor so you can organize like you're writing a document.");e.addStep(this.itemAddItem),e.addStep(this.itemIndent),e.addStep(this.itemOutdent),e.addStep({text:"Click and drag on the left edge of an item to move it",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.DropItem&&t.vmMain.isLoaded?!0:void 0}}),e.addStep({text:"Press "+i.cmdCharP+"Z to undo and "+i.cmdCharP+"Y to redo",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.UndoRedo?!0:void 0}}),e.addStep({text:"To collapse an item and hide its children press "+i.cmdCharP+", or select collapse from the right click menu",check:function(e){if(e.type===TrackerType.Update){var t=e.data[0];return"isCollapsed"===t.field&&t.newValue}}}),this.addSection(e);var n=new r("Dates","Scheduling items automatically puts them on your Agenda.");n.addStep(this.itemDateTime),n.addStep({text:'Write dates in plain English like <span class="date">@tomorrow</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&t.vmMain.isLoaded){var n=e.data[0].date;return!!n}}}),n.addStep({text:'Schedule a full date and time like <span class="date">@today 2:30pm</span> or <span class="date">@5/25 6:00</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&t.vmMain.isLoaded){var n=e.data[0].date;if(n)return n._explicitTime}}}),n.addStep({text:'Describe urgency with <span class="date">@now</span>, <span class="date">@soon</span>, or <span class="date">@later</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&t.vmMain.isLoaded){var n=o.itemsById[e.data[0].itemID].model;return n?t.isDateSoft(n.dateText):!1}}}),this.addSection(n);var a=new r("Priority","Prioritizing items automatically puts them on your agenda and lets you manage what to do next.");a.addStep(this.itemRightClick),a.addStep({text:"Set a priority with the right click menu or "+i.cmdCharP+"1/2/3",check:function(e){if(e.type===TrackerType.Update){var t=e.data[0];return"priority"===t.field&&t.newValue>0}}}),a.addStep({text:"Click the left of an item or "+i.cmdCharP+"/ to mark it complete",check:this.checkComplete}),a.addStep({text:"Press "+i.cmdCharP+"* to star an item which highlights it in yellow",check:function(e){if(e.type===TrackerType.Update){var t=e.data[0];return"isStarred"===t.field&&t.newValue}}}),this.addSection(a);var s=new r("Contacts","Add a contact to an item to easily start a call or email.");s.addStep({text:"Add a contact by typing + in the text of an item",check:function(e){return e.type===TrackerType.Insert&&"+"===e.data[0].text}}),s.addStep({text:"Select a contact's name from the list or start typing a name to narrow the search",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.AddContact}}),s.addStep({text:'Click on a <span class="contact">+contact</span> to start a call or email',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenContact}}),this.addSection(s);var d=new r("Panes","There are two types of panes: List and Agenda. The List pane is where you write and organize while the Agenda pane is organized automatically by time and priority.");d.addStep({text:'Click <i class="icon-align-left f22 gd"></i> in the top right to add a List pane',check:function(e){if(e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.AddPane){var n=t.vmMain.panes()[e.data[0].data];if(n.mode()===PaneMode.Normal)return!0}}}),d.addStep(this.itemAddAgenda),d.addStep({text:'Click <i class="icon-remove gd"></i> in the top right of a pane to close it',check:function(e){return e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.RemovePane}}),this.addSection(d);var c=new r("Focus","Focus on an item to show only the items under it");c.addStep({text:"To focus on an item, right click on it and select Focus or press "+i.cmdCharP+"Enter",check:function(e){return e.type===TrackerType.Zoom&&!e.data[0].zoomOut}}),c.addStep({text:'To bring focus back out, click the <span class="titleWrapper"><span class="titleOpen">title of the list</span></span> you want to focus on',check:function(e){return e.type===TrackerType.Zoom&&e.data[0].zoomOut}}),c.addStep({text:'Press <i class="outlineButtonNormal icon-list"></i> in the top left of a pane to open the outline',check:this.checkOutline}),c.addStep({text:"Click the title of a list in the outline to focus on it",check:function(e){return e.type===TrackerType.Zoom&&!e.data[0].zoomOut&&t.focusedPane.outline.isVisible()}}),this.addSection(c);var l=new r("Search","Filter for only the items you want to see right now");l.addStep({text:"Filter for a keyword by searching for that word",check:this.checkSearch}),l.addStep({text:'Mark similar items with a <span class="tag">#tag</span> to easily search for all items matching that tag',check:function(e){return e.type===TrackerType.Insert&&"#"===e.data[0].text}}),l.addStep({text:"Filter by priority by searching for !, !!, or !!!",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data[0].text.indexOf("!")>=0}}),l.addStep({text:"Show only starred items by searching for *",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data[0].text.indexOf("*")>=0}}),l.addStep({text:"Hide items you're not interested in by starting a search with - (dash)",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data[0].text.indexOf("-")>=0}}),l.addStep({text:"Hide completed items by searching for -// (dash, two slashes)",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data[0].text.indexOf("-//")>=0}}),this.addSection(l);var u=new r("Collaboration","Collaborate with others by sharing documents with different groups of people");u.addStep({text:'Click <i class="icon-logoIcon f22 gd"></i> in the top left to open the sidebar',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.ToggleSidebar&&e.data[0].value}}),u.addStep({text:'Click <i class="icon-plus f18 g"></i> to create a new document',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.AddDocument&&e.data[0].value}}),u.addStep({text:"Open your new document by clicking on it in the list of documents",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenDocument&&e.data[0].value}}),u.addStep({text:'Click <i class="icon-user f18 c g"></i> to change the sharing settings',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenDocSharing&&e.data[0].value}}),this.addSection(u);var h=new r("Data","Import data from another app to use in Moo.do or export your data out of Moo.do");h.addStep({text:"Paste into Moo.do by pressing "+i.cmdCharP+"V or finding Paste in your browsers edit menu",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.Paste&&e.data[0].value}}),h.addStep({text:"Copy the selected text by pressing "+i.cmdCharP+"C or finding Copy in your browsers edit menu",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.Copy&&e.data[0].value}}),h.addStep({text:'Click on Import Data in the sidebar, then choose the app to import from and follow the instructions. If you do not see your app, try using copy and paste to paste it in to Moo.do. If that does not work, please <a href="mailto:support@moo.do?subject=Import Request">contact us</a> and tell us what app you want to import from.',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenImport&&e.data[0].value}}),h.addStep({text:"Click on Export Data in the sidebar, then choose the format you'd like. You can see your data in a new tab so you may copy or download it.",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenExport&&e.data[0].value}}),this.addSection(h)},initMobile:function(){var e=t.tooltip,n=new r("Mobile Intro");n.inOrder=!0,n.enforceOrder=!0;var o=this;n.addStep({text:"Open Keyboard",show:function(){o.needsKeyboardOpen=!1},check:function(e){return e.type===TrackerType.Mobile&&e.misc===TrackerMiscMobile.OpenKeyboard}}),n.addStep({text:"Press return to add another item",show:function(){o.needsKeyboardOpen=!0,e.displayTip({text:this.text,element:t.element("mobileKeyboardToolbar"),above:!0,offset:{y:-10},maxWidth:240})},check:this.checkAddItem}),n.addStep({text:"Indent items into lists",show:function(){o.needsKeyboardOpen=!0,e.displayTip({text:this.text,element:t.element("indentButton"),above:!0,offset:{y:-10},arrow:"arrowBottom",time:200})},check:function(e){return this.checkIndent(e)||this.checkOutdent(e)}.bind(this)}),n.addStep({text:"Add a date to a task",show:function(){o.needsKeyboardOpen=!0,e.displayTip({text:this.text,element:t.element("dateButton"),above:!0,offset:{x:0,y:-10},arrow:"arrowBottom",time:200})},check:function(t){return t.type===TrackerType.Mobile&&t.misc===TrackerMiscMobile.AtButton&&e.hideTip(),t.type===TrackerType.Mobile&&t.misc===TrackerMiscMobile.CloseAutocomplete}}),n.addStep({text:"Open the Agenda",show:function(){o.needsKeyboardOpen=!1,e.displayTip({text:this.text,element:t.element("modeButton"),offset:{x:5,y:8},arrow:"arrowTop"})},check:function(e){return e.type===TrackerType.Mobile&&e.misc===TrackerMiscMobile.PaneAgenda}}),n.addStep({text:"The agenda shows items with dates or priorities. Go back to the List view.",show:function(){o.needsKeyboardOpen=!1,e.displayTip({text:this.text,element:t.element("modeButton"),offset:{x:5,y:8},arrow:"arrowTop"})},check:function(e){return e.type===TrackerType.Mobile&&e.misc===TrackerMiscMobile.PaneNormal}}),n.addStep({text:"Tap the title to search",show:function(){o.needsKeyboardOpen=!1,e.displayTip({text:this.text,element:t.element("searchPhone"),offset:{x:0,y:8},arrow:"arrowTop",time:200})},check:this.checkSearch}),n.addStep({text:"Wait Swipes",show:function(){o.needsKeyboardOpen=!1,e.hideTip()},check:function(e){return e.type===TrackerType.Create&&t.vmMain.root().items().length>=3?!0:void 0}}),n.addStep({text:"Swipe left on an item to complete it",show:function(){o.needsKeyboardOpen=!1,e.displayTip({text:this.text,element:t.element("searchPhone"),offset:{x:0,y:5}})},check:this.checkComplete}),n.addStep({text:"Swipe left even farther to enter multiselect mode",show:function(){o.needsKeyboardOpen=!1,e.displayTip({text:this.text,element:t.element("searchPhone"),offset:{x:0,y:5},time:200})},check:function(e){return e.type===TrackerType.Mobile&&e.misc===TrackerMiscMobile.OpenMultiselect}}),n.addStep({text:"Wait close multiselect",show:function(){o.needsKeyboardOpen=!1,e.hideTip()},check:function(e){return e.type===TrackerType.Mobile&&e.misc===TrackerMiscMobile.CloseMultiselect}}),n.addStep({text:"Swipe right to open the Outline",show:function(){o.needsKeyboardOpen=!1,e.displayTip({text:this.text,element:t.element("searchPhone"),offset:{right:10,y:5},time:200})},check:this.checkOutline}),n.addStep({text:"Tap a list title to focus on it",show:function(){o.needsKeyboardOpen=!1,e.displayTip({text:this.text,element:t.element("searchPhone"),offset:{right:10,y:5},time:200})},check:function(e){return e.type===TrackerType.Zoom}}),n.addStep({text:"Open the outline again and tap on Home to go back",show:function(){o.needsKeyboardOpen=!1,e.displayTip({text:this.text,element:t.element("searchPhone"),offset:{right:10,y:5},time:200})},check:function(e){return e.type===TrackerType.Zoom?e.data[0].itemID==t.vmMain.root().id:void 0}}),n.addStep({text:"Intro Done",show:function(){this.hasShown=!0,o.needsKeyboardOpen=!1,e.hideTip(),o.setMode(HelpMode.None)},check:function(){return!!this.hasShown}}),this.addSection(n),i.mobile&&(window.addEventListener("closeKeyboard",function(){this.needsKeyboardOpen&&t.tooltip.hideTip()}.bind(this)),window.addEventListener("keyboardOpened",function(e){this.sections()[0].isComplete()||this.sections()[0].showFirstIncomplete(e)}.bind(this)))},addMobileStep:function(e){this.sections.push(e)},onAction:function(e){try{for(var n=this.sections(),i=0;i<n.length;++i)n[i].isComplete()||n[i].check(e)}catch(o){t.reportError(o)}},onClosePane:function(){t.tooltip.hideTip(),t.vmMain.closeHelp(),this.switchToHelp(),this.setMode(HelpMode.None)},introComplete:function(){return this.introSection&&this.introSection.isComplete()},switchToHelp:function(){delete this.introSection,this.initHelp(),this.saveState()},nextStep:function(){for(var e=this.sections(),t=0;t<e.length;++t)e[t].isComplete()||e[t].check(!0)}},a}),define("VMMain",["ko","globals","util","android","data","gdata","goog","edit","copypaste","VMMain_DragDrop","VMLI","VMTitle","tracker","platform","VMSearch","VMPane","VMMenus","VMSettings","VMPicker","VMPhoneMenu","VMKeyboardToolbar","parseWorker","VMIntro"],function(e,t,n,i,o,r,a,s,d,c,l,u,h,p,f,m,g,v,y,b,S,T,w){var M=function(){function s(){var e;if(p.ie)e="js/parseWorker.js",window.helperWrapper=void 0,window.dateWrapper=void 0,window.parseWorkerWrapper=void 0,delete window.helperWrapper,delete window.dateWrapper,delete window.parseWorkerWrapper;else try{var t=window.helperWrapper.toString(),n=window.dateWrapper.toString(),i=window.parseWorkerWrapper.toString(),o="parseWorkerWrapper();";window.URL=window.URL||window.webkitURL,e=window.URL.createObjectURL(new Blob([t,n,i,o],{type:"text/javascript"}))}catch(r){ShouldLog(LogLevels.Warning)&&log("---- WARNING: Blob URLs not supported, falling back to default web worker support! ----"),ShouldLog(LogLevels.Warning)&&log(JSON.stringify(r)),e="js/parseWorker.js"}finally{window.helperWrapper=void 0,window.dateWrapper=void 0,window.parseWorkerWrapper=void 0,delete window.helperWrapper,delete window.dateWrapper,delete window.parseWorkerWrapper}return e}function u(){if(!M.worker){if(!window.Worker)return ShouldLog(LogLevels.Warning)&&log("---- WARNING: Running without WebWorker support! ----"),M.supportWebWorker=!1,void(M.worker=void 0);var e=s();try{M.worker=new Worker(e)}catch(n){if(18===n.code)try{M.worker=new Worker("js/parseWorker.js")}catch(i){t.reportError(i)}else t.reportError(n)}M.worker?(M.worker.onmessage=function(e){if(t.isString(e.data))return void log("Message from worker: ",e.data);log("Worker Finished: ",e.data.end-e.data.start,"ms");for(var n,i=-1,r=0;r<D.length;++r)D[r].id===e.data.id&&(n=D[r],i=r);if(D.splice(i,1),e.data.styles)for(var r=0;r<e.data.styles.length;++r){var a=e.data.styles[r],s=o.getModel(n.items[r].id);if(s){var d={};s.styleText(a,!0,d)&&s.save(d,SaveFlag.None)}}e.data.done&&n.cb&&n.cb(),e.data.styles||e.data.done||log("Error in parse worker: ",e)},M.worker.onerror=function(e){log("Error in ParseWorker: ",e,e.message),t.reportError(new Error("Worker reported error"))}):M.supportWebWorker=!1}}function f(e,t){if(M.supportWebWorker){var n=k++;D.push({id:n,cb:t,items:e});var i={id:n,items:e};P||(i.contacts=o.getContacts(),P=!0),M.worker.postMessage(i)}}function g(e){t.isLoadingRemote=!0;try{o.beginTransaction(),t.timeline.startLoading();var n=t.settings.get(Settings.lastServerVersion),i=r.getServerVersion();n===i&&log("Client and Server Versions Match!"),t.startTimeEvent("PageLoad","RemoteData","Load Remote Data"),h.beginAction();var a=t.settings.get(Settings.localIntegrity);a===!1&&(ShouldLog(LogLevels.Warning)&&log("Previous remote sync had an issue!"),t.reportError(new Error("Previous remote sync had an issue!"))),r.loadSeen={},t.settings.set(Settings.localIntegrity,!1),M.root().initFromGDrive(e),t.settings.set(Settings.localIntegrity,!0),r.loadSeen={},h.endAction(),M.flushParseItems(),M.flushModifiedItems(),t.timeline.endLoading(),o.hasLocalData&&M.root().resetModified(),o.clearPendingUpdates(),t.endTimeEvent(),t.fireCustomEvent("remoteDataLoaded")}catch(s){t.reportError(s),t.messageQueue.pushMessage({text:"There was an error loading your data from the server. Please reload the app to try again.",type:MessageType.Error,action:MessageAction.Reload})}finally{o.endTransaction(),t.isLoadingRemote=!1,t.vmMain.isLoadingDoc(!1),t.StopSpinner()}}function T(){if(!p.mobile){var e=t.restoreSavedSelection("loadData");if(!e&&t.focusedPane&&!t.focusedPane.isTimeline()){var n=t.getFirstPaneItem(t.focusedPane);n&&t.setSelection(n.getSpan(),0,0)}}}var M={root:e.observable(void 0),panes:e.observableArray(),isHelpShowing:e.observable(!1),isLoaded:!1,hasResized:e.observable(!1),isSidebarOpen:!1,helpButtonHidden:e.observable(!1),gdriveStatus:e.observable(-1),isPhone:p.phone,vmSettings:new v(this),supportWebWorker:!0,swipingScreens:!1,swipeDirection:0,lastSwipeMove:0,lastSwipeMoveTime:0,vmPicker:new y,selected:e.observableArray(),help:void 0};t.vmMain=M,p.mobile&&(M.elPhoneMenu=t.element("phoneMenu")),t.vmSettings=M.vmSettings,M.isOnline=function(){return M.gdriveStatus()!==DriveStatus.Offline},M.isReconnecting=function(){return M.gdriveStatus()===DriveStatus.Reconnecting},M.isLocal=function(){return"localhost"==window.location.hostname},M.onlineText=function(){if(M.isDemoMode())return"DEMO";switch(M.gdriveStatus()){case DriveStatus.Connecting:return"CONNECTING";case DriveStatus.Offline:return"OFFLINE";case DriveStatus.Saving:case DriveStatus.Saved:return"ONLINE";case DriveStatus.Reconnecting:return"RETRYING"}},c(M);var C=0;M.maxWidth=e.computed({read:function(){if(M.isPhone)return p.windowWidth()+"px";var e=800*M.panes().length+(M.isHelpShowing()?400:0);return e+"px"},deferEvaluation:!0}),M.pinButtons=e.computed({read:function(){return p.windowWidth()>800*M.panes().length},deferEvaluation:!0}),M.getUserName=e.computed({read:function(){var e=r.authenticatedUser();return e?e.displayName:M.gdriveStatus()===DriveStatus.Saved?"Connected":t.vmSetup.loginState()==LoginState.LOGGED_IN?"Connecting":"Demo"},deferEvaluation:!0}),M.getUserImage=function(){var e=r.authenticatedUser();return e?e.photoUrl:void 0},M.isDemoMode=function(){return t.isDemoMode()},window.addEventListener("scriptLoadError",function(e){M.handleScriptLoadError(e)}),M.handleScriptLoadError=function(e){"gapiScript"===e.data.id&&(log("Failed to load GAPI!"),M.setGDriveStatus(DriveStatus.Offline),M.failedGapiLoad=!0,setTimeout(a.goOnline,3e4))};var x;M.connectFailed=function(){M.setGDriveStatus(DriveStatus.Offline),x=void 0,a.ensureDocConnection()},M.setGDriveStatus=function(e){var n=M.gdriveStatus();e!==n&&e!==DriveStatus.Saving&&(M.gdriveStatus(e),e===DriveStatus.Connecting||e===DriveStatus.Reconnecting?(clearTimeout(x),x=setTimeout(M.connectFailed,r.offlineTimeoutMS)):(clearTimeout(x),x=void 0),e===DriveStatus.Offline?(t.goOffline(),p.mobile&&t.messageQueue.pushMessage(MessageID.MobileOffline)):n===DriveStatus.Offline&&(t.goOnline(),p.mobile&&t.messageQueue.clearMessage(MessageID.MobileOffline)),p.mobile&&(e===DriveStatus.Connecting?t.messageQueue.pushMessage(MessageID.MobileConnecting):n===DriveStatus.Connecting&&t.messageQueue.clearMessage(MessageID.MobileConnecting)))},M.init=function(){d.init()},M.onLoad=function(){if(p.isTouchDevice&&!p.app)for(var e=document.getElementsByClassName("paneOutline"),n=0;n<e.length;++n)e[n].addEventListener(p.touchStartEvent,function(i){return t.preventScrollPropagation(e[n])?void 0:(i.preventDefault(),!1)});p.mobile&&setTimeout(function(){t.ScreenManager.computeSnapPoints(),p.mobileie&&t.ScreenManager.scrollToScreen(Screens.List,0)}.bind(this),0)};M.addModifiedItem=function(){},M.flushModifiedItems=function(){};var I,E=[];M.addParseItem=function(e,t){M.addItemToArrayForWorker(e,t,E),I||(I=setTimeout(M.flushParseItems,0))},M.flushParseItems=function(){E.length>0&&!a.loadingContacts&&M.runParseWorker(E,function(){for(var e=0;e<M.panes().length;e++)M.panes()[e].vmSearch.updateSearch(!0)}),clearTimeout(I),I=void 0,E=[]},M.runParseWorkerNewContacts=function(){if(M.root()){var e=[];M.parseWorkerNewContactsHelper(M.root(),e),e.length>0&&M.runParseWorker(e)}},M.parseWorkerNewContactsHelper=function(e,t){var n=e.getRawText();n.indexOf(ContactPrefix)>=0&&t.push({id:e.id,text:e.getRawText(),isUpdate:!1,prevDate:e.getDateTime()});for(var i=e.items(),o=0;o<i.length;o++)M.parseWorkerNewContactsHelper(i[o],t)},M.addItemToArrayForWorker=function(e,t,n){n.push({id:e.id,text:e.getRawText(),isUpdate:!t&&e.isLoaded,prevDate:e.getDateTime()})},M.addChildrenToArrayForWorker=function(e,t,n){n.push({id:e.id,text:e.getRawText(),isUpdate:!t&&e.isLoaded,prevDate:e.getDateTime()});for(var i=e.items(),o=0;o<i.length;o++)M.addChildrenToArrayForWorker(i[o],t,n)};var k=0,D=[],P=!1;M.notifyContactsUpdated=function(){P=!1},M.runParseWorker=function(e,t){{var n;performance.now()}if(e&&e instanceof Array)log("Running Parse Worker for Array: ",e.length),n=e;else{n=[];var i=e;e?log("Running Parse Worker for Item: ",e.id):(i=M.root(),log("Running Parse Worker for Root.")),i&&M.addChildrenToArrayForWorker(i,!1,n)}u(),M.supportWebWorker?(log("Parsing Items Async: ",n.length),f(n,t)):setTimeout(function(){log("Parsing Items Sync: ",n.length);for(var e=o.getContacts(),t=0;t<n.length;++t){var i=n[t],r=DuchessHelpers.parseText(i.text,i.prevDate,i.isUpdate,e),a=o.getModel(i.id);if(a){var s={};a.styleText(r,!0,s)&&a.save(s,SaveFlag.None)}}},0)},M.createPane=function(e,t){isNaN(e)&&(e=M.panes().length);var n=new m({id:C++,item:M.root(),mode:t});return M.addPane(n,e),M.setFocusedPane(n),n},M.removePane=function(e){for(var t=M.panes(),n=0;n<t.length;n++)if(e==t[n])return M.removePaneAtIndex(n),M.setFocusedPane(t[0]),n;return-1},M.removeFocusPane=function(){if(t.focusedPane&&M.panes().length>1){var e=M.removePane(t.focusedPane);h.performAction(TrackerType.UIAction,{type:TrackerUIAction.RemovePane,data:e}),t.sendEvent("Hotkey","ClosePane"),t.tooltip.hideTip()}},M.paneCount=function(){return M.panes().length};M.setupDateRollover=function(){var e=new Date,n=e.clone().addDays(1).clearTime();return log("Next Rollover Time: ",n),setTimeout(function(){function e(){M.runParseWorker(),t.timeline.reloadTimelines(),log("-------------------------------")}log("---- Running Date Rollover ----"),lastDateRollver=new Date;M.setupDateRollover();t.settings.get(Settings.syncContacts)?(a.loadedContacts=!1,a.loadContacts(e)):e()},n-e),n};var L=!1;M.notifyDriveDisconnect=function(){L=!1,h.resetAggregateActionCount()},M.notifyDriveOperationError=function(){h.resetAggregateActionCount()},M.loadGDriveData=function(){if(!L){L=!0,p.mobile||t.saveSelection("loadData");var e=r.rootItem;try{M.root().linkToGDrive(e)}catch(n){t.reportError(n),t.messageQueue.pushMessage(MessageID.FatalError)}try{r.checkRemoteIntegrity()}catch(n){t.reportError(n)}var i=o.getRootItem();i.id!==e.id?o.modifyItemId(i.id,e.id,function(){var t=o.getModel(e.id);i.id=e.id,o.setRoot(e.id),t.forceModifiedItems=!0,g(e),o.hasLocalData||t.items.valueHasMutated(),T()}):(g(e),T()),M.vmPicker.refreshFiles()}};var O=!1;M.loadData=function(){function e(e){i.push({id:"contact_"+r++,name:e,isDemo:!0,emails:[{address:"contact@moo.do",primary:!0}],phoneNumbers:[{number:"(555) 123-4567",type:"mobile"}]})}if(!O&&o.localDataLoaded()){if(O=!0,t.startTimeEvent("PageLoad","LocalData","Load Local Data"),M.root(new l(o.getRootItem())),t.checkpoint(Checkpoint.LocalDocLoad),t.endTimeEvent(),t.requireGDriveDataCallback&&M.loadGDriveData(),M.isDemoMode()){var i=[],r=0;
e("Jay"),e("Grant"),e("Ramada"),e("Canyon Ranch"),e("Jim Joseph"),e("Miller Harris"),e("Bob Johnson"),e("Bill Wilson"),e("Emily Edwards"),e("Jane Johnson"),e("Mike Thomas"),e("Joe Lewis"),e("Steve"),e("Melissa"),e("Mikey"),e("Bart"),e("Dad"),e("Mom"),o.loadContacts(i,!0)}M.runParseWorker(void 0,function(){n.getURLParam("data");M.isDemoMode()&&(p.script&&t.vmSetup.runScript(n.getURLParam("script")),window.parent.postMessage("loaded","*"))}),M.afterLoaded(),t.startTimeEvent("PageLoad","ApplyBindings","Apply Bindings"),t.applyBindings(M,"container"),p.mobile||t.applyBindings(M,"desktopMenu");for(var a=0;a<M.panes().length;a++)M.panes()[a].vmSearch.onUpdated.valueHasMutated();M.isLoaded=!0,document.getElementById("container").style.display="block",p.app&&p.sendToApp("localLoaded"),t.endTimeEvent()}},M.changeRoot=function(e){var t=!1,n=o.getModel(e);if(n||(n=new l(o.getItem(e)),t=!0),n){M.root(n);for(var i=0;i<M.panes().length;i++)M.panes()[i].item(n),M.panes()[i].notifyOfZoom();t&&M.runParseWorker(void 0)}},M.resetScrollOffsets=function(){for(var e=0;e<M.panes().length;e++){var t=M.panes()[e];t.setScrollOffset(t.defaultOffset)}},M.helpMessage=function(){return p.mobile?"Welcome to Moo.do! If this is your first time here take a minute to orient yourself, otherwise your data will be here shortly.":"Welcome to Moo.do! If this is your first time here take a minute to orient yourself and import your data, otherwise your data will be here shortly. You can access the introduction at a later time through the top-right menu."},M.onTapMain={onClick:function(){M.isDemoMode()&&p.script&&window.parent.postMessage("click","*")}},M.addPane=function(e,n){var i=t.settings.get(Settings.paneState);i||(i=[]),void 0===n?M.panes.push(e):M.panes.splice(n,0,e),i.push({id:e.id,focus:e.item().id,mode:e.mode(),showarch:e.showArchived(),search:e.vmSearch.search(),offset:0}),t.settings.set(Settings.paneState,i)},M.removePaneAtIndex=function(e){var n=t.settings.get(Settings.paneState);n&&n.splice(e,1),M.panes.splice(e,1),t.settings.set(Settings.paneState,n)},M.afterLoaded=function(){var e;if(M.isDemoMode()?M.clearPaneState():e=t.settings.get(Settings.paneState),e){for(var n=0;n<e.length&&!(p.mobile&&n>0);++n){var i=e[n];i.id=C;var r=o.getModel(i.focus);r||(r=M.root(),i.focus=r.id,i.offset=0,i.search="");var a=new m({id:C++,item:r,mode:i.mode,search:i.search,offset:i.offset});i.showarch&&a.showArchived(!0),M.panes.push(a),M.setFocusedPane(a,!0),M.zoomin(r,!0)}1!==M.panes().length&&M.setFocusedPane(M.panes()[0],!0)}if(M.isDemoMode()&&t.demoPanes){for(var n=0;n<t.demoPanes.length;n++){var i=t.demoPanes[n].split(","),s={id:C++,item:M.root(),mode:+i[0]};if(i.length>1&&(i[1]&&(s.search=i[1]),i[2])){var d=o.getModel(i[2]);s.item=d||M.root()}M.addPane(new m(s))}var a=M.panes()[0];t.focusedPaneID=a.id,t.focusedPane=a,t.focusedItem=a.item(),M.zoomin(a.item(),!0)}else if(0===M.panes().length){var a=new m({id:C++,item:M.root()});if(M.addPane(a),!p.mobile&&t.activeDisplayMode&DisplayMode.ForceTwoPane){var c=new m({id:C++,item:M.root(),mode:PaneMode.Timeline});M.addPane(c)}t.focusedPaneID=a.id,t.focusedPane=a,t.focusedItem=M.root(),M.zoomin(M.root(),!0)}p.mobile&&(t.phoneMenu=new b,t.keyboardToolbar=new S),t.timeline.updateNotifications()},M.clearPaneState=function(){t.settings.reset(Settings.paneState)},M.updatePaneState=function(e){if(!t.isRunningScript()){var n=t.settings.get(Settings.paneState);if(n)for(var i=!1,o=0;o<n.length;++o){var r=n[o];if(r.id===e.id){r.focus=e.item().id,r.mode=e.mode(),r.showarch=e.showArchived(),r.search=e.vmSearch.search(),t.settings.set(Settings.paneState,n),i=!0;break}}}},M.updatePaneScrollState=function(){if(!t.isRunningScript()){var e=t.settings.get(Settings.paneState);if(e&&M.panes().length>0){for(var n=0;n<e.length;++n){var i=e[n],o=M.panes()[n];i.offset=o?o.getScrollOffset():0}t.settings.set(Settings.paneState,e)}}};var A;M.getFirstSelectedItem=function(){return M.selected().length>0?M.selected()[0]:void 0},M.setSelected=function(e){e=e||[],M._clearIsSelected(e);for(var t=0;t<e.length;t++)e[t].isSelected(!0);M.selected(e)},M.getSelected=function(){return M.selected()},M._clearIsSelected=function(e){e=e||[];for(var t=0;t<M.selected().length;t++){var n=M.selected()[t];e.indexOf(n)<0&&n.isSelected(!1)}},M.clearSelected=function(e){M._clearIsSelected(e),M.selected([])},p.mobile&&(document.onselectstart=function(e){return t.dragging?(e.preventDefault(),!1):!0},document.onselectionchange=function(n){var o,r=t.getSelectionInfo(),a=!0;if(t.ignoreSelectionChange)return t.ignoreSelectionChange=!1,void(A=void 0);if(r){if(p.android&&t.dragging)return void t.clearSelection();var s=t.getSelectionRange();if(a=!A||s.startContainer!==A.startContainer||s.endContainer!==A.endContainer,A&&!a&&s.startOffset==A.startOffset&&s.endOffset==A.endOffset)return;if("fullscreenClickGrabber"===s.startContainer.id)return;if(A=s,t.focusedPane&&t.focusedPane.mode()===PaneMode.Normal){var d=t.getLIParent(s.startContainer),c=d?e.dataFor(d):void 0,u=!c||!c instanceof m&&!c instanceof l;if(u);else{t.restrictSelectionToText(),r=t.getSelectionInfo(),s=t.getSelectionRange();var h=t.getLIParent(s.startContainer),f=t.getLIParent(s.endContainer);if(h&&f&&!t.hasClass(h,"emptyPaneItem")&&!t.hasClass(f,"emptyPaneItem")){var g=e.dataFor(h);if(a)if(h!==f)if(p.android&&i.isEnabled())t.clearSelection();else{var v=e.dataFor(f);if(g===t.getFirstPaneItem(t.focusedPane)&&v===t.getLastPaneItem(t.focusedPane)){var y=M.getSelected(),b=y[0],S=y[y.length-1];return t.selectMultiline(b.getSpan(),0,S.getSpan(),S.getParsedText().length),t.scrollIntoView(b.getSpan(),0),void t.preventDefault(n)}o=t.getItemsBetween(g,v,t.focusedPane)}else if(o=[g],i.isEnabled()&&!p.mobileie&&(i.updateInput(g),r&&r.node&&t.hasClass(r.node,"contact"))){var T=t.getOffsetOfSubNode(g.getSpan(),r.node);t.autocomplete.update({item:g,start:T+1}),t.autocomplete.show(g,r.node)}}}}}else(p.android||p.mobileie||p.ios&&(!p.app||p.ipad))&&(p.mobileie&&i.isEnabled()&&i.isVisible()||t.fireCustomEvent("closeKeyboard"));r||(A=void 0),!a||p.android||p.mobileie||M.setSelected(o)}),M.setFocusedPaneFromElement=function(n){if(n){var i=t.hasClass(n,"paneRoot")?n:t.getPaneForElement(n).rootElement,o=e.dataFor(i);M.setFocusedPane(o)}};var R=!1;M.setFocusedPane=function(e,n){e&&t.focusedPaneID!==e.id&&(R=!n,t.focusedPaneID=e.id,t.focusedPane=e,t.focusedItem=t.focusedPane.item())},M.zoomin=function(e,n){var i=t.focusedItem;M._zoom(e,n);var o=t.focusedPane;n||t.sendEvent("Menu","ZoomIn"),!p.mobile&&o.paneContent&&t.setSelection(o.paneContent,0,0),o.rootElement?o.setScrollOffset():setTimeout(function(){o.setScrollOffset()},0),e.isCollapsed()&&e.toggleCollapsed(),n||h.performAction(TrackerType.Zoom,{itemID:e.id,oldItemID:i.id,zoomOut:!1,time:t.zoomTime})},M.zoomout=function(e,n){var i=t.focusedItem;M._zoom(e,!1),t.sendEvent("Menu","ZoomOut"),t.selectChildren(n,n.getParsedText().length,0),t.scrollToTop(n.getSpan(),0),h.performAction(TrackerType.Zoom,{itemID:e.id,oldItemID:i.id,zoomOut:!0,time:t.zoomTime})},M._zoom=function(e,n){var i=t.focusedItem;i&&i.id===e.id||(t.focusedPane.item(e),t.focusedPane.notifyOfZoom(),t.focusedItem=e,n||M.updatePaneState(t.focusedPane))},M.onMenuButtonClick=function(){M.isSidebarOpen?(M.closeSidebar(),t.sendEvent("Menu","CloseSidebar")):(M.openSidebar(),t.sendEvent("Menu","OpenSidebar"))},M.onHelpButtonClick=function(e){M.showHelp(HelpMode.Normal),t.sendEvent("Menu","HelpMain"),M.closeSidebar(),e.preventDefault(),e.stopPropagation()},M.closeSidebarEvent=function(e){return t.findParentID(e.target,"desktopSidebar")||t.findParentID(e.target,"desktopMenuRight")||t.findParentID(e.target,"desktopMenuButton")?!0:M.isSidebarOpen?(M.closeSidebar(),e.preventDefault(),e.stopPropagation(),!1):void 0},t.addCustomEventListener("keyEscape",M.closeSidebarEvent,200),M.openSidebar=function(){M.isSidebarOpen=!0,t.autocomplete&&t.autocomplete.hide(),t.tooltip.hideTip(),t.addClass(t.element("container"),"sidebarOpen"),setTimeout(function(){t.element("container").addEventListener("mouseup",M.closeSidebarEvent),t.element("desktopMenu").addEventListener("mouseup",M.closeSidebarEvent)},0),h.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleSidebar,data:[{value:!0}]})},M.closeSidebar=function(){M.isSidebarOpen=!1,t.removeClass(t.element("container"),"sidebarOpen"),t.element("container").removeEventListener("mouseup",M.closeSidebarEvent),t.hideHighlightElement(),h.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleSidebar,data:[{value:!1}]})};var _=document.getElementById("fullscreenClickGrabber"),N=!1;M.handleFullscreenClick=function(e){N||(t.setupClick(_,void 0,{onRightClick:function(e){_.style.display="none";var n=document.elementFromPoint(e.clientX,e.clientY),i=t.getPaneForElement(n);i&&i.onTap.onRightClick({srcElement:n,pageX:e.x,pageY:e.y,preventDefault:function(){e.preventDefault()},stopPropagation:function(){e.stopPropagation()},stopImmediatePropagation:function(){e.stopImmediatePropagation()}}),_.style.display=""},onEnd:function(){M.cancelFullscreenClick(),e()}}),t.removeClass(_,"none"),N=!0)},M.cancelFullscreenClick=function(){N&&(t.addClass(_,"none"),t.menus.closeAllMenus(),N=!1)},M.applyFnToSelection=function(e,t){var n=t&&t.toggle||t===!0,i=t&&void 0!==t.value?t.value:!0;if(M.applyToSelection(function(t){n&&t[e]()!==i&&(n=!1),n||t[e](i)}),n){var o=o=t&&void 0!==t.emptyValue?t.emptyValue:!1;M.applyToSelection(function(t){t[e](o)})}},M.applyPriorityToSelection=function(e,t){t?M.applyFnToSelection("priority",{toggle:!0,value:e,emptyValue:VMLIFlag.None}):M.applyFnToSelection("priority",{value:e})},M.insertCharacter=function(e,n){var o;if(i.isEnabled()){o=i.getInputText();var r=o[i.getSelectionStart()-1];n&&" "!==r&&0!==i.getSelectionStart()?i.insertText(i.getSelectionStart()," "+e):i.insertText(i.getSelectionStart(),e)}else{var a=t.getSelectionRange();if(a){var s=t.getItemForElement(a.startContainer);if(s){o=s.getRawText();var r=o[a.startOffset-1];n&&" "!==r&&0!==a.startOffset&&t.fireKeyEvent(void 0,{normCode:KeyCode.Space}),t.fireKeyEvent(void 0,{normCode:e.charCodeAt(0)})}}}},M.applyToSelection=function(e,n){var o=n&&n.passExtraInfo;if(p.android||i.isEnabled()){var r=i.getCurrentVMLI(),a=i.getCurrentVMLI();if(void 0===r||void 0===a)return!0}else{var s=t.getSelectionInfo();if(!s||0===s.rangeCount)return!0;if(s.node&&t.hasClass(s.node,"search"))return!0;var d=t.getPaneForElement(s.node);if(!d)return!0;if(t.restrictSelectionToText(),s=t.getSelectionInfo(),!s||0===s.rangeCount)return!0;var c=t.getSelectionRange();if(t.hasClass(c.startContainer.parentNode,"timelineItemTime"))return!0;var r=t.getItemForElement(c.startContainer),a=t.getItemForElement(c.endContainer);if(void 0===r||void 0===a)return!0}h.beginAction(),r!==a&&0===c.endOffset&&(a=t.getPreviousItem(a,t.focusedPane));for(var l=t.getItemsBetween(r,a,t.focusedPane),u=M.panes(),f=u.length,m=0;m<l.length;++m){var g=o?e(l[m],m,l.length):e(l[m]);if(g===!1)break;for(var v=0;f>v;v++)u[v]!=t.focusedPane&&u[v].vmSearch.checkItem(l[m])}return h.endAction(),l.length};var F={over:void 0,wasPointer:!1};M.updateCursor=function(e){F&&F.over&&(e&&("A"===F.over.tagName||t.hasClass(F.over,"tag"))?(F.wasPointer=!0,F.over.style.cursor="pointer"):!e&&F.wasPointer&&(F.wasPointer=!1,F.over.style.cursor="text"))},p.touch||(M.mousemove=function(e){if(!t.disableMouseMove&&(e.pageX!==F.pageX||e.pageY!==F.pageY)){F.pageX=e.pageX,F.pageY=e.pageY;var n=e.srcElement||e.target;if(e.offsetX>=0&&e.offsetX<=18){var i=t.getLIParent(F.over),o=t.getLIParent(n);o&&t.addClass(o,"hoveredFormatter"),i&&i!==o&&t.removeClass(i,"hoveredFormatter")}else{var i=t.getLIParent(F.over);i&&t.removeClass(i,"hoveredFormatter")}e.ctrlKey&&("A"===n.tagName||t.hasClass(n,"tag"))?(F.wasPointer&&(F.over.style.cursor="text"),F.wasPointer=!0,n.style.cursor="pointer"):F.wasPointer&&(F.wasPointer=!1,F.over.style.cursor="text"),F.over=n}},t.element("container").addEventListener("mousemove",M.mousemove)),M.addPaneToRight=function(e){var t=M.panes().length,n=M.createPane(t,e);M.cancelFullscreenClick(),e===PaneMode.Normal&&n.vmSearch.focusBox(),h.performAction(TrackerType.UIAction,{type:TrackerUIAction.AddPane,data:t})},M.onTapAddNormal=function(e){M.addPaneToRight(PaneMode.Normal),t.sendEvent("Menu","AddPaneNormal"),M.closeSidebar(),e.preventDefault(),e.stopPropagation()},M.onTapAddTimeline=function(e){M.addPaneToRight(PaneMode.Timeline),t.sendEvent("Menu","AddPaneTimeline"),M.closeSidebar(),e.preventDefault(),e.stopPropagation()},M.showSearchSeparator=function(){return!p.mobile||t.phoneMenu.showSearchSeparator()},M.onTapSettingsPhone={onStart:function(e){t.ScreenManager.checkSwipeStart(e)},onMove:function(e){t.ScreenManager.checkSwipeMove(e)},onEnd:function(e){t.ScreenManager.checkSwipeEnd(e)}},M.isLoadingDoc=function(e){for(var n=0;n<M.panes().length;n++)e?t.addClass(M.panes()[n].paneContent,"loading"):t.removeClass(M.panes()[n].paneContent,"loading")},M.showHelp=function(e){var t=e||HelpMode.Intro;M.help||(M.help=new w(t),M.helpButtonHidden(t===HelpMode.Intro)),p.mobile||M.isHelpShowing(!0)},M.closeHelp=function(){M.isHelpShowing(!1),M.helpButtonHidden(!1)};var V=n.storage.getItem("helpIntro")?t.settings.get(Settings.helpPaneState):HelpMode.Intro;return V===HelpMode.None||t.isDemoMode()||setTimeout(M.showHelp,0,V),M.init(),M};return M});var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(e){var t=e.document,n=function(){return e.URL||e.webkitURL||e},i=e.URL||e.webkitURL||e,o=t.createElementNS("http://www.w3.org/1999/xhtml","a"),r="download"in o,a=function(n){var i=t.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),n.dispatchEvent(i)},s=e.webkitRequestFileSystem,d=e.requestFileSystem||s||e.mozRequestFileSystem,c=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l="application/octet-stream",u=0,h=[],p=function(){for(var e=h.length;e--;){var t=h[e];"string"==typeof t?i.revokeObjectURL(t):t.remove()}h.length=0},f=function(e,t,n){t=[].concat(t);for(var i=t.length;i--;){var o=e["on"+t[i]];if("function"==typeof o)try{o.call(e,n||e)}catch(r){c(r)}}},m=function(t,i){var c,p,m,g=this,v=t.type,y=!1,b=function(){var e=n().createObjectURL(t);return h.push(e),e},S=function(){f(g,"writestart progress write writeend".split(" "))},T=function(){(y||!c)&&(c=b(t)),p?p.location.href=c:window.open(c,"_blank"),g.readyState=g.DONE,S()},w=function(e){return function(){return g.readyState!==g.DONE?e.apply(this,arguments):void 0}},M={create:!0,exclusive:!1};return g.readyState=g.INIT,i||(i="download"),r?(c=b(t),o.href=c,o.download=i,a(o),g.readyState=g.DONE,void S()):(e.chrome&&v&&v!==l&&(m=t.slice||t.webkitSlice,t=m.call(t,0,t.size,l),y=!0),s&&"download"!==i&&(i+=".download"),(v===l||s)&&(p=e),d?(u+=t.size,void d(e.TEMPORARY,u,w(function(e){e.root.getDirectory("saved",M,w(function(e){var n=function(){e.getFile(i,M,w(function(e){e.createWriter(w(function(n){n.onwriteend=function(t){p.location.href=e.toURL(),h.push(e),g.readyState=g.DONE,f(g,"writeend",t)},n.onerror=function(){var e=n.error;e.code!==e.ABORT_ERR&&T()},"writestart progress write abort".split(" ").forEach(function(e){n["on"+e]=g["on"+e]}),n.write(t),g.abort=function(){n.abort(),g.readyState=g.DONE},g.readyState=g.WRITING}),T)}),T)};e.getFile(i,{create:!1},w(function(e){e.remove(),n()}),w(function(e){e.code===e.NOT_FOUND_ERR?n():T()}))}),T)}),T)):void T())},g=m.prototype,v=function(e,t){return new m(e,t)};return g.abort=function(){var e=this;e.readyState=e.DONE,f(e,"abort")},g.readyState=g.INIT=0,g.WRITING=1,g.DONE=2,g.error=g.onwritestart=g.onprogress=g.onwrite=g.onabort=g.onerror=g.onwriteend=null,e.addEventListener("unload",p,!1),v}(self);define("FileSaver",function(){}),define("dimport",["globals","data","tracker","VMLI","parse","goog"],function(e,t,n,i,o,r){function a(){this.workflowy={login:this.workflowyLogin.bind(this),"import":this.workflowyImport.bind(this),save:this.workflowySave.bind(this)},this.wunderlist={login:this.wunderlistLogin.bind(this),"import":this.wunderlistImport.bind(this),save:this.wunderlistSave.bind(this)},this.opml={login:this.opmlLogin.bind(this),"import":this.opmlImport.bind(this),save:this.opmlSave.bind(this)},this.json={login:this.jsonLogin.bind(this),"import":this.jsonImport.bind(this),save:this.jsonSave.bind(this)},this.text={login:this.textLogin.bind(this),"import":this.textImport.bind(this),save:this.textSave.bind(this)},this.gtasks={login:this.gtasksLogin.bind(this),"import":this.gtasksImport.bind(this),save:this.gtasksSave.bind(this)},this.trello={login:this.trelloLogin.bind(this),"import":this.trelloImport.bind(this),save:this.trelloSave.bind(this)},this.toodledo={login:this.toodledoLogin.bind(this),"import":this.toodledoImport.bind(this),save:this.toodledoSave.bind(this)}}return a.prototype={workflowyLogin:function(t,n,i,o){e.XHR({type:"POST",url:window.location.protocol+"//api.moo.do/oauth/workflowy",data:{username:t,password:n},cb:function(e){log("Login Response: ",e),200===e.status?(this.workflowy.data=JSON.parse(e.response),i()):(log("XHR Status: "+e.status),o("Error contacting remote server."))}.bind(this)})},workflowyImport:function(e){e(this.workflowy.data)},workflowyIterateItem:function(e,t){var n=673732;if(e&&t){var o=e.lm===n,r=new i({text:e.nm,isComplete:o},{parent:t,parse:!0,forceSave:!0});if(t.insertItem(r),e.no){var a=new i({text:e.no},{parent:r,parse:!0,forceSave:!0});r.insertItem(a)}if(e.ch)for(var s=0;s<e.ch.length;++s){var d=e.ch[s];this.workflowyIterateItem(d,r)}}},workflowySave:function(o,r,a){var s=o.projectTreeData.mainProjectTreeInfo;try{n.beginAction();var d=t.getRootModel(),c=new i({text:"Workflowy Import:"},{parent:d,parse:!0,forceSave:!0});d.insertItem(c);for(var l=0;l<s.rootProjectChildren.length;++l){var u=s.rootProjectChildren[l];this.workflowyIterateItem(u,c)}e.vmMain.runParseWorker(c),n.endAction(),r()}catch(h){a(void 0,h)}},wunderlistLogin:function(t,n,i,o){e.XHR({type:"POST",url:"https://api.wunderlist.com/login",data:{email:t,password:n},cb:function(e){if(log("Login Response: ",e),200===e.status){var t=JSON.parse(e.response);this.wunderlist.token=t.token,i(t)}else log("XHR Status: "+e.status),o("Error contacting remote server.")}.bind(this)})},wunderlistImport:function(e,t){this.wunderlistGetLists(function(n){this.wunderlistGetTasks(function(t){for(var i={inbox:{title:"inbox",items:{},p:0}},o=0;o<n.length;++o){var r=n[o];i[r.id]={title:r.title,items:{},p:r.position}}for(var o=0;o<t.length;++o){var a=t[o];if(a.parent_id){var s=i[a.list_id].items[a.parent_id];s?(s.items||(s.items=[]),s.items.push(a)):i[a.list_id].items[a.parent_id]={items:[a]}}else{var d=i[a.list_id].items[a.id];i[a.list_id].items[a.id]=a,d&&(i[a.list_id].items[a.id].items=d.items)}}e(i)}.bind(this),t)}.bind(this),t)},wunderlistGetLists:function(t,n){e.XHR({type:"GET",url:"https://api.wunderlist.com/me/lists",headers:{Authorization:this.wunderlist.token},cb:function(e){if(200===e.status){var i=JSON.parse(e.response);t(i)}else log("XHR Status: "+e.status),n("Error contacting remote server.")}.bind(this)})},wunderlistGetTasks:function(t,n){e.XHR({type:"GET",url:"https://api.wunderlist.com/me/tasks",headers:{Authorization:this.wunderlist.token},cb:function(e){if(200===e.status){var i=JSON.parse(e.response);t(i)}else log("XHR Status: "+e.status),n("Error contacting remote server.")}.bind(this)})},wunderlistSave:function(o,r,a){try{n.beginAction();var s=t.getRootModel(),d=new i({text:"Wunderlist Import:"},{parent:s,parse:!0,forceSave:!0});s.insertItem(d);for(var c in o){var l=o[c],u=l.title+(":"!==l.title[l.title.length-1]?":":""),h=new i({text:u},{parent:d,parse:!0,forceSave:!0});d.insertItem(h);for(var p in l.items){var f=l.items[p],m=new i({text:f.title,isComplete:!!f.completed_at,dateCompleted:f.completed_at,isStarred:f.starred},{parent:h,parse:!0,forceSave:!0});if(h.insertItem(m),f.note){var g=new i({text:f.note},{parent:m,parse:!0,forceSave:!0});m.insertItem(g)}if(f.items)for(var v=0;v<f.items.length;++v){var y=f.items[v],b=new i({text:y.title,isComplete:!!y.completed_at,dateCompleted:y.completed_at,isStarred:y.starred},{parent:m,parse:!0,forceSave:!0});m.insertItem(b)}}}e.vmMain.runParseWorker(d),n.endAction(),r()}catch(S){a(void 0,S)}},opmlLogin:function(e,t,n){n()},opmlImport:function(t,n){try{var i=new FileReader,r=document.forms.importFileUpload.importFile.files[0];r?(i.onload=function(i){var a,s=i.target.result;if((s.startsWith("<?xml ")||s.startsWith("<opml "))&&(a=e.loadXML(s)),a){var d=o.parseOPML(a,r.name);d?t():n("Error parsing OPML, please validate your data")}else n("Unable to load XML lib, please update or try another browser")},i.onerror=n,i.readAsText(r)):n("You must select a file before importing")}catch(a){n(void 0,a)}},opmlSave:function(e,t){log("OPML Save: ",e),t()},jsonLogin:function(e,t,n){n()},jsonImport:function(e,t){try{var n=new FileReader,i=document.forms.importFileUpload.importFile.files[0];i?(n.onload=function(n){var i=n.target.result;if(i)try{var r=JSON.parse(i),a=o.parseJSON(r);a?e():t("Error parsing JSON, please validate your data")}catch(s){t(void 0,s)}else t("Unable to import your requested file, please try agani")},n.onerror=t,n.readAsText(i)):t("You must select a file before importing")}catch(r){t(void 0,r)}},jsonSave:function(e,t){t()},textLogin:function(e,t,n){n()},textImport:function(t,n){var i,r=document.getElementById("importFileDataBox").textContent;if(r.startsWith("<?xml ")||r.startsWith("<opml "))try{if(i=e.loadXML(r)){var a=o.parseOPML(i,fileImport.name);if(a)return void t()}}catch(s){}if(r.startsWith("{")&&r.endsWith("}"))try{var d=JSON.parse(r),a=o.parseJSON(d);if(a)return void t()}catch(s){}n("Text Import Not Supported")},textSave:function(e,t){log("Text Save: ",e),t()},gtasksLogin:function(e,t,n,i){r.runAuthenticate([GScope.TasksRO],!1,!1,function(e){e&&!e.error?(this.gtasks.token=e,n(e)):i("Unable to authenticate with Google, please try again",e)}.bind(this))},gtasksImport:function(t,n){var i={roots:[],remoteItems:{},unassigned:[]};this.gtasksGetLists(function(o){for(var r=0;r<o.length;++r){var a=o[r];i.remoteItems[a.id]={id:a.id,text:a.title,isComplete:!1,dateCompleted:void 0,isArchived:!1,due:void 0,notes:void 0,parent:void 0,items:[]},i.roots.push(a.id),this.gtasksGetTasks(a,function(o){if(o&&e.isArray(o)){for(var r=0;r<o.length;++r){var s=o[r];i.remoteItems[s.id]={id:s.id,text:s.title,isComplete:"completed"===s.status,dateCompleted:s.completed?new Date(s.completed):void 0,isArchived:s.hidden,due:s.due?new Date(s.due):void 0,notes:s.notes,parent:s.parent||a.id,items:[]};var d=i.remoteItems[s.parent||a.id];d?d.items.push(s.id):i.unassigned.push(s.id)}t(i)}else n("Invalid task list returned")}.bind(this),n)}}.bind(this),n)},gtasksGetLists:function(t,n){var i=2e3;e.XHR({type:"GET",url:"https://www.googleapis.com/tasks/v1/users/@me/lists?maxResults="+i+"&key="+window.gapiKey+"&access_token="+r.getAccessToken(),cb:function(e){if(200===e.status){var i=JSON.parse(e.response);t(i.items)}else log("XHR Status: "+e.status),n("Error contacting remote server.")}.bind(this)})},gtasksGetTasks:function(t,n,i){var o=5e3;e.XHR({type:"GET",url:"https://www.googleapis.com/tasks/v1/lists/"+t.id+"/tasks?maxResults="+o+"&key="+window.gapiKey+"&access_token="+r.getAccessToken(),cb:function(e){if(200===e.status){var t=JSON.parse(e.response);n(t.items)}else log("XHR Status: "+e.status),i("Error contacting remote server.")}.bind(this)})},gtasksSave:function(o,r,a){function s(e,t){var n=e.text;e.due&&(n+=" @"+e.due.toString("MMM d"));var r=new i({text:n,isComplete:e.isComplete,dateCompleted:e.dateCompleted?e.dateCompleted.getTime():e.dateCompleted,isArchived:e.isArchived},{parent:t,parse:!0,forceSave:!0});if(t.insertItem(r),e.notes){var a=new i({text:e.notes},{parent:r,parse:!0,forceSave:!0});r.insertItem(a)}for(var d=0;d<e.items.length;++d)s(o.remoteItems[e.items[d]],r)}try{n.beginAction();var d=t.getRootModel(),c=new i({text:"Google Tasks Import:"},{parent:d,parse:!0,forceSave:!0});d.insertItem(c);for(var l=0;l<o.roots.length;++l)s(o.remoteItems[o.roots[l]],c);e.vmMain.runParseWorker(c),n.endAction(),r()}catch(u){a(void 0,u)}},trelloLogin:function(t,n,i,o){function r(){Trello.members("me",function(){},o)}function a(){o()}var s="667ecf0c3d3e029c51d205b7173f6c38";e.addScript("http://code.jquery.com/jquery-1.7.1.min.js","jqueryScript",function(){e.addScript("https://api.trello.com/1/client.js?key="+s,"trelloScript",function(){Trello.authorize({type:"popup",name:"Moo.do",persist:!1,expiration:"1hour",success:r,error:a})}.bind(this))}.bind(this))},trelloImport:function(){},trelloSave:function(){},toodledoLogin:function(e,t,n,i){var o="DuchessToodledoClientID",r="Dchs"+(new Date).getTime(),a="https://api.toodledo.com/3/account/authorize.php?response_type=code&client_id="+o+"&state="+r+"&scope=basic%20tasks%20notes%20outlines%20lists",s=(window.open(a,"toodledo","height=600,width=550"),function(e){var t=e.origin===location.origin;t&&(window.removeEventListener("message",s),e.data.error?i(e.data.error):(this.toodledo.token=e.data.access_token,n()))}.bind(this));window.addEventListener("message",s)},toodledoImport:function(){},toodledoSave:function(){}},a}),define("VMDebug",["ko","globals","platform","data","FileSaver","goog","dimport"],function(e,t,n,i,o,r,a){function s(){this.bugDescription=e.observable(""),this.mode=e.observable("html"),this.exportedContent="",this.exportedPreview=e.observable(""),this.exportArchived=e.observable(!0),this.importName=e.observable("JSON"),this.importDisplayMessage=e.observable(""),this.importing=!1,this.importer=new a,this.init()}return s.prototype={init:function(){this.exportArchived.subscribe(this.exportData.bind(this)),t.menus.registerModal("reportBug",this,this.reportBug),t.menus.registerModal("importData",this),t.menus.registerModal("exportData",this,this.openExport.bind(this),this.closeExport.bind(this))},reportBug:function(){setTimeout(function(){document.getElementById("bugDescription").focus()})},onTapSaveBug:function(){var e={};t.getAppInfo(e);var i=this.bugDescription()+"\r\n\r\n\r\n"+JSON.stringify(e,void 0,3),o=this.bugDescription().indexOf("\n"),r=this.bugDescription().substr(0,o>=0?o:Math.min(this.bugDescription().length,120)),a={name:r,notes:i};a.email=t.getUserIdentifier();var s=function(){t.XHR({type:"POST",url:window.location.protocol+"//api.moo.do/debug/reportIssue",data:a,cb:function(e){log("XHR Response: ",e.status,e),this.bugDescription("")}.bind(this)})}.bind(this);"Unknown"!==a.email?s():t.getClientInfo(function(e){e&&(a.email=e.ip),s()}),t.menus.closeModal("reportBug"),t.messageQueue.pushMessage({text:"Thanks for taking the time to send us feedback!",type:MessageType.Info,action:MessageAction.Default,timeout:1500}),t.blurActiveElement(),n.mobile&&t.vmMain.clearSelected()},onTapCancelBug:function(){t.menus.closeModal("reportBug"),t.blurActiveElement(),n.mobile&&t.vmMain.clearSelected()},openExport:function(){this.exportData(),this.exportKeyHandler=this.onExportKeydown.bind(this),document.addEventListener("keydown",this.exportKeyHandler,!0)},closeExport:function(){document.removeEventListener("keydown",this.exportKeyHandler,!0),this.exportKeyHandler=void 0},onTapCloseExport:function(){t.menus.closeModal("exportData")},exportData:function(){var e,t,n=i.getRootItem();if("html"==this.mode())e=i.toHtml(n,this.exportArchived()),t=e;else if("plain"==this.mode()){var o="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";e=i.toPlainText(n,0,this.exportArchived()),t=e.replace(/\n/g,"<br>").replace(/\t/g,o)}else"json"==this.mode()&&(e=i.toJSON(n,!1,this.exportArchived()),t=e);this.exportedContent=e,this.exportedPreview(t)},onTapHTML:function(e){this.mode("html"),this.exportData(),this.highlightExportButton(e)},onTapPlain:function(e){this.mode("plain"),this.exportData(),this.highlightExportButton(e)},onTapJSON:function(e){this.mode("json"),this.exportData(),this.highlightExportButton(e)},highlightExportButton:function(e){e.srcElement||(e.srcElement=e.target);var n=document.getElementById("exportTypes");if(n)for(var i=0;i<n.children.length;++i){var o=n.children[i];t.hasClass(o,"button")&&(o!==e.srcElement?t.removeClass(o,"bSelected"):t.addClass(o,"bSelected"))}},onTapOpen:function(){var e="plain"==this.mode()?this.exportedPreview():this.exportedContent,t=open("url");t.document.write(e)},onTapSelect:function(){var e=document.createRange();e.selectNodeContents(document.getElementById("exportedContent"));var t=window.getSelection();t.removeAllRanges(),t.addRange(e)},onTapSaveExport:function(){var e;"html"==this.mode()?e="html":"plain"==this.mode()?e="txt":"json"==this.mode()&&(e="json");try{var n=new Blob([this.exportedContent],{type:"text/plain;charset=utf-8"});saveAs(n,"moodo."+e)}catch(i){t.reportError(i)}},onExportKeydown:function(e){return n.normalizeKeys(e),(n.mac&&e.metaKey||!n.mac&&e.ctrlKey)&&e.normCode===KeyCode.A?(this.onTapSelect(),e.preventDefault(),e.stopPropagation(),!1):void 0},closeImport:function(){t.menus.closeModal("importData")},isAreaVisible:function(e){switch(this.importName()){case"Wunderlist":return"LoginArea"===e;case"Workflowy":return"LoginArea"===e;case"OPML":return"UploadArea"===e;case"JSON":return"UploadArea"===e;case"Text":return"TextArea"===e;case"Google Tasks":return"OAuthArea"===e;case"Trello":return"LoginArea"===e;case"Toodledo":return"OAuthArea"===e}return!1},highlightImportButton:function(e){e.srcElement||(e.srcElement=e.target);var n=document.getElementById("importLocations");if(n)for(var i=0;i<n.children.length;++i){var o=n.children[i];o!==e.srcElement?t.removeClass(o,"bSelected"):t.addClass(o,"bSelected")}},onTapRunImportWunderlist:function(e){this.importName("Wunderlist"),this.highlightImportButton(e)},onTapRunImportWorkflowy:function(e){this.importName("Workflowy"),this.highlightImportButton(e)},onTapRunImportOPML:function(e){this.importName("OPML"),this.highlightImportButton(e)},onTapRunImportJSON:function(e){this.importName("JSON"),this.highlightImportButton(e)},onTapRunImportText:function(e){this.importName("Text"),this.highlightImportButton(e)},onTapRunImportGTasks:function(e){this.importName("Google Tasks"),this.highlightImportButton(e)},onTapRunImportTrello:function(e){this.importName("Trello"),this.highlightImportButton(e)},onTapRunImportToodledo:function(e){this.importName("Toodledo"),this.highlightImportButton(e)},onTapRunImport:function(){if(!this.importing){var e=function(e,n){try{var i=e;i&&t.isString(i)||(i="There was an unexpected error, please double check your data"),this.importing=!1,this.importDisplayMessage(i),t.reportError(n||e,e)}catch(o){t.reportError(o)}}.bind(this),n=document.getElementById("importEmail").value,i=document.getElementById("importPW").value,o=void 0;switch(this.importName()){case"Wunderlist":o=this.importer.wunderlist;break;case"Workflowy":o=this.importer.workflowy;break;case"OPML":o=this.importer.opml;break;case"JSON":o=this.importer.json;break;case"Text":o=this.importer.text;break;case"Google Tasks":o=this.importer.gtasks;break;case"Trello":o=this.importer.trello;break;case"Toodledo":o=this.importer.toodledo}o&&(this.importing=!0,o.login(n,i,function(){o.import(function(n){o.save(n,function(){this.importDisplayMessage("Your data was imported successfully!"),this.importing=!1,setTimeout(function(){t.menus.closeModal("importData")}.bind(this),2e3)}.bind(this),e)}.bind(this),e)}.bind(this),e))}},importTitle:function(){var e=this.importName();return"OPML"!==e&&"JSON"!==e&&"Text"!==e?"Importing data from "+this.importName():"Upload "+e+" File"},importMessage:function(){return this.importDisplayMessage()}},s}),define("VMTimeline",["ko","globals","platform","data"],function(e,t,n){function i(){this.itemsToSchedule={},this.scheduleTimeout=0,this.delayNotifications=!1}return i.prototype={shouldNotify:function(e,t){return t||(t=new Date),!e.isComplete()&&e.date()&&e.date()>t&&!e.allDayDate&&!e.isArchived()},updateNotifications:function(e){if(!this.delayNotifications&&(n.ios||n.android||n.isChrome)&&n.app&&!t.isDemoMode()&&t.vmSettings.enabledNotifications()){var i=0,o=new Date;if(e)this.shouldNotify(e,o)&&(this.itemsToSchedule[e.id]=e,i=1);
else{var r=this;t.searchVMLIs({item:t.vmMain.root(),includeArchived:!1,comparator:function(e){return r.shouldNotify(e,o)},action:function(e){i++,r.itemsToSchedule[e.id]=e}})}this.scheduleTimeout&&(clearTimeout(this.scheduleTimeout),this.scheduleTimeout=void 0),i>0&&(this.scheduleTimeout=setTimeout(this.sendNotifications.bind(this),500))}},clearNotifications:function(){n.sendToApp("scheduledItems","[]")},sendNotifications:function(){var e="[",t=!0;for(var i in this.itemsToSchedule)if(this.itemsToSchedule.hasOwnProperty(i)){var o=this.itemsToSchedule[i];o.date()&&(t||(e+=","),e+=o.getBasicJSON(),t=!1)}e+="]",n.sendToApp("scheduledItems",e),this.itemsToSchedule={}},notifyPositionChanged:function(e){for(var n=0;n<t.vmMain.panes().length;++n)t.vmMain.panes()[n].notifyPositionChanged(e)},notifyStateChanged:function(e,n){if(e.date()&&n==PropChangeType.Date)this.dateUpdated(e);else for(var i=0;i<t.vmMain.panes().length;++i)t.vmMain.panes()[i].notifyStateChanged(e,n)},dateUpdated:function(e){t.vmMain.root()&&this.updateNotifications(e);for(var n=0;n<t.vmMain.panes().length;n++)t.vmMain.panes()[n].notifyStateChanged(e,PropChangeType.Date)},reloadTimelines:function(){for(var e=0;e<t.vmMain.panes().length;e++)t.vmMain.panes()[e].reloadTimeline()},load:function(){},startLoading:function(){this.delayNotifications=!0;for(var e=0;e<t.vmMain.panes().length;e++)t.vmMain.panes()[e].startLoading()},endLoading:function(){for(var e=0;e<t.vmMain.panes().length;e++)t.vmMain.panes()[e].endLoading();this.delayNotifications=!1,this.updateNotifications()}},i}),define("VMMessage",["ko","globals","util","data"],function(e,t,n,i){function o(e,t){this.id=e.id,this.owner=t,this.text=e.text,this.type=e.type||MessageType.Info,this.action=e.action||MessageAction.Default,this.block=e.block||!1,this.bottom=e.bottom||!1,this.data=e.data,this.onCloseFn=e.onClose,this.timeout=e.timeout,this.clearTimeout=void 0,this._isVisible=!1}return o.prototype={show:function(){this._isVisible||(this._isVisible=!0,this.timeout&&(this.clearTimeout=setTimeout(this.hide.bind(this),this.timeout)),this.block&&t.removeClass(document.getElementById("overlayBlocker"),"none"),this.owner.onMessageShow(this))},hide:function(e){this._isVisible&&(this._isVisible=!1,clearTimeout(this.clearTimeout),this.clearTimeout=void 0,this.onCloseFn&&this.onCloseFn(this),e||this.owner.onMessageHide(this))},isVisible:function(){return this._isVisible},getClass:function(){var e;switch(this.type){case MessageType.Info:e="messageInfo";break;case MessageType.Intro:e="messageIntro";break;case MessageType.Warning:e="messageWarning";break;case MessageType.Error:e="messageError";break;case MessageType.Fatal:e="messageFatal";break;case MessageType.Subtitle:e="messageSubtitle";break;case MessageType.RequiredUpdate:e="messageRequiredUpdate";break;case MessageType.InfoGray:e="messageInfoGray";break;case MessageType.MobileOffline:e="messageMobileOffline";break;case MessageType.MobileConnecting:e="messageMobileConnecting";break;default:e="messageInfo"}return this.bottom&&(e+=" bottom"),e},doAction:function(e){if(this.isVisible()){if(t.isFunction(this.action))this.action();else switch(this.action){case MessageAction.Default:this.hide();break;case MessageAction.Reload:t.reload(),this.hide();break;case MessageAction.Login:n.removeURLParam("demo"),this.hide();break;case MessageAction.Demo:n.insertURLParam("demo","true"),this.hide();break;case MessageAction.ResetClient:i.clearData(function(){t.reload()}),this.hide();break;case MessageAction.SyncContacts:break;case MessageAction.OpenURL:var o=this.data?this.data.url:void 0;o&&t.openUrl(o);break;case MessageAction.None:break;default:this.hide()}e.preventDefault(),e.stopImmediatePropagation(),e.returnFalse=!0}},onTapIgnore:{onStart:t.handlerPreventStop,onClick:function(e){this.isVisible()&&(this.hide(),e.preventDefault(),e.stopImmediatePropagation(),e.returnFalse=!0)}}},o}),define("VMMessageQueue",["ko","globals","util","platform","data","VMMessage"],function(e,t,n,i,o,r){function a(){this.queue=e.observableArray(),this.remoteMessages={},this.defaultMessages=[],this.defaultMessages[MessageID.Undefined]=void 0,this.hasConnectionError=!1,this.hasFatalError=!1,this.hasDocChange=!1,this.hasOfflineWarning=!1,this.hasOnlineInfo=!1,this.hasCacheReset=!1,this.hasRequiredUpdate=!1,this.currentFilter=0,this.FilterType={Mobile:1,Desktop:2,App:4},this.init()}return a.prototype={init:function(){t.applyBindings(this,"overlayArea"),i.demo||i.offline||setTimeout(this.updateRemoteMessages.bind(this),5e3),this.computeFilter()},getMessageById:function(e){return void 0===this.defaultMessages[e]&&this.initMessageByid(e),this.defaultMessages[e]},testMessageById:function(e){return!!this.defaultMessages[e]},initMessageByid:function(e){switch(e){case MessageID.ConnectionError:this.defaultMessages[e]=new r({text:"Connection error detected. "+i.actionVerbCaps()+" here to reconnect.",type:MessageType.Error,action:MessageAction.Reload},this);break;case MessageID.OfflineUndo:this.defaultMessages[e]=new r({text:"Offline undo/redo has been disabled temporarily",type:MessageType.Warning},this);break;case MessageID.FatalError:this.defaultMessages[e]=new r({text:"There was a fatal error in the application. "+i.actionVerbCaps()+" to restart.",type:MessageType.Error,action:MessageAction.Reload},this);break;case MessageID.DocChange:this.defaultMessages[e]=new r({text:"The document was changed in another tab. "+i.actionVerbCaps()+" to restart.",type:MessageType.Fatal,action:MessageAction.Reload,block:!0},this);break;case MessageID.OfflineWarn:this.defaultMessages[e]=new r({text:"You are offline and not saving your changes locally or remotely. You must reconnect before closing the window or you will lose your changes.",type:MessageType.Warning},this);break;case MessageID.OnlineInfo:this.defaultMessages[e]=new r({text:"You have gone back online. Your changes have been saved.",type:MessageType.Info,timeout:1e4},this);break;case MessageID.CacheReset:this.defaultMessages[e]=new r({text:"To fix your issues we are going to clear the local cache. This will reload the page and your data. "+i.actionVerbCaps()+" here to continue.",type:MessageType.Fatal,action:MessageAction.ResetClient,block:!0},this);break;case MessageID.RequiredUpdate:this.defaultMessages[e]=new r({text:"A software update is required to continue. "+i.actionVerbCaps()+" to update.",type:MessageType.RequiredUpdate,action:MessageAction.Reload,block:!0},this);break;case MessageID.Updated:this.defaultMessages[e]=new r({text:"An update was installed. "+i.actionVerbCaps()+" to reload.",type:MessageType.RequiredUpdate,action:MessageAction.Reload,bottom:!0},this);break;case MessageID.MobileOffline:this.defaultMessages[e]=new r({text:"OFFLINE",type:MessageType.MobileOffline,action:MessageAction.None,bottom:!0},this);break;case MessageID.MobileConnecting:this.defaultMessages[e]=new r({text:"Connecting",type:MessageType.MobileConnecting,action:MessageAction.None,bottom:!0},this);break;case MessageID.SyncContacts:this.defaultMessages[e]=new r({text:i.actionVerbCaps()+" to enable contact syncing to insert contacts into your document.",type:MessageType.Info,action:MessageAction.SyncContacts,timeout:1e4},this)}},pushMessage:function(e){var n;return e instanceof r?n=e:t.isObject(e)?n=new r(e,this):t.isString(e)?n=new r({text:e},this):(n=this.getMessageById(e),n||log("Message not created properly",e)),n&&n.show(),n},clearMessage:function(e){var t;return e instanceof r?t=e:this.testMessageById(e)&&(t=this.getMessageById(e)),t&&t.hide(),t},onMessageShow:function(e){this.queue.push(e)},onMessageHide:function(e){var t=this.queue.indexOf(e);0>t||this.queue.splice(t,1)},computeFilter:function(){i.isMobile&&(this.currentFilter|=this.FilterType.Mobile),i.isMobile||(this.currentFilter|=this.FilterType.Desktop),i.app&&(this.currentFilter|=this.FilterType.App)},updateRemoteMessages:function(){if(!t.isDemoMode()){var e=t.settings.get(Settings.lastMessageSync),n="";e&&(n="?lastSync="+new Date(e).toString("yyyy-MM-ddTHH:mm:ss"));var i=new Date;t.XHR({type:"GET",url:window.location.protocol+"//api.moo.do/debug/getMessages"+n,cb:function(e){if(200===e.status){t.settings.set(Settings.lastMessageSync,i);var n=JSON.parse(e.responseText);if(n)for(var o=n.m,r=0;o&&r<o.length;++r){var a=o[r],s=this.remoteMessages[a.id];if(!s){var d=!0;a.filter&&(d=0!==(a.filter&this.currentFilter),log("Remote Message Filter: "+a.filter+" "+this.currentFilter+" "+d)),d&&this.pushMessage({text:a.data,type:a.type,action:MessageAction.Default}),this.remoteMessages[a.id]=a}}}else log("Unable to get remote messages",e)}.bind(this)})}}},a}),define("TemplateCache",["ko","globals"],function(e,t){window.__TOTAL_TEMPLATES=0;var n={},i="__cached_template__";n.templateSources=function(t){var n={elem:t,__proto__:new e.templateSources.domElement(t)};return n.text=function(e){return 0===arguments.length?n.elem.text:void(n.elem.text=e)},n.nodes=function(){if(0===arguments.length){var t=e.utils.domData.get(n.elem,i);if(!t){for(var o=n.text().replace(/(\r\n|\n|\r|\s*(?=<)|\s*$)/gm,""),r=e.utils.parseHtmlFragment(o),a=document.createElement("div"),s=0;s<r.length;s++)a.appendChild(r[s]);return e.utils.domData.set(n.elem,i,{cachedNodes:a}),a}return t.cachedNodes}},n},n.templateEngine=function(){var i={__proto__:new e.nativeTemplateEngine};return i.cachedDoc=void 0,i.makeTemplateSource=function(e,o){var r=o||document,a=i.cachedDoc;i.cachedDoc||(a={doc:r,cachedTemplates:{}},i.cachedDoc=a);var s=a.cachedTemplates[e];if(!s){var d=a.doc.getElementById(e);if(d)try{s=new n.templateSources(d)}catch(c){t.reportError(c)}else t.reportError(new Error('Unable to find element for template "'+e+'". '+d));a.cachedTemplates[e]=s,__TOTAL_TEMPLATES++}return s},i};var o=n.templateEngine();return o instanceof e.templateEngine&&e.setTemplateEngine(o),n}),define("VMContact",["ko","globals","data","goog","platform","tracker"],function(e,t,n,i,o){function r(t){this.templateName="template-contact",this.id=t.id,this.isSelected=e.observable(!1),this.imageURL=e.observable(""),this.text=t.text||"",this.avatar=t.avatar||"",this.image=void 0,this.phoneNumbers=t.phoneNumbers||[],this.emails=t.emails||[],this.dbItem=t,this.phone=void 0,this.phoneLink=void 0,this.email=void 0,this.emailLink=void 0,this.item=void 0,this.init()}return r.prototype={hasPreview:function(){return!0},init:function(){for(var e=0;e<this.phoneNumbers.length;e++)this.phoneNumbers[e].link=this.formatPhone(this.phoneNumbers[e].number),this.phoneNumbers[e].type=this.phoneNumbers[e].type[0];for(var e=0;e<this.emails.length;e++)this.emails[e].link="mailto:"+this.emails[e].address},onLoad:function(e){this.element=e},formatPhone:function(e){var t=/^(?:\+?1[-. ]?)?(?:\(?([0-9]{3})\)?[-. ]?)?([0-9]{3})[-. ]?([0-9]{4})$/;if(t.test(e)){var n=e.match(t),i="";n[1]&&(i+="("+n[1]+") "),i+=n[2]+"-"+n[3];var r="";return n[1]&&(r+="+1-"+n[1]+"-"),r+=n[2]+"-"+n[3],o.ios||o.android?"tel:"+r:"callto:"+r}},loadImageForContact:function(){if(t.vmMain.isOnline()&&!o.mobile&&this.avatar&&!this.imageURL()){var e=this.avatar+"&access_token="+i.getAccessToken(),n=new Image;return n.width=35,n.height=35,n.onload=function(){this.imageURL(e),n=void 0,log("success",this.text),t.autocomplete.onImageSuccess(this)}.bind(this),n.onerror=function(){n=void 0,t.autocomplete.onImageFail(this)}.bind(this),n.src=e,!0}},onTapNumber:function(e){o.android&&t.openUrl(e.srcElement.href,e)},onTapEmail:function(e){o.android&&t.openUrl(e.srcElement.href,e)},onTap:{onClick:function(e){log("Contact Element Tapped: ",e.srcElement,this.text),t.hasClass(e.srcElement,"contactPhone")||t.hasClass(e.srcElement,"contactEmail")||t.autocomplete.onTapped(this.text)}}},r}),define("VMAutocompleteItem",["ko","data","globals","platform"],function(e,t,n){function i(t){this.id=t.id,this.text=t.text||"",this.object=t.object,this.index=t.index,this.isSelected=e.observable(!1),this.element=void 0,this.init()}return i.prototype={init:function(){},html:function(){var e=n.autocomplete.text();if(void 0!==this.text&&void 0!==e&&e.length>0){var t=this.text.toLowerCase().indexOf(e.toLowerCase()),i="";return i=t>=0?this.text.substr(0,t)+"<b>"+this.text.substr(t,e.length)+"</b>"+this.text.substr(t+e.length):this.text}return this.text},onLoad:function(e){this.element=e}},i}),define("AutocompleteDates",["ko","data","globals","platform"],function(){function e(){this.soft=["now","soon","later"],this.softDays=["today","tomorrow"],this.dayModifiers=["next"],this.days=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],this.months=["january","february","march","april","may","june","july","august","september","october","november","december"],this.dict=this.soft.concat(this.softDays).concat(this.dayModifiers).concat(this.days).concat(this.months),this.NextWordOptions={None:0,DayName:1,Days:2,Time:4},this.init()}return e.prototype={init:function(){},findDatesLike:function(e){for(var t=e.toLowerCase(),n=[],i=0;i<this.dict.length;++i)0===this.dict[i].indexOf(t)&&n.push({index:0,object:{id:this.dict[i],text:this.dict[i]}});return n},findExact:function(e){return this.dict.indexOf(e)>=0&&this.nextWordOptions(e)===this.NextWordOptions.None?{index:0,id:e,text:e}:void 0},nextWordOptions:function(e){var t=e.split(" "),n=t[t.length-1];if(""==n&&(n=t[t.length-2]),this.soft.indexOf(n)>=0)return this.NextWordOptions.None;if(this.softDays.indexOf(n)>=0)return this.NextWordOptions.Time;if(this.dayModifiers.indexOf(n)>=0)return this.NextWordOptions.DayName;if(this.days.indexOf(n)>=0)return this.NextWordOptions.Time;if(this.months.indexOf(n)>=0)return this.NextWordOptions.Days;var i=parseInt(n,10);return isNaN(i)?n.indexOf(":")>=0?this.NextWordOptions.Time:this.NextWordOptions.None:this.NextWordOptions.Time},getMonthList:function(){var e=1,t=5,n=(new Date).getMonth(),i=n-e;0>i&&(i=12+i);for(var o=i+e+t+1,r=[],a=i;o>a;++a){var s=a%12;r.push(s)}return r}},e}),define("VMContactManager",["ko","globals","data","VMContact"],function(e,t,n,i){function o(){this.contactCache={},this.init()}return o.prototype={init:function(){},getContact:function(e){var t=n.contactsByName[e];if(t){if(this.contactCache[t.id])return this.contactCache[t.id];var o=new i(t);return this.contactCache[t.id]=o,o}return void 0},notifyContactsUpdated:function(){}},o}),define("VMAutocomplete",["ko","data","globals","goog","platform","android","VMContact","VMAutocompleteItem","AutocompleteDates","tracker","VMContactManager"],function(e,t,n,i,o,r,a,s,d,c,l){function u(){this.items=e.observableArray(),this.isVisible=e.observable(!1),this.element=void 0,this.trackingItem=void 0,this.trackingTag=void 0,this.selectedIndex=e.observable(-1),this.exactMatch=e.observable(!1),this.text=e.observable(""),this.contactsEnabled=e.observable(!0),this.lastParams=void 0,this.autocompleteDates=new d,this.nextDateWord=e.observable(this.autocompleteDates.NextWordOptions.None),this.lastX=0,this.lastY=0,this.Modes={Contact:0,Date:1},this.mode=e.observable(-1),this.cman=new l,this.init()}return u.prototype={getDateText:function(e){switch(e){case 1:return e+"st ";case 2:return e+"nd ";case 3:return e+"rd ";default:return e+"th "}},showAllDates:function(){return""===this.text()},showDate:function(){return this.nextDateWord()==this.autocompleteDates.NextWordOptions.None||this.nextDateWord()==this.autocompleteDates.NextWordOptions.DayName},showDays:function(){return this.nextDateWord()==this.autocompleteDates.NextWordOptions.Days},showTime:function(){return this.nextDateWord()==this.autocompleteDates.NextWordOptions.Time},showDates:function(){return o.mobile&&o.app&&this.mode()==this.Modes.Date&&(""===this.text()||this.nextDateWord())},showList:function(){return!this.exactMatch()&&!this.showDates()},showPreview:function(){return this.mode()==this.Modes.Contact&&this.items().length>0&&this.selectedIndex()>=0&&this.selectedItem()&&(!o.mobile||this.exactMatch)},showEnableContactsUI:function(){return this.mode()==this.Modes.Contact&&!this.contactsEnabled()},hasContent:function(){return this.showDates()||this.showList()||this.showPreview()},getMonthList:function(){return this.autocompleteDates.getMonthList()},getShortMonth:function(e){return Date.CultureInfo.abbreviatedMonthNames[e]},getLongMonth:function(e){return Date.CultureInfo.monthNames[e]},templatePreview:function(){return"template-contact"},selectedItem:function(){return this.selectedIndex()<0?void 0:this.items()[this.selectedIndex()]},selectedData:function(){var e=this.selectedItem();return e?e.object:void 0},init:function(){this.onkeydown=this.onkeydown.bind(this),this.onMouseover=this.onMouseover.bind(this),this.element=document.getElementById("autocomplete"),n.applyBindings(this,"autocomplete"),window.addEventListener("closeKeyboard",this.hide.bind(this)),o.isTouchDevice&&this.element.addEventListener(o.touchStartEvent,function(e){return this.showPreview()||n.preventScrollPropagation(this.element)?void 0:(e.preventDefault(),!1)}.bind(this))},setMode:function(e){e==DatePrefix&&this.mode(this.Modes.Date),e==ContactPrefix&&this.mode(this.Modes.Contact)},show:function(e,t){if(!this.isVisible()||t){var i,a=t;if(!a&&(i=document.getSelection(),i&&i.baseNode)){var s=n.findParent(i.baseNode,"contact",2);a=s||n.findParent(i.baseNode,"date",2),s&&c.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenContact,data:[{info:e}]})}this.completionElement=a,this.showList()&&(this.element.children[0].style.maxHeight="");var d=document.documentElement.getBoundingClientRect(),l=this.element.getBoundingClientRect(),u={left:l.left,right:l.right,top:l.top,bottom:l.bottom};if(0===l.width&&0===l.height&&(u.right=350,u.bottom=170),a)var h=a.getBoundingClientRect();else if(r.isEnabled()){var h=e.getSpan().getBoundingClientRect();h.left-=20}else{if(!(i.rangeCount>0))return;var h=n.getSelectionRange().getClientRects()[0];h.left-=20}if(n.setOrigin(u,h.left,h.bottom),!o.mobile){var p=n.adjustHeightToBeInsideBounds(d,u,200,600,10);this.showList()&&(this.element.children[0].style.maxHeight=p+"px")}if(this.element.style[o.transform.style]="translate("+u.left+"px, "+u.top+"px)",this.isVisible(!0),o.mobile&&e){var f=150,m=0;if(this.mode()==this.Modes.Contact&&t)this.element.style.top="",this.element.style.paddingBottom="30px",this.element.style.bottom=r.isEnabled()?o.getKBTop()+"px":0;else{var g=n.scrollToTop(e.getSpan(),f),v=a?a.getBoundingClientRect():e.getSpan().getBoundingClientRect();m=v.bottom-g,this.element.style.paddingBottom="",this.element.style.top=m+4+"px",this.element.style.bottom=o.getKBTop()+"px",this.mode()==this.Modes.Contact?n.phoneMenu.contactMode(!0):this.mode()==this.Modes.Date&&n.phoneMenu.dateMode(!0)}n.keyboardToolbar.isVisible(!1);var y=o.windowHeight()-o.kbsize-m;n.setTransform(this.element,0,y),requestAnimationFrame(function(){n.setTransform(this.element,0,0,f,"ease-out")}.bind(this))}c.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.OpenAutocomplete})}},updateItems:function(e,t){0>t&&e.length>0&&(t=0),t>=0&&e[t].isSelected(!0),this.items(e),this.selectedIndex(t)},clear:function(e){if(this.selectedIndex(-1),e){var t=this.items();t.splice(0,t.length)}else this.items.removeAll();this.trackingTag=!1},hide:function(){if(this.isVisible()){var e=200;if(o.mobile){var t=o.windowHeight()-o.kbsize;n.setTransform(this.element,0,t,e,"ease-out"),setTimeout(function(){this.selectedIndex(-1),this.isVisible(!1),n.phoneMenu.contactMode(!1),n.isKeyboardOpen&&n.keyboardToolbar.isVisible(!0),this.clear()}.bind(this),e)}else this.selectedIndex(-1),this.isVisible(!1);c.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.CloseAutocomplete})}},onkeydown:function(e){if(0===this.items().length||!this.isVisible()||this.exactMatch()&&e.normCode!==KeyCode.Escape)return!0;if(e.normCode===KeyCode.UpArrow||e.normCode===KeyCode.DownArrow){if(this.items().length>1){this.selectedIndex()>=0&&this.items()[this.selectedIndex()].isSelected(!1);var t=this.selectedIndex()+(e.normCode==KeyCode.DownArrow?1:-1);this.selectedIndex(0>t?this.items().length+t:t>=this.items().length?t%this.items().length:t);var i=this.items()[this.selectedIndex()];return i.isSelected(!0),n.scrollIntoView(i.element,200),!1}this.hide()}else{if(e.normCode===KeyCode.Enter){if(this.selectedIndex()>=0){var o=this.items()[this.selectedIndex()];this.onTapped(o.text,!0)}return this.hide(),!1}if(e.normCode===KeyCode.Escape)return this.hide(),!1}return!0},onTap:{onClick:function(t){var n=e.dataFor(t.srcElement);n&&n instanceof s&&this.onTapped(n.text,!0),t.preventDefault(),t.stopImmediatePropagation()}},onTapped:function(e,t){this.text(e),this.trackingItem&&this.trackingItem.onAutocompleteTapped(e,this.trackingTag),(t||this.mode()===this.Modes.Contact||!o.mobile)&&this.hide()},find:function(e,t,n){if(t+n>e.length-1)return!1;var i=e[t];isNaN(n)&&(n=0);for(var o=0;n>o&&e[t+o+1];o++)i+=" "+e[t+o+1];var r,a=-1!==i.indexOf(":",i.length-1)?i.substr(0,i.length-1):i;return this.mode()==this.Modes.Contact?r=this.findContact(a):this.mode()==this.Modes.Date&&(r=this.findDate(a)),r.length>0?this.find(e,t,n+1)||{start:t,num:n+1,text:a,results:r}:!1},findContact:function(e){return t.findContactsLike(e)},findDate:function(e){return this.autocompleteDates.findDatesLike(e)},findExact:function(e){return this.mode()==this.Modes.Contact?this.findContactExact(e):this.mode()==this.Modes.Date?this.findDateExact(e):void 0},findContactExact:function(e){return t.findContactsExact(e)},findDateExact:function(e){return this.autocompleteDates.findExact(e)},objectFromResult:function(e){return this.mode()==this.Modes.Contact?this.cman.getContact(e.text):this.mode()==this.Modes.Date?new a(e):void 0},getMinWordLength:function(){return this.mode()==this.Modes.Contact?1:this.mode()==this.Modes.Date?1:void 0},getLineIndexFromWordIndex:function(e,t){for(var n=0,i=0;t>i;i++)n+=e[i].length+1;return n},update:function(e){this.lastParams=e;var t=e.item||this.trackingItem,i=r.isEnabled()?r.getInputText():t.getParsedText(),a=e.start,d=e.fromArrows;this.trackingItem=t,this.trackingTag=!1;var c,l=0,u=0,h=-1,p=-1,f=i.split(" ");for(l>0&&(f[0]=f[0].substr(l)),c=0;c<f.length;c++)(f[c].startsWith(ContactPrefix)||f[c].startsWith(DatePrefix))&&a>=u&&(h=c,p=u,this.setMode(f[c][0])),u+=f[c].length+1;this.getMinWordLength();if(h>=0){this.trackingTag=!1,f[h]=f[h].substr(1);var m=this.find(f,h),g=1;""===f[h+1]&&g++;var v=!1,y=-1,b=[];if(m&&p+g+m.text.length>=a){var S=this.findExact(m.text);if(this.exactMatch(!!S),S){var T={index:-1,text:S.text};T.object=this.objectFromResult(S);var t=new s(T);b.push(t),y=0,this.trackingTag=!0,d||o.mobile||(v=!0)}else{if(m&&m.num>0){this.trackingTag={text:m.text,index:this.getLineIndexFromWordIndex(f,m.start)+1,length:m.text.length},this.text(m.text);var w=m.results;for(c=0;c<w.length;c++){var M=w[c].object,T={index:c,text:M.text};T.object=this.objectFromResult(M);var t=new s(T);b.push(t)}this.newIndex=0}d||(v=!0)}}else m||this.mode()!==this.Modes.Contact||n.settings.get(Settings.syncContacts)||d||(this.trackingTag=void 0,n.isDemoMode()||this.contactsEnabled(!1),this.show(this.trackingItem));this.updateItems(b,y),v&&this.show(this.trackingItem)}this.nextDateWord(this.autocompleteDates.NextWordOptions.None),this.trackingTag===!1&&this.hide()},onMouseover:function(t,n){var i=e.dataFor(n.srcElement);if(i&&i instanceof s){this.selectedIndex()>=0&&this.items()[this.selectedIndex()].isSelected(!1);var o=this.items.indexOf(i);o>=0&&(this.selectedIndex(o),i.isSelected(!0))}},onTapDate:{onStart:n.handlerPreventStop,onClick:function(e){var t=e.srcElement;if("SPAN"==t.nodeName){var i=t.parentNode;if(n.hasClass(i,"disabled"))return;var o=t.id?t.id+" ":t.textContent,r=this.autocompleteDates.nextWordOptions(o);this.nextDateWord(r);var a=r==this.autocompleteDates.NextWordOptions.None;this.onTapped(o,a),this.trackingTag.index+=o.length}}},onTapEnableContacts:{onClick:function(){n.vmSettings.enableSyncContacts(function(e){e&&(this.contactsEnabled(!0),this.lastParams&&(this.update(this.lastParams),this.show(this.trackingItem,this.completionElement)))}.bind(this))}}},u}),define("ScreenManager",["ko","globals","platform"],function(e,t,n){function i(e){this.snapPoints=[],this.screens=[],this.activeScreen=-1,this.screenAtSwipeStart=-1,this._isSwiping=!1,this.swipePoints=[],this.minOffset=0,this.maxOffset=0,this.owner=e,this.useScroll=n.mobileie&&!t.isDemoMode(),this.lastOffset=0,this.updateFunctions=[],this.paneWidth=.85,window.Screens||t.reportError(new Error("Screen manager created before screens are valid")),this.init()}return window.Screens=n.mobile?{Settings:0,Outline:1,List:2,MAX:2}:{Outline:0,List:1,MAX:1},i.prototype={init:function(){this.activeScreen=Screens.MAX},getActiveScreen:function(){return this.activeScreen},setOwner:function(e){this.owner=e},isSwiping:function(){return this._isSwiping},isScreenOpen:function(e){return this.activeScreen===e},computeSnapPoints:function(){for(var e=2*this.paneWidth+1,n=[0,this.paneWidth,2*this.paneWidth,2*this.paneWidth+1],i=this.useScroll?this.owner.scrollWidth-50:parseInt(t.width(this.owner))*e,o=0;o<n.length;++o)this.snapPoints[o]=Math.round(n[o]*(i/e));this.offsetMin=0,this.offsetMax=this.snapPoints[2],this.lastOffset=this.offsetMax},onResize:function(){if(n.mobile){var e=this.activeScreen;this.computeSnapPoints();var t=this.snapPoints[e];this.updateScreenOffset(e,t,0),this.lastOffset=t}},scrollToScreen:function(e,t){t=void 0===t?200:t,this.activeScreen!==e&&(this.notifyScreenOfClose(this.activeScreen),this.notifyScreenOfOpen(e));var n=this.activeScreen;this.activeScreen=e;var i=this.snapPoints[e];return this.notifyScreenOfScroll(n,i,t),this.updateScreenOffset(e,i,t),this.lastOffset=i,i},updateScreenOffset:function(e,i,o){if(o=o||0,this.useScroll)if(o){var r=this.snapPoints[e];t.scrollTo(r,o,this.owner,!0)}else this.owner.scrollLeft=Math.round(i);else for(var a=0;a<this.screens.length;++a){var s=this.screens[a].getTopElement();t.setTransform(s,-i,0,o,"ease-out");var d=i-(a-1)*n.windowWidth()*this.paneWidth,c=d/(n.windowWidth()*this.paneWidth);o&&t.setTransitionStyle(s,"all",o,"ease-out"),s.style.opacity=t.clamp(.1+.9*c,0,1)}t.setTransform(t.element("headers"),-i*(1/this.paneWidth),0,o),this.lastOffset=i},getCurrentScreenOffset:function(){return this.useScroll?this.owner.scrollLeft:this.lastOffset},addScreen:function(e,t){this.screens[t]=e},getScreen:function(e){var t=this.screens[e];return t},notifyScreenOfClose:function(e){if(-1!==e){var t=this.getScreen(e);t&&t.onScreenClose&&t.onScreenClose()}},notifyScreenOfScroll:function(e,n,i){if(-1!==e)for(var o=0;o<this.screens.length;++o){var r=this.getScreen(o);r&&r.onScreenScroll&&r.onScreenScroll(n,i)}t.fireCustomEvent("screenScroll")},notifyScreenOfStartOpen:function(e){if(-1!==e){var t=this.getScreen(e);t&&t.onScreenStartOpen&&t.onScreenStartOpen()}},notifyScreenOfOpen:function(e){if(-1!==e){var t=this.getScreen(e);t&&t.onScreenOpen&&t.onScreenOpen()}},startSwipe:function(){this._isSwiping||(this._isSwiping=!0,0===this.activeScreen?this.notifyScreenOfStartOpen(1):this.activeScreen===Screens.MAX?this.notifyScreenOfStartOpen(Screens.MAX-1):(this.notifyScreenOfStartOpen(this.activeScreen-1),this.notifyScreenOfStartOpen(this.activeScreen+1)))},updateSwipe:function(e,t){if(n.ios||n.android||n.mobileie){var i=this.getCurrentScreenOffset(),o=Math.max(Math.min(i+e,this.offsetMax),this.offsetMin);i!==o&&this.updateScreenOffset(this.activeScreen,o),this.swipePoints.splice(0,0,{time:t,x:e}),this.swipePoints.length>20&&this.swipePoints.splice(this.swipePoints.length-1,1)}},endSwipe:function(){for(var e=-1,i=Date.now(),o=300,r=200,a=0,s=0,d=0;d<this.swipePoints.length;d++){var c=this.swipePoints[d];if(!(i-c.time<o))break;a+=c.x,s=i-c.time}var l=a/(s/1e3);if(-r>l)e=this.screenAtSwipeStart-1;else if(l>r)e=this.screenAtSwipeStart+1;else for(var u=this.getCurrentScreenOffset(this.activeScreen),h=1e5,d=0;d<this.snapPoints.length;++d){var p=Math.abs(this.snapPoints[d]-u);h>p&&(e=d,h=p)}e=Math.max(Math.min(e,Screens.MAX),0),this.scrollToScreen(e),n.ios&&t.preventClick(),this._isSwiping&&(this._isSwiping=!1)},checkSwipeStart:function(e){var t=!1;return this.screenAtSwipeStart=this.activeScreen,this.swipePoints.length=0,n.ie&&!n.mobile||n.mobile&&this.activeScreen!==Screens.List&&e.eventX>this.paneWidth*n.windowWidth()&&(e.preventDefault(),t=!0),t},checkSwipeMove:function(e){var i=!1;if(n.ie&&!n.mobile);else if(n.mobile){var o=this.activeScreen!==Screens.MAX&&Math.abs(e.diffX)>5||this.activeScreen===Screens.MAX&&e.diffX>5;(this.isSwiping()||Math.abs(e.distanceY)<10&&o&&t.canRevealMenu)&&(this.isSwiping()||this.startSwipe(),this.updateSwipe(-e.xThisFrame,e.timeStamp),e.preventDefault(),e.stopImmediatePropagation(),i=!0)}return i},checkSwipeClick:function(e){return this.activeScreen!==Screens.List&&e.eventX>this.paneWidth*n.windowWidth()?(this._isSwiping=!1,this.scrollToScreen(this.activeScreen+1),!0):this._isSwiping},checkSwipeEnd:function(e){var t=!1;return this.activeScreen==this.screenAtSwipeStart?n.ie&&!n.mobile||n.mobile&&this.isSwiping()&&this.endSwipe(e):this.activeScreen!=this.screenAtSwipeStart&&(t=!0),t}},i}),define("VMTooltip",["ko","globals","platform"],function(e,t,n){function i(){this.listenerElement=void 0,this.displayElement=void 0,this.element=void 0,this.arrowElement=void 0,this.displayTimeout=void 0,this.extraTimeout=void 0,this.displayText=e.observable(""),this.displayExtra=e.observable(""),this.arrowClass=e.observable("notVisible"),this.arrowX=e.observable(0),this.overTooltip=e.observable(!1),this.tipExtras={"#desktopMenuButton":"Access your settings and documents, view help",".addPaneNormal":"Open another editable view of your data",".addPaneTimeline":"View your agenda"},t.applyBindings(this,"tooltip"),this.init()}var o=300,r=1e3;return i.prototype={init:function(){},onLoad:function(){this.element=document.getElementById("tooltip"),this.tooltipArrow=document.getElementById("tooltipArrow"),n.touch||(this.listenerElement=document.getElementById("outerWrapper"),this.listenerElement&&(this.listenerElement.addEventListener("mouseover",this.handleEleOver.bind(this),!0),this.listenerElement.addEventListener("mouseout",this.handleEleOut.bind(this),!0)))},register:function(e,t){this.update(e,t)},update:function(e,t){e.setAttribute("tooltip",t)},tipIn:function(e){this.displayElement!==e.srcElement&&(clearTimeout(this.displayTimeout),this.displayTimeout=setTimeout(this.displayTip.bind(this),o,{element:e.srcElement,offset:{y:5}}))},adjustBounds:function(e){var n=40,i=0,o=document.documentElement.getBoundingClientRect(),r=this.displayElement.getBoundingClientRect(),a=(o.right-r.right,t.width(this.element)),s=r.left+r.width/2-a/2;y=e&&e.above?r.top-t.height(this.element):r.bottom;var d=e&&e.offset;d?(d.x?s+=d.x:d.right?s=o.right-a-d.right:d.left&&(s=d.left),d.y&&(y+=d.y)):e&&e.above?y-=5:y+=5;var c=s;s+a>o.right?c=o.right-a-5:0>s&&(c=5);var l=e&&e.arrow;if(l){var u=(a-n)/2;c!=s&&(u+=s-c),this.arrowClass(l),this.arrowX(u+"px")}else this.arrowClass("notVisible");e&&e.time&&(i=e.time),t.setTransform(this.element,c,y,i)},displayTip:function(e){if(e){this.displayTimeout=void 0;var t,i=this.displayElement=e.element;e.text?t=e.text:i&&(t=i.getAttribute("tooltip")),t&&(this.displayText(t),this.element.style["max-width"]=e.maxWidth?e.maxWidth+"px":"",this.adjustBounds(e),n.mobile||(this.extraTimeout=setTimeout(this.showExtra.bind(this),r)))}},tipOut:function(e){e.srcElement||(e.srcElement=e.target);var n=!1,i=e.toElement||e.relatedTarget;i&&(n=t.isAncestor(i,e.srcElement)),n||e.srcElement===i||i===this.element||this.hideTip()},handleEleOver:function(e){e.srcElement||(e.srcElement=e.target);var t=e.srcElement.getAttribute("tooltip");t&&this.tipIn(e)},handleEleOut:function(e){e.srcElement||(e.srcElement=e.target);e.srcElement.getAttribute("tooltip");this.tipOut(e)},showExtra:function(){var e=void 0;if(this.displayElement){if(this.displayElement.id){var t="#"+this.displayElement.id;this.tipExtras[t]&&(e=t)}if(!e)for(var n=0;n<this.displayElement.classList.length;++n){var i="."+this.displayElement.classList[n];if(this.tipExtras[i]){e=i;break}}if(e){var o=this.tipExtras[e];o&&(this.displayExtra(o),this.adjustBounds())
}clearTimeout(this.extraTimeout),this.extraTimeout=void 0}},hideTip:function(){this.displayElement=void 0,clearTimeout(this.displayTimeout),this.displayTimeout=void 0,clearTimeout(this.extraTimeout),this.extraTimeout=void 0,this.displayText(""),this.displayExtra("")},onTap:function(e){t.intro.nextStep(),e.stopImmediatePropagation(),e.preventDefault()}},i}),define("AppCache",["ko","globals","platform"],function(e,t,n){function i(){this.minTimeShowUpdate=2e3,this.timeToCancelButton=2e3,this.notifiedOfNew=!1,this.isFinished=!1,this.timeShownUpdatingMessage=void 0,this.showCancel=e.observable(!1),this.downloadingTimeout=0,this.startStatus=window.applicationCache?window.applicationCache.status:-2,this.continuedUpdate=!1,this.updateActionDone=!1,this.fnToRun=[],this.dynamicUpdateCheck=!1,this.requiredUpdate=!1,this.appUpdatePending=!1,this.isShowingProgress=!1,this.init()}return i.prototype={init:function(){log("Cache Status: "+this.startStatus),window.applicationCache?(window.applicationCache.addEventListener("noupdate",this.onCacheLoadFinished.bind(this)),window.applicationCache.addEventListener("cached",this.onFirstUpdateReady.bind(this)),window.applicationCache.addEventListener("downloading",this.onUpdateDownloading.bind(this)),window.applicationCache.addEventListener("updateready",this.onUpdateReady.bind(this)),window.applicationCache.addEventListener("obsolete",this.onCacheLoadFinished.bind(this)),window.applicationCache.addEventListener("error",this.onUpdateError.bind(this)),window.applicationCache.status>=window.applicationCache.UPDATEREADY||document.documentElement.attributes.getNamedItem("manifest")||this.onCacheLoadFinished()):this.onCacheLoadFinished()},isVisible:function(e){e&&(t.isDemoMode()?t.reload():t.messageQueue.pushMessage(MessageID.Updated))},update:function(){window.applicationCache.status===window.applicationCache.IDLE&&applicationCache.update()},checkForUpdate:function(e){this.requiredUpdate=!!e,this.appUpdatePending||(this.dynamicUpdateCheck=!0,this.update())},runOnFinish:function(e){this.isFinished?setTimeout(e,0):this.fnToRun.push(e)},onUpdateReady:function(){log("Cache: New version available"),this.appUpdatePending=!0,this.startStatus===window.applicationCache.UNCACHED&&log("Cache Update from UNCACHED state. ERROR."),this.onCacheLoadFinished(),this.updateAction()},onFirstUpdateReady:function(){log("Cache: first update")},onUpdateError:function(e){n.demo||t.vmMain&&!t.vmMain.isOnline()||(log("Update Error: ",e),t.reportError(new Error("Error during app update"),e)),this.isVisible(!1),this.onCacheLoadFinished()},onUpdateDownloading:function(){log("Cache: New version downloading")},onCacheLoadFinished:function(){if(log("Cache: No update"),!this.isFinished){this.isFinished=!0;for(var e=0;e<this.fnToRun.length;++e)this.fnToRun[e]()}},notifyOfUpdate:function(){this.notifiedOfNew||(this.notifiedOfNew=!0,t.setAppCacheUpdateState(!0),this.startStatus!==window.applicationCache.UNCACHED&&(t.StopSpinner(),this.isVisible(!0)))},updateAction:function(){this.requiredUpdate?t.messageQueue.pushMessage(MessageID.RequiredUpdate):this.isVisible(!0),t.sendEvent("AppCache","Update")}},i}),Error.stackTraceLimit=150;try{window.__checkpoints|=1,window.__SESSION_ID=Math.round(1e4*Math.random())+"|"+Date.now(),window.appEvents=window.appEvents||{kbsize:function(){},enterBackground:function(){},enterForeground:function(){},statusBarTap:function(){},closeKeyboard:function(){},undo:function(){},redo:function(){},reportLowMemory:function(){}},window.log=console.log.bind(console),window.performance&&window.performance.now?window.log.now=function(){return window.performance.now()-window.log.start}:(window.performance={now:function(){return Date.now()-window.log.start}},window.log.now=performance.now),window.log.start=window.performance.now(),console.timeStamp||(Object.defineProperty?Object.defineProperty(console,"timeStamp",{value:function(){}}):console.timeStamp=function(){}),console.time||(Object.defineProperty?Object.defineProperty(console,"time",{value:function(){}}):console.time=function(){}),console.timeEnd||(Object.defineProperty?Object.defineProperty(console,"timeEnd",{value:function(){}}):console.timeEnd=function(){}),console.trace||(Object.defineProperty?Object.defineProperty(console,"trace",{value:function(){}}):console.trace=function(){}),window.LogLevels={Off:0,Error:1,Warning:2,Timing:4,Data:8,Status:16,Search:32,Timeline:64,Input:128,Tracker:256,Profile:512,PageLoad:1024,Toolbar:2048,Picker:4096,Intro:8192,Import:16384,Version:32768,Settings:65536,Selection:131072,ScrMgr:262144,Verbose:524288},window.LogLevel=LogLevels.Error|LogLevels.Warning,window.ShouldLog=function(e){return window.DEBUG===e},window.logIf=function(){var e=Array.prototype.slice.call(arguments);ShouldLog&&(e.splice(0,1),window.log.apply(this,e))},window.inspectLocal=function(e){if(!e)return void log("Must specify either an item ID or item object to inspect");var t=e;return"string"==typeof e&&(t=window.getModel(e)),log("---- Inspecting Item:",t.id,"----"),log("  RawText:",t.getRawText()),log("  ParsedText:",t.getParsedText()),log("  StyledText:",t.getStyledText()),log('  Parent: "'+t.parent().id+'"'),log("  Date:",t.date()),log("  AllDayDate:",t.allDayDate),log("--------------------------------------------"),t}}catch(err){console.log("Error in main header",err),window.__ERRORINMAINHEADER=err}!function(){var e,e={paths:{ko:"lib/knockout-2.3.0.custom",date:"lib/date",FileSaver:"lib/FileSaver",IndexedDBShim:"lib/IndexedDBShim.min",db:"lib/db"},waitSeconds:0};require.config(e)}(),window.gapiKey="AIzaSyB9HEdSJ-nhLJG_ssSSqhI2DX74GSiKSao",window.location.hash.indexOf("gtest=true")>=0&&(log("Loading DEBUG version of RealtimeAPI"),window.___gcfg={"drive-realtime":{server:"https://drive.sandbox.google.com/otservice"}});var gapiCalled=!1,gapiLoadError=!1;requirejs(["ko","data","globals","util","gdata","goog","platform","android","edit","VMMain","VMSetup","VMDebug","VMTimeline","VMSearch","VMMessageQueue","TemplateCache","VMAutocomplete","VMMenus","ScreenManager","VMTooltip","AppCache","DuchessHelpers"],function(e,t,n,i,o,r,a,s,d,c,l,u,h,p,f,m,g,v,y,b,S){n.checkpoint(Checkpoint.RequireLoaded),window.__ERRORINMAINHEADER&&n.reportError(window.__ERRORINMAINHEADER),n.runOnLoad(function(){function e(e){document.documentElement.addEventListener(e,function(e){n.reportEvent(e)},!0),document.documentElement.addEventListener(e,function(e){},!1)}function o(){return n.requestNotification(navigator.userAgent)}function p(){n.AppCache.runOnFinish(function(){n.reload()},!0)}function m(){a.updateOrientation(),a.mobile&&(n.keyboardToolbar&&n.keyboardToolbar.isVisible()&&n.keyboardToolbar.updatePosition(!0),document.body.scrollTop=0),a.mobile&&n.keyboardToolbar&&n.keyboardToolbar.hideTopBarIfLandscape()}function T(){R||(R=!0,n.checkpoint(Checkpoint.InitializeMain),n.openMainPage(),n.registerEvent("ItemCreated","ItemAction","Create"),n.registerEvent("ItemCompleted","ItemAction","Complete"),t.initData(w),w())}function w(){try{if(_||!R||!t.localDataLoaded())return;_=!0,n.checkpoint(Checkpoint.OnInitializedData),r.loadClientDefaultFile(),n.isDemoMode()?n.isDisplayModeActive(DisplayMode.NoDemoSidebar)||a.script||(n.vmMain.openSidebar(),setTimeout(function(){n.highlightElement(document.getElementById("logoutButton"),.6,1)},0)):n.vmMain.setupDateRollover(),n.vmMain.loadData(),n.timeline.load(),n.StopSpinner(),setTimeout(function(){n.menus&&n.menus.bind(),n.autocomplete||(n.autocomplete=new g)})}catch(e){n.reportError(e)}}function M(e){return(a.mac&&e.metaKey||!a.mac&&e.ctrlKey)&&e.normCode==KeyCode.A}try{if(n.checkpoint(Checkpoint.PageLoad),"loading"===document.readyState){var C="ERROR: MainJS running before document load! "+document.readyState;ShouldLog(LogLevels.Error)&&log(C),n.reportError(new Error(C))}for(var x in window.scriptErrors)n.fireCustomEvent("scriptLoadError",{src:x,id:window.scriptErrors[x],firstChance:!0});if(window.handleLoadError=function(e){try{window.scriptErrors[e.target.src]=e.target.id,n.fireCustomEvent("scriptLoadError",{src:e.target.src,id:e.target.id,firstChance:!1})}catch(t){n.reportError(t)}},window.oncontextmenu=function(e){e.preventDefault()},a.demo&&(n.messageQueue||(n.messageQueue=new f),n.enableDemoMode()),n.isDemoMode()){var I=i.getURLParam("panes");I&&(n.demoPanes=I.split(":"))}else n.removeDOM("preventInteraction");setTimeout(function(){n.sendEvent("PageLoad","NewPage")},0),e("keydown"),e("keyup"),e("keypress"),e("MSPointerDown"),e("MSPointerUp"),e("MSPointerHover"),e("MSPointerCancel"),e("mousedown"),e("mouseup"),e("touchstart"),e("touchend"),n.messageQueue||(n.messageQueue=new f),n.tooltip=new b,n.AppCache=new S,n.StartSpinner();var E=a.blockClient();if(void 0!==E){var k,D=!1;return E.platform?E.update?"Firefox"==E.platform?k='Please update your Firefox browser to use Moo.do. Moo.do requires at least Firefox 16. See <a href="https://support.mozilla.org/en-US/kb/update-firefox-latest-version">https://support.mozilla.org/en-US/kb/update-firefox-latest-version</a> for more information.':"Chrome"==E.platform?k='Please update your Chrome browser to use Moo.do. Moo.do requires at least Chrome 26. See <a href="https://support.google.com/chrome/answer/95414">https://support.google.com/chrome/answer/95414</a> for more information.':"Native Android"==E.platform?k="Please update your Android device to use Moo.do. Moo.do requires at least Android 2.1.":"Internet Explorer"==E.platform?k='Please update your Internet Explorer browser to use Moo.do. Moo.do requires at least Internet Explorer 10. See <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie">http://windows.microsoft.com/en-us/internet-explorer/download-ie</a> for more information.':"Safari"==E.platform?k=a.mobile?"Please update your "+a.OSName+" to use Moo.do. Moo.do requires at least iOS 6.":'Please update your Safari browser to use Moo.do. Moo.do requires at least Safari 6.1. See <a href="http://support.apple.com/kb/HT6103">http://support.apple.com/kb/HT6103</a> for more information.':(k="Please update your browser to use Moo.do. If you are unable to update your browser, please let us know. Thanks!",D=!0):(D=!0,k="Sorry, we don't support "+E.platform+" yet. Please let us know that you're interested in using "+E.platform+" and we will make it a higher priority. Thanks!"):E.version?k="Please update to the latest version of this app by opening the TestFlight app and installing the latest version. Thanks!":E.cacheUpdate&&(k="There was an issue while updating the app, "+a.actionVerb()+" to try again.",n.AppCache.update(),E.error&&n.AppCache.runOnFinish(function(){i.insertURLParam("cacheError",!0)},!0)),k&&n.applyBindings({platformError:k,showSignup:D,onTapRefresh:p,onTapSubmit:o},"OSError"),n.StopSpinner(),n.removeDOM("outerWrapper"),n.removeDOM("setupWrapper"),void n.removeDOM("templates")}i.removeURLParam("cacheError",!0),n.removeDOM("OSError"),n.localDocChangeRequested=!1,n.settings.initEvents(function(e){if("localSettings"===e.key){var t;e.oldValue&&(t=JSON.parse(e.oldValue));var i;e.newValue&&(i=JSON.parse(e.newValue)),t&&i&&!n.localDocChangeRequested&&t.gdocId&&t.gdocId!==i.gdocId&&(n.messageQueue.pushMessage(MessageID.DocChange),setTimeout(function(){n.reload()},1e4))}}),n.ScreenManager=new y(document.getElementById("main")),n.menus=new v,n.vmDebug=new u,window.addEventListener("remoteDataLoaded",function(){var e=i.getURLParam("file"),t=i.getURLParam("state");if(e||t){if(!e)try{var o=JSON.parse(t);"open"===o.action&&o.ids&&o.ids.length>=0&&(e=o.ids[0])}catch(s){n.reportError(s)}var d=r.getDocId();e&&d!==e&&n.messageQueue.pushMessage({text:"You have requested to view another document. "+a.actionVerbCaps()+" here to open it.",type:MessageType.Info,action:function(){n.vmMain.vmPicker.requestOpenDocument(e)}})}});var P=function(e){var t=window.innerWidth,i=window.innerHeight,o=a.windowWidth(),r=a.windowHeight();if(a.ipad&&!a.app&&e!==!0&&e!==!1&&setTimeout(P,0,!0),(t!=o||i!=r&&i!=r+60)&&(n.smallMode=480>=t,a.windowWidth(t),a.windowHeight(i),n.documentHeight=i,n.isMainPageOpen)){var s=i-r,d=(a.android||a.mobileie)&&i>r&&(!a.app||s<=a.kbsize)&&n.vmMain&&n.vmMain.isLoaded;if(d&&n.blurActiveElement(),a.iphone&&!a.standalone&&!a.app&&!a.ios7){var c=document.documentElement.clientHeight+60;document.documentElement.style.height=c+"px",setTimeout(n.enforceScroll,0)}n.autocomplete&&d&&n.autocomplete.hide(),o!==t&&e&&a.mobile&&(n.ScreenManager&&n.ScreenManager.onResize(),n.menus&&n.menus.onResize()),a.mobile||n.fireCustomEvent("windowResize")}};if(P(!1),m(),!n.isDemoMode()&&(!a.offline&&window.gapi&&window.gapi.auth&&!gapiCalled&&GoogleApiLoaded(),a.mobile&&!a.app)){var L=a.actionVerbCaps()+" to get the app from the app store.";void 0!==a.appStoreLink&&n.messageQueue.pushMessage({text:L,type:MessageType.InfoGray,action:MessageAction.OpenURL,data:{url:a.appStoreLink}})}if(a.mobile?(n.removeDOM("desktopMenu"),n.removeDOM("desktopSidebar"),n.removeDOM("contextMenuItem"),n.removeDOM("contextMenuLink"),n.removeDOM("exportData")):(n.removeDOM("phoneMenu"),n.removeDOM("mobileKeyboardToolbar"),n.removeDOM("paneSettings"),a.touch||(n.removeDOM("itemMenuPhone"),n.removeDOM("rightMenuPhone"))),window.onblur=function(){n.hasFocus=!1},window.onfocus=function(){n.hasFocus=!0,r.onFocusHandler()},new c,n.timeline=new h,window.addEventListener("resize",P),window.addEventListener("orientationchange",P),window.addEventListener("orientationchange",m),document.addEventListener("focusout",function(e){a.ios&&a.app&&n.fireCustomEvent("closeKeyboard")},!0),a.mobileie){document.addEventListener("focusin",function(e){"HTML"===e.target.tagName&&(s.isEnabled()?s.isVisible()?s.finishInput(!1):n.vmSearchPhone&&n.vmSearchPhone.isFocused()&&n.vmSearchPhone.onblur():log("Skipping Close - Not Android"))});var O,A=0;window.addEventListener("scroll",function(){A=Date.now(),O||(O=setInterval(function(){Date.now()-A>5e3&&(clearInterval(O),O=void 0),window.scrollTo(0,0)},15))})}window.addEventListener("dragstart",function(e){return e.preventDefault(),!1}),window.addEventListener("drop",function(e){return e.preventDefault(),!1});var R=!1,_=!1;n.vmSetup=new l,n.vmSetup.loginState.subscribe(function(e){e==LoginState.LOGGED_IN?(T(),n.openMainPage()):e==LoginState.LOGGED_OUT&&(n.isSetupPageOpen||(n.isSetupPageOpen=!0,i.hasURLParam("login","true")||n.openSetupPage(),n.vmSetup.openLogin())),n.vmMain.setGDriveStatus(a.offline||!navigator.onLine?DriveStatus.Offline:DriveStatus.Connecting)}),n.vmSetup.init(),n.isDemoMode()&&T();var N=n.getLoginState();if(N!=LoginState.LOGGED_OUT?t.initData(T):!n.isDemoMode()&&a.app&&a.sendToApp("loaded"),!a.mobile){var F={},V=function(){var e=n.focusedPane||n.vmMain.panes()[0];e&&(e.vmSearch.isFocused()||n.saveSelection("StoredSearch"),n.selectElement(e.vmSearch.elSearch,!1),n.sendEvent("Hotkey","Search"))},B=function(){n.focusedPane.toggleOutlineVisibility(),n.sendEvent("Hotkey","Outline")},U=function(){var e=n.getSelectedItem();if(e){for(var t=0;t<e.elements.length;++t)n.scrollIntoView(e.getSpan(t),200);e.highlight()}n.sendEvent("Hotkey","GoTo")},q=function(){n.vmMain.applyPriorityToSelection(VMLIFlag.P0,!0),n.sendEvent("Hotkey","Important")},H=function(){n.vmMain.applyPriorityToSelection(VMLIFlag.P1,!0),n.sendEvent("Hotkey","Important")},W=function(){n.vmMain.applyPriorityToSelection(VMLIFlag.P2,!0),n.sendEvent("Hotkey","Important")},K=function(){n.vmMain.applyFnToSelection("isStarred",!0),n.sendEvent("Hotkey","Star")},j=function(){n.vmMain.applyFnToSelection("isComplete",!0),n.sendEvent("Hotkey","Complete")},z=function(){n.vmMain.applyToSelection(function(e){return n.vmMain.zoomin(e),!1}),n.sendEvent("Hotkey","ZoomIn")},G=function(){if(n.focusedItem&&n.focusedItem.parent()){var e=n.focusedItem;n.vmMain.zoomout(e.parent(),e)}n.sendEvent("Hotkey","ZoomOut")},Y=function(){n.vmMain.applyToSelection(function(e){n.focusedPane.isTimeline()||e.toggleCollapsed()}),n.sendEvent("Hotkey","Collapse")},X=function(e){e.target!=document.body&&(n.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!1}),n.sendEvent("Hotkey","Indent"))},J=function(e){e.target!=document.body&&(n.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!0}),n.sendEvent("Hotkey","Unindent"))},$=function(){},Q=function(e){return e.target!=document.body?!1:void 0},Z=function(e){var t=n.enumToString(KeyCode,e.normCode);return t?n.fireCustomEvent("key"+t):void n.sendEvent("Hotkey","FireEvent_"+t)},et=function(){n.vmMain.removeFocusPane()};F[KeyCode.E]=F[KeyCode.F]=[{mods:{0:!0},call:V},{mods:{2:!0},call:V}],F[KeyCode.G]=[{mods:{0:!0},call:U},{mods:{2:!0},call:U}],F[KeyCode.O]=[{mods:{0:!0},call:B},{mods:{2:!0},call:B}],F[KeyCode.Slash]=[{mods:{0:!0},call:j},{mods:{2:!0},call:j}],F[KeyCode.D1]=[{mods:{0:!0},call:q},{mods:{2:!0},call:q}],F[KeyCode.D2]=[{mods:{0:!0},call:H},{mods:{2:!0},call:H}],F[KeyCode.D3]=[{mods:{0:!0},call:W},{mods:{2:!0},call:W}],F[KeyCode.D8]=[{mods:{0:!0},call:K},{mods:{2:!0},call:K}],F[KeyCode.B]=[{mods:{0:!0},call:$},{mods:{2:!0},call:$}],F[KeyCode.I]=[{mods:{0:!0},call:$},{mods:{2:!0},call:$}],F[KeyCode.U]=[{mods:{0:!0},call:$},{mods:{2:!0},call:$}],F[KeyCode.S]=[{mods:{0:!0},call:$},{mods:{2:!0},call:$}],F[KeyCode.Enter]=[{mods:{0:!0,4:!0},call:G},{mods:{2:!0,4:!0},call:G},{mods:{0:!0},call:z},{mods:{2:!0},call:z}],F[KeyCode.Comma]=[{mods:{0:!0},call:Y},{mods:{2:!0},call:Y}],F[KeyCode.Period]=[{mods:{0:!0},call:Y},{mods:{2:!0},call:Y}],F[KeyCode.LBracket]=[{mods:{0:!0},call:J},{mods:{2:!0},call:J}],F[KeyCode.RBracket]=[{mods:{0:!0},call:X},{mods:{2:!0},call:X}],F[KeyCode.Escape]=[{call:Z}],F[KeyCode.F4]=[{mods:{4:!0},call:et}],F[KeyCode.BackSpace]=[{call:Q}],n.globalKeyDown=function(e){var t=F[e.normCode];if(t)if(n.isFunction(t))t(e);else{for(var i,o=0;o<t.length;o++)if(!(t[o].mods&&(t[o].mods[0]&&!e.ctrlKey||t[o].mods[1]&&!e.optKey||t[o].mods[2]&&!e.metaKey||t[o].mods[3]&&!e.altKey||t[o].mods[4]&&!e.shiftKey))){i=t[o];break}if(i){var r=i.call(e);if(r!==!1)return e.handled=!0,e.preventDefault(),!1}}else e.normCode===KeyCode.Ctrl&&n.vmMain.updateCursor(!0);if(a.android&&e.srcElement===document.body){if(M(e))return e.preventDefault(),!1;d.keydown(null,e)}},n.globalKeyUp=function(e){a.normalizeKeys(e),e.normCode===KeyCode.Ctrl&&n.vmMain.updateCursor(!1)},document.addEventListener("keydown",n.globalKeyDown),document.addEventListener("keyup",n.globalKeyUp,!0)}}catch(tt){n.reportError(tt),n.handleCriticalError()}})}),define("main",function(){});
//# sourceMappingURL=main-min.js.map