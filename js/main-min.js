function GoogleApiLoaded(){if(!gapiCalled){if(gapiCalled=!0,gapi.auth.init(),window.location.hash.indexOf("offline=true")>=0||window.location.hash.indexOf("offline%22:true")>=0||window.location.hash.indexOf('offline":true')>=0||window.location.hash.indexOf("demo=true")>=0)return void log("%cOffline","color: pink");ShouldLog(LogLevels.Timing)&&log("GAPI Callback - Loaded:",log.now()),gapi.client.setApiKey(window.gapiKey),require(["globals"],function(g){g.loadGoogleAPI("drive","v2",function(){g.vmMain&&g.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.DriveAPI)})}),require(["globals"],function(g){g.vmMain&&g.vmMain.pluginManager&&g.vmMain.pluginManager.isAuthorized(PluginID.Gmail)&&g.loadGoogleAPI("gmail","v1",function(){g.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.GmailAPI)})}),gapi.load("drive-realtime",function(){ShouldLog(LogLevels.Timing)&&log("Drive-Realtime API - Loaded: ",window.performance.now()),gapi&&gapi.drive&&gapi.drive.realtime?require(["globals","goog"],function(g,goog){goog.loadClientDefaultFile(),g.removeDOM("blockedError")}):require(["globals","platform"],function(g,platform){var errorString;errorString=gapi?gapi.drive?gapi.drive.realtime?"all exist":"gapi.drive.realtime":"gapi.drive":"gapi",gapiCalled=!1,gapiLoadError=!0,g.reportError(new Error("Drive returned load, but unable to load "+errorString));var msgEle=document.getElementById("blockedMessage");msgEle.innerText=platform.app?"There was an error loading the Google APIs, "+platform.actionVerb()+" to try again.":"You may be running an extension that blocked drive.google.com from loading, Moo.do requires access to function correctly. Please re-load the page if you are not using an extension and the issue will resolve itself.";var errEle=document.getElementById("blockedError");g.removeClass(errEle,"none"),errEle.addEventListener("mousedown",function(){g.reload()}),g.vmMain&&g.vmMain.gdriveStatus(DriveStatus.Offline)}),require(["globals"],function(g){g.fireCustomEvent("gapiDriveLoaded")})}),require(["globals","util","platform","goog","VMSetup","data"],function(g,util,platform,goog,VMSetup,d){ShouldLog(LogLevels.Timing)&&log("Goog Callback - Loaded: ",log.now()),g.fireCustomEvent("gapiLoaded");var setTokenFromHash=!1;(!platform.ie||platform.mobile)&&(setTokenFromHash=goog.checkTokenInHash());var hasLoginParam=util.hasURLParam("login","true"),hasUserParam=util.hasURLParam("user"),doLogin=setTokenFromHash||hasLoginParam||hasUserParam||g.getLoginState()==LoginState.LOGGED_IN,skipLogin=!1;if(hasUserParam){var forceUser=util.getURLParam("user"),activeUser=g.settings.get(Settings.activeUser);util.removeURLParam("user",!0),forceUser!==activeUser&&(g.settings.set(Settings.activeUser,forceUser),void 0!==activeUser&&(d.clearData(function(){g.reload()},{Default:[Settings.activeUser]}),skipLogin=!0))}skipLogin||goog.runAuthenticate(goog.requestScopes,!0,!1,function(token){ShouldLog(LogLevels.Timing)&&log("Goog Authorized - Callback: ",log.now()),hasLoginParam&&util.removeURLParam("login",!0),token&&!token.error?(doLogin&&(g.vmSetup?g.vmSetup.setLoginState(LoginState.LOGGED_IN):g.setLoginState(LoginState.LOGGED_IN),goog.loadClientDefaultFile(),g.openMainPage()),goog.ensureRequiredScopesAreRequested()):goog.requiredScopes!==goog.requestScopes?(g.settings.reset(Settings.authScopes),goog.runAuthenticate(goog.requiredScopes,!0,!1,function(token2){token2&&!token2.error?doLogin&&(g.vmSetup?g.vmSetup.setLoginState(LoginState.LOGGED_IN):g.setLoginState(LoginState.LOGGED_IN),goog.loadClientDefaultFile(),g.runOnLoad(function(){g.openMainPage()})):(g.vmSetup?g.vmSetup.setLoginState(LoginState.LOGGED_OUT):g.setLoginState(LoginState.LOGGED_OUT),g.runOnLoad(function(){g.openSetupPage()}))})):(g.vmSetup?g.vmSetup.setLoginState(LoginState.LOGGED_OUT):g.setLoginState(LoginState.LOGGED_OUT),g.runOnLoad(function(){g.openSetupPage()}))})})}}var requirejs,require,define;!function(undef){function hasProp(obj,prop){return hasOwn.call(obj,prop)}function normalize(name,baseName){var nameParts,nameSegment,mapValue,foundMap,lastIndex,foundI,foundStarMap,starI,i,j,part,baseParts=baseName&&baseName.split("/"),map=config.map,starMap=map&&map["*"]||{};if(name&&"."===name.charAt(0))if(baseName){for(baseParts=baseParts.slice(0,baseParts.length-1),name=name.split("/"),lastIndex=name.length-1,config.nodeIdCompat&&jsSuffixRegExp.test(name[lastIndex])&&(name[lastIndex]=name[lastIndex].replace(jsSuffixRegExp,"")),name=baseParts.concat(name),i=0;i<name.length;i+=1)if(part=name[i],"."===part)name.splice(i,1),i-=1;else if(".."===part){if(1===i&&(".."===name[2]||".."===name[0]))break;i>0&&(name.splice(i-1,2),i-=2)}name=name.join("/")}else 0===name.indexOf("./")&&(name=name.substring(2));if((baseParts||starMap)&&map){for(nameParts=name.split("/"),i=nameParts.length;i>0;i-=1){if(nameSegment=nameParts.slice(0,i).join("/"),baseParts)for(j=baseParts.length;j>0;j-=1)if(mapValue=map[baseParts.slice(0,j).join("/")],mapValue&&(mapValue=mapValue[nameSegment])){foundMap=mapValue,foundI=i;break}if(foundMap)break;!foundStarMap&&starMap&&starMap[nameSegment]&&(foundStarMap=starMap[nameSegment],starI=i)}!foundMap&&foundStarMap&&(foundMap=foundStarMap,foundI=starI),foundMap&&(nameParts.splice(0,foundI,foundMap),name=nameParts.join("/"))}return name}function makeRequire(relName,forceSync){return function(){var args=aps.call(arguments,0);return"string"!=typeof args[0]&&1===args.length&&args.push(null),req.apply(undef,args.concat([relName,forceSync]))}}function makeNormalize(relName){return function(name){return normalize(name,relName)}}function makeLoad(depName){return function(value){defined[depName]=value}}function callDep(name){if(hasProp(waiting,name)){var args=waiting[name];delete waiting[name],defining[name]=!0,main.apply(undef,args)}if(!hasProp(defined,name)&&!hasProp(defining,name))throw new Error("No "+name);return defined[name]}function splitPrefix(name){var prefix,index=name?name.indexOf("!"):-1;return index>-1&&(prefix=name.substring(0,index),name=name.substring(index+1,name.length)),[prefix,name]}function makeConfig(name){return function(){return config&&config.config&&config.config[name]||{}}}var main,req,makeMap,handlers,defined={},waiting={},config={},defining={},hasOwn=Object.prototype.hasOwnProperty,aps=[].slice,jsSuffixRegExp=/\.js$/;makeMap=function(name,relName){var plugin,parts=splitPrefix(name),prefix=parts[0];return name=parts[1],prefix&&(prefix=normalize(prefix,relName),plugin=callDep(prefix)),prefix?name=plugin&&plugin.normalize?plugin.normalize(name,makeNormalize(relName)):normalize(name,relName):(name=normalize(name,relName),parts=splitPrefix(name),prefix=parts[0],name=parts[1],prefix&&(plugin=callDep(prefix))),{f:prefix?prefix+"!"+name:name,n:name,pr:prefix,p:plugin}},handlers={require:function(name){return makeRequire(name)},exports:function(name){var e=defined[name];return"undefined"!=typeof e?e:defined[name]={}},module:function(name){return{id:name,uri:"",exports:defined[name],config:makeConfig(name)}}},main=function(name,deps,callback,relName){var cjsModule,depName,ret,map,i,args=[],callbackType=typeof callback,usingExports;if(relName=relName||name,"undefined"===callbackType||"function"===callbackType){for(deps=!deps.length&&callback.length?["require","exports","module"]:deps,i=0;i<deps.length;i+=1)if(map=makeMap(deps[i],relName),depName=map.f,"require"===depName)args[i]=handlers.require(name);else if("exports"===depName)args[i]=handlers.exports(name),usingExports=!0;else if("module"===depName)cjsModule=args[i]=handlers.module(name);else if(hasProp(defined,depName)||hasProp(waiting,depName)||hasProp(defining,depName))args[i]=callDep(depName);else{if(!map.p)throw new Error(name+" missing "+depName);map.p.load(map.n,makeRequire(relName,!0),makeLoad(depName),{}),args[i]=defined[depName]}ret=callback?callback.apply(defined[name],args):void 0,name&&(cjsModule&&cjsModule.exports!==undef&&cjsModule.exports!==defined[name]?defined[name]=cjsModule.exports:ret===undef&&usingExports||(defined[name]=ret))}else name&&(defined[name]=callback)},requirejs=require=req=function(deps,callback,relName,forceSync,alt){if("string"==typeof deps)return handlers[deps]?handlers[deps](callback):callDep(makeMap(deps,callback).f);if(deps&&!deps.splice){if(config=deps,config.deps&&req(config.deps,config.callback),!callback)return;callback.splice?(deps=callback,callback=relName,relName=null):deps=undef}return callback=callback||function(){},"function"==typeof relName&&(relName=forceSync,forceSync=alt),forceSync?main(undef,deps,callback,relName):setTimeout(function(){main(undef,deps,callback,relName)},4),req},req.config=function(cfg){return req(cfg)},requirejs._defined=defined,define=function(name,deps,callback){if("string"!=typeof name)throw new Error("Incorrect module build - no module name");deps&&deps.splice||(callback=deps,deps=[]),hasProp(defined,name)||hasProp(waiting,name)||(waiting[name]=[name,deps,callback])},define.amd={jQuery:!0}}(),define("lib/almond",function(){}),function(){!function(p){var s=this||(0,eval)("this"),v=s.document,L=s.navigator,w=s.jQuery,D=s.JSON;!function(p){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?p(module.exports||exports,require):"function"==typeof define&&define.amd?define("ko",["exports","require"],p):p(s.ko={})}(function(M,N){function H(a,d){return null===a||typeof a in R?a===d:!1}function S(a,d){var c;return function(){c||(c=setTimeout(function(){c=p,a()},d))}}function T(a,d){var c;return function(){clearTimeout(c),c=setTimeout(a,d)}}function I(b,d,c,e){a.d[b]={init:function(b,h,k,f,m){var l,q;return a.s(function(){var f=a.a.c(h()),k=!c!=!f,z=!q;(z||d||k!==l)&&(z&&a.Y.la()&&(q=a.a.ia(a.f.childNodes(b),!0)),k?(z||a.f.T(b,a.a.ia(q)),a.Ca(e?e(m,f):m,b)):a.f.ja(b),l=k)},null,{o:b}),{controlsDescendantBindings:!0}}},a.h.ha[b]=!1,a.f.Q[b]=!0}var a="undefined"!=typeof M?M:{};a.b=function(b,d){for(var c=b.split("."),e=a,g=0;g<c.length-1;g++)e=e[c[g]];e[c[c.length-1]]=d},a.A=function(a,d,c){a[d]=c},a.version="3.2.0",a.b("version",a.version),a.a=function(){function b(a,b){for(var c in a)a.hasOwnProperty(c)&&b(c,a[c])}function d(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function c(a,b){return a.__proto__=b,a}var e={__proto__:[]}instanceof Array,g={},h={};g[L&&/Firefox\/2/i.test(L.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],g.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),b(g,function(a,b){if(b.length)for(var c=0,d=b.length;d>c;c++)h[b[c]]=a});var k={propertychange:!0},f=v&&function(){for(var a=3,b=v.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",c[0];);return a>4?a:p}();return{vb:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],u:function(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)},m:function(a,b){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(a,b);for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},qb:function(a,b,c){for(var d=0,f=a.length;f>d;d++)if(b.call(c,a[d],d))return a[d];return null},ua:function(m,b){var c=a.a.m(m,b);c>0?m.splice(c,1):0===c&&m.shift()},rb:function(m){m=m||[];for(var b=[],c=0,d=m.length;d>c;c++)0>a.a.m(b,m[c])&&b.push(m[c]);return b},Da:function(a,b){a=a||[];for(var c=[],d=0,f=a.length;f>d;d++)c.push(b(a[d],d));return c},ta:function(a,b){a=a||[];for(var c=[],d=0,f=a.length;f>d;d++)b(a[d],d)&&c.push(a[d]);return c},ga:function(a,b){if(b instanceof Array)a.push.apply(a,b);else for(var c=0,d=b.length;d>c;c++)a.push(b[c]);return a},ea:function(b,c,d){var f=a.a.m(a.a.Xa(b),c);0>f?d&&b.push(c):d||b.splice(f,1)},xa:e,extend:d,za:c,Aa:e?c:d,G:b,na:function(a,b){if(!a)return a;var c={},d;for(d in a)a.hasOwnProperty(d)&&(c[d]=b(a[d],d,a));return c},Ka:function(b){for(;b.firstChild;)a.removeNode(b.firstChild)},oc:function(b){b=a.a.S(b);for(var c=v.createElement("div"),d=0,f=b.length;f>d;d++)c.appendChild(a.R(b[d]));return c},ia:function(b,c){for(var d=0,f=b.length,e=[];f>d;d++){var k=b[d].cloneNode(!0);e.push(c?a.R(k):k)}return e},T:function(b,c){if(a.a.Ka(b),c)for(var d=0,f=c.length;f>d;d++)b.appendChild(c[d])},Lb:function(b,c){var d=b.nodeType?[b]:b;if(0<d.length){for(var f=d[0],e=f.parentNode,k=0,g=c.length;g>k;k++)e.insertBefore(c[k],f);for(k=0,g=d.length;g>k;k++)a.removeNode(d[k])}},ka:function(a,b){if(a.length){for(b=8===b.nodeType&&b.parentNode||b;a.length&&a[0].parentNode!==b;)a.shift();if(1<a.length){var c=a[0],d=a[a.length-1];for(a.length=0;c!==d;)if(a.push(c),c=c.nextSibling,!c)return;a.push(d)}}return a},Nb:function(a,b){7>f?a.setAttribute("selected",b):a.selected=b},cb:function(a){return null===a||a===p?"":a.trim?a.trim():a.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},vc:function(a,b){return a=a||"",b.length>a.length?!1:a.substring(0,b.length)===b},cc:function(a,b){if(a===b)return!0;if(11===a.nodeType)return!1;if(b.contains)return b.contains(3===a.nodeType?a.parentNode:a);if(b.compareDocumentPosition)return 16==(16&b.compareDocumentPosition(a));for(;a&&a!=b;)a=a.parentNode;return!!a},Ja:function(b){return a.a.cc(b,b.ownerDocument.documentElement)},ob:function(b){return!!a.a.qb(b,a.a.Ja)},t:function(a){return a&&a.tagName&&a.tagName.toLowerCase()},n:function(b,c,d){var e=f&&k[c];if(!e&&w)w(b).bind(c,d);else if(e||"function"!=typeof b.addEventListener){if("undefined"==typeof b.attachEvent)throw Error("Browser doesn't support addEventListener or attachEvent");var g=function(a){d.call(b,a)},h="on"+c;b.attachEvent(h,g),a.a.w.da(b,function(){b.detachEvent(h,g)})}else b.addEventListener(c,d,!1)},oa:function(b,c){if(!b||!b.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var d;if("input"===a.a.t(b)&&b.type&&"click"==c.toLowerCase()?(d=b.type,d="checkbox"==d||"radio"==d):d=!1,w&&!d)w(b).trigger(c);else if("function"==typeof v.createEvent){if("function"!=typeof b.dispatchEvent)throw Error("The supplied element doesn't support dispatchEvent");d=v.createEvent(h[c]||"HTMLEvents"),d.initEvent(c,!0,!0,s,0,0,0,0,0,!1,!1,!1,!1,0,b),b.dispatchEvent(d)}else if(d&&b.click)b.click();else{if("undefined"==typeof b.fireEvent)throw Error("Browser doesn't support triggering events");b.fireEvent("on"+c)}},c:function(b){return a.C(b)?b():b},Xa:function(b){return a.C(b)?b.v():b},Ba:function(b,c,d){if(c){var f=/\S+/g,e=b.className.match(f)||[];a.a.u(c.match(f),function(b){a.a.ea(e,b,d)}),b.className=e.join(" ")}},bb:function(b,c){var d=a.a.c(c);(null===d||d===p)&&(d="");var f=a.f.firstChild(b);!f||3!=f.nodeType||a.f.nextSibling(f)?a.f.T(b,[b.ownerDocument.createTextNode(d)]):f.data=d,a.a.fc(b)},Mb:function(a,b){if(a.name=b,7>=f)try{a.mergeAttributes(v.createElement("<input name='"+a.name+"'/>"),!1)}catch(c){}},fc:function(a){f>=9&&(a=1==a.nodeType?a:a.parentNode,a.style&&(a.style.zoom=a.style.zoom))},dc:function(a){if(f){var b=a.style.width;a.style.width=0,a.style.width=b}},sc:function(b,c){b=a.a.c(b),c=a.a.c(c);for(var d=[],f=b;c>=f;f++)d.push(f);return d},S:function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(a[c]);return b},yc:6===f,zc:7===f,L:f,xb:function(b,c){for(var d=a.a.S(b.getElementsByTagName("input")).concat(a.a.S(b.getElementsByTagName("textarea"))),f="string"==typeof c?function(a){return a.name===c}:function(a){return c.test(a.name)},e=[],k=d.length-1;k>=0;k--)f(d[k])&&e.push(d[k]);return e},pc:function(b){return"string"==typeof b&&(b=a.a.cb(b))?D&&D.parse?D.parse(b):new Function("return "+b)():null},eb:function(b,c,d){if(!D||!D.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return D.stringify(a.a.c(b),c,d)},qc:function(c,d,f){f=f||{};var e=f.params||{},k=f.includeFields||this.vb,g=c;if("object"==typeof c&&"form"===a.a.t(c))for(var g=c.action,h=k.length-1;h>=0;h--)for(var r=a.a.xb(c,k[h]),E=r.length-1;E>=0;E--)e[r[E].name]=r[E].value;d=a.a.c(d);var y=v.createElement("form");y.style.display="none",y.action=g,y.method="post";for(var p in d)c=v.createElement("input"),c.type="hidden",c.name=p,c.value=a.a.eb(a.a.c(d[p])),y.appendChild(c);b(e,function(a,b){var c=v.createElement("input");c.type="hidden",c.name=a,c.value=b,y.appendChild(c)}),v.body.appendChild(y),f.submitter?f.submitter(y):y.submit(),setTimeout(function(){y.parentNode.removeChild(y)},0)}}}(),a.b("utils",a.a),a.b("utils.arrayForEach",a.a.u),a.b("utils.arrayFirst",a.a.qb),a.b("utils.arrayFilter",a.a.ta),a.b("utils.arrayGetDistinctValues",a.a.rb),a.b("utils.arrayIndexOf",a.a.m),a.b("utils.arrayMap",a.a.Da),a.b("utils.arrayPushAll",a.a.ga),a.b("utils.arrayRemoveItem",a.a.ua),a.b("utils.extend",a.a.extend),a.b("utils.fieldsIncludedWithJsonPost",a.a.vb),a.b("utils.getFormFields",a.a.xb),a.b("utils.peekObservable",a.a.Xa),a.b("utils.postJson",a.a.qc),a.b("utils.parseJson",a.a.pc),a.b("utils.registerEventHandler",a.a.n),a.b("utils.stringifyJson",a.a.eb),a.b("utils.range",a.a.sc),a.b("utils.toggleDomNodeCssClass",a.a.Ba),a.b("utils.triggerEvent",a.a.oa),a.b("utils.unwrapObservable",a.a.c),a.b("utils.objectForEach",a.a.G),a.b("utils.addOrRemoveItem",a.a.ea),a.b("unwrap",a.a.c),Function.prototype.bind||(Function.prototype.bind=function(a){var d=this,c=Array.prototype.slice.call(arguments);return a=c.shift(),function(){return d.apply(a,c.concat(Array.prototype.slice.call(arguments)))}}),a.a.e=new function(){function a(b,h){var k=b[c];if(!k||"null"===k||!e[k]){if(!h)return p;k=b[c]="ko"+d++,e[k]={}}return e[k]}var d=0,c="__ko__"+(new Date).getTime(),e={};return{get:function(c,d){var e=a(c,!1);return e===p?p:e[d]},set:function(c,d,e){(e!==p||a(c,!1)!==p)&&(a(c,!0)[d]=e)},clear:function(a){var b=a[c];return b?(delete e[b],a[c]=null,!0):!1},F:function(){return d++ +c}}},a.b("utils.domData",a.a.e),a.b("utils.domData.clear",a.a.e.clear),a.a.w=new function(){function b(b,d){var f=a.a.e.get(b,c);return f===p&&d&&(f=[],a.a.e.set(b,c,f)),f}function d(c){var e=b(c,!1);if(e)for(var e=e.slice(0),f=0;f<e.length;f++)e[f](c);if(a.a.e.clear(c),a.a.w.cleanExternalData(c),g[c.nodeType])for(e=c.firstChild;c=e;)e=c.nextSibling,8===c.nodeType&&d(c)}var c=a.a.e.F(),e={1:!0,8:!0,9:!0},g={1:!0,9:!0};return{da:function(a,c){if("function"!=typeof c)throw Error("Callback must be a function");b(a,!0).push(c)},Kb:function(d,e){var f=b(d,!1);f&&(a.a.ua(f,e),0==f.length&&a.a.e.set(d,c,p))},R:function(b){if(e[b.nodeType]&&(d(b),g[b.nodeType])){var c=[];a.a.ga(c,b.getElementsByTagName("*"));for(var f=0,m=c.length;m>f;f++)d(c[f])}return b},removeNode:function(b){a.R(b),b.parentNode&&b.parentNode.removeChild(b)},cleanExternalData:function(a){w&&"function"==typeof w.cleanData&&w.cleanData([a])}}},a.R=a.a.w.R,a.removeNode=a.a.w.removeNode,a.b("cleanNode",a.R),a.b("removeNode",a.removeNode),a.b("utils.domNodeDisposal",a.a.w),a.b("utils.domNodeDisposal.addDisposeCallback",a.a.w.da),a.b("utils.domNodeDisposal.removeDisposeCallback",a.a.w.Kb),function(){a.a.ba=function(b){var d;if(w){if(w.parseHTML)d=w.parseHTML(b)||[];else if((d=w.clean([b]))&&d[0]){for(b=d[0];b.parentNode&&11!==b.parentNode.nodeType;)b=b.parentNode;b.parentNode&&b.parentNode.removeChild(b)}}else{var c=a.a.cb(b).toLowerCase();for(d=v.createElement("div"),c=c.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!c.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!c.indexOf("<td")||!c.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],b="ignored<div>"+c[1]+b+c[2]+"</div>","function"==typeof s.innerShiv?d.appendChild(s.innerShiv(b)):d.innerHTML=b;c[0]--;)d=d.lastChild;d=a.a.S(d.lastChild.childNodes)}return d},a.a.$a=function(b,d){if(a.a.Ka(b),d=a.a.c(d),null!==d&&d!==p)if("string"!=typeof d&&(d=d.toString()),w)w(b).html(d);else for(var c=a.a.ba(d),e=0;e<c.length;e++)b.appendChild(c[e])}}(),a.b("utils.parseHtmlFragment",a.a.ba),a.b("utils.setHtml",a.a.$a),a.D=function(){function b(c,d){if(c)if(8==c.nodeType){var g=a.D.Gb(c.nodeValue);null!=g&&d.push({bc:c,mc:g})}else if(1==c.nodeType)for(var g=0,h=c.childNodes,k=h.length;k>g;g++)b(h[g],d)}var d={};return{Ua:function(a){if("function"!=typeof a)throw Error("You can only pass a function to ko.memoization.memoize()");var b=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return d[b]=a,"<!--[ko_memo:"+b+"]-->"},Rb:function(a,b){var g=d[a];if(g===p)throw Error("Couldn't find any memo with ID "+a+". Perhaps it's already been unmemoized.");try{return g.apply(null,b||[]),!0}finally{delete d[a]}},Sb:function(c,d){var g=[];b(c,g);for(var h=0,k=g.length;k>h;h++){var f=g[h].bc,m=[f];d&&a.a.ga(m,d),a.D.Rb(g[h].mc,m),f.nodeValue="",f.parentNode&&f.parentNode.removeChild(f)}},Gb:function(a){return(a=a.match(/^\[ko_memo\:(.*?)\]$/))?a[1]:null}}}(),a.b("memoization",a.D),a.b("memoization.memoize",a.D.Ua),a.b("memoization.unmemoize",a.D.Rb),a.b("memoization.parseMemoText",a.D.Gb),a.b("memoization.unmemoizeDomNodeAndDescendants",a.D.Sb),a.La={throttle:function(b,d){b.throttleEvaluation=d;var c=null;return a.j({read:b,write:function(a){clearTimeout(c),c=setTimeout(function(){b(a)},d)}})},rateLimit:function(a,d){var c,e,g;"number"==typeof d?c=d:(c=d.timeout,e=d.method),g="notifyWhenChangesStop"==e?T:S,a.Ta(function(a){return g(a,c)})},notify:function(a,d){a.equalityComparer="always"==d?null:H}};var R={undefined:1,"boolean":1,number:1,string:1};a.b("extenders",a.La),a.Pb=function(b,d,c){this.target=b,this.wa=d,this.ac=c,this.Cb=!1,a.A(this,"dispose",this.K)},a.Pb.prototype.K=function(){this.Cb=!0,this.ac()},a.P=function(){a.a.Aa(this,a.P.fn),this.M={}};var G="change",A={U:function(b,d,c){var e=this;c=c||G;var g=new a.Pb(e,d?b.bind(d):b,function(){a.a.ua(e.M[c],g),e.nb&&e.nb()});return e.va&&e.va(c),e.M[c]||(e.M[c]=[]),e.M[c].push(g),g},notifySubscribers:function(b,d){if(d=d||G,this.Ab(d))try{a.k.Ea();for(var c=this.M[d].slice(0),e=0,g;g=c[e];++e)g.Cb||g.wa(b)}finally{a.k.end()}},Ta:function(b){var d=this,c=a.C(d),e,g,h;d.qa||(d.qa=d.notifySubscribers,d.notifySubscribers=function(a,b){b&&b!==G?"beforeChange"===b?d.kb(a):d.qa(a,b):d.lb(a)});var k=b(function(){c&&h===d&&(h=d()),e=!1,d.Pa(g,h)&&d.qa(g=h)});d.lb=function(a){e=!0,h=a,k()},d.kb=function(a){e||(g=a,d.qa(a,"beforeChange"))}},Ab:function(a){return this.M[a]&&this.M[a].length},yb:function(){var b=0;return a.a.G(this.M,function(a,c){b+=c.length}),b},Pa:function(a,d){return!this.equalityComparer||!this.equalityComparer(a,d)},extend:function(b){var d=this;return b&&a.a.G(b,function(b,e){var g=a.La[b];"function"==typeof g&&(d=g(d,e)||d)}),d}};a.A(A,"subscribe",A.U),a.A(A,"extend",A.extend),a.A(A,"getSubscriptionsCount",A.yb),a.a.xa&&a.a.za(A,Function.prototype),a.P.fn=A,a.Db=function(a){return null!=a&&"function"==typeof a.U&&"function"==typeof a.notifySubscribers},a.b("subscribable",a.P),a.b("isSubscribable",a.Db),a.Y=a.k=function(){function b(a){c.push(e),e=a}function d(){e=c.pop()}var c=[],e,g=0;return{Ea:b,end:d,Jb:function(b){if(e){if(!a.Db(b))throw Error("Only subscribable things can act as dependencies");e.wa(b,b.Vb||(b.Vb=++g))}},B:function(a,c,f){try{return b(),a.apply(c,f||[])}finally{d()}},la:function(){return e?e.s.la():void 0},ma:function(){return e?e.ma:void 0}}}(),a.b("computedContext",a.Y),a.b("computedContext.getDependenciesCount",a.Y.la),a.b("computedContext.isInitial",a.Y.ma),a.b("computedContext.isSleeping",a.Y.Ac),a.p=function(b){function d(){return 0<arguments.length?(d.Pa(c,arguments[0])&&(d.X(),c=arguments[0],d.W()),this):(a.k.Jb(d),c)}var c=b;return a.P.call(d),a.a.Aa(d,a.p.fn),d.v=function(){return c},d.W=function(){d.notifySubscribers(c)},d.X=function(){d.notifySubscribers(c,"beforeChange")},a.A(d,"peek",d.v),a.A(d,"valueHasMutated",d.W),a.A(d,"valueWillMutate",d.X),d},a.p.fn={equalityComparer:H};var F=a.p.rc="__ko_proto__";a.p.fn[F]=a.p,a.a.xa&&a.a.za(a.p.fn,a.P.fn),a.Ma=function(b,d){return null===b||b===p||b[F]===p?!1:b[F]===d?!0:a.Ma(b[F],d)},a.C=function(b){return a.Ma(b,a.p)},a.Ra=function(b){return"function"==typeof b&&b[F]===a.p||"function"==typeof b&&b[F]===a.j&&b.hc?!0:!1},a.b("observable",a.p),a.b("isObservable",a.C),a.b("isWriteableObservable",a.Ra),a.b("isWritableObservable",a.Ra),a.aa=function(b){if(b=b||[],"object"!=typeof b||!("length"in b))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return b=a.p(b),a.a.Aa(b,a.aa.fn),b.extend({trackArrayChanges:!0})},a.aa.fn={remove:function(b){for(var d=this.v(),c=[],e="function"!=typeof b||a.C(b)?function(a){return a===b}:b,g=0;g<d.length;g++){var h=d[g];e(h)&&(0===c.length&&this.X(),c.push(h),d.splice(g,1),g--)}return c.length&&this.W(),c},removeAll:function(b){if(b===p){var d=this.v(),c=d.slice(0);return this.X(),d.splice(0,d.length),this.W(),c}return b?this.remove(function(c){return 0<=a.a.m(b,c)}):[]},destroy:function(b){var d=this.v(),c="function"!=typeof b||a.C(b)?function(a){return a===b}:b;this.X();for(var e=d.length-1;e>=0;e--)c(d[e])&&(d[e]._destroy=!0);this.W()},destroyAll:function(b){return b===p?this.destroy(function(){return!0}):b?this.destroy(function(d){return 0<=a.a.m(b,d)}):[]},indexOf:function(b){var d=this();return a.a.m(d,b)},replace:function(a,d){var c=this.indexOf(a);c>=0&&(this.X(),this.v()[c]=d,this.W())}},a.a.u("pop push reverse shift sort splice unshift".split(" "),function(b){a.aa.fn[b]=function(){var a=this.v();return this.X(),this.sb(a,b,arguments),a=a[b].apply(a,arguments),this.W(),a}}),a.a.u(["slice"],function(b){a.aa.fn[b]=function(){var a=this();return a[b].apply(a,arguments)}}),a.a.xa&&a.a.za(a.aa.fn,a.p.fn),a.b("observableArray",a.aa);var J="arrayChange";a.La.trackArrayChanges=function(b){function d(){if(!c){c=!0;var d=b.notifySubscribers;b.notifySubscribers=function(a,b){return b&&b!==G||++g,d.apply(this,arguments)};var f=[].concat(b.v()||[]);e=null,b.U(function(c){if(c=[].concat(c||[]),b.Ab(J)){var d;(!e||g>1)&&(e=a.a.Fa(f,c,{sparse:!0})),d=e,d.length&&b.notifySubscribers(d,J)}f=c,e=null,g=0})}}if(!b.sb){var c=!1,e=null,g=0,h=b.U;b.U=b.subscribe=function(a,b,c){return c===J&&d(),h.apply(this,arguments)},b.sb=function(b,d,m){function l(a,b,c){return q[q.length]={status:a,value:b,index:c}}if(c&&!g){var q=[],h=b.length,t=m.length,z=0;switch(d){case"push":z=h;case"unshift":for(d=0;t>d;d++)l("added",m[d],z+d);break;case"pop":z=h-1;case"shift":h&&l("deleted",b[z],z);break;case"splice":d=Math.min(Math.max(0,0>m[0]?h+m[0]:m[0]),h);for(var h=1===t?h:Math.min(d+(m[1]||0),h),t=d+t-2,z=Math.max(h,t),u=[],r=[],E=2;z>d;++d,++E)h>d&&r.push(l("deleted",b[d],d)),t>d&&u.push(l("added",m[E],d));a.a.wb(r,u);break;default:return}e=q}}}},a.s=a.j=function(b,d,c){function e(){a.a.G(v,function(a,b){b.K()}),v={}}function g(){e(),C=0,u=!0,n=!1}function h(){var a=f.throttleEvaluation;a&&a>=0?(clearTimeout(P),P=setTimeout(k,a)):f.ib?f.ib():k()}function k(b){if(t){if(E)throw Error("A 'pure' computed must not be called recursively")}else if(!u){if(w&&w()){if(!z)return void s()}else z=!1;if(t=!0,y)try{var c={};a.k.Ea({wa:function(a,b){c[b]||(c[b]=1,++C)},s:f,ma:p}),C=0,q=r.call(d)}finally{a.k.end(),t=!1}else try{var e=v,m=C;a.k.Ea({wa:function(a,b){u||(m&&e[b]?(v[b]=e[b],++C,delete e[b],--m):v[b]||(v[b]=a.U(h),++C))},s:f,ma:E?p:!C}),v={},C=0;try{var l=d?r.call(d):r()}finally{a.k.end(),m&&a.a.G(e,function(a,b){b.K()}),n=!1}f.Pa(q,l)&&(f.notifySubscribers(q,"beforeChange"),q=l,!0!==b&&f.notifySubscribers(q))}finally{t=!1}C||s()}}function f(){if(0<arguments.length){if("function"!=typeof O)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return O.apply(d,arguments),this}return a.k.Jb(f),n&&k(!0),q}function m(){return n&&!C&&k(!0),q}function l(){return n||C>0}var q,n=!0,t=!1,z=!1,u=!1,r=b,E=!1,y=!1;if(r&&"object"==typeof r?(c=r,r=c.read):(c=c||{},r||(r=c.read)),"function"!=typeof r)throw Error("Pass a function that returns the value of the ko.computed");var O=c.write,x=c.disposeWhenNodeIsRemoved||c.o||null,B=c.disposeWhen||c.Ia,w=B,s=g,v={},C=0,P=null;d||(d=c.owner),a.P.call(f),a.a.Aa(f,a.j.fn),f.v=m,f.la=function(){return C},f.hc="function"==typeof c.write,f.K=function(){s()},f.Z=l;var A=f.Ta;return f.Ta=function(a){A.call(f,a),f.ib=function(){f.kb(q),n=!0,f.lb(f)}},c.pure?(y=E=!0,f.va=function(){y&&(y=!1,k(!0))},f.nb=function(){f.yb()||(e(),y=n=!0)}):c.deferEvaluation&&(f.va=function(){m(),delete f.va}),a.A(f,"peek",f.v),a.A(f,"dispose",f.K),a.A(f,"isActive",f.Z),a.A(f,"getDependenciesCount",f.la),x&&(z=!0,x.nodeType&&(w=function(){return!a.a.Ja(x)||B&&B()})),y||c.deferEvaluation||k(),x&&l()&&x.nodeType&&(s=function(){a.a.w.Kb(x,s),g()},a.a.w.da(x,s)),f},a.jc=function(b){return a.Ma(b,a.j)},A=a.p.rc,a.j[A]=a.p,a.j.fn={equalityComparer:H},a.j.fn[A]=a.j,a.a.xa&&a.a.za(a.j.fn,a.P.fn),a.b("dependentObservable",a.j),a.b("computed",a.j),a.b("isComputed",a.jc),a.Ib=function(b,d){return"function"==typeof b?a.s(b,d,{pure:!0}):(b=a.a.extend({},b),b.pure=!0,a.s(b,d))},a.b("pureComputed",a.Ib),function(){function b(a,g,h){if(h=h||new c,a=g(a),"object"!=typeof a||null===a||a===p||a instanceof Date||a instanceof String||a instanceof Number||a instanceof Boolean)return a;var k=a instanceof Array?[]:{};return h.save(a,k),d(a,function(c){var d=g(a[c]);switch(typeof d){case"boolean":case"number":case"string":case"function":k[c]=d;break;case"object":case"undefined":var l=h.get(d);k[c]=l!==p?l:b(d,g,h)}}),k}function d(a,b){if(a instanceof Array){for(var c=0;c<a.length;c++)b(c);"function"==typeof a.toJSON&&b("toJSON")}else for(c in a)b(c)}function c(){this.keys=[],this.hb=[]}a.Qb=function(c){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return b(c,function(b){for(var c=0;a.C(b)&&10>c;c++)b=b();return b})},a.toJSON=function(b,c,d){return b=a.Qb(b),a.a.eb(b,c,d)},c.prototype={save:function(b,c){var d=a.a.m(this.keys,b);d>=0?this.hb[d]=c:(this.keys.push(b),this.hb.push(c))},get:function(b){return b=a.a.m(this.keys,b),b>=0?this.hb[b]:p}}}(),a.b("toJS",a.Qb),a.b("toJSON",a.toJSON),function(){a.i={q:function(b){switch(a.a.t(b)){case"option":return!0===b.__ko__hasDomDataOptionValue__?a.a.e.get(b,a.d.options.Va):7>=a.a.L?b.getAttributeNode("value")&&b.getAttributeNode("value").specified?b.value:b.text:b.value;case"select":return 0<=b.selectedIndex?a.i.q(b.options[b.selectedIndex]):p;default:return b.value}},ca:function(b,d,c){switch(a.a.t(b)){case"option":switch(typeof d){case"string":a.a.e.set(b,a.d.options.Va,p),"__ko__hasDomDataOptionValue__"in b&&delete b.__ko__hasDomDataOptionValue__,b.value=d;break;default:a.a.e.set(b,a.d.options.Va,d),b.__ko__hasDomDataOptionValue__=!0,b.value="number"==typeof d?d:""}break;case"select":(""===d||null===d)&&(d=p);for(var e=-1,g=0,h=b.options.length,k;h>g;++g)if(k=a.i.q(b.options[g]),k==d||""==k&&d===p){e=g;break}(c||e>=0||d===p&&1<b.size)&&(b.selectedIndex=e);break;default:(null===d||d===p)&&(d=""),b.value=d}}}}(),a.b("selectExtensions",a.i),a.b("selectExtensions.readValue",a.i.q),a.b("selectExtensions.writeValue",a.i.ca),a.h=function(){function b(b){b=a.a.cb(b),123===b.charCodeAt(0)&&(b=b.slice(1,-1));var c=[],d=b.match(e),k,n,t=0;if(d){d.push(",");for(var z=0,u;u=d[z];++z){var r=u.charCodeAt(0);if(44===r){if(0>=t){k&&c.push(n?{key:k,value:n.join("")}:{unknown:k}),k=n=t=0;continue}}else if(58===r){if(!n)continue}else if(47===r&&z&&1<u.length)(r=d[z-1].match(g))&&!h[r[0]]&&(b=b.substr(b.indexOf(u)+1),d=b.match(e),d.push(","),z=-1,u="/");else if(40===r||123===r||91===r)++t;else if(41===r||125===r||93===r)--t;else if(!k&&!n){k=34===r||39===r?u.slice(1,-1):u;continue}n?n.push(u):n=[u]}}return c}var d=["true","false","null","undefined"],c=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,e=RegExp("\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*'|/(?:[^/\\\\]|\\\\.)*/w*|[^\\s:,/][^,\"'{}()/:[\\]]*[^\\s,\"'{}()/:[\\]]|[^\\s]","g"),g=/[\])"'A-Za-z0-9_$]+$/,h={"in":1,"return":1,"typeof":1},k={};return{ha:[],V:k,Wa:b,ya:function(f,m){function e(b,m){var f;if(!z){var u=a.getBindingHandler(b);
if(u&&u.preprocess&&!(m=u.preprocess(m,b,e)))return;(u=k[b])&&(f=m,0<=a.a.m(d,f)?f=!1:(u=f.match(c),f=null===u?!1:u[1]?"Object("+u[1]+")"+u[2]:f),u=f),u&&h.push("'"+b+"':function(_z){"+f+"=_z}")}t&&(m="function(){return "+m+" }"),g.push("'"+b+"':"+m)}m=m||{};var g=[],h=[],t=m.valueAccessors,z=m.bindingParams,u="string"==typeof f?b(f):f;return a.a.u(u,function(a){e(a.key||a.unknown,a.value)}),h.length&&e("_ko_property_writers","{"+h.join(",")+" }"),g.join(",")},lc:function(a,b){for(var c=0;c<a.length;c++)if(a[c].key==b)return!0;return!1},pa:function(b,c,d,e,k){b&&a.C(b)?!a.Ra(b)||k&&b.v()===e||b(e):(b=c.get("_ko_property_writers"))&&b[d]&&b[d](e)}}}(),a.b("expressionRewriting",a.h),a.b("expressionRewriting.bindingRewriteValidators",a.h.ha),a.b("expressionRewriting.parseObjectLiteral",a.h.Wa),a.b("expressionRewriting.preProcessBindings",a.h.ya),a.b("expressionRewriting._twoWayBindings",a.h.V),a.b("jsonExpressionRewriting",a.h),a.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",a.h.ya),function(){function b(a){return 8==a.nodeType&&h.test(g?a.text:a.nodeValue)}function d(a){return 8==a.nodeType&&k.test(g?a.text:a.nodeValue)}function c(a,c){for(var f=a,e=1,k=[];f=f.nextSibling;){if(d(f)&&(e--,0===e))return k;k.push(f),b(f)&&e++}if(!c)throw Error("Cannot find closing comment tag to match: "+a.nodeValue);return null}function e(a,b){var d=c(a,b);return d?0<d.length?d[d.length-1].nextSibling:a.nextSibling:null}var g=v&&"<!--test-->"===v.createComment("test").text,h=g?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,k=g?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,f={ul:!0,ol:!0};a.f={Q:{},childNodes:function(a){return b(a)?c(a):a.childNodes},ja:function(c){if(b(c)){c=a.f.childNodes(c);for(var d=0,f=c.length;f>d;d++)a.removeNode(c[d])}else a.a.Ka(c)},T:function(c,d){if(b(c)){a.f.ja(c);for(var f=c.nextSibling,e=0,k=d.length;k>e;e++)f.parentNode.insertBefore(d[e],f)}else a.a.T(c,d)},Hb:function(a,c){b(a)?a.parentNode.insertBefore(c,a.nextSibling):a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)},Bb:function(c,d,f){f?b(c)?c.parentNode.insertBefore(d,f.nextSibling):f.nextSibling?c.insertBefore(d,f.nextSibling):c.appendChild(d):a.f.Hb(c,d)},firstChild:function(a){return b(a)?!a.nextSibling||d(a.nextSibling)?null:a.nextSibling:a.firstChild},nextSibling:function(a){return b(a)&&(a=e(a)),a.nextSibling&&d(a.nextSibling)?null:a.nextSibling},gc:b,xc:function(a){return(a=(g?a.text:a.nodeValue).match(h))?a[1]:null},Fb:function(c){if(f[a.a.t(c)]){var k=c.firstChild;if(k)do if(1===k.nodeType){var g;g=k.firstChild;var h=null;if(g)do if(h)h.push(g);else if(b(g)){var t=e(g,!0);t?g=t:h=[g]}else d(g)&&(h=[g]);while(g=g.nextSibling);if(g=h)for(h=k.nextSibling,t=0;t<g.length;t++)h?c.insertBefore(g[t],h):c.appendChild(g[t])}while(k=k.nextSibling)}}}}(),a.b("virtualElements",a.f),a.b("virtualElements.allowedBindings",a.f.Q),a.b("virtualElements.emptyNode",a.f.ja),a.b("virtualElements.insertAfter",a.f.Bb),a.b("virtualElements.prepend",a.f.Hb),a.b("virtualElements.setDomNodeChildren",a.f.T),function(){a.J=function(){this.Yb={}},a.a.extend(a.J.prototype,{nodeHasBindings:function(b){switch(b.nodeType){case 1:return null!=b.getAttribute("data-bind")||a.g.getComponentNameForNode(b);case 8:return a.f.gc(b);default:return!1}},getBindings:function(b,d){var c=this.getBindingsString(b,d),c=c?this.parseBindingsString(c,d,b):null;return a.g.mb(c,b,d,!1)},getBindingAccessors:function(b,d){var c=this.getBindingsString(b,d),c=c?this.parseBindingsString(c,d,b,{valueAccessors:!0}):null;return a.g.mb(c,b,d,!0)},getBindingsString:function(b){switch(b.nodeType){case 1:return b.getAttribute("data-bind");case 8:return a.f.xc(b);default:return null}},parseBindingsString:function(b,d,c,e){try{var g=this.Yb,h=b+(e&&e.valueAccessors||""),k;if(!(k=g[h])){var f,m="with($context){with($data||{}){return{"+a.h.ya(b,e)+"}}}";f=new Function("$context","$element",m),k=g[h]=f}return k(d,c)}catch(l){throw l.message="Unable to parse bindings.\nBindings value: "+b+"\nMessage: "+l.message,l}}}),a.J.instance=new a.J}(),a.b("bindingProvider",a.J),function(){function b(a){return function(){return a}}function d(a){return a()}function c(b){return a.a.na(a.k.B(b),function(a,c){return function(){return b()[c]}})}function e(a,b){return c(this.getBindings.bind(this,a,b))}function g(b,c,d){var f,e=a.f.firstChild(c),k=a.J.instance,g=k.preprocessNode;if(g){for(;f=e;)e=a.f.nextSibling(f),g.call(k,f);e=a.f.firstChild(c)}for(;f=e;)e=a.f.nextSibling(f),h(b,f,d)}function h(b,c,d){var e=!0,k=1===c.nodeType;k&&a.f.Fb(c),(k&&d||a.J.instance.nodeHasBindings(c))&&(e=f(c,null,b,d).shouldBindDescendants),e&&!l[a.a.t(c)]&&g(b,c,!k)}function k(b){var c=[],d={},f=[];return a.a.G(b,function y(e){if(!d[e]){var k=a.getBindingHandler(e);k&&(k.after&&(f.push(e),a.a.u(k.after,function(c){if(b[c]){if(-1!==a.a.m(f,c))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+f.join(", "));y(c)}}),f.length--),c.push({key:e,zb:k})),d[e]=!0}}),c}function f(b,c,f,g){var m=a.a.e.get(b,q);if(!c){if(m)throw Error("You cannot apply bindings multiple times to the same element.");a.a.e.set(b,q,!0)}!m&&g&&a.Ob(b,f);var l;if(c&&"function"!=typeof c)l=c;else{var h=a.J.instance,n=h.getBindingAccessors||e,s=a.j(function(){return(l=c?c(f,b):n.call(h,b,f))&&f.I&&f.I(),l},null,{o:b});l&&s.Z()||(s=null)}var v;if(l){var w=s?function(a){return function(){return d(s()[a])}}:function(a){return l[a]},A=function(){return a.a.na(s?s():l,d)};A.get=function(a){return l[a]&&d(w(a))},A.has=function(a){return a in l},g=k(l),a.a.u(g,function(c){var d=c.zb.init,e=c.zb.update,k=c.key;if(8===b.nodeType&&!a.f.Q[k])throw Error("The binding '"+k+"' cannot be used with virtual elements");try{"function"==typeof d&&a.k.B(function(){var a=d(b,w(k),A,f.$data,f);if(a&&a.controlsDescendantBindings){if(v!==p)throw Error("Multiple bindings ("+v+" and "+k+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");v=k}}),"function"==typeof e&&a.j(function(){e(b,w(k),A,f.$data,f)},null,{o:b})}catch(g){throw g.message='Unable to process binding "'+k+": "+l[k]+'"\nMessage: '+g.message,g}})}return{shouldBindDescendants:v===p}}function m(b){return b&&b instanceof a.N?b:new a.N(b)}a.d={};var l={script:!0};a.getBindingHandler=function(b){return a.d[b]},a.N=function(b,c,d,f){var e=this,k="function"==typeof b&&!a.C(b),g,m=a.j(function(){var g=k?b():b,l=a.a.c(g);return c?(c.I&&c.I(),a.a.extend(e,c),m&&(e.I=m)):(e.$parents=[],e.$root=l,e.ko=a),e.$rawData=g,e.$data=l,d&&(e[d]=l),f&&f(e,c,l),e.$data},null,{Ia:function(){return g&&!a.a.ob(g)},o:!0});m.Z()&&(e.I=m,m.equalityComparer=null,g=[],m.Tb=function(b){g.push(b),a.a.w.da(b,function(b){a.a.ua(g,b),g.length||(m.K(),e.I=m=p)})})},a.N.prototype.createChildContext=function(b,c,d){return new a.N(b,this,c,function(a,b){a.$parentContext=b,a.$parent=b.$data,a.$parents=(b.$parents||[]).slice(0),a.$parents.unshift(a.$parent),d&&d(a)})},a.N.prototype.extend=function(b){return new a.N(this.I||this.$data,this,null,function(c,d){c.$rawData=d.$rawData,a.a.extend(c,"function"==typeof b?b():b)})};var q=a.a.e.F(),n=a.a.e.F();a.Ob=function(b,c){return 2!=arguments.length?a.a.e.get(b,n):(a.a.e.set(b,n,c),void(c.I&&c.I.Tb(b)))},a.ra=function(b,c,d){return 1===b.nodeType&&a.f.Fb(b),f(b,c,m(d),!0)},a.Wb=function(d,f,e){return e=m(e),a.ra(d,"function"==typeof f?c(f.bind(null,e,d)):a.a.na(f,b),e)},a.Ca=function(a,b){1!==b.nodeType&&8!==b.nodeType||g(m(a),b,!0)},a.pb=function(a,b){if(!w&&s.jQuery&&(w=s.jQuery),b&&1!==b.nodeType&&8!==b.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");b=b||s.document.body,h(m(a),b,!0)},a.Ha=function(b){switch(b.nodeType){case 1:case 8:var c=a.Ob(b);if(c)return c;if(b.parentNode)return a.Ha(b.parentNode)}return p},a.$b=function(b){return(b=a.Ha(b))?b.$data:p},a.b("bindingHandlers",a.d),a.b("applyBindings",a.pb),a.b("applyBindingsToDescendants",a.Ca),a.b("applyBindingAccessorsToNode",a.ra),a.b("applyBindingsToNode",a.Wb),a.b("contextFor",a.Ha),a.b("dataFor",a.$b)}(),function(b){function d(d,f){var e=g.hasOwnProperty(d)?g[d]:b,l;e||(e=g[d]=new a.P,c(d,function(a){h[d]=a,delete g[d],l?e.notifySubscribers(a):setTimeout(function(){e.notifySubscribers(a)},0)}),l=!0),e.U(f)}function c(a,b){e("getConfig",[a],function(c){c?e("loadComponent",[a,c],function(a){b(a)}):b(null)})}function e(c,d,g,l){l||(l=a.g.loaders.slice(0));var h=l.shift();if(h){var n=h[c];if(n){var t=!1;if(n.apply(h,d.concat(function(a){t?g(null):null!==a?g(a):e(c,d,g,l)}))!==b&&(t=!0,!h.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}else e(c,d,g,l)}else g(null)}var g={},h={};a.g={get:function(a,c){var e=h.hasOwnProperty(a)?h[a]:b;e?setTimeout(function(){c(e)},0):d(a,c)},tb:function(a){delete h[a]},jb:e},a.g.loaders=[],a.b("components",a.g),a.b("components.get",a.g.get),a.b("components.clearCachedDefinition",a.g.tb)}(),function(){function b(b,c,d,e){function k(){0===--u&&e(h)}var h={},u=2,r=d.template;d=d.viewModel,r?g(c,r,function(c){a.g.jb("loadTemplate",[b,c],function(a){h.template=a,k()})}):k(),d?g(c,d,function(c){a.g.jb("loadViewModel",[b,c],function(a){h[f]=a,k()})}):k()}function d(a,b,c){if("function"==typeof b)c(function(a){return new b(a)});else if("function"==typeof b[f])c(b[f]);else if("instance"in b){var e=b.instance;c(function(){return e})}else"viewModel"in b?d(a,b.viewModel,c):a("Unknown viewModel value: "+b)}function c(b){switch(a.a.t(b)){case"script":return a.a.ba(b.text);case"textarea":return a.a.ba(b.value);case"template":if(e(b.content))return a.a.ia(b.content.childNodes)}return a.a.ia(b.childNodes)}function e(a){return s.DocumentFragment?a instanceof DocumentFragment:a&&11===a.nodeType}function g(a,b,c){"string"==typeof b.require?N||s.require?(N||s.require)([b.require],c):a("Uses require, but no AMD loader is present"):c(b)}function h(a){return function(b){throw Error("Component '"+a+"': "+b)}}var k={};a.g.tc=function(b,c){if(!c)throw Error("Invalid configuration for "+b);if(a.g.Qa(b))throw Error("Component "+b+" is already registered");k[b]=c},a.g.Qa=function(a){return a in k},a.g.wc=function(b){delete k[b],a.g.tb(b)},a.g.ub={getConfig:function(a,b){b(k.hasOwnProperty(a)?k[a]:null)},loadComponent:function(a,c,d){var e=h(a);g(e,c,function(c){b(a,e,c,d)})},loadTemplate:function(b,d,f){if(b=h(b),"string"==typeof d)f(a.a.ba(d));else if(d instanceof Array)f(d);else if(e(d))f(a.a.S(d.childNodes));else if(d.element)if(d=d.element,s.HTMLElement?d instanceof HTMLElement:d&&d.tagName&&1===d.nodeType)f(c(d));else if("string"==typeof d){var k=v.getElementById(d);k?f(c(k)):b("Cannot find element with ID "+d)}else b("Unknown element type: "+d);else b("Unknown template value: "+d)},loadViewModel:function(a,b,c){d(h(a),b,c)}};var f="createViewModel";a.b("components.register",a.g.tc),a.b("components.isRegistered",a.g.Qa),a.b("components.unregister",a.g.wc),a.b("components.defaultLoader",a.g.ub),a.g.loaders.push(a.g.ub),a.g.Ub=k}(),function(){function b(b,e){var g=b.getAttribute("params");if(g){var g=d.parseBindingsString(g,e,b,{valueAccessors:!0,bindingParams:!0}),g=a.a.na(g,function(d){return a.s(d,null,{o:b})}),h=a.a.na(g,function(d){return d.Z()?a.s(function(){return a.a.c(d())},null,{o:b}):d.v()});return h.hasOwnProperty("$raw")||(h.$raw=g),h}return{$raw:{}}}a.g.getComponentNameForNode=function(b){return b=a.a.t(b),a.g.Qa(b)&&b},a.g.mb=function(c,d,g,h){if(1===d.nodeType){var k=a.g.getComponentNameForNode(d);if(k){if(c=c||{},c.component)throw Error('Cannot use the "component" binding on a custom element matching a component');var f={name:k,params:b(d,g)};c.component=h?function(){return f}:f}}return c};var d=new a.J;9>a.a.L&&(a.g.register=function(a){return function(b){return v.createElement(b),a.apply(this,arguments)}}(a.g.register),v.createDocumentFragment=function(b){return function(){var d=b(),g=a.g.Ub,h;for(h in g)g.hasOwnProperty(h)&&d.createElement(h);return d}}(v.createDocumentFragment))}(),function(){var b=0;a.d.component={init:function(d,c,e,g,h){function k(){var a=f&&f.dispose;"function"==typeof a&&a.call(f),m=null}var f,m;return a.a.w.da(d,k),a.s(function(){var e=a.a.c(c()),g,n;if("string"==typeof e?g=e:(g=a.a.c(e.name),n=a.a.c(e.params)),!g)throw Error("No component name specified");var t=m=++b;a.g.get(g,function(b){if(m===t){if(k(),!b)throw Error("Unknown component '"+g+"'");var c=b.template;if(!c)throw Error("Component '"+g+"' has no template");c=a.a.ia(c),a.f.T(d,c);var c=n,e=b.createViewModel;b=e?e.call(b,c,{element:d}):c,c=h.createChildContext(b),f=b,a.Ca(c,d)}})},null,{o:d}),{controlsDescendantBindings:!0}}},a.f.Q.component=!0}();var Q={"class":"className","for":"htmlFor"};a.d.attr={update:function(b,d){var c=a.a.c(d())||{};a.a.G(c,function(c,d){d=a.a.c(d);var h=!1===d||null===d||d===p;h&&b.removeAttribute(c),8>=a.a.L&&c in Q?(c=Q[c],h?b.removeAttribute(c):b[c]=d):h||b.setAttribute(c,d.toString()),"name"===c&&a.a.Mb(b,h?"":d.toString())})}},function(){a.d.checked={after:["value","attr"],init:function(b,d,c){function e(){var e=b.checked,k=q?h():e;if(!a.Y.ma()&&(!f||e)){var g=a.k.B(d);m?l!==k?(e&&(a.a.ea(g,k,!0),a.a.ea(g,l,!1)),l=k):a.a.ea(g,k,e):a.h.pa(g,c,"checked",k,!0)}}function g(){var c=a.a.c(d());b.checked=m?0<=a.a.m(c,h()):k?c:h()===c}var h=a.Ib(function(){return c.has("checkedValue")?a.a.c(c.get("checkedValue")):c.has("value")?a.a.c(c.get("value")):b.value}),k="checkbox"==b.type,f="radio"==b.type;if(k||f){var m=k&&a.a.c(d())instanceof Array,l=m?h():p,q=f||m;f&&!b.name&&a.d.uniqueName.init(b,function(){return!0}),a.s(e,null,{o:b}),a.a.n(b,"click",e),a.s(g,null,{o:b})}}},a.h.V.checked=!0,a.d.checkedValue={update:function(b,d){b.value=a.a.c(d())}}}(),a.d.css={update:function(b,d){var c=a.a.c(d());"object"==typeof c?a.a.G(c,function(c,d){d=a.a.c(d),a.a.Ba(b,c,d)}):(c=String(c||""),a.a.Ba(b,b.__ko__cssValue,!1),b.__ko__cssValue=c,a.a.Ba(b,c,!0))}},a.d.enable={update:function(b,d){var c=a.a.c(d());c&&b.disabled?b.removeAttribute("disabled"):c||b.disabled||(b.disabled=!0)}},a.d.disable={update:function(b,d){a.d.enable.update(b,function(){return!a.a.c(d())})}},a.d.event={init:function(b,d,c,e,g){var h=d()||{};a.a.G(h,function(k){"string"==typeof k&&a.a.n(b,k,function(b){var h,l=d()[k];if(l){try{var q=a.a.S(arguments);e=g.$data,q.unshift(e),h=l.apply(e,q)}finally{!0!==h&&(b.preventDefault?b.preventDefault():b.returnValue=!1)}!1===c.get(k+"Bubble")&&(b.cancelBubble=!0,b.stopPropagation&&b.stopPropagation())}})})}},a.d.foreach={Eb:function(b){return function(){var d=b(),c=a.a.Xa(d);return c&&"number"!=typeof c.length?(a.a.c(d),{foreach:c.data,as:c.as,includeDestroyed:c.includeDestroyed,afterAdd:c.afterAdd,beforeRemove:c.beforeRemove,afterRender:c.afterRender,beforeMove:c.beforeMove,afterMove:c.afterMove,templateEngine:a.O.Oa}):{foreach:d,templateEngine:a.O.Oa}}},init:function(b,d){return a.d.template.init(b,a.d.foreach.Eb(d))},update:function(b,d,c,e,g){return a.d.template.update(b,a.d.foreach.Eb(d),c,e,g)}},a.h.ha.foreach=!1,a.f.Q.foreach=!0,a.d.hasfocus={init:function(b,d,c){function e(e){b.__ko_hasfocusUpdating=!0;var f=b.ownerDocument;if("activeElement"in f){var g;try{g=f.activeElement}catch(h){g=f.body}e=g===b}f=d(),a.h.pa(f,c,"hasfocus",e,!0),b.__ko_hasfocusLastValue=e,b.__ko_hasfocusUpdating=!1}var g=e.bind(null,!0),h=e.bind(null,!1);a.a.n(b,"focus",g),a.a.n(b,"focusin",g),a.a.n(b,"blur",h),a.a.n(b,"focusout",h)},update:function(b,d){var c=!!a.a.c(d());b.__ko_hasfocusUpdating||b.__ko_hasfocusLastValue===c||(c?b.focus():b.blur(),a.k.B(a.a.oa,null,[b,c?"focusin":"focusout"]))}},a.h.V.hasfocus=!0,a.d.hasFocus=a.d.hasfocus,a.h.V.hasFocus=!0,a.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(b,d){a.a.$a(b,d())}},I("if"),I("ifnot",!1,!0),I("with",!0,!1,function(a,d){return a.createChildContext(d)});var K={};a.d.options={init:function(b){if("select"!==a.a.t(b))throw Error("options binding applies only to SELECT elements");for(;0<b.length;)b.remove(0);return{controlsDescendantBindings:!0}},update:function(b,d,c){function e(){return a.a.ta(b.options,function(a){return a.selected})}function g(a,b,c){var d=typeof b;return"function"==d?b(a):"string"==d?a[b]:c}function h(c,d){if(q.length){var e=0<=a.a.m(q,a.i.q(d[0]));a.a.Nb(d[0],e),n&&!e&&a.k.B(a.a.oa,null,[b,"change"])}}var k=0!=b.length&&b.multiple?b.scrollTop:null,f=a.a.c(d()),m=c.get("optionsIncludeDestroyed");d={};var l,q;q=b.multiple?a.a.Da(e(),a.i.q):0<=b.selectedIndex?[a.i.q(b.options[b.selectedIndex])]:[],f&&("undefined"==typeof f.length&&(f=[f]),l=a.a.ta(f,function(b){return m||b===p||null===b||!a.a.c(b._destroy)}),c.has("optionsCaption")&&(f=a.a.c(c.get("optionsCaption")),null!==f&&f!==p&&l.unshift(K)));var n=!1;d.beforeRemove=function(a){b.removeChild(a)},f=h,c.has("optionsAfterRender")&&(f=function(b,d){h(0,d),a.k.B(c.get("optionsAfterRender"),null,[d[0],b!==K?b:p])}),a.a.Za(b,l,function(d,e,f){return f.length&&(q=f[0].selected?[a.i.q(f[0])]:[],n=!0),e=b.ownerDocument.createElement("option"),d===K?(a.a.bb(e,c.get("optionsCaption")),a.i.ca(e,p)):(f=g(d,c.get("optionsValue"),d),a.i.ca(e,a.a.c(f)),d=g(d,c.get("optionsText"),f),a.a.bb(e,d)),[e]},d,f),a.k.B(function(){c.get("valueAllowUnset")&&c.has("value")?a.i.ca(b,a.a.c(c.get("value")),!0):(b.multiple?q.length&&e().length<q.length:q.length&&0<=b.selectedIndex?a.i.q(b.options[b.selectedIndex])!==q[0]:q.length||0<=b.selectedIndex)&&a.a.oa(b,"change")}),a.a.dc(b),k&&20<Math.abs(k-b.scrollTop)&&(b.scrollTop=k)}},a.d.options.Va=a.a.e.F(),a.d.selectedOptions={after:["options","foreach"],init:function(b,d,c){a.a.n(b,"change",function(){var e=d(),g=[];a.a.u(b.getElementsByTagName("option"),function(b){b.selected&&g.push(a.i.q(b))}),a.h.pa(e,c,"selectedOptions",g)})},update:function(b,d){if("select"!=a.a.t(b))throw Error("values binding applies only to SELECT elements");var c=a.a.c(d());c&&"number"==typeof c.length&&a.a.u(b.getElementsByTagName("option"),function(b){var d=0<=a.a.m(c,a.i.q(b));a.a.Nb(b,d)})}},a.h.V.selectedOptions=!0,a.d.style={update:function(b,d){var c=a.a.c(d()||{});a.a.G(c,function(c,d){d=a.a.c(d),(null===d||d===p||!1===d)&&(d=""),b.style[c]=d})}},a.d.submit={init:function(b,d,c,e,g){if("function"!=typeof d())throw Error("The value for a submit binding must be a function");a.a.n(b,"submit",function(a){var c,e=d();try{c=e.call(g.$data,b)}finally{!0!==c&&(a.preventDefault?a.preventDefault():a.returnValue=!1)}})}},a.d.text={init:function(){return{controlsDescendantBindings:!0}},update:function(b,d){a.a.bb(b,d())}},a.f.Q.text=!0,function(){if(s&&s.navigator)var b=function(a){return a?parseFloat(a[1]):void 0},d=s.opera&&s.opera.version&&parseInt(s.opera.version()),c=s.navigator.userAgent,e=b(c.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),g=b(c.match(/Firefox\/([^ ]*)/));if(10>a.a.L)var h=a.a.e.F(),k=a.a.e.F(),f=function(b){var c=this.activeElement;(c=c&&a.a.e.get(c,k))&&c(b)},m=function(b,c){var d=b.ownerDocument;a.a.e.get(d,h)||(a.a.e.set(d,h,!0),a.a.n(d,"selectionchange",f)),a.a.e.set(b,k,c)};a.d.textInput={init:function(b,c,f){function k(c,d){a.a.n(b,c,d)}function h(){var d=a.a.c(c());(null===d||d===p)&&(d=""),v!==p&&d===v?setTimeout(h,4):b.value!==d&&(s=d,b.value=d)}function u(){y||(v=b.value,y=setTimeout(r,4))}function r(){clearTimeout(y),v=y=p;var d=b.value;s!==d&&(s=d,a.h.pa(c(),f,"textInput",d))}var s=b.value,y,v;10>a.a.L?(k("propertychange",function(a){"value"===a.propertyName&&r()}),8==a.a.L&&(k("keyup",r),k("keydown",r)),8<=a.a.L&&(m(b,r),k("dragend",u))):(k("input",r),5>e&&"textarea"===a.a.t(b)?(k("keydown",u),k("paste",u),k("cut",u)):11>d?k("keydown",u):4>g&&(k("DOMAutoComplete",r),k("dragdrop",r),k("drop",r))),k("change",r),a.s(h,null,{o:b})}},a.h.V.textInput=!0,a.d.textinput={preprocess:function(a,b,c){c("textInput",a)}}}(),a.d.uniqueName={init:function(b,d){if(d()){var c="ko_unique_"+ ++a.d.uniqueName.Zb;a.a.Mb(b,c)}}},a.d.uniqueName.Zb=0,a.d.value={after:["options","foreach"],init:function(b,d,c){if("input"!=b.tagName.toLowerCase()||"checkbox"!=b.type&&"radio"!=b.type){var e=["change"],g=c.get("valueUpdate"),h=!1,k=null;g&&("string"==typeof g&&(g=[g]),a.a.ga(e,g),e=a.a.rb(e));var f=function(){k=null,h=!1;var e=d(),f=a.i.q(b);a.h.pa(e,c,"value",f)};!a.a.L||"input"!=b.tagName.toLowerCase()||"text"!=b.type||"off"==b.autocomplete||b.form&&"off"==b.form.autocomplete||-1!=a.a.m(e,"propertychange")||(a.a.n(b,"propertychange",function(){h=!0}),a.a.n(b,"focus",function(){h=!1}),a.a.n(b,"blur",function(){h&&f()})),a.a.u(e,function(c){var d=f;a.a.vc(c,"after")&&(d=function(){k=a.i.q(b),setTimeout(f,0)},c=c.substring(5)),a.a.n(b,c,d)});var m=function(){var e=a.a.c(d()),f=a.i.q(b);if(null!==k&&e===k)setTimeout(m,0);else if(e!==f)if("select"===a.a.t(b)){var g=c.get("valueAllowUnset"),f=function(){a.i.ca(b,e,g)};f(),g||e===a.i.q(b)?setTimeout(f,0):a.k.B(a.a.oa,null,[b,"change"])}else a.i.ca(b,e)};a.s(m,null,{o:b})}else a.ra(b,{checkedValue:d})},update:function(){}},a.h.V.value=!0,a.d.visible={update:function(b,d){var c=a.a.c(d()),e="none"!=b.style.display;c&&!e?b.style.display="":!c&&e&&(b.style.display="none")}},function(b){a.d[b]={init:function(d,c,e,g,h){return a.d.event.init.call(this,d,function(){var a={};return a[b]=c(),a},e,g,h)}}}("click"),a.H=function(){},a.H.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")},a.H.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")},a.H.prototype.makeTemplateSource=function(b,d){if("string"==typeof b){d=d||v;var c=d.getElementById(b);if(!c)throw Error("Cannot find template with ID "+b);return new a.r.l(c)}if(1==b.nodeType||8==b.nodeType)return new a.r.fa(b);throw Error("Unknown template type: "+b)},a.H.prototype.renderTemplate=function(a,d,c,e){return a=this.makeTemplateSource(a,e),this.renderTemplateSource(a,d,c)},a.H.prototype.isTemplateRewritten=function(a,d){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(a,d).data("isRewritten")},a.H.prototype.rewriteTemplate=function(a,d,c){a=this.makeTemplateSource(a,c),d=d(a.text()),a.text(d),a.data("isRewritten",!0)},a.b("templateEngine",a.H),a.fb=function(){function b(b,c,d,k){b=a.h.Wa(b);for(var f=a.h.ha,m=0;m<b.length;m++){var l=b[m].key;if(f.hasOwnProperty(l)){var q=f[l];if("function"==typeof q){if(l=q(b[m].value))throw Error(l)}else if(!q)throw Error("This template engine does not support the '"+l+"' binding within its templates")}}return d="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+a.h.ya(b,{valueAccessors:!0})+" } })()},'"+d.toLowerCase()+"')",k.createJavaScriptEvaluatorBlock(d)+c}var d=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,c=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{ec:function(b,c,d){c.isTemplateRewritten(b,d)||c.rewriteTemplate(b,function(b){return a.fb.nc(b,c)},d)},nc:function(a,g){return a.replace(d,function(a,c,d,e,l){return b(l,c,d,g)}).replace(c,function(a,c){return b(c,"<!-- ko -->","#comment",g)})},Xb:function(b,c){return a.D.Ua(function(d,k){var f=d.nextSibling;f&&f.nodeName.toLowerCase()===c&&a.ra(f,b,k)})}}}(),a.b("__tr_ambtns",a.fb.Xb),function(){a.r={},a.r.l=function(a){this.l=a},a.r.l.prototype.text=function(){var b=a.a.t(this.l),b="script"===b?"text":"textarea"===b?"value":"innerHTML";if(0==arguments.length)return this.l[b];var d=arguments[0];"innerHTML"===b?a.a.$a(this.l,d):this.l[b]=d};var b=a.a.e.F()+"_";a.r.l.prototype.data=function(c){return 1===arguments.length?a.a.e.get(this.l,b+c):void a.a.e.set(this.l,b+c,arguments[1])};var d=a.a.e.F();a.r.fa=function(a){this.l=a},a.r.fa.prototype=new a.r.l,a.r.fa.prototype.text=function(){if(0==arguments.length){var b=a.a.e.get(this.l,d)||{};return b.gb===p&&b.Ga&&(b.gb=b.Ga.innerHTML),b.gb}a.a.e.set(this.l,d,{gb:arguments[0]})},a.r.l.prototype.nodes=function(){return 0==arguments.length?(a.a.e.get(this.l,d)||{}).Ga:void a.a.e.set(this.l,d,{Ga:arguments[0]})},a.b("templateSources",a.r),a.b("templateSources.domElement",a.r.l),a.b("templateSources.anonymousTemplate",a.r.fa)}(),function(){function b(b,c,d){var e;for(c=a.f.nextSibling(c);b&&(e=b)!==c;)b=a.f.nextSibling(e),d(e,b)}function d(c,d){if(c.length){var e=c[0],g=c[c.length-1],h=e.parentNode,n=a.J.instance,t=n.preprocessNode;if(t){if(b(e,g,function(a,b){var c=a.previousSibling,d=t.call(n,a);d&&(a===e&&(e=d[0]||b),a===g&&(g=d[d.length-1]||c))}),c.length=0,!e)return;e===g?c.push(e):(c.push(e,g),a.a.ka(c,h))}b(e,g,function(b){1!==b.nodeType&&8!==b.nodeType||a.pb(d,b)}),b(e,g,function(b){1!==b.nodeType&&8!==b.nodeType||a.D.Sb(b,[d])}),a.a.ka(c,h)}}function c(a){return a.nodeType?a:0<a.length?a[0]:null}function e(b,e,h,l,q){q=q||{};var n=b&&c(b),n=n&&n.ownerDocument,t=q.templateEngine||g;if(a.fb.ec(h,t,n),h=t.renderTemplate(h,l,q,n),"number"!=typeof h.length||0<h.length&&"number"!=typeof h[0].nodeType)throw Error("Template engine must return an array of DOM nodes");switch(n=!1,e){case"replaceChildren":a.f.T(b,h),n=!0;break;case"replaceNode":a.a.Lb(b,h),n=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+e)}return n&&(d(h,l),q.afterRender&&a.k.B(q.afterRender,null,[h,l.$data])),h}var g;a.ab=function(b){if(b!=p&&!(b instanceof a.H))throw Error("templateEngine must inherit from ko.templateEngine");g=b},a.Ya=function(b,d,h,l,q){if(h=h||{},(h.templateEngine||g)==p)throw Error("Set a template engine before calling renderTemplate");if(q=q||"replaceChildren",l){var n=c(l);return a.j(function(){var g=d&&d instanceof a.N?d:new a.N(a.a.c(d)),p=a.C(b)?b():"function"==typeof b?b(g.$data,g):b,g=e(l,q,p,g,h);"replaceNode"==q&&(l=g,n=c(l))},null,{Ia:function(){return!n||!a.a.Ja(n)},o:n&&"replaceNode"==q?n.parentNode:n})}return a.D.Ua(function(c){a.Ya(b,d,h,c,"replaceNode")})},a.uc=function(b,c,g,h,q){function n(a,b){d(b,s),g.afterRender&&g.afterRender(b,a)}function t(c,d){s=q.createChildContext(c,g.as,function(a){a.$index=d});var f=a.C(b)?b():"function"==typeof b?b(c,s):b;return e(null,"ignoreTargetNode",f,s,g)}var s;return a.j(function(){var b=a.a.c(c)||[];"undefined"==typeof b.length&&(b=[b]),b=a.a.ta(b,function(b){return g.includeDestroyed||b===p||null===b||!a.a.c(b._destroy)}),a.k.B(a.a.Za,null,[h,b,t,g,n])},null,{o:h})};var h=a.a.e.F();a.d.template={init:function(b,c){var d=a.a.c(c());return"string"==typeof d||d.name?a.f.ja(b):(d=a.f.childNodes(b),d=a.a.oc(d),new a.r.fa(b).nodes(d)),{controlsDescendantBindings:!0}},update:function(b,c,d,e,g){var n=c(),t;c=a.a.c(n),d=!0,e=null,"string"==typeof c?c={}:(n=c.name,"if"in c&&(d=a.a.c(c["if"])),d&&"ifnot"in c&&(d=!a.a.c(c.ifnot)),t=a.a.c(c.data)),"foreach"in c?e=a.uc(n||b,d&&c.foreach||[],c,b,g):d?(g="data"in c?g.createChildContext(t,c.as):g,e=a.Ya(n||b,g,c,b)):a.f.ja(b),g=e,(t=a.a.e.get(b,h))&&"function"==typeof t.K&&t.K(),a.a.e.set(b,h,g&&g.Z()?g:p)}},a.h.ha.template=function(b){return b=a.h.Wa(b),1==b.length&&b[0].unknown||a.h.lc(b,"name")?null:"This template engine does not support anonymous templates nested within its templates"},a.f.Q.template=!0}(),a.b("setTemplateEngine",a.ab),a.b("renderTemplate",a.Ya),a.a.wb=function(a,d,c){if(a.length&&d.length){var e,g,h,k,f;for(e=g=0;(!c||c>e)&&(k=a[g]);++g){for(h=0;f=d[h];++h)if(k.value===f.value){k.moved=f.index,f.moved=k.index,d.splice(h,1),e=h=0;break}e+=h}}},a.a.Fa=function(){function b(b,c,e,g,h){var k=Math.min,f=Math.max,m=[],l,q=b.length,n,p=c.length,s=p-q||1,u=q+p+1,r,v,w;for(l=0;q>=l;l++)for(v=r,m.push(r=[]),w=k(p,l+s),n=f(0,l-1);w>=n;n++)r[n]=n?l?b[l-1]===c[n-1]?v[n-1]:k(v[n]||u,r[n-1]||u)+1:n+1:l+1;for(k=[],f=[],s=[],l=q,n=p;l||n;)p=m[l][n]-1,n&&p===m[l][n-1]?f.push(k[k.length]={status:e,value:c[--n],index:n}):l&&p===m[l-1][n]?s.push(k[k.length]={status:g,value:b[--l],index:l}):(--n,--l,h.sparse||k.push({status:"retained",value:c[n]}));return a.a.wb(f,s,10*q),k.reverse()}return function(a,c,e){return e="boolean"==typeof e?{dontLimitMoves:e}:e||{},a=a||[],c=c||[],a.length<=c.length?b(a,c,"added","deleted",e):b(c,a,"deleted","added",e)}}(),a.b("utils.compareArrays",a.a.Fa),function(){function b(b,d,g,h,k){var f=[],m=a.j(function(){var l=d(g,k,a.a.ka(f,b))||[];0<f.length&&(a.a.Lb(f,l),h&&a.k.B(h,null,[g,l,k])),f.length=0,a.a.ga(f,l)},null,{o:b,Ia:function(){return!a.a.ob(f)}});return{$:f,j:m.Z()?m:p}}var d=a.a.e.F();a.a.Za=function(c,e,g,h,k){function f(b,d){x=q[d],r!==d&&(A[b]=x),x.Na(r++),a.a.ka(x.$,c),s.push(x),w.push(x)}function m(b,c){if(b)for(var d=0,e=c.length;e>d;d++)c[d]&&a.a.u(c[d].$,function(a){b(a,d,c[d].sa)})}e=e||[],h=h||{};var l=a.a.e.get(c,d)===p,q=a.a.e.get(c,d)||[],n=a.a.Da(q,function(a){return a.sa}),t=a.a.Fa(n,e,h.dontLimitMoves),s=[],u=0,r=0,v=[],w=[];e=[];for(var A=[],n=[],x,B=0,D,F;D=t[B];B++)switch(F=D.moved,D.status){case"deleted":F===p&&(x=q[u],x.j&&x.j.K(),v.push.apply(v,a.a.ka(x.$,c)),h.beforeRemove&&(e[B]=x,w.push(x))),u++;break;case"retained":f(B,u++);break;case"added":F!==p?f(B,F):(x={sa:D.value,Na:a.p(r++)},s.push(x),w.push(x),l||(n[B]=x))}m(h.beforeMove,A),a.a.u(v,h.beforeRemove?a.R:a.removeNode);for(var B=0,l=a.f.firstChild(c),G;x=w[B];B++){for(x.$||a.a.extend(x,b(c,g,x.sa,k,x.Na)),u=0;t=x.$[u];l=t.nextSibling,G=t,u++)t!==l&&a.f.Bb(c,t,G);!x.ic&&k&&(k(x.sa,x.$,x.Na),x.ic=!0)}m(h.beforeRemove,e),m(h.afterMove,A),m(h.afterAdd,n),a.a.e.set(c,d,s)}}(),a.b("utils.setDomNodeChildrenFromArrayMapping",a.a.Za),a.O=function(){this.allowTemplateRewriting=!1},a.O.prototype=new a.H,a.O.prototype.renderTemplateSource=function(b){var d=(9>a.a.L?0:b.nodes)?b.nodes():null;return d?a.a.S(d.cloneNode(!0).childNodes):(b=b.text(),a.a.ba(b))},a.O.Oa=new a.O,a.ab(a.O.Oa),a.b("nativeTemplateEngine",a.O),function(){a.Sa=function(){var a=this.kc=function(){if(!w||!w.tmpl)return 0;try{if(0<=w.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(a){}return 1}();this.renderTemplateSource=function(b,e,g){if(g=g||{},2>a)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var h=b.data("precompiled");return h||(h=b.text()||"",h=w.template(null,"{{ko_with $item.koBindingContext}}"+h+"{{/ko_with}}"),b.data("precompiled",h)),b=[e.$data],e=w.extend({koBindingContext:e},g.templateOptions),e=w.tmpl(h,b,e),e.appendTo(v.createElement("div")),w.fragments={},e},this.createJavaScriptEvaluatorBlock=function(a){return"{{ko_code ((function() { return "+a+" })()) }}"},this.addTemplate=function(a,b){v.write("<script type='text/html' id='"+a+"'>"+b+"</script>")},a>0&&(w.tmpl.tag.ko_code={open:"__.push($1 || '');"},w.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},a.Sa.prototype=new a.H;var b=new a.Sa;0<b.kc&&a.ab(b),a.b("jqueryTmplTemplateEngine",a.Sa)}()})}()}(),define("util",[],function(){function setURLPart(part,str){part===URLPart.Search?window.location.search=str:part===URLPart.Hash&&(window.location.hash=str)}function getStringForPart(part){return part===URLPart.Search?window.location.search:part===URLPart.Hash?window.location.hash:void 0}function getURLPartForParam(param){return URLParamMap[param]}function dummyStorageGetFn(){}var self={};window.URLPart={Search:1,Hash:2};var URLParamMap={demo:URLPart.Hash,login:URLPart.Hash,user:URLPart.Hash,premium:URLPart.Hash,access_token:URLPart.Hash,error:URLPart.Hash,expires_in:URLPart.Hash,scope:URLPart.Hash,token_type:URLPart.Hash,data:URLPart.Hash,script:URLPart.Hash,dmode:URLPart.Hash,jasmine:URLPart.Hash,touch:URLPart.Hash,file:URLPart.Hash,panes:URLPart.Hash,offline:URLPart.Hash,live:URLPart.Hash,test:URLPart.Hash,nolocal:URLPart.Hash,nosync:URLPart.Hash,rdebug:URLPart.Hash,rsession:URLPart.Hash,cacheError:URLPart.Hash,versionError:URLPart.Hash,invite:URLPart.Hash,state:URLPart.Search};self.hasURLParam=function hasURLParamFn(key,value){var str=key+"=";value&&(str+=value);var part=getURLPartForParam(key);part||log("Invalid URL Part");var rawString=getStringForPart(part);return rawString.indexOf(str)>=0},self.getURLParam=function getURLParamFn(key,forcePart){var part=forcePart?forcePart:getURLPartForParam(key);
if(part===URLPart.Search){key=key.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+key+"=([^&#]*)",regex=new RegExp(regexS),results=regex.exec(window.location.href);return null===results?void 0:decodeURIComponent(results[1].replace(/\+/g," "))}if(part===URLPart.Hash){for(var queryString=window.location.hash.substring(1),regex=/([^&=]+)=([^&]*)/g,m;m=regex.exec(queryString);)if(decodeURIComponent(m[1])===key)return decodeURIComponent(m[2]);return void 0}log("Invalid URL part")},self.insertURLParam=function insertURLParamFn(key,value,noReload){key=encodeURIComponent(key),value=encodeURIComponent(value);for(var part=getURLPartForParam(key),rawString=getStringForPart(part),params=rawString.substr(1).split("&"),i=params.length-1;i>=0;i--){var param=params[i].split("=");if(param[0]==key){param[1]=value,params[i]=param.join("=");break}}0>i&&(params[params.length]=[key,value].join("=")),setURLPart(part,params.join("&")),part!==URLPart.Hash||noReload||window.location.reload()},self.removeURLParam=function removeURLParamFn(key,noReload){key=encodeURIComponent(key);for(var part=getURLPartForParam(key),rawString=getStringForPart(part),params=rawString.substr(1).split("&"),i=params.length-1;i>=0;i--){var param=params[i].split("=");if(param[0]==key){params.splice(i,1);break}}setURLPart(part,params.join("&")),part!==URLPart.Hash||noReload||window.location.reload()};var __bindMap;self.forceBind=function forceBindFn(fnName,obj){var hasEntry,bindFn=obj[fnName].bind(obj);return obj[fnName]=bindFn,bindFn},self.destroy=function destroyFn(obj){},self.extend=function extendFn(target,source){if(source)for(var prop in source)source.hasOwnProperty(prop)&&(target[prop]=source[prop]);return target},self.inherit=function inheritFn(base,sub){sub.prototype=Object.create(base.prototype),sub.prototype.constructor=sub,sub.prototype._super=base.prototype},self.defineBase=function defineBaseFn(base){base.prototype.constructor=base};var dummyStorage={getItem:function(){},setItem:function(){},removeItem:function(){},clear:function(){}};try{self.__storage=window.localStorage||dummyStorage}catch(err){self.__storage=dummyStorage}return self.storage={getItem:(self.__storage.getItem||function(key,cb){return this.get(key,cb||dummyStorageGetFn)}).bind(self.__storage),setItem:(self.__storage.setItem||function(key,value){var obj={};obj[key]=value,this.set(obj)}).bind(self.__storage),removeItem:(self.__storage.removeItem||function(key,cb){this.remove(key,cb)}).bind(self.__storage),clear:(self.__storage.clear||function(cb){this.clear(cb)}).bind(self.__storage)},self}),define("Listener",[],function(){var Listener=function(target,cb){this.target=target,this.cb=cb};return Listener.prototype={dispose:function disposeFn(){this.target.unlisten(this.cb)}},Listener}),define("Trigger",["globals","Listener"],function(g,Listener){var Trigger=function(onUpdate){this._listeners=[],this._enabled=!0,onUpdate&&this._listeners.push(onUpdate)};return Trigger.prototype={listen:function listenFn(cb){return this._addListener(cb),new Listener(this,cb)},_addListener:function _addListenerFn(cb){this._listeners.push(cb)},_hasListener:function _hasListenerFn(cb){return this._listeners.indexOf(cb)>=0},unlisten:function unlistenFn(cb){this._listeners.remove(cb)},enable:function enableFn(){this._enabled=!0},disable:function disableFn(){this._enabled=!1},notify:function notifyFn(){if(this._enabled)for(var i=0;i<this._listeners.length;++i)arguments.length>0?this._listeners[i](arguments[0]):this._listeners[i]()}},Trigger}),define("platform",["ko","util","Trigger"],function(ko,util,Trigger){function platform(){this.versionRequired=[],this.versionAvailable=[],this.versionRequired[AppPlatform.iOS]=4,this.versionAvailable[AppPlatform.iOS]=5,this.versionRequired[AppPlatform.Android]=4,this.versionAvailable[AppPlatform.Android]=5,this.versionRequired[AppPlatform.WinPhone]=1,this.versionAvailable[AppPlatform.WinPhone]=1,this.versionRequired[AppPlatform.Chrome]=1,this.versionAvailable[AppPlatform.Chrome]=1,this.versionMobile=1,this.versionDesktop=4,this.versionMobileMessages={1:"New features: Tap the right edge of an item to complete it. Tap the left edge of a list to collapse its items."},this.versionDesktopMessages={1:"New features: Click the right edge of an item to complete it. Click the left edge of a list to collapse its items. See our blog for more details.",2:"Update: Hotkeys have been changed. See the Help for the list of hotkeys.",3:"Update: Documents have been moved to the folder menu in the top left and options have been moved to the cog menu in the top right.",4:"Moo.do Premium has launched with Google Drive integration. You can sign up in the settings menu and find more information and a demo in our blog post."},this.setDeployEnvironments(),this.appStoreLinks=[],this.appStoreLinks[AppPlatform.iOS]="https://itunes.apple.com/us/app/moo.do-organize-your-way/id889830074?ls=1&mt=8",this.appStoreLinks[AppPlatform.Android]="https://play.google.com/store/apps/details?id=moo.do",this.appStoreLinks[AppPlatform.WinPhone]=void 0,this.appStoreLinks[AppPlatform.Chrome]="https://chrome.google.com/webstore/detail/moodo/iffimmolghilclfndeiebgppddmagofk",this.appReviewLinks=[],this.appReviewLinks[AppPlatform.iOS]=void 0,this.appReviewLinks[AppPlatform.Android]=void 0,this.appReviewLinks[AppPlatform.WinPhone]=void 0,this.appReviewLinks[AppPlatform.Chrome]=void 0,this.appPlatform=void 0,this.appStoreLink=void 0,this.appReviewLink=void 0,this.requireCustomRedirect=!1,this.b=document.documentElement,this.orientation=Orientation.Portrait,this.windowWidth=ko.observable(0),this.windowHeight=ko.observable(0),this.onResize=new Trigger,this.kbsize=void 0,this.kbsizePortrait=void 0,this.kbsizeLandscape=void 0,this.hasBeenPortrait=!1,this.appState=void 0,this.forceNotifications=void 0,this.isHosted=!1,this.hostedBy=void 0,this.pageVisibilityHidden=void 0,this.pageVisibilityChange=void 0,this.isPhantom=!1,this.isDevURL="dev.moo.do"===window.location.hostname||"beta.moo.do"===window.location.hostname,this.init();var useLocationHost=!1||this.isDevURL||this.app&&this.debugApp||!this.app&&this.standalone;this.customRedirectString=window.location.protocol+"//"+(useLocationHost?window.location.host:"www.moo.do")+"/app/",this.app&&(this.customRedirectState={app:!0,appv:this.appv,webview:this.appState&&this.appState.webview}),this.keyboardOpenTime=this.app||this.android?200:this.winphone?200:this.mobileie?600:0}return window.Orientation={Portrait:0,Landscape:1},window.PlatformConfig={DesktopWindows:0,DesktopMac:1,DesktopOther:2,ChromeApp:3,AndroidBrowser:4,AndroidApp:5,iOSBrowser:6,iOSApp:7,WinPhoneBrowser:8,WinPhoneApp:9,MobileOther:10,Unknown:11,EmbedDesktopApp:12,EmbedMobileApp:13},window.AppPlatform={iOS:0,Android:1,WinPhone:2,Chrome:3,Embed:4},window.EmbedApps={Mailbird:"mailbird"},window.DeployVariable={Environment:"Environment",APIHost:"APIHost",APIProtocol:"APIProtocol"},platform.prototype={getDeployVar:function getDeployVarFn(key){return this.deployEnvironment[key]},setDeployEnvironments:function setDeployEnvironmentsFn(){this.deployEnvironment={},"dev.moo.do"===window.location.hostname?(this.deployEnvironment[DeployVariable.Environment]="dev",this.deployEnvironment[DeployVariable.APIProtocol]="https:",this.deployEnvironment[DeployVariable.APIHost]="//api-dev.moo.do"):"beta.moo.do"===window.location.hostname?(this.deployEnvironment[DeployVariable.Environment]="beta",this.deployEnvironment[DeployVariable.APIProtocol]="https:",this.deployEnvironment[DeployVariable.APIHost]="//api-beta.moo.do"):"localhost"===window.location.hostname?(this.deployEnvironment[DeployVariable.Environment]="local",this.deployEnvironment[DeployVariable.APIProtocol]="http:",this.deployEnvironment[DeployVariable.APIHost]="//localhost:9024"):(this.deployEnvironment[DeployVariable.Environment]="production",this.deployEnvironment[DeployVariable.APIProtocol]="https:",this.deployEnvironment[DeployVariable.APIHost]="//api.moo.do")},getKBSize:function getKBSizeFn(){return!this.app&&this.android?0:this.kbsize?this.kbsize:Math.ceil(window.innerHeight/2)},setKBSize:function setKBSizeFn(size){this.kbsize=parseInt(size)},getLocaleInfo:function getLocaleInfoFn(obj){try{obj.lang=navigator.language||navigator.userLanguage}catch(err){obj.lang="EXCEPTION"}},getPlatformInfo:function getPlatformInfoFn(obj){obj.os=this.OSName,obj.browser=this.browser,obj.majorVersion=this.majorVersion,obj.minorVersion=this.minorVersion,obj.appVersionRequired=this.versionRequired[this.appPlatform],obj.app=this.app,obj.appPlatform=this.appPlatform,obj.standalone=this.standalone,obj.packagedApp=this.packagedApp,obj.requireCustomRedirect=this.requireCustomRedirect,obj.isMobile=this.mobile,obj.isMobileBrowser=this.isMobileBrowser,obj.isPhone=this.phone,obj.isTouch=this.touch,obj.isTouchDevice=this.isTouchDevice,obj.usePointerEvents=this.usePointerEvents,obj.kbsize=this.kbsize,obj.appState=this.appState,obj.isHosted=this.isHosted,obj.hostedBy=this.hostedBy,obj.embed=this.embed,obj.bodyClass=this.b.className,obj.rawUA=navigator.userAgent,obj.referrer=document.referrer,obj.devicePixelRatio=window.devicePixelRatio,this.getLocaleInfo(obj)},getUserPlatformConfig:function getUserPlatformConfigFn(obj){var pConfig=PlatformConfig.Unknown;if(this.app)switch(this.appPlatform){case AppPlatform.iOS:pConfig=PlatformConfig.iOSApp;break;case AppPlatform.Android:pConfig=PlatformConfig.AndroidApp;break;case AppPlatform.WinPhone:pConfig=PlatformConfig.WinPhoneApp;break;case AppPlatform.Chrome:pConfig=PlatformConfig.ChromeApp;break;case AppPlatform.Embed:pConfig=this.mobile?PlatformConfig.EmbedMobileApp:PlatformConfig.EmbedDesktopApp}else switch(this.OSName){case"Windows":pConfig=this.phone?PlatformConfig.WinPhoneBrowser:PlatformConfig.DesktopWindows;break;case"iPad":case"iPod":case"iPhone":pConfig=PlatformConfig.iOSBrowser;break;case"MacOS":pConfig=PlatformConfig.DesktopMac;break;case"Android":pConfig=PlatformConfig.AndroidBrowser;break;case"Linux":default:pConfig=this.phone?PlatformConfig.MobileOther:PlatformConfig.DesktopOther}obj.platformConfig=pConfig},init:function initFn(){this.initAppState(),this.initHostState();var userAgent=navigator.userAgent,bodyClass="";if(this.OSName="Unknown OS",this.app&&(bodyClass+=" app"),-1!==userAgent.indexOf("Win")?(this.OSName="Windows",this.windows=!0,-1!==userAgent.indexOf("Windows Phone")&&(this.phone=!0,this.touch=!0,this.mobile=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.WinPhone],this.app&&(this.appPlatform=AppPlatform.WinPhone))):-1!==userAgent.indexOf("iPad")?(this.OSName="iPad",this.ios=!0,this.ipad=!0,this.phone=!0,this.touch=!0,this.mobile=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.iOS],this.app&&(this.appPlatform=AppPlatform.iOS)):-1!==userAgent.indexOf("iPhone")?(this.OSName="iPhone",this.ios=!0,this.iphone=!0,this.phone=!0,this.mobile=!0,this.touch=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.iOS],this.app&&(this.appPlatform=AppPlatform.iOS)):-1!==userAgent.indexOf("iPod")?(this.OSName="iPod",this.ios=!0,this.ipod=!0,this.phone=!0,this.mobile=!0,this.touch=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.iOS],this.app&&(this.appPlatform=AppPlatform.iOS)):-1!==userAgent.indexOf("Mac")?(this.OSName="MacOS",this.mac=!0):-1!==userAgent.indexOf("X11")?(this.OSName="UNIX",this.unix=!0):-1!==userAgent.indexOf("Android")?(this.OSName="Android",this.android=!0,this.touch=!0,this.mobile=!0,this.phone=!0,this.appStoreLink=this.appStoreLinks[AppPlatform.Android],this.app&&(this.appPlatform=AppPlatform.Android),bodyClass+=" android"):-1!==userAgent.indexOf("Linux")&&(this.OSName="Linux",this.linux=!0),this.ios){this.ios7=-1!==userAgent.indexOf("OS 7"),this.ios70=-1!==userAgent.indexOf("OS 7_0"),this.ios71=-1!==userAgent.indexOf("OS 7_1");var webview=this.appState&&this.appState.webview;"ioswk"===webview?this.ioswk=!0:this.iosui=!0,this.ios7&&(bodyClass+=" ios7")}if(this.majorVersion=1e3,this.minorVersion=1e3,-1!==userAgent.indexOf("MSIE")||-1!==userAgent.indexOf("Trident")){this.browser="Trident",this.ie=!0,this.winphone=!!userAgent.match(/IEMobile/i);var re;if(re=new RegExp(this.winphone||"Microsoft Internet Explorer"===navigator.appName?"MSIE ([0-9]{1,}[.0-9]{0,})":"Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!==re.exec(userAgent))this.majorVersion=parseFloat(RegExp.$1);else{var take2=new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})");null!==take2.exec(userAgent)&&(this.majorVersion=parseFloat(RegExp.$1))}}else if(-1!==userAgent.indexOf("Chrome")||-1!==userAgent.indexOf("CriOS")){this.browser="Chrome",this.isChrome=!0;var re=new RegExp("Chrome/([0-9]{1,}).");null!==re.exec(userAgent)&&(this.majorVersion=parseFloat(RegExp.$1)),-1!==userAgent.indexOf("Edge")&&(this.ieEdge=!0),this.app&&this.appPlatform!==AppPlatform.Android&&(this.appPlatform=AppPlatform.Chrome)}else if(-1!==userAgent.indexOf("Android")){this.browser="Native Android";var re=new RegExp("Linux; Android ([0-9]{1,}).([0-9]{1,}).");null!==re.exec(userAgent)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))}else if(-1!==userAgent.indexOf("Firefox")){this.browser="Firefox",this.isFirefox=!0;var re=new RegExp("Firefox/([0-9]{1,}).");null!==re.exec(userAgent)&&(this.majorVersion=parseFloat(RegExp.$1))}else if(-1!==userAgent.indexOf("Safari")||"iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName){this.browser="Safari",this.safari=!0;var re;re=new RegExp(this.mobile?"OS ([0-9]{1,})_([0-9]{1,})":"Version/([0-9]{1,}).([0-9]{1,})."),null!==re.exec(userAgent)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))}else-1!==userAgent.indexOf("Opera")&&(this.browser="Opera");this.appReviewLink=this.appReviewLinks[this.appPlatform],this.isTouchDevice=!!("ontouchstart"in window||window.navigator.msMaxTouchPoints),this.isMobileBrowser=this.checkMobileBrowser(),this.usePointerEvents=!!window.navigator.msPointerEnabled,this.isTouchDevice&&this.isMobileBrowser&&(this.usePointerEvents?(this.touchStartEvent="MSPointerDown",this.touchMoveEvent="MSPointerMove",this.touchEndEvent="MSPointerUp",this.touchCancelEvent="MSPointerCancel"):(this.touchStartEvent="touchstart",this.touchMoveEvent="touchmove",this.touchEndEvent="touchend",this.touchCancelEvent="touchcancel")),this.usePointerEvents?(this.downEvent="MSPointerDown",this.moveEvent="MSPointerMove",this.upEvent="MSPointerUp"):(this.downEvent="mousedown",this.moveEvent="mousemove",this.upEvent="mouseup"),util.hasURLParam("touch","false")?(this.touch=!1,this.phone=!1,this.mobile=!1,this.ios=!1,this.android=!1):(this.isTouchDevice&&this.isMobileBrowser||util.hasURLParam("touch","true"))&&(this.touch=!0,this.phone=!0,this.mobile=!0),this.windows&&(bodyClass+=" windows",this.ie&&(bodyClass+=" ie",this.demo||(this.mobro=this.isMobro()))),"Firefox"===this.browser&&(bodyClass+=" firefox",document.queryCommandEnabled("enableObjectResizing")&&document.execCommand("enableObjectResizing",!1,"false")),this.safari&&(bodyClass+=" safari"),this.phone&&(bodyClass+=" phone"),this.ipad&&(bodyClass+=" ipad"),this.embed===EmbedApps.Mailbird&&(bodyClass+=" mailbird"),this.demo&&(bodyClass+=" demoMode"),this.mobileie=this.ie&&this.mobile,this.mobile&&!this.app&&this.calcKeyboardSize(),this.isChrome&&this.app&&(this.isPackagedApp=!0),this.cmdChar=this.mac?"⌘":"ctrl",this.priModKey=this.mac?"⌘":"Ctrl",this.secModKey=this.app?this.priModKey:this.mac?"Ctrl":"Alt",this.noErrorStacks="iPad"===platform.OSName||"iPhone"===platform.OSName||"iPod"===platform.OSName,this.standalone=!!window.navigator.standalone||window.navigator.userAgent.indexOf("FluidApp")>=0,(this.standalone||this.app||this.mobro)&&(this.requireCustomRedirect=!0),bodyClass&&bodyClass.length>0&&(this.b.className+=bodyClass),this.transition=this.addPrefix("transition"),this.animation=this.addPrefix("animation"),this.transform=this.addPrefix("transform"),this.transformOrigin=this.addPrefix("transformOrigin"),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(callback){return window.setTimeout(callback,1e3/60)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame||window.oCancelAnimationFrame||function(id){clearTimeout(id)},this.ie&&(document.documentElement.addEventListener("MSHoldVisual",function(e){e.preventDefault()},!1),document.documentElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1)),document.documentElement.addEventListener("keydown",this.normalizeKeys,!0),document.documentElement.addEventListener("keypress",this.normalizeKeys,!0),document.documentElement.addEventListener("keyup",this.normalizeKeys,!0),document.documentElement.addEventListener(this.downEvent,this.normalizeMouse,!0),document.documentElement.addEventListener(this.moveEvent,this.normalizeMouse,!0),document.documentElement.addEventListener(this.upEvent,this.normalizeMouse,!0);var hidden,visibilitychange;"undefined"!=typeof document.hidden?(hidden="hidden",visibilitychange="visibilitychange"):["moz","ms","webkit"].forEach(function(v){return"undefined"!==document[v+"Hidden"]?(hidden=v+"Hidden",visibilitychange=v+"visibilitychange",!1):void 0}),void 0!==hidden&&(this.pageVisibilityHidden=hidden,this.pageVisibilityChange=visibilitychange)},forceEnableNotifications:function forceEnableNotificationsFn(){this.forceNotifications=!0},forceDisableNotifications:function forceDisableNotificationsFn(){this.forceNotifications=!1},supportsNotifications:function supportsNotificationsFn(){var doesSupport=!1;return this.forceNotifications?doesSupport=!0:this.forceNotifications!==!1&&(this.app?(this.ios||this.android||this.isChrome)&&(doesSupport=!0):this.embed===EmbedApps.Mailbird&&(doesSupport=!0)),doesSupport},isMobro:function isMobroFn(){var supported=null,errorName;try{new ActiveXObject("")}catch(e){errorName=e.name}try{supported=!!new ActiveXObject("htmlfile")}catch(e){supported=!1}return supported="ReferenceError"!==errorName&&supported===!1?!1:!0,!supported},calcKeyboardSize:function calcKeyboardSizeFn(){this.ios?this.iphone||this.ipod?(this.kbsizePortrait=216,this.kbsizeLandscape=162,this.ios71&&(this.kbsizePortrait+=44,this.kbsizeLandscape+=44)):this.ipad&&(this.kbsizePortrait=264,this.kbsizeLandscape=352,this.kbsizePortrait+=44,this.kbsizeLandscape+=44):this.android?(this.kbsizePortrait=Math.ceil(window.innerHeight/2.5),this.kbsizeLandscape=Math.ceil(window.innerWidth/2)):this.mobileie&&(this.kbsizePortrait=226,this.kbsizeLandscape=200)},normalizeKeys:function normalizeKeysFn(ev){void 0===ev.normCode&&(ev.normCode=null===ev.keyCode||0===ev.keyCode?null!==ev.charCode?ev.charCode:ev.which:ev.keyCode,46===ev.normCode&&"keypress"===ev.type&&(ev.normCode=190))},normalizeMouse:function normalizeMouseFn(ev){ev.hasOwnProperty("srcElement")||(ev.srcElement=ev.target)},initAppState:function initAppStateFn(){var appState=location.hash.substring(1);if(appState)for(var regex=/([^&=]+)=([^&]*)/g,m;null!==(m=regex.exec(appState));)if("state"===decodeURIComponent(m[1])){var uri=decodeURIComponent(m[2]);if(uri){try{appState=JSON.parse(uri)}catch(err){log("Error parsing AppState: ",uri),appState=void 0}appState&&(this.app=appState.app===!0,this.appv=appState.appv,this.debugApp=appState.debug,this.live=appState.live,this.offline=appState.offline,this.syncContacts=appState.syncContacts,this.test=appState.test,this.embed=appState.embed,this.appState=appState)}break}this.live=this.live||util.hasURLParam("live","true"),this.test=!1,this.offline=this.offline||this.test||util.hasURLParam("offline","true")||!1,this.demo=util.hasURLParam("demo","true")||!1,this.script=util.hasURLParam("script")&&!util.hasURLParam("script","none")},checkMobileBrowser:function checkMobileBrowserFn(){var check=!1;if(!this.embed&&(function(a){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))&&(check=!0)}(navigator.userAgent||navigator.vendor||window.opera),!check)){var mediaQuery="(max-device-width: 620px)";window.matchMedia&&window.matchMedia(mediaQuery).matches&&(check=!0)}return check},initHostState:function initHostStateFn(){try{this.isHosted=window.self!==window.top}catch(e){this.isHosted=!0}this.isHosted&&(this.hostedBy=document.referrer)},addPrefix:function addPrefixFn(p){var prefix="",v=["ms","webkit","moz","o"],s=this.b.style;if("string"==typeof s[p])prefix="";else for(var i=0;i<v.length;i++)if("string"==typeof s["-"+v[i]+"-"+p]){prefix=v[i];break}var styleString=prefix.length>0?p.charAt(0).toUpperCase()+p.slice(1):p;if(prefix){var reactPrefix=prefix.length>0?prefix.charAt(0).toUpperCase()+prefix.slice(1):p;return{prop:"-"+prefix+"-"+p,style:prefix+styleString,react:reactPrefix+styleString}}return{prop:p,style:styleString,react:styleString}},blockClient:function blockClientFn(){switch(this.browser){case"Firefox":if(this.majorVersion<16)return{platform:"Firefox",browser:this.browser,update:!0};break;case"Chrome":if(this.majorVersion<26)return{platform:"Chrome",browser:this.browser,update:!0};break;case"Native Android":if(this.majorVersion<4)return{platform:"Native Android",browser:"NativeAndroid",update:!0};break;case"Opera":return{platform:this.browser,browser:this.browser,update:!1};case"Trident":if(this.majorVersion<10)return{platform:"Internet Explorer",browser:this.browser,update:!0};break;case"Safari":if(this.mobile&&this.majorVersion<6)return{platform:"Safari",browser:this.browser,update:!0};if(!this.mobile&&(6===this.majorVersion&&this.minorVersion<1||this.majorVersion<6))return{platform:"Safari",browser:this.browser,update:!0}}if(this.app){if(this.appv<this.versionRequired[this.appPlatform])return log("App Version out of date."),{version:this.versionRequired[this.appPlatform]};if(this.appv>this.versionAvailable[this.appPlatform])return log("App is newer than the javascript, forcing an app cache update: "+this.appv+" vs. "+this.versionAvailable[this.appPlatform]),{cacheUpdate:!0,error:!1}}if("1441572654863"!==document.body.getAttribute("ver")){var cErr=util.hasURLParam("cacheError");if(require(["globals"],function(g){g.reportError(new Error("VersionMismatch, CacheError: "+cErr)),!cErr&&this.app&&g.nativeBridge.sendToApp("resetCache")}.bind(this)),!cErr)return{cacheUpdate:!0,error:!0}}},actionVerb:function actionVerbFn(){return this.touch?"tap":"click"},actionVerbCaps:function actionVerbCapsFn(){return this.touch?"Tap":"Click"},updateOrientation:function updateOrientationFn(){var orientation=90===Math.abs(window.orientation)?Orientation.Landscape:Orientation.Portrait;return this.orientation===Orientation.Portrait&&(this.hasBeenPortrait=!0),this.orientation=orientation,this.app||(this.kbsize=this.orientation===Orientation.Portrait?this.kbsizePortrait:this.kbsizeLandscape),this.orientation},isPageVisible:function isPageVisibleFn(){return!this.pageVisibilityHidden||!document[this.pageVisibilityHidden]},getUpdateMessages:function getUpdateMessagesFn(prevVersion){for(var ret=[],versionName=this.mobile?"versionMobile":"versionDesktop",i=(prevVersion||0)+1;i<=this[versionName];i++)ret.push(this[versionName+"Messages"][i]);return ret}},new platform}),function(window,document,Math){function IScroll(el,options){this.wrapper="string"==typeof el?document.querySelector(el):el,this.scroller=this.wrapper.children[0],this.scrollerStyle=this.scroller.style,this.options={resizeScrollbars:!0,mouseWheelSpeed:20,snapThreshold:.334,startX:0,startY:0,scrollY:!0,directionLockThreshold:5,momentum:!0,bounce:!0,bounceTime:600,bounceEasing:"",preventDefault:!0,preventDefaultException:{tagName:/^(INPUT|TEXTAREA|BUTTON|SELECT)$/},HWCompositing:!0,useTransition:!0,useTransform:!0};for(var i in options)this.options[i]=options[i];this.translateZ=this.options.HWCompositing&&utils.hasPerspective?" translateZ(0)":"",this.options.useTransition=utils.hasTransition&&this.options.useTransition,this.options.useTransform=utils.hasTransform&&this.options.useTransform,this.options.eventPassthrough=this.options.eventPassthrough===!0?"vertical":this.options.eventPassthrough,this.options.preventDefault=!this.options.eventPassthrough&&this.options.preventDefault,this.options.scrollY="vertical"==this.options.eventPassthrough?!1:this.options.scrollY,this.options.scrollX="horizontal"==this.options.eventPassthrough?!1:this.options.scrollX,this.options.freeScroll=this.options.freeScroll&&!this.options.eventPassthrough,this.options.directionLockThreshold=this.options.eventPassthrough?0:this.options.directionLockThreshold,this.options.bounceEasing="string"==typeof this.options.bounceEasing?utils.ease[this.options.bounceEasing]||utils.ease.circular:this.options.bounceEasing,this.options.resizePolling=void 0===this.options.resizePolling?60:this.options.resizePolling,this.options.tap===!0&&(this.options.tap="tap"),"scale"==this.options.shrinkScrollbars&&(this.options.useTransition=!1),this.options.invertWheelDirection=this.options.invertWheelDirection?-1:1,3==this.options.probeType&&(this.options.useTransition=!1),this.x=0,this.y=0,this.directionX=0,this.directionY=0,this._events={},this._init(),this.refresh(),this.scrollTo(this.options.startX,this.options.startY),this.enable()}function createDefaultScrollbar(direction,interactive,type){var scrollbar=document.createElement("div"),indicator=document.createElement("div");return type===!0&&(scrollbar.style.cssText="position:absolute;z-index:9999",indicator.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);border-radius:3px"),indicator.className="iScrollIndicator","h"==direction?(type===!0&&(scrollbar.style.cssText+=";height:7px;left:2px;right:2px;bottom:0",indicator.style.height="100%"),scrollbar.className="iScrollHorizontalScrollbar"):(type===!0&&(scrollbar.style.cssText+=";width:7px;bottom:2px;top:2px;right:1px",indicator.style.width="100%"),scrollbar.className="iScrollVerticalScrollbar"),scrollbar.style.cssText+=";overflow:hidden",interactive||(scrollbar.style.pointerEvents="none"),scrollbar.appendChild(indicator),scrollbar}function Indicator(scroller,options){this.wrapper="string"==typeof options.el?document.querySelector(options.el):options.el,this.wrapperStyle=this.wrapper.style,this.indicator=this.wrapper.children[0],this.indicatorStyle=this.indicator.style,this.scroller=scroller,this.options={listenX:!0,listenY:!0,interactive:!1,resize:!0,defaultScrollbars:!1,shrink:!1,fade:!1,speedRatioX:0,speedRatioY:0};for(var i in options)this.options[i]=options[i];this.sizeRatioX=1,this.sizeRatioY=1,this.maxPosX=0,this.maxPosY=0,this.options.interactive&&(this.options.disableTouch||(utils.addEvent(this.indicator,"touchstart",this),utils.addEvent(window,"touchend",this)),this.options.disablePointer||(utils.addEvent(this.indicator,utils.prefixPointerEvent("pointerdown"),this),utils.addEvent(window,utils.prefixPointerEvent("pointerup"),this)),this.options.disableMouse||(utils.addEvent(this.indicator,"mousedown",this),utils.addEvent(window,"mouseup",this))),this.options.fade&&(this.wrapperStyle[utils.style.transform]=this.scroller.translateZ,this.wrapperStyle[utils.style.transitionDuration]=utils.isBadAndroid?"0.001s":"0ms",this.wrapperStyle.opacity="0")}var rAF=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){window.setTimeout(callback,1e3/60)},utils=function(){function _prefixStyle(style){return _vendor===!1?!1:""===_vendor?style:_vendor+style.charAt(0).toUpperCase()+style.substr(1)}var me={},_elementStyle=document.createElement("div").style,_vendor=function(){for(var vendors=["t","webkitT","MozT","msT","OT"],transform,i=0,l=vendors.length;l>i;i++)if(transform=vendors[i]+"ransform",transform in _elementStyle)return vendors[i].substr(0,vendors[i].length-1);return!1}();me.getTime=Date.now||function getTime(){return(new Date).getTime()},me.extend=function(target,obj){for(var i in obj)target[i]=obj[i]},me.addEvent=function(el,type,fn,capture){el.addEventListener(type,fn,!!capture)},me.removeEvent=function(el,type,fn,capture){el.removeEventListener(type,fn,!!capture)},me.prefixPointerEvent=function(pointerEvent){return window.MSPointerEvent?"MSPointer"+pointerEvent.charAt(9).toUpperCase()+pointerEvent.substr(10):pointerEvent},me.momentum=function(current,start,time,lowerMargin,wrapperSize,deceleration){var distance=current-start,speed=Math.abs(distance)/time,destination,duration;return deceleration=void 0===deceleration?6e-4:deceleration,destination=current+speed*speed/(2*deceleration)*(0>distance?-1:1),duration=speed/deceleration,lowerMargin>destination?(destination=wrapperSize?lowerMargin-wrapperSize/2.5*(speed/8):lowerMargin,distance=Math.abs(destination-current),duration=distance/speed):destination>0&&(destination=wrapperSize?wrapperSize/2.5*(speed/8):0,distance=Math.abs(current)+destination,duration=distance/speed),{destination:Math.round(destination),duration:duration}};var _transform=_prefixStyle("transform");return me.extend(me,{hasTransform:_transform!==!1,hasPerspective:_prefixStyle("perspective")in _elementStyle,hasTouch:"ontouchstart"in window,hasPointer:window.PointerEvent||window.MSPointerEvent,hasTransition:_prefixStyle("transition")in _elementStyle}),me.isBadAndroid=/Android /.test(window.navigator.appVersion)&&!/Chrome\/\d/.test(window.navigator.appVersion),me.extend(me.style={},{transform:_transform,transitionTimingFunction:_prefixStyle("transitionTimingFunction"),transitionDuration:_prefixStyle("transitionDuration"),transitionDelay:_prefixStyle("transitionDelay"),transformOrigin:_prefixStyle("transformOrigin")}),me.hasClass=function(e,c){var re=new RegExp("(^|\\s)"+c+"(\\s|$)");return re.test(e.className)},me.addClass=function(e,c){if(!me.hasClass(e,c)){var newclass=e.className.split(" ");newclass.push(c),e.className=newclass.join(" ")}},me.removeClass=function(e,c){if(me.hasClass(e,c)){var re=new RegExp("(^|\\s)"+c+"(\\s|$)","g");e.className=e.className.replace(re," ")
}},me.offset=function(el){for(var left=-el.offsetLeft,top=-el.offsetTop;el=el.offsetParent;)left-=el.offsetLeft,top-=el.offsetTop;return{left:left,top:top}},me.preventDefaultException=function(el,exceptions){for(var i in exceptions)if(exceptions[i].test(el[i]))return!0;return!1},me.extend(me.eventType={},{touchstart:1,touchmove:1,touchend:1,mousedown:2,mousemove:2,mouseup:2,pointerdown:3,pointermove:3,pointerup:3,MSPointerDown:3,MSPointerMove:3,MSPointerUp:3}),me.extend(me.ease={},{quadratic:{style:"cubic-bezier(0.25, 0.46, 0.45, 0.94)",fn:function(k){return k*(2-k)}},circular:{style:"cubic-bezier(0.1, 0.57, 0.1, 1)",fn:function(k){return Math.sqrt(1- --k*k)}},back:{style:"cubic-bezier(0.175, 0.885, 0.32, 1.275)",fn:function(k){var b=4;return(k-=1)*k*((b+1)*k+b)+1}},bounce:{style:"",fn:function(k){return(k/=1)<1/2.75?7.5625*k*k:2/2.75>k?7.5625*(k-=1.5/2.75)*k+.75:2.5/2.75>k?7.5625*(k-=2.25/2.75)*k+.9375:7.5625*(k-=2.625/2.75)*k+.984375}},elastic:{style:"",fn:function(k){var f=.22,e=.4;return 0===k?0:1==k?1:e*Math.pow(2,-10*k)*Math.sin(2*(k-f/4)*Math.PI/f)+1}}}),me.tap=function(e,eventName){var ev=document.createEvent("Event");ev.initEvent(eventName,!0,!0),ev.pageX=e.pageX,ev.pageY=e.pageY,e.target.dispatchEvent(ev)},me.click=function(e){var target=e.target,ev;/(SELECT|INPUT|TEXTAREA)/i.test(target.tagName)||(ev=document.createEvent("MouseEvents"),ev.initMouseEvent("click",!0,!0,e.view,1,target.screenX,target.screenY,target.clientX,target.clientY,e.ctrlKey,e.altKey,e.shiftKey,e.metaKey,0,null),ev._constructed=!0,target.dispatchEvent(ev))},me}();IScroll.prototype={version:"5.1.3",_init:function(){this._initEvents(),(this.options.scrollbars||this.options.indicators)&&this._initIndicators(),this.options.mouseWheel&&this._initWheel(),this.options.snap&&this._initSnap(),this.options.keyBindings&&this._initKeys()},destroy:function(){this._initEvents(!0),this._execEvent("destroy")},_transitionEnd:function(e){e.target==this.scroller&&this.isInTransition&&(this._transitionTime(),this.resetPosition(this.options.bounceTime)||(this.isInTransition=!1,this._execEvent("scrollEnd")))},_start:function(e){if(!(1!=utils.eventType[e.type]&&0!==e.button||!this.enabled||this.initiated&&utils.eventType[e.type]!==this.initiated)){!this.options.preventDefault||utils.isBadAndroid||utils.preventDefaultException(e.target,this.options.preventDefaultException)||e.preventDefault();var point=e.touches?e.touches[0]:e,pos;this.initiated=utils.eventType[e.type],this.moved=!1,this.distX=0,this.distY=0,this.directionX=0,this.directionY=0,this.directionLocked=0,this._transitionTime(),this.startTime=utils.getTime(),this.options.useTransition&&this.isInTransition?(this.isInTransition=!1,pos=this.getComputedPosition(),this._translate(Math.round(pos.x),Math.round(pos.y)),this._execEvent("scrollEnd")):!this.options.useTransition&&this.isAnimating&&(this.isAnimating=!1,this._execEvent("scrollEnd")),this.startX=this.x,this.startY=this.y,this.absStartX=this.x,this.absStartY=this.y,this.pointX=point.pageX,this.pointY=point.pageY,this._execEvent("beforeScrollStart")}},_move:function(e){if(this.enabled&&utils.eventType[e.type]===this.initiated){this.options.preventDefault&&e.preventDefault();var point=e.touches?e.touches[0]:e,deltaX=point.pageX-this.pointX,deltaY=point.pageY-this.pointY,timestamp=utils.getTime(),newX,newY,absDistX,absDistY;if(this.pointX=point.pageX,this.pointY=point.pageY,this.distX+=deltaX,this.distY+=deltaY,absDistX=Math.abs(this.distX),absDistY=Math.abs(this.distY),!(timestamp-this.endTime>300&&10>absDistX&&10>absDistY)){if(this.directionLocked||this.options.freeScroll||(this.directionLocked=absDistX>absDistY+this.options.directionLockThreshold?"h":absDistY>=absDistX+this.options.directionLockThreshold?"v":"n"),"h"==this.directionLocked){if("vertical"==this.options.eventPassthrough)e.preventDefault();else if("horizontal"==this.options.eventPassthrough)return void(this.initiated=!1);deltaY=0}else if("v"==this.directionLocked){if("horizontal"==this.options.eventPassthrough)e.preventDefault();else if("vertical"==this.options.eventPassthrough)return void(this.initiated=!1);deltaX=0}deltaX=this.hasHorizontalScroll?deltaX:0,deltaY=this.hasVerticalScroll?deltaY:0,newX=this.x+deltaX,newY=this.y+deltaY,(newX>0||newX<this.maxScrollX)&&(newX=this.options.bounce?this.x+deltaX/3:newX>0?0:this.maxScrollX),(newY>0||newY<this.maxScrollY)&&(newY=this.options.bounce?this.y+deltaY/3:newY>0?0:this.maxScrollY),this.directionX=deltaX>0?-1:0>deltaX?1:0,this.directionY=deltaY>0?-1:0>deltaY?1:0,this.moved||this._execEvent("scrollStart"),this.moved=!0,this._translate(newX,newY),timestamp-this.startTime>300&&(this.startTime=timestamp,this.startX=this.x,this.startY=this.y,1==this.options.probeType&&this._execEvent("scroll")),this.options.probeType>1&&this._execEvent("scroll")}}},_end:function(e){if(this.enabled&&utils.eventType[e.type]===this.initiated){this.options.preventDefault&&!utils.preventDefaultException(e.target,this.options.preventDefaultException)&&e.preventDefault();var point=e.changedTouches?e.changedTouches[0]:e,momentumX,momentumY,duration=utils.getTime()-this.startTime,newX=Math.round(this.x),newY=Math.round(this.y),distanceX=Math.abs(newX-this.startX),distanceY=Math.abs(newY-this.startY),time=0,easing="";if(this.isInTransition=0,this.initiated=0,this.endTime=utils.getTime(),!this.resetPosition(this.options.bounceTime)){if(this.scrollTo(newX,newY),!this.moved)return this.options.tap&&utils.tap(e,this.options.tap),this.options.click&&utils.click(e),void this._execEvent("scrollCancel");if(this._events.flick&&200>duration&&100>distanceX&&100>distanceY)return void this._execEvent("flick");if(this.options.momentum&&300>duration&&(momentumX=this.hasHorizontalScroll?utils.momentum(this.x,this.startX,duration,this.maxScrollX,this.options.bounce?this.wrapperWidth:0,this.options.deceleration):{destination:newX,duration:0},momentumY=this.hasVerticalScroll?utils.momentum(this.y,this.startY,duration,this.maxScrollY,this.options.bounce?this.wrapperHeight:0,this.options.deceleration):{destination:newY,duration:0},newX=momentumX.destination,newY=momentumY.destination,time=Math.max(momentumX.duration,momentumY.duration),this.isInTransition=1),this.options.snap){var snap=this._nearestSnap(newX,newY);this.currentPage=snap,time=this.options.snapSpeed||Math.max(Math.max(Math.min(Math.abs(newX-snap.x),1e3),Math.min(Math.abs(newY-snap.y),1e3)),300),newX=snap.x,newY=snap.y,this.directionX=0,this.directionY=0,easing=this.options.bounceEasing}return newX!=this.x||newY!=this.y?((newX>0||newX<this.maxScrollX||newY>0||newY<this.maxScrollY)&&(easing=utils.ease.quadratic),void this.scrollTo(newX,newY,time,easing)):void this._execEvent("scrollEnd")}}},resetPosition:function(time){var x=this.x,y=this.y;return time=time||0,!this.hasHorizontalScroll||this.x>0?x=0:this.x<this.maxScrollX&&(x=this.maxScrollX),!this.hasVerticalScroll||this.y>0?y=0:this.y<this.maxScrollY&&(y=this.maxScrollY),x==this.x&&y==this.y?!1:(this.scrollTo(x,y,time,this.options.bounceEasing),!0)},disable:function(){this.enabled=!1},enable:function(){this.enabled=!0},refresh:function(){var rf=this.wrapper.offsetHeight;this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=this.scroller.offsetWidth,this.scrollerHeight=this.scroller.offsetHeight,this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=utils.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()},manualRefresh:function(forceHeight){var rf=this.wrapper.offsetHeight;this.wrapperWidth=this.wrapper.clientWidth,this.wrapperHeight=this.wrapper.clientHeight,this.scrollerWidth=this.wrapperWidth,this.scrollerHeight=forceHeight,this.maxScrollX=this.wrapperWidth-this.scrollerWidth,this.maxScrollY=this.wrapperHeight-this.scrollerHeight,this.hasHorizontalScroll=this.options.scrollX&&this.maxScrollX<0,this.hasVerticalScroll=this.options.scrollY&&this.maxScrollY<0,this.hasHorizontalScroll||(this.maxScrollX=0,this.scrollerWidth=this.wrapperWidth),this.hasVerticalScroll||(this.maxScrollY=0,this.scrollerHeight=this.wrapperHeight),this.endTime=0,this.directionX=0,this.directionY=0,this.wrapperOffset=utils.offset(this.wrapper),this._execEvent("refresh"),this.resetPosition()},on:function(type,fn){this._events[type]||(this._events[type]=[]),this._events[type].push(fn)},off:function(type,fn){if(this._events[type]){var index=this._events[type].indexOf(fn);index>-1&&this._events[type].splice(index,1)}},_execEvent:function(type){if(this._events[type]){var i=0,l=this._events[type].length;if(l)for(;l>i;i++)this._events[type][i].apply(this,[].slice.call(arguments,1))}},scrollBy:function(x,y,time,easing){x=this.x+x,y=this.y+y,time=time||0,this.scrollTo(x,y,time,easing)},scrollTo:function(x,y,time,easing){easing=easing||utils.ease.circular,this.isInTransition=this.options.useTransition&&time>0,!time||this.options.useTransition&&easing.style?(this._transitionTimingFunction(easing.style),this._transitionTime(time),this._translate(x,y)):this._animate(x,y,time,easing.fn)},scrollToElement:function(el,time,offsetX,offsetY,easing){if(el=el.nodeType?el:this.scroller.querySelector(el)){var pos=utils.offset(el);pos.left-=this.wrapperOffset.left,pos.top-=this.wrapperOffset.top,offsetX===!0&&(offsetX=Math.round(el.offsetWidth/2-this.wrapper.offsetWidth/2)),offsetY===!0&&(offsetY=Math.round(el.offsetHeight/2-this.wrapper.offsetHeight/2)),pos.left-=offsetX||0,pos.top-=offsetY||0,pos.left=pos.left>0?0:pos.left<this.maxScrollX?this.maxScrollX:pos.left,pos.top=pos.top>0?0:pos.top<this.maxScrollY?this.maxScrollY:pos.top,time=void 0===time||null===time||"auto"===time?Math.max(Math.abs(this.x-pos.left),Math.abs(this.y-pos.top)):time,this.scrollTo(pos.left,pos.top,time,easing)}},_transitionTime:function(time){if(time=time||0,this.scrollerStyle[utils.style.transitionDuration]=time+"ms",!time&&utils.isBadAndroid&&(this.scrollerStyle[utils.style.transitionDuration]="0.001s"),this.indicators)for(var i=this.indicators.length;i--;)this.indicators[i].transitionTime(time)},_transitionTimingFunction:function(easing){if(this.scrollerStyle[utils.style.transitionTimingFunction]=easing,this.indicators)for(var i=this.indicators.length;i--;)this.indicators[i].transitionTimingFunction(easing)},_translate:function(x,y){if(this.options.useTransform?this.scrollerStyle[utils.style.transform]="translate("+x+"px,"+y+"px)"+this.translateZ:(x=Math.round(x),y=Math.round(y),this.scrollerStyle.left=x+"px",this.scrollerStyle.top=y+"px"),this.x=x,this.y=y,this.indicators)for(var i=this.indicators.length;i--;)this.indicators[i].updatePosition()},_initEvents:function(remove){var eventType=remove?utils.removeEvent:utils.addEvent,target=this.options.bindToWrapper?this.wrapper:window;this.options.click&&eventType(this.wrapper,"click",this,!0),this.options.disableMouse||(eventType(this.wrapper,"mousedown",this),eventType(target,"mousemove",this),eventType(target,"mousecancel",this),eventType(target,"mouseup",this)),utils.hasPointer&&!this.options.disablePointer&&(eventType(this.wrapper,utils.prefixPointerEvent("pointerdown"),this),eventType(target,utils.prefixPointerEvent("pointermove"),this),eventType(target,utils.prefixPointerEvent("pointercancel"),this),eventType(target,utils.prefixPointerEvent("pointerup"),this)),utils.hasTouch&&!this.options.disableTouch&&(eventType(this.wrapper,"touchstart",this),eventType(target,"touchmove",this),eventType(target,"touchcancel",this),eventType(target,"touchend",this)),eventType(this.scroller,"transitionend",this),eventType(this.scroller,"webkitTransitionEnd",this),eventType(this.scroller,"oTransitionEnd",this),eventType(this.scroller,"MSTransitionEnd",this)},getComputedPosition:function(){var matrix=window.getComputedStyle(this.scroller,null),x,y;return this.options.useTransform?(matrix=matrix[utils.style.transform].split(")")[0].split(", "),x=+(matrix[12]||matrix[4]),y=+(matrix[13]||matrix[5])):(x=+matrix.left.replace(/[^-\d.]/g,""),y=+matrix.top.replace(/[^-\d.]/g,"")),{x:x,y:y}},_initIndicators:function(){function _indicatorsMap(fn){for(var i=that.indicators.length;i--;)fn.call(that.indicators[i])}var interactive=this.options.interactiveScrollbars,customStyle="string"!=typeof this.options.scrollbars,indicators=[],indicator,that=this;this.indicators=[],this.options.scrollbars&&(this.options.scrollY&&(indicator={el:createDefaultScrollbar("v",interactive,this.options.scrollbars),interactive:interactive,defaultScrollbars:!0,customStyle:customStyle,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenX:!1},this.wrapper.appendChild(indicator.el),indicators.push(indicator)),this.options.scrollX&&(indicator={el:createDefaultScrollbar("h",interactive,this.options.scrollbars),interactive:interactive,defaultScrollbars:!0,customStyle:customStyle,resize:this.options.resizeScrollbars,shrink:this.options.shrinkScrollbars,fade:this.options.fadeScrollbars,listenY:!1},this.wrapper.appendChild(indicator.el),indicators.push(indicator))),this.options.indicators&&(indicators=indicators.concat(this.options.indicators));for(var i=indicators.length;i--;)this.indicators.push(new Indicator(this,indicators[i]));this.options.fadeScrollbars&&(this.on("scrollEnd",function(){_indicatorsMap(function(){this.fade()})}),this.on("scrollCancel",function(){_indicatorsMap(function(){this.fade()})}),this.on("scrollStart",function(){_indicatorsMap(function(){this.fade(1)})}),this.on("beforeScrollStart",function(){_indicatorsMap(function(){this.fade(1,!0)})})),this.on("refresh",function(){_indicatorsMap(function(){this.refresh()})}),this.on("destroy",function(){_indicatorsMap(function(){this.destroy()}),delete this.indicators})},_initWheel:function(){utils.addEvent(this.wrapper,"wheel",this),utils.addEvent(this.wrapper,"mousewheel",this),utils.addEvent(this.wrapper,"DOMMouseScroll",this),this.on("destroy",function(){utils.removeEvent(this.wrapper,"wheel",this),utils.removeEvent(this.wrapper,"mousewheel",this),utils.removeEvent(this.wrapper,"DOMMouseScroll",this)})},_wheel:function(e){if(this.enabled){e.preventDefault(),e.stopPropagation();var wheelDeltaX,wheelDeltaY,newX,newY,that=this;if(void 0===this.wheelTimeout&&that._execEvent("scrollStart"),clearTimeout(this.wheelTimeout),this.wheelTimeout=setTimeout(function(){that._execEvent("scrollEnd"),that.wheelTimeout=void 0},400),"deltaX"in e)1===e.deltaMode?(wheelDeltaX=-e.deltaX*this.options.mouseWheelSpeed,wheelDeltaY=-e.deltaY*this.options.mouseWheelSpeed):(wheelDeltaX=-e.deltaX,wheelDeltaY=-e.deltaY);else if("wheelDeltaX"in e)wheelDeltaX=e.wheelDeltaX/120*this.options.mouseWheelSpeed,wheelDeltaY=e.wheelDeltaY/120*this.options.mouseWheelSpeed;else if("wheelDelta"in e)wheelDeltaX=wheelDeltaY=e.wheelDelta/120*this.options.mouseWheelSpeed;else{if(!("detail"in e))return;wheelDeltaX=wheelDeltaY=-e.detail/3*this.options.mouseWheelSpeed}if(wheelDeltaX*=this.options.invertWheelDirection,wheelDeltaY*=this.options.invertWheelDirection,this.hasVerticalScroll||(wheelDeltaX=wheelDeltaY,wheelDeltaY=0),this.options.snap)return newX=this.currentPage.pageX,newY=this.currentPage.pageY,wheelDeltaX>0?newX--:0>wheelDeltaX&&newX++,wheelDeltaY>0?newY--:0>wheelDeltaY&&newY++,void this.goToPage(newX,newY);newX=this.x+Math.round(this.hasHorizontalScroll?wheelDeltaX:0),newY=this.y+Math.round(this.hasVerticalScroll?wheelDeltaY:0),newX>0?newX=0:newX<this.maxScrollX&&(newX=this.maxScrollX),newY>0?newY=0:newY<this.maxScrollY&&(newY=this.maxScrollY),this.scrollTo(newX,newY,0),this.options.probeType>1&&this._execEvent("scroll")}},_initSnap:function(){this.currentPage={},"string"==typeof this.options.snap&&(this.options.snap=this.scroller.querySelectorAll(this.options.snap)),this.on("refresh",function(){var i=0,l,m=0,n,cx,cy,x=0,y,stepX=this.options.snapStepX||this.wrapperWidth,stepY=this.options.snapStepY||this.wrapperHeight,el;if(this.pages=[],this.wrapperWidth&&this.wrapperHeight&&this.scrollerWidth&&this.scrollerHeight){if(this.options.snap===!0)for(cx=Math.round(stepX/2),cy=Math.round(stepY/2);x>-this.scrollerWidth;){for(this.pages[i]=[],l=0,y=0;y>-this.scrollerHeight;)this.pages[i][l]={x:Math.max(x,this.maxScrollX),y:Math.max(y,this.maxScrollY),width:stepX,height:stepY,cx:x-cx,cy:y-cy},y-=stepY,l++;x-=stepX,i++}else for(el=this.options.snap,l=el.length,n=-1;l>i;i++)(0===i||el[i].offsetLeft<=el[i-1].offsetLeft)&&(m=0,n++),this.pages[m]||(this.pages[m]=[]),x=Math.max(-el[i].offsetLeft,this.maxScrollX),y=Math.max(-el[i].offsetTop,this.maxScrollY),cx=x-Math.round(el[i].offsetWidth/2),cy=y-Math.round(el[i].offsetHeight/2),this.pages[m][n]={x:x,y:y,width:el[i].offsetWidth,height:el[i].offsetHeight,cx:cx,cy:cy},x>this.maxScrollX&&m++;this.goToPage(this.currentPage.pageX||0,this.currentPage.pageY||0,0),this.options.snapThreshold%1===0?(this.snapThresholdX=this.options.snapThreshold,this.snapThresholdY=this.options.snapThreshold):(this.snapThresholdX=Math.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].width*this.options.snapThreshold),this.snapThresholdY=Math.round(this.pages[this.currentPage.pageX][this.currentPage.pageY].height*this.options.snapThreshold))}}),this.on("flick",function(){var time=this.options.snapSpeed||Math.max(Math.max(Math.min(Math.abs(this.x-this.startX),1e3),Math.min(Math.abs(this.y-this.startY),1e3)),300);this.goToPage(this.currentPage.pageX+this.directionX,this.currentPage.pageY+this.directionY,time)})},_nearestSnap:function(x,y){if(!this.pages.length)return{x:0,y:0,pageX:0,pageY:0};var i=0,l=this.pages.length,m=0;if(Math.abs(x-this.absStartX)<this.snapThresholdX&&Math.abs(y-this.absStartY)<this.snapThresholdY)return this.currentPage;for(x>0?x=0:x<this.maxScrollX&&(x=this.maxScrollX),y>0?y=0:y<this.maxScrollY&&(y=this.maxScrollY);l>i;i++)if(x>=this.pages[i][0].cx){x=this.pages[i][0].x;break}for(l=this.pages[i].length;l>m;m++)if(y>=this.pages[0][m].cy){y=this.pages[0][m].y;break}return i==this.currentPage.pageX&&(i+=this.directionX,0>i?i=0:i>=this.pages.length&&(i=this.pages.length-1),x=this.pages[i][0].x),m==this.currentPage.pageY&&(m+=this.directionY,0>m?m=0:m>=this.pages[0].length&&(m=this.pages[0].length-1),y=this.pages[0][m].y),{x:x,y:y,pageX:i,pageY:m}},goToPage:function(x,y,time,easing){easing=easing||this.options.bounceEasing,x>=this.pages.length?x=this.pages.length-1:0>x&&(x=0),y>=this.pages[x].length?y=this.pages[x].length-1:0>y&&(y=0);var posX=this.pages[x][y].x,posY=this.pages[x][y].y;time=void 0===time?this.options.snapSpeed||Math.max(Math.max(Math.min(Math.abs(posX-this.x),1e3),Math.min(Math.abs(posY-this.y),1e3)),300):time,this.currentPage={x:posX,y:posY,pageX:x,pageY:y},this.scrollTo(posX,posY,time,easing)},next:function(time,easing){var x=this.currentPage.pageX,y=this.currentPage.pageY;x++,x>=this.pages.length&&this.hasVerticalScroll&&(x=0,y++),this.goToPage(x,y,time,easing)},prev:function(time,easing){var x=this.currentPage.pageX,y=this.currentPage.pageY;x--,0>x&&this.hasVerticalScroll&&(x=0,y--),this.goToPage(x,y,time,easing)},_initKeys:function(e){var keys={pageUp:33,pageDown:34,end:35,home:36,left:37,up:38,right:39,down:40},i;if("object"==typeof this.options.keyBindings)for(i in this.options.keyBindings)"string"==typeof this.options.keyBindings[i]&&(this.options.keyBindings[i]=this.options.keyBindings[i].toUpperCase().charCodeAt(0));else this.options.keyBindings={};for(i in keys)this.options.keyBindings[i]=this.options.keyBindings[i]||keys[i];utils.addEvent(window,"keydown",this),this.on("destroy",function(){utils.removeEvent(window,"keydown",this)})},_key:function(e){if(this.enabled){var snap=this.options.snap,newX=snap?this.currentPage.pageX:this.x,newY=snap?this.currentPage.pageY:this.y,now=utils.getTime(),prevTime=this.keyTime||0,acceleration=.25,pos;switch(this.options.useTransition&&this.isInTransition&&(pos=this.getComputedPosition(),this._translate(Math.round(pos.x),Math.round(pos.y)),this.isInTransition=!1),this.keyAcceleration=200>now-prevTime?Math.min(this.keyAcceleration+acceleration,50):0,e.keyCode){case this.options.keyBindings.pageUp:this.hasHorizontalScroll&&!this.hasVerticalScroll?newX+=snap?1:this.wrapperWidth:newY+=snap?1:this.wrapperHeight;break;case this.options.keyBindings.pageDown:this.hasHorizontalScroll&&!this.hasVerticalScroll?newX-=snap?1:this.wrapperWidth:newY-=snap?1:this.wrapperHeight;break;case this.options.keyBindings.end:newX=snap?this.pages.length-1:this.maxScrollX,newY=snap?this.pages[0].length-1:this.maxScrollY;break;case this.options.keyBindings.home:newX=0,newY=0;break;case this.options.keyBindings.left:newX+=snap?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.up:newY+=snap?1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.right:newX-=snap?-1:5+this.keyAcceleration>>0;break;case this.options.keyBindings.down:newY-=snap?1:5+this.keyAcceleration>>0;break;default:return}if(snap)return void this.goToPage(newX,newY);newX>0?(newX=0,this.keyAcceleration=0):newX<this.maxScrollX&&(newX=this.maxScrollX,this.keyAcceleration=0),newY>0?(newY=0,this.keyAcceleration=0):newY<this.maxScrollY&&(newY=this.maxScrollY,this.keyAcceleration=0),this.scrollTo(newX,newY,0),this.keyTime=now}},_animate:function(destX,destY,duration,easingFn){function step(){var now=utils.getTime(),newX,newY,easing;return now>=destTime?(that.isAnimating=!1,that._translate(destX,destY),void(that.resetPosition(that.options.bounceTime)||that._execEvent("scrollEnd"))):(now=(now-startTime)/duration,easing=easingFn(now),newX=(destX-startX)*easing+startX,newY=(destY-startY)*easing+startY,that._translate(newX,newY),that.isAnimating&&rAF(step),void(3==that.options.probeType&&that._execEvent("scroll")))}var that=this,startX=this.x,startY=this.y,startTime=utils.getTime(),destTime=startTime+duration;this.isAnimating=!0,step()},handleEvent:function(e){switch(e.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(e);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(e);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(e);break;case"transitionend":case"webkitTransitionEnd":case"oTransitionEnd":case"MSTransitionEnd":this._transitionEnd(e);break;case"wheel":case"DOMMouseScroll":case"mousewheel":this._wheel(e);break;case"keydown":this._key(e);break;case"click":e._constructed||(e.preventDefault(),e.stopPropagation())}}},Indicator.prototype={handleEvent:function(e){switch(e.type){case"touchstart":case"pointerdown":case"MSPointerDown":case"mousedown":this._start(e);break;case"touchmove":case"pointermove":case"MSPointerMove":case"mousemove":this._move(e);break;case"touchend":case"pointerup":case"MSPointerUp":case"mouseup":case"touchcancel":case"pointercancel":case"MSPointerCancel":case"mousecancel":this._end(e)}},destroy:function(){this.options.interactive&&(utils.removeEvent(this.indicator,"touchstart",this),utils.removeEvent(this.indicator,utils.prefixPointerEvent("pointerdown"),this),utils.removeEvent(this.indicator,"mousedown",this),utils.removeEvent(window,"touchmove",this),utils.removeEvent(window,utils.prefixPointerEvent("pointermove"),this),utils.removeEvent(window,"mousemove",this),utils.removeEvent(window,"touchend",this),utils.removeEvent(window,utils.prefixPointerEvent("pointerup"),this),utils.removeEvent(window,"mouseup",this)),this.options.defaultScrollbars&&this.wrapper.parentNode.removeChild(this.wrapper)},_start:function(e){var point=e.touches?e.touches[0]:e;e.preventDefault(),e.stopPropagation(),this.transitionTime(),this.initiated=!0,this.moved=!1,this.lastPointX=point.pageX,this.lastPointY=point.pageY,this.startTime=utils.getTime(),this.options.disableTouch||utils.addEvent(window,"touchmove",this),this.options.disablePointer||utils.addEvent(window,utils.prefixPointerEvent("pointermove"),this),this.options.disableMouse||utils.addEvent(window,"mousemove",this),this.scroller._execEvent("beforeScrollStart")},_move:function(e){var point=e.touches?e.touches[0]:e,deltaX,deltaY,newX,newY,timestamp=utils.getTime();this.moved||this.scroller._execEvent("scrollStart"),this.moved=!0,deltaX=point.pageX-this.lastPointX,this.lastPointX=point.pageX,deltaY=point.pageY-this.lastPointY,this.lastPointY=point.pageY,newX=this.x+deltaX,newY=this.y+deltaY,this._pos(newX,newY),1==this.scroller.options.probeType&&timestamp-this.startTime>300?(this.startTime=timestamp,this.scroller._execEvent("scroll")):this.scroller.options.probeType>1&&this.scroller._execEvent("scroll"),e.preventDefault(),e.stopPropagation()},_end:function(e){if(this.initiated){if(this.initiated=!1,e.preventDefault(),e.stopPropagation(),utils.removeEvent(window,"touchmove",this),utils.removeEvent(window,utils.prefixPointerEvent("pointermove"),this),utils.removeEvent(window,"mousemove",this),this.scroller.options.snap){var snap=this.scroller._nearestSnap(this.scroller.x,this.scroller.y),time=this.options.snapSpeed||Math.max(Math.max(Math.min(Math.abs(this.scroller.x-snap.x),1e3),Math.min(Math.abs(this.scroller.y-snap.y),1e3)),300);(this.scroller.x!=snap.x||this.scroller.y!=snap.y)&&(this.scroller.directionX=0,this.scroller.directionY=0,this.scroller.currentPage=snap,this.scroller.scrollTo(snap.x,snap.y,time,this.scroller.options.bounceEasing))}this.moved&&this.scroller._execEvent("scrollEnd")}},transitionTime:function(time){time=time||0,this.indicatorStyle[utils.style.transitionDuration]=time+"ms",!time&&utils.isBadAndroid&&(this.indicatorStyle[utils.style.transitionDuration]="0.001s")},transitionTimingFunction:function(easing){this.indicatorStyle[utils.style.transitionTimingFunction]=easing},refresh:function(){this.transitionTime(),this.indicatorStyle.display=this.options.listenX&&!this.options.listenY?this.scroller.hasHorizontalScroll?"block":"none":this.options.listenY&&!this.options.listenX?this.scroller.hasVerticalScroll?"block":"none":this.scroller.hasHorizontalScroll||this.scroller.hasVerticalScroll?"block":"none",this.scroller.hasHorizontalScroll&&this.scroller.hasVerticalScroll?(utils.addClass(this.wrapper,"iScrollBothScrollbars"),utils.removeClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="8px":this.wrapper.style.bottom="8px")):(utils.removeClass(this.wrapper,"iScrollBothScrollbars"),utils.addClass(this.wrapper,"iScrollLoneScrollbar"),this.options.defaultScrollbars&&this.options.customStyle&&(this.options.listenX?this.wrapper.style.right="2px":this.wrapper.style.bottom="2px"));var r=this.wrapper.offsetHeight;this.options.listenX&&(this.wrapperWidth=this.wrapper.clientWidth,this.options.resize?(this.indicatorWidth=Math.max(Math.round(this.wrapperWidth*this.wrapperWidth/(this.scroller.scrollerWidth||this.wrapperWidth||1)),8),this.indicatorStyle.width=this.indicatorWidth+"px"):this.indicatorWidth=this.indicator.clientWidth,this.maxPosX=this.wrapperWidth-this.indicatorWidth,"clip"==this.options.shrink?(this.minBoundaryX=-this.indicatorWidth+8,this.maxBoundaryX=this.wrapperWidth-8):(this.minBoundaryX=0,this.maxBoundaryX=this.maxPosX),this.sizeRatioX=this.options.speedRatioX||this.scroller.maxScrollX&&this.maxPosX/this.scroller.maxScrollX),this.options.listenY&&(this.wrapperHeight=this.wrapper.clientHeight,this.options.resize?(this.indicatorHeight=Math.max(Math.round(this.wrapperHeight*this.wrapperHeight/(this.scroller.scrollerHeight||this.wrapperHeight||1)),8),this.indicatorStyle.height=this.indicatorHeight+"px"):this.indicatorHeight=this.indicator.clientHeight,this.maxPosY=this.wrapperHeight-this.indicatorHeight,"clip"==this.options.shrink?(this.minBoundaryY=-this.indicatorHeight+8,this.maxBoundaryY=this.wrapperHeight-8):(this.minBoundaryY=0,this.maxBoundaryY=this.maxPosY),this.maxPosY=this.wrapperHeight-this.indicatorHeight,this.sizeRatioY=this.options.speedRatioY||this.scroller.maxScrollY&&this.maxPosY/this.scroller.maxScrollY),this.updatePosition()},updatePosition:function(){var x=this.options.listenX&&Math.round(this.sizeRatioX*this.scroller.x)||0,y=this.options.listenY&&Math.round(this.sizeRatioY*this.scroller.y)||0;this.options.ignoreBoundaries||(x<this.minBoundaryX?("scale"==this.options.shrink&&(this.width=Math.max(this.indicatorWidth+x,8),this.indicatorStyle.width=this.width+"px"),x=this.minBoundaryX):x>this.maxBoundaryX?"scale"==this.options.shrink?(this.width=Math.max(this.indicatorWidth-(x-this.maxPosX),8),this.indicatorStyle.width=this.width+"px",x=this.maxPosX+this.indicatorWidth-this.width):x=this.maxBoundaryX:"scale"==this.options.shrink&&this.width!=this.indicatorWidth&&(this.width=this.indicatorWidth,this.indicatorStyle.width=this.width+"px"),y<this.minBoundaryY?("scale"==this.options.shrink&&(this.height=Math.max(this.indicatorHeight+3*y,8),this.indicatorStyle.height=this.height+"px"),y=this.minBoundaryY):y>this.maxBoundaryY?"scale"==this.options.shrink?(this.height=Math.max(this.indicatorHeight-3*(y-this.maxPosY),8),this.indicatorStyle.height=this.height+"px",y=this.maxPosY+this.indicatorHeight-this.height):y=this.maxBoundaryY:"scale"==this.options.shrink&&this.height!=this.indicatorHeight&&(this.height=this.indicatorHeight,this.indicatorStyle.height=this.height+"px")),this.x=x,this.y=y,this.scroller.options.useTransform?this.indicatorStyle[utils.style.transform]="translate("+x+"px,"+y+"px)"+this.scroller.translateZ:(this.indicatorStyle.left=x+"px",this.indicatorStyle.top=y+"px")},_pos:function(x,y){0>x?x=0:x>this.maxPosX&&(x=this.maxPosX),0>y?y=0:y>this.maxPosY&&(y=this.maxPosY),x=this.options.listenX?Math.round(x/this.sizeRatioX):this.scroller.x,y=this.options.listenY?Math.round(y/this.sizeRatioY):this.scroller.y,this.scroller.scrollTo(x,y)},fade:function(val,hold){if(!hold||this.visible){clearTimeout(this.fadeTimeout),this.fadeTimeout=null;var time=val?250:500,delay=val?0:300;val=val?"1":"0",this.wrapperStyle[utils.style.transitionDuration]=time+"ms",this.fadeTimeout=setTimeout(function(val){this.wrapperStyle.opacity=val,this.visible=+val}.bind(this,val),delay)}}},IScroll.utils=utils,"undefined"!=typeof module&&module.exports?module.exports=IScroll:window.IScroll=IScroll}(window,document,Math),define("IScroll",function(global){return function(){var ret,fn;return ret||global.IScroll}}(this)),function(){var $D=Date,lang=Date.CultureStrings?Date.CultureStrings.lang:null,loggedKeys={},getText={getFromKey:function(key,countryCode){var output;return output=Date.CultureStrings&&Date.CultureStrings[countryCode]&&Date.CultureStrings[countryCode][key]?Date.CultureStrings[countryCode][key]:getText.buildFromDefault(key),"/"===key.charAt(0)&&(output=getText.buildFromRegex(key,countryCode)),output},getFromObjectValues:function(obj,countryCode){var key,output={};for(key in obj)obj.hasOwnProperty(key)&&(output[key]=getText.getFromKey(obj[key],countryCode));return output},getFromObjectKeys:function(obj,countryCode){var key,output={};for(key in obj)obj.hasOwnProperty(key)&&(output[getText.getFromKey(key,countryCode)]=obj[key]);return output},getFromArray:function(arr,countryCode){for(var output=[],i=0;i<arr.length;i++)i in arr&&(output[i]=getText.getFromKey(arr[i],countryCode));return output},buildFromDefault:function(key){var output,length,split,last;switch(key){case"name":output="en-US";break;case"englishName":output="English (United States)";break;case"nativeName":output="English (United States)";break;case"twoDigitYearMax":output=2049;break;case"firstDayOfWeek":output=0;break;default:output=key,split=key.split("_"),length=split.length,length>1&&"/"!==key.charAt(0)&&(last=split[length-1].toLowerCase(),("initial"===last||"abbr"===last)&&(output=split[0]))
}return output},buildFromRegex:function(key,countryCode){var output;return output=Date.CultureStrings&&Date.CultureStrings[countryCode]&&Date.CultureStrings[countryCode][key]?new RegExp(Date.CultureStrings[countryCode][key],"i"):new RegExp(key.replace(new RegExp("/","g"),""),"i")}},shallowMerge=function(obj1,obj2){for(var attrname in obj2)obj2.hasOwnProperty(attrname)&&(obj1[attrname]=obj2[attrname])},__=function(key,language){var countryCode=language?language:lang;return loggedKeys[key]=key,"object"==typeof key?key instanceof Array?getText.getFromArray(key,countryCode):getText.getFromObjectKeys(key,countryCode):getText.getFromKey(key,countryCode)},buildInfo={buildFromMethodHash:function(obj){var key;for(key in obj)obj.hasOwnProperty(key)&&(obj[key]=buildInfo[obj[key]]());return obj},timeZoneDST:function(){var DST={CHADT:"+1345",NZDT:"+1300",AEDT:"+1100",ACDT:"+1030",AZST:"+0500",IRDT:"+0430",EEST:"+0300",CEST:"+0200",BST:"+0100",PMDT:"-0200",ADT:"-0300",NDT:"-0230",EDT:"-0400",CDT:"-0500",MDT:"-0600",PDT:"-0700",AKDT:"-0800",HADT:"-0900"};return __(DST)},timeZoneStandard:function(){var standard={LINT:"+1400",TOT:"+1300",CHAST:"+1245",NZST:"+1200",NFT:"+1130",SBT:"+1100",AEST:"+1000",ACST:"+0930",JST:"+0900",CWST:"+0845",CT:"+0800",ICT:"+0700",MMT:"+0630",BST:"+0600",NPT:"+0545",IST:"+0530",PKT:"+0500",AFT:"+0430",MSK:"+0400",IRST:"+0330",FET:"+0300",EET:"+0200",CET:"+0100",GMT:"+0000",UTC:"+0000",CVT:"-0100",GST:"-0200",BRT:"-0300",NST:"-0330",AST:"-0400",EST:"-0500",CST:"-0600",MST:"-0700",PST:"-0800",AKST:"-0900",MIT:"-0930",HST:"-1000",SST:"-1100",BIT:"-1200"};return __(standard)},timeZones:function(data){var zone;data.timezones=[];for(zone in data.abbreviatedTimeZoneStandard)data.abbreviatedTimeZoneStandard.hasOwnProperty(zone)&&data.timezones.push({name:zone,offset:data.abbreviatedTimeZoneStandard[zone]});for(zone in data.abbreviatedTimeZoneDST)data.abbreviatedTimeZoneDST.hasOwnProperty(zone)&&data.timezones.push({name:zone,offset:data.abbreviatedTimeZoneDST[zone],dst:!0});return data.timezones},days:function(){return __(["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"])},dayAbbr:function(){return __(["Sun","Mon","Tue","Wed","Thu","Fri","Sat"])},dayShortNames:function(){return __(["Su","Mo","Tu","We","Th","Fr","Sa"])},dayFirstLetters:function(){return __(["S_Sun_Initial","M_Mon_Initial","T_Tues_Initial","W_Wed_Initial","T_Thu_Initial","F_Fri_Initial","S_Sat_Initial"])},months:function(){return __(["January","February","March","April","May","June","July","August","September","October","November","December"])},monthAbbr:function(){return __(["Jan_Abbr","Feb_Abbr","Mar_Abbr","Apr_Abbr","May_Abbr","Jun_Abbr","Jul_Abbr","Aug_Abbr","Sep_Abbr","Oct_Abbr","Nov_Abbr","Dec_Abbr"])},formatPatterns:function(){return getText.getFromObjectValues({shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss",monthDay:"MMMM dd",monthDayShortTime:"MM/dd",monthDayYear:"MM/dd/yy",yearMonth:"MMMM, yyyy"},Date.i18n.currentLanguage())},regex:function(){return getText.getFromObjectValues({thisMorning:"/(this )(morn(ing)?)\\b/",thisEvening:"/(this )(even(ing)?)\\b/",jan:"/jan(uary)?/",feb:"/feb(ruary)?/",mar:"/mar(ch)?/",apr:"/apr(il)?/",may:"/may/",jun:"/jun(e)?/",jul:"/jul(y)?/",aug:"/aug(ust)?/",sep:"/sep(t(ember)?)?/",oct:"/oct(ober)?/",nov:"/nov(ember)?/",dec:"/dec(ember)?/",sun:"/^sun(day)?/",mon:"/^mon(day)?/",tue:"/^tue(s(day)?)?/",wed:"/^wed(nesday)?/",thu:"/^thu(rsday)?/",fri:"/^fri(day)?/",sat:"/^sat(urday)?/",future:"/^next/",past:"/^last|past|prev(ious)?/",yesterday:"/^yesterday/",today:"/^today/",tomorrow:"/^tom(orrow)?/",soon:"/^soon/",later:"/^later/",someday:"/^someday/",now:"/^now/",shortMeridian:"/^(a|p)/",longMeridian:"/^(a\\.?m?\\.?|p\\.?m?\\.?)/",timezone:"/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\\s*(\\+|\\-)\\s*\\d\\d\\d\\d?)|gmt|utc)/",ordinalSuffix:"/^\\s*(st|nd|rd|th)/",timeContext:"/^\\s*(\\:|a(?!u|p)|p)/"},Date.i18n.currentLanguage())}},CultureInfo=function(){var info=getText.getFromObjectValues({name:"name",englishName:"englishName",nativeName:"nativeName",amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:"firstDayOfWeek",twoDigitYearMax:"twoDigitYearMax",dateElementOrder:"mdy"},Date.i18n.currentLanguage()),constructedInfo=buildInfo.buildFromMethodHash({dayNames:"days",abbreviatedDayNames:"dayAbbr",shortestDayNames:"dayShortNames",firstLetterDayNames:"dayFirstLetters",monthNames:"months",abbreviatedMonthNames:"monthAbbr",formatPatterns:"formatPatterns",regexPatterns:"regex",abbreviatedTimeZoneDST:"timeZoneDST",abbreviatedTimeZoneStandard:"timeZoneStandard"});return shallowMerge(info,constructedInfo),buildInfo.timeZones(info),info};$D.i18n={__:function(key,lang){return __(key,lang)},currentLanguage:function(){return lang||"en-US"},setLanguage:function(code,force,cb){if(force||"en-US"===code||Date.CultureStrings&&Date.CultureStrings[code])lang=code,Date.CultureStrings=Date.CultureStrings||{},Date.CultureStrings.lang=code,Date.CultureInfo=new CultureInfo;else if(!Date.CultureStrings||!Date.CultureStrings[code])return!1;$D.Parsing.Normalizer.buildReplaceData(),$D.Grammar&&$D.Grammar.buildGrammarFormats(),cb&&cb()},getLoggedKeys:function(){return loggedKeys},updateCultureInfo:function(){Date.CultureInfo=new CultureInfo}},$D.i18n.updateCultureInfo()}(),function(){var $D=Date,$P=$D.prototype,p=function(s,l){return l||(l=2),("000"+s).slice(-1*l)};$D.console="undefined"!=typeof window&&"undefined"!=typeof window.console&&"undefined"!=typeof window.console.log?console:{log:function(){},error:function(){}},$D.Config=$D.Config||{},$D.initOverloads=function(){$D.now?$D._now||($D._now=$D.now):$D._now=function now(){return(new Date).getTime()},$D.now=function(returnObj){return returnObj?$D.present():$D._now()},$P.toISOString||($P.toISOString=function(){return this.getUTCFullYear()+"-"+p(this.getUTCMonth()+1)+"-"+p(this.getUTCDate())+"T"+p(this.getUTCHours())+":"+p(this.getUTCMinutes())+":"+p(this.getUTCSeconds())+"."+String((this.getUTCMilliseconds()/1e3).toFixed(3)).slice(2,5)+"Z"}),void 0===$P._toString&&($P._toString=$P.toString)},$D.initOverloads(),$D.today=function(){return(new Date).clearTime()},$D.present=function(){return new Date},$D.compare=function(date1,date2){if(isNaN(date1)||isNaN(date2))throw new Error(date1+" - "+date2);if(date1 instanceof Date&&date2 instanceof Date)return date2>date1?-1:date1>date2?1:0;throw new TypeError(date1+" - "+date2)},$D.equals=function(date1,date2){return 0===date1.compareTo(date2)},$D.getDayName=function(n){return Date.CultureInfo.dayNames[n]},$D.getDayNumberFromName=function(name){for(var n=Date.CultureInfo.dayNames,m=Date.CultureInfo.abbreviatedDayNames,o=Date.CultureInfo.shortestDayNames,s=name.toLowerCase(),i=0;i<n.length;i++)if(n[i].toLowerCase()===s||m[i].toLowerCase()===s||o[i].toLowerCase()===s)return i;return-1},$D.getMonthNumberFromName=function(name){for(var n=Date.CultureInfo.monthNames,m=Date.CultureInfo.abbreviatedMonthNames,s=name.toLowerCase(),i=0;i<n.length;i++)if(n[i].toLowerCase()===s||m[i].toLowerCase()===s)return i;return-1},$D.getMonthName=function(n){return Date.CultureInfo.monthNames[n]},$D.isLeapYear=function(year){return year%4===0&&year%100!==0||year%400===0},$D.getDaysInMonth=function(year,month){return!month&&$D.validateMonth(year)&&(month=year,year=Date.today().getFullYear()),[31,$D.isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month]},$P.getDaysInMonth=function(){return $D.getDaysInMonth(this.getFullYear(),this.getMonth())},$D.getTimezoneAbbreviation=function(offset,dst){var p,n=dst?Date.CultureInfo.abbreviatedTimeZoneDST:Date.CultureInfo.abbreviatedTimeZoneStandard;for(p in n)if(n.hasOwnProperty(p)&&n[p]===offset)return p;return null},$D.getTimezoneOffset=function(name,dst){var i,a=[],z=Date.CultureInfo.timezones;for(name||(name=(new Date).getTimezone()),i=0;i<z.length;i++)z[i].name===name.toUpperCase()&&a.push(i);if(!z[a[0]])return null;if(1===a.length||!dst)return z[a[0]].offset;for(i=0;i<a.length;i++)if(z[a[i]].dst)return z[a[i]].offset},$D.getQuarter=function(d){d=d||new Date;var q=[1,2,3,4];return q[Math.floor(d.getMonth()/3)]},$D.getDaysLeftInQuarter=function(d){d=d||new Date;var qEnd=new Date(d);return qEnd.setMonth(qEnd.getMonth()+3-qEnd.getMonth()%3,0),Math.floor((qEnd-d)/864e5)},$P.ensureTimeOfDay=function(){0===this.getMilliseconds()&&this.setTime(this.getTime()+1)};var validate=function(n,min,max,name){if(name=name?name:"Object","undefined"==typeof n)return!1;if("number"!=typeof n)throw new TypeError(n+" is not a Number.");return min>n||n>max?!1:!0};$D.validateMillisecond=function(value){return validate(value,0,999,"millisecond")},$D.validateSecond=function(value){return validate(value,0,59,"second")},$D.validateMinute=function(value){return validate(value,0,59,"minute")},$D.validateHour=function(value){return validate(value,0,23,"hour")},$D.validateDay=function(value,year,month){return void 0===year||null===year||void 0===month||null===month?!1:validate(value,1,$D.getDaysInMonth(year,month),"day")},$D.validateWeek=function(value){return validate(value,0,53,"week")},$D.validateMonth=function(value){return validate(value,0,11,"month")},$D.validateYear=function(value){return validate(value,-271822,275760,"year")},$D.validateTimezone=function(value){var timezones={ACDT:1,ACST:1,ACT:1,ADT:1,AEDT:1,AEST:1,AFT:1,AKDT:1,AKST:1,AMST:1,AMT:1,ART:1,AST:1,AWDT:1,AWST:1,AZOST:1,AZT:1,BDT:1,BIOT:1,BIT:1,BOT:1,BRT:1,BST:1,BTT:1,CAT:1,CCT:1,CDT:1,CEDT:1,CEST:1,CET:1,CHADT:1,CHAST:1,CHOT:1,ChST:1,CHUT:1,CIST:1,CIT:1,CKT:1,CLST:1,CLT:1,COST:1,COT:1,CST:1,CT:1,CVT:1,CWST:1,CXT:1,DAVT:1,DDUT:1,DFT:1,EASST:1,EAST:1,EAT:1,ECT:1,EDT:1,EEDT:1,EEST:1,EET:1,EGST:1,EGT:1,EIT:1,EST:1,FET:1,FJT:1,FKST:1,FKT:1,FNT:1,GALT:1,GAMT:1,GET:1,GFT:1,GILT:1,GIT:1,GMT:1,GST:1,GYT:1,HADT:1,HAEC:1,HAST:1,HKT:1,HMT:1,HOVT:1,HST:1,ICT:1,IDT:1,IOT:1,IRDT:1,IRKT:1,IRST:1,IST:1,JST:1,KGT:1,KOST:1,KRAT:1,KST:1,LHST:1,LINT:1,MAGT:1,MART:1,MAWT:1,MDT:1,MET:1,MEST:1,MHT:1,MIST:1,MIT:1,MMT:1,MSK:1,MST:1,MUT:1,MVT:1,MYT:1,NCT:1,NDT:1,NFT:1,NPT:1,NST:1,NT:1,NUT:1,NZDT:1,NZST:1,OMST:1,ORAT:1,PDT:1,PET:1,PETT:1,PGT:1,PHOT:1,PHT:1,PKT:1,PMDT:1,PMST:1,PONT:1,PST:1,PYST:1,PYT:1,RET:1,ROTT:1,SAKT:1,SAMT:1,SAST:1,SBT:1,SCT:1,SGT:1,SLST:1,SRT:1,SST:1,SYOT:1,TAHT:1,THA:1,TFT:1,TJT:1,TKT:1,TLT:1,TMT:1,TOT:1,TVT:1,UCT:1,ULAT:1,UTC:1,UYST:1,UYT:1,UZT:1,VET:1,VLAT:1,VOLT:1,VOST:1,VUT:1,WAKT:1,WAST:1,WAT:1,WEDT:1,WEST:1,WET:1,WST:1,YAKT:1,YEKT:1,Z:1};return 1===timezones[value]},$D.validateTimezoneOffset=function(value){return value>-841&&721>value},$D.validateSetExplicitTime=function(value){return!0}}(),function(){var $D=Date,$P=$D.prototype,p=function(s,l){return l||(l=2),("000"+s).slice(-1*l)},validateConfigObject=function(obj){var result={},self=this,prop,testFunc;testFunc=function(prop,func,value){if("day"===prop){var month=void 0!==obj.month?obj.month:self.getMonth(),year=void 0!==obj.year?obj.year:self.getFullYear();return $D[func](value,year,month)}return $D[func](value)};for(prop in obj)if(hasOwnProperty.call(obj,prop)){var func="validate"+prop.charAt(0).toUpperCase()+prop.slice(1);$D[func]&&null!==obj[prop]&&testFunc(prop,func,obj[prop])&&(result[prop]=obj[prop])}return result};$P.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},$P.setTimeToNow=function(){var n=new Date;return this.setHours(n.getHours()),this.setMinutes(n.getMinutes()),this.setSeconds(n.getSeconds()),this.setMilliseconds(n.getMilliseconds()),this},$P.clone=function(){return new Date(this.getTime())},$P.compareTo=function(date){return Date.compare(this,date)},$P.equals=function(date){return Date.equals(this,void 0!==date?date:new Date)},$P.between=function(start,end){return this.getTime()>=start.getTime()&&this.getTime()<=end.getTime()},$P.isAfter=function(date){return 1===this.compareTo(date||new Date)},$P.isBefore=function(date){return-1===this.compareTo(date||new Date)},$P.isToday=$P.isSameDay=function(date){return this.clone().clearTime().equals((date||new Date).clone().clearTime())},$P.addMilliseconds=function(value){return value?(this.setTime(this.getTime()+1*value),this):this},$P.addSeconds=function(value){return value?this.addMilliseconds(1e3*value):this},$P.addMinutes=function(value){return value?this.addMilliseconds(6e4*value):this},$P.addHours=function(value){return value?this.addMilliseconds(36e5*value):this},$P.addDays=function(value){return value?(this.setDate(this.getDate()+1*value),this):this},$P.addWeekdays=function(value){if(!value)return this;var day=this.getDay(),weeks=Math.ceil(Math.abs(value)/7);if((0===day||6===day)&&value>0&&(this.next().monday(),this.addDays(-1),day=this.getDay()),0>value){for(;0>value;)this.addDays(-1),day=this.getDay(),0!==day&&6!==day&&value++;return this}return(value>5||value>=6-day)&&(value+=2*weeks),this.addDays(value)},$P.addWeeks=function(value){return value?this.addDays(7*value):this},$P.addMonths=function(value){if(!value)return this;var n=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+1*value),this.setDate(Math.min(n,$D.getDaysInMonth(this.getFullYear(),this.getMonth()))),this},$P.addQuarters=function(value){return value?this.addMonths(3*value):this},$P.addYears=function(value){return value?this.addMonths(12*value):this},$P.add=function(config){if("number"==typeof config)return this._orient=config,this;var changed,x=config;return x.day&&x.day-this.getDate()!==0&&this.setDate(x.day),x.milliseconds&&this.addMilliseconds(x.milliseconds),x.seconds&&this.addSeconds(x.seconds),x.minutes&&this.addMinutes(x.minutes),x.hours&&this.addHours(x.hours),x.weeks&&this.addWeeks(x.weeks),x.months&&this.addMonths(x.months),x.years&&this.addYears(x.years),x.days&&this.addDays(x.days),x.setExplicitTime&&this.ensureTimeOfDay(),this},$P.getWeek=function(utc){var self,target=new Date(this.valueOf());utc?(target.addMinutes(target.getTimezoneOffset()),self=target.clone()):self=this;var dayNr=(self.getDay()+6)%7;target.setDate(target.getDate()-dayNr+3);var firstThursday=target.valueOf();return target.setMonth(0,1),4!==target.getDay()&&target.setMonth(0,1+(4-target.getDay()+7)%7),1+Math.ceil((firstThursday-target)/6048e5)},$P.getISOWeek=function(){return p(this.getWeek(!0))},$P.setWeek=function(n){return n-this.getWeek()===0?1!==this.getDay()?this.moveToDayOfWeek(1,this.getDay()>1?-1:1):this:this.moveToDayOfWeek(1,this.getDay()>1?-1:1).addWeeks(n-this.getWeek())},$P.setQuarter=function(qtr){var month=Math.abs(3*(qtr-1)+1);return this.setMonth(month,1)},$P.getQuarter=function(){return Date.getQuarter(this)},$P.getDaysLeftInQuarter=function(){return Date.getDaysLeftInQuarter(this)},$P.moveToNthOccurrence=function(dayOfWeek,occurrence){if("Weekday"===dayOfWeek){if(occurrence>0)this.moveToFirstDayOfMonth(),this.is().weekday()&&(occurrence-=1);else{if(!(0>occurrence))return this;this.moveToLastDayOfMonth(),this.is().weekday()&&(occurrence+=1)}return this.addWeekdays(occurrence)}var shift=0;if(occurrence>0)shift=occurrence-1;else if(-1===occurrence)return this.moveToLastDayOfMonth(),this.getDay()!==dayOfWeek&&this.moveToDayOfWeek(dayOfWeek,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(dayOfWeek,1).addWeeks(shift)};var moveToN=function(getFunc,addFunc,nVal){return function(value,orient){var diff=(value-this[getFunc]()+nVal*(orient||1))%nVal;return this[addFunc](0===diff?diff+=nVal*(orient||1):diff)}};$P.moveToDayOfWeek=moveToN("getDay","addDays",7),$P.moveToMonth=moveToN("getMonth","addMonths",12),$P.getOrdinate=function(){var num=this.getDate();return ord(num)},$P.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1},$P.getTimezone=function(){return $D.getTimezoneAbbreviation(this.getUTCOffset(),this.isDaylightSavingTime())},$P.setTimezoneOffset=function(offset){var here=this.getTimezoneOffset(),there=-6*Number(offset)/10;return there||0===there?this.addMinutes(there-here):this},$P.setTimezone=function(offset){return this.setTimezoneOffset($D.getTimezoneOffset(offset))},$P.hasDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset()},$P.isDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==this.getTimezoneOffset()},$P.getUTCOffset=function(offset){var n=-10*(offset||this.getTimezoneOffset())/6,r;return 0>n?(r=(n-1e4).toString(),r.charAt(0)+r.substr(2)):(r=(n+1e4).toString(),"+"+r.substr(1))},$P.getElapsed=function(date){return(date||new Date)-this},$P.set=function(config){config=validateConfigObject.call(this,config);var key;for(key in config)if(hasOwnProperty.call(config,key)){var name=key.charAt(0).toUpperCase()+key.slice(1),addFunc,getFunc;"week"!==key&&"month"!==key&&"timezone"!==key&&"timezoneOffset"!==key&&(name+="s"),addFunc="add"+name,getFunc="get"+name,"month"===key?addFunc+="s":"year"===key&&(getFunc="getFullYear"),"day"!==key&&"timezone"!==key&&"timezoneOffset"!==key&&"week"!==key&&"hour"!==key&&"setExplicitTime"!==key?this[addFunc](config[key]-this[getFunc]()):("timezone"===key||"timezoneOffset"===key||"week"===key||"hour"===key)&&this["set"+name](config[key])}return config.day&&this.addDays(config.day-this.getDate()),this},$P.moveToFirstDayOfMonth=function(){return this.set({day:1})},$P.moveToLastDayOfMonth=function(){return this.set({day:$D.getDaysInMonth(this.getFullYear(),this.getMonth())})};var ord=function(n){switch(1*n){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}},parseStandardFormats=function(format){var y,c=Date.CultureInfo.formatPatterns;switch(format){case"d":return this.toString(c.shortDate);case"D":return this.toString(c.longDate);case"F":return this.toString(c.fullDateTime);case"m":return this.toString(c.monthDay);case"r":case"R":return y=this.clone().addMinutes(this.getTimezoneOffset()),y.toString(c.rfc1123)+" GMT";case"s":return this.toString(c.sortableDateTime);case"t":return this.toString(c.shortTime);case"T":return this.toString(c.longTime);case"u":return y=this.clone().addMinutes(this.getTimezoneOffset()),y.toString(c.universalSortableDateTime);case"y":return this.toString(c.yearMonth);default:return!1}},parseFormatStringsClosure=function(context){return function(m){if("\\"===m.charAt(0))return m.replace("\\","");switch(m){case"hh":return p(context.getHours()<13?0===context.getHours()?12:context.getHours():context.getHours()-12);case"h":return context.getHours()<13?0===context.getHours()?12:context.getHours():context.getHours()-12;case"HH":return p(context.getHours());case"H":return context.getHours();case"mm":return p(context.getMinutes());case"m":return context.getMinutes();case"ss":return p(context.getSeconds());case"s":return context.getSeconds();case"yyyy":return p(context.getFullYear(),4);case"yy":return p(context.getFullYear());case"y":return context.getFullYear();case"E":case"dddd":return Date.CultureInfo.dayNames[context.getDay()];case"ddd":return Date.CultureInfo.abbreviatedDayNames[context.getDay()];case"dd":return p(context.getDate());case"d":return context.getDate();case"MMMM":return Date.CultureInfo.monthNames[context.getMonth()];case"MMM":return Date.CultureInfo.abbreviatedMonthNames[context.getMonth()];case"MM":return p(context.getMonth()+1);case"M":return context.getMonth()+1;case"t":return context.getHours()<12?Date.CultureInfo.amDesignator.substring(0,1):Date.CultureInfo.pmDesignator.substring(0,1);case"tt":return context.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator;case"S":return ord(context.getDate());case"W":return context.getWeek();case"WW":return context.getISOWeek();case"Q":return"Q"+context.getQuarter();case"q":return String(context.getQuarter());case"z":return context.getTimezone();case"Z":case"X":return Date.getTimezoneOffset(context.getTimezone());case"ZZ":return-60*context.getTimezoneOffset();case"u":return context.getDay();case"L":return $D.isLeapYear(context.getFullYear())?1:0;case"B":return"@"+(context.getUTCSeconds()+60*context.getUTCMinutes()+3600*(context.getUTCHours()+1))/86.4;default:return m}}};$P.toString=function(format,ignoreStandards){if(!ignoreStandards&&format&&1===format.length&&(output=parseStandardFormats.call(this,format)))return output;var parseFormatStrings=parseFormatStringsClosure(this);return format?format.replace(/((\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S|q|Q|WW?W?W?)(?![^\[]*\]))/g,parseFormatStrings).replace(/\[|\]/g,""):this._toString()}}(),function(){var $D=Date,$P=$D.prototype,$N=Number.prototype;$P._orient=1,$P._nth=null,$P._is=!1,$P._same=!1,$P._isSecond=!1,$N._dateElement="days",$P.next=function(){return this._move=!0,this._orient=1,this},$D.next=function(){return $D.today().next()},$P.last=$P.prev=$P.previous=function(){return this._move=!0,this._orient=-1,this},$D.last=$D.prev=$D.previous=function(){return $D.today().last()},$P.is=function(){return this._is=!0,this},$P.same=function(){return this._same=!0,this._isSecond=!1,this},$P.today=function(){return this.same().day()},$P.weekday=function(){return this._nth?df("Weekday").call(this):this._move?this.addWeekdays(this._orient):this._is?(this._is=!1,!this.is().sat()&&!this.is().sun()):!1},$P.weekend=function(){return this._is?(this._is=!1,this.is().sat()||this.is().sun()):!1},$P.at=function(time){return"string"==typeof time?$D.parse(this.toString("d")+" "+time):this.set(time)},$N.fromNow=$N.after=function(date){var c={};return c[this._dateElement]=this,(date?date.clone():new Date).add(c)},$N.ago=$N.before=function(date){var c={},s="s"!==this._dateElement[this._dateElement.length-1]?this._dateElement+"s":this._dateElement;return c[s]=-1*this,(date?date.clone():new Date).add(c)};var dx="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),mx="january february march april may june july august september october november december".split(/\s/),px=[],pxf=[],nth="final first second third fourth fifth".split(/\s/),de;$P.toObject=function(){for(var o={},i=0;i<px.length;i++)this["get"+pxf[i]]&&(o[px[i].toLowerCase()]=this["get"+pxf[i]]());return o},$D.fromObject=function(config){return config.week=null,Date.today().set(config)};var df=function(n){return function(){if(this._is)return this._is=!1,this.getDay()===n;if(this._move&&(this._move=null),null!==this._nth){this._isSecond&&this.addSeconds(-1*this._orient),this._isSecond=!1;var ntemp=this._nth;this._nth=null;var temp=this.clone().moveToLastDayOfMonth();if(this.moveToNthOccurrence(n,ntemp),this>temp)throw new RangeError($D.getDayName(n)+" does not occur "+ntemp+" times in the month of "+$D.getMonthName(temp.getMonth())+" "+temp.getFullYear()+".");return this}return this.moveToDayOfWeek(n,this._orient)}},sdf=function(n){return function(){var t=$D.today(),shift=n-t.getDay();return(0===n&&1===Date.CultureInfo.firstDayOfWeek&&0!==t.getDay()||0>shift)&&(shift+=7),t.addDays(shift)}},month_instance_functions=function(n){return function(){return this._is?(this._is=!1,this.getMonth()===n):this.moveToMonth(n,this._orient)}},month_static_functions=function(n){return function(){return $D.today().set({month:n,day:1})}},processTerms=function(names,staticFunc,instanceFunc){for(var i=0;i<names.length;i++)$D[names[i].toUpperCase()]=$D[names[i].toUpperCase().substring(0,3)]=i,$D[names[i]]=$D[names[i].substring(0,3)]=staticFunc(i),$P[names[i]]=$P[names[i].substring(0,3)]=instanceFunc(i)};processTerms(dx,sdf,df),processTerms(mx,month_static_functions,month_instance_functions);for(var ef=function(j){return function(){if(this._isSecond)return this._isSecond=!1,this;if(this._same){this._same=this._is=!1;var o1=this.toObject(),o2=(arguments[0]||new Date).toObject(),v="",k=j.toLowerCase();k="s"===k[k.length-1]?k.substring(0,k.length-1):k;for(var m=px.length-1;m>-1;m--){if(v=px[m].toLowerCase(),o1[v]!==o2[v])return!1;if(k===v)break}return!0}return"s"!==j.substring(j.length-1)&&(j+="s"),this._move&&(this._move=null),this["add"+j](this._orient)}},nf=function(n){return function(){return this._dateElement=n,this}},k=0;k<px.length;k++)de=px[k].toLowerCase(),"weekday"!==de&&($P[de]=$P[de+"s"]=ef(px[k]),$N[de]=$N[de+"s"]=nf(de+"s"));$P._ss=ef("Second");for(var nthfn=function(n){return function(dayOfWeek){return this._same?this._ss(arguments[0]):dayOfWeek||0===dayOfWeek?this.moveToNthOccurrence(dayOfWeek,n):(this._nth=n,2!==n||void 0!==dayOfWeek&&null!==dayOfWeek?this:(this._isSecond=!0,this.addSeconds(this._orient)))}},l=0;l<nth.length;l++)$P[nth[l]]=nthfn(0===l?-1:l)}(),function(){Date.Parsing={Exception:function(s){this.message="Parse error at '"+s.substring(0,10)+" ...'"}};var $P=Date.Parsing,dayOffsets={standard:[0,31,59,90,120,151,181,212,243,273,304,334],leap:[0,31,60,91,121,152,182,213,244,274,305,335]};$P.isLeapYear=function(year){return year%4===0&&year%100!==0||year%400===0};var utils={multiReplace:function(str,hash){var key;for(key in hash)if(Object.prototype.hasOwnProperty.call(hash,key)){var regex;"function"==typeof hash[key]||(regex=hash[key]instanceof RegExp?hash[key]:new RegExp(hash[key],"g")),str=str.replace(regex,key)}return str},getDayOfYearFromWeek:function(obj){var d,jan4,offset;return obj.weekDay=obj.weekDay||0===obj.weekDay?obj.weekDay:1,d=new Date(obj.year,0,4),jan4=0===d.getDay()?7:d.getDay(),offset=jan4+3,obj.dayOfYear=7*obj.week+(0===obj.weekDay?7:obj.weekDay)-offset,obj},getDayOfYear:function(obj,dayOffset){obj.dayOfYear||(obj=utils.getDayOfYearFromWeek(obj));for(var i=0;i<=dayOffset.length;i++){if(obj.dayOfYear<dayOffset[i]||i===dayOffset.length){obj.day=obj.day?obj.day:obj.dayOfYear-dayOffset[i-1];break}obj.month=i}return obj},adjustForTimeZone:function(obj,date){var offset;return"Z"===obj.zone.toUpperCase()||0===obj.zone_hours&&0===obj.zone_minutes?offset=-date.getTimezoneOffset():(offset=60*obj.zone_hours+(obj.zone_minutes||0),"+"===obj.zone_sign&&(offset*=-1),offset-=date.getTimezoneOffset()),date.setMinutes(date.getMinutes()+offset),date},setDefaults:function(obj){return obj.year=obj.year||Date.today().getFullYear(),obj.hours=obj.hours||0,obj.minutes=obj.minutes||0,obj.seconds=obj.seconds||0,obj.milliseconds=obj.milliseconds||0,(obj.month||!obj.week&&!obj.dayOfYear)&&(obj.month=obj.month||0,obj.day=obj.day||1),obj},dataNum:function(data,mod,explict,postProcess){var dataNum=1*data;return mod?postProcess?data?1*mod(data):data:data?mod(dataNum):data:explict?data&&"undefined"!=typeof data?dataNum:data:data?dataNum:data},timeDataProcess:function(obj){var timeObj={};for(var x in obj.data)obj.data.hasOwnProperty(x)&&(timeObj[x]=obj.ignore[x]?obj.data[x]:utils.dataNum(obj.data[x],obj.mods[x],obj.explict[x],obj.postProcess[x]));return obj.data.secmins&&(obj.data.secmins=60*obj.data.secmins.replace(",","."),timeObj.minutes?timeObj.seconds||(timeObj.seconds=obj.data.secmins):timeObj.minutes=obj.data.secmins,delete obj.secmins),timeObj},buildTimeObjectFromData:function(data){var time=utils.timeDataProcess({data:{year:data[1],month:data[5],day:data[7],week:data[8],dayOfYear:data[10],hours:data[15],zone_hours:data[23],zone_minutes:data[24],zone:data[21],zone_sign:data[22],weekDay:data[9],minutes:data[16],seconds:data[19],milliseconds:data[20],secmins:data[18]},mods:{month:function(data){return data-1},weekDay:function(data){return data=Math.abs(data),7===data?0:data},minutes:function(data){return data.replace(":","")},seconds:function(data){return Math.floor(1*data.replace(":","").replace(",","."))},milliseconds:function(data){return 1e3*data.replace(",",".")}},postProcess:{minutes:!0,seconds:!0,milliseconds:!0},explict:{zone_hours:!0,zone_minutes:!0},ignore:{zone:!0,zone_sign:!0,secmins:!0}});return time},addToHash:function(hash,keys,data){keys=keys,data=data;for(var len=keys.length,i=0;len>i;i++)hash[keys[i]]=data[i];return hash},combineRegex:function(r1,r2){return new RegExp("(("+r1.source+")\\s("+r2.source+"))")},getDateNthString:function(add,last,inc){return add?Date.today().addDays(inc).toString("d"):last?Date.today().last()[inc]().toString("d"):void 0},buildRegexData:function(array){for(var arr=[],len=array.length,i=0;len>i;i++)arr.push(Array.isArray(array[i])?this.combineRegex(array[i][0],array[i][1]):array[i]);return arr}};$P.processTimeObject=function(obj){var date,dayOffset;return utils.setDefaults(obj),dayOffset=$P.isLeapYear(obj.year)?dayOffsets.leap:dayOffsets.standard,obj.month||!obj.week&&!obj.dayOfYear?obj.dayOfYear=dayOffset[obj.month]+obj.day:utils.getDayOfYear(obj,dayOffset),date=new Date(obj.year,obj.month,obj.day,obj.hours,obj.minutes,obj.seconds,obj.milliseconds),obj.zone&&utils.adjustForTimeZone(obj,date),date},$P.Numeric={isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},regex:/\b([0-1]?[0-9])([0-3]?[0-9])([0-2]?[0-9]?[0-9][0-9])\b/i,parse:function(s){var data,i,time={},order=Date.CultureInfo.dateElementOrder.split("");if(!this.isNumeric(s)||"+"===s[0]&&"-"===s[0])return null;if(s.length<5&&s.indexOf(".")<0&&s.indexOf("/")<0)return time.year=s,$P.processTimeObject(time);if(data=s.match(this.regex),!data||!data.length)return null;for(i=0;i<order.length;i++)switch(order[i]){case"d":time.day=data[i+1];break;case"m":time.month=data[i+1]-1;break;case"y":time.year=data[i+1]}return $P.processTimeObject(time)}},$P.Normalizer={regexData:function(){var $R=Date.CultureInfo.regexPatterns;return utils.buildRegexData([$R.tomorrow,$R.yesterday,[$R.past,$R.mon],[$R.past,$R.tue],[$R.past,$R.wed],[$R.past,$R.thu],[$R.past,$R.fri],[$R.past,$R.sat],[$R.past,$R.sun]])},basicReplaceHash:function(){var $R=Date.CultureInfo.regexPatterns;return{January:$R.jan,February:$R.feb,March:$R.mar,April:$R.apr,May:$R.may,June:$R.jun,July:$R.jul,August:$R.aug,September:$R.sep,October:$R.oct,November:$R.nov,December:$R.dec,"":/\bat\b/gi," ":/\s{2,}/,"9am":$R.thisMorning,"7pm":$R.thisEvening}},keys:function(){return[utils.getDateNthString(!0,!1,1),utils.getDateNthString(!0,!1,-1),utils.getDateNthString(!1,!0,"monday"),utils.getDateNthString(!1,!0,"tuesday"),utils.getDateNthString(!1,!0,"wednesday"),utils.getDateNthString(!1,!0,"thursday"),utils.getDateNthString(!1,!0,"friday"),utils.getDateNthString(!1,!0,"saturday"),utils.getDateNthString(!1,!0,"sunday")]},buildRegexFunctions:function(){var $R=Date.CultureInfo.regexPatterns,__=Date.i18n.__,tomorrowRE=new RegExp("(\\b\\d\\d?("+__("AM")+"|"+__("PM")+")? )("+$R.tomorrow.source.slice(1)+")","i"),todayRE=new RegExp($R.today.source+"(?!\\s*([+-]))\\b");this.replaceFuncs=[[todayRE,function(full){return full.length>1?Date.today().toString("d"):full}],[tomorrowRE,function(full,m1){var t=Date.today().addDays(1).toString("d");return t+" "+m1}]]},buildReplaceData:function(){this.buildRegexFunctions(),this.replaceHash=utils.addToHash(this.basicReplaceHash(),this.keys(),this.regexData())},stringReplaceFuncs:function(s){for(var i=0;i<this.replaceFuncs.length;i++)s=s.replace(this.replaceFuncs[i][0],this.replaceFuncs[i][1]);return s},parse:function(s){s=this.stringReplaceFuncs(s),s=utils.multiReplace(s,this.replaceHash);try{var n=s.split(/([\s\-\.\,\/\x27]+)/);3===n.length&&$P.Numeric.isNumeric(n[0])&&$P.Numeric.isNumeric(n[2])&&n[2].length>=4&&"d"===Date.CultureInfo.dateElementOrder[0]&&(s="1/"+n[0]+"/"+n[2])}catch(e){}return s}},$P.Normalizer.buildReplaceData()}(),function(){for(var $P=Date.Parsing,_=$P.Operators={rtoken:function(r){return function(s){var mx=s.match(r);if(mx)return[mx[0],s.substring(mx[0].length)];throw new $P.Exception(s)}},token:function(){return function(s){return _.rtoken(new RegExp("^\\s*"+s+"\\s*"))(s)}},stoken:function(s){return _.rtoken(new RegExp("^"+s))},until:function(p){return function(s){for(var qx=[],rx=null;s.length;){try{rx=p.call(this,s)}catch(e){qx.push(rx[0]),s=rx[1];continue}break}return[qx,s]}},many:function(p){return function(s){for(var rx=[],r=null;s.length;){try{r=p.call(this,s)}catch(e){return[rx,s]}rx.push(r[0]),s=r[1]}return[rx,s]}},optional:function(p){return function(s){var r=null;
try{r=p.call(this,s)}catch(e){return[null,s]}return[r[0],r[1]]}},not:function(p){return function(s){try{p.call(this,s)}catch(e){return[null,s]}throw new $P.Exception(s)}},ignore:function(p){return p?function(s){var r=null;return r=p.call(this,s),[null,r[1]]}:null},product:function(){for(var px=arguments[0],qx=Array.prototype.slice.call(arguments,1),rx=[],i=0;i<px.length;i++)rx.push(_.each(px[i],qx));return rx},cache:function(rule){var cache={},cache_length=0,cache_keys=[],CACHE_MAX=Date.Config.CACHE_MAX||500,r=null,cacheCheck=function(){if(cache_length===CACHE_MAX)for(var i=0;10>i;i++){var key=cache_keys.shift();key&&(delete cache[key],cache_length--)}};return function(s){cacheCheck();try{r=cache[s]=cache[s]||rule.call(this,s)}catch(e){r=cache[s]=e}if(cache_length++,cache_keys.push(s),r instanceof $P.Exception)throw r;return r}},any:function(){var px=arguments;return function(s){for(var r=null,i=0;i<px.length;i++)if(null!=px[i]){try{r=px[i].call(this,s)}catch(e){r=null}if(r)return r}throw new $P.Exception(s)}},each:function(){var px=arguments;return function(s){for(var rx=[],r=null,i=0;i<px.length;i++)if(null!=px[i]){try{r=px[i].call(this,s)}catch(e){throw new $P.Exception(s)}rx.push(r[0]),s=r[1]}return[rx,s]}},all:function(){var px=arguments,_=_;return _.each(_.optional(px))},sequence:function(px,d,c){return d=d||_.rtoken(/^\s*/),c=c||null,1===px.length?px[0]:function(s){for(var r=null,q=null,rx=[],i=0;i<px.length;i++){try{r=px[i].call(this,s)}catch(e){break}rx.push(r[0]);try{q=d.call(this,r[1])}catch(ex){q=null;break}s=q[1]}if(!r)throw new $P.Exception(s);if(q)throw new $P.Exception(q[1]);if(c)try{r=c.call(this,r[1])}catch(ey){throw new $P.Exception(r[1])}return[rx,r?r[1]:s]}},between:function(d1,p,d2){d2=d2||d1;var _fn=_.each(_.ignore(d1),p,_.ignore(d2));return function(s){var rx=_fn.call(this,s);return[[rx[0][0],r[0][2]],rx[1]]}},list:function(p,d,c){return d=d||_.rtoken(/^\s*/),c=c||null,p instanceof Array?_.each(_.product(p.slice(0,-1),_.ignore(d)),p.slice(-1),_.ignore(c)):_.each(_.many(_.each(p,_.ignore(d))),px,_.ignore(c))},set:function(px,d,c){return d=d||_.rtoken(/^\s*/),c=c||null,function(s){for(var r=null,p=null,q=null,rx=null,best=[[],s],last=!1,i=0;i<px.length;i++){q=null,p=null,r=null,last=1===px.length;try{r=px[i].call(this,s)}catch(e){continue}if(rx=[[r[0]],r[1]],r[1].length>0&&!last)try{q=d.call(this,r[1])}catch(ex){last=!0}else last=!0;if(last||0!==q[1].length||(last=!0),!last){for(var qx=[],j=0;j<px.length;j++)i!==j&&qx.push(px[j]);p=_.set(qx,d).call(this,q[1]),p[0].length>0&&(rx[0]=rx[0].concat(p[0]),rx[1]=p[1])}if(rx[1].length<best[1].length&&(best=rx),0===best[1].length)break}if(0===best[0].length)return best;if(c){try{q=c.call(this,best[1])}catch(ey){throw new $P.Exception(best[1])}best[1]=q[1]}return best}},forward:function(gr,fname){return function(s){return gr[fname].call(this,s)}},replace:function(rule,repl){return function(s){var r=rule.call(this,s);return[repl,r[1]]}},process:function(rule,fn){return function(s){var r=rule.call(this,s);return[fn.call(this,r[0]),r[1]]}},min:function(min,rule){return function(s){var rx=rule.call(this,s);if(rx[0].length<min)throw new $P.Exception(s);return rx}}},_generator=function(op){function gen(){var args=null,rx=[],px,i;return arguments.length>1?args=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(args=arguments[0]),args?(px=args.shift(),px.length>0?(args.unshift(px[i]),rx.push(op.apply(null,args)),args.shift(),rx):void 0):op.apply(null,arguments)}return gen},gx="optional not ignore cache".split(/\s/),i=0;i<gx.length;i++)_[gx[i]]=_generator(_[gx[i]]);for(var _vector=function(op){return function(){return arguments[0]instanceof Array?op.apply(null,arguments[0]):op.apply(null,arguments)}},vx="each any all".split(/\s/),j=0;j<vx.length;j++)_[vx[j]]=_vector(_[vx[j]])}(),function(){var $D=Date,flattenAndCompact=function(ax){for(var rx=[],i=0;i<ax.length;i++)ax[i]instanceof Array?rx=rx.concat(flattenAndCompact(ax[i])):ax[i]&&rx.push(ax[i]);return rx},parseMeridian=function(){if(this.meridian&&(this.hour||0===this.hour)){if("a"===this.meridian&&this.hour>11&&Date.Config.strict24hr)throw"Invalid hour and meridian combination";if("p"===this.meridian&&this.hour<12&&Date.Config.strict24hr)throw"Invalid hour and meridian combination";"p"===this.meridian&&this.hour<12?this.hour=this.hour+12:"a"===this.meridian&&12===this.hour&&(this.hour=0)}else this.meridian||!this.hour&&0!==this.hour||this.hour<8&&(this.hour=this.hour+12)},setDefaults=function(){var now=new Date;!this.hour&&!this.minute||this.month||this.year||this.day||(this.day=now.getDate()),this.year||(this.year=now.getFullYear(),this.month<now.getMonth()&&this.year++),this.month||0===this.month||(this.month=now.getMonth()),this.day||(this.day=1),this.hour||(this.hour=0),this.minute||(this.minute=0),this.second||(this.second=0),this.millisecond||(this.millisecond=0)},finishUtils={getToday:function(){return this.now||-1!=="hour minute second".indexOf(this.unit)?new Date:$D.today()},setDaysFromWeekday:function(today,orient){var gap;return orient=orient||1,this.unit="day",gap=$D.getDayNumberFromName(this.weekday)-today.getDay(),this.days=gap?gap+7*orient:7*orient,this},setMonthsFromMonth:function(today,orient){var gap;return orient=orient||1,this.unit="month",gap=this.month-today.getMonth(),this.months=gap?(gap+12*orient)%12:12*orient,this.month=null,this},setDMYFromWeekday:function(){var d=Date[this.weekday]();return this.day=d.getDate(),this.month||(this.month=d.getMonth()),this.year=d.getFullYear(),this},setUnitValue:function(orient){!this.value&&this.operator&&null!==this.operator&&this[this.unit+"s"]&&null!==this[this.unit+"s"]?this[this.unit+"s"]=this[this.unit+"s"]+("add"===this.operator?1:-1)+(this.value||0)*orient:(null==this[this.unit+"s"]||null!=this.operator)&&(this.value||(this.value=1),this[this.unit+"s"]=this.value*orient)},generateDateFromWeeks:function(){var weekday=void 0!==this.weekday?this.weekday:"today",d=Date[weekday]().addWeeks(this.weeks);return this.now&&d.setTimeToNow(),d}};$D.Translator={hour:function(s){return function(){this.hour=Number(s),this.setExplicitTime=!0}},minute:function(s){return function(){this.minute=Number(s),this.setExplicitTime=!0}},second:function(s){return function(){this.second=Number(s),this.setExplicitTime=!0}},secondAndMillisecond:function(s){return function(){var mx=s.match(/^([0-5][0-9])\.([0-9]{1,3})/);this.second=Number(mx[1]),this.millisecond=Number(mx[2]),this.setExplicitTime=!0}},meridian:function(s){return function(){this.meridian=s.slice(0,1).toLowerCase(),this.setExplicitTime=!0}},timezone:function(s){return function(){var n=s.replace(/[^\d\+\-]/g,"");n.length?this.timezoneOffset=Number(n):this.timezone=s.toLowerCase()}},day:function(x){var s=x[0];return function(){if(this.day=Number(s.match(/\d+/)[0]),this.day<1)throw"invalid day"}},month:function(s){return function(){if(this.month=3===s.length?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(s)/4:Number(s)-1,this.month<0)throw"invalid month"}},year:function(s){return function(){var n=Number(s);this.year=s.length>2?n:n+(n+2e3<Date.CultureInfo.twoDigitYearMax?2e3:1900)}},rday:function(s){return function(){switch(s){case"yesterday":this.days=-1;break;case"someday":this.days=14;break;case"later":this.days=5;break;case"soon":this.days=2;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(x){var d;x=x instanceof Array?x:[x];for(var i=0;i<x.length;i++)x[i]&&x[i].call(this);if(setDefaults.call(this),parseMeridian.call(this),this.day>$D.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");return d=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond),this.setExplicitTime&&d.ensureTimeOfDay(),this.year<100&&d.setFullYear(this.year),this.timezone?d.set({timezone:this.timezone}):this.timezoneOffset&&d.set({timezoneOffset:this.timezoneOffset}),d},finish:function(x){var today,expression,orient,givenYean,temp;if(x=x instanceof Array?flattenAndCompact(x):[x],0===x.length)return null;for(var i=0;i<x.length;i++)"function"==typeof x[i]&&x[i].call(this);if(this.now&&!this.unit&&!this.operator)return new Date;if(today=finishUtils.getToday.call(this),givenYear=!!this.year,expression=!!(this.days&&null!==this.days||this.orient||this.operator),orient="past"===this.orient||"subtract"===this.operator?-1:1,this.month&&"week"===this.unit&&(this.value=this.month+1,delete this.month,delete this.day),!this.month&&0!==this.month||-1==="year day hour minute second".indexOf(this.unit)||(this.value||(this.value=this.month+1),this.month=null,expression=!0),expression||!this.weekday||this.day||this.days||finishUtils.setDMYFromWeekday.call(this),expression&&this.weekday&&"month"!==this.unit&&"week"!==this.unit&&finishUtils.setDaysFromWeekday.call(this,today,orient),!this.weekday||"week"===this.unit||this.day||this.days||(temp=Date[this.weekday](),this.day=temp.getDate(),temp.getMonth()!==today.getMonth()&&(this.month=temp.getMonth())),this.month&&"day"===this.unit&&this.operator&&(this.value||(this.value=this.month+1),this.month=null),null!=this.value&&null!=this.month&&null!=this.year&&(this.day=1*this.value),this.month&&!this.day&&this.value&&(today.set({day:1*this.value}),expression||(this.day=1*this.value)),this.month||!this.value||"month"!==this.unit||this.now||(this.month=this.value,expression=!0),expression&&(this.month||0===this.month)&&"year"!==this.unit&&finishUtils.setMonthsFromMonth.call(this,today,orient),this.unit||(this.unit="day"),finishUtils.setUnitValue.call(this,orient),parseMeridian.call(this),!this.month&&0!==this.month||this.day||(this.day=1),!this.orient&&!this.operator&&"week"===this.unit&&this.value&&!this.day&&!this.month)return Date.today().setWeek(this.value);if("week"===this.unit&&this.weeks&&!this.day&&!this.month)return finishUtils.generateDateFromWeeks.call(this);if(expression&&this.timezone&&this.day&&this.days&&(this.day=this.days),!givenYear&&this.month<today.getMonth()&&(this.year=today.getFullYear()+1),expression&&(this.hour||this.minute||this.second)&&(this.hours=this.hour,this.minutes=this.minute,this.seconds=this.second),expression?today.add(this):today.set(this),this.timezone){this.timezone=this.timezone.toUpperCase();var offset=$D.getTimezoneOffset(this.timezone),timezone;today.hasDaylightSavingTime()&&(timezone=$D.getTimezoneAbbreviation(offset,today.isDaylightSavingTime()),timezone!==this.timezone&&today.addHours(today.isDaylightSavingTime()?-1:1)),today.setTimezoneOffset(offset)}return today}}}(),function(){var $D=Date;$D.Grammar={};var _=$D.Parsing.Operators,g=$D.Grammar,t=$D.Translator,_fn;_fn=function(){return _.each(_.any.apply(null,arguments),_.not(g.ctoken2("timeContext")))},g.datePartDelimiter=_.rtoken(/^([\s\-\.\,\/\x27]+)/),g.timePartDelimiter=_.stoken(":"),g.whiteSpace=_.rtoken(/^\s*/),g.generalDelimiter=_.rtoken(/^(([\s\,]|at|@|on)+)/);var _C={};g.ctoken=function(keys){var fn=_C[keys];if(!fn){for(var c=Date.CultureInfo.regexPatterns,kx=keys.split(/\s+/),px=[],i=0;i<kx.length;i++)px.push(_.replace(_.rtoken(c[kx[i]]),kx[i]));fn=_C[keys]=_.any.apply(null,px)}return fn},g.ctoken2=function(key){return _.rtoken(Date.CultureInfo.regexPatterns[key])};var cacheProcessRtoken=function(key,token,type,eachToken){g[key]=_.cache(eachToken?_.process(_.each(_.rtoken(token),_.optional(g.ctoken2(eachToken))),type):_.process(_.rtoken(token),type))},cacheProcessCtoken=function(token,type){return _.cache(_.process(g.ctoken2(token),type))},_F={},_get=function(f){return _F[f]=_F[f]||g.format(f)[0],_F[f]};g.allformats=function(fx){var rx=[];if(fx instanceof Array)for(var i=0;i<fx.length;i++)rx.push(_get(fx[i]));else rx.push(_get(fx));return rx},g.formats=function(fx){if(fx instanceof Array){for(var rx=[],i=0;i<fx.length;i++)rx.push(_get(fx[i]));return _.any.apply(null,rx)}return _get(fx)};var grammarFormats={timeFormats:function(){var i,RTokenKeys=["h","hh","H","HH","m","mm","s","ss","ss.s","z","zz"],RToken=[/^(0[0-9]|1[0-2]|[1-9])/,/^(0[0-9]|1[0-2])/,/^([0-1][0-9]|2[0-3]|[0-9])/,/^([0-1][0-9]|2[0-3])/,/^([0-5][0-9]|[0-9])/,/^[0-5][0-9]/,/^([0-5][0-9]|[0-9])/,/^[0-5][0-9]/,/^[0-5][0-9]\.[0-9]{1,3}/,/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/,/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/],tokens=[t.hour,t.hour,t.hour,t.hour,t.minute,t.minute,t.second,t.second,t.secondAndMillisecond,t.timezone,t.timezone];for(i=0;i<RTokenKeys.length;i++)cacheProcessRtoken(RTokenKeys[i],RToken[i],tokens[i]);g.hms=_.cache(_.sequence([g.H,g.m,g.s],g.timePartDelimiter)),g.t=cacheProcessCtoken("shortMeridian",t.meridian),g.tt=cacheProcessCtoken("longMeridian",t.meridian),g.zzz=cacheProcessCtoken("timezone",t.timezone),g.timeSuffix=_.each(_.ignore(g.whiteSpace),_.set([g.tt,g.zzz])),g.time=_.each(_.optional(_.ignore(_.stoken("T"))),g.hms,g.timeSuffix)},dateFormats:function(){cacheProcessRtoken("d",/^([0-2]\d|3[0-1]|\d)/,t.day,"ordinalSuffix"),cacheProcessRtoken("dd",/^([0-2]\d|3[0-1])/,t.day,"ordinalSuffix"),g.rday=_.cache(_.process(g.ctoken("yesterday tomorrow soon later someday today now"),t.rday)),g.ddd=g.dddd=_.cache(_.process(g.ctoken("sun mon tue wed thu fri sat"),function(s){return function(){this.weekday=s}})),cacheProcessRtoken("M",/^(1[0-2]|0\d|\d)/,t.month),cacheProcessRtoken("MM",/^(1[0-2]|0\d)/,t.month),g.MMM=g.MMMM=_.cache(_.process(g.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),t.month)),cacheProcessRtoken("y",/^(\d+)/,t.year),cacheProcessRtoken("yy",/^(\d\d)/,t.year),cacheProcessRtoken("yyy",/^(\d\d?\d?\d?)/,t.year),cacheProcessRtoken("yyyy",/^(\d\d\d\d)/,t.year),g.day=_fn(g.d,g.dd),g.month=_fn(g.M,g.MMM),g.year=_fn(g.yyyy,g.yy);var _setfn=function(){return _.set(arguments,g.datePartDelimiter)};g.mdy=_setfn(g.ddd,g.month,g.day,g.year),g.ymd=_setfn(g.ddd,g.year,g.month,g.day),g.dmy=_setfn(g.ddd,g.day,g.month,g.year),g.date=function(s){return(g[Date.CultureInfo.dateElementOrder]||g.mdy).call(this,s)}},relative:function(){g.orientation=_.process(g.ctoken("past future"),function(s){return function(){this.orient=s}}),g.operator=_.process(g.ctoken("add subtract"),function(s){return function(){this.operator=s}})}};g.buildGrammarFormats=function(){_C={},grammarFormats.timeFormats(),grammarFormats.dateFormats(),grammarFormats.relative(),g.value=_.process(_.rtoken(/^([-+]?\d+)?(st|nd|rd|th)?/),function(s){return function(){this.value=s.replace(/\D/g,"")}}),g.expression=_.set([g.rday,g.time,g.value,g.orientation,g.ddd,g.MMM]),g.format=_.process(_.many(_.any(_.process(_.rtoken(/^(dd?d?d?(?!e)|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(fmt){if(g[fmt])return g[fmt];throw $D.Parsing.Exception(fmt)}),_.process(_.rtoken(/^[^dMyhHmstz]+/),function(s){return _.ignore(_.stoken(s))}))),function(rules){return _.process(_.each.apply(null,rules),t.finishExact)}),g._start=_.process(_.set([g.date,g.expression,g.time],g.generalDelimiter,g.whiteSpace),t.finish)},g.buildGrammarFormats(),g._formats=g.formats(["M-d H","ddd H"]),g.start=function(s){try{var r=g._formats.call({},s);if(0===r[1].length)return r}catch(e){}return g._start.call({},s)}}(),function(){function parse(s){var d;return s?s instanceof Date?s.clone():(s.length>=4&&"0"!==s.charAt(0)&&"+"!==s.charAt(0)&&"-"!==s.charAt(0)&&(d=$D.Parsing.Numeric.parse(s)),d instanceof Date&&!isNaN(d.getTime())?d:(s=$D.Parsing.Normalizer.parse(parseUtils.removeOrds(s)),d=parseUtils.grammarParser(s))):null}var $D=Date,parseUtils={removeOrds:function(s){var ords=s.match(/\b(\d+)(?:st|nd|rd|th)\b/);return s=ords&&2===ords.length?s.replace(ords[0],ords[1]):s},grammarParser:function(s){var r=null;try{r=$D.Grammar.start.call({},s.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(e){return null}return 0===r[1].length?r[0]:null}};$D._parse||($D._parse=$D.parse),$D.parse=parse,Date.getParseFunction=function(fx){var fns=Date.Grammar.allformats(fx);return function(s){for(var r=null,i=0;i<fns.length;i++){try{r=fns[i].call({},s)}catch(e){continue}if(0===r[1].length)return r[0]}return null}},$D.parseExact=function(s,fx){return $D.getParseFunction(fx)(s)}}(),function(){var $D=Date,$P=$D.prototype,p=function(s,l){return l||(l=2),("000"+s).slice(-1*l)},normalizer={substitutes:function(m){switch(m){case"d":case"%d":return"dd";case"D":case"%a":return"ddd";case"j":case"l":case"%A":return"dddd";case"S":return"S";case"F":case"%B":return"MMMM";case"m":case"%m":return"MM";case"M":case"%b":case"%h":return"MMM";case"n":return"M";case"Y":case"%Y":return"yyyy";case"y":case"%y":return"yy";case"g":case"%I":return"h";case"G":return"H";case"h":return"hh";case"H":case"%H":return"HH";case"i":case"%M":return"mm";case"s":case"%S":return"ss";case"%r":return"hh:mm tt";case"%R":return"H:mm";case"%T":return"H:mm:ss";case"%X":return"t";case"%x":case"%e":return"d";case"%D":return"MM/dd/yy";case"%n":return"\\n";case"%t":return"\\t";case"e":case"T":case"%z":case"%Z":return"z";case"Z":return"ZZ";case"N":case"w":case"%w":return"u";case"W":case"%V":return"W"}},interpreted:function(m,x){var y;switch(m){case"%u":return x.getDay()+1;case"z":return x.getOrdinalNumber();case"%j":return p(x.getOrdinalNumber(),3);case"%U":var d1=x.clone().set({month:0,day:1}).addDays(-1).moveToDayOfWeek(0),d2=x.clone().addDays(1).moveToDayOfWeek(0,-1);return d1>d2?"00":p((d2.getOrdinalNumber()-d1.getOrdinalNumber())/7+1);case"%W":return p(x.getWeek());case"t":return $D.getDaysInMonth(x.getFullYear(),x.getMonth());case"o":case"%G":return x.setWeek(x.getISOWeek()).toString("yyyy");case"%g":return x._format("%G").slice(-2);case"a":case"%p":return t("tt").toLowerCase();case"A":return t("tt").toUpperCase();case"u":return p(x.getMilliseconds(),3);case"I":return x.isDaylightSavingTime()?1:0;case"O":return x.getUTCOffset();case"P":return y=x.getUTCOffset(),y.substring(0,y.length-2)+":"+y.substring(y.length-2);case"B":var now=new Date;return Math.floor((3600*now.getHours()+60*now.getMinutes()+now.getSeconds()+60*(now.getTimezoneOffset()+60))/86.4);case"c":return x.toISOString().replace(/\"/g,"");case"U":return $D.strtotime("now");case"%c":return t("d")+" "+t("t");case"%C":return Math.floor(x.getFullYear()/100+1)}},shouldOverrideDefaults:function(m){switch(m){case"%e":return!0;default:return!1}},parse:function(m,context){var formatString,c=context||new Date;return(formatString=normalizer.substitutes(m))?formatString:(formatString=normalizer.interpreted(m,c),formatString?formatString:m)}};$D.normalizeFormat=function(format,context){return format.replace(/(%|\\)?.|%%/g,function(t){return normalizer.parse(t,context)})},$D.strftime=function(format,time){var d=Date.parse(time);return d._format(format)},$D.strtotime=function(time){var d=$D.parse(time);return Math.round($D.UTC(d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate(),d.getUTCHours(),d.getUTCMinutes(),d.getUTCSeconds(),d.getUTCMilliseconds())/1e3)};var formatReplace=function(context){return function(m){var formatString,override=!1;return"\\"===m.charAt(0)||"%%"===m.substring(0,2)?m.replace("\\","").replace("%%","%"):(override=normalizer.shouldOverrideDefaults(m),formatString=$D.normalizeFormat(m,context),formatString?context.toString(formatString,override):void 0)}};$P._format=function(format){var formatter=formatReplace(this);return format?format.replace(/(%|\\)?.|%%/g,formatter):this._toString()},$P.format||($P.format=$P._format)}(),function(){var gFn=function(attr){return function(){return this[attr]}},sFn=function(attr){return function(val){return this[attr]=val,this}},attrs=["years","months","days","hours","minutes","seconds","milliseconds"],addSetFuncs=function(context,attrs){for(var i=0;i<attrs.length;i++){var $a=attrs[i],$b=$a.slice(0,1).toUpperCase()+$a.slice(1);context.prototype[$a]=0,context.prototype["get"+$b]=gFn($a),context.prototype["set"+$b]=sFn($a)}},TimeSpan=function(days,hours,minutes,seconds,milliseconds){if(1===arguments.length&&"number"==typeof days){var orient=0>days?-1:1,millsLeft=Math.abs(days);this.setDays(Math.floor(millsLeft/864e5)*orient),millsLeft%=864e5,this.setHours(Math.floor(millsLeft/36e5)*orient),millsLeft%=36e5,this.setMinutes(Math.floor(millsLeft/6e4)*orient),millsLeft%=6e4,this.setSeconds(Math.floor(millsLeft/1e3)*orient),millsLeft%=1e3,this.setMilliseconds(millsLeft*orient)}else this.set(days,hours,minutes,seconds,milliseconds);return this.getTotalMilliseconds=function(){return 864e5*this.getDays()+36e5*this.getHours()+6e4*this.getMinutes()+1e3*this.getSeconds()},this.compareTo=function(time){var t1=new Date(1970,1,1,this.getHours(),this.getMinutes(),this.getSeconds()),t2;return t2=null===time?new Date(1970,1,1,0,0,0):new Date(1970,1,1,time.getHours(),time.getMinutes(),time.getSeconds()),t2>t1?-1:t1>t2?1:0},this.equals=function(time){return 0===this.compareTo(time)},this.add=function(time){return null===time?this:this.addSeconds(time.getTotalMilliseconds()/1e3)},this.subtract=function(time){return null===time?this:this.addSeconds(-time.getTotalMilliseconds()/1e3)},this.addDays=function(n){return new TimeSpan(this.getTotalMilliseconds()+864e5*n)},this.addHours=function(n){return new TimeSpan(this.getTotalMilliseconds()+36e5*n)},this.addMinutes=function(n){return new TimeSpan(this.getTotalMilliseconds()+6e4*n)},this.addSeconds=function(n){return new TimeSpan(this.getTotalMilliseconds()+1e3*n)},this.addMilliseconds=function(n){return new TimeSpan(this.getTotalMilliseconds()+n)},this.get12HourHour=function(){return this.getHours()>12?this.getHours()-12:0===this.getHours()?12:this.getHours()},this.getDesignator=function(){return this.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator},this.toString=function(format){this._toString=function(){return null!==this.getDays()&&this.getDays()>0?this.getDays()+"."+this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds()):this.getHours()+":"+this.p(this.getMinutes())+":"+this.p(this.getSeconds())},this.p=function(s){return s.toString().length<2?"0"+s:s};var me=this;return format?format.replace(/dd?|HH?|hh?|mm?|ss?|tt?/g,function(format){switch(format){case"d":return me.getDays();case"dd":return me.p(me.getDays());case"H":return me.getHours();case"HH":return me.p(me.getHours());case"h":return me.get12HourHour();case"hh":return me.p(me.get12HourHour());case"m":return me.getMinutes();case"mm":return me.p(me.getMinutes());case"s":return me.getSeconds();case"ss":return me.p(me.getSeconds());case"t":return(me.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator).substring(0,1);case"tt":return me.getHours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator}}):this._toString()},this};addSetFuncs(TimeSpan,attrs.slice(2)),TimeSpan.prototype.set=function(days,hours,minutes,seconds,milliseconds){this.setDays(days||this.getDays()),this.setHours(hours||this.getHours()),this.setMinutes(minutes||this.getMinutes()),this.setSeconds(seconds||this.getSeconds()),this.setMilliseconds(milliseconds||this.getMilliseconds())},Date.prototype.getTimeOfDay=function(){return this.getMilliseconds()+1e3*this.getSeconds()+6e4*this.getMinutes()+36e5*this.getHours()},Date.prototype.hasTimeOfDay=function(){return 0!==this.getHours()||0!==this.getMinutes()||0!==this.getSeconds()||0!==this.getMilliseconds()},Date.prototype.isRepeatDate=function(){return!1},Date.TimeSpan=TimeSpan,"undefined"!=typeof window&&(window.TimeSpan=TimeSpan)}(),function(){var attrs=["years","months","days","hours","minutes","seconds","milliseconds"],gFn=function(attr){return function(){return this[attr]}},sFn=function(attr){return function(val){return this[attr]=val,this}},addSetFuncs=function(context,attrs){for(var i=0;i<attrs.length;i++){var $a=attrs[i],$b=$a.slice(0,1).toUpperCase()+$a.slice(1);context.prototype[$a]=0,context.prototype["get"+$b]=gFn($a),context.prototype["set"+$b]=sFn($a)}},setMonthsAndYears=function(orient,d1,d2,context){function inc(){d1.addMonths(-orient),context.months++,12===context.months&&(context.years++,context.months=0)}if(1===orient)for(;d1>d2;)inc();else for(;d2>d1;)inc();context.months--,context.months*=orient,context.years*=orient},adjustForDST=function(orient,startDate,endDate){var hasDSTMismatch=!1==(startDate.isDaylightSavingTime()===endDate.isDaylightSavingTime());hasDSTMismatch&&1===orient?startDate.addHours(-1):hasDSTMismatch&&startDate.addHours(1)},TimePeriod=function(years,months,days,hours,minutes,seconds,milliseconds){if(7===arguments.length)this.set(years,months,days,hours,minutes,seconds,milliseconds);else if(2===arguments.length&&arguments[0]instanceof Date&&arguments[1]instanceof Date){var startDate=arguments[0].clone(),endDate=arguments[1].clone(),orient=startDate>endDate?1:-1;this.dates={start:arguments[0].clone(),end:arguments[1].clone()},setMonthsAndYears(orient,startDate,endDate,this),adjustForDST(orient,startDate,endDate);var diff=endDate-startDate;if(0!==diff){var ts=new TimeSpan(diff);this.set(this.years,this.months,ts.getDays(),ts.getHours(),ts.getMinutes(),ts.getSeconds(),ts.getMilliseconds())}}return this};addSetFuncs(TimePeriod,attrs),TimePeriod.prototype.set=function(years,months,days,hours,minutes,seconds,milliseconds){this.setYears(years||this.getYears()),this.setMonths(months||this.getMonths()),this.setDays(days||this.getDays()),this.setHours(hours||this.getHours()),this.setMinutes(minutes||this.getMinutes()),this.setSeconds(seconds||this.getSeconds()),this.setMilliseconds(milliseconds||this.getMilliseconds())},Date.TimePeriod=TimePeriod,"undefined"!=typeof window&&(window.TimePeriod=TimePeriod)}(),define("date",function(){}),define("globals",["ko","platform","util","IScroll","date"],function(ko,platform,util,IScroll){function murmurhash3_32_gc(key,seed){var remainder,bytes,h1,h1b,c1,c2,k1,i;for(remainder=3&key.length,bytes=key.length-remainder,h1=seed,c1=3432918353,c2=461845907,i=0;bytes>i;)k1=255&key.charCodeAt(i)|(255&key.charCodeAt(++i))<<8|(255&key.charCodeAt(++i))<<16|(255&key.charCodeAt(++i))<<24,++i,k1=(65535&k1)*c1+(((k1>>>16)*c1&65535)<<16)&4294967295,k1=k1<<15|k1>>>17,k1=(65535&k1)*c2+(((k1>>>16)*c2&65535)<<16)&4294967295,h1^=k1,h1=h1<<13|h1>>>19,h1b=5*(65535&h1)+((5*(h1>>>16)&65535)<<16)&4294967295,h1=(65535&h1b)+27492+(((h1b>>>16)+58964&65535)<<16);switch(k1=0,remainder){case 3:k1^=(255&key.charCodeAt(i+2))<<16;case 2:k1^=(255&key.charCodeAt(i+1))<<8;case 1:k1^=255&key.charCodeAt(i),k1=(65535&k1)*c1+(((k1>>>16)*c1&65535)<<16)&4294967295,k1=k1<<15|k1>>>17,k1=(65535&k1)*c2+(((k1>>>16)*c2&65535)<<16)&4294967295,h1^=k1}return h1^=key.length,h1^=h1>>>16,h1=2246822507*(65535&h1)+((2246822507*(h1>>>16)&65535)<<16)&4294967295,h1^=h1>>>13,h1=3266489909*(65535&h1)+((3266489909*(h1>>>16)&65535)<<16)&4294967295,h1^=h1>>>16,h1>>>0}function sanitizePaneState(stateObj){try{for(var stateOut=JSON.parse(JSON.stringify(stateObj)),i=0;i<stateOut.length;++i)""!==stateOut[i].search&&(stateOut[i].search="HasSearch");return JSON.stringify(stateOut)}catch(err){return"Failed to sanitize pane state"}}function sanitizeLocalSettings(settingsIn){try{var settingsOut=JSON.parse(settingsIn);return delete settingsOut.values.Default.paneState,delete settingsOut.values.Default.gdocTitle,settingsOut}catch(err){return"Failed to parse settings"}}function sanitizeKey(keyIn){switch(keyIn){case KeyCode.BackSpace:return"BACKSPACE";case KeyCode.Delete:return"DELETE";case KeyCode.Enter:return"ENTER";case KeyCode.Escape:return"ESCAPE";default:return"CHAR"}}function sanitizeURL(url){return url.replace(/&?access_token=[^&]*/g,"")}function getExtraReportData(info){platform.getUserPlatformConfig(info)}function rollbarIgnoreFn(isUncaught,args,payload){return rollbarIgnoreFiles.indexOf(payload.data.body.trace.frames[0].filename)>=0?!0:!1}function generateRemoteDebugKey(){var user=self.settings.get(Settings.activeUser);return user?"MooDoRDebug"+(new Date).getTime()+"_"+user:"Unknown"}function wrapFn(func){function wrapper(){try{return func.apply(this,arguments)}catch(err){self.reportError(err)}}return wrapper}function tagEvent(e,info,handlers){e.id||(e.id=eventID++)}function fnCatch(cb){try{self.PAssert(1929,cb,"Must specify a callback")}catch(PERR){self.reportError(PERR)}return function dbgCatch(){try{if(cb)return cb.apply(void 0,arguments)}catch(err){self.reportError(err,arguments)}}}function readyStateCallback(e,callback,error){e.onloadDone=!1,e.onload=function(){e.onloadDone=!0,callback&&callback()},e.onreadystatechange=function(){"loaded"!==e.readyState||e.onloadDone||(e.onloadDone=!0,callback&&callback())},error&&(e.onerror=error)}function makeString(args){for(var str="",i=0;i<args.length;++i)str+=" "+self.safeStringify(args[i]);return str}function isItemValidForPass(item,isTest){return item?isTest?item.lastFindPass===currentFindPass:item.lastFindPass<currentFindPass:!1}function markItemForPass(item,isTest){if(item){var isItemValid=isItemValidForPass(item,isTest);try{self.PAssert(2015,isItemValid,"Item should always be valid")}catch(PERR){self.reportError(PERR)}return item.lastFindPass=currentFindPass,isItemValid}return!1}function _getPreviousItem(item,pane,options){var found,isTest=options&&options.isTest,ignoreSearch=options&&options.ignoreSearch,sameLevel=options&&options.sameLevel,includeNotes=options&&options.includeNotes;if(!markItemForPass(item,isTest))return void 0;var prev=item.parent();if(!prev)return void 0;if(item.isNote())return item.parent();var index=prev.getChildIndex(item);if(index>0)for(;!found;){for(var newChild=!1,i=index-1;i>=0;i--){var prevChild=prev.getChild(i),isChildValid=markItemForPass(prevChild,isTest);if(!isChildValid){try{self.PAssert(2017,!1,"Invalid child found during findPreviousItem")}catch(PERR){self.reportError(PERR)}return void 0}if(sameLevel||!prevChild.hasChildren()||pane&&prevChild.isCollapsed(pane,!1)){if(ignoreSearch||!pane||!prevChild.isHidden(pane,!1)){found=prevChild,newChild=!0;break}}else if(ignoreSearch||!pane||!prevChild.isHidden(pane,!1)){prev=prevChild,index=prevChild.numChildren(),newChild=!0;break}}if(sameLevel)break;newChild||(found=prev)}else sameLevel||(found=item.parent());includeNotes&&found&&found.hasNote()&&(found=found.getNote());try{self.PAssert(2018,!sameLevel||!found||found.parent()===item.parent(),"Previous item must share the same parent")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2019,isTest||!found||pane&&found.isCollapsed(pane,!1)||item===_getNextItem(found,pane,{isTest:!0,ignoreSearch:ignoreSearch,sameLevel:sameLevel}),"Previous/Next should always match")}catch(PERR){self.reportError(PERR)}return found}function _getNextItem(item,pane,options){var next,isTest=options&&options.isTest,ignoreSearch=options&&options.ignoreSearch,sameLevel=options&&options.sameLevel,includeNotes=options&&options.includeNotes;if(!item)return void 0;if(includeNotes&&item.hasNote())return item.getNote();if(item.isNote()&&(item=item.parent()),!(sameLevel||!item.hasChildren()||pane&&item.isCollapsed(pane,!1)))for(var numChildren=item.numChildren(),i=0;numChildren>i;++i){var candidate=item.getChild(i),isChildValid=markItemForPass(candidate,isTest);if(!isChildValid){try{self.PAssert(2021,!1,"Invalid child found during findNextItem A")}catch(PERR){self.reportError(PERR)}return void 0}if(ignoreSearch||!pane||!candidate.isHidden(pane,!1)){next=candidate,options&&options.numLevels++;break}}for(var cItem=item;!next;){var isParentValid=markItemForPass(cItem,isTest);if(!isParentValid){try{self.PAssert(2022,!1,"Invalid parent found during findNextItem B")}catch(PERR){self.reportError(PERR)}break}var parent=cItem.parent();if(!parent)break;var index=parent.getChildIndex(cItem),numChildren=parent.numChildren();if(!pane||!parent.isCollapsed(pane,!1))for(var i=index+1;numChildren>i;++i){var candidate=parent.getChild(i),isChildValid=markItemForPass(candidate,isTest);if(!isChildValid){try{self.PAssert(2024,!1,"Invalid child found during findNextItem C")}catch(PERR){self.reportError(PERR)}return void 0}if(ignoreSearch||!pane||!candidate.isHidden(pane,!1)){next=candidate;break}}if(cItem=parent,options&&!next&&options.numLevels--,sameLevel||pane&&cItem===pane.getItem())break}try{self.PAssert(2025,!sameLevel||!next||next.parent()===item.parent(),"Next item must share the same parent")
}catch(PERR){self.reportError(PERR)}try{self.PAssert(2026,isTest||!next||item===_getPreviousItem(next,pane,{isTest:!0,ignoreSearch:ignoreSearch,sameLevel:sameLevel}),"Previous/Next should always match")}catch(PERR){self.reportError(PERR)}return next}function performScroll(){var minSpeed=0,maxSpeedAdd=6,delta=minSpeed+maxSpeedAdd*lastState.speed,changed=lastState.pane.addScrollDelta(delta);runScroll&&changed?requestAnimationFrame(performScroll):(lastState.speed=0,lastState.pane=void 0)}function addScrollPadding(element){if(element){var scrollObj=self.dataFor(element);scrollObj&&scrollObj.addPadding&&scrollObj.addPadding()}}function searchVMLIArray(options,array){for(var pane=options.pane,noCollapsed=options.noCollapsed,outline=options.outline,i=0;i<array.length;++i){var item=array[i];(!options.headers||item.showInOutline())&&((!options.comparator||options.comparator(item))&&options.each&&options.each(item),noCollapsed&&item.isCollapsed(pane,outline)||searchFromVMLI(item,options))}}function searchFromVMLI(startItem,options){searchVMLIArray(options,startItem.items.get()),options.includeArchived&&startItem.hasArchivedChildren()&&searchVMLIArray(options,startItem.archivedItems(!0))}function getMapping(obj,map){try{self.PAssert(2095,"string"!=typeof obj,"Should only pass objects to the obj mapping function",obj)}catch(PERR){self.reportError(PERR)}var target={};for(var i in obj){try{self.PAssert(2096,obj.hasOwnProperty(i),"This should always be the case, the prototype shouldn't be extended")}catch(PERR){self.reportError(PERR)}if(void 0!==obj[i]&&null!==obj[i]){var mappedField=map[i];if(mappedField)target[mappedField]=obj[i];else{try{self.PAssert(2097,!1,"Incoming field should be added to the field map",i)}catch(PERR){self.reportError(PERR)}target[i]=obj[i]}}}return target}function fireKeyEventInternal(ele,etype,key){try{self.PAssert(2108,void 0!==key,"Must pass in valid key data to type")}catch(PERR){self.reportError(PERR)}if(ele||(ele=Sel.getStartElement()),document.createEvent&&ele){var eventObj=document.createEvent("Event");eventObj.normCode=key.normCode,eventObj.shiftKey=!!key.shiftKey,eventObj.synthetic=!0,eventObj.initEvent(etype,!0,!0),ele.dispatchEvent(eventObj)}else if(ele)try{self.PAssert(2109,!1,"Unable to fire key event")}catch(PERR){self.reportError(PERR)}else try{self.PAssert(2110,!1,"No element available to fire key event on")}catch(PERR){self.reportError(PERR)}}function fireClickEventInternal(ele,etype,button,optData){try{self.PAssert(2111,void 0!==button,"Must pass in a valid button to click with")}catch(PERR){self.reportError(PERR)}if(ele||(ele=NativeSel.getSelectionNode()),document.createEvent&&ele){var evObj=document.createEvent("Event");if(evObj.button=button,evObj.synthetic=!0,optData)for(var id in optData)evObj[id]=optData[id];evObj.initEvent(etype,!0,!0),ele.dispatchEvent(evObj)}else if(ele)try{self.PAssert(2112,!1,"Unable to fire click event")}catch(PERR){self.reportError(PERR)}else try{self.PAssert(2113,!1,"No element available to fire click event on")}catch(PERR){self.reportError(PERR)}}function loadDone(){document.removeEventListener("DOMContentLoaded",loadDone,!1),window.removeEventListener("load",loadDone,!1);for(var i=0;i<onLoadCallbacks.length;++i)onLoadCallbacks[i]();onLoadCallbacks=void 0}function generateQueryString(data){var queryString="";if("object"==typeof data){var queryArr=[];for(var key in data)queryArr[queryArr.length]=encodeURIComponent(key)+"="+encodeURIComponent(data[key]);queryString=queryArr.join("&").replace(/%20/g,"+")}else{try{self.PAssert(2145,"string"==typeof data,"Only Objects or Strings are currently supported")}catch(PERR){self.reportError(PERR)}queryString=data}return queryString}function ensureStatsXHR(url){var sanitizedURL=sanitizeURL(url),baseURL=sanitizedURL.split("?")[0];return __xhrRequests[baseURL]||(__xhrRequests[baseURL]={requests:0,retries:0,failures:0}),__xhrRequests[baseURL]}function notifyStatsXHRRequest(url){var stats=ensureStatsXHR(url);stats.requests++}function notifyStatsXHRRetry(url){var stats=ensureStatsXHR(url);stats.retries++}function notifyStatsXHRFailure(url){var stats=ensureStatsXHR(url);stats.failures++}function notifyXHR(xhr){var notifier;if(notifier=shouldNotifyXHR(xhr.url)){xhr.iid=idXHR++;var _rsc=xhr.onreadystatechange;xhr.onreadystatechange=function(){_rsc&&_rsc(),notifier(this)}}}function shouldNotifyXHR(url){return notifyURLs[url.split("?")[0]]}var self={vmMain:void 0,vmDebug:void 0,topBarHeight:platform.android?48:44,topBoxHeight:platform.phone?40:36,agendaPadding:34,keyboardToolbarHeight:40,maxPaneWidth:900,minPaneWidth:400,iOSDragTime:400,iOSDragTimeKeyboardOpen:200,outlineWidthPerc:.85,itemTextPadding:5,hasFocus:!0,zoomTime:0,demoMode:!1,intro:void 0,focusedPane:void 0,focusedItem:void 0,isScrolling:!1,ClickThreshold:5,isFirstRun:!1,topLevelInitId:void 0,isReconnected:!1,noLocalWrites:!1,isLoadingRemote:!1,canRevealMenu:!0,revealingMenu:!1,isKeyboardOpen:!1,itemMenuOpenedOn:void 0,errorPlatformInfo:void 0,nativeBacklog:[],nativeBridge:{sendToApp:function(method,data){self.nativeBacklog.push({method:method,data:data})}},elements:{},SPThresholdLeft:8,SPThresholdRight:32,MobileSideTapThreshold:40,MobileSideTapThresholdKeyboardOpen:15,itemLineHeight:18,itemPad:7,minItemHeight:32};self.paneTop=platform.mobile?self.topBarHeight:45,self.itemPaddingStart=platform.phone?24:30,self.itemPaddingIncrement=20,self.outlinePaddingStart=platform.phone?16:12,self.outlinePaddingIncrement=18;var android={isEnabled:function(){return!!platform.android}},VMLI,VMPane,NativeSel,Sel;require(["android","VMLI","VMPane","NativeSel","Sel"],function(droidLoad,VMLILoad,VMPaneLoad,NativeSelLoad,SelLoad){android=droidLoad,VMLI=VMLILoad,VMPane=VMPaneLoad,NativeSel=NativeSelLoad,Sel=SelLoad}),window.ScrollDuration={Snap:0,Default:200,Slow:500},window.KeyCode={BackSpace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,End:35,Home:36,LeftArrow:37,UpArrow:38,RightArrow:39,DownArrow:40,Delete:46,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D8:56,Colon:58,LAngle:60,RAngle:62,At:64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,L:76,N:78,O:79,S:83,U:85,V:86,Y:89,Z:90,LeftMeta:91,RightMeta:93,NumPlus:107,F1:112,F4:115,F12:123,Equals:187,Comma:188,Dash:189,Period:190,Slash:191,Tilde:192,LBracket:219,RBracket:221,Apos:222},window.ButtonCode={None:-1,Left:0,Middle:1,Right:2},window.Direction={Up:-1,None:0,Down:1},window.TextSpace="﻿",window.AttachChar=" ",window.EmbedAttachChar=" ",window.DriveStatus={Offline:0,Connecting:1,Saving:2,Saved:3,Reconnecting:4},window.PaneMode={Normal:"PaneNormal",Timeline:"PaneTimeline"},window.MessageAction={Default:0,Reload:1,LoginScreen:2,Demo:3,ResetClient:4,None:5,SyncContacts:6,OpenURL:7,Okay:8,Blog:9,Undo:10,Contact:11,OpenSettings:12,OpenAccountSettings:13,OpenGoogleDrive:14},window.MessageType={Info:0,Warning:1,Error:2,Fatal:3,Subtitle:4,Intro:5,RequiredUpdate:6,InfoGray:7},window.MessageID={Undefined:0,ConnectionError:1,OfflineUndo:2,FatalError:3,DocChange:4,OfflineWarn:5,OnlineInfo:6,CacheReset:7,RequiredUpdate:8,Updated:9,SyncContacts:10,ExitDemo:11,Reauthorize:12,ShareFailure:13,ThisIsDemo:14,MailbirdClick:15,InviteFailure:16,InviteSuccess:17,PremiumRequired:18,TrialOver:19,TrialEndSoon:20,DisabledFolderDrop:21,WarnLargeFile:22,InviteInvalid:23,NoSharingWarning:24,LostPermission:25},window.VMLIFlag={None:0,Header:1,Collapsed:2,Selected:4,Highlighted:8,NumList:16,Note:32,Multiline:64,Complete:4096,P2:8192,P1:16384,P0:32768,Starred:65536,HasPageToken:131072,DisplayComplete:262144},window.UninitializedVersion=-1,window.VersionType={Structure:1,Text:2},window.SaveFlag={None:0,Prop:1,Text:2,All:3},window.RepeatFreq={Once:0,Daily:1,Weekly:2,Monthly:3,DayOfMonth:4,Yearly:5,EndOfMonthOffset:6,NthMonthInst:7},window.DateType={Once:1,Repeat:2},window.ChangeType={None:0,Local:1,Remote:2,Auto:4,Text:1073741824,Property:2147483648,All:3221225472,Rollover:1048576,AllLocal:3221225473},window.PropChangeType={None:0,Date:2,Complete:4,Archive:8,Starred:16,Priority:32,All:63},window.StorageType={InMemory:1,LocalStorage:2,IndexedDB:3},window.LoginState={NONE:0,LOGGED_OUT:1,LOGGED_IN:2},window.ReturnValue={Success:0,Error:1,FatalError:2},window.OAuthSchemeType={Invalid:-1,None:0,Web:1,Native:2,Count:2},window.ACProvider={None:0,Contact:1,DatePicker:2,DateList:3,Tag:4,Search:5},window.DataSource={Paste:1,Drop:2,Plugin:3},window.DropEffect={Copy:"copy",Move:"move"},window.PluginID={Moodo:"Moodo",Contacts:"Contacts",Drive:"Drive",Mailbird:"Mailbird",Gmail:"Gmail",GCalendar:"GCalendar"},window.PluginLoad={Preview:1,Full:2,Runtime:4,Autocomplete:8},window.PluginDependency={DemoMode:"DemoMode",DriveAPI:"DriveAPI",GmailAPI:"GmailAPI",CalendarAPI:"CalendarAPI",GoogleLogin:"GoogleLogin",PremiumSub:"PremiumSub",EarlyAccess:"EarlyAccess"},window.PluginRenderTypes={Generic:0,StyledText:1,UnstyledText:2,AutocompleteText:3,AgendaEntry:4,Measure:5},window.PluginRenderers={DriveFile:0,EmailThread:1,CalendarEvent:2},window.PerPaneStateField={Element:"element",OutlineElement:"oelement",Collapsed:"collapsed",CollapsedOutline:"collapsedOutline",CollapsedSearch:"collapsedSearch",NumLines:"numLines",NumLinesOutline:"numLinesOutline"},window.Modals={ReportBug:"reportBug",ImportData:"importData",ExportData:"exportData",RecoverData:"recoverData",ShareDoc:"shareDoc",MobileSettings:"mobileSettings",Settings:"settings",Confirm:"confirm",Alert:"alert",Billing:"billing",DeleteAccount:"deleteAccount"},window.PremiumStatus={Unknown:0,Never:1,Trial:2,TrialOver:3,Active:4,PastDue:5,CanceledUser:6,CanceledPastDue:7},function(){function ec(code){return code}window.PrivateAPIErrorCodes={Success:0,UnknownFailure:ec(1),Unexpected:ec(2),DatabaseReadError:ec(3),DatabaseWriteError:ec(4),MissingParameter:ec(5),InvalidParameter:ec(6),UnauthorizedUser:ec(7),ErrorSendingEmail:ec(8),AlreadyReferred:ec(9),ErrorContactingRemote:ec(10),BraintreeUnknown:ec(11),InvalidToken:ec(12),InvalidReferralCode:ec(13),NoSignupFound:ec(14)}}(),window.DataChangeType={Add:1,Remove:2,Change:3},window.SearchResultStatus={Done:1,TooMany:2,None:3,Error:4},window.Settings={theme:"theme",syncContacts:"syncContacts",lastContactSync:"lastContactSync",disableNotifications:"disableNotifications",rootFolderId:"rootFolderId",authScopes:"authScopes",localIntegrity:"localIntegrity",localDataVersion:"localDataVersion",shownTutorial:"shownTutorial",gdocId:"gdocId",gdocTitle:"gdocTitle",activeUser:"activeUser",noSounds:"noSounds",lastServerVersion:"lastServerVersion",helpPaneState:"helpPaneState",oauthScheme:"oauthScheme",premiumStatus:"zzp",trialStart:"pzs",trialDuration:"pzd",premiumEndDate:"ped",notifiedTrialOver:"notifiedTrialOver",notifiedTrialEndSoon:"notifiedTrialEndSoon"},self.isFlagSet=function isFlagSetFn(data,mask){return(data&mask)===mask},self.isOneFlagSet=function isOneFlagSetFn(data,mask){var mmv=data&mask;return 0!==mmv&&0===(mmv&mmv-1)},self.isAtLeastOneFlagSet=function isAtLeastOneFlagSetFn(data,mask){return 0!==(data&mask)},self.forEachFlagSet=function forEachFlagSetFn(data,fn){for(;0!==data;){var flag=data&-data;fn(flag),data&=data-1}},self.PCMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2|VMLIFlag.Complete,self.PMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2,self.fieldMapIn={id:"id",items:"i",archivedItems:"ai",text:"t",modifiedOffline:"l",modifiedOfflineText:"o",versionText:"u",version:"v",formats:"f",isArchived:"a",isDeleted:"x",isCollapsed:"m",note:"n",isNote:"k",date:"d",dateText:"s",allDayDate:"ad",repeatDate:"r",dateCreated:"c",dateCompleted:"^",priority:"p",isComplete:"z",isStarred:"*"},self.priorityMapOut={},self.priorityMapOut[VMLIFlag.None]=" ",self.priorityMapOut[VMLIFlag.P0]=" p0",self.priorityMapOut[VMLIFlag.P1]=" p1",self.priorityMapOut[VMLIFlag.P2]=" p2",window.NumListPrefix="#.",window.NumListPrefixOther="1.",window.DatePrefix="@",window.ContactPrefix="+",window.TagPrefix="#";var charMapHTML={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"};self.escape=function escapeFn(text){return String(text).replace(/[&\"<>]/g,function(c){return charMapHTML[c]})},self.trimPunc=function trimPuncFn(str){return str.replace(/[:,\.\'\"\)\]]$/g,"")},self.getTransitionClass=function getTransitionClassFn(time){var trans;switch(time){case 50:trans="trans05";break;case 100:trans="trans1";break;case 200:trans="trans2";break;case 300:trans="trans3";break;case 400:trans="trans4";break;case 500:trans="trans5";break;case 1e3:trans="trans10";break;default:console.log("ERROR: no time for ",time)}return trans},self.setTransformStyle=function setTransformStyleFn(element,x,y){try{self.PAssert(1886,element,"Must provide a valid element")}catch(PERR){self.reportError(PERR)}if(element){try{self.PAssert(1887,void 0!==x,"Must supply a valid X offset")}catch(PERR){self.reportError(PERR)}try{self.PAssert(1888,void 0!==y,"Must supply a valid Y offset")}catch(PERR){self.reportError(PERR)}element.style[platform.transform.style]=platform.ie?"translate("+x+"px, "+y+"px)":"translate3d("+x+"px, "+y+"px, 0px)"}},self.setTransitionStyle=function setTransitionStyleFn(element,property,time,easing){try{self.PAssert(1889,element,"Must provide a valid element")}catch(PERR){self.reportError(PERR)}element&&(easing=easing||"ease",element.style[platform.transition.style]=property+" "+time+"ms "+easing,setTimeout(function(){element.style[platform.transition.style]=""},time))};var IE_ANIM_WORKAROUND=!1;self.setTransform=function setTransformFn(element,x,y,time,easing){time>0?IE_ANIM_WORKAROUND?self.setTransformStyle(element,x,y):(self.setTransitionStyle(element,platform.transform.prop,time,easing),self.setTransformStyle(element,x,y)):x||y?self.setTransformStyle(element,x,y):element.style[platform.transform.style]="none"},self.reload=function reloadFn(forceFetch){try{self.PAssert(1890,!appCacheUpdating,"Page should not be reloaded while waiting for an appcache update to finish.")}catch(PERR){self.reportError(PERR)}appCacheUpdating&&self.reportError(new Error("Page requesting reload while waiting for AppCache update.")),window.location.reload(forceFetch)},self.isSetupPageOpen=!1,self.isMainPageOpen=!1,self.openMainPage=function openMainPageFn(){self.isSetupPageOpen&&(self.isSetupPageOpen=!1),self.isMainPageOpen||(self.isMainPageOpen=!0);var outer=document.getElementById("outerWrapper"),setup=document.getElementById("setupWrapper");outer&&setup&&(self.removeClass(outer,"none"),self.addClass(setup,"none"))},self.openSetupPage=function openSetupPageFn(){self.isMainPageOpen&&(self.isMainPageOpen=!1),self.addClass(document.getElementById("outerWrapper"),"none"),self.removeClass(document.getElementById("setupWrapper"),"none")};var wasAppCacheUpdated=!1,appCacheUpdating=!1;self.setAppCacheUpdateState=function setAppCacheUpdateStateFn(state){appCacheUpdating=state,state&&(wasAppCacheUpdated=!0)},self.isEmpty=function isEmptyFn(object){for(var i in object)return!1;return!0},self.isEmail=function isEmailFn(string){var regex=new RegExp(/.+@.+\..+/i),results=regex.exec(string);return!!results},self.removeDOM=function removeDOMFn(id){var domElem=document.getElementById(id);try{self.PAssert(1891,domElem,"DOM Element must exist to remove it")}catch(PERR){self.reportError(PERR)}domElem&&domElem.parentNode.removeChild(domElem)},self.isRunningScript=function isRunningScriptFn(){return self.AScript&&self.AScript.isRunning};var isOffline=!1;self.goOnline=function goOnlineFn(){isOffline=!1},self.goOffline=function goOfflineFn(){isOffline=!0},self.isOffline=function isOfflineFn(){return isOffline};var isUserAuthorized=!1,userAuthorizedCBList=[];self.notifyUserAuthorized=function notifyUserAuthorizedFn(){for(var i=0;i<userAuthorizedCBList.length;++i)try{userAuthorizedCBList[i]()}catch(err){self.reportError(err)}isUserAuthorized=!0,userAuthorizedCBList=[]},self.onUserAuthorized=function onUserAuthorizedFn(cb){var token=require("goog").getAccessToken(!0);token&&isUserAuthorized?cb():(isUserAuthorized=!1,userAuthorizedCBList.push(cb))},self.preventLocalWrites=function preventLocalWritesFn(){ShouldLog(LogLevels.Warning)&&log("---- WARNING: Local Writes Disabled ----"),self.noLocalWrites=!0},self.shouldWriteLocal=function shouldWriteLocalFn(){return!self.noLocalWrites},self.enableDemoMode=function enableDemoModeFn(){self.demoMode=!0;var dmode=util.getURLParam("dmode");dmode&&self.enableMinMode(dmode),self.preventLocalWrites()},self.isDemoMode=function isDemoModeFn(){return self.demoMode},window.DisplayMode={Default:0,NoTopBar:1,NoPaneHeaders:2,ForceTwoPane:4,NoScrollbars:8,NoBackground:16,NoPaneTop:32,NoInteraction:64,NoPanePadding:128,NoPaneStyle:256,NoRightClick:512,ShowDemoExit:1024,FullMin:4095},self.activeDisplayMode=DisplayMode.Default,self.isDisplayModeActive=function isDisplayModeActiveFn(mode){return(self.activeDisplayMode&mode)===mode},self.enableMinMode=function enableMinModeFn(mode){try{if(self.addClass(document.body,"minMode"),self.isMinMode=!0,mode=parseInt(mode),platform.touch||(mode&DisplayMode.NoTopBar&&self.addClass(document.documentElement,"noTopBar"),mode&DisplayMode.NoPaneHeaders&&self.addClass(document.body,"noPaneHeaders"),mode&DisplayMode.NoPaneTop&&(self.addClass(document.body,"noPaneTopBox"),self.topBoxHeight=0),mode&DisplayMode.NoPaneStyle&&self.addClass(document.body,"noPaneStyle")),mode&DisplayMode.NoPanePadding&&self.addClass(document.body,"noPanePadding"),mode&DisplayMode.NoScrollbars&&self.addClass(document.body,"noScrollbars"),mode&DisplayMode.NoBackground){var html=document.getElementsByTagName("html")[0];try{self.PAssert(1892,html,"Must have a valid HTML element")}catch(PERR){self.reportError(PERR)}html&&self.addClass(html,"noBackground")}if(mode&DisplayMode.NoInteraction){var outer=document.getElementById("outerWrapper"),div=document.createElement("div");div.id="preventInteraction",outer.appendChild(div)}mode&DisplayMode.ShowDemoExit&&setTimeout(function(){self.messageQueue.pushMessage(MessageID.ExitDemo)},0),self.activeDisplayMode=parseInt(mode)}catch(err){self.reportError(err)}},self.sendEvent=function sendEventFn(category,action,value){try{self.PAssert(1893,void 0===value||self.isNumber(value),"Values must be numeric")}catch(PERR){self.reportError(PERR)}if(window.ga&&!self.isDemoMode())try{ga("send","event",category,action,self.getAnonUserIdentifier(),value)}catch(err){self.reportError(err,"Category: "+category+" Action: "+action+" Value: "+value)}},self.sendTimeEvent=function sendTimeEventFn(category,variable,value){try{self.PAssert(1894,self.isNumber(value),"Values must be numeric")}catch(PERR){self.reportError(PERR)}if(window.ga&&!self.isDemoMode())try{ga("send","timing",category,variable,value,self.getAnonUserIdentifier())}catch(err){self.reportError(err,"Category: "+category+" Variable: "+variable+" Value: "+value)}};var currentTimeEvent;self.startTimeEvent=function startTimeEventFn(category,variable){if(window.log&&window.log.now){try{self.PAssert(1895,void 0===currentTimeEvent,"This function needs to be updated to allow nested timing events")}catch(PERR){self.reportError(PERR)}currentTimeEvent={startTime:log.now(),category:category,variable:variable}}},self.endTimeEvent=function endTimeEventFn(){if(window.log&&window.log.now){try{self.PAssert(1896,void 0!==currentTimeEvent,"Must have started a timing event")}catch(PERR){self.reportError(PERR)}if(currentTimeEvent){var elapsedTime=log.now()-currentTimeEvent.startTime;self.sendTimeEvent(currentTimeEvent.category,currentTimeEvent.variable,elapsedTime),currentTimeEvent=void 0}}};var aggregateEvents={};self.registerEvent=function registerEventFn(name,category,action){try{self.PAssert(1897,!aggregateEvents.hasOwnProperty(name),"Should only register an event once")}catch(PERR){self.reportError(PERR)}try{self.PAssert(1898,void 0!==name,"Must specify a name for the event")}catch(PERR){self.reportError(PERR)}try{self.PAssert(1899,void 0!==category,"Must specify a category for the event")}catch(PERR){self.reportError(PERR)}try{self.PAssert(1900,void 0!==action,"Must specify an action for the event")}catch(PERR){self.reportError(PERR)}var registerEvent={category:category,action:action,label:self.getAnonUserIdentifier(),count:0};aggregateEvents[name]=registerEvent},self.aggregateEvent=function aggregateEventFn(name,count){try{self.PAssert(1901,aggregateEvents.hasOwnProperty(name),"Must register an event before using it")}catch(PERR){self.reportError(PERR)}void 0===count&&(count=1),aggregateEvents[name]&&(aggregateEvents[name].count+=count)};var isPageDataCleared=!1;self.pageDataCleared=function pageDataClearedFn(){isPageDataCleared=!0},self.onunload=function onunloadFn(){log("Unloading the page");try{for(var evName in aggregateEvents){var ev=aggregateEvents[evName];self.sendEvent(ev.category,ev.action,ev.count),ev.count=0}if(self.vmMain&&self.vmMain.failedGapiLoad?self.sendEvent("ScriptLoad","GapiFailed"):gapiCalled||self.sendEvent("ScriptLoad","GapiNotLoaded"),self.vmMain&&self.vmMain.paneManager.updatePaneScrollState(),isPageDataCleared)self.vmMain&&self.vmMain.pluginManager&&self.vmMain.pluginManager.onShutdown(!1);else{self.vmMain&&self.vmMain.pluginManager&&self.vmMain.pluginManager.onShutdown(!0);try{var gdata=require("gdata");gdata&&self.settings&&self.settings.set(Settings.lastServerVersion,gdata.getServerVersion())}catch(err){}}if(self.isLoadingRemote)return"We are still syncing your changes, are you sure you want to exit?"}catch(errOutside){self.reportError(errOutside)}},platform.demo||(window.onbeforeunload=self.onunload);var lastSetLoginState=LoginState.LOGGED_OUT;self.getLoginState=function getLoginStateFn(){var state=lastSetLoginState;if(self.shouldWriteLocal())try{var savedState=util.storage.getItem("loginState");null!==savedState&&void 0!==savedState&&(state=parseInt(savedState))}catch(err){self.reportError(err)}try{self.PAssert(1902,state===LoginState.NONE||state===LoginState.LOGGED_OUT||state===LoginState.LOGGED_IN,"Invalid login state set")}catch(PERR){self.reportError(PERR)}return state},self.setLoginState=function setLoginStateFn(value){try{self.PAssert(1903,null!==value&&void 0!==value&&!isNaN(value),"Should always be a valid LoginState enum value")}catch(PERR){self.reportError(PERR)}if(lastSetLoginState=value,self.shouldWriteLocal())try{(isNaN(value)||null===value||void 0===value)&&(value=LoginState.LOGGED_OUT);try{self.PAssert(1904,value===LoginState.NONE||value===LoginState.LOGGED_OUT||value===LoginState.LOGGED_IN,"Invalid login state set")}catch(PERR){self.reportError(PERR)}util.storage.setItem("loginState",value)}catch(err){self.reportError(err)}};var noSync,syncReport,snapshots;self.applyBindings=function applyBindingsFn(model,eleID){var elem=document.getElementById(eleID);try{self.PAssert(1920,model,"A valid model must be defined when apply bindings")}catch(PERR){self.reportError(PERR)}try{self.PAssert(1921,elem,"A valid element must be defined when apply bindings")}catch(PERR){self.reportError(PERR)}if(elem&&model)try{ko.applyBindings(model,elem)}catch(err){throw err.message+=" | Binding on: "+self.elementToString(elem),self.reportError(err),err}else{var errStr="Invalid model or element passed to applyBindings | ";errStr+=elem?"NoModel - Elem: "+self.elementToString(elem):model?"NoElem - Elem: #"+eleID:"NoModelNoElem - Elem: #"+eleID,self.reportError(new Error(errStr))}},ko.bindingHandlers.load={init:function initFn(element,valueAccessor,allBindingsAccessor,viewModel,context){try{self.PAssert(1922,viewModel,"Must always be passing in a valid view model to load - "+self.elementToString(element))}catch(PERR){self.reportError(PERR)}try{self.PAssert(1923,viewModel.onLoad,"If no load function is specified, remove the binding from the template - "+self.elementToString(element))}catch(PERR){self.reportError(PERR)}var pIndex=context.$parents.length-2,paneRoot;pIndex>=0&&(paneRoot=context.$parents[pIndex]),viewModel&&viewModel.onLoad&&viewModel.onLoad(element,paneRoot)}},ko.bindingHandlers.check={init:function initFn(element,valueAccessor,allBindingsAccessor,viewModel){var obs=valueAccessor();obs()&&self.addClass(element,"checked"),self.setupClick(element,viewModel,{onClick:function onClickFn(e){obs(!obs()),obs()?self.addClass(element,"checked"):self.removeClass(element,"checked"),e.preventDefault(),e.stopPropagation()}})},update:function updateFn(element,valueAccessor){var obs=valueAccessor();obs()?self.addClass(element,"checked"):self.removeClass(element,"checked")}};var onRippleTap={timeout:0,onStart:function onStartFn(e){e.pressedAlready||(this.pressed=!0,e.pressedAlready=!0,this.timeout=setTimeout(function(){self.addClass(this,"pressed"),this.pressed||setTimeout(function(){self.removeClass(this,"pressed")}.bind(this),60)}.bind(this),120))},onFirstMove:function onFirstMoveFn(){this.pressed&&(clearTimeout(this.timeout),self.removeClass(this,"pressed"),this.pressed=!1)},onEnd:function onEndFn(){this.pressed&&(self.removeClass(this,"pressed"),this.pressed=!1)}};ko.bindingHandlers.ripple={init:function initFn(element){self.setupClick(element,void 0,onRippleTap)}},ko.bindingHandlers.tap={init:function initFn(element,valueAccessor,allBindingsAccessor,viewModel){self.setupClick(element,viewModel,valueAccessor())}},ko.bindingHandlers.stopBinding={init:function initFn(){return{controlsDescendantBindings:!0}}},ko.bindingHandlers.tooltip={init:function initFn(element,valueAccessor){platform.mobile||self.setupMouseOver(element,ko.utils.unwrapObservable(valueAccessor()),!1)},update:function updateFn(element,valueAccessor){platform.mobile||self.setupMouseOver(element,ko.utils.unwrapObservable(valueAccessor()),!0)}},self.setupMouseOver=function setupMouseOverFn(element,value,isUpdate){try{self.PAssert(1924,!platform.mobile)}catch(PERR){self.reportError(PERR)}self.tooltip?isUpdate?self.tooltip.update(element,value):self.tooltip.register(element,value):self.reportError(new Error("Tooltips registered before VMTooltip created"))},"function"!=typeof String.prototype.startsWith&&(Object.defineProperty?Object.defineProperty(String.prototype,"startsWith",{enumerable:!1,configurable:!1,writable:!1,value:function valueFn(searchString,position){return position=position||0,this.lastIndexOf(searchString,position)===position}}):String.prototype.startsWith=function(str){return 0===this.lastIndexOf(str,0)}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(str){return-1!==this.indexOf(str,this.length-str.length)}),"function"!=typeof String.prototype.prevIndexOf&&(String.prototype.prevIndexOf=function(ch,offset){for(var idx=-1,i=offset-1;i>=0;--i)if(this[i]===ch){idx=i;break}return idx}),ko.bindingHandlers.css2=ko.bindingHandlers.css,self.findFirstDiff=function findFirstDiffFn(str1,str2,ignoreCase,preferFirst){if(!str1)return str2.length;if(!str2)return str1.length;for(var minLen=Math.min(str1.length,str2.length),i=0;minLen>i;++i)if(ignoreCase){if(str1.charAt(i).toLowerCase()!==str2.charAt(i).toLowerCase())return i}else if(str1.charAt(i)!==str2.charAt(i))return i;return preferFirst?str1.length:str2.length},self.findMatchingLength=function findMatchingLengthFn(str1,str2,ignoreCase){if(!str1||!str2)return 0;for(var minLen=Math.min(str1.length,str2.length),i=0;minLen>i;++i)if(ignoreCase){if(str1.charAt(i).toLowerCase()!==str2.charAt(i).toLowerCase())return i}else if(str1.charAt(i)!==str2.charAt(i))return i;return minLen},self.TEMP_PREFIX="~T^";var idx=0;self.generateTempId=function generateTempIdFn(){return self.TEMP_PREFIX+Date.now()+ ++idx},self.isTempId=function isTempIdFn(id){return id[0]===self.TEMP_PREFIX[0]&&id[1]===self.TEMP_PREFIX[1]&&id[2]===self.TEMP_PREFIX[2]},self.isLocalItem=function isLocalItemFn(item){try{self.PAssert(1925,item.id,"All items should have an ID even if it is a temp one")}catch(PERR){self.reportError(PERR)}return self.isTempId(item.id)},self.requestNotification=function requestNotificationFn(platform){var reqForm=document.forms.requestNotification,reqResult=document.getElementById("notificationResult"),email=reqForm.email.value;return void 0===email||null===email||email.length<5?reqResult.innerText="Please enter a valid email address.":self.XHR_PrivateAPI({type:"POST",path:"/feedback/notification",data:{email:email,platform:platform},cb:function cbFn(xhr){200===xhr.status?(reqForm.email.value="",reqResult.innerText="Thanks for your interest!"):reqResult.innerText="There was an error processing your request, please try again in a few minutes."}}),!1};var cachedID;self.getUserIdentifier=function getUserIdentifierFn(){if(!cachedID){var goog=require("goog"),user=(goog?goog.getCurrentUserEmail():void 0)||(self.settings?self.settings.get(Settings.activeUser):void 0);if(!user)return"Unknown";cachedID=user}return cachedID};var anonID;self.getAnonUserIdentifier=function getAnonUserIdentifierFn(){if(!anonID){var userID=self.getUserIdentifier();anonID=userID[0]+userID[1]+userID[2]+murmurhash3_32_gc(userID,17124123)}return anonID},self.introHash=function introHashFn(str){return murmurhash3_32_gc(str,347236113)},self.getAppStats=function getAppStatsFn(obj){if(obj.numItems=window.__TOTAL_ITEMS,obj.numArchivedItems=window.__TOTAL_ARCHIVED_ITEMS,obj.numArchiveParents=window.__TOTAL_ARCHIVE_PARENTS,obj.parseTextCalls=window.__PARSE_TEXT_TOTAL_CALLS,obj.notificationUpdatesFull=window.__FULL_NOTIFICATION_UPDATES,obj.notificationUpdatesSingle=window.__SINGLE_NOTIFICATION_UPDATES,obj.XHRStats=self.getXHRStats(),self.vmMain&&self.vmMain.pluginManager)try{obj.pluginStats=self.vmMain.pluginManager.getStats()}catch(err){obj.pluginStats="Error: "+err.message}if(self.vmMain&&self.vmMain.taskManager)try{obj.taskStats=self.vmMain.taskManager.getStats()}catch(err){obj.taskStats="Error: "+err.message}if(DETAILED_STATS)try{obj.previewCacheStats=require("gdata").getPreviewCacheStats()}catch(err){obj.previewCacheStats="Error: "+err.message}try{obj.measureStats=require("Measure").getMeasureStats()}catch(err){obj.measureStats="Error: "+err.message}},self.getRunningState=function getRunningStateFn(obj){var paneState;try{paneState=self.vmMain.paneManager.getPaneState()}catch(err){log("Failed to get paneState")}obj.isDebug=!1,obj.isDemo=self.isDemoMode(),obj.localWrites=self.shouldWriteLocal(),obj.isReconnected=self.isReconnected,obj.url=sanitizeURL(window.location.href),obj.paneState=sanitizePaneState(paneState),obj.localSettings=self.settings?sanitizeLocalSettings(self.settings.getRawSettings()):"Not Initialized",obj.loginState=self.getLoginState(),obj.checkpoints=window.__checkpoints,obj.gapiLoadError=gapiLoadError,obj.jsVersion=window.__jsVersion,obj.htmlVersion=document&&document.body?document.body.getAttribute("ver"):"UNKNOWN",obj.windowWidth=window.innerWidth,obj.windowHeight=window.innerHeight,obj.nativesel=self.parseExtra(window.getSelection()),obj.eventStream=self.getEventStream(),obj.trackerStream=self.getTrackerStream(),obj.screenManager=self.ScreenManager?self.ScreenManager.activeScreen:"UNDEFINED",obj.criticalErrorReported=self.criticalErrorReported();try{obj.customsel=require("Sel").dumpState()}catch(err){obj.customsel="Error: "+err.message}try{obj.errorPlatformInfo=JSON.stringify(self.errorPlatformInfo)}catch(err){obj.errorPlatformInfo="Error: "+err.message}try{android&&android.isEnabled()&&(obj.currentKeyboard=android.getActiveKeyboard())}catch(err){obj.currentKeyboard="Error: "+err.message}try{obj.validScreens=JSON.stringify(window.Screens)}catch(err){obj.validScreens="Error: "+err.message}obj.rootId=self.vmMain?self.vmMain.root()?self.vmMain.root().id:"Undefined Root":"VMMain Not Initialized"},self.getPremiumInfo=function getPremiumInfoFn(obj){if(self.billingManager){var premiumInfo={isEnabled:self.billingManager.isPremiumEnabled(),premiumStatus:self.billingManager.getPremiumStatus(),billingIdentifier:self.billingManager.getBillingIdentifier(),btRequested:self.billingManager._braintreeRequested,btLoaded:self.billingManager._braintreeLoaded,ctRequested:self.billingManager._clientTokenRequested,ctLoaded:self.billingManager._clientTokenLoaded,lastSignupError:self.billingManager._lastSignupError};obj.premiumInfo=premiumInfo}else obj.premiumInfo="Billing Manager Not Loaded"},self.getAppInfo=function getAppInfoFn(obj){var gapiStatus="Loaded";
self.vmMain&&self.vmMain.failedGapiLoad?gapiStatus="ErrorLoading":gapiCalled||(gapiStatus="NotLoaded"),obj.gapiStatus=gapiStatus,obj.sessionID=window.__SESSION_ID,obj.appCacheUpdated=wasAppCacheUpdated,platform.getPlatformInfo(obj),self.getRunningState(obj),self.getAppStats(obj),self.getPremiumInfo(obj),require("gdata").getState(obj),require("goog").getUserName(obj)},self.reportSignup=function reportSignupFn(email,info,cb){try{self.PAssert(1926,email,"Must specify a valid email address to signup with")}catch(PERR){self.reportError(PERR)}try{self.PAssert(1927,info,"Must provide valid signup info in addition to an email address")}catch(PERR){self.reportError(PERR)}email&&info&&(info.email=email,getExtraReportData(info),self.XHR_PrivateAPI({type:"POST",path:"/tracking/signup",data:info,requireAuth:!0,cb:function cbFn(xhr){200!==xhr.status?(ShouldLog(LogLevels.Error)&&log("Failed to report signup",xhr.responseText,xhr),cb&&cb(!1)):cb&&cb(!0)}}))};var hasCriticalError=!1;self.criticalErrorReported=function criticalErrorReportedFn(){return hasCriticalError},self.handleCriticalError=function handleCriticalErrorFn(){hasCriticalError=!0;try{if(self.isDemoMode())self.reload();else{var errorNode=document.createElement("div");errorNode.id="criticalError",errorNode.textContent="There was a critical error while loading the app, "+platform.actionVerb()+" to reload.",platform.isTouchDevice?errorNode.addEventListener(platform.touchStartEvent,function(){self.reload()},!0):errorNode.addEventListener(platform.upEvent,function(){self.reload()},!0),self.prependChild(document.body,errorNode),self.removeDOM("outerWrapper"),self.removeDOM("setupWrapper"),self.removeDOM("templates")}}catch(err){self.reportError(err)}},self.safeStringify=function safeStringifyFn(obj){try{return JSON.stringify(obj)}catch(err){}},self.reportEvent=function reportEventFn(e){if(!self.isDemoMode()){var eventString=self.parseExtra(e);eventString&&self.eventStream.push(eventString)}},self.getEventStream=function getEventStreamFn(){return self.eventStream.ordered()},window.__getEventStream=self.getEventStream,self.getTrackerStream=function getTrackerStreamFn(){try{var tracker=require("tracker");return tracker.stringifyGroups()}catch(err){log("Error getting tracker stream: ",err.message)}},self.parseExtra=function parseExtraFn(extra){var extraString;if(extra)try{var info;if(extra instanceof window.KeyboardEvent){var targetEle=self.elementToString(extra.target||extra.srcElement),skipElements=["[INPUT#importPW]","[INPUT#importEmail]","[TEXTAREA#bugDescription.bugDescription editable]"];skipElements.indexOf(targetEle)<0&&(info={type:extra.type,currentTarget:self.elementToString(extra.currentTarget),target:targetEle,keyCode:sanitizeKey(extra.keyCode),normCode:sanitizeKey(extra.normCode),ctrlKey:extra.ctrlKey,shiftKey:extra.shiftKey,metaKey:extra.metaKey,altKey:extra.altKey,tstamp:Date.now()})}else if(extra instanceof window.MouseEvent)info={type:extra.type,currentTarget:self.elementToString(extra.currentTarget),relatedTarget:self.elementToString(extra.relatedTarget),target:self.elementToString(extra.target||extra.srcElement),clientX:extra.clientX,clientY:extra.clientY,ctrlKey:extra.ctrlKey,shiftKey:extra.shiftKey,metaKey:extra.metaKey,altKey:extra.altKey,which:extra.which,button:extra.button,tstamp:Date.now()};else if(window.TouchEvent&&extra instanceof window.TouchEvent){info={type:extra.type,currentTarget:self.elementToString(extra.currentTarget),relatedTarget:self.elementToString(extra.relatedTarget),target:self.elementToString(extra.target||extra.srcElement),tstamp:Date.now()};var touch=extra.touches[0];touch&&(info.clientX=touch.clientX,info.clientY=touch.clientY)}else if(window.PointerEvent&&extra instanceof window.PointerEvent)info={type:extra.type,currentTarget:self.elementToString(extra.currentTarget),relatedTarget:self.elementToString(extra.relatedTarget),target:self.elementToString(extra.target||extra.srcElement),clientX:extra.clientX,clientY:extra.clientY,tstamp:Date.now()};else if(extra instanceof window.Event)info={type:extra.type,currentTarget:self.elementToString(extra.currentTarget),relatedTarget:self.elementToString(extra.relatedTarget),target:self.elementToString(extra.target||extra.srcElement),tstamp:Date.now()};else if(extra instanceof window.Selection)if(0===extra.rangeCount)info={rangeCount:0};else{var range=extra.getRangeAt(0),startElement=range.startContainer,startWasTextNode=!1,endElement=range.endContainer,endWasTextNode=!1;startElement.nodeType===Node.TEXT_NODE&&(startElement=startElement.parentNode,startWasTextNode=!0),endElement.nodeType===Node.TEXT_NODE&&(endElement=endElement.parentNode,endWasTextNode=!0),info={rangeCount:extra.rangeCount,startContainer:self.getElementPath(startElement),startWasTextNode:startWasTextNode,startOffset:range.startOffset,endContainer:self.getElementPath(endElement),endWasTextNode:endWasTextNode,endOffset:range.endOffset}}else info=extra;extraString=info?self.safeStringify(info):void 0}catch(err){log("Error parsing extra "+err.message)}return extraString},window.__jsVersion="1441572654863";var rollbarIgnoreFiles=["http://a.visadd.com/script/layer"];require(["goog"],function(){Rollbar.configure({payload:{environment:platform.getDeployVar(DeployVariable.Environment),person:{id:self.getUserIdentifier()},client:{javascript:{source_map_enabled:!0,code_version:__jsVersion,guess_uncaught_frames:!0}}},checkIgnore:rollbarIgnoreFn})}),window.__MAX_ERRORS_REPORTED=40;var numReported=0,isRollbarConfigured=!1;self.handleJSError=function handleJSErrorFn(msg,stack,extra,noMsg,errorLevel){function reportError(){if(numReported++,numReported<=window.__MAX_ERRORS_REPORTED){var appInfo={};try{self.getAppInfo(appInfo)}catch(appInfoErr){Rollbar.error(appInfoErr)}appInfo.numReported=numReported;var data={url:sanitizeURL(window.location.href),logs:logs,info:appInfo,user:user,extra:extraString,jsVersion:window.__jsVersion,htmlVersion:document&&document.body?document.body.getAttribute("ver"):"UNKNOWN"};if(window.Rollbar){var errObj={message:msg,stack:stack};errorLevel===LogLevels.Error?Rollbar.error(errObj,data):errorLevel===LogLevels.Warning&&Rollbar.warning(errObj,data)}else data.msg=msg,data.stack=stack,self.XHR_PrivateAPI({type:"POST",path:"/feedback/error",data:data,cb:function cbFn(xhr){200!==xhr.status?log("Failed to report remote error",xhr.responseText,xhr):log("Reported Remote Error: ",xhr.responseText)}})}}if(noMsg||window.__error("JS Error: "+msg,"  Stack: ",stack,"  Extra: ",extra),msg||stack){errorLevel||(errorLevel=LogLevels.Error);try{var logs=window.__LOG_BUFFER.ordered().join("\r\n"),user=self.getUserIdentifier();isRollbarConfigured||("Unknown"!==user&&(isRollbarConfigured=!0),Rollbar.configure({payload:{person:{id:user}},checkIgnore:rollbarIgnoreFn}));var extraString=self.parseExtra(extra);reportError()}catch(err){log("Badness happened reporting errors to server: ",err);try{Rollbar.error({message:msg,stack:stack}),Rollbar.error(err)}catch(fatalRollbarErr){log("More badness happened reporting errors to rollbar: ",fatalRollbarErr)}}}else;},window.onerror=function(errorMsg,url,lineNumber,colNumber,errorObj){errorObj?(log("Reported Global OnError: "+errorMsg+" Script: "+url+" Line: "+lineNumber+" Column: "+colNumber),self.reportError(errorObj)):(log("Unreported Global OnError: "+errorMsg+" Script: "+url+" Line: "+lineNumber+" Column: "+colNumber),self.reportError(errorMsg))},self.reportError=function reportErrorFn(err,extra,errorLevel){!err||extra||err.message||err.stack?err&&err.e&&self.isString(err.e)&&(err={message:err.e,stack:self.getCurrentStack("")}):(extra=err,err=void 0),err||(err={message:"Undefined error passed to reporter",stack:self.getCurrentStack("")}),self.handleJSError(err.message,err.stack,extra,!1,errorLevel)},window.__SendInfo=function(text){return self.handleJSError("Remote Client Info",void 0,text,!0),"Thank you for providing your client info!"},window.__CreateDebugSession=function(key){if(window.remote)return"Debug session already started";var debugKey=key||generateRemoteDebugKey();window.rcon=window.console,self.handleJSError("Remote Debug Session",void 0,debugKey,!0),self.addScript("http://jsconsole.com/remote.js?"+debugKey,"rDebugScript");var profileRunning=!1,profileIndex=0,profileName="";return window.rdbg={startProfile:function startProfileFn(forceName){try{return profileRunning?"Profiler already running":(profileName=forceName?forceName:"RDBGProfile_"+profileIndex,window.rcon.profile(profileName),profileRunning=!0,"Profiler Started: "+profileName)}catch(err){return"Error starting profile: "+err.message}},stopProfile:function stopProfileFn(){try{if(profileRunning){window.rcon.profileEnd(profileName),profileRunning=!1;var retString="Profile Completed: "+profileName;return profileName="",profileIndex++,retString}return"Profiler not running, use startProfile()"}catch(err){return"Error stopping profile: "+err.message}}},"Your remote debug session has started: "+debugKey},(util.hasURLParam("rsession")||util.hasURLParam("rdebug","true"))&&setTimeout(function(){var useKey=util.getURLParam("rsession")||generateRemoteDebugKey();window.__CreateDebugSession(useKey),log("%c---- REMOTE DEBUGGING ENABLED: "+useKey+" ----","color: green")},2e3),window.Checkpoint={MainRun:1,RequireLoaded:2,PageLoad:4,LocalDocLoad:8,InitData:16,DBLoaded:32,OnInitializedData:64,InitializeMain:128,LoadDefaultFile:256,MaskRequired:511},self.checkpoint=function checkpointFn(chk){window.__checkpoints|=chk},self.hasSentLowMemoryWarning=ko.observable(!1),self.handleLowMemory=function handleLowMemoryFn(e){self.hasSentLowMemoryWarning()||(self.hasSentLowMemoryWarning(!0),log("Low Memory Event: ",e),self.isNumber(e)&&(e=Math.round(e/1024/1024)+"MB"))};var fnRegex=/function\s+([^(]*?)\s*\(([^)]*)\)/,supportSimpleStack=!0;self.getCurrentStack=function getCurrentStackFn(message){var msg;if(supportSimpleStack||platform.noErrorStacks)try{msg=JSON.stringify(message)}catch(err){log("Error stringifying stack message",err,message)}if(supportSimpleStack){var err=new Error(msg||message);if(err.stack)return err.stack}supportSimpleStack=!1;try{for(var callstack=["GenError: "+(msg||message)],currentFunction=arguments.callee.caller,DEPTH_LIMIT=75,depth=0;currentFunction&&depth++<DEPTH_LIMIT;){var fn=currentFunction.toString(),fnMatch=fnRegex.exec(fn),fnName;fnName=fnMatch&&3===fnMatch.length&&""!==fnMatch[1]&&void 0!==fnMatch[1]?"at "+fnMatch[1]+"("+fnMatch[2].replace(/[\r\n]/g,"")+")":fnMatch&&3===fnMatch.length?"at <anonymous> ("+fnMatch[2].replace(/[\r\n]/g,"")+")":"at <anonymous> (<unknown>)",callstack.push(fnName),currentFunction=currentFunction.caller}return callstack.join("\n")}catch(err2){log("Error generating stack trace",err2)}return""};var remoteUpdateWait=12e5,lastUpdateTime=0;self.checkForRemoteChanges=function checkForRemoteChangesFn(){var currentTime=Date.now();if(lastUpdateTime-currentTime>=remoteUpdateWait)try{self.AppCache&&self.AppCache.checkForUpdate(),self.vmMain&&self.vmMain.vmPicker&&self.vmMain.vmPicker.refreshFiles()}catch(err){self.reportError(err)}finally{lastUpdateTime=currentTime}},self.createRingBuffer=function createRingBufferFn(len){var p=0,b=[],limit=len;return{get:function getFn(i){return b[i]},push:function pushFn(e){b[p]=e,p=(limit+p+1)%limit},count:function countFn(){return p},reset:function resetFn(){p=0,b=[]},buffer:function bufferFn(){return b},limit:function limitFn(lim){limit=lim},ordered:function orderedFn(){return b.slice(p).concat(b.slice(0,p))},entries:function entriesFn(){for(var arr=this.ordered(),i=0;i<arr.length;++i)console.log("---- Entry ["+i+"] ----"),console.log(arr[i])}}},function wrapAsyncCallbacks(){var _helper=function _helperFn(fnName){var originalFn=window[fnName];window[fnName]=function wrapAsyncFn(){var args=Array.prototype.slice.call(arguments),originalCallback=args[0];return"function"==typeof originalCallback&&(args[0]=wrapFn(originalCallback)),originalFn.apply?originalFn.apply(this,args):originalFn(args[0],args[1])}};_helper("setTimeout"),_helper("setInterval")}();var logBufferLength=platform.mobile?30:50;window.__LOG_BUFFER=self.createRingBuffer(logBufferLength);var oldLog=window.log,logErrorReported;self.isDemoMode()||(window.log=function(){try{window.__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," "))}catch(err){window.__LOG_BUFFER.push(Date.now()+": Invalid Log Arguments")}console.log.apply(console,arguments)},window.__log=function(){try{window.__LOG_BUFFER.push(Date.now()+": "+Array.prototype.join.call(arguments," "))}catch(err){window.__LOG_BUFFER.push(Date.now()+": Invalid Log Arguments")}});try{window.console.error=function(){try{var message=arguments[0],stack=arguments[1];2===arguments.length&&self.isString(message)&&self.isString(stack)?self.reportError({message:message,stack:stack}):window.__error.apply(window,arguments)}catch(err){window.__error.apply(window,arguments),self.reportError(err)}}}catch(errorErr){self.reportError(errorErr),log("Unable to override console.error")}for(var i in oldLog)window.log[i]=oldLog[i];self.getObjectInfo=function getObjectInfoFn(obj){try{if(obj&&obj.constructor)return obj.constructor.name}catch(err){self.reportError(err)}return typeof obj},self.isFunction=function isFunctionFn(obj){return!!(obj&&obj.constructor&&obj.call&&obj.apply)},self.isArray=function isArrayFn(obj){return"[object Array]"===Object.prototype.toString.call(obj)},self.isString=function isStringFn(obj){return"string"==typeof obj},self.isObject=function isObjectFn(obj){return"object"==typeof obj&&null!==obj},self.isNumber=function isNumberFn(obj){return"number"==typeof obj},self.isBoolean=function isBooleanFn(obj){return obj===!0||obj===!1},self.isValidChangeType=function isValidChangeTypeFn(changeType){if(void 0!==changeType&&null!==changeType){var type=changeType&~ChangeType.All;return type===ChangeType.None||self.isOneFlagSet(type,ChangeType.Local|ChangeType.Remote|ChangeType.Auto)}return!1},self.isRemoteChange=function isRemoteChangeFn(changeType){var type=changeType&~ChangeType.All;return self.isOneFlagSet(type,ChangeType.Remote)},self.isLocalChange=function isLocalChangeFn(changeType){var type=changeType&~ChangeType.All;return self.isFlagSet(type,ChangeType.Local)},self.isDOMNode=function isDOMNodeFn(obj){return window.HTMLElement?obj instanceof HTMLElement:obj&&obj.tagName&&1===obj.nodeType},self.enumToString=function enumToStringFn(en,value){for(var k in en)if(en[k]===value)return k;return null},self.elementToString=function elementToStringFn(ele,includeLength){if(ele){var nodeString=ele.nodeName;return ele.id&&(nodeString+="#"+ele.id),ele.className&&(nodeString+="."+ele.className.replace(/ /g,".")),includeLength&&ele.innerText&&(nodeString+=":"+ele.innerText.length),nodeString}return"UNDEFINED"},self.getElementPath=function getElementPathFn(ele,includeLength){var isFirst=!0,path="";try{for(;ele!==document.documentElement&&ele!==document.body;)path+=isFirst?self.elementToString(ele,includeLength)+" ":self.elementToString(ele)+" ",isFirst=!1,ele=ele.nodeType===Node.TEXT_NODE?ele.parentNode:ele.parentElement}catch(err){path+=err.message}return path};var eventID,replaceFunction,dblClickTime=300;self.setupClick=function setupClickFn(obj,item,params){function move(e){var xThisFrame=e.eventX-this.lastX,yThisFrame=e.eventY-this.lastY;if(0!==xThisFrame||0!==yThisFrame){var firstMove=!this.moved;if(this.lastX=e.eventX,this.lastY=e.eventY,e.distanceX=this.distanceX=this.distanceX+Math.abs(xThisFrame),e.distanceY=this.distanceY=this.distanceY+Math.abs(yThisFrame),(this.moved||e.distanceX>self.ClickThreshold||e.distanceY>self.ClickThreshold)&&(this.moved=!0,e.moved=this.moved),(params.onMove||params.onFirstMove)&&(e.diffX=e.eventX-this.startX,e.diffY=e.eventY-this.startY,e.xThisFrame=xThisFrame,e.yThisFrame=yThisFrame,e.startX=this.startX,e.startY=this.startY,e.startClientX=this.startClientX,e.startClientY=this.startClientY,e.startSrc=this.startSrc,firstMove&&params.onFirstMove&&params.onFirstMove.call(item,e),params.onMove)){var handled=!1;handled=params.onMove.call(item,e),handled&&e.stopImmediatePropagation()}}}function end(e){var now=Date.now(),lastTouch=this.lastTouch||now,delta=Math.max(0,now-lastTouch);this.numClicks?this.numClicks++:this.numClicks=1,e.moved=this.moved,e.timeDelta=delta,e.diffX=this.lastX-this.startX,e.diffY=this.lastY-this.startY,e.startX=this.startX,e.startY=this.startY,e.startSrc=this.startSrc,this.startSrc=void 0,dblClickTime>delta&&delta>0&&params.onDblClick&&!this.moved&&params.onDblClick.call(item,e),isNaN(e.button)||e.button===ButtonCode.Left?(this.lastTouch=now,!params.onClick||this.moved||platform.mac&&e.ctrlKey||(params.onClick.call(item,e),self.globalClickHandler&&self.globalClickHandler(e)),params.onEnd&&params.onEnd.call(item,e)):e.button===ButtonCode.Middle&&params.onMiddleClick&&!this.moved&&params.onMiddleClick.call(item,e),setTimeout(function(){this.lastTouch=void 0,this.numClicks=void 0}.bind(this),dblClickTime)}function cancel(e){params.onCancel&&params.onCancel.call(item,e)}function start(e){e.timeStart=this.timeStart=Date.now(),e.srcElement||(e.srcElement=e.target),this.startSrc=e.srcElement,e.startSrc=e.srcElement,this.moved=!1,e.startX=this.startX=e.eventX,e.startY=this.startY=e.eventY,e.startClientX=this.startClientX=e.clientX,e.startClientY=this.startClientY=e.clientY,this.lastX=e.eventX,this.lastY=e.eventY,this.distanceX=0,this.distanceY=0,(isNaN(e.button)||e.button===ButtonCode.Left||e.button===ButtonCode.Right)&&((isNaN(e.button)||e.button===ButtonCode.Left)&&params.onStart?params.onStart.call(item,e):e.button===ButtonCode.Right&&params.onRightStart&&params.onRightStart.call(item,e)),isNaN(e.changeLastY)||(this.lastY+=e.changeLastY)}function touchMove(e){var touch=platform.ie?e:e.touches[0];return e.eventX=touch.pageX,e.eventY=touch.pageY,e.clientX=touch.clientX,e.clientY=touch.clientY,move.call(obj,e),e.returnFalse?!1:void 0}function touchUp(e){document.removeEventListener(platform.touchMoveEvent,touchMoveHandler,useCapture),document.removeEventListener(platform.touchEndEvent,touchEndHandler,useCapture),document.removeEventListener(platform.touchCancelEvent,touchCancelHandler,useCapture);var touch=platform.ie?e:e.changedTouches[0];return e.eventX=touch.pageX,e.eventY=touch.pageY,e.clientX=touch.clientX,e.clientY=touch.clientY,gesture&&gesture.stop(),end.call(obj,e),e.returnFalse?!1:void 0}function touchCancel(e){return document.removeEventListener(platform.touchMoveEvent,touchMoveHandler,useCapture),document.removeEventListener(platform.touchEndEvent,touchEndHandler,useCapture),document.removeEventListener(platform.touchCancelEvent,touchCancelHandler,useCapture),gesture&&gesture.stop(),cancel.call(obj,e),e.returnFalse?!1:void 0}function touchStart(e){if(!e.handled){this.lastInputTouch=!0;var touch=platform.ie?e:e.touches[0];return e.eventX=touch.pageX,e.eventY=touch.pageY,e.clientX=touch.clientX,e.clientY=touch.clientY,start.call(obj,e),e.ignore||(document.addEventListener(platform.touchMoveEvent,touchMoveHandler,useCapture),document.addEventListener(platform.touchEndEvent,touchEndHandler,useCapture),document.addEventListener(platform.touchCancelEvent,touchCancelHandler,useCapture),gesture&&(log("Add Gesture Pointer: ",e.id,self.elementToString(e.target),self.elementToString(obj)),gesture.addPointer(e.pointerId))),e.returnFalse?!1:void 0}}function mouseMove(e){return this.lastInputTouch?void 0:(e=self.replaceTargetInPane(e),e.eventX=e.pageX,e.eventY=e.pageY,move.call(obj,e),e.returnFalse?!1:void 0)}function mouseUp(e){return e.handled||this.lastInputTouch?void 0:(e=self.replaceTargetInPane(e),document.removeEventListener(platform.moveEvent,mouseMoveHandler,useCapture),document.removeEventListener(platform.upEvent,mouseUpHandler,useCapture),0===e.button&&end.call(obj,e),e.returnFalse?!1:void 0)}function mouseDown(e){return e.handled||this.lastInputTouch?void 0:(e=self.replaceTargetInPane(e),this.lastInputTouch=!1,e.eventX=e.pageX,e.eventY=e.pageY,start.call(obj,e),e.ignore||(0===e.button&&document.addEventListener(platform.moveEvent,mouseMoveHandler,useCapture),document.addEventListener(platform.upEvent,mouseUpHandler,useCapture)),e.returnFalse?!1:void 0)}function contextMenu(e){e.handled||this.lastInputTouch||(e=self.replaceTargetInPane(e),params.onRightClick&&params.onRightClick.call(item,e))}function killMousedown(e){return android.isEnabled()&&android.isTargetBox(e)||(e.preventDefault(),e.stopImmediatePropagation()),!1}try{self.PAssert(1930,obj,"Expecting an object to bind the click handlers to.")}catch(PERR){self.reportError(PERR)}item||(item=obj);var useCapture=!1;self.isFunction(params)?params={onClick:params}:params&&params.useCapture&&(useCapture=params.useCapture);var touchStartHandler=fnCatch(touchStart),touchMoveHandler=fnCatch(touchMove),touchEndHandler=fnCatch(touchUp),touchCancelHandler=fnCatch(touchCancel),gesture,mouseDownHandler=fnCatch(mouseDown),mouseMoveHandler=fnCatch(mouseMove),mouseUpHandler=fnCatch(mouseUp),contextMenuHandler=fnCatch(contextMenu);return platform.isTouchDevice&&platform.isMobileBrowser?obj.addEventListener(platform.touchStartEvent,touchStartHandler,useCapture):obj.addEventListener(platform.downEvent,mouseDownHandler,useCapture),platform.usePointerEvents&&platform.mobile&&obj.addEventListener("mousedown",killMousedown,useCapture),params.onRightClick&&!platform.mobile&&obj.addEventListener("contextmenu",contextMenuHandler,useCapture),this},"function"!=typeof Array.prototype.pushOnlyUniques&&(Array.prototype.pushOnlyUniques=function(arr,comp){if(!arr)return this;for(var i=0,len=arr.length;len>i;++i){for(var isUnique=!0,u=0,len2=this.length;len2>u;++u)if(comp&&comp(arr[i],this[u])||!comp&&arr[i]===this[u]){isUnique=!1;break}isUnique&&this.push(arr[i])}return this}),"function"!=typeof Array.prototype.pushArray&&(Array.prototype.pushArray=function(arr){return this.push.apply(this,arr)}),"function"!=typeof Array.prototype.removeAt&&(Array.prototype.removeAt=function(from){return this.splice(from,1)[0]}),"function"!=typeof Array.prototype.remove&&(Array.prototype.remove=function(obj){var index=this.indexOf(obj);return index>=0&&this.removeAt.call(this,index),index}),"function"!=typeof Array.prototype.equals&&(Array.prototype.equals=function(array){if(!array)return!1;if(this.length!==array.length)return!1;for(var i=0,l=this.length;l>i;i++)if(this[i]instanceof Array&&array[i]instanceof Array){if(!this[i].equals(array[i]))return!1}else if(this[i]!==array[i])return!1;return!0}),"function"!=typeof Array.prototype.indexOfWithProperty&&(Array.prototype.indexOfWithProperty=function(property,value){for(var i=0;i<this.length;i++)if(this[i][property]===value)return i;return-1}),"function"!=typeof Array.prototype.findInsertIndex&&(Array.prototype.findInsertIndex=function(ele,comp){try{self.PAssert(1932,void 0!==ele&&null!==ele,"Require a valid element to insert")}catch(PERR){self.reportError(PERR)}try{self.PAssert(1933,comp,"Require a valid comparison function")}catch(PERR){self.reportError(PERR)}for(var low=0,high=this.length-1;high>=low;){var i=low+high>>1,c=comp(this[i],ele);if(0>c)low=i+1;else{if(!(c>0))return i;high=i-1}}return low}),"function"!=typeof Array.prototype.findSorted&&(Array.prototype.findSorted=function(ele,comp){var index=this.findInsertIndex(ele,comp);return 0===comp(this[index],ele)?this[index]:void 0}),"function"!=typeof Array.prototype.insertSorted&&(Array.prototype.insertSorted=function(ele,comp){var idx=this.findInsertIndex(ele,comp);return this.splice.apply(this,[idx,0,ele]),idx}),ko.observableArray.fn.insertSorted=function(ele,comp){this.valueWillMutate();var idx=this.peek().insertSorted(ele,comp);return this.valueHasMutated(),idx};var gapiMap={};self.loadGoogleAPI=function loadGoogleAPIFn(api,version,cb){try{self.PAssert(1934,api,"Must supply a valid API name")}catch(PERR){self.reportError(PERR)}try{self.PAssert(1935,version,"Must supply a valid API version")}catch(PERR){self.reportError(PERR)}try{self.PAssert(1936,cb,"Must supply a valid cb")}catch(PERR){self.reportError(PERR)}try{self.PAssert(1937,window.gapi&&window.gapi.client,"Must have loaded GAPI client lib")}catch(PERR){self.reportError(PERR)}if(window.gapi&&window.gapi.client){var prevData=gapiMap[api];if(prevData){try{self.PAssert(1938,prevData.version===version,"Must only load a single version of an API")}catch(PERR){self.reportError(PERR)}prevData.isLoaded?cb():prevData.cbs.push(cb)}else prevData={api:api,version:version,isLoaded:!1,cbs:[cb]},window.gapi.client.load(api,version,function(){for(var i=0;i<prevData.cbs.length;++i)prevData.cbs[i]();prevData.cbs=[],prevData.isLoaded=!0})}},self.clamp=function clampFn(val,min,max){return Math.max(min,Math.min(max,val))},self.randParam=function randParamFn(){return"?t="+Date.now()},self.createPath=function createPathFn(filename){return window.location.protocol+"//"+window.location.host+"/"+filename},self.addScript=function addScriptFn(filename,id,callback,error){try{self.PAssert(1939,!id||null===document.getElementById(id),"Should never include the same script ID multiple times")}catch(PERR){self.reportError(PERR)}var e=document.createElement("script");e.type="text/javascript",e.src=filename,id&&(e.id=id),callback&&readyStateCallback(e,callback,error),"undefined"!=typeof e&&document.getElementsByTagName("head")[0].appendChild(e)},self.addScriptHack=function addScriptHackFn(filename,id,callback,error){window.define.amd=void 0,self.addScript(filename,id,function(){window.define.amd={jQuery:!0},callback&&callback()},function(){window.define.amd={jQuery:!0},error&&error()})},self.addStylesheet=function addStylesheetFn(filename,callback,error){var e=document.createElement("link");e.type="text/css",e.rel="stylesheet",e.href=filename,callback&&readyStateCallback(e,callback,error),"undefined"!=typeof e&&document.getElementsByTagName("head")[0].appendChild(e)},self.PAssert=function PAssertFn(tag,value){if(!value){var assertExtra={isAssert:!0,tag:tag};try{var argString=makeString(Array.prototype.slice.call(arguments,2));log(arguments.length>2?"Assert Failure "+tag+": "+argString:"Assert Failure "+tag),self.reportError(new Error("Assert Failure: "+argString),assertExtra,LogLevels.Warning)}catch(err){log("Exception in PAssert "+tag+": ",err),self.reportError(err,assertExtra)}}},self.templateNameItem=function templateNameItemFn(item,pane){var name;return name=0===item.numItems()||item.isCollapsed(pane,!1)?"template-li-nochildren":item.hasPaginationToken()?"template-li-pagination":"template-li-modular"},self.getItemForElement=function getItemForElementFn(el){var reactItem=self.getReactItemForElement(el);return reactItem&&reactItem.props.item},self.getPaneForElement=function getPaneForElementFn(el){var paneEl=self.findParent(el,"pane");return self.dataFor(paneEl)},self.getReactItemForElement=function getReactItemForElementFn(el){for(;el&&el!==document.body;){var reactItem=self.getReactItem(el);if(reactItem)return reactItem;el=el.parentNode}try{self.PAssert(1963,!1,"Should always be able to find a valid item for a given element",self.getElementPath(el))}catch(PERR){self.reportError(PERR)}},self.getElementParent=function getElementParentFn(el){for(;el&&!self.hasClass(el,"item");)el=el.parentNode;return el};var currentFindPass=0;self.getPreviousItem=function getPreviousItemFn(item,pane,options){return currentFindPass++,_getPreviousItem(item,pane,options)},self.getNextItem=function getNextItemFn(item,pane,options){return currentFindPass++,_getNextItem(item,pane,options)},self.getFirstItem=function getFirstItemFn(item1,item2){try{self.PAssert(2033,item1.belongsToSameItemStore(item2),"Must match item stores")}catch(PERR){self.reportError(PERR)}if(item1.id===item2.id||item2.parent().id===item1.id)return item1;if(item1.parent().id===item2.id)return item2;var p=item1,prevP=void 0,q,prevQ;do{q=item2,prevQ=void 0;do{if(p.id===q.id){if(void 0===prevP)return item1;if(void 0===prevQ)return item2;try{self.PAssert(2034,p.id===prevQ.parent().id,"Must share a common parent")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2035,p.id===prevP.parent().id,"Must share a common parent")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2036,prevP.id!==prevQ.id,"If both previous items match, they should have been the common ancestor")}catch(PERR){self.reportError(PERR)}return prevP.getIndex()<prevQ.getIndex()?item1:item2}prevQ=q}while(void 0!==(q=q.parent()));prevP=p}while(void 0!==(p=p.parent()));try{self.PAssert(2037,!1,"One item must appear first in the tree")}catch(PERR){self.reportError(PERR)}return void 0},self.animateTransform=function animateTransformFn(element,options){function onComplete(){options.clearTransform&&(element.style[platform.transform.style]="",element.style[platform.transformOrigin.style]=""),options.onComplete&&options.onComplete()}try{self.PAssert(2038,element,"Must supply a valid element to transform")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2039,options,"Options must always be defined")}catch(PERR){self.reportError(PERR)}if(element){var transform=options.transform;if(!isNaN(options.delay)){var delay=options.delay;return options.delay=void 0,void setTimeout(self.animateTransform,delay,element,options)}if(options.time){var trans=self.getTransitionClass(options.time);self.addClass(element,trans),setTimeout(function(){self.removeClass(element,trans),onComplete()},options.time)}else onComplete();isNaN(options.opacity)||(element.style.opacity=options.opacity),transform||isNaN(options.left)||isNaN(options.top)||(transform="translate3d("+options.left+"px, "+options.top+"px, 0)"),options.origin&&(element.style[platform.transformOrigin.style]=options.origin),element.style[platform.transform.style]=transform}},self.easeOut=function easeOutFn(t,b,c){return-c*t*(t-2)+b};var scrollTimeouts={};self.scrollTo=function scrollToFn(scrollPosX,scrollPosY,duration,element,cb){function scrollLoop(timestamp){startTime||(startTime=timestamp-20);var t=Math.min((timestamp-startTime)/duration,1);if(void 0!==scrollPosX){var scrollOffsetX=self.easeOut(t,scrollValueX,differenceX);element.scrollLeft=scrollOffsetX}if(void 0!==scrollPosY){var scrollOffsetY=self.easeOut(t,scrollValueY,differenceY);element.scrollTop=scrollOffsetY}1===t?(delete scrollTimeouts[key],cb&&cb()):scrollTimeouts[key]=requestAnimationFrame(scrollLoop)}try{self.PAssert(2040,void 0!==scrollPosX||void 0!==scrollPosY,"Must be scrolling something")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2041,void 0===scrollPosX||self.isNumber(scrollPosX),"Must provide a valid scrollPosX")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2042,void 0===scrollPosY||self.isNumber(scrollPosY),"Must provide a valid scrollPosY")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2043,self.isNumber(duration),"Must provide a valid duration")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2044,self.isDOMNode(element),"Must provide a valid element to scroll")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2045,!cb||self.isFunction(cb),"Must provide a valid scrollDone callback")}catch(PERR){self.reportError(PERR)}var key=element.getAttribute("data-reactid");if(scrollTimeouts[key]&&(cancelAnimationFrame(scrollTimeouts[key]),delete scrollTimeouts[key]),!element)return void self.reportError(new Error("Must specify an element to scroll to"));if(duration>0){if(void 0!==scrollPosX)var scrollValueX=element.scrollLeft,differenceX=scrollPosX-scrollValueX;if(void 0!==scrollPosY)var scrollValueY=element.scrollTop,differenceY=scrollPosY-scrollValueY;var startTime;scrollTimeouts[key]=requestAnimationFrame(scrollLoop)}else element&&(void 0!==scrollPosX&&(element.scrollLeft=scrollPosX),void 0!==scrollPosY&&(element.scrollTop=scrollPosY)),cb&&cb()},self.computeScrollSpeed=function computeScrollSpeedFn(min,max,val){return val=self.clamp(val,min,max),(max-min-(max-val))/(max-min)};var lastState={speed:0,pane:void 0},runScroll=!1;self.repeatScroll=function repeatScrollFn(speed,pane){try{self.PAssert(2046,!self.isString(pane),"Must pass a valid pane object to repeatScroll")}catch(PERR){self.reportError(PERR)
}lastState.speed=speed,lastState.pane=pane,runScroll||(runScroll=!0,requestAnimationFrame(performScroll))},self.cancelRepeatScroll=function cancelRepeatScrollFn(){runScroll=!1},self.getPaneForContext=function getPaneForContextFn(localContext){var paneCandidate=localContext?localContext.$parents[localContext.$parents.length-2]:void 0;return!paneCandidate&&localContext&&1===localContext.$parents.length&&(paneCandidate=localContext.$data),paneCandidate instanceof VMPane?paneCandidate:void 0},self.elementInPane=function elementInPaneFn(element){if(element)for(element.nodeType===Node.TEXT_NODE&&(element=element.parentNode);element;){if(self.hasClass(element,"pane"))return!!element;element=element.parentElement}return!1},self.elementInPaneEdit=function elementInPaneEditFn(element){var isPaneEdit=!1,pane=self.getPaneForElement(element);return pane&&self.isAncestor(element,pane.getContentElement())&&(isPaneEdit=!0),isPaneEdit},self.scrollIntoView=function scrollIntoViewFn(element,duration,callback){try{self.PAssert(2047,self.isDOMNode(element),"Must supply a valid DOM node to scroll into view")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2048,self.isNumber(duration)&&duration>=0,"Must supply a valid scroll duration")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2049,!callback||self.isFunction(callback),"Callback must be a function")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2050,!self.getReactItem(element),"Use methods on VMPane to scroll VMLIs")}catch(PERR){self.reportError(PERR)}var needsScroll=!1;if(element){var scrollView=self.findParent(element,"scroller");try{self.PAssert(2051,scrollView,"Every element must be a child of a scroller to be able to scroll it into view")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2052,!self.hasClass(scrollView,"customScroller"),"Must not be scrolling this way, use methods on VMPane instead")}catch(PERR){self.reportError(PERR)}if(scrollView){var scrollBounds=scrollView.getBoundingClientRect(),scrollBottom=scrollBounds.bottom,bounds=element.getBoundingClientRect(),MagicNumber_1=80,MagicNumber_2=400,MagicNumber_3=120,boundsBottom=Math.min(bounds.bottom,bounds.top+MagicNumber_1),scrollTop=scrollView.scrollTop,scrollPosY;if(platform.mobile){var topPad=platform.orientation===Orientation.Landscape?self.topBarHeight:MagicNumber_3;scrollBottom=Math.max(scrollBounds.top+topPad,scrollBottom-MagicNumber_2)}bounds.top<scrollBounds.top?scrollPosY=scrollTop+bounds.top-scrollBounds.top:boundsBottom>scrollBottom&&bounds.top>scrollBounds.top&&(scrollPosY=scrollTop+boundsBottom-scrollBottom),void 0!==scrollPosY&&(self.scrollTo(void 0,scrollPosY,duration,scrollView,callback),needsScroll=!0)}}return needsScroll},self.isKeyboardInputElement=function isKeyboardInputElementFn(ele){return"checkbox"===ele.type?!1:"INPUT"===ele.nodeName||"textarea"===ele.type?!0:!1},self.openKeyboardOnItem=function openKeyboardOnItemFn(e,pane,item,focusFn,blurFn){try{self.PAssert(2053,platform.mobile,"Should only be opening keyboard on mobile devices")}catch(PERR){self.reportError(PERR)}var scrollStart=pane.getScrollOffset(),performedScroll=!1;if(self.keyboardToolbar.preShow(),!self.isKeyboardOpen){var callback=function(){self.keyboardToolbar.show(self.keyboardToolbar.Type.Item),focusFn&&focusFn(),self.enforceScroll()};pane.addPadding(),platform.app&&!platform.ioswk||platform.android||platform.mobileie?performedScroll=pane.scrollItemIntoView(item,platform.keyboardOpenTime,callback):(performedScroll=pane.scrollItemIntoView(item,platform.keyboardOpenTime),callback()),self.keyboardToolbar.hideTopBarIfLandscape()}return performedScroll&&platform.app&&!platform.android||(focusFn&&focusFn(),self.keyboardToolbar.show(self.keyboardToolbar.Type.Item)),keyboardOpenedOn=pane,keyboardBlurFn=blurFn,keyboardStartScrollOffset=scrollStart,keyboardDestination=KeyboardDestination.Item,platform.ios&&self.preventClick(),e.preventDefault(),e.stopImmediatePropagation(),e.returnFalse=!0,self.enforceScroll(),performedScroll},self.openKeyboardOnElement=function openKeyboardOnElementFn(e,element,focusFn,blurFn){try{self.PAssert(2054,platform.mobile,"Should only be opening keyboard on mobile devices")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2055,self.isDOMNode(element),"Must supply a valid element")}catch(PERR){self.reportError(PERR)}var scrollView,scrollStart;if(element){scrollView=self.findParent(element,"scroller");try{self.PAssert(2056,!self.hasClass(element,"paneScroller"),"Must never scroll a custom scroller this way")}catch(PERR){self.reportError(PERR)}scrollStart=scrollView?scrollView.scrollTop:0}var performedScroll=!1;if(self.keyboardToolbar.preShow(),!self.isKeyboardOpen){var callback=function(){self.keyboardToolbar.show(self.keyboardToolbar.Type.Modal),focusFn&&focusFn(),self.enforceScroll()};addScrollPadding(scrollView),platform.app&&!platform.ioswk||platform.android||platform.mobileie?performedScroll=self.scrollIntoView(element,platform.keyboardOpenTime,callback):(performedScroll=self.scrollIntoView(element,platform.keyboardOpenTime),callback()),self.keyboardToolbar.hideTopBarIfLandscape()}return performedScroll&&platform.app&&!platform.android||(focusFn&&focusFn(),self.keyboardToolbar.show(self.keyboardToolbar.Type.Modal)),keyboardOpenedOn=scrollView,keyboardBlurFn=blurFn,keyboardStartScrollOffset=scrollStart,keyboardDestination=KeyboardDestination.Element,platform.ios&&self.preventClick(),e.stopImmediatePropagation(),e.returnFalse=!0,self.enforceScroll(),performedScroll};var KeyboardDestination={None:0,Item:1,Element:2},keyboardDestination=KeyboardDestination.None,keyboardOpenedOn=void 0,keyboardBlurFn=void 0,keyboardStartScrollOffset=0;self.closeKeyboard=function closeKeyboardFn(){Sel.reset(),self.blurActiveElement(),self.fireCustomEvent("closeKeyboard")},self.onCloseKeyboardItem=function onCloseKeyboardItemFn(){self.isKeyboardOpen&&(keyboardOpenedOn.addPadding(),keyboardOpenedOn.setScrollOffset(keyboardStartScrollOffset,platform.keyboardOpenTime),self.isKeyboardOpen=!1,keyboardBlurFn&&keyboardBlurFn())},self.onCloseKeyboardElement=function onCloseKeyboardElementFn(){if(self.isKeyboardOpen){try{self.PAssert(2057,keyboardOpenedOn,"Must have a valid scroller")}catch(PERR){self.reportError(PERR)}self.scrollTo(void 0,keyboardStartScrollOffset,platform.keyboardOpenTime,keyboardOpenedOn),self.isKeyboardOpen=!1,keyboardBlurFn&&keyboardBlurFn()}},self.onCloseKeyboard=function onCloseKeyboardFn(){keyboardDestination===KeyboardDestination.Item?self.onCloseKeyboardItem():keyboardDestination===KeyboardDestination.Element&&self.onCloseKeyboardElement()},self.blurActiveElement=function blurActiveElementFn(ignoreSelectionChange){self.ignoreSelectionChange=!!ignoreSelectionChange,document.activeElement.blur(),setTimeout(function(){self.ignoreSelectionChange=!1},100)},self.preventScrollPropagation=function preventScrollPropagationFn(ele){try{self.PAssert(2058,self.isDOMNode(ele),"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2059,!self.hasClass(ele,"customScroller"),"Should not prevent scroll prop on pane")}catch(PERR){self.reportError(PERR)}return ele.scrollHeight===ele.clientHeight?!1:(0===ele.scrollTop?ele.scrollTop=1:ele.scrollTop+ele.offsetHeight>=ele.scrollHeight&&(ele.scrollTop=ele.scrollHeight-ele.offsetHeight-1),!0)},self.trimString=function trimStringFn(str){str=str.replace(/^\s\s*/,"");for(var ws=/\s/,i=str.length;ws.test(str.charAt(--i)););return str.slice(0,i+1)},self.enforceScroll=function enforceScrollFn(force,top){(force||(platform.ios||platform.android)&&(!platform.app||platform.ios71))&&(setTimeout(function(){window.scrollTo(0,top||0)},0),requestAnimationFrame(function(){window.scrollTo(0,top||0)}),window.scrollTo(0,top||0),document.body.scrollTop=0)},self.preventDefault=function preventDefaultFn(e){if(e&&e.preventDefault)e.preventDefault();else try{self.PAssert(2090,!1,"Invalid event object: "+e)}catch(PERR){self.reportError(PERR)}},self.preventClick=function preventClickFn(){self.addClass(self.element("outerWrapper"),"noClick"),window.ontouchstart=self.preventDefault,requestAnimationFrame(function(){window.ontouchstart=void 0,self.removeClass(self.element("outerWrapper"),"noClick")})},self.searchVMLIs=function searchVMLIsFn(options){try{self.PAssert(2091,options,"Must supply a valid options param")}catch(PERR){self.reportError(PERR)}var startItem;if(options.itemStoreFilter){var storeMan=self.vmMain.itemStoreManager;storeMan.runForEachStore(function(itemStore){var item=options.item,searchRoot=item&&item.belongsToItemStore(itemStore)?item:itemStore.getRoot();searchFromVMLI(searchRoot,options)},options.itemStoreFilter)}else if(options.item){try{self.PAssert(2092,!options.itemStore&&!options.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(PERR){self.reportError(PERR)}searchFromVMLI(options.item,options)}else if(options.itemStore){try{self.PAssert(2093,!options.itemStoreFilter,"Should only specify one of item/itemStore/itemStoreFilter")}catch(PERR){self.reportError(PERR)}searchFromVMLI(options.itemStore.getRoot(),options)}else{try{self.PAssert(2094,!1,"Must specify a valid search root, using the default root is deprecated")}catch(PERR){self.reportError(PERR)}startItem=self.vmMain.itemStoreManager.getDefaultItemStore().getRoot()}},self.searchVMLIsAsArray=function searchVMLIsAsArrayFn(options){var arr=[];return options.each=function(item){arr.push(item)},self.searchVMLIs(options),arr},self.getActiveSearch=function getActiveSearchFn(){return self.focusedPane.search},self.invertObject=function invertObjectFn(obj){var target={};for(var i in obj)obj.hasOwnProperty(i)&&(target[obj[i]]=i);return target},self.fieldMapOut=self.invertObject(self.fieldMapIn),self.translateFieldIn=function translateFieldInFn(field){try{self.PAssert(2098,self.fieldMapIn[field],"Incoming field should be added to the field map",field)}catch(PERR){self.reportError(PERR)}try{self.PAssert(2099,"string"==typeof field,"Should only pass strings to the field mapping function",field)}catch(PERR){self.reportError(PERR)}return self.fieldMapIn[field]||field},self.translateFieldOut=function translateFieldOutFn(field){try{self.PAssert(2100,self.fieldMapOut[field],"Incoming field should be added to the field map",field)}catch(PERR){self.reportError(PERR)}try{self.PAssert(2101,"string"==typeof field,"Should only pass strings to the field mapping function",field)}catch(PERR){self.reportError(PERR)}return self.fieldMapOut[field]||field},self.translateObjIn=function translateObjInFn(obj){return getMapping(obj,self.fieldMapIn)},self.translateObjOut=function translateObjOutFn(obj){return getMapping(obj,self.fieldMapOut)};var eventListeners={};self.addCustomEventListener=function addCustomEventListenerFn(name,fn,priority){try{self.PAssert(2102,name,"Must provide a valid event name")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2103,fn,"Must provide a valid event handler to add")}catch(PERR){self.reportError(PERR)}if(void 0!==priority){var evs=eventListeners[name],entry={fn:fn,pri:priority};evs?eventListeners[name].insertSorted(entry,function(left,right){return right>left?1:-1}):(eventListeners[name]=[entry],window.addEventListener(name,function(e){for(var i=0;i<eventListeners[name].length;++i){var ev=eventListeners[name][i],ret=ev.fn(e);if(ret===!1)break}}))}else window.addEventListener(name,fn)},self.removeCustomEventListener=function removeCustomEventListenerFn(name,fn,isPriority){try{self.PAssert(2104,name,"Must provide a valid event name")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2105,fn,"Must provide a valid event handler to remove")}catch(PERR){self.reportError(PERR)}if(isPriority){for(var evs=eventListeners[name],found=!1,i=0;i<evs.length;++i)if(evs[i].fn===fn){found=!0,evs.removeAt(i);break}0===evs.length;try{self.PAssert(2106,found,"Event listener should always be found when removing")}catch(PERR){self.reportError(PERR)}}else window.removeEventListener(name,fn)},self.fireCustomEvent=function fireCustomEventFn(name,data,target){if(document.createEvent){var eventObj=document.createEvent("Event");return data&&(eventObj.data=data),eventObj.initEvent(name,!0,!0),(target||window).dispatchEvent(eventObj)}try{self.PAssert(2107,!1,"Unable to fire custom event")}catch(PERR){self.reportError(PERR)}},self.fireKeyEvent=function fireKeyEventFn(ele,keyData){fireKeyEventInternal(ele,"keydown",keyData),fireKeyEventInternal(ele,"keypress",keyData),fireKeyEventInternal(ele,"keyup",keyData)},self.fireClickEvent=function fireClickEventFn(ele,button){fireClickEventInternal(ele,"mousedown",button),fireClickEventInternal(ele,"mouseup",button),fireClickEventInternal(ele,"mouseclick",button)},self.fireMouseUp=function fireMouseUpFn(ele,button){fireClickEventInternal(ele,"mouseclick",button)},self.fireDragStart=function fireDragStartFn(ele){fireClickEventInternal(ele,"mousedown",ButtonCode.Left,{offsetX:10,offsetY:10,clientX:10,clientY:10})},self.fireDragMove=function fireDragMoveFn(ele,x,y){if(ele||(ele=NativeSel.getSelectionNode()),document.createEvent){var evObj=document.createEvent("Event");evObj.pageX=x,evObj.pageY=y,evObj.synthetic=!0,evObj.initEvent("mousemove",!0,!0),ele.dispatchEvent(evObj)}else try{self.PAssert(2114,!1,"Unable to fire click event")}catch(PERR){self.reportError(PERR)}},self.fireDragEnd=function fireDragEndFn(ele){fireClickEventInternal(ele,"mouseup",ButtonCode.Left)},self.clone=function cloneFn(obj){var target={};for(var i in obj)obj.hasOwnProperty(i)&&(target[i]=obj[i]);return target},self.cloneMouseEvent=function cloneMouseEventFn(e){return{altKey:e.altKey,button:e.button,buttons:e.buttons,clientX:e.clientX,clientY:e.clientY,ctrlKey:e.ctrlKey,currentTarget:e.currentTarget,fromElement:e.fromElement,metaKey:e.metaKey,pageX:e.pageX,pageY:e.pageY,relatedTarget:e.relatedTarget,srcElement:e.srcElement,shiftKey:e.shiftKey,target:e.target,timestamp:e.timestamp,toElement:e.toElement,type:e.type,view:e.view,which:e.which,x:e.x,y:e.y,preventDefault:e.preventDefault.bind(e),stopPropagation:e.stopPropagation.bind(e),stopImmediatePropagation:e.stopImmediatePropagation.bind(e)}},self.replaceTargetInPane=function replaceTargetInPaneFn(e){if(!platform.mobile){var pane=self.getPaneForElement(e.target);pane&&(e=self.cloneMouseEvent(e),e.currentTarget=e.srcElement=e.target=self.elementFromPoint(e.clientX,e.clientY,e.target))}return e},self.loadXML=function loadXMLFn(xml){try{if("undefined"!=typeof window.DOMParser)return(new window.DOMParser).parseFromString(xml,"text/xml");if("undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")){var xmlDoc=new window.ActiveXObject("Microsoft.XMLDOM");return xmlDoc.async="false",xmlDoc.loadXML(xml),xmlDoc}try{self.PAssert(2115,!1,"No XML parser found")}catch(PERR){self.reportError(PERR)}return void 0}catch(err){return void self.reportError(err)}},self.adjustOriginToBeInsideBounds=function adjustOriginToBeInsideBoundsFn(bounds,rect,xMin,yMin,xPad,yPad){var out={x:rect.left,y:rect.top};return xMin=xMin||0,yMin=yMin||0,xPad=xPad||0,yPad=yPad||0,rect.bottom+yPad>bounds.bottom&&(out.y=Math.max(yMin,rect.top-(rect.bottom+yPad-bounds.bottom))),rect.top-yPad<bounds.top&&(out.y=Math.max(yMin,rect.top)),rect.right+xPad>bounds.right&&(out.x=Math.max(xMin,rect.left-(rect.right+xPad-bounds.right))),out},self.adjustLeftToBeInsideBounds=function adjustLeftToBeInsideBoundsFn(bounds,left,width,leftPad){return left+width+leftPad>bounds.right&&(left=bounds.right-leftPad-width),left},self.adjustHeightToBeInsideBounds=function adjustHeightToBeInsideBoundsFn(bounds,rect,minHeight,maxHeight,yPad){if(rect.bottom+yPad>bounds.bottom&&(rect.bottom=bounds.bottom-yPad,rect.bottom-rect.top<minHeight)){var lineHeight=25,newTop=Math.max(0,rect.bottom-minHeight);rect.top=newTop}return Math.min(maxHeight,rect.bottom-rect.top)},self.setOrigin=function setOriginFn(rect,xOrigin,yOrigin){var xDiff=rect.left-xOrigin,yDiff=rect.top-yOrigin;rect.left-=xDiff,rect.right-=xDiff,rect.top-=yDiff,rect.bottom-=yDiff},self.copyStyles=function copyStylesFn(src,dst,styles){try{self.PAssert(2116,src,"Must have a valid source element")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2117,dst,"Must have a valid dest element")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2118,styles,"Must have a valid list of styles to copy")}catch(PERR){self.reportError(PERR)}var computedStyle=window.getComputedStyle(src);if(computedStyle){for(var values=[],i=0;i<styles.length;++i)values[i]=computedStyle[styles[i]];for(var i=0;i<values.length;++i)dst.style[styles[i]]=values[i]}},self.hasClass=function hasClassFn(elem,cls){try{self.PAssert(2119,elem,"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}return elem&&elem.classList?elem.classList.contains(cls):void 0},self.removeClass=function removeClassFn(elem,cls){try{self.PAssert(2120,elem,"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}elem&&elem.classList&&elem.classList.remove(cls)},self.addClass=function addClassFn(elem,cls){try{self.PAssert(2121,elem,"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}elem&&elem.classList&&elem.classList.add(cls)},self.toggleClass=function toggleClassFn(elem,cls){try{self.PAssert(2122,elem,"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}elem&&elem.classList&&elem.classList.toggle(cls)},self.css=function cssFn(elem,styles){try{self.PAssert(2123,elem,"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}if(elem)for(var style in styles)if(styles.hasOwnProperty(style)){var value=styles[style];"number"==typeof value&&(value+="px"),elem.style[style]=value}},self.findChild=function findChildFn(elem,cls){try{self.PAssert(2124,elem,"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}if(elem)for(var i=0;i<elem.childElementCount;++i){var child=elem.children[i];if(self.hasClass(child,cls))return child;var match=self.findChild(child,cls);if(match)return match}return void 0},self.getPluginForElement=function getPluginForElementFn(ele){return self.findParent(ele,"plugin",4)},self.findParentInItem=function findParentInItemFn(element,cls){for(;element&&!self.hasClass(element,"item");){if(self.hasClass(element,cls))return element;element=element.parentNode}},self.findParent=function findParentFn(elem,cls,num){try{self.PAssert(2125,elem,"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}if(num||(num=1e3),elem){var parent=elem;try{self.PAssert(2126,parent,"Must have a valid parent element")}catch(PERR){self.reportError(PERR)}for(var i=0;num>i&&parent;++i,parent=parent.parentNode)if(self.hasClass(parent,cls))return parent}return void 0},self.findParentID=function findParentIDFn(elem,id,num){try{self.PAssert(2127,elem,"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}if(num||(num=1e4),elem){var parent=elem;try{self.PAssert(2128,parent,"Must have a valid parent element")}catch(PERR){self.reportError(PERR)}for(var i=0;num>i&&parent;++i,parent=parent.parentNode)if(parent.id===id)return parent}return void 0},self.isAncestor=function isAncestorFn(elem,candidate){try{self.PAssert(2129,elem,"Must have a valid element")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2130,candidate,"Must have a valid candidate")}catch(PERR){self.reportError(PERR)}for(;elem&&elem!==candidate;)elem=elem.parentNode;return!!elem},self.firstChildTag=function firstChildTagFn(elem,tag){try{self.PAssert(2131,elem,"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2132,tag,"Must pass in a valid tag to check")}catch(PERR){self.reportError(PERR)}if(elem)for(var upper=tag.toUpperCase(),i=0;i<elem.childElementCount;++i)if(elem.children[i].tagName===upper)return elem.children[i];return void 0},self.insertAfter=function insertAfterFn(reference,newNode){try{self.PAssert(2134,reference,"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2135,newNode,"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}reference.parentNode.insertBefore(newNode,reference.nextSibling)},self.prependChild=function prependChildFn(parent,newNode){try{self.PAssert(2136,parent,"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2137,newNode,"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}parent.insertBefore(newNode,parent.firstChild)},self.isAttachedToDoc=function isAttachedToDocFn(ele){try{self.PAssert(2138,ele,"Must supply a valid element to check")}catch(PERR){self.reportError(PERR)}return ele.ownerDocument.body.contains(ele)},self.offset=function offsetFn(elem){try{self.PAssert(2139,elem,"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}var box=elem.getBoundingClientRect(),doc=elem.ownerDocument,docElem=elem.ownerDocument.documentElement,win=doc.defaultView,customAns={top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft};return customAns},self.height=function heightFn(elem){try{self.PAssert(2141,elem,"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}var customHeight=elem.offsetHeight,cStyle=window.getComputedStyle(elem);return cStyle?("border-box"!==cStyle.boxSizing&&(customHeight-=parseFloat(cStyle.paddingTop)+parseFloat(cStyle.paddingBottom)),customHeight-=parseFloat(cStyle.borderTopWidth)+parseFloat(cStyle.borderBottomWidth)):ShouldLog(LogLevels.Error)&&log("GetComputedStyle failed in globals::height"),customHeight},self.width=function widthFn(elem){try{self.PAssert(2143,elem,"Must pass in a valid element")}catch(PERR){self.reportError(PERR)}var customWidth=elem.offsetWidth,cStyle=window.getComputedStyle(elem);return cStyle?("border-box"!==cStyle.boxSizing&&(customWidth-=parseFloat(cStyle.paddingLeft)+parseFloat(cStyle.paddingRight)),customWidth-=parseFloat(cStyle.borderLeftWidth)+parseFloat(cStyle.borderRightWidth)):ShouldLog(LogLevels.Error)&&log("GetComputedStyle failed in globals::width"),customWidth};var onLoadCallbacks;self.runOnLoad=function runOnLoadFn(cb){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(cb):(onLoadCallbacks||(onLoadCallbacks=[],document.addEventListener("DOMContentLoaded",loadDone,!1),window.addEventListener("load",loadDone,!1)),onLoadCallbacks[onLoadCallbacks.length]=cb)},self.sendFeedback=function sendFeedbackFn(name,message,cb){var appInfo={};self.getAppInfo(appInfo),appInfo.eventStream=void 0;var notes=message+"\r\n\r\n\r\n"+JSON.stringify(appInfo,void 0,3),bug={name:name,notes:notes};bug.email=self.getUserIdentifier(),bug.premiumStatus=self.billingManager.getPremiumStatus();var sendBug=function(){self.XHR_PrivateAPI({type:"POST",path:"/feedback/suggestion",data:bug,cb:function cbFn(xhr){log("XHR Response: ",xhr.status,xhr),cb()}.bind(this)})}.bind(this);sendBug()};var __xhrRequests={};self.getXHRStats=function getXHRStatsFn(){return __xhrRequests};var maxRetryCount=5,retryTimeouts=[0,5,15,35,80,170],retryErrorCodes=[0,408,500,502,503,504];self.XHR=function XHRFn(params){function retry(){try{self.PAssert(2148,maxRetries>currentRetries,"Should not be calling retry once retries have been exhausted")}catch(PERR){self.reportError(PERR)}maxRetries>currentRetries?(currentRetries++,notifyStatsXHRRetry(url),setTimeout(sendXHR,1e3*retryTimeouts[currentRetries])):(notifyStatsXHRFailure(url),self.reportError(new Error("XHR Failed: "+url)))}function sendXHR(){var xhr=new XMLHttpRequest;if(xhr.onreadystatechange=function(){4===xhr.readyState&&(200!==xhr.status?maxRetries>currentRetries?(xhr.retry=retry,autoRetry&&retryErrorCodes.indexOf(xhr.status)>=0?xhr.retry():cb(xhr)):(notifyStatsXHRFailure(url),cb(xhr)):cb(xhr))},username&&password?xhr.open(type.toUpperCase(),url,!0,username,password):xhr.open(type.toUpperCase(),url,!0),headers)for(var key in headers)xhr.setRequestHeader(key,headers[key]);if(data){xhr.setRequestHeader("Accept","*/*"),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");var queryString=generateQueryString(data);xhr.send(queryString)}else xhr.send()}try{self.PAssert(2146,params.url,"Must specify a valid URL to use")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2147,params.type,"Must specify a valid request type")}catch(PERR){self.reportError(PERR)}var url=params.url,type=params.type,cb=params.cb,data=params.data,headers=params.headers,autoRetry=params.autoRetry,maxRetries=Math.min(params.maxRetries||2,maxRetryCount),currentRetries=0,username=params.username,password=params.password;notifyStatsXHRRequest(url),sendXHR()},self.XHR_PrivateAPI=function XHR_PrivateAPIFn(params){try{self.PAssert(2149,params.type,"Must supply a valid type")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2150,params.path&&params.path.startsWith("/"),"Must supply a valid path"+params.path)}catch(PERR){self.reportError(PERR)}var goog=require("goog"),protocol=platform.getDeployVar(DeployVariable.APIProtocol),host=platform.getDeployVar(DeployVariable.APIHost),basePath="/private/v1";if(params.requireAuth){var token=goog.getAccessToken(!0);try{self.PAssert(2151,token,"Must have a valid auth token before making API calls")}catch(PERR){self.reportError(PERR)}if(!token){try{self.PAssert(2153,!isUserAuthorized,"User must not be authorized if no token is available: "+params.path)}catch(PERR){self.reportError(PERR)}return void self.onUserAuthorized(function(){self.XHR_PrivateAPI(params)})}params.headers||(params.headers={});try{self.PAssert(2152,!params.headers.token,"Callers should not be setting access token themselves")}catch(PERR){self.reportError(PERR)}params.headers.token=token}var XHRParams={type:params.type,url:protocol+host+basePath+params.path,data:params.data,cb:params.cb,headers:params.headers,autoRetry:params.autoRetry,maxRetries:params.maxRetries};self.XHR(XHRParams)},self.XHR_PublicAPI=function XHR_PublicAPIFn(params){};var isXHRWrapped=!1,idXHR=1,notifyURLs={};self.registerURLForNotifyXHR=function registerURLForNotifyXHRFn(url,cb){return notifyURLs[url]||(notifyURLs[url]=cb),isXHRWrapped},self.wrapXHR=function wrapXHRFn(){try{var __open=window.XMLHttpRequest.prototype.open,__send=window.XMLHttpRequest.prototype.send;window.XMLHttpRequest.prototype.open=function(method,url,async,user,password){this.url=url;try{__open.call(this,method,url,async,user,password)}catch(openErr){throw self.reportError(openErr),openErr}},window.XMLHttpRequest.prototype.send=function(data){notifyXHR(this);try{__send.call(this,data)}catch(sendErr){throw self.reportError(sendErr),sendErr}}}catch(err){return void self.reportError(err)}isXHRWrapped=!0},self.wrapXHR(),self.areObjectsEqual=function areObjectsEqualFn(obj1,obj2){return JSON.stringify(obj1)===JSON.stringify(obj2)},self.JSONP=function JSONPFn(params){try{self.PAssert(2154,params.url,"Must supply a valid URL to fetch")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2155,params.cb,"Must supply a valid callback")}catch(PERR){self.reportError(PERR)}var url=params.url,data=params.data,cb=params.cb;if(data){for(var queryString="",keys=Object.keys(data),i=0;i<keys.length;i++)queryString+=encodeURIComponent(keys[i])+"="+encodeURIComponent(data[keys[i]]),i!==keys.length-1&&(queryString+="&");url+="?"+queryString}var timestamp=Date.now(),generatedFunction="jsonp"+Math.round(timestamp+10001*Math.random());window[generatedFunction]=function(json){cb(json),delete window[generatedFunction]},url+=-1===url.indexOf("?")?"?":"&";var jsonpScript=document.createElement("script");jsonpScript.id=generatedFunction,jsonpScript.setAttribute("src",url+"callback="+generatedFunction),document.getElementsByTagName("head")[0].appendChild(jsonpScript)},self.element=function elementFn(id,reload){try{self.PAssert(2156,id,"Tried to get an element without an id")}catch(PERR){self.reportError(PERR)}(!self.elements[id]||reload)&&(self.elements[id]=document.getElementById(id));try{self.PAssert(2157,self.elements[id],"Tried to get an element that doesn't exist",id)}catch(PERR){self.reportError(PERR)}return self.elements[id]},self.openUrl=function openUrlFn(url,e,notBlank){try{self.PAssert(2158,url,"Must always provide a valid URL to open")}catch(PERR){self.reportError(PERR)}if(!url)return!1;if(platform.standalone){var a=document.createElement("a");a.setAttribute("href",url),a.setAttribute("target","_blank");var dispatch=document.createEvent("HTMLEvents");dispatch.initEvent("click",!0,!0),a.dispatchEvent(dispatch)}else if(platform.app){var validProtocols,isValid,i,supportsFullProtocol=platform.ios&&platform.appv>=5||platform.android&&platform.appv>=5||platform.isChrome;supportsFullProtocol||!url.startsWith("http://")&&!url.startsWith("https://")?url.startsWith("/")&&(url=window.location.host+url):url=url.replace("http://","").replace("https://",""),platform.ios&&(url.startsWith("tel:")||url.startsWith("mailto:")||url.startsWith("callto:"))?open(url):self.nativeBridge.sendToApp("openURL",url),e&&(self.handlerPreventStop(e),e.returnFalse=!0)}else notBlank?open(url,"_self"):open(url,"_blank");return!0},self.isDateSoft=function isDateSoftFn(dateText){if(dateText)switch(dateText.toUpperCase()){case"NEXT":case"SOON":case"LATER":case"SOMEDAY":case"NOW":return!0}return!1},self.getLocationOrigin=function getLocationOriginFn(){return window.location.origin?window.location.origin:window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")};var spellcheckEnabled;self.isSpellcheckEnabled=function isSpellcheckEnabledFn(){return spellcheckEnabled},self.handlerPreventStop=function handlerPreventStopFn(e){e.preventDefault(),e.stopImmediatePropagation()},self.handlerStopProp=function handlerStopPropFn(e){e.stopImmediatePropagation()},self.fFalse=function fFalseFn(){return!1},self.fTrue=function fTrueFn(){return!0},self.emptyFn=function emptyFnFn(){},self.hours=function hoursFn(hours){return 36e5*hours},self.minutes=function minutesFn(mins){return 6e4*mins},self.seconds=function secondsFn(secs){return 1e3*secs},self.curry=function curryFn(fn){var args=[].slice.call(arguments,1);return function(){return fn.apply(this,args.concat(Array.prototype.slice.call(arguments,0)))}},self.saveFile=function saveFileFn(content,name){if(platform.appPlatform===AppPlatform.Chrome)try{self.nativeBridge.sendToApp("exportData",{content:content,filename:name})}catch(err){self.reportError(err)}else{var blob=new Blob([content],{type:"text/plain;charset=utf-8"});saveAs(blob,name)}},util.hasURLParam("nolocal","true")&&(self.noLocalWrites=!0),self.eventStream=self.createRingBuffer(25),window.__CHECK_OAUTH=function(){self.XHR({type:"GET",url:"https://accounts.google.com/o/oauth2/auth?scope=email&redirect_uri=http://moo.do&response_type=token&client_id=597847337936.apps.googleusercontent.com",cb:function cbFn(xhr){log("XHR OAuth: ",xhr)}})},self.createCustomScroller=function createCustomScrollerFn(element){var iScroller=new IScroll(element,{scrollbars:!0,shrinkScrollbars:"clip",bindToWrapper:!0,preventDefault:!1,scrollX:!1,scrollY:!0,deceleratopn:.005,probeType:3,useTransition:!1});return iScroller};var reactItems={};self.setReactItem=function setReactItemFn(item,li){var liKey=li.getAttribute("data-reactid");reactItems[liKey]=item},self.getReactItem=function getReactItemFn(element){var reactItem;if(element.nodeType!==Node.TEXT_NODE){var key=element.getAttribute("data-reactid");reactItem=reactItems[key]}return reactItem},self.clearReactItem=function clearReactItemFn(item,li){var liKey=li.getAttribute("data-reactid");try{self.PAssert(2160,reactItems[liKey]===item,"Must be clearing the same item that was set")}catch(PERR){self.reportError(PERR)}reactItems[liKey]=void 0};var reactElements={};return self.setDataFor=function setDataForFn(element,value){var key=element.getAttribute("data-reactid");value?reactElements[key]=value:delete reactElements[key]},self.dataFor=function dataForFn(element,checkParents){if(checkParents){for(var startElement=element;element&&element!==document;){var key=element.getAttribute("data-reactid");if(reactElements[key])return reactElements[key];element=element.parentNode}return ko.dataFor(startElement)
}if(element){var key=element.getAttribute("data-reactid");return reactElements[key]||ko.dataFor(element)}},self.classNames=function classNamesFn(){for(var args=arguments,classes=[],i=0;i<args.length;i++){var arg=args[i];if(arg)if("string"==typeof arg||"number"==typeof arg)classes.push(arg);else if("object"==typeof arg)for(var key in arg)arg.hasOwnProperty(key)&&arg[key]&&classes.push(key)}return classes.join(" ")},self.isVMLI=function isVMLIFn(obj){return obj instanceof VMLI},self.isPane=function isPaneFn(obj){return obj instanceof VMPane},self.timeouts={},self.hasTimeoutOnce=function hasTimeoutOnceFn(name){return!!self.timeouts[name]},self.timeoutOnce=function timeoutOnceFn(name,cb,time,arg){try{self.PAssert(2161,name,"Must supply a valid name")}catch(PERR){self.reportError(PERR)}try{self.PAssert(2162,self.isFunction(cb),"must supply a valid cb fn")}catch(PERR){self.reportError(PERR)}var t=self.timeouts[name];t&&clearTimeout(t),self.timeouts[name]=setTimeout(function(){delete self.timeouts[name],cb(arg)},time)},self.animFrameOnce=function animFrameOnceFn(name,cb){var t=self.timeouts[name];t&&cancelAnimationFrame(t),self.timeouts[name]=requestAnimationFrame(cb)},self.contentSetAuto=void 0,self.reEnableNone=function reEnableNoneFn(contentEle){try{self.PAssert(2163,contentEle,"Must have a valid element to set pointer-events on")}catch(PERR){self.reportError(PERR)}contentEle.style["pointer-events"]=""},self.elementFromPoint=function elementFromPointFn(x,y,target){var element;target||(target=document.elementFromPoint(x,y));var setStyle=self.elementInPane(target);if(setStyle){var pane=self.getPaneForElement(target),isOutline=!!self.findParent(target,"paneOutline"),timeoutName="EnableNone_"+pane.id+"_"+isOutline;if(!self.hasTimeoutOnce(timeoutName)){var contentEle=isOutline?pane.getOutline().getContentElement():pane.getContentElement();contentEle.style["pointer-events"]="auto",self.timeoutOnce(timeoutName,self.reEnableNone,0,contentEle)}}return element=document.elementFromPoint(x,y)},platform.demo&&self.enableDemoMode(),self}),define("gdata",["ko","globals","data","platform"],function(ko,g,d,platform){function promptTrashDoc(){g.menus.alert({text:"You are using an out of date document - please contact support@moo.do for help.",actionText:"OKAY",action:function actionFn(){g.loadGoogleAPI("drive","v2",function(){gapi.client.drive.files.trash({fileId:g.settings.get(Settings.gdocId)}).execute(function(response){g.reportError(response.error?new Error("Error deleting out of date doc - "+response.error):new Error("Successfully deleted out of date doc - "+g.settings.get(Settings.gdocId))),d.clearData(function(){g.reload()})})})}})}function ensureWriteAction(){try{g.PAssert(2212,!self.inCompoundOperation,"Should never be in a compound operation after sync block finishes")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2213,!self.wantCompoundOperation,"Should never want a compound operation after a sync block finishes")}catch(PERR){g.reportError(PERR)}if(self.inCompoundOperation){try{self.inCompoundOperation=!1,self.wantCompoundOperation=!1,g.vmMain.notifyDriveOperationError(),self.model.endCompoundOperation()}catch(err){g.reportError(err)}g.reportError(new Error("Compound operation open after sync block finished"))}ensureActionTimeout=void 0}function attachEvents(item){try{g.PAssert(2219,item,"Must have a valid local item to attach events to")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2220,item instanceof VMLI,"Must pass in a valid instace of a local item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2221,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2222,item.data,"Must have a valid remote item to attach events to")}catch(PERR){g.reportError(PERR)}item.data.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,item.onObjectChanged.bind(item))}function ensureRemoteItemsArray(item){self.beginWriteAction();try{g.PAssert(2257,item instanceof VMLI)}catch(PERR){g.reportError(PERR)}try{g.PAssert(2258,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2259,item.data,"Must have valid remote item to attach events to and create")}catch(PERR){g.reportError(PERR)}var itemList=self.get(item.data,"items");return itemList||(itemList=self.model.createList(),self.set(item.data,"items",itemList)),itemList}function ensureRemoteArchiveArray(item){self.beginWriteAction();try{g.PAssert(2260,item instanceof VMLI)}catch(PERR){g.reportError(PERR)}try{g.PAssert(2261,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2262,item.data,"Must have valid remote item to attach events to and create")}catch(PERR){g.reportError(PERR)}var archivedList=self.get(item.data,"archivedItems");return archivedList||(archivedList=self.model.createList(),self.set(item.data,"archivedItems",archivedList)),archivedList}function setRemoteVersion(data){self.beginWriteAction();var v=self.getVersion(data,VersionType.Structure);v=v?v+1:1;var verStr;self.set(data,"version",v)}function setRemoteTextVersion(data){self.beginWriteAction();var v=self.getVersion(data,VersionType.Text);v=v?v+1:1;var verStr;self.set(data,"versionText",v)}function saveChangesInternal(item,changes){try{g.PAssert(2305,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}var itemData=self.canSave(item);if(itemData){if(g.isEmpty(changes))return void(ShouldLog(LogLevels.Warning)&&log("Skipped remote saving an empty object"));self.beginWriteAction(),d.addPendingUpdate(item.id);for(var prop in changes){try{g.PAssert(2306,changes.hasOwnProperty(prop),"Changes should only contain properties they own")}catch(PERR){g.reportError(PERR)}if(changes.hasOwnProperty(prop))switch(prop){case"text":try{g.PAssert(2307,g.isString(changes.text))}catch(PERR){g.reportError(PERR)}self.set(itemData,"text",changes.text);break;case"date":try{g.PAssert(2308,!changes.date||g.isNumber(changes.date),"Invalid date type")}catch(PERR){g.reportError(PERR)}self.set(itemData,"date",changes.date);break;case"repeatDate":try{g.PAssert(2309,!changes.repeatDate||g.isString(changes.repeatDate),"Invalid repeat date type")}catch(PERR){g.reportError(PERR)}self.set(itemData,"repeatDate",changes.repeatDate);break;case"dateCreated":try{g.PAssert(2311,g.isNumber(changes.dateCreated),"Invalid dateCreated type")}catch(PERR){g.reportError(PERR)}self.set(itemData,"dateCreated",changes.dateCreated);break;case"dateCompleted":try{g.PAssert(2312,!changes.dateCompleted||g.isNumber(changes.dateCompleted),"Invalid dateCompleted type")}catch(PERR){g.reportError(PERR)}self.set(itemData,"dateCompleted",changes.dateCompleted);break;case"allDayDate":case"priority":case"isComplete":case"isStarred":self.set(itemData,prop,changes[prop]);break;case"isCollapsed":case"isArchived":try{g.PAssert(2313,!1,"These properties are not set this way")}catch(PERR){g.reportError(PERR)}self.set(itemData,prop,changes[prop]);break;case"modifiedOfflineText":case"dateText":break;default:try{g.PAssert(2314,!1,"Attempting to remotely save an unknown field: ",prop)}catch(PERR){g.reportError(PERR)}}}setRemoteTextVersion(itemData)}}function getRetryInterval(count){return retryIntervals[Math.min(count,retryIntervals.length-1)]}function tryDriveReconnect(){try{g.PAssert(2317,driveRealtimeStatus===RealtimeStatus.Error||driveRealtimeStatus===RealtimeStatus.XHRError,"Invalid state for request reconnect: ",driveRealtimeStatus)}catch(PERR){g.reportError(PERR)}clearTimeout(driveReconnectTimer),driveReconnectTimer=void 0,g.goog.reconnectToActiveDocument()}function setDriveRealtimeStatus(newStatus){var oldStatus=driveRealtimeStatus;if(driveRealtimeStatus=newStatus,log("Change Realtime Status: ",oldStatus," -> ",newStatus),oldStatus!==newStatus)switch(oldStatus){case RealtimeStatus.Disconnected:try{g.PAssert(2320,newStatus===RealtimeStatus.Connecting,"Invalid state switch",oldStatus,newStatus)}catch(PERR){g.reportError(PERR)}break;case RealtimeStatus.XHRError:case RealtimeStatus.Error:try{g.PAssert(2321,newStatus===RealtimeStatus.Reconnecting||newStatus===RealtimeStatus.Connected,"Invalid state switch",oldStatus,newStatus)}catch(PERR){g.reportError(PERR)}newStatus===RealtimeStatus.Connected&&self.notifyReconnectSuccess();break;case RealtimeStatus.Connected:try{g.PAssert(2322,newStatus===RealtimeStatus.Error,"Invalid state switch",oldStatus,newStatus)}catch(PERR){g.reportError(PERR)}newStatus===RealtimeStatus.Error&&(self.close(),self.setupReconnect());break;case RealtimeStatus.Connecting:case RealtimeStatus.Reconnecting:try{g.PAssert(2323,newStatus===RealtimeStatus.Error||newStatus===RealtimeStatus.Connected,"Invalid state switch",oldStatus,newStatus)}catch(PERR){g.reportError(PERR)}newStatus===RealtimeStatus.Error?(self.close(),self.setupReconnect()):newStatus===RealtimeStatus.XHRError?self.notifyReconnectFailure():newStatus===RealtimeStatus.Connected&&oldStatus===RealtimeStatus.Reconnecting&&self.notifyReconnectSuccess();break;default:try{g.PAssert(2324,!1,"Invalid status: ",oldStatus,newStatus)}catch(PERR){g.reportError(PERR)}}}function fwdOnLoaded(cb){try{g.PAssert(2325,cb,"Must pass a valid CB for doc loaded")}catch(PERR){g.reportError(PERR)}return function fwdOnloadedFn(doc){setDriveRealtimeStatus(RealtimeStatus.Connected),_connectIdentifier++,cb(doc)}}function fwdOnInitialized(cb){try{g.PAssert(2326,cb,"Must pass a valid CB for doc initialized")}catch(PERR){g.reportError(PERR)}return function fwdOnInitializedFn(doc){setDriveRealtimeStatus(RealtimeStatus.Connected),cb(doc)}}function fwdOnError(cb){try{g.PAssert(2327,cb,"Must pass a valid CB for doc error")}catch(PERR){g.reportError(PERR)}return function fwdOnErrorFn(err){var fatalError=cb(err);fatalError&&setDriveRealtimeStatus(RealtimeStatus.Error)}}function onRSCDrive(xhr){(!xhr||4===xhr.readyState&&200!==xhr.status)&&setDriveRealtimeStatus(RealtimeStatus.XHRError)}function entrySize(entry){return entry?entry.length:0}var self={isClosed:!0,initialized:!1,loadedOnce:!1,actionsPreventUndo:!1,wantCompoundOperation:!1,inCompoundOperation:!1,flushingDeferredActions:!1,deferredActionsCommitted:!1,hasPendingDeferredActions:!1,authenticatedUser:ko.observable(),numChanges:0};self.offlineTimeoutMS=platform.mobile?12e3:8e3;var CURRENT_VERSION=5;self.currentVersion=function currentVersionFn(){return CURRENT_VERSION};var deletedItemCache={},itemCache={};self.cacheItem=function cacheItemFn(item){try{g.PAssert(2164,void 0===itemCache[item.id]||itemCache[item.id]===item,"Should not be caching different items with the same ID")}catch(PERR){g.reportError(PERR)}if(itemCache[item.id]=item,deletedItemCache[item.id]){try{g.PAssert(2165,deletedItemCache[item.id]===item,"Should not be caching different items with the same ID in deleted")}catch(PERR){g.reportError(PERR)}delete deletedItemCache[item.id]}},self.getCacheItem=function getCacheItemFn(id){return itemCache[id]},self.getDeletedCacheItem=function getDeletedCacheItemFn(id){return deletedItemCache[id]},self.removeItemFromCache=function removeItemFromCacheFn(id){try{g.PAssert(2166,void 0!==itemCache[id],"Item cache should contain a valid entry for item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2167,void 0===deletedItemCache[id],"Should never already have item in deleted cache")}catch(PERR){g.reportError(PERR)}deletedItemCache[id]=itemCache[id],delete itemCache[id]},self.restoreDeletedItem=function restoreDeletedItemFn(id){try{g.PAssert(2168,void 0!==deletedItemCache[id],"Deleted item cache should contain a valid entry for item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2169,void 0===itemCache[id],"Should never already have an item in the item cache")}catch(PERR){g.reportError(PERR)}itemCache[id]=deletedItemCache[id],delete deletedItemCache[id]},self.getState=function getStateFn(obj){try{var gState={};if(self.doc)try{var model=self.doc.getModel();gState.isReadOnly=model.isReadOnly,gState.serverVersion=model.serverVersion,gState.size=model.bytesUsed,gState.saveDelay=self.doc.saveDelay}catch(err2){obj.docAccessError=!0}gState.lastPending=lastPending,gState.lastSaving=lastSaving,gState.isClosed=self.isClosed,gState.initialized=self.initialized,obj.gState=gState}catch(err){log("Error getting information in gdata::getState()"+err.message)}};var d,VMLI;self.checkRemoteIntegrity=function checkRemoteIntegrityFn(){function verifyChildren(children,isArchived){if(children)for(var j=0;j<children.length;++j){var child=children.get(j).id;child||(log(child,": Child does not have a valid reference in our remote database"),remoteDataError=!0),seen[child]?seen[child].ref?(log(child,": Item is referenced remotely multiple times"),log("   ",seen[child].ref),log("   ",item.id),remoteDataError=!0,self.beginWriteAction(),self.setItemParent(children.get(j),self.getCacheItem(seen[child.ref])),children.remove(j)):seen[child].ref=item.id:seen[child]={exist:!1,arch:isArchived,ref:item.id}}}self.beginAction(),ShouldLog(LogLevels.Timing)&&log("Verifying Remote Data: ",log.now());var remoteDataError=!1,localDataError=!1,seen={},rootSeen=!1;for(var itemID in itemCache){var item=itemCache[itemID];seen[item.id]?seen[item.id].exist?(log(item.id,": Duplicated IDs in the remote database",item),remoteDataError=!0):seen[item.id].exist=!0:seen[item.id]={exist:!0,ref:!1},item.id===self.rootID&&(rootSeen&&(log(item.id,": Multiple roots present remotely",item),remoteDataError=!0),rootSeen=!0,seen[item.id].isRoot=!0),self.getItemParent(item)||seen[item.id].isRoot||log(item.id,": Missing remote parent field",item);var childItems=self.get(item,"items");verifyChildren(childItems,!1);var childArchivedItems=self.get(item,"archivedItems");verifyChildren(childArchivedItems,!0);var note=self.get(item,"note");note&&(seen[note.id]?seen[note.id].ref?(log(note,": Note is referenced remotely multiple times: "),log("    ",seen[note.id].ref),log("    ",item.id),remoteDataError=!0,self.beginWriteAction(),self.set(item,"note",void 0)):seen[note.id].ref=item.id:seen[note.id]={exist:!1,ref:item.id})}rootSeen||(log("No root present"),localDataError=!0);for(var entryID in seen){var entry=seen[entryID];if(!entry.exist){try{g.PAssert(2171,!1,"This should never happen as the database is inline with the item tree now")}catch(PERR){g.reportError(PERR)}log(entryID,": Item is referenced remotely as a child but does not exist in the database");var parent=itemCache[entry.ref];try{g.PAssert(2172,parent,"Parent must exist otherwise it couldn't reference this item")}catch(PERR){g.reportError(PERR)}var parentItems=self.getItemList(parent,entry.arch);try{g.PAssert(2173,parentItems,"If the item has been seen here, we will always have a valid parent list")}catch(PERR){g.reportError(PERR)}if(parentItems){var remoteIndex=parentItems.indexOf(entryID);if(remoteIndex>=0)self.beginWriteAction(),parentItems.remove(remoteIndex);else try{g.PAssert(2174,!1,"If we previously saw this item, we expect to be able to delete it from the parent list")}catch(PERR){g.reportError(PERR)}}}entry.ref||entry.isRoot||(log(entryID,": Item exists remotely but is not referenced by a parent"),log("   : ",self.get(itemCache[entryID],"text")),this.removeItemFromCache(entryID)),entry.isRoot&&entry.ref&&(log(entryID,": Remote root has a parent"),localDataError=!0)}d.removeDeletedItems(seen),self.endAction(),ShouldLog(LogLevels.Timing)&&log("Done Verifying Remote Data: ",log.now())},self.migrateData=function migrateDataFn(){function reloadFn(){reqCount++,2===reqCount&&g.reload()}var stopDocLoad=!1,requireLocalReload=!1,requireRemoteReload=!1,trashDoc=!1,clearLocalData=!1,remoteVersion=self.root.get("dataVersion");try{g.PAssert(2184,g.isNumber(remoteVersion),"Remote data version must always be numeric",remoteVersion)}catch(PERR){g.reportError(PERR)}if(CURRENT_VERSION>remoteVersion){self.beginAction(),log("Migrating to latest version: ",remoteVersion);try{switch(remoteVersion){case 0:case 1:case 2:case 3:case 4:trashDoc=!0,log("Remote Migration Completed");break;default:try{g.PAssert(2185,!1,"Unknown remoteVersion: ",remoteVersion)}catch(PERR){g.reportError(PERR)}}}catch(err){requireRemoteReload=!0,g.reportError(err)}self.endAction(),self.model.getRoot().set("dataVersion",CURRENT_VERSION),log("Done Migrating Remote Data!",CURRENT_VERSION)}else remoteVersion>CURRENT_VERSION&&(requireLocalReload=!0,stopDocLoad=!0);if(d.hasLocalData){var localVersion=g.settings.get(Settings.localDataVersion)||0;try{g.PAssert(2187,g.isNumber(localVersion),"Local data version must be numeric",localVersion)}catch(PERR){g.reportError(PERR)}if(g.isNumber(localVersion)){if(CURRENT_VERSION>localVersion){try{switch(localVersion){case 0:case 1:case 2:case 3:case 4:stopDocLoad=!0,clearLocalData=!0,log("Local Migration Completed");break;default:try{g.PAssert(2188,!1,"Unknown localVersion",localVersion)}catch(PERR){g.reportError(PERR)}}}catch(err){requireLocalReload=!0,g.reportError(err)}g.settings.set(Settings.localDataVersion,CURRENT_VERSION),log("Done Migrating Local Data!",CURRENT_VERSION)}else if(localVersion>CURRENT_VERSION)try{g.PAssert(2189,!1,"localVersion is greater than our CURRENT_VERSION",localVersion,CURRENT_VERSION)}catch(PERR){g.reportError(PERR)}}else stopDocLoad=!0,g.menus.alert({text:"There was an error loading your document, please try loading a different document and contact support@moo.do.",actionText:"OKAY"})}else g.settings.set(Settings.localDataVersion,remoteVersion);if(trashDoc)promptTrashDoc();else if(clearLocalData)g.AppCache.runOnFinish(function(){d.clearDataAndReload()},!0);else if(requireLocalReload||requireRemoteReload)if(requireLocalReload&&!requireRemoteReload)g.AppCache.runOnFinish(function(){g.reload()},!0);else if(requireRemoteReload&&!requireLocalReload)self.registerSaveNotify(function(){g.reload()});else{var reqCount=0;g.AppCache.runOnFinish(reloadFn,!0),self.registerSaveNotify(reloadFn)}return stopDocLoad},self.beginAction=function beginActionFn(preventUndo){if(self.model){try{g.PAssert(2202,!self.flushingDeferredActions,"Should never begin a new action while flushing")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2203,!self.inCompoundOperation,"Should not nest compound operations")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2204,!self.wantCompoundOperation,"Should not nest compound operations")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2205,!self.isClosed,"Document must be open to make changes")}catch(PERR){g.reportError(PERR)}self.wantCompoundOperation=!0,self.actionsPreventUndo=!!preventUndo}};var ensureActionTimeout;self.beginWriteAction=function beginWriteActionFn(preventUndo){if(self.model){try{g.PAssert(2206,void 0===preventUndo||self.actionsPreventUndo===!!preventUndo,"Compound operations prevent undo must match",self.actionsPreventUndo,preventUndo)}catch(PERR){g.reportError(PERR)}if(!self.flushingDeferredActions){try{g.PAssert(2207,self.inCompoundOperation||self.wantCompoundOperation,"If performing an action, we should have already requested a compound operation")}catch(PERR){g.reportError(PERR)}if(!self.inCompoundOperation&&self.wantCompoundOperation)try{self.deferredActionsCommitted&&self.flushDeferredActions(),ensureActionTimeout=setTimeout(ensureWriteAction,0),self.model.beginCompoundOperation(void 0,!self.actionsPreventUndo),self.inCompoundOperation=!0,self.wantCompoundOperation=!1,self.deferredActionsCommitted||self.executeDeferredActions()}catch(err){g.reportError(err)}else try{g.PAssert(2208,!self.wantCompoundOperation,"Should not nest compound operations")}catch(PERR){g.reportError(PERR)}}}},self.endAction=function endActionFn(){if(self.model){try{g.PAssert(2209,!self.flushingDeferredActions,"Should never end an action while flushing")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2210,!self.isClosed,"Document must be open to make changes")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2211,self.inCompoundOperation||self.wantCompoundOperation,"If ending an action, a beginning should have happened")}catch(PERR){g.reportError(PERR)}try{self.hasPendingDeferredActions&&(self.deferredActionsCommitted=!0),self.inCompoundOperation&&self.model.endCompoundOperation()}catch(err){g.goog.recoverFromError(err)}finally{self.inCompoundOperation=!1,self.wantCompoundOperation=!1,self.actionsPreventUndo=!1,clearTimeout(ensureActionTimeout),ensureActionTimeout=void 0}}};var DEFERRED_ACTION_TIMEOUT=800,deferredActions={},flushDeferredActionsTimeout;self.performDeferredAction=function performDeferredActionFn(item,action){try{g.PAssert(2214,item,"Must supply a valid item to perform the action on")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2215,action,"Must supply a valid action to be performed")}catch(PERR){g.reportError(PERR)}if(self.model){try{g.PAssert(2216,!self.inCompoundOperation,"Cannot perform deferred action after a compound operation has started")}catch(PERR){g.reportError(PERR)}if(deferredActions[item.id])for(var prop in action)deferredActions[item.id].changes[prop]=action[prop];else deferredActions[item.id]={item:item,changes:action};self.hasPendingDeferredActions=!0,clearTimeout(flushDeferredActionsTimeout),flushDeferredActionsTimeout=setTimeout(self.flushDeferredActions,DEFERRED_ACTION_TIMEOUT)}},self.executeDeferredActions=function executeDeferredActionsFn(){self.flushingDeferredActions=!0;try{for(var id in deferredActions)saveChangesInternal(deferredActions[id].item,deferredActions[id].changes)}catch(err){g.reportError(err)}finally{self.flushingDeferredActions=!1,self.hasPendingDeferredActions=!1,deferredActions={},self.deferredActionsCommitted=!1}},self.flushDeferredActions=function flushDeferredActionsFn(){if(self.model&&!self.isClosed){try{g.PAssert(2217,!self.flushingDeferredActions,"Should never recursively call flushDeferredActions")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2218,!self.inCompoundOperation,"Must flush deferred actions before starting a compound operation")}catch(PERR){g.reportError(PERR)}if(self.hasPendingDeferredActions){clearTimeout(flushDeferredActionsTimeout),flushDeferredActionsTimeout=void 0;try{self.model.beginCompoundOperation(),self.executeDeferredActions(),self.model.endCompoundOperation()}catch(err){g.reportError(err)}}}},self.createNewItem=function createNewItemFn(item,hasItems,hasArchivedItems){self.beginWriteAction();try{g.PAssert(2223,item instanceof VMLI,"Must pass in a valid instace of a local item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2224,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2225,self.inCompoundOperation,"Should always create an item inside of a compound operation")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2226,!self.isClosed,"Document must be open to make changes")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2227,self.model,"Need a valid model to create collaborative items")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2228,!item.data,"When initializing a new item, it should have no gdata components already")}catch(PERR){g.reportError(PERR)}var map=self.model.createMap();if(item.data=map,item.data.connectIdentifier=self.connectIdentifier(),self.set(map,"text",item.getRawText()),hasItems){var collabList=self.model.createList();self.set(map,"items",collabList)}if(hasArchivedItems){var collabArchiveList=self.model.createList();self.set(map,"archivedItems",collabArchiveList)}return self.set(map,"dateCreated",item.dateCreated.getTime()),item.id=map.id,itemCache[map.id]||(itemCache[map.id]=map),map.id},self.initializeNewItem=function initializeNewItemFn(item){self.beginWriteAction();try{g.PAssert(2229,item instanceof VMLI,"Must pass in a valid instace of a local item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2230,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2231,!self.isClosed,"Document must be open to make changes")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2232,self.inCompoundOperation,"Should always initialize an item inside of a compound operation")}catch(PERR){g.reportError(PERR)}if(item.hasChildren()){var items=item.getItems(),collabList=ensureRemoteItemsArray(item);try{g.PAssert(2233,collabList,"Must have a valid collab list for normal init")}catch(PERR){g.reportError(PERR)}for(var i=0;i<items.length;++i){try{g.PAssert(2234,items[i].data,"Item must have a valid remote to be added to a collab list")}catch(PERR){g.reportError(PERR)}collabList.push(items[i].data)}}if(item.hasArchivedChildren()){var archivedItems=item.archivedItems(!0),collabArchivedList=ensureRemoteArchiveArray(item);try{g.PAssert(2235,collabArchivedList,"Must have a valid collab list for archived init")}catch(PERR){g.reportError(PERR)}for(var i=0;i<archivedItems.length;++i){try{g.PAssert(2236,archivedItems[i].data,"Item must have a valid remote to be added to a collab list")}catch(PERR){g.reportError(PERR)}collabArchivedList.push(archivedItems[i].data)}}if(item.hasNote()){var note=item.getNote();try{g.PAssert(2237,note.data,"Note must have a valid remote to be added to an item")}catch(PERR){g.reportError(PERR)}self.set(item,"note",note.data)}attachEvents(item)},self.attachEventsToItem=function attachEventsToItemFn(item){try{g.PAssert(2238,item instanceof VMLI,"Must pass in a valid local item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2239,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2240,item.data,"Must have loaded data from gdrive before attaching events to item")}catch(PERR){g.reportError(PERR)}attachEvents(item)};var undoRedoStateChangeHandler;self.registerForUndoRedoStateChange=function registerForUndoRedoStateChangeFn(handler){self.model?(self.model.addEventListener(gapi.drive.realtime.EventType.UNDO_REDO_STATE_CHANGED,handler.stateChangeForUndoRedo),handler.stateChangeForUndoRedo({canUndo:self.model.canUndo,canRedo:self.model.canRedo})):undoRedoStateChangeHandler=handler},self.registerForSaveStateChange=function registerForSaveStateChangeFn(handler){try{g.PAssert(2241,self.doc,"Must have a valid doc to connect to")}catch(PERR){g.reportError(PERR)}self.doc.addEventListener(gapi.drive.realtime.EventType.DOCUMENT_SAVE_STATE_CHANGED,handler)},self.loadCollaborators=function loadCollaboratorsFn(){for(var collabs=self.doc.getCollaborators(),selfInfo,i=0;i<collabs.length;++i){var collab=collabs[i];collab.isMe&&(selfInfo=collab)}self.authenticatedUser(selfInfo)},self.undoAction=function undoActionFn(){self.flushDeferredActions();try{g.PAssert(2242,!self.isClosed,"Document must be open to make changes")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2243,self.model.canUndo)}catch(PERR){g.reportError(PERR)}self.model.undo()},self.redoAction=function redoActionFn(){self.flushDeferredActions();try{g.PAssert(2244,!self.isClosed,"Document must be open to make changes")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2245,self.model.canRedo)}catch(PERR){g.reportError(PERR)}self.model.redo()},self.getItemParent=function getItemParentFn(model){return model._mdParent},self.setItemParent=function setItemParentFn(model,parentModel){try{g.PAssert(2246,model,"Must provide a valid model when setting the item parent")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2247,!(model instanceof VMLI),"Must pass in a valid remote item for child")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2248,!(parentModel instanceof VMLI),"Must pass in a valid remote item for parent")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2249,void 0===model._mdParent||void 0===parentModel,"Should not be overwriting a parent without clearing it first")}catch(PERR){g.reportError(PERR)}model._mdParent=parentModel},self.changeItemParent=function changeItemParentFn(model,parentModel){try{g.PAssert(2250,model,"Must provide a valid model when setting the item parent")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2251,!(model instanceof VMLI),"Must pass in a valid remote item for child")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2252,!(parentModel instanceof VMLI),"Must pass in a valid remote item for parent")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2253,void 0!==model._mdParent&&void 0!==parentModel,"Should always be overwriting the parent value")}catch(PERR){g.reportError(PERR)}model._mdParent=parentModel},self.getItemList=function getItemListFn(model,isArchived){self.beginWriteAction();try{g.PAssert(2254,!(model instanceof VMLI),"Must pass in a valid remote item")}catch(PERR){g.reportError(PERR)}return isArchived?self.get(model,"archivedItems"):self.get(model,"items")},self.ensureItemList=function ensureItemListFn(item,isArchived){self.beginWriteAction();try{g.PAssert(2255,item instanceof VMLI,"Must pass in a valid local item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2256,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}return isArchived?ensureRemoteArchiveArray(item):ensureRemoteItemsArray(item)},self.canSave=function canSaveFn(item){if(self.initialized){var data=item instanceof VMLI?item.data:item;try{g.PAssert(2263,data,"Must have a valid remote item to make changes")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2264,!self.isClosed,"Document must be open to make changes")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2265,!data||data.connectIdentifier===self.connectIdentifier(),"Using remote item data that is out of date",data?data.connectIdentifier:-1,self.connectIdentifier())}catch(PERR){g.reportError(PERR)}return data&&!self.isClosed&&data.connectIdentifier===self.connectIdentifier()?data:!1}},self.deleteTree=function deleteTreeFn(item){self.beginWriteAction();try{g.PAssert(2266,item,"Must provide a valid item instance to deleteTree")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2267,!(item instanceof VMLI),"Must not be a VMLI, should be a remote item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2268,!g.isString(item),"Must pass in a valid remote item not an ID")}catch(PERR){g.reportError(PERR)}if(item){self.setItemParent(item,void 0);var localItem=d.getItem(item.id);localItem&&localItem.data&&localItem.data===item&&(localItem.data=void 0);var items=self.getItemList(item,!1);if(items)for(var i=0;i<items.length;++i){var child=items.get(i);self.deleteTree(child)}var archivedItems=self.getItemList(item,!0);if(archivedItems)for(var i=0;i<archivedItems.length;++i){var archivedChild=archivedItems.get(i);self.deleteTree(archivedChild)}self.removeItemFromCache(item.id)}},self.noteSet=function noteSetFn(item,noteItem){if(!self.isConnected())return ReturnValue.Success;self.beginWriteAction();try{g.PAssert(2269,item,"Must provide a valid item to set a note on")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2270,!noteItem||noteItem.isNote(),"Must be removing a note or setting note with a valid note item")}catch(PERR){g.reportError(PERR)}try{var itemData=self.canSave(item);if(!itemData)return ReturnValue.Error;var noteData;noteItem&&(noteData=self.canSave(noteItem)),self.set(itemData,"note",noteData)}catch(err){throw g.reportError(err),err}return ReturnValue.Success},self.itemAdded=function itemAddedFn(params){if(!self.isConnected())return ReturnValue.Success;self.beginWriteAction();var item=params.item,addedItem=params.addedItem,index=params.index,isArchived=params.isArchived,noVersion=params.noVersion;try{g.PAssert(2271,void 0!==item&&void 0!==addedItem&&void 0!==isArchived,"itemAdded is missing parameters")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2272,index>=-1||void 0===index,"Invalid index",index)}catch(PERR){g.reportError(PERR)}try{var itemData=self.canSave(item);if(!itemData)return ReturnValue.Error;var addedData=self.canSave(addedItem);try{g.PAssert(2273,addedData,"Must have valid gdata for the item being inserted")}catch(PERR){g.reportError(PERR)}d.addPendingUpdate(item.id),d.addPendingUpdate(addedItem.id);var arr=self.ensureItemList(item,isArchived);try{g.PAssert(2274,arr,"Must have a valid remote list to add the item to")}catch(PERR){g.reportError(PERR)}0>index||isNaN(index)||index>arr.length?arr.push(addedData):arr.insert(index,addedData),noVersion||setRemoteVersion(addedData),self.setItemParent(addedData,itemData)}catch(err){throw g.reportError(err),err
}return ReturnValue.Success},self.itemsAdded=function itemsAddedFn(params){if(!self.isConnected())return ReturnValue.Success;self.beginWriteAction();var item=params.item;try{g.PAssert(2275,item instanceof VMLI,"Passed in item must be a VMLI")}catch(PERR){g.reportError(PERR)}var addedItems=params.addedItems,index=params.index,isArchived=params.isArchived,noVersion=params.noVersion;try{g.PAssert(2276,void 0!==item&&void 0!==addedItems&&void 0!==isArchived,"itemsAdded is missing parameters")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2277,isNaN(index)||index>=0,"Must provide a valid item index when adding an item to a remote list")}catch(PERR){g.reportError(PERR)}try{var itemData=self.canSave(item);try{g.PAssert(2278,itemData,"Must have valid item data when adding an item")}catch(PERR){g.reportError(PERR)}if(!itemData)return ReturnValue.Error;var arr=self.ensureItemList(item,isArchived);try{g.PAssert(2279,arr,"Must have a valid remote list to add the item to")}catch(PERR){g.reportError(PERR)}for(var addedArr=new Array(addedItems.length),i=0;i<addedItems.length;++i)addedArr[i]=addedItems[i].data,d.addPendingUpdate(addedItems[i].id),!noVersion&&addedArr[i]&&setRemoteVersion(addedArr[i]),self.setItemParent(addedArr[i],item);if(d.addPendingUpdate(item.id),0>index||isNaN(index)){try{g.PAssert(2280,isArchived,"Only archived items should be inserted into a list by pushing")}catch(PERR){g.reportError(PERR)}arr.pushAll(addedArr)}else arr.insertAll(index,addedArr)}catch(err){throw g.reportError(err),err}return ReturnValue.Success},self.itemRemoved=function itemRemovedFn(params){if(!self.isConnected())return ReturnValue.Success;self.beginWriteAction();var item=params.item,index=params.index,numToRemove=params.numToRemove,isArchived=params.isArchived,noDelete=params.noDelete,noVersion=params.noVersion;try{g.PAssert(2281,void 0!==item&&void 0!==index&&void 0!==numToRemove&&void 0!==isArchived,"itemRemoved is missing parameters")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2282,index>=0,"Must have a valid index to remove from")}catch(PERR){g.reportError(PERR)}try{var itemData=self.canSave(item);try{g.PAssert(2283,itemData,"Must have valid item data when removing an item")}catch(PERR){g.reportError(PERR)}if(!itemData)return ReturnValue.Error;isNaN(numToRemove)&&(numToRemove=1);var arr=self.getItemList(itemData,isArchived);try{g.PAssert(2284,arr,"Must have a valid remote list to remove the item from")}catch(PERR){g.reportError(PERR)}for(var i=index;index+numToRemove>i;i++){var deleted=arr.get(i);d.addPendingUpdate(deleted.id),noVersion||setRemoteVersion(deleted),noDelete||self.deleteTree(deleted)}d.addPendingUpdate(item.id),1===numToRemove?arr.remove(index):arr.removeRange(index,index+numToRemove)}catch(err){throw g.reportError(err),err}return ReturnValue.Success},self.itemMoved=function itemMovedFn(params){if(!self.isConnected())return ReturnValue.Success;self.beginWriteAction();var item=params.item,newInfo=params.newInfo,oldParent=params.oldParent,oldInfo=params.oldInfo,noVersion=params.noVersion;try{g.PAssert(2285,void 0!==item&&void 0!==newInfo&&void 0!==oldParent&&void 0!==oldInfo,"itemMoved is missing parameters")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2286,newInfo&&newInfo.index>=-1)}catch(PERR){g.reportError(PERR)}try{g.PAssert(2287,newInfo&&void 0!==newInfo.isArchived)}catch(PERR){g.reportError(PERR)}try{g.PAssert(2288,oldParent)}catch(PERR){g.reportError(PERR)}try{g.PAssert(2289,oldInfo&&oldInfo.index>=0)}catch(PERR){g.reportError(PERR)}try{g.PAssert(2290,oldInfo&&void 0!==oldInfo.isArchived)}catch(PERR){g.reportError(PERR)}try{var itemData=self.canSave(item);try{g.PAssert(2291,itemData,"Must have valid item data when moving")}catch(PERR){g.reportError(PERR)}if(!itemData)return ReturnValue.Error;var oldParentData=self.canSave(oldParent);try{g.PAssert(2292,oldParentData,"Must have valid src item data when moving")}catch(PERR){g.reportError(PERR)}if(!oldParentData)return ReturnValue.Error;var newParentData=self.canSave(item.parent());try{g.PAssert(2293,newParentData,"Must have valid dst item data when moving")}catch(PERR){g.reportError(PERR)}if(!newParentData)return ReturnValue.Error;var srcList=self.getItemList(oldParentData,oldInfo.isArchived);try{g.PAssert(2294,srcList,"Must have a valid remote list to remove the item from")}catch(PERR){g.reportError(PERR)}var dstList=self.ensureItemList(item.parent(),newInfo.isArchived);try{g.PAssert(2295,dstList,"Must have a valid remote list to add the item to")}catch(PERR){g.reportError(PERR)}var dstIndex=newInfo.index;(newInfo.index<0||isNaN(newInfo.index)||newInfo.index>dstList.length)&&(dstIndex=dstList.length),srcList.moveToList(oldInfo.index,dstList,dstIndex),self.changeItemParent(itemData,newParentData),d.addPendingUpdate(item.id),d.addPendingUpdate(oldParent.id),d.addPendingUpdate(item.parent().id),noVersion||setRemoteVersion(itemData)}catch(err){throw g.reportError(err),err}return ReturnValue.Success},self.itemArchived=function itemArchivedFn(item,itemArchived,index){if(!self.isConnected())return ReturnValue.Success;self.beginWriteAction();try{g.PAssert(2296,index>=0,"Must have a valid index to remove from")}catch(PERR){g.reportError(PERR)}try{var itemData=self.canSave(item);try{g.PAssert(2297,itemData,"Must have valid item data when archiving an item")}catch(PERR){g.reportError(PERR)}if(!itemData)return ReturnValue.Error;var archivedItemData=self.canSave(itemArchived);if(!archivedItemData)return ReturnValue.Error;var items=self.getItemList(itemData,!1);try{g.PAssert(2298,items,"Must be an items array present")}catch(PERR){g.reportError(PERR)}var archivedItems=ensureRemoteArchiveArray(item);try{g.PAssert(2299,archivedItems,"Must be an archived items array present")}catch(PERR){g.reportError(PERR)}if(!(index<items.length)){try{g.PAssert(2300,!1,"Passed in an invalid idnex to archive an item at")}catch(PERR){g.reportError(PERR)}return ReturnValue.Error}items.moveToList(index,archivedItems,archivedItems.length),d.addPendingUpdate(item.id),d.addPendingUpdate(itemArchived.id),setRemoteVersion(itemArchived.data)}catch(err){throw g.reportError(err),err}return ReturnValue.Success},self.itemUnarchived=function itemUnarchivedFn(item,itemUnarchived,removeIndex,insertIndex){if(!self.isConnected())return ReturnValue.Success;self.beginWriteAction();try{g.PAssert(2301,removeIndex>=0,"Must have a valid index to remove from")}catch(PERR){g.reportError(PERR)}try{var itemData=self.canSave(item);try{g.PAssert(2302,itemData,"Must have valid item data when archiving an item")}catch(PERR){g.reportError(PERR)}if(!itemData)return ReturnValue.Error;var unarchivedItemData=self.canSave(itemUnarchived);if(!unarchivedItemData)return ReturnValue.Error;var items=self.get(itemData,"items");try{g.PAssert(2303,items,"Must be an items array present")}catch(PERR){g.reportError(PERR)}var archivedItems=self.get(itemData,"archivedItems");try{g.PAssert(2304,archivedItems,"Must be an archived items array present")}catch(PERR){g.reportError(PERR)}archivedItems.moveToList(removeIndex,items,insertIndex),d.addPendingUpdate(item.id),d.addPendingUpdate(itemUnarchived.id),setRemoteVersion(itemUnarchived.data)}catch(err){throw g.reportError(err),err}return ReturnValue.Success},self.saveChanges=function saveChangesFn(item,changes){self.isConnected()&&(self.inCompoundOperation||self.actionsPreventUndo?saveChangesInternal(item,changes):self.performDeferredAction(item,changes))},self.resetDriveData=function resetDriveDataFn(){itemCache={},self.initialized=!1,self.doc=void 0,self.model=void 0,self.root=void 0,self.rootItem=void 0,self.rootID=void 0,window.__remoteDoc=void 0,self.cachesRemote=void 0,d.forEachModel(function(vmli){vmli&&vmli.resetDriveData()}),g.vmMain.notifyDriveDisconnect(),self.inCompoundOperation=!1,self.wantCompoundOperation=!1,self.flushingDeferredActions=!1,self.deferredActionsCommitted=!1,clearTimeout(ensureActionTimeout),ensureActionTimeout=void 0,clearTimeout(flushDeferredActionsTimeout),flushDeferredActionsTimeout=void 0,self.hasPendingDeferredActions=!1,deferredActions={}},self.close=function closeFn(){try{g.PAssert(2315,driveRealtimeStatus===RealtimeStatus.Error,"Invalid state for document close: ",driveRealtimeStatus)}catch(PERR){g.reportError(PERR)}try{g.PAssert(2316,!self.wantCompoundOperation,"Closing the doc with a deferred compound operation")}catch(PERR){g.reportError(PERR)}if(self.doc&&!self.isClosed){log("---- Closing Remote Document! ----"),self.isClosed=!0,g.vmMain.setGDriveStatus(DriveStatus.Offline);try{self.doc.close()}catch(err){log("Error Closing Doc: ",err)}self.resetDriveData()}else g.vmMain.isReconnecting()&&g.vmMain.setGDriveStatus(DriveStatus.Offline)};var retryCount=0,retryIntervals=[1e3,2e4,4e4,6e4,9e4],driveReconnectTimer;self.setupReconnect=function setupReconnectFn(){try{g.PAssert(2318,driveRealtimeStatus===RealtimeStatus.Error||driveRealtimeStatus===RealtimeStatus.XHRError,"Invalid state for setup reconnect: ",driveRealtimeStatus)}catch(PERR){g.reportError(PERR)}try{g.PAssert(2319,!driveReconnectTimer,"Reconnect timer already active")}catch(PERR){g.reportError(PERR)}var retryTimeout=getRetryInterval(retryCount++);clearTimeout(driveReconnectTimer),driveReconnectTimer=setTimeout(tryDriveReconnect,retryTimeout)},self.notifyReconnectFailure=function notifyReconnectFailureFn(){self.setupReconnect()},self.notifyReconnectSuccess=function notifyReconnectSuccessFn(){retryCount=0,clearTimeout(driveReconnectTimer),driveReconnectTimer=void 0};var RealtimeStatus={Disconnected:0,Connecting:1,Connected:2,Reconnecting:3,Error:4,XHRError:5},driveRealtimeStatus=RealtimeStatus.Disconnected;self.getDriveRealtimeStatus=function getDriveRealtimeStatusFn(){return driveRealtimeStatus};var _connectIdentifier=1;self.connectIdentifier=function connectIdentifierFn(){return _connectIdentifier};var isXHRWrapped=!1;if(self.driveRealtimeLoad=function driveRealtimeLoadFn(id,onLoaded,onInitialized,onError){try{g.PAssert(2328,driveRealtimeStatus===RealtimeStatus.Disconnected||driveRealtimeStatus===RealtimeStatus.Error,"Loading realtime document from invalid state")}catch(PERR){g.reportError(PERR)}var prevStatus=driveRealtimeStatus;if(driveRealtimeStatus===RealtimeStatus.Disconnected?setDriveRealtimeStatus(RealtimeStatus.Connecting):(driveRealtimeStatus===RealtimeStatus.Error||driveRealtimeStatus===RealtimeStatus.XHRError)&&setDriveRealtimeStatus(RealtimeStatus.Reconnecting),prevStatus===RealtimeStatus.Disconnected||prevStatus===RealtimeStatus.Error||prevStatus===RealtimeStatus.XHRError){isXHRWrapped=g.registerURLForNotifyXHR("https://drive.google.com/otservice/gs",onRSCDrive);try{g.PAssert(2329,isXHRWrapped,"XHR must always be successfully wrapped")}catch(PERR){g.reportError(PERR)}gapi.drive.realtime.load(id,fwdOnLoaded(onLoaded),fwdOnInitialized(onInitialized),fwdOnError(onError))}},self.onInitialized=function onInitializedFn(model){log("Initializing",model),d||(d=require("data")),VMLI||(VMLI=require("VMLI"));var home=model.createMap(),homeItems=model.createList();self.set(home,"text","Home"),self.set(home,"items",homeItems),self.set(home,"archivedItems",model.createList()),self.set(home,"dateCreated",Date.now());var root=model.getRoot();root.set("dataVersion",CURRENT_VERSION),root.set("root",home);var openDoc=g.vmMain.docManager.getOpenDoc();try{g.PAssert(2330,openDoc,"Must have an open doc to be initializing a realtime doc")}catch(PERR){g.reportError(PERR)}openDoc.getDocumentFolder(function(docFolderID){root.set("docFolderID",docFolderID)}),root.set("settings",model.createMap()),root.set("caches",model.createMap())},DETAILED_STATS){var __RCacheStats={reads:0,writes:0,exists:0,updates:0,deletes:0,ensures:0,rchanges:0};self.getPreviewCacheStats=function getPreviewCacheStatsFn(){return __RCacheStats},window.__dumpRCacheStats=function(){log("---- RCache Stats ----"),log(" Reads: "+__RCacheStats.reads),log(" Writes: "+__RCacheStats.writes),log(" Exists: "+__RCacheStats.exists),log(" Updates: "+__RCacheStats.updates),log(" Deletes: "+__RCacheStats.deletes),log(" Ensures: "+__RCacheStats.ensures),log(" RChanges: "+__RCacheStats.rchanges),log("----------------------")}}var missedCacheWrites={},cacheMaxEntrySize=300;self.maxCacheEntrySize=function maxCacheEntrySizeFn(){return cacheMaxEntrySize},self.cacheChanged=function cacheChangedFn(cache,e){if(e.ocHandled||e.isLocal)return!1;for(var i=0;i<e.events.length;++i){var ev=e.events[i];switch(DETAILED_STATS&&__RCacheStats.rchanges++,ev.type){case gapi.drive.realtime.EventType.VALUES_ADDED:self.notifyListeners(cache,DataChangeType.Add,ev.property,ev.newValue);break;case gapi.drive.realtime.EventType.VALUES_REMOVED:self.notifyListeners(cache,DataChangeType.Remove,ev.property,ev.newValue);break;case gapi.drive.realtime.EventType.VALUE_CHANGED:self.notifyListeners(cache,DataChangeType.Change,ev.property,ev.newValue);break;case gapi.drive.realtime.EventType.TEXT_DELETED:case gapi.drive.realtime.EventType.TEXT_INSERTED:case gapi.drive.realtime.EventType.VALUES_SET:default:try{g.PAssert(2332,!1,"Unexpected event type")}catch(PERR){g.reportError(PERR)}}}};var cacheChangeListeners={};self.notifyListeners=function notifyListenersFn(cache,type,id,data){var listeners=cacheChangeListeners[cache];try{g.PAssert(2333,listeners&&listeners.length>0,"Should always have an interested party if we are receiving notifications")}catch(PERR){g.reportError(PERR)}try{var dataObj;data&&(dataObj=JSON.parse(data),dataObj.id=id);for(var i=0;i<listeners.length;++i)try{listeners[i](type,id,dataObj)}catch(err){g.reportError(err)}}catch(parseErr){g.reportError(parseErr)}},self.hookCacheListeners=function hookCacheListenersFn(){for(var cache in cacheChangeListeners)try{self.hookCacheListener(cache)}catch(err){g.reportError(err)}},self.hookCacheListener=function hookCacheListenerFn(cache){var remoteCache=self.cachesRemote.get(cache);try{g.PAssert(2334,remoteCache,"If we are listening for a cache, it must have been ensured first")}catch(PERR){g.reportError(PERR)}var success=!1;if(remoteCache){var dataCache=remoteCache.get("data");try{g.PAssert(2335,dataCache,"Malformed cache, must have a data entry present")}catch(PERR){g.reportError(PERR)}dataCache&&(dataCache.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,self.cacheChanged.bind(self,cache)),success=!0)}return success},self.registerForCacheChanges=function registerForCacheChangesFn(cache,cb){try{g.PAssert(2336,cb,"Must provide a valid callback function for cache changes")}catch(PERR){g.reportError(PERR)}var success=!1,listeners=cacheChangeListeners[cache];if(listeners){try{g.PAssert(2337,listeners.indexOf(cb)<0,"Should never double register a listener")}catch(PERR){g.reportError(PERR)}listeners.push(cb)}else cacheChangeListeners[cache]=[cb];return self.isCacheAvailable(cache)&&(success=self.hookCacheListener(cache)),success},self.unregisterForCacheChanges=function unregisterForCacheChangesFn(cache,cb){var listeners=cacheChangeListeners[cache];try{g.PAssert(2338,listeners,"Must have previously registered with a cache")}catch(PERR){g.reportError(PERR)}var removedIndex=listeners.remove(cb);try{g.PAssert(2339,removedIndex>=0,"Did not try to remove a valid listener")}catch(PERR){g.reportError(PERR)}return removedIndex>=0},self.loadDataCaches=function loadDataCachesFn(){self.cachesRemote=self.root.get("caches"),self.cachesRemote||(self.cachesRemote=self.model.createMap(),self.root.set("caches",self.cachesRemote)),self.writeMissedCacheEntries(),self.sendAvailableNotifications(),self.hookCacheListeners()},self.queryCache=function queryCacheFn(cache,key){try{g.PAssert(2340,self.cachesRemote,"Caches must have been initialized")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2341,!g.isTempId(key),"Should not query remote cache for local only items")}catch(PERR){g.reportError(PERR)}DETAILED_STATS&&__RCacheStats.reads++;var remoteCache=self.ensureCache(cache);if(remoteCache){var cacheEntry=JSON.parse(remoteCache.get("data").get(key));if(cacheEntry)return cacheEntry.id=key,cacheEntry}return void 0},self.hasCacheEntry=function hasCacheEntryFn(cache,key){try{g.PAssert(2342,self.cachesRemote,"Caches must have been initialized")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2343,!g.isTempId(key),"Should not query remote cache for local only items")}catch(PERR){g.reportError(PERR)}DETAILED_STATS&&__RCacheStats.exists++;var remoteCache=self.ensureCache(cache);return remoteCache?!!remoteCache.get("data").get(key):!1},self.updateCache=function updateCacheFn(cache,key,value){try{g.PAssert(2344,self.cachesRemote,"Caches must have been initialized")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2345,!g.isTempId(key),"Should never save a local only item to the remote cache")}catch(PERR){g.reportError(PERR)}var oldEntry,remoteCache=self.ensureCache(cache);try{value=JSON.stringify(value)}catch(err){g.reportError(err),value=void 0}if(remoteCache){oldEntry=remoteCache.get("data").get(key);var oldSize=entrySize(oldEntry),newSize=entrySize(value);try{g.PAssert(2346,newSize<self.maxCacheEntrySize(),"New cache entry too large",newSize)}catch(PERR){g.reportError(PERR)}var sizeDiff=newSize-oldSize,cacheInfo=remoteCache.get("info");if(oldEntry?DETAILED_STATS&&__RCacheStats.updates++:cacheInfo.set("entries",cacheInfo.get("entries")+1),cacheInfo.set("size",cacheInfo.get("size")+sizeDiff),void 0!==value)DETAILED_STATS&&__RCacheStats.writes++,remoteCache.get("data").set(key,value);else{try{g.PAssert(2347,oldEntry,"Should never be setting undefined->undefined")}catch(PERR){g.reportError(PERR)}DETAILED_STATS&&__RCacheStats.deletes++,remoteCache.get("data").delete(key)}}else missedCacheWrites[key]=value;return oldEntry},self.ensureCache=function ensureCacheFn(cache){DETAILED_STATS&&__RCacheStats.ensures++;var remoteCache;if(self.cachesRemote&&(remoteCache=self.cachesRemote.get(cache),!remoteCache)){self.model.beginCompoundOperation(),remoteCache=self.model.createMap();var cacheInfo=self.model.createMap();cacheInfo.set("entries",0),cacheInfo.set("size",0),remoteCache.set("info",cacheInfo);var cacheData=self.model.createMap();remoteCache.set("data",cacheData),self.cachesRemote.set(cache,remoteCache),self.model.endCompoundOperation()}return remoteCache},self.clearCache=function clearCacheFn(cache){try{g.PAssert(2348,self.cachesRemote,"Caches must have been initialized")}catch(PERR){g.reportError(PERR)}if(self.cachesRemote){var remoteCache=self.cachesRemote.get(cache);if(remoteCache){remoteCache.get("data").clear();var cacheInfo=remoteCache.get("info");try{g.PAssert(2349,cacheInfo,"Malformed cache, every cache must have an info object")}catch(PERR){g.reportError(PERR)}cacheInfo.set("entries",0),cacheInfo.set("size",0)}}},self.clearCaches=function clearCachesFn(){},self.getCacheSize=function getCacheSizeFn(cache){try{g.PAssert(2350,self.cachesRemote,"Caches must have been initialized")}catch(PERR){g.reportError(PERR)}if(self.cachesRemote){var remoteCache=self.cachesRemote.get(cache);if(remoteCache)return remoteCache.get("info").get("size")}return 0},self.isCacheAvailable=function isCacheAvailableFn(cache){return self.cachesRemote&&self.cachesRemote.get(cache)};var notifyOnCacheAvailable=[];self.requestNotifyWhenAvailable=function requestNotifyWhenAvailableFn(cb){try{g.PAssert(2351,notifyOnCacheAvailable.indexOf(cb)<0,"Should not push same callback multiple times")}catch(PERR){g.reportError(PERR)}self.cachesRemote?cb():notifyOnCacheAvailable.push(cb)},self.sendAvailableNotifications=function sendAvailableNotificationsFn(){for(var i=0;i<notifyOnCacheAvailable.length;++i)notifyOnCacheAvailable[i]();notifyOnCacheAvailable=[]},self.writeMissedCacheEntries=function writeMissedCacheEntriesFn(){for(var key in self.missedCacheWrites){var value=self.missedCacheWrites[key];log("XX Writing missed cache entry: ",key,value)}self.missedCacheWrites={}},self.poke=function pokeFn(){if(self.root&&!self.isClosed)try{var pk=self.root.get("poke");pk?self.root.set("poke",pk+1):self.root.set("poke",1)}catch(err){log("Exception during poke, reconnecting: ",err),self.close(),self.setupReconnect()}},window.__poke=self.poke,self.rootChanged=function rootChangedFn(e){if(e.ocHandled||e.isLocal||self.root.id!==e.target.id)return!1;for(var i=0;i<e.events.length;++i)switch(e.events[i].type){case gapi.drive.realtime.EventType.VALUES_ADDED:case gapi.drive.realtime.EventType.VALUES_REMOVED:break;case gapi.drive.realtime.EventType.VALUE_CHANGED:"dataVersion"===e.property&&(e.newValue>CURRENT_VERSION?g.AppCache.checkForUpdate(!0):e.newVersion<CURRENT_VERSION&&g.reportError(new Error("Remote setting dataVersion to invalid value"+e.newVersion)));break;case gapi.drive.realtime.EventType.TEXT_DELETED:case gapi.drive.realtime.EventType.TEXT_INSERTED:case gapi.drive.realtime.EventType.VALUES_SET:default:try{g.PAssert(2352,!1,"Unexpected event type")}catch(PERR){g.reportError(PERR)}}},self.isConnected=function isConnectedFn(){return self.initialized&&!self.isClosed&&!!self.model},self.onLoad=function onLoadFn(doc){try{try{window.__LOAD_HANDLES.push(g.getCurrentStack("Document Opened Handled"))}catch(err){g.reportError(err)}try{g.PAssert(2353,self.isClosed,"Document must not already be open when we are loading")}catch(PERR){g.reportError(PERR)}try{self.isClosed||g.reportError(new Error("Multi-Document Load"),window.__LOAD_REQUESTS.ordered())}catch(err){g.reportError(err)}self.initialized=!0,self.loadedOnce=!0,ShouldLog(LogLevels.Timing)&&log("Loading document from gdrive",log.now()),d||(d=require("data")),VMLI||(VMLI=require("VMLI")),self.doc=doc,self.model=doc.getModel(),self.root=self.model.getRoot(),self.root.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,self.rootChanged),self.isClosed=!1,self.registerForSaveStateChange(self.onSaveStateChange);var stopLoadingRemote=self.migrateData();return stopLoadingRemote?(log("---- Skipping Document Load! ----"),self.isClosed=!0,self.initialized=!1,self.doc=void 0,self.model=void 0,self.root=void 0,!1):(self.loadDataCaches(),self.rootItem=self.root.get("root"),self.rootItem?(self.rootID=self.rootItem.id,window.__remoteDoc=doc,undoRedoStateChangeHandler&&(self.registerForUndoRedoStateChange(undoRedoStateChangeHandler),undoRedoStateChangeHandler=void 0),g.vmMain?g.vmMain.loadGDriveData():g.requireGDriveDataCallback=!0,self.loadCollaborators(),!0):void g.menus.alert({text:"Moo.do has encountered an error. The developers have been notified to make sure this doesn't happen again. If the problem persists, please contact support@moo.do.",actionText:"RELOAD",action:function actionFn(){d.clearData(function(){g.reload()})}}))}catch(err){g.reportError(err)}},self.getServerVersion=function getServerVersionFn(){return self.model&&!self.isClosed?self.model.serverVersion:void 0};var notifyOfSaveChange=[];self.registerSaveNotify=function registerSaveNotifyFn(fn){notifyOfSaveChange.push(fn)};var lastPending=!1,lastSaving=!1,saveTimeout;return self.onSaveStateChange=function onSaveStateChangeFn(e){if(lastPending!==e.isPending||lastSaving!==e.isSaving){if(e.isSaving||e.isPending)navigator.onLine?e.isSaving&&(e.isPending||g.vmMain.setGDriveStatus(DriveStatus.Saving),clearTimeout(saveTimeout),saveTimeout=setTimeout(self.onErrorSaving,self.offlineTimeoutMS)):g.vmMain.setGDriveStatus(DriveStatus.Offline);else{g.vmMain.setGDriveStatus(DriveStatus.Saved),d.clearPendingUpdates(),clearTimeout(saveTimeout),saveTimeout=void 0,g.messageQueue.clearMessage(MessageID.ConnectionError);for(var i=0;i<notifyOfSaveChange.length;++i)notifyOfSaveChange[i](self.numChanges);self.numChanges=0}lastPending=e.isPending,lastSaving=e.isSaving}},self.onErrorSaving=function onErrorSavingFn(){g.vmMain.setGDriveStatus(DriveStatus.Offline),saveTimeout=void 0},self.getVersion=function getVersionFn(map,type){try{g.PAssert(2354,!(map instanceof VMLI),"Must pass in a valid remote item: ",g.getObjectInfo(map))}catch(PERR){g.reportError(PERR)}var field,v;switch(type){case VersionType.Structure:v=map.get(g.translateFieldIn("version"));break;case VersionType.Text:v=map.get(g.translateFieldIn("versionText"));break;default:v=-2;try{g.PAssert(2355,!1,"Invalid version type")}catch(PERR){g.reportError(PERR)}}return v?v:0},self.get=function getFn(map,field){try{g.PAssert(2356,!(map instanceof VMLI),"Must pass in a valid remote item: ",g.getObjectInfo(map))}catch(PERR){g.reportError(PERR)}return map.get(g.translateFieldIn(field))},self.set=function setFn(map,field,value){self.beginWriteAction();try{g.PAssert(2357,!(map instanceof VMLI),"Must pass in a valid remote item: ",g.getObjectInfo(map))}catch(PERR){g.reportError(PERR)}return void 0===value&&(value=null),map.set(g.translateFieldIn(field),value)},self.delete=function deleteFn(map,field){self.beginWriteAction();try{g.PAssert(2358,!(map instanceof VMLI),"Must pass in a valid remote item: ",g.getObjectInfo(map))}catch(PERR){g.reportError(PERR)}return map.delete(g.translateFieldIn(field))},self.findInTree=function findInTreeFn(item){try{g.PAssert(2361,item,"Must provide a valid item to find")}catch(PERR){g.reportError(PERR)}var isArchived=!1,parent=self.getItemParent(item);if(parent){var itemList=self.getItemList(parent,!1),itemIndex=-1;if(itemList&&(itemIndex=itemList.indexOf(item)),0>itemIndex){var archivedItemList=self.getItemList(parent,!0);archivedItemList&&(itemIndex=archivedItemList.indexOf(item),itemIndex>=0&&(isArchived=!0))}}var output=void 0;return parent&&itemIndex>=0&&(output={parent:parent,index:itemIndex,isArchived:isArchived}),output},self});var idbModules={util:{}},cleanInterface=!1;!function(){var testObject={test:!0};if(Object.defineProperty)try{Object.defineProperty(testObject,"test",{enumerable:!1}),testObject.test&&(cleanInterface=!0)}catch(e){}}(),function(idbModules){function callback(fn,context,event){event.target=context,"function"==typeof context[fn]&&context[fn].apply(context,[event])}var StringList=function(){this.length=0,this._items=[],cleanInterface&&Object.defineProperty(this,"_items",{enumerable:!1})};if(StringList.prototype={contains:function(str){return-1!==this._items.indexOf(str)},item:function(key){return this._items[key]},indexOf:function(str){return this._items.indexOf(str)},push:function(item){this._items.push(item),this.length+=1;for(var i=0;i<this._items.length;i++)this[i]=this._items[i]},splice:function(){this._items.splice.apply(this._items,arguments),this.length=this._items.length;for(var i in this)i===String(parseInt(i,10))&&delete this[i];for(i=0;i<this._items.length;i++)this[i]=this._items[i]}},cleanInterface)for(var i in{indexOf:!1,push:!1,splice:!1})Object.defineProperty(StringList.prototype,i,{enumerable:!1});idbModules.util.callback=callback,idbModules.util.StringList=StringList,idbModules.util.quote=function(arg){return'"'+arg+'"'}}(idbModules),function(idbModules){var Sca=function(){return{decycle:function(object,callback){function checkForCompletion(){0===queuedObjects.length&&returnCallback(derezObj)}function readBlobAsDataURL(blob,path){var reader=new FileReader;reader.onloadend=function(loadedEvent){var dataURL=loadedEvent.target.result,blobtype="Blob";updateEncodedBlob(dataURL,path,blobtype)},reader.readAsDataURL(blob)}function updateEncodedBlob(dataURL,path,blobtype){var encoded=queuedObjects.indexOf(path);path=path.replace("$","derezObj"),eval(path+'.$enc="'+dataURL+'"'),eval(path+'.$type="'+blobtype+'"'),queuedObjects.splice(encoded,1),checkForCompletion()}function derez(value,path){var i,name,nu;if(!("object"!=typeof value||null===value||value instanceof Boolean||value instanceof Date||value instanceof Number||value instanceof RegExp||value instanceof Blob||value instanceof String)){for(i=0;i<objects.length;i+=1)if(objects[i]===value)return{$ref:paths[i]};if(objects.push(value),paths.push(path),"[object Array]"===Object.prototype.toString.apply(value))for(nu=[],i=0;i<value.length;i+=1)nu[i]=derez(value[i],path+"["+i+"]");else{nu={};for(name in value)Object.prototype.hasOwnProperty.call(value,name)&&(nu[name]=derez(value[name],path+"["+JSON.stringify(name)+"]"))}return nu}return value instanceof Blob?(queuedObjects.push(path),readBlobAsDataURL(value,path)):value instanceof Boolean?value={$type:"Boolean",$enc:value.toString()}:value instanceof Date?value={$type:"Date",$enc:value.getTime()}:value instanceof Number?value={$type:"Number",$enc:value.toString()}:value instanceof RegExp?value={$type:"RegExp",$enc:value.toString()}:"number"==typeof value?value={$type:"number",$enc:value+""}:void 0===value&&(value={$type:"undefined"}),value}var objects=[],paths=[],queuedObjects=[],returnCallback=callback,derezObj=derez(object,"$");checkForCompletion()},retrocycle:function retrocycle($){function dataURLToBlob(dataURL){var BASE64_MARKER=";base64,",contentType,parts,raw;if(-1===dataURL.indexOf(BASE64_MARKER))return parts=dataURL.split(","),contentType=parts[0].split(":")[1],raw=parts[1],new Blob([raw],{type:contentType});parts=dataURL.split(BASE64_MARKER),contentType=parts[0].split(":")[1],raw=window.atob(parts[1]);for(var rawLength=raw.length,uInt8Array=new Uint8Array(rawLength),i=0;rawLength>i;++i)uInt8Array[i]=raw.charCodeAt(i);return new Blob([uInt8Array.buffer],{type:contentType})}function rez(value){var i,item,name,path;if(value&&"object"==typeof value)if("[object Array]"===Object.prototype.toString.apply(value))for(i=0;i<value.length;i+=1)item=value[i],item&&"object"==typeof item&&(path=item.$ref,value[i]="string"==typeof path&&px.test(path)?eval(path):rez(item));else if(void 0!==value.$type)switch(value.$type){case"Blob":case"File":value=dataURLToBlob(value.$enc);break;case"Boolean":value=Boolean("true"===value.$enc);break;case"Date":value=new Date(value.$enc);break;case"Number":value=Number(value.$enc);break;case"RegExp":value=eval(value.$enc);break;case"number":value=parseFloat(value.$enc);break;case"undefined":value=void 0}else for(name in value)"object"==typeof value[name]&&(item=value[name],item&&(path=item.$ref,value[name]="string"==typeof path&&px.test(path)?eval(path):rez(item)));return value}var px=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;return rez($)},encode:function(val,callback){function finishEncode(val){callback(JSON.stringify(val))}this.decycle(val,finishEncode)},decode:function(val){return this.retrocycle(JSON.parse(val))}}}();idbModules.Sca=Sca}(idbModules),function(idbModules){function validateKey(key){var type=typeof key;if("string"===type||"number"===type&&!isNaN(key)||key instanceof Date);else{if(!(key instanceof Array))throw idbModules.util.createDOMException("DataError","Not a valid key");for(var i=0;i<key.length;i++)validateKey(key[i])}}function getKeyPath(value,keyPath){try{return eval("value."+keyPath)}catch(e){return void 0}}function setKeyPath(value,keyPath,key){for(var props=keyPath.split("."),i=0;i<props.length-1;i++){var prop=props[i];value=value[prop]=value[prop]||{}}value[props[props.length-1]]=key}var collations=["","number","string","boolean","object","undefined"],getGenericEncoder=function(){return{encode:function(key){return collations.indexOf(typeof key)+"-"+JSON.stringify(key)},decode:function(key){return"undefined"==typeof key?void 0:JSON.parse(key.substring(2))}}},types={"boolean":getGenericEncoder(),object:getGenericEncoder(),number:{encode:function(key){return collations.indexOf("number")+"-"+key},decode:function(key){return parseFloat(key.substring(2))}},string:{encode:function(key){return collations.indexOf("string")+"-"+key},decode:function(key){return""+key.substring(2)}},undefined:{encode:function(key){return collations.indexOf("undefined")+"-undefined"},decode:function(key){return void 0}}};idbModules.Key={encode:function(key){return types[typeof key].encode(key)},encodeKey:function(key){return validateKey(key),types[typeof key].encode(key)},decode:function(key){return types[collations[key.substring(0,1)]].decode(key)},validateKey:validateKey,getKeyPath:getKeyPath,setKeyPath:setKeyPath}}(idbModules),function(idbModules){function createNativeEvent(type,debug){var event=new window.Event(type);return event.debug=debug,Object.defineProperty(event,"target",{writable:!0}),event}function ShimEvent(type,debug){this.type=type,this.debug=debug,this.bubbles=!1,this.cancelable=!1,this.eventPhase=0,this.timeStamp=(new Date).valueOf()
}var useNativeEvent=!1;try{var test=createNativeEvent("test type","test debug"),target={test:"test target"};test.target=target,test instanceof window.Event&&"test type"===test.type&&"test debug"===test.debug&&test.target===target&&(useNativeEvent=!0)}catch(e){}useNativeEvent?(idbModules.Event=window.Event,idbModules.IDBVersionChangeEvent=window.Event,idbModules.util.createEvent=createNativeEvent):(idbModules.Event=ShimEvent,idbModules.IDBVersionChangeEvent=ShimEvent,idbModules.util.createEvent=function(type,debug){return new ShimEvent(type,debug)})}(idbModules),function(idbModules){function createNativeDOMException(name,message){var e=new DOMException.prototype.constructor(0,message);return e.name=name||"DOMException",e.message=message,e}function createNativeDOMError(name,message){name=name||"DOMError";var e=new DOMError(name,message);return e.name===name||(e.name=name),e.message===message||(e.message=message),e}function createError(name,message){var e=new Error(message);return e.name=name||"DOMException",e.message=message,e}function logError(name,message,error){var method}var test,useNativeDOMException=!1,useNativeDOMError=!1;try{test=createNativeDOMException("test name","test message"),test instanceof DOMException&&"test name"===test.name&&"test message"===test.message&&(useNativeDOMException=!0)}catch(e){}try{test=createNativeDOMError("test name","test message"),test instanceof DOMError&&"test name"===test.name&&"test message"===test.message&&(useNativeDOMError=!0)}catch(e){}idbModules.util.logError=logError,useNativeDOMException?(idbModules.DOMException=DOMException,idbModules.util.createDOMException=function(name,message,error){return logError(name,message,error),createNativeDOMException(name,message)}):(idbModules.DOMException=Error,idbModules.util.createDOMException=function(name,message,error){return logError(name,message,error),createError(name,message)}),useNativeDOMError?(idbModules.DOMError=DOMError,idbModules.util.createDOMError=function(name,message,error){return logError(name,message,error),createNativeDOMError(name,message)}):(idbModules.DOMError=Error,idbModules.util.createDOMError=function(name,message,error){return logError(name,message,error),createError(name,message)})}(idbModules),function(idbModules){function IDBRequest(){this.onsuccess=this.onerror=this.result=this.error=this.source=this.transaction=null,this.readyState="pending"}function IDBOpenDBRequest(){this.onblocked=this.onupgradeneeded=null}IDBOpenDBRequest.prototype=new IDBRequest,IDBOpenDBRequest.prototype.constructor=IDBOpenDBRequest,idbModules.IDBRequest=IDBRequest,idbModules.IDBOpenDBRequest=IDBOpenDBRequest}(idbModules),function(idbModules,undefined){function IDBKeyRange(lower,upper,lowerOpen,upperOpen){this.lower=lower,this.upper=upper,this.lowerOpen=lowerOpen,this.upperOpen=upperOpen}IDBKeyRange.only=function(value){return new IDBKeyRange(value,value,!1,!1)},IDBKeyRange.lowerBound=function(value,open){return new IDBKeyRange(value,undefined,open,undefined)},IDBKeyRange.upperBound=function(value,open){return new IDBKeyRange(undefined,value,undefined,open)},IDBKeyRange.bound=function(lower,upper,lowerOpen,upperOpen){return new IDBKeyRange(lower,upper,lowerOpen,upperOpen)},idbModules.IDBKeyRange=IDBKeyRange}(idbModules),function(idbModules,undefined){function IDBCursor(range,direction,store,cursorRequest,keyColumnName,valueColumnName){if(!range||range instanceof idbModules.IDBKeyRange||(range=new idbModules.IDBKeyRange(range,range,!1,!1)),this.__range=range,this.__req=cursorRequest,this.source=store,this.key=undefined,this.direction=direction,this.__keyColumnName=keyColumnName,this.__valueColumnName=valueColumnName,this.__valueDecoder="value"===valueColumnName?idbModules.Sca:idbModules.Key,!this.source.transaction.__active)throw idbModules.util.createDOMException("TransactionInactiveError","The transaction this IDBObjectStore belongs to is not active.");this.__offset=-1,this.__lastKeyContinued=undefined,this["continue"]()}IDBCursor.prototype.__find=function(key,tx,success,error,recordsToLoad){recordsToLoad=recordsToLoad||1;var me=this,sql=["SELECT * FROM ",idbModules.util.quote(me.source.name)],sqlValues=[];sql.push("WHERE ",me.__keyColumnName," NOT NULL"),!me.__range||me.__range.lower===undefined&&me.__range.upper===undefined||(sql.push("AND"),me.__range.lower!==undefined&&(sql.push(me.__keyColumnName+(me.__range.lowerOpen?" >":" >= ")+" ?"),sqlValues.push(idbModules.Key.encode(me.__range.lower))),me.__range.lower!==undefined&&me.__range.upper!==undefined&&sql.push("AND"),me.__range.upper!==undefined&&(sql.push(me.__keyColumnName+(me.__range.upperOpen?" < ":" <= ")+" ?"),sqlValues.push(idbModules.Key.encode(me.__range.upper)))),"undefined"!=typeof key&&(me.__lastKeyContinued=key,me.__offset=0),me.__lastKeyContinued!==undefined&&(sql.push("AND "+me.__keyColumnName+" >= ?"),sqlValues.push(idbModules.Key.encode(me.__lastKeyContinued)));var direction="prev"===me.direction||"prevunique"===me.direction?"DESC":"ASC";sql.push("ORDER BY ",me.__keyColumnName," "+direction),sql.push("LIMIT "+recordsToLoad+" OFFSET "+me.__offset),me.__prefetchedData=null,tx.executeSql(sql.join(" "),sqlValues,function(tx,data){data.rows.length>1?(me.__prefetchedData=data.rows,me.__prefetchedIndex=0,me.__decode(data.rows.item(0),success)):1===data.rows.length?me.__decode(data.rows.item(0),success):success(undefined,undefined)},function(tx,data){error(data)})},IDBCursor.prototype.__decode=function(rowItem,callback){var key=idbModules.Key.decode(rowItem[this.__keyColumnName]),val=this.__valueDecoder.decode(rowItem[this.__valueColumnName]),primaryKey=idbModules.Key.decode(rowItem.key);callback(key,val,primaryKey)},IDBCursor.prototype["continue"]=function(key){var recordsToPreloadOnContinue=idbModules.cursorPreloadPackSize||1e3,me=this;this.source.transaction.__addToTransactionQueue(function cursorContinue(tx,args,success,error){me.__offset++;var successCallback=function(key,val,primaryKey){me.key=key,me.value=val,me.primaryKey=primaryKey,success("undefined"!=typeof me.key?me:undefined,me.__req)};return me.__prefetchedData&&(me.__prefetchedIndex++,me.__prefetchedIndex<me.__prefetchedData.length)?void me.__decode(me.__prefetchedData.item(me.__prefetchedIndex),successCallback):void me.__find(key,tx,successCallback,error,recordsToPreloadOnContinue)})},IDBCursor.prototype.advance=function(count){if(0>=count)throw idbModules.util.createDOMException("Type Error","Count is invalid - 0 or negative",count);var me=this;this.source.transaction.__addToTransactionQueue(function cursorAdvance(tx,args,success,error){me.__offset+=count,me.__find(undefined,tx,function(key,value){me.key=key,me.value=value,success("undefined"!=typeof me.key?me:undefined,me.__req)},error)})},IDBCursor.prototype.update=function(valueToUpdate){var me=this;me.source.transaction.__assertWritable();var request=this.source.transaction.__createRequest();return idbModules.Sca.encode(valueToUpdate,function(encoded){me.source.transaction.__pushToQueue(request,function cursorUpdate(tx,args,success,error){me.__find(undefined,tx,function(key,value,primaryKey){for(var store=me.source,params=[encoded],sql="UPDATE "+idbModules.util.quote(store.name)+" SET value = ?",i=0;i<store.indexNames.length;i++){var index=store.__indexes[store.indexNames[i]];sql+=", "+index.name+" = ?",params.push(idbModules.Key.encode(idbModules.Key.getKeyPath(valueToUpdate,index.keyPath)))}sql+=" WHERE key = ?",params.push(idbModules.Key.encode(primaryKey)),tx.executeSql(sql,params,function(tx,data){me.__prefetchedData=null,1===data.rowsAffected?success(key):error("No rows with key found"+key)},function(tx,data){error(data)})},error)})}),request},IDBCursor.prototype["delete"]=function(){var me=this;return me.source.transaction.__assertWritable(),this.source.transaction.__addToTransactionQueue(function cursorDelete(tx,args,success,error){me.__find(undefined,tx,function(key,value,primaryKey){var sql="DELETE FROM  "+idbModules.util.quote(me.source.name)+" WHERE key = ?";tx.executeSql(sql,[idbModules.Key.encode(primaryKey)],function(tx,data){me.__prefetchedData=null,1===data.rowsAffected?(me.__offset--,success(undefined)):error("No rows with key found"+key)},function(tx,data){error(data)})},error)})},idbModules.IDBCursor=IDBCursor}(idbModules),function(idbModules,undefined){function IDBIndex(store,indexProperties){this.objectStore=store,this.name=indexProperties.columnName,this.keyPath=indexProperties.keyPath,this.multiEntry=indexProperties.optionalParams&&indexProperties.optionalParams.multiEntry,this.unique=indexProperties.optionalParams&&indexProperties.optionalParams.unique}IDBIndex.__createIndex=function(store,index){store.__indexes[index.name]=index,store.indexNames.push(index.name);var transaction=store.transaction;transaction.__addToTransactionQueue(function createIndex(tx,args,success,failure){function error(tx,err){failure(idbModules.util.createDOMException(0,'Could not create index "'+index.name+'"',err))}var sql=["ALTER TABLE",idbModules.util.quote(store.name),"ADD",idbModules.util.quote(index.name),"BLOB"].join(" ");tx.executeSql(sql,[],function(tx,data){tx.executeSql("SELECT * FROM "+idbModules.util.quote(store.name),[],function(tx,data){function initIndexForRow(i){if(i<data.rows.length)try{var value=idbModules.Sca.decode(data.rows.item(i).value),indexKey=idbModules.Key.getKeyPath(value,index.keyPath);tx.executeSql("UPDATE "+idbModules.util.quote(store.name)+" set "+idbModules.util.quote(index.name)+" = ? where key = ?",[idbModules.Key.encode(indexKey),data.rows.item(i).key],function(tx,data){initIndexForRow(i+1)},error)}catch(e){initIndexForRow(i+1)}else updateObjectStoreSchema()}function updateObjectStoreSchema(){for(var indexList={},i=0;i<store.indexNames.length;i++){var idx=store.__indexes[store.indexNames[i]];indexList[idx.name]={columnName:idx.name,keyPath:idx.keyPath,optionalParams:{unique:idx.unique,multiEntry:idx.multiEntry}}}tx.executeSql("UPDATE __sys__ set indexList = ? where name = ?",[JSON.stringify(indexList),store.name],function(){success(index)},error)}initIndexForRow(0)},error)},error)})},IDBIndex.__deleteIndex=function(store,index){store.__indexes[index.name]=undefined,store.indexNames.splice(store.indexNames.indexOf(index.name),1)},IDBIndex.prototype.__fetchIndexData=function(key,opType){var me=this,hasKey;return 1===arguments.length?(opType=key,key=undefined,hasKey=!1):(key=idbModules.Key.encodeKey(key),hasKey=!0),me.objectStore.transaction.__addToTransactionQueue(function fetchIndexData(tx,args,success,error){var sql=["SELECT * FROM ",idbModules.util.quote(me.objectStore.name)," WHERE",idbModules.util.quote(me.name),"NOT NULL"],sqlValues=[];hasKey&&(sql.push("AND",idbModules.util.quote(me.name)," = ?"),sqlValues.push(key)),tx.executeSql(sql.join(" "),sqlValues,function(tx,data){var d;d="count"===opType?data.rows.length:0===data.rows.length?undefined:"key"===opType?idbModules.Key.decode(data.rows.item(0).key):idbModules.Sca.decode(data.rows.item(0).value),success(d)},error)})},IDBIndex.prototype.openCursor=function(range,direction){var cursorRequest=new idbModules.IDBRequest,cursor=new idbModules.IDBCursor(range,direction,this.objectStore,cursorRequest,this.name,"value");return cursorRequest},IDBIndex.prototype.openKeyCursor=function(range,direction){var cursorRequest=new idbModules.IDBRequest,cursor=new idbModules.IDBCursor(range,direction,this.objectStore,cursorRequest,this.name,"key");return cursorRequest},IDBIndex.prototype.get=function(key){if(0===arguments.length)throw new TypeError("No key was specified");return this.__fetchIndexData(key,"value")},IDBIndex.prototype.getKey=function(key){if(0===arguments.length)throw new TypeError("No key was specified");return this.__fetchIndexData(key,"key")},IDBIndex.prototype.count=function(key){return 0===arguments.length?this.__fetchIndexData("count"):this.__fetchIndexData(key,"count")},idbModules.IDBIndex=IDBIndex}(idbModules),function(idbModules){function IDBObjectStore(storeProperties,transaction){this.name=storeProperties.name,this.keyPath=storeProperties.keyPath||null,this.autoIncrement="string"==typeof storeProperties.autoInc?"true"===storeProperties.autoInc:!!storeProperties.autoInc,this.transaction=transaction,this.__indexes={},this.indexNames=new idbModules.util.StringList;var indexList="object"==typeof storeProperties.indexList?storeProperties.indexList:JSON.parse(storeProperties.indexList);for(var indexName in indexList)if(indexList.hasOwnProperty(indexName)){var index=new idbModules.IDBIndex(this,indexList[indexName]);this.__indexes[index.name]=index,this.indexNames.push(index.name)}}IDBObjectStore.__createObjectStore=function(db,store){db.__objectStores[store.name]=store,db.objectStoreNames.push(store.name);var transaction=db.__versionTransaction;idbModules.IDBTransaction.__assertVersionChange(transaction),transaction.__addToTransactionQueue(function createObjectStore(tx,args,success,failure){function error(tx,err){throw idbModules.util.createDOMException(0,'Could not create object store "'+store.name+'"',err)}var sql=["CREATE TABLE",idbModules.util.quote(store.name),"(key BLOB",store.autoIncrement?"UNIQUE, inc INTEGER PRIMARY KEY AUTOINCREMENT":"PRIMARY KEY",", value BLOB)"].join(" ");tx.executeSql(sql,[],function(tx,data){tx.executeSql("INSERT INTO __sys__ VALUES (?,?,?,?)",[store.name,store.keyPath,store.autoIncrement,"{}"],function(){success(store)},error)},error)})},IDBObjectStore.__deleteObjectStore=function(db,store){db.__objectStores[store.name]=void 0,db.objectStoreNames.splice(db.objectStoreNames.indexOf(store.name),1);var transaction=db.__versionTransaction;idbModules.IDBTransaction.__assertVersionChange(transaction),transaction.__addToTransactionQueue(function deleteObjectStore(tx,args,success,failure){function error(tx,err){failure(idbModules.util.createDOMException(0,"Could not delete ObjectStore",err))}db.__db.transaction(function(tx){tx.executeSql("SELECT * FROM __sys__ where name = ?",[store.name],function(tx,data){data.rows.length>0&&tx.executeSql("DROP TABLE "+idbModules.util.quote(store.name),[],function(){tx.executeSql("DELETE FROM __sys__ WHERE name = ?",[store.name],function(){success()},error)},error)})})})},IDBObjectStore.prototype.__validateKey=function(value,key){if(this.keyPath){if("undefined"!=typeof key)throw idbModules.util.createDOMException("DataError","The object store uses in-line keys and the key parameter was provided",this);if(!value||"object"!=typeof value)throw idbModules.util.createDOMException("DataError","KeyPath was specified, but value was not an object");if(key=idbModules.Key.getKeyPath(value,this.keyPath),void 0===key){if(this.autoIncrement)return;throw idbModules.util.createDOMException("DataError","Could not eval key from keyPath")}}else if("undefined"==typeof key){if(this.autoIncrement)return;throw idbModules.util.createDOMException("DataError","The object store uses out-of-line keys and has no key generator and the key parameter was not provided. ",this)}idbModules.Key.validateKey(key)},IDBObjectStore.prototype.__deriveKey=function(tx,value,key,success,failure){function getNextAutoIncKey(callback){tx.executeSql("SELECT * FROM sqlite_sequence where name like ?",[me.name],function(tx,data){callback(1!==data.rows.length?1:data.rows.item(0).seq+1)},function(tx,error){failure(idbModules.util.createDOMException("DataError","Could not get the auto increment value for key",error))})}var me=this;if(me.keyPath){var primaryKey=idbModules.Key.getKeyPath(value,me.keyPath);void 0===primaryKey&&me.autoIncrement?getNextAutoIncKey(function(primaryKey){try{idbModules.Key.setKeyPath(value,me.keyPath,primaryKey),success(primaryKey)}catch(e){failure(idbModules.util.createDOMException("DataError","Could not assign a generated value to the keyPath",e))}}):success(primaryKey)}else"undefined"==typeof key&&me.autoIncrement?getNextAutoIncKey(success):success(key)},IDBObjectStore.prototype.__insertData=function(tx,encoded,value,primaryKey,success,error){try{var paramMap={};"undefined"!=typeof primaryKey&&(paramMap.key=idbModules.Key.encodeKey(primaryKey));for(var i=0;i<this.indexNames.length;i++){var index=this.__indexes[this.indexNames[i]];paramMap[index.name]=idbModules.Key.encode(idbModules.Key.getKeyPath(value,index.keyPath))}var sqlStart=["INSERT INTO ",idbModules.util.quote(this.name),"("],sqlEnd=[" VALUES ("],sqlValues=[];for(var key in paramMap)sqlStart.push(idbModules.util.quote(key)+","),sqlEnd.push("?,"),sqlValues.push(paramMap[key]);sqlStart.push("value )"),sqlEnd.push("?)"),sqlValues.push(encoded);var sql=sqlStart.join(" ")+sqlEnd.join(" ");tx.executeSql(sql,sqlValues,function(tx,data){idbModules.Sca.encode(primaryKey,function(primaryKey){primaryKey=idbModules.Sca.decode(primaryKey),success(primaryKey)})},function(tx,err){error(idbModules.util.createDOMError("ConstraintError",err.message,err))})}catch(e){error(e)}},IDBObjectStore.prototype.add=function(value,key){var me=this;if(0===arguments.length)throw new TypeError("No value was specified");this.__validateKey(value,key),me.transaction.__assertWritable();var request=me.transaction.__createRequest();return me.transaction.__pushToQueue(request,function objectStoreAdd(tx,args,success,error){me.__deriveKey(tx,value,key,function(primaryKey){idbModules.Sca.encode(value,function(encoded){me.__insertData(tx,encoded,value,primaryKey,success,error)})},error)}),request},IDBObjectStore.prototype.put=function(value,key){var me=this;if(0===arguments.length)throw new TypeError("No value was specified");this.__validateKey(value,key),me.transaction.__assertWritable();var request=me.transaction.__createRequest();return me.transaction.__pushToQueue(request,function objectStorePut(tx,args,success,error){me.__deriveKey(tx,value,key,function(primaryKey){idbModules.Sca.encode(value,function(encoded){var sql="DELETE FROM "+idbModules.util.quote(me.name)+" where key = ?";tx.executeSql(sql,[idbModules.Key.encode(primaryKey)],function(tx,data){me.__insertData(tx,encoded,value,primaryKey,success,error)},function(tx,err){error(err)})})},error)}),request},IDBObjectStore.prototype.get=function(key){var me=this;if(0===arguments.length)throw new TypeError("No key was specified");var primaryKey=idbModules.Key.encodeKey(key);return me.transaction.__addToTransactionQueue(function objectStoreGet(tx,args,success,error){tx.executeSql("SELECT * FROM "+idbModules.util.quote(me.name)+" where key = ?",[primaryKey],function(tx,data){var value;try{if(0===data.rows.length)return success();value=idbModules.Sca.decode(data.rows.item(0).value)}catch(e){}success(value)},function(tx,err){error(err)})})},IDBObjectStore.prototype["delete"]=function(key){var me=this;if(0===arguments.length)throw new TypeError("No key was specified");me.transaction.__assertWritable();var primaryKey=idbModules.Key.encodeKey(key);return me.transaction.__addToTransactionQueue(function objectStoreDelete(tx,args,success,error){tx.executeSql("DELETE FROM "+idbModules.util.quote(me.name)+" where key = ?",[primaryKey],function(tx,data){success()},function(tx,err){error(err)})})},IDBObjectStore.prototype.clear=function(){var me=this;return me.transaction.__assertWritable(),me.transaction.__addToTransactionQueue(function objectStoreClear(tx,args,success,error){tx.executeSql("DELETE FROM "+idbModules.util.quote(me.name),[],function(tx,data){success()},function(tx,err){error(err)})})},IDBObjectStore.prototype.count=function(key){var me=this,hasKey=!1;return arguments.length>0&&(hasKey=!0,key=idbModules.Key.encodeKey(key)),me.transaction.__addToTransactionQueue(function objectStoreCount(tx,args,success,error){var sql="SELECT * FROM "+idbModules.util.quote(me.name)+(hasKey?" WHERE key = ?":""),sqlValues=[];hasKey&&sqlValues.push(key),tx.executeSql(sql,sqlValues,function(tx,data){success(data.rows.length)},function(tx,err){error(err)})})},IDBObjectStore.prototype.openCursor=function(range,direction){var cursorRequest=new idbModules.IDBRequest,cursor=new idbModules.IDBCursor(range,direction,this,cursorRequest,"key","value");return cursorRequest},IDBObjectStore.prototype.index=function(indexName){if(0===arguments.length)throw new TypeError("No index name was specified");var index=this.__indexes[indexName];if(!index)throw idbModules.util.createDOMException("NotFoundError",'Index "'+indexName+'" does not exist on '+this.name);return index},IDBObjectStore.prototype.createIndex=function(indexName,keyPath,optionalParameters){if(0===arguments.length)throw new TypeError("No index name was specified");if(1===arguments.length)throw new TypeError("No key path was specified");if(this.__indexes[indexName])throw idbModules.util.createDOMException("ConstraintError",'Index "'+indexName+'" already exists on '+this.name);this.transaction.__assertVersionChange(),optionalParameters=optionalParameters||{};var indexProperties={columnName:indexName,keyPath:keyPath,optionalParams:{unique:!!optionalParameters.unique,multiEntry:!!optionalParameters.multiEntry}},index=new idbModules.IDBIndex(this,indexProperties);return idbModules.IDBIndex.__createIndex(this,index),index},IDBObjectStore.prototype.deleteIndex=function(indexName){if(0===arguments.length)throw new TypeError("No index name was specified");var index=this.__indexes[indexName];if(!index)throw idbModules.util.createDOMException("NotFoundError",'Index "'+indexName+'" does not exist on '+this.name);this.transaction.__assertVersionChange(),idbModules.IDBIndex.__deleteIndex(this,index)},idbModules.IDBObjectStore=IDBObjectStore}(idbModules),function(idbModules){function IDBTransaction(db,storeNames,mode){this.__active=!0,this.__running=!1,this.__requests=[],this.__storeNames=storeNames,this.mode=mode,this.db=db,this.error=null,this.onabort=this.onerror=this.oncomplete=null;var me=this;setTimeout(function(){me.__executeRequests()},0)}IDBTransaction.prototype.__executeRequests=function(){function transactionError(err){try{idbModules.util.logError("Error","An error occurred in a transaction",err),me.error=err;var evt=idbModules.util.createEvent("error");idbModules.util.callback("onerror",me,evt)}finally{me.abort()}}function transactionFinished(){var evt=idbModules.util.createEvent("complete");idbModules.util.callback("oncomplete",me,evt),idbModules.util.callback("__oncomplete",me,evt)}if(!this.__running){this.__running=!0;var me=this;me.db.__db.transaction(function executeRequests(tx){function success(result,req){req&&(q.req=req),q.req.readyState="done",q.req.result=result,delete q.req.error;var e=idbModules.util.createEvent("success");idbModules.util.callback("onsuccess",q.req,e),i++,executeNextRequest()}function error(tx,err){1===arguments.length&&(err=tx);try{q.req.readyState="done",q.req.error=err||"DOMError";var e=idbModules.util.createEvent("error",err);idbModules.util.callback("onerror",q.req,e)}finally{transactionError(err)}}function executeNextRequest(){if(i>=me.__requests.length)me.__requests=[],me.__active&&(me.__active=!1,transactionFinished());else try{q=me.__requests[i],q.op(tx,q.args,success,error)}catch(e){error(e)}}me.__tx=tx;var q=null,i=0;executeNextRequest()},transactionError)}},IDBTransaction.prototype.__createRequest=function(){var request=new idbModules.IDBRequest;return request.source=this.db,request.transaction=this,request},IDBTransaction.prototype.__addToTransactionQueue=function(callback,args){var request=this.__createRequest();return this.__pushToQueue(request,callback,args),request},IDBTransaction.prototype.__pushToQueue=function(request,callback,args){this.__assertActive(),this.__requests.push({op:callback,args:args,req:request})},IDBTransaction.prototype.__assertActive=function(){if(!this.__active)throw idbModules.util.createDOMException("TransactionInactiveError","A request was placed against a transaction which is currently not active, or which is finished")},IDBTransaction.prototype.__assertWritable=function(){if(this.mode===IDBTransaction.READ_ONLY)throw idbModules.util.createDOMException("ReadOnlyError","The transaction is read only")},IDBTransaction.prototype.__assertVersionChange=function(){IDBTransaction.__assertVersionChange(this)},IDBTransaction.__assertVersionChange=function(tx){if(!tx||tx.mode!==IDBTransaction.VERSION_CHANGE)throw idbModules.util.createDOMException("InvalidStateError","Not a version transaction")},IDBTransaction.prototype.objectStore=function(objectStoreName){if(0===arguments.length)throw new TypeError("No object store name was specified");if(!this.__active)throw idbModules.util.createDOMException("InvalidStateError","A request was placed against a transaction which is currently not active, or which is finished");if(-1===this.__storeNames.indexOf(objectStoreName)&&this.mode!==IDBTransaction.VERSION_CHANGE)throw idbModules.util.createDOMException("NotFoundError",objectStoreName+" is not participating in this transaction");var store=this.db.__objectStores[objectStoreName];if(!store)throw idbModules.util.createDOMException("NotFoundError",objectStoreName+" does not exist in "+this.db.name);return store.transaction=this,store},IDBTransaction.prototype.abort=function(){var me=this;me.__active=!1;var evt=idbModules.util.createEvent("abort");setTimeout(function(){idbModules.util.callback("onabort",me,evt)},0)},IDBTransaction.READ_ONLY="readonly",IDBTransaction.READ_WRITE="readwrite",IDBTransaction.VERSION_CHANGE="versionchange",idbModules.IDBTransaction=IDBTransaction}(idbModules),function(idbModules){function IDBDatabase(db,name,version,storeProperties){this.__db=db,this.__closed=!1,this.version=version,this.name=name,this.onabort=this.onerror=this.onversionchange=null,this.__objectStores={},this.objectStoreNames=new idbModules.util.StringList;for(var i=0;i<storeProperties.rows.length;i++){var store=new idbModules.IDBObjectStore(storeProperties.rows.item(i));this.__objectStores[store.name]=store,this.objectStoreNames.push(store.name)}}IDBDatabase.prototype.createObjectStore=function(storeName,createOptions){if(0===arguments.length)throw new TypeError("No object store name was specified");if(this.__objectStores[storeName])throw idbModules.util.createDOMException("ConstraintError",'Object store "'+storeName+'" already exists in '+this.name);this.__versionTransaction.__assertVersionChange(),createOptions=createOptions||{};var storeProperties={name:storeName,keyPath:createOptions.keyPath||null,autoInc:!!createOptions.autoIncrement,indexList:{}},store=new idbModules.IDBObjectStore(storeProperties,this.__versionTransaction);return idbModules.IDBObjectStore.__createObjectStore(this,store),store},IDBDatabase.prototype.deleteObjectStore=function(storeName){if(0===arguments.length)throw new TypeError("No object store name was specified");var store=this.__objectStores[storeName];if(!store)throw idbModules.util.createDOMException("NotFoundError",'Object store "'+storeName+'" does not exist in '+this.name);this.__versionTransaction.__assertVersionChange(),idbModules.IDBObjectStore.__deleteObjectStore(this,store)},IDBDatabase.prototype.close=function(){this.__closed=!0},IDBDatabase.prototype.transaction=function(storeNames,mode){if(this.__closed)throw idbModules.util.createDOMException("InvalidStateError","An attempt was made to start a new transaction on a database connection that is not open");if(mode="number"==typeof mode?1===mode?IDBTransaction.READ_WRITE:IDBTransaction.READ_ONLY:mode||IDBTransaction.READ_ONLY,mode!==IDBTransaction.READ_ONLY&&mode!==IDBTransaction.READ_WRITE)throw new TypeError("Invalid transaction mode: "+mode);if(storeNames="string"==typeof storeNames?[storeNames]:storeNames,0===storeNames.length)throw idbModules.util.createDOMException("InvalidAccessError","No object store names were specified");for(var i=0;i<storeNames.length;i++)if(!this.objectStoreNames.contains(storeNames[i]))throw idbModules.util.createDOMException("NotFoundError",'The "'+storeNames[i]+'" object store does not exist');var transaction=new idbModules.IDBTransaction(this,storeNames,mode);return transaction},idbModules.IDBDatabase=IDBDatabase}(idbModules),function(idbModules){function IDBFactory(){this.Event=idbModules.Event,this.DOMException=idbModules.DOMException,this.DOMError=idbModules.DOMError}var DEFAULT_DB_SIZE=2097152,sysdb,isShimReady=!1,isReadyCallbacks,shimInitSuccess=!1;IDBFactory.prototype.loadShim=function(){window.openDatabase&&(sysdb=window.openDatabase("__sysdb__",1,"System Database",DEFAULT_DB_SIZE),sysdb.transaction(function(tx){tx.executeSql("CREATE TABLE IF NOT EXISTS dbVersions (name VARCHAR(255), version INT);",[],function(){this.notifyIsReady(!0)}.bind(this),function(){this.notifyIsReady(!1)}.bind(this))}.bind(this),function(){this.notifyIsReady(!1)}.bind(this)))},IDBFactory.prototype.notifyIsReady=function(success){if(isShimReady=!0,shimInitSuccess=success,isReadyCallbacks){for(var i=0;i<isReadyCallbacks.length;++i)isReadyCallbacks[i](shimInitSuccess);isReadyCallbacks=void 0}},IDBFactory.prototype.onIsReady=function(cb){isShimReady?setTimeout(function(){cb(shimInitSuccess)},0):isReadyCallbacks?isReadyCallbacks.push(cb):isReadyCallbacks=[cb]},IDBFactory.prototype.open=function(name,version){function dbCreateError(err){if(!calledDbCreateError){calledDbCreateError=!0;var evt=idbModules.util.createEvent("error",arguments);req.readyState="done",req.error=err||"DOMError",idbModules.util.callback("onerror",req,evt)}}function openDB(oldVersion){var db=window.openDatabase(name,1,name,DEFAULT_DB_SIZE);if(req.readyState="done","undefined"==typeof version&&(version=oldVersion||1),0>=version||oldVersion>version){var err=idbModules.util.createDOMError("VersionError","An attempt was made to open a database using a lower version than the existing version.",version);return void dbCreateError(err)}db.transaction(function(tx){tx.executeSql("CREATE TABLE IF NOT EXISTS __sys__ (name VARCHAR(255), keyPath VARCHAR(255), autoInc BOOLEAN, indexList BLOB)",[],function(){tx.executeSql("SELECT * FROM __sys__",[],function(tx,data){var e=idbModules.util.createEvent("success");req.source=req.result=new idbModules.IDBDatabase(db,name,version,data),version>oldVersion?sysdb.transaction(function(systx){systx.executeSql("UPDATE dbVersions set version = ? where name = ?",[version,name],function(){var e=idbModules.util.createEvent("upgradeneeded");e.oldVersion=oldVersion,e.newVersion=version,req.transaction=req.result.__versionTransaction=new idbModules.IDBTransaction(req.source,[],idbModules.IDBTransaction.VERSION_CHANGE),req.transaction.__addToTransactionQueue(function onupgradeneeded(tx,args,success){idbModules.util.callback("onupgradeneeded",req,e),success()}),req.transaction.__oncomplete=function(){req.transaction=null;var e=idbModules.util.createEvent("success");idbModules.util.callback("onsuccess",req,e)}},dbCreateError)},dbCreateError):idbModules.util.callback("onsuccess",req,e)},dbCreateError)},dbCreateError)},dbCreateError)}var req=new idbModules.IDBOpenDBRequest,calledDbCreateError=!1;if(0===arguments.length)throw new TypeError("Database name is required");if(2===arguments.length&&(version=parseFloat(version),isNaN(version)||!isFinite(version)||0>=version))throw new TypeError("Invalid database version: "+version);return name+="",sysdb.transaction(function(tx){tx.executeSql("SELECT * FROM dbVersions where name = ?",[name],function(tx,data){0===data.rows.length?tx.executeSql("INSERT INTO dbVersions VALUES (?,?)",[name,version||1],function(){openDB(0)},dbCreateError):openDB(data.rows.item(0).version)},dbCreateError)},dbCreateError),req},IDBFactory.prototype.deleteDatabase=function(name){function dbError(msg){if(!calledDBError){req.readyState="done",req.error="DOMError";var e=idbModules.util.createEvent("error");e.message=msg,e.debug=arguments,idbModules.util.callback("onerror",req,e),calledDBError=!0}}function deleteFromDbVersions(){sysdb.transaction(function(systx){systx.executeSql("DELETE FROM dbVersions where name = ? ",[name],function(){req.result=void 0;var e=idbModules.util.createEvent("success");e.newVersion=null,e.oldVersion=version,idbModules.util.callback("onsuccess",req,e)},dbError)},dbError)}var req=new idbModules.IDBOpenDBRequest,calledDBError=!1,version=null;
if(0===arguments.length)throw new TypeError("Database name is required");return name+="",sysdb.transaction(function(systx){systx.executeSql("SELECT * FROM dbVersions where name = ?",[name],function(tx,data){if(0===data.rows.length){req.result=void 0;var e=idbModules.util.createEvent("success");return e.newVersion=null,e.oldVersion=version,void idbModules.util.callback("onsuccess",req,e)}version=data.rows.item(0).version;var db=window.openDatabase(name,1,name,DEFAULT_DB_SIZE);db.transaction(function(tx){tx.executeSql("SELECT * FROM __sys__",[],function(tx,data){var tables=data.rows;!function deleteTables(i){i>=tables.length?tx.executeSql("DROP TABLE __sys__",[],function(){deleteFromDbVersions()},dbError):tx.executeSql("DROP TABLE "+idbModules.util.quote(tables.item(i).name),[],function(){deleteTables(i+1)},function(){deleteTables(i+1)})}(0)},function(e){deleteFromDbVersions()})},dbError)})},dbError),req},IDBFactory.prototype.cmp=function(key1,key2){return idbModules.Key.encodeKey(key1)>idbModules.Key.encodeKey(key2)?1:key1===key2?0:-1},idbModules.shimIndexedDB=new IDBFactory,idbModules.IDBFactory=IDBFactory}(idbModules),function(window,idbModules){function shim(name,value){try{window[name]=value}catch(e){}if(window[name]!==value&&Object.defineProperty){try{Object.defineProperty(window,name,{value:value})}catch(e){}window[name]!==value&&window.console&&console.warn&&console.warn("Unable to shim "+name)}}"undefined"!=typeof window.openDatabase&&(shim("shimIndexedDB",idbModules.shimIndexedDB),window.shimIndexedDB&&(window.shimIndexedDB.__useShim=function(){try{window.shimIndexedDB.loadShim(),shim("dbProvider",idbModules.shimIndexedDB),shim("IDBFactory",idbModules.IDBFactory),shim("IDBDatabase",idbModules.IDBDatabase),shim("IDBObjectStore",idbModules.IDBObjectStore),shim("IDBIndex",idbModules.IDBIndex),shim("IDBTransaction",idbModules.IDBTransaction),shim("IDBCursor",idbModules.IDBCursor),shim("IDBKeyRange",idbModules.IDBKeyRange),shim("IDBRequest",idbModules.IDBRequest),shim("IDBOpenDBRequest",idbModules.IDBOpenDBRequest),shim("IDBVersionChangeEvent",idbModules.IDBVersionChangeEvent)}catch(err){console.log("Error loading SQL shim")}})),window.dbProvider=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.oIndexedDB||window.msIndexedDB;var poorIndexedDbSupport=!1;(navigator.userAgent.match(/Android 2/)||navigator.userAgent.match(/Android 3/)||navigator.userAgent.match(/Android 4\.[0-3]/))&&(navigator.userAgent.match(/Chrome/)||(poorIndexedDbSupport=!0));var forceSQL=window.location.hash.indexOf("forcesql=true")>=0;if(forceSQL||("undefined"==typeof window.indexedDB||null===window.indexedDB||poorIndexedDbSupport)&&"undefined"!=typeof window.openDatabase)window.shimIndexedDB.__useShim();else{window.IDBDatabase=window.IDBDatabase||window.webkitIDBDatabase,window.IDBTransaction=window.IDBTransaction||window.webkitIDBTransaction,window.IDBCursor=window.IDBCursor||window.webkitIDBCursor,window.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,window.IDBTransaction||(window.IDBTransaction={});try{window.IDBTransaction.READ_ONLY=window.IDBTransaction.READ_ONLY||"readonly",window.IDBTransaction.READ_WRITE=window.IDBTransaction.READ_WRITE||"readwrite"}catch(e){}}}(window,idbModules),define("IndexedDBShim",function(){}),define("database",["IndexedDBShim"],function(idbpoly){var dbProvider=window.dbProvider,IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,transactionModes={readonly:"readonly",readwrite:"readwrite"},hasOwn=Object.prototype.hasOwnProperty;if(!dbProvider)return void console.log("IndexedDB is not available");var defaultMapper=function(value){return value},CallbackList=function(){var state,list=[],exec=function(context,args){if(list){args=args||[],state=state||[context,args];for(var i=0,il=list.length;il>i;i++)list[i].apply(state[0],state[1]);list=[]}};this.add=function(){for(var i=0,il=arguments.length;il>i;i++)list.push(arguments[i]);return state&&exec(),this},this.execute=function(){return exec(this,arguments),this}},Deferred=function(func){var state="progress",actions=[["resolve","done",new CallbackList,"resolved"],["reject","fail",new CallbackList,"rejected"],["notify","progress",new CallbackList]],deferred={},promise={state:function(){return state},then:function(){var handlers=arguments;return Deferred(function(newDefer){actions.forEach(function(action,i){var handler=handlers[i];deferred[action[1]]("function"==typeof handler?function(){var returned=handler.apply(this,arguments);returned&&"function"==typeof returned.promise&&returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)}:newDefer[action[0]])})}).promise()},promise:function(obj){return obj?(Object.keys(promise).forEach(function(key){obj[key]=promise[key]}),obj):promise}};return actions.forEach(function(action,i){var list=action[2],actionState=action[3];promise[action[1]]=list.add,actionState&&list.add(function(){state=actionState}),deferred[action[0]]=list.execute}),promise.promise(deferred),func&&func.call(deferred,deferred),deferred},Server=function(db,name){var that=this,closed=!1;this.add=function(table){if(closed)throw"Database has been closed";for(var records=[],counter=0,i=0;i<arguments.length-1;i++)if(Array.isArray(arguments[i+1]))for(var j=0;j<arguments[i+1].length;j++)records[counter]=arguments[i+1][j],counter++;else records[counter]=arguments[i+1],counter++;var transaction=db.transaction(table,transactionModes.readwrite),store=transaction.objectStore(table),deferred=Deferred();return records.forEach(function(record){var req;if(record.item&&record.key){var key=record.key;record=record.item,req=store.add(record,key)}else req=store.add(record);req.onsuccess=function(e){var target=e.target,keyPath=target.source.keyPath;null===keyPath&&(keyPath="__id__"),Object.defineProperty(record,keyPath,{value:target.result,enumerable:!0}),deferred.notify()}}),transaction.oncomplete=function(){deferred.resolve(records,that)},transaction.onerror=function(e){deferred.reject(records,e)},transaction.onabort=function(e){deferred.reject(records,e)},deferred.promise()},this.update=function(table){if(closed)throw"Database has been closed";for(var records=[],i=0;i<arguments.length-1;i++)records[i]=arguments[i+1];var transaction=db.transaction(table,transactionModes.readwrite),store=transaction.objectStore(table),deferred=Deferred();return records.forEach(function(record){var req;if(record.item&&record.key){var key=record.key;record=record.item,req=store.put(record,key)}else req=store.put(record);req.onsuccess=function(e){deferred.notify()}}),transaction.oncomplete=function(){deferred.resolve(records,that)},transaction.onerror=function(e){deferred.reject(records,e)},transaction.onabort=function(e){deferred.reject(records,e)},deferred.promise()},this.updateObject=function(table){if(closed)throw"Database has been closed";var transaction=db.transaction(table,transactionModes.readwrite),store=transaction.objectStore(table),deferred=Deferred(),records=arguments[1];for(var id in records)store.put(records[id]);return transaction.oncomplete=function(){deferred.resolve(records,that)},transaction.onerror=function(e){deferred.reject(records,e)},transaction.onabort=function(e){deferred.reject(records,e)},deferred.promise()},this.remove=function(table,key){if(closed)throw"Database has been closed";var transaction=db.transaction(table,transactionModes.readwrite),store=transaction.objectStore(table),deferred=Deferred(),req=store.delete(key);return transaction.oncomplete=function(){deferred.resolve(key)},transaction.onerror=function(e){deferred.reject(e)},deferred.promise()},this.clear=function(table){if(closed)throw"Database has been closed";var transaction=db.transaction(table,transactionModes.readwrite),store=transaction.objectStore(table),deferred=Deferred(),req=store.clear();return transaction.oncomplete=function(){deferred.resolve()},transaction.onerror=function(e){deferred.reject(e)},deferred.promise()},this.close=function(){if(closed)throw"Database has been closed";db.close(),closed=!0,delete dbCache[name]},this.get=function(table,id){if(closed)throw"Database has been closed";var transaction=db.transaction(table),store=transaction.objectStore(table),deferred=Deferred(),req=store.get(id);return req.onsuccess=function(e){deferred.resolve(e.target.result)},transaction.onerror=function(e){deferred.reject(e)},deferred.promise()},this.query=function(table,index){if(closed)throw"Database has been closed";return new IndexQuery(table,db,index)};for(var i=0,il=db.objectStoreNames.length;il>i;i++)!function(storeName){that[storeName]={};for(var i in that)hasOwn.call(that,i)&&"close"!==i&&(that[storeName][i]=function(i){return function(){var args=[storeName].concat([].slice.call(arguments,0));return that[i].apply(that,args)}}(i))}(db.objectStoreNames[i])},IndexQuery=function(table,db,indexName){var that=this,modifyObj=!1,runQuery=function(type,args,cursorType,direction,limitRange,filters,mapper){var transaction=db.transaction(table,modifyObj?transactionModes.readwrite:transactionModes.readonly),store=transaction.objectStore(table),index=indexName?store.index(indexName):store,keyRange=type?IDBKeyRange[type].apply(null,args):null,results=[],deferred=Deferred(),indexArgs=[keyRange],limitRange=limitRange?limitRange:null,filters=filters?filters:void 0,counter=0;"count"!==cursorType&&indexArgs.push(direction||"next");var modifyKeys=modifyObj?Object.keys(modifyObj):!1,modifyRecord=function(record){for(var i=0;i<modifyKeys.length;i++){var key=modifyKeys[i],val=modifyObj[key];val instanceof Function&&(val=val(record)),record[key]=val}return record};return index[cursorType].apply(index,indexArgs).onsuccess=function(e){var cursor=e.target.result;if("number"==typeof cursor)results=cursor;else if(cursor)if(null!==limitRange&&limitRange[0]>counter)counter=limitRange[0],cursor.advance(limitRange[0]);else if(null!==limitRange&&counter>=limitRange[0]+limitRange[1]);else{var matchFilter=!0,result="value"in cursor?cursor.value:cursor.key;filters&&filters.forEach(function(filter){filter&&filter.length&&(matchFilter=2===filter.length?result[filter[0]]===filter[1]:filter[0].apply(void 0,[result]))}),matchFilter&&(counter++,results.push(mapper(result)),modifyObj&&(result=modifyRecord(result),cursor.update(result))),cursor.continue()}},transaction.oncomplete=function(){deferred.resolve(results)},transaction.onerror=function(e){deferred.reject(e)},transaction.onabort=function(e){deferred.reject(e)},deferred.promise()},Query=function(type,args){var direction="next",cursorType="openCursor",filters=[],limitRange=null,mapper=defaultMapper,unique=!1,execute=function(){return runQuery(type,args,cursorType,unique?direction+"unique":direction,limitRange,filters,mapper)},limit=function(){return limitRange=Array.prototype.slice.call(arguments,0,2),1==limitRange.length&&limitRange.unshift(0),{execute:execute}},count=function(){return direction=null,cursorType="count",{execute:execute}},keys=function(){return cursorType="openKeyCursor",{desc:desc,execute:execute,filter:filter,distinct:distinct,map:map}},filter=function(){return filters.push(Array.prototype.slice.call(arguments,0,2)),{keys:keys,execute:execute,filter:filter,desc:desc,distinct:distinct,modify:modify,limit:limit,map:map}},desc=function(){return direction="prev",{keys:keys,execute:execute,filter:filter,distinct:distinct,modify:modify,map:map}},distinct=function(){return unique=!0,{keys:keys,count:count,execute:execute,filter:filter,desc:desc,modify:modify,map:map}},modify=function(update){return modifyObj=update,{execute:execute}},map=function(fn){return mapper=fn,{execute:execute,count:count,keys:keys,filter:filter,desc:desc,distinct:distinct,modify:modify,limit:limit,map:map}};return{execute:execute,count:count,keys:keys,filter:filter,desc:desc,distinct:distinct,modify:modify,limit:limit,map:map}};"only bound upperBound lowerBound".split(" ").forEach(function(name){that[name]=function(){return new Query(name,arguments)}}),this.filter=function(){var query=new Query(null,null);return query.filter.apply(query,arguments)},this.all=function(){return this.filter()}},createSchema=function(e,schema,db){"function"==typeof schema&&(schema=schema());for(var tableName in schema){var table=schema[tableName],store;if(!hasOwn.call(schema,tableName)||db.objectStoreNames.contains(tableName)){var target=e.currentTarget||e.target;store=target.transaction.objectStore(tableName)}else store=db.createObjectStore(tableName,table.key);for(var indexKey in table.indexes)if(!store.indexNames.contains(indexKey)){var index=table.indexes[indexKey];store.createIndex(indexKey,index.key||indexKey,Object.keys(index).length?index:{unique:!1})}}},open=function(e,server,version,schema){var db=e.target.result,s=new Server(db,server),upgrade,deferred=Deferred();return deferred.resolve(s),dbCache[server]=db,deferred.promise()},dbCache={},db={version:"0.9.0",open:function(options){var request,deferred=Deferred();return dbCache[options.server]?open({target:{result:dbCache[options.server]}},options.server,options.version,options.schema).done(deferred.resolve).fail(deferred.reject).progress(deferred.notify):(request=dbProvider.open(options.server,options.version),request?(request.onsuccess=function(e){open(e,options.server,options.version,options.schema).done(deferred.resolve).fail(deferred.reject).progress(deferred.notify)},request.onupgradeneeded=function(e){createSchema(e,options.schema,e.target.result)},request.onerror=function(e){deferred.reject(e)}):deferred.reject({target:{error:{name:"DBOpenError"}}})),deferred.promise()}};return db}),define("EventDispatcher",["globals"],function(g){var EventDispatcherFns={_ensureListeners:function _ensureListenersFn(){return this._listeners||(this._listeners={}),this._listeners},clearListeners:function clearListenersFn(){this._listeners=void 0},listen:function listenFn(){for(var sub=this._ensureListeners(),i=0;i<arguments.length-1;++i){try{g.PAssert(2362,"callbacks"!==arguments[i],"Invalid event name/grouping")}catch(PERR){g.reportError(PERR)}sub[arguments[i]]||(sub[arguments[i]]={callbacks:[]}),sub=sub[arguments[i]]}sub.callbacks.push(arguments[arguments.length-1])},isListening:function isListeningFn(){for(var sub=this._ensureListeners(),cb=arguments[arguments.length-1],i=0;i<arguments.length-1;++i)sub[arguments[i]]&&(sub=sub[arguments[i]]);return sub&&sub.callbacks&&sub.callbacks.indexOf(cb)>=0},unlisten:function unlistenFn(){for(var sub=this._ensureListeners(),cb=arguments[arguments.length-1],i=0;i<arguments.length-1;++i){try{g.PAssert(2363,"callbacks"!==arguments[i],"Invalid event name/grouping")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2364,sub[arguments[i]],"Cannot unlisten something that has never been listened")}catch(PERR){g.reportError(PERR)}sub[arguments[i]]&&(sub=sub[arguments[i]])}try{g.PAssert(2365,sub&&sub.callbacks&&sub.callbacks.indexOf(cb)>=0,"Cannot unlisten something that has never been listened")}catch(PERR){g.reportError(PERR)}sub.callbacks&&sub.callbacks.remove(cb)},fireEvent:function fireEventFn(){var ret=!0,sub=this._ensureListeners(),cbArgs=arguments[arguments.length-1];try{g.PAssert(2366,void 0===cbArgs||g.isArray(cbArgs),"Last argument to fireEvent must be an array")}catch(PERR){g.reportError(PERR)}for(var i=0;i<arguments.length-1;++i){try{g.PAssert(2367,"callbacks"!==arguments[i],"Invalid event name/grouping")}catch(PERR){g.reportError(PERR)}if(!sub[arguments[i]])break;sub=sub[arguments[i]];for(var j=0;j<sub.callbacks.length;++j)ret=sub.callbacks[j].apply(this,cbArgs)&&ret}return ret}};return EventDispatcherFns}),define("Dispatcher",["util","EventDispatcher"],function(util,EventDispatcher){function Dispatcher(){}return util.defineBase(Dispatcher),util.extend(Dispatcher.prototype,EventDispatcher),new Dispatcher}),define("demo",["globals","Dispatcher"],function(g,Dispatcher){function demo(){this.cache={},this.loadedGapiData={},this._isRemoteHooked=!1,this.resetListener=void 0}return demo.prototype={setGapiData:function setGapiDataFn(id,data){try{g.PAssert(2368,g.isObject(data)&&!g.isArray(data),"Setting malformed data",id)}catch(PERR){g.reportError(PERR)}this.loadedGapiData[id]=[];for(var entryID in data)data[entryID].id=entryID,this.loadedGapiData[id].push(data[entryID])},setGapiDataDirect:function setGapiDataDirectFn(id,dataArr){try{g.PAssert(2369,g.isArray(dataArr),"Setting malformed data",id)}catch(PERR){g.reportError(PERR)}this.loadedGapiData[id]=dataArr},clearGapiData:function clearGapiDataFn(){this.loadedGapiData={}},loadRemoteData:function loadRemoteDataFn(info,cb){try{g.PAssert(2370,info&&cb,"Must supply valid remote load info as well as a cb when data is loaded")}catch(PERR){g.reportError(PERR)}var rInfo=info.split(".");this.cache[rInfo[0]]?cb(JSON.parse(JSON.stringify(this.cache[rInfo[0]][rInfo[1]]))):g.XHR({type:"GET",url:window.location.protocol+"//"+window.location.host+"/data/"+rInfo[0]+".json",cb:function cbFn(xhr){if(200===xhr.status)try{var demoData=JSON.parse(xhr.responseText);this.cache[rInfo[0]]=demoData;var demoEntry=demoData[rInfo[1]];if(demoEntry){var dataCopy=JSON.parse(JSON.stringify(demoEntry));cb(dataCopy)}else log("Invalid data slot")}catch(err){log("Error parsing demo data: "+err.message)}else log("Error getting demo data",xhr.status,xhr.responseText)}.bind(this)})},stubGapi:function stubGapiFn(){try{g.PAssert(2371,!window.gapi,"Should not have loaded gapi when stubbing")}catch(PERR){g.reportError(PERR)}var emptyFn=function(){},emptyImpl=function(){return{}},emptyPromise=function(){return{then:emptyFn,execute:emptyFn}};window.gapi={client:{load:emptyFn,setApiKey:emptyFn,newBatch:function newBatchFn(){return{add:emptyFn,then:emptyFn}},drive:{files:{get:emptyPromise,list:emptyPromise,trash:emptyPromise,insert:emptyPromise,patch:emptyPromise},permissions:{list:emptyPromise,insert:emptyPromise,"delete":emptyPromise},properties:{insert:emptyPromise},parents:{insert:emptyPromise},changes:{list:emptyPromise}},gmail:{users:{threads:{list:emptyPromise,get:emptyPromise}}},calendar:{settings:{list:emptyPromise},events:{list:emptyPromise}}}}},areRemoteFunctionsHooked:function areRemoteFunctionsHookedFn(){return this._isRemoteHooked},hookRemoteFunctions:function hookRemoteFunctionsFn(){function findById(arr,id){try{g.PAssert(2373,arr,"Must load local or remote data to perform queries")}catch(PERR){g.reportError(PERR)}for(var i=0;i<arr.length;++i)if(arr[i].id===id)return arr[i];return void 0}function findByParentId(arr,id){try{g.PAssert(2374,arr,"Must load local or remote data to perform queries")}catch(PERR){g.reportError(PERR)}for(var matches=[],i=0;i<arr.length;++i)(arr[i].parents[0].id===id||"root"===id&&arr[i].parents[0].isRoot)&&matches.push(arr[i]);return matches}function findByField(arr,field,value){try{g.PAssert(2375,arr,"Must load local or remote data to perform queries")}catch(PERR){g.reportError(PERR)}for(var matches=[],i=0;i<arr.length;++i)arr[i][field]===value&&matches.push(arr[i]);return matches}function findByFieldContains(arr,field,value){try{g.PAssert(2376,arr,"Must load local or remote data to perform queries")}catch(PERR){g.reportError(PERR)}for(var matches=[],i=0;i<arr.length;++i)arr[i][field].indexOf(value)>=0&&matches.push(arr[i]);return matches}function replyThen(impl){return function(success,failure,context){var data=impl(context),timeout=setTimeout(function(){timeouts.remove(timeout),data?success({result:data}):failure({error:!0})},API_TIMEOUT);timeouts.push(timeout)}}function replyExecute(impl){return function(success,failure,context){var data=impl(context),timeout=setTimeout(function(){timeouts.remove(timeout),data?success(data):failure({error:!0})},API_TIMEOUT);timeouts.push(timeout)}}function genPromise(impl){return{then:replyThen(impl),execute:replyExecute(impl)}}function loadAPI_Drive(){gapi.client.drive.files.get=function(params){function impl(context){var file=findById(_this.loadedGapiData.Drive,params.fileId);return file}return genPromise(impl)},gapi.client.drive.files.list=function(params){function impl(context){if("trashed=false and mimeType contains 'application/vnd.google-apps.drive-sdk.597847337936'"===params.q)return{items:_this.loadedGapiData.documents};var parentsCheck=/\'(.*)\' in parents/g,searchCheck=/title contains \'([^\']*)\'/g,mimeCheck=/mimeType contains \'([^\']*)\'/g,parentsMatch=parentsCheck.exec(params.q),searchMatch=searchCheck.exec(params.q),mimeMatch=mimeCheck.exec(params.q),matches=_this.loadedGapiData.Drive;if(parentsMatch){var parentID=parentsMatch[1];matches=findByParentId(matches,parentID)}if(searchMatch){var searchString=searchMatch[1];matches=findByFieldContains(matches,"title",searchString)}if(mimeMatch){var mimeString=mimeMatch[1];matches=findByFieldContains(matches,"mimeType",mimeString)}return{items:matches}}return genPromise(impl)},gapi.client.drive.files.trash=function(params){return genPromise(emptyImpl)},gapi.client.drive.files.insert=function(params){return genPromise(emptyImpl)},gapi.client.drive.files.patch=function(params){return genPromise(emptyImpl)},gapi.client.drive.permissions.list=function(params){function impl(context){return{items:_this.loadedGapiData.permissions}}return genPromise(impl)},gapi.client.drive.permissions.insert=function(params){return genPromise(emptyImpl)},gapi.client.drive.permissions.delete=function(params){return genPromise(emptyImpl)},gapi.client.drive.properties.insert=function(params){return genPromise(emptyImpl)}}function loadAPI_Gmail(){gapi.client.gmail.users.threads.list=function(params){function impl(context){return void 0===params.q?{threads:findByField(_this.loadedGapiData.Gmail,"hideInPane",void 0)}:{threads:_this.loadedGapiData.Gmail}}return genPromise(impl)},gapi.client.gmail.users.threads.get=function(params){function impl(context){return findById(_this.loadedGapiData.Gmail,params.id)}return genPromise(impl)}}try{g.PAssert(2372,!this._isRemoteHooked,"Should not hook remote functions more than once")}catch(PERR){g.reportError(PERR)}this.stubGapi(),this._isRemoteHooked=!0;var API_TIMEOUT=0,timeouts=[],_this=this;Dispatcher.listen("resetEverything",function(){for(var i=0;i<timeouts.length;i++)clearTimeout(timeouts[i]);timeouts=[]}),loadAPI_Drive(),loadAPI_Gmail()}},new demo}),define("VMContact",["ko","globals"],function(ko,g){function VMContact(p){try{g.PAssert(2377,g.isObject(p),"Should always supply a valid object to init a contact")}catch(PERR){g.reportError(PERR)}this.id=p.id,this.text=p.text||"",this.phoneNumbers=p.phoneNumbers||[],this.emails=p.emails||[],this.init()}return VMContact.prototype={init:function initFn(){for(var i=0;i<this.phoneNumbers.length;i++)this.phoneNumbers[i].link=this.formatPhone(this.phoneNumbers[i].number),this.phoneNumbers[i].type=this.phoneNumbers[i].type[0];for(var i=0;i<this.emails.length;i++)this.emails[i].link="mailto:"+this.emails[i].address},_phoneRegex:/^(?:\+?1[-. ]?)?(?:\(?([0-9]{3})\)?[-. ]?)?([0-9]{3})[-. ]?([0-9]{4})$/,formatPhone:function formatPhoneFn(phonenum){if(this._phoneRegex.test(phonenum)){var parts=phonenum.match(this._phoneRegex),phoneLink="";return parts[1]&&(phoneLink+="+1-"+parts[1]+"-"),phoneLink+=parts[2]+"-"+parts[3],"tel:"+phoneLink}var parsedNum=phonenum.replace(/\D+/g,"");try{g.PAssert(2378,parsedNum&&""!==parsedNum,"Invalid phone number format: "+phonenum)}catch(PERR){g.reportError(PERR)}return phonenum.startsWith("+")&&(parsedNum="+"+parsedNum),"tel:"+parsedNum},onTapNumber:function onTapNumberFn(e){g.openUrl(this.link,e,!0)},onTapEmail:function onTapEmailFn(e){g.openUrl(this.link,e,!0)},onTap:{onClick:function onClickFn(e){log("Contact Element Tapped: ",e.srcElement,this.text),g.hasClass(e.srcElement,"contactPhone")||g.hasClass(e.srcElement,"contactEmail")||g.autocomplete.onTapped(this.text,this.text.length,!0)}}},VMContact}),define("VMContactManager",["ko","globals","VMContact"],function(ko,g,VMContact){function VMContactManager(){this._contactCache={},this._contacts=[],this._contactsByName={},this._contactNames={___info___:{count:0}},this.init()}return VMContactManager.prototype={init:function initFn(){},loadContacts:function loadContactsFn(contacts,isDemo){try{g.PAssert(2379,0===this._contacts.length,"Should only load contacts once")}catch(PERR){g.reportError(PERR)}var modifiedContact=!1;if(contacts){this._contacts=[];for(var i=0;i<contacts.length;++i){var contact=contacts[i];if(contact.name&&(contact.text=contact.name,contacts[i].text=contact.name,delete contacts[i].name,modifiedContact=!0),!isDemo&&contact.isDemo||contact.text&&!contact.phoneNumbers&&!contact.emails)modifiedContact=!0;else{if(contact.text){var escContact=g.escape(contact.text);this._contactNames[escContact]="",this._contactsByName[contact.text]=contact,this._contacts.push(contact)}try{g.PAssert(2380,contact.id,"Each contact must have a valid id")}catch(PERR){g.reportError(PERR)}}}this._contacts.sort(this.contactComparator),this._contactNames.___info___.count=this._contacts.length}else this.clearContacts();return modifiedContact},addContact:function addContactFn(contact){try{g.PAssert(2381,contact.id,"Incoming contacts must have a valid id")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2382,contact.text,"All contacts are expected to have a text")}catch(PERR){g.reportError(PERR)}var existingContact=this._contactsByName[contact.text];if(existingContact)contact.emails&&(existingContact.emails||(existingContact.emails=[]),existingContact.emails.pushOnlyUniques(contact.emails,this.emailComparator)),contact.phoneNumbers&&(existingContact.phoneNumbers||(existingContact.phoneNumbers=[]),existingContact.phoneNumbers.pushOnlyUniques(contact.phoneNumbers,this.phoneComparator));else{if(this._contacts.insertSorted(contact,this.contactComparator),contact.text){var escContact=g.escape(contact.text);this._contactNames[escContact]="",this._contactsByName[contact.text]=contact}this._contactNames.___info___.count=this._contacts.length}this._contactCache[contact.id]&&(this._contactCache=new VMContact(contact))},updateContact:function updateContactFn(newContact){try{g.PAssert(2383,newContact.id,"Incoming contacts must have a valid id")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2384,newContact.text,"All contacts are expected to have a text")}catch(PERR){g.reportError(PERR)}for(var wasReplaced=!1,i=0;i<this._contacts.length;++i){var oldContact=this._contacts[i];if(oldContact.id===newContact.id){oldContact.text=newContact.text,oldContact.emails=oldContact.phoneNumbers=void 0,this.addContact(newContact),wasReplaced=!0;break}}return wasReplaced?void 0:(this.addContact(newContact),!0)},clearContacts:function clearContactsFn(){this._contactCache={},this._contacts=[],this._contactsByName={},this._contactNames={___info___:{count:0}}},numContacts:function numContactsFn(){try{g.PAssert(2385,this._contacts.length===this._contactNames.___info___.count,"Contact names count should match contacts value")}catch(PERR){g.reportError(PERR)}return this._contacts.length},getContacts:function getContactsFn(){return this._contactNames},previewTemplate:function previewTemplateFn(){return"template-contact"},getItemStyledText:function getItemStyledTextFn(item){return item.text},getItemText:function getItemTextFn(item){return item.text},getItemTextLength:function getItemTextLengthFn(item){return item.text.length},contactComparator:function contactComparatorFn(a,b){return a.text&&b.text?a.text.localeCompare(b.text):a.text&&!b.text?1:!a.text&&b.text?-1:void 0},emailComparator:function emailComparatorFn(a,b){return a.address&&b.address?a.address.localeCompare(b.address):a.address&&!b.address?1:!a.address&&b.address?-1:void 0},phoneComparator:function phoneComparatorFn(a,b){return a===b},ensureCacheObject:function ensureCacheObjectFn(contactData){try{g.PAssert(2386,contactData,"Must have valid data to store in cache")}catch(PERR){g.reportError(PERR)}if(this._contactCache[contactData.id])return this._contactCache[contactData.id];var newContactVM=new VMContact(contactData);return this._contactCache[contactData.id]=newContactVM,newContactVM},findMatchExact:function findMatchExactFn(name){var contactData=this._contactsByName[name];return contactData?this.ensureCacheObject(contactData):void 0},findMatchLike:function findMatchLikeFn(name,maxCount){try{g.PAssert(2387,void 0!==name,"Must provide a valid contact part")}catch(PERR){g.reportError(PERR)}for(var upper=name.toUpperCase(),results=[],i=0;i<this._contacts.length;++i){var index=this._contacts[i].text.toUpperCase().indexOf(upper);if(index>=0&&(results.push(this.ensureCacheObject(this._contacts[i])),results.length>=maxCount))break}return results.sort(this.contactComparator),results},findContactByEmail:function findContactByEmailFn(email){for(var i=0;i<this._contacts.length;++i){var contact=this._contacts[i];if(contact.emails)for(var u=0;u<contact.emails.length;++u)if(contact.emails[u].address===email)return contact}return void 0},findEmailsLike:function findEmailsLikeFn(email,maxCount){try{g.PAssert(2388,void 0!==email,"Must provide a valid email part")}catch(PERR){g.reportError(PERR)}maxCount=maxCount||20;for(var results=[],upper=email.toUpperCase(),i=0;i<this._contacts.length;++i){var contact=this._contacts[i];if(contact&&contact.emails)for(var j=0;j<contact.emails.length;++j){var cEmail=contact.emails[j].address;if(cEmail.toUpperCase().indexOf(upper)>=0&&(results.push(cEmail),results.length>=maxCount))break}if(results.length>=maxCount)break}return results.sort(this.emailComparator),results}},VMContactManager}),define("VMTagManager",["ko","globals"],function(ko,g){function VMTagManager(){this._tagKeys=[],this._tagKeysLower=[],this._tagCache={},this.init()}return VMTagManager.prototype={init:function initFn(){},previewTemplate:function previewTemplateFn(){return void 0},getItemStyledText:function getItemStyledTextFn(item){return item},getItemText:function getItemTextFn(item){return item},getItemTextLength:function getItemTextLengthFn(item){return item?item.length:0},tagComparator:function tagComparatorFn(a,b){return a.localeCompare(b)},findMatchExact:function findMatchExactFn(tag){return!1},findMatchLike:function findMatchLikeFn(tag,maxCount){tag=this.getCacheName(tag);var tagLower=tag.toLowerCase(),startIndex=this._tagKeysLower.findInsertIndex(tagLower,this.tagComparator);1===this._tagCache[tag]&&startIndex++;for(var matchCount=maxCount,i=0;maxCount>i&&startIndex+i<this._tagKeys.length;++i)if(!this._tagKeysLower[startIndex+i].startsWith(tagLower)){matchCount=i;break}return this._tagKeys.slice(startIndex,startIndex+matchCount)},notifyAdded:function notifyAddedFn(tag){tag=this.getCacheName(tag),this._tagCache[tag]?this._tagCache[tag]++:(this._tagCache[tag]=1,this._tagKeys.insertSorted(tag,this.tagComparator),this._tagKeysLower.insertSorted(tag.toLowerCase(),this.tagComparator));try{g.PAssert(2389,this._tagCache[tag]>0,"Invalid value for tag count",this._tagCache[tag])}catch(PERR){g.reportError(PERR)}},notifyRemoved:function notifyRemovedFn(tag){tag=this.getCacheName(tag);try{g.PAssert(2390,void 0!==this._tagCache[tag]&&this._tagCache[tag]>0,"Invalid value for tag count",this._tagCache[tag])}catch(PERR){g.reportError(PERR)}if(!isNaN(this._tagCache[tag])&&0===--this._tagCache[tag]){var index=this._tagKeys.findInsertIndex(tag,this.tagComparator),removedTag=this._tagKeys.removeAt(index);this._tagKeysLower.removeAt(index);try{g.PAssert(2391,tag===removedTag,"Removed tag should always match incoming tag")}catch(PERR){g.reportError(PERR)}}},getCacheName:function getCacheNameFn(tag){return this._tagCache[tag]&&isNaN(this._tagCache[tag])&&(tag="t~"+tag),tag}},VMTagManager}),define("ItemStore",["globals","util"],function(g,util){function ItemStore(id,isReadonly,isDestructible,enabledFilters,owner){this.id=id,this._readonly=!!isReadonly,this._isDestructible=!!isDestructible,this._enabledFilters=!!enabledFilters,this._owner=owner,this._root=void 0,this._data={},this._destroyed=!1,this.init()}return ItemStore.prototype={init:function initFn(){this._constructor=require("VMLI")},areFiltersEnabled:function areFiltersEnabledFn(filters){return g.isFlagSet(this._enabledFilters,filters)},getEnabledFilters:function getEnabledFiltersFn(){return this._enabledFilters
},isOwner:function isOwnerFn(owner){return this._owner===owner},destroy:function destroyFn(){this._destroyed=!0,this.clearStore(),this._root=void 0,this._owner=void 0,util.destroy(this)},clearStore:function clearStoreFn(){this._data={},this._root&&(this._root.items.set([]),this._data[this._root.id]=this._root)},createRoot:function createRootFn(id,text){this._root=this.createItem(id,text)},setRoot:function setRootFn(root){try{g.PAssert(2392,root,"Must specify a valid root item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2393,root.belongsToItemStore(this),"Root item must belong to this item store")}catch(PERR){g.reportError(PERR)}this._root=root},createItem:function createItemFn(id,text,parentID,props,changeType){try{g.PAssert(2394,!this._data[id],"Should never double-create for the same item, should use update instead")}catch(PERR){g.reportError(PERR)}void 0===changeType&&(changeType=ChangeType.None);var parent;if(parentID){parent=this._data[parentID];try{g.PAssert(2395,parent,"Parent must be valid if defined")}catch(PERR){g.reportError(PERR)}}var itemData={id:id,text:text};if(props)for(var key in props)props.hasOwnProperty(key)&&(itemData[key]=props[key]);var item=new this._constructor(itemData,{store:this,parent:parent,changeType:changeType,canDestroy:this._isDestructible,noSave:this._readonly});return this._data[item.id]=item,item},createItemRaw:function createItemRawFn(p,extraInfo){try{g.PAssert(2396,!!extraInfo.canDestroy===this._isDestructible,"When creating raw items, canDestroy must match")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2397,!!extraInfo.noSave===this._readonly,"When creating raw items, noSave must match")}catch(PERR){g.reportError(PERR)}extraInfo.store=this;var item=new this._constructor(p,extraInfo);return this._data[item.id]=item,item},destroyItem:function destroyItemFn(id){var item=this._data[id];item.destroy(),this._data[id]=void 0},getItem:function getItemFn(id){return this._data[id]},hasItem:function hasItemFn(id){return!!this._data[id]},getRoot:function getRootFn(){return this._root},isRoot:function isRootFn(item){return this._root===item},getCount:function getCountFn(){return Object.keys(this._data).length},forEach:function forEachFn(fn){for(var id in this._data)this._data[id]&&fn(this._data[id])}},util.defineBase(ItemStore),ItemStore}),define("data",["globals","util","gdata","database","demo","platform","VMContactManager","VMTagManager","ItemStore"],function(g,util,gdata,database,demo,platform,VMContactManager,VMTagManager,ItemStore){function transactionDoneCallback(){}function transactionErrorCallback(obj,e){log("Transaction Error: ",arguments),g.reportError(new Error("IDB Transaction Error"),e)}function removeItemSubtree(id){var item=self.getItem(id);if(item){var children=item.items;if(children)for(var i=0;i<children.length;++i)removeItemSubtree(children[i]);self.dbDeleteItem(item.id)}}function doArchive(item,archivedItem,value){try{g.PAssert(2433,item,"Must provide a valid item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2434,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}item.save({items:item.getItemsArrayForSave()},SaveFlag.None),archivedItem.save({isArchived:value},SaveFlag.None)}function makePropString(item,field){var value=item[field];return value?',"'+field+'":'+value:""}function makeJSON(item,hasPrev,allowArchived){var str="";hasPrev&&(str+=",");var model=self.getModel(item.id),text=String(model.getParsedText()).replace(/[\"\\]/g,function(chr){return charMapJSON[chr]}),item=self.getItem(item.id),dateString=makePropString(item,"date"),dateCompletedString=makePropString(item,"dateCompleted"),priorityString=makePropString(item,"priority"),isCompleteString=makePropString(item,"isComplete"),isStarredString=makePropString(item,"isStarred"),isArchivedString=makePropString(item,"isArchived");if(str+='{"text": "'+text+'"'+dateString+dateCompletedString+priorityString+isCompleteString+isStarredString+isArchivedString,item.items&&item.items.length>0){str+=',"items":[';for(var i=0;i<item.items.length;i++){var child=self.getItem(item.items[i]);(!child.isArchived||child.isArchived&&allowArchived)&&(str+=makeJSON(child,i>0,allowArchived))}str+="]"}return str+="}"}var DB_CONTACTS="ctcs",self={pendingRemoteUpdates:{},itemCache:{},dbDataCache:{},loadedItemCount:0,hasLocalData:!1,freezeUpdates:!1,dbi:void 0,contactManager:new VMContactManager,tagManager:new VMTagManager};self.forEachModel=function forEachModelFn(fn){try{g.PAssert(2398,fn,"Must pass a valid function to iterate on")}catch(PERR){g.reportError(PERR)}for(var id in self.itemCache)self.itemCache[id]&&fn(self.itemCache[id])},self.getModel=function getModelFn(id){try{g.PAssert(2399,g.isString(id),"ID must be a valid string: "+g.getObjectInfo(id))}catch(PERR){g.reportError(PERR)}try{g.PAssert(2400,id,"Tried to get a model with an invalid id")}catch(PERR){g.reportError(PERR)}return self.itemCache[id]},self.setModel=function setModelFn(model){try{g.PAssert(2401,model,"Tried to set an invalid model")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2402,model.id,"Tried to set a model with an invalid id")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2403,g.isString(model.id),"ID must be a valid string: "+g.getObjectInfo(model.id))}catch(PERR){g.reportError(PERR)}self.itemCache[model.id]=model},self.getItem=function getItemFn(id){try{g.PAssert(2404,g.isString(id),"ID must be a valid string:"+g.getObjectInfo(id))}catch(PERR){g.reportError(PERR)}try{g.PAssert(2405,id,"Tried to get an item that doesn't exist")}catch(PERR){g.reportError(PERR)}return self.dbDataCache[id]},self.setItem=function setItemFn(id,data){try{g.PAssert(2406,g.isString(id),"ID must be a valid string: "+g.getObjectInfo(id))}catch(PERR){g.reportError(PERR)}try{g.PAssert(2407,id,"Tried to set an item with an invalid id")}catch(PERR){g.reportError(PERR)}self.dbDataCache[id]=data},self.clearItems=function clearItemsFn(){self.dbDataCache={},self.itemCache={}},self.clearPlugins=function clearPluginsFn(){g.vmMain.pluginManager.onClearData()},self.getRootItem=function getRootItemFn(){return self.rootId?self.getItem(self.rootId):void 0},self.getRootModel=function getRootModelFn(){return self.rootId?self.getModel(self.rootId):void 0},self.createVMLI=function createVMLIFn(p,extraInfo){return g.vmMain.itemStoreManager.getDefaultItemStore().createItemRaw(p,extraInfo)},self.initializeIndexedDB=function initializeIndexedDBFn(handler){function initLocalDB(initSuccess){initSuccess?database.open({server:"duchess",version:version,schema:{items:{key:{keyPath:"id"}},settings:{},caches:{key:{keyPath:"cid"}}}}).done(function(server){self.dbi=server;for(var i=0;i<cachesAvailableCBs.length;++i)cachesAvailableCBs[i](!0);cachesAvailableCBs=[],handler()}).fail(function(e){try{log("Error loading local DB client - "+e.target.error.name+": "+e.target.error.message)}catch(err2){log("Error loading local DB client - Invalid Error Message")}g.preventLocalWrites(),"Firefox"===platform.browser?e.target&&e.target.error&&"InvalidStateError"===e.target.error.name||g.reportError(e):"Safari"===platform.browser?e.target&&e.target.error&&"DBOpenError"===e.target.error.name||g.reportError(e):g.reportError(e),"VersionError"===e.target.error.name&&(util.hasURLParam("versionError")||g.AppCache.runOnFinish(function(){util.insertURLParam("versionError",!0)},!0)),handler()}):(log("Shim failed to init."),g.preventLocalWrites(),handler())}var version=3;window.indexedDB&&void 0!==window.indexedDB.onIsReady&&null!==window.indexedDB.onIsReady?window.indexedDB.onIsReady(initLocalDB):setTimeout(function(){initLocalDB(!0)},0)};var cachesAvailableCBs=[];self.onCachesAvailable=function onCachesAvailableFn(cb){self.dbi?cb(!0):g.shouldWriteLocal()?cachesAvailableCBs.push(cb):cb(!1)};var openCaches={};self.openCacheTable=function openCacheTableFn(id){return openCaches[id]=void 0===openCaches[id]?1:openCaches[id]+1,self.dbi.caches},self.closeCacheTable=function closeCacheTableFn(id){try{g.PAssert(2408,openCaches[id]>0,"Must have previously opened the cache to close it")}catch(PERR){g.reportError(PERR)}openCaches[id]--};var isLocalDataLoaded=!1;self.localDataLoaded=function localDataLoadedFn(){return isLocalDataLoaded},self.loadFromIndexedDB=function loadFromIndexedDBFn(callback){try{g.PAssert(2410,!isLocalDataLoaded,"Should never load local data twice")}catch(PERR){g.reportError(PERR)}ShouldLog(LogLevels.Timing)&&log("Loading DB: ",log.now()),self.dbDataCache={},g.shouldWriteLocal()&&self.dbi&&self.dbi.items?self.dbi.items.query().all().execute().done(function(results){ShouldLog(LogLevels.Timing)&&log("Loaded DB: ",log.now()),self.loadedItemCount=results.length;for(var i=0;i<results.length;++i)self.setItem(results[i].id,g.translateObjOut(results[i]));self.dbi.settings?self.dbi.settings.get("root").done(function(result){if(!g.criticalErrorReported()){if(isLocalDataLoaded=!0,result){try{g.PAssert(2411,self.getItem(result.root),"If there is a root item defined there should be a corresponding local item")}catch(PERR){g.reportError(PERR)}self.rootId=result.root}callback&&callback()}}).fail(callback):(log("Unable to load local settings DB"),callback&&callback())}):(log("Unable to load local items DB"),isLocalDataLoaded=!0,g.preventLocalWrites(),callback&&callback())};var updateTransaction;self.beginTransaction=function beginTransactionFn(){g.shouldWriteLocal()&&(updateTransaction={})},self.transactionUpdate=function transactionUpdateFn(id,data){try{g.PAssert(2412,g.shouldWriteLocal(),"Should never be writing during a transaction if local writes are disabled")}catch(PERR){g.reportError(PERR)}if(updateTransaction[id])for(var attr in data)updateTransaction[id][attr]=data[attr];else updateTransaction[id]=data},self.endTransaction=function endTransactionFn(){if(g.shouldWriteLocal()&&self.dbi&&self.dbi.items)try{self.dbi.items.updateObject(updateTransaction).done(transactionDoneCallback).fail(transactionErrorCallback)}catch(err){g.reportError(err),transactionErrorCallback()}else void 0!==updateTransaction&&g.reportError(new Error("Started a transaction and stopped writes halfway through"));updateTransaction=void 0},self.dbUpdateItem=function dbUpdateItemFn(params){function trackUpdates(){if(window.__UPDATES_ACTUAL++,callback){var args=Array.prototype.slice.call(arguments,1);callback(args)}}if(!self.freezeUpdates){self.hasLocalData||g.isLoadingRemote||params.skipLocalModification||(self.hasLocalData=!0);var changes=params.changes||{},id=params.id?params.id:changes.id,callback=params.callback,saveFlags=params.saveFlags;try{g.PAssert(2413,saveFlags===SaveFlag.None||saveFlags===SaveFlag.Prop||saveFlags===SaveFlag.Text||saveFlags===SaveFlag.All)}catch(PERR){g.reportError(PERR)}var item=self.getItem(id);if(g.shouldWriteLocal()){var translated;try{g.PAssert(2414,!saveFlags||void 0===changes.modifiedOffline&&void 0===changes.modifiedOfflineText,"Shouldn't be setting a modified flag while passing them in with changes")}catch(PERR){g.reportError(PERR)}if(g.isFlagSet(saveFlags,SaveFlag.Prop)){try{g.PAssert(2415,void 0===changes.modifiedOffline,"Shouldnt be passing in a value and assigning "+changes.modifiedOffline)}catch(PERR){g.reportError(PERR)}changes.modifiedOffline=!0;var model=self.getModel(id);model&&(model.modifiedOffline=!0)}if(g.isFlagSet(saveFlags,SaveFlag.Text)){try{g.PAssert(2416,void 0===changes.modifiedOfflineText,"Shouldnt be passing in a value and assigning "+changes.modifiedOfflineText)}catch(PERR){g.reportError(PERR)}changes.modifiedOfflineText=!0;var model=self.getModel(id);model&&(model.modifiedOfflineText=!0)}if(item){for(var prop in changes)if(changes.hasOwnProperty(prop)){var verStr;item[prop]=changes[prop]}translated=g.translateObjIn(item)}else{try{g.PAssert(2417,changes.id,"Item being modified does not already exist as expected",changes)}catch(PERR){g.reportError(PERR)}var verStr,verStr;self.setItem(id,changes),translated=g.translateObjIn(changes)}if(updateTransaction){try{g.PAssert(2419,!callback,"Callbacks not supported for updates inside of a transaction")}catch(PERR){g.reportError(PERR)}self.transactionUpdate(id,translated)}else try{callback?self.dbi.items.update(translated).done(callback).fail(callback):self.dbi.items.update(translated)}catch(err){g.reportError(err)}}else{if(item)for(var prop in changes)changes.hasOwnProperty(prop)&&(item[prop]=changes[prop]);else self.setItem(id,changes);callback&&callback()}}},self.dbDeleteItem=function dbDeleteItemFn(id,callback){if(!self.freezeUpdates&&(self.setItem(id,void 0),g.shouldWriteLocal()))try{callback?self.dbi.items.remove(id).done(callback).fail(callback):self.dbi.items.remove(id)}catch(err){g.reportError(err)}},self.setRoot=function setRootFn(id){if(!self.freezeUpdates){if(g.shouldWriteLocal())try{self.dbi.settings.update({key:"root",item:{root:id}})}catch(err){g.reportError(err)}return self.rootId=id,self.getRootItem()}},self.setPluginData=function setPluginDataFn(data){var plugins=Object.keys(data);demo.clearGapiData();for(var i=0;i<plugins.length;++i){var pluginID=plugins[i],plugin=g.vmMain.pluginManager.getPlugin(pluginID),pluginData=data[pluginID].data;pluginData&&(demo.setGapiData(pluginID,pluginData),plugin.forceLoad())}};var demoId=0,loadedDemoData={};self.loadDemoData=function loadDemoDataFn(testData,forceLoad,handler){function insertIntoDB(root){root.id||(root.id="demo"+demoId++),self.setItem(root.id,root);var items=root.items;if(items){for(var itemIDs=[],i=0;i<items.length;++i)items[i].id||(items[i].id="demo"+demoId++),itemIDs.push(items[i].id),insertIntoDB(items[i]);root.items=itemIDs}}function handleDataLoad(demoData){var root,plugins;demoData&&(root=demoData[0],plugins=demoData[1]),plugins&&(forceLoad&&self.clearPlugins(),self.setPluginData(plugins)),root&&(forceLoad&&(g.vmMain.itemStoreManager.runForEachStore(function(itemStore){itemStore.clearStore()}),self.clearItems()),insertIntoDB(root),self.setRoot(root.id),loadedDemoData[testData]={root:root,plugins:plugins},isLocalDataLoaded=!0,handler&&handler(root.id))}if(void 0===testData&&(testData="demo.0"),demo.areRemoteFunctionsHooked()||demo.hookRemoteFunctions(),forceLoad||void 0===testData||""===testData||void 0===loadedDemoData[testData]){var num,root,i;demo.loadRemoteData(testData,handleDataLoad)}else{log("Use Preloaded demo data: ",testData);var demoData=loadedDemoData[testData];self.setRoot(demoData.root.id),demoData.plugins&&self.setPluginData(demoData.plugins),handler&&handler(demoData.root.id)}};var initDataCalled=!1;self.initData=function initDataFn(handler){if(initDataCalled)return!1;initDataCalled=!0,ShouldLog(LogLevels.Timing)&&log("Initializing User Item Data",log.now());try{g.isDemoMode()?setTimeout(function(){var testData=util.getURLParam("data");self.loadDemoData(testData,!1,handler)},0):(g.checkpoint(Checkpoint.InitData),self.initializeIndexedDB(function(){self.loadFromIndexedDB(function(){g.checkpoint(Checkpoint.DBLoaded),self.checkLocalIntegrity(function(){self.loadLocalContacts(),handler()})})}))}catch(err){g.reportError(err)}return!0},self.initializeItem=function initializeItemFn(item){try{g.PAssert(2420,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}var oldId=item.id,isNewItem=!oldId||g.isLocalItem(item)||!item.data;if(isNewItem){var newId=gdata.createNewItem(item,item.hasChildren(),item.hasArchivedChildren());oldId&&oldId!==newId&&self.modifyItemId(oldId,newId);for(var hasNewChildren=!1,num=item.numItems(),i=0;num>i;++i)hasNewChildren|=self.initializeItem(item.itemAtIndex(i));if(item.hasArchivedChildren())for(var archivedItems=item.archivedItems(!0),i=0;i<archivedItems.length;++i)hasNewChildren|=self.initializeItem(archivedItems[i]);if(item.hasNote()&&(hasNewChildren|=self.initializeItem(item.getNote())),gdata.initializeNewItem(item),oldId&&oldId!==newId){var parent=item.parent();parent&&parent.save(null,SaveFlag.None)}}return isNewItem},self.checkLocalIntegrity=function checkLocalIntegrityFn(callback){ShouldLog(LogLevels.Timing)&&log("Checking Local: ",log.now());var localDataError=!1,localData=!1;self.ensureLocalCache(function(){ShouldLog(LogLevels.Timing)&&log("Verifying Local Data",log.now());var rootSeen=!1,seen={};for(var id in self.dbDataCache)if(self.dbDataCache.hasOwnProperty(id)&&self.getItem(id)){var item=self.getItem(id);(item.i||item.t)&&(log("%cInvalid local properties on item: ","color: red",item),localDataError=!0),seen[item.id]?seen[item.id].exist?(log(item.id,": Duplicated IDs in the local database",item),localDataError=!0):(seen[item.id].exist=!0,seen[item.id].del=!!item.isDeleted):seen[item.id]={exist:!0,ref:!1,del:!!item.isDeleted},item.id===self.rootId&&(rootSeen&&(log(item.id,": Multiple roots present locally",item),localDataError=!0),rootSeen=!0,seen[item.id].isRoot=!0),void 0===item.text&&(log("Found item with no text",item.id),item.text="",self.dbUpdateItem({id:id,changes:{text:""},saveFlags:SaveFlag.None})),item.note&&(seen[item.note]?seen[item.note].ref?(log(item.id,": Item note is used twice - ",item.note),localDataError=!0):seen[item.note].ref=item.id:seen[item.note]={exist:!1,ref:item.id});for(var j=0;item.items&&j<item.items.length;++j){var seenArchived=-1;if(item.items[j]){var child=item.items[j],childInfo=self.getItem(child);if(childInfo){if(childInfo.isArchived&&(seenArchived=j),seenArchived>=0&&!childInfo.isArchived){log(child,": Unarchived child found after an archived one"),log("   ",item.id,": Parent with incorrectly ordered children"),localDataError=!0;var archivedItem=item.items.removeAt(seenArchived);item.items.insert(j,archivedItem),seenArchived=j,self.dbUpdateItem({id:item.id,changes:{items:item.items},saveFlags:SaveFlag.None})}}else log(child,": Child does not have a valid reference on our local database"),localDataError=!0;if(seen[child])if(seen[child].ref){log(child,": Item is referenced locally multiple times: ",childInfo?self.getItem(child).id:"UNDEFINED"),log("   ",seen[child].ref,": ",self.getItem(seen[child].ref).id),log("   ",item.id,": <CLIENTDATA>"),localDataError=!0;var newItems=item.items;newItems.removeAt(j),self.dbUpdateItem({id:id,changes:{items:newItems},saveFlags:SaveFlag.None})}else seen[child].ref=item.id;else seen[child]={exist:!1,ref:item.id}}else log(item.id,": Invalid item in local items array"),localDataError=!0}}rootSeen||(log("No root present"),localDataError=!0);for(var entryID in seen){var entry=seen[entryID];if(!entry.exist){log(entryID,": Item is referenced locally as a child but does not exist in the database");var item=self.getItem(entry.ref);try{g.PAssert(2421,item,"Parent of item must exist")}catch(PERR){g.reportError(PERR)}if(item){var newItems=item.items;newItems?newItems.remove(entryID):newItems=[],self.dbUpdateItem({id:item.id,changes:{items:newItems},saveFlags:SaveFlag.None})}}if(entry.ref||entry.isRoot||entry.del||(log(entryID,": Item exists locally but is not referenced by a parent"),removeItemSubtree(entryID)),entry.ref&&entry.del){log(entryID,": Item is referenced locally by a parent but has been deleted");var item=self.getItem(entry.ref);try{g.PAssert(2422,item)}catch(PERR){g.reportError(PERR)}var newItems=item.items;newItems?newItems.remove(entryID):newItems=[],self.dbUpdateItem({id:item.id,changes:{items:newItems},saveFlags:SaveFlag.None})}if(entry.isRoot&&entry.ref&&(log(entryID,": Local root has a parent"),localDataError=!0),entry.del&&!entry.ref){var item=self.getItem(entryID);g.isLocalItem(item)&&(log("Deleting Unreferenced Local Item: ",entryID),self.dbDeleteItem(entryID))}}ShouldLog(LogLevels.Timing)&&log("Done Verifying Local Data",log.now()),callback({error:localDataError,local:localData})})},self.removeDeletedItems=function removeDeletedItemsFn(remoteSeen){for(var id in self.dbDataCache){var localItem=self.getItem(id);localItem&&localItem.isDeleted&&(remoteSeen[id]||self.dbDeleteItem(id))}},self.defaultSkipSettings={Default:[Settings.authScopes,Settings.activeUser,Settings.shownTutorial,Settings.helpPaneState,Settings.oauthScheme,Settings.premiumStatus,Settings.trialStart,Settings.trialDuration,Settings.theme]},self.addDefaultSkipSetting=function addDefaultSkipSettingFn(key,groupID){self.defaultSkipSettings[groupID]||(self.defaultSkipSettings[groupID]=[]),self.defaultSkipSettings[groupID].push(key)},self.clearDataAndReload=function clearDataAndReloadFn(){self.clearData(function(){setTimeout(g.reload,0)},self.defaultSkipSettings)},self.clearData=function clearDataFn(cb,skip){self.freezeUpdates=!0,g.shouldWriteLocal()?setTimeout(function(){function clearLocalStorage(){self.clearContacts();var skipObj;skipObj=g.isArray(skip)?{Default:skip}:skip,g.settings.resetAll(skipObj),g.vmMain&&g.vmMain.pluginManager&&g.vmMain.pluginManager.onPurgeData(),g.vmMain&&g.vmMain.cacheManager&&g.vmMain.cacheManager.clearLocalCaches(),setTimeout(function(){cb&&cb()},0)}function clearItems(){if(self.dbi.items)try{self.dbi.items.clear().done(function(){clearCaches()}).fail(function(){log("Failed to reset items!"+arguments),clearCaches()})}catch(err){g.reportError(err),clearCaches()}else clearCaches()}function clearCaches(){if(self.dbi.caches)try{self.dbi.caches.clear().done(function(){clearLocalStorage()}).fail(function(){log("Failed to reset items!"+arguments),clearLocalStorage()})}catch(err){g.reportError(err),clearLocalStorage()}else clearLocalStorage()}if(g.pageDataCleared(),!self.dbi)return void self.initializeIndexedDB(function(){self.clearData(cb,skip)});if(self.dbi.settings)try{self.dbi.settings.clear().done(function(){clearItems()}).fail(function(){log("Failed to reset settings!"+arguments),clearItems()})}catch(err){g.reportError(err),clearItems()}else clearItems()},0):cb&&setTimeout(cb,0)};var localContactsLoaded=!1;self.clearLocalContacts=function clearLocalContactsFn(){if(localContactsLoaded=!1,g.shouldWriteLocal())try{util.storage.setItem(DB_CONTACTS,"[]")}catch(err){g.reportError(err)}self.contactManager.clearContacts(),g.settings.set(Settings.lastContactSync,void 0)},self.loadLocalContacts=function loadLocalContactsFn(){if(!localContactsLoaded&&(localContactsLoaded=!0,g.shouldWriteLocal()))try{self.contactManager.loadContacts(JSON.parse(util.storage.getItem(DB_CONTACTS)),!1)}catch(err){g.reportError(err)}},self.areLocalContactsLoaded=function areLocalContactsLoadedFn(){return localContactsLoaded},self.saveContacts=function saveContactsFn(){g.shouldWriteLocal()&&util.storage.setItem(DB_CONTACTS,JSON.stringify(self.contactManager._contacts))},self.clearContacts=function clearContactsFn(){g.settings.reset(Settings.lastContactSync),g.shouldWriteLocal()&&util.storage.removeItem(DB_CONTACTS,void 0)},self.insertItems=function insertItemsFn(item,items,index){try{g.PAssert(2423,item,"Must pass in a valid item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2424,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2425,void 0===index||index>=0,"Must pass in a valid index")}catch(PERR){g.reportError(PERR)}item.save({items:item.getItemsArrayForSave()},SaveFlag.Prop),1===items.length?gdata.itemAdded({item:item,addedItem:items[0],index:index,isArchived:!1}):gdata.itemsAdded({item:item,addedItems:items,index:index,isArchived:!1})},self.removeItem=function removeItemFn(item,index,removedItem,isArchived){try{g.PAssert(2426,item,"Must pass in a valid item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2427,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2428,void 0===index||index>=0,"Must pass in a valid index")}catch(PERR){g.reportError(PERR)}item.save({items:item.getItemsArrayForSave()},SaveFlag.Prop),removedItem&&removedItem.data&&gdata.itemRemoved({item:item,index:index,numToRemove:1,isArchived:isArchived})},self.moveItem=function moveItemFn(params){var item=params.item,newInfo=params.newInfo,oldParent=params.oldParent,oldInfo=params.oldInfo,isRemoteChange=params.isRemoteChange,noVersion=params.noVersion,saveFlags=isRemoteChange?SaveFlag.None:SaveFlag.Prop;try{g.PAssert(2429,void 0!==item&&void 0!==newInfo&&void 0!==oldParent&&void 0!==oldInfo,"moveItem is missing parameters")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2430,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2431,oldParent.shouldSave(),"Old parent must be marked as saveable")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2432,item.parent().shouldSave(),"New parent must be marked as saveable")}catch(PERR){g.reportError(PERR)}oldParent.save({items:oldParent.getItemsArrayForSave()},saveFlags),item.parent().save({items:item.parent().getItemsArrayForSave()},saveFlags),oldInfo.isArchived!==newInfo.isArchived&&(item.isArchived(newInfo.isArchived),item.save({isArchived:newInfo.isArchived},saveFlags)),isRemoteChange||(self.saveChanges(item,{},saveFlags),gdata.itemMoved({item:item,newInfo:newInfo,oldParent:oldParent,oldInfo:oldInfo,noVersion:noVersion}))},self.archiveItem=function archiveItemFn(item,index,archivedItem){try{g.PAssert(2435,item,"Must provide a valid item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2436,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2437,index>=0,"Must have a valid index to remove from")}catch(PERR){g.reportError(PERR)}doArchive(item,archivedItem,!0),archivedItem.data&&gdata.itemArchived(item,archivedItem,index)},self.unarchiveItem=function unarchiveItemFn(item,index,unarchivedItem){try{g.PAssert(2438,item,"Must provide a valid item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2439,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2440,index>=0,"Must have a valid index to remove from")}catch(PERR){g.reportError(PERR)}doArchive(item,unarchivedItem,!1),unarchivedItem.data&&gdata.itemUnarchived(item,unarchivedItem,index,item.numItems()-1)},self.modifyItemId=function modifyItemIdFn(id,newId,callback){var item=self.getItem(id),model=self.getModel(id);try{g.PAssert(2441,model.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}if(item.id=newId,model.id=newId,self.pendingRemoteUpdates[id]&&(self.pendingRemoteUpdates[id]=void 0,self.pendingRemoteUpdates[newId]=!0),item.version=-1,item.versionText=-1,"root"===id)for(var i=item.items.length-1;i>=0;i--){var rootChild=self.getItem(item.items[i]);if(g.isLocalItem(rootChild)&&!rootChild.modifiedOffline&&!rootChild.modifiedOfflineText){item.items.removeAt(i);try{g.PAssert(2442,model.itemAtIndex(i).id===rootChild.id,"Item arrays should match")}catch(PERR){g.reportError(PERR)}model.getItems().removeAt(i)}}self.itemCache[newId]=self.itemCache[id],self.dbDataCache[newId]=item,self.dbDeleteItem(id),self.dbUpdateItem({changes:item,callback:callback,skipLocalModification:!0,saveFlags:SaveFlag.None}),self.dbDataCache[id]=void 0,delete self.dbDataCache[id],self.itemCache[id]=void 0,delete self.itemCache[id]},self.deleteItem=function deleteItemFn(item,changeType){try{g.PAssert(2443,item,"Must provide a valid item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2444,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2445,!item.isDeleted(),"Should never try to delete an item that has already been deleted")}catch(PERR){g.reportError(PERR)}var localItem=self.getItem(item.id);if(localItem)item.isDeleted(!0,changeType),self.dbUpdateItem({id:item.id,changes:{isDeleted:!0},saveFlags:SaveFlag.Prop});else try{g.PAssert(2446,"Expected local item, didnt find one",item.id)}catch(PERR){g.reportError(PERR)}},self.undeleteItem=function undeleteItemFn(item,changeType){var localItem=self.getItem(item.id);if(localItem)item.isDeleted(!1,changeType),self.dbUpdateItem({id:item.id,changes:{isDeleted:void 0},saveFlags:SaveFlag.Prop});else try{g.PAssert(2447,"Expected local item, didnt find one",item.id)}catch(PERR){g.reportError(PERR)}},self.saveChanges=function saveChangesFn(item,changes,saveFlags){if(item){try{g.PAssert(2449,item.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}changes||(changes={}),self.dbUpdateItem({id:item.id,changes:changes,saveFlags:saveFlags})}else{log("Incoming item to save has no item!",item,changes);try{g.PAssert(2448,!1,"Incoming item to save has no item!")}catch(PERR){g.reportError(PERR)}}},self.addPendingUpdate=function addPendingUpdateFn(id){try{g.PAssert(2450,id,"Invalid ID")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2451,g.isString(id),"Must provide a valid id string")}catch(PERR){g.reportError(PERR)}self.pendingRemoteUpdates[id]||(self.pendingRemoteUpdates[id]=!0)},self.clearPendingUpdates=function clearPendingUpdatesFn(){for(var itemID in self.pendingRemoteUpdates){try{g.PAssert(2452,self.pendingRemoteUpdates.hasOwnProperty(itemID))}catch(PERR){g.reportError(PERR)}var item=self.getModel(itemID),itemData=self.getItem(itemID);if(itemData&&itemData.isDeleted)self.dbDeleteItem(itemID);else if(item&&item.data){var changes={modifiedOffline:!1,modifiedOfflineText:!1};item.modifiedOffline=!1,item.modifiedOfflineText=!1;var newVersion=gdata.getVersion(item.data,VersionType.Structure),newTextVersion=gdata.getVersion(item.data,VersionType.Text);newVersion!=item.getVersion(VersionType.Structure)&&(changes.version=newVersion,item.setVersion(VersionType.Structure,newVersion)),newTextVersion!=item.getVersion(VersionType.Text)&&(changes.versionText=newTextVersion,item.setVersion(VersionType.Text,newTextVersion)),self.dbUpdateItem({id:itemID,changes:changes,saveFlags:SaveFlag.None})}}self.pendingRemoteUpdates={},self.printIndexedDB("id","text","version","versionText","modifiedOffline","isArchived")};var charMapJSON={'"':'\\"',"\\":"\\\\"};return self.toHtml=function toHtmlFn(item,allowArchived){var str="<ul>";if(item.items)for(var i=0;i<item.items.length;i++){var child=self.getItem(item.items[i]),model=self.getModel(child.id),text=g.escape(model.getParsedText());(!child.isArchived||child.isArchived&&allowArchived)&&(str+="<li>"+text,child.items&&child.items.length>0&&(str+=self.toHtml(child,allowArchived)),str+="</li>")}return str+="</ul>"},self.toPlainText=function toPlainTextFn(item,indent,allowArchived){isNaN(indent)&&(indent=0);var str="";if(item.items)for(var i=0;i<item.items.length;i++){var child=self.getItem(item.items[i]),model=self.getModel(child.id);if(!child.isArchived||child.isArchived&&allowArchived){for(var u=0;indent>u;u++)str+="	";str+=model.getParsedText()+"\n",child.items&&child.items.length>0&&(str+=self.toPlainText(child,indent+1,allowArchived))}}return str},self.toJSON=function toJSONFn(item,hasPrev,allowArchived){var rootItem=makeJSON(item,hasPrev,allowArchived);return'{"moodoVer":'+(g.settings.get(Settings.localDataVersion)||gdata.currentVersion())+',"moodoRoot":'+rootItem+"}"},self.createRootItem=function createRootItemFn(id){self.setRoot(id),self.dbUpdateItem({changes:{id:id,text:"Home",items:[]},skipLocalModification:!0,saveFlags:SaveFlag.None,callback:function callbackFn(){}})},self.ensureLocalCache=function ensureLocalCacheFn(callback){var root=self.getRootItem();root?(self.loadedItemCount>1&&(self.hasLocalData=!0),callback()):(g.vmMain.isLoadingRemoteDoc.set(!0),callback())},self.printIndexedDB=function printIndexedDBFn(){var args,i,printAll},self}),define("goog",["ko","data","globals","util","gdata","platform"],function(ko,d,g,util,gdata,platform){function showErrorMessage(){g.messageQueue.pushMessage({text:"There was an internal error in Google Drive. Please reload to try again.",action:MessageAction.Reload}),g.vmMain.setGDriveStatus(DriveStatus.Offline)}function openDefaultRealtimeFile(callback){g.vmMain.setGDriveStatus(DriveStatus.Connecting),g.loadGoogleAPI("drive","v2",function(){if(!gapi.client.drive)return void showErrorMessage();var options={getAllPages:!0,maxResults:1},queryString="(title='"+self.LEGACY_DefaultDriveDocTitle+"' or properties has {key='"+self.DefaultProperty+"' and value='"+self.DefaultPropertyValue+"' and visibility='PRIVATE'}) and 'me' in owners and trashed=false",successCB=function(result){0===result.length?createDefaultRealtimeFile(callback):callback(result[0],!1)},failureCB=function(result){showErrorMessage()
};g.vmMain.remoteAPI().driveFilesList(queryString,successCB,failureCB,options)})}function createDefaultFileStructure(cb){try{g.PAssert(2487,!g.isDemoMode(),"Should not be creating file structure in demo mode")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2488,void 0===rootFolderID,"Must not already have a root folder")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2489,cb,"Must supply a valid callback when done creating the default file structure")}catch(PERR){g.reportError(PERR)}var requestFn=gapi.client.drive.files.insert,requestData={resource:{mimeType:self.FOLDER_MIMETYPE,title:self.DefaultFolderTitle,writersCanShare:!1,folderColorRgb:"#FF7537",properties:[{key:self.DefaultRootFolderProperty,value:self.DefaultRootFolderPropertyValue,visibility:"PRIVATE"}]}},successCB=function(result){return cb(result.id)},failureCB=function(result){return cb()};g.vmMain.remoteAPI().runRemoteSingleRequest(requestFn,requestData,successCB,failureCB)}function createDefaultRealtimeFile(callback){var defaultDoc=g.vmMain.docManager.createNewDoc();self.createAndSetupDocument(defaultDoc,!0,function(docInfo){if(!docInfo||docInfo.error)showErrorMessage();else{g.vmMain.docManager.setDoc(defaultDoc);var loadFileID=util.getURLParam("file");if(loadFileID)try{try{g.PAssert(2493,gapi.drive,"gapi.drive should exist")}catch(PERR){g.reportError(PERR)}util.removeURLParam("file");var openingDoc=g.vmMain.docManager.loadDocFromData({id:loadFileID},!1);openingDoc.open(),self.setDocInfo(loadFileID,void 0),gdata.driveRealtimeLoad(loadFileID,onDocLoaded,onDocInitialized,onDocLoadError);try{window.__LOAD_REQUESTS.push(g.getCurrentStack("File Request After Default Load"))}catch(err){g.reportError(err)}}catch(err){g.reportError(err)}else callback(docInfo,!0)}})}function onFirstDocInitialized(doc){log("First Run Drive Document"),onDocInitialized(doc),self.onHaveUserSignupData(function(){g.sendEvent("Subscribe","NewUser"),g.reportSignup(self.getCurrentUserEmail(),self.getCurrentUserSignupInfo())})}function onDocInitialized(doc){log("Drive Document Initialized"),gdata.onInitialized(doc),self.onHaveUserSignupData(function(){g.sendEvent("Documents","CreateNew")})}function onDocLoaded(doc){ShouldLog(LogLevels.Timing)&&log("Drive document load started: ",log.now()),g.vmMain.setGDriveStatus(DriveStatus.Saved);var success=gdata.onLoad(doc);if(success){ShouldLog(LogLevels.Timing)&&log("Drive document load done: ",log.now()),self.startWatchdog();var folderID=doc.getModel().getRoot().get("docFolderID");if(!folderID){var openDoc=g.vmMain.docManager.getOpenDoc();try{g.PAssert(2501,openDoc,"Must have an open doc to load a realtime doc")}catch(PERR){g.reportError(PERR)}openDoc.getDocumentFolder(function(newFolderID){doc.getModel().getRoot().set("docFolderID",newFolderID)})}self.isLoaded=!0,g.fireCustomEvent("docLoaded")}}function onDocLoadError(e){switch(ShouldLog(LogLevels.Error)&&log("Doc Load Error - ",JSON.stringify(e)),e.type){case gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED:try{g.PAssert(2502,!e.isFatal,"Token refresh required causes a non-fatal error")}catch(PERR){g.reportError(PERR)}self.recoverFromError();break;case gapi.drive.realtime.ErrorType.INVALID_COMPOUND_OPERATION:try{g.PAssert(2503,e.isFatal,"Invalid compound operation causes a fatal error")}catch(PERR){g.reportError(PERR)}ShouldLog(LogLevels.Error)&&log("RealtimeAPI Error: ["+e.type+"] Fatal: "+e.isFatal),g.reportError(new Error("Invalid Compound Operation: "+g.safeStringify(e)));break;case gapi.drive.realtime.ErrorType.CONCURRENT_CREATION:case gapi.drive.realtime.ErrorType.CLIENT_ERROR:ShouldLog(LogLevels.Error)&&log("RealtimeAPI Error: ["+e.type+"] Fatal: "+e.isFatal),g.reportError(new Error("Client Error: "+g.safeStringify(e))),self.clearDocInfo(),findAndLoadDoc();break;case gapi.drive.realtime.ErrorType.FORBIDDEN:case gapi.drive.realtime.ErrorType.NOT_FOUND:ShouldLog(LogLevels.Error)&&log("Unable to access or find the requested document"),g.reportError(new Error("DocError Forbidden/NotFound: "+g.safeStringify(e))),e.type===gapi.drive.realtime.ErrorType.FORBIDDEN?g.menus.alert({text:"Moo.do has lost access to your document. If the problem persists, please contact support@moo.do.",actionText:"RELOAD",action:d.clearDataAndReload}):e.type===gapi.drive.realtime.ErrorType.NOT_FOUND&&g.menus.alert({text:"Moo.do cannot find your document. If the problem persists, please contact support@moo.do.",actionText:"RELOAD",action:d.clearDataAndReload});break;case gapi.drive.realtime.ErrorType.SERVER_ERROR:ShouldLog(LogLevels.Error)&&log("Received server error: "+g.safeStringify(e)),e.isFatal&&g.vmMain.setGDriveStatus(DriveStatus.Offline);break;default:ShouldLog(LogLevels.Error)&&log("Unkown Doc Error - "+g.safeStringify(e)),g.reportError(new Error("Unknown Doc Error: "+g.safeStringify(e)))}return e.isFatal}function loadDoc(id,title,newDoc){if(id){ShouldLog(LogLevels.Timing)&&log("Drive document requested: ",log.now());var openingDoc=g.vmMain.docManager.loadDocFromData({id:id,title:title},!1);openingDoc.open(),self.setDocInfo(id,title);try{var initFn=newDoc?onFirstDocInitialized:onDocInitialized;gdata.driveRealtimeLoad(id,onDocLoaded,initFn,onDocLoadError);try{window.__LOAD_REQUESTS.push(g.getCurrentStack("Normal Load ["+newDoc+"]"))}catch(err){g.reportError(err)}}catch(err){self.recoverFromError(err)}}else findAndLoadDoc()}function findAndLoadDoc(){openDefaultRealtimeFile(function(docInfo,newDoc){docInfo&&docInfo.id?loadDoc(docInfo.id,docInfo.title,newDoc):g.reportError(new Error("We should always find a valid document with a defined id")),newDoc&&g.fireCustomEvent("firstRun")})}function runUnlinkBatches(batchesArr,cb){function runBatch(index){batchesArr[index].then(function(response){batchesArr.length>index+1?setTimeout(function(){runBatch(index+1)},unlinkBatchTimeout):cb(!0)},function(){cb(!1)})}return 0===batchesArr.length?cb(!0):void runBatch(0)}function unlinkFolder(folderID,cb){var options={getAllPages:!0,maxPageResults:500},successCB=function(result){try{if(result.length>0){for(var batch=gapi.client.newBatch(),i=0;i<result.length;++i){var req=gapi.client.drive.children.delete({folderId:folderID,childId:result[i].id});batch.add(req)}cb(batch)}else cb(void 0)}catch(err){g.reportError(err),cb(void 0)}},failureCB=function(result,partialResponse){cb(void 0)};g.vmMain.remoteAPI().driveChildrenList(folderID,successCB,failureCB,options)}function saveAuthorizedScopes(){for(var scopeArr=[],i=0;i<authorizedScopes.length;++i){var scopeIndex=self.scopes.indexOf(authorizedScopes[i]),forceNoSave=noSaveScopes.indexOf(authorizedScopes[i])>=0;scopeIndex>=0&&!forceNoSave&&scopeArr.push(scopeIndex)}var saveString=JSON.stringify(scopeArr);g.settings.set(Settings.authScopes,saveString)}function handleContactsLoaded(numContacts){numContacts>0&&g.vmMain.runParseWorkerNewContacts()}function getAccessTokenInternal(){var token;if(!window.gapi||!window.gapi.auth)return void 0;try{var gapiToken=gapi.auth.getToken();gapiToken&&(token=gapiToken.access_token)}catch(err){self.recoverFromError(err)}return token}function setExternalAccessTokenInternal(){try{g.PAssert(2517,void 0!==externalToken,"Should always have a valid token value")}catch(PERR){g.reportError(PERR)}gapi.auth.setToken(externalToken)}function lockOAuthScheme(){isOAuthSchemeLocked=!0,g.settings.set(Settings.oauthScheme,currentOAuthSchemeType)}function getBestOAuthScheme(){for(var i=OAuthSchemeType.Count;i>=0;i--)if(availableOAuthSchemes[i])return i}function tokenRequestFilter(authFn){return function(config,cb){authFn(config,function(token){token&&!token.error&&lockOAuthScheme(),cb(token)})}}function setupOAuthScheme(){try{g.PAssert(2521,!isOAuthSchemeLocked,"Should not be setting up OAuth if locked into the current scheme")}catch(PERR){g.reportError(PERR)}if(!isOAuthSchemeLocked){var scheme=getBestOAuthScheme();if(scheme!==currentOAuthSchemeType)switch(currentOAuthSchemeType=scheme,scheme){case OAuthSchemeType.None:OAuthScheme={authorize:tokenRequestFilter(self.requestNoneOAuth)};break;case OAuthSchemeType.Web:try{g.PAssert(2522,self.isAuthAPILoaded(),"GAPI Auth should always be valid at this point")}catch(PERR){g.reportError(PERR)}OAuthScheme={authorize:tokenRequestFilter(gapi.auth.authorize)};break;case OAuthSchemeType.Native:OAuthScheme={authorize:tokenRequestFilter(self.requestNativeOAuth)};break;default:try{g.PAssert(2523,!1,"Invalid OAuth scheme type")}catch(PERR){g.reportError(PERR)}}}}function frameIdx(frame){return parseInt(frame.id.split("_")[1])}function handleAuthorization(token,callback){if(token&&!token.error){try{g.PAssert(2525,token.scope,"Scopes must be valid")}catch(PERR){g.reportError(PERR)}g.isString(token.scope)&&(token.scope=token.scope.split(" ")),self.getActiveUser();var oldAuthorizedScopes=authorizedScopes,newAuthorizedScopes=ko.utils.arrayGetDistinctValues(token.scope);authorizedScopes=newAuthorizedScopes,oldAuthorizedScopes.equals(newAuthorizedScopes)||saveAuthorizedScopes();var expireMS=1e3*(parseInt(token.expires_in)-600);log("Token expires in",expireMS/1e3),authorizedUntil=Date.now()+expireMS,clearTimeout(refreshAuthorizationTimer),refreshAuthorizationTimer=setTimeout(function(){refreshAuthorization()},expireMS),lastRefreshWait=DEFAULT_REFRESH_WAIT,gdata.poke(),g.vmMain&&(g.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.GoogleLogin,authorizedScopes),g.vmMain.realtimeDocManager.notifyGoogleAuthorization(authorizedScopes),g.notifyUserAuthorized()),setTimeout(function(){for(var iframes=document.getElementsByTagName("iframe"),i=0;i<iframes.length;++i)if(iframes[i].src.startsWith("https://accounts.google.com/o/oauth2/auth?"))if(""===iframes[i].id)iframes[i].id="auth_"+authIndex++;else{var idx=frameIdx(iframes[i]);idx!==authIndex&&idx!==authIndex-1&&iframes[i].parentElement.removeChild(iframes[i])}},0)}else log("Error authorizing token: "+(token?token.error:"UNDEFINED"));callback&&callback(token)}function refreshAuthorization(cb){if(!OAuthScheme||!OAuthScheme.authorize)return cb(void 0),!1;try{g.PAssert(2528,authorizedScopes.length>=self.requiredScopes.length,"We lost some required scopes somewhere...")}catch(PERR){g.reportError(PERR)}refreshingAuth=!0;var tokenString,currentToken,userId=self.getCurrentUserEmail()||g.settings.get(Settings.activeUser),config={client_id:self.CLIENT_ID,scope:authorizedScopes,immediate:!0,login_hint:userId,authuser:-1};return OAuthScheme.authorize(config,function(token){tokenRefreshed=!0,refreshingAuth=!1,handleAuthorization(token,cb)}),!0}function tryToLoadGapi(){if(self.isRealtimeAPILoaded())isLoadingScript=!1;else{var oldScript=document.getElementById("gapiScript");oldScript&&oldScript.parentNode.removeChild(oldScript),g.addScript("https://apis.google.com/js/client.js?onload=GoogleApiLoaded","gapiScript",function(){isLoadingScript=!1}),numTriesLoad-->0?setTimeout(tryToLoadGapi,RELOAD_TIMEOUT):isLoadingScript=!1}}function tryToRefreshToken(cb){tokenRefreshed?(g.vmMain.setGDriveStatus(DriveStatus.Saved),g.messageQueue.clearMessage(MessageID.ConnectionError),cb&&cb()):(refreshAuthorization(),setTimeout(function(){tryToRefreshToken(cb)},RELOAD_TIMEOUT))}var self={CLIENT_ID:"597847337936.apps.googleusercontent.com",eventSubscribers:[],authenticatedUserInfo:ko.observable()};g.goog=self;var DEFAULT_REFRESH_WAIT=1e4,MAX_REFRESH_WAIT=16e4;self.APP_ID="597847337936",self.REALTIME_MIMETYPE="application/vnd.google-apps.drive-sdk",self.FOLDER_MIMETYPE="application/vnd.google-apps.folder",self.MoodoMimetype=self.REALTIME_MIMETYPE+"."+self.APP_ID,window.GScope={Calendar:"https://www.googleapis.com/auth/calendar",CalendarRO:"https://www.googleapis.com/auth/calendar.readonly",Contacts:"https://www.googleapis.com/auth/contacts.readonly",Drive:"https://www.googleapis.com/auth/drive.file",UserInfoEmail:"https://www.googleapis.com/auth/userinfo.email",DriveFull:"https://www.googleapis.com/auth/drive",TasksRO:"https://www.googleapis.com/auth/tasks.readonly",UserInfoProfile:"https://www.googleapis.com/auth/userinfo.profile",DriveInstall:"https://www.googleapis.com/auth/drive.install",DriveAppData:"https://www.googleapis.com/auth/drive.appdata",DriveMetadataRO:"https://www.googleapis.com/auth/drive.metadata.readonly",GmailRO:"https://www.googleapis.com/auth/gmail.readonly",GmailCompose:"https://www.googleapis.com/auth/gmail.compose"};var noSaveScopes=[GScope.TasksRO];self.LEGACY_DefaultDriveDocTitle="DuchessBeta",self.DefaultDocTitle="Moo.do Personal Document",self.DefaultFolderTitle="_Moo.do Shared Files (Do not delete)",self.DefaultProperty="MooDoDefault",self.DefaultPropertyValue="TRUE",self.DefaultRootFolderProperty="MooDoDefaultRoot",self.DefaultRootFolderPropertyValue="TRUE",self.DocFolderTitlePrefix="Moodo_",self.DocFolderProperty="MooDoFolder",self.DocFolderPropertyPrefix="MDSF_",self.DocFolderTitleProperty="MooDoTitle",self.requiredScopes=[GScope.Drive,GScope.UserInfoEmail,GScope.DriveInstall,GScope.DriveAppData],self.requestScopes=[],self.scopes=[GScope.Calendar,GScope.CalendarRO,GScope.Contacts,GScope.Drive,GScope.UserInfoEmail,GScope.DriveFull,GScope.UserInfoProfile,GScope.DriveInstall,GScope.DriveAppData,GScope.DriveMetadataRO,GScope.GmailRO];var authorizedScopes=[];self.getAuthorizedScopes=function getAuthorizedScopesFn(){return authorizedScopes};var docFields="items(id,title,properties)";self.isLoaded=!1,self.init=function initFn(){self.isAuthAPILoaded()?self.addOAuthMethod(OAuthSchemeType.Web):window.addEventListener("gapiLoaded",function(){self.addOAuthMethod(OAuthSchemeType.Web)});var lastOAuthScheme=g.settings.get(Settings.oauthScheme);if(void 0!==lastOAuthScheme&&lastOAuthScheme!=OAuthSchemeType.Web)try{var scheme=parseInt(lastOAuthScheme);self.addOAuthMethod(scheme)}catch(err){g.reportError(err)}setupOAuthScheme();var savedScopesString=g.settings.get(Settings.authScopes);if(savedScopesString){var savedScopes;try{savedScopes=JSON.parse(savedScopesString)}catch(err){g.reportError(err)}if(savedScopes){for(var i=0;i<savedScopes.length;++i){try{g.PAssert(2461,savedScopes[i]>=0,"Each saved scope should be a valid array index")}catch(PERR){g.reportError(PERR)}savedScopes[i]>=0&&self.requestScopes.push(self.scopes[savedScopes[i]])}self.requestScopes=ko.utils.arrayGetDistinctValues(self.requestScopes)}}else self.requestScopes=self.requiredScopes;authorizedScopes=self.requestScopes,platform.syncContacts&&util.getURLParam("access_token")&&!util.hasURLParam("error")&&(authorizedScopes.indexOf(GScope.Contacts)<0&&(authorizedScopes.push(GScope.Contacts),saveAuthorizedScopes()),g.settings.set(Settings.syncContacts,!0)),g.settings.registerForChangeNotification(Settings.syncContacts,void 0,function(oldValue,newValue){newValue&&self.authAndLoadContacts(!1,function(success){g.settings.set(Settings.syncContacts,success)})});try{g.PAssert(2462,void 0===self.authenticatedUserInfo(),"We should not have user info when initing goog")}catch(PERR){g.reportError(PERR)}var authGASub=self.authenticatedUserInfo.subscribe(function(newValue){void 0!==newValue&&(window.ga&&ga("set","&uid",g.getAnonUserIdentifier()),authGASub.dispose(),authGASub=void 0)})},self.ensureRequiredScopesAreRequested=function ensureRequiredScopesAreRequestedFn(){for(var needsAdditionalScopes=!1,i=0;i<self.requiredScopes.length;++i)if(authorizedScopes.indexOf(self.requiredScopes[i])<0){needsAdditionalScopes=!0;break}needsAdditionalScopes&&self.runAuthenticate(self.requiredScopes,!0,!1,function(token){!token||token.error?g.messageQueue.pushMessage({text:"We need additional permissions to give you the best experience.",actionText:"AUTHORIZE",action:function actionFn(){self.runAuthenticate(self.requiredScopes,!1,!1,function(token2){(!token2||token2.error)&&g.messageQueue.pushMessage({text:"There was an error authenticating. Please try again.",actionText:"AUTHORIZE",action:self.ensureRequiredScopesAreRequested})})}}):saveAuthorizedScopes()})},self.onHaveUserSignupData=function onHaveUserSignupDataFn(cb){if(self.authenticatedUserInfo())setTimeout(cb,0);else var infoSub=self.authenticatedUserInfo.subscribe(function(){infoSub.dispose(),infoSub=void 0,setTimeout(cb,0)})},self.getCurrentUserFirstName=function getCurrentUserFirstNameFn(){return self.authenticatedUserInfo()?self.authenticatedUserInfo().given_name:void 0},self.getCurrentUserLastName=function getCurrentUserLastNameFn(){return self.authenticatedUserInfo()?self.authenticatedUserInfo().family_name:void 0},self.getCurrentUserEmail=function getCurrentUserEmailFn(){return self.authenticatedUserInfo()?self.authenticatedUserInfo().email:void 0},self.getCurrentUserSignupInfo=function getCurrentUserSignupInfoFn(){var signupInfo={full:self.authenticatedUserInfo(),fname:self.getCurrentUserFirstName(),lname:self.getCurrentUserLastName()};return signupInfo},self.getUserName=function getUserNameFn(info){try{info.fname=self.getCurrentUserFirstName(),info.lname=self.getCurrentUserLastName()}catch(err){info.nameError=!0}};var watchdogWait=96e4,watchdogInterval;self.startWatchdog=function startWatchdogFn(){watchdogInterval||(watchdogInterval=setInterval(self.watchdogFn,watchdogWait))},self.stopWatchdog=function stopWatchdogFn(){clearInterval(watchdogInterval),watchdogInterval=void 0};var lastWatchdogTime=0;self.watchdogFn=function watchdogFnFn(){var currentTime=Date.now();if(lastWatchdogTime-currentTime>=watchdogWait){try{var token=gapi.auth.getToken();if(token){var expireTime=1e3*parseInt(token.expires_at);currentTime>expireTime?(ShouldLog(LogLevels.Error)&&log("Active token is no longer valid: "+currentTime+" vs. "+expireTime),refreshAuthorization(),g.reportError(new Error("Watchdog found expired token on client"))):gdata.poke()}else ShouldLog(LogLevels.Error)&&log("No active token on client!"),refreshAuthorization(),g.reportError(new Error("Watchdog found client with no token set"))}catch(err){g.reportError(err)}finally{lastWatchdogTime=currentTime}g.checkForRemoteChanges()}},self.hasPermission=function hasPermissionFn(scope){return authorizedScopes.indexOf(scope)>-1};var refreshAuthorizationTimer,authorizedUntil,refreshingAuth=!0;self.onFocusHandler=function onFocusHandlerFn(){authorizedUntil&&Date.now()>authorizedUntil&&!refreshingAuth&&refreshAuthorization()},self.onBlurHandler=function onBlurHandlerFn(){refreshAuthorizationTimer&&clearTimeout(refreshAuthorizationTimer)},self.getContactInfo=function getContactInfoFn(name,callback){function handleResponse(xhr){if(200!==xhr.status)callback();else{var obj=JSON.parse(xhr.responseText);try{g.settings.set(Settings.lastContactSync,new Date(obj.feed.updated.$t))}catch(err){g.reportError(err)}callback(obj)}}var accessToken=getAccessTokenInternal();if(!accessToken)return void callback(void 0);var lastSync,url="https://www.google.com/m8/feeds/contacts/default/full?v=3.0&alt=json";name?url+='&q="'+name+'"':lastSync=g.settings.get(Settings.lastContactSync);var forceLoad=d.areLocalContactsLoaded()&&0===d.contactManager.numContacts();if(lastSync&&!forceLoad){var syncDate=new Date(lastSync);url+="&updated-min="+syncDate.toString("yyyy-MM-ddTHH:mm:ss")}url+="&max-results=10000",url+="&access_token="+accessToken,g.XHR({type:"GET",url:url,cb:handleResponse})},self.loadedContacts=!1,self.loadContacts=function loadContactsFn(callback){if(!self.loadedContacts){self.loadedContacts=!0,d.loadLocalContacts();var loadedContacts=d.contactManager.numContacts();self.getContactInfo(void 0,function(data){if(!data)return void callback(-1);log("Loading Remote Contacts!",parseInt(data.feed.openSearch$totalResults.$t));var contactCount=0;if(data&&data.feed&&data.feed.entry&&data.feed.entry.length){contactCount=data.feed.entry.length;for(var entries=data.feed.entry,i=0;i<entries.length;i++){var entry=entries[i],contact={id:/\/([^\s\/]+$)/gi.exec(entry.id.$t)[1],text:""};if(entry.gd$name&&entry.gd$name.gd$fullName){var text=entry.gd$name.gd$fullName.$t;contact.text=text,"'"===contact.text[0]&&(contact.text=contact.text.substr(1))}if(entry.gd$email){var emails=entry.gd$email;contact.emails=emails;for(var u=0;u<emails.length;u++)delete contact.emails[u].rel,!contact.text&&contact.emails[u].primary&&(contact.text=contact.emails[u].address);!contact.text&&emails.length>0&&(contact.text=contact.emails[0].address)}if(entry.gd$phoneNumber){var phoneNumbers=entry.gd$phoneNumber;contact.phoneNumbers=[];for(var u=0;u<phoneNumbers.length;u++){var phoneNumber={number:phoneNumbers[u].$t};phoneNumber.type=phoneNumbers[u].rel?phoneNumbers[u].rel.replace("http://schemas.google.com/g/2005#",""):phoneNumbers[u].label,contact.phoneNumbers.push(phoneNumber)}}contact.text&&(0===loadedContacts?d.contactManager.addContact(contact):d.contactManager.updateContact(contact))}}contactCount>0&&d.saveContacts(),callback&&callback(contactCount)})}},self.setDocInfo=function setDocInfoFn(id,title){g.settings.set(Settings.gdocId,id),g.settings.set(Settings.gdocTitle,title)},self.getDocId=function getDocIdFn(){return g.vmMain.docManager.getOpenDoc().id},self.clearDocInfo=function clearDocInfoFn(){g.settings.reset(Settings.gdocId),g.settings.reset(Settings.gdocTitle)};var rootFolderID;self.getRootFolder=function getRootFolderFn(cb){function ensureRootFolderProps(folderInfo){}function createRootFolder(){createDefaultFileStructure(function(rootID){return rootID?(rootFolderID=rootID,g.settings.set(Settings.rootFolderId,rootFolderID),cb(rootFolderID)):cb()})}try{g.PAssert(2476,!g.isDemoMode(),"Should not be creating file structure in demo mode")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2477,cb,"Must provide a valid callback when getting the root folder")}catch(PERR){g.reportError(PERR)}if(rootFolderID)return cb(rootFolderID);var folderID=g.settings.get(Settings.rootFolderId);if(folderID){var successCB=function(result){return result?(rootFolderID=folderID,ensureRootFolderProps(result),cb(folderID)):void createRootFolder()},failureCB=function(result){return g.settings.set(Settings.rootFolderId,void 0),result&&result.error&&404===result.error.code?void createRootFolder():cb()};g.vmMain.remoteAPI().driveFilesGet(folderID,successCB,failureCB)}else{var q="properties has {key='"+self.DefaultRootFolderProperty+"' and value='"+self.DefaultRootFolderPropertyValue+"' and visibility='PRIVATE'} and 'me' in owners and trashed=false",options={getAllPages:!0},successCB=function(result){if(result.length>0){try{g.PAssert(2478,1===result.length,"Must have a single root folder present")}catch(PERR){g.reportError(PERR)}var rootFolderInfo=result[0];return rootFolderID=rootFolderInfo.id,g.settings.set(Settings.rootFolderId,rootFolderID),ensureRootFolderProps(rootFolderInfo),cb(rootFolderInfo.id)}createRootFolder()},failureCB=function(result){return cb()};g.vmMain.remoteAPI().driveFilesList(q,successCB,failureCB,options)}},self.createAndSetupDocument=function createAndSetupDocumentFn(doc,isDefault,cb){try{g.PAssert(2494,cb,"Must pass in a valid creation callback")}catch(PERR){g.reportError(PERR)}g.loadGoogleAPI("drive","v2",function(){var props;isDefault&&(props=[{key:self.DefaultProperty,value:self.DefaultPropertyValue,visibility:"PRIVATE"}]);var requestFn=gapi.client.drive.files.insert,requestData={fields:"createdDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,userPermission(id,role,type)",resource:{mimeType:self.REALTIME_MIMETYPE,title:doc.getTitle()||self.DefaultDocTitle,writersCanShare:!1,properties:props}},successCB=function(result){doc.updateData(result),doc.createDocumentFileStructure(function(folderInfo){return cb(result)})},failureCB=function(result){return cb(void 0)};g.vmMain.remoteAPI().runRemoteSingleRequest(requestFn,requestData,successCB,failureCB)})};var lastRefreshWait=DEFAULT_REFRESH_WAIT;self.recoverFromError=function recoverFromErrorFn(err){err&&(ShouldLog(LogLevels.Error)&&log("GDrive Error: ",err),g.reportError(err)),g.vmMain.setGDriveStatus(DriveStatus.Connecting),refreshAuthorization(function(token){if(!token||token.error){g.messageQueue.pushMessage(MessageID.ConnectionError),g.vmMain.setGDriveStatus(DriveStatus.Offline);var errorMessage="Unable to refresh authentication token - ",sendReport=!0;token?(errorMessage+=token.error,"immediate_failed"===token.error&&(sendReport=!1)):errorMessage+="No Token",sendReport?g.reportError(new Error(errorMessage)):ShouldLog(LogLevels.Error)&&log("Refresh Auth Failed: ",errorMessage),MAX_REFRESH_WAIT>lastRefreshWait&&(setTimeout(self.recoverFromError,lastRefreshWait),lastRefreshWait*=2)}})};var activeUserRequestQueue=[],activeUserRequested=!1;self.getActiveUser=function getActiveUserFn(cb){if(self.getAccessToken(!0))if(self.getCurrentUserEmail()){try{g.PAssert(2504,0===activeUserRequestQueue.length,"If we have the current user data, the request queue should be empty")}catch(PERR){g.reportError(PERR)}cb&&cb(self.getCurrentUserEmail())}else cb&&activeUserRequestQueue.push(cb),activeUserRequested||(activeUserRequested=!0,g.XHR({type:"GET",url:"https://www.googleapis.com/oauth2/v2/userinfo?alt=json&access_token="+self.getAccessToken(!0),autoRetry:!0,cb:function cbFn(xhr){if(activeUserRequested=!1,200===xhr.status){var userInfoParsed={};try{userInfoParsed=JSON.parse(xhr.responseText)}catch(err){g.reportError(new Error("Error parsing user info"),xhr.responseText)}self.authenticatedUserInfo(userInfoParsed);for(var i=0;i<activeUserRequestQueue.length;++i)activeUserRequestQueue[i](self.getCurrentUserEmail());activeUserRequestQueue=[]}}}));else cb&&activeUserRequestQueue.push(cb)};var loadedClientDefaultFile=!1;self.loadClientDefaultFile=function loadClientDefaultFileFn(){var mainLoaded=!!g.vmMain,driveLoaded=!!window.gapi&&!!window.gapi.drive&&!!window.gapi.drive.realtime;if(!loadedClientDefaultFile&&mainLoaded&&driveLoaded){var token=getAccessTokenInternal();if(token&&g.getLoginState()==LoginState.LOGGED_IN)return g.checkpoint(Checkpoint.LoadDefaultFile),loadedClientDefaultFile=!0,ShouldLog(LogLevels.Timing)&&log("Loading Default Client File: ",log.now()),g.vmMain.setGDriveStatus(DriveStatus.Connecting),self.getActiveUser(function(newUser){try{g.PAssert(2505,newUser,"The authenticated user should always be valid",newUser,g.settings.get(Settings.activeUser))}catch(PERR){g.reportError(PERR)}var prevUser=g.settings.get(Settings.activeUser);prevUser&&newUser&&newUser!==prevUser?d.clearData(function(){g.reload()}):!prevUser&&newUser&&g.settings.set(Settings.activeUser,newUser)}),loadDoc(g.settings.get(Settings.gdocId),g.settings.get(Settings.gdocTitle),!1),self.loadCalendarAndContacts(),!0}return!1},self.reconnectToActiveDocument=function reconnectToActiveDocumentFn(){var mainLoaded=!!g.vmMain,driveLoaded=!!window.gapi&&!!window.gapi.drive&&!!window.gapi.drive.realtime,isLoggedIn=g.getLoginState()==LoginState.LOGGED_IN,token=getAccessTokenInternal();try{g.PAssert(2506,!gdata.isConnected(),"Should not try to reconnect if gdata is still connected")}catch(PERR){g.reportError(PERR)}mainLoaded&&driveLoaded&&isLoggedIn&&token&&!gdata.isConnected()&&!g.vmMain.isReconnecting()&&(g.vmMain.setGDriveStatus(DriveStatus.Reconnecting),g.isReconnected=!0,loadDoc(g.settings.get(Settings.gdocId),g.settings.get(Settings.gdocTitle),!1))},self.deleteAppDataFiles=function deleteAppDataFilesFn(cb){var successCB=function(result){for(var appBatch=gapi.client.newBatch(),numInAppBatch=0,i=0;i<result.length;++i){var req=gapi.client.drive.files.trash({fileId:result[i].id});appBatch.add(req),numInAppBatch++}numInAppBatch>0?appBatch.then(function(response){cb(!0)},function(){cb(!1)}):cb(!0)},failureCB=function(result,partialResponse){cb(!1)},q="'appfolder' in parents",options={getAllPages:!0};g.vmMain.remoteAPI().driveFilesList(q,successCB,failureCB,options)},self.deleteAllFiles=function deleteAllFilesFn(fileList,cb){for(var batch=gapi.client.newBatch(),numInBatch=0,i=0;i<fileList.length;++i)if(fileList[i].hasDriveBacking()){var fileData=fileList[i].getData();if(fileData.userPermission&&"owner"===fileData.userPermission.role){var req=gapi.client.drive.files.trash({fileId:fileList[i].id});batch.add(req),numInBatch++}}numInBatch>0?batch.then(function(response){self.deleteAppDataFiles(cb)},function(){cb(!1)}):self.deleteAppDataFiles(cb)},self.DeleteErrorCode={None:0,RootFolder:1,UnlinkFailure:2,UnlinkException:3,MissingFolders:4,FolderException:5,MissingRoot:6};var unlinkBatchTimeout=1500;self.deleteAccount=function deleteAccountFn(cb){var numFoldersBatched=0,expectedFoldersBatched=0,unlinkBatches=[];self.getRootFolder(function(rootFolderID){function trashRootFolder(cb){gapi.client.drive.files.trash({fileId:rootFolderID}).execute(function(trashResponse){!trashResponse||trashResponse.error?cb(!1,self.DeleteErrorCode.RootFolder):cb(!0,self.DeleteErrorCode.None)})}if(rootFolderID){var q="'"+rootFolderID+"' in parents",options={getAllPages:!0,maxPageResults:999},successCB=function(result){try{if(expectedFoldersBatched=result.length,expectedFoldersBatched>0)for(var i=0;i<result.length;++i){var folderInfo=result[i];"owner"===folderInfo.userPermission.role?unlinkFolder(folderInfo.id,function(batch){batch&&unlinkBatches.push(batch),++numFoldersBatched===expectedFoldersBatched&&runUnlinkBatches(unlinkBatches,function(unlinkSuccess){try{unlinkSuccess?trashRootFolder(cb):cb(!1,self.DeleteErrorCode.UnlinkFailure)}catch(unlinkErr){g.reportError(unlinkErr),cb(!1,self.DeleteErrorCode.UnlinkException)}})}):expectedFoldersBatched--}else trashRootFolder(cb)}catch(err){g.reportError(err),cb(!1,self.DeleteErrorCode.FolderException)}},failureCB=function(result,partialresponse){cb(!1,self.DeleteErrorCode.MissingFolders)};g.vmMain.remoteAPI().driveFilesList(q,successCB,failureCB,options)}else cb(!1,self.DeleteErrorCode.MissingRoot)})},self.authAndLoadContacts=function authAndLoadContactsFn(retry,cb){g.settings.get(Settings.syncContacts)&&(authorizedScopes.indexOf(GScope.Contacts)<0?self.runAuthenticate([GScope.Contacts],!0,retry,function(token){!token||token.error?(g.messageQueue.pushMessage(MessageID.LostPermission),g.settings.set(Settings.syncContacts,!1),cb&&cb(!1)):self.loadContacts(function(numContacts){handleContactsLoaded(numContacts),cb&&numContacts>0&&cb(!0)})}):self.loadContacts(function(numContacts){handleContactsLoaded(numContacts),cb&&numContacts>0&&cb(!0)}))},self.authDocSharing=function authDocSharingFn(){},self.loadCalendarAndContacts=function loadCalendarAndContactsFn(){window.gapi&&self.authAndLoadContacts(!1)},window.__LOAD_HANDLES=g.createRingBuffer(5),window.__LOAD_REQUESTS=g.createRingBuffer(5),self.checkTokenInHash=function checkTokenInHashFn(){var setToken=!1;if(util.hasURLParam("access_token"))try{var scopeString=util.getURLParam("scope"),scopes;scopeString&&(scopes=scopeString.split("+"));var token={access_token:util.getURLParam("access_token"),expires_in:util.getURLParam("expires_in"),scope:scopes};gapi.auth.setToken(token),setToken=!0,util.removeURLParam("access_token",!0),util.removeURLParam("expires_in",!0),util.removeURLParam("scope",!0),util.removeURLParam("token_type",!0),util.hasURLParam("login")||util.insertURLParam("login",!0,!0),g.notifyUserAuthorized()}catch(err){g.reportError(err)}return setToken},self.getAccessToken=function getAccessTokenFn(peekOnly){var token=getAccessTokenInternal();return token||peekOnly||self.recoverFromError(),token};var externalToken;self.setExternalAccessToken=function setExternalAccessTokenFn(token){externalToken=token,self.isAuthAPILoaded()?setExternalAccessTokenInternal():window.addEventListener("gapiLoaded",setExternalAccessTokenInternal)};var nativeOAuthCount=0,nativeOAuthRequests={};self.requestNativeOAuth=function requestNativeOAuthFn(config,cb){try{g.PAssert(2518,config,"Must supply valid OAuth config")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2519,cb,"Must specify a callback function for OAuth respose")}catch(PERR){g.reportError(PERR)}var requestId=++nativeOAuthCount,nativeData={id:requestId,scope:config.scope,immediate:config.immediate},wasSent=g.nativeBridge.sendToApp("getOAuth",nativeData);nativeOAuthRequests[requestId]=cb},self.handleNativeOAuthResponse=function handleNativeOAuthResponseFn(data){var requestCallback=nativeOAuthRequests[data.id];
if(requestCallback)nativeOAuthRequests[data.id]=void 0,data.success?(self.setExternalAccessToken(data.token),requestCallback(data.token)):requestCallback(void 0);else try{g.PAssert(2520,!1,"OAuth callback without a valid handler")}catch(PERR){g.reportError(PERR)}};var noneOAuthRequests=[];self.requestNoneOAuth=function requestNoneOAuthFn(config,cb){noneOAuthRequests.push({config:config,cb:cb})};var isOAuthSchemeLocked=!1,availableOAuthSchemes=[];availableOAuthSchemes[OAuthSchemeType.None]=!0;var currentOAuthSchemeType=-1,OAuthScheme;self.addOAuthMethod=function addOAuthMethodFn(method){availableOAuthSchemes[method]||(availableOAuthSchemes[method]=!0,isOAuthSchemeLocked||setupOAuthScheme())},self.runAuthenticate=function runAuthenticateFn(requestScopes,runImmediate,retry,callback){if(!self.isAuthAPILoaded())return callback&&callback(),!1;var userId=self.getCurrentUserEmail()||g.settings.get(Settings.activeUser)||void 0;try{g.PAssert(2524,userId===util.getURLParam("user")||!util.getURLParam("user"),"Do not try to login a user that is not valid")}catch(PERR){g.reportError(PERR)}if(runImmediate&&!userId&&!util.hasURLParam("login",!0))return callback&&callback(),!1;var currentToken;try{currentToken=gapi.auth.getToken()}catch(err){g.reportError(err)}var requiredScopesToRequest;if(currentToken){if(g.isArray(currentToken.scope))requiredScopesToRequest=currentToken.scope.slice();else if(g.isString(currentToken.scope))try{requiredScopesToRequest=currentToken.scope.split(" ")}catch(err){g.reportError(err)}else requiredScopesToRequest=[];var numScopesAdded=0;if(currentToken.scope)for(var i=0;i<requestScopes.length;++i)currentToken.scope.indexOf(requestScopes[i])<0&&(requiredScopesToRequest.push(requestScopes[i]),numScopesAdded++);else requiredScopesToRequest=requestScopes,numScopesAdded=requestScopes.length;0===numScopesAdded&&(requiredScopesToRequest=[])}else requiredScopesToRequest=requestScopes;if(requiredScopesToRequest.length>0){requiredScopesToRequest.indexOf(GScope.DriveFull)>=0&&requiredScopesToRequest.remove(GScope.Drive);var config={client_id:self.CLIENT_ID,scope:requiredScopesToRequest,immediate:runImmediate,login_hint:userId,authuser:-1};platform.requireCustomRedirect&&!runImmediate&&(config.redirect_uri=platform.customRedirectString,platform.customRedirectState&&(requiredScopesToRequest.indexOf(GScope.Contacts)>=0&&(platform.customRedirectState.syncContacts=!0),config.state=JSON.stringify(platform.customRedirectState))),refreshingAuth=!0;var tokenString;OAuthScheme.authorize(config,function(token){refreshingAuth=!1,ShouldLog(LogLevels.Timing)&&log("GAPI Authorized: ",log.now()),(!token||token.error)&&runImmediate&&retry?self.runAuthenticate(requiredScopesToRequest,!1,!1,callback):(token&&!token.error&&(platform.app||util.hasURLParam("login","true"))&&(g.vmSetup?g.vmSetup.setLoginState(LoginState.LOGGED_IN):g.setLoginState(LoginState.LOGGED_IN),self.loadClientDefaultFile()),handleAuthorization(token,callback))})}else ShouldLog(LogLevels.Error)&&log("Authorization request with no scopes: ",requiredScopesToRequest),callback&&callback(currentToken);return!0};var authIndex=0,tokenRefreshed=!1;self.isAuthAPILoaded=function isAuthAPILoadedFn(){return!!(window.gapi&&window.gapi.auth&&window.gapi.auth.authorize)},self.isDriveAPILoaded=function isDriveAPILoadedFn(){return!!(window.gapi&&window.gapi.client&&window.gapi.client.drive)},self.isRealtimeAPILoaded=function isRealtimeAPILoadedFn(){return!!(window.gapi&&window.gapi.client&&window.gapi.drive&&window.gapi.drive.realtime)};var RELOAD_TIMEOUT=1e4,numTriesLoad=0,isLoadingScript=!1;return self.goOnline=function goOnlineFn(cb){return numTriesLoad=2,self.isRealtimeAPILoaded()?(tokenRefreshed=!1,setTimeout(function(){tryToRefreshToken(cb)},2e3),!0):(isLoadingScript||(isLoadingScript=!0,setTimeout(tryToLoadGapi,2e3)),!1)},self.ensureDocConnection=function ensureDocConnectionFn(){self.isRealtimeAPILoaded()?tryToRefreshToken(function(){loadedClientDefaultFile?gdata.isConnected()||self.reconnectToActiveDocument():self.loadClientDefaultFile()}):self.goOnline()},self.init(),self}),define("LocalCache",["ko","globals","util","platform"],function(ko,g,util,platform){function LocalCache(cacheId,name,options){this._id=cacheId,this._name=name,this._isOpen=!1,this._isReady=!1,this._isAllLoaded=!1,this._storageError=!1,this._onReadyFns=[],this._onMetadataReadyFns=[],this._cache={},this._metadata={},this._useInMemoryStore=!options||!options.noInMemoryCache,this.open()}var LocalCacheFns={_cacheInMemory:function _cacheInMemoryFn(){return this._useInMemoryStore},_hasLoadedAll:function _hasLoadedAllFn(){return this._isAllLoaded},getStorageType:function getStorageTypeFn(){try{g.PAssert(2529,!1,"SubClass must override")}catch(PERR){g.reportError(PERR)}},open:function openFn(){this._isOpen=!0},close:function closeFn(){this._isOpen=!1,this._isReady=!1},isOpen:function isOpenFn(){return this._isOpen},isReady:function isReadyFn(){return this._isOpen&&this._isReady},notifyCacheReady:function notifyCacheReadyFn(success){if(success){this._storageError=!1,this._isReady=!0;for(var i=0;i<this._onReadyFns.length;++i)this._onReadyFns[i]();this._onReadyFns=[]}else this._storageError=!0,this._isReady=!1},notifyCacheMetadataReady:function notifyCacheMetadataReadyFn(success){if(success){this._isMetadataReady=!0;for(var i=0;i<this._onMetadataReadyFns.length;++i)this._onMetadataReadyFns[i]();this._onMetadataReadyFns=[]}else this._isMetadataReady=!1},onCacheReady:function onCacheReadyFn(cb){try{g.PAssert(2530,cb,"Must provide a valid cb")}catch(PERR){g.reportError(PERR)}if(this._isReady)cb();else{try{g.PAssert(2531,this._onReadyFns.indexOf(cb)<0,"Must not double register a cache ready fn")}catch(PERR){g.reportError(PERR)}this._onReadyFns.push(cb)}},onCacheMetadataReady:function onCacheMetadataReadyFn(cb){try{g.PAssert(2532,cb,"Must provide a valid cb")}catch(PERR){g.reportError(PERR)}if(this._isMetadataReady)cb();else{try{g.PAssert(2533,this._onMetadataReadyFns.indexOf(cb)<0,"Must not double register a cache metadata ready fn")}catch(PERR){g.reportError(PERR)}this._onMetadataReadyFns.push(cb)}},setMetadata:function setMetadataFn(key,value,cb){try{g.PAssert(2534,!cb,"In memory query is sync")}catch(PERR){g.reportError(PERR)}this._cacheInMemory()&&(this._metadata[key]=value)},removeMetadata:function removeMetadataFn(key,cb){try{g.PAssert(2535,!cb,"In memory query is sync")}catch(PERR){g.reportError(PERR)}this._cacheInMemory()&&delete this._metadata[key]},getMetadata:function getMetadataFn(key,cb){try{g.PAssert(2536,!cb,"In memory query is sync")}catch(PERR){g.reportError(PERR)}return this._cacheInMemory()?this._metadata[key]:void 0},_setRawInMemoryMetadata:function _setRawInMemoryMetadataFn(metadata){try{g.PAssert(2537,this._cacheInMemory(),"Must be running an in-memory cache")}catch(PERR){g.reportError(PERR)}this._metadata=metadata},_getRawInMemoryMetadata:function _getRawInMemoryMetadataFn(){return this._cacheInMemory()?this._metadata:void 0},_setRawInMemoryCache:function _setRawInMemoryCacheFn(cache){try{g.PAssert(2538,this._cacheInMemory(),"Must be running an in-memory cache")}catch(PERR){g.reportError(PERR)}this._cache=cache},_getRawInMemoryCache:function _getRawInMemoryCacheFn(){return this._cacheInMemory()?this._cache:void 0},loadAll:function loadAllFn(cb){try{g.PAssert(2539,!cb,"In memory query is sync")}catch(PERR){g.reportError(PERR)}this._isAllLoaded=!0},getEntrySync:function getEntrySyncFn(id){return this._cacheInMemory()?this._cache[id]:void 0},getEntry:function getEntryFn(id,cb){try{g.PAssert(2540,!cb,"In memory query is sync")}catch(PERR){g.reportError(PERR)}return this._cacheInMemory()?this._cache[id]:void 0},getBoundEntries:function getBoundEntriesFn(index,spanStart,spanEnd,cb){try{g.PAssert(2541,!cb,"In memory query is sync")}catch(PERR){g.reportError(PERR)}var entryList;if(this._cacheInMemory()){entryList=[];for(var id in entryList)entryList[id][index]>=spanStart&&entryList[id][index]<=spanEnd&&entryList.push(entryList[id])}return entryList},getFilterEntries:function getFilterEntriesFn(index,filterValue,cb){try{g.PAssert(2542,!cb,"In memory query is sync")}catch(PERR){g.reportError(PERR)}var entryList;if(this._cacheInMemory()){entryList=[];for(var id in entryList)entryList[id][index]===filterValue&&entryList.push(entryList[id])}return entryList},removeEntry:function removeEntryFn(id,cb){try{g.PAssert(2543,!cb,"In memory query is sync")}catch(PERR){g.reportError(PERR)}this._cacheInMemory()&&delete this._cache[id]},hasEntry:function hasEntryFn(id,cb){try{g.PAssert(2545,!cb,"In memory query is sync")}catch(PERR){g.reportError(PERR)}return this._cacheInMemory()?this._cache.hasOwnProperty(id):!1},cacheEntry:function cacheEntryFn(id,data,cb){try{g.PAssert(2546,!cb,"In memory query is sync")}catch(PERR){g.reportError(PERR)}this._cacheInMemory()&&data&&(this._cache[id]=data)},clearCache:function clearCacheFn(cb){try{g.PAssert(2547,!cb,"In memory query is sync")}catch(PERR){g.reportError(PERR)}this._cache={}},clearMetadata:function clearMetadataFn(cb){try{g.PAssert(2548,!cb,"In memory query is sync")}catch(PERR){g.reportError(PERR)}this._metadata={}},dumpData:function dumpDataFn(inMemory){console.log("-- Cache: ",this._id,"--"),console.log(this._cache)},onCacheError:function onCacheErrorFn(err){g.reportError(err)}};return util.defineBase(LocalCache),util.extend(LocalCache.prototype,LocalCacheFns),LocalCache}),define("LocalCacheMemory",["globals","util","data","LocalCache"],function(g,util,d,LocalCache){function LocalCacheMemory(cacheId,name,options){if(options){try{g.PAssert(2549,!options.noInMemoryCache,"Invalid in-memory cache option")}catch(PERR){g.reportError(PERR)}options.noInMemoryCache=!1}this._super.constructor.call(this,cacheId,name,options),this._db=void 0}var LocalCacheMemoryFns={getStorageType:function getStorageTypeFn(){return StorageType.InMemory},setMetadata:function setMetadataFn(key,value,cb){this._super.setMetadata.call(this,key,value),cb&&cb(!0)},removeMetadata:function removeMetadataFn(key,cb){this._super.removeMetadata.call(this,key),cb&&cb(!0)},getMetadata:function getMetadataFn(key,cb){var inMemEntry=this._super.getMetadata.call(this,key)||void 0;cb&&cb(inMemEntry)},loadAll:function loadAllFn(cb){this._super.loadAll.call(this),cb&&cb(!1)},getEntrySync:function getEntrySyncFn(id){try{g.PAssert(2550,id,"Must provide a valid ID to get")}catch(PERR){g.reportError(PERR)}var inMemEntry=this._super.getEntrySync.call(this,id)||void 0;return inMemEntry},getEntry:function getEntryFn(id,cb){try{g.PAssert(2551,id,"Must provide a valid ID to get")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2552,cb,"Must provide a valid entry callback")}catch(PERR){g.reportError(PERR)}var inMemEntry=this._super.getEntry.call(this,id)||void 0;cb&&cb(inMemEntry,id)},getBoundEntries:function getBoundEntriesFn(index,spanStart,spanEnd,cb){try{g.PAssert(2553,index,"Must specify a valid index")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2554,cb,"Must provide a valid entry callback")}catch(PERR){g.reportError(PERR)}var inMemEntries=this._super.getBoundEntries.call(this,index,spanStart,spanEnd)||void 0;cb&&cb(inMemEntries)},getFilterEntries:function getFilterEntriesFn(index,filterValue,cb){try{g.PAssert(2555,index,"Must specify a valid index")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2556,cb,"Must provide a valid entry callback")}catch(PERR){g.reportError(PERR)}var inMemEntries=this._super.getFilterEntries.call(this,index,filterValue)||void 0;cb&&cb(inMemEntries)},removeEntry:function removeEntryFn(id,cb){try{g.PAssert(2557,id,"Must provide valid data id")}catch(PERR){g.reportError(PERR)}this._super.removeEntry(id),cb&&cb(!0)},hasEntry:function hasEntryFn(id,cb){var inMemEntry=this._super.hasEntry(id);cb&&cb(inMemEntry)},cacheEntry:function cacheEntryFn(id,data,cb){try{g.PAssert(2558,id,"Must provide valid data id")}catch(PERR){g.reportError(PERR)}this._super.cacheEntry.call(this,id,data),cb&&cb(!0)},clearCache:function clearCacheFn(cb){this._super.clearCache.call(this),cb&&cb(!0)},clearMetadata:function clearMetadataFn(cb){this._super.clearMetadata.call(this),cb&&cb(!0)}};return util.inherit(LocalCache,LocalCacheMemory),util.extend(LocalCacheMemory.prototype,LocalCacheMemoryFns),LocalCacheMemory}),define("LocalCacheIDB",["globals","util","data","LocalCache"],function(g,util,d,LocalCache){function LocalCacheIDB(cacheId,name,options){this._super.constructor.call(this,cacheId,name,options),this._db=void 0}var primaryKey="cid",metadataPrefix="Meta_Moo_",LocalCacheIDBFns={_makeID:function _makeIDFn(id){return this._id+id},_validID:function _validIDFn(id){return id.startsWith(this._id)},_metadataID:function _metadataIDFn(key){return metadataPrefix+key+"_"+this._id},getStorageType:function getStorageTypeFn(){return StorageType.IndexedDB},open:function openFn(){this._super.open.call(this)},close:function closeFn(){this._super.close.call(this),this._db=void 0,d.closeCacheTable(this._id)},isReady:function isReadyFn(){return this._super.isReady.call(this)&&this._db},notifyCacheReady:function notifyCacheReadyFn(success){success&&(this._db=d.openCacheTable(this._id)),this._super.notifyCacheReady.call(this,success)},notifyCacheMetadataReady:function notifyCacheMetadataReadyFn(success){this._super.notifyCacheMetadataReady.call(this,success)},setMetadata:function setMetadataFn(key,value,cb){if(this._super.setMetadata.call(this,key,value),this.isReady()){var entry={id:key,cid:this._metadataID(key),value:value};this._db.update(entry).done(function(){cb&&cb(!0)}).fail(function(err){log("IDB setMetadata Error: ",err),cb&&cb(!1)})}else cb&&cb(!1)},removeMetadata:function removeMetadataFn(key,cb){this._super.removeMetadata.call(this,key),this.isReady()?this._db.remove(this._metadataID(key)).done(function(){cb&&cb(!0)}).fail(function(err){log("IDB removeMetadata Error: ",err),cb&&cb(!1)}):cb&&cb(!1)},getMetadata:function getMetadataFn(key,cb){var inMemEntry=this._super.getMetadata.call(this,key);inMemEntry?cb(inMemEntry):this.isReady()?this._db.query().only(this._metadataID(key)).limit(1).execute().done(function(metadata){var value;metadata&&1===metadata.length&&(value=metadata[0].value),cb(value)}).fail(function(err){log("IDB getMetadata Error: ",err),cb(void 0)}):cb(void 0)},loadAll:function loadAllFn(cb){this.isReady()?this._db.query().bound(this._id,this._id+"￿").execute().done(function(entries){for(var i=0;i<entries.length;++i)this._super.cacheEntry.call(this,entries[i].id,entries[i]);this._super.loadAll.call(this),cb(!0)}.bind(this)).fail(function(err){log("IDB loadAll Error: ",err),this._super.loadAll.call(this),cb(!1)}):cb(!1)},getEntrySync:function getEntrySyncFn(id){try{g.PAssert(2559,!1,"Sync access to IDB is not supported")}catch(PERR){g.reportError(PERR)}return void 0},getEntry:function getEntryFn(id,cb){try{g.PAssert(2560,id,"Must provide a valid ID to get")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2561,cb,"Must provide a valid entry callback")}catch(PERR){g.reportError(PERR)}var inMemEntry=this._super.getEntry.call(this,id);inMemEntry?cb(inMemEntry):this.isReady()?this._db.query().only(this._makeID(id)).limit(1).execute().done(function(entries){var entry;entries&&1===entries.length&&(entry=entries[0],this._super.cacheEntry.call(this,id,entry)),cb(entry,id)}.bind(this)).fail(function(err){log("IDB getEntry Error: ",err),cb(void 0)}):cb(void 0)},getBoundEntries:function getBoundEntriesFn(index,spanStart,spanEnd,cb){try{g.PAssert(2562,index,"Must specify a valid index to query")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2563,cb,"Must provide a valid entry callback")}catch(PERR){g.reportError(PERR)}this.isReady()?this._db.query().bound(this._id,this._id+"￿").filter(function(entry){return entry[index]>=spanStart&&entry[index]<=spanEnd}).execute().done(function(entries){cb(entries)}.bind(this)).fail(function(err){cb(void 0)}.bind(this)):cb(void 0)},getFilterEntries:function getFilterEntriesFn(index,filterValue,cb){try{g.PAssert(2564,index,"Must specify a valid index to query")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2565,cb,"Must provide a valid entry callback")}catch(PERR){g.reportError(PERR)}this.isReady()?this._db.query().bound(this._id,this._id+"￿").filter(function(entry){return entry[index]===filterValue}).execute().done(function(entries){cb(entries)}.bind(this)).fail(function(err){cb(void 0)}.bind(this)):cb(void 0)},removeEntry:function removeEntryFn(id,cb){try{g.PAssert(2566,id,"Must provide valid data id")}catch(PERR){g.reportError(PERR)}this._super.removeEntry.call(this,id),this.isReady()?this._db.remove(this._makeID(id)).done(function(){cb&&cb(!0)}).fail(function(err){log("IDB removeEntry Error: ",err),cb&&cb(!1)}):cb&&cb(!1)},hasEntry:function hasEntryFn(id,cb){var inMemEntry=this._super.hasEntry.call(this,id);inMemEntry?cb(!0):this.isReady()?this._db.query().only(this._makeID(id)).limit(1).execute().done(function(entries){var entry;entries&&1===entries.length&&(entry=entries[0],this._super.cacheEntry.call(this,id,entry)),cb(!!entry)}.bind(this)).fail(function(err){log("IDB hasEntry Error: ",err),cb(!1)}):cb(!1)},cacheEntry:function cacheEntryFn(id,data,cb){try{g.PAssert(2567,id,"Must provide valid data id")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2568,data.id,"Data must also contain a valid item id")}catch(PERR){g.reportError(PERR)}data.cid||(data.cid=this._makeID(id));try{g.PAssert(2569,this._validID(data.cid),"Data must have a valid item id",data.id,data.cid)}catch(PERR){g.reportError(PERR)}this._super.cacheEntry.call(this,id,data),this.isReady()?this._db.update(data).done(function(){cb&&cb(!0)}).fail(function(err){log("IDB cacheEntry Error: ",err),cb&&cb(!1)}):cb&&cb(!1)},clearCache:function clearCacheFn(cb){this._super.clearCache.call(this),this.isReady()?this._db.query().bound(this._id,this._id+"￿").execute().done(function(entries){for(var i=0;i<entries.length;++i)this.removeEntry(entries[i].id);cb&&cb(!0)}.bind(this)).fail(function(err){log("IDB clearcache Error: ",err),cb&&cb(!1)}):cb&&cb(!1)},clearMetadata:function clearMetadataFn(cb){this._super.clearMetadata.call(this),this.isReady()?this._db.query().bound(metadataPrefix,metadataPrefix+"￿").execute().done(function(entries){for(var i=0;i<entries.length;++i)this.removeMetadata(entries[i].id);cb&&cb(!0)}.bind(this)).fail(function(err){log("IDB clearMetadata Error: ",err),cb&&cb(!1)}):cb&&cb(!1)},dumpData:function dumpDataFn(inMemory){inMemory?this._super.dumpData.call(this,inMemory):(console.log("-- Cache: ",this._id,"--"),this.isReady()?this._db.query().all().execute().done(function(entries){for(var i=0;i<entries.length;++i)console.log(entries[i])}).fail(function(err){console.log("Error running IDB query: ",err)}):console.log("Cache not ready"))}};return util.inherit(LocalCache,LocalCacheIDB),util.extend(LocalCacheIDB.prototype,LocalCacheIDBFns),LocalCacheIDB}),define("LocalCacheLocalStorage",["globals","util","data","LocalCache"],function(g,util,d,LocalCache){function LocalCacheLocalStorage(cacheId,name,options){if(options){try{g.PAssert(2570,!options.noInMemoryCache,"Invalid in-memory cache option")}catch(PERR){g.reportError(PERR)}options.noInMemoryCache=!1}this._super.constructor.call(this,cacheId,name,options),this._saveTimeout=void 0,util.forceBind("_writeCache",this)}var saveTime=5e3,dbPrefix="MDC_",LocalCacheLocalStorageFns={_localStorageKey:function _localStorageKeyFn(){return dbPrefix+this._id},_onWrite:function _onWriteFn(forceWrite){forceWrite?(clearTimeout(this._saveTimeout),this._saveTimeout=void 0,this._writeCache()):(this._saveTimeout&&clearTimeout(this._saveTimeout),this._saveTimeout=setTimeout(this._writeCache,saveTime))},_writeCache:function _writeCacheFn(){var timeStart=performance.now(),cacheData={metadata:this._getRawInMemoryMetadata(),cache:this._getRawInMemoryCache()},cacheStr;try{cacheStr=JSON.stringify(cacheData),util.storage.setItem(this._localStorageKey(),cacheStr)}catch(err){g.reportError(err)}},close:function closeFn(){this._onWrite(!0),this._super.close.call(this)},getStorageType:function getStorageTypeFn(){return StorageType.LocalStorage},setMetadata:function setMetadataFn(key,value,cb){this._super.setMetadata.call(this,key,value),this._onWrite(),cb&&cb(!0)},getMetadata:function getMetadataFn(key,cb){var inMemEntry=this._super.getMetadata.call(this,key)||void 0;cb&&cb(inMemEntry)},loadAll:function loadAllFn(cb){try{var cacheStr=util.storage.getItem(this._localStorageKey());if(cacheStr){var cacheData=JSON.parse(cacheStr);this._setRawInMemoryMetadata(cacheData.metadata),this._setRawInMemoryCache(cacheData.cache)}this._super.loadAll.call(this),cb&&cb(!0)}catch(err){g.reportError(err),this._super.loadAll.call(this),cb&&cb(!1)}},getEntrySync:function getEntrySyncFn(id){try{g.PAssert(2571,id,"Must provide a valid ID to get")}catch(PERR){g.reportError(PERR)}var inMemEntry=this._super.getEntrySync.call(this,id)||void 0;return inMemEntry},getEntry:function getEntryFn(id,cb){try{g.PAssert(2572,id,"Must provide a valid ID to get")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2573,cb,"Must provide a valid entry callback")}catch(PERR){g.reportError(PERR)}var inMemEntry=this._super.getEntry.call(this,id)||void 0;cb&&cb(inMemEntry,id)},removeEntry:function removeEntryFn(id,cb){try{g.PAssert(2574,id,"Must provide valid data id")}catch(PERR){g.reportError(PERR)}this._super.removeEntry(id),this._onWrite(),cb&&cb(!0)},hasEntry:function hasEntryFn(id,cb){var inMemEntry=this._super.hasEntry(id);cb&&cb(inMemEntry)},cacheEntry:function cacheEntryFn(id,data,cb){try{g.PAssert(2575,id,"Must provide valid data id")}catch(PERR){g.reportError(PERR)}this._super.cacheEntry.call(this,id,data),this._onWrite(),cb&&cb(!0)},clearCache:function clearCacheFn(cb){this._super.clearCache.call(this),this._onWrite(!0),cb&&cb(!0)},clearMetadata:function clearMetadataFn(cb){this._super.clearMetadata.call(this),this._onWrite(),cb&&cb(!0)}};return util.inherit(LocalCache,LocalCacheLocalStorage),util.extend(LocalCacheLocalStorage.prototype,LocalCacheLocalStorageFns),LocalCacheLocalStorage}),define("CacheManager",["globals","util","data","LocalCache","LocalCacheMemory","LocalCacheIDB","LocalCacheLocalStorage"],function(g,util,d,LocalCache,LocalCacheMemory,LocalCacheIDB,LocalCacheLocalStorage){var CacheManager=function(){this._registeredCaches={},this._storageReady=[],this.init()};return CacheManager.prototype={init:function initFn(){this._storageReady[StorageType.InMemory]=!0,d.onCachesAvailable(this._notifyIDBReady.bind(this))},registerLocalCache:function registerLocalCacheFn(id,name,storageType){try{g.PAssert(2576,id,"Must provide a valid cache ID")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2577,name,"Must have a valid cache name")}catch(PERR){g.reportError(PERR)}var cacheId=this._createCacheId(id,name);try{g.PAssert(2579,void 0===this._registeredCaches[cacheId],"Must not have a previously registered cache with the same id")}catch(PERR){g.reportError(PERR)}g.shouldWriteLocal()||(storageType=StorageType.InMemory);var cache;switch(storageType){case StorageType.InMemory:cache=new LocalCacheMemory(cacheId,name);break;case StorageType.LocalStorage:cache=new LocalCacheLocalStorage(cacheId,name);break;case StorageType.IndexedDB:cache=new LocalCacheIDB(cacheId,name)}try{g.PAssert(2580,cache,"Must have valid cache after creation")}catch(PERR){g.reportError(PERR)}return this._registeredCaches[id]=cache,this._storageReady[storageType]&&(cache.notifyCacheMetadataReady(!0),cache.notifyCacheReady(!0)),cache},clearLocalCache:function clearLocalCacheFn(id,clearMetadata){var cache=this._registeredCaches[id];try{g.PAssert(2581,cache,"Must have valid local cache")}catch(PERR){g.reportError(PERR)}cache.clearCache(),clearMetadata&&cache.clearMetadata()},clearLocalCaches:function clearLocalCachesFn(clearMetadata){for(var id in this._registeredCaches)this.clearLocalCache(id,clearMetadata)},_notifyIDBReady:function _notifyIDBReadyFn(success){this._storageReady[StorageType.IndexedDB]=!0;for(var id in this._registeredCaches){var cache=this._registeredCaches[id];cache.getStorageType()===StorageType.IndexedDB&&(cache.notifyCacheMetadataReady(success),cache.notifyCacheReady(success))}},_createCacheId:function _createCacheIdFn(id,name){return id}},new CacheManager}),define("VMLIElement",["globals","util"],function(g,util){function VMLIElement(parsedText,attrs){this._parsedText=parsedText,this._attrs=attrs}var VMLIElementFns={getParsedText:function getParsedTextFn(){return this._parsedText},setParsedText:function setParsedTextFn(parsedText){this._parsedText=parsedText},getStyledText:function getStyledTextFn(){var styledText;if(this.getAttr("plugin")){try{g.PAssert(2582,this.getAttr("plugin-id"),"If a plugin is specified, must have the ID for that plugin as well")}catch(PERR){g.reportError(PERR)}var plugin=g.vmMain.pluginManager.getPlugin(this._attrs.plugin),attach=plugin.getAttachment(this.getAttr("plugin-id"));styledText=plugin._getDisplayText(attach)}else styledText=g.escape(this._parsedText);return styledText},getAttrs:function getAttrsFn(){return this._attrs},getAttr:function getAttrFn(attr){var value;return this._attrs&&(value=this._attrs[attr]),value},hasAttrs:function hasAttrsFn(){return!!this._attrs},getClasses:function getClassesFn(){var classes;return this._attrs&&(classes=this._attrs.cls),classes},hasClasses:function hasClassesFn(){var classes=this.getClasses();return!!classes&&classes.length>0},hasClass:function hasClassFn(cls){var hasClass=!1,classes=this.getClasses();return classes&&(hasClass=classes.indexOf(cls)>=0),hasClass},getClassString:function getClassStringFn(){var classStr="",classes=this.getClasses();return classes&&(classStr=classes.join(" ")),classStr},mergeAttrs:function mergeAttrsFn(attrs){if(attrs){if(!this._attrs)return void(this._attrs=attrs);attrs.cls&&(this._attrs.cls?this._attrs.cls.pushArray(attrs.cls):this._attrs.cls=attrs.cls);try{g.PAssert(2583,void 0===this._attrs.plugin||void 0===attrs.plugin||this._attrs.plugin===attrs.plugin,"A single element cannot match multiple plugins")}catch(PERR){g.reportError(PERR)}this._attrs.plugin=this._attrs.plugin||attrs.plugin;try{g.PAssert(2584,void 0===this._attrs["plugin-id"]||void 0===attrs["plugin-id"]||this._attrs["plugin-id"]===attrs["plugin-id"],"A single element cannot match multiple plugins")}catch(PERR){g.reportError(PERR)}this._attrs["plugin-id"]=this._attrs["plugin-id"]||attrs["plugin-id"]}}};return util.extend(VMLIElement.prototype,VMLIElementFns),VMLIElement}),define("DuchessHelpers",["globals","VMLIElement"],function(g,VMLIElement){function enumToString(en,value){for(var k in en)if(en[k]===value)return k;return null}function DuchessHelpers(){}var punctuation=", . ? ! ) ( : ; [ ] ' \"".split(" "),cmdChar=-1===navigator.userAgent.indexOf("Mac")?"ctrl":"⌘",charMap={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"},validProtocols=["http","https","evernote"];window.__PARSE_TEXT_TOTAL_CALLS=0;var DAY_LENGTH=864e5,forceCompleteTime=new Date(9e12).getTime(),minStartDate=new Date(1401606e6),nowRelativeDates=["NEXT","NOW","SOON","LATER"],softDateRegexp=/^(today|tomorrow|yesterday|(?:sun|mon|tue(?:s)?|wed(?:nes)?|thu(?:rs)?|fri|sat(?:ur)?)(?:day)?)/i,timeRegexp=/^(?:(?:([0]?[1-9]|1[0-2])(?::([0-5]\d))?(?:\s)?(am?|pm?|\b))|(?:([0]?\d|1\d|2[0-3]):([0-5]\d)))$/i,tagRegexp=/(^#|[\(\s]#)([^\s\),]+)/g,dateRegexp=/(?:^@|[\(\s]@)([^\s\)]{2,})(\s[^\s\)@]{1,})?(\s[^\s\)@]{1,})?/g,linkRegexp=/\b((?:(https?|evernote):\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/g,minLinkRegexp=/(?:^|[\s\(\[])([^\(\[#@\s]+\.(?:com|org|net|io))/gi,pluginRegexp=/(?:\u2001(p:[^\u2001]+)\u2001)/gi,dToken={repeat:/^(ev(ery)?|after)\b/i,recur:/^(other|first|second|third|fourth|1st|2nd|3rd|4th|last)$/i,day:/^(((sun|mon|tue(s)?|wed(nes)?|thu(rs)?|fri|sat(ur)?)(day)?)(?:,|\sand\s)?)$/i,daysOfWeek:/^(weekday|weekend)$/i,len:/^(day|week|month|year|morning|afternoon|night)$/i,count:/^((\d{1,2})|one|two|three|four|five|six|seven|eight|nine|ten)$/i,month:/^(jan(uary)?|feb(ruary)?|ma((r(ch)?)?|y)|apr(il)?|ju(ly|ne)|aug(ust)?|oct(ober)?|(sept|nov|dec)(ember)?)$/i,at:/^at$/i,of:/^of$/i,"in":/^in$/i,delim:/^and$/i,date:/^((\d{1,2})|([2-5]?1(st)?|[2-5]?2(nd)?|[2-5]?3(rd)?|(0|[1-5]?[4-9]|[1-5]0|1[1-3])(th)?))$/i,year:/^((\d\d)|(\d\d\d\d))$/i,time:timeRegexp,from:/^(from|starting)$/i,until:/^(until)$/i,measure:/^(days|weeks|months|years)$/i},dTokenValue={"1st":1,fir:1,"2nd":2,sec:2,"3rd":3,thi:3,"4th":4,fou:4,sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6,jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11,one:1,two:2,three:3,four:4,five:5,six:6,seven:7,eight:8,nine:9,ten:10,days:RepeatFreq.Daily,weeks:RepeatFreq.Weekly,months:RepeatFreq.Monthly,years:RepeatFreq.Yearly},lastToken,dateCharsConsumed=0,dateCharsFromString=0,dateTokens,dateTokenOffset=1,dateParsedDate;return DuchessHelpers.prototype={isFlagSet:function isFlagSetFn(data,mask){return(data&mask)===mask},trimPunc:function trimPuncFn(str){var outStr=str.replace(/[:,\.\'\"\)\]]$/g,"");return outStr},generateStyledLines:function generateStyledLinesFn(els,lines){for(var lineEls=this.linesToEls(els,lines),arr=[],i=0;i<lineEls.length;++i)arr.push(this.generateHTML(lineEls[i]));return arr},linesToEls:function linesToElsFn(els,lines){for(var arr=[],line=[],i=0;i<lines.length;++i){for(var strIndex=0,lineStart=lines[i].start,lineLength=lines[i].length,lineIndex=0,u=0;u<els.length;++u){var el=els[u],elLength=el.getParsedText().length,start=Math.max(lineStart-strIndex,0);if(elLength>start){var length=Math.min(elLength-start,lineLength-lineIndex);if(length>0){var text=el.getParsedText().substr(start,length);line.push(new VMLIElement(text,el.getAttrs())),lineIndex+=length}}strIndex+=elLength}arr.push(line),line=[]}return arr},replaceTextInEls:function replaceTextInElsFn(els,replacedParsedText,start,length){try{g.PAssert(2585,g.isArray(els),"Must supply a valid VMLIElement array")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2586,replacedParsedText,"Must be replacing at least one of parsed or styled text")}catch(PERR){g.reportError(PERR)}for(var strIndex=0,i=0;i<els.length;++i){var el=els[i],text=el.getParsedText();if(start+length>=strIndex&&start<strIndex+text.length){var localStart=start-strIndex,localLength=Math.min(length,text.length-localStart),startText=text.substr(0,localStart),endText=text.substr(localStart+localLength);replacedParsedText&&el.setParsedText(startText+replacedParsedText+endText);break}strIndex+=text.length}},insertEl:function insertElFn(els,attrs,start,length){try{g.PAssert(2587,g.isArray(attrs.cls),"Must always pass in a valid classes array")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2588,g.isNumber(start),"Must have a valid start")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2589,g.isNumber(length),"Must have a valid length")}catch(PERR){g.reportError(PERR)}for(var strIndex=0,i=0;i<els.length;++i){var el=els[i],text=el.getParsedText();if(start+length>=strIndex&&start<strIndex+text.length){var newEls=[],localStart=start-strIndex,localLength=Math.min(length,text.length),lastStart=localStart+length,lastLength=text.length-lastStart;if(localStart>0){var sText=text.substr(0,localStart);newEls.push(new VMLIElement(sText,el.getAttrs()))}var mText=text.substr(localStart,localLength),newElement=new VMLIElement(mText,el.getAttrs());if(newElement.mergeAttrs(attrs),newEls.push(newElement),lastLength>0){var lText=text.substr(lastStart,lastLength);newEls.push(new VMLIElement(lText,el.getAttrs()))}Array.prototype.splice.apply(els,[i,1].concat(newEls));break}strIndex+=text.length}},generateHTML:function generateHTMLFn(els){for(var arr=[],i=0;i<els.length;++i){var el=els[i],attrs=el.getAttrs(),attrsStr="",cls;if(attrs){for(var key in attrs)attrs.hasOwnProperty(key)&&("cls"===key?cls='class="'+el.getClassString()+'" ':attrsStr+=key+'="'+attrs[key]+'" ');var start,end;el.hasClass("a")?(start="<a ",end='target="_blank" tooltip="'+cmdChar+'+click to navigate">'+el.getStyledText()+"</a>"):el.hasClass("plugin")?(start="<p ",end="><span>"+el.getStyledText()+"</span></p>"):(start="<p ",end=">"+el.getStyledText()+"</p>"),arr.push(start+(cls?cls:"")+(attrsStr?" "+attrsStr:"")+end)
}else arr.push(el.getStyledText())}return arr.join("")},getNowRelativeDate:function getNowRelativeDateFn(date){var retDate;switch(date.toUpperCase()){case"NOW":retDate=Date.today().add({hours:11});break;case"NEXT":retDate=Date.today().add({hours:12});break;case"SOON":retDate=Date.today().add({days:1,hours:12});break;case"LATER":retDate=Date.today().add({days:3,hours:12});break;default:try{g.PAssert(2590,!1,"Must supply a valid now relative date string")}catch(PERR){g.reportError(PERR)}}return retDate},parseText:function parseTextFn(itemText,prevDate,prevRepeatDate,prevDateText,completedTime,changeType,contactsList){if(window.__PARSE_TEXT_TOTAL_CALLS++,!itemText||0===itemText.length)return{parsedText:void 0,els:[]};var hasDiffParse=!1,parsedText=itemText,numContacts=0,els=[new VMLIElement(itemText)],match,tags,dates,attachments,i,u;if(contactsList&&contactsList.___info___.count>0&&parsedText.indexOf(ContactPrefix)>=0){var words=parsedText.split(" "),lineIndex=0,matchedName;for(i=0;i<words.length;i++){if(0===words[i].indexOf(ContactPrefix)){matchedName=void 0;var combined=words[i].substring(1);for(u=1;;u++){var compStr=this.trimPunc(combined);if(""===contactsList[compStr]&&(matchedName=compStr),!(i+u<words.length))break;combined+=" "+words[i+u]}matchedName&&(numContacts++,this.insertEl(els,{cls:["contact"]},lineIndex,matchedName.length+1))}lineIndex+=words[i].length+1}}for(tagRegexp.lastIndex=0;null!==(match=tagRegexp.exec(parsedText));){var matchIndex=match.index+match[1].length-1,matchLength=match[2].length+1;punctuation.indexOf(match[2].charAt(match[2].length-1))>=0&&matchLength--,tags?tags.push(match[2]):tags=[match[2]],this.insertEl(els,{cls:["tag"]},matchIndex,matchLength)}for(dateRegexp.lastIndex=0;null!==(match=dateRegexp.exec(parsedText));){var prefixLength=match[0].indexOf(DatePrefix),dateString,puncFound=!1;for(i=1;i<match.length&&match[i];++i)if(puncFound)match[i]=void 0;else{var lastChar=match[i][match[i].length-1];punctuation.indexOf(lastChar)>=0&&(match[i]=match[i].slice(0,-1),puncFound=!0)}var repeatDateInfo=this.parseRepeatDate(prevRepeatDate,prevDateText,completedTime,changeType,parsedText.substr(match.index+prefixLength+1)),parsedDateIndex;if(repeatDateInfo||match[1].startsWith("every")||"in"===match[1]){if(repeatDateInfo){parsedDateIndex=match.index+prefixLength,repeatDateInfo.replacedStartDate?(this.insertEl(els,{cls:["date"]},parsedDateIndex,repeatDateInfo.repLength+1),this.replaceTextInEls(els,repeatDateInfo.text,parsedDateIndex+1,repeatDateInfo.repLength),parsedText=parsedText.substr(0,parsedDateIndex+1)+repeatDateInfo.text+parsedText.substr(parsedDateIndex+repeatDateInfo.repLength+1),hasDiffParse=!0):this.insertEl(els,{cls:["date"]},parsedDateIndex,repeatDateInfo.repLength+prefixLength+1),dates?dates.push(repeatDateInfo):dates=[repeatDateInfo];break}}else{var dateStringInfo=[match[1]?match[1]:"",match[2]?match[2]:"",match[3]?match[3]:""];nowRelativeDates.indexOf(dateStringInfo[0].toUpperCase())>=0&&(prevDate=this.getNowRelativeDate(dateStringInfo[0]),dateStringInfo[1]="",dateStringInfo[2]="");var newDateInfo=this.computeDateInfo(prevDate,prevDateText,changeType,dateStringInfo);if(newDateInfo.isValid){var dateObj;parsedDateIndex=match.index+prefixLength,newDateInfo.replacedDate?(this.insertEl(els,{cls:["date"]},parsedDateIndex,newDateInfo.oldText.length+1),this.replaceTextInEls(els,newDateInfo.text,parsedDateIndex+1,newDateInfo.oldText.length),parsedText=parsedText.substr(0,parsedDateIndex+1)+newDateInfo.text+parsedText.substr(parsedDateIndex+newDateInfo.oldText.length+1),hasDiffParse=!0,dateObj={type:DateType.Once,date:newDateInfo.date,origText:newDateInfo.oldText,text:newDateInfo.text,explicitTime:newDateInfo.date.hasTimeOfDay()}):(this.insertEl(els,{cls:["date"]},parsedDateIndex,newDateInfo.text.length+1),dateObj={type:DateType.Once,date:newDateInfo.date,origText:newDateInfo.oldText,text:newDateInfo.text,explicitTime:newDateInfo.date.hasTimeOfDay()}),dates?dates.push(dateObj):dates=[dateObj];break}}}if(linkRegexp.lastIndex=0,null!==(match=linkRegexp.exec(parsedText))){var hasProtocol=validProtocols.indexOf(match[2])>=0,linkHref=hasProtocol?match[0]:"http://"+match[0];this.insertEl(els,{cls:["a"],href:linkHref},match.index,match[0].length)}else if(minLinkRegexp.lastIndex=0,null!==(match=minLinkRegexp.exec(parsedText))){var prefixLength=match[0].length-match[1].length,linkHref=match[1].startsWith("http")?match[1]:"http://"+match[1];this.insertEl(els,{cls:["a"],href:linkHref},match.index+prefixLength,match[1].length)}for(pluginRegexp.lastIndex=0;null!==(match=pluginRegexp.exec(parsedText));){var padBefore=0!==match.index,padAfter=match.index+match[0].length<parsedText.length,obj=g.vmMain.pluginManager.parseAttachmentEmbedString(match[1],padBefore,padAfter);try{g.PAssert(2591,obj,"Must have a valid object")}catch(PERR){g.reportError(PERR)}this.insertEl(els,obj.displayElement.attrs,match.index,match[0].length),this.replaceTextInEls(els,window.AttachChar,match.index,match[0].length),hasDiffParse=!0,attachments?attachments.push(obj):attachments=[obj]}attachments&&(pluginRegexp.lastIndex=0,parsedText=parsedText.replace(pluginRegexp,window.AttachChar));var ret={parsedText:hasDiffParse?parsedText:void 0,dates:dates,tags:tags,attachments:attachments,numContacts:numContacts,els:els};return ret},getSoftText:function getSoftTextFn(date,diff){return 0>diff?diff>=-DAY_LENGTH?"yesterday":date.toString(Date.CultureInfo.formatPatterns.monthDayYear):DAY_LENGTH>=diff&&date.isToday()?"today":2*DAY_LENGTH>diff?"tomorrow":void 0},runDateParse:function runDateParseFn(dateStringInfo){var dateString=dateStringInfo.join(""),dt=Date.parse(dateString);return!dt&&dateStringInfo[1]&&(dateString=dateStringInfo[0]+dateStringInfo[1],dt=Date.parse(dateString)),!dt&&dateStringInfo[0]&&(dateString=dateStringInfo[0],dt=Date.parse(dateString)),{dt:dt,dateString:dateString}},computeDateInfo:function computeDateInfoFn(prevDate,prevDateText,changeType,dateStringInfo){var prevDateTime=new Date(prevDate).clearTime(),currentDateTime=(new Date).clearTime(),diff=prevDateTime-currentDateTime,dateString=prevDateText||dateStringInfo.join(""),finalString=dateString,replacedDate=!1,newDate,transString;if(this.isFlagSet(changeType,ChangeType.Auto)||this.isFlagSet(changeType,ChangeType.Remote)){if(newDate=new Date(prevDate),void 0!==prevDate&&(0>diff||diff>=0&&2*DAY_LENGTH>diff)){var softMatch;if(null!==(softMatch=softDateRegexp.exec(dateString))){if(transString=this.getSoftText(newDate,diff),transString&&!dateString.toUpperCase().startsWith(transString.toUpperCase())){if(void 0===prevDateText){var parseInfo=this.runDateParse(dateStringInfo);dateString=parseInfo.dateString}finalString=dateString.replace(softMatch[0],transString),replacedDate=!0}}else if(null!==(softMatch=timeRegexp.exec(dateString))){if(transString=this.getSoftText(newDate,diff),transString&&"today"!==transString){if(void 0===prevDateText){var parseInfo=this.runDateParse(dateStringInfo);dateString=parseInfo.dateString}finalString=transString+" "+dateString,replacedDate=!0}}else{var parseInfo=this.runDateParse(dateStringInfo);newDate=parseInfo.dt,dateString=parseInfo.dateString,finalString=parseInfo.dateString}}else if(void 0===prevDate||void 0===prevDateText){var isRollover=this.isFlagSet(changeType,ChangeType.Rollover);if(!this.isFlagSet(changeType,ChangeType.Auto)||isRollover){var parseInfo=this.runDateParse(dateStringInfo);newDate=parseInfo.dt,finalString=parseInfo.dateString,isRollover||(dateString=parseInfo.dateString)}else void 0===prevDate&&(newDate=void 0)}}else if(this.isFlagSet(changeType,ChangeType.Local)){var parseInfo=this.runDateParse(dateStringInfo);newDate=parseInfo.dt,dateString=parseInfo.dateString,finalString=parseInfo.dateString}else{var parseInfo=this.runDateParse(dateStringInfo);newDate=parseInfo.dt,dateString=parseInfo.dateString,finalString=parseInfo.dateString}try{g.PAssert(2592,!newDate||!isNaN(newDate.getTime()),"Must be a valid parsed date")}catch(PERR){g.reportError(PERR)}return{isValid:!!newDate,oldText:dateString,text:finalString,date:newDate,replacedDate:replacedDate}},getRepeatStartDate:function getRepeatStartDateFn(repeatDateStr){if(repeatDateStr&&"string"==typeof repeatDateStr){var tokens=repeatDateStr.split("|");if(tokens.length>3)return new Date(parseInt(tokens[1]))}return void 0},setDateTokens:function setDateTokensFn(dateString){lastToken=void 0,dateTokens=dateString.split(" "),dateTokenOffset=1,dateCharsConsumed=dateTokens[0].length,dateCharsFromString=0,dateParsedDate=void 0},checkAndParse:function checkAndParseFn(tokenType,numTokens){var isValid=!1;if(numTokens=void 0!==numTokens&&numTokens>1?Math.min(dateTokens.length-dateTokenOffset,numTokens):numTokens,void 0===numTokens||1===numTokens)dateTokenOffset<dateTokens.length&&(isValid=dateTokens[dateTokenOffset].match(tokenType),isValid&&(lastToken=dateTokens[dateTokenOffset],dateTokenOffset++,dateCharsConsumed+=lastToken.length+1));else if(numTokens>1&&dateTokenOffset+numTokens<=dateTokens.length)for(var consumeToken=numTokens;consumeToken>0;consumeToken--){for(var currentString="",i=0;consumeToken>i;++i)currentString+=dateTokens[dateTokenOffset+i],i+1!==consumeToken&&(currentString+=" ");if(isValid=currentString.match(tokenType)){lastToken=currentString,dateTokenOffset+=consumeToken,dateCharsConsumed+=currentString.length+1;break}}return isValid},checkAndParseDate:function checkAndParseDateFn(){var isValid=!1;if(dateTokenOffset+1<dateTokens.length&&!dateTokens[dateTokenOffset+1].match(dToken.at)){var twoParsedDate=Date.parse(dateTokens[dateTokenOffset]+" "+dateTokens[dateTokenOffset+1]);twoParsedDate&&(isValid=!0,lastToken=dateTokens[dateTokenOffset]+dateTokens[dateTokenOffset+1],dateParsedDate=twoParsedDate,dateTokenOffset+=2,dateCharsConsumed+=lastToken.length+2)}if(!isValid&&dateTokenOffset<dateTokens.length){var parsedDate=Date.parse(dateTokens[dateTokenOffset]);parsedDate&&(isValid=!0,lastToken=dateTokens[dateTokenOffset],dateParsedDate=parsedDate,dateTokenOffset++,dateCharsConsumed+=lastToken.length+1)}return isValid},computeStartDate:function computeStartDateFn(dayOrd,wkOrd,monthOrd,yearOrd,time,fromDate){var minStart=fromDate||new Date,startDate=(fromDate?new Date(fromDate):new Date).clearTime();if(void 0!==yearOrd&&(startDate.setMonth(yearOrd),startDate.isBefore(minStart)&&(startDate.addYears(1),startDate.setMonth(yearOrd))),void 0!==monthOrd&&monthOrd>0&&31>=monthOrd){var maxDays=Date.getDaysInMonth(startDate.getFullYear(),startDate.getMonth());monthOrd>maxDays&&startDate.addMonths(1),startDate.setDate(monthOrd)}if(void 0!==wkOrd?(startDate.moveToNthOccurrence(dayOrd,wkOrd),startDate.isBefore(minStart)&&(startDate.addMonths(1),startDate.moveToNthOccurrence(dayOrd,wkOrd))):void 0!==dayOrd&&startDate.getDay()!==dayOrd&&(startDate.moveToDayOfWeek(dayOrd,-1),startDate.isBefore(minStart)&&startDate.moveToDayOfWeek(dayOrd)),time){var parts=timeRegexp.exec(time),merid,isPM,hour,min,hourString;void 0!==parts[1]?(merid=parts[3].toUpperCase(),isPM=merid===Date.CultureInfo.pmDesignator[0]||merid===Date.CultureInfo.pmDesignator,hour=parseInt(parts[1])+(isPM?12:0),min=parts[2]?parseInt(parts[2].slice(1)):0,hourString=parts[1]):void 0!==parts[4]&&void 0!==parts[5]&&(hour=parseInt(parts[4]),min=parseInt(parts[5]),hourString=parts[4]);var is24Hour=!1;if(hourString){var rawHour=parseInt(hourString);(hourString.startsWith("0")||0===rawHour||rawHour>12)&&(is24Hour=!0)}merid||is24Hour?merid&&!is24Hour&&(isPM||12!==hour?isPM&&24===hour&&(hour=12):hour=0):8>hour&&(hour+=12),startDate.setHours(hour),startDate.setMinutes(min),startDate.setMilliseconds(1)}return startDate},parseRepeatDate:function parseRepeatDateFn(prevRepeatDate,prevDateText,completedTime,changeType,dateString){var retValue,isDateValid=!1,startDate=Date.today(),endDate,freq=RepeatFreq.Daily,sep=1,offsets,time,dayOrd,wkOrd,monthOrd,yearOrd;if(dateString.match(dToken.repeat)){this.setDateTokens(dateString);var parsedRecur=!1;if(this.checkAndParse(dToken.recur)){switch(lastToken){case"other":sep=2;break;case"last":freq=RepeatFreq.NthMonthInst,wkOrd=-1;break;default:freq=RepeatFreq.NthMonthInst,wkOrd=dTokenValue[lastToken.substr(0,3).toLowerCase()]}parsedRecur=!0}if(parsedRecur&&"other"!==lastToken||!this.checkAndParse(dToken.date))if(!parsedRecur&&this.checkAndParse(dToken.count)){var parsedSep=parseInt(lastToken);isNaN(parsedSep)&&(parsedSep=dTokenValue[lastToken]),this.checkAndParse(dToken.measure)&&(freq=dTokenValue[lastToken.toLowerCase()],sep=parsedSep,isDateValid=!0)}else if(this.checkAndParse(dToken.day)){freq!==RepeatFreq.NthMonthInst&&(freq=RepeatFreq.Weekly),dayOrd=dTokenValue[lastToken.substr(0,3).toLowerCase()];for(var dayOrdList;(lastToken.endsWith(",")||this.checkAndParse(dToken.delim))&&this.checkAndParse(dToken.day);){var nxtDayOrd=dTokenValue[lastToken.substr(0,3).toLowerCase()];dayOrdList?dayOrdList.push(nxtDayOrd):dayOrdList=[dayOrd,nxtDayOrd]}dayOrdList&&(dayOrdList.sort(),offsets=dayOrdList),isDateValid=!0}else if(this.checkAndParse(dToken.daysOfWeek))freq=RepeatFreq.Weekly,"weekday"===lastToken?offsets=[1,2,3,4,5]:"weekend"===lastToken&&(offsets=[0,6]),isDateValid=!0;else if(this.checkAndParse(dToken.month)){var monthParsed=lastToken;if(this.checkAndParse(dToken.date)){var tempMonthOrd=parseInt(lastToken);tempMonthOrd>0&&31>=tempMonthOrd&&(monthOrd=tempMonthOrd,yearOrd=dTokenValue[monthParsed.substr(0,3).toLowerCase()],freq=RepeatFreq.Yearly,isDateValid=!0)}}else if(parsedRecur&&"other"!==lastToken||!this.checkAndParse(dToken.len))if(parsedRecur&&"last"!==lastToken||!this.checkAndParse(dToken.len))parsedRecur&&"other"!==lastToken&&(freq=RepeatFreq.DayOfMonth,monthOrd=wkOrd,wkOrd=void 0,isDateValid=!0);else switch(lastToken){case"day":isDateValid=!0,freq=RepeatFreq.EndOfMonthOffset}else{switch(lastToken){case"day":freq=RepeatFreq.Daily;break;case"week":freq=RepeatFreq.Weekly;break;case"month":freq=RepeatFreq.Monthly;break;case"year":freq=RepeatFreq.Yearly;break;case"morning":freq=RepeatFreq.Daily,time="9:00am";break;case"afternoon":freq=RepeatFreq.Daily,time="2:00pm";break;case"night":freq=RepeatFreq.Daily,time="7:00pm"}isDateValid=!0}else{var dateParsed=parseInt(lastToken);dateParsed>0&&31>=dateParsed&&(isNaN(dateParsed)||(freq=RepeatFreq.DayOfMonth,monthOrd=dateParsed,isDateValid=!0),this.checkAndParse(dToken.measure)?(freq=dTokenValue[lastToken.toLowerCase()],sep=dateParsed,monthOrd=void 0,isDateValid=!0):(this.checkAndParse(dToken.of),this.checkAndParse(dToken.month)&&(monthOrd=dateParsed,yearOrd=dTokenValue[lastToken.substr(0,3).toLowerCase()],freq=RepeatFreq.Yearly,isDateValid=!0)))}var atParsed=!1;this.checkAndParse(dToken.at)&&(atParsed=!0),this.checkAndParse(dToken.time,2)&&(time=lastToken,isDateValid=!0);var implicitFrom=!1,inParsed=!1;if(this.checkAndParse(dToken.in)){inParsed=!0;var inMonth,inYear;this.checkAndParse(dToken.month)&&(inMonth=dTokenValue[lastToken.substr(0,3).toLowerCase()]),this.checkAndParse(dToken.year)&&(inYear=parseInt(lastToken)),(void 0!==inMonth||void 0!==inYear)&&(endDate=new Date,fromDate=new Date,implicitFrom=!0,inYear&&(endDate.setYear(inYear),endDate.setMonth(11),fromDate.setYear(inYear),fromDate.setMonth(0)),void 0!==inMonth&&(void 0!==inYear&&(endDate.getMonth()>inMonth&&endDate.addYears(1),fromDate.getMonth()>inMonth&&fromDate.addYears(1)),endDate.setMonth(inMonth),fromDate.setMonth(inMonth)),endDate.moveToLastDayOfMonth(),fromDate.setDate(1))}var fromDate,fromDateOffset=dateCharsConsumed+1,fromOffset=dateCharsConsumed;this.checkAndParse(dToken.from)?(fromDateOffset=dateCharsConsumed+1,this.checkAndParseDate()&&((!implicitFrom||dateParsedDate.isAfter(fromDate))&&(fromDate=dateParsedDate),implicitFrom=!1,dateCharsFromString=dateCharsConsumed)):dateCharsFromString=dateCharsConsumed;var postParsed=!1;atParsed||time||(this.checkAndParse(dToken.at)&&(atParsed=!0,postParsed=!0),this.checkAndParse(dToken.time,2)&&(time=lastToken,postParsed=!0)),inParsed||this.checkAndParse(dToken.until)&&this.checkAndParseDate()&&(endDate=dateParsedDate,postParsed=!0),endDate&&endDate.isBefore(fromDate)&&(isDateValid=!1)}else"everyday"===dateString&&(this.setDateTokens(dateString),isDateValid=!0,freq=RepeatFreq.Daily,sep=1);if(isDateValid){var prevStartDate=this.getRepeatStartDate(prevRepeatDate),computeFromDate=this.isFlagSet(changeType,ChangeType.Remote)?prevStartDate:fromDate;if(offsets&&freq===RepeatFreq.Weekly)for(var currentDayOrd=(computeFromDate||new Date).getDay(),i=0;i<offsets.length;++i)if(offsets[i]>=currentDayOrd){dayOrd=offsets[i];break}var startDate=this.computeStartDate(dayOrd,wkOrd,monthOrd,yearOrd,time,computeFromDate),isValidStartDate=!!startDate;if(startDate&&(startDate.isBefore(minStartDate)&&(isValidStartDate=!1),endDate&&endDate.isBefore(startDate)&&(isValidStartDate=!1)),isValidStartDate){var replacedStartDate,finalDateString=dateString.substr(0,dateCharsConsumed),fromString;if(!completedTime&&fromDate&&prevRepeatDate&&!implicitFrom){fromString=dateString.substr(fromDateOffset,dateCharsFromString);var newFromDateInfo=this.computeDateInfo(prevStartDate,void 0,changeType,[fromString]);newFromDateInfo.replacedDate&&(fromString=newFromDateInfo.text)}else completedTime&&completedTime!==forceCompleteTime&&(this.isFlagSet(changeType,ChangeType.Text)||(fromString=new Date(completedTime).toString(Date.CultureInfo.formatPatterns.shortDate)));if(fromString){var origString=dateString.substr(fromDateOffset,dateCharsFromString);if(origString.toUpperCase()!==fromString.toUpperCase()){var repStart=Date.parse(fromString);repStart&&(replacedStartDate=repStart.getTime(),finalDateString=finalDateString.substr(0,fromOffset)+" from "+fromString+(postParsed?finalDateString.substr(dateCharsFromString):""))}}retValue={type:DateType.Repeat,repLength:dateCharsConsumed,oldText:prevDateText,text:finalDateString,startDate:replacedStartDate||startDate,endDate:endDate,frequency:freq,separation:sep,offsets:offsets,replacedStartDate:replacedStartDate}}}return retValue}},new DuchessHelpers}),define("Measure",["globals","data","CacheManager","platform","DuchessHelpers"],function(g,d,CacheManager,platform,DuchessHelpers){function roundToFixed(num){return Math.round(num*fixedPrecision)/fixedPrecision}var wordDelims=[" ","-"],wordPlaceholders=[window.AttachChar],ItemCacheMaxSize=5,Measure=function(){this.fontSize=platform.mobile?15:14,this.canvasFont=this.fontSize+"px Helvetica Neue, Helvetica, Arial, Sans-serif",this.isBold=!1,this._wordCache=CacheManager.registerLocalCache("WordCacheNormal","WordCacheNormal",StorageType.LocalStorage),this._wordCacheBold=CacheManager.registerLocalCache("WordCacheBold","WordCacheBold",StorageType.LocalStorage),this._itemCache={},this._loadCaches()},timeWord=0,MeasureStats={CallCount:{GetCaretOffset:0,GetClassStyles:0,MeasureItem:0,MeasureLines:0,MeasureWord:0,MeasureLine:0,GetOffsetFromLineOffset:0,GetOffsetForPositionInLine:0,GetNearestOffsetInLine:0},Cache:{ItemCacheMiss:0,ItemCacheHit:0,CanvasStyleHit:0,CanvasStyleMiss:0,WordCacheHit:0,WordCacheMiss:0}},fixedPrecision=100;return Measure.prototype={getCanvasContext:function getCanvasContextFn(){return this.canvasContext||(this.canvasContext=document.getElementById("canvas").getContext("2d"),this.canvasContext.font=this.canvasFont),this.canvasContext},getMeasureStats:function getMeasureStatsFn(){return MeasureStats},getCaretOffset:function getCaretOffsetFn(item,pane,offset,preferLineStart){MeasureStats.CallCount.GetCaretOffset++;var maxWidth=g.focusedPane.maxWidthOfItem(item),text=item.getParsedText();if(0===text.length)return{left:0,top:0,line:0,lineOffset:0};void 0===offset&&(offset=text.length);for(var linesOriginal=this.measureLines(item,pane,maxWidth),lines=this.measureLines(item,pane,maxWidth,offset,!0),lineNum=Math.max(lines.length-1,0),line=lines[lineNum],left=line?Math.round(line.width):0,i=0;i<lines.length-1;++i)offset-=lines[i].length;preferLineStart&&offset===linesOriginal[lineNum].length&&lineNum<linesOriginal.length-1?(left=0,offset=0,lineNum++):!preferLineStart&&lineNum>0&&0===offset&&0===lines[lineNum].length&&(lineNum--,offset+=lines[lineNum].length,left=Math.round(lines[lineNum].width));var top=g.itemLineHeight*lineNum;try{g.PAssert(2593,!isNaN(offset),"Should always have a valid offset")}catch(PERR){g.reportError(PERR)}return{left:left,top:top,line:lineNum,lineOffset:offset,lineLength:linesOriginal[lineNum].length}},getCaretScreenPosition:function getCaretScreenPositionFn(pane,index,offset){var item=pane.itemAtIndex(index),element=pane.elementAtIndex(index),padding=item.getPadding(pane),caretPos=this.getCaretOffset(item,pane,offset),itemOffset=element.getBoundingClientRect();return{left:caretPos.left+itemOffset.left+padding,top:caretPos.top+itemOffset.top}},_getClassStyles:function _getClassStylesFn(item,el){MeasureStats.CallCount.GetClassStyles++;try{g.PAssert(2594,g.isVMLI(item),"Item must be a valid VMLI instance")}catch(PERR){g.reportError(PERR)}var isBold=item.isHeader()||el.hasClass("contact")||el.hasClass("date")||el.hasClass("tag"),isItalic=!1,isUnderline=!1;return{isBold:isBold,isItalic:isItalic,isUnderline:isUnderline,attrs:el.getAttrs()}},_appendLine:function _appendLineFn(pane,lines,strIndex,words,maxWidth,offset,start,end){for(var lineText="",lineWidth2=0,strLineIndex=strIndex,needsOffsetRet=!1,u=start;end>=u;++u){var w=words[u];if(strLineIndex+w.text.length+w.delim.length>offset){var len=offset-strLineIndex,t=(w.text+w.delim).substr(0,len),wordWidth=this.measureWord(pane,t,w.styles,!0);lineWidth2+=wordWidth,needsOffsetRet=!0;break}lineText+=w.text+w.delim,lineWidth2+=w.width+w.delimWidth,strLineIndex+=(w.text+w.delim).length}lineWidth2=Math.min(lineWidth2,maxWidth);var line={text:lineText,start:strIndex,length:lineText.length,width:lineWidth2};return lines.push(line),{line:line,needsOffsetRet:needsOffsetRet}},measureLines:function measureLinesFn(item,pane,maxWidth,offset,noCache){try{g.PAssert(2595,g.isVMLI(item),"Must provide a valid item to measure lines for")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2596,g.isPane(pane),"Must provide a valid pane to measure lines for")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2597,maxWidth>=0,"Max width must be greater than 0: ",maxWidth)}catch(PERR){g.reportError(PERR)}MeasureStats.CallCount.MeasureLines++;var fullText=item.getParsedText();try{g.PAssert(2598,item&&item.els,"Item has no els: ",item.isArchived(),item._needsParse)}catch(PERR){g.reportError(PERR)}if(0===fullText.length||!item||!item.els)return[{text:"",start:0,length:0,width:0}];for(var lines=[],els=item.els,strIndex=0,lineWidth=0,word="",lineStart=0,needsOffsetRet=!1,elStyles,words=[],i=0;i<els.length&&!needsOffsetRet;++i){var el=els[i],textLength=el.getParsedText().length;elStyles=this._getClassStyles(item,el);try{g.PAssert(2599,!elStyles.plugin||el.getParsedText()===window.AttachChar,"Plugin should only be set for attachment element")}catch(PERR){g.reportError(PERR)}for(var u=0;textLength>u;++u){var ch=el.getParsedText()[u];if(wordDelims.indexOf(ch)<0||0===strIndex){word+=ch;for(var delimWord="",y=strIndex+1;y<fullText.length;++y){var nextCh=fullText[y];if(!(wordDelims.indexOf(nextCh)>=0))break;delimWord+=nextCh}var shouldCommitWord=delimWord||wordPlaceholders.indexOf(ch)>=0||el.getParsedText()[u+1]===window.AttachChar;if(shouldCommitWord){var width=this.measureWord(pane,word,elStyles,noCache),delimWidth=this.measureWord(pane,delimWord,elStyles,noCache);words.push({text:word,delim:delimWord,styles:elStyles,width:width,delimWidth:Math.min(delimWidth,maxWidth),isAttach:ch===window.AttachChar}),word=""}}strIndex++}if(word.length>0){var width=this.measureWord(pane,word,elStyles,noCache);words.push({text:word,delim:"",styles:elStyles,width:width,delimWidth:0}),word=""}}needsOffsetRet=!1,strIndex=0;for(var i=0;i<words.length&&!needsOffsetRet;++i){if(word=words[i],i>lineStart&&lineWidth+word.width+word.delimWidth>maxWidth){var lineRet=this._appendLine(pane,lines,strIndex,words,maxWidth,offset,lineStart,i-1);lineWidth=0,lineStart=i,strIndex+=lineRet.line.text.length,needsOffsetRet|=lineRet.needsOffsetRet}if(word.width+word.delimWidth>maxWidth&&!word.isAttach){for(var bigWordStart=0,t,w,u=0;u<word.text.length&&!needsOffsetRet;++u){if(t=word.text.substring(bigWordStart,u+1),w=this.measureWord(pane,t,word.styles,!0),(w+word.delimWidth>maxWidth||strIndex+t.length-1>offset)&&u>0){var t2=word.text.substring(bigWordStart,u-1),w2=this.measureWord(pane,t2,word.styles,!0);lines.push({text:t2,start:strIndex,length:t2.length,width:w2}),strIndex+=t2.length,bigWordStart=u-1,u--}if(strIndex>=offset){needsOffsetRet=!0;break}}if(!needsOffsetRet&&bigWordStart>0){if(t=word.text.substring(bigWordStart,word.text.length),t.length>0){w=this.measureWord(pane,t,word.styles,!0);var newWord={text:t,delim:word.delim,styles:word.styles,width:w,delimWidth:word.delimWidth};words.splice(i+1,0,newWord)}lineWidth=w+word.delimWidth,lineStart=i+1}}else lineWidth+=word.width+word.delimWidth;needsOffsetRet||i!==words.length-1||this._appendLine(pane,lines,strIndex,words,maxWidth,offset,lineStart,i)}return lines},getItemFromCache:function getItemFromCacheFn(item,maxWidth){var cachedItem=this._itemCache[item.id],validCacheItem,key=maxWidth,text=item.getParsedText();if(cachedItem&&cachedItem[key]&&text==cachedItem.text&&text.indexOf(window.AttachChar)<0){var cached=cachedItem[key];MeasureStats.Cache.ItemCacheHit++,validCacheItem=cached}return validCacheItem||MeasureStats.Cache.ItemCacheMiss++,validCacheItem},saveItemToCache:function saveItemToCacheFn(item,measuredItem){var text=item.getParsedText(),cached=this._itemCache[item.id];if(cached&&cached.text===text){var num=0,oldestTime=Number.MAX_VALUE,oldestWidth;for(var key in cached)if(cached.hasOwnProperty(key)){num++;var oldCached=cached[key],t=oldCached.lastAccess;oldestTime>t&&(oldestTime=t,oldestWidth=key)}num>ItemCacheMaxSize&&delete cached[oldestWidth]}else cached=this._itemCache[item.id]={text:text};cached[measuredItem.maxWidth]=measuredItem},clearItemCache:function clearItemCacheFn(){this._itemCache={}},measureItem:function measureItemFn(item,pane,maxWidth,offset){MeasureStats.CallCount.MeasureItem++;try{g.PAssert(2600,maxWidth>=0,"Max width must be greater than 0")}catch(PERR){g.reportError(PERR)}var measuredItem,fullText=item.getParsedText(),els=item.els,isHeader=item.isHeader();if(0===fullText.length||0===offset){var height=2*g.itemPad+1*g.itemLineHeight,newEls=[{text:"",start:0,length:0,width:0,cls:"line",index:0}];return{width:0,height:height,maxWidth:maxWidth,parsedLines:[],styledLines:[],els:newEls,isHeader:isHeader}}if(void 0===offset&&(measuredItem=this.getItemFromCache(item,maxWidth)),!measuredItem){for(var lines=this.measureLines(item,pane,maxWidth,offset),joined,i,sum=0,lineEls=[],i=0;i<lines.length;++i){var line=lines[i];sum+=line.width,lineEls.push({text:line.text,start:line.start,length:line.length,width:line.width,cls:"line",index:i})}sum=roundToFixed(sum);try{g.PAssert(2602,item&&item.els,"Item has no els: ",item.isArchived(),item._needsParse,lines.length,sum,fullText.length)}catch(PERR){g.reportError(PERR)}if(!els){var height=2*g.itemPad+1*g.itemLineHeight,newEls=[{text:"",start:0,length:0,width:0,cls:"line",index:0}];return{text:fullText,width:0,height:height,maxWidth:maxWidth,parsedLines:[],styledLines:[],els:newEls,isHeader:isHeader}}var generatedLines=DuchessHelpers.generateStyledLines(els,lines);height=2*g.itemPad+g.itemLineHeight*lines.length,measuredItem={width:sum,height:height,maxWidth:maxWidth,parsedLines:lines,styledLines:generatedLines,els:lineEls,isHeader:isHeader,lastAccess:Date.now()},this.saveItemToCache(item,measuredItem)}return measuredItem},_updateCanvasWithStyles:function _updateCanvasWithStylesFn(wordStyles){wordStyles.isBold!==this.isBold?(MeasureStats.Cache.CanvasStyleMiss++,this.getCanvasContext().font=(wordStyles.isBold?"bold ":"")+this.canvasFont,this.isBold=wordStyles.isBold):MeasureStats.Cache.CanvasStyleHit++},measureWord:function measureWordFn(pane,word,wordStyles,noCache){MeasureStats.CallCount.MeasureWord++;try{g.PAssert(2603,void 0!==word,"Must pass in a valid word")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2604,wordStyles,"Must supply valid styles for word")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2605,word.indexOf(window.AttachChar)<0||1===word.length,"AttachChar should not be processed with other chars")}catch(PERR){g.reportError(PERR)}var width=0;if(word.length>0){var start=log.now();if(word===window.AttachChar){try{g.PAssert(2606,!wordStyles.attrs||wordStyles.attrs.plugin,"Must have a valid plugin: ",wordStyles.attrs.plugin)}catch(PERR){g.reportError(PERR)}try{g.PAssert(2607,!wordStyles.attrs||wordStyles.attrs["plugin-id"],"Must have a valid attachment",wordStyles.attrs["plugin-id"])}catch(PERR){g.reportError(PERR)}width=g.vmMain.pluginManager.measureAttachment(pane,wordStyles)}else{var cache=this._selectCache(wordStyles,this.fontSize),cachedValue=cache.getEntrySync(word);if(cachedValue)MeasureStats.Cache.WordCacheHit++,width=cachedValue;else{MeasureStats.Cache.WordCacheMiss++,this._updateCanvasWithStyles(wordStyles);var metrics=this.getCanvasContext().measureText(word);width=roundToFixed(metrics.width),noCache||cache.cacheEntry(word,width)}}timeWord+=log.now()-start}return width},measureLine:function measureLineFn(item,pane,lineIndex,lineOffset,noCache){MeasureStats.CallCount.MeasureLine++;var offset=this.getOffsetFromLineOffset(item,pane,lineIndex,lineOffset),maxWidth=pane.maxWidthOfItem(item),lines=this.measureLines(item,pane,maxWidth,offset,noCache);try{g.PAssert(2608,lines,"Must have valid lines for an item")}catch(PERR){g.reportError(PERR)}var data;return data=lines.length>0?lines[lines.length-1]:[{text:"",start:0,length:0,width:0,cls:"line",index:0}]},getOffsetFromLineOffset:function getOffsetFromLineOffsetFn(item,pane,lineIndex,lineOffset){MeasureStats.CallCount.GetOffsetFromLineOffset++;for(var metrics=item.metricsInPane(pane),lines=metrics.parsedLines,sum=0,i=0;i<lines.length;++i){var line=lines[i].length;if(i===lineIndex)return Math.min(sum+lineOffset,item.getParsedText().length);sum+=line}return 0},getOffsetForPositionInLine:function getOffsetForPositionInLineFn(item,pane,line,targetX,guessOffset){MeasureStats.CallCount.GetOffsetForPositionInLine++;var metrics=item.metricsInPane(pane),els=metrics.els;try{g.PAssert(2609,line>=0&&line<els.length,"findOffsetInLineByX out of range",line)}catch(PERR){g.reportError(PERR)}(-1===guessOffset||guessOffset>els[line].length)&&(guessOffset=els[line].length);var x=this.measureLine(item,pane,line,guessOffset,!0).width,closest=guessOffset,lineWidth=els[line].length,add=targetX-x>0;if(targetX>0)for(var i=add?guessOffset+1:guessOffset-1;add?lineWidth>=i:i>=0;add?i++:i--){var newX=this.measureLine(item,pane,line,i,!0).width;if(!(Math.abs(newX-targetX)<Math.abs(x-targetX)))break;closest=i,x=newX}else closest=0;var closestOffset=this.getOffsetFromLineOffset(item,pane,line,closest);return closestOffset},getNearestOffsetInLine:function getNearestOffsetInLineFn(item,pane,offset,lineOrig,line){MeasureStats.CallCount.GetNearestOffsetInLine++;var metrics=item.metricsInPane(pane),els=metrics.els;try{g.PAssert(2610,lineOrig>=0&&lineOrig<els.length,"findOffsetInLineByX out of range",lineOrig)}catch(PERR){g.reportError(PERR)}try{g.PAssert(2611,line>=0&&line<els.length,"findOffsetInLineByX out of range",line)}catch(PERR){g.reportError(PERR)}for(var origX=this.measureLine(item,pane,lineOrig,offset).width,x=this.measureLine(item,pane,line,offset).width,closest=offset,lineWidth=els[line].length,add=origX-x>0,i=add?offset+1:offset-1;add?lineWidth>i:i>=0;add?i++:i--){var newX=this.measureLine(item,pane,line,i).width;if(!(Math.abs(newX-origX)<Math.abs(x-origX)))break;closest=i,x=newX}return closest},_loadCaches:function _loadCachesFn(){this._wordCache.loadAll(),this._wordCacheBold.loadAll()},_invalidateCaches:function _invalidateCachesFn(){this._wordCache.clearCache(),this._wordCacheBold.clearCache()},_selectCache:function _selectCacheFn(wordStyles,fontSize){return wordStyles.isBold?this._wordCacheBold:this._wordCache}},new Measure}),define("Observable",["util","Listener"],function(util,Listener){function Observable(value,onUpdate){this._value=value,this._listeners=[],onUpdate&&this._listeners.push(onUpdate)
}return Observable.prototype={get:function getFn(){return this._value},set:function setFn(value,notify){var oldValue=this._value;return this._value=value,notify!==!1&&this.notify(value,oldValue,notify),value},listen:function listenFn(cb){return this._listeners.push(cb),new Listener(this,cb)},unlisten:function unlistenFn(cb){this._listeners.remove(cb)},notify:function notifyFn(value,oldValue,shouldNotify){if(0===arguments.length&&(value=this._value),value!==oldValue||shouldNotify===!0)for(var i=0;i<this._listeners.length;i++)0===arguments.length?this._listeners[i]():this._listeners[i](value,oldValue)}},util.defineBase(Observable),Observable}),define("FakeRange",["globals","platform"],function(g,platform){function FakeRange(range){this._range=range,this._range||android.isEnabled()||(this._range=NativeSel._getSelectionRange())}var android={isEnabled:function(){return!!platform.android}};require(["android"],function(androidLoad){android=androidLoad});var NativeSel;return require(["NativeSel"],function(NativeSelLoad){NativeSel=NativeSelLoad}),FakeRange.prototype={isValid:function isValidFn(){return!!this._range},getStartContainer:function getStartContainerFn(){return this._range.startContainer},getEndContainer:function getEndContainerFn(){return this._range.endContainer},getStartElement:function getStartElementFn(){var startEl;return startEl=!this._range&&android.isEnabled()?android.getCurrentElement():g.getElementParent(this._range.startContainer)},getEndElement:function getEndElementFn(){var endEl;return endEl=!this._range&&android.isEnabled()?android.getCurrentElement():g.getElementParent(this._range.endContainer)},getSelectOffsetsInElement:function getSelectOffsetsInElementFn(li){var offsets;return offsets=!this._range&&android.isEnabled()?android.getSelectionOffsets():NativeSel.getSelectOffsetsInElement(li,this._range)},getStartOffset:function getStartOffsetFn(){try{g.PAssert(2612,!android.isEnabled(),"Should not be called during andorid editing")}catch(PERR){g.reportError(PERR)}return this._range.startOffset},getEndOffset:function getEndOffsetFn(){try{g.PAssert(2613,!android.isEnabled(),"Should not be called during andorid editing")}catch(PERR){g.reportError(PERR)}return this._range.endOffset}},FakeRange}),define("NativeSel",["globals","platform","FakeRange"],function(g,platform,FakeRange){function NativeSel(){}return NativeSel.prototype={createSelectionRange:function createSelectionRangeFn(){return document.createRange()},setSelectionRange:function setSelectionRangeFn(range){var selection=window.getSelection();selection.removeAllRanges(),selection.addRange(range)},setSelectionRangeToWhatItAlreadyIs:function setSelectionRangeToWhatItAlreadyIsFn(){var range=this._getSelectionRange();range&&this.setSelectionRange(range)},getSelectionRange:function getSelectionRangeFn(forceNative){var range;return forceNative&&(range=this._getSelectionRange()),new FakeRange(range)},_getSelectionRange:function _getSelectionRangeFn(){var range,selection=window.getSelection();return selection.rangeCount>0&&(range=selection.getRangeAt(0)),range},getSelectionNode:function getSelectionNodeFn(){var selection=window.getSelection(),node=selection.anchorNode;return node?node.nodeType===Node.TEXT_NODE?node.parentNode:node:void 0},clearSelection:function clearSelectionFn(){var selection=window.getSelection();selection.removeAllRanges()},hasSelection:function hasSelectionFn(){var hasSelection=!1,isInAndroidEditBox=document.activeElement&&"androidInput"===document.activeElement.id,range=this._getSelectionRange();if(!isInAndroidEditBox&&range){var pane=g.getPaneForElement(range.startContainer);return pane&&g.findParent(range.startContainer,"paneContent")}return hasSelection=isInAndroidEditBox},hasRawSelection:function hasRawSelectionFn(){return!!window.getSelection().anchorNode},getCursorSelectionRange:function getCursorSelectionRangeFn(e){var range,hovered=g.elementFromPoint(e.clientX,e.clientY,e.target);try{g.PAssert(2614,g.findParent(hovered,"item"),"getCursorSelectionRange must only be called when hovered item is item",hovered)}catch(PERR){g.reportError(PERR)}var boundingRect=hovered.getBoundingClientRect(),clampedY=g.clamp(e.clientY,boundingRect.top+9,boundingRect.bottom-9);if(document.caretRangeFromPoint)range=document.caretRangeFromPoint(e.clientX,clampedY);else if(document.caretPositionFromPoint){var r=document.caretPositionFromPoint(e.clientX,clampedY);range={startContainer:r.offsetNode,endContainer:r.offsetNode,startOffset:r.offset,endOffset:r.offset}}else if(document.body.createTextRange){var origSelection=this._getSelectionRange(),clickTextRange=document.body.createTextRange();try{clickTextRange.moveToPoint(e.clientX,clampedY),clickTextRange.select(),range=this._getSelectionRange(),this.setSelectionRange(origSelection)}catch(err){}}else try{g.PAssert(2615,!1,"Unable to get selection range at cursor")}catch(PERR){g.reportError(PERR)}return range?new FakeRange(range):void 0},_ensureSelectionInElement:function _ensureSelectionInElementFn(element,range){try{g.PAssert(2616,element,"Must have a valid element")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2617,range,"Must have a valid range")}catch(PERR){g.reportError(PERR)}g.isAncestor(range.startContainer,element)||range.setStart(element,0),g.isAncestor(range.endContainer,element)||range.setEnd(element,0),g.hasClass(range.startContainer,"textSelected")&&range.setStart(range.startContainer.parentElement.firstElementChild,range.startContainer.innerText.length),g.hasClass(range.endContainer,"textSelected")&&range.setEnd(range.endContainer.parentElement.firstElementChild,range.endContainer.innerText.length);var startPluginCandidate=g.getPluginForElement(range.startContainer);if(startPluginCandidate){var startPluginLength=startPluginCandidate.textContent.length,isTextNode=startPluginCandidate.nodeType===Node.TEXT_NODE;!isTextNode&&0===range.startOffset||isTextNode&&range.startOffset<startPluginLength/2?range.setStartBefore(startPluginCandidate):range.setStartAfter(startPluginCandidate)}var endPluginCandidate=g.getPluginForElement(range.endContainer);if(endPluginCandidate){var endPluginLength=endPluginCandidate.textContent.length,isTextNode=endPluginCandidate.nodeType===Node.TEXT_NODE;!isTextNode&&0===range.endOffset||isTextNode&&range.endOffset<endPluginLength/2?range.setEndBefore(endPluginCandidate):range.setEndAfter(endPluginCandidate)}},getSelectOffsetsInElement:function getSelectOffsetsInElementFn(element,range){var returnValue={total:0};try{g.PAssert(2618,element&&"LI"===element.tagName,"Expected LI, Actual: ",element)}catch(PERR){g.reportError(PERR)}try{g.PAssert(2619,range,"Must provide a valid range")}catch(PERR){g.reportError(PERR)}if(range&&element){this._ensureSelectionInElement(element,range);var startComponent=this._getComponentNode(range.startContainer),startOffset=range.startOffset,endComponent=this._getComponentNode(range.endContainer),endOffset=range.endOffset;startComponent&&startComponent.textContent!==TextSpace||(startOffset=0),endComponent&&endComponent.textContent!==TextSpace||(endOffset=0);var totalOffset=0,components=this._getComponentNodesIn(element);if(components.length>0)for(var i=0;i<components.length;++i)components[i]===startComponent&&(returnValue.start=totalOffset+startOffset),components[i]===endComponent&&(returnValue.end=totalOffset+endOffset),totalOffset+=this._getComponentNodeLength(components[i]);else returnValue.start=0,returnValue.end=0;returnValue.total=totalOffset,isNaN(returnValue.end)&&(returnValue.end=totalOffset)}else returnValue.start=0,returnValue.end=0;try{g.PAssert(2620,!isNaN(returnValue.start)&&!isNaN(returnValue.end),"Must have valid start and end",returnValue)}catch(PERR){g.reportError(PERR)}return returnValue},getSelectOffsetsForEvent:function getSelectOffsetsForEventFn(e){var reactItem=g.getReactItemForElement(e.target),range=this.getCursorSelectionRange(e);return range.getSelectOffsetsInElement(reactItem.element)},getOffsetChildElement:function getOffsetChildElementFn(element,offset){try{g.PAssert(2621,element,"Must supply a valid element")}catch(PERR){g.reportError(PERR)}if(this._isComponentNode(element)){try{g.PAssert(2623,this._isComponentSelectable(element),"Component must be selectable")}catch(PERR){g.reportError(PERR)}return{element:element,offset:offset}}for(var totalOffset=0,children=this._getComponentNodesIn(element),i=0;i<children.length;++i){var childLength=this._getComponentNodeLength(children[i]);if(totalOffset+childLength>=offset)return{element:children[i],offset:offset-totalOffset};totalOffset+=childLength}try{g.PAssert(2622,!1,"Unable to find offset child element")}catch(PERR){g.reportError(PERR)}return void 0},getChildNodeOffset:function getChildNodeOffsetFn(child){try{g.PAssert(2624,child,"Must supply a valid child element")}catch(PERR){g.reportError(PERR)}for(var offset=0,children=this._getComponentNodesIn(g.getElementParent(child)),childrenSub=this._getComponentNodesIn(child),i=0;i<children.length&&children[i]!==childrenSub[0];++i)offset+=this._getComponentNodeLength(children[i]);return offset},_getComponentNodeLength:function _getComponentNodeLengthFn(node){try{g.PAssert(2625,this._isComponentNode(node),"Supplied node must be a valid component")}catch(PERR){g.reportError(PERR)}return g.hasClass(node,"plugin")?1:1===node.length&&node.textContent===TextSpace?0:node.length},_getComponentNodesIn:function _getComponentNodesInFn(element){if(this._isComponentNode(element))return[element];var nodes=[];return this._getComponentNodes(nodes,element),nodes},_isComponentNode:function _isComponentNodeFn(node){var isComponent=!1;return node&&(node.nodeType===Node.TEXT_NODE&&!g.getPluginForElement(node)||g.hasClass(node,"plugin"))&&(isComponent=!0),isComponent},_isComponentSelectable:function _isComponentSelectableFn(node){try{g.PAssert(2626,!node||this._isComponentNode(node),"Must either be an invalid node (not-selectable) or a component")}catch(PERR){g.reportError(PERR)}var isSelectable=!1;return node&&node.nodeType===Node.TEXT_NODE&&(isSelectable=!0),isSelectable},_getComponentNodes:function _getComponentNodesFn(arr,node){if(node)if(this._isComponentNode(node))arr.push(node);else if(node.childNodes)for(var i=0;i<node.childNodes.length;++i){var el=node.childNodes[i];this._getComponentNodes(arr,el)}},_getComponentNode:function _getComponentNodeFn(node){var componentNode;if(this._isComponentNode(node))componentNode=node;else{var pluginCandidate=g.getPluginForElement(node);if(pluginCandidate)componentNode=pluginCandidate;else{var components=this._getComponentNodesIn(node);components&&(componentNode=components[0])}}return componentNode},setSelectionValues:function setSelectionValuesFn(range,startEle,startOffset,endEle,endOffset){try{g.PAssert(2627,range,"Range must be supplied")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2628,this._isComponentNode(startEle),"Must be selecting a valid component")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2629,this._isComponentNode(endEle),"Must be selecting a valid component")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2630,startEle!==endEle||endOffset>=startOffset,"Select elements must be different, or selection must start before it ends")}catch(PERR){g.reportError(PERR)}if(startEle.nodeType===Node.TEXT_NODE)range.setStart(startEle,startOffset);else{try{g.PAssert(2631,g.hasClass(startEle,"plugin"),"Only other valid component is plugin")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2632,0===startOffset||1===startOffset,"Must eiter be selecting before or after the plugin")}catch(PERR){g.reportError(PERR)}0===startOffset?this._selectBeforeComponent(range,startEle,"setStart"):1===startOffset&&this._selectAfterComponent(range,startEle,"setStart")}if(endEle.nodeType===Node.TEXT_NODE)range.setEnd(endEle,endOffset);else{try{g.PAssert(2633,g.hasClass(endEle,"plugin"),"Only other valid component is plugin")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2634,0===endOffset||1===endOffset,"Must eiter be selecting before or after the plugin")}catch(PERR){g.reportError(PERR)}0===endOffset?this._selectBeforeComponent(range,endEle,"setEnd"):1===endOffset&&this._selectAfterComponent(range,endEle,"setEnd")}},_selectBeforeComponent:function _selectBeforeComponentFn(range,node,fnName){var prevComponent=this._getPrevComponent(node),isPrevSelectable=this._isComponentSelectable(prevComponent);if(isPrevSelectable)range[fnName](prevComponent,this._getComponentNodeLength(prevComponent));else{var newTarget=document.createTextNode("");node.parentNode.insertBefore(newTarget,node),range[fnName](newTarget,0)}},_selectAfterComponent:function _selectAfterComponentFn(range,node,fnName){var nextComponent=this._getNextComponent(node),isNextSelectable=this._isComponentSelectable(nextComponent);if(isNextSelectable)range[fnName](nextComponent,0);else{var newTarget=document.createTextNode("");node.parentNode.insertBefore(newTarget,void 0),range[fnName](newTarget,0)}},_getPrevComponent:function _getPrevComponentFn(node){try{g.PAssert(2635,node,"Must supply a valid node")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2636,this._isComponentNode(node),"Supplied node must be a valid component itself")}catch(PERR){g.reportError(PERR)}var prevNode=node.previousSibling;try{g.PAssert(2637,!prevNode||this._isComponentNode(prevNode),"Siblings must always be valid components")}catch(PERR){g.reportError(PERR)}return prevNode},_getNextComponent:function _getNextComponentFn(node){try{g.PAssert(2638,node,"Must supply a valid node")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2639,this._isComponentNode(node),"Supplied node must be a valid component itself")}catch(PERR){g.reportError(PERR)}var nextNode=node.nextSibling;try{g.PAssert(2640,!nextNode||this._isComponentNode(nextNode),"Siblings must always be valid components")}catch(PERR){g.reportError(PERR)}return nextNode}},new NativeSel}),define("EditHelpers",[],function(){function EditHelpers(){}return EditHelpers.prototype={getPreviousWord:function getPreviousWordFn(text,offset){var ret=Math.max(text.prevIndexOf(" ",offset-1),text.prevIndexOf("-",offset-1));return ret},getNextWord:function getNextWordFn(text,offset){var ret,iSpace=text.indexOf(" ",offset),iDash=text.indexOf("-",offset);return ret=0>iDash?iSpace:0>iSpace?iDash:Math.min(iSpace,iDash),-1===ret&&(ret=text.length),ret}},new EditHelpers}),define("Sel",["globals","platform","data","util","Dispatcher","Measure","Observable","NativeSel","EditHelpers"],function(g,platform,d,util,Dispatcher,Measure,Observable,NativeSel,EditHelpers){function Sel(){this._isValid=!1,this._isDirty=!1,this._isWatchingChange=!0,this._isMouseDown=!1,this.isWindowFocused=new Observable(!0),this.hoveredItem=void 0,this.hoveredPane=void 0,this._selectedMap=[],this._scrollTop=0,this.mousePos={x:-1,y:-1},this.mouseDownPos={x:-1,y:-1},this._lastClickTime=0,this._numClicks=1,this.pane=new Observable,this.init()}var InvalidOffset=-1,SelectionSide={Start:"start",End:"end"},DragDrop,android,edit;return require(["DragDrop","android","edit"],function(DragDropLoad,AndroidLoad,editLoad){DragDrop=DragDropLoad,android=AndroidLoad,edit=editLoad}),Sel.prototype={init:function initFn(){this.reset();var clickHandlers={};platform.mobile?(clickHandlers.onMove=this.onMouseMoveMobile.bind(this),document.addEventListener("selectstart",this._onSelectStart.bind(this)),document.addEventListener("selectionchange",this._onSelectionChange.bind(this))):(clickHandlers.onStart=this.onMouseDown.bind(this),clickHandlers.onEnd=this.onMouseUp.bind(this),clickHandlers.onRightStart=this.onRightMouseDown.bind(this),clickHandlers.onMove=this.onMouseMove.bind(this),document.addEventListener("mousemove",this.onMouseMoveDocument.bind(this),!0)),g.setupClick(document,this,clickHandlers),window.addEventListener("blur",this.onWindowBlur.bind(this)),window.addEventListener("focus",this.onWindowFocus.bind(this)),Dispatcher.listen("paneAdded",this.onPaneAdded.bind(this)),Dispatcher.listen("paneRemoved",this.onPaneRemoved.bind(this)),Dispatcher.listen("paneSizeChanged",this.updateCaret.bind(this)),util.forceBind("onScroll",this)},reset:function resetFn(){this._isValid&&(this._setOffset(SelectionSide.Start,void 0),this._setIndex(SelectionSide.Start,void 0),this._setOffset(SelectionSide.End,void 0),this._setIndex(SelectionSide.End,void 0),this._dblClickOffsets=void 0,this.preferLineStart=!1,this._mouseOffset=-1,this._mouseMoved=!1,this._isValid=!1,this._isArrowSelectInverted=!1,this.getPane()&&this.getPane().caretPosition.set(void 0),this._updateSelection(),platform.mobile&&g.keyboardToolbar&&(g.vmMain.clearSelected(),g.fireCustomEvent("closeKeyboard")))},dumpState:function dumpStateFn(){var state={isValid:this._isValid,isDirty:this._isDirty,isWatchingChange:this._isWatchingChange,isMouseDown:this._isMouseDown,isWindowFocused:this.isWindowFocused.get(),numClicks:this._numClicks,start:{index:this.startIndex,offset:this.startOffset},end:{index:this.endIndex,offset:this.endOffset}};try{var hasPane=!!this.pane.get();state.paneInfo=hasPane?{hasPane:hasPane,id:this.pane.get().id,numItems:this.pane.get().numItems()}:"No Pane Set"}catch(err){state.paneInfo="Invalid Pane"}try{void 0!==this.startIndex&&(state.start.item=this.pane.get().getItems()[this.startIndex].id)}catch(err){state.start.item="Invalid Item"}try{void 0!==this.endIndex&&(state.end.item=this.pane.get().getItems()[this.endIndex].id)}catch(err){state.end.item="Invalid Item"}return state},setValid:function setValidFn(valid){valid||this.reset(),this._isValid=valid},isArrowSelectInverted:function isArrowSelectInvertedFn(){return this._isArrowSelectInverted},setArrowSelectInverted:function setArrowSelectInvertedFn(value){this._isArrowSelectInverted=value},getStartItem:function getStartItemFn(){return this.getPane().itemAtIndex(this.startIndex)},getStartOffset:function getStartOffsetFn(){var startOffset;return this.startOffset===InvalidOffset?(startOffset=this.getStartTotal(),this.startOffset=startOffset):startOffset=this.startOffset,startOffset},getStartIndex:function getStartIndexFn(){return this.startIndex},getStartTotal:function getStartTotalFn(){return this.getStartItem().getParsedText().length},getEndItem:function getEndItemFn(){return this.getPane().itemAtIndex(this.endIndex)},getEndOffset:function getEndOffsetFn(){var endOffset;return this.endOffset===InvalidOffset?(endOffset=this.getEndTotal(),this.endOffset=endOffset):endOffset=this.endOffset,endOffset},getEndIndex:function getEndIndexFn(){return this.endIndex},getEndTotal:function getEndTotalFn(){return this.getEndItem().getParsedText().length},isMouseDown:function isMouseDownFn(){return this._isMouseDown},_mutateProperty:function _mutatePropertyFn(updateProp,value){var oldValue=this[updateProp];this[updateProp]=value,oldValue!==value&&(this._isDirty=!0)},_setIndex:function _setIndexFn(toUpdate,index){this._mutateProperty(toUpdate+"Index",index)},_setOffset:function _setOffsetFn(toUpdate,offset){this._mutateProperty(toUpdate+"Offset",offset)},isValid:function isValidFn(){return this._isValid},getPane:function getPaneFn(){try{g.PAssert(2641,this.pane.get()===g.focusedPane,"Should these always match?")}catch(PERR){g.reportError(PERR)}return this.pane.get()},clearSelection:function clearSelectionFn(){this.reset()},onPaneAdded:function onPaneAddedFn(pane){pane.useCustomScroller||platform.mobile||pane.addScrollListener(this.onScroll)},onPaneRemoved:function onPaneRemovedFn(pane){pane.useCustomScroller||platform.mobile||pane.removeScrollListener(this.onScroll),this.getPane()===pane&&this.setFocusedPane(void 0)},onScroll:function onScrollFn(e){this._scrollTop=e.target.scrollTop;var pane=g.getPaneForElement(e.target);if(this._isMouseDown&&pane===this.getPane()&&pane.isWriteable&&!DragDrop.isDragging){var pos=this.mousePos;this._mouseOffset=this.mousePos.y+this._scrollTop,e.clientX=pos.x,e.clientY=pos.y;var target=g.elementFromPoint(pos.x,pos.y,e.target),params={clientX:pos.x,clientY:pos.y,target:target};this._updateFromMouse(params),this._updateSelection()}},onRightMouseDown:function onRightMouseDownFn(e){var ok=!0,li=g.getElementParent(e.target);if(li){var reactItem=g.getReactItemForElement(li);if(reactItem){var pane=g.getPaneForElement(li),index=reactItem.props.index;this.isSelected(index,pane)&&(ok=!1)}}ok&&this.onMouseDown(e,!0)},checkDoubleClick:function checkDoubleClickFn(){this._isValid&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()!==this.getEndOffset()&&(this._dblClickOffsets={index:this.getStartIndex(),start:this.getStartOffset(),end:this.getEndOffset()})},onMouseDown:function onMouseDownFn(e,isRightClick){var pane=g.getPaneForElement(e.target);if(this.isWindowFocused.set(!0),pane){var hovered=g.elementFromPoint(e.clientX,e.clientY,e.target);if(!g.hasClass(hovered,"itemCheckbox")&&!g.hasClass(hovered,"collapser")){this._isMouseDown=!0,this._selectionBeforeBlur=void 0,this.preferLineStart=void 0;var MAGIC_NUMBER_1=2,MAGIC_NUMBER_2=300;if(isRightClick)this._lastClickTime=0;else{var time=Date.now();time-this._lastClickTime<MAGIC_NUMBER_2&&Math.abs(e.pageX-this.mouseDownPos.x)<MAGIC_NUMBER_1&&Math.abs(e.pageY-this.mouseDownPos.y)<MAGIC_NUMBER_1?this._numClicks++:this._numClicks=1,this._lastClickTime=time}this.mouseDownPos.x=e.pageX,this.mouseDownPos.y=e.pageY,this.setFocusedPane(pane),pane.onFocus();var downLI=g.getElementParent(e.target),valid=!1;if(pane&&pane.isWriteable){if(downLI){var range=NativeSel.getCursorSelectionRange(e);if(range){var downReactItem=g.getReactItemForElement(range.getStartElement());if(downReactItem&&!downReactItem.props.outline){if(e.shiftKey)this._mouseMoved=!0,this._mouseOffset=e.eventY+this._scrollTop,this._updateFromMouse(e);else if(1===this._numClicks||this._numClicks>3){this.reset(),this._downIndex=downReactItem.props.index,this._setIndex(SelectionSide.Start,this._downIndex),this._setIndex(SelectionSide.End,this._downIndex),this._downItem=downReactItem.props.item;var offsets=range.getSelectOffsetsInElement(downReactItem.element);this._downOffset=offsets.start,this._setOffset(SelectionSide.Start,this._downOffset),this._setOffset(SelectionSide.End,this._downOffset)}else if(2===this._numClicks){var text=this._downItem.getParsedText(),prevWord=EditHelpers.getPreviousWord(text,this._downOffset)+1,nextWord=EditHelpers.getNextWord(text,this._downOffset);this._setOffset(SelectionSide.Start,prevWord),this._setOffset(SelectionSide.End,nextWord)}else 3===this._numClicks&&(this._setOffset(SelectionSide.Start,0),this._setOffset(SelectionSide.End,this._downItem.getParsedText().length));valid=!0}}}else if(g.findParent(e.target,"paneContent")){var selIndex=g.focusedPane.numItems()-1;selIndex>=0&&(e.shiftKey&&this.isValid()&&!isRightClick?this.selectIndices(this.getStartIndex(),this.getStartOffset(),selIndex,-1):this.selectIndex(selIndex,-1)),valid=!0,e.preventDefault()}this._dblClickTimeout=setTimeout(this.checkDoubleClick.bind(this),0)}this.setValid(valid),valid&&this._updateSelection()}}},onMouseMoveDocument:function onMouseMoveDocumentFn(e){this.mousePos.x=e.pageX,this.mousePos.y=e.pageY},onMouseMove:function onMouseMoveFn(e){try{g.PAssert(2644,!platform.mobile,"Should not be called on mobile")}catch(PERR){g.reportError(PERR)}this._dblClickTimeout&&(clearTimeout(this._dblClickTimeout),this._dblClickTimeout=void 0);var pane=g.getPaneForElement(e.target);return this._isValid&&this._isMouseDown&&pane===this.getPane()&&pane.isWriteable&&!DragDrop.isDragging?(this._mouseMoved=!0,this._mouseOffset=e.eventY+this._scrollTop,this._updateFromMouse(e),this._updateSelection(),pane.scrollFromMousePosition(e.clientY),e.preventDefault(),!1):void 0},onMouseMoveMobile:function onMouseMoveMobileFn(e){this.mousePos.x=e.pageX||e.clientX,this.mousePos.y=e.pageY||e.clientY},onMouseUp:function onMouseUpFn(e){var pane=g.getPaneForElement(e.target);if(pane){this._isMouseDown=!1;var downLI=g.getElementParent(e.target);downLI&&this.updateCaret(),g.cancelRepeatScroll()}},focusPane:function focusPaneFn(pane){this.setFocusedPane(pane),pane.focus(),this.updateCaret()},setFocusedPane:function setFocusedPaneFn(pane){pane&&g.focusedPane&&g.focusedPane.id===pane.id||(this.reset(),g.focusedPane=pane,g.focusedItem=pane?pane.getItem():void 0,this.pane.set(pane))},_updateWith:function _updateWithFn(toUpdate,whichSelect,range){var container=whichSelect===SelectionSide.Start?range.getStartElement():range.getEndElement();try{g.PAssert(2645,container,"Trying to select in invalid container")}catch(PERR){g.reportError(PERR)}if(container){var reactItem=g.getReactItemForElement(container),offsets=range.getSelectOffsetsInElement(reactItem.element),offsetsValue=whichSelect===SelectionSide.Start?offsets.start:offsets.end;try{g.PAssert(2646,reactItem.props.item,"Should not be updating ReactItems without VMLIs")}catch(PERR){g.reportError(PERR)}if(this._setIndex(toUpdate,reactItem.props.index),this._dblClickOffsets&&reactItem.props.index===this._dblClickOffsets.index)if(toUpdate===SelectionSide.Start)offsetsValue=Math.min(offsetsValue,this._dblClickOffsets.start);else if(toUpdate===SelectionSide.End)offsetsValue=Math.max(offsetsValue,this._dblClickOffsets.end);else try{g.PAssert(2647,!1,"Invalid toUpdate value")}catch(PERR){g.reportError(PERR)}this._setOffset(toUpdate,offsetsValue);try{g.PAssert(2648,!isNaN(offsetsValue),"Selection offsets should not be undefined")}catch(PERR){g.reportError(PERR)}}},_updateFromMouse:function _updateFromMouseFn(e){try{g.PAssert(2649,!platform.mobile,"Should never be reading selection values from mouse on mobile, only accept taps")}catch(PERR){g.reportError(PERR)}var target=e.target;if(target){var pane=g.focusedPane;if(g.hasClass(target,"paneContent")){var lastItem=pane.getLastItem();return this._setIndex(SelectionSide.End,pane.numItems()-1),void this._setOffset(SelectionSide.End,lastItem?lastItem.getParsedText().length:0)}if(g.getElementParent(target)){var range=NativeSel.getCursorSelectionRange(e);if(range&&g.findParent(range.getStartContainer(),"line")&&g.findParent(range.getEndContainer(),"line")){var reactItem=g.getReactItemForElement(range.getStartElement()),offsets=range.getSelectOffsetsInElement(reactItem.element),index=reactItem.props.index,offset=offsets.start,toUpdate;index<this._downIndex||index===this._downIndex&&offset<this._downOffset?(toUpdate=SelectionSide.End,this._updateWith(SelectionSide.Start,SelectionSide.Start,range),this.setArrowSelectInverted(!0)):(index>this._downIndex||index===this._downIndex&&offset>=this._downOffset)&&(toUpdate=SelectionSide.Start,this._updateWith(SelectionSide.End,SelectionSide.End,range),this.setArrowSelectInverted(!1),offset===this._downOffset&&(this._isDirty=!0)),void 0!==toUpdate&&(this._setIndex(toUpdate,this._downIndex),this._dblClickOffsets?this._setOffset(toUpdate,this._dblClickOffsets[toUpdate]):this._setOffset(toUpdate,this._downOffset),this.setValid(!0))}}else if(e.clientY<pane.contentTop()){target=g.elementFromPoint(e.clientX,pane.contentTop()+1,e.target);var element=g.getElementParent(target);if(element){var reactItem=g.getReactItemForElement(target),item=g.getItemForElement(target);try{g.PAssert(2650,item,"If it is an LI it should be an item",target)}catch(PERR){g.reportError(PERR)}this._setIndex(SelectionSide.Start,reactItem.props.index),this._setOffset(SelectionSide.Start,0)}}}},setSelectionFromNativeRange:function setSelectionFromNativeRangeFn(range){this._updateWith(SelectionSide.Start,SelectionSide.Start,range),this._updateWith(SelectionSide.End,SelectionSide.End,range),this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex()))},_updateSelection:function _updateSelectionFn(force){if(this._isDirty||force){var numNotified=0,pane=this.getPane(),oldSelected=this._selectedMap;if(this._selectedMap=[],this.setValid(!isNaN(this.getStartIndex())&&!isNaN(this.getEndIndex())),this.getStartIndex()===this.getEndIndex()&&void 0!==this.getStartIndex()){try{g.PAssert(2651,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(PERR){g.reportError(PERR)}platform.mobile&&g.vmMain.setSelected([this.getStartItem()]),this.getStartOffset()!==this.getEndOffset()&&(this._selectedMap[this.getStartIndex()]={start:this.getStartOffset(),end:this.getEndOffset()})}else for(var i=this.getStartIndex();i<=this.getEndIndex();++i){var offsets;if(i===this.getStartIndex())offsets={start:this.getStartOffset(),end:InvalidOffset};else if(i===this.getEndIndex()){try{g.PAssert(2652,this.getEndOffset()<=this.getEndItem().getParsedText().length,"Selection is past end of text string")}catch(PERR){g.reportError(PERR)}offsets={start:0,end:this.getEndOffset()}}else offsets=!0;this._selectedMap[i]=offsets}pane&&(oldSelected.forEach(function(selection,oldIndex){if(void 0===this._selectedMap[oldIndex]&&oldIndex<pane.numItems()){var item=pane.itemAtIndex(oldIndex);item&&(item.itemChanged.notify(),numNotified++)}}.bind(this)),this._selectedMap.forEach(function(selection,newIndex){var oldSel=oldSelected[newIndex],newSel=this._selectedMap[newIndex];if(void 0===oldSel||oldSel.start!==newSel.start||oldSel.end!==newSel.end){var item=pane.itemAtIndex(newIndex);item&&(item.itemChanged.notify(),numNotified++)}}.bind(this))),this.updateCaret(),this._isDirty=!1}},_onSelectStart:function _onSelectStartFn(e){return DragDrop=DragDrop||require("DragDrop"),log("Select Start: ",DragDrop.isDragging,e),DragDrop.isDragging?(e.preventDefault(),!1):!0},_onSelectionChange:function _onSelectionChangeFn(e){if(NativeSel.hasSelection()){if(platform.android&&DragDrop.isDragging)return void NativeSel.clearSelection();if(platform.ios)if(this.getPane().isWriteable){var range=NativeSel.getSelectionRange();this.setSelectionFromNativeRange(range),edit.updateAutocomplete(e)}else this.reset()}NativeSel.getSelectionRange(!0).isValid()||g.closeKeyboard()},updateCaret:function updateCaretFn(){if(!platform.ios){var pane=this.getPane();if(pane&&pane.isWriteable)if(this.isValid()){if(this.getStartItem()&&this.getEndItem()&&this.getStartIndex()===this.getEndIndex()&&this.getStartOffset()===this.getEndOffset()){var item=this.getStartItem(),itemTop=pane.topOfItem(item),padding=this.getStartItem().getPadding(pane),caretPosition=Measure.getCaretOffset(item,pane,this.getStartOffset(),this.preferLineStart);caretPosition.left+=padding,caretPosition.top+=itemTop+g.topBoxHeight+(platform.mobile?0:g.itemPad),(pane.caretPosition.left!==caretPosition.left||pane.caretPosition.top!==caretPosition.top)&&pane.caretPosition.set(caretPosition)}else pane.caretPosition.set(void 0);if(android.isEnabled())android.updateInput(this.getStartItem());else if(pane.emptyElement){var range=NativeSel.createSelectionRange(),emp=pane.emptyElement;try{g.PAssert(2653,emp.firstChild,"Empty element does not have a child")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2654,emp.firstChild&&emp.firstChild.length>0,"Empty element has no length")}catch(PERR){g.reportError(PERR)}emp.firstChild&&0!==emp.firstChild.length||(emp.innerHTML=TextSpace);var selEle=emp.firstChild;range.setStart(selEle,0),range.setEnd(selEle,1),NativeSel.setSelectionRange(range)}}else pane.caretPosition.set(void 0)}},isSelected:function isSelectedFn(index,pane){return pane!==this.getPane()?!1:!!this._selectedMap[index]},getSelectionAtIndex:function getSelectionAtIndexFn(index){return this._selectedMap[index]},setSelectionFromAndroid:function setSelectionFromAndroidFn(startOffset,endOffset){this._setOffset(SelectionSide.Start,startOffset),this._setOffset(SelectionSide.End,endOffset)},selectIndex:function selectIndexFn(index,startOffset,endOffset){return void 0===endOffset&&(endOffset=startOffset),this.selectIndices(index,startOffset,index,endOffset)},selectIndices:function selectIndicesFn(startIndex,startOffset,endIndex,endOffset){try{g.PAssert(2655,startIndex>=0,"Must supply a valid start index")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2656,endIndex>=0,"Must supply a valid end index")}catch(PERR){g.reportError(PERR)}if(!(0>startIndex||0>endIndex)){var didSelect=!1;if(!this.isValid()||platform.ios||startIndex!==this.getStartIndex()||startOffset!==this.getStartOffset()||endIndex!==this.getEndIndex()||endOffset!==this.getEndOffset()){var pane=this.getPane(),startItem,endItem;
if(pane&&pane.isWriteable){startItem=pane.itemAtIndex(startIndex),endItem=pane.itemAtIndex(endIndex);try{g.PAssert(2657,startItem,"Trying to select invalid start index")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2658,endItem,"Trying to select invalid end index")}catch(PERR){g.reportError(PERR)}}if(startItem&&endItem){this._setIndex(SelectionSide.Start,startIndex),this._setOffset(SelectionSide.Start,startOffset),this._setIndex(SelectionSide.End,endIndex),this._setOffset(SelectionSide.End,endOffset),this._downIndex=startIndex,this._downOffset=startOffset;try{g.PAssert(2659,!isNaN(this.getStartOffset())&&!isNaN(this.getEndOffset()),"Selection offsets should not be undefined")}catch(PERR){g.reportError(PERR)}if(!isNaN(this.getStartOffset())&&this.getStartOffset()>=0&&!isNaN(this.getEndOffset())&&this.getEndOffset()<=this.getEndTotal()&&this._updateSelection(!0),platform.ios){var startElement=pane.elementAtIndex(startIndex),endElement=pane.elementAtIndex(endIndex);this.selectElements(startElement,startOffset,endElement,endOffset)}didSelect=!0}}else this.updateCaret();return didSelect}},selectItem:function selectItemFn(item,startOffset,endOffset){try{g.PAssert(2660,g.isNumber(startOffset),"Must pass a valid start offset")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2661,g.isNumber(endOffset)||void 0===endOffset,"Must pass a valid end offset")}catch(PERR){g.reportError(PERR)}return void 0===endOffset&&(endOffset=startOffset),this.selectItems(item,startOffset,item,endOffset)},selectItems:function selectItemsFn(startItem,oStart,endItem,oEnd){try{g.PAssert(2662,g.isVMLI(startItem),"Should only be passing VMLIs to start this fn")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2663,g.isVMLI(endItem),"Should only be passing VMLIs to end this fn")}catch(PERR){g.reportError(PERR)}var pane=this.getPane(),startIndex=pane.indexOfItem(startItem);try{g.PAssert(2664,startIndex>=0,"Must be able to find the start item in the pane")}catch(PERR){g.reportError(PERR)}var endIndex=pane.indexOfItem(endItem);try{g.PAssert(2665,endIndex>=0,"Must be able to find the end item in the pane")}catch(PERR){g.reportError(PERR)}return this.selectIndices(startIndex,oStart,endIndex,oEnd)},selectElements:function selectElementsFn(eStart,oStart,eEnd,oEnd){try{g.PAssert(2666,!g.isVMLI(eStart),"Should not be passing VMLIs to start this fn")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2667,!g.isVMLI(eEnd),"Should not be passing VMLIs to end this fn")}catch(PERR){g.reportError(PERR)}this._isWatchingChange=!1;var retVal=!1,start=NativeSel.getOffsetChildElement(eStart,oStart),end=NativeSel.getOffsetChildElement(eEnd,oEnd);try{g.PAssert(2668,start&&start.element&&!isNaN(start.offset),"Start element is invalid")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2669,end&&end.element&&!isNaN(end.offset),"End element is invalid")}catch(PERR){g.reportError(PERR)}if(start&&start.element&&end&&end.element){var range=NativeSel.createSelectionRange();NativeSel.setSelectionValues(range,start.element,start.offset,end.element,end.offset),NativeSel.setSelectionRange(range),retVal=!0}return this._isWatchingChange=!0,retVal},getOffsetInLine:function getOffsetInLineFn(item,pane,offset){for(var metrics=item.metricsInPane(pane),lines=metrics.parsedLines,sum=0,i=0;i<lines.length;++i){var line=lines[i].length;if(sum+line>offset)return{line:i,offset:offset-sum};sum+=line}return void 0},getNearestOffsetInLine:function getNearestOffsetInLineFn(item,pane,offset,lineOrig,line){return Measure.getNearestOffsetInLine(item,pane,offset,lineOrig,line)},save:function saveFn(){if(!this._isValid)return void 0;try{g.PAssert(2671,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2672,!isNaN(this.getEndIndex()),"End index must be valid")}catch(PERR){g.reportError(PERR)}return{pane:this.getPane(),startIndex:this.getStartIndex(),startItem:this.getStartItem(),startOffset:this.getStartOffset(),endIndex:this.getEndIndex(),endItem:this.getEndItem(),endOffset:this.getEndOffset()}},restore:function restoreFn(saved,adjust){saved&&(this.pane.set(saved.pane),saved=saved.pane.adjustSelectionFromRemoteChanges(saved)),saved&&saved.startItem&&saved.endItem?this.selectIndices(saved.startIndex,saved.startOffset,saved.endIndex,saved.endOffset):this.reset()},scrollStartIntoView:function scrollStartIntoViewFn(snap){if(this._isValid){try{g.PAssert(2673,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2674,!isNaN(this.getEndIndex()),"End index must be valid")}catch(PERR){g.reportError(PERR)}g.focusedPane.scrollIndexIntoView(this.getStartIndex(),snap?ScrollDuration.Snap:ScrollDuration.Default)}},scrollEndIntoView:function scrollEndIntoViewFn(){if(this._isValid){try{g.PAssert(2675,!isNaN(this.getStartIndex()),"Start index must be valid")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2676,!isNaN(this.getEndIndex()),"End index must be valid")}catch(PERR){g.reportError(PERR)}g.focusedPane.scrollIndexIntoView(this.getEndIndex(),ScrollDuration.Default)}},onWindowBlur:function onWindowBlurFn(e){this.isWindowFocused.set(!1)},onWindowFocus:function onWindowFocusFn(e){this.isWindowFocused.set(!0)},getSelectedItems:function getSelectedItemsFn(){if(!this._isValid)return[];for(var arr=[],pane=this.getPane(),items=pane.getItems(),i=this.getStartIndex();i<=this.getEndIndex();++i)arr.push(items[i]);return arr},getStartElement:function getStartElementFn(){return this._isValid&&!isNaN(this.getStartIndex())?this.getPane().elementAtIndex(this.getStartIndex()):void 0},setHovered:function setHoveredFn(pane,item){if(pane!==this.hoveredPane||item!==this.hoveredItem){var oldItem=this.hoveredItem;this.hoveredItem=item,this.hoveredPane=pane,oldItem&&oldItem.itemChanged.notify(),item&&item.itemChanged.notify()}},isItemHovered:function isItemHoveredFn(item,pane){return this.hoveredItem===item&&this.hoveredPane===pane}},new Sel}),define("tracker",["globals","util","platform","data","gdata","Sel"],function(g,util,platform,d,gdata,Sel){function tracker(){this.disabled=!1,this.allowOfflineUndo=!1,this.cursor=-1,this.groupID=0,this.groups=[],this.externalUndoRedo=!1,this.undoRedoActive=!1,this.canRedo=!1,this.canUndo=!1,this._performingActions=!1,this._currentAction=[],this._actionsPreventUndo=!1,this._aggregateActions=0,this._externalStateChanged=[],util.forceBind("stateChangeForUndoRedo",this),this.init()}function undoInsert(data){for(var i=0;i<data.length;++i){var entry=data[i],model=d.getModel(entry.itemID);try{g.PAssert(2677,model,"Expected model to exist: ",entry)}catch(PERR){g.reportError(PERR)}var oldText=model.getParsedText(),startIndex=0;"﻿"===oldText[0]&&(startIndex=1);var newText=oldText.slice(startIndex,entry.position)+oldText.slice(entry.position+entry.text.length);model.setText(newText,!0,ChangeType.Local),Sel.selectItem(model,entry.position)}}function redoInsert(data){for(var i=0;i<data.length;++i){var entry=data[i],model=d.getModel(entry.itemID);try{g.PAssert(2678,model,"Expected model to exist: ",entry)}catch(PERR){g.reportError(PERR)}var oldText=model.getParsedText(),newText=oldText.slice(0,entry.position)+entry.text+oldText.slice(entry.position);0===newText.length&&(newText="﻿"),model.setText(newText,!0,ChangeType.Local),Sel.selectItem(model,entry.position,entry.position+entry.text.length)}}function undoRemove(data){for(var i=0;i<data.length;++i){var entry=data[i],model=d.getModel(entry.itemID);try{g.PAssert(2679,model,"Expected model to exist: ",entry)}catch(PERR){g.reportError(PERR)}var oldText=model.getParsedText(),startIndex=0;"﻿"===oldText[0]&&(startIndex=1);var newText=oldText.slice(startIndex,entry.position)+entry.text+oldText.slice(entry.position);model.setText(newText,!0,ChangeType.Local),Sel.selectItem(model,entry.position,entry.position+entry.text.length)}}function redoRemove(data){for(var i=0;i<data.length;++i){var entry=data[i],model=d.getModel(entry.itemID);try{g.PAssert(2680,model,"Expected model to exist: ",entry)}catch(PERR){g.reportError(PERR)}var oldText=model.getParsedText(),newText=oldText.slice(0,entry.position)+oldText.slice(entry.position+entry.text.length);0===newText.length&&(newText="﻿"),model.setText(newText,!0,ChangeType.Local),Sel.selectItem(model,entry.position)}}function undoCreate(data){for(var i=0;i<data.length;++i){var entry=data[i],parentModel=d.getModel(entry.parent);try{g.PAssert(2681,parentModel,"Expected model to exist: ",entry)}catch(PERR){g.reportError(PERR)}var removedChild=parentModel.removeChildAtIndex(entry.position);try{g.PAssert(2682,removedChild.id===entry.itemID,"Expected data to match removed child: ",removedChild,entry)}catch(PERR){g.reportError(PERR)}removedChild.parent(void 0),d.deleteItem(removedChild,ChangeType.Local);var selectionChild=parentModel;entry.position>0&&(selectionChild=parentModel.getChild(entry.position-1)),g.focusedPane.indexOfItem(selectionChild)>=0&&Sel.selectItem(selectionChild,selectionChild.getParsedText().length),parentModel.save({items:parentModel.getItemsArrayForSave()},SaveFlag.None)}}function redoCreate(data){for(var i=0;i<data.length;++i){var entry=data[i],parentModel=d.getModel(entry.parent);try{g.PAssert(2683,parentModel,"Expected parent model to exist: ",entry)}catch(PERR){g.reportError(PERR)}var newChild=d.getModel(entry.itemID);try{g.PAssert(2684,newChild,"Expected child model to exist: ",entry)}catch(PERR){g.reportError(PERR)}d.undeleteItem(newChild,ChangeType.Local),newChild.parent(parentModel),parentModel.items.splice(entry.position,0,newChild),Sel.selectItem(newChild,0),parentModel.save({items:parentModel.getItemsArrayForSave()},SaveFlag.None)}}function undoDelete(data){for(var i=0;i<data.length;++i){var entry=data[i],parentModel=d.getModel(entry.parent);try{g.PAssert(2686,parentModel,"Expected model to exist: ",entry)}catch(PERR){g.reportError(PERR)}var childModel=d.getModel(entry.itemID);try{g.PAssert(2687,childModel,"Expected model to exist: ",entry)}catch(PERR){g.reportError(PERR)}d.undeleteItem(childModel,ChangeType.Local),childModel.parent(parentModel),parentModel.items.splice(entry.position,0,childModel),Sel.selectItem(childModel,0),parentModel.save({items:parentModel.getItemsArrayForSave()},SaveFlag.None)}}function redoDelete(data){for(var i=0;i<data.length;++i){var entry=data[i],parentModel=d.getModel(entry.parent);try{g.PAssert(2689,parentModel,"Expected model to exist: ",entry)}catch(PERR){g.reportError(PERR)}var removedChild=parentModel.removeChildAtIndex(entry.position);try{g.PAssert(2690,removedChild.id===entry.itemID,"Expected data to match removed child: ",removedChild,entry)}catch(PERR){g.reportError(PERR)}removedChild.parent(void 0),d.deleteItem(removedChild,ChangeType.Local);var selectionChild=parentModel;entry.position>0&&(selectionChild=parentModel.getChild(entry.position-1)),Sel.selectItem(selectionChild,selectionChild.getParsedText().length),parentModel.save({items:parentModel.getItemsArrayForSave()},SaveFlag.None)}}function undoMove(data){for(var i=0;i<data.length;++i){var entry=data[i],oldParent=d.getModel(entry.oldParent);try{g.PAssert(2691,oldParent,"Expected oldParent model to exist: ",entry)}catch(PERR){g.reportError(PERR)}var newParent=d.getModel(entry.newParent);try{g.PAssert(2692,newParent,"Expected newParent model to exist: ",entry)}catch(PERR){g.reportError(PERR)}var child=newParent.removeChildAtIndex(entry.newPosition);try{g.PAssert(2693,child.id===entry.itemID,"Expected data to match child: ",child,entry)}catch(PERR){g.reportError(PERR)}child.parent(oldParent),oldParent.items.splice(entry.oldPosition,0,child),Sel.selectItem(child,0),newParent.save({items:newParent.getItemsArrayForSave()},SaveFlag.None),oldParent.save({items:oldParent.getItemsArrayForSave()},SaveFlag.None)}}function redoMove(data){for(var i=0;i<data.length;++i){var entry=data[i],oldParent=d.getModel(entry.oldParent);try{g.PAssert(2694,oldParent,"Expected oldParent model to exist: ",entry)}catch(PERR){g.reportError(PERR)}var newParent=d.getModel(entry.newParent);try{g.PAssert(2695,newParent,"Expected newParent model to exist: ",entry)}catch(PERR){g.reportError(PERR)}var child=oldParent.removeChildAtIndex(entry.oldPosition);try{g.PAssert(2696,child.id===entry.itemID)}catch(PERR){g.reportError(PERR)}child.parent(newParent),newParent.items.splice(entry.newPosition,0,child),Sel.selectItem(child,0),newParent.save({items:newParent.getItemsArrayForSave()},SaveFlag.None),oldParent.save({items:oldParent.getItemsArrayForSave()},SaveFlag.None)}}function undoUpdate(data){for(var i=0;i<data.length;++i){var entry=data[i],item=d.getModel(entry.itemID);try{g.PAssert(2697,item,"Expected model to exist: ",entry)}catch(PERR){g.reportError(PERR)}try{g.PAssert(2698,item[entry.field],"Expected field to exist: ",entry)}catch(PERR){g.reportError(PERR)}item[entry.field](entry.oldValue)}}function redoUpdate(data){for(var i=0;i<data.length;++i){var entry=data[i],item=d.getModel(entry.itemID);try{g.PAssert(2699,item,"Expected model to exist: ",entry)}catch(PERR){g.reportError(PERR)}try{g.PAssert(2700,item[entry.field],"Expected field to exist: ",entry)}catch(PERR){g.reportError(PERR)}item[entry.field](entry.newValue)}}function undoFormat(data){for(var i=0;i<data.length;++i){var entry=data[i],item=d.getModel(entry.itemID);try{g.PAssert(2701,item,"Expected model to exist: ",entry)}catch(PERR){g.reportError(PERR)}}}function redoFormat(data){for(var i=0;i<data.length;++i){var entry=data[i],item=d.getModel(entry.itemID);try{g.PAssert(2702,item,"Expected model to exist: ",entry)}catch(PERR){g.reportError(PERR)}}}function undoZoom(data){var entry=data[0],oldItem=d.getModel(entry.oldItemID);try{g.PAssert(2703,oldItem,"Expected model to exist: ",entry)}catch(PERR){g.reportError(PERR)}if(entry.zoomIn)g.vmMain.zoomout(oldItem,!0);else if(entry.zoomOut)g.vmMain.zoomin(oldItem,!0);else try{g.PAssert(2704,!1,"Zoom action must define either zoomIn or zoomOut")}catch(PERR){g.reportError(PERR)}}function redoZoom(data){var entry=data[0],item=d.getModel(entry.itemID);try{g.PAssert(2705,item,"Expected model to exist: ",entry)}catch(PERR){g.reportError(PERR)}if(entry.zoomIn)g.vmMain.zoomout(item,!0);else if(entry.zoomOut)g.vmMain.zoomin(item,!0);else try{g.PAssert(2706,!1,"Zoom action must define either zoomIn or zoomOut")}catch(PERR){g.reportError(PERR)}}function undoUIAction(data){var entry=data[0];switch(entry.type){case TrackerUIAction.RemovePane:break;case TrackerUIAction.SwitchPaneMode:break;default:try{g.PAssert(2707,!1,"Invalid UIAction")}catch(PERR){g.reportError(PERR)}}}function redoUIAction(data){}window.TrackerType={Insert:1,Remove:2,SetText:3,Create:4,Delete:5,Move:6,Update:7,Format:8,Zoom:9,UIAction:10,Misc:11,Mobile:12},window.TrackerMisc={ToggleOutline:1,RightClick:2,CloseMessage:3,ChangeDate:4,AddContact:5,DropItem:6,SyncContacts:7,OpenContact:8,SearchChanged:10,OpenDocumentsMenu:11,AddDocument:12,OpenDocument:13,OpenDocSharing:14,Copy:15,Paste:16,OpenImport:17,OpenExport:18,UndoRedo:19},window.TrackerMiscMobile={OpenKeyboard:1,CloseKeyboard:2,PaneAgenda:3,PaneNormal:4,OpenAutocomplete:5,CloseAutocomplete:6,AtButton:7,OpenMultiselect:8,CloseMultiselect:9},window.TrackerUIAction={AddPane:1,RemovePane:2,SwitchPaneMode:3,OpenSettingsMenu:4};var MaxGroups=75;return tracker.prototype={init:function initFn(){gdata.registerForUndoRedoStateChange(this)},_getNextGroupID:function _getNextGroupIDFn(){return this.groupID+1},_useNextGroupID:function _useNextGroupIDFn(){return++this.groupID},_getCurrentGroup:function _getCurrentGroupFn(){return this.groups[this.cursor]},_getCurrentAction:function _getCurrentActionFn(){return this.groups[this.cursor].events[this.groups[this.cursor].events.length-1]},_pushGroup:function _pushGroupFn(){var id=this._useNextGroupID();return this.groups.push({id:id,events:[],persisted:!1}),this.cursor<MaxGroups-1&&this.cursor++,this.groups.length>MaxGroups&&this._handleGroupTrimmed(this.groups.shift()),id},_doAction:function _doActionFn(type,data){var group=this._getCurrentGroup();try{g.PAssert(2708,group,"Expected group to exist")}catch(PERR){g.reportError(PERR)}var action={type:type,data:data};switch(type){case TrackerType.Insert:action.cb={undo:undoInsert,redo:redoInsert};break;case TrackerType.Remove:action.cb={undo:undoRemove,redo:redoRemove};break;case TrackerType.Create:action.cb={undo:undoCreate,redo:redoCreate};break;case TrackerType.Delete:action.cb={undo:undoDelete,redo:redoDelete};break;case TrackerType.Move:action.cb={undo:undoMove,redo:redoMove};break;case TrackerType.Update:action.cb={undo:undoUpdate,redo:redoUpdate};break;case TrackerType.Format:action.cb={undo:undoFormat,redo:redoFormat};break;case TrackerType.Zoom:action.cb={undo:undoZoom,redo:redoZoom};break;case TrackerType.UIAction:action.cb={undo:undoUIAction,redo:redoUIAction};break;default:try{g.PAssert(2709,!1,"Expected TrackerType, received: ",type)}catch(PERR){g.reportError(PERR)}}group.events.push(action)},_handleGroupTrimmed:function _handleGroupTrimmedFn(group){for(var i=0;i<group.events.length;++i){var action=group.events[i];switch(action.type){case TrackerType.Insert:break;case TrackerType.Remove:break;case TrackerType.Create:break;case TrackerType.Delete:break;case TrackerType.Move:break;case TrackerType.Update:break;case TrackerType.Format:break;case TrackerType.Zoom:break;case TrackerType.UIAction:break;default:try{g.PAssert(2710,!1,"Expected TrackerType, received: ",action.type)}catch(PERR){g.reportError(PERR)}}}},_mergeAction:function _mergeActionFn(type,data){log("Tracker Action Merged: ",type,data);var action=this._getCurrentAction();try{g.PAssert(2711,action,"Expected action to exist")}catch(PERR){g.reportError(PERR)}switch(type){case TrackerType.Insert:break;case TrackerType.Remove:break;case TrackerType.Create:break;case TrackerType.Delete:break;case TrackerType.Move:break;case TrackerType.Update:break;case TrackerType.Format:try{g.PAssert(2712,!1,"Formats cannot be merged")}catch(PERR){g.reportError(PERR)}break;case TrackerType.Zoom:try{g.PAssert(2713,!1,"Zooms cannot be merged")}catch(PERR){g.reportError(PERR)}break;case TrackerType.UIAction:try{g.PAssert(2714,!1,"UIActions cannot be merged")}catch(PERR){g.reportError(PERR)}break;default:try{g.PAssert(2715,!1,"Expected TrackerType, received: ",type)}catch(PERR){g.reportError(PERR)}}},_canMerge:function _canMergeFn(type){var shouldMerge=!1,group=this._getCurrentGroup();return group&&group.events.length>0&&(group.events[group.events.length-1].type===type?type===TrackerType.Insert&&(shouldMerge=!0):shouldMerge=!1),shouldMerge},_canCombine:function _canCombineFn(type,groupID){var group=this._getCurrentGroup();return group&&(group.id===groupID||0===group.events.length)},performActions:function performActionsFn(actions){try{g.PAssert(2716,!this.disabled||g.intro,"Can only perform actions when enabled or during the intro")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2717,!this._performingActions,"Can not nest performing actions")}catch(PERR){g.reportError(PERR)}if(this._performingActions=!0,actions&&actions.length>0){if(!this.disabled){var groupID=void 0;this.cursor!=this.groups.length-1?(this.groups.splice(this.cursor+1,this.groups.length-(this.cursor+1)),groupID=this._pushGroup()):groupID=this._getNextGroupID()}for(var i=0;i<actions.length;++i){var action=actions[i];g.intro&&g.intro.onAction(action),this.disabled||(this._canCombine(action.type,groupID)?this._canMerge(action.type)?this._mergeAction(action.type,action.data):this._doAction(action.type,action.data):(groupID=this._pushGroup(),this._doAction(action.type,action.data)))}}this._performingActions=!1},beginAction:function beginActionFn(preventUndo){try{g.PAssert(2718,!this._performingActions,"Should never begin an action while replaying old actions")}catch(PERR){g.reportError(PERR)}if(0===this._aggregateActions){this._actionsPreventUndo=!!preventUndo,gdata.beginAction(preventUndo);try{g.PAssert(2719,0===this._currentAction.length,"Current actions should always be empty when starting a new action")}catch(PERR){g.reportError(PERR)}}this._aggregateActions++},performAction:function performActionFn(type,data){try{g.PAssert(2720,!this._performingActions,"Should never perform an action while replaying old actions")}catch(PERR){g.reportError(PERR)}var isFromLoad=!g.vmMain.isLoaded||g.isLoadingRemote;this.disabled?g.intro&&(isFromLoad||this.performActions([{type:type,data:[data]}])):this._aggregateActions?this._currentAction.push({type:type,data:[data]}):this.performActions([{type:type,data:[data]}])},endAction:function endActionFn(){try{g.PAssert(2721,!this._performingActions,"Should never end an action while replaying old actions")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2722,0!==this._aggregateActions,"Must have called beginAction before calling endAction")}catch(PERR){g.reportError(PERR)}1===this._aggregateActions&&((!this.disabled||g.intro)&&this.performActions(this._currentAction),this._currentAction.length=0,gdata.endAction(),this._actionsPreventUndo=!1),this._aggregateActions=Math.max(0,this._aggregateActions-1)},resetAggregateActionCount:function resetAggregateActionCountFn(){this._aggregateActions=0},_processStateChangedSelection:function _processStateChangedSelectionFn(stateChanged){try{g.PAssert(2723,!this.undoRedoActive,"Must not currently be undoing/redoing an action when setting selection")}catch(PERR){g.reportError(PERR)}var finalModel=void 0,finalPosition=0,finalLength=0;if(g.isKeyboardOPen||!g.keyboardToolbar){for(var i=0;i<stateChanged.length;++i){var entry=stateChanged[i],data=entry.data,model=d.getModel(data.itemID);try{g.PAssert(2724,model,"Expected model to exist: ",data)}catch(PERR){g.reportError(PERR)}switch(entry.type){case TrackerType.Insert:finalModel=model,finalPosition=data.position,finalLength=data.text.length;break;case TrackerType.Remove:finalModel=model,finalPosition=data.position,finalLength=0;break;case TrackerType.SetText:g.focusedPane.indexOfItem(model)>=0&&(finalModel=model,finalPosition=data.position,finalLength=0);break;case TrackerType.Create:finalModel=model,finalPosition=0,finalLength=0;break;case TrackerType.Delete:if(data.previous){var selectionChild=d.getModel(data.previous);selectionChild&&(finalModel=selectionChild,finalPosition=selectionChild.getParsedText().length,finalLength=0)}}}finalModel&&(Sel.selectItem(finalModel,finalPosition,finalPosition+finalLength),g.focusedPane.scrollItemIntoView(finalModel,ScrollDuration.Default))}this._externalStateChanged=[]},notifyStateChangedFromUndoRedo:function notifyStateChangedFromUndoRedoFn(type,data){try{g.PAssert(2725,this.undoRedoActive)}catch(PERR){g.reportError(PERR)}this._externalStateChanged.push({type:type,data:data})},undoAction:function undoActionFn(){g.vmMain.isOnline()||this.allowOfflineUndo||g.messageQueue.pushMessage(MessageID.OfflineUndo),this.undoRedoActive=!0;try{g.PAssert(2726,!this._performingActions)}catch(PERR){g.reportError(PERR)}if(!this.disabled&&this.allowOfflineUndo){if(this.cursor>=0)for(var group=this.groups[this.cursor--],i=group.events.length-1;i>=0;i--){var action=group.events[i];action.cb.undo(action.data)}}else if(this.canUndo){try{g.PAssert(2727,this.externalUndoRedo)}catch(PERR){g.reportError(PERR)}gdata.undoAction()}this.undoRedoActive=!1,this._processStateChangedSelection(this._externalStateChanged),this.miscAction({type:TrackerType.Misc,misc:TrackerMisc.UndoRedo,data:[{undo:!0}]})},redoAction:function redoActionFn(){g.vmMain.isOnline()||this.allowOfflineUndo||g.messageQueue.pushMessage(MessageID.OfflineUndo),this.undoRedoActive=!0;try{g.PAssert(2728,!this._performingActions)}catch(PERR){g.reportError(PERR)}if(!this.disabled&&this.allowOfflineUndo){if(this.cursor>=-1&&this.cursor<this.groups.length-1)for(var group=this.groups[++this.cursor],i=0;i<group.events.length;++i){var action=group.events[i];action.cb.redo(action.data)}}else if(this.canRedo){try{g.PAssert(2729,this.externalUndoRedo)}catch(PERR){g.reportError(PERR)}gdata.redoAction()}this.undoRedoActive=!1,this._processStateChangedSelection(this._externalStateChanged),this.miscAction({type:TrackerType.Misc,misc:TrackerMisc.UndoRedo,data:[{redo:!0}]})},miscAction:function miscActionFn(e){if(g.intro)try{g.intro.onAction(e)}catch(err){g.reportError(err)}},resetState:function resetStateFn(){this._performingActions=!1,this._externalStateChanged=[],this._currentAction=[],this.undoRedoActive=!1,this.cursor=-1,this.groupID=0,this.groups=[]},_getOrderedGroups:function _getOrderedGroupsFn(){return this.groups.slice(this.cursor).concat(this.groups.slice(0,this.cursor))},stringifyGroups:function stringifyGroupsFn(){var groups=this._getOrderedGroups();return"Tracker: "+groups.length},stateChangeForUndoRedo:function stateChangeForUndoRedoFn(event){this.externalUndoRedo=!0,this.disabled=!0,this.canRedo=event.canRedo,this.canUndo=event.canUndo}},new tracker}),define("ObservableArray",["util","Listener","Observable"],function(util,Listener,Observable){function ObservableArray(value,onUpdate){this._super.constructor.call(this,value,onUpdate),this._value=value||[],this.version=0}var ObservableArrayFns={wrapKOArray:function wrapKOArrayFn(koArray){this._value=koArray(),koArray.subscribe(this.koChanged.bind(this))},koChanged:function koChangedFn(value){this.set(value)},length:function lengthFn(){return this._value.get().length},set:function setFn(arr,notify){this._value=arr,this.version++,notify!==!1&&this.notify(this._value)},remove:function removeFn(item,notify){var ret=this._value.remove(item);return this.version++,notify!==!1&&this.notify(this._value),ret},removeAt:function removeAtFn(index,notify){var ret=this._value.removeAt(index);return this.version++,notify!==!1&&this.notify(this._value),ret},push:function pushFn(item,notify){var ret=this._value.push(item);return this.version++,notify!==!1&&this.notify(this._value),ret},insertSorted:function insertSortedFn(item,sortFn,notify){var ret=this._value.insertSorted(item,sortFn);return this.version++,notify!==!1&&this.notify(this._value),ret},splice:function spliceFn(index,remove,item,notify){var ret;return ret=item?this._value.splice(index,remove,item):this._value.splice(index,remove),this.version++,notify!==!1&&this.notify(this._value),ret}};return util.inherit(Observable,ObservableArray),util.extend(ObservableArray.prototype,ObservableArrayFns),ObservableArray}),define("DragDrop",["ko","globals","platform","tracker","data","Observable","ObservableArray","Sel"],function(ko,g,platform,tracker,d,Observable,ObservableArray,Sel){function DragDrop(){this.activePane=void 0,this.startPane=void 0,this.previousEventTarget=void 0,this.previousDropTarget=void 0,this.previousHighlightElement=void 0,this.previousAbove=void 0,this.previousWasPane=void 0,this.dataTransfer=void 0,this.startInfo=void 0,this.startDragItem=void 0,this.isDragging=!1,this.dragItem=void 0,this.isVisible=new Observable(!1),this.draggingItems=new ObservableArray,this.draggingExternal=new Observable(!1),this.position=new Observable,this.transform=new Observable({left:0,top:0}),this.linePosition=new Observable,window.addEventListener("dragover",this.handleDragOver.bind(this)),window.addEventListener("dragleave",this.handleDragLeave.bind(this)),window.addEventListener("drop",this.handleDrop.bind(this))}var copypaste;return require(["copypaste"],function(copypasteLoad){copypaste=copypasteLoad}),DragDrop.prototype={stop:function stopFn(){this.activePane?this.activePane.notifyDragEnd():g.vmMain.paneManager.runForEachPane(function(pane){pane.notifyDragEnd()});for(var items=this.draggingItems.get(),i=0;i<items.length;++i)items[i].draggedInPane.set(!1);this.draggingItems.set([],!1),this.draggingExternal.set(!1,!1),this.isDragging=!1,this.dragItem=void 0,this.isVisible.set(!1)},start:function startFn(items,left,top,pane,startInfo,dataTransfer){this.isDragging&&this.stop(),Sel.reset(),this.isDragging=!0,this.activePane=pane,this.startPane=pane,this.startInfo=startInfo,this.dataTransfer=dataTransfer,this.draggingItems.set(items,!1),this.transform.set({left:0,top:0},!1),this.position.set({left:left,top:top},!1);for(var i=0;i<items.length;++i)items[i].draggedInPane.set(g.focusedPane);this.isVisible.set(!0),this.activePane.notifyDragStart()},startExternal:function startExternalFn(pane){this.isDragging=!0,this.activePane=pane,this.startPane=pane,this.draggingExternal.set(!0,!1),this.draggingItems.set([],!1),this.isVisible.set(!0),this.activePane.notifyDragStart()},setTransform:function setTransformFn(left,top){this.isVisible.set(!0,!1),this.transform.set({left:left,top:top})},handleDragOver:function handleDragOverFn(e){var eventTarget=g.elementFromPoint(e.clientX,e.clientY,e.srcElement),li=g.getElementParent(eventTarget),pane=g.getPaneForElement(eventTarget);if(this.activePane=pane,li||pane){try{g.PAssert(2730,pane,"Must have a valid pane to update our drag target on")}catch(PERR){g.reportError(PERR)}this.isDragging||this.startExternal(pane);var currentDropTarget,highlightAbove,highlightElement,changedHighlight=!1,xPadding=0,isPane=!1;if(pane&&pane.isWriteable)if(li&&(currentDropTarget=g.getItemForElement(eventTarget)),currentDropTarget)currentDropTarget.isNote()&&(currentDropTarget=currentDropTarget.parent()),pane.isWriteable&&currentDropTarget.isFullscreen()?this.previousDropTarget&&(currentDropTarget=this.previousDropTarget,highlightAbove=e.diffY<0||this.previousWasPane?!0:!1):highlightAbove=!0,this.previousHighlightElement=li,changedHighlight=!0,xPadding=currentDropTarget.getPadding(pane);else if(pane&&g.findParent(eventTarget,"paneContent")){if(isPane=!0,highlightAbove=e.diffY<0?!0:!1,this.previousDropTarget&&g.getPaneForElement(this.previousDropTarget)===pane)currentDropTarget=this.previousDropTarget;else{var lastItem=pane.getLastItem();lastItem?(currentDropTarget=lastItem,this.previousHighlightElement=pane.elementAtIndex(pane.numItems()-1),changedHighlight=!0):(currentDropTarget=pane,this.previousHighlightElement=pane.paneContent,highlightAbove=!0,changedHighlight=!0)}xPadding=0}else currentDropTarget=e.dataTransfer.item,this.previousHighlightElement=void 0,changedHighlight=!0;else this.previousHighlightElement=void 0,changedHighlight=!0;if(this.previousAbove=highlightAbove,this.previousHighlightElement&&changedHighlight){var rect=this.previousHighlightElement.getBoundingClientRect(),y=highlightAbove?rect.top:rect.bottom;if(y>pane.contentTop()){var x=rect.left+xPadding+6,width=rect.right-rect.left-xPadding;this.linePosition.set({left:x,top:y,width:width})}}else this.linePosition.set(void 0);this.previousDropTarget=currentDropTarget,this.previousEventTarget=eventTarget,this.previousWasPane=isPane}return this.activePane&&this.activePane===pane?this.activePane.scrollFromMousePosition(e.clientY):g.cancelRepeatScroll(),!1},handleDropItem:function handleDropItemFn(movingItem,e,isNew){try{g.PAssert(2733,this.previousDropTarget,"Must have always had at least one drop target before actually dropping")}catch(PERR){g.reportError(PERR)}var item=movingItem;if(g.cancelRepeatScroll(),movingItem!==this.previousDropTarget){if(g.isVMLI(this.previousDropTarget)){for(var parent=this.previousDropTarget.parent();parent;){if(parent===movingItem)return void 0;parent=parent.parent()}if(g.focusedPane.isWriteable&&g.getNextItem(movingItem,g.focusedPane)===this.previousDropTarget&&this.previousAbove)return void 0}var pane=g.getPaneForElement(this.previousEventTarget);if(pane&&pane.isWriteable){var target,targetIndex=-1;g.isPane(this.previousDropTarget)?(target=this.previousDropTarget.getItem(),targetIndex=0):this.previousDropTarget.isFullscreen()?(target=this.previousDropTarget,targetIndex=target.numChildren()):(target=this.previousDropTarget.parent(),targetIndex=this.previousAbove?this.previousDropTarget.getIndex():this.previousDropTarget.getIndex()+1),tracker.beginAction();try{g.PAssert(2734,target,"Trying to move without a target")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2735,!isNaN(targetIndex),"Trying to move without a target index")}catch(PERR){g.reportError(PERR)}var performedDrop=!0;if(e.dataTransfer.dropEffect===DropEffect.Move){var previousParent=movingItem.parent(),previousIndex=movingItem.getIndex();
previousParent.belongsToSameItemStore(target)?(movingItem.moveTo({parent:target,index:targetIndex}),tracker.performAction(TrackerType.Move,{itemID:movingItem.id,oldParent:previousParent.id,oldPosition:previousIndex,newParent:target.id,newPosition:targetIndex})):(item=movingItem.clone(target,ChangeType.Local),target.insertItem(item,targetIndex),previousParent.removeChildAtIndex(previousIndex))}else isNew||(item=e.dataTransfer.fromPane?e.dataTransfer.fromPane.dropEffectCopyBehavior(movingItem,target):movingItem.clone(target,ChangeType.Local)),item?(item.parent(target),target.insertItem(item,targetIndex)):performedDrop=!1;tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.DropItem,data:[{itemID:movingItem.id}]}),tracker.endAction(),performedDrop&&e.dataTransfer.fromPane&&e.dataTransfer.fromPane.notifyDropFrom(movingItem,pane)}}return item},handleDrop:function handleDropFn(e){if(e.stopPropagation(),this.previousEventTarget&&this.activePane&&this.previousDropTarget){var dropItem=e.dataTransfer.item;if(dropItem)this.handleDropItem(dropItem,e);else{var pluginHandled=g.vmMain.pluginManager.handleDropEvent(e,function(res,isNew){tracker.beginAction();var item=d.createVMLI({text:res},{changeType:ChangeType.AllLocal});return item=this.handleDropItem(item,e,isNew),tracker.endAction(),item}.bind(this));if(!pluginHandled&&(e.dataTransfer.getData(platform.ie?"Text":"text/plain")||e.dataTransfer.getData("text/html"))){var range=NativeSel.getCursorSelectionRange(e);try{g.PAssert(2736,range,"Range should always be properly set")}catch(PERR){g.reportError(PERR)}NativeSel.setSelectionRange(range),copypaste.insert(e.dataTransfer,range,e,DataSource.Drop)}}this.isVisible.set(!1),this.draggingExternal.get()&&(this.isDragging=!1,this.draggingExternal.set(!1)),e.preventDefault()}},handleDragLeave:function handleDragLeaveFn(e){(g.hasClass(e.target,"paneRoot")||"reactRoot"===e.target.id)&&(this.isVisible.set(!1),this.draggingExternal.get()&&(this.isDragging=!1,this.draggingExternal.set(!1)))}},new DragDrop}),define("android",["util","globals","platform","NativeSel","Sel","DragDrop"],function(util,g,platform,NativeSel,Sel,DragDrop){function android(){this._activePane=void 0,this._inputContainer=void 0,this._inputBox=void 0,this._currentVMLI=void 0,this._canSetInput=void 0,this._pasteHappened=!1,this._forceFirstCaps=!0,this._isStarred=!1,this._linePadding=2,this._padCharacter="​",this._activeKeyboard=void 0,this._customKeyboard=void 0,this._wasHeader=!1,this._isInputVisible=!1,this._lastHeight=0,this._enabled=!1}var edit,tracker,copypaste,AndroidFns={isEnabled:function isEnabledFn(){return this._enabled},getCurrentVMLI:function getCurrentVMLIFn(){return this._currentVMLI},setCurrentVMLI:function setCurrentVMLIFn(vmli){try{g.PAssert(2737,vmli,"Must supply a valid VMLI to android editing")}catch(PERR){g.reportError(PERR)}this._currentVMLI=vmli},clearCurrentVMLI:function clearCurrentVMLIFn(){this._currentVMLI=void 0},isCurrentVMLI:function isCurrentVMLIFn(vmli){return this._currentVMLI===vmli},isVisible:function isVisibleFn(){return this._isInputVisible},getCurrentElement:function getCurrentElementFn(){var elem;if(this._currentVMLI){var itemIndex=this._activePane.indexOfItem(this._currentVMLI);elem=this._activePane.elementAtIndex(itemIndex);try{g.PAssert(2738,elem,"Must be able to get a valid element for the current VMLI to update input bounds")}catch(PERR){g.reportError(PERR)}}return elem},isTargetBox:function isTargetBoxFn(e){return g.isAncestor(e.target||e.srcElement,this.getInputContainer())},getInputContainer:function getInputContainerFn(){return this._inputContainer},getInputBox:function getInputBoxFn(){return this._inputBox},getRawInputText:function getRawInputTextFn(){return this.getInputBox().value},setRawInputText:function setRawInputTextFn(text){this.getInputBox().value=text},getRawSelectionStart:function getRawSelectionStartFn(){return this.getInputBox().selectionStart},getRawSelectionEnd:function getRawSelectionEndFn(){return this.getInputBox().selectionEnd},getSelectionStart:function getSelectionStartFn(){return this.getRawSelectionStart()<this._linePadding?0:this.getRawSelectionStart()-this._linePadding},getSelectionEnd:function getSelectionEndFn(){return this.getRawSelectionEnd()<this._linePadding?0:this.getRawSelectionEnd()-this._linePadding},getSelectionOffsets:function getSelectionOffsetsFn(){return{start:this.getSelectionStart(),end:this.getSelectionEnd(),total:this.getInputText().length}},setSelection:function setSelectionFn(start,end){this.setRawSelection(start+this._linePadding,end+this._linePadding)},setRawSelection:function setRawSelectionFn(start,end){this.setRawSelectionStart(start),this.setRawSelectionEnd(end)},setRawSelectionStart:function setRawSelectionStartFn(start){this.getInputBox().selectionStart=start},setRawSelectionEnd:function setRawSelectionEndFn(end){this.getInputBox().selectionEnd=end},canSetInput:function canSetInputFn(){return void 0===this._canSetInput&&(this._canSetInput=null!==this.getInputBox().selectionStart&&void 0!==this.getInputBox().selectionStart&&null!==this.getInputBox().selectionEnd&&void 0!==this.getInputBox().selectionEnd),this._canSetInput},getActiveKeyboard:function getActiveKeyboardFn(){return this._activeKeyboard},notifyCustomKeyboard:function notifyCustomKeyboardFn(keyboard){keyboard.startsWith("com.google.android")||(this._customKeyboard=keyboard),this._activeKeyboard=keyboard},setPaneRoot:function setPaneRootFn(pane){try{g.PAssert(2739,pane,"Must supply a valid pane")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2740,pane.rootElement,"Pane must have a valid root element")}catch(PERR){g.reportError(PERR)}if(void 0===pane.rootElement){try{g.PAssert(2741,!platform.android,"Android should always have editing enabled")}catch(PERR){g.reportError(PERR)}return void(this._enabled=!1)}this._enabled=!0,this._activePane!==pane&&(this._activePane=pane,platform.mobileie&&this._activePane.paneContent.removeAttribute("contenteditable"),this._inputBox=document.createElement("textarea"),this._inputBox.id="androidInput",this._inputBox.style.visibility="hidden",this._inputContainer=this._inputBox,this._activePane.rootElement.appendChild(this._inputBox),this._inputBox.addEventListener("focus",function(e){DragDrop.isDragging||g.isKeyboardOpen||g.keyboardToolbar.show(g.keyboardToolbar.Type.Item)}),platform.mobileie||this._inputBox.addEventListener("blur",function(e){(!e.relatedTarget||g.hasClass(e.relatedTarget,"search"))&&(this.finishInput(),g.keyboardToolbar.hide())}.bind(this)),this._inputBox.addEventListener("input",function(e){try{g.PAssert(2742,this._currentVMLI,"VMLI must be selected in order to get input events")}catch(PERR){g.reportError(PERR)}if(this._currentVMLI){if(edit=edit||require("edit"),Sel.setSelectionFromAndroid(this.getSelectionEnd(),this.getSelectionEnd()),this._pasteHappened)if(this._pasteHappened=!1,copypaste=copypaste||require("copypaste"),document.createEvent){var eventObj=document.createEvent("Event");eventObj.synthetic=!0,eventObj.data={types:["text/plain"],getData:function getDataFn(){return this.getBoxValue()}},eventObj.initEvent("paste",!0,!0),Sel.selectItem(this._currentVMLI,0,this.getBoxValue().length),this._inputBox.dispatchEvent(eventObj)}else try{g.PAssert(2743,!1,"Unable to fire key event")}catch(PERR){g.reportError(PERR)}else{var isBackspace=!this.getBoxHasTextSpace();if(isBackspace){tracker=tracker||require("tracker");try{g.PAssert(2744,edit&&tracker,"Should always be defined")}catch(PERR){g.reportError(PERR)}tracker.beginAction(),edit.handleBackspace(e),tracker.endAction()}else this.handleChacterTyped(e)}this.ensureLinePadding(),edit.updateAutocomplete(e),this.checkAndroidBounds()}}.bind(this)),log("---- Android Editing Enabled ----"))},notifyStarred:function notifyStarredFn(newValue){this._isStarred!==newValue&&(this._isStarred=newValue,this._isStarred?g.addClass(this._inputBox,"pStar"):g.removeClass(this._inputBox,"pStar"))},_forceCapsHelper:function _forceCapsHelperFn(){var text=this.getBoxValue(),newText;1===text.length?newText=text.toUpperCase():text.length>1&&(newText=text[0].toUpperCase()+text.substring(1)),this.setBoxValue(newText)},handleChacterTyped:function handleChacterTypedFn(){if(!this._customKeyboard){var sOffset=this.getSelectionStart(),eOffset=this.getSelectionEnd();sOffset===eOffset?1===sOffset?this._forceFirstCaps&&this._forceCapsHelper():0===sOffset&&(this._forceFirstCaps=!1):0===sOffset&&eOffset>0&&this._forceFirstCaps&&this._forceCapsHelper()}this._activePane.scrollItemIntoView(this.getCurrentVMLI(),ScrollDuration.Default)},updateInput:function updateInputFn(vmli){try{g.PAssert(2745,this.isEnabled(),"Must be enabled to update input")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2746,vmli,"Must supply a valid item to select")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2747,Sel.isValid(),"Must have a valid selection to update android input")}catch(PERR){g.reportError(PERR)}var openingInput=!1;this._isInputVisible||(this._isInputVisible=!0,openingInput=!0,this.getInputContainer().style.visibility="visible",(null===this.getInputContainer().parentElement||void 0===this.getInputContainer().parentElement)&&this._activePane.rootElement.appendChild(this.getInputContainer())),g.isKeyboardOpen||g.keyboardToolbar.show(g.keyboardToolbar.Type.Item);var itemChanged=vmli!==this.getCurrentVMLI();if((itemChanged||vmli&&vmli.isHeader()!==this._wasHeader)&&(this._currentVMLI&&itemChanged&&this.finishInput(!0),this.setCurrentVMLI(vmli),this._wasHeader=vmli.isHeader(),this.notifyStarred(vmli.isStarred()),this.updateInputText(vmli),this.updateInputBounds(vmli)),openingInput&&this.getInputBox().focus(),this.canSetInput())try{var targetStart=Sel.getStartOffset(),targetEnd=Sel.getEndOffset();this.setRawSelection(targetStart,targetEnd),this.setSelection(targetStart,targetEnd)}catch(err){g.reportError(err)}},updateInputText:function updateInputTextFn(vmli){if(vmli&&this._currentVMLI&&vmli===this._currentVMLI){var displayText=this._currentVMLI.getParsedText();this._forceFirstCaps=0===displayText.length,this.setBoxValue(displayText)}else try{g.PAssert(2748,!1,"Updating input text with an invalid VMLI")}catch(PERR){g.reportError(PERR)}},insertText:function insertTextFn(offset,text){var val=this.getBoxValue(),newText=val.substr(0,offset)+text+val.substr(offset);this.setBoxValue(newText),this.canSetInput()&&(this.setSelection(offset+text.length,offset+text.length),g.autocomplete&&g.autocomplete.update({owner:this._currentVMLI,index:this._activePane.indexOfItem(this._currentVMLI),start:this.getSelectionStart(),fromArrows:!1}))},getInputText:function getInputTextFn(){try{g.PAssert(2749,this.isEnabled(),"Must be enabled to get input")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2750,this._currentVMLI,"Android input must be active to get input text")}catch(PERR){g.reportError(PERR)}return this._currentVMLI?this.getBoxValue():""},updateInputBounds:function updateInputBoundsFn(vmli){try{g.PAssert(2751,this._activePane,"Must have previously set an active pane for android editing")}catch(PERR){g.reportError(PERR)}if(vmli&&this._currentVMLI&&vmli===this._currentVMLI){var itemIndex=this._activePane.indexOfItem(this._currentVMLI);try{g.PAssert(2753,itemIndex>=0,"Must have a valid item index")}catch(PERR){g.reportError(PERR)}var container=this.getInputContainer(),lineHeight=18,leftOffset=8,paddingTop=7,paddingBottom=7,paddingLeft=this._currentVMLI.getPadding(this._activePane)-leftOffset,paddingRight=g.SPThresholdRight+leftOffset,itemHeight=this._activePane.heightAtIndex(itemIndex);container.style.top=this._activePane.topOfIndex(itemIndex)+g.topBoxHeight+"px",container.style.height=itemHeight-paddingTop-paddingBottom+"px",container.style.lineHeight=lineHeight+"px",container.style.marginLeft=leftOffset+"px",container.style.paddingLeft=paddingLeft+"px",container.style.paddingTop=paddingTop+"px",container.style.paddingBottom=paddingBottom+"px",container.style.paddingRight=paddingRight+"px",container.style.width=this._activePane.getWidth()-paddingLeft-g.SPThresholdRight-leftOffset+"px"}else try{g.PAssert(2752,!1,"Invalid VMLI being used to update android input bounds")}catch(PERR){g.reportError(PERR)}},checkAndroidBounds:function checkAndroidBoundsFn(){try{g.PAssert(2754,this.getCurrentVMLI(),"When updating Android bounds we should always have a current VMLI")}catch(PERR){g.reportError(PERR)}var boxHeight=this.getInputContainer().scrollHeight;if(boxHeight!==this._lastHeight){var resultText=this.getBoxValue();this._enabled=!1,this.getCurrentVMLI()&&(this.getCurrentVMLI().getParsedText()!==resultText&&this.getCurrentVMLI().setText(resultText,!0,ChangeType.Local,!0),this.updateInputBounds(this.getCurrentVMLI())),this._enabled=!0,this._lastHeight=boxHeight}},flushInput:function flushInputFn(){var resultText=this.getBoxValue();this._currentVMLI&&this._currentVMLI.getParsedText()!==resultText&&(this._forceFirstCaps&&(1===resultText.length?resultText=resultText.toUpperCase():resultText.length>1&&(resultText=resultText[0].toUpperCase()+resultText.substring(1))),this._currentVMLI.setText(resultText,!0,ChangeType.Local,!0))},finishInput:function finishInputFn(continueEditing){try{g.PAssert(2755,this.isEnabled(),"Must be enabled to finish input")}catch(PERR){g.reportError(PERR)}this._currentVMLI&&(this._isInputVisible&&!continueEditing&&(this._isInputVisible=!1,this.getInputContainer().style.visibility="hidden",g.blurActiveElement()),this.flushInput(),continueEditing||this.clearCurrentVMLI())},handlePaste:function handlePasteFn(){this._pasteHappened=!0},_fixLinePadding:function _fixLinePaddingFn(rawText){this.setBoxValue(rawText)},ensureLinePadding:function ensureLinePaddingFn(){var rawText=this.getInputBox().value;if(rawText.length<this._linePadding)return this._fixLinePadding(rawText),!1;for(var i=0;i<this._linePadding;++i)if(rawText[i]!==this._padCharacter)return this._fixLinePadding(rawText),!1;return!0},getBoxHasTextSpace:function getBoxHasTextSpaceFn(){var rawText=this.getRawInputText();if(rawText.length<this._linePadding)return!1;for(var sCount=0,i=0;i<rawText.length&&sCount<this._linePadding;++i)rawText[i]===this._padCharacter&&sCount++;return sCount===this._linePadding},_removeTextSpace:function _removeTextSpaceFn(text){var re=new RegExp(this._padCharacter,"g");return text.replace(re,"")},getBoxValue:function getBoxValueFn(){var rawText=this.getRawInputText(),outText=this._removeTextSpace(rawText);return outText},setBoxValue:function setBoxValueFn(text){text||(text="");for(var newText="",i=0;i<this._linePadding;++i)newText+=this._padCharacter;newText+=this._removeTextSpace(text),this.setRawInputText(newText)},passKeypress:function passKeypressFn(e){return this._currentVMLI&&(e.normCode===KeyCode.Enter||e.synthetic)?!0:!1},passKeydown:function passKeydownFn(e){return this._currentVMLI&&(e.normCode===KeyCode.Tab||e.synthetic)?!0:!1}};return util.extend(android.prototype,AndroidFns),new android}),define("VMLI_TapHandlers",["ko","globals","platform","android","DragDrop","NativeSel","Sel","Dispatcher"],function(ko,g,platform,android,DragDrop,NativeSel,Sel,Dispatcher){var VMLI_TapHandlers={dragStart:function dragStartFn(e){var pane=g.focusedPane;try{g.PAssert(2756,!platform.mobile||pane.isWriteable,"Should not be able to drag/drop on timeline on mobile")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2757,DragDrop.startDragItem,"Should always have a valid item to start dragging from")}catch(PERR){g.reportError(PERR)}android.isEnabled()&&android.finishInput();var target=g.getElementParent(e.startSrc);try{g.PAssert(2758,target,"Must have a valid target node")}catch(PERR){g.reportError(PERR)}if(target){DragDrop.startDragItem=void 0,DragDrop.dragItem=this;var allMovingNodes=[this].concat(g.searchVMLIsAsArray({item:this})),srcRect=g.offset(target),x=srcRect.left+5,y=srcRect.top-1;pane.dragMarginTop&&(y+=pane.dragMarginTop),g.vmMain.paneManager.runForEachPane(function(pane){pane.addScrollListener(this.dragScroll)}.bind(this));var startInfo={x:e.eventX,y:e.eventY},dataTransfer={dropEffect:pane.dropEffect,item:this,fromPane:pane};DragDrop.start(allMovingNodes,x,y,pane,startInfo,dataTransfer),g.disableMouseMove=!0}},dragMove:function dragMoveFn(e){try{g.PAssert(2759,DragDrop.startInfo,"Must have started a drag to be valid")}catch(PERR){g.reportError(PERR)}if(DragDrop.startInfo){e.preventDefault();var x=platform.mobile?0:e.eventX-DragDrop.startInfo.x,y=e.eventY-DragDrop.startInfo.y;g.focusedPane.dragMarginTop&&(e.eventY+=g.focusedPane.dragMarginTop);var eventY=Math.max(e.eventY,g.focusedPane.contentTop()),dragOver=g.elementFromPoint(e.eventX,eventY,e.target);DragDrop.setTransform(x,y),dragOver&&DragDrop.handleDragOver({srcElement:dragOver,target:dragOver,dataTransfer:DragDrop.dataTransfer,diffY:e.diffY,clientX:e.eventX,clientY:eventY,preventDefault:g.emptyFn,stopPropagation:g.emptyFn,stopImmediatePropagation:g.emptyFn})}},dragScroll:function dragScrollFn(){var e={eventX:Sel.mousePos.x,eventY:Sel.mousePos.y,preventDefault:g.emptyFn,diffY:0};this.dragMove(e)},dragEnd:function dragEndFn(e){platform.ios&&g.preventClick(),g.disableMouseMove=!1,DragDrop.stop(),DragDrop.handleDrop({srcElement:e.srcElement,target:e.target,dataTransfer:DragDrop.dataTransfer,preventDefault:g.emptyFn,stopPropagation:g.emptyFn,stopImmediatePropagation:g.emptyFn}),g.vmMain.paneManager.runForEachPane(function(pane){pane.removeScrollListener(this.dragScroll)}.bind(this)),platform.ios&&g.preventClick(),g.disableMouseMove=!1},onTouchHoldTimeout:function onTouchHoldTimeoutFn(e){g.isKeyboardOpen?this.isLoupeOpen=!0:(DragDrop.startDragItem=this,this.dragStart(e),this.dragMove(e))},onStart:function onStartFn(e){var pane=g.focusedPane;g.scrollAtTouchStart=pane.getScrollOffset(),platform.ios&&this.isEditable.set(!0),g.hasClass(e.target,"paneScroller")?e.preventDefault():platform.mobile&&this.isDraggable()&&!platform.ie&&"UL"!==e.srcElement.tagName&&pane.isWriteable?Dispatcher.listen("touchHoldTimeout",this.onTouchHoldTimeout):!platform.mobile&&this.isDraggable()&&(platform.mobile&&e.clientX<this.getPadding(pane)||!platform.mobile&&g.hasClass(e.srcElement,"collapser")||g.findParent(e.srcElement,"plugin"))?(DragDrop.startDragItem=this,g.vmMain.updateCursorFromEvent(e),e.preventDefault(),e.stopImmediatePropagation()):platform.mobile&&e.clientX>pane.getWidth()-g.SPThresholdRight||!platform.mobile&&g.hasClass(e.target,"itemCheckbox")?(e.preventDefault(),e.stopImmediatePropagation()):g.vmMain.pluginManager.handleTapStart(this,e)?platform.mobile&&(e.preventDefault(),e.stopImmediatePropagation()):platform.mobile&&("A"===e.srcElement.tagName||g.hasClass(e.srcElement,"tag")||g.hasClass(e.srcElement,"contact"))&&(e.preventDefault(),e.stopImmediatePropagation())},onMove:function onMoveFn(e,onPane){DragDrop.startDragItem&&(!platform.touch||Math.abs(e.distanceY)>g.ClickThreshold&&Math.abs(e.distanceX)<g.ClickThreshold)&&DragDrop.startDragItem===this&&this.dragStart(e),DragDrop.isDragging?this.dragMove(e):platform.touch&&g.canRevealMenu&&g.focusedPane.type!==PaneMode.Timeline&&(g.revealingMenu||Math.abs(e.distanceY)<g.ClickThreshold&&Math.abs(e.diffX)>g.ClickThreshold)&&((!onPane||g.phoneMenu.multiSelectMode())&&(g.revealingMenu||g.menus.revealGestureMenu(this,e),g.menus.updateRevealGestureMenu(e)),e.preventDefault())},onClick:function onClickFn(e){var pane=g.focusedPane;if(platform.mobile&&DragDrop.isDragging)e.preventDefault(),platform.ios&&this.isEditable.set(!1);else if(platform.mobile&&g.phoneMenu.multiSelectMode())g.vmMain.toggleSelection(this);else if(pane.supportCollapsing&&(platform.mobile&&e.clientX<this.getPadding(pane)||!platform.mobile&&g.hasClass(e.target,"collapser"))){if(platform.mac&&e.metaKey||!platform.mac&&e.ctrlKey)g.vmMain.zoomin(this);else if(this.isCollapsible()){var savedSel=Sel.save();this.toggleCollapsed(pane),savedSel&&(platform.mobile?(!savedSel.startItem||savedSel.startItem.isDescendantOf(this))&&g.closeKeyboard():pane.restoreSelectionAfterCollapse(savedSel,this))}e.preventDefault(),e.stopImmediatePropagation(),platform.mobile&&platform.ios&&g.preventClick()}else if(platform.mobile&&e.clientX>pane.getWidth()-g.SPThresholdRight||!platform.mobile&&g.hasClass(e.target,"itemCheckbox"))this.isComplete(!this.isComplete()),e.preventDefault(),e.stopImmediatePropagation(),platform.mobile&&platform.ios&&g.preventClick();else if("SPAN"===e.srcElement.tagName&&g.hasClass(e.srcElement,"itemDataPageLoad"))this.notifyPaginationUpdate();else if(!g.hasClass(e.srcElement,"tag")||platform.mobile&&g.isKeyboardOpen)if(!g.hasClass(e.srcElement,"contact")||platform.mobile&&g.isKeyboardOpen)if(!platform.mobile&&g.hasClass(e.srcElement,"date")){if(platform.mac&&e.metaKey||!platform.mac&&e.ctrlKey){Sel.reset();var text=e.srcElement.textContent;e.shiftKey?pane.search.setValue(text):pane.search.addToValue(text)}}else if(g.vmMain.pluginManager.handleTapEvent(this,e))platform.mobile?(e.preventDefault(),e.stopImmediatePropagation()):DragDrop.isDragging&&this.dragEnd(e);else if("A"!==e.srcElement.tagName||platform.mobile&&g.isKeyboardOpen){if(g.autocomplete&&g.autocomplete.hide(),platform.ios||platform.android||platform.mobileie){var activeElement=document.activeElement,scrollTopClick=pane.getScrollOffset(),justCancelledInertialScroll=Math.abs(scrollTopClick-g.scrollAtTouchStart)>0;if(!justCancelledInertialScroll&&pane.isWriteable){var item=this,selectOffset;if(platform.mobile&&this===pane.getItem())item=pane.getLastItem(),selectOffset=item.getParsedText().length;else if(g.getElementParent(e.target)){var offsets=NativeSel.getSelectOffsetsForEvent(e);selectOffset=offsets.start}else selectOffset=item.getParsedText().length;try{g.PAssert(2760,item,"Click on undefined item should not happen")}catch(PERR){g.reportError(PERR)}g.isKeyboardOpen&&activeElement&&"search"!==activeElement.id?(Sel.selectItem(item,selectOffset),e.preventDefault(),e.stopImmediatePropagation()):g.openKeyboardOnItem(e,pane,item,function(){pane.onFocus(),Sel.selectItem(item,selectOffset)},function(){pane.onBlur()}),platform.mobile&&g.vmMain.setSelected([item])}else platform.mobileie&&android.isEnabled()&&pane.isWriteable&&(android.updateInput(this),e.preventDefault(),e.stopPropagation())}else if(!platform.mobile&&pane.type===PaneMode.Timeline){var item=this,cb=function(pane){var index=pane.indexOfItem(this);index>=0&&(Sel.setFocusedPane(pane),Sel.selectIndex(index,-1))}.bind(this),focusedPane=pane;g.vmMain.paneManager.runForEachPane(function(pane){if(pane!==focusedPane&&pane.search.isMatched(item)){var newCb=cb?g.curry(cb,pane):cb;pane.scrollToMiddle(item,ScrollDuration.Default,newCb)}},PaneMode.Normal),this.highlight(),g.sendEvent("Menu","GoTo")}}else(platform.mac&&e.metaKey||!platform.mac&&e.ctrlKey||platform.app)&&g.openUrl(e.srcElement.href,e),e.preventDefault(),e.stopImmediatePropagation();else{if(platform.mac&&e.metaKey||!platform.mac&&e.ctrlKey){Sel.reset();var text=e.srcElement.textContent;e.shiftKey?pane.search.setValue(text):pane.search.addToValue(text)}else if(!platform.mobile||!g.isKeyboardOpen){var start;if(platform.mobile){var offsets=NativeSel.getSelectOffsetsForEvent(e);start=offsets.start}else start=Sel.getStartOffset();g.autocomplete.update({owner:this,index:Sel.getStartIndex(),start:start}),g.autocomplete.show(e.srcElement)}platform.mobile&&(e.preventDefault(),e.stopImmediatePropagation())}else{Sel.reset();var text=e.srcElement.textContent;e.shiftKey?pane.search.setValue(text):pane.search.addToValue(text),platform.mobile&&(e.preventDefault(),e.stopImmediatePropagation())}},onDblClick:function onDblClickFn(e){if(platform.mobile&&g.focusedPane.type===PaneMode.Timeline&&g.hasClass(e.srcElement,"line")){g.focusedPane.onTapToggleModeMobile(),e.preventDefault();var item=this;g.vmMain.paneManager.runForEachPane(function(pane){pane.search.isMatched(item)&&pane.scrollItemIntoView(item,ScrollDuration.Default)}),this.highlight(),g.sendEvent("PhoneMenu","GoTo")}},onEnd:function onEndFn(e){Dispatcher.isListening("touchHoldTimeout",this.onTouchHoldTimeout)&&Dispatcher.unlisten("touchHoldTimeout",this.onTouchHoldTimeout),DragDrop.startDragItem=void 0,g.itemMenuOpenedOn===this&&g.menus.menuItemSelected(e.srcElement),(g.revealingMenu||g.phoneMenu&&g.phoneMenu.multiSelectMode())&&(e.preventDefault(),e.stopImmediatePropagation(),e.returnFalse=!0),platform.ios&&e.moved&&!this.isLoupeOpen&&(e.preventDefault(),g.preventClick()),this.isLoupeOpen=!1,g.revealingMenu&&g.menus.stopRevealGestureMenu(e),DragDrop.isDragging&&(this.dragEnd(e),e.preventDefault()),g.vmMain.updateCursorFromEvent(e)},onRightClick:function onRightClickFn(e){g.menus.openItemMenu(this,e),e.preventDefault(),e.stopPropagation()},onAutocompleteTapped:function onAutocompleteTappedFn(text,textLength,trackingTag){try{g.PAssert(2761,trackingTag,"Must be tracking the current AC tag")}catch(PERR){g.reportError(PERR)}var newText;if(android.isEnabled()){var aText=android.getInputText();newText=aText.substr(0,trackingTag.index-trackingTag.replaceLength)+text+aText.substr(trackingTag.index+trackingTag.length),this.setText(newText,!0,ChangeType.Local),android.updateInputText(this);var selOffset=trackingTag.index+textLength;android.setSelection(selOffset,selOffset)}else{var oText=this.getParsedText(),startOffset=Sel.getStartOffset()-trackingTag.length;newText=oText.substr(0,startOffset)+text+oText.substr(Sel.getStartOffset()+1),Sel.getPane().focus(),this.setText(newText,!0,ChangeType.Local),Sel.selectIndex(Sel.getStartIndex(),startOffset+textLength)}}};return VMLI_TapHandlers}),define("RepeatDate",["globals"],function(g){function RepeatDate(p){if(this._valid=!0,this._initData=p,g.isString(p))this.fromString(p);else if(p instanceof RepeatDate)this._startDate=new Date(p._startDate),this._endDate=p._endDate?new Date(p._endDate):void 0,this._frequency=p._frequency,this._separation=p._separation,this._offsets=p._offsets?p._offsets.slice():void 0;else if(g.isObject(p)){try{g.PAssert(2762,p.type===DateType.Repeat,"Must have a valid date type set")}catch(PERR){g.reportError(PERR)}this._startDate=new Date(p.startDate),this._endDate=p.endDate?new Date(p.endDate):void 0,this._frequency=p.frequency,this._separation=p.separation||1,this._offsets=p.offsets}else{try{g.PAssert(2763,!1,"Invalid object passed to RepeatDate constructor",p)}catch(PERR){g.reportError(PERR)}this._valid=!1}if(this._startDate){try{g.PAssert(2764,this._startDate instanceof Date,"Must be a valid date instance")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2765,this._startDate.isAfter(minStartDate),"Start date must be after the minimum start date")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2766,!this._endDate||this._endDate instanceof Date,"Must be a valid date instance")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2767,!this._offsets||this._offsets.length>=1,"Must always store at least one offset if _offsets is defined",this._offsets)}catch(PERR){g.reportError(PERR)}if(this._endDate&&!this._startDate.isBefore(this._endDate)&&!this._startDate.equals(this._endDate)){this._valid=!1;try{g.PAssert(2769,!1,"Start date must always be before the end date")}catch(PERR){g.reportError(PERR)}}}else this._valid=!1;this._doneGenerating=!this._valid,this._cache=[],this._cacheDate=new Date(this._startDate)}var REPEAT_VER=1,SEP="|",maxGenDates=500,minStartDate=new Date(1401606e6);return RepeatDate.prototype={isValid:function isValidFn(){return this._valid},_isValidDate:function _isValidDateFn(obj){return obj&&obj instanceof Date},setStartDate:function setStartDateFn(date){try{g.PAssert(2770,date,"Must provide a valid date")}catch(PERR){g.reportError(PERR)}if(this._startDate=new Date(date),this._endDate&&!this._startDate.isBefore(this._endDate)&&!this._startDate.equals(this._endDate)){this._valid=!1;try{g.PAssert(2771,!1,"Start date must always be before the end date")}catch(PERR){g.reportError(PERR)}}this._resetCache()},getStartDate:function getStartDateFn(){return this._startDate},getEndDate:function getEndDateFn(){return this._endDate},_isBeforeEnd:function _isBeforeEndFn(date){try{g.PAssert(2772,this._isValidDate(date),"Must provide a valid date: ",date)}catch(PERR){g.reportError(PERR)}var cacheHasSpace=this._cache.length<maxGenDates,beforeEnd=this._endDate?date.isBefore(this._endDate)||date.equals(this._endDate):!0;return cacheHasSpace&&beforeEnd},_resetCache:function _resetCacheFn(){this._cache=[],this._cacheDate=new Date(this._startDate),this._doneGenerating=!this._valid},_getNext:function _getNextFn(num){return this._cache.length<num&&this._generate(num),this._cache.slice(0,num)},_generateUntil:function _generateUntilFn(until){try{g.PAssert(2773,this._isValidDate(until),"Must provide a valid date to generate until: ",until)}catch(PERR){g.reportError(PERR)}for(var generated=!1;!this._doneGenerating&&this._getLastCachedDate()&&this._getLastCachedDate().isBefore(until);)this._generateNext(1),generated=!0;return generated},_generateNext:function _generateNextFn(num){try{g.PAssert(2774,num>0,"Must request a valid number of additional dates")}catch(PERR){g.reportError(PERR)}this._generate(this._cache.length+num)},_generate:function _generateFn(totalNum){try{g.PAssert(2775,totalNum>0,"Must request a valid number of dates")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2776,maxGenDates>totalNum,"Must request less than maxGenDates dates")}catch(PERR){g.reportError(PERR)}var currentDate=new Date(this._cacheDate);totalNum=Math.min(totalNum,maxGenDates);for(var iterations=0;totalNum>iterations&&this._cache.length<totalNum&&this._isBeforeEnd(currentDate);){if(this._offsets)for(var i=0;i<this._offsets.length&&this._cache.length<totalNum;++i){var cOffset=this._offsets[i],instanceDate=new Date(currentDate);if(instanceDate.getDay()<=cOffset){switch(this._frequency){case RepeatFreq.Weekly:instanceDate.addDays(cOffset-instanceDate.getDay());break;default:try{g.PAssert(2777,!1,"Invalid repeat frequency for offset dates",this._frequency)}catch(PERR){g.reportError(PERR)}}var lastCache=this._cache[this._cache.length-1];if(!this._isBeforeEnd(instanceDate)||lastCache&&!instanceDate.isAfter(lastCache))return void(this._isBeforeEnd(instanceDate)||(this._doneGenerating=!0));this._cache.push(instanceDate)}}else{var instanceDate=new Date(currentDate),lastCache=this._cache[this._cache.length-1];if(!this._isBeforeEnd(instanceDate)||lastCache&&!instanceDate.isAfter(lastCache))return void(this._isBeforeEnd(instanceDate)||(this._doneGenerating=!0));this._cache.push(instanceDate)}switch(this._frequency){case RepeatFreq.Hourly:currentDate.addHours(this._separation);break;case RepeatFreq.Daily:currentDate.addDays(this._separation);break;case RepeatFreq.Weekly:this._offsets&&this._offsets.length>1&&currentDate.getDay()!==this._offsets[0]&&currentDate.moveToDayOfWeek(this._offsets[0],-1),currentDate.addWeeks(this._separation);break;case RepeatFreq.Monthly:currentDate.addMonths(this._separation);break;case RepeatFreq.NthMonthInst:var targetDay=this._startDate.getDay(),occur=Math.ceil(this._startDate.getDate()/7);currentDate.addMonths(this._separation),(4===occur||5===occur)&&(occur=-1),currentDate.moveToNthOccurrence(targetDay,occur);break;case RepeatFreq.Yearly:currentDate.addYears(this._separation);break;case RepeatFreq.EndOfMonthOffset:currentDate.addMonths(this._separation);var offsetDay=this._startDate.getDate(),maxOffsetDay=this._startDate.getDaysInMonth(),diff=maxOffsetDay-offsetDay;currentDate.setDate(currentDate.getDaysInMonth()-diff);break;case RepeatFreq.DayOfMonth:for(var i=0;i<this._separation;++i)this.getNextValidMonth(currentDate,this._startDate.getDate());break;case RepeatFreq.Once:default:try{g.PAssert(2778,!1,"Invalid repeat frequency")}catch(PERR){g.reportError(PERR)}return void(this._doneGenerating=!0)}this._cacheDate=currentDate,iterations++}this._isBeforeEnd(currentDate)||(this._doneGenerating=!0)},getNextValidMonth:function getNextValidMonthFn(date,offsetDay){try{g.PAssert(2779,this._isValidDate(date),"Must provide a valid date: ",date)}catch(PERR){g.reportError(PERR)}if(date.addMonths(1),date.getDate()!==offsetDay){var maxDays=date.getDaysInMonth();offsetDay>maxDays&&(date.addMonths(1),date.setDate(offsetDay))
}},getDates:function getDatesFn(futureOnly){try{g.PAssert(2780,this._valid,"Must not call getDates with invalid RepeatDate: ",this._initData)}catch(PERR){g.reportError(PERR)}var maxPastDates=3,maxFutureDates=4,today=new Date;this._generate(maxFutureDates),this._generateUntil(today);var todayIndex=this._cache.findInsertIndex(today,Date.compare),futureDates=this._cache.length-todayIndex;maxFutureDates>futureDates&&this._generateNext(maxFutureDates-futureDates);var minIndex=futureOnly?Math.max(todayIndex,0):Math.max(todayIndex-maxPastDates,0),maxIndex=Math.min(todayIndex+maxFutureDates,this._cache.length);return this._cache.slice(minIndex,maxIndex)},next:function nextFn(num){return num>0?this._getNext(num):void 0},nextIndex:function nextIndexFn(fromDate){try{g.PAssert(2782,this._valid,"Must not call nextIndex with invalid RepeatDate: ",this._initData)}catch(PERR){g.reportError(PERR)}try{g.PAssert(2783,!fromDate||this._isValidDate(fromDate),"Must provide a valid from date",fromDate)}catch(PERR){g.reportError(PERR)}var from=fromDate?new Date(fromDate):this._startDate,generated=this._generateUntil(from);if(generated)return this._cache.length-1;for(var i=0;i<this._cache.length;++i)if(this._cache[i].isAfter(from)||this._cache[i].equals(from))return i;return this._generateNext(1),this._cache.length-1},nextComplete:function nextCompleteFn(fromDate){try{g.PAssert(2784,this._valid,"Must not call nextComplete with invalid RepeatDate: ",this._initData)}catch(PERR){g.reportError(PERR)}try{g.PAssert(2785,!fromDate||this._isValidDate(fromDate),"Must provide a valid from date",fromDate)}catch(PERR){g.reportError(PERR)}var futIndex=this.nextIndex(fromDate);return this._cache[futIndex]},nextActive:function nextActiveFn(fromDate){try{g.PAssert(2788,this._valid,"Must not call nextActive with invalid RepeatDate: ",this._initData)}catch(PERR){g.reportError(PERR)}try{g.PAssert(2789,!fromDate||this._isValidDate(fromDate),"Must provide a valid from date",fromDate)}catch(PERR){g.reportError(PERR)}var futIndex=this.nextIndex(fromDate);return this._cache.length<=futIndex+1&&this._generateNext(1),this._cache[futIndex+1]},_getLastCachedDate:function _getLastCachedDateFn(){return this._cache[this._cache.length-1]},hasTimeOfDay:function hasTimeOfDayFn(){return this._valid?this._startDate.hasTimeOfDay():!1},isRepeatDate:function isRepeatDateFn(){return!0},getTimeOfDay:function getTimeOfDayFn(){return this._valid?this._startDate.getTimeOfDay():0},getTime:function getTimeFn(format){return this._valid?this._startDate.toString(format):""},equals:function equalsFn(dateInfo){if(this._valid){if(g.isString(dateInfo))return this.toString()===dateInfo;if(dateInfo instanceof RepeatDate){if(dateInfo._valid){var startEqual=!isNaN(this._startDate)&&!isNaN(dateInfo._startDate)&&this._startDate.equals(dateInfo._startDate),endEqual=this._endDate?this._endDate.equals(dateInfo._endDate):this._endDate===dateInfo._endDate,freqEqual=this._frequency===dateInfo._frequency,sepEqual=this._separation===dateInfo._separation,offsetsEqual=this._offsets?this._offsets.equals(dateInfo._offsets):this._offsets===dateInfo._offsets;return startEqual&&endEqual&&freqEqual&&sepEqual&&offsetsEqual}}else if(g.isObject(dateInfo)){try{g.PAssert(2792,dateInfo.type===DateType.Repeat,"Must have a valid date type set")}catch(PERR){g.reportError(PERR)}var compDate=new Date(dateInfo.startDate);try{g.PAssert(2793,this._isValidDate(compDate),"Must provide a valid comp date",compDate)}catch(PERR){g.reportError(PERR)}var startEqual=!isNaN(this._startDate)&&!isNaN(compDate)&&this._startDate.equals(compDate),endEqual=this._endDate==(dateInfo._endDate?new Date(dateInfo._endDate):void 0),freqEqual=this._frequency===dateInfo.frequency,sepEqual=this._separation===dateInfo._separation,offsetsEqual=this._offsets?this._offsets.equals(dateInfo._offsets):this._offsets===dateInfo._offsets;return startEqual&&endEqual&&freqEqual&&sepEqual&&offsetsEqual}}return!1},fromString:function fromStringFn(str){try{var tokens=str.split(SEP),ver=tokens[0];if("1"===ver){this._startDate=new Date(parseInt(tokens[1])),this._endDate=tokens[2]?new Date(parseInt(tokens[2])):void 0,this._frequency=parseInt(tokens[3]),this._separation=parseInt(tokens[4]);try{g.PAssert(2794,g.isNumber(this._frequency),"Invalid frequency",tokens[3])}catch(PERR){g.reportError(PERR)}try{g.PAssert(2795,g.isNumber(this._separation),"Invalid frequency",tokens[4])}catch(PERR){g.reportError(PERR)}if(this._offsets=void 0,tokens[5]){var offsets=tokens[5].split(",");if(offsets.length>0){this._offsets=[];for(var i=0;i<offsets.length;++i){var offset=parseInt(offsets[i]);try{g.PAssert(2796,g.isNumber(offset),"Date offsets must be valid numbers",offsets[i])}catch(PERR){g.reportError(PERR)}this._offsets.push(offset)}}}if(!this._isValidDate(this._startDate)||this._endDate&&!this._isValidDate(this._endDate)){try{g.PAssert(2797,!1,"Invalid start or end date parsing from string",this._startDate,this._endDate)}catch(PERR){g.reportError(PERR)}this._valid=!1}}else this._valid=!1}catch(err){this._valid=!1,g.reportError(err)}this._resetCache()},toString:function toStringFn(){if(this._valid){var start=this._startDate.getTime(),end=this._endDate?this._endDate.getTime():"",offsets=this._offsets&&this._offsets.length>1?this._offsets.join(","):"";return REPEAT_VER+SEP+start+SEP+end+SEP+this._frequency+SEP+this._separation+SEP+offsets}return void 0}},RepeatDate}),define("VMLI_Text",["data","gdata","globals","tracker","android","RepeatDate","Measure","DuchessHelpers"],function(d,gdata,g,tracker,android,RepeatDate,Measure,DuchessHelpers){var VMLI_Text={_runAndGetSaveData:function _runAndGetSaveDataFn(text,immediateParse,changeType){if(this.shouldSave())var oldMetaData=this.getMetaTextSaveData();if(this.setRawText(this.generateSaveText(text)),this.parseText(immediateParse,changeType),this.shouldSave()){var newMetaData=this.getMetaTextSaveData(),saveData={};for(var key in newMetaData)oldMetaData[key]!==newMetaData[key]&&(saveData[key]=newMetaData[key])}return saveData},setText:function setTextFn(text,immediateParse,changeType,fromAndroidEditing){changeType|=ChangeType.Text;var saveData=this._runAndGetSaveData(text,immediateParse,changeType);this.shouldSave()&&(saveData.text=this.generateSaveText(text),gdata.saveChanges(this,saveData),saveData.dateText=this.dateText,this.save(saveData,SaveFlag.Text),immediateParse&&!fromAndroidEditing&&android.isEnabled()&&android.updateInputText(this))},metricsInPane:function metricsInPaneFn(pane,outline){var spanWidth=pane.maxWidthOfItem(this,outline),textMetrics;try{textMetrics=Measure.measureItem(this,pane,spanWidth)}catch(err){g.reportError(err)}return textMetrics},heightInPane:function heightInPaneFn(pane,outline){return this.metricsInPane(pane,outline).height},generateSaveText:function generateSaveTextFn(text){return this._generateUsableText(text,"getEmbedString")},generateTitleText:function generateTitleTextFn(text){return this._generateUsableText(text,"getTitleString")},_generateUsableText:function _generateUsableTextFn(text,fnName){try{g.PAssert(2798,this.hasAttachments()||text.indexOf(window.AttachChar)<0,"Should either have attachments or no embedded attachment chars")}catch(PERR){g.reportError(PERR)}var outText=text;if(this.hasAttachments()&&text.indexOf(window.AttachChar)>=0){var attachIndex=0,maxAttachIndex=this.getNumAttachments();outText=text.replace(/\u2000/g,function(){if(maxAttachIndex>attachIndex){var attach=this.getAttachment(attachIndex);return attachIndex++,attach[fnName]()}return window.AttachChar}.bind(this));try{g.PAssert(2799,outText.indexOf(window.AttachChar)<0,"Should convert all attachments to their string form")}catch(PERR){g.reportError(PERR)}}return outText},splitUsableText:function splitUsableTextFn(text,startSplitIndex,endSplitIndex){try{g.PAssert(2800,this.hasAttachments()||text.indexOf(window.AttachChar)<0,"Should either have attachments or no embedded attachment chars")}catch(PERR){g.reportError(PERR)}var usableText=text.substring(0,startSplitIndex)+text.substring(endSplitIndex),splitIndex=startSplitIndex;if(this.hasAttachments()&&text.indexOf(window.AttachChar)>=0){var attachIndex=0,maxAttachIndex=this.getNumAttachments();usableText=text.replace(/\u2000/g,function(match,offset){if(maxAttachIndex>attachIndex){var attach=this.getAttachment(attachIndex);attachIndex++;var replaceStr=attach.getEmbedString();return startSplitIndex>offset&&(splitIndex+=Math.max(replaceStr.length-1,0)),replaceStr}return window.AttachChar}.bind(this));try{g.PAssert(2801,usableText.indexOf(window.AttachChar)<0,"Should convert all attachments to their string form")}catch(PERR){g.reportError(PERR)}}var outData={before:usableText.substring(0,splitIndex),after:usableText.substring(splitIndex)};return outData},parseText:function parseTextFn(immediateParse,changeType,changedStyles){try{g.PAssert(2802,immediateParse,"Currently we only support immediate parsing")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2803,g.isValidChangeType(changeType),"Must specify a valid changetype")}catch(PERR){g.reportError(PERR)}var styleInfo;if(immediateParse)styleInfo=DuchessHelpers.parseText(this.getRawText(),this.getDateTime(),this.getRepeatDate(),this.dateText,this.getDateCompletedTime(),changeType,d.contactManager.getContacts()),g.isFlagSet(changeType,ChangeType.Local)&&styleInfo.numContacts>0&&tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.AddContact,data:[{itemID:this.id}]});else try{g.PAssert(2804,!1,"Should always be using immediate parse")}catch(PERR){g.reportError(PERR)}var styled=this.styleText(styleInfo,immediateParse,changeType,changedStyles);return this.itemChanged.notify(),styled},styleText:function styleTextFn(styleInfo,parsedFull,changeType,changedStyles){try{g.PAssert(2805,parsedFull,"Currently we only support full parses")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2806,g.isValidChangeType(changeType),"Must specify a valid changetype")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2807,!(!styleInfo&&parsedFull),"In a full parse, styleInfo should always be defined")}catch(PERR){g.reportError(PERR)}var styleChanges=!1,text;if(styleInfo){parsedFull&&this.setParsedText(styleInfo.parsedText);try{g.PAssert(2808,styleInfo.els,"Must always return an els list")}catch(PERR){g.reportError(PERR)}if(styleInfo.els&&(this.els=styleInfo.els),styleInfo.dates){0===styleInfo.dates.length&&(this.date()||this.repeatDate())&&(this.dateText=void 0,this.repeatDate()&&!this.isForceCompleted()&&(this.dateCompleted=void 0,changedStyles&&(styleChanges=!0,changedStyles.dateCompleted=void 0)),this.date(null),this.repeatDate(null),changedStyles&&(styleChanges=!0,changedStyles.date=void 0,changedStyles.dateText=void 0,changedStyles.repeatDate=void 0));for(var i=0;i<styleInfo.dates.length;++i){var dt=styleInfo.dates[i];if(dt.type===DateType.Once)this.dateText!==dt.origText&&(this.dateText=dt.origText,changedStyles&&(styleChanges=!0,changedStyles.dateText=dt.origText)),dt.date&&this.date()&&dt.date==this.date()||(!!dt.date^!!this.date()||this.date()&&dt.date.getTime()!==this.date().getTime())&&(this.date(dt.date),changedStyles&&(styleChanges=!0,changedStyles.date=dt.date)),this.repeatDate()&&(this.repeatDate(null),changedStyles&&(styleChanges=!0,changedStyles.repeatDate=void 0));else if(dt.type===DateType.Repeat){this.dateText!==dt.text&&(this.dateText=dt.text,changedStyles&&(styleChanges=!0,changedStyles.dateText=dt.text));var rDate=new RepeatDate(dt);rDate.isValid()?(!this.repeatDate()||!rDate.equals(this.repeatDate())||!!rDate^!!this.repeatDate())&&((!rDate||this.repeatDate()&&!this.repeatDate().getStartDate().equals(rDate.getStartDate()))&&(this.isForceCompleted()||(this.dateCompleted=void 0,changedStyles&&(styleChanges=!0,changedStyles.dateCompleted=void 0))),this.repeatDate(rDate),changedStyles&&(styleChanges=!0,changedStyles.repeatDate=rDate.toString())):g.reportError(new Error("Local invalid repeat date: "+dt)),this.date()&&(this.date(null),changedStyles&&(styleChanges=!0,changedStyles.date=void 0))}}}else(this.date()||this.repeatDate())&&parsedFull&&(this.dateText=void 0,this.repeatDate()&&!this.isForceCompleted()&&(this.dateCompleted=void 0,changedStyles&&(styleChanges=!0,changedStyles.dateCompleted=void 0)),this.date(null),this.repeatDate(null),changedStyles&&(styleChanges=!0,changedStyles.date=void 0,changedStyles.dateText=void 0,changedStyles.repeatDate=void 0));if((styleInfo.tags||this._activeTags)&&this.setTags(styleInfo.tags),styleInfo.attachments||this.getAttachments()){for(var newAttachments=[],i=0;styleInfo.attachments&&i<styleInfo.attachments.length;++i){var newAttach=g.vmMain.pluginManager.getAttachment(styleInfo.attachments[i]);newAttach&&newAttachments.push(newAttach)}this.setAttachments(newAttachments,changeType)}}return styleChanges}};return VMLI_Text}),define("VMLI_Drive",["globals","data","gdata","tracker","RepeatDate","Sel"],function(g,d,gdata,tracker,RepeatDate,Sel){var VMLI_Drive=function(VMLI){function iterateRemoteLink(parentItem,remoteItem){gdata.cacheItem(remoteItem),iterateLink(remoteItem,gdata.get(remoteItem,"items")),iterateLink(remoteItem,gdata.get(remoteItem,"archivedItems"))}function iterateLink(parentItem,itemArray){if(itemArray)for(var i=0;i<itemArray.length;++i){var item=itemArray.get(i);try{g.PAssert(2821,item,"Item must exist to get it from the array")}catch(PERR){g.reportError(PERR)}if(item&&item.id){gdata.setItemParent(item,parentItem);var localItem=d.getModel(item.id);localItem?localItem.linkToGDrive(item):iterateRemoteLink(parentItem,item)}else{if(item)try{g.reportError(new Error("Item in list without defined ID: "+g.getObjectInfo(item)+" : "+JSON.stringify(item)))}catch(err){g.reportError(err)}else g.reportError(new Error("Removing undefined/null value form remote list"));itemArray.remove(i),i--}}}function linkNote(parentItem,note){if(note){gdata.setItemParent(note,parentItem);var localItem=d.getModel(note.id);localItem?localItem.linkToGDrive(note):gdata.cacheItem(note)}}return{linkToGDrive:function linkToGDriveFn(data,overwriteFromRemote){try{g.PAssert(2822,data,"Must be passing in valid data")}catch(PERR){g.reportError(PERR)}if(!this.data){if(data){try{g.PAssert(2823,void 0===data.connectIdentifier,"Should never have a connect identifier present during link")}catch(PERR){g.reportError(PERR)}data.connectIdentifier=gdata.connectIdentifier(),this.data=data,gdata.cacheItem(data)}this.setRemoteVersion(VersionType.Structure,gdata.getVersion(data,VersionType.Structure)),this.setRemoteVersion(VersionType.Text,gdata.getVersion(data,VersionType.Text)),overwriteFromRemote&&(this.setVersion(VersionType.Structure,this.getRemoteVersion(VersionType.Structure)),this.setVersion(VersionType.Text,this.getRemoteVersion(VersionType.Text))),linkNote(data,gdata.get(data,"note")),iterateLink(data,gdata.get(data,"items")),iterateLink(data,gdata.get(data,"archivedItems"))}},resetModified:function resetModifiedFn(){var i;try{g.PAssert(2824,this.data,"Can only reset modified if remote data exists")}catch(PERR){g.reportError(PERR)}var remoteChanged=!1,versionChanges={};if(!this.modifiedOffline&&this.isRemoteVersionNewer(VersionType.Structure)){var remoteVersion=this.getRemoteVersion(VersionType.Structure);this.setVersion(VersionType.Structure,remoteVersion),versionChanges.version=remoteVersion,remoteChanged=!0}else this.modifiedOffline&&(versionChanges.modifiedOffline=!1,remoteChanged=!0);if(!this.modifiedOfflineText&&this.isRemoteVersionNewer(VersionType.Text)){var remoteVersionText=this.getRemoteVersion(VersionType.Text);this.setVersion(VersionType.Text,remoteVersionText),versionChanges.versionText=remoteVersionText,remoteChanged=!0}else this.modifiedOfflineText&&(versionChanges.modifiedOfflineText=!1,remoteChanged=!0);remoteChanged&&this.save(versionChanges,SaveFlag.None),this.setRemoteVersion(VersionType.Structure,void 0),this.setRemoteVersion(VersionType.Text,void 0);var items=this.getItems();for(i=0;i<items.length;++i)items[i].resetModified();if(this.hasArchivedChildren()){var archivedItems=this.archivedItems(!0);for(i=0;i<archivedItems.length;++i)archivedItems[i].resetModified()}},initFromGDrive:function initFromGDriveFn(data){try{g.PAssert(2827,data,"To initialize from gdrive a valid remote data object must be passed in")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2828,!tracker.undoRedoActive,"Should not be initializing new VMLIs from gdrive during undo/redo")}catch(PERR){g.reportError(PERR)}if(!data)return void g.reportError(new Error("FATAL ERROR - No remote data for item"));if(this.data=data,data.connectIdentifier)try{g.PAssert(2831,data.connectIdentifier===gdata.connectIdentifier(),"Should never have a connect identifier present during link")}catch(PERR){g.reportError(PERR)}else data.connectIdentifier=gdata.connectIdentifier();var needsFullSave=void 0===this.id||this.forceModifiedItems,remoteChanges=needsFullSave?void 0:{},needsParsing=!1;this.id=data.id,g.topLevelInitId||(g.topLevelInitId=this.id);try{needsParsing=this.resolveMisc(remoteChanges)||needsParsing,needsParsing=this.resolveText(remoteChanges)||needsParsing,needsParsing&&(g.vmMain.addParseItem(this,ChangeType.Remote|ChangeType.All),g.vmMain.addModifiedItem(this)),this.resolveItems(remoteChanges)}catch(err){g.reportError(err)}if(g.topLevelInitId===this.id&&(g.topLevelInitId=void 0),needsFullSave){try{g.PAssert(2832,void 0===remoteChanges,"If doing a full save, remoteChanges should always be undefined")}catch(PERR){g.reportError(PERR)}this.setVersion(VersionType.Structure,this.getRemoteVersion(VersionType.Structure)),this.setVersion(VersionType.Text,this.getRemoteVersion(VersionType.Text)),this.save(null,SaveFlag.None)}else g.isEmpty(remoteChanges)||(remoteChanges.isDeleted!==!0&&(remoteChanges.isDeleted=void 0),this.save(remoteChanges,SaveFlag.None));gdata.attachEventsToItem(this)},resolveText:function resolveTextFn(remoteChanges){var needsParsing=!1;if(this.modifiedOfflineText&&!this.forceModifiedItems)if(this.isLocalVersionNewer(VersionType.Text))gdata.saveChanges(this,{text:this.getParsedText()});else{var remoteText=gdata.get(this.data,"text");try{g.PAssert(2833,void 0!==remoteText,"Every item should have text associated with it from gdrive")}catch(PERR){g.reportError(PERR)}var localText=this.getRawText(),needDupe=!1;if(localText!==remoteText&&(needDupe=!0),needDupe){var thisIndex=this.getIndex(),newItem=d.createVMLI({text:this.getParsedText()},{parent:this.parent(),changeType:ChangeType.Remote});this.parent().insertItem(newItem,thisIndex+1),this.setText(remoteText,!0,ChangeType.Remote),remoteChanges&&(remoteChanges.text=this.getParsedText())}else remoteChanges&&(remoteChanges.modifiedOfflineText=!1);remoteChanges&&(remoteChanges.versionText=this.getRemoteVersion(VersionType.Text))}else if(this.isRemoteVersionNewer(VersionType.Text)){var remoteText=gdata.get(this.data,"text");try{g.PAssert(2834,void 0!==remoteText,"Every item should have text associated with it from gdrive")}catch(PERR){g.reportError(PERR)}this.getRawText()!==remoteText&&(this.setRawText(remoteText),remoteChanges&&(remoteChanges.text=this.getRawText()),this.isVersionUninitialized(VersionType.Text)||(needsParsing=!0)),remoteChanges&&this.getVersion(VersionType.Text)!==this.getRemoteVersion(VersionType.Text)&&(remoteChanges.versionText=this.getRemoteVersion(VersionType.Text))}return needsParsing},resolveMisc:function resolveMiscFn(remoteChanges){var useLocal=this.modifiedOfflineText&&this.isLocalVersionNewer(VersionType.Text),needsParsing=!1,modLocal=!1;if(useLocal||this.isRemoteVersionNewer(VersionType.Structure)||this.isRemoteVersionNewer(VersionType.Text)){var localChanges={},remoteDate=gdata.get(this.data,"date");if((remoteDate||this.date())&&(!this.date()||this.date().getTime()!==remoteDate))if(useLocal&&this.date())localChanges.date=this.date().getTime(),modLocal=!0;else{if(remoteDate){var newDate=new Date(remoteDate);this.date(newDate,!0)}else this.date(null,!0);remoteChanges&&(remoteChanges.date=this.getDateTime()),this.isVersionUninitialized(VersionType.Text)||(needsParsing=!0)}var remoteRepeatDate=gdata.get(this.data,"repeatDate");if(!(!remoteRepeatDate&&!this.repeatDate()||this.repeatDate()&&this.repeatDate().equals(remoteRepeatDate)))if(useLocal&&this.repeatDate())localChanges.repeatDate=this.repeatDate().toString(),modLocal=!0;else{if(remoteRepeatDate){var newRepeatDate=new RepeatDate(remoteRepeatDate);newRepeatDate.isValid()?this.repeatDate(newRepeatDate,!0):g.reportError(new Error("Remote init invalid repeat date: "+remoteRepeatDate))}else this.repeatDate(null,!0);remoteChanges&&(remoteChanges.repeatDate=this.getRepeatDate()),this.isVersionUninitialized(VersionType.Text)||(needsParsing=!0)}var remoteDateCreated=gdata.get(this.data,"dateCreated");if(!this.dateCreated||!remoteDateCreated||this.dateCreated.getTime()!==remoteDateCreated)if(useLocal)localChanges.dateCreated=this.dateCreated?this.dateCreated.getTime():void 0,modLocal=!0;else{var rDate=remoteDateCreated;try{g.PAssert(2835,"string"!=typeof remoteDateCreated,"Invalid date format stored")}catch(PERR){g.reportError(PERR)}this.dateCreated=new Date(rDate),remoteChanges&&(remoteChanges.dateCreated=rDate)}var remoteDateCompleted=gdata.get(this.data,"dateCompleted");if(!(!remoteDateCompleted&&!this.dateCompleted||this.dateCompleted&&remoteDateCompleted&&this.dateCompleted.getTime()===remoteDateCompleted))if(useLocal)localChanges.dateCompleted=this.dateCompleted?this.dateCompleted.getTime():void 0,modLocal=!0;else{var rDate=remoteDateCompleted;try{g.PAssert(2836,"string"!=typeof remoteDateCompleted,"Invalid date format stored")}catch(PERR){g.reportError(PERR)}this.dateCompleted=new Date(rDate),remoteChanges&&(remoteChanges.dateCompleted=rDate)}var remotePriority=gdata.get(this.data,"priority");(remotePriority||this.priority())&&this.priority()!==remotePriority&&(useLocal?(localChanges.priority=this.priority(),modLocal=!0):(null===remotePriority&&(remotePriority=VMLIFlag.None),this.priority(remotePriority,!0)));var remoteStarred=gdata.get(this.data,"isStarred");(remoteStarred||this.isStarred())&&this.isStarred()!==remoteStarred&&(useLocal?(localChanges.isStarred=this.isStarred(),modLocal=!0):(null===remoteStarred&&(remoteStarred=!1),this.isStarred(remoteStarred,!0)));var remoteComplete=gdata.get(this.data,"isComplete");if((remoteComplete||this.isComplete())&&this.isComplete()!==remoteComplete&&(useLocal?(localChanges.isComplete=this.isComplete(),modLocal=!0):(null===remoteComplete&&(remoteComplete=!1),this.isComplete(remoteComplete,!0))),useLocal){try{g.PAssert(2837,modLocal===!g.isEmpty(localChanges),"Verify modLocal is computed properly. It should track any changes to localChanges")}catch(PERR){g.reportError(PERR)}modLocal===!0&&gdata.saveChanges(this,localChanges)}}return needsParsing},resolveNote:function resolveNoteFn(remoteChanges){var remoteItem=gdata.get(this.data,"note"),localModel=this.hasNote()?this.getNote():void 0;if(remoteItem)if(localModel)localModel.initFromGDrive(remoteItem);else{var localItem=d.getItem(remoteItem.id);if(localItem){if(localItem.isDeleted){try{g.PAssert(2838,g.isReconnected||!localModel,"The local model should never exist when an item has been marked as deleted locally")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2839,localItem.modifiedOffline,"How did the note get deleted if it wasn't modified offline?")}catch(PERR){g.reportError(PERR)}gdata.getVersion(remoteItem,VersionType.Structure)==localItem.version?gdata.noteSet(this,void 0):(localModel=d.createVMLI({data:remoteItem,isNote:!0},{parent:this,changeType:ChangeType.Remote}),d.undeleteItem(localModel,ChangeType.Remote),this.setNote(localModel,!0),g.vmMain.addModifiedItem(localModel))}}else localModel=d.createVMLI({data:remoteItem,isNote:!0},{parent:this,changeType:ChangeType.Remote}),this.setNote(localModel,!0),g.vmMain.addModifiedItem(localModel)}else localModel&&(d.initializeItem(localModel),gdata.noteSet(this,localModel))},resolveItemsHelper:function resolveItemsHelperFn(resolveArchived,remoteChanges){var i,remoteItem,localIndex,localItem,localModel,saveItemLists,collabItemList=gdata.getItemList(this.data,resolveArchived),itemArray;itemArray=resolveArchived?this.hasArchivedChildren()?this.archivedItems(!0):[]:this.getItems();try{g.PAssert(2840,itemArray,"Item arrays must exist")}catch(PERR){g.reportError(PERR)}for(i=0;collabItemList&&i<collabItemList.length;i++)if(remoteItem=collabItemList.get(i)){try{g.PAssert(2842,void 0===gdata.loadSeen[remoteItem.id]||gdata.loadSeen[remoteItem.id]===!1,"Items can only be seen once on the remote.")}catch(PERR){g.reportError(PERR)}gdata.loadSeen[remoteItem.id]=this.id;var localIndex=this.getIndexOf(remoteItem.id,resolveArchived);if(localIndex>=0)localModel=itemArray[localIndex],localModel.initFromGDrive(remoteItem);else if(localItem=d.getItem(remoteItem.id),localModel=d.getModel(remoteItem.id),localItem)if(localItem.isDeleted){try{g.PAssert(2844,localItem.modifiedOffline,"How did the item get deleted if it wasn't modified offline?")}catch(PERR){g.reportError(PERR)}if(gdata.getVersion(remoteItem,VersionType.Structure)==localItem.version){gdata.itemRemoved({item:this,index:i,numToRemove:1,isArchived:resolveArchived});var childItem;i--}else{if(localModel){try{g.PAssert(2845,void 0===localModel.parent(),"Should never have a parent if deleted")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2846,localModel.data===remoteItem,"Local model should match remote data")}catch(PERR){g.reportError(PERR)}localModel.parent(this)}else localModel=d.createVMLI({data:remoteItem,isArchived:resolveArchived},{parent:this,changeType:ChangeType.Remote});d.undeleteItem(localModel,ChangeType.Remote),itemArray.splice(i,0,localModel),saveItemLists=!0,g.vmMain.addModifiedItem(localModel)}}else if(localModel&&localModel.modifiedOffline)if(localModel.isLocalVersionNewer(VersionType.Structure)){try{g.PAssert(2847,gdata.loadSeen[remoteItem.id]===this.id)}catch(PERR){g.reportError(PERR)}gdata.loadSeen[remoteItem.id]=!1}else localModel.moveTo({parent:this,index:i,isRemoteChange:!0,shouldBeArchived:resolveArchived}),localModel.initFromGDrive(remoteItem),saveItemLists=!0,g.vmMain.addModifiedItem(localModel);else localModel?(localModel.moveTo({parent:this,index:i,isRemoteChange:!0,shouldBeArchived:resolveArchived}),localModel.initFromGDrive(remoteItem),saveItemLists=!0,g.vmMain.addModifiedItem(localModel)):g.reportError(new Error("Local model does not exist for local item that was not deleted."));else{try{g.PAssert(2843,!localModel,"The local model should never exist if there is no corresponding item entry")}catch(PERR){g.reportError(PERR)}localModel=d.createVMLI({data:remoteItem,isArchived:resolveArchived},{parent:this,changeType:ChangeType.Remote}),itemArray.splice(i,0,localModel),saveItemLists=!0,g.vmMain.addModifiedItem(localModel)}}else try{g.PAssert(2841,remoteItem,"Item in remote list does not exist")}catch(PERR){g.reportError(PERR)}if(d.hasLocalData){for(i=0;i<itemArray.length;i++)if(localModel=itemArray[i],gdata.loadSeen[localModel.id]!==this.id)if(remoteItem=localModel.data){if(localModel.modifiedOffline&&localModel.isLocalVersionNewer(VersionType.Structure)){var inTree=gdata.findInTree(remoteItem);if(inTree){var oldParentModel;gdata.itemMoved({item:localModel,newInfo:{index:i,isArchived:resolveArchived},oldParent:inTree.parent,oldInfo:inTree})}else{var remoteDeletedItem=gdata.getDeletedCacheItem(remoteItem.id);if(remoteDeletedItem){try{g.PAssert(2854,!gdata.getItemParent(remoteDeletedItem),"Deleted items should never have parents")}catch(PERR){g.reportError(PERR)}gdata.restoreDeletedItem(remoteItem.id),gdata.itemAdded({item:this,addedItem:remoteItem,index:i,isArchived:resolveArchived})}}localModel.initFromGDrive(remoteItem)}}else if(localModel.modifiedOfflineText){var childrenToRemove=[],localChildren;if(resolveArchived?localModel.hasArchivedChildren()&&(localChildren=localModel.archivedItems(!0)):localChildren=localModel.getItems(),localChildren)for(var j=0;j<localChildren.length;++j)if(localChildren[j].data&&localChildren[j].isLocalVersionNewer(VersionType.Structure)){var inTree=gdata.findInTree(localChildren[j].data);try{g.PAssert(2849,inTree,"Item should be found in tree")}catch(PERR){g.reportError(PERR)}inTree&&childrenToRemove.push({parent:inTree.parent,child:localChildren[j]})}d.initializeItem(localModel),gdata.itemAdded({item:this,addedItem:localModel,index:i,isArchived:resolveArchived});for(var j=0;j<childrenToRemove.length;++j){var removeData=childrenToRemove[j];try{g.PAssert(2850,removeData,"Must have valid data to remove")}catch(PERR){g.reportError(PERR)}var isArchived=removeData.child.isArchived(),remoteList=gdata.getItemList(removeData.parent,isArchived);try{g.PAssert(2851,remoteList,"The item has children, it must have a list")}catch(PERR){g.reportError(PERR)}var index=remoteList.indexOf(removeData.child.data);try{g.PAssert(2852,index>=0,"Remote item must be in the parents list")}catch(PERR){g.reportError(PERR)}gdata.itemRemoved({item:removeData.parent,index:index,numToRemove:1,isArchived:isArchived})}localModel.initFromGDrive(localModel.data)}else{try{g.PAssert(2853,d.getItem(localModel.id),"Trying to delete an item locally that doesn't exist locally")}catch(PERR){g.reportError(PERR)}this.deleteChild(localModel,void 0,void 0,ChangeType.Remote),i--,saveItemLists=!0,g.vmMain.addModifiedItem(localModel)}if(!resolveArchived&&collabItemList&&(collabItemList.length>0||itemArray.length>0)){var localModArray=[],nonSharedArray,tempArray=[],remoteArray=collabItemList.asArray(),reorderFound=!1;for(i=0;i<remoteArray.length;++i){var tempID=remoteArray[i].id;if(!tempID)try{g.PAssert(2855,tempID,"Item in list without an ID defined: "+JSON.stringify(remoteArray[i]))}catch(PERR){g.reportError(PERR)}var tempModel=d.getModel(tempID);try{g.PAssert(2856,tempModel,"If the remote ID exists the local item should have been created.")}catch(PERR){g.reportError(PERR)}var localIndex=this.getIndexOf(tempID);tempModel&&tempModel.modifiedOffline&&tempModel.isLocalVersionNewer(VersionType.Structure)?localIndex>=0?localModArray.push(localIndex):(nonSharedArray||(nonSharedArray=[]),log(this.id+": Item in remote array not found in local array: ",tempID),nonSharedArray.push(tempID)):localIndex>=0?(tempArray.push(tempID),localIndex!==i&&(reorderFound=!0)):(nonSharedArray||(nonSharedArray=[]),log(this.id+": Item in remote array not found in local array: ",tempID),nonSharedArray.push(tempID))}if(reorderFound||localModArray.length>0){var tempArrayText;for(localModArray.sort(),i=0;i<localModArray.length;i++){var localItem=itemArray[localModArray[i]];localItem&&tempArray.splice(localModArray[i],0,localItem.id);var tempArrayText}nonSharedArray&&nonSharedArray.length>0&&(tempArray=tempArray.concat(nonSharedArray));var remoteArrayText,localArrayText,tempArrayText,remoteArrayText;for(i=0;i<tempArray.length;++i)for(var searchItem=tempArray[i],j=i;j<collabItemList.length;++j){var findItem=collabItemList.get(j);if(searchItem===findItem.id){if(i!==j){var lModel=d.getModel(findItem.id),oldInfo={index:j,isArchived:!1},newInfo={index:i,isArchived:!1};gdata.itemMoved({item:lModel,newInfo:newInfo,oldParent:this,oldInfo:oldInfo}),saveItemLists=!0,g.vmMain.addModifiedItem(lModel);var remoteArrayText}break}}var localArrayText;for(i=0;i<tempArray.length;++i)for(var searchItem=tempArray[i],j=i;j<itemArray.length;++j){var findItem=itemArray[j];if(searchItem===findItem.id){if(i!==j){findItem.moveTo({parent:this,index:i,isRemoteChange:!0,shouldBeArchived:!1}),saveItemLists=!0,g.vmMain.addModifiedItem(findItem);var localArrayText}break}}}}}saveItemLists&&(resolveArchived?this.hasArchivedChildren()&&this.archivedItems().notify():g.vmMain.updateAllItems(),resolveArchived&&!this.hasArchivedChildren()&&this.archivedItems().set(itemArray),remoteChanges&&(remoteChanges.items=this.getItemsArrayForSave()))},resolveItems:function resolveItemsFn(remoteChanges){this.resolveItemsHelper(!1,remoteChanges),this.resolveItemsHelper(!0,remoteChanges),this.resolveNote(remoteChanges)},isLocalEvent:function isLocalEventFn(event){var isLocal=event.isLocal;if(tracker.undoRedoActive)try{g.PAssert(2862,isLocal,"Must be a local event during undo/redo")
}catch(PERR){g.reportError(PERR)}return isLocal},onValueChanged:function onValueChangedFn(event){if(!event.isLocal||tracker.undoRedoActive){var mappedProperty=g.translateFieldOut(event.property);if(this.id===event.target.id){var fromRemote=!this.isLocalEvent(event),needsParse=!1;switch(mappedProperty){case"version":case"versionText":var remoteVersion=gdata.get(this.data,mappedProperty);if(remoteVersion>this[mappedProperty]||void 0===this[mappedProperty]){var changes={modifiedOffline:!1};changes[mappedProperty]=this[mappedProperty]=remoteVersion,this.save(changes,SaveFlag.None)}break;case"priority":this.priority(event.newValue,fromRemote);break;case"isComplete":this.isComplete(event.newValue,fromRemote);break;case"isStarred":this.isStarred(event.newValue,fromRemote);break;case"dateCompleted":this.dateCompleted=event.newValue?new Date(event.newValue):null,this.save({dateCompleted:event.newValue},SaveFlag.None),needsParse=!0;break;case"isArchived":this.isArchived(event.newValue),this.save({isArchived:event.newValue},SaveFlag.None);break;case"date":this.date(event.newValue?new Date(event.newValue):null,fromRemote),this.save({date:event.newValue},SaveFlag.None);break;case"repeatDate":var newRepeatDate=event.newValue?new RepeatDate(event.newValue):null;!newRepeatDate||newRepeatDate.isValid()?(this.repeatDate(newRepeatDate,fromRemote),this.save({repeatDate:event.newValue},SaveFlag.None),needsParse=!0):g.reportError(new Error("Remote invalid repeat date: "+event.newValue));break;case"allDayDate":break;case"note":event.newValue?this.addRemoteNote(event.newValue,fromRemote):this.removeRemoteNote(fromRemote);break;case"items":case"archivedItems":var isArchived=!("items"===mappedProperty);if(event.newValue)for(var i=0;i<event.newValue.length;++i)this.addRemoteItem(event.newValue.get(i),i,isArchived,fromRemote);else{try{g.PAssert(2864,0===event.oldValue.length,"Expected no items in list")}catch(PERR){g.reportError(PERR)}this.removeAllRemoteItems(isArchived)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None);break;case"dateCreated":break;case"text":this.onTextChanged(event);break;default:ShouldLog(LogLevels.Error)&&log("Unhandled value changed remotely: ",mappedProperty,event)}if(needsParse){var changeType=(fromRemote?ChangeType.Remote:ChangeType.Local)|ChangeType.Property;this.parseText(!0,changeType)}}}},onTextChanged:function onTextChangedFn(event){if(!event.isLocal||tracker.undoRedoActive){var changeType=(this.isLocalEvent(event)?ChangeType.Local:ChangeType.Remote)|ChangeType.Text,remoteText=gdata.get(this.data,"text");if(remoteText!==this.getRawText()&&(this.setRawText(remoteText),this.parseText(!0,changeType),this.save({text:this.getRawText()},SaveFlag.None),tracker.undoRedoActive)){var evType=TrackerType.SetText;tracker.notifyStateChangedFromUndoRedo(evType,{itemID:this.id,position:g.findFirstDiff(event.newValue,event.oldValue,!1,!0),text:event.newValue})}}},addRemoteItem:function addRemoteItemFn(remoteItem,index,isArchived,fromRemote){var remoteID=remoteItem.id;gdata.cacheItem(remoteItem);var changeType=fromRemote?ChangeType.Remote:ChangeType.Local,localList=isArchived?this.archivedItems():this.items,localListUnderlying=localList.get();if(index<localListUnderlying.length&&localListUnderlying[index].id===remoteID)return void log("Skipping addRemoteItem - "+index+" vs. "+localListUnderlying.length);var vmli=d.getModel(remoteID);vmli||(vmli=d.createVMLI({data:remoteItem},{parent:this,changeType:changeType})),vmli.isDeleted()&&(vmli.isDeleted(!1,changeType),vmli.save(null,SaveFlag.None)),vmli.isArchived()!==isArchived&&(vmli.isArchived(isArchived),vmli.save({isArchived:isArchived},SaveFlag.None)),vmli.parent(this),localList.splice(index,0,vmli),tracker.undoRedoActive&&tracker.notifyStateChangedFromUndoRedo(TrackerType.Create,{itemID:vmli.id,parent:this.id,position:index,text:gdata.get(remoteItem,"text")})},removeAllRemoteItems:function removeAllRemoteItemsFn(isArchived){isArchived?this.hasArchivedChildren()&&this.archivedItems().set([]):this.items.set([])},removeRemoteItem:function removeRemoteItemFn(remoteItem,index,isArchived,isActualDelete,fromRemote){var localList;if(isArchived){try{g.PAssert(2865,this.hasArchivedChildren(),"Must have a valid item list to remove from")}catch(PERR){g.reportError(PERR)}localList=this.archivedItems()}else localList=this.items;var localItem=localList.get()[index];if(localItem&&localItem.id===remoteItem.id){try{g.PAssert(2866,localItem,"Expect a valid local item to remove")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2867,remoteItem.id===localItem.id,"Remote item should match local items")}catch(PERR){g.reportError(PERR)}if(tracker.undoRedoActive){var prevItem=g.getPreviousItem(localItem);tracker.notifyStateChangedFromUndoRedo(TrackerType.Delete,{itemID:localItem.id,parent:this.id,position:index,previous:prevItem?prevItem.id:void 0})}localList.splice(index,1),isActualDelete&&d.deleteItem(localItem,fromRemote?ChangeType.Remote:ChangeType.Local)}},addRemoteNote:function addRemoteNoteFn(remoteNote,fromRemote){try{g.PAssert(2868,!this.hasNote(),"State of note should always match when adding")}catch(PERR){g.reportError(PERR)}var remoteID=remoteNote.id;gdata.cacheItem(remoteNote);var vmli=d.getModel(remoteID);vmli||(vmli=d.createVMLI({data:remoteNote,isNote:!0},{parent:this,changeType:fromRemote?ChangeType.Remote:ChangeType.Local}));try{g.PAssert(2869,vmli.isNote(),"Must always be a valid note")}catch(PERR){g.reportError(PERR)}vmli.parent(this),this.setNote(vmli,fromRemote)},removeRemoteNote:function removeRemoteNoteFn(fromRemote){try{g.PAssert(2870,this.hasNote(),"State of note should always match when removing")}catch(PERR){g.reportError(PERR)}var localNote=this.getNote();this.setNote(void 0,!0);var changeType=fromRemote?ChangeType.Remote:ChangeType.Local;d.deleteItem(localNote,changeType)},onListAdded:function onListAddedFn(event){if(!event.isLocal||tracker.undoRedoActive){g.vmMain.beginUpdateItems(),gdata.numChanges++;var fromRemote=!this.isLocalEvent(event),areItemsArchived=!1,isValidTarget=!0,remoteItemList=gdata.get(this.data,"items");if(remoteItemList&&event.target.id===remoteItemList.id)isValidTarget=event.target.id===remoteItemList.id;else{var remoteArchivedList=gdata.get(this.data,"archivedItems");remoteArchivedList&&event.target.id===remoteArchivedList.id&&(areItemsArchived=!0),isValidTarget=remoteArchivedList&&event.target.id===remoteArchivedList.id}if(!isValidTarget)return void log("Skipping list add due to invalid target");var getRemoteFn,startIndex,endIndex;event.values.length>0?(startIndex=event.index,endIndex=startIndex+event.values.length,getRemoteFn=function(index){return event.values[index]}):(startIndex=0,endIndex=event.target.length,getRemoteFn=function(index){return event.target.get(index)});for(var i=startIndex;endIndex>i;++i){var eventIndex=i-startIndex,remoteItem=getRemoteFn(eventIndex);try{g.PAssert(2873,remoteItem,"Always expect a valid item at each index")}catch(PERR){g.reportError(PERR)}this.addRemoteItem(remoteItem,i,areItemsArchived,fromRemote)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None),this._selectionBeforeBlur=void 0,g.vmMain.commitUpdateItems()}},onListRemoved:function onListRemovedFn(event){if(!event.isLocal||tracker.undoRedoActive){var fromRemote=!this.isLocalEvent(event);gdata.numChanges++;var idx,remoteItem,debugLocalItem,localText,areItemsArchived=!1,isValidTarget=!0,remoteItemList=gdata.get(this.data,"items");if(remoteItemList&&event.target.id===remoteItemList.id)isValidTarget=event.target.id===remoteItemList.id;else{var remoteArchivedList=gdata.get(this.data,"archivedItems");remoteArchivedList&&event.target.id===remoteArchivedList.id&&(areItemsArchived=!0),isValidTarget=remoteArchivedList&&event.target.id===remoteArchivedList.id}if(!isValidTarget)return void log("Skipping list remove due to invalid target");g.vmMain.beginUpdateItems();for(var startIndex=event.index,endIndex=startIndex+event.values.length,isActualDelete=void 0===event.movedToList||null===event.movedToList,i=endIndex-1;i>=startIndex;i--){var eventIndex=i-startIndex;try{g.PAssert(2877,!!event.values[eventIndex],"Always expect a valid item at each index")}catch(PERR){g.reportError(PERR)}var remoteItem=event.values[eventIndex];this.removeRemoteItem(remoteItem,i,areItemsArchived,isActualDelete,fromRemote)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None),this._selectionBeforeBlur=void 0,g.vmMain.commitUpdateItems()}},onListSet:function onListSetFn(event){try{g.PAssert(2878,!1,"What? This shouldn't happen!",event)}catch(PERR){g.reportError(PERR)}},onObjectChanged:function onObjectChangedFn(event){if(event.ocHandled)return ShouldLog(LogLevels.Warning|LogLevels.Verbose)&&log("Event Already Handled: ",event.ocHandled,"-",this.id,event.events[0].type),!1;gdata.numChanges++,event.ocHandled=this.id,event.stopPropagation();var i,ev;if(event.isLocal&&!tracker.undoRedoActive)return!1;var savedSelection=Sel.save();Sel.reset();for(var i=0;i<event.events.length;++i){var e=event.events[i];if(e.ocHandled)log("Sub-Event Already Handled: ",e.ocHandled,"-",this.id,e.type);else switch(e.ocHandled=this.id,e.type){case gapi.drive.realtime.EventType.TEXT_DELETED:this.onTextChanged(e);break;case gapi.drive.realtime.EventType.TEXT_INSERTED:this.onTextChanged(e);break;case gapi.drive.realtime.EventType.VALUES_ADDED:this.onListAdded(e);break;case gapi.drive.realtime.EventType.VALUES_REMOVED:this.onListRemoved(e);break;case gapi.drive.realtime.EventType.VALUE_CHANGED:this.onValueChanged(e);break;case gapi.drive.realtime.EventType.VALUES_SET:try{g.PAssert(2879,!1,"VALUES_SET should never be triggered")}catch(PERR){g.reportError(PERR)}break;default:try{g.PAssert(2880,!1,"Unexpected event type")}catch(PERR){g.reportError(PERR)}}}return savedSelection&&Sel.restore(savedSelection,!0),!1}}};return VMLI_Drive}),define("sounds",["globals","platform"],function(g,platform){function addSource(sound,src){var source=document.createElement("source");source.src=src,sound.appendChild(source)}var self={},bank={};return self.add=function addFn(name){if(self[name]=name,!bank[name]){var sound=document.createElement("audio");addSource(sound,"sounds/"+name+".mp3"),sound.preload="auto",bank[name]=sound}},self.play=function playFn(name){if(!g.settings.get(Settings.noSounds)){if(!bank[name])return log("Tried to play a sound that has not been loaded:",name),void console.trace();try{bank[name].play()}catch(err){log("Failed to play audio",err)}}},self}),define("International",["platform","globals"],function(platform,g){function International(){this._currentLanguage="en-US",this._supportedLanguages=["en-US","en-GB"],this._languages={},this._localized=[],this.init()}return window.DFormat={LongDayTime:0,ShortDayTime:1,ShortTime:2,ShortDate:3,MonthDay:4,LongStrDate:5},International.prototype={init:function initFn(){this._loadLanguages();var browserLang=navigator.language||navigator.userLanguage;browserLang!==this._currentLanguage&&this._supportedLanguages[browserLang]&&(this._currentLanguage=browserLang,this._loadLanguage()),this._loadLocalized()},setLanguage:function setLanguageFn(lcode,cb){lcode!==this._currentLanguage&&this._supportedLanguages.indexOf(lcode)>=0&&(this._currentLanguage=lcode,this._loadLanguage(cb))},getCurrentLanguageCode:function getCurrentLanguageCodeFn(){return this._currentLanguage},getCurrentLanguagePack:function getCurrentLanguagePackFn(){try{g.PAssert(2881,this._languages[this._currentLanguage],"Invalid language request")}catch(PERR){g.reportError(PERR)}return this._languages[this._currentLanguage]},getFormat:function getFormatFn(format){try{g.PAssert(2882,this._localized[format],"Invalid format request")}catch(PERR){g.reportError(PERR)}return this._localized[format]},_loadLanguage:function _loadLanguageFn(cb){var loadLanguage=this._currentLanguage;try{g.PAssert(2883,this._languages[loadLanguage],"Languages must always be loaded")}catch(PERR){g.reportError(PERR)}log("Set Language: ",loadLanguage),Date.CultureStrings=Date.CultureStrings||{},Date.CultureStrings[loadLanguage]=this._languages[loadLanguage],g.vmMain.notifyLanguageUpdated(),Date.i18n.setLanguage(loadLanguage,!1,function(){cb&&cb(),this._loadLocalized()}.bind(this))},_loadLocalized:function _loadLocalizedFn(){this._localized[DFormat.LongDayTime]="dddd "+Date.CultureInfo.formatPatterns.shortTime,this._localized[DFormat.ShortDayTime]=Date.CultureInfo.formatPatterns.monthDayShortTime+" "+Date.CultureInfo.formatPatterns.shortTime,this._localized[DFormat.ShortTime]=Date.CultureInfo.formatPatterns.shortTime,this._localized[DFormat.ShortDate]=Date.CultureInfo.formatPatterns.monthDayShortTime,this._localized[DFormat.MonthDay]="MMM d",this._localized[DFormat.MonthDayYear]=Date.CultureInfo.formatPatterns.monthDayYear,this._localized[DFormat.LongStrDate]="MMMM dd, yyyy"},_loadLanguages:function _loadLanguagesFn(){this._languages["en-US"]={},this._languages["en-GB"]={name:"en-GB",englishName:"English (United Kingdom)",nativeName:"English (United Kingdom)",Sunday:"Sunday",Monday:"Monday",Tuesday:"Tuesday",Wednesday:"Wednesday",Thursday:"Thursday",Friday:"Friday",Saturday:"Saturday",Sun:"Sun",Mon:"Mon",Tue:"Tue",Wed:"Wed",Thu:"Thu",Fri:"Fri",Sat:"Sat",Su:"Su",Mo:"Mo",Tu:"Tu",We:"We",Th:"Th",Fr:"Fr",Sa:"Sa",S_Sun_Initial:"S",M_Mon_Initial:"M",T_Tue_Initial:"T",W_Wed_Initial:"W",T_Thu_Initial:"T",F_Fri_Initial:"F",S_Sat_Initial:"S",January:"January",February:"February",March:"March",April:"April",May:"May",June:"June",July:"July",August:"August",September:"September",October:"October",November:"November",December:"December",Jan_Abbr:"Jan",Feb_Abbr:"Feb",Mar_Abbr:"Mar",Apr_Abbr:"Apr",May_Abbr:"May",Jun_Abbr:"Jun",Jul_Abbr:"Jul",Aug_Abbr:"Aug",Sep_Abbr:"Sep",Oct_Abbr:"Oct",Nov_Abbr:"Nov",Dec_Abbr:"Dec",AM:"AM",PM:"PM",firstDayOfWeek:1,twoDigitYearMax:2029,mdy:"dmy","M/d/yyyy":"dd/MM/yyyy","dddd, MMMM dd, yyyy":"dd MMMM yyyy","h:mm tt":"HH:mm","h:mm:ss tt":"HH:mm:ss","dddd, MMMM dd, yyyy h:mm:ss tt":"dd MMMM yyyy HH:mm:ss","yyyy-MM-ddTHH:mm:ss":"yyyy-MM-ddTHH:mm:ss","yyyy-MM-dd HH:mm:ssZ":"yyyy-MM-dd HH:mm:ssZ","ddd, dd MMM yyyy HH:mm:ss":"ddd, dd MMM yyyy HH:mm:ss","MMMM dd":"dd MMMM","MM/dd":"dd/MM","MM/dd/yy":"dd/MM/yy","MMMM, yyyy":"MMMM yyyy","/jan(uary)?/":"jan(uary)?","/feb(ruary)?/":"feb(ruary)?","/mar(ch)?/":"mar(ch)?","/apr(il)?/":"apr(il)?","/may/":"may","/jun(e)?/":"jun(e)?","/jul(y)?/":"jul(y)?","/aug(ust)?/":"aug(ust)?","/sep(t(ember)?)?/":"sep(t(ember)?)?","/oct(ober)?/":"oct(ober)?","/nov(ember)?/":"nov(ember)?","/dec(ember)?/":"dec(ember)?","/^sun(day)?/":"^sun(day)?","/^mon(day)?/":"^mon(day)?","/^tue(s(day)?)?/":"^tue(s(day)?)?","/^wed(nesday)?/":"^wed(nesday)?","/^thu(rsday)?/":"^thu(rsday)?","/^fri(day)?/":"^fri(day)?","/^sat(urday)?/":"^sat(urday)?","/^next/":"^next","/^last|past|prev(ious)?/":"^last|past|prev(ious)?","/^yesterday/":"^yesterday","/^today/":"^today","/^tom(orrow)?/":"^tom(orrow)?","/^soon/":"^soon","/^later/":"^later","/^someday/":"^someday","/^now/":"^now","/^(a|p)/":"^(a|p)","/^(a\\.?m?\\.?|p\\.?m?\\.?)/":"^(a\\.?m?\\.?|p\\.?m?\\.?)","/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\\s*(\\+|\\-)\\s*\\d\\d\\d\\d?)|gmt|utc)/":"^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\\s*(\\+|\\-)\\s*\\d\\d\\d\\d?)|gmt|utc)","/^\\s*(st|nd|rd|th)/":"^\\s*(st|nd|rd|th)","/^\\s*(\\:|a(?!u|p)|p)/":"^\\s*(\\:|a(?!u|p)|p)","/(this )(morn(ing)?)\\b/":"(this )(morn(ing)?)\\b","/(this )(even(ing)?)\\b/":"(this )(even(ing)?)\\b",LINT:"LINT",TOT:"TOT",CHAST:"CHAST",NZST:"NZST",NFT:"NFT",SBT:"SBT",AEST:"AEST",ACST:"ACST",JST:"JST",CWST:"CWST",CT:"CT",ICT:"ICT",MMT:"MMT",BIOT:"BST",NPT:"NPT",IST:"IST",PKT:"PKT",AFT:"AFT",MSK:"MSK",IRST:"IRST",FET:"FET",EET:"EET",CET:"CET",UTC:"UTC",GMT:"GMT",CVT:"CVT",GST:"GST",BRT:"BRT",NST:"NST",AST:"AST",EST:"EST",CST:"CST",MST:"MST",PST:"PST",AKST:"AKST",MIT:"MIT",HST:"HST",SST:"SST",BIT:"BIT",CHADT:"CHADT",NZDT:"NZDT",AEDT:"AEDT",ACDT:"ACDT",AZST:"AZST",IRDT:"IRDT",EEST:"EEST",CEST:"CEST",BST:"BST",PMDT:"PMDT",ADT:"ADT",NDT:"NDT",EDT:"EDT",CDT:"CDT",MDT:"MDT",PDT:"PDT",AKDT:"AKDT",HADT:"HADT"}}},new International}),define("VMLI",["ko","globals","util","platform","data","gdata","android","VMLI_TapHandlers","VMLI_Text","VMLI_Drive","tracker","sounds","RepeatDate","International","Observable","ObservableArray","Trigger","Dispatcher"],function(ko,g,util,platform,d,gdata,android,VMLI_TapHandlers,VMLI_Text,VMLI_Drive,tracker,sounds,RepeatDate,International,Observable,ObservableArray,Trigger,Dispatcher){function VMLI(p,extraInfo){try{g.PAssert(2884,extraInfo,"Each VMLI must be given a set of additional info")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2885,g.isValidChangeType(extraInfo.changeType),"Must specify a valid change type when creating a VMLI")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2886,extraInfo.store,"Must supply a valid itemStore for each VMLI")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2887,!extraInfo.parent||extraInfo.parent._store===extraInfo.store,"All VMLIs in a tree must share the same owner")}catch(PERR){g.reportError(PERR)}if(!p.id&&p.data&&p.data.id)p.id=p.data.id;else if(p.id&&p.data)try{g.PAssert(2888,p.id===p.data.id,"If passing in a local id and a remote ID, they should match")}catch(PERR){g.reportError(PERR)}if(p.id&&d.getModel[p.id]){ShouldLog(LogLevels.Warning)&&log("Attempting to create an already created VMLI: ",p.id);try{g.PAssert(2889,!1,"Should not be constructing a VMLI here")}catch(PERR){g.reportError(PERR)}return d.getModel[p.id]}try{g.PAssert(2890,void 0===p.v,"We should never be passing in 'v'")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2891,void 0===p.extern,"We should never be passing in 'extern'")}catch(PERR){g.reportError(PERR)}this._store=extraInfo.store,this._parent=extraInfo?extraInfo.parent:void 0,this._rawText=p.data?"":p.text,this._searchText=p.data?"":p.text?p.text.toLowerCase():"",this._parsedText=void 0,this.els=void 0,this._isArchived=p.isArchived||!1,this.items=new ObservableArray([],this.itemsHasMutated.bind(this)),this._note=void 0,this.itemChanged=new Trigger,this._archivedItems=void 0,this._demandLoadChildren=p.demandLoadChildren||!1,this._loadedOnDemandData=!this._demandLoadChildren,this._paginationToken=void 0,this._canDestroy=p.canDestroy||!1,this._date=void 0,this._repeatDate=void 0,this._attachments=void 0,this.draggedInPane=new Observable(!1);var origFlags=VMLIFlag.None;p.isComplete?origFlags|=VMLIFlag.Complete:this._parent&&(this._parent._isFlagHelper(VMLIFlag.Complete)||this._parent._isFlagHelper(VMLIFlag.DisplayComplete))&&(origFlags|=VMLIFlag.DisplayComplete),p.isStarred&&(origFlags|=VMLIFlag.Starred),p.isNote&&(origFlags|=VMLIFlag.Note),p.priority&&(origFlags|=p.priority),this.flags=new Observable(origFlags),this.dateText=p.dateText,this.dateCreated=p.dateCreated?new Date(p.dateCreated):new Date,this.dateCompleted=p.dateCompleted?new Date(p.dateCompleted):void 0,this._activeTags=void 0,this._isDeleted=p.isDeleted||!1,this.modifiedOffline=void 0,this.modifiedOfflineText=void 0,this.highlightTimeout=void 0,this.data=void 0,this._version=window.UninitializedVersion,this._versionText=window.UninitializedVersion,this._versionRemote=void 0,this._versionRemoteText=void 0,this.lastFindPass=0,this.isEditable=new Observable(!0),this.levelsDeep=new Observable(this._parent?this._parent.levelsDeep.get()+1:0),window.__TOTAL_ITEMS++,p.isArchived&&window.__TOTAL_ARCHIVED_ITEMS++,this._needsParse=!1,this.init(p,extraInfo),this.isHeader(),util.forceBind("dragScroll",this),util.forceBind("onTouchHoldTimeout",this)}window.__TOTAL_ITEMS=0,window.__TOTAL_ARCHIVED_ITEMS=0,window.__TOTAL_ARCHIVE_PARENTS=0;var forceCompleteDate=new Date(9e12);return VMLI.prototype={templateNameItem:function templateNameItemFn(item,context){var pane=g.getPaneForContext(context);return g.templateNameItem(item,pane)},notifyDemandLoadUpdate:function notifyDemandLoadUpdateFn(showItems,pane){showItems&&!this._loadedOnDemandData&&(pane.requestDemandLoadData(this),this.notifyLoadedData())},notifyLoadedData:function notifyLoadedDataFn(){this._loadedOnDemandData=!0},notifyLoadDataFailed:function notifyLoadDataFailedFn(pane){this.setCollapsed(!1,pane,!1),this._loadedOnDemandData=!1},isDemandLoad:function isDemandLoadFn(){return this._demandLoadChildren},isDemandNotYetLoaded:function isDemandNotYetLoadedFn(){return this._demandLoadChildren&&!this._loadedOnDemandData},showInOutline:function showInOutlineFn(){return this.numItems()>0||this._demandLoadChildren},hasPaginationToken:function hasPaginationTokenFn(){return!!(this.flags.get()&VMLIFlag.HasPageToken)},setPaginationToken:function setPaginationTokenFn(token){try{g.PAssert(2892,token,"Should never be setting an undefined token - use clear instead")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2893,!this._paginationToken,"Should never be overriding a pagination token - clear then set")}catch(PERR){g.reportError(PERR)}this._paginationToken=token,this.setFlags(this.flags.get()|VMLIFlag.HasPageToken)},beginDataPageLoad:function beginDataPageLoadFn(){var token=this._paginationToken;try{g.PAssert(2895,token,"Should always have a valid pagination token when beginning to load a data page")}catch(PERR){g.reportError(PERR)}return this._paginationToken=void 0,this.setFlags(this.flags.get()&~VMLIFlag.HasPageToken),token},endDataPageLoad:function endDataPageLoadFn(token){token&&this.setPaginationToken(token)},notifyPaginationUpdate:function notifyPaginationUpdateFn(){try{g.PAssert(2897,this._paginationToken,"Must have a valid token to get next page of data")}catch(PERR){g.reportError(PERR)}this._paginationToken&&g.focusedPane.requestDataPage(this)},stylePaginationPadding:function stylePaginationPaddingFn(context){try{g.PAssert(2898,context,"Must always supply a data context for pagination padding calculation")}catch(PERR){g.reportError(PERR)}var pane=context.$parents[context.$parents.length-2];return this.getPadding(pane)+g.itemPaddingIncrement+"px"},hasNote:function hasNoteFn(){return void 0!==this._note},getNote:function getNoteFn(){try{g.PAssert(2899,this.hasNote(),"Must have a note to get one")}catch(PERR){g.reportError(PERR)}return this._note},setNote:function setNoteFn(note,fromRemote){try{g.PAssert(2900,!this.isNote(),"Should never set a note on a note")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2901,!this._note||!note,"Should never set a note multiple times on a single item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2902,!note||note.isNote(),"Should only set items that are notes as notes")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2903,!note||note instanceof VMLI,"Note must be a valid VMLI")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2904,!note||note.parent()===this,"Should always have a valid parent set before setting note on item")}catch(PERR){g.reportError(PERR)}if(this._note=note,this.shouldSave()){var newID=note?note.id:void 0;this.save({note:newID},SaveFlag.Prop),fromRemote||gdata.noteSet(this,note)}this.itemsHasMutated()},isNote:function isNoteFn(value,fromRemote){if(void 0===value)return this._isFlagHelper(VMLIFlag.Note);if(value!==this._isFlagHelper(VMLIFlag.Note)){var newFlags=value?this.flags.get()|VMLIFlag.Note:this.flags.get()&~VMLIFlag.Note;this.setFlags(newFlags)}},shouldSave:function shouldSaveFn(){return this._shouldSave||g.isDemoMode()},canDestroy:function canDestroyFn(){return this._canDestroy},_getLineStyle:function _getLineStyleFn(){return this.flags.get()&g.LSMask},_getPriority:function _getPriorityFn(){return this.flags.get()&g.PMask},getPadding:function getPaddingFn(pane){try{g.PAssert(2905,pane&&pane.getItem(),"Invalid pane")}catch(PERR){g.reportError(PERR)}if(this.isNote())return this.parent().getPadding(pane);var rootDepth=pane.getItem().levelsDeep.get(),paddingLevels=this.levelsDeep.get()-rootDepth-1;return g.itemPaddingStart+paddingLevels*g.itemPaddingIncrement},getPaddingOutline:function getPaddingOutlineFn(){var paddingLevels=this.levelsDeep.get();return g.outlinePaddingStart+paddingLevels*g.outlinePaddingIncrement},getPaddingForLevel:function getPaddingForLevelFn(level,outline){return outline?g.outlinePaddingStart+level*g.outlinePaddingIncrement:g.itemPaddingStart+level*g.itemPaddingIncrement},stylePadding:function stylePaddingFn(context){if(context){var pane=g.getPaneForContext(context);try{g.PAssert(2906,pane,"Must find a valid pane to get style padding for element")}catch(PERR){g.reportError(PERR)}return this.getPadding(pane)+"px"}return this.getPaddingOutline()+"px"},getSpanWidth:function getSpanWidthFn(pane){var padding=this.getPadding(pane),spanWidth=pane.getWidth()-padding-g.SPThresholdRight;return spanWidth},_updateStylePadding:function _updateStylePaddingFn(parentDepth,forceChange){try{g.PAssert(2907,this._parent,"Must have a valid parent to update padding, root should never change")}catch(PERR){g.reportError(PERR)}var newDepth=parentDepth+1,hasChanged=this.levelsDeep.get()!==newDepth;if(hasChanged||forceChange){hasChanged&&this.levelsDeep.set(newDepth);for(var children=this.getItems(),i=0;i<children.length;++i)children[i]._updateStylePadding(newDepth,forceChange)}},setFlags:function setFlagsFn(value){this.flags.set(value)},styleProps:function stylePropsFn(pane,blockDate){var localFlags=this.flags.get(),styleProps=this.isHeader()?"pHeader ":"";localFlags&VMLIFlag.Selected&&(styleProps+="selected "),localFlags&VMLIFlag.Highlighted&&pane!==g.focusedPane&&(styleProps+="highlight "),localFlags&VMLIFlag.NumList&&(styleProps+="pNumList "),this.isArchived()&&(styleProps+="archived "),localFlags&VMLIFlag.Complete?(!this.repeatDate()||this.dateCompleted&&this.dateCompleted.getTime()===forceCompleteDate.getTime())&&(styleProps+="pComplete "):styleProps+=localFlags&VMLIFlag.DisplayComplete?"pComplete ":localFlags&g.PMask?g.priorityMapOut[localFlags&g.PMask]+" ":"pNormal ",localFlags&VMLIFlag.Starred&&(styleProps+="pStar "),localFlags&VMLIFlag.Note&&(styleProps+="pNote ",localFlags&VMLIFlag.Multiline&&(styleProps+="multiline "));var attachments=this.getAttachments();if(attachments)for(var i=0;i<attachments.length;++i)if(attachments[i].isLoaded()){var cssField=attachments[i].getField("cssClass");cssField&&(styleProps+=cssField)}return styleProps},onAttachmentIDChange:function onAttachmentIDChangeFn(attach,oldID){this.setText(this.getParsedText(),!0,ChangeType.None)},onAttachmentUpdate:function onAttachmentUpdateFn(attach){this.parseText(!0,ChangeType.None)},setAttachments:function setAttachmentsFn(attachments,changeType){if(!this._attachments&&attachments&&(this._attachments=ko.observableArray()),this._attachments){for(var thisAttachments=this._attachments(),i=0;i<thisAttachments.length;++i)attachments.indexOf(thisAttachments[i])<0&&(thisAttachments[i].unsubscribe(this),this.shouldSave()&&thisAttachments[i].markUnused(changeType));for(var i=0;i<attachments.length;++i){var attach=attachments[i];if(thisAttachments.indexOf(attach)<0){if(attach.shouldBeDeleted()){var embedString=attach.getEmbedString(),newText=this.getRawText().replace(embedString,"File failed to upload");return void requestAnimationFrame(function(){this.setText(newText,!0,ChangeType.Local)}.bind(this))}attach.subscribe(this),this.shouldSave()&&attach.markInUse(changeType)}}this._attachments(attachments)}this.itemChanged.notify()},getAttachment:function getAttachmentFn(index){try{g.PAssert(2912,this._attachments,"Must have valid attachments in order to query")}catch(PERR){g.reportError(PERR)}return this._attachments?this._attachments()[index]:void 0},hasAttachment:function hasAttachmentFn(id){if(this._attachments)for(var i=0;i<this._attachments().length;++i)if(this._attachments()[i].id===id)return!0;return!1},hasPluginAttachment:function hasPluginAttachmentFn(pluginID){if(this._attachments)for(var i=0;i<this._attachments().length;++i)if(this._attachments()[i].getPlugin().id===pluginID)return!0;return!1},getAttachmentById:function getAttachmentByIdFn(id){try{g.PAssert(2913,this._attachments,"Must have valid attachments in order to query")}catch(PERR){g.reportError(PERR)}if(this._attachments)for(var i=0;i<this._attachments().length;++i)if(this._attachments()[i].id===id)return this._attachments()[i];return void 0},getAttachments:function getAttachmentsFn(){return this._attachments&&this._attachments().length>0?this._attachments():void 0},hasAttachments:function hasAttachmentsFn(){return this._attachments&&this._attachments().length>0},getNumAttachments:function getNumAttachmentsFn(){return this._attachments?this._attachments().length:0},copyProperties:function copyPropertiesFn(src){this.isStarred(src.isStarred()),this.isComplete(src.isComplete()),this.priority(src.priority())},moveNote:function moveNoteFn(src){try{g.PAssert(2914,src.hasNote(),"Must have a note to move")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2915,!this.hasNote(),"Must not already have a note")}catch(PERR){g.reportError(PERR)}var note=src.getNote();src.setNote(void 0),note&&(note.parent(this),this.setNote(note))},parent:function parentFn(){if(1===arguments.length){try{g.PAssert(2916,arguments[0]instanceof VMLI||void 0===arguments[0],"Parent must be a VMLI")}catch(PERR){g.reportError(PERR)}this._parent=arguments[0];try{g.PAssert(2917,!this._parent||this._parent._store===this._store,"All VMLIs in the same tree must share the same owner")}catch(PERR){g.reportError(PERR)}void 0!==arguments[0]&&this._updateStylePadding(this._parent.levelsDeep.get(),!1)}return this._parent},getItemStore:function getItemStoreFn(){return this._store},belongsToSameItemStore:function belongsToSameItemStoreFn(item){return this.getItemStore()===item.getItemStore()},belongsToItemStore:function belongsToItemStoreFn(itemStore){return this.getItemStore()===itemStore},archivedItems:function archivedItemsFn(underlying){return this._archivedItems||(this._archivedItems=new ObservableArray,window.__TOTAL_ARCHIVE_PARENTS++),underlying?this._archivedItems.get():this._archivedItems},hasArchivedChildren:function hasArchivedChildrenFn(){return void 0!==this._archivedItems?this._archivedItems.get().length>0:!1},isArchived:function isArchivedFn(){if(1===arguments.length){var oldValue=this._isArchived;this._isArchived=arguments[0],arguments[0]!==oldValue&&Dispatcher.fireEvent("itemStateChanged",[this])}return this._isArchived},isHidden:function isHiddenFn(pane,outline){try{g.PAssert(2918,pane,"Must specify the pane for the item being checked")}catch(PERR){g.reportError(PERR)}return pane?!pane.search.isMatched(this):!1},getRawText:function getRawTextFn(){return this._rawText},getParsedText:function getParsedTextFn(){try{g.PAssert(2919,this._needsParse===!1,"Text should be parsed before calling get")}catch(PERR){g.reportError(PERR)}return this._parsedText?this._parsedText:this._rawText},getSearchText:function getSearchTextFn(){try{g.PAssert(2920,void 0!==this._searchText,"Item should always have search text")}catch(PERR){g.reportError(PERR)}return this._searchText},setRawText:function setRawTextFn(text){(void 0===text||null===text)&&(text=""),this._rawText=text,void 0!==text&&(this._searchText=text.toLowerCase()),this._parsedText=void 0,this._needsParse=!0},setParsedText:function setParsedTextFn(text){this._parsedText=text,text&&(this._searchText=text.toLowerCase()),this._needsParse=!1},priority:function priorityFn(pri,fromRemote){if(void 0===pri)return this._getPriority();try{g.PAssert(2922,null===pri||g.priorityMapOut[pri],"Priority must be defined in globals")}catch(PERR){g.reportError(PERR)}var oldPriority=this._getPriority();if(pri!==oldPriority){var origFlags=this.flags.get(),newFlags=origFlags&~g.PCMask|pri;if(origFlags&VMLIFlag.Complete&&(newFlags=newFlags&~VMLIFlag.Complete&~VMLIFlag.DisplayComplete),this.setFlags(newFlags),this.shouldSave()){var saveData={priority:pri};fromRemote||(gdata.saveChanges(this,saveData),saveData=g.clone(saveData));var saveFlags=fromRemote?SaveFlag.None:SaveFlag.Text;this.save(saveData,saveFlags)}Dispatcher.fireEvent("itemStateChanged",[this]),tracker.performAction(TrackerType.Update,{itemID:this.id,field:"priority",newValue:pri,oldValue:oldPriority})}},isScheduled:function isScheduledFn(){return!!this._date||!!this._repeatDate
},date:function dateFn(date,fromRemote){if(void 0!==date){try{g.PAssert(2923,!date||date instanceof Date,"Must pass in a valid date object")}catch(PERR){g.reportError(PERR)}if(date!==this._date){null===date&&(date=void 0);try{g.PAssert(2924,void 0===date||!isNaN(date.getTime()),"Must be setting a valid date")}catch(PERR){g.reportError(PERR)}this._date=date,g.timeline.updateNotifications(this),Dispatcher.fireEvent("itemStateChanged",[this]),fromRemote||tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ChangeDate,data:[{itemID:this.id,date:date}]})}}return this._date},repeatDate:function repeatDateFn(rDate,fromRemote){if(void 0!==rDate){try{g.PAssert(2925,!rDate||rDate instanceof RepeatDate,"Must pass in a valid repeat date object")}catch(PERR){g.reportError(PERR)}rDate!==this._repeatDate&&(null===rDate&&(rDate=void 0),this._repeatDate=rDate,!rDate&&this.dateCompleted&&this.dateCompleted.getTime()!==forceCompleteDate.getTime()&&this.isComplete(!1,fromRemote),g.timeline.updateNotifications(this),Dispatcher.fireEvent("itemStateChanged",[this]),fromRemote||tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ChangeDate,data:[{itemID:this.id,date:rDate}]}))}return this._repeatDate},allDayDate:function allDayDateFn(){return this._date?!this._date.hasTimeOfDay():this.repeatDate()?!this.repeatDate().hasTimeOfDay():!1},_isFlagHelper:function _isFlagHelperFn(flag,value){if(void 0!==value){var newFlags=value?this.flags.get()|flag:this.flags.get()&~flag;return void this.setFlags(newFlags)}return!!(this.flags.get()&flag)},isDeleted:function isDeletedFn(value,changeType){if(void 0!==value){try{g.PAssert(2926,g.isValidChangeType(changeType),"Must supply a valid changetype to delete an item: "+changeType)}catch(PERR){g.reportError(PERR)}if(this._isDeleted=value,this._attachments)for(var tAttach=this._attachments(),i=0;i<tAttach.length;++i)value?(tAttach[i].unsubscribe(this),this.shouldSave()&&tAttach[i].markUnused(changeType)):(tAttach[i].subscribe(this),this.shouldSave()&&tAttach[i].markInUse(changeType))}return this._isDeleted},isImportant:function isImportantFn(){return this._getPriority()},forceComplete:function forceCompleteFn(value,fromRemote){return this.isComplete(value,fromRemote,!0)},_completeChildrenHelper:function _completeChildrenHelperFn(value){this._isFlagHelper(VMLIFlag.DisplayComplete,value);for(var i=0;i<this.numItems();i++){var item=this.itemAtIndex(i);item._completeChildrenHelper(value)}},_hideChildrenHelper:function _hideChildrenHelperFn(value){for(var i=0;i<this.numItems();i++){var item=this.itemAtIndex(i);item._hideChildrenHelper(value)}},isComplete:function isCompleteFn(value,fromRemote,force){if(void 0===value)return this._isFlagHelper(VMLIFlag.Complete)&&(!this.repeatDate()||this.dateCompleted&&this.dateCompleted.getTime()===forceCompleteDate.getTime());var saveData={isComplete:value},propChanges=PropChangeType.Complete;if(value!==this._isFlagHelper(VMLIFlag.Complete)||this.repeatDate()){if(value){if(this.repeatDate()){try{g.PAssert(2927,!this.dateCompleted||this.dateCompleted.getTime()!==forceCompleteDate.getTime(),"If the passed in value is true then the repeated date should never be forced")}catch(PERR){g.reportError(PERR)}if(force)this.dateCompleted=forceCompleteDate;else{var nextComplete=this.repeatDate().nextComplete(this.dateCompleted),nextActive=this.repeatDate().nextActive(this.dateCompleted);if(nextActive){if(this.dateCompleted=nextActive,!fromRemote){tracker.beginAction();var newText=this.getParsedText().replace(this.dateText,nextComplete.toString(Date.CultureInfo.formatPatterns.shortDate)),completedItem=d.createVMLI({text:newText,isComplete:!0,dateCompleted:Date.now()},{parent:this.parent(),changeType:ChangeType.AllLocal});this.parent().insertItem(completedItem,this.getIndex()),this.repeatDate().setStartDate(nextActive),saveData.repeatDate=this.repeatDate().toString(),Dispatcher.fireEvent("itemStateChanged",[this]);var Sel=require("Sel");Sel.selectItem(this,0,0),tracker.endAction()}}else this.dateCompleted=forceCompleteDate,force=!0}saveData.dateCompleted=this.getDateCompletedTime(),g.vmMain.addParseItem(this,(fromRemote?ChangeType.Remote:ChangeType.Local)|ChangeType.Property)}else this.dateCompleted||(this.dateCompleted=new Date,saveData.dateCompleted=this.getDateCompletedTime());g.vmMain.isLoaded&&g.aggregateEvent("ItemCompleted")}else this.dateCompleted=void 0,saveData.dateCompleted=void 0,force=!0;if(this.shouldSave()){fromRemote||(gdata.saveChanges(this,saveData),saveData=g.clone(saveData));var saveFlags=fromRemote?SaveFlag.None:SaveFlag.Text;this.save(saveData,saveFlags)}this.repeatDate()&&(propChanges|=PropChangeType.Date),tracker.performAction(TrackerType.Update,{itemID:this.id,field:"isComplete",newValue:value,oldValue:!value})}(force||!this.repeatDate())&&(this._isFlagHelper(VMLIFlag.Complete,value),this._completeChildrenHelper(value),Dispatcher.fireEvent("itemCompleteChanged",[this]),Dispatcher.fireEvent("itemStateChanged",[this]))},isStarred:function isStarredFn(value,fromRemote){if(void 0===value)return this._isFlagHelper(VMLIFlag.Starred);if(value!==this._isFlagHelper(VMLIFlag.Starred)){var origFlags=this.flags.get();value&&origFlags&VMLIFlag.Complete&&(origFlags=origFlags&~VMLIFlag.Complete&~VMLIFlag.DisplayComplete);var newFlags=value?origFlags|VMLIFlag.Starred:origFlags&~VMLIFlag.Starred;this.setFlags(newFlags);var saveData={isStarred:value};if(android.isEnabled()&&android.isCurrentVMLI(this)&&android.notifyStarred(value),this.shouldSave()){fromRemote||(gdata.saveChanges(this,saveData),saveData=g.clone(saveData));var saveFlags=fromRemote?SaveFlag.None:SaveFlag.Text;this.save(saveData,saveFlags)}Dispatcher.fireEvent("itemStateChanged",[this]),tracker.performAction(TrackerType.Update,{itemID:this.id,field:"isStarred",newValue:value,oldValue:!value})}},isHeader:function isHeaderFn(){if(this.isNote())return!1;var value=this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData;return value},hasHeaderChildren:function hasHeaderChildrenFn(){if(this.isNote())return!1;for(var items=this.getItems(),i=0;i<items.length;i++)if(items[i].isHeader())return!0;return!1},isCollapsed:function isCollapsedFn(pane,outline){try{g.PAssert(2928,pane,"Must specify the pane for the item being checked for collapsed")}catch(PERR){g.reportError(PERR)}if(!pane)return!1;var state=pane.getPerPaneState(this.id,pane.isSearched()?PerPaneStateField.CollapsedSearch:outline?PerPaneStateField.CollapsedOutline:PerPaneStateField.Collapsed);return void 0===state&&this.isDemandLoad()?0===this.numItems()?!0:!pane.isSearched()&&!outline:!!state},setCollapsed:function setCollapsedFn(value,pane,outline){try{g.PAssert(2929,pane,"Must specify the pane for the item being checked for collapsed")}catch(PERR){g.reportError(PERR)}if(!pane)return!1;var oldValue=this.isCollapsed(pane,outline);return void 0!==value&&(!value||this.isCollapsible())&&(pane.setPerPaneState(this.id,pane.isSearched()?PerPaneStateField.CollapsedSearch:outline?PerPaneStateField.CollapsedOutline:PerPaneStateField.Collapsed,value),g.vmMain.paneManager.updatePaneStateForPane(pane),this._isFlagHelper(VMLIFlag.Collapsed,value),this.shouldSave()&&this.save({isCollapsed:value},SaveFlag.Text),this.isDemandLoad()&&this.notifyDemandLoadUpdate(!value,g.focusedPane),Dispatcher.fireEvent("itemCollapsedChanged",[this])),pane?pane.getPerPaneState(this.id,outline?PerPaneStateField.CollapsedOutline:PerPaneStateField.Collapsed):!1},toggleCollapsed:function toggleCollapsedFn(pane){try{g.PAssert(2930,pane,"Must specify the pane that this item is being collapsed in")}catch(PERR){g.reportError(PERR)}this.setCollapsed(!this.isCollapsed(pane,!1),pane,!1)},isCollapsible:function isCollapsibleFn(){return!this.isNote()&&(this.numItems()>0||this._demandLoadChildren&&!this._loadedOnDemandData)},isDraggable:function isDraggableFn(){return!this.isNote()&&!this.hasPluginAttachment(PluginID.GCalendar)},setTags:function setTagsFn(newTags){for(var i=0;this._activeTags&&i<this._activeTags.length;++i)d.tagManager.notifyRemoved(this._activeTags[i]);for(var i=0;newTags&&i<newTags.length;++i)d.tagManager.notifyAdded(newTags[i]);this._activeTags=newTags},isSelected:function isSelectedFn(value){return this._isFlagHelper(VMLIFlag.Selected,value)},isMultiline:function isMultilineFn(value){return this._isFlagHelper(VMLIFlag.Multiline,value)},isHighlighted:function isHighlightedFn(value){return this._isFlagHelper(VMLIFlag.Highlighted,value)},isNumList:function isNumListFn(value){return this._isFlagHelper(VMLIFlag.NumList,value)},hasCompletedAncestor:function hasCompletedAncestorFn(){for(var parent=this.parent();parent;){if(parent.isComplete())return!0;parent=parent.parent()}},hasTime:function hasTimeFn(){return this.date()?this.date().hasTimeOfDay():this.repeatDate()?this.repeatDate().hasTimeOfDay():!!this.dateCompleted},getTimeOfDay:function getTimeOfDayFn(){return this.date()?this.date().getTimeOfDay():this.repeatDate()?this.repeatDate().getTimeOfDay():this.dateCompleted?this.dateCompleted.getTimeOfDay():0},time:function timeFn(){var timeString="";return this.date()?timeString=this.date().hasTimeOfDay()?this.date().toString(International.getFormat(DFormat.ShortTime)):"Any Time":this.repeatDate()?timeString=this.repeatDate().hasTimeOfDay()?this.repeatDate().getTime(International.getFormat(DFormat.ShortTime)):"Any Time":this.dateCompleted&&(timeString=this.dateCompleted.toString(International.getFormat(DFormat.ShortTime))),timeString},createDateString:function createDateStringFn(dt){return dt.toString(dt.isBefore(Date.today().addWeeks(1))?International.getFormat(DFormat.LongDayTime):International.getFormat(DFormat.ShortDayTime))},fullTime:function fullTimeFn(){var date=this.date();return date?void this.createDateString(date):""},isVersionUninitialized:function isVersionUninitializedFn(type){var v;switch(type){case VersionType.Structure:v=this._version;break;case VersionType.Text:v=this._versionText;break;default:v=-2;try{g.PAssert(2931,!1,"Invalid version type")}catch(PERR){g.reportError(PERR)}}return(v?v:0)===window.UninitializedVersion},setVersion:function setVersionFn(type,v){var verStr;switch(type){case VersionType.Structure:this._version=v;break;case VersionType.Text:this._versionText=v;break;default:try{g.PAssert(2932,!1,"Invalid version type")}catch(PERR){g.reportError(PERR)}}},getVersion:function getVersionFn(type){var v;switch(type){case VersionType.Structure:v=this._version;break;case VersionType.Text:v=this._versionText;break;default:v=-2;try{g.PAssert(2933,!1,"Invalid version type")}catch(PERR){g.reportError(PERR)}}return v?v:0},setRemoteVersion:function setRemoteVersionFn(type,v){var verStr;switch(type){case VersionType.Structure:this._versionRemote=v;break;case VersionType.Text:this._versionRemoteText=v;break;default:try{g.PAssert(2934,!1,"Invalid version type")}catch(PERR){g.reportError(PERR)}}},getRemoteVersion:function getRemoteVersionFn(type){var v;switch(type){case VersionType.Structure:v=this._versionRemote;break;case VersionType.Text:v=this._versionRemoteText;break;default:v=-2;try{g.PAssert(2935,!1,"Invalid version type")}catch(PERR){g.reportError(PERR)}}return v?v:0},isLocalVersionNewer:function isLocalVersionNewerFn(type){return this.getVersion(type)==this.getRemoteVersion(type)},isRemoteVersionNewer:function isRemoteVersionNewerFn(type){return!this.isLocalVersionNewer(type)},init:function initFn(p,extraInfo){this._shouldSave=!(extraInfo&&extraInfo.noSave);try{g.PAssert(2936,!this._shouldSave||!this._demandLoadChildren,"Should never be saving results of demand loaded items")}catch(PERR){g.reportError(PERR)}if(p.data){try{g.PAssert(2937,this._shouldSave,"Should never be loading from remote with item that doesnt save")}catch(PERR){g.reportError(PERR)}var verStructure=gdata.getVersion(p.data,VersionType.Structure),verText=gdata.getVersion(p.data,VersionType.Text);this.setRemoteVersion(VersionType.Structure,verStructure),this.setRemoteVersion(VersionType.Text,verText),tracker.beginAction(),this.initFromGDrive(p.data),tracker.endAction(),this.setRemoteVersion(VersionType.Structure,void 0),this.setRemoteVersion(VersionType.Text,void 0)}else{if(this.setVersion(VersionType.Structure,p.version),this.setVersion(VersionType.Text,p.versionText),this.modifiedOffline=p.modifiedOffline,this.modifiedOfflineText=p.modifiedOfflineText,this.modifiedOffline,this.modifiedOfflineText,g.vmMain.isLoaded&&this._shouldSave&&gdata.isConnected()&&p.id!==d.rootId?d.initializeItem(this):this.id=p.id||g.generateTempId(),p.date){var newDate=new Date(p.date);this.date(newDate)}if(p.repeatDate){var newRepeatDate=new RepeatDate(p.repeatDate);newRepeatDate.isValid()?this.repeatDate(newRepeatDate):g.reportError(new Error("Initial invalid repeat date: "+p.repeatDate))}p.dateCompleted&&(this.dateCompleted=new Date(p.dateCompleted)),(p.items&&p.items.length>0||p.note)&&this.updateItems(p.items,p.note,extraInfo.changeType)}if(!this.isArchived()||g.vmMain.hasDisplayedArchivedItems()){try{g.PAssert(2938,extraInfo,"Currently we have required properties in extraInfo")}catch(PERR){g.reportError(PERR)}var changeType=extraInfo?extraInfo.changeType:ChangeType.Auto;try{g.PAssert(2939,g.isValidChangeType(changeType),"Must supply a valid changetype to VMLIs")}catch(PERR){g.reportError(PERR)}this.parseText(!0,extraInfo.changeType)}this._shouldSave&&extraInfo&&extraInfo.changeType!==ChangeType.Auto&&(this.save(void 0,SaveFlag.Prop),(this.date()||this.repeatDate())&&gdata.saveChanges(this,this.getMetaTextSaveData()),this.isComplete()&&gdata.saveChanges(this,{isComplete:this.isComplete()})),g.vmMain.isLoaded&&g.aggregateEvent("ItemCreated"),d.setModel(this)},onLoad:function onLoadFn(pane){this.isLoaded||(!this.isDemandLoad()||this.isCollapsed(pane,!1)||pane.isSearched()||this.notifyDemandLoadUpdate(!0,pane),this.isLoaded=!0)},destroy:function destroyFn(){try{g.PAssert(2940,this._canDestroy,"VMLI must be explicitly marked as destroyable")}catch(PERR){g.reportError(PERR)}util.destroy(this)},getACText:function getACTextFn(){return android.isEnabled()&&android.isCurrentVMLI(this)?android.getInputText():this.getParsedText()},resetDriveData:function resetDriveDataFn(){this._versionRemote=void 0,this._versionRemoteText=void 0,this.data=void 0},isFullscreen:function isFullscreenFn(){return g.focusedItem===this},findItem:function findItemFn(item){var found=this.getIndexOf(item.id,!1);return found>=0?{index:found,arr:this.getItems(),isArchived:!1}:this.hasArchivedChildren()&&(found=this.getIndexOf(item.id,!0),found>=0)?{index:found,arr:this.archivedItems(!0),isArchived:!0}:void 0},updateItems:function updateItemsFn(newItems,note,changeType){var itemsModified=!1,archivedItemsModified=!1;if(newItems&&newItems.length>0){var collabItemList,collabArchivedItemList;this.data&&(collabItemList=gdata.get(this.data,"items"),collabArchivedItemList=gdata.get(this.data,"archivedItems"));try{g.PAssert(2943,!this.hasChildren(),"Update items should only be called from initialize when there are no items already loaded")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2944,!this.hasArchivedChildren(),"Update items should only be called from initialize when there are no items already loaded")}catch(PERR){g.reportError(PERR)}for(var i=0;i<newItems.length;++i){var item=newItems[i],itemVM=void 0;if(item instanceof VMLI?itemVM=item:g.isString(item)&&(itemVM=d.getModel(item)),itemVM){var oldParentInfo=d.getItem(itemVM.parent().id);if(oldParentInfo){var oldParentIndex=oldParentInfo.items.indexOf(itemVM.id);try{g.PAssert(2947,-1===oldParentIndex,"Expect that the old parent has been notified")}catch(PERR){g.reportError(PERR)}var childModelIndex=itemVM.getIndex();childModelIndex>-1&&itemVM.parent().removeChildAtIndex(childModelIndex)}itemVM.parent(this)}else if("object"!=typeof item){var itemInfo=d.getItem(item);try{g.PAssert(2945,itemInfo,"Referenced item doesn't exist",item)}catch(PERR){g.reportError(PERR)}itemInfo&&(itemVM=d.createVMLI(itemInfo,{parent:this,changeType:changeType}))}else{try{g.PAssert(2946,item,"Item must exist otherwise we arent creating anything")}catch(PERR){g.reportError(PERR)}item&&(itemVM=d.createVMLI(item,{parent:this,changeType:changeType}))}try{g.PAssert(2948,itemVM,"There must be a model at this point")}catch(PERR){g.reportError(PERR)}itemVM&&(itemVM.isArchived()?(archivedItemsModified=!0,this.archivedItems(!0).push(itemVM),!collabArchivedItemList&&this.data&&(collabArchivedItemList=gdata.ensureItemList(this,!0)),collabArchivedItemList&&collabArchivedItemList.push(itemVM.data)):(itemsModified=!0,this.items.push(itemVM),!collabItemList&&this.data&&(collabItemList=gdata.ensureItemList(this,!1)),collabItemList&&collabItemList.push(itemVM.data)))}}if(note){try{g.PAssert(2949,!this._note,"Must not already have a valid note set")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2950,g.isString(note),"Note must be a valid ID")}catch(PERR){g.reportError(PERR)}var noteVM=d.getModel(note);if(!noteVM){var itemInfo=d.getItem(note);try{g.PAssert(2951,itemInfo,"Referenced note doesn't exist",note)}catch(PERR){g.reportError(PERR)}itemInfo&&(itemInfo.isNote=!0,noteVM=d.createVMLI(itemInfo,{parent:this,changeType:changeType}))}try{g.PAssert(2952,noteVM,"Must have a valid note VM at this point")}catch(PERR){g.reportError(PERR)}this._note=noteVM,itemsModified=!0}itemsModified&&this.itemsHasMutated(),archivedItemsModified&&this.archivedItems().notify()},insertItem:function insertItemFn(item,index,underlying,force){try{g.PAssert(2953,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2954,item,"Must specify a valid item to be inserted")}catch(PERR){g.reportError(PERR)}isNaN(index)?this.items.push(item):this.items.splice(index,0,item),this.shouldSave()&&d.insertItems(this,[item],index)},insertSorted:function insertSortedFn(item,sortFn,force){try{g.PAssert(2955,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2956,item,"Must specify a valid item to be inserted")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2957,sortFn,"Must supply a valid comparator")}catch(PERR){g.reportError(PERR)}var index=this.items.insertSorted(item,sortFn);this.shouldSave()&&d.insertItems(this,[item],index)},moveTo:function moveToFn(params){var parent=params.parent,index=params.index,isRemoteChange=params.isRemoteChange,shouldBeArchived=params.shouldBeArchived,noVersion=params.noVersion,underlying=params.underlying,fromTab=params.fromTab;try{g.PAssert(2958,parent instanceof VMLI,"New parent must be a valid VMLI")}catch(PERR){g.reportError(PERR)}void 0===index&&(index=-1),void 0===isRemoteChange&&(isRemoteChange=!1),void 0===shouldBeArchived&&(shouldBeArchived=!1);var oldParent=this.parent(),oldInfo=oldParent.findItem(this);if(oldInfo){var dstLocalIndex=index,dstRemoteIndex=index;if(oldParent===parent){if(oldInfo.index===dstLocalIndex)return;oldInfo.index<dstLocalIndex&&dstLocalIndex--}oldInfo.arr.splice(oldInfo.index,1),this.parent(parent);var arr=shouldBeArchived?parent.archivedItems():parent.items;if(0>dstLocalIndex?arr.push(this,!1):arr.splice(dstLocalIndex,0,this,!1),this.shouldSave()){var newInfo={index:dstRemoteIndex,isArchived:shouldBeArchived};d.moveItem({item:this,newInfo:newInfo,oldParent:oldParent,oldInfo:oldInfo,isRemoteChange:isRemoteChange,noVersion:noVersion})}g.vmMain.updateAllItems(!0)}},getItemsArrayForSave:function getItemsArrayForSaveFn(){try{g.PAssert(2959,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}for(var saveItems=[],items=this.getItems(),i=0;i<items.length;++i)saveItems.push(items[i].id);if(this.hasArchivedChildren())for(var archivedItems=this.archivedItems(!0),i=0;i<archivedItems.length;++i)saveItems.push(archivedItems[i].id);return saveItems},getDateTime:function getDateTimeFn(){return this.date()?this.date().getTime():void 0},getRepeatDate:function getRepeatDateFn(){return this.repeatDate()?this.repeatDate().toString():void 0},getDateCompletedTime:function getDateCompletedTimeFn(){return this.dateCompleted?this.dateCompleted.getTime():void 0},isForceCompleted:function isForceCompletedFn(){return this.dateCompleted&&this.dateCompleted.equals(forceCompleteDate)?!0:!1},getMetaTextSaveData:function getMetaTextSaveDataFn(){var currentDate=this.date(),repeatDate=this.repeatDate(),numDate,numRepeatDate;return void 0!==currentDate&&(numDate=currentDate.getTime()),void 0!==repeatDate&&(numRepeatDate=repeatDate.toString()),{date:numDate,repeatDate:numRepeatDate,dateCompleted:this.getDateCompletedTime()}},_generateNotificationEntry:function _generateNotificationEntryFn(date){var dateJSON=date.toJSON(),alertDateJSON;return alertDateJSON=date.hasTimeOfDay()?new Date(date).addMinutes(-30).toJSON():new Date(date).addDays(-1).setHours(17).toJSON(),{id:this.id,text:this.getParsedText(),date:dateJSON,alertDate:alertDateJSON}},getNotificationEntries:function getNotificationEntriesFn(){try{g.PAssert(2960,this.date()||this.repeatDate(),"Must have a valid date")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2961,!this.allDayDate(),"All day dates should not be scheduled")}catch(PERR){g.reportError(PERR)}if(this.allDayDate())return void 0;if(this.date())return this._generateNotificationEntry(this.date());if(this.repeatDate()){for(var entries=[],dates=this.repeatDate().getDates(!0),i=0;i<dates.length;++i)entries.push(this._generateNotificationEntry(dates[i]));return entries}},getDebugData:function getDebugDataFn(){var data={id:this.id,parent:this._parent?this._parent.id:void 0,items:this.isNote()?void 0:this.getItemsArrayForSave(),text:this.getRawText(),note:this.hasNote()?this.getNote().id:void 0,isNote:this.isNote(),isArchived:this.isArchived(),isDeleted:this.isDeleted(),version:this.getVersion(VersionType.Structure),versionText:this.getVersion(VersionType.Text),modifiedOffline:this.modifiedOffline,modifiedOfflineText:this.modifiedOfflineText};return data},getFullSaveData:function getFullSaveDataFn(){try{g.PAssert(2962,this.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}var data={id:this.id,text:this.getRawText(),date:this.getDateTime(),repeatDate:this.getRepeatDate(),dateText:this.dateText,dateCreated:this.dateCreated.getTime(),dateCompleted:this.getDateCompletedTime(),priority:this._getPriority()||void 0,isComplete:this.isComplete()||void 0,isStarred:this.isStarred()||void 0,note:this.hasNote()?this.getNote().id:void 0,isArchived:this.isArchived()||void 0,isNote:this.isNote()||void 0,isDeleted:void 0,version:this.getVersion(VersionType.Structure),versionText:this.getVersion(VersionType.Text),modifiedOffline:this.modifiedOffline,modifiedOfflineText:this.modifiedOfflineText};return this.isNote()||(data.items=this.getItemsArrayForSave()),data},save:function saveFn(changes,saveFlags){try{g.PAssert(2963,this.shouldSave(),"Item must be marked as saveable")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2964,void 0!==saveFlags,"Must specify saveFlags for the changes that are being saved")}catch(PERR){g.reportError(PERR)}if(changes){var existingItem=d.getItem(this.id);existingItem||changes.id?(changes.items&&(changes.items=this.getItemsArrayForSave()),void 0!==changes.text&&Dispatcher.fireEvent("itemTextChanged",[{item:this,force:saveFlags===SaveFlag.None}])):changes=this.getFullSaveData()}else changes=this.getFullSaveData();d.saveChanges(this,changes,saveFlags)},highlight:function highlightFn(){var self=this;this.highlightTimeout?(this.isHighlighted(!1),clearTimeout(this.highlightTimeout),this.highlightTimeout=void 0,setTimeout(function(){self.isHighlighted(!0)},0)):this.isHighlighted(!0),this.highlightTimeout=setTimeout(function(){self.isHighlighted(!1)},2e3)},getElement:function getElementFn(paneID){return void 0},getSpan:function getSpanFn(paneID){return void 0},getOutlineElement:function getOutlineElementFn(paneID){return void 0},removeChild:function removeChildFn(child){try{g.PAssert(2967,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2968,!child.isNote(),"Do not use remove child to remove notes from items")}catch(PERR){g.reportError(PERR)}var removedIndex;if(child.isArchived()){try{g.PAssert(2971,this.hasArchivedChildren(),"For a child to be archived, this item must have valid archived children")}catch(PERR){g.reportError(PERR)}if(this.hasArchivedChildren()){if(removedIndex=this.archivedItems(!0).remove(child),removedIndex>=0)this.shouldSave()&&d.removeItem(this,removedIndex,child,!0);else{try{g.PAssert(2972,!1,"Archived child not found in parent")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2973,this===child.parent(),"Parent of archived child is not set to this item, should not remove: "+child.parent())}catch(PERR){g.reportError(PERR)}}this.archivedItems().notify()}}else if(removedIndex=this.items.remove(child),removedIndex>=0)this.shouldSave()&&d.removeItem(this,removedIndex,child,!1);else{try{g.PAssert(2969,!1,"Child not found in parent")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2970,this===child.parent(),"Parent of child is not set to this item, should not remove: "+child.parent())}catch(PERR){g.reportError(PERR)}}return removedIndex},removeChildAtIndex:function removeChildAtIndexFn(index){try{g.PAssert(2974,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2975,!this.itemAtIndex(index).isArchived())}catch(PERR){g.reportError(PERR)}var removed=this.items.removeAt(index);return this.shouldSave()&&d.removeItem(this,index,removed,!1),removed},archiveChild:function archiveChildFn(child){try{g.PAssert(2976,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2977,!child.isNote(),"Do not use archive child on notes")}catch(PERR){g.reportError(PERR)}var retVal=!1;if(!child.isArchived()){tracker.beginAction(),child.isArchived(!0),this.archivedItems().push(child);var removedIndex=this.items.remove(child);this.shouldSave()&&d.archiveItem(this,removedIndex,child),tracker.endAction(),retVal=!0}return retVal},unarchiveChild:function unarchiveChildFn(child){try{g.PAssert(2978,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2979,!child.isNote(),"Do not use unarchive child on notes")}catch(PERR){g.reportError(PERR)}var retVal=!1;if(child.isArchived()){tracker.beginAction();try{g.PAssert(2980,child.isArchived(),"Child must be archived to be unarchived")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2981,this.hasArchivedChildren(),"Parent must have archived children to unarchive a child")}catch(PERR){g.reportError(PERR)}child.isArchived(!1);var removedIndex=this.archivedItems(!0).remove(child);this.items.push(child),this.shouldSave()&&d.unarchiveItem(this,removedIndex,child),this.archivedItems().notify(),tracker.endAction(),retVal=!0}return retVal},_moveChildrenHelper:function _moveChildrenHelperFn(params){var newParent=params.newParent,index=params.index,isArchived=params.isArchived;try{g.PAssert(2982,void 0!==newParent&&void 0!==isArchived,"_moveChildrenHelper is missing parameters")}catch(PERR){g.reportError(PERR)}var oldItems=isArchived?this.archivedItems(!0):this.getItems(),children=oldItems;if(children.length>0){var newItems=isArchived?newParent.archivedItems(!0):newParent.getItems();!isArchived&&(isNaN(index)||0>index)&&(index=newItems.length);for(var i=0;children.length>0;){try{g.PAssert(2983,children[i]!==newParent,"Should never be reparenting to a child")}catch(PERR){g.reportError(PERR)}var id=children[0];children[0].moveTo({parent:newParent,index:index+i,shouldBeArchived:isArchived,underlying:!0}),tracker.performAction(TrackerType.Move,{itemID:id,oldParent:this.id,oldPosition:i,newParent:newParent.id,newPosition:index+i}),i++}}},moveChildren:function moveChildrenFn(newParent,index,changeType){try{g.PAssert(2984,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2985,this.id!==newParent.id,"Do not use moveChildren to move a child to the same parent")}catch(PERR){g.reportError(PERR)}if(newParent.parent()===this){var oldIndex=this.removeChild(newParent);tracker.performAction(TrackerType.Delete,{itemID:newParent.id,parent:this.id,position:oldIndex})}this._moveChildrenHelper({newParent:newParent,index:index,isArchived:!1}),this._moveChildrenHelper({newParent:newParent,index:index,isArchived:!0})},deleteSelf:function deleteSelfFn(changeType){this.parent().deleteChild(this,void 0,void 0,changeType||ChangeType.Local),this.parent(void 0)},deleteChild:function deleteChildFn(child,newParent,newIndex,changeType){try{g.PAssert(2986,child,"Must provide a valid child to delete")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2987,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}if(tracker.beginAction(),child.isNote())this.setNote(void 0);else if(child.hasChildren()||child.hasArchivedChildren())if(newParent)child.moveChildren(newParent,newIndex,changeType);else for(var childItems=child.getItems(),i=childItems.length-1;i>=0;i--)child.deleteChild(childItems[i],void 0,void 0,changeType);if(!child.isDeleted()){if(!child.isNote()){var oldIndex=this.removeChild(child);tracker.performAction(TrackerType.Delete,{itemID:child.id,parent:this.id,position:oldIndex})}d.deleteItem(child,changeType)}Dispatcher.fireEvent("itemStateChanged",[this]),tracker.endAction()},replaceChild:function replaceChildFn(oldChild,newChild,changeType){try{g.PAssert(2988,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2989,!oldChild.isNote(),"Old child should not be a note")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2990,!newChild.isNote(),"New child should not be a note")}catch(PERR){g.reportError(PERR)}var index=oldChild.getIndex();this.items.removeAt(index),tracker.performAction(TrackerType.Delete,{itemID:oldChild.id,parent:this.id,position:index}),d.deleteItem(oldChild,changeType),newChild.moveTo({parent:this,index:index}),d.removeItem(this,index+1,oldChild,!1),oldChild.moveChildren(newChild,newChild.numChildren());var newChildOldParentID=newChild.parent().id;if(newChildOldParentID!==this.id){var newChildOldIndex=newChild.parent().items.remove(newChild);tracker.performAction(TrackerType.Move,{itemID:newChild.id,oldParent:newChildOldParentID,oldPosition:newChildOldIndex,newParent:this.id,newPosition:index})}},getChildren:function getChildrenFn(){return this.isNote()?void 0:this.hasNote()?[this.getNote()].concat(this.getItems()):this.getItems()},getChild:function getChildFn(index){try{g.PAssert(2991,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2992,index<this.numItems())}catch(PERR){g.reportError(PERR)}return this.itemAtIndex(index)},getFirstChild:function getFirstChildFn(){try{g.PAssert(2993,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}return this.hasChildren()?this.itemAtIndex(0):void 0},isFirstChild:function isFirstChildFn(){try{g.PAssert(2994,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}return this.parent()?this.parent().getFirstChild()===this:!1},getLastChild:function getLastChildFn(){try{g.PAssert(2995,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}return this.hasChildren()?this.itemAtIndex(this.numItems()-1):void 0},isLastChild:function isLastChildFn(){try{g.PAssert(2996,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}return this.parent()?this.parent().getLastChild()===this:!1},isDescendantOf:function isDescendantOfFn(ancestor){for(var check=this.parent();check&&check!==ancestor;)check=check.parent();return void 0!==check},getChildIndex:function getChildIndexFn(child){try{g.PAssert(2997,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(2998,!child.isNote(),"Should not get the index of an item note")}catch(PERR){g.reportError(PERR)}return this.getIndexOf(child.id,child.isArchived())},getIndexOf:function getIndexOfFn(id,isArchived){try{g.PAssert(2999,!this.isNote(),"Notes cannot use this function")
}catch(PERR){g.reportError(PERR)}try{g.PAssert(3e3,g.isString(id),"ID must be a valid string: "+g.getObjectInfo(id))}catch(PERR){g.reportError(PERR)}var index=-1,arr;if(isArchived?this.hasArchivedChildren()&&(arr=this.archivedItems(!0)):arr=this.getItems(),arr)for(var i=0;i<arr.length;++i)if(arr[i].id===id){index=i;break}return index},getRemoteIndexOf:function getRemoteIndexOfFn(item,isArchived){try{g.PAssert(3001,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3002,!item.isNote(),"Should never be getting a remote child index of a note")}catch(PERR){g.reportError(PERR)}var remoteList=gdata.getItemList(this.data,isArchived),index=-1;return remoteList&&(index=remoteList.indexOf(item)),index},getIndex:function getIndexFn(){try{g.PAssert(3004,!this.isNote(),"Should never be getting a child index of a note")}catch(PERR){g.reportError(PERR)}return this.parent().getChildIndex(this)},hasChildren:function hasChildrenFn(){return this.isNote()?!1:this.numItems()>0},numChildren:function numChildrenFn(){try{g.PAssert(3005,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}return this.numItems()},canZoom:function canZoomFn(){return this.isNote()?!1:this.numChildren()>0||this.getParsedText().length>0},parents:function parentsFn(){for(var parents=[],parent=this;parent;)parents.splice(0,0,parent),parent=parent.parent();return parents},getSiblings:function getSiblingsFn(startIndex){try{g.PAssert(3006,!this.isNote(),"Notes cannot use this function")}catch(PERR){g.reportError(PERR)}startIndex=startIndex||0;var arr=[];if(this.parent())for(var items=this.parent().getItems(),i=startIndex,_l=items.length;_l>i;i++)items[i]!==this&&arr.push(items[i]);return arr},nextSibling:function nextSiblingFn(){var index=this.getIndex(),parentItems=this.parent().getItems(),next=parentItems[index+1];return next},isRootItem:function isRootItemFn(){var itemStore=this.getItemStore();return itemStore.isRoot(this)},isPaneRoot:function isPaneRootFn(context){if(context)for(var i=context.$parents.length-1;i>=0;i--)if(context.$parents[i]instanceof g.VMPane)return this===context.$parents[i].getItem()},clone:function cloneFn(parent,changeType){for(var itemStore=parent.getItemStore(),clonedItem=itemStore.createItemRaw({text:this.getRawText(),isComplete:this.isComplete()},{parent:parent,changeType:changeType}),i=0;i<this.numItems();++i){var childItem=this.itemAtIndex(i).clone(clonedItem,changeType);clonedItem.insertItem(childItem)}return clonedItem},getItems:function getItemsFn(){return this.items.get()},itemAtIndex:function itemAtIndexFn(index){return this.items.get()[index]},numItems:function numItemsFn(){return this.items.get().length},itemsHasMutated:function itemsHasMutatedFn(){g.vmMain.updateAllItems()},numChildrenRecursive:function numChildrenRecursiveFn(){var num=0,options={item:this};return options.each=function(item){num++},g.searchVMLIs(options),num}},util.defineBase(VMLI),util.extend(VMLI.prototype,VMLI_TapHandlers),util.extend(VMLI.prototype,VMLI_Text),util.extend(VMLI.prototype,VMLI_Drive(VMLI)),VMLI}),define("edit",["globals","platform","data","android","VMLI","tracker","NativeSel","Sel","EditHelpers","Measure"],function(g,platform,d,android,VMLI,tracker,NativeSel,Sel,EditHelpers,Measure){function edit(){}var NavigationActions={None:0,Left:1,Right:2,StartLine:3,EndLine:4,LeftWord:5,RightWord:6,Down:7,Up:8,PageDown:9,PageUp:10,Top:11,Bottom:12,PrevHeader:13,NextHeader:14,All:15},keyCodesDown=[KeyCode.Tab,KeyCode.BackSpace,KeyCode.Delete],keyCodesArrows=[KeyCode.UpArrow,KeyCode.DownArrow,KeyCode.LeftArrow,KeyCode.RightArrow,KeyCode.Home,KeyCode.End,KeyCode.A,KeyCode.E,KeyCode.PageUp,KeyCode.PageDown],textSaveInfo={},tempInput,lastKeypress,StringNewLine=String.fromCharCode(10);return edit.prototype={getNavigationAction:function getNavigationActionFn(e){var mac=platform.mac,ctrl=e.ctrlKey&&!e.altKey&&!e.metaKey,alt=e.altKey&&!e.ctrlKey&&!e.metaKey,meta=e.metaKey&&!e.ctrlKey&&!e.altKey,none=!e.ctrlKey&&!e.altKey&&!e.metaKey,key=e.normCode,K=KeyCode,A=NavigationActions;if(key===K.LeftArrow){if(ctrl&&!platform.mac||alt&&platform.mac)return A.LeftWord;if(meta&&mac)return A.StartLine;if(none)return A.Left}if(key===K.RightArrow){if(ctrl&&!platform.mac||alt&&platform.mac)return A.RightWord;if(meta&&mac)return A.EndLine;if(none)return A.Right}if(key===K.UpArrow){if(mac&&meta)return A.Top;if(mac&&ctrl)return A.PageUp;if(mac&&alt)return A.StartLine;if(!mac&&ctrl)return A.PrevHeader;if(none)return A.Up}if(key===K.DownArrow){if(mac&&meta)return A.Bottom;if(mac&&ctrl)return A.PageDown;if(mac&&alt)return A.EndLine;if(!mac&&ctrl)return A.NextHeader;if(none)return A.Down}if(key===K.A&&ctrl&&mac)return A.StartLine;if(key===K.E&&ctrl&&mac)return A.EndLine;if(key===K.Home&&!mac){if(ctrl)return A.Top;if(none)return A.StartLine}if(key===K.End&&!mac){if(ctrl)return A.Bottom;if(none)return A.EndLine}return key===K.PageUp&&none?A.PageUp:key===K.PageDown&&none?A.PageDown:key===K.A&&meta&&mac||key===K.A&&ctrl&&!mac?A.All:A.None},updateAutocomplete:function updateAutocompleteFn(e){var fromArrows=e.normCode&&keyCodesArrows.indexOf(e.normCode)>=0;g.autocomplete&&(Sel.isValid()&&Sel.getStartItem()===Sel.getEndItem()&&Sel.getStartOffset()===Sel.getEndOffset()?g.autocomplete.update({owner:Sel.getStartItem(),index:Sel.getStartIndex(),start:Sel.getStartOffset(),fromArrows:fromArrows}):g.autocomplete.hide())},stopPropagation:function stopPropagationFn(e){try{g.PAssert(3007,e.stopImmediatePropagation,"Should always be defined")}catch(PERR){g.reportError(PERR)}e.stopImmediatePropagation&&e.stopImmediatePropagation()},preventDefault:function preventDefaultFn(e){try{g.PAssert(3008,e.preventDefault,"Should always be defined")}catch(PERR){g.reportError(PERR)}e.preventDefault&&e.preventDefault()},keyup:function keyupFn(element,e){var scrolled=!1;return textSaveInfo.item&&(tracker.beginAction(),void 0!==textSaveInfo.text&&(lastKeypress===KeyCode.BackSpace&&textSaveInfo.innerHTML&&(e.target.innerHTML=textSaveInfo.innerHTML),textSaveInfo.item.setText(textSaveInfo.text,!0,ChangeType.Local)),textSaveInfo.nextItem?Sel.selectItem(textSaveInfo.nextItem,0):Sel.selectItem(textSaveInfo.item,textSaveInfo.start),this.updateAutocomplete(e),scrolled=!0,tracker.endAction()),textSaveInfo.nextItem&&"enter"===textSaveInfo.waitAutocorrect&&(g.vmMain.setSelected([textSaveInfo.nextItem]),Sel.selectItem(textSaveInfo.nextItem,0)),textSaveInfo.item=void 0,textSaveInfo.nextItem=void 0,textSaveInfo.text=void 0,textSaveInfo.start=void 0,textSaveInfo.waitAutocorrect=void 0,textSaveInfo.innerHTML=void 0,platform.mobile&&!scrolled&&Sel.scrollStartIntoView(platform.ios),this.stopPropagation(e),this.preventDefault(e),e.handled?!0:void 0},handleSelectAll:function handleSelectAllFn(pane){return Sel.selectIndices(0,0,pane.numItems()-1,-1),!1},handleSelectAllItem:function handleSelectAllItemFn(){return Sel.selectIndex(Sel.getStartIndex(),0,-1),!1},_move:function _moveFn(direction,e){try{g.PAssert(3009,direction===Direction.Up||direction===Direction.Down,"Must move in a direction")}catch(PERR){g.reportError(PERR)}var firstItem=Sel.getStartItem(),lastItem=Sel.getEndItem(),ok=!1;if(firstItem.parent()===lastItem.parent()&&(ok=!0),!ok){var next=g.getNextItem(lastItem,g.focusedPane,{sameLevel:!0});if(!next)for(;lastItem;){if(firstItem.parent()===lastItem.parent()){ok=!0;break}lastItem=lastItem.parent()}}if(ok){var moveItem,index;if(direction===Direction.Up?(moveItem=g.getPreviousItem(firstItem,g.focusedPane,{sameLevel:!0}),index=lastItem.getIndex()+1):(moveItem=g.getNextItem(lastItem,g.focusedPane,{sameLevel:!0}),index=firstItem.getIndex()),moveItem){tracker.beginAction();var savedSelection=Sel.save();Sel.reset();var numMovedPast=1+moveItem.numChildrenRecursive();moveItem.moveTo({parent:moveItem.parent(),index:index}),direction===Direction.Up?(savedSelection.startIndex-=numMovedPast,savedSelection.endIndex-=numMovedPast):direction===Direction.Down&&(savedSelection.startIndex+=numMovedPast,savedSelection.endIndex+=numMovedPast),Sel.restore(savedSelection),direction===Direction.Up?Sel.scrollStartIntoView():Sel.scrollEndIntoView(),tracker.endAction()}}},moveUp:function moveUpFn(e){this._move(Direction.Up,e)},moveDown:function moveDownFn(e){this._move(Direction.Down,e)},handleArrows:function handleArrowsFn(element,e){var pane=g.focusedPane;if(!Sel.isValid())return!0;var action=this.getNavigationAction(e),A=NavigationActions;switch(action){case A.Left:case A.Right:case A.StartLine:case A.EndLine:case A.LeftWord:case A.RightWord:var item,text,isLeft=action===A.Left||action===A.LeftWord||action===A.StartLine,isRight=action===A.Right||action===A.RightWord||action===A.EndLine,offset,newIndex,newOffset,total;if(isLeft&&(!e.shiftKey||Sel.isArrowSelectInverted())||isRight&&e.shiftKey&&Sel.isArrowSelectInverted()||action===A.StartLine&&Sel.getStartIndex()===Sel.getEndIndex()?(offset=Sel.getStartOffset(),newIndex=Sel.getStartIndex(),total=Sel.getStartTotal(),item=Sel.getStartItem()):(offset=Sel.getEndOffset(),newIndex=Sel.getEndIndex(),total=Sel.getEndTotal(),item=Sel.getEndItem()),text=item.getParsedText(),action===A.StartLine){var caretPos=Measure.getCaretOffset(item,pane,offset,Sel.preferLineStart),line=caretPos.line;newOffset=line>0&&0===caretPos.lineOffset?0:Measure.getOffsetForPositionInLine(item,pane,line,0,0),newIndex=Sel.isArrowSelectInverted()?Sel.getStartIndex():Sel.getEndIndex(),total=Sel.isArrowSelectInverted()?Sel.getStartTotal():Sel.getEndTotal()}else if(action===A.EndLine){var caretPos=Measure.getCaretOffset(item,pane,offset,Sel.preferLineStart),line=caretPos.line,itemMetrics=item.metricsInPane(pane);total=Sel.isArrowSelectInverted()?Sel.getStartTotal():Sel.getEndTotal(),newOffset=line<itemMetrics.parsedLines.length-1&&caretPos.lineOffset===caretPos.lineLength?total:Measure.getOffsetForPositionInLine(item,pane,line,pane.getWidth(),-1),newIndex=Sel.isArrowSelectInverted()?Sel.getStartIndex():Sel.getEndIndex()}else if(action===A.LeftWord){var lastWord=EditHelpers.getPreviousWord(text,offset-1),lastPlugin=text.prevIndexOf(window.AttachChar,offset);if(0>lastPlugin)if(-1===lastWord&&0===offset)if(newIndex>0){newIndex--;var textPrev=pane.itemAtIndex(newIndex).getParsedText();newOffset=EditHelpers.getPreviousWord(textPrev,textPrev.length-1)+1,total=textPrev.length}else newOffset=-1;else newOffset=lastWord+1;else lastPlugin>lastWord&&(newOffset=lastPlugin+1,lastPlugin+1===offset&&newOffset--)}else if(action===A.RightWord){var nextWord=EditHelpers.getNextWord(text,offset+1),nextPlugin=text.indexOf(window.AttachChar,offset);if(0>nextPlugin)if(-1===nextWord)if(offset===total)if(newIndex<pane.numItems()-1){newIndex++;var textNext=pane.itemAtIndex(newIndex).getParsedText();nextWord=EditHelpers.getNextWord(textNext,0),total=textNext.length,-1===nextWord&&(nextWord=textNext.length),newOffset=nextWord}else newOffset=total+1;else newOffset=total;else newOffset=nextWord;else(nextWord>nextPlugin||0>nextWord)&&nextPlugin>=0&&(newOffset=nextPlugin,nextPlugin===offset&&newOffset++)}else action===A.Left?newOffset=Sel.getStartOffset()===Sel.getEndOffset()||e.shiftKey?offset-1:Sel.getStartOffset():action===A.Right&&(newOffset=Sel.getStartOffset()===Sel.getEndOffset()||e.shiftKey?offset+1:Sel.getEndOffset());if(Sel.preferLineStart=isLeft,0>newOffset?newIndex>0?newIndex--:newOffset=0:newOffset>total&&(newIndex<pane.numItems()-1?(newIndex++,newOffset=0):newOffset=total),e.shiftKey){var otherIndex=Sel.isArrowSelectInverted()?Sel.getEndIndex():Sel.getStartIndex(),otherOffset=Sel.isArrowSelectInverted()?Sel.getEndOffset():Sel.getStartOffset();!Sel.isArrowSelectInverted()&&isLeft&&newIndex<=Sel.getStartIndex()&&newOffset>=0&&newOffset<Sel.getStartOffset()?Sel.setArrowSelectInverted(!0):Sel.isArrowSelectInverted()&&isRight&&newIndex>=Sel.getEndIndex()&&newOffset>Sel.getEndOffset()&&Sel.setArrowSelectInverted(!1),Sel.isArrowSelectInverted()?Sel.selectIndices(newIndex,newOffset,otherIndex,otherOffset):Sel.selectIndices(otherIndex,otherOffset,newIndex,newOffset)}else Sel.selectIndex(newIndex,newOffset);if(platform.isFirefox)if(e.normCode===KeyCode.LeftArrow){var prevChar=item.getParsedText()[Sel.getStartOffset()-1];if(prevChar===window.AttachChar&&!e.shiftKey)return Sel.selectItem(item,Sel.getStartOffset()-1),!1}else if(e.normCode===KeyCode.RightArrow){var nextChar=item.getParsedText()[Sel.getEndOffset()];if(nextChar===window.AttachChar&&!e.shiftKey)return Sel.selectItem(item,Sel.getEndOffset()+1),!1}isLeft?Sel.scrollStartIntoView():Sel.scrollEndIntoView();break;case A.Up:case A.Down:case A.Top:case A.Bottom:case A.PageUp:case A.PageDown:var isUp=action===A.Up||action===A.Top||action===A.PageUp,isDown=action===A.Down||action===A.Bottom||action===A.PageDown,newIndex,newItem,offset;isUp&&(!e.shiftKey||Sel.isArrowSelectInverted())||isDown&&e.shiftKey&&Sel.isArrowSelectInverted()?(offset=Sel.getStartOffset(),newIndex=Sel.getStartIndex(),newItem=Sel.getStartItem()):(offset=Sel.getEndOffset(),newIndex=Sel.getEndIndex(),newItem=Sel.getEndItem());var origItem=newItem,caretPosStart=Measure.getCaretOffset(newItem,pane,offset,Sel.preferLineStart),targetLineOffset=caretPosStart.lineOffset,targetX=caretPosStart.left,newOffset;if(action===A.Up){var newLine=caretPosStart.line-1;if(0>newLine&&newIndex>0){newIndex--,newItem=Sel.getPane().itemAtIndex(newIndex);var paddingDiff=origItem.getPadding(pane)-newItem.getPadding(pane);targetX+=paddingDiff;var prevLineInfo=Measure.getCaretOffset(newItem,pane);newLine=prevLineInfo.line}newLine>=0&&(newOffset=Measure.getOffsetForPositionInLine(newItem,pane,newLine,targetX,targetLineOffset))}else if(action===A.Down){var newLine=caretPosStart.line+1,itemMetrics=newItem.metricsInPane(pane);if(newLine>itemMetrics.parsedLines.length-1)if(newIndex<pane.numItems()-1){newIndex++,newItem=pane.itemAtIndex(newIndex);var paddingDiff=origItem.getPadding(pane)-newItem.getPadding(pane);targetX+=paddingDiff,targetX=Math.max(targetX,0),newLine=0}else newLine=caretPosStart.line;newOffset=Measure.getOffsetForPositionInLine(newItem,Sel.getPane(),newLine,targetX,targetLineOffset)}else if(action===A.Top)newIndex=0,newOffset=0;else if(action===A.Bottom){var lastItem=pane.getLastItem(),numItems=pane.numItems();lastItem&&numItems>0&&(newIndex=numItems-1,newOffset=lastItem.getParsedText().length)}else if(action===A.PageUp){var up=pane.indexPageUp(Sel.getStartIndex());newIndex=up,newOffset=0}else if(action===A.PageDown){var down=pane.indexPageDown(Sel.getStartIndex());newIndex=down;var item=pane.itemAtIndex(down);newOffset=item.getParsedText().length}else{if(action===A.PrevHeader){var item=Sel.getStartItem(),focusItem;if(item.parent()===g.focusedItem){if(!item.isFirstChild()){try{g.PAssert(3010,item.getIndex()>0,"Should never hit this with the first item in the list")}catch(PERR){g.reportError(PERR)}focusItem=item.parent().getChild(item.getIndex()-1)}}else{for(;item.parent()!==g.focusedItem;)item=item.parent();focusItem=item}return void 0!==focusItem&&Sel.selectItem(focusItem,-1),!1}if(action===A.NextHeader){var item=Sel.getEndItem(),focusItem;if(item.parent()===g.focusedItem)item.isLastChild()||(focusItem=item.parent().getChild(item.getIndex()+1));else{for(;item.parent()!==g.focusedItem;)item=item.parent();item.isLastChild()||(focusItem=item.parent().getChild(item.getIndex()+1))}return void 0!==focusItem&&Sel.selectItem(focusItem,-1,0),!1}}if(!isNaN(newOffset))if(e.shiftKey){var otherIndex=Sel.isArrowSelectInverted()?Sel.getEndIndex():Sel.getStartIndex(),otherOffset=Sel.isArrowSelectInverted()?Sel.getEndOffset():Sel.getStartOffset();!Sel.isArrowSelectInverted()&&isUp&&(newIndex===Sel.getStartIndex()&&newOffset<Sel.getStartOffset()||newIndex<Sel.getStartIndex())?Sel.setArrowSelectInverted(!0):Sel.isArrowSelectInverted()&&isDown&&(newIndex===Sel.getEndIndex()&&newOffset>Sel.getEndOffset()||newIndex>Sel.getEndIndex())&&Sel.setArrowSelectInverted(!1),Sel.isArrowSelectInverted()?Sel.selectIndices(newIndex,newOffset,otherIndex,otherOffset):Sel.selectIndices(otherIndex,otherOffset,newIndex,newOffset)}else Sel.selectIndex(newIndex,newOffset);isUp?Sel.scrollStartIntoView():Sel.scrollEndIntoView();break;case A.All:this.handleSelectAll(pane)}return action!==A.None?!1:!0},keydown:function keydownFn(pane,e){var ret=!0;return keyCodesDown.indexOf(e.normCode)>=0?ret=this.keypress(pane,e,!0):platform.mac&&e.ctrlKey&&e.normCode===KeyCode.D?ret=this.keypress(pane,e,!0):keyCodesArrows.indexOf(e.normCode)>=0?(ret=this.handleArrows(pane,e),platform.ios||this.updateAutocomplete(e)):platform.mac&&e.metaKey||!platform.mac&&e.ctrlKey&&!e.altKey?(e.normCode===KeyCode.Y||e.normCode===KeyCode.Z)&&(ret=this.keypress(pane,e,!0)):platform.mac&&e.ctrlKey&&e.normCode===KeyCode.H&&this.preventDefault(e),!platform.mobile&&ret&&this.keyWantsScrollIntoView(e,!0)&&Sel.scrollStartIntoView(),ret},checkKeypressSpecialCases:function checkKeypressSpecialCasesFn(e,character){var forceValid;return e.ctrlKey&&e.altKey&&character?forceValid=!0:e.metaKey&&e.normCode===KeyCode.Tilde&&(forceValid=!1),forceValid},allowTextEditing:function allowTextEditingFn(item){try{g.PAssert(3011,item,"Must provide a valid item to check")}catch(PERR){g.reportError(PERR)}return!platform.mobile||android.isEnabled()||item&&!item.hasAttachments()},keypress:function keypressFn(element,e,fromKeydown){var keyCodes=[KeyCode.Enter,KeyCode.D];try{g.PAssert(3012,e.stopPropagation,"Should always be defined")}catch(PERR){g.reportError(PERR)}e.stopPropagation&&e.stopPropagation();var returnValue=!0,validCharacter=e.normCode>=32||keyCodes.indexOf(e.normCode)>=0,skipCharacter=platform.mobile&&e.normCode===KeyCode.Delete||0===e.which;if(!skipCharacter&&(fromKeydown||validCharacter)){if(platform.mac&&e.metaKey||!platform.mac&&e.ctrlKey){if(e.normCode===KeyCode.Y||e.normCode===KeyCode.Z){e.normCode!==KeyCode.Z||e.shiftKey?(tracker.redoAction(),g.sendEvent("Hotkey","Redo")):(tracker.undoAction(),g.sendEvent("Hotkey","Undo")),e.handled=!0;try{g.PAssert(3013,e.preventDefault,"Should always be defined")}catch(PERR){g.reportError(PERR)}return e.preventDefault&&e.preventDefault(),!0}var keyChar=String.fromCharCode(e.normCode);switch(keyChar){case"c":case"C":return e.handled=!0,!0;case"v":case"V":return e.handled=!0,!0;case"x":case"X":return e.handled=!0,!0;case"r":case"R":case"a":case"A":case"t":case"T":return e.handled=!0,!0}}var item=Sel.getStartItem();tracker.beginAction();var specialKeys=[KeyCode.Tab,KeyCode.Enter,KeyCode.BackSpace,KeyCode.Delete,KeyCode.D];if(Sel.getStartIndex()!==Sel.getEndIndex()&&e.normCode!==KeyCode.Tab&&(!e.metaKey&&!e.ctrlKey&&!e.optKey||specialKeys.indexOf(e.normCode)>=0)&&(g.vmMain.beginUpdateItems(),returnValue=returnValue&&this.handleMultiselect(e),g.vmMain.commitUpdateItems()),returnValue&&specialKeys.indexOf(e.normCode)>=0){var treatBackspaceLikeTab=!1;e.shiftKey&&e.normCode===KeyCode.BackSpace&&0===Sel.getStartOffset()&&(treatBackspaceLikeTab=!0),!e.ctrlKey&&e.normCode===KeyCode.Tab||treatBackspaceLikeTab?returnValue=returnValue&&this.handleTab(e):e.normCode===KeyCode.Enter?returnValue=returnValue&&this.handleEnter(e):e.normCode===KeyCode.BackSpace?returnValue=this.allowTextEditing(item)?returnValue&&this.handleBackspace(e):!1:(e.normCode===KeyCode.Delete||platform.mac&&e.ctrlKey&&e.normCode===KeyCode.D)&&(returnValue=this.allowTextEditing(item)?returnValue&&this.handleDelete(e):!1)}var keyCode=e.normCode;e.normCode!==KeyCode.Period||fromKeydown||(keyCode=KeyCode.Delete);var character=String.fromCharCode(keyCode),isValid=returnValue&&character&&e.normCode!==KeyCode.BackSpace&&e.normCode!==KeyCode.Enter&&!e.ctrlKey&&!e.metaKey,forceValid=this.checkKeypressSpecialCases(e,character);if(forceValid===!0?isValid=!0:forceValid===!1&&(isValid=!1),isValid){var item=Sel.getStartItem();if(Sel.isValid()&&this.allowTextEditing(item)){var s;s=android.isEnabled()?android.getInputText():item.getParsedText();var newText=s.substr(0,Sel.getStartOffset())+character+s.substr(Sel.getEndOffset());Sel.getStartOffset()!==Sel.getEndOffset()&&tracker.performAction(TrackerType.Remove,{itemID:item.id,position:Sel.getStartOffset(),text:s.slice(Sel.getStartOffset(),Sel.getEndOffset())}),tracker.performAction(TrackerType.Insert,{itemID:item.id,position:Sel.getStartOffset(),text:character}),platform.ios?(textSaveInfo.text=newText,textSaveInfo.start=Sel.getStartOffset()+1,textSaveInfo.waitAutocorrect=" "===character?"space":void 0,textSaveInfo.item=item,returnValue=!0):(item.setText(newText,!0,ChangeType.Local),Sel.selectIndex(Sel.getStartIndex(),Sel.getStartOffset()+1),returnValue=!1,this.preventDefault(e))}else returnValue=!1}tracker.endAction()}return lastKeypress=e.normCode,!platform.mobile&&this.keyWantsScrollIntoView(e,fromKeydown)&&Sel.scrollStartIntoView(),platform.ios||this.updateAutocomplete(e),returnValue},textInputiOS:function textInputiOSFn(pane,e){try{g.PAssert(3014,platform.ios||platform.android||platform.mac||platform.windows,"Should only ever use textInput events on iOS or OSX")}catch(PERR){g.reportError(PERR)}var returnValue=!0;try{g.PAssert(3015,e.stopPropagation,"Should always be defined")}catch(PERR){g.reportError(PERR)}if(e.stopPropagation&&e.stopPropagation(),!Sel.isValid())return e.stopPropagation(),e.preventDefault(),!1;tracker.beginAction();var incText=e.data;try{g.PAssert(3016,incText&&incText.length>0,"Must have valid incoming text: ",e)}catch(PERR){g.reportError(PERR)}incText&&!g.isString(incText)&&e.detail&&(incText=e.detail.data);var incTextLength=0;incText&&g.isString(incText)&&(incText=incText.replace(/(\r\n|\n|\r)/g,""),incTextLength=incText.length);var range=NativeSel.getSelectionRange(),element=range.getStartElement();if(!element)return!1;var offsets=range.getSelectOffsetsInElement(element),item=g.getItemForElement(element),reactItem=g.getReactItemForElement(element),index=reactItem.props.index,startOffset=offsets.start,endOffset=offsets.end,s=item.getParsedText(),delLength=s.length-offsets.total,incIndex=!1;if(startOffset!==endOffset&&0===delLength){var endIndex=s.indexOf(" ",endOffset);0>endIndex&&(endIndex=s.length);var fullWord=s.substring(startOffset,endIndex),trimWord=g.trimPunc(fullWord);try{g.PAssert(3018,endOffset<=startOffset+trimWord.length,"Should never shorten a word being replaced by autocomplete")}catch(PERR){g.reportError(PERR)}endOffset=startOffset+trimWord.length;try{g.PAssert(3019,endOffset<=Sel.getEndTotal())}catch(PERR){g.reportError(PERR)}}else textSaveInfo&&"enter"===textSaveInfo.waitAutocorrect&&textSaveInfo.useNext&&(incIndex=!0);var newText=s.substr(0,startOffset)+incText+s.substr(endOffset+delLength);if(startOffset!==endOffset&&tracker.performAction(TrackerType.Remove,{itemID:item.id,position:startOffset,text:s.slice(startOffset,endOffset)}),tracker.performAction(TrackerType.Insert,{itemID:item.id,position:startOffset,text:incText}),item.setText(newText,!0,ChangeType.Local),incIndex?(index++,startOffset=0):startOffset+=incTextLength,platform.ios){var startElement=pane.elementAtIndex(index);Sel.selectElements(startElement,startOffset,startElement,startOffset)}else Sel.selectIndex(index,startOffset);returnValue=!1;try{g.PAssert(3020,e.preventDefault,"Should always be defined")}catch(PERR){g.reportError(PERR)}return e.preventDefault&&e.preventDefault(),tracker.endAction(),textSaveInfo.item=void 0,returnValue},handleMultiselect:function handleMultiselectFn(e){var arrToDelete=[],levelsDeep=0,returnValue=!0,startItem=Sel.getStartItem(),endItem=Sel.getEndItem();if(startItem.isNote()&&(startItem=startItem.parent()),endItem.isNote()&&(endItem=endItem.parent()),startItem===endItem)return!1;if(e.normCode===KeyCode.Enter&&e.shiftKey)return!0;var nextItem=startItem,fscount=0;do{var nextItemOptions={numLevels:0};nextItem=g.getNextItem(nextItem,g.focusedPane,nextItemOptions),nextItem&&(nextItem.parent()===g.focusedPane.getItem()&&nextItem.isHeader()&&fscount++,levelsDeep+=nextItemOptions.numLevels,(nextItem!==endItem||Sel.getEndOffset()===Sel.getEndTotal())&&arrToDelete.push(nextItem))}while(nextItem&&nextItem!==endItem);var doAction=!0;if(arrToDelete.length>=16&&fscount>=2&&(doAction=confirm("You have selected a large number of items to delete. Please confirm you want to perform this action.")),doAction){var newStartText;if(Sel.getStartOffset()>0||Sel.getEndOffset()<Sel.getEndTotal()){var startTextInfo=startItem.splitUsableText(startItem.getParsedText(),Sel.getStartOffset(),Sel.getStartOffset()),textAddedInfo=endItem.splitUsableText(endItem.getParsedText(),Sel.getEndOffset(),Sel.getEndOffset());newStartText=startTextInfo.before+textAddedInfo.after,tracker.performAction(TrackerType.Remove,{itemID:startItem.id,position:Sel.getStartOffset(),text:startItem.getParsedText().slice(Sel.getStartOffset())}),tracker.performAction(TrackerType.Insert,{itemID:startItem.id,position:Sel.getStartOffset(),text:endItem.getParsedText().substring(Sel.getEndOffset())}),arrToDelete.indexOf(endItem)<0&&arrToDelete.push(endItem),0===Sel.getStartOffset()&&startItem.copyProperties(endItem)}else tracker.performAction(TrackerType.Remove,{itemID:startItem.id,position:0,text:startItem.getParsedText()}),newStartText="";if((e.normCode===KeyCode.BackSpace||e.normCode===KeyCode.Delete||e.normCode===KeyCode.Enter)&&(returnValue=!1),endItem.moveChildren(startItem,0),levelsDeep>0){var arrToMove2=[],arrToMove=[],next,endLI=Sel.endLI;for(next=endItem.nextSibling();levelsDeep>0&&next;){var index=next.getIndex(),nextItems=next.parent().getItems().slice(index);arrToMove=arrToMove.concat(nextItems),next=next.parent().nextSibling(),levelsDeep--}if(arrToMove.length>0)for(var parentToMoveTo=startItem,index=0,i=0;i<arrToMove.length;i++){var item=arrToMove[i],oldParent=item.parent();if(arrToDelete.indexOf(oldParent)>=0){item.moveTo({parent:parentToMoveTo,index:index});var oldIndex=item.parent().getChildIndex(item);tracker.performAction(TrackerType.Move,{itemID:item.id,oldParent:oldParent.id,oldPosition:oldIndex,newParent:parentToMoveTo.id,newPosition:index}),index++}}}else if(arrToDelete.indexOf(endItem.parent())>=0)for(var parentToMoveTo=startItem.parent(),item=g.getNextItem(endItem,g.focusedPane,{sameLevel:!0});item;){var index=parentToMoveTo.numItems(),oldParent=item.parent(),oldIndex=oldParent.getChildIndex(item);item.moveTo({parent:parentToMoveTo,index:index}),tracker.performAction(TrackerType.Move,{itemID:item.id,oldParent:oldParent.id,oldPosition:oldIndex,newParent:parentToMoveTo.id,newPosition:index}),item=g.getNextItem(endItem,g.focusedPane,{sameLevel:!0})}for(var i=0;i<arrToDelete.length;i++){var item=arrToDelete[i];try{g.PAssert(3026,item,"Item must exist")}catch(PERR){g.reportError(PERR)}item.isDeleted()||item.parent().deleteChild(item,void 0,void 0,ChangeType.Local)}startItem.setText(newStartText,!0,ChangeType.Local),Sel.selectIndex(Sel.getStartIndex(),Sel.getStartOffset())}else returnValue=!1;return returnValue},handleTab:function handleTabFn(e){g.vmMain.beginUpdateItems();var pane=Sel.getPane(),startItem=Sel.getStartItem(),endItem=Sel.getEndItem(),startIndex=Sel.getStartIndex(),endIndex=Sel.getEndIndex(),indent=e.normCode===KeyCode.Tab&&!e.shiftKey||e.normCode===KeyCode.RightArrow,origStartItem=startItem;startItem&&startItem.isNote()&&(startItem=startItem.parent());var origEndItem=endItem;endItem&&endItem.isNote()&&(endItem=endItem.parent());var nextItem=startItem,needUpdate={},itemsToTab=[startItem],newParent,moved={},itemsHighlighted={};if(itemsHighlighted[startItem.id]=!0,startItem!==endItem)do{var nextItemOptions={numLevels:0,ignoreSearch:!0};nextItem=g.getNextItem(nextItem,pane,nextItemOptions),nextItem&&(itemsToTab.push(nextItem),itemsHighlighted[nextItem.id]=!0)}while(nextItem!==endItem&&void 0!==nextItem);var i,initial,condition,increment;for(e.shiftKey?(initial=function(){i=itemsToTab.length-1},condition=function(){return i>=0},increment=function(){i--}):(initial=function(){i=0},condition=function(){return i<itemsToTab.length},increment=function(){i++}),initial();condition();increment()){var item=itemsToTab[i];try{g.PAssert(3027,item,"Must always be tabbing/untabbing valid items")}catch(PERR){g.reportError(PERR)}var parent=item.parent(),index=parent.getItems().indexOf(item),ok,u;if(indent){if(ok=index>0){for(newParent=parent.itemAtIndex(index-1);newParent.isHidden(pane);){if(index--,0>=index)return g.vmMain.commitUpdateItems(),!1;newParent=parent.itemAtIndex(index-1)}moved[parent.id]||(needUpdate[item.parent().id]=item.parent(),needUpdate[newParent.id]=newParent,item.moveTo({parent:newParent,fromTab:!0})),moved[item.id]=!0,tracker.performAction(TrackerType.Move,{itemID:item.id,oldParent:parent.id,oldPosition:index,newParent:newParent.id,newPosition:newParent.numItems()-1})}else newParent=parent,moved[item.id]=moved[parent.id];for(var moveSiblings=!1,parentMoved=item;parentMoved;){if(moved[parentMoved.id]){parentMoved.isCollapsed(pane,!1)||(moveSiblings=!0);break}parentMoved=parentMoved.parent()}var siblingStartIndex=item.getIndex()+1;if(moveSiblings){var items=item.getItems(),numMoved=0;for(u=0;u<items.length;u++){var child=items[u];if(!itemsHighlighted[child.id]){if(child.isHidden(pane,!1))continue;needUpdate[child.parent().id]=child.parent(),needUpdate[item.parent().id]=item.parent();var moveIndex=siblingStartIndex+numMoved;child.moveTo({parent:item.parent(),index:moveIndex,fromTab:!0}),moved[child.id]=!0,tracker.performAction(TrackerType.Move,{itemID:child.id,oldParent:item.id,oldPosition:u,newParent:item.parent().id,newPosition:moveIndex}),numMoved++,u--}}}}else if(ok=item.parent()!==g.focusedItem){newParent=item.parent().parent();var parentItems=parent.getItems();for(u=index+1;parentItems[index+1];){var siblingItem=parentItems[index+1];itemsHighlighted[siblingItem.id]||siblingItem.isHidden(pane)?index++:(needUpdate[siblingItem.parent().id]=siblingItem.parent(),needUpdate[item.id]=item,siblingItem.moveTo({parent:item,fromTab:!0}),moved[siblingItem.id]=!0,tracker.performAction(TrackerType.Move,{itemID:siblingItem.id,oldParent:parent.id,oldPosition:u,newParent:item.id,newPosition:item.numItems()-1})),u++}if(itemsHighlighted[parent.id]>=0&&(!parent.parent()||parent.parent()!==g.focusedItem))continue;var parentIndex=newParent.getItems().indexOf(parent);needUpdate[item.parent().id]=item.parent(),needUpdate[newParent.id]=newParent,item.moveTo({parent:newParent,index:parentIndex+1,fromTab:!0}),moved[item.id]=!0,tracker.performAction(TrackerType.Move,{itemID:item.id,oldParent:parent.id,oldPosition:index,newParent:newParent.id,newPosition:parentIndex+1})}}if(android.isEnabled())android.updateInputBounds(startItem);else if(startItem||endItem){try{g.PAssert(3028,startItem&&endItem)}catch(PERR){g.reportError(PERR)}Sel.selectIndices(Sel.getStartIndex(),Sel.getStartOffset(),Sel.getEndIndex(),Sel.getEndOffset())}e.handled=!0;try{g.PAssert(3029,e.preventDefault,"Should always be defined")}catch(PERR){g.reportError(PERR)}return e.preventDefault&&e.preventDefault(),g.vmMain.commitUpdateItems(),!1},handleEnter:function handleEnterFn(e){var item=Sel.getStartItem();if(!item){try{g.PAssert(3030,!1,"Invalid item in handleEnter")}catch(PERR){g.reportError(PERR)}return!1}var parent=item.parent();if(!parent){try{g.PAssert(3031,!1,"Invalid parent in handleEnter")}catch(PERR){g.reportError(PERR)}return!1}var index=parent.getItems().indexOf(item);android.isEnabled()&&android.finishInput(!0);var text=item.getParsedText(),item2,addToChild=!1,newParent=parent;if(e.shiftKey)return e.preventDefault(),!1;if(!item.isNote()){var useNextItem=!0;if(0===Sel.getEndOffset()&&""!==text)item2=item.isNumList()?d.createVMLI({text:NumListPrefix},{parent:newParent,changeType:ChangeType.AllLocal}):d.createVMLI({text:""},{parent:newParent,changeType:ChangeType.AllLocal}),index--,useNextItem=!1;else if(Sel.getStartOffset()>=Sel.getStartTotal()){addToChild=!item.isCollapsed(g.focusedPane,!1)&&(item.numItems()>0||item.isHeader()),addToChild&&(newParent=item);var newText="";item.isNumList()&&(newText=NumListPrefix),item2=d.createVMLI({text:newText},{parent:newParent,changeType:ChangeType.AllLocal})}else if(0===Sel.getStartOffset()&&Sel.getEndOffset()===Sel.getEndTotal())item2=d.createVMLI({text:""},{parent:newParent,changeType:ChangeType.AllLocal}),item.setText("",!0,ChangeType.Local),tracker.performAction(TrackerType.Remove,{itemID:item.id,position:0,text:text});
else{var splitText=item.splitUsableText(text,Sel.getStartOffset(),Sel.getEndOffset());item.isNumList()&&(secondText=NumListPrefix+splitText.after),item2=d.createVMLI({text:splitText.before},{parent:newParent,changeType:ChangeType.AllLocal}),item.setText(splitText.after,!0,ChangeType.Local),tracker.performAction(TrackerType.Remove,{itemID:item.id,position:Sel.getStartOffset(),text:text.substring(Sel.getStartOffset())}),item2.copyProperties(item),index--,useNextItem=!1}if(item2.parseText(!0,ChangeType.Local|ChangeType.All),addToChild)item.insertItem(item2,0),tracker.performAction(TrackerType.Create,{itemID:item2.id,parent:item.id,position:0,text:item2.getParsedText()});else{try{g.PAssert(3032,!item2.isNote(),"Should never be inserting a note here")}catch(PERR){g.reportError(PERR)}newParent.insertItem(item2,index+1),tracker.performAction(TrackerType.Create,{itemID:item2.id,parent:newParent.id,position:index+1,text:item2.getParsedText()})}var selectItem=useNextItem?item2:item;try{g.PAssert(3033,selectItem,"Expected another item to exist")}catch(PERR){g.reportError(PERR)}if(platform.ios)return textSaveInfo.start=Sel.getStartOffset(),textSaveInfo.waitAutocorrect="enter",textSaveInfo.item=useNextItem?item:item2,textSaveInfo.nextItem=useNextItem?item2:item,textSaveInfo.useNext=useNextItem,!0;Sel.selectIndex(Sel.getStartIndex()+1,0,0);try{g.PAssert(3034,e.preventDefault,"Should always be defined")}catch(PERR){g.reportError(PERR)}return e.preventDefault&&e.preventDefault(),!1}if(platform.ios);else if(!android.isEnabled()){var newText=text.substr(0,Sel.getStartOffset())+StringNewLine+text.substr(Sel.getEndOffset());return item.setText(newText,!0,ChangeType.Local),Sel.selectItem(item,Sel.getStartOffset()+1),e.preventDefault(),!1}},handleBackspace:function handleBackspaceFn(e){var item=Sel.getStartItem(),pane=g.focusedPane;if(!item){try{g.PAssert(3035,!1,"Invalid item in handleBackspace")}catch(PERR){g.reportError(PERR)}return!1}var parent=item.parent();try{g.PAssert(3036,parent,"Must always have a valid parent for an item")}catch(PERR){g.reportError(PERR)}android.isEnabled()&&android.finishInput(!0),platform.ie&&(e.preventDefault(),e.stopImmediatePropagation());var text=item.getParsedText(),newText="",newTextOffset=0;if(0===Sel.getStartOffset()&&0===Sel.getEndOffset()||""===text){if(item.isNote()&&""!==text)return!1;var prev=Sel.getStartIndex()>0&&pane.itemAtIndex(Sel.getStartIndex()-1);if(prev){var prevTextLength=prev.getParsedText().length,selectIndex=prev.isFullscreen()?0:Sel.getStartIndex()-1,selectOffset=prev.isFullscreen()?0:prevTextLength;return Sel.selectIndex(selectIndex,selectOffset),parent.deleteChild(item,prev,0,ChangeType.Local),text.length>0&&""!==text&&(0===prev.getParsedText().length&&prev.copyProperties(item),prev.setText(prev.getParsedText()+item.generateSaveText(text),!0,ChangeType.Local),item.hasNote()&&(prev.hasNote()||prev.moveNote(item)),tracker.performAction(TrackerType.Insert,{itemID:prev.id,position:prevTextLength,text:text})),!1}return!1}if(0===Sel.getStartOffset()&&Sel.getEndOffset()===text.length)tracker.performAction(TrackerType.Remove,{itemID:item.id,position:0,text:item.getParsedText()}),newText="",newTextOffset=0;else if(e.metaKey)if(item.isNote()){var lastLine=text.prevIndexOf("\n",Sel.getEndOffset());0>lastLine?(newText=text.substring(Sel.getEndOffset()),newTextOffset=0,tracker.performAction(TrackerType.Remove,{itemID:item.id,position:0,text:text.slice(0,Sel.getEndOffset())})):(newText=text.substring(0,lastLine)+text.substring(Sel.getEndOffset()),newTextOffset=lastLine,tracker.performAction(TrackerType.Remove,{itemID:item.id,position:0,text:text.slice(lastLine,Sel.getEndOffset())}))}else newText=text.substring(Sel.getEndOffset()),tracker.performAction(TrackerType.Remove,{itemID:item.id,position:0,text:text.slice(0,Sel.getEndOffset())}),newTextOffset=0;else if((platform.mac&&e.altKey||!platform.mac&&e.ctrlKey)&&Sel.getStartOffset()===Sel.getEndOffset()){var endOfText=text.substring(Sel.getStartOffset()),subIndex=EditHelpers.getPreviousWord(text,Sel.getStartOffset()-1)+1;subIndex>=0?(tracker.performAction(TrackerType.Remove,{itemID:item.id,position:subIndex,text:text.slice(subIndex,Sel.getStartOffset())}),newText=text.substring(0,subIndex)+endOfText,newTextOffset=subIndex):(Sel.getStartOffset()===text.length?0===Sel.getStartOffset()&&(newText="",tracker.performAction(TrackerType.Remove,{itemID:item.id,position:0,text:text})):(tracker.performAction(TrackerType.Remove,{itemID:item.id,position:0,text:text.slice(0,Sel.getStartOffset())}),newText=endOfText),newTextOffset=0)}else if(Sel.getStartOffset()!==Sel.getEndOffset())tracker.performAction(TrackerType.Remove,{itemID:item.id,position:Sel.getStartOffset(),text:text.slice(Sel.getStartOffset(),Sel.getEndOffset())}),newText=text.substr(0,Sel.getStartOffset())+text.substr(Sel.getEndOffset()),newTextOffset=Sel.getStartOffset();else{var sub=1;text.length>1&&""===text[Sel.getStartOffset()-1]&&sub++,newText=text.substr(0,Sel.getStartOffset()-sub)+text.substr(Sel.getStartOffset()),tracker.performAction(TrackerType.Remove,{itemID:item.id,position:Sel.getStartOffset()-sub,text:text.slice(Sel.getStartOffset()-sub,Sel.getStartOffset())}),newTextOffset=Sel.getStartOffset()-sub}return platform.ios?(textSaveInfo.text=newText,textSaveInfo.start=newTextOffset,textSaveInfo.item=item,textSaveInfo.innerHTML=e.target&&e.target.innerHTML,!0):(item.setText(newText,!0,ChangeType.Local),Sel.selectItem(item,newTextOffset,newTextOffset),!1)},handleDelete:function handleDeleteFn(e){var item=Sel.getStartItem(),pane=g.focusedPane;if(!item)return!1;var parent=item.parent(),text=item.getParsedText();if(""===text)if(item.isNote())parent.setNote(void 0),Sel.selectItem(parent,-1);else{var index=Sel.getStartIndex(),selectIndex=index,selectOffset=0;index===pane.numItems()-1&&(selectIndex=Math.max(0,index-1),selectOffset=pane.itemAtIndex(selectIndex).getParsedText().length),pane.numItems()>1&&(item.hasChildren()?parent.replaceChild(item,item.getFirstChild(),ChangeType.Local):parent.deleteChild(item,parent,index,ChangeType.Local),Sel.selectIndex(selectIndex,selectOffset))}else if(Sel.getStartOffset()===Sel.getStartTotal()&&Sel.getEndOffset()===Sel.getEndTotal()){if(item.isNote())return!1;var next=g.getNextItem(item,g.focusedPane);next&&(item.setText(item.generateSaveText(text)+next.getParsedText(),!0,ChangeType.Local),tracker.performAction(TrackerType.Insert,{itemID:item.id,position:text.length,text:next.getParsedText()}),next.parent().deleteChild(next,item,0,ChangeType.Local),Sel.selectIndex(Sel.getEndIndex(),Sel.getEndOffset()))}else if(e.metaKey)item.isNote()||(newText=text.substring(0,Sel.getStartOffset()),item.setText(newText,!0,ChangeType.Local),tracker.performAction(TrackerType.Remove,{itemID:item.id,position:0,text:text.slice(0,Sel.getStartOffset())}),Sel.selectIndex(Sel.getStartIndex(),Sel.getStartOffset()),newTextOffset=0);else if((platform.mac&&e.altKey||!platform.mac&&e.ctrlKey)&&Sel.getStartOffset()===Sel.getEndOffset()){var subIndex=EditHelpers.getNextWord(text,Sel.getStartOffset()+1);if(0>subIndex&&(subIndex=Sel.getStartTotal()),subIndex>=0){var newText=text.substring(0,Sel.getStartOffset())+text.substring(subIndex);item.setText(newText,!0,ChangeType.Local),tracker.performAction(TrackerType.Remove,{itemID:item.id,position:subIndex,text:newText}),Sel.selectItem(item,Sel.getStartOffset())}}else if(Sel.getStartOffset()!==Sel.getEndOffset()){var newText=text.substr(0,Sel.getStartOffset())+text.substr(Sel.getEndOffset());item.setText(newText,!0,ChangeType.Local),tracker.performAction(TrackerType.Remove,{itemID:item.id,position:Sel.getStartOffset(),text:text.slice(Sel.getStartOffset(),Sel.getEndOffset())}),Sel.selectItem(item,Sel.getStartOffset())}else{var newText=text.substr(0,Sel.getStartOffset())+text.substr(Sel.getStartOffset()+1);item.setText(newText,!0,ChangeType.Local),tracker.performAction(TrackerType.Remove,{itemID:item.id,position:Sel.getStartOffset(),text:text.slice(Sel.getStartOffset(),Sel.getStartOffset()+1)}),Sel.selectItem(item,Sel.getStartOffset(),Sel.getStartOffset())}return!1},keyWantsScrollIntoView:function keyWantsScrollIntoViewFn(e,fromKeydown){switch(e.normCode){case KeyCode.LeftMeta:case KeyCode.RightMeta:case KeyCode.Alt:case KeyCode.Shift:case KeyCode.Ctrl:case KeyCode.LeftArrow:case KeyCode.RightArrow:case KeyCode.UpArrow:case KeyCode.DownArrow:return!1}return platform.mac&&e.metaKey&&(fromKeydown&&e.normCode===KeyCode.Tilde||!fromKeydown&&"`"===String.fromCharCode(e.normCode))?!1:!(platform.mac&&e.metaKey||!platform.mac&&e.ctrlKey)||e.normCode!==KeyCode.Z&&e.normCode!==KeyCode.Y?e.normCode>=KeyCode.F1&&e.normCode<=KeyCode.F12?!1:!0:!1}},new edit}),define("AScript",["globals","platform","data","tracker","VMLI","edit","Sel","DragDrop","Dispatcher"],function(g,platform,d,tracker,VMLI,edit,Sel,DragDrop,Dispatcher){function AScript(){function onMessage(e){if(e.data&&g.isString(e.data)&&e.data.indexOf("{")<0)for(var commands=e.data.split("&"),i=0;i<commands.length;i++){var params=commands[i].split("=");try{g.PAssert(3038,params.length>=0,"Invalid number of params in message")}catch(PERR){g.reportError(PERR)}switch(params[0]){case"script":this.runScript(params[1],!1);break;case"data":if(this.isRunning)return this.stop(),void setTimeout(onMessage.bind(this),100,e);this.loadScriptData(params[1]);break;case"video":window.__IS_DEMO_VIDEO=!0;break;case"demoIntroWider":g.addClass(document.documentElement,"demoIntroWider");break;case"start":this.start();break;case"stop":this.stop();break;case"pause":this.pause();break;case"resume":this.resume();break;case"restart":this.restart();break;case"alertDemo":g.menus.alert({text:'Click anywhere to try this <b class="blue">live demo</b>',action:g.emptyFn,big:!0});break;case"help":var show=params[1];"1"==show?g.vmMain.showHelp(HelpMode.Intro):g.intro.closeHelp();break;case"panes":this.loadPanes(params[1])}}}this.queueDebug=!1,this.videoPhone=!1,this.hasSelection=!1,this.isTyping=!1,this.isRunning=!1,this.isDisabled=!1,this.isPaused=!1,this.stoppedFromPause=!1,this.activeScript=void 0,this.index=0,this.repeat=!1,this.onScriptDone=void 0,this.selectedItem=void 0,this.needsFinish=!1,this.needsStop=!1,this.lastLoadedData=void 0,this.savedItems={},this._scriptQueue=[],this.startText={},window.addEventListener("message",onMessage.bind(this),!1),window.pauseScript=function(){this.isDisabled||(log("pause script"),this.isDisabled=!0)}.bind(this)}var ActionType={Run:1,Reset:2},q=function(){var args=Array.prototype.slice.call(arguments,1),s=arguments[0];args.splice(0,0,ActionType.Run),s.queue.apply(s,args)},addItem=function(s,text,name,indent,set){if(s.queue(ActionType.Run,"createItemAfter",void 0,name),void 0!==indent&&0!==indent)for(var i=0;i<Math.abs(indent);i++)s.queue(ActionType.Run,"indent",0>indent?!0:!1);set?s.queue(ActionType.Run,"setText",void 0,text):s.queue(ActionType.Run,"typeString",void 0,text,40)};return AScript.prototype={runScript:function runScriptFn(id,repeat){var shouldStart=!0;if(!this.isDisabled){switch(id){case"intro":this._scriptQueue.push(this.demoIntro()),g.addClass(document.documentElement,"demoIntro"),repeat=!1,shouldStart=!1;break;case"kanban":this._scriptQueue.push(this.demoKanban()),repeat=!1;break;case"gtd":this._scriptQueue.push(this.demoGTD()),repeat=!1;break;case"projectManagement":this._scriptQueue.push(this.demoProjectManagement()),repeat=!1;break;case"inboxZero":this._scriptQueue.push(this.demoInboxZero()),repeat=!1;break;case"none":try{g.PAssert(3039,!1,"Should never be requesting a NONE script")}catch(PERR){g.reportError(PERR)}return;default:try{g.PAssert(3040,!1,"Invalid script request: ",id)}catch(PERR){g.reportError(PERR)}}this.repeat=repeat,this.activeScript=this._scriptQueue[0],!this.isRunning&&this.activeScript&&shouldStart&&this.start()}},start:function startFn(){this.needsStop=!1,g.messageQueue.clearMessage(MessageID.ThisIsDemo),this.onScriptStart(this.activeScript),this.reset(),this.run()},restart:function restartFn(){this.activeScript=this._scriptQueue[0],this.activeScript.index=0,this.start()},stop:function stopFn(){this._scriptQueue=[],this.needsStop=!0,this.isRunning=!1,this.activeScript=void 0,clearTimeout(this.delayTimeout),clearTimeout(this.timeout),this.delayTimeout=void 0,this.timeout=void 0,g.autocomplete.hide(),DragDrop.stop()},pause:function pauseFn(){this.isPaused=!0},resume:function resumeFn(){this.isPaused=!1,this.stoppedFromPause&&this.run()},loadScriptData:function loadScriptDataFn(dataId,cb){log("Load Script Data: ",dataId),this._scriptQueue=[],this.repeat=!1,this.lastLoadedData=dataId,Dispatcher.fireEvent("resetEverything",[]),g.vmMain.paneManager.clearPanes(),g.vmMain.beginUpdateItems(),d.loadDemoData(dataId,!0,function(id){g.vmMain.changeRoot(id),g.vmMain.commitUpdateItems(),cb&&cb()})},loadPanes:function loadPanesFn(dataId){g.demoPanes=dataId.split(":"),g.vmMain.loadDemoPanes()},onScriptStart:function onScriptStartFn(script){script&&window.parent.postMessage(script.getName(),"*")},createScript:function createScriptFn(name){var script={_nextId:0,owner:this,_name:name,index:0,isResetting:!1,_repeat:!1,noDelay:!1,runQueue:[],resetQueue:[],_activeQueue:function _activeQueueFn(){return this.isResetting?this.resetQueue:this.runQueue},queue:function queueFn(type,fnName){var args=Array.prototype.slice.call(arguments,2),arr=type===ActionType.Run?this.runQueue:this.resetQueue;return arr.push({id:this._nextId++,name:fnName,args:args}),arr},repeat:function repeatFn(val){this._repeat=val},reset:function resetFn(){this.index=0;for(var i=0;i<this.resetQueue.length;i++){var next=this.resetQueue[i];this.owner[next.name].apply(this.owner,next.args)}},nextStep:function nextStepFn(){var queue=this.runQueue;return queue[this.index++]},getName:function getNameFn(){return this._name}};return script},reset:function resetFn(){this.index=0;for(var i=0;i<this._scriptQueue.length;i++)this._scriptQueue[i].reset()},run:function runFn(){if(!this.isDisabled&&this.activeScript){if(this.isPaused)return void(this.stoppedFromPause=!0);try{g.PAssert(3042,this.activeScript,"Must have a script active to be running")}catch(PERR){g.reportError(PERR)}var next=this.activeScript.nextStep();if(!next){if(this.index++,this.index>=this._scriptQueue.length){if(!this.repeat)return this.isRunning=!1,void(this.onScriptDone&&this.onScriptDone());this.reset()}this.activeScript=this._scriptQueue[this.index],this.activeScript.reset(),this.onScriptStart(this.activeScript),next=this.activeScript.nextStep()}var args=next.args;args.push(this.run.bind(this)),args.push(this.activeScript),this.isRunning=!0,this.timeout=setTimeout(function(){try{this.queueDebug,this[next.name].apply(this,args)}catch(err){g.reportError(err),this.onDisable()}}.bind(this),0)}},onDisable:function onDisableFn(){this.isDisabled=!0},setSelection:function setSelectionFn(item,paneIndex,offset,length,cb){try{g.PAssert(3043,item,"Must provide a valid item to select")}catch(PERR){g.reportError(PERR)}item=this.getItemIfString(item);var selectPane=paneIndex>=0?g.vmMain.paneManager.getPaneAtIndex(paneIndex):g.focusedPane;g.focusedPane.id!==selectPane.id&&Sel.focusPane(selectPane),void 0===offset||null===offset?offset=0:0>offset&&(offset=item.getParsedText().length+offset+1),Sel.selectItem(item,offset,offset+length),this.hasSelection=!0,this.selectedItem=item,cb&&cb()},clearSelection:function clearSelectionFn(cb){Sel.reset(),this.hasSelection=!1,this.selectedItem=void 0,cb&&cb()},scrollTo:function scrollToFn(index,offset,cb){var pane=g.vmMain.paneManager.getPaneAtIndex(index);try{g.PAssert(3044,pane,"Must have selected a valid pane")}catch(PERR){g.reportError(PERR)}pane.setScrollOffset(offset),cb&&cb()},setText:function setTextFn(item,str,cb){item=item||this.selectedItem,item.setText(str,!0,ChangeType.Local),cb&&cb()},appendText:function appendTextFn(item,str,cb){item.setText(item.getParsedText()+str,!0),cb&&cb()},setPriority:function setPriorityFn(item,priority,cb){item=this.getItemIfString(item)||this.selectedItem,item.priority(priority),cb&&cb()},setStarred:function setStarredFn(item,isStarred,cb){item=item||this.selectedItem,item.isStarred(isStarred),cb&&cb()},setComplete:function setCompleteFn(item,isComplete,date,cb){item=this.getItemIfString(item)||this.selectedItem,item.dateCompleted=date,item.isComplete(isComplete),cb&&cb()},indent:function indentFn(outdent,cb){var keyData={normCode:KeyCode.Tab,shiftKey:outdent};g.fireKeyEvent(void 0,keyData),cb&&cb()},typeString:function typeStringFn(item,str,charDelay,cb){function typeChar(){if(this.needsStop)return void stop();this.videoPhone&&this.setSelection(item,0,-1,0);var normCode=str.charCodeAt(i);normCode===KeyCode.Delete&&(normCode=KeyCode.Period),g.fireKeyEvent(void 0,{normCode:normCode}),++i>=str.length&&(stop(),cb&&cb())}try{g.PAssert(3049,cb,"typeString should always have a callback")}catch(PERR){g.reportError(PERR)}this.needsFinish&&(charDelay=0),item=this.getItemIfString(item)||this.selectedItem;try{g.PAssert(3050,item,"Must be an item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3051,this.hasSelection,"Must set selection before typing")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3052,!this.isTyping,"Must wait until previous typing is finished")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3053,void 0!==str,"Must supply a string to be typed")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3054,void 0!==charDelay,"Must specify a delay between each typed character")}catch(PERR){g.reportError(PERR)}this.isTyping=!0;var i=0,typeInterval,stop=function(){typeInterval&&clearInterval(typeInterval),this.isTyping=!1,this.needsStop=!1}.bind(this);str&&(typeChar.apply(this),str.length>1&&(typeInterval=setInterval(typeChar.bind(this),charDelay)))},createItemAfter:function createItemAfterFn(item,savedName,cb){item=item||this.selectedItem,this.setSelection(item,void 0,item.getParsedText().length,0),g.fireKeyEvent(void 0,{normCode:KeyCode.Enter}),requestAnimationFrame(function(){this.clearSelection(function(){var newItem;newItem=item.isHeader()?item.getChild(0):item.parent().getChild(item.getIndex()+1);try{g.PAssert(3058,newItem,"Error getting new item: ",savedName)}catch(PERR){g.reportError(PERR)}savedName&&(this.savedItems[savedName]=newItem),this.selectedItem=newItem,this.setSelection(newItem,void 0,-1,0,cb)}.bind(this))}.bind(this))},delay:function delayFn(ms,cb){cb&&(this.needsFinish||0===ms?cb&&cb():(this.delayCb=cb,this.delayTimeout=setTimeout(function(){this.delayCb=this.delayTimeout=void 0,cb()}.bind(this),ms)))},selectItemInPane:function selectItemInPaneFn(paneIndex,itemIndex,cb){var pane=g.vmMain.paneManager.getPaneAtIndex(paneIndex),item=pane.itemAtIndex(itemIndex);this.selectedItem=item,cb()},dragTo:function dragToFn(paneIndexMove,paneIndexTarget,moveIndex,targetIndex,totalTime,cb){function ease(t){return.5>t?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1}function moveDrag(time){if(self.needsStop)return DragDrop.handleDragOver({target:targetEl,srcElement:targetEl,clientX:currentX,clientY:currentY}),g.fireMouseUp(moveEl,ButtonCode.Left),void(self.needsStop=!1);startTime||(startTime=time);var p=ease((time-startTime)/totalTime);currentX=targetX*p+srcRect.left+10,currentY=targetY*p+srcRect.top+5,moveItem.dragMove({eventX:currentX,eventY:currentY,diffY:targetY>srcRect.top?1:-1,preventDefault:g.emptyFn}),p>=1?(moveItem.dragEnd({srcElement:moveEl}),cb&&cb()):requestAnimationFrame(moveDrag)}var paneMove=g.vmMain.paneManager.getPaneAtIndex(paneIndexMove),paneTarget=g.vmMain.paneManager.getPaneAtIndex(paneIndexTarget),moveItem=paneMove.itemAtIndex(moveIndex),moveEl=paneMove.elementAtIndex(moveIndex),targetEl=paneTarget.elementAtIndex(targetIndex),srcRect=moveEl.getBoundingClientRect(),dstRect=targetEl.getBoundingClientRect(),targetX=dstRect.left-srcRect.left,targetY=dstRect.top-srcRect.top;paneMove.dragMarginTop&&(targetY-=paneMove.dragMarginTop),Sel.focusPane(paneMove);var currentX,currentY,startTime=null,self=this;DragDrop.startDragItem=moveItem,moveItem.dragStart({startSrc:moveEl,eventX:srcRect.left+10,eventY:srcRect.top+10}),requestAnimationFrame(moveDrag)},getItemIfString:function getItemIfStringFn(itemCandidate){var item;if(g.isString(itemCandidate)){item=d.getModel(itemCandidate)||this.savedItems[itemCandidate];try{g.PAssert(3070,item,"Item was not saved correctly")}catch(PERR){g.reportError(PERR)}}else if(itemCandidate){try{g.PAssert(3071,itemCandidate instanceof VMLI,"Must supply a valid VMLI: ",g.getObjectInfo(itemCandidate))}catch(PERR){g.reportError(PERR)}item=itemCandidate}return item},pushMessage:function pushMessageFn(text,cb){var msg;msg=g.messageQueue.pushMessage(g.isString(text)?{text:text,hold:!0}:text);var closeFn=function(){g.messageQueue.clearMessage(msg),window.removeEventListener("tapMain",closeFn)};window.addEventListener("tapMain",closeFn),cb&&cb()},notify:function notifyFn(text,cb){window.parent.postMessage(text,"*"),cb()},addClass:function addClassFn(cls,cb){g.addClass(document.documentElement||document.body,cls),cb()},removeClass:function removeClassFn(cls,cb){g.removeClass(document.documentElement||document.body,cls),cb()},demoKanban:function demoKanbanFn(id){function delay(value){s.queue(ActionType.Run,"delay",value)}var s=this.createScript(id);return delay(1500),q(s,"dragTo",0,1,3,3,1e3),delay(1500),q(s,"dragTo",1,2,2,1,1e3),delay(1500),q(s,"setSelection","helpSystem",2,0,0),q(s,"typeString",void 0," ",80),q(s,"setSelection","helpSystem",2,0,0),q(s,"typeString",void 0,"+Jay ",160),delay(1500),q(s,"setComplete","touchup",!0,new Date),delay(2e3),q(s,"pushMessage",MessageID.ThisIsDemo),q(s,"notify","done"),s},demoGTD:function demoGTDFn(id){function delay(value){s.queue(ActionType.Run,"delay",value)}var s=this.createScript(id);return delay(1500),q(s,"setSelection","tapContact",0,-1,0),q(s,"typeString",void 0," #mobile @today",80),delay(1500),q(s,"dragTo",0,1,0,3,1e3),delay(1500),q(s,"setSelection","tapTooltips",0,-1,0),q(s,"dragTo",0,1,0,1,1e3),delay(1500),q(s,"setSelection","tapSlide",0,-1,0),q(s,"typeString",void 0," #mobile @tomorrow",80),delay(1500),q(s,"dragTo",0,1,0,1,1e3),delay(2e3),q(s,"pushMessage",MessageID.ThisIsDemo),q(s,"notify","done"),s},demoProjectManagement:function demoProjectManagementFn(id){function delay(value){s.queue(ActionType.Run,"delay",value)}var s=this.createScript(id);return delay(1500),q(s,"setSelection","pressHold",0,-1,0),q(s,"typeString",void 0," #Android ",80),delay(1500),q(s,"setComplete","projectTouchup",!0,new Date),delay(1500),q(s,"setSelection","projectHelpSystem",0,0,0),q(s,"typeString",void 0,"+Jay ",160),delay(2e3),q(s,"pushMessage",MessageID.ThisIsDemo),q(s,"notify","done"),s},demoInboxZero:function demoInboxZeroFn(id){function delay(value){q(s,"delay",value)}var s=this.createScript(id);return delay(1500),q(s,"selectItemInPane",0,1),q(s,"dragTo",0,1,1,4,1e3),delay(1500),q(s,"selectItemInPane",0,0),q(s,"setComplete","emailContacts1",!0,(new Date).addDays(-2)),delay(1500),q(s,"selectItemInPane",0,1),q(s,"dragTo",0,1,1,1,1e3),delay(2e3),q(s,"pushMessage",MessageID.ThisIsDemo),q(s,"notify","done"),s},demoIntro:function demoIntroFn(id){function delay(value){s.queue(ActionType.Run,"delay",value)}var s=this.createScript(id);delay(2500),q(s,"addClass","showSecondPane"),q(s,"notify","showSecondPane"),delay(1500),q(s,"setSelection","first",1,-1,0),q(s,"typeString",void 0,"Work",30),addItem(s,"Website design","subproject",1,!1),addItem(s,"Update icons","task1",1,!1),addItem(s,"New flat buttons","task2",0,!1),addItem(s,"Home",void 0,-2,!1),addItem(s,"Take out the trash","homeFirst",1,!1),delay(1500),q(s,"notify","showEmails"),delay(1500),q(s,"selectItemInPane",0,1),q(s,"dragTo",0,1,1,2,1e3),delay(1700),q(s,"addClass","showThirdPane"),q(s,"notify","showAgenda"),delay(2e3),q(s,"setSelection","task1",1,-1,0),q(s,"typeString","task1"," @",80),delay(1e3),q(s,"typeString","task1","tomorrow",80),delay(1e3),q(s,"setSelection","task2",1,-1,0),q(s,"typeString","task2"," @",80),delay(1e3);var date=Date.today().addDays(4);return q(s,"typeString","task2",date.toString("MMM d"),80),delay(1e3),q(s,"selectItemInPane",1,2),q(s,"setPriority",void 0,VMLIFlag.P0),delay(1e3),q(s,"setSelection","homeFirst",1,-1,0),addItem(s,"Reference contacts +",void 0,0,!1),delay(1e3),q(s,"typeString","homeFirst","Jane Johnson",100),delay(1e3),addItem(s,"Use #tags to help you search",void 0,0,!1),delay(2e3),q(s,"addClass","demoIntroDone"),q(s,"notify","done"),s}},AScript}),define("VMSetup",["ko","data","globals","util","platform","goog","AScript"],function(ko,d,g,util,platform,goog,AScript){function VMSetup(){this.loginState=ko.observable(LoginState.NONE);var gapiLoaded=window.gapi&&window.gapi.auth;this.loginStatus=ko.observable(navigator.onLine?gapiLoaded?LoginStatus.Normal:LoginStatus.Loading:LoginStatus.Offline),gapiLoaded||window.addEventListener("gapiLoaded",function(){this.loginStatus()===LoginStatus.Loading&&this.loginStatus(LoginStatus.Normal)}.bind(this)),this.loginRequested=!1,this.loginRequestTimer=void 0}var LoginStatus={Normal:"Sign in with Google",Connecting:"Connecting...",LoggingIn:"Logging In...",Loading:"Loading...",Offline:"Offline"};return VMSetup.prototype={init:function initFn(){if(g.isDemoMode())return LoginState.LOGGED_OUT;var loginState=g.getLoginState();return this.setLoginState(loginState),g.applyBindings(this,"setup"),window.addEventListener("gapiLoaded",function(){try{g.PAssert(3072,window.gapi&&window.gapi.auth,"Must have gapi libs loaded correctly to receive gapiLoaded event")}catch(PERR){g.reportError(PERR)}this.loginRequested&&(this.loginStatus(LoginStatus.Normal),goog.getAccessToken(!0)?this.userLogin():this.loginRequested=!1)}.bind(this)),window.addEventListener("offline",function(){log("Browser going offline."),g.vmMain.setGDriveStatus(DriveStatus.Offline),this.loginStatus(LoginStatus.Offline)}.bind(this)),window.addEventListener("online",function(){if(log("Browser going online."),this.loginStatus(LoginStatus.Normal),this.loginRequested&&(goog.getAccessToken(!0)?this.userLogin():this.loginRequested=!1),g.getLoginState()==LoginState.LOGGED_IN&&!platform.offline){var alreadyOnline=goog.ensureDocConnection();log("Coming online. Already online:",alreadyOnline)}}.bind(this)),loginState},showGooglePlus:function showGooglePlusFn(){return this.loginStatus()===LoginStatus.Normal},logoutButtonText:function logoutButtonTextFn(){return g.isDemoMode()?"Leave Introduction":"LOGOUT"},setLoginState:function setLoginStateFn(state){state!=this.loginState()&&(g.setLoginState(state),this.loginState(state))},userLogin:function userLoginFn(){var gapiLoaded=window.gapi&&window.gapi.auth;gapiLoaded&&this.loginStatus()===LoginStatus.Normal&&this.loginState()!=LoginState.LOGGED_IN?(this.loginStatus(LoginStatus.LoggingIn),this.loginRequested=!1,goog.runAuthenticate(goog.requiredScopes,!1,!0,function(token){this.loginStatus(LoginStatus.Normal),token&&!token.error?(g.settings.set(Settings.localIntegrity,!0),this.setLoginState(LoginState.LOGGED_IN),gapi.load("drive-realtime",function(){goog.loadClientDefaultFile()})):log("Invalid token returned when calling userLogin")}.bind(this))):(this.loginStatus(LoginStatus.Connecting),this.loginRequested=!0),clearTimeout(this.loginRequestTimer),this.loginRequestTimer=setTimeout(function(){this.loginStatus(navigator.onLine?LoginStatus.Normal:LoginStatus.Offline),this.loginRequested=!1}.bind(this),500)},openLogin:function openLoginFn(){this.loginState(LoginState.NONE)},logout:function logoutFn(){this.setLoginState(LoginState.LOGGED_OUT),d.clearData(function(){util.storage.clear(),setTimeout(function(){util.hasURLParam("login")?util.removeURLParam("login"):util.hasURLParam("user")?util.removeURLParam("user"):platform.app?platform.app&&g.nativeBridge.sendToApp("logout"):g.reload()},0)})},logoutClicked:function logoutClickedFn(){if(g.isDemoMode())util.removeURLParam("demo");else{var ok=!0;for(var itemID in d.pendingRemoteUpdates)if(d.pendingRemoteUpdates.hasOwnProperty(itemID)){g.menus.confirm("You have unsaved changes which will be lost if you log out. Are you sure?",function(result){result&&this.logout()}.bind(this)),ok=!1;break}ok&&this.logout()}},isLocal:function isLocalFn(){return"localhost"==window.location.hostname},onlineStatusToggle:function onlineStatusToggleFn(){platform.offline?util.removeURLParam("offline"):util.insertURLParam("offline","true")},runScript:function runScriptFn(id){g.AScript||(g.AScript=new AScript),g.AScript.runScript(id,!0)},onTapLogin:function onTapLoginFn(e){this.loginStatus()===LoginStatus.Normal&&this.userLogin(),platform.mobile&&e&&(e.preventDefault(),e.stopPropagation(),g.preventClick())},onTapLanding:function onTapLandingFn(e){(platform.mobile||g.hasClass(e.srcElement,"link"))&&g.openUrl("/",e)},onPrivacyPolicy:function onPrivacyPolicyFn(e){(platform.mobile||g.hasClass(e.srcElement,"link"))&&g.openUrl("/privacy/",e)},onEmailKeydown:function onEmailKeydownFn(data,e){return e.normCode===KeyCode.Enter?(this.onTapLogin(e),e.preventDefault(),e.stopImmediatePropagation(),!1):!0}},VMSetup}),define("SettingsManager",["ko","globals","util","EventDispatcher"],function(ko,g,util,EventDispatcher){function SettingsManager(){this._versions={},this._values={},this._changeListeners=[],this._localLoaded=!1,this._localLoadError=!1,this._localWriteError=!1,this._remoteLoaded=!1,this._remoteLoadError=!1,this._remoteSettings=void 0,this.init()}var CURRENT_VERSION=1,LocalSettingProp="localSettings",DefaultGroup="Default",UnsetVersion=-1,RemoteKey=0,RemoteValue=1;return SettingsManager.prototype={init:function initFn(){this._testLocalWrites(),this.registerGroup(DefaultGroup),this.registerSetting(Settings.theme,DefaultGroup,!0),this.registerSetting(Settings.syncContacts,DefaultGroup,!0),this.registerSetting(Settings.shownTutorial,DefaultGroup,!0),this.registerSetting(Settings.rootFolderId,DefaultGroup,!0),this.registerSetting(Settings.lastContactSync),this.registerSetting(Settings.disableNotifications),this.registerSetting(Settings.authScopes),this.registerSetting(Settings.localIntegrity),this.registerSetting(Settings.localDataVersion),this.registerSetting(Settings.gdocId),this.registerSetting(Settings.gdocTitle),this.registerSetting(Settings.activeUser),this.registerSetting(Settings.noSounds),this.registerSetting(Settings.lastServerVersion),this.registerSetting(Settings.helpPaneState),this.registerSetting(Settings.oauthScheme),this.registerSetting(Settings.premiumStatus),this.registerSetting(Settings.trialStart),this.registerSetting(Settings.trialDuration),this.registerSetting(Settings.premiumEndDate),this.registerSetting(Settings.notifiedTrialOver),this.registerSetting(Settings.notifiedTrialEndSoon),this._setupLocalNotifications(),this._ensureLocalLoaded(),this._ensureRemoteSettings()},_setupLocalNotifications:function _setupLocalNotificationsFn(){g.shouldWriteLocal()&&window.addEventListener("storage",function(e){if(e||(e=window.event),e.key===LocalSettingProp){var oldParsedValue,newParsedValue;try{if(e.oldValue&&(oldParsedValue=this._deserializeSettings(e.oldValue)),e.newValue&&(newParsedValue=this._deserializeSettings(e.newValue)),oldParsedValue&&newParsedValue){try{g.PAssert(3075,oldParsedValue.values,"Must have a valid set of old settings")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3076,newParsedValue.values,"Must have a valid set of new settings")}catch(PERR){g.reportError(PERR)}for(var i=0;i<this._changeListeners.length;++i){var entry=this._changeListeners[i];try{g.PAssert(3077,entry,"Each listener must have a valid entry")}catch(PERR){g.reportError(PERR)}var oldGroup=oldParsedValue.values[entry.groupID],newGroup=newParsedValue.values[entry.groupID],oldValue,newValue;oldGroup&&newGroup?(oldValue=oldGroup[entry.key],newValue=newGroup[entry.key]):!oldGroup&&newGroup?(oldValue=void 0,newValue=newGroup[entry.key]):oldGroup&&!newGroup&&(oldValue=oldGroup[entry.key],newValue=void 0),oldValue!==newValue&&entry.fn(oldValue,newValue)}}}catch(err){g.reportError(err)}if(this._localLoaded=!1,newParsedValue)this._loadLocalSettings(newParsedValue);else try{g.PAssert(3078,!1,"Unable to update settings to be empty")
}catch(PERR){g.reportError(PERR)}}}.bind(this),!1)},registerForChangeNotification:function registerForChangeNotificationFn(key,groupID,fn){try{g.PAssert(3079,key,"Must provide a valid key to watch")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3080,fn&&g.isFunction(fn),"Must provide a valid callback fn",fn)}catch(PERR){g.reportError(PERR)}groupID=groupID||DefaultGroup,this._changeListeners.push({key:key,groupID:groupID,fn:fn})},_testLocalWrites:function _testLocalWritesFn(){var localAvailable=!1;try{util.storage.setItem("poke",0),localAvailable=!0}catch(err){g.preventLocalWrites()}return localAvailable},registerGroup:function registerGroupFn(groupID){this._versions[groupID]||(this._versions[groupID]={},this._values[groupID]={})},registerSetting:function registerSettingFn(key,groupID,syncRemote){groupID=groupID||DefaultGroup,syncRemote=syncRemote||!1;try{g.PAssert(3082,this._versions[groupID],"Must first register a group before a setting in the group")}catch(PERR){g.reportError(PERR)}this._versions[groupID][key]||(this._versions[groupID][key]={version:UnsetVersion,syncRemote:syncRemote})},get:function getFn(key,groupID){groupID=groupID||DefaultGroup;try{g.PAssert(3084,key,"Must specify a valid setting to get")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3085,this._versions[groupID],"Must first register a group before getting a setting from it")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3086,!this._versions[groupID]||void 0!==this._versions[groupID][key],"Must first register a setting before getting a value from it: "+key)}catch(PERR){g.reportError(PERR)}return this._ensureLocalLoaded(),this._values[groupID][key]},set:function setFn(key,value,groupID){groupID=groupID||DefaultGroup;try{g.PAssert(3087,key,"Must specify a valid setting to get")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3088,this._versions[groupID],"Must first register a group before getting a setting from it")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3089,!this._versions[groupID]||void 0!==this._versions[groupID][key],"Must first register a setting before setting a value to it")}catch(PERR){g.reportError(PERR)}var performWrite=!1;this._ensureLocalLoaded();var localValue=this._values[groupID][key],localVersion=this._versions[groupID][key].version;if((localValue!==value||g.isObject(value))&&(performWrite=!0),performWrite){var syncRemote=this._versions[groupID][key].syncRemote,newVersion=localVersion+1;syncRemote&&this._remoteLoaded&&this._setRemoteValue(key,value,newVersion,groupID),this._values[groupID][key]=value,this._versions[groupID][key].version=newVersion,this._writeLocalSettings(),this._sendChangeNotification(groupID,key,localValue,value)}},reset:function resetFn(key,groupID){groupID=groupID||DefaultGroup;try{g.PAssert(3090,key,"Must specify a valid setting to get")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3091,void 0!==this._versions[groupID],"Must first register a group before getting a setting from it")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3092,this._versions[groupID][key].syncRemote===!1,"Currently do not support resetting remote syncd settings")}catch(PERR){g.reportError(PERR)}this._ensureLocalLoaded();var oldValue=this._values[groupID][key];delete this._values[groupID][key],this._writeLocalSettings(),this._sendChangeNotification(groupID,key,oldValue,void 0)},resetAll:function resetAllFn(skipList){try{g.PAssert(3094,!g.isArray(skipList),"Must pass in a valid settings object to skip")}catch(PERR){g.reportError(PERR)}if(g.isArray(skipList)){var defaultSettingsSkip=skipList;skipList={},skipList[DefaultGroup]=defaultSettingsSkip}for(var groupID in this._versions){var group=this._versions[groupID],groupSkip=skipList?skipList[groupID]:void 0;for(var propID in group)(!groupSkip||groupSkip.indexOf(propID)<0)&&(this._versions[groupID][propID].version=UnsetVersion,this._values[groupID][propID]=void 0)}if(skipList)this._writeLocalSettings();else if(g.shouldWriteLocal())try{util.storage.setItem(LocalSettingProp,"{}")}catch(err){g.reportError(err)}},_ensureLocalLoaded:function _ensureLocalLoadedFn(){if(g.shouldWriteLocal()&&!this._localLoaded)try{var storValue=util.storage.getItem(LocalSettingProp);storValue||(g.isFirstRun=!0),this._loadLocalSettings(this._deserializeSettings(storValue))}catch(err){g.reportError(err),this._localLoadError=!0}},_serializeSettings:function _serializeSettingsFn(){var out={__version:CURRENT_VERSION,versions:{},values:{}};for(var groupID in this._versions){var group=this._versions[groupID];for(var propID in group){var pVersion=this._versions[groupID][propID].version,pValue=this._values[groupID][propID];this._versions[groupID][propID].syncRemote&&(out.versions[groupID]||(out.versions[groupID]={}),out.versions[groupID][propID]=pVersion),out.values[groupID]||(out.values[groupID]={}),void 0!==pValue&&(out.values[groupID][propID]=pValue)}}return out},_deserializeSettings:function _deserializeSettingsFn(settings){var out={versions:{},values:{}};if(settings)try{var settingsObj=JSON.parse(settings);if(void 0===settingsObj.__version){var VersionPrefix="V~";out.versions[DefaultGroup]={},out.values[DefaultGroup]={};for(var prop in settingsObj)if(prop.startsWith(VersionPrefix)){var ver=settingsObj[prop];out.versions[DefaultGroup][prop.substr(VersionPrefix.length)]=ver}else{var value=settingsObj[prop];out.values[DefaultGroup][prop]=value}}else if(settingsObj.__version===CURRENT_VERSION)out.versions=settingsObj.versions,out.values=settingsObj.values;else try{g.PAssert(3095,!1,"Invalid settings version")}catch(PERR){g.reportError(PERR)}}catch(err){g.reportError(err)}return out},_loadLocalSettings:function _loadLocalSettingsFn(parsedSettings){try{g.PAssert(3096,!this._localLoaded,"Should not load settings from local twice")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3097,parsedSettings,"Must supply some valid parsed settings")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3098,!parsedSettings||parsedSettings.versions,"Must have a valid constructed parsed settings - versions")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3099,!parsedSettings||parsedSettings.values,"Must have a valid constructed parsed settings - values")}catch(PERR){g.reportError(PERR)}var versions=parsedSettings.versions,values=parsedSettings.values;for(var groupID in versions){var group=versions[groupID];this._versions[groupID]||(this._versions[groupID]={});for(var propID in group)this._versions[groupID][propID]={version:group[propID],syncRemote:!0}}for(var groupID in values){var group=values[groupID];this._values[groupID]||(this._values[groupID]={});for(var propID in group)this._values[groupID][propID]=group[propID]}this._localLoaded=!0,this._localLoadError=!1},_writeLocalSettings:function _writeLocalSettingsFn(){if(g.shouldWriteLocal())try{var writeSettings=this._serializeSettings();util.storage.setItem("localSettings",JSON.stringify(writeSettings))}catch(err){g.reportError(err);try{util.storage.setItem("localSettings","{}")}catch(err2){g.reportError(err2)}this._localWriteError=!0}},_ensureRemoteSettings:function _ensureRemoteSettingsFn(){this._remoteRequested||this._remoteLoaded||g.vmMain&&g.vmMain.realtimeDocManager&&(this._remoteRequested=!0,g.vmMain.realtimeDocManager.registerForReadyNotification(DocType.GAppData,function(){this._remoteSettings=g.vmMain.realtimeDocManager.createDocument(DocType.GAppData,"RemoteSettings"),this._remoteSettings.open("RemoteSettings",this._onRemoteLoad.bind(this),this._onRemoteInit.bind(this),this._onRemoteError.bind(this))}.bind(this)))},_getRemoteEntry:function _getRemoteEntryFn(key,groupID){if(this._remoteLoaded){var model=this._remoteSettings.getModel(),settingsRoot=model.getRoot().get("settings"),group=settingsRoot.get(groupID);if(group){var entry=group.get(key);return entry}}return void 0},_getRemoteValue:function _getRemoteValueFn(key,groupID){var entry=this._getRemoteEntry(key,groupID);return entry?entry.value:void 0},_getRemoteVersion:function _getRemoteVersionFn(key,groupID){var entry=this._getRemoteEntry(key,groupID);return entry?entry.ver:UnsetVersion},_setRemoteValue:function _setRemoteValueFn(key,value,version,groupID){if(groupID=groupID||DefaultGroup,this._remoteLoaded){var model=this._remoteSettings.getModel(),settingsRoot=model.getRoot().get("settings"),group=settingsRoot.get(groupID);group||(group=model.createMap(),settingsRoot.set(groupID,group)),group.set(key,{value:value,ver:version})}},_sendChangeNotification:function _sendChangeNotificationFn(groupID,key,oldValue,newValue){this.fireEvent(groupID,key,[oldValue,newValue]);for(var i=0;i<this._changeListeners.length;++i){var listener=this._changeListeners[i];if(groupID===listener.groupID&&key===listener.key)try{listener.fn(oldValue,newValue)}catch(err){g.reportError(err)}}},_findGroupForMap:function _findGroupForMapFn(settingsMap,groupMap){for(var items=settingsMap.items(),i=0;i<items.length;++i)if(items[i][RemoteValue]===groupMap)return items[i][RemoteKey];return void 0},_onRemoteSettingsChange:function _onRemoteSettingsChangeFn(change){for(var i=0;i<change.events.length;++i){var ev=change.events[i];if(!ev.isLocal){var groupID=this._findGroupForMap(change.currentTarget,ev.target);groupID&&this._remoteSettingLoaded(ev.property,ev.newValue.value,ev.newValue.ver,groupID)}}},_remoteSettingLoaded:function _remoteSettingLoadedFn(key,remoteValue,remoteVersion,groupID){try{g.PAssert(3101,groupID,"Must specify a valid groupID at this point")}catch(PERR){g.reportError(PERR)}this._versions[groupID]||this.registerGroup(groupID),this._versions[groupID][key]||this.registerSetting(key,groupID,!0);var localValue=this._values[groupID][key],localVersion=this._versions[groupID][key].version;if(remoteVersion>localVersion)this._values[groupID][key]=remoteValue,this._versions[groupID][key].version=remoteVersion,this._sendChangeNotification(groupID,key,localValue,remoteValue);else if(localVersion>remoteVersion)this._setRemoteValue(key,localValue,localVersion,groupID);else if(remoteVersion===localVersion)try{g.PAssert(3102,localValue===remoteValue,"Should match if the versions are the same")}catch(PERR){g.reportError(PERR)}else try{g.PAssert(3103,!1,"What - remote and local versions are messed up",remoteVersion,localVersion)}catch(PERR){g.reportError(PERR)}},_onRemoteLoad:function _onRemoteLoadFn(doc){try{g.PAssert(3104,this._localLoaded,"Local settings must be loaded before remote")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3105,this._remoteRequested,"Remote document must have been requested")}catch(PERR){g.reportError(PERR)}this._remoteLoaded=!0;var updatedLocal=!1,updatedRemote=!1,model=doc.getModel();model.beginCompoundOperation("Sync Settings",!1);var root=model.getRoot(),settings=root.get("settings"),info=root.get("info");try{for(var groups=settings.items(),i=0;i<groups.length;++i)for(var groupID=groups[i][RemoteKey],group=groups[i][RemoteValue],props=group.items(),j=0;j<props.length;++j){var propID=props[j][RemoteKey],prop=props[j][RemoteValue],pValue=prop.value,pVersion=prop.ver;updatedLocal|=this._remoteSettingLoaded(propID,pValue,pVersion,groupID)}for(var groupID in this._versions){var group=this._versions[groupID];for(var propID in group)if(this._versions[groupID][propID].syncRemote&&this._versions[groupID][propID].version!==UnsetVersion){var remoteGroup=settings.get(groupID);remoteGroup||(remoteGroup=model.createMap(),settings.set(groupID,remoteGroup));var remoteProp=remoteGroup.get(propID);remoteProp||(remoteProp={value:this._values[groupID][propID],ver:this._versions[groupID][propID].version},remoteGroup.set(propID,remoteProp),updatedRemote=!0)}}}catch(err){g.reportError(err)}model.endCompoundOperation(),settings.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,this._onRemoteSettingsChange.bind(this)),updatedLocal&&this._writeLocalSettings()},_onRemoteError:function _onRemoteErrorFn(err){try{g.PAssert(3106,this._localLoaded,"Local settings must be loaded before remote")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3107,this._remoteRequested,"Remote document must have been requested")}catch(PERR){g.reportError(PERR)}this._remoteLoaded=!1,this._remoteLoadError=!0},_onRemoteInit:function _onRemoteInitFn(model){try{g.PAssert(3108,this._localLoaded,"Local settings must be loaded before remote")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3109,this._remoteRequested,"Remote document must have been requested")}catch(PERR){g.reportError(PERR)}var root=model.getRoot(),settings=model.createMap(),info=model.createMap();info.set("settingsVer",1),root.set("settings",settings),root.set("info",info)},getRawSettings:function getRawSettingsFn(){var rawSettings;if(g.shouldWriteLocal())try{rawSettings=util.storage.getItem("localSettings")}catch(err){g.reportError(err)}else try{return JSON.stringify(this._serializeSettings())}catch(err){return g.reportError(err),'{m:"Invalid Settings"}'}return rawSettings},_dumpSettings:function _dumpSettingsFn(){log("---- Settings ----"),log("Versions: ",this._versions),log("Values: ",this._values)}},util.defineBase(SettingsManager),util.extend(SettingsManager.prototype,EventDispatcher),g.settings=new SettingsManager,g.settings}),define("parse",["globals","VMLI","tracker","data"],function(g,VMLI,tracker,d){function parse(){}return parse.prototype={parseHead:function parseHeadFn(node){for(var props={},i=0;i<node.childElementCount;++i){var prop=node.children[i],propName=prop.nodeName;if(prop.firstChild){var propValue=prop.firstChild.textContent;props[propName]=propValue}}return props},parseOPML:function parseOPMLFn(data,filename){function visit(node,parentModel){var visitChildren=!0,nodeModel;switch(node.nodeName){case"#document":case"body":case"opml":break;case"head":visitChildren=!1;var ret=this.parseHead(node);ret&&ret.title&&!rootModel&&(rootModel=d.createVMLI({text:ret.title},{parent:d.getRootModel(),changeType:ChangeType.AllLocal}),d.getRootModel().insertItem(rootModel));break;case"outline":parentModel||(rootModel?parentModel=rootModel:(parentModel=rootModel=d.createVMLI({text:filename},{parent:d.getRootModel(),changeType:ChangeType.AllLocal}),d.getRootModel().insertItem(rootModel)));var itemTextAttr=node.attributes.text,itemText=itemTextAttr?itemTextAttr.value:"";nodeModel=d.createVMLI({text:itemText},{parent:parentModel,changeType:ChangeType.AllLocal}),parentModel.insertItem(nodeModel);break;default:log("Unknown OPML Node: ",node)}if(visitChildren)for(var i=0;i<node.childElementCount;++i)visit(node.children[i],nodeModel);return nodeModel}var rootModel;return tracker.beginAction(),visit(data),tracker.endAction(),!0},parseJSON:function parseJSONFn(data,root){function visit(node,parentModel){var nodeParent=parentModel||root||d.getRootModel(),nodeData={text:node.text,dateCompleted:node.dateCompleted,priority:node.priority,isComplete:node.isComplete,isStarred:node.isStarred},nodeModel=d.createVMLI(nodeData,{parent:nodeParent,changeType:ChangeType.AllLocal});if(nodeParent.insertItem(nodeModel),node.items)for(var i=0;i<node.items.length;++i)visit(node.items[i],nodeModel)}var dataVersion;if(void 0!==data.moodoVer&&void 0!==data.moodoRoot)try{dataVersion=parseInt(data.moodoVer),tracker.beginAction();var docRoot=data.moodoRoot;if(docRoot.items)for(var i=0;i<docRoot.items.length;++i)visit(docRoot.items[i]);return tracker.endAction(),!0}catch(err){g.reportError(err)}else if(void 0!==data.text&&void 0!==data.items)try{return tracker.beginAction(),visit(data),tracker.endAction(),!0}catch(err){}return!1},stripParents:function stripParentsFn(item){if(item.parent=void 0,item.items)for(var i=0;i<item.items.length;i++)this.stripParents(item.items[i])},parseClassName:function parseClassNameFn(className,v){return className?(className.indexOf("high")>=0?v.priority=VMLIFlag.P0:className.indexOf("medium")>=0?v.priority=VMLIFlag.P1:className.indexOf("low")>=0&&(v.priority=VMLIFlag.P2),className.indexOf("complete")>=0&&(v.isComplete=!0),className.indexOf("starred")>=0&&(v.isStarred=!0),v):void 0},traverseDOM:function traverseDOMFn(options){function visit(node){if(node.nodeType===Node.TEXT_NODE){(reallyNeedsNewItem||needsNewItem)&&(currentLine.text=currentLine.text.trim(),""!==currentLine.text&&(newItem={text:"",parent:currentLine.parent},_this.parseClassName(newItemClass,newItem),currentLine.parent.items.push(newItem),currentLine=newItem)),reallyNeedsNewItem=!1,needsNewItem=!1;var addText=node.nodeValue.replace(/[\ud800-\udfff]+/g,"");""===currentLine.text&&(addText=addText.replace(/^\s+/g,"")),_this.parseClassName(newItemClass,currentLine),currentLine.text+=addText}else node.nodeType===Node.COMMENT_NODE||("BR"===node.tagName||"P"===node.tagName||"LI"===node.tagName||"DIV"===node.tagName?(needsNewItem=!0,newItemClass=node.className):("UL"===node.tagName||"OL"===node.tagName)&&(currentLine.text=currentLine.text.trim(),newItem={text:"",parent:currentLine},_this.parseClassName(newItemClass,newItem),currentLine.items?currentLine.items.push(newItem):currentLine.items=[newItem],currentLine=newItem,needsNewItem=!1,newItemClass=""))}function end(node){node.nodeType!==Node.TEXT_NODE&&("UL"===node.tagName||"OL"===node.tagName?(currentLine=currentLine.parent,reallyNeedsNewItem=!0):("DIV"===node.tagName||"P"===node.tagName)&&(needsNewItem=!0,newItemClass=""))}function print(r,levelsDeep){isNaN(levelsDeep)&&(levelsDeep=0);for(var text="",i=0;levelsDeep>i;i++)text+="--";if(levelsDeep&&console.log(text,r.text),r.items)for(var i=0;i<r.items.length;i++)print(r.items[i],levelsDeep+1)}var root=options.root,doStripParents=options.stripParents,shouldPrint=options.shouldPrint,n=root.firstChild,rootNode={items:[]},currentLine={text:"",parent:rootNode};rootNode.items.push(currentLine);var newItem,needsNewItem=!1,reallyNeedsNewItem=!1,newItemClass,_this=this,c;do if(visit(n),c=n.firstChild)n=c;else if(c=n.nextSibling)n=c;else{do c=n.parentNode.nextSibling,c?(end(n.parentNode),n=c):(n=n.parentNode,end(n));while(!c&&n&&n.parentNode);if(!c)break}while(n);return doStripParents&&this.stripParents(rootNode),shouldPrint&&print(rootNode),rootNode}},new parse}),define("copypaste",["ko","globals","platform","data","android","edit","VMLI","tracker","parse","NativeSel","Sel"],function(ko,g,platform,d,android,edit,VMLI,tracker,parse,NativeSel,Sel){function copypaste(){}return copypaste.prototype={init:function initFn(){try{g.PAssert(3110,"complete"===document.readyState||"interactive"===document.readyState,"Setting up copy/paste too early")}catch(PERR){g.reportError(PERR)}document.body.addEventListener("paste",this.handlepaste.bind(this),!1),document.body.addEventListener("cut",this.handlecut.bind(this),!1),document.body.addEventListener("copy",this.handlecopy.bind(this),!1)},killEvent:function killEventFn(e){try{g.PAssert(3111,e.preventDefault,"Should always be defined")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3112,e.stopPropagation,"Should always be defined")}catch(PERR){g.reportError(PERR)}e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()},insertToNote:function insertToNoteFn(startItem,endItem,text){try{g.PAssert(3113,startItem,"Must have a valid start item")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3114,endItem,"Must have a valid end item")}catch(PERR){g.reportError(PERR)}var itemText=startItem.getParsedText();tracker.beginAction();var newText;newText=endItem===startItem?itemText.substring(0,Sel.getStartOffset())+text+itemText.substring(Sel.getEndOffset()):itemText.substring(0,Sel.getStartOffset())+text,startItem.setText(newText,!0,ChangeType.Local),tracker.endAction()},insert:function insertFn(data,e,source){if(!Sel.isValid())return!1;var clipboardBuffer="",dataTypeText=platform.ie?"Text":"text/plain",lastItem,selOffset,traversed;if(source===DataSource.Plugin)traversed={items:[{text:data}]};else if(data&&data.getData){if(tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.Paste,data:[{value:!0}]}),this.killEvent(e),!platform.ie&&(clipboardBuffer=data.getData("text/html"))){if(!clipboardBuffer)return;var node=document.createElement("div"),replacedText=clipboardBuffer.replace(/[\n\t]/g," ").replace(/[\r]|<head(.|\s)*?\/head>|<script(.|\s)*?\/script>|<style(.|\s)*?\/style>/g,"").replace(/\s+/g," ").replace(/onload/gi,"never"),bodyRegex=/<body(.|\s)*?\/body>/g,bodyMatch;(bodyMatch=bodyRegex.exec(replacedText))&&(replacedText=bodyMatch[0]),node.innerHTML=replacedText,Sel.getStartItem().isNote()?this.insertToNote(Sel.getStartItem(),Sel.getEndItem(),node.innerText):(traversed=parse.traverseDOM({root:node,shouldPrint:!1,stripParents:!0}),1===traversed.items.length&&""===traversed.items[0].text&&(traversed=traversed.items[0]))}else if(clipboardBuffer=data.getData(dataTypeText)){var isXML=clipboardBuffer.startsWith("<?xml "),isOPML=clipboardBuffer.startsWith("<?opml "),xml;if((isXML||isOPML)&&(xml=g.loadXML(clipboardBuffer)),xml){if(isXML)return g.messageQueue.pushMessage({text:"We currently do not support pasting XML. If you need to import XML please tell us",action:MessageAction.Contact,hold:!0}),!1;if(isOPML)return parse.parseOPML(xml,"OPML Import"),!1}else{if(clipboardBuffer.startsWith("{")&&clipboardBuffer.endsWith("}"))try{var jsonData=JSON.parse(clipboardBuffer),res=parse.parseJSON(jsonData,Sel.getStartItem().parent());if(res)return!1}catch(err){}var replacedText=clipboardBuffer.replace(/[\t]/g," ");if(Sel.getStartItem().isNote())this.insertToNote(Sel.getStartItem(),Sel.getEndItem(),replacedText);else{var traversedText=replacedText.split("\n");traversed={items:[]};for(var i=0;i<traversedText.length;i++)if(0!==traversedText[i].length){var str=g.trimString(traversedText[i].replace(/[\ud800-\udfff]+/g,""));traversed.items.push({text:str,parent:traversed})}}}}else try{g.PAssert(3115,!1,"Paste with unexpected data type",data.types)}catch(PERR){g.reportError(PERR)}if(!traversed||!traversed.items||0===traversed.items.length)return!1}if(traversed){tracker.beginAction(),g.vmMain.beginUpdateItems();var itemStart=Sel.getStartItem(),itemEnd=Sel.getEndItem(),itemParent=Sel.getStartItem().parent(),itemIndex=Sel.getStartItem().getIndex(),sText=Sel.getStartItem().getParsedText(),eText=Sel.getEndItem().getParsedText();if(itemStart!==itemEnd&&(itemEnd.isNote()&&(itemEnd=itemEnd.parent()),itemStart!==itemEnd&&edit.handleMultiselect({normCode:KeyCode.BackSpace,preventDefault:g.emptyFn,stopPropagation:g.emptyFn,stopImmediatePropagation:g.emptyFn})),lastItem=itemStart,1!==traversed.items.length||traversed.items[0].items){ShouldLog(LogLevels.Timing)&&console.time("paste");var mutations=[],allowFirstItemSplit=!itemStart.hasChildren()&&Sel.getStartOffset()>0&&Sel.getEndOffset()<eText.length;!allowFirstItemSplit&&Sel.getStartOffset()>0&&itemIndex++;for(var i=0;traversed&&i<traversed.items.length;++i){var itemInfo=traversed.items[i];if(itemInfo.text=itemInfo.text.trim(),""!==itemInfo.text||itemInfo.items)if(0===i&&allowFirstItemSplit){if(itemInfo.text=sText.substring(0,Sel.getStartOffset())+itemInfo.text,itemStart.setText(itemInfo.text,!0,ChangeType.Local),tracker.performAction(TrackerType.Insert,{itemID:itemStart.id,position:0,text:itemInfo.text}),itemIndex++,itemInfo.items){for(var u=0;u<itemInfo.items.length;++u){var child=itemInfo.items[u];if(""!==child.text||child.items){var newItem=d.createVMLI(child,{parent:itemStart,changeType:ChangeType.AllLocal});itemStart.insertItem(newItem),lastItem=newItem}}mutations.indexOf(itemStart)<0&&mutations.push(itemStart)}}else{var newItem=d.createVMLI(itemInfo,{parent:itemParent,changeType:ChangeType.AllLocal});itemParent.insertItem(newItem,itemIndex++,!0),lastItem=newItem,mutations.indexOf(itemParent)<0&&mutations.push(itemParent),tracker.performAction(TrackerType.Create,{itemID:newItem.id,parent:itemParent.id,position:itemIndex-1,text:newItem.getParsedText()})}}for(;lastItem.hasChildren();)lastItem=lastItem.getLastChild();selOffset=lastItem.getParsedText().length,allowFirstItemSplit&&lastItem.setText(lastItem.getParsedText()+eText.substring(Sel.getEndOffset().endText),!0,ChangeType.Local)}else{var iText=traversed.items[0].text.trim(),str=sText.substring(0,Sel.getStartOffset())+iText+eText.substring(Sel.getEndOffset());tracker.performAction(TrackerType.Remove,{itemID:itemStart.id,position:0,text:itemStart.getParsedText()}),itemStart.setText(str,!0,ChangeType.Local),tracker.performAction(TrackerType.Insert,{itemID:itemStart.id,position:0,text:str}),selOffset=Sel.getStartOffset()+iText.length}g.vmMain.commitUpdateItems(),tracker.endAction(),ShouldLog(LogLevels.Timing)&&console.timeEnd("paste")}return lastItem&&(Sel.selectItem(lastItem,selOffset),g.focusedPane.scrollItemIntoView(lastItem,ScrollDuration.Snap)),!1},handlepaste:function handlepasteFn(e){if(e.srcElement||(e.srcElement=e.target),!e.synthetic&&android.isEnabled())return android.handlePaste(),!0;var clipData=e&&e.clipboardData?e.clipboardData:e.synthetic?e.data:window.clipboardData;return this.insert(clipData,e,DataSource.Paste)},handlecut:function handlecutFn(e){var copySuccess=!this.handlecopy(e);return copySuccess?(edit.keydown(void 0,{normCode:KeyCode.BackSpace,preventDefault:g.emptyFn,stopPropagation:g.emptyFn,stopImmediatePropagation:g.emptyFn}),!1):!0},padText:function padTextFn(text,deep){for(var i=0;deep>i;++i)text="    "+text;return text},printLI:function printLIFn(item,startOffset,endOffset){var text;text=isNaN(startOffset)||isNaN(endOffset)?isNaN(startOffset)?isNaN(endOffset)?item.getParsedText():item.getParsedText().substring(0,endOffset):item.getParsedText().substring(startOffset):item.getParsedText().substr(startOffset,endOffset-startOffset);var cls=[],pri=item.priority();return pri&&(pri===VMLIFlag.P0?cls.push("high"):pri===VMLIFlag.P1?cls.push("medium"):pri===VMLIFlag.P2&&cls.push("low")),item.isComplete()&&cls.push("complete"),item.isStarred()&&cls.push("starred"),{html:"<li"+(cls.length>0?' class="'+cls.join(" ")+'"':"")+">"+text+"</li>",plain:text}},handlecopy:function handlecopyFn(e){if(!android.isEnabled()){var dataType=platform.ie?"Text":"text/plain",clipData=e&&e.clipboardData?e.clipboardData:window.clipboardData;if(clipData)if(e.srcElement||(e.srcElement=e.target),!platform.mobile&&g.isAncestor(e.srcElement,document.getElementById("exportedArea"))){if(!NativeSel.hasRawSelection())return!0;var outDataText=e.srcElement.innerText;clipData.setData(dataType,outDataText);var outDataHTML=e.srcElement.innerHTML;clipData.setData("text/html",outDataHTML)}else{if(!Sel.isValid())return!0;if(!Sel.getPane().overrideCopyBehavior)return!0;var item=Sel.getStartItem(),endItem=Sel.getEndItem();try{g.PAssert(3116,item&&endItem,"Must have valid item selections")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3117,item instanceof VMLI&&endItem instanceof VMLI,"Items must be valid VMLIs")}catch(PERR){g.reportError(PERR)}var createHTML=!platform.ie,html,plain,text;if(item===endItem)text=Sel.getStartOffset()===Sel.getEndOffset()?this.printLI(item):this.printLI(item,Sel.getStartOffset(),Sel.getEndOffset()),createHTML&&(html=text.html),plain=text.plain;else{var deep=0;text=this.printLI(item,Sel.getStartOffset()),deep++,createHTML&&(html="<ul>"+text.html),plain=text.plain;do{var nextOptions={numLevels:0};if(item=g.getNextItem(item,g.focusedPane,nextOptions)){for(nextOptions.numLevels>0&&(createHTML&&(html+="<ul>"),deep++);nextOptions.numLevels<0&&deep>=0;)createHTML&&(html+="</ul>"),deep--,nextOptions.numLevels++;0>=deep&&(createHTML&&(html+="<ul>"),deep++),item!==endItem?(text=this.printLI(item),createHTML&&(html+=text.html)):(text=this.printLI(item,0,Sel.getEndOffset()),createHTML&&(html+=text.html+"</ul>"),deep--)}plain+="\r\n"+this.padText(text.plain,deep-1)}while(item!==endItem);for(;deep>0;)createHTML&&(html+="</ul>"),deep--}createHTML&&html&&clipData.setData("text/html",html),clipData.setData(dataType,plain)}return platform.ios||this.killEvent(e),tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.Copy,data:[{value:!0}]}),!1}}},new copypaste}),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("React",[],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.React=e()}}(function(){return function e(t,n,r){function o(a,s){if(!n[a]){if(!t[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(i)return i(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,n){var r=e(25),o=e(31),i=e(42),a=e(34),s=e(67),u=e(95),l=e(97),c=e(124),p=e(119),d=e(165);o.addons={CSSTransitionGroup:a,LinkedStateMixin:r,PureRenderMixin:i,TransitionGroup:u,batchedUpdates:l.batchedUpdates,classSet:c,cloneWithProps:p,createFragment:s.create,update:d},t.exports=o},{119:119,124:124,165:165,25:25,31:31,34:34,42:42,67:67,95:95,97:97}],2:[function(e,t,n){var r=e(131),o={componentDidMount:function(){this.props.autoFocus&&r(this.getDOMNode())}};t.exports=o},{131:131}],3:[function(e,t,n){function r(){var e=window.opera;return"object"==typeof e&&"function"==typeof e.version&&parseInt(e.version(),10)<=12}function o(e){return(e.ctrlKey||e.altKey||e.metaKey)&&!(e.ctrlKey&&e.altKey)}function i(e){switch(e){case P.topCompositionStart:return I.compositionStart;case P.topCompositionEnd:return I.compositionEnd;case P.topCompositionUpdate:return I.compositionUpdate}}function a(e,t){return e===P.topKeyDown&&t.keyCode===b}function s(e,t){switch(e){case P.topKeyUp:return-1!==E.indexOf(t.keyCode);case P.topKeyDown:return t.keyCode!==b;case P.topKeyPress:case P.topMouseDown:case P.topBlur:return!0;default:return!1}}function u(e){var t=e.detail;return"object"==typeof t&&"data"in t?t.data:null}function l(e,t,n,r){var o,l;if(_?o=i(e):w?s(e,r)&&(o=I.compositionEnd):a(e,r)&&(o=I.compositionStart),!o)return null;M&&(w||o!==I.compositionStart?o===I.compositionEnd&&w&&(l=w.getData()):w=v.getPooled(t));var c=g.getPooled(o,n,r);if(l)c.data=l;else{var p=u(r);null!==p&&(c.data=p)}return h.accumulateTwoPhaseDispatches(c),c}function c(e,t){switch(e){case P.topCompositionEnd:return u(t);case P.topKeyPress:var n=t.which;return n!==T?null:(R=!0,N);case P.topTextInput:var r=t.data;return r===N&&R?null:r;default:return null}}function p(e,t){if(w){if(e===P.topCompositionEnd||s(e,t)){var n=w.getData();return v.release(w),w=null,n}return null}switch(e){case P.topPaste:return null;case P.topKeyPress:return t.which&&!o(t)?String.fromCharCode(t.which):null;case P.topCompositionEnd:return M?null:t.data;default:return null}}function d(e,t,n,r){var o;if(o=D?c(e,r):p(e,r),!o)return null;var i=y.getPooled(I.beforeInput,n,r);return i.data=o,h.accumulateTwoPhaseDispatches(i),i}var f=e(16),h=e(21),m=e(22),v=e(23),g=e(103),y=e(107),C=e(154),E=[9,13,27,32],b=229,_=m.canUseDOM&&"CompositionEvent"in window,x=null;m.canUseDOM&&"documentMode"in document&&(x=document.documentMode);var D=m.canUseDOM&&"TextEvent"in window&&!x&&!r(),M=m.canUseDOM&&(!_||x&&x>8&&11>=x),T=32,N=String.fromCharCode(T),P=f.topLevelTypes,I={beforeInput:{phasedRegistrationNames:{bubbled:C({onBeforeInput:null}),captured:C({onBeforeInputCapture:null})},dependencies:[P.topCompositionEnd,P.topKeyPress,P.topTextInput,P.topPaste]},compositionEnd:{phasedRegistrationNames:{bubbled:C({onCompositionEnd:null}),captured:C({onCompositionEndCapture:null})},dependencies:[P.topBlur,P.topCompositionEnd,P.topKeyDown,P.topKeyPress,P.topKeyUp,P.topMouseDown]},compositionStart:{phasedRegistrationNames:{bubbled:C({onCompositionStart:null}),captured:C({onCompositionStartCapture:null})},dependencies:[P.topBlur,P.topCompositionStart,P.topKeyDown,P.topKeyPress,P.topKeyUp,P.topMouseDown]},compositionUpdate:{phasedRegistrationNames:{bubbled:C({onCompositionUpdate:null}),captured:C({onCompositionUpdateCapture:null})},dependencies:[P.topBlur,P.topCompositionUpdate,P.topKeyDown,P.topKeyPress,P.topKeyUp,P.topMouseDown]}},R=!1,w=null,O={eventTypes:I,extractEvents:function(e,t,n,r){return[l(e,t,n,r),d(e,t,n,r)]}};t.exports=O},{103:103,107:107,154:154,16:16,21:21,22:22,23:23}],4:[function(e,t,n){var r=e(147),o={addClass:function(e,t){return r(!/\s/.test(t)),t&&(e.classList?e.classList.add(t):o.hasClass(e,t)||(e.className=e.className+" "+t)),e
},removeClass:function(e,t){return r(!/\s/.test(t)),t&&(e.classList?e.classList.remove(t):o.hasClass(e,t)&&(e.className=e.className.replace(new RegExp("(^|\\s)"+t+"(?:\\s|$)","g"),"$1").replace(/\s+/g," ").replace(/^\s*|\s*$/g,""))),e},conditionClass:function(e,t,n){return(n?o.addClass:o.removeClass)(e,t)},hasClass:function(e,t){return r(!/\s/.test(t)),e.classList?!!t&&e.classList.contains(t):(" "+e.className+" ").indexOf(" "+t+" ")>-1}};t.exports=o},{147:147}],5:[function(e,t,n){function r(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}var o={boxFlex:!0,boxFlexGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,strokeDashoffset:!0,strokeOpacity:!0,strokeWidth:!0},i=["Webkit","ms","Moz","O"];Object.keys(o).forEach(function(e){i.forEach(function(t){o[r(t,e)]=o[e]})});var a={background:{backgroundImage:!0,backgroundPosition:!0,backgroundRepeat:!0,backgroundColor:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0}},s={isUnitlessNumber:o,shorthandPropertyExpansions:a};t.exports=s},{}],6:[function(e,t,n){var r=e(5),o=e(22),i=(e(118),e(125)),a=e(145),s=e(156),u=(e(166),s(function(e){return a(e)})),l="cssFloat";o.canUseDOM&&void 0===document.documentElement.style.cssFloat&&(l="styleFloat");var c={createMarkupForStyles:function(e){var t="";for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];null!=r&&(t+=u(n)+":",t+=i(n,r)+";")}return t||null},setValueForStyles:function(e,t){var n=e.style;for(var o in t)if(t.hasOwnProperty(o)){var a=i(o,t[o]);if("float"===o&&(o=l),a)n[o]=a;else{var s=r.shorthandPropertyExpansions[o];if(s)for(var u in s)n[u]="";else n[o]=""}}}};t.exports=c},{118:118,125:125,145:145,156:156,166:166,22:22,5:5}],7:[function(e,t,n){function r(){this._callbacks=null,this._contexts=null}var o=e(30),i=e(29),a=e(147);i(r.prototype,{enqueue:function(e,t){this._callbacks=this._callbacks||[],this._contexts=this._contexts||[],this._callbacks.push(e),this._contexts.push(t)},notifyAll:function(){var e=this._callbacks,t=this._contexts;if(e){a(e.length===t.length),this._callbacks=null,this._contexts=null;for(var n=0,r=e.length;r>n;n++)e[n].call(t[n]);e.length=0,t.length=0}},reset:function(){this._callbacks=null,this._contexts=null},destructor:function(){this.reset()}}),o.addPoolingTo(r),t.exports=r},{147:147,29:29,30:30}],8:[function(e,t,n){function r(e){return"SELECT"===e.nodeName||"INPUT"===e.nodeName&&"file"===e.type}function o(e){var t=x.getPooled(P.change,R,e);E.accumulateTwoPhaseDispatches(t),_.batchedUpdates(i,t)}function i(e){C.enqueueEvents(e),C.processEventQueue()}function a(e,t){I=e,R=t,I.attachEvent("onchange",o)}function s(){I&&(I.detachEvent("onchange",o),I=null,R=null)}function u(e,t,n){return e===N.topChange?n:void 0}function l(e,t,n){e===N.topFocus?(s(),a(t,n)):e===N.topBlur&&s()}function c(e,t){I=e,R=t,w=e.value,O=Object.getOwnPropertyDescriptor(e.constructor.prototype,"value"),Object.defineProperty(I,"value",k),I.attachEvent("onpropertychange",d)}function p(){I&&(delete I.value,I.detachEvent("onpropertychange",d),I=null,R=null,w=null,O=null)}function d(e){if("value"===e.propertyName){var t=e.srcElement.value;t!==w&&(w=t,o(e))}}function f(e,t,n){return e===N.topInput?n:void 0}function h(e,t,n){e===N.topFocus?(p(),c(t,n)):e===N.topBlur&&p()}function m(e,t,n){return e!==N.topSelectionChange&&e!==N.topKeyUp&&e!==N.topKeyDown||!I||I.value===w?void 0:(w=I.value,R)}function v(e){return"INPUT"===e.nodeName&&("checkbox"===e.type||"radio"===e.type)}function g(e,t,n){return e===N.topClick?n:void 0}var y=e(16),C=e(18),E=e(21),b=e(22),_=e(97),x=e(105),D=e(148),M=e(150),T=e(154),N=y.topLevelTypes,P={change:{phasedRegistrationNames:{bubbled:T({onChange:null}),captured:T({onChangeCapture:null})},dependencies:[N.topBlur,N.topChange,N.topClick,N.topFocus,N.topInput,N.topKeyDown,N.topKeyUp,N.topSelectionChange]}},I=null,R=null,w=null,O=null,S=!1;b.canUseDOM&&(S=D("change")&&(!("documentMode"in document)||document.documentMode>8));var A=!1;b.canUseDOM&&(A=D("input")&&(!("documentMode"in document)||document.documentMode>9));var k={get:function(){return O.get.call(this)},set:function(e){w=""+e,O.set.call(this,e)}},L={eventTypes:P,extractEvents:function(e,t,n,o){var i,a;if(r(t)?S?i=u:a=l:M(t)?A?i=f:(i=m,a=h):v(t)&&(i=g),i){var s=i(e,t,n);if(s){var c=x.getPooled(P.change,s,o);return E.accumulateTwoPhaseDispatches(c),c}}a&&a(e,t,n)}};t.exports=L},{105:105,148:148,150:150,154:154,16:16,18:18,21:21,22:22,97:97}],9:[function(e,t,n){var r=0,o={createReactRootIndex:function(){return r++}};t.exports=o},{}],10:[function(e,t,n){function r(e,t,n){e.insertBefore(t,e.childNodes[n]||null)}var o=e(13),i=e(77),a=e(160),s=e(147),u={dangerouslyReplaceNodeWithMarkup:o.dangerouslyReplaceNodeWithMarkup,updateTextContent:a,processUpdates:function(e,t){for(var n,u=null,l=null,c=0;c<e.length;c++)if(n=e[c],n.type===i.MOVE_EXISTING||n.type===i.REMOVE_NODE){var p=n.fromIndex,d=n.parentNode.childNodes[p],f=n.parentID;s(d),u=u||{},u[f]=u[f]||[],u[f][p]=d,l=l||[],l.push(d)}var h=o.dangerouslyRenderMarkup(t);if(l)for(var m=0;m<l.length;m++)l[m].parentNode.removeChild(l[m]);for(var v=0;v<e.length;v++)switch(n=e[v],n.type){case i.INSERT_MARKUP:r(n.parentNode,h[n.markupIndex],n.toIndex);break;case i.MOVE_EXISTING:r(n.parentNode,u[n.parentID][n.fromIndex],n.toIndex);break;case i.TEXT_CONTENT:a(n.parentNode,n.textContent);break;case i.REMOVE_NODE:}}};t.exports=u},{13:13,147:147,160:160,77:77}],11:[function(e,t,n){function r(e,t){return(e&t)===t}var o=e(147),i={MUST_USE_ATTRIBUTE:1,MUST_USE_PROPERTY:2,HAS_SIDE_EFFECTS:4,HAS_BOOLEAN_VALUE:8,HAS_NUMERIC_VALUE:16,HAS_POSITIVE_NUMERIC_VALUE:48,HAS_OVERLOADED_BOOLEAN_VALUE:64,injectDOMPropertyConfig:function(e){var t=e.Properties||{},n=e.DOMAttributeNames||{},a=e.DOMPropertyNames||{},u=e.DOMMutationMethods||{};e.isCustomAttribute&&s._isCustomAttributeFunctions.push(e.isCustomAttribute);for(var l in t){o(!s.isStandardName.hasOwnProperty(l)),s.isStandardName[l]=!0;var c=l.toLowerCase();if(s.getPossibleStandardName[c]=l,n.hasOwnProperty(l)){var p=n[l];s.getPossibleStandardName[p]=l,s.getAttributeName[l]=p}else s.getAttributeName[l]=c;s.getPropertyName[l]=a.hasOwnProperty(l)?a[l]:l,s.getMutationMethod[l]=u.hasOwnProperty(l)?u[l]:null;var d=t[l];s.mustUseAttribute[l]=r(d,i.MUST_USE_ATTRIBUTE),s.mustUseProperty[l]=r(d,i.MUST_USE_PROPERTY),s.hasSideEffects[l]=r(d,i.HAS_SIDE_EFFECTS),s.hasBooleanValue[l]=r(d,i.HAS_BOOLEAN_VALUE),s.hasNumericValue[l]=r(d,i.HAS_NUMERIC_VALUE),s.hasPositiveNumericValue[l]=r(d,i.HAS_POSITIVE_NUMERIC_VALUE),s.hasOverloadedBooleanValue[l]=r(d,i.HAS_OVERLOADED_BOOLEAN_VALUE),o(!s.mustUseAttribute[l]||!s.mustUseProperty[l]),o(s.mustUseProperty[l]||!s.hasSideEffects[l]),o(!!s.hasBooleanValue[l]+!!s.hasNumericValue[l]+!!s.hasOverloadedBooleanValue[l]<=1)}}},a={},s={ID_ATTRIBUTE_NAME:"data-reactid",isStandardName:{},getPossibleStandardName:{},getAttributeName:{},getPropertyName:{},getMutationMethod:{},mustUseAttribute:{},mustUseProperty:{},hasSideEffects:{},hasBooleanValue:{},hasNumericValue:{},hasPositiveNumericValue:{},hasOverloadedBooleanValue:{},_isCustomAttributeFunctions:[],isCustomAttribute:function(e){for(var t=0;t<s._isCustomAttributeFunctions.length;t++){var n=s._isCustomAttributeFunctions[t];if(n(e))return!0}return!1},getDefaultValueForProperty:function(e,t){var n,r=a[e];return r||(a[e]=r={}),t in r||(n=document.createElement(e),r[t]=n[t]),r[t]},injection:i};t.exports=s},{147:147}],12:[function(e,t,n){function r(e,t){return null==t||o.hasBooleanValue[e]&&!t||o.hasNumericValue[e]&&isNaN(t)||o.hasPositiveNumericValue[e]&&1>t||o.hasOverloadedBooleanValue[e]&&t===!1}var o=e(11),i=e(158),a=(e(166),{createMarkupForID:function(e){return o.ID_ATTRIBUTE_NAME+"="+i(e)},createMarkupForProperty:function(e,t){if(o.isStandardName.hasOwnProperty(e)&&o.isStandardName[e]){if(r(e,t))return"";var n=o.getAttributeName[e];return o.hasBooleanValue[e]||o.hasOverloadedBooleanValue[e]&&t===!0?n:n+"="+i(t)}return o.isCustomAttribute(e)?null==t?"":e+"="+i(t):null},setValueForProperty:function(e,t,n){if(o.isStandardName.hasOwnProperty(t)&&o.isStandardName[t]){var i=o.getMutationMethod[t];if(i)i(e,n);else if(r(t,n))this.deleteValueForProperty(e,t);else if(o.mustUseAttribute[t])e.setAttribute(o.getAttributeName[t],""+n);else{var a=o.getPropertyName[t];o.hasSideEffects[t]&&""+e[a]==""+n||(e[a]=n)}}else o.isCustomAttribute(t)&&(null==n?e.removeAttribute(t):e.setAttribute(t,""+n))},deleteValueForProperty:function(e,t){if(o.isStandardName.hasOwnProperty(t)&&o.isStandardName[t]){var n=o.getMutationMethod[t];if(n)n(e,void 0);else if(o.mustUseAttribute[t])e.removeAttribute(o.getAttributeName[t]);else{var r=o.getPropertyName[t],i=o.getDefaultValueForProperty(e.nodeName,r);o.hasSideEffects[t]&&""+e[r]===i||(e[r]=i)}}else o.isCustomAttribute(t)&&e.removeAttribute(t)}});t.exports=a},{11:11,158:158,166:166}],13:[function(e,t,n){function r(e){return e.substring(1,e.indexOf(" "))}var o=e(22),i=e(123),a=e(126),s=e(139),u=e(147),l=/^(<[^ \/>]+)/,c="data-danger-index",p={dangerouslyRenderMarkup:function(e){u(o.canUseDOM);for(var t,n={},p=0;p<e.length;p++)u(e[p]),t=r(e[p]),t=s(t)?t:"*",n[t]=n[t]||[],n[t][p]=e[p];var d=[],f=0;for(t in n)if(n.hasOwnProperty(t)){var h,m=n[t];for(h in m)if(m.hasOwnProperty(h)){var v=m[h];m[h]=v.replace(l,"$1 "+c+'="'+h+'" ')}for(var g=i(m.join(""),a),y=0;y<g.length;++y){var C=g[y];C.hasAttribute&&C.hasAttribute(c)&&(h=+C.getAttribute(c),C.removeAttribute(c),u(!d.hasOwnProperty(h)),d[h]=C,f+=1)}}return u(f===d.length),u(d.length===e.length),d},dangerouslyReplaceNodeWithMarkup:function(e,t){u(o.canUseDOM),u(t),u("html"!==e.tagName.toLowerCase());var n=i(t,a)[0];e.parentNode.replaceChild(n,e)}};t.exports=p},{123:123,126:126,139:139,147:147,22:22}],14:[function(e,t,n){var r=e(154),o=[r({ResponderEventPlugin:null}),r({SimpleEventPlugin:null}),r({TapEventPlugin:null}),r({EnterLeaveEventPlugin:null}),r({ChangeEventPlugin:null}),r({SelectEventPlugin:null}),r({BeforeInputEventPlugin:null}),r({AnalyticsEventPlugin:null}),r({MobileSafariClickEventPlugin:null})];t.exports=o},{154:154}],15:[function(e,t,n){var r=e(16),o=e(21),i=e(109),a=e(75),s=e(154),u=r.topLevelTypes,l=a.getFirstReactDOM,c={mouseEnter:{registrationName:s({onMouseEnter:null}),dependencies:[u.topMouseOut,u.topMouseOver]},mouseLeave:{registrationName:s({onMouseLeave:null}),dependencies:[u.topMouseOut,u.topMouseOver]}},p=[null,null],d={eventTypes:c,extractEvents:function(e,t,n,r){if(e===u.topMouseOver&&(r.relatedTarget||r.fromElement))return null;if(e!==u.topMouseOut&&e!==u.topMouseOver)return null;var s;if(t.window===t)s=t;else{var d=t.ownerDocument;s=d?d.defaultView||d.parentWindow:window}var f,h;if(e===u.topMouseOut?(f=t,h=l(r.relatedTarget||r.toElement)||s):(f=s,h=t),f===h)return null;var m=f?a.getID(f):"",v=h?a.getID(h):"",g=i.getPooled(c.mouseLeave,m,r);g.type="mouseleave",g.target=f,g.relatedTarget=h;var y=i.getPooled(c.mouseEnter,v,r);return y.type="mouseenter",y.target=h,y.relatedTarget=f,o.accumulateEnterLeaveDispatches(g,y,m,v),p[0]=g,p[1]=y,p}};t.exports=d},{109:109,154:154,16:16,21:21,75:75}],16:[function(e,t,n){var r=e(153),o=r({bubbled:null,captured:null}),i=r({topBlur:null,topChange:null,topClick:null,topCompositionEnd:null,topCompositionStart:null,topCompositionUpdate:null,topContextMenu:null,topCopy:null,topCut:null,topDoubleClick:null,topDrag:null,topDragEnd:null,topDragEnter:null,topDragExit:null,topDragLeave:null,topDragOver:null,topDragStart:null,topDrop:null,topError:null,topFocus:null,topInput:null,topKeyDown:null,topKeyPress:null,topKeyUp:null,topLoad:null,topMouseDown:null,topMouseMove:null,topMouseOut:null,topMouseOver:null,topMouseUp:null,topPaste:null,topReset:null,topScroll:null,topSelectionChange:null,topSubmit:null,topTextInput:null,topTouchCancel:null,topTouchEnd:null,topTouchMove:null,topTouchStart:null,topWheel:null}),a={topLevelTypes:i,PropagationPhases:o};t.exports=a},{153:153}],17:[function(e,t,n){var r=e(126),o={listen:function(e,t,n){return e.addEventListener?(e.addEventListener(t,n,!1),{remove:function(){e.removeEventListener(t,n,!1)}}):e.attachEvent?(e.attachEvent("on"+t,n),{remove:function(){e.detachEvent("on"+t,n)}}):void 0},capture:function(e,t,n){return e.addEventListener?(e.addEventListener(t,n,!0),{remove:function(){e.removeEventListener(t,n,!0)}}):{remove:r}},registerDefault:function(){}};t.exports=o},{126:126}],18:[function(e,t,n){var r=e(19),o=e(20),i=e(115),a=e(132),s=e(147),u={},l=null,c=function(e){if(e){var t=o.executeDispatch,n=r.getPluginModuleForEvent(e);n&&n.executeDispatch&&(t=n.executeDispatch),o.executeDispatchesInOrder(e,t),e.isPersistent()||e.constructor.release(e)}},p=null,d={injection:{injectMount:o.injection.injectMount,injectInstanceHandle:function(e){p=e},getInstanceHandle:function(){return p},injectEventPluginOrder:r.injectEventPluginOrder,injectEventPluginsByName:r.injectEventPluginsByName},eventNameDispatchConfigs:r.eventNameDispatchConfigs,registrationNameModules:r.registrationNameModules,putListener:function(e,t,n){s(!n||"function"==typeof n);var r=u[t]||(u[t]={});r[e]=n},getListener:function(e,t){var n=u[t];return n&&n[e]},deleteListener:function(e,t){var n=u[t];n&&delete n[e]},deleteAllListeners:function(e){for(var t in u)delete u[t][e]},extractEvents:function(e,t,n,o){for(var a,s=r.plugins,u=0,l=s.length;l>u;u++){var c=s[u];if(c){var p=c.extractEvents(e,t,n,o);p&&(a=i(a,p))}}return a},enqueueEvents:function(e){e&&(l=i(l,e))},processEventQueue:function(){var e=l;l=null,a(e,c),s(!l)},__purge:function(){u={}},__getListenerBank:function(){return u}};t.exports=d},{115:115,132:132,147:147,19:19,20:20}],19:[function(e,t,n){function r(){if(s)for(var e in u){var t=u[e],n=s.indexOf(e);if(a(n>-1),!l.plugins[n]){a(t.extractEvents),l.plugins[n]=t;var r=t.eventTypes;for(var i in r)a(o(r[i],t,i))}}}function o(e,t,n){a(!l.eventNameDispatchConfigs.hasOwnProperty(n)),l.eventNameDispatchConfigs[n]=e;var r=e.phasedRegistrationNames;if(r){for(var o in r)if(r.hasOwnProperty(o)){var s=r[o];i(s,t,n)}return!0}return e.registrationName?(i(e.registrationName,t,n),!0):!1}function i(e,t,n){a(!l.registrationNameModules[e]),l.registrationNameModules[e]=t,l.registrationNameDependencies[e]=t.eventTypes[n].dependencies}var a=e(147),s=null,u={},l={plugins:[],eventNameDispatchConfigs:{},registrationNameModules:{},registrationNameDependencies:{},injectEventPluginOrder:function(e){a(!s),s=Array.prototype.slice.call(e),r()},injectEventPluginsByName:function(e){var t=!1;for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];u.hasOwnProperty(n)&&u[n]===o||(a(!u[n]),u[n]=o,t=!0)}t&&r()},getPluginModuleForEvent:function(e){var t=e.dispatchConfig;if(t.registrationName)return l.registrationNameModules[t.registrationName]||null;for(var n in t.phasedRegistrationNames)if(t.phasedRegistrationNames.hasOwnProperty(n)){var r=l.registrationNameModules[t.phasedRegistrationNames[n]];if(r)return r}return null},_resetEventPlugins:function(){s=null;for(var e in u)u.hasOwnProperty(e)&&delete u[e];l.plugins.length=0;var t=l.eventNameDispatchConfigs;for(var n in t)t.hasOwnProperty(n)&&delete t[n];var r=l.registrationNameModules;for(var o in r)r.hasOwnProperty(o)&&delete r[o]}};t.exports=l},{147:147}],20:[function(e,t,n){function r(e){return e===v.topMouseUp||e===v.topTouchEnd||e===v.topTouchCancel}function o(e){return e===v.topMouseMove||e===v.topTouchMove}function i(e){return e===v.topMouseDown||e===v.topTouchStart}function a(e,t){var n=e._dispatchListeners,r=e._dispatchIDs;if(Array.isArray(n))for(var o=0;o<n.length&&!e.isPropagationStopped();o++)t(e,n[o],r[o]);else n&&t(e,n,r)}function s(e,t,n){e.currentTarget=m.Mount.getNode(n);var r=t(e,n);return e.currentTarget=null,r}function u(e,t){a(e,t),e._dispatchListeners=null,e._dispatchIDs=null}function l(e){var t=e._dispatchListeners,n=e._dispatchIDs;if(Array.isArray(t)){for(var r=0;r<t.length&&!e.isPropagationStopped();r++)if(t[r](e,n[r]))return n[r]}else if(t&&t(e,n))return n;return null}function c(e){var t=l(e);return e._dispatchIDs=null,e._dispatchListeners=null,t}function p(e){var t=e._dispatchListeners,n=e._dispatchIDs;h(!Array.isArray(t));var r=t?t(e,n):null;return e._dispatchListeners=null,e._dispatchIDs=null,r}function d(e){return!!e._dispatchListeners}var f=e(16),h=e(147),m={Mount:null,injectMount:function(e){m.Mount=e}},v=f.topLevelTypes,g={isEndish:r,isMoveish:o,isStartish:i,executeDirectDispatch:p,executeDispatch:s,executeDispatchesInOrder:u,executeDispatchesInOrderStopAtTrue:c,hasDispatches:d,injection:m,useTouchEvents:!1};t.exports=g},{147:147,16:16}],21:[function(e,t,n){function r(e,t,n){var r=t.dispatchConfig.phasedRegistrationNames[n];return v(e,r)}function o(e,t,n){var o=t?m.bubbled:m.captured,i=r(e,n,o);i&&(n._dispatchListeners=f(n._dispatchListeners,i),n._dispatchIDs=f(n._dispatchIDs,e))}function i(e){e&&e.dispatchConfig.phasedRegistrationNames&&d.injection.getInstanceHandle().traverseTwoPhase(e.dispatchMarker,o,e)}function a(e,t,n){if(n&&n.dispatchConfig.registrationName){var r=n.dispatchConfig.registrationName,o=v(e,r);o&&(n._dispatchListeners=f(n._dispatchListeners,o),n._dispatchIDs=f(n._dispatchIDs,e))}}function s(e){e&&e.dispatchConfig.registrationName&&a(e.dispatchMarker,null,e)}function u(e){h(e,i)}function l(e,t,n,r){d.injection.getInstanceHandle().traverseEnterLeave(n,r,a,e,t)}function c(e){h(e,s)}var p=e(16),d=e(18),f=e(115),h=e(132),m=p.PropagationPhases,v=d.getListener,g={accumulateTwoPhaseDispatches:u,accumulateDirectDispatches:c,accumulateEnterLeaveDispatches:l};t.exports=g},{115:115,132:132,16:16,18:18}],22:[function(e,t,n){var r=!("undefined"==typeof window||!window.document||!window.document.createElement),o={canUseDOM:r,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:r&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:r&&!!window.screen,isInWorker:!r};t.exports=o},{}],23:[function(e,t,n){function r(e){this._root=e,this._startText=this.getText(),this._fallbackText=null}var o=e(30),i=e(29),a=e(142);i(r.prototype,{getText:function(){return"value"in this._root?this._root.value:this._root[a()]},getData:function(){if(this._fallbackText)return this._fallbackText;var e,t,n=this._startText,r=n.length,o=this.getText(),i=o.length;for(e=0;r>e&&n[e]===o[e];e++);var a=r-e;for(t=1;a>=t&&n[r-t]===o[i-t];t++);var s=t>1?1-t:void 0;return this._fallbackText=o.slice(e,s),this._fallbackText}}),o.addPoolingTo(r),t.exports=r},{142:142,29:29,30:30}],24:[function(e,t,n){var r,o=e(11),i=e(22),a=o.injection.MUST_USE_ATTRIBUTE,s=o.injection.MUST_USE_PROPERTY,u=o.injection.HAS_BOOLEAN_VALUE,l=o.injection.HAS_SIDE_EFFECTS,c=o.injection.HAS_NUMERIC_VALUE,p=o.injection.HAS_POSITIVE_NUMERIC_VALUE,d=o.injection.HAS_OVERLOADED_BOOLEAN_VALUE;if(i.canUseDOM){var f=document.implementation;r=f&&f.hasFeature&&f.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")}var h={isCustomAttribute:RegExp.prototype.test.bind(/^(data|aria)-[a-z_][a-z\d_.\-]*$/),Properties:{accept:null,acceptCharset:null,accessKey:null,action:null,allowFullScreen:a|u,allowTransparency:a,alt:null,async:u,autoComplete:null,autoPlay:u,cellPadding:null,cellSpacing:null,charSet:a,checked:s|u,classID:a,className:r?a:s,cols:a|p,colSpan:null,content:null,contentEditable:null,contextMenu:a,controls:s|u,coords:null,crossOrigin:null,data:null,dateTime:a,defer:u,dir:null,disabled:a|u,download:d,draggable:null,encType:null,form:a,formAction:a,formEncType:a,formMethod:a,formNoValidate:u,formTarget:a,frameBorder:a,headers:null,height:a,hidden:a|u,high:null,href:null,hrefLang:null,htmlFor:null,httpEquiv:null,icon:null,id:s,label:null,lang:null,list:a,loop:s|u,low:null,manifest:a,marginHeight:null,marginWidth:null,max:null,maxLength:a,media:a,mediaGroup:null,method:null,min:null,multiple:s|u,muted:s|u,name:null,noValidate:u,open:u,optimum:null,pattern:null,placeholder:null,poster:null,preload:null,radioGroup:null,readOnly:s|u,rel:null,required:u,role:a,rows:a|p,rowSpan:null,sandbox:null,scope:null,scoped:u,scrolling:null,seamless:a|u,selected:s|u,shape:null,size:a|p,sizes:a,span:p,spellCheck:null,src:null,srcDoc:s,srcSet:a,start:c,step:null,style:null,tabIndex:null,target:null,title:null,type:null,useMap:null,value:s|l,width:a,wmode:a,autoCapitalize:null,autoCorrect:null,itemProp:a,itemScope:a|u,itemType:a,itemID:a,itemRef:a,property:null,unselectable:a},DOMAttributeNames:{acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv"},DOMPropertyNames:{autoCapitalize:"autocapitalize",autoComplete:"autocomplete",autoCorrect:"autocorrect",autoFocus:"autofocus",autoPlay:"autoplay",encType:"encoding",hrefLang:"hreflang",radioGroup:"radiogroup",spellCheck:"spellcheck",srcDoc:"srcdoc",srcSet:"srcset"}};t.exports=h},{11:11,22:22}],25:[function(e,t,n){var r=e(73),o=e(92),i={linkState:function(e){return new r(this.state[e],o.createStateKeySetter(this,e))}};t.exports=i},{73:73,92:92}],26:[function(e,t,n){function r(e){l(null==e.props.checkedLink||null==e.props.valueLink)}function o(e){r(e),l(null==e.props.value&&null==e.props.onChange)}function i(e){r(e),l(null==e.props.checked&&null==e.props.onChange)}function a(e){this.props.valueLink.requestChange(e.target.value)}function s(e){this.props.checkedLink.requestChange(e.target.checked)}var u=e(84),l=e(147),c={button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0},p={Mixin:{propTypes:{value:function(e,t,n){return!e[t]||c[e.type]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`.")},checked:function(e,t,n){return!e[t]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")},onChange:u.func}},getValue:function(e){return e.props.valueLink?(o(e),e.props.valueLink.value):e.props.value},getChecked:function(e){return e.props.checkedLink?(i(e),e.props.checkedLink.value):e.props.checked},getOnChange:function(e){return e.props.valueLink?(o(e),a):e.props.checkedLink?(i(e),s):e.props.onChange}};t.exports=p},{147:147,84:84}],27:[function(e,t,n){function r(e){e.remove()}var o=e(33),i=e(115),a=e(132),s=e(147),u={trapBubbledEvent:function(e,t){s(this.isMounted());var n=this.getDOMNode();s(n);var r=o.trapBubbledEvent(e,t,n);this._localEventListeners=i(this._localEventListeners,r)},componentWillUnmount:function(){this._localEventListeners&&a(this._localEventListeners,r)}};t.exports=u},{115:115,132:132,147:147,33:33}],28:[function(e,t,n){var r=e(16),o=e(126),i=r.topLevelTypes,a={eventTypes:null,extractEvents:function(e,t,n,r){if(e===i.topTouchStart){var a=r.target;a&&!a.onclick&&(a.onclick=o)}}};t.exports=a},{126:126,16:16}],29:[function(e,t,n){function r(e,t){if(null==e)throw new TypeError("Object.assign target cannot be null or undefined");for(var n=Object(e),r=Object.prototype.hasOwnProperty,o=1;o<arguments.length;o++){var i=arguments[o];if(null!=i){var a=Object(i);for(var s in a)r.call(a,s)&&(n[s]=a[s])}}return n}t.exports=r},{}],30:[function(e,t,n){var r=e(147),o=function(e){var t=this;if(t.instancePool.length){var n=t.instancePool.pop();return t.call(n,e),n}return new t(e)},i=function(e,t){var n=this;if(n.instancePool.length){var r=n.instancePool.pop();return n.call(r,e,t),r}return new n(e,t)},a=function(e,t,n){var r=this;if(r.instancePool.length){var o=r.instancePool.pop();return r.call(o,e,t,n),o}return new r(e,t,n)},s=function(e,t,n,r,o){var i=this;if(i.instancePool.length){var a=i.instancePool.pop();return i.call(a,e,t,n,r,o),a}return new i(e,t,n,r,o)},u=function(e){var t=this;r(e instanceof t),e.destructor&&e.destructor(),t.instancePool.length<t.poolSize&&t.instancePool.push(e)},l=10,c=o,p=function(e,t){var n=e;return n.instancePool=[],n.getPooled=t||c,n.poolSize||(n.poolSize=l),n.release=u,n},d={addPoolingTo:p,oneArgumentPooler:o,twoArgumentPooler:i,threeArgumentPooler:a,fiveArgumentPooler:s};t.exports=d},{147:147}],31:[function(e,t,n){var r=e(20),o=e(37),i=e(39),a=e(38),s=e(44),u=e(45),l=e(61),c=(e(62),e(46)),p=e(57),d=e(60),f=e(70),h=e(75),m=e(80),v=e(84),g=e(87),y=e(90),C=e(29),E=e(129),b=e(157);d.inject();var _=l.createElement,x=l.createFactory,D=l.cloneElement,M=m.measure("React","render",h.render),T={Children:{map:o.map,forEach:o.forEach,count:o.count,only:b},Component:i,DOM:c,PropTypes:v,initializeTouchEvents:function(e){r.useTouchEvents=e},createClass:a.createClass,createElement:_,cloneElement:D,createFactory:x,createMixin:function(e){return e},constructAndRenderComponent:h.constructAndRenderComponent,constructAndRenderComponentByID:h.constructAndRenderComponentByID,findDOMNode:E,render:M,renderToString:y.renderToString,renderToStaticMarkup:y.renderToStaticMarkup,unmountComponentAtNode:h.unmountComponentAtNode,isValidElement:l.isValidElement,withContext:s.withContext,__spread:C};"undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.inject&&__REACT_DEVTOOLS_GLOBAL_HOOK__.inject({CurrentOwner:u,InstanceHandles:f,Mount:h,Reconciler:g,TextComponent:p}),T.version="0.13.3",t.exports=T},{129:129,157:157,20:20,29:29,37:37,38:38,39:39,44:44,45:45,46:46,57:57,60:60,61:61,62:62,70:70,75:75,80:80,84:84,87:87,90:90}],32:[function(e,t,n){var r=e(129),o={getDOMNode:function(){return r(this)}};t.exports=o},{129:129}],33:[function(e,t,n){function r(e){return Object.prototype.hasOwnProperty.call(e,m)||(e[m]=f++,p[e[m]]={}),p[e[m]]}var o=e(16),i=e(18),a=e(19),s=e(65),u=e(114),l=e(29),c=e(148),p={},d=!1,f=0,h={topBlur:"blur",topChange:"change",topClick:"click",topCompositionEnd:"compositionend",topCompositionStart:"compositionstart",topCompositionUpdate:"compositionupdate",topContextMenu:"contextmenu",topCopy:"copy",topCut:"cut",topDoubleClick:"dblclick",topDrag:"drag",topDragEnd:"dragend",topDragEnter:"dragenter",topDragExit:"dragexit",topDragLeave:"dragleave",topDragOver:"dragover",topDragStart:"dragstart",topDrop:"drop",topFocus:"focus",topInput:"input",topKeyDown:"keydown",topKeyPress:"keypress",topKeyUp:"keyup",topMouseDown:"mousedown",topMouseMove:"mousemove",topMouseOut:"mouseout",topMouseOver:"mouseover",topMouseUp:"mouseup",topPaste:"paste",topScroll:"scroll",topSelectionChange:"selectionchange",topTextInput:"textInput",topTouchCancel:"touchcancel",topTouchEnd:"touchend",topTouchMove:"touchmove",topTouchStart:"touchstart",topWheel:"wheel"},m="_reactListenersID"+String(Math.random()).slice(2),v=l({},s,{ReactEventListener:null,injection:{injectReactEventListener:function(e){e.setHandleTopLevel(v.handleTopLevel),v.ReactEventListener=e}},setEnabled:function(e){v.ReactEventListener&&v.ReactEventListener.setEnabled(e)},isEnabled:function(){return!(!v.ReactEventListener||!v.ReactEventListener.isEnabled())},listenTo:function(e,t){for(var n=t,i=r(n),s=a.registrationNameDependencies[e],u=o.topLevelTypes,l=0,p=s.length;p>l;l++){var d=s[l];i.hasOwnProperty(d)&&i[d]||(d===u.topWheel?c("wheel")?v.ReactEventListener.trapBubbledEvent(u.topWheel,"wheel",n):c("mousewheel")?v.ReactEventListener.trapBubbledEvent(u.topWheel,"mousewheel",n):v.ReactEventListener.trapBubbledEvent(u.topWheel,"DOMMouseScroll",n):d===u.topScroll?c("scroll",!0)?v.ReactEventListener.trapCapturedEvent(u.topScroll,"scroll",n):v.ReactEventListener.trapBubbledEvent(u.topScroll,"scroll",v.ReactEventListener.WINDOW_HANDLE):d===u.topFocus||d===u.topBlur?(c("focus",!0)?(v.ReactEventListener.trapCapturedEvent(u.topFocus,"focus",n),v.ReactEventListener.trapCapturedEvent(u.topBlur,"blur",n)):c("focusin")&&(v.ReactEventListener.trapBubbledEvent(u.topFocus,"focusin",n),v.ReactEventListener.trapBubbledEvent(u.topBlur,"focusout",n)),i[u.topBlur]=!0,i[u.topFocus]=!0):h.hasOwnProperty(d)&&v.ReactEventListener.trapBubbledEvent(d,h[d],n),i[d]=!0)}},trapBubbledEvent:function(e,t,n){return v.ReactEventListener.trapBubbledEvent(e,t,n)},trapCapturedEvent:function(e,t,n){return v.ReactEventListener.trapCapturedEvent(e,t,n)},ensureScrollValueMonitoring:function(){if(!d){var e=u.refreshScrollValues;v.ReactEventListener.monitorScrollValue(e),d=!0}},eventNameDispatchConfigs:i.eventNameDispatchConfigs,registrationNameModules:i.registrationNameModules,putListener:i.putListener,getListener:i.getListener,deleteListener:i.deleteListener,deleteAllListeners:i.deleteAllListeners});t.exports=v},{114:114,148:148,16:16,18:18,19:19,29:29,65:65}],34:[function(e,t,n){var r=e(31),o=e(29),i=r.createFactory(e(95)),a=r.createFactory(e(35)),s=r.createClass({displayName:"ReactCSSTransitionGroup",propTypes:{transitionName:r.PropTypes.string.isRequired,transitionAppear:r.PropTypes.bool,transitionEnter:r.PropTypes.bool,transitionLeave:r.PropTypes.bool},getDefaultProps:function(){return{transitionAppear:!1,transitionEnter:!0,transitionLeave:!0}},_wrapChild:function(e){return a({name:this.props.transitionName,appear:this.props.transitionAppear,enter:this.props.transitionEnter,leave:this.props.transitionLeave},e)},render:function(){return i(o({},this.props,{childFactory:this._wrapChild}))}});t.exports=s},{29:29,31:31,35:35,95:95}],35:[function(e,t,n){var r=e(31),o=e(4),i=e(94),a=e(157),s=(e(166),17),u=r.createClass({displayName:"ReactCSSTransitionGroupChild",transition:function(e,t){var n=this.getDOMNode(),r=this.props.name+"-"+e,a=r+"-active",s=function(e){e&&e.target!==n||(o.removeClass(n,r),o.removeClass(n,a),i.removeEndEventListener(n,s),t&&t())};i.addEndEventListener(n,s),o.addClass(n,r),this.queueClass(a)},queueClass:function(e){this.classNameQueue.push(e),this.timeout||(this.timeout=setTimeout(this.flushClassNameQueue,s))},flushClassNameQueue:function(){this.isMounted()&&this.classNameQueue.forEach(o.addClass.bind(o,this.getDOMNode())),this.classNameQueue.length=0,this.timeout=null},componentWillMount:function(){this.classNameQueue=[]},componentWillUnmount:function(){this.timeout&&clearTimeout(this.timeout)},componentWillAppear:function(e){this.props.appear?this.transition("appear",e):e()},componentWillEnter:function(e){this.props.enter?this.transition("enter",e):e()},componentWillLeave:function(e){this.props.leave?this.transition("leave",e):e()},render:function(){return a(this.props.children)}});t.exports=u},{157:157,166:166,31:31,4:4,94:94}],36:[function(e,t,n){var r=e(87),o=e(130),i=e(146),a=e(162),s={instantiateChildren:function(e,t,n){var r=o(e);for(var a in r)if(r.hasOwnProperty(a)){var s=r[a],u=i(s,null);r[a]=u}return r},updateChildren:function(e,t,n,s){var u=o(t);if(!u&&!e)return null;var l;for(l in u)if(u.hasOwnProperty(l)){var c=e&&e[l],p=c&&c._currentElement,d=u[l];if(a(p,d))r.receiveComponent(c,d,n,s),u[l]=c;else{c&&r.unmountComponent(c,l);var f=i(d,null);u[l]=f}}for(l in e)!e.hasOwnProperty(l)||u&&u.hasOwnProperty(l)||r.unmountComponent(e[l]);return u},unmountChildren:function(e){for(var t in e){var n=e[t];r.unmountComponent(n)}}};t.exports=s},{130:130,146:146,162:162,87:87}],37:[function(e,t,n){function r(e,t){this.forEachFunction=e,this.forEachContext=t}function o(e,t,n,r){var o=e;o.forEachFunction.call(o.forEachContext,t,r)}function i(e,t,n){if(null==e)return e;var i=r.getPooled(t,n);f(e,o,i),r.release(i)}function a(e,t,n){this.mapResult=e,this.mapFunction=t,this.mapContext=n}function s(e,t,n,r){var o=e,i=o.mapResult,a=!i.hasOwnProperty(n);if(a){var s=o.mapFunction.call(o.mapContext,t,r);i[n]=s}}function u(e,t,n){if(null==e)return e;var r={},o=a.getPooled(r,t,n);return f(e,s,o),a.release(o),d.create(r)}function l(e,t,n,r){return null}function c(e,t){return f(e,l,null)}var p=e(30),d=e(67),f=e(164),h=(e(166),p.twoArgumentPooler),m=p.threeArgumentPooler;
p.addPoolingTo(r,h),p.addPoolingTo(a,m);var v={forEach:i,map:u,count:c};t.exports=v},{164:164,166:166,30:30,67:67}],38:[function(e,t,n){function r(e,t){var n=D.hasOwnProperty(t)?D[t]:null;T.hasOwnProperty(t)&&y(n===_.OVERRIDE_BASE),e.hasOwnProperty(t)&&y(n===_.DEFINE_MANY||n===_.DEFINE_MANY_MERGED)}function o(e,t){if(t){y("function"!=typeof t),y(!d.isValidElement(t));var n=e.prototype;t.hasOwnProperty(b)&&M.mixins(e,t.mixins);for(var o in t)if(t.hasOwnProperty(o)&&o!==b){var i=t[o];if(r(n,o),M.hasOwnProperty(o))M[o](e,i);else{var a=D.hasOwnProperty(o),l=n.hasOwnProperty(o),c=i&&i.__reactDontBind,p="function"==typeof i,f=p&&!a&&!l&&!c;if(f)n.__reactAutoBindMap||(n.__reactAutoBindMap={}),n.__reactAutoBindMap[o]=i,n[o]=i;else if(l){var h=D[o];y(a&&(h===_.DEFINE_MANY_MERGED||h===_.DEFINE_MANY)),h===_.DEFINE_MANY_MERGED?n[o]=s(n[o],i):h===_.DEFINE_MANY&&(n[o]=u(n[o],i))}else n[o]=i}}}}function i(e,t){if(t)for(var n in t){var r=t[n];if(t.hasOwnProperty(n)){var o=n in M;y(!o);var i=n in e;y(!i),e[n]=r}}}function a(e,t){y(e&&t&&"object"==typeof e&&"object"==typeof t);for(var n in t)t.hasOwnProperty(n)&&(y(void 0===e[n]),e[n]=t[n]);return e}function s(e,t){return function(){var n=e.apply(this,arguments),r=t.apply(this,arguments);if(null==n)return r;if(null==r)return n;var o={};return a(o,n),a(o,r),o}}function u(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function l(e,t){var n=t.bind(e);return n}function c(e){for(var t in e.__reactAutoBindMap)if(e.__reactAutoBindMap.hasOwnProperty(t)){var n=e.__reactAutoBindMap[t];e[t]=l(e,f.guard(n,e.constructor.displayName+"."+t))}}var p=e(39),d=(e(45),e(61)),f=e(64),h=e(71),m=e(72),v=(e(83),e(82),e(96)),g=e(29),y=e(147),C=e(153),E=e(154),b=(e(166),E({mixins:null})),_=C({DEFINE_ONCE:null,DEFINE_MANY:null,OVERRIDE_BASE:null,DEFINE_MANY_MERGED:null}),x=[],D={mixins:_.DEFINE_MANY,statics:_.DEFINE_MANY,propTypes:_.DEFINE_MANY,contextTypes:_.DEFINE_MANY,childContextTypes:_.DEFINE_MANY,getDefaultProps:_.DEFINE_MANY_MERGED,getInitialState:_.DEFINE_MANY_MERGED,getChildContext:_.DEFINE_MANY_MERGED,render:_.DEFINE_ONCE,componentWillMount:_.DEFINE_MANY,componentDidMount:_.DEFINE_MANY,componentWillReceiveProps:_.DEFINE_MANY,shouldComponentUpdate:_.DEFINE_ONCE,componentWillUpdate:_.DEFINE_MANY,componentDidUpdate:_.DEFINE_MANY,componentWillUnmount:_.DEFINE_MANY,updateComponent:_.OVERRIDE_BASE},M={displayName:function(e,t){e.displayName=t},mixins:function(e,t){if(t)for(var n=0;n<t.length;n++)o(e,t[n])},childContextTypes:function(e,t){e.childContextTypes=g({},e.childContextTypes,t)},contextTypes:function(e,t){e.contextTypes=g({},e.contextTypes,t)},getDefaultProps:function(e,t){e.getDefaultProps=e.getDefaultProps?s(e.getDefaultProps,t):t},propTypes:function(e,t){e.propTypes=g({},e.propTypes,t)},statics:function(e,t){i(e,t)}},T={replaceState:function(e,t){v.enqueueReplaceState(this,e),t&&v.enqueueCallback(this,t)},isMounted:function(){var e=h.get(this);return e&&e!==m.currentlyMountingInstance},setProps:function(e,t){v.enqueueSetProps(this,e),t&&v.enqueueCallback(this,t)},replaceProps:function(e,t){v.enqueueReplaceProps(this,e),t&&v.enqueueCallback(this,t)}},N=function(){};g(N.prototype,p.prototype,T);var P={createClass:function(e){var t=function(e,t){this.__reactAutoBindMap&&c(this),this.props=e,this.context=t,this.state=null;var n=this.getInitialState?this.getInitialState():null;y("object"==typeof n&&!Array.isArray(n)),this.state=n};t.prototype=new N,t.prototype.constructor=t,x.forEach(o.bind(null,t)),o(t,e),t.getDefaultProps&&(t.defaultProps=t.getDefaultProps()),y(t.prototype.render);for(var n in D)t.prototype[n]||(t.prototype[n]=null);return t.type=t,t},injection:{injectMixin:function(e){x.push(e)}}};t.exports=P},{147:147,153:153,154:154,166:166,29:29,39:39,45:45,61:61,64:64,71:71,72:72,82:82,83:83,96:96}],39:[function(e,t,n){function r(e,t){this.props=e,this.context=t}var o=e(96),i=e(147);e(166),r.prototype.setState=function(e,t){i("object"==typeof e||"function"==typeof e||null==e),o.enqueueSetState(this,e),t&&o.enqueueCallback(this,t)},r.prototype.forceUpdate=function(e){o.enqueueForceUpdate(this),e&&o.enqueueCallback(this,e)},t.exports=r},{147:147,166:166,96:96}],40:[function(e,t,n){var r=e(50),o=e(75),i={processChildrenUpdates:r.dangerouslyProcessChildrenUpdates,replaceNodeWithMarkupByID:r.dangerouslyReplaceNodeWithMarkupByID,unmountIDFromEnvironment:function(e){o.purgeID(e)}};t.exports=i},{50:50,75:75}],41:[function(e,t,n){var r=e(147),o=!1,i={unmountIDFromEnvironment:null,replaceNodeWithMarkupByID:null,processChildrenUpdates:null,injection:{injectEnvironment:function(e){r(!o),i.unmountIDFromEnvironment=e.unmountIDFromEnvironment,i.replaceNodeWithMarkupByID=e.replaceNodeWithMarkupByID,i.processChildrenUpdates=e.processChildrenUpdates,o=!0}}};t.exports=i},{147:147}],42:[function(e,t,n){var r=e(161),o={shouldComponentUpdate:function(e,t){return!r(this.props,e)||!r(this.state,t)}};t.exports=o},{161:161}],43:[function(e,t,n){function r(e){var t=e._currentElement._owner||null;if(t){var n=t.getName();if(n)return" Check the render method of `"+n+"`."}return""}var o=e(41),i=e(44),a=e(45),s=e(61),u=(e(62),e(71)),l=e(72),c=e(78),p=e(80),d=e(83),f=(e(82),e(87)),h=e(97),m=e(29),v=e(127),g=e(147),y=e(162),C=(e(166),1),E={construct:function(e){this._currentElement=e,this._rootNodeID=null,this._instance=null,this._pendingElement=null,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._renderedComponent=null,this._context=null,this._mountOrder=0,this._isTopLevel=!1,this._pendingCallbacks=null},mountComponent:function(e,t,n){this._context=n,this._mountOrder=C++,this._rootNodeID=e;var r=this._processProps(this._currentElement.props),o=this._processContext(this._currentElement._context),i=c.getComponentClassForElement(this._currentElement),a=new i(r,o);a.props=r,a.context=o,a.refs=v,this._instance=a,u.set(a,this);var s=a.state;void 0===s&&(a.state=s=null),g("object"==typeof s&&!Array.isArray(s)),this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1;var p,d,h=l.currentlyMountingInstance;l.currentlyMountingInstance=this;try{a.componentWillMount&&(a.componentWillMount(),this._pendingStateQueue&&(a.state=this._processPendingState(a.props,a.context))),p=this._getValidatedChildContext(n),d=this._renderValidatedComponent(p)}finally{l.currentlyMountingInstance=h}this._renderedComponent=this._instantiateReactComponent(d,this._currentElement.type);var m=f.mountComponent(this._renderedComponent,e,t,this._mergeChildContext(n,p));return a.componentDidMount&&t.getReactMountReady().enqueue(a.componentDidMount,a),m},unmountComponent:function(){var e=this._instance;if(e.componentWillUnmount){var t=l.currentlyUnmountingInstance;l.currentlyUnmountingInstance=this;try{e.componentWillUnmount()}finally{l.currentlyUnmountingInstance=t}}f.unmountComponent(this._renderedComponent),this._renderedComponent=null,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._pendingCallbacks=null,this._pendingElement=null,this._context=null,this._rootNodeID=null,u.remove(e)},_setPropsInternal:function(e,t){var n=this._pendingElement||this._currentElement;this._pendingElement=s.cloneAndReplaceProps(n,m({},n.props,e)),h.enqueueUpdate(this,t)},_maskContext:function(e){var t=null;if("string"==typeof this._currentElement.type)return v;var n=this._currentElement.type.contextTypes;if(!n)return v;t={};for(var r in n)t[r]=e[r];return t},_processContext:function(e){var t=this._maskContext(e);return t},_getValidatedChildContext:function(e){var t=this._instance,n=t.getChildContext&&t.getChildContext();if(n){g("object"==typeof t.constructor.childContextTypes);for(var r in n)g(r in t.constructor.childContextTypes);return n}return null},_mergeChildContext:function(e,t){return t?m({},e,t):e},_processProps:function(e){return e},_checkPropTypes:function(e,t,n){var o=this.getName();for(var i in e)if(e.hasOwnProperty(i)){var a;try{g("function"==typeof e[i]),a=e[i](t,i,o,n)}catch(s){a=s}a instanceof Error&&(r(this),n===d.prop)}},receiveComponent:function(e,t,n){var r=this._currentElement,o=this._context;this._pendingElement=null,this.updateComponent(t,r,e,o,n)},performUpdateIfNecessary:function(e){null!=this._pendingElement&&f.receiveComponent(this,this._pendingElement||this._currentElement,e,this._context),(null!==this._pendingStateQueue||this._pendingForceUpdate)&&this.updateComponent(e,this._currentElement,this._currentElement,this._context,this._context)},_warnIfContextsDiffer:function(e,t){e=this._maskContext(e),t=this._maskContext(t);for(var n=Object.keys(t).sort(),r=(this.getName()||"ReactCompositeComponent",0);r<n.length;r++)n[r]},updateComponent:function(e,t,n,r,o){var i=this._instance,a=i.context,s=i.props;t!==n&&(a=this._processContext(n._context),s=this._processProps(n.props),i.componentWillReceiveProps&&i.componentWillReceiveProps(s,a));var u=this._processPendingState(s,a),l=this._pendingForceUpdate||!i.shouldComponentUpdate||i.shouldComponentUpdate(s,u,a);l?(this._pendingForceUpdate=!1,this._performComponentUpdate(n,s,u,a,e,o)):(this._currentElement=n,this._context=o,i.props=s,i.state=u,i.context=a)},_processPendingState:function(e,t){var n=this._instance,r=this._pendingStateQueue,o=this._pendingReplaceState;if(this._pendingReplaceState=!1,this._pendingStateQueue=null,!r)return n.state;if(o&&1===r.length)return r[0];for(var i=m({},o?r[0]:n.state),a=o?1:0;a<r.length;a++){var s=r[a];m(i,"function"==typeof s?s.call(n,i,e,t):s)}return i},_performComponentUpdate:function(e,t,n,r,o,i){var a=this._instance,s=a.props,u=a.state,l=a.context;a.componentWillUpdate&&a.componentWillUpdate(t,n,r),this._currentElement=e,this._context=i,a.props=t,a.state=n,a.context=r,this._updateRenderedComponent(o,i),a.componentDidUpdate&&o.getReactMountReady().enqueue(a.componentDidUpdate.bind(a,s,u,l),a)},_updateRenderedComponent:function(e,t){var n=this._renderedComponent,r=n._currentElement,o=this._getValidatedChildContext(),i=this._renderValidatedComponent(o);if(y(r,i))f.receiveComponent(n,i,e,this._mergeChildContext(t,o));else{var a=this._rootNodeID,s=n._rootNodeID;f.unmountComponent(n),this._renderedComponent=this._instantiateReactComponent(i,this._currentElement.type);var u=f.mountComponent(this._renderedComponent,a,e,this._mergeChildContext(t,o));this._replaceNodeWithMarkupByID(s,u)}},_replaceNodeWithMarkupByID:function(e,t){o.replaceNodeWithMarkupByID(e,t)},_renderValidatedComponentWithoutOwnerOrContext:function(){var e=this._instance,t=e.render();return t},_renderValidatedComponent:function(e){var t,n=i.current;i.current=this._mergeChildContext(this._currentElement._context,e),a.current=this;try{t=this._renderValidatedComponentWithoutOwnerOrContext()}finally{i.current=n,a.current=null}return g(null===t||t===!1||s.isValidElement(t)),t},attachRef:function(e,t){var n=this.getPublicInstance(),r=n.refs===v?n.refs={}:n.refs;r[e]=t.getPublicInstance()},detachRef:function(e){var t=this.getPublicInstance().refs;delete t[e]},getName:function(){var e=this._currentElement.type,t=this._instance&&this._instance.constructor;return e.displayName||t&&t.displayName||e.name||t&&t.name||null},getPublicInstance:function(){return this._instance},_instantiateReactComponent:null};p.measureMethods(E,"ReactCompositeComponent",{mountComponent:"mountComponent",updateComponent:"updateComponent",_renderValidatedComponent:"_renderValidatedComponent"});var b={Mixin:E};t.exports=b},{127:127,147:147,162:162,166:166,29:29,41:41,44:44,45:45,61:61,62:62,71:71,72:72,78:78,80:80,82:82,83:83,87:87,97:97}],44:[function(e,t,n){var r=e(29),o=e(127),i=(e(166),{current:o,withContext:function(e,t){var n,o=i.current;i.current=r({},o,e);try{n=t()}finally{i.current=o}return n}});t.exports=i},{127:127,166:166,29:29}],45:[function(e,t,n){var r={current:null};t.exports=r},{}],46:[function(e,t,n){function r(e){return o.createFactory(e)}var o=e(61),i=(e(62),e(155)),a=i({a:"a",abbr:"abbr",address:"address",area:"area",article:"article",aside:"aside",audio:"audio",b:"b",base:"base",bdi:"bdi",bdo:"bdo",big:"big",blockquote:"blockquote",body:"body",br:"br",button:"button",canvas:"canvas",caption:"caption",cite:"cite",code:"code",col:"col",colgroup:"colgroup",data:"data",datalist:"datalist",dd:"dd",del:"del",details:"details",dfn:"dfn",dialog:"dialog",div:"div",dl:"dl",dt:"dt",em:"em",embed:"embed",fieldset:"fieldset",figcaption:"figcaption",figure:"figure",footer:"footer",form:"form",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",head:"head",header:"header",hr:"hr",html:"html",i:"i",iframe:"iframe",img:"img",input:"input",ins:"ins",kbd:"kbd",keygen:"keygen",label:"label",legend:"legend",li:"li",link:"link",main:"main",map:"map",mark:"mark",menu:"menu",menuitem:"menuitem",meta:"meta",meter:"meter",nav:"nav",noscript:"noscript",object:"object",ol:"ol",optgroup:"optgroup",option:"option",output:"output",p:"p",param:"param",picture:"picture",pre:"pre",progress:"progress",q:"q",rp:"rp",rt:"rt",ruby:"ruby",s:"s",samp:"samp",script:"script",section:"section",select:"select",small:"small",source:"source",span:"span",strong:"strong",style:"style",sub:"sub",summary:"summary",sup:"sup",table:"table",tbody:"tbody",td:"td",textarea:"textarea",tfoot:"tfoot",th:"th",thead:"thead",time:"time",title:"title",tr:"tr",track:"track",u:"u",ul:"ul","var":"var",video:"video",wbr:"wbr",circle:"circle",clipPath:"clipPath",defs:"defs",ellipse:"ellipse",g:"g",line:"line",linearGradient:"linearGradient",mask:"mask",path:"path",pattern:"pattern",polygon:"polygon",polyline:"polyline",radialGradient:"radialGradient",rect:"rect",stop:"stop",svg:"svg",text:"text",tspan:"tspan"},r);t.exports=a},{155:155,61:61,62:62}],47:[function(e,t,n){var r=e(2),o=e(32),i=e(38),a=e(61),s=e(153),u=a.createFactory("button"),l=s({onClick:!0,onDoubleClick:!0,onMouseDown:!0,onMouseMove:!0,onMouseUp:!0,onClickCapture:!0,onDoubleClickCapture:!0,onMouseDownCapture:!0,onMouseMoveCapture:!0,onMouseUpCapture:!0}),c=i.createClass({displayName:"ReactDOMButton",tagName:"BUTTON",mixins:[r,o],render:function(){var e={};for(var t in this.props)!this.props.hasOwnProperty(t)||this.props.disabled&&l[t]||(e[t]=this.props[t]);return u(e,this.props.children)}});t.exports=c},{153:153,2:2,32:32,38:38,61:61}],48:[function(e,t,n){function r(e){e&&(null!=e.dangerouslySetInnerHTML&&(g(null==e.children),g("object"==typeof e.dangerouslySetInnerHTML&&"__html"in e.dangerouslySetInnerHTML)),g(null==e.style||"object"==typeof e.style))}function o(e,t,n,r){var o=d.findReactContainerForID(e);if(o){var i=o.nodeType===D?o.ownerDocument:o;E(t,i)}r.getPutListenerQueue().enqueuePutListener(e,t,n)}function i(e){I.call(P,e)||(g(N.test(e)),P[e]=!0)}function a(e){i(e),this._tag=e,this._renderedChildren=null,this._previousStyleCopy=null,this._rootNodeID=null}var s=e(6),u=e(11),l=e(12),c=e(33),p=e(40),d=e(75),f=e(76),h=e(80),m=e(29),v=e(128),g=e(147),y=(e(148),e(154)),C=(e(166),c.deleteListener),E=c.listenTo,b=c.registrationNameModules,_={string:!0,number:!0},x=y({style:null}),D=1,M=null,T={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},N=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,P={},I={}.hasOwnProperty;a.displayName="ReactDOMComponent",a.Mixin={construct:function(e){this._currentElement=e},mountComponent:function(e,t,n){this._rootNodeID=e,r(this._currentElement.props);var o=T[this._tag]?"":"</"+this._tag+">";return this._createOpenTagMarkupAndPutListeners(t)+this._createContentMarkup(t,n)+o},_createOpenTagMarkupAndPutListeners:function(e){var t=this._currentElement.props,n="<"+this._tag;for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];if(null!=i)if(b.hasOwnProperty(r))o(this._rootNodeID,r,i,e);else{r===x&&(i&&(i=this._previousStyleCopy=m({},t.style)),i=s.createMarkupForStyles(i));var a=l.createMarkupForProperty(r,i);a&&(n+=" "+a)}}if(e.renderToStaticMarkup)return n+">";var u=l.createMarkupForID(this._rootNodeID);return n+" "+u+">"},_createContentMarkup:function(e,t){var n="";("listing"===this._tag||"pre"===this._tag||"textarea"===this._tag)&&(n="\n");var r=this._currentElement.props,o=r.dangerouslySetInnerHTML;if(null!=o){if(null!=o.__html)return n+o.__html}else{var i=_[typeof r.children]?r.children:null,a=null!=i?null:r.children;if(null!=i)return n+v(i);if(null!=a){var s=this.mountChildren(a,e,t);return n+s.join("")}}return n},receiveComponent:function(e,t,n){var r=this._currentElement;this._currentElement=e,this.updateComponent(t,r,e,n)},updateComponent:function(e,t,n,o){r(this._currentElement.props),this._updateDOMProperties(t.props,e),this._updateDOMChildren(t.props,e,o)},_updateDOMProperties:function(e,t){var n,r,i,a=this._currentElement.props;for(n in e)if(!a.hasOwnProperty(n)&&e.hasOwnProperty(n))if(n===x){var s=this._previousStyleCopy;for(r in s)s.hasOwnProperty(r)&&(i=i||{},i[r]="");this._previousStyleCopy=null}else b.hasOwnProperty(n)?C(this._rootNodeID,n):(u.isStandardName[n]||u.isCustomAttribute(n))&&M.deletePropertyByID(this._rootNodeID,n);for(n in a){var l=a[n],c=n===x?this._previousStyleCopy:e[n];if(a.hasOwnProperty(n)&&l!==c)if(n===x)if(l?l=this._previousStyleCopy=m({},l):this._previousStyleCopy=null,c){for(r in c)!c.hasOwnProperty(r)||l&&l.hasOwnProperty(r)||(i=i||{},i[r]="");for(r in l)l.hasOwnProperty(r)&&c[r]!==l[r]&&(i=i||{},i[r]=l[r])}else i=l;else b.hasOwnProperty(n)?o(this._rootNodeID,n,l,t):(u.isStandardName[n]||u.isCustomAttribute(n))&&M.updatePropertyByID(this._rootNodeID,n,l)}i&&M.updateStylesByID(this._rootNodeID,i)},_updateDOMChildren:function(e,t,n){var r=this._currentElement.props,o=_[typeof e.children]?e.children:null,i=_[typeof r.children]?r.children:null,a=e.dangerouslySetInnerHTML&&e.dangerouslySetInnerHTML.__html,s=r.dangerouslySetInnerHTML&&r.dangerouslySetInnerHTML.__html,u=null!=o?null:e.children,l=null!=i?null:r.children,c=null!=o||null!=a,p=null!=i||null!=s;null!=u&&null==l?this.updateChildren(null,t,n):c&&!p&&this.updateTextContent(""),null!=i?o!==i&&this.updateTextContent(""+i):null!=s?a!==s&&M.updateInnerHTMLByID(this._rootNodeID,s):null!=l&&this.updateChildren(l,t,n)},unmountComponent:function(){this.unmountChildren(),c.deleteAllListeners(this._rootNodeID),p.unmountIDFromEnvironment(this._rootNodeID),this._rootNodeID=null}},h.measureMethods(a,"ReactDOMComponent",{mountComponent:"mountComponent",updateComponent:"updateComponent"}),m(a.prototype,a.Mixin,f.Mixin),a.injection={injectIDOperations:function(e){a.BackendIDOperations=M=e}},t.exports=a},{11:11,12:12,128:128,147:147,148:148,154:154,166:166,29:29,33:33,40:40,6:6,75:75,76:76,80:80}],49:[function(e,t,n){var r=e(16),o=e(27),i=e(32),a=e(38),s=e(61),u=s.createFactory("form"),l=a.createClass({displayName:"ReactDOMForm",tagName:"FORM",mixins:[i,o],render:function(){return u(this.props)},componentDidMount:function(){this.trapBubbledEvent(r.topLevelTypes.topReset,"reset"),this.trapBubbledEvent(r.topLevelTypes.topSubmit,"submit")}});t.exports=l},{16:16,27:27,32:32,38:38,61:61}],50:[function(e,t,n){var r=e(6),o=e(10),i=e(12),a=e(75),s=e(80),u=e(147),l=e(159),c={dangerouslySetInnerHTML:"`dangerouslySetInnerHTML` must be set using `updateInnerHTMLByID()`.",style:"`style` must be set using `updateStylesByID()`."},p={updatePropertyByID:function(e,t,n){var r=a.getNode(e);u(!c.hasOwnProperty(t)),null!=n?i.setValueForProperty(r,t,n):i.deleteValueForProperty(r,t)},deletePropertyByID:function(e,t,n){var r=a.getNode(e);u(!c.hasOwnProperty(t)),i.deleteValueForProperty(r,t,n)},updateStylesByID:function(e,t){var n=a.getNode(e);r.setValueForStyles(n,t)},updateInnerHTMLByID:function(e,t){var n=a.getNode(e);l(n,t)},updateTextContentByID:function(e,t){var n=a.getNode(e);o.updateTextContent(n,t)},dangerouslyReplaceNodeWithMarkupByID:function(e,t){var n=a.getNode(e);o.dangerouslyReplaceNodeWithMarkup(n,t)},dangerouslyProcessChildrenUpdates:function(e,t){for(var n=0;n<e.length;n++)e[n].parentNode=a.getNode(e[n].parentID);o.processUpdates(e,t)}};s.measureMethods(p,"ReactDOMIDOperations",{updatePropertyByID:"updatePropertyByID",deletePropertyByID:"deletePropertyByID",updateStylesByID:"updateStylesByID",updateInnerHTMLByID:"updateInnerHTMLByID",updateTextContentByID:"updateTextContentByID",dangerouslyReplaceNodeWithMarkupByID:"dangerouslyReplaceNodeWithMarkupByID",dangerouslyProcessChildrenUpdates:"dangerouslyProcessChildrenUpdates"}),t.exports=p},{10:10,12:12,147:147,159:159,6:6,75:75,80:80}],51:[function(e,t,n){var r=e(16),o=e(27),i=e(32),a=e(38),s=e(61),u=s.createFactory("iframe"),l=a.createClass({displayName:"ReactDOMIframe",tagName:"IFRAME",mixins:[i,o],render:function(){return u(this.props)},componentDidMount:function(){this.trapBubbledEvent(r.topLevelTypes.topLoad,"load")}});t.exports=l},{16:16,27:27,32:32,38:38,61:61}],52:[function(e,t,n){var r=e(16),o=e(27),i=e(32),a=e(38),s=e(61),u=s.createFactory("img"),l=a.createClass({displayName:"ReactDOMImg",tagName:"IMG",mixins:[i,o],render:function(){return u(this.props)},componentDidMount:function(){this.trapBubbledEvent(r.topLevelTypes.topLoad,"load"),this.trapBubbledEvent(r.topLevelTypes.topError,"error")}});t.exports=l},{16:16,27:27,32:32,38:38,61:61}],53:[function(e,t,n){function r(){this.isMounted()&&this.forceUpdate()}var o=e(2),i=e(12),a=e(26),s=e(32),u=e(38),l=e(61),c=e(75),p=e(97),d=e(29),f=e(147),h=l.createFactory("input"),m={},v=u.createClass({displayName:"ReactDOMInput",tagName:"INPUT",mixins:[o,a.Mixin,s],getInitialState:function(){var e=this.props.defaultValue;return{initialChecked:this.props.defaultChecked||!1,initialValue:null!=e?e:null}},render:function(){var e=d({},this.props);e.defaultChecked=null,e.defaultValue=null;var t=a.getValue(this);e.value=null!=t?t:this.state.initialValue;var n=a.getChecked(this);return e.checked=null!=n?n:this.state.initialChecked,e.onChange=this._handleChange,h(e,this.props.children)},componentDidMount:function(){var e=c.getID(this.getDOMNode());m[e]=this},componentWillUnmount:function(){var e=this.getDOMNode(),t=c.getID(e);delete m[t]},componentDidUpdate:function(e,t,n){var r=this.getDOMNode();null!=this.props.checked&&i.setValueForProperty(r,"checked",this.props.checked||!1);var o=a.getValue(this);null!=o&&i.setValueForProperty(r,"value",""+o)},_handleChange:function(e){var t,n=a.getOnChange(this);n&&(t=n.call(this,e)),p.asap(r,this);var o=this.props.name;if("radio"===this.props.type&&null!=o){for(var i=this.getDOMNode(),s=i;s.parentNode;)s=s.parentNode;for(var u=s.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),l=0,d=u.length;d>l;l++){var h=u[l];if(h!==i&&h.form===i.form){var v=c.getID(h);f(v);var g=m[v];f(g),p.asap(r,g)}}}return t}});t.exports=v},{12:12,147:147,2:2,26:26,29:29,32:32,38:38,61:61,75:75,97:97}],54:[function(e,t,n){var r=e(32),o=e(38),i=e(61),a=(e(166),i.createFactory("option")),s=o.createClass({displayName:"ReactDOMOption",tagName:"OPTION",mixins:[r],componentWillMount:function(){},render:function(){return a(this.props,this.props.children)}});t.exports=s},{166:166,32:32,38:38,61:61}],55:[function(e,t,n){function r(){if(this._pendingUpdate){this._pendingUpdate=!1;var e=s.getValue(this);null!=e&&this.isMounted()&&i(this,e)}}function o(e,t,n){if(null==e[t])return null;if(e.multiple){if(!Array.isArray(e[t]))return new Error("The `"+t+"` prop supplied to <select> must be an array if `multiple` is true.")}else if(Array.isArray(e[t]))return new Error("The `"+t+"` prop supplied to <select> must be a scalar value if `multiple` is false.")}function i(e,t){var n,r,o,i=e.getDOMNode().options;if(e.props.multiple){for(n={},r=0,o=t.length;o>r;r++)n[""+t[r]]=!0;for(r=0,o=i.length;o>r;r++){var a=n.hasOwnProperty(i[r].value);i[r].selected!==a&&(i[r].selected=a)}}else{for(n=""+t,r=0,o=i.length;o>r;r++)if(i[r].value===n)return void(i[r].selected=!0);i.length&&(i[0].selected=!0)}}var a=e(2),s=e(26),u=e(32),l=e(38),c=e(61),p=e(97),d=e(29),f=c.createFactory("select"),h=l.createClass({displayName:"ReactDOMSelect",tagName:"SELECT",mixins:[a,s.Mixin,u],propTypes:{defaultValue:o,value:o},render:function(){var e=d({},this.props);return e.onChange=this._handleChange,e.value=null,f(e,this.props.children)},componentWillMount:function(){this._pendingUpdate=!1},componentDidMount:function(){var e=s.getValue(this);null!=e?i(this,e):null!=this.props.defaultValue&&i(this,this.props.defaultValue)},componentDidUpdate:function(e){var t=s.getValue(this);null!=t?(this._pendingUpdate=!1,i(this,t)):!e.multiple!=!this.props.multiple&&(null!=this.props.defaultValue?i(this,this.props.defaultValue):i(this,this.props.multiple?[]:""))},_handleChange:function(e){var t,n=s.getOnChange(this);return n&&(t=n.call(this,e)),this._pendingUpdate=!0,p.asap(r,this),t}});t.exports=h},{2:2,26:26,29:29,32:32,38:38,61:61,97:97}],56:[function(e,t,n){function r(e,t,n,r){return e===n&&t===r}function o(e){var t=document.selection,n=t.createRange(),r=n.text.length,o=n.duplicate();o.moveToElementText(e),o.setEndPoint("EndToStart",n);var i=o.text.length,a=i+r;return{start:i,end:a}}function i(e){var t=window.getSelection&&window.getSelection();if(!t||0===t.rangeCount)return null;var n=t.anchorNode,o=t.anchorOffset,i=t.focusNode,a=t.focusOffset,s=t.getRangeAt(0),u=r(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),l=u?0:s.toString().length,c=s.cloneRange();c.selectNodeContents(e),c.setEnd(s.startContainer,s.startOffset);var p=r(c.startContainer,c.startOffset,c.endContainer,c.endOffset),d=p?0:c.toString().length,f=d+l,h=document.createRange();h.setStart(n,o),h.setEnd(i,a);var m=h.collapsed;return{start:m?f:d,end:m?d:f}}function a(e,t){var n,r,o=document.selection.createRange().duplicate();"undefined"==typeof t.end?(n=t.start,r=n):t.start>t.end?(n=t.end,r=t.start):(n=t.start,r=t.end),o.moveToElementText(e),o.moveStart("character",n),o.setEndPoint("EndToStart",o),o.moveEnd("character",r-n),o.select()}function s(e,t){if(window.getSelection){var n=window.getSelection(),r=e[c()].length,o=Math.min(t.start,r),i="undefined"==typeof t.end?o:Math.min(t.end,r);if(!n.extend&&o>i){var a=i;i=o,o=a}var s=l(e,o),u=l(e,i);if(s&&u){var p=document.createRange();p.setStart(s.node,s.offset),n.removeAllRanges(),o>i?(n.addRange(p),n.extend(u.node,u.offset)):(p.setEnd(u.node,u.offset),n.addRange(p))}}}var u=e(22),l=e(140),c=e(142),p=u.canUseDOM&&"selection"in document&&!("getSelection"in window),d={getOffsets:p?o:i,setOffsets:p?a:s};t.exports=d},{140:140,142:142,22:22}],57:[function(e,t,n){var r=e(12),o=e(40),i=e(48),a=e(29),s=e(128),u=function(e){};a(u.prototype,{construct:function(e){this._currentElement=e,this._stringText=""+e,this._rootNodeID=null,this._mountIndex=0},mountComponent:function(e,t,n){this._rootNodeID=e;var o=s(this._stringText);return t.renderToStaticMarkup?o:"<span "+r.createMarkupForID(e)+">"+o+"</span>"},receiveComponent:function(e,t){if(e!==this._currentElement){this._currentElement=e;var n=""+e;n!==this._stringText&&(this._stringText=n,i.BackendIDOperations.updateTextContentByID(this._rootNodeID,n))}},unmountComponent:function(){o.unmountIDFromEnvironment(this._rootNodeID)}}),t.exports=u},{12:12,128:128,29:29,40:40,48:48}],58:[function(e,t,n){function r(){this.isMounted()&&this.forceUpdate()}var o=e(2),i=e(12),a=e(26),s=e(32),u=e(38),l=e(61),c=e(97),p=e(29),d=e(147),f=(e(166),l.createFactory("textarea")),h=u.createClass({displayName:"ReactDOMTextarea",tagName:"TEXTAREA",mixins:[o,a.Mixin,s],getInitialState:function(){var e=this.props.defaultValue,t=this.props.children;null!=t&&(d(null==e),Array.isArray(t)&&(d(t.length<=1),t=t[0]),e=""+t),null==e&&(e="");var n=a.getValue(this);return{initialValue:""+(null!=n?n:e)}},render:function(){var e=p({},this.props);return d(null==e.dangerouslySetInnerHTML),e.defaultValue=null,e.value=null,e.onChange=this._handleChange,f(e,this.state.initialValue)},componentDidUpdate:function(e,t,n){var r=a.getValue(this);if(null!=r){var o=this.getDOMNode();i.setValueForProperty(o,"value",""+r)}},_handleChange:function(e){var t,n=a.getOnChange(this);return n&&(t=n.call(this,e)),c.asap(r,this),t}});t.exports=h},{12:12,147:147,166:166,2:2,26:26,29:29,32:32,38:38,61:61,97:97}],59:[function(e,t,n){function r(){this.reinitializeTransaction()}var o=e(97),i=e(113),a=e(29),s=e(126),u={initialize:s,close:function(){d.isBatchingUpdates=!1}},l={initialize:s,close:o.flushBatchedUpdates.bind(o)},c=[l,u];a(r.prototype,i.Mixin,{getTransactionWrappers:function(){return c}});var p=new r,d={isBatchingUpdates:!1,batchedUpdates:function(e,t,n,r,o){var i=d.isBatchingUpdates;d.isBatchingUpdates=!0,i?e(t,n,r,o):p.perform(e,null,t,n,r,o)}};t.exports=d},{113:113,126:126,29:29,97:97}],60:[function(e,t,n){function r(e){return h.createClass({tagName:e.toUpperCase(),render:function(){return new P(e,null,null,null,null,this.props)}})}function o(){R.EventEmitter.injectReactEventListener(I),R.EventPluginHub.injectEventPluginOrder(u),R.EventPluginHub.injectInstanceHandle(w),R.EventPluginHub.injectMount(O),R.EventPluginHub.injectEventPluginsByName({SimpleEventPlugin:L,EnterLeaveEventPlugin:l,ChangeEventPlugin:a,MobileSafariClickEventPlugin:d,SelectEventPlugin:A,BeforeInputEventPlugin:i}),R.NativeComponent.injectGenericComponentClass(g),R.NativeComponent.injectTextComponentClass(N),R.NativeComponent.injectAutoWrapper(r),R.Class.injectMixin(f),R.NativeComponent.injectComponentClasses({button:y,form:C,iframe:_,img:E,input:x,option:D,select:M,textarea:T,html:F("html"),head:F("head"),body:F("body")}),R.DOMProperty.injectDOMPropertyConfig(p),R.DOMProperty.injectDOMPropertyConfig(U),R.EmptyComponent.injectEmptyComponent("noscript"),R.Updates.injectReconcileTransaction(S),R.Updates.injectBatchingStrategy(v),R.RootIndex.injectCreateReactRootIndex(c.canUseDOM?s.createReactRootIndex:k.createReactRootIndex),R.Component.injectEnvironment(m),R.DOMComponent.injectIDOperations(b)}var i=e(3),a=e(8),s=e(9),u=e(14),l=e(15),c=e(22),p=e(24),d=e(28),f=e(32),h=e(38),m=e(40),v=e(59),g=e(48),y=e(47),C=e(49),E=e(52),b=e(50),_=e(51),x=e(53),D=e(54),M=e(55),T=e(58),N=e(57),P=e(61),I=e(66),R=e(68),w=e(70),O=e(75),S=e(86),A=e(99),k=e(100),L=e(101),U=e(98),F=e(122);t.exports={inject:o}},{100:100,101:101,122:122,14:14,15:15,22:22,24:24,28:28,3:3,32:32,38:38,40:40,47:47,48:48,49:49,50:50,51:51,52:52,53:53,54:54,55:55,57:57,58:58,59:59,61:61,66:66,68:68,70:70,75:75,8:8,86:86,9:9,98:98,99:99}],61:[function(e,t,n){var r=e(44),o=e(45),i=e(29),a=(e(166),{key:!0,ref:!0}),s=function(e,t,n,r,o,i){this.type=e,this.key=t,this.ref=n,this._owner=r,this._context=o,this.props=i};s.prototype={_isReactElement:!0},s.createElement=function(e,t,n){var i,u={},l=null,c=null;if(null!=t){c=void 0===t.ref?null:t.ref,l=void 0===t.key?null:""+t.key;for(i in t)t.hasOwnProperty(i)&&!a.hasOwnProperty(i)&&(u[i]=t[i])}var p=arguments.length-2;if(1===p)u.children=n;else if(p>1){for(var d=Array(p),f=0;p>f;f++)d[f]=arguments[f+2];u.children=d}if(e&&e.defaultProps){var h=e.defaultProps;for(i in h)"undefined"==typeof u[i]&&(u[i]=h[i])}return new s(e,l,c,o.current,r.current,u)},s.createFactory=function(e){var t=s.createElement.bind(null,e);return t.type=e,t},s.cloneAndReplaceProps=function(e,t){var n=new s(e.type,e.key,e.ref,e._owner,e._context,t);return n},s.cloneElement=function(e,t,n){var r,u=i({},e.props),l=e.key,c=e.ref,p=e._owner;if(null!=t){void 0!==t.ref&&(c=t.ref,p=o.current),void 0!==t.key&&(l=""+t.key);for(r in t)t.hasOwnProperty(r)&&!a.hasOwnProperty(r)&&(u[r]=t[r])}var d=arguments.length-2;if(1===d)u.children=n;else if(d>1){for(var f=Array(d),h=0;d>h;h++)f[h]=arguments[h+2];u.children=f}return new s(e.type,l,c,p,e._context,u)},s.isValidElement=function(e){var t=!(!e||!e._isReactElement);return t},t.exports=s},{166:166,29:29,44:44,45:45}],62:[function(e,t,n){function r(){if(y.current){var e=y.current.getName();if(e)return" Check the render method of `"+e+"`."}return""}function o(e){var t=e&&e.getPublicInstance();if(!t)return void 0;var n=t.constructor;return n?n.displayName||n.name||void 0:void 0}function i(){var e=y.current;return e&&o(e)||void 0}function a(e,t){e._store.validated||null!=e.key||(e._store.validated=!0,u('Each child in an array or iterator should have a unique "key" prop.',e,t))}function s(e,t,n){D.test(e)&&u("Child objects should have non-numeric keys so ordering is preserved.",t,n)
}function u(e,t,n){var r=i(),a="string"==typeof n?n:n.displayName||n.name,s=r||a,u=_[e]||(_[e]={});if(!u.hasOwnProperty(s)){u[s]=!0;var l="";if(t&&t._owner&&t._owner!==y.current){var c=o(t._owner);l=" It was passed a child from "+c+"."}}}function l(e,t){if(Array.isArray(e))for(var n=0;n<e.length;n++){var r=e[n];m.isValidElement(r)&&a(r,t)}else if(m.isValidElement(e))e._store.validated=!0;else if(e){var o=E(e);if(o){if(o!==e.entries)for(var i,u=o.call(e);!(i=u.next()).done;)m.isValidElement(i.value)&&a(i.value,t)}else if("object"==typeof e){var l=v.extractIfFragment(e);for(var c in l)l.hasOwnProperty(c)&&s(c,l[c],t)}}}function c(e,t,n,o){for(var i in t)if(t.hasOwnProperty(i)){var a;try{b("function"==typeof t[i]),a=t[i](n,i,e,o)}catch(s){a=s}a instanceof Error&&!(a.message in x)&&(x[a.message]=!0,r(this))}}function p(e,t){var n=t.type,r="string"==typeof n?n:n.displayName,o=t._owner?t._owner.getPublicInstance().constructor.displayName:null,i=e+"|"+r+"|"+o;if(!M.hasOwnProperty(i)){M[i]=!0;var a="";r&&(a=" <"+r+" />");var s="";o&&(s=" The element was created by "+o+".")}}function d(e,t){return e!==e?t!==t:0===e&&0===t?1/e===1/t:e===t}function f(e){if(e._store){var t=e._store.originalProps,n=e.props;for(var r in n)n.hasOwnProperty(r)&&(t.hasOwnProperty(r)&&d(t[r],n[r])||(p(r,e),t[r]=n[r]))}}function h(e){if(null!=e.type){var t=C.getComponentClassForElement(e),n=t.displayName||t.name;t.propTypes&&c(n,t.propTypes,e.props,g.prop),"function"==typeof t.getDefaultProps}}var m=e(61),v=e(67),g=e(83),y=(e(82),e(45)),C=e(78),E=e(138),b=e(147),_=(e(166),{}),x={},D=/^\d+$/,M={},T={checkAndWarnForMutatedProps:f,createElement:function(e,t,n){var r=m.createElement.apply(this,arguments);if(null==r)return r;for(var o=2;o<arguments.length;o++)l(arguments[o],e);return h(r),r},createFactory:function(e){var t=T.createElement.bind(null,e);return t.type=e,t},cloneElement:function(e,t,n){for(var r=m.cloneElement.apply(this,arguments),o=2;o<arguments.length;o++)l(arguments[o],r.type);return h(r),r}};t.exports=T},{138:138,147:147,166:166,45:45,61:61,67:67,78:78,82:82,83:83}],63:[function(e,t,n){function r(e){c[e]=!0}function o(e){delete c[e]}function i(e){return!!c[e]}var a,s=e(61),u=e(71),l=e(147),c={},p={injectEmptyComponent:function(e){a=s.createFactory(e)}},d=function(){};d.prototype.componentDidMount=function(){var e=u.get(this);e&&r(e._rootNodeID)},d.prototype.componentWillUnmount=function(){var e=u.get(this);e&&o(e._rootNodeID)},d.prototype.render=function(){return l(a),a()};var f=s.createElement(d),h={emptyElement:f,injection:p,isNullComponentID:i};t.exports=h},{147:147,61:61,71:71}],64:[function(e,t,n){var r={guard:function(e,t){return e}};t.exports=r},{}],65:[function(e,t,n){function r(e){o.enqueueEvents(e),o.processEventQueue()}var o=e(18),i={handleTopLevel:function(e,t,n,i){var a=o.extractEvents(e,t,n,i);r(a)}};t.exports=i},{18:18}],66:[function(e,t,n){function r(e){var t=p.getID(e),n=c.getReactRootIDFromNodeID(t),r=p.findReactContainerForID(n),o=p.getFirstReactDOM(r);return o}function o(e,t){this.topLevelType=e,this.nativeEvent=t,this.ancestors=[]}function i(e){for(var t=p.getFirstReactDOM(h(e.nativeEvent))||window,n=t;n;)e.ancestors.push(n),n=r(n);for(var o=0,i=e.ancestors.length;i>o;o++){t=e.ancestors[o];var a=p.getID(t)||"";v._handleTopLevel(e.topLevelType,t,a,e.nativeEvent)}}function a(e){var t=m(window);e(t)}var s=e(17),u=e(22),l=e(30),c=e(70),p=e(75),d=e(97),f=e(29),h=e(137),m=e(143);f(o.prototype,{destructor:function(){this.topLevelType=null,this.nativeEvent=null,this.ancestors.length=0}}),l.addPoolingTo(o,l.twoArgumentPooler);var v={_enabled:!0,_handleTopLevel:null,WINDOW_HANDLE:u.canUseDOM?window:null,setHandleTopLevel:function(e){v._handleTopLevel=e},setEnabled:function(e){v._enabled=!!e},isEnabled:function(){return v._enabled},trapBubbledEvent:function(e,t,n){var r=n;return r?s.listen(r,t,v.dispatchEvent.bind(null,e)):null},trapCapturedEvent:function(e,t,n){var r=n;return r?s.capture(r,t,v.dispatchEvent.bind(null,e)):null},monitorScrollValue:function(e){var t=a.bind(null,e);s.listen(window,"scroll",t)},dispatchEvent:function(e,t){if(v._enabled){var n=o.getPooled(e,t);try{d.batchedUpdates(i,n)}finally{o.release(n)}}}};t.exports=v},{137:137,143:143,17:17,22:22,29:29,30:30,70:70,75:75,97:97}],67:[function(e,t,n){var r=(e(61),e(166),{create:function(e){return e},extract:function(e){return e},extractIfFragment:function(e){return e}});t.exports=r},{166:166,61:61}],68:[function(e,t,n){var r=e(11),o=e(18),i=e(41),a=e(38),s=e(63),u=e(33),l=e(78),c=e(48),p=e(80),d=e(89),f=e(97),h={Component:i.injection,Class:a.injection,DOMComponent:c.injection,DOMProperty:r.injection,EmptyComponent:s.injection,EventPluginHub:o.injection,EventEmitter:u.injection,NativeComponent:l.injection,Perf:p.injection,RootIndex:d.injection,Updates:f.injection};t.exports=h},{11:11,18:18,33:33,38:38,41:41,48:48,63:63,78:78,80:80,89:89,97:97}],69:[function(e,t,n){function r(e){return i(document.documentElement,e)}var o=e(56),i=e(120),a=e(131),s=e(133),u={hasSelectionCapabilities:function(e){return e&&("INPUT"===e.nodeName&&"text"===e.type||"TEXTAREA"===e.nodeName||"true"===e.contentEditable)},getSelectionInformation:function(){var e=s();return{focusedElem:e,selectionRange:u.hasSelectionCapabilities(e)?u.getSelection(e):null}},restoreSelection:function(e){var t=s(),n=e.focusedElem,o=e.selectionRange;t!==n&&r(n)&&(u.hasSelectionCapabilities(n)&&u.setSelection(n,o),a(n))},getSelection:function(e){var t;if("selectionStart"in e)t={start:e.selectionStart,end:e.selectionEnd};else if(document.selection&&"INPUT"===e.nodeName){var n=document.selection.createRange();n.parentElement()===e&&(t={start:-n.moveStart("character",-e.value.length),end:-n.moveEnd("character",-e.value.length)})}else t=o.getOffsets(e);return t||{start:0,end:0}},setSelection:function(e,t){var n=t.start,r=t.end;if("undefined"==typeof r&&(r=n),"selectionStart"in e)e.selectionStart=n,e.selectionEnd=Math.min(r,e.value.length);else if(document.selection&&"INPUT"===e.nodeName){var i=e.createTextRange();i.collapse(!0),i.moveStart("character",n),i.moveEnd("character",r-n),i.select()}else o.setOffsets(e,t)}};t.exports=u},{120:120,131:131,133:133,56:56}],70:[function(e,t,n){function r(e){return f+e.toString(36)}function o(e,t){return e.charAt(t)===f||t===e.length}function i(e){return""===e||e.charAt(0)===f&&e.charAt(e.length-1)!==f}function a(e,t){return 0===t.indexOf(e)&&o(t,e.length)}function s(e){return e?e.substr(0,e.lastIndexOf(f)):""}function u(e,t){if(d(i(e)&&i(t)),d(a(e,t)),e===t)return e;var n,r=e.length+h;for(n=r;n<t.length&&!o(t,n);n++);return t.substr(0,n)}function l(e,t){var n=Math.min(e.length,t.length);if(0===n)return"";for(var r=0,a=0;n>=a;a++)if(o(e,a)&&o(t,a))r=a;else if(e.charAt(a)!==t.charAt(a))break;var s=e.substr(0,r);return d(i(s)),s}function c(e,t,n,r,o,i){e=e||"",t=t||"",d(e!==t);var l=a(t,e);d(l||a(e,t));for(var c=0,p=l?s:u,f=e;;f=p(f,t)){var h;if(o&&f===e||i&&f===t||(h=n(f,l,r)),h===!1||f===t)break;d(c++<m)}}var p=e(89),d=e(147),f=".",h=f.length,m=100,v={createReactRootID:function(){return r(p.createReactRootIndex())},createReactID:function(e,t){return e+t},getReactRootIDFromNodeID:function(e){if(e&&e.charAt(0)===f&&e.length>1){var t=e.indexOf(f,1);return t>-1?e.substr(0,t):e}return null},traverseEnterLeave:function(e,t,n,r,o){var i=l(e,t);i!==e&&c(e,i,n,r,!1,!0),i!==t&&c(i,t,n,o,!0,!1)},traverseTwoPhase:function(e,t,n){e&&(c("",e,t,n,!0,!1),c(e,"",t,n,!1,!0))},traverseAncestors:function(e,t,n){c("",e,t,n,!0,!1)},_getFirstCommonAncestorID:l,_getNextDescendantID:u,isAncestorIDOf:a,SEPARATOR:f};t.exports=v},{147:147,89:89}],71:[function(e,t,n){var r={remove:function(e){e._reactInternalInstance=void 0},get:function(e){return e._reactInternalInstance},has:function(e){return void 0!==e._reactInternalInstance},set:function(e,t){e._reactInternalInstance=t}};t.exports=r},{}],72:[function(e,t,n){var r={currentlyMountingInstance:null,currentlyUnmountingInstance:null};t.exports=r},{}],73:[function(e,t,n){function r(e,t){this.value=e,this.requestChange=t}function o(e){var t={value:"undefined"==typeof e?i.PropTypes.any.isRequired:e.isRequired,requestChange:i.PropTypes.func.isRequired};return i.PropTypes.shape(t)}var i=e(31);r.PropTypes={link:o},t.exports=r},{31:31}],74:[function(e,t,n){var r=e(116),o={CHECKSUM_ATTR_NAME:"data-react-checksum",addChecksumToMarkup:function(e){var t=r(e);return e.replace(">"," "+o.CHECKSUM_ATTR_NAME+'="'+t+'">')},canReuseMarkup:function(e,t){var n=t.getAttribute(o.CHECKSUM_ATTR_NAME);n=n&&parseInt(n,10);var i=r(e);return i===n}};t.exports=o},{116:116}],75:[function(e,t,n){function r(e,t){for(var n=Math.min(e.length,t.length),r=0;n>r;r++)if(e.charAt(r)!==t.charAt(r))return r;return e.length===t.length?-1:n}function o(e){var t=I(e);return t&&K.getID(t)}function i(e){var t=a(e);if(t)if(L.hasOwnProperty(t)){var n=L[t];n!==e&&(w(!c(n,t)),L[t]=e)}else L[t]=e;return t}function a(e){return e&&e.getAttribute&&e.getAttribute(k)||""}function s(e,t){var n=a(e);n!==t&&delete L[n],e.setAttribute(k,t),L[t]=e}function u(e){return L.hasOwnProperty(e)&&c(L[e],e)||(L[e]=K.findReactNodeByID(e)),L[e]}function l(e){var t=b.get(e)._rootNodeID;return C.isNullComponentID(t)?null:(L.hasOwnProperty(t)&&c(L[t],t)||(L[t]=K.findReactNodeByID(t)),L[t])}function c(e,t){if(e){w(a(e)===t);var n=K.findReactContainerForID(t);if(n&&P(n,e))return!0}return!1}function p(e){delete L[e]}function d(e){var t=L[e];return t&&c(t,e)?void(W=t):!1}function f(e){W=null,E.traverseAncestors(e,d);var t=W;return W=null,t}function h(e,t,n,r,o){var i=D.mountComponent(e,t,r,N);e._isTopLevel=!0,K._mountImageIntoNode(i,n,o)}function m(e,t,n,r){var o=T.ReactReconcileTransaction.getPooled();o.perform(h,null,e,t,n,o,r),T.ReactReconcileTransaction.release(o)}var v=e(11),g=e(33),y=(e(45),e(61)),C=(e(62),e(63)),E=e(70),b=e(71),_=e(74),x=e(80),D=e(87),M=e(96),T=e(97),N=e(127),P=e(120),I=e(141),R=e(146),w=e(147),O=e(159),S=e(162),A=(e(166),E.SEPARATOR),k=v.ID_ATTRIBUTE_NAME,L={},U=1,F=9,B={},j={},V=[],W=null,K={_instancesByReactRootID:B,scrollMonitor:function(e,t){t()},_updateRootComponent:function(e,t,n,r){return K.scrollMonitor(n,function(){M.enqueueElementInternal(e,t),r&&M.enqueueCallbackInternal(e,r)}),e},_registerComponent:function(e,t){w(t&&(t.nodeType===U||t.nodeType===F)),g.ensureScrollValueMonitoring();var n=K.registerContainer(t);return B[n]=e,n},_renderNewRootComponent:function(e,t,n){var r=R(e,null),o=K._registerComponent(r,t);return T.batchedUpdates(m,r,o,t,n),r},render:function(e,t,n){w(y.isValidElement(e));var r=B[o(t)];if(r){var i=r._currentElement;if(S(i,e))return K._updateRootComponent(r,e,t,n).getPublicInstance();K.unmountComponentAtNode(t)}var a=I(t),s=a&&K.isRenderedByReact(a),u=s&&!r,l=K._renderNewRootComponent(e,t,u).getPublicInstance();return n&&n.call(l),l},constructAndRenderComponent:function(e,t,n){var r=y.createElement(e,t);return K.render(r,n)},constructAndRenderComponentByID:function(e,t,n){var r=document.getElementById(n);return w(r),K.constructAndRenderComponent(e,t,r)},registerContainer:function(e){var t=o(e);return t&&(t=E.getReactRootIDFromNodeID(t)),t||(t=E.createReactRootID()),j[t]=e,t},unmountComponentAtNode:function(e){w(e&&(e.nodeType===U||e.nodeType===F));var t=o(e),n=B[t];return n?(K.unmountComponentFromNode(n,e),delete B[t],delete j[t],!0):!1},unmountComponentFromNode:function(e,t){for(D.unmountComponent(e),t.nodeType===F&&(t=t.documentElement);t.lastChild;)t.removeChild(t.lastChild)},findReactContainerForID:function(e){var t=E.getReactRootIDFromNodeID(e),n=j[t];return n},findReactNodeByID:function(e){var t=K.findReactContainerForID(e);return K.findComponentRoot(t,e)},isRenderedByReact:function(e){if(1!==e.nodeType)return!1;var t=K.getID(e);return t?t.charAt(0)===A:!1},getFirstReactDOM:function(e){for(var t=e;t&&t.parentNode!==t;){if(K.isRenderedByReact(t))return t;t=t.parentNode}return null},findComponentRoot:function(e,t){var n=V,r=0,o=f(t)||e;for(n[0]=o.firstChild,n.length=1;r<n.length;){for(var i,a=n[r++];a;){var s=K.getID(a);s?t===s?i=a:E.isAncestorIDOf(s,t)&&(n.length=r=0,n.push(a.firstChild)):n.push(a.firstChild),a=a.nextSibling}if(i)return n.length=0,i}n.length=0,w(!1)},_mountImageIntoNode:function(e,t,n){if(w(t&&(t.nodeType===U||t.nodeType===F)),n){var o=I(t);if(_.canReuseMarkup(e,o))return;var i=o.getAttribute(_.CHECKSUM_ATTR_NAME);o.removeAttribute(_.CHECKSUM_ATTR_NAME);var a=o.outerHTML;o.setAttribute(_.CHECKSUM_ATTR_NAME,i);var s=r(e,a);" (client) "+e.substring(s-20,s+20)+"\n (server) "+a.substring(s-20,s+20),w(t.nodeType!==F)}w(t.nodeType!==F),O(t,e)},getReactRootID:o,getID:i,setID:s,getNode:u,getNodeFromInstance:l,purgeID:p};x.measureMethods(K,"ReactMount",{_renderNewRootComponent:"_renderNewRootComponent",_mountImageIntoNode:"_mountImageIntoNode"}),t.exports=K},{11:11,120:120,127:127,141:141,146:146,147:147,159:159,162:162,166:166,33:33,45:45,61:61,62:62,63:63,70:70,71:71,74:74,80:80,87:87,96:96,97:97}],76:[function(e,t,n){function r(e,t,n){h.push({parentID:e,parentNode:null,type:c.INSERT_MARKUP,markupIndex:m.push(t)-1,textContent:null,fromIndex:null,toIndex:n})}function o(e,t,n){h.push({parentID:e,parentNode:null,type:c.MOVE_EXISTING,markupIndex:null,textContent:null,fromIndex:t,toIndex:n})}function i(e,t){h.push({parentID:e,parentNode:null,type:c.REMOVE_NODE,markupIndex:null,textContent:null,fromIndex:t,toIndex:null})}function a(e,t){h.push({parentID:e,parentNode:null,type:c.TEXT_CONTENT,markupIndex:null,textContent:t,fromIndex:null,toIndex:null})}function s(){h.length&&(l.processChildrenUpdates(h,m),u())}function u(){h.length=0,m.length=0}var l=e(41),c=e(77),p=e(87),d=e(36),f=0,h=[],m=[],v={Mixin:{mountChildren:function(e,t,n){var r=d.instantiateChildren(e,t,n);this._renderedChildren=r;var o=[],i=0;for(var a in r)if(r.hasOwnProperty(a)){var s=r[a],u=this._rootNodeID+a,l=p.mountComponent(s,u,t,n);s._mountIndex=i,o.push(l),i++}return o},updateTextContent:function(e){f++;var t=!0;try{var n=this._renderedChildren;d.unmountChildren(n);for(var r in n)n.hasOwnProperty(r)&&this._unmountChildByName(n[r],r);this.setTextContent(e),t=!1}finally{f--,f||(t?u():s())}},updateChildren:function(e,t,n){f++;var r=!0;try{this._updateChildren(e,t,n),r=!1}finally{f--,f||(r?u():s())}},_updateChildren:function(e,t,n){var r=this._renderedChildren,o=d.updateChildren(r,e,t,n);if(this._renderedChildren=o,o||r){var i,a=0,s=0;for(i in o)if(o.hasOwnProperty(i)){var u=r&&r[i],l=o[i];u===l?(this.moveChild(u,s,a),a=Math.max(u._mountIndex,a),u._mountIndex=s):(u&&(a=Math.max(u._mountIndex,a),this._unmountChildByName(u,i)),this._mountChildByNameAtIndex(l,i,s,t,n)),s++}for(i in r)!r.hasOwnProperty(i)||o&&o.hasOwnProperty(i)||this._unmountChildByName(r[i],i)}},unmountChildren:function(){var e=this._renderedChildren;d.unmountChildren(e),this._renderedChildren=null},moveChild:function(e,t,n){e._mountIndex<n&&o(this._rootNodeID,e._mountIndex,t)},createChild:function(e,t){r(this._rootNodeID,t,e._mountIndex)},removeChild:function(e){i(this._rootNodeID,e._mountIndex)},setTextContent:function(e){a(this._rootNodeID,e)},_mountChildByNameAtIndex:function(e,t,n,r,o){var i=this._rootNodeID+t,a=p.mountComponent(e,i,r,o);e._mountIndex=n,this.createChild(e,a)},_unmountChildByName:function(e,t){this.removeChild(e),e._mountIndex=null}}};t.exports=v},{36:36,41:41,77:77,87:87}],77:[function(e,t,n){var r=e(153),o=r({INSERT_MARKUP:null,MOVE_EXISTING:null,REMOVE_NODE:null,TEXT_CONTENT:null});t.exports=o},{153:153}],78:[function(e,t,n){function r(e){if("function"==typeof e.type)return e.type;var t=e.type,n=p[t];return null==n&&(p[t]=n=l(t)),n}function o(e){return u(c),new c(e.type,e.props)}function i(e){return new d(e)}function a(e){return e instanceof d}var s=e(29),u=e(147),l=null,c=null,p={},d=null,f={injectGenericComponentClass:function(e){c=e},injectTextComponentClass:function(e){d=e},injectComponentClasses:function(e){s(p,e)},injectAutoWrapper:function(e){l=e}},h={getComponentClassForElement:r,createInternalComponent:o,createInstanceForText:i,isTextComponent:a,injection:f};t.exports=h},{147:147,29:29}],79:[function(e,t,n){var r=e(147),o={isValidOwner:function(e){return!(!e||"function"!=typeof e.attachRef||"function"!=typeof e.detachRef)},addComponentAsRefTo:function(e,t,n){r(o.isValidOwner(n)),n.attachRef(t,e)},removeComponentAsRefFrom:function(e,t,n){r(o.isValidOwner(n)),n.getPublicInstance().refs[t]===e.getPublicInstance()&&n.detachRef(t)}};t.exports=o},{147:147}],80:[function(e,t,n){function r(e,t,n){return n}var o={enableMeasure:!1,storedMeasure:r,measureMethods:function(e,t,n){},measure:function(e,t,n){return n},injection:{injectMeasure:function(e){o.storedMeasure=e}}};t.exports=o},{}],81:[function(e,t,n){function r(e){return function(t,n,r){t[n]=t.hasOwnProperty(n)?e(t[n],r):r}}function o(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=l[n];r&&l.hasOwnProperty(n)?r(e,n,t[n]):e.hasOwnProperty(n)||(e[n]=t[n])}return e}var i=e(29),a=e(126),s=e(152),u=r(function(e,t){return i({},t,e)}),l={children:a,className:r(s),style:u},c={mergeProps:function(e,t){return o(i({},e),t)}};t.exports=c},{126:126,152:152,29:29}],82:[function(e,t,n){var r={};t.exports=r},{}],83:[function(e,t,n){var r=e(153),o=r({prop:null,context:null,childContext:null});t.exports=o},{153:153}],84:[function(e,t,n){function r(e){function t(t,n,r,o,i){if(o=o||b,null==n[r]){var a=C[i];return t?new Error("Required "+a+" `"+r+"` was not specified in "+("`"+o+"`.")):null}return e(n,r,o,i)}var n=t.bind(null,!1);return n.isRequired=t.bind(null,!0),n}function o(e){function t(t,n,r,o){var i=t[n],a=m(i);if(a!==e){var s=C[o],u=v(i);return new Error("Invalid "+s+" `"+n+"` of type `"+u+"` "+("supplied to `"+r+"`, expected `"+e+"`."))}return null}return r(t)}function i(){return r(E.thatReturns(null))}function a(e){function t(t,n,r,o){var i=t[n];if(!Array.isArray(i)){var a=C[o],s=m(i);return new Error("Invalid "+a+" `"+n+"` of type "+("`"+s+"` supplied to `"+r+"`, expected an array."))}for(var u=0;u<i.length;u++){var l=e(i,u,r,o);if(l instanceof Error)return l}return null}return r(t)}function s(){function e(e,t,n,r){if(!g.isValidElement(e[t])){var o=C[r];return new Error("Invalid "+o+" `"+t+"` supplied to "+("`"+n+"`, expected a ReactElement."))}return null}return r(e)}function u(e){function t(t,n,r,o){if(!(t[n]instanceof e)){var i=C[o],a=e.name||b;return new Error("Invalid "+i+" `"+n+"` supplied to "+("`"+r+"`, expected instance of `"+a+"`."))}return null}return r(t)}function l(e){function t(t,n,r,o){for(var i=t[n],a=0;a<e.length;a++)if(i===e[a])return null;var s=C[o],u=JSON.stringify(e);return new Error("Invalid "+s+" `"+n+"` of value `"+i+"` "+("supplied to `"+r+"`, expected one of "+u+"."))}return r(t)}function c(e){function t(t,n,r,o){var i=t[n],a=m(i);if("object"!==a){var s=C[o];return new Error("Invalid "+s+" `"+n+"` of type "+("`"+a+"` supplied to `"+r+"`, expected an object."))}for(var u in i)if(i.hasOwnProperty(u)){var l=e(i,u,r,o);if(l instanceof Error)return l}return null}return r(t)}function p(e){function t(t,n,r,o){for(var i=0;i<e.length;i++){var a=e[i];if(null==a(t,n,r,o))return null}var s=C[o];return new Error("Invalid "+s+" `"+n+"` supplied to "+("`"+r+"`."))}return r(t)}function d(){function e(e,t,n,r){if(!h(e[t])){var o=C[r];return new Error("Invalid "+o+" `"+t+"` supplied to "+("`"+n+"`, expected a ReactNode."))}return null}return r(e)}function f(e){function t(t,n,r,o){var i=t[n],a=m(i);if("object"!==a){var s=C[o];return new Error("Invalid "+s+" `"+n+"` of type `"+a+"` "+("supplied to `"+r+"`, expected `object`."))}for(var u in e){var l=e[u];if(l){var c=l(i,u,r,o);if(c)return c}}return null}return r(t)}function h(e){switch(typeof e){case"number":case"string":case"undefined":return!0;case"boolean":return!e;case"object":if(Array.isArray(e))return e.every(h);if(null===e||g.isValidElement(e))return!0;e=y.extractIfFragment(e);for(var t in e)if(!h(e[t]))return!1;return!0;default:return!1}}function m(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":t}function v(e){var t=m(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}var g=e(61),y=e(67),C=e(82),E=e(126),b="<<anonymous>>",_=s(),x=d(),D={array:o("array"),bool:o("boolean"),func:o("function"),number:o("number"),object:o("object"),string:o("string"),any:i(),arrayOf:a,element:_,instanceOf:u,node:x,objectOf:c,oneOf:l,oneOfType:p,shape:f};t.exports=D},{126:126,61:61,67:67,82:82}],85:[function(e,t,n){function r(){this.listenersToPut=[]}var o=e(30),i=e(33),a=e(29);a(r.prototype,{enqueuePutListener:function(e,t,n){this.listenersToPut.push({rootNodeID:e,propKey:t,propValue:n})},putListeners:function(){for(var e=0;e<this.listenersToPut.length;e++){var t=this.listenersToPut[e];i.putListener(t.rootNodeID,t.propKey,t.propValue)}},reset:function(){this.listenersToPut.length=0},destructor:function(){this.reset()}}),o.addPoolingTo(r),t.exports=r},{29:29,30:30,33:33}],86:[function(e,t,n){function r(){this.reinitializeTransaction(),this.renderToStaticMarkup=!1,this.reactMountReady=o.getPooled(null),this.putListenerQueue=u.getPooled()}var o=e(7),i=e(30),a=e(33),s=e(69),u=e(85),l=e(113),c=e(29),p={initialize:s.getSelectionInformation,close:s.restoreSelection},d={initialize:function(){var e=a.isEnabled();return a.setEnabled(!1),e},close:function(e){a.setEnabled(e)}},f={initialize:function(){this.reactMountReady.reset()},close:function(){this.reactMountReady.notifyAll()}},h={initialize:function(){this.putListenerQueue.reset()},close:function(){this.putListenerQueue.putListeners()}},m=[h,p,d,f],v={getTransactionWrappers:function(){return m},getReactMountReady:function(){return this.reactMountReady},getPutListenerQueue:function(){return this.putListenerQueue},destructor:function(){o.release(this.reactMountReady),this.reactMountReady=null,u.release(this.putListenerQueue),this.putListenerQueue=null}};c(r.prototype,l.Mixin,v),i.addPoolingTo(r),t.exports=r},{113:113,29:29,30:30,33:33,69:69,7:7,85:85}],87:[function(e,t,n){function r(){o.attachRefs(this,this._currentElement)}var o=e(88),i=(e(62),{mountComponent:function(e,t,n,o){var i=e.mountComponent(t,n,o);return n.getReactMountReady().enqueue(r,e),i},unmountComponent:function(e){o.detachRefs(e,e._currentElement),e.unmountComponent()},receiveComponent:function(e,t,n,i){var a=e._currentElement;if(t!==a||null==t._owner){var s=o.shouldUpdateRefs(a,t);s&&o.detachRefs(e,a),e.receiveComponent(t,n,i),s&&n.getReactMountReady().enqueue(r,e)}},performUpdateIfNecessary:function(e,t){e.performUpdateIfNecessary(t)}});t.exports=i},{62:62,88:88}],88:[function(e,t,n){function r(e,t,n){"function"==typeof e?e(t.getPublicInstance()):i.addComponentAsRefTo(t,e,n)}function o(e,t,n){"function"==typeof e?e(null):i.removeComponentAsRefFrom(t,e,n)}var i=e(79),a={};a.attachRefs=function(e,t){var n=t.ref;null!=n&&r(n,e,t._owner)},a.shouldUpdateRefs=function(e,t){return t._owner!==e._owner||t.ref!==e.ref},a.detachRefs=function(e,t){var n=t.ref;null!=n&&o(n,e,t._owner)},t.exports=a},{79:79}],89:[function(e,t,n){var r={injectCreateReactRootIndex:function(e){o.createReactRootIndex=e}},o={createReactRootIndex:null,injection:r};t.exports=o},{}],90:[function(e,t,n){function r(e){p(i.isValidElement(e));var t;try{var n=a.createReactRootID();return t=u.getPooled(!1),t.perform(function(){var r=c(e,null),o=r.mountComponent(n,t,l);return s.addChecksumToMarkup(o)},null)}finally{u.release(t)}}function o(e){p(i.isValidElement(e));var t;try{var n=a.createReactRootID();return t=u.getPooled(!0),t.perform(function(){var r=c(e,null);return r.mountComponent(n,t,l)},null)}finally{u.release(t)}}var i=e(61),a=e(70),s=e(74),u=e(91),l=e(127),c=e(146),p=e(147);t.exports={renderToString:r,renderToStaticMarkup:o}},{127:127,146:146,147:147,61:61,70:70,74:74,91:91}],91:[function(e,t,n){function r(e){this.reinitializeTransaction(),this.renderToStaticMarkup=e,this.reactMountReady=i.getPooled(null),this.putListenerQueue=a.getPooled()}var o=e(30),i=e(7),a=e(85),s=e(113),u=e(29),l=e(126),c={initialize:function(){this.reactMountReady.reset()},close:l},p={initialize:function(){this.putListenerQueue.reset()},close:l},d=[p,c],f={getTransactionWrappers:function(){return d},getReactMountReady:function(){return this.reactMountReady},getPutListenerQueue:function(){return this.putListenerQueue},destructor:function(){i.release(this.reactMountReady),this.reactMountReady=null,a.release(this.putListenerQueue),this.putListenerQueue=null}};u(r.prototype,s.Mixin,f),o.addPoolingTo(r),t.exports=r},{113:113,126:126,29:29,30:30,7:7,85:85}],92:[function(e,t,n){function r(e,t){var n={};return function(r){n[t]=r,e.setState(n)}}var o={createStateSetter:function(e,t){return function(n,r,o,i,a,s){var u=t.call(e,n,r,o,i,a,s);u&&e.setState(u)}},createStateKeySetter:function(e,t){var n=e.__keySetters||(e.__keySetters={});return n[t]||(n[t]=r(e,t))}};o.Mixin={createStateSetter:function(e){return o.createStateSetter(this,e)},createStateKeySetter:function(e){return o.createStateKeySetter(this,e)}},t.exports=o},{}],93:[function(e,t,n){var r=e(37),o=e(67),i={getChildMapping:function(e){return e?o.extract(r.map(e,function(e){return e})):e},mergeChildMappings:function(e,t){function n(n){return t.hasOwnProperty(n)?t[n]:e[n]}e=e||{},t=t||{};var r={},o=[];for(var i in e)t.hasOwnProperty(i)?o.length&&(r[i]=o,o=[]):o.push(i);var a,s={};for(var u in t){if(r.hasOwnProperty(u))for(a=0;a<r[u].length;a++){var l=r[u][a];s[r[u][a]]=n(l)}s[u]=n(u)}for(a=0;a<o.length;a++)s[o[a]]=n(o[a]);return s}};t.exports=i},{37:37,67:67}],94:[function(e,t,n){function r(){var e=document.createElement("div"),t=e.style;"AnimationEvent"in window||delete s.animationend.animation,"TransitionEvent"in window||delete s.transitionend.transition;for(var n in s){var r=s[n];for(var o in r)if(o in t){u.push(r[o]);break}}}function o(e,t,n){e.addEventListener(t,n,!1)}function i(e,t,n){e.removeEventListener(t,n,!1)}var a=e(22),s={transitionend:{transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"mozTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd"},animationend:{animation:"animationend",WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd"}},u=[];a.canUseDOM&&r();var l={addEndEventListener:function(e,t){return 0===u.length?void window.setTimeout(t,0):void u.forEach(function(n){o(e,n,t)})},removeEndEventListener:function(e,t){0!==u.length&&u.forEach(function(n){i(e,n,t)})}};t.exports=l},{22:22}],95:[function(e,t,n){var r=e(31),o=e(93),i=e(29),a=e(119),s=e(126),u=r.createClass({displayName:"ReactTransitionGroup",propTypes:{component:r.PropTypes.any,childFactory:r.PropTypes.func},getDefaultProps:function(){return{component:"span",childFactory:s.thatReturnsArgument}},getInitialState:function(){return{children:o.getChildMapping(this.props.children)}},componentWillMount:function(){this.currentlyTransitioningKeys={},this.keysToEnter=[],this.keysToLeave=[]},componentDidMount:function(){var e=this.state.children;for(var t in e)e[t]&&this.performAppear(t)},componentWillReceiveProps:function(e){var t=o.getChildMapping(e.children),n=this.state.children;this.setState({children:o.mergeChildMappings(n,t)});var r;for(r in t){var i=n&&n.hasOwnProperty(r);!t[r]||i||this.currentlyTransitioningKeys[r]||this.keysToEnter.push(r)}for(r in n){var a=t&&t.hasOwnProperty(r);!n[r]||a||this.currentlyTransitioningKeys[r]||this.keysToLeave.push(r)}},componentDidUpdate:function(){var e=this.keysToEnter;this.keysToEnter=[],e.forEach(this.performEnter);var t=this.keysToLeave;this.keysToLeave=[],t.forEach(this.performLeave)},performAppear:function(e){this.currentlyTransitioningKeys[e]=!0;var t=this.refs[e];t.componentWillAppear?t.componentWillAppear(this._handleDoneAppearing.bind(this,e)):this._handleDoneAppearing(e)},_handleDoneAppearing:function(e){var t=this.refs[e];t.componentDidAppear&&t.componentDidAppear(),delete this.currentlyTransitioningKeys[e];var n=o.getChildMapping(this.props.children);n&&n.hasOwnProperty(e)||this.performLeave(e)},performEnter:function(e){this.currentlyTransitioningKeys[e]=!0;var t=this.refs[e];t.componentWillEnter?t.componentWillEnter(this._handleDoneEntering.bind(this,e)):this._handleDoneEntering(e)},_handleDoneEntering:function(e){var t=this.refs[e];t.componentDidEnter&&t.componentDidEnter(),delete this.currentlyTransitioningKeys[e];var n=o.getChildMapping(this.props.children);n&&n.hasOwnProperty(e)||this.performLeave(e)},performLeave:function(e){this.currentlyTransitioningKeys[e]=!0;var t=this.refs[e];t.componentWillLeave?t.componentWillLeave(this._handleDoneLeaving.bind(this,e)):this._handleDoneLeaving(e)},_handleDoneLeaving:function(e){var t=this.refs[e];t.componentDidLeave&&t.componentDidLeave(),delete this.currentlyTransitioningKeys[e];var n=o.getChildMapping(this.props.children);if(n&&n.hasOwnProperty(e))this.performEnter(e);else{var r=i({},this.state.children);delete r[e],this.setState({children:r})}},render:function(){var e=[];for(var t in this.state.children){var n=this.state.children[t];n&&e.push(a(this.props.childFactory(n),{ref:t,key:t}))}return r.createElement(this.props.component,this.props,e)}});t.exports=u},{119:119,126:126,29:29,31:31,93:93}],96:[function(e,t,n){function r(e){e!==i.currentlyMountingInstance&&l.enqueueUpdate(e)}function o(e,t){p(null==a.current);var n=u.get(e);return n?n===i.currentlyUnmountingInstance?null:n:null}var i=e(72),a=e(45),s=e(61),u=e(71),l=e(97),c=e(29),p=e(147),d=(e(166),{enqueueCallback:function(e,t){p("function"==typeof t);var n=o(e);return n&&n!==i.currentlyMountingInstance?(n._pendingCallbacks?n._pendingCallbacks.push(t):n._pendingCallbacks=[t],void r(n)):null},enqueueCallbackInternal:function(e,t){p("function"==typeof t),e._pendingCallbacks?e._pendingCallbacks.push(t):e._pendingCallbacks=[t],r(e)},enqueueForceUpdate:function(e){var t=o(e,"forceUpdate");t&&(t._pendingForceUpdate=!0,r(t))},enqueueReplaceState:function(e,t){var n=o(e,"replaceState");n&&(n._pendingStateQueue=[t],n._pendingReplaceState=!0,r(n))},enqueueSetState:function(e,t){var n=o(e,"setState");if(n){var i=n._pendingStateQueue||(n._pendingStateQueue=[]);i.push(t),r(n)}},enqueueSetProps:function(e,t){var n=o(e,"setProps");if(n){p(n._isTopLevel);var i=n._pendingElement||n._currentElement,a=c({},i.props,t);n._pendingElement=s.cloneAndReplaceProps(i,a),r(n)}},enqueueReplaceProps:function(e,t){var n=o(e,"replaceProps");if(n){p(n._isTopLevel);var i=n._pendingElement||n._currentElement;n._pendingElement=s.cloneAndReplaceProps(i,t),r(n)}},enqueueElementInternal:function(e,t){e._pendingElement=t,r(e)}});t.exports=d},{147:147,166:166,29:29,45:45,61:61,71:71,72:72,97:97}],97:[function(e,t,n){function r(){v(T.ReactReconcileTransaction&&E)}function o(){this.reinitializeTransaction(),this.dirtyComponentsLength=null,this.callbackQueue=c.getPooled(),this.reconcileTransaction=T.ReactReconcileTransaction.getPooled()}function i(e,t,n,o,i){r(),E.batchedUpdates(e,t,n,o,i)}function a(e,t){return e._mountOrder-t._mountOrder}function s(e){var t=e.dirtyComponentsLength;v(t===g.length),g.sort(a);for(var n=0;t>n;n++){var r=g[n],o=r._pendingCallbacks;if(r._pendingCallbacks=null,f.performUpdateIfNecessary(r,e.reconcileTransaction),o)for(var i=0;i<o.length;i++)e.callbackQueue.enqueue(o[i],r.getPublicInstance())}}function u(e){return r(),E.isBatchingUpdates?void g.push(e):void E.batchedUpdates(u,e)}function l(e,t){v(E.isBatchingUpdates),y.enqueue(e,t),C=!0}var c=e(7),p=e(30),d=(e(45),e(80)),f=e(87),h=e(113),m=e(29),v=e(147),g=(e(166),[]),y=c.getPooled(),C=!1,E=null,b={initialize:function(){this.dirtyComponentsLength=g.length},close:function(){this.dirtyComponentsLength!==g.length?(g.splice(0,this.dirtyComponentsLength),D()):g.length=0}},_={initialize:function(){this.callbackQueue.reset()},close:function(){this.callbackQueue.notifyAll()}},x=[b,_];m(o.prototype,h.Mixin,{getTransactionWrappers:function(){return x},destructor:function(){this.dirtyComponentsLength=null,c.release(this.callbackQueue),this.callbackQueue=null,T.ReactReconcileTransaction.release(this.reconcileTransaction),this.reconcileTransaction=null},perform:function(e,t,n){return h.Mixin.perform.call(this,this.reconcileTransaction.perform,this.reconcileTransaction,e,t,n)
}}),p.addPoolingTo(o);var D=function(){for(;g.length||C;){if(g.length){var e=o.getPooled();e.perform(s,null,e),o.release(e)}if(C){C=!1;var t=y;y=c.getPooled(),t.notifyAll(),c.release(t)}}};D=d.measure("ReactUpdates","flushBatchedUpdates",D);var M={injectReconcileTransaction:function(e){v(e),T.ReactReconcileTransaction=e},injectBatchingStrategy:function(e){v(e),v("function"==typeof e.batchedUpdates),v("boolean"==typeof e.isBatchingUpdates),E=e}},T={ReactReconcileTransaction:null,batchedUpdates:i,enqueueUpdate:u,flushBatchedUpdates:D,injection:M,asap:l};t.exports=T},{113:113,147:147,166:166,29:29,30:30,45:45,7:7,80:80,87:87}],98:[function(e,t,n){var r=e(11),o=r.injection.MUST_USE_ATTRIBUTE,i={Properties:{clipPath:o,cx:o,cy:o,d:o,dx:o,dy:o,fill:o,fillOpacity:o,fontFamily:o,fontSize:o,fx:o,fy:o,gradientTransform:o,gradientUnits:o,markerEnd:o,markerMid:o,markerStart:o,offset:o,opacity:o,patternContentUnits:o,patternUnits:o,points:o,preserveAspectRatio:o,r:o,rx:o,ry:o,spreadMethod:o,stopColor:o,stopOpacity:o,stroke:o,strokeDasharray:o,strokeLinecap:o,strokeOpacity:o,strokeWidth:o,textAnchor:o,transform:o,version:o,viewBox:o,x1:o,x2:o,x:o,y1:o,y2:o,y:o},DOMAttributeNames:{clipPath:"clip-path",fillOpacity:"fill-opacity",fontFamily:"font-family",fontSize:"font-size",gradientTransform:"gradientTransform",gradientUnits:"gradientUnits",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",patternContentUnits:"patternContentUnits",patternUnits:"patternUnits",preserveAspectRatio:"preserveAspectRatio",spreadMethod:"spreadMethod",stopColor:"stop-color",stopOpacity:"stop-opacity",strokeDasharray:"stroke-dasharray",strokeLinecap:"stroke-linecap",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",textAnchor:"text-anchor",viewBox:"viewBox"}};t.exports=i},{11:11}],99:[function(e,t,n){function r(e){if("selectionStart"in e&&s.hasSelectionCapabilities(e))return{start:e.selectionStart,end:e.selectionEnd};if(window.getSelection){var t=window.getSelection();return{anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}}if(document.selection){var n=document.selection.createRange();return{parentElement:n.parentElement(),text:n.text,top:n.boundingTop,left:n.boundingLeft}}}function o(e){if(y||null==m||m!==l())return null;var t=r(m);if(!g||!d(g,t)){g=t;var n=u.getPooled(h.select,v,e);return n.type="select",n.target=m,a.accumulateTwoPhaseDispatches(n),n}}var i=e(16),a=e(21),s=e(69),u=e(105),l=e(133),c=e(150),p=e(154),d=e(161),f=i.topLevelTypes,h={select:{phasedRegistrationNames:{bubbled:p({onSelect:null}),captured:p({onSelectCapture:null})},dependencies:[f.topBlur,f.topContextMenu,f.topFocus,f.topKeyDown,f.topMouseDown,f.topMouseUp,f.topSelectionChange]}},m=null,v=null,g=null,y=!1,C={eventTypes:h,extractEvents:function(e,t,n,r){switch(e){case f.topFocus:(c(t)||"true"===t.contentEditable)&&(m=t,v=n,g=null);break;case f.topBlur:m=null,v=null,g=null;break;case f.topMouseDown:y=!0;break;case f.topContextMenu:case f.topMouseUp:return y=!1,o(r);case f.topSelectionChange:case f.topKeyDown:case f.topKeyUp:return o(r)}}};t.exports=C},{105:105,133:133,150:150,154:154,16:16,161:161,21:21,69:69}],100:[function(e,t,n){var r=Math.pow(2,53),o={createReactRootIndex:function(){return Math.ceil(Math.random()*r)}};t.exports=o},{}],101:[function(e,t,n){var r=e(16),o=e(20),i=e(21),a=e(102),s=e(105),u=e(106),l=e(108),c=e(109),p=e(104),d=e(110),f=e(111),h=e(112),m=e(134),v=e(147),g=e(154),y=(e(166),r.topLevelTypes),C={blur:{phasedRegistrationNames:{bubbled:g({onBlur:!0}),captured:g({onBlurCapture:!0})}},click:{phasedRegistrationNames:{bubbled:g({onClick:!0}),captured:g({onClickCapture:!0})}},contextMenu:{phasedRegistrationNames:{bubbled:g({onContextMenu:!0}),captured:g({onContextMenuCapture:!0})}},copy:{phasedRegistrationNames:{bubbled:g({onCopy:!0}),captured:g({onCopyCapture:!0})}},cut:{phasedRegistrationNames:{bubbled:g({onCut:!0}),captured:g({onCutCapture:!0})}},doubleClick:{phasedRegistrationNames:{bubbled:g({onDoubleClick:!0}),captured:g({onDoubleClickCapture:!0})}},drag:{phasedRegistrationNames:{bubbled:g({onDrag:!0}),captured:g({onDragCapture:!0})}},dragEnd:{phasedRegistrationNames:{bubbled:g({onDragEnd:!0}),captured:g({onDragEndCapture:!0})}},dragEnter:{phasedRegistrationNames:{bubbled:g({onDragEnter:!0}),captured:g({onDragEnterCapture:!0})}},dragExit:{phasedRegistrationNames:{bubbled:g({onDragExit:!0}),captured:g({onDragExitCapture:!0})}},dragLeave:{phasedRegistrationNames:{bubbled:g({onDragLeave:!0}),captured:g({onDragLeaveCapture:!0})}},dragOver:{phasedRegistrationNames:{bubbled:g({onDragOver:!0}),captured:g({onDragOverCapture:!0})}},dragStart:{phasedRegistrationNames:{bubbled:g({onDragStart:!0}),captured:g({onDragStartCapture:!0})}},drop:{phasedRegistrationNames:{bubbled:g({onDrop:!0}),captured:g({onDropCapture:!0})}},focus:{phasedRegistrationNames:{bubbled:g({onFocus:!0}),captured:g({onFocusCapture:!0})}},input:{phasedRegistrationNames:{bubbled:g({onInput:!0}),captured:g({onInputCapture:!0})}},keyDown:{phasedRegistrationNames:{bubbled:g({onKeyDown:!0}),captured:g({onKeyDownCapture:!0})}},keyPress:{phasedRegistrationNames:{bubbled:g({onKeyPress:!0}),captured:g({onKeyPressCapture:!0})}},keyUp:{phasedRegistrationNames:{bubbled:g({onKeyUp:!0}),captured:g({onKeyUpCapture:!0})}},load:{phasedRegistrationNames:{bubbled:g({onLoad:!0}),captured:g({onLoadCapture:!0})}},error:{phasedRegistrationNames:{bubbled:g({onError:!0}),captured:g({onErrorCapture:!0})}},mouseDown:{phasedRegistrationNames:{bubbled:g({onMouseDown:!0}),captured:g({onMouseDownCapture:!0})}},mouseMove:{phasedRegistrationNames:{bubbled:g({onMouseMove:!0}),captured:g({onMouseMoveCapture:!0})}},mouseOut:{phasedRegistrationNames:{bubbled:g({onMouseOut:!0}),captured:g({onMouseOutCapture:!0})}},mouseOver:{phasedRegistrationNames:{bubbled:g({onMouseOver:!0}),captured:g({onMouseOverCapture:!0})}},mouseUp:{phasedRegistrationNames:{bubbled:g({onMouseUp:!0}),captured:g({onMouseUpCapture:!0})}},paste:{phasedRegistrationNames:{bubbled:g({onPaste:!0}),captured:g({onPasteCapture:!0})}},reset:{phasedRegistrationNames:{bubbled:g({onReset:!0}),captured:g({onResetCapture:!0})}},scroll:{phasedRegistrationNames:{bubbled:g({onScroll:!0}),captured:g({onScrollCapture:!0})}},submit:{phasedRegistrationNames:{bubbled:g({onSubmit:!0}),captured:g({onSubmitCapture:!0})}},touchCancel:{phasedRegistrationNames:{bubbled:g({onTouchCancel:!0}),captured:g({onTouchCancelCapture:!0})}},touchEnd:{phasedRegistrationNames:{bubbled:g({onTouchEnd:!0}),captured:g({onTouchEndCapture:!0})}},touchMove:{phasedRegistrationNames:{bubbled:g({onTouchMove:!0}),captured:g({onTouchMoveCapture:!0})}},touchStart:{phasedRegistrationNames:{bubbled:g({onTouchStart:!0}),captured:g({onTouchStartCapture:!0})}},wheel:{phasedRegistrationNames:{bubbled:g({onWheel:!0}),captured:g({onWheelCapture:!0})}}},E={topBlur:C.blur,topClick:C.click,topContextMenu:C.contextMenu,topCopy:C.copy,topCut:C.cut,topDoubleClick:C.doubleClick,topDrag:C.drag,topDragEnd:C.dragEnd,topDragEnter:C.dragEnter,topDragExit:C.dragExit,topDragLeave:C.dragLeave,topDragOver:C.dragOver,topDragStart:C.dragStart,topDrop:C.drop,topError:C.error,topFocus:C.focus,topInput:C.input,topKeyDown:C.keyDown,topKeyPress:C.keyPress,topKeyUp:C.keyUp,topLoad:C.load,topMouseDown:C.mouseDown,topMouseMove:C.mouseMove,topMouseOut:C.mouseOut,topMouseOver:C.mouseOver,topMouseUp:C.mouseUp,topPaste:C.paste,topReset:C.reset,topScroll:C.scroll,topSubmit:C.submit,topTouchCancel:C.touchCancel,topTouchEnd:C.touchEnd,topTouchMove:C.touchMove,topTouchStart:C.touchStart,topWheel:C.wheel};for(var b in E)E[b].dependencies=[b];var _={eventTypes:C,executeDispatch:function(e,t,n){var r=o.executeDispatch(e,t,n);r===!1&&(e.stopPropagation(),e.preventDefault())},extractEvents:function(e,t,n,r){var o=E[e];if(!o)return null;var g;switch(e){case y.topInput:case y.topLoad:case y.topError:case y.topReset:case y.topSubmit:g=s;break;case y.topKeyPress:if(0===m(r))return null;case y.topKeyDown:case y.topKeyUp:g=l;break;case y.topBlur:case y.topFocus:g=u;break;case y.topClick:if(2===r.button)return null;case y.topContextMenu:case y.topDoubleClick:case y.topMouseDown:case y.topMouseMove:case y.topMouseOut:case y.topMouseOver:case y.topMouseUp:g=c;break;case y.topDrag:case y.topDragEnd:case y.topDragEnter:case y.topDragExit:case y.topDragLeave:case y.topDragOver:case y.topDragStart:case y.topDrop:g=p;break;case y.topTouchCancel:case y.topTouchEnd:case y.topTouchMove:case y.topTouchStart:g=d;break;case y.topScroll:g=f;break;case y.topWheel:g=h;break;case y.topCopy:case y.topCut:case y.topPaste:g=a}v(g);var C=g.getPooled(o,n,r);return i.accumulateTwoPhaseDispatches(C),C}};t.exports=_},{102:102,104:104,105:105,106:106,108:108,109:109,110:110,111:111,112:112,134:134,147:147,154:154,16:16,166:166,20:20,21:21}],102:[function(e,t,n){function r(e,t,n){o.call(this,e,t,n)}var o=e(105),i={clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}};o.augmentClass(r,i),t.exports=r},{105:105}],103:[function(e,t,n){function r(e,t,n){o.call(this,e,t,n)}var o=e(105),i={data:null};o.augmentClass(r,i),t.exports=r},{105:105}],104:[function(e,t,n){function r(e,t,n){o.call(this,e,t,n)}var o=e(109),i={dataTransfer:null};o.augmentClass(r,i),t.exports=r},{109:109}],105:[function(e,t,n){function r(e,t,n){this.dispatchConfig=e,this.dispatchMarker=t,this.nativeEvent=n;var r=this.constructor.Interface;for(var o in r)if(r.hasOwnProperty(o)){var i=r[o];this[o]=i?i(n):n[o]}var s=null!=n.defaultPrevented?n.defaultPrevented:n.returnValue===!1;this.isDefaultPrevented=s?a.thatReturnsTrue:a.thatReturnsFalse,this.isPropagationStopped=a.thatReturnsFalse}var o=e(30),i=e(29),a=e(126),s=e(137),u={type:null,target:s,currentTarget:a.thatReturnsNull,eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null};i(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e.preventDefault?e.preventDefault():e.returnValue=!1,this.isDefaultPrevented=a.thatReturnsTrue},stopPropagation:function(){var e=this.nativeEvent;e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this.isPropagationStopped=a.thatReturnsTrue},persist:function(){this.isPersistent=a.thatReturnsTrue},isPersistent:a.thatReturnsFalse,destructor:function(){var e=this.constructor.Interface;for(var t in e)this[t]=null;this.dispatchConfig=null,this.dispatchMarker=null,this.nativeEvent=null}}),r.Interface=u,r.augmentClass=function(e,t){var n=this,r=Object.create(n.prototype);i(r,e.prototype),e.prototype=r,e.prototype.constructor=e,e.Interface=i({},n.Interface,t),e.augmentClass=n.augmentClass,o.addPoolingTo(e,o.threeArgumentPooler)},o.addPoolingTo(r,o.threeArgumentPooler),t.exports=r},{126:126,137:137,29:29,30:30}],106:[function(e,t,n){function r(e,t,n){o.call(this,e,t,n)}var o=e(111),i={relatedTarget:null};o.augmentClass(r,i),t.exports=r},{111:111}],107:[function(e,t,n){function r(e,t,n){o.call(this,e,t,n)}var o=e(105),i={data:null};o.augmentClass(r,i),t.exports=r},{105:105}],108:[function(e,t,n){function r(e,t,n){o.call(this,e,t,n)}var o=e(111),i=e(134),a=e(135),s=e(136),u={key:a,location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:s,charCode:function(e){return"keypress"===e.type?i(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?i(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}};o.augmentClass(r,u),t.exports=r},{111:111,134:134,135:135,136:136}],109:[function(e,t,n){function r(e,t,n){o.call(this,e,t,n)}var o=e(111),i=e(114),a=e(136),s={screenX:null,screenY:null,clientX:null,clientY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:a,button:function(e){var t=e.button;return"which"in e?t:2===t?2:4===t?1:0},buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},pageX:function(e){return"pageX"in e?e.pageX:e.clientX+i.currentScrollLeft},pageY:function(e){return"pageY"in e?e.pageY:e.clientY+i.currentScrollTop}};o.augmentClass(r,s),t.exports=r},{111:111,114:114,136:136}],110:[function(e,t,n){function r(e,t,n){o.call(this,e,t,n)}var o=e(111),i=e(136),a={touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:i};o.augmentClass(r,a),t.exports=r},{111:111,136:136}],111:[function(e,t,n){function r(e,t,n){o.call(this,e,t,n)}var o=e(105),i=e(137),a={view:function(e){if(e.view)return e.view;var t=i(e);if(null!=t&&t.window===t)return t;var n=t.ownerDocument;return n?n.defaultView||n.parentWindow:window},detail:function(e){return e.detail||0}};o.augmentClass(r,a),t.exports=r},{105:105,137:137}],112:[function(e,t,n){function r(e,t,n){o.call(this,e,t,n)}var o=e(109),i={deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null};o.augmentClass(r,i),t.exports=r},{109:109}],113:[function(e,t,n){var r=e(147),o={reinitializeTransaction:function(){this.transactionWrappers=this.getTransactionWrappers(),this.wrapperInitData?this.wrapperInitData.length=0:this.wrapperInitData=[],this._isInTransaction=!1},_isInTransaction:!1,getTransactionWrappers:null,isInTransaction:function(){return!!this._isInTransaction},perform:function(e,t,n,o,i,a,s,u){r(!this.isInTransaction());var l,c;try{this._isInTransaction=!0,l=!0,this.initializeAll(0),c=e.call(t,n,o,i,a,s,u),l=!1}finally{try{if(l)try{this.closeAll(0)}catch(p){}else this.closeAll(0)}finally{this._isInTransaction=!1}}return c},initializeAll:function(e){for(var t=this.transactionWrappers,n=e;n<t.length;n++){var r=t[n];try{this.wrapperInitData[n]=i.OBSERVED_ERROR,this.wrapperInitData[n]=r.initialize?r.initialize.call(this):null}finally{if(this.wrapperInitData[n]===i.OBSERVED_ERROR)try{this.initializeAll(n+1)}catch(o){}}}},closeAll:function(e){r(this.isInTransaction());for(var t=this.transactionWrappers,n=e;n<t.length;n++){var o,a=t[n],s=this.wrapperInitData[n];try{o=!0,s!==i.OBSERVED_ERROR&&a.close&&a.close.call(this,s),o=!1}finally{if(o)try{this.closeAll(n+1)}catch(u){}}}this.wrapperInitData.length=0}},i={Mixin:o,OBSERVED_ERROR:{}};t.exports=i},{147:147}],114:[function(e,t,n){var r={currentScrollLeft:0,currentScrollTop:0,refreshScrollValues:function(e){r.currentScrollLeft=e.x,r.currentScrollTop=e.y}};t.exports=r},{}],115:[function(e,t,n){function r(e,t){if(o(null!=t),null==e)return t;var n=Array.isArray(e),r=Array.isArray(t);return n&&r?(e.push.apply(e,t),e):n?(e.push(t),e):r?[e].concat(t):[e,t]}var o=e(147);t.exports=r},{147:147}],116:[function(e,t,n){function r(e){for(var t=1,n=0,r=0;r<e.length;r++)t=(t+e.charCodeAt(r))%o,n=(n+t)%o;return t|n<<16}var o=65521;t.exports=r},{}],117:[function(e,t,n){function r(e){return e.replace(o,function(e,t){return t.toUpperCase()})}var o=/-(.)/g;t.exports=r},{}],118:[function(e,t,n){function r(e){return o(e.replace(i,"ms-"))}var o=e(117),i=/^-ms-/;t.exports=r},{117:117}],119:[function(e,t,n){function r(e,t){var n=i.mergeProps(t,e.props);return!n.hasOwnProperty(s)&&e.props.hasOwnProperty(s)&&(n.children=e.props.children),o.createElement(e.type,n)}var o=e(61),i=e(81),a=e(154),s=(e(166),a({children:null}));t.exports=r},{154:154,166:166,61:61,81:81}],120:[function(e,t,n){function r(e,t){return e&&t?e===t?!0:o(e)?!1:o(t)?r(e,t.parentNode):e.contains?e.contains(t):e.compareDocumentPosition?!!(16&e.compareDocumentPosition(t)):!1:!1}var o=e(151);t.exports=r},{151:151}],121:[function(e,t,n){function r(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"length"in e&&!("setInterval"in e)&&"number"!=typeof e.nodeType&&(Array.isArray(e)||"callee"in e||"item"in e)}function o(e){return r(e)?Array.isArray(e)?e.slice():i(e):[e]}var i=e(163);t.exports=o},{163:163}],122:[function(e,t,n){function r(e){var t=i.createFactory(e),n=o.createClass({tagName:e.toUpperCase(),displayName:"ReactFullPageComponent"+e,componentWillUnmount:function(){a(!1)},render:function(){return t(this.props)}});return n}var o=e(38),i=e(61),a=e(147);t.exports=r},{147:147,38:38,61:61}],123:[function(e,t,n){function r(e){var t=e.match(c);return t&&t[1].toLowerCase()}function o(e,t){var n=l;u(!!l);var o=r(e),i=o&&s(o);if(i){n.innerHTML=i[1]+e+i[2];for(var c=i[0];c--;)n=n.lastChild}else n.innerHTML=e;var p=n.getElementsByTagName("script");p.length&&(u(t),a(p).forEach(t));for(var d=a(n.childNodes);n.lastChild;)n.removeChild(n.lastChild);return d}var i=e(22),a=e(121),s=e(139),u=e(147),l=i.canUseDOM?document.createElement("div"):null,c=/^\s*<(\w+)/;t.exports=o},{121:121,139:139,147:147,22:22}],124:[function(e,t,n){function r(e){return"object"==typeof e?Object.keys(e).filter(function(t){return e[t]}).join(" "):Array.prototype.join.call(arguments," ")}e(166),t.exports=r},{166:166}],125:[function(e,t,n){function r(e,t){var n=null==t||"boolean"==typeof t||""===t;if(n)return"";var r=isNaN(t);return r||0===t||i.hasOwnProperty(e)&&i[e]?""+t:("string"==typeof t&&(t=t.trim()),t+"px")}var o=e(5),i=o.isUnitlessNumber;t.exports=r},{5:5}],126:[function(e,t,n){function r(e){return function(){return e}}function o(){}o.thatReturns=r,o.thatReturnsFalse=r(!1),o.thatReturnsTrue=r(!0),o.thatReturnsNull=r(null),o.thatReturnsThis=function(){return this},o.thatReturnsArgument=function(e){return e},t.exports=o},{}],127:[function(e,t,n){var r={};t.exports=r},{}],128:[function(e,t,n){function r(e){return i[e]}function o(e){return(""+e).replace(a,r)}var i={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},a=/[&><"']/g;t.exports=o},{}],129:[function(e,t,n){function r(e){return null==e?null:s(e)?e:o.has(e)?i.getNodeFromInstance(e):(a(null==e.render||"function"!=typeof e.render),void a(!1))}var o=(e(45),e(71)),i=e(75),a=e(147),s=e(149);e(166),t.exports=r},{147:147,149:149,166:166,45:45,71:71,75:75}],130:[function(e,t,n){function r(e,t,n){var r=e,o=!r.hasOwnProperty(n);o&&null!=t&&(r[n]=t)}function o(e){if(null==e)return e;var t={};return i(e,r,t),t}var i=e(164);e(166),t.exports=o},{164:164,166:166}],131:[function(e,t,n){function r(e){try{e.focus()}catch(t){}}t.exports=r},{}],132:[function(e,t,n){var r=function(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)};t.exports=r},{}],133:[function(e,t,n){function r(){try{return document.activeElement||document.body}catch(e){return document.body}}t.exports=r},{}],134:[function(e,t,n){function r(e){var t,n=e.keyCode;return"charCode"in e?(t=e.charCode,0===t&&13===n&&(t=13)):t=n,t>=32||13===t?t:0}t.exports=r},{}],135:[function(e,t,n){function r(e){if(e.key){var t=i[e.key]||e.key;if("Unidentified"!==t)return t}if("keypress"===e.type){var n=o(e);return 13===n?"Enter":String.fromCharCode(n)}return"keydown"===e.type||"keyup"===e.type?a[e.keyCode]||"Unidentified":""}var o=e(134),i={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},a={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};t.exports=r},{134:134}],136:[function(e,t,n){function r(e){var t=this,n=t.nativeEvent;if(n.getModifierState)return n.getModifierState(e);var r=i[e];return r?!!n[r]:!1}function o(e){return r}var i={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};t.exports=o},{}],137:[function(e,t,n){function r(e){var t=e.target||e.srcElement||window;return 3===t.nodeType?t.parentNode:t}t.exports=r},{}],138:[function(e,t,n){function r(e){var t=e&&(o&&e[o]||e[i]);return"function"==typeof t?t:void 0}var o="function"==typeof Symbol&&Symbol.iterator,i="@@iterator";t.exports=r},{}],139:[function(e,t,n){function r(e){return i(!!a),d.hasOwnProperty(e)||(e="*"),s.hasOwnProperty(e)||(a.innerHTML="*"===e?"<link />":"<"+e+"></"+e+">",s[e]=!a.firstChild),s[e]?d[e]:null}var o=e(22),i=e(147),a=o.canUseDOM?document.createElement("div"):null,s={circle:!0,clipPath:!0,defs:!0,ellipse:!0,g:!0,line:!0,linearGradient:!0,path:!0,polygon:!0,polyline:!0,radialGradient:!0,rect:!0,stop:!0,text:!0},u=[1,'<select multiple="true">',"</select>"],l=[1,"<table>","</table>"],c=[3,"<table><tbody><tr>","</tr></tbody></table>"],p=[1,"<svg>","</svg>"],d={"*":[1,"?<div>","</div>"],area:[1,"<map>","</map>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],legend:[1,"<fieldset>","</fieldset>"],param:[1,"<object>","</object>"],tr:[2,"<table><tbody>","</tbody></table>"],optgroup:u,option:u,caption:l,colgroup:l,tbody:l,tfoot:l,thead:l,td:c,th:c,circle:p,clipPath:p,defs:p,ellipse:p,g:p,line:p,linearGradient:p,path:p,polygon:p,polyline:p,radialGradient:p,rect:p,stop:p,text:p};t.exports=r},{147:147,22:22}],140:[function(e,t,n){function r(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function o(e){for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}function i(e,t){for(var n=r(e),i=0,a=0;n;){if(3===n.nodeType){if(a=i+n.textContent.length,t>=i&&a>=t)return{node:n,offset:t-i};i=a}n=r(o(n))}}t.exports=i},{}],141:[function(e,t,n){function r(e){return e?e.nodeType===o?e.documentElement:e.firstChild:null}var o=9;t.exports=r},{}],142:[function(e,t,n){function r(){return!i&&o.canUseDOM&&(i="textContent"in document.documentElement?"textContent":"innerText"),i}var o=e(22),i=null;t.exports=r},{22:22}],143:[function(e,t,n){function r(e){return e===window?{x:window.pageXOffset||document.documentElement.scrollLeft,y:window.pageYOffset||document.documentElement.scrollTop}:{x:e.scrollLeft,y:e.scrollTop}}t.exports=r},{}],144:[function(e,t,n){function r(e){return e.replace(o,"-$1").toLowerCase()}var o=/([A-Z])/g;t.exports=r},{}],145:[function(e,t,n){function r(e){return o(e).replace(i,"-ms-")}var o=e(144),i=/^ms-/;t.exports=r},{144:144}],146:[function(e,t,n){function r(e){return"function"==typeof e&&"undefined"!=typeof e.prototype&&"function"==typeof e.prototype.mountComponent&&"function"==typeof e.prototype.receiveComponent}function o(e,t){var n;if((null===e||e===!1)&&(e=a.emptyElement),"object"==typeof e){var o=e;n=t===o.type&&"string"==typeof o.type?s.createInternalComponent(o):r(o.type)?new o.type(o):new c}else"string"==typeof e||"number"==typeof e?n=s.createInstanceForText(e):l(!1);return n.construct(e),n._mountIndex=0,n._mountImage=null,n}var i=e(43),a=e(63),s=e(78),u=e(29),l=e(147),c=(e(166),function(){});u(c.prototype,i.Mixin,{_instantiateReactComponent:o}),t.exports=o},{147:147,166:166,29:29,43:43,63:63,78:78}],147:[function(e,t,n){var r=function(e,t,n,r,o,i,a,s){if(!e){var u;if(void 0===t)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[n,r,o,i,a,s],c=0;u=new Error("Invariant Violation: "+t.replace(/%s/g,function(){return l[c++]}))}throw u.framesToPop=1,u}};t.exports=r},{}],148:[function(e,t,n){function r(e,t){if(!i.canUseDOM||t&&!("addEventListener"in document))return!1;var n="on"+e,r=n in document;if(!r){var a=document.createElement("div");a.setAttribute(n,"return;"),r="function"==typeof a[n]}return!r&&o&&"wheel"===e&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r}var o,i=e(22);i.canUseDOM&&(o=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0),t.exports=r},{22:22}],149:[function(e,t,n){function r(e){return!(!e||!("function"==typeof Node?e instanceof Node:"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName))}t.exports=r},{}],150:[function(e,t,n){function r(e){return e&&("INPUT"===e.nodeName&&o[e.type]||"TEXTAREA"===e.nodeName)}var o={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};t.exports=r},{}],151:[function(e,t,n){function r(e){return o(e)&&3==e.nodeType}var o=e(149);t.exports=r},{149:149}],152:[function(e,t,n){function r(e){e||(e="");var t,n=arguments.length;if(n>1)for(var r=1;n>r;r++)t=arguments[r],t&&(e=(e?e+" ":"")+t);return e}t.exports=r},{}],153:[function(e,t,n){var r=e(147),o=function(e){var t,n={};r(e instanceof Object&&!Array.isArray(e));for(t in e)e.hasOwnProperty(t)&&(n[t]=t);return n};t.exports=o},{147:147}],154:[function(e,t,n){var r=function(e){var t;for(t in e)if(e.hasOwnProperty(t))return t;return null};t.exports=r},{}],155:[function(e,t,n){function r(e,t,n){if(!e)return null;var r={};for(var i in e)o.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}var o=Object.prototype.hasOwnProperty;t.exports=r},{}],156:[function(e,t,n){function r(e){var t={};return function(n){return t.hasOwnProperty(n)||(t[n]=e.call(this,n)),t[n]}}t.exports=r},{}],157:[function(e,t,n){function r(e){return i(o.isValidElement(e)),e}var o=e(61),i=e(147);t.exports=r},{147:147,61:61}],158:[function(e,t,n){function r(e){return'"'+o(e)+'"'}var o=e(128);t.exports=r},{128:128}],159:[function(e,t,n){var r=e(22),o=/^[ \r\n\t\f]/,i=/<(!--|link|noscript|meta|script|style)[ \r\n\t\f\/>]/,a=function(e,t){e.innerHTML=t};if("undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction&&(a=function(e,t){MSApp.execUnsafeLocalFunction(function(){e.innerHTML=t})}),r.canUseDOM){var s=document.createElement("div");s.innerHTML=" ",""===s.innerHTML&&(a=function(e,t){if(e.parentNode&&e.parentNode.replaceChild(e,e),o.test(t)||"<"===t[0]&&i.test(t)){e.innerHTML="﻿"+t;var n=e.firstChild;1===n.data.length?e.removeChild(n):n.deleteData(0,1)}else e.innerHTML=t})}t.exports=a},{22:22}],160:[function(e,t,n){var r=e(22),o=e(128),i=e(159),a=function(e,t){e.textContent=t};r.canUseDOM&&("textContent"in document.documentElement||(a=function(e,t){i(e,o(t))})),t.exports=a},{128:128,159:159,22:22}],161:[function(e,t,n){function r(e,t){if(e===t)return!0;var n;for(n in e)if(e.hasOwnProperty(n)&&(!t.hasOwnProperty(n)||e[n]!==t[n]))return!1;for(n in t)if(t.hasOwnProperty(n)&&!e.hasOwnProperty(n))return!1;return!0}t.exports=r},{}],162:[function(e,t,n){function r(e,t){if(null!=e&&null!=t){var n=typeof e,r=typeof t;if("string"===n||"number"===n)return"string"===r||"number"===r;if("object"===r&&e.type===t.type&&e.key===t.key){var o=e._owner===t._owner;return o}}return!1}e(166),t.exports=r},{166:166}],163:[function(e,t,n){function r(e){var t=e.length;if(o(!Array.isArray(e)&&("object"==typeof e||"function"==typeof e)),o("number"==typeof t),o(0===t||t-1 in e),e.hasOwnProperty)try{return Array.prototype.slice.call(e)}catch(n){}for(var r=Array(t),i=0;t>i;i++)r[i]=e[i];return r}var o=e(147);t.exports=r},{147:147}],164:[function(e,t,n){function r(e){return v[e]}function o(e,t){return e&&null!=e.key?a(e.key):t.toString(36)}function i(e){return(""+e).replace(g,r)}function a(e){return"$"+i(e)}function s(e,t,n,r,i){var u=typeof e;if(("undefined"===u||"boolean"===u)&&(e=null),null===e||"string"===u||"number"===u||l.isValidElement(e))return r(i,e,""===t?h+o(e,0):t,n),1;var p,v,g,y=0;if(Array.isArray(e))for(var C=0;C<e.length;C++)p=e[C],v=(""!==t?t+m:h)+o(p,C),g=n+y,y+=s(p,v,g,r,i);else{var E=d(e);if(E){var b,_=E.call(e);if(E!==e.entries)for(var x=0;!(b=_.next()).done;)p=b.value,v=(""!==t?t+m:h)+o(p,x++),g=n+y,y+=s(p,v,g,r,i);else for(;!(b=_.next()).done;){var D=b.value;D&&(p=D[1],v=(""!==t?t+m:h)+a(D[0])+m+o(p,0),g=n+y,y+=s(p,v,g,r,i))}}else if("object"===u){f(1!==e.nodeType);var M=c.extract(e);for(var T in M)M.hasOwnProperty(T)&&(p=M[T],v=(""!==t?t+m:h)+a(T)+m+o(p,0),g=n+y,y+=s(p,v,g,r,i))}}return y}function u(e,t,n){return null==e?0:s(e,"",0,t,n)}var l=e(61),c=e(67),p=e(70),d=e(138),f=e(147),h=(e(166),p.SEPARATOR),m=":",v={"=":"=0",".":"=1",":":"=2"},g=/[=.:]/g;t.exports=u},{138:138,147:147,166:166,61:61,67:67,70:70}],165:[function(e,t,n){function r(e){return Array.isArray(e)?e.concat():e&&"object"==typeof e?a(new e.constructor,e):e}function o(e,t,n){u(Array.isArray(e));var r=t[n];u(Array.isArray(r))}function i(e,t){if(u("object"==typeof t),l.call(t,f))return u(1===Object.keys(t).length),t[f];var n=r(e);if(l.call(t,h)){var s=t[h];u(s&&"object"==typeof s),u(n&&"object"==typeof n),a(n,t[h])}l.call(t,c)&&(o(e,t,c),t[c].forEach(function(e){n.push(e)})),l.call(t,p)&&(o(e,t,p),t[p].forEach(function(e){n.unshift(e)})),l.call(t,d)&&(u(Array.isArray(e)),u(Array.isArray(t[d])),t[d].forEach(function(e){u(Array.isArray(e)),n.splice.apply(n,e)})),l.call(t,m)&&(u("function"==typeof t[m]),n=t[m](n));for(var v in t)g.hasOwnProperty(v)&&g[v]||(n[v]=i(e[v],t[v]));return n}var a=e(29),s=e(154),u=e(147),l={}.hasOwnProperty,c=s({$push:null}),p=s({$unshift:null}),d=s({$splice:null}),f=s({$set:null}),h=s({$merge:null}),m=s({$apply:null}),v=[c,p,d,f,h,m],g={};v.forEach(function(e){g[e]=!0}),t.exports=i},{147:147,154:154,29:29}],166:[function(e,t,n){var r=e(126),o=r;t.exports=o},{126:126}]},{},[1])(1)}),define("InfiniteList",["globals","util","platform","Observable","ObservableArray","Sel","DragDrop","React","Dispatcher"],function(g,util,platform,Observable,ObservableArray,Sel,DragDrop,React,Dispatcher){function InfiniteList(pane,isOutline){this._pane=pane,this._isOutline=isOutline,this.contentHeight=new Observable(0),this._direction=Direction.None,this._scrollTop=0,this._lastProcessedScrollTop=0,this._topOffset=0,this._indexOfTop=0,this.renderTiles=new ObservableArray,this._reactList=void 0,this._isMounted=!1,this.tileSize=6,this._mountedItems=[],this.init()}var _disableHeightChanged=!1;return InfiniteList.prototype={init:function initFn(){util.forceBind("_onListChanged",this),util.forceBind("_onResize",this),util.forceBind("_onScroll",this),util.forceBind("itemsInTile",this)},notifyWillMount:function notifyWillMountFn(){this._onListChanged()},notifyMounted:function notifyMountedFn(reactInfiniteList){this._isMounted=!0,this._reactList=reactInfiniteList,this._getItemsList().listen(this._onListChanged),this._pane.getSize().listen(this._onResize),Dispatcher.listen("itemTextChanged",util.forceBind("handleItemTextChanged",this)),setTimeout(function(){try{g.PAssert(3118,this._isMounted,"Should always still be mounted when adding scroll listener")}catch(PERR){g.reportError(PERR)}this._isMounted&&this._addScrollListener(this._onScroll),this._pane.useCustomScroller&&this._refreshScrollListener()}.bind(this),0)},notifyUnmounted:function notifyUnmountedFn(){util.destroy(this),this._isMounted=!1,this._getItemsList().unlisten(this._onListChanged),this._pane.getSize().unlisten(this._onResize),Dispatcher.unlisten("itemTextChanged",this.handleItemTextChanged),this._reactList=void 0,platform.mobile||(this._pane=void 0)},notifyItemMounted:function notifyItemMountedFn(index,item){this._mountedItems[index]=item},notifyItemUnmounted:function notifyItemUnmountedFn(index,item){this._mountedItems[index]===item&&(this._mountedItems[index]=void 0)},handleItemTextChanged:function handleItemTextChangedFn(e){var outline=this._isOutline,pane=this._pane,item=e.item,lines=item.metricsInPane(pane,outline).styledLines,field=outline?PerPaneStateField.NumLinesOutline:PerPaneStateField.NumLines,numLines=pane.getPerPaneState(item.id,field);numLines!==lines.length&&(pane.setPerPaneState(item.id,field,lines.length),this._onItemHeightChanged())},getElementAtIndex:function getElementAtIndexFn(index){try{g.PAssert(3119,void 0!==this._mountedItems[index],"Must have a valid mounted item at index")}catch(PERR){g.reportError(PERR)}var element;return this._mountedItems[index]&&(element=this._mountedItems[index].element),element},hasItems:function hasItemsFn(){return this._getItemsList().get().length>0},_getHeight:function _getHeightFn(){return this._pane.getHeight()},indexOfTop:function indexOfTopFn(){return this._indexOfTop},indexPageUp:function indexPageUpFn(index){for(var pageHeight=this._getHeight(),diff=0,i=index-1;i>=0;--i){var height=this._heights[i];
if(diff+=height,diff>pageHeight)return i+1}return 0},indexPageDown:function indexPageDownFn(index){for(var pageHeight=this._getHeight(),diff=0,num=this._heights.length,i=index;num>i;++i){var height=this._heights[i];if(diff+=height,diff>pageHeight)return i}return Math.max(num-1,0)},_getItemsList:function _getItemsListFn(){var items;return items=this._isOutline?this._pane.headers:this._pane.items},heightAtIndex:function heightAtIndexFn(index){var height;if(this._isOutline){var item=this._getItemsList().get()[index];height=item.heightInPane(this._pane,!0)}else height=this._pane.heightAtIndex(index);return height},_addScrollListener:function _addScrollListenerFn(cb){this._isOutline?this._pane.getOutline().addScrollListener(cb):this._pane.addScrollListener(cb)},_refreshScrollListener:function _refreshScrollListenerFn(){this._isOutline?this._pane.getOutline().refreshScrollListener():this._pane.refreshScrollListener()},_getScrollTop:function _getScrollTopFn(){var scrollTop;return scrollTop=this._isOutline?this._pane.getOutline().getScrollOffset():this._pane.getScrollOffset()},_computeContentHeight:function _computeContentHeightFn(notify){var contentHeight=0;this._heights=[],this._tops=[];for(var i=0;i<this._getItemsList().get().length;++i){var height=this.heightAtIndex(i);this._heights[i]=height,this._tops[i]=(this._tops[i-1]||0)+(this._heights[i-1]||0),contentHeight+=height}return platform.mobile&&(contentHeight+=2*g.minItemHeight),this.contentHeight.set(contentHeight,notify),this._pane.useCustomScroller&&this._refreshScrollListener(),contentHeight},_onScroll:function _onScrollFn(){var oldScroll=this._scrollTop;if(this._scrollTop=this._getScrollTop(),this._scrollTop!==oldScroll){this._direction=this._scrollTop>oldScroll?Direction.Down:Direction.Up;var scrollDiff=Math.abs(this._scrollTop-this._lastProcessedScrollTop);scrollDiff>=g.minItemHeight&&(this._lastProcessedScrollTop=this._scrollTop,this._computeRenderItems())}},_onListChanged:function _onListChangedFn(){_disableHeightChanged=!0,this.renderTiles.set([],!1),this._computeContentHeight(!1),this._isMounted&&(this._scrollTop=this._getScrollTop()),this._computeRenderItems(),_disableHeightChanged=!1},_onItemHeightChanged:function _onItemHeightChangedFn(){_disableHeightChanged||this._onListChanged()},_onResize:function _onResizeFn(){this._onListChanged()},_isInBounds:function _isInBoundsFn(top,bottom){var isInBounds=!1;return(top>this._getPVRTop()&&top<this._getPVRBottom()||bottom>this._getPVRTop()&&bottom<this._getPVRBottom())&&(isInBounds=!0),isInBounds},setTopOffset:function setTopOffsetFn(val){this._topOffset=val},_getPVRTop:function _getPVRTopFn(){return this._scrollTop-32-this._topOffset},_getPVRBottom:function _getPVRBottomFn(){return this._scrollTop+this._getHeight()+32-this._topOffset},itemsInTile:function itemsInTileFn(tile){for(var items=[],i=0;i<this.tileSize;i++){var index=tile*this.tileSize+i;if(!(index<this._heights.length))break;items.push({index:index,height:this._heights[index],offsetTop:this._tops[index]})}return items},_computeRenderItems:function _computeRenderItemsFn(){for(var inView=[],items=this._getItemsList().get(),y=0,yPlusHeight,inBounds,newTopIndex,i=0;i<items.length;++i){if(yPlusHeight=y+this._heights[i],inBounds=this._isInBounds(y,yPlusHeight))isNaN(newTopIndex)&&(newTopIndex=i),inView.push({index:i,height:this._heights[i],offsetTop:y});else if(y>this._getPVRBottom())break;y=yPlusHeight}isNaN(newTopIndex)||(this._indexOfTop=newTopIndex);var index;Sel.isValid()&&(!platform.mobile||platform.ios&&g.isKeyboardOpen)&&this._pane===Sel.getPane()&&(index=Sel.getStartIndex(),index<this._heights.length&&inView.indexOfWithProperty("index",index)<0&&inView.push({index:index,height:this._heights[index],offsetTop:this._pane.topOfIndex(index)})),platform.mobile&&DragDrop.isDragging&&(index=this._pane.indexOfItem(DragDrop.dragItem),index>=0&&inView.indexOfWithProperty("index",index)<0&&inView.push({index:index,height:this._heights[index],offsetTop:this._pane.topOfIndex(index)}));for(var tilesInView=[],shouldSet=!1,currentTiles=this.renderTiles.get(),i=0;i<inView.length;i++){var tileIndex=Math.floor(inView[i].index/this.tileSize);tilesInView.indexOf(tileIndex)<0&&(tilesInView.push(tileIndex),currentTiles.indexOf(tileIndex)<0&&(shouldSet=!0))}(shouldSet||0===currentTiles.length)&&this.renderTiles.set(tilesInView)}},util.defineBase(InfiniteList),InfiniteList}),define("VMOutline",["globals","util","data","gdata","platform","tracker","React","Observable","InfiniteList","Sel","Dispatcher"],function(g,util,d,gdata,platform,tracker,React,Observable,InfiniteList,Sel,Dispatcher){function VMOutline(pane){this.pane=pane,this.root=pane.getRootItem(),this.scrollElement=void 0,this.contentElement=void 0,this.isVisible=new Observable(!1);var defaultTransform=platform.mobile?0:-1;this.transform=new Observable(defaultTransform),this.hasOpened=!1,this.cursor=new Observable,this.hasSetHeightOnce=!1,this._infiniteList=new InfiniteList(pane,!0),this.useCustomScroller=this.pane.useCustomScroller,this.init()}return VMOutline.prototype={init:function initFn(){platform.mobile&&(util.forceBind("refreshScrollListener",this),Dispatcher.listen("documentsLoaded",this.refreshScrollListener))},destroy:function destroyFn(){this.pane=void 0,this.scrollElement=void 0,this.useCustomScroller&&(this.iScroller.destroy(),this.iScroller=void 0),platform.mobile&&Dispatcher.unlisten("documentsLoaded",this.refreshScrollListener),util.destroy(this)},getInfiniteList:function getInfiniteListFn(){return this._infiniteList},getContentElement:function getContentElementFn(){return this.contentElement},onTapSection:function onTapSectionFn(e){g.vmMain.vmPicker.onTapSection(e)},setupCustomScroller:function setupCustomScrollerFn(){this.iScroller=g.createCustomScroller(this.scrollElement)},getScrollOffset:function getScrollOffsetFn(){var sOffset=0;return sOffset=this.useCustomScroller?this.iScroller?-this.iScroller.y:0:this.scrollElement.scrollTop},addScrollListener:function addScrollListenerFn(cb){this.useCustomScroller?this.iScroller.on("scroll",cb):this.scrollElement.addEventListener("scroll",cb)},removeScrollListener:function removeScrollListenerFn(cb){this.useCustomScroller?this.iScroller.off("scroll",cb):this.scrollElement.removeEventListener("scroll",cb)},refreshScrollListener:function refreshScrollListenerFn(){if(this.useCustomScroller&&this.iScroller){var height=this._infiniteList.contentHeight.get();if(platform.mobile){var list=g.vmMain.docManager.docListObs.get(),documentsHeight=42*(list.length+1),outlineTop=documentsHeight+10;if(height+=documentsHeight,this._infiniteList.setTopOffset(outlineTop),!this.hasSetHeightOnce){this.hasSetHeightOnce=!0;var top=outlineTop,scrollTop=-(top-75);this.iScroller.scrollTo(0,scrollTop,ScrollDuration.Snap)}}this.iScroller.manualRefresh(height)}},onTap:{onStart:function onStartFn(e){g.ScreenManager&&g.ScreenManager.checkSwipeStart(e),e.preventDefault()},onMove:function onMoveFn(e){g.ScreenManager&&g.ScreenManager.checkSwipeMove(e)},onClick:function onClickFn(e){var pane=this.pane;if(!platform.mobile||g.ScreenManager&&!g.ScreenManager.checkSwipeClick(e)){var item,data=g.dataFor(e.target),li=g.getElementParent(e.target);if(li&&data!==pane&&data!==this){item=g.getItemForElement(e.target);try{g.PAssert(3120,item,"Element in outline was text but was not an item")}catch(PERR){g.reportError(PERR)}}if(item){try{g.PAssert(3121,li,"Item must have an outline element: "+(item.getRawText?item.getRawText():"not an item"))}catch(PERR){g.reportError(PERR)}var doZoom=!1;if(li){var offsetX=e.clientX-g.offset(li).left;offsetX<item.getPaddingOutline()-(platform.mobile?0:g.SPThresholdLeft)?(item.setCollapsed(!item.isCollapsed(pane,!0),pane,!0),this.pane.updateHeaders()):doZoom=!0}doZoom&&(g.vmMain.zoomin(item),platform.mobile?g.ScreenManager.closeOutline():g.focusedPane.toggleOutlineVisibility(),g.sendEvent("Menu","OutlineZoom"))}e.preventDefault()}},onEnd:function onEndFn(e){g.ScreenManager&&g.ScreenManager.checkSwipeEnd(e)}},setVisibility:function setVisibilityFn(isVisible){isVisible&&(this.hasOpened=!0,Sel.reset()),this.isVisible.set(isVisible),platform.mobile&&(isVisible&&g.isKeyboardOpen&&!g.getActiveSearch().isFocused.get()&&g.blurActiveElement(),tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleOutline,data:{value:isVisible}}),this.pane.onOutlineToggled(isVisible))},toggleDesktop:function toggleDesktopFn(){var time=150;this.isVisible.get()?(this.transform.set(-1),setTimeout(function(){this.setVisibility(!1)}.bind(this),time)):(this.setVisibility(!0),setTimeout(function(){this.transform.set(0)}.bind(this),0)),tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleOutline,data:{value:this.isVisible.get()}})}},VMOutline}),define("Search",["globals","util","platform","android","data","VMLI","tracker","Observable","ObservableArray","Dispatcher"],function(g,util,platform,android,d,VMLI,tracker,Observable,ObservableArray,Dispatcher){function Search(pane,searchStr,callback){this.callback=callback,this.value=new Observable(searchStr||"",callback),this.results=new ObservableArray,this.pane=pane,this.searchArr=[],this.matches={},this.matchesOutline={},this.previousSearch="",this.itemStoreFilter=void 0,this.UI=void 0,this.isFocused=new Observable,this._destroyed=!1,Dispatcher.listen("itemTextChanged",util.forceBind("handleItemTextChanged",this)),this._updateSearchArr()}var MatchState={Unknown:void 0,No:0,Yes:1,Negated:2,ChildYes:3};return Search.prototype={destroy:function destroyFn(){this._destroyed=!0,Dispatcher.unlisten("itemTextChanged",this.handleItemTextChanged),this.value.unlisten(this.callback),this.pane=void 0,this.UI=void 0,util.destroy(this)},getValue:function getValueFn(){return this.value.get()},focus:function focusFn(){this.UI.focus()},setValue:function setValueFn(value){this.value.set(value,!1),this._updateSearchArr(),this.update(!0,!0)},addToValue:function addToValueFn(add){var text=this.value.get();"-"!==text[text.length-1]&&(text+=" "),text+=add,this.setValue(text)},isSearched:function isSearchedFn(){return this.value.get().length>0},reset:function resetFn(){this.setValue("")},isMatched:function isMatchedFn(item,outline){var matches=outline?this.matchesOutline:this.matches,m=matches[item.id];return void 0===m||m===MatchState.Yes||m===MatchState.ChildYes||m===MatchState.Unknown},handleItemTextChanged:function handleItemTextChangedFn(e){if(g.vmMain.paneManager.isPaneActive(this.pane.id)&&!platform.mobile&&(e.force||g.focusedPane.id!==this.pane.id)){var item=e.item,oldValue=this.isMatched(item);this.checkItem(item);var newValue=this.isMatched(item);newValue!=oldValue&&(this.update(),this.pane.refreshSearchResults())}},_updateSearchArr:function _updateSearchArrFn(){var textArray=this.value.get().toLowerCase().trim().split(/\s+/);textArray=textArray.filter(function(str){return!(!str||"-"===str)}),this.searchArr=[];for(var i=0;i<textArray.length;++i){var isNegated=textArray[i].startsWith("-"),itemText=isNegated?textArray[i].substr(1):textArray[i];this.searchArr.push({text:itemText,isNegated:isNegated})}},update:function updateFn(notify,scroll){this.matches={},this.matchesOutline={},this.checkChildren(),notify&&this.value.notify(),scroll&&this.pane.setScrollOffset(0)},_checkMatch:function _checkMatchFn(item,lower,s){var found=!0;if(s.indexOf("!")>=0&&(found=item.priority()>=VMLIFlag.P2,s.indexOf("!!")>=0&&(found=item.priority()>=VMLIFlag.P1,s.indexOf("!!!")>=0&&(found=item.priority()>=VMLIFlag.P0)),s=s.replace(/!/g,"")),s.indexOf("*")>=0&&found&&(found=item.isStarred()&&!item.isComplete(),s=s.replace(/\*/g,"")),s.indexOf("//")>=0&&found&&(found=item.isComplete(),s=s.replace(/\//g,"")),s.length>0&&found&&(found=lower.indexOf(s)>=0,!found)){var attachments=item.getAttachments();if(attachments)for(var i=0;i<attachments.length&&!found;i++)found=attachments[i].match(s)}return found},checkItem:function checkItemFn(item,outline){var root=d.getRootModel(),matches=outline?this.matchesOutline:this.matches;if(0===this.searchArr.length)return matches[item.id]=MatchState.Yes,MatchState.Yes;if(matches[item.parent().id]===MatchState.Negated)return matches[item.id]=MatchState.Negated,MatchState.Negated;var matchState=MatchState.Unknown,parent,i,s,found,termEntry,lower=item.getSearchText();for(i=0;i<this.searchArr.length;i++){termEntry=this.searchArr[i];var negate=termEntry.isNegated;if(negate){s=termEntry.text;try{g.PAssert(3122,s,"Each value in the search array should be valid at this point")}catch(PERR){g.reportError(PERR)}if(found=this._checkMatch(item,lower,s)){matchState=MatchState.Negated;break}}}if(matchState===MatchState.Unknown){if(matches[item.parent().id]===MatchState.Yes)return matches[item.id]=MatchState.Yes,MatchState.Yes;for(i=0;i<this.searchArr.length;i++){termEntry=this.searchArr[i],s=termEntry.text;try{g.PAssert(3123,s,"Each value in the search array should be valid at this point")}catch(PERR){g.reportError(PERR)}if(!termEntry.isNegated&&(found=this._checkMatch(item,lower,s),!found))for(parent=item;parent;){if(parent=parent.parent(),!parent||parent===root){matchState=MatchState.No;break}if(this._checkMatch(parent,parent.getSearchText(),s))break}if(matchState===MatchState.No)break}}if(matchState===MatchState.Unknown&&(matchState=MatchState.Yes),matchState===MatchState.Yes)for(parent=item.parent();parent&&matches[parent.id]!==MatchState.Negated;)matches[parent.id]=MatchState.ChildYes,parent=parent.parent();return matches[item.id]=matchState,matchState},checkChildren:function checkChildrenFn(){var params={includeArchived:this.pane.showArchived.get(),comparator:function comparatorFn(item){var val=this.checkItem(item);return val!==MatchState.Negated}.bind(this)};this.itemStoreFilter&&(params.itemStoreFilter=this.itemStoreFilter),params.itemStore=this.pane.getItemStore(),g.searchVMLIs(params);for(var item=this.pane.getItem();item;)this.matches[item.id]=MatchState.Yes,item=item.parent()},onTapAutocomplete:{onStart:function onStartFn(e){e.preventDefault()}},onTapSearchInsert:{onStart:function onStartFn(e){e.preventDefault()},onClick:function onClickFn(e){var className=e.srcElement.className;switch(0!==className.indexOf("search")&&(className=e.srcElement.parentNode.className),className){case"searchNegate":this.addToValue("-");break;case"searchP2":this.addToValue("!");break;case"searchP1":this.addToValue("!!");break;case"searchP0":this.addToValue("!!!");break;case"searchStarred":this.addToValue("*");break;case"searchComplete":this.addToValue("//")}g.sendEvent("Menu",className)}}},Search}),define("VMPane",["globals","util","android","data","gdata","edit","VMLI","tracker","VMOutline","platform","React","EventDispatcher","Dispatcher","Observable","ObservableArray","Trigger","Search","NativeSel","Sel","DragDrop","InfiniteList"],function(g,util,android,d,gdata,edit,VMLI,tracker,VMOutline,platform,React,EventDispatcher,Dispatcher,Observable,ObservableArray,Trigger,Search,NativeSel,Sel,DragDrop,InfiniteList){function VMPane(p){this.type=PaneMode.Normal,this.paneClass="paneNormal",this.paneEmptyMessage="Write some things here to get started.",this.paneEmptySearchMessage="Write some things here to get started.",this.dropEffect=DropEffect.Move,this.isWriteable=!0,this.overrideCopyBehavior=!0,this.supportCollapsing=!0,this.supportCompleting=!0,this.supportOffline=!0,this.supportViewArchived=!1,this.supportPerformArchive=!0,this.supportDataRefresh=!1,this.supportPagination=!1,this.supportSearchAutocomplete=!0;try{g.PAssert(3124,void 0!==p.id,"Must supply a valid pane id")}catch(PERR){g.reportError(PERR)}this.id=p.id,p.item||(p.item=this.getRootItem(),p.offset=0,p.search=""),this.item=new Observable(p.item),this.items=new ObservableArray,this.headers=new ObservableArray,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.reloading=!1,this.showArchived=new Observable(!1),this.numCompleteItems=new Observable(0),this.useCustomScroller=platform.android||platform.ios,this.iScroller=void 0,this._panePadding=0,this._isScrollingTo=void 0,this.cursor=new Observable,this.paneTopText=new Observable,this.blurTrigger=new Trigger,this.focusTrigger=new Trigger,this.isInitialized=!1,this.isLoaded=!1,this.isLoading=new Observable(!1),this.isFocused=!1,this.caretPosition=new Observable,this.isReady=new Observable(this.plugin?this.plugin.isReady():!0),this.paddingBottom=new Observable(0),this._infiniteList=new InfiniteList(this,!1),this._perPaneState={},this._destroyed=!1,this.initialOffset=p.offset,platform.mobile?(this.defaultOffset=g.topBoxHeight-16,util.forceBind("onTouchHoldTimeout",this)):this.defaultOffset=0,util.forceBind("textInput",this),util.forceBind("compositionEnd",this),util.forceBind("onShowArchivedChanged",this),this.showArchived.listen(this.onShowArchivedChanged),this.search=new Search(this,p.search,this.onSearchChanged.bind(this)),this.outline=new VMOutline(this)}return VMPane.prototype={init:function initFn(){this.getItem()&&this.setItem(this.getItem(),!1),this.plugin&&this.plugin.notifyPaneCreated(this)},destroy:function destroyFn(){this._destroyed=!0,this.plugin&&this.plugin.notifyPaneDestroyed(this),this.showArchived.unlisten(this.onShowArchivedChanged),this.search.destroy(),this.search=void 0,this.outline.destroy(),this.outline=void 0,this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.emptyElement=void 0,this.useCustomScroller&&(this.iScroller.destroy(),this.iScroller=void 0),platform.mobile&&(this.itemMenuPhone=void 0,this.rightMenuPhone=void 0),util.destroy(this)},getInfiniteList:function getInfiniteListFn(isOutline){var infiniteList;return infiniteList=isOutline?this.getOutline().getInfiniteList():this._infiniteList},getItemStore:function getItemStoreFn(){return g.vmMain.itemStoreManager.getDefaultItemStore()},getOutline:function getOutlineFn(){return this.outline},isOutlineVisible:function isOutlineVisibleFn(){return this.outline.isVisible.get()},numItems:function numItemsFn(){return this.getItems().length},getItems:function getItemsFn(){return g.vmMain.flushItemsUpdate(),this.items.get()},itemAtIndex:function itemAtIndexFn(index){try{g.PAssert(3126,index>=0&&index<this.getItems().length,"Invalid item index: "+index)}catch(PERR){g.reportError(PERR)}return this.getItems()[index]},indexOfItem:function indexOfItemFn(item){return this.getItems().indexOf(item)},heightAtIndex:function heightAtIndexFn(index){var item=this.itemAtIndex(index);try{g.PAssert(3127,item,"Must have found a valid item")}catch(PERR){g.reportError(PERR)}return item?this.heightOfItem(item):0},heightOfItem:function heightOfItemFn(item,outline){try{g.PAssert(3128,item,"Must provide a valid item to measure")}catch(PERR){g.reportError(PERR)}return item.heightInPane(this,outline)},topOfItem:function topOfItemFn(item){try{g.PAssert(3129,item,"Must provide a valid item to measure")}catch(PERR){g.reportError(PERR)}var index=this.indexOfItem(item);return this.topOfIndex(index)},topOfIndex:function topOfIndexFn(index){for(var top=0,items=this.getItems(),i=0;index>i;i++)top+=items[i].heightInPane(this);return top},indexOfTop:function indexOfTopFn(){return this._infiniteList.indexOfTop()},notifyElementMounted:function notifyElementMountedFn(index,item){this._infiniteList.notifyItemMounted(index,item)},notifyElementUnmounted:function notifyElementUnmountedFn(index,item){this._infiniteList.notifyItemUnmounted(index,item)},elementAtIndex:function elementAtIndexFn(index){return this._infiniteList.getElementAtIndex(index)},getPaneDoc:function getPaneDocFn(){return g.vmMain.docManager.getOpenDoc()},getStatusMessage:function getStatusMessageFn(){var msg;return this.isLoading.get()||(0===this.numItems()?msg=this.isSearched()?this.paneEmptySearchMessage:this.paneEmptyMessage:this.isReady.get()||(msg=this._getNotReadyStatus())),msg},_getNotReadyStatus:function _getNotReadyStatusFn(){return"Pane data is only available while online."},copyStateFrom:function copyStateFromFn(pane){this.getItem()!==pane.getItem()&&this.setItem(pane.getItem())},getSaveInfo:function getSaveInfoFn(){return{id:this.id,focus:this.getItem().id,type:this.type,showarch:this.showArchived.get(),search:this.search.getValue(),offset:this.getScrollOffset(),itemState:this.getSaveInfoItemState()}},getSaveInfoItemState:function getSaveInfoItemStateFn(){var state=this._perPaneState,collapsed=[],collapsedSearch=[],uncollapsed=[];for(var id in state)if(state.hasOwnProperty(id)){var item=d.getModel(id);if(!item){delete state[id];continue}var o=state[id];o[PerPaneStateField.Collapsed]&&collapsed.push(id),o[PerPaneStateField.CollapsedSearch]&&collapsedSearch.push(id),o[PerPaneStateField.Collapsed]===!1&&item.isDemandLoad()&&uncollapsed.push(id)}return{collapsed:collapsed.length>0?collapsed:void 0,collapsedSearch:collapsedSearch.length>0?collapsedSearch:void 0,uncollapsed:uncollapsed.length>0?uncollapsed:void 0}},getPerPaneState:function getPerPaneStateFn(id,field){return this._perPaneState[id]?this._perPaneState[id][field]:void 0},setPerPaneState:function setPerPaneStateFn(id,field,data){this._perPaneState[id]||(this._perPaneState[id]={}),this._perPaneState[id][field]=data},clearPerPaneStateSearch:function clearPerPaneStateSearchFn(){if(this.isSearched()){var list=this._perPaneState;for(var id in list)if(list.hasOwnProperty(id)&&void 0!==list[id][PerPaneStateField.CollapsedSearch]){var item=d.getModel(id);if(!item)continue;item.setCollapsed(!1,this,!1),list[id][PerPaneStateField.CollapsedSearch]=void 0}}},deletePerPaneState:function deletePerPaneStateFn(id){this._perPaneState[id]=void 0},isSearched:function isSearchedFn(){return this.search.isSearched()},onSearchChanged:function onSearchChangedFn(){var isSelValid=Sel.isValid();isSelValid&&Sel.reset(),this.refreshSearchResults(),isSelValid&&this.numItems()>0&&Sel.selectIndex(0,0)},refreshSearchResults:function refreshSearchResultsFn(){this.clearPerPaneStateSearch(),this.updateItems()},_applyItemStateArr:function _applyItemStateArrFn(arr,field,value){if(arr)for(var i=0;i<arr.length;i++){var id=arr[i];this.setPerPaneState(id,field,value)}},applyItemState:function applyItemStateFn(itemState){itemState&&(this._applyItemStateArr(itemState.collapsed,PerPaneStateField.Collapsed,!0),this._applyItemStateArr(itemState.uncollapsed,PerPaneStateField.Collapsed,!1),this._applyItemStateArr(itemState.collapsedSearch,PerPaneStateField.CollapsedSearch,!0))},requestDemandLoadData:function requestDemandLoadDataFn(paneID,item){try{g.PAssert(3130,!1,"SubClass must override - by default demand load is not supported")}catch(PERR){g.reportError(PERR)}},requestDataPage:function requestDataPageFn(item){try{g.PAssert(3131,!1,"SubClass must override - by default data pagination is not supported")}catch(PERR){g.reportError(PERR)}},getRootItem:function getRootItemFn(){return g.vmMain.root.peek()},setRootItem:function setRootItemFn(item){try{g.PAssert(3132,void 0===item.parent(),"Root should never have a parent")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3133,this.getItem()!==item,"Should not be setting root to the same value")}catch(PERR){g.reportError(PERR)}this.setItem(item)},notifyDragStart:function notifyDragStartFn(){this.useCustomScroller&&this.iScroller.disable()},notifyDragEnd:function notifyDragEndFn(){this.useCustomScroller&&this.iScroller.enable()},notifySwappedIn:function notifySwappedInFn(scrollOffset){this.setScrollOffset(scrollOffset)},getScrollOffset:function getScrollOffsetFn(){var sOffset=0;return this.useCustomScroller?sOffset=this.iScroller?-this.iScroller.y:0:this.scrollElement&&(sOffset=this.scrollElement.scrollTop),sOffset},addScrollListener:function addScrollListenerFn(cb){this.useCustomScroller?this.iScroller.on("scroll",cb):this.scrollElement.addEventListener("scroll",cb)},removeScrollListener:function removeScrollListenerFn(cb){this.useCustomScroller?this.iScroller.off("scroll",cb):this.scrollElement.removeEventListener("scroll",cb)},refreshScrollListener:function refreshScrollListenerFn(){this.useCustomScroller&&this.iScroller&&this.iScroller.manualRefresh(this._infiniteList.contentHeight.get()+this._panePadding)},onTapSection:function onTapSectionFn(e){g.vmMain.vmPicker.onTapSection(e)},setupCustomScroller:function setupCustomScrollerFn(){this.iScroller=g.createCustomScroller(this.scrollElement),this.iScroller.on("scrollStart",function(){this._isScrollingTo=void 0,this._disableClick=!0}.bind(this));var disableTimeout,disableClick=function(){this._disableClick=!1}.bind(this);this.iScroller.on("scrollEnd",function(){this._isScrollingTo=void 0,cancelAnimationFrame(disableTimeout),disableTimeout=requestAnimationFrame(disableClick),this._scrollCompleteCallback&&this._scrollCompleteCallback()}.bind(this))},getMaxScrollOffset:function getMaxScrollOffsetFn(){var maxScrollOffset;return maxScrollOffset=this.useCustomScroller?-this.iScroller.maxScrollY:g.height(this.scrollElement)-g.height(this.paneContent)},setScrollOffset:function setScrollOffsetFn(offset,duration,cb){try{g.PAssert(3135,this.scrollElement,"Pane must have loaded a scrollable element")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3136,g.isNumber(offset),"Must supply a valid scroll offset")}catch(PERR){g.reportError(PERR)}duration=duration||ScrollDuration.Snap;var startOffset=this.getScrollOffset(),maxScrollY=Math.max(this._infiniteList.contentHeight.get()-this.getHeight(),0);return platform.mobile&&(maxScrollY+=platform.getKBSize()+g.keyboardToolbarHeight),0>offset?offset=0:platform.mobile&&offset>maxScrollY&&(offset=maxScrollY),this._isScrollingTo!==offset?(this.useCustomScroller?(this._scrollCompleteCallback=function(){this._scrollCompleteCallback=void 0,this._isScrollingTo=void 0,cb&&cb()}.bind(this),this.iScroller.scrollTo(0,-offset,duration),duration||this.iScroller._execEvent("scroll")):g.scrollTo(void 0,offset,duration,this.scrollElement,function(){this._isScrollingTo=void 0,cb&&cb()}.bind(this)),duration&&(this._isScrollingTo=offset)):cb&&cb(),offset-startOffset},_scrollIntoView:function _scrollIntoViewFn(item,itemTop,duration,cb){var kbsize=platform.getKBSize(),paneHeight=this.getHeight(),availableScreenArea=platform.mobile?paneHeight-kbsize-g.keyboardToolbarHeight:paneHeight,scrollTop,scrollBottom;platform.mobile?(scrollTop=this.getScrollOffset(),scrollBottom=scrollTop+availableScreenArea):(scrollTop=this.getScrollOffset(),scrollBottom=scrollTop+paneHeight);var metrics=item.metricsInPane(this),itemScrollTop=itemTop+g.topBoxHeight,itemScrollBottom=itemScrollTop+metrics.height,isBelow=itemScrollBottom>scrollBottom,isAbove=scrollTop>itemScrollTop;isAbove&&metrics.height>availableScreenArea&&itemScrollBottom>=scrollBottom&&(isAbove=!1);var needsScroll=0,scrollDest;return isAbove?scrollDest=0===itemTop?0:itemScrollTop:isBelow&&(scrollDest=itemScrollBottom-availableScreenArea),isAbove||isBelow?(needsScroll=scrollDest-scrollTop,this.setScrollOffset(scrollDest,duration,function(){cb&&setTimeout(cb,0)})):cb&&cb(),needsScroll},scrollIndexIntoView:function scrollIndexIntoViewFn(index,duration,cb){try{g.PAssert(3137,g.isNumber(index),"Must supply a valid index")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3138,g.isNumber(duration),"Must supply a valid scroll duration")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3139,!cb||g.isFunction(cb),"Must supply a valid callback function")}catch(PERR){g.reportError(PERR)}var item=this.itemAtIndex(index);try{g.PAssert(3140,item,"Item does not exist to scroll to",index,this.numItems())}catch(PERR){g.reportError(PERR)}if(item){var itemTop=this.topOfIndex(index);return this._scrollIntoView(item,itemTop,duration,cb)}return!1},scrollItemIntoView:function scrollItemIntoViewFn(item,duration,cb){var itemTop=this.topOfItem(item);return this._scrollIntoView(item,itemTop,duration,cb)},scrollToTop:function scrollToTopFn(item,duration){try{g.PAssert(3141,item instanceof VMLI,"Must be a valid VMLI instance")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3142,g.isNumber(duration),"Must have a valid scroll duration")}catch(PERR){g.reportError(PERR)}var itemTop=this.topOfItem(item)+g.topBoxHeight;return this.setScrollOffset(itemTop,duration)},scrollToMiddle:function scrollToMiddleFn(item,duration,cb){var itemTop=this.topOfItem(item),metrics=item.metricsInPane(this),amtMoved=itemTop+metrics.height/2+g.topBoxHeight-this.getHeight()/2;return this.setScrollOffset(amtMoved,duration,cb)},addScrollDelta:function addScrollDeltaFn(delta){try{g.PAssert(3143,this.scrollElement,"Pane must have loaded a scrollable element")}catch(PERR){g.reportError(PERR)}return this.setScrollOffset(this.getScrollOffset()+delta)},scrollFromMousePosition:function scrollFromMousePositionFn(clientY){var scrollAreaSize=50,topMin=0,topMax=scrollAreaSize,bottomMax=this.getHeight(),bottomMin=bottomMax-scrollAreaSize,offsetY=clientY-this.contentTop(),speedMod=3;if(topMax>offsetY){var speed=-(1-g.computeScrollSpeed(topMin,topMax,offsetY))*speedMod;g.repeatScroll(speed,this)}else if(offsetY>bottomMin){var speed=g.computeScrollSpeed(bottomMin,bottomMax,offsetY)*speedMod;g.repeatScroll(speed,this)}else g.cancelRepeatScroll()},addPadding:function addPaddingFn(){this.useCustomScroller&&(this._panePadding=platform.windowHeight()-2*g.topBarHeight,this.refreshScrollListener())},removePadding:function removePaddingFn(){if(this.useCustomScroller){var s=this.iScroller;this._panePadding=0,this.refreshScrollListener(),s.y<s.maxScrollY&&this.iScroller.scrollTo(0,s.maxScrollY,200)}},getContentElement:function getContentElementFn(){return this.paneContent},trackDOM:function trackDOMFn(){return!0},searchACName:function searchACNameFn(){return"template-search-ac-default"},templateNameItem:function templateNameItemFn(item,context){var pane=g.getPaneForContext(context);try{g.PAssert(3144,pane,"Must be able to find a valid pane")}catch(PERR){g.reportError(PERR)}return pane&&pane.isWriteable?"template-li":g.templateNameItem(item,pane)},getPaneIcon:function getPaneIconFn(){return"icon-align-left"},itemHasChildren:function itemHasChildrenFn(){return this.getItem().numItems()>0},getItem:function getItemFn(){return this.item.get()},setItem:function setItemFn(newItem,notify){var oldItem=this.getItem();this.item.set(newItem,!1),this.updateItems(!0),oldItem.parent()&&oldItem._updateStylePadding(oldItem.parent().levelsDeep.get(),!0),notify&&(newItem.itemChanged.notify(),newItem!=oldItem&&oldItem.itemChanged.notify()),notify&&this.item.notify()},onItemCompleteChanged:function onItemCompleteChangedFn(item){this.updateItems(),item.isDescendantOf(this.getItem())&&this.numCompleteItems.set(this.numCompleteItems.get()+(item.isComplete()?1:-1))},onItemCollapsedChanged:function onItemCollapsedChangedFn(item){this.updateItems()},getItemSearchParams:function getItemSearchParamsFn(){return{item:this.getItem(),comparator:this.search.isMatched.bind(this.search),noCollapsed:!0,pane:this}},updateItems:function updateItemsFn(updateSearch,forceNotify){(updateSearch||this!==g.focusedPane)&&this.search.update();var numComplete=0,arr=[],params=this.getItemSearchParams();params.each=function(item){arr.push(item),item.isComplete()&&!item.isArchived()&&numComplete++},g.searchVMLIs(params),this.numCompleteItems.set(numComplete),this.setItems(arr,forceNotify),this.updateHeaders(),this.isInitialized||(this.isInitialized=!0),Dispatcher.fireEvent("itemsUpdated",[this])},setItems:function setItemsFn(items,forceNotify){(forceNotify||!items.equals(this.items.get()))&&this.items.set(items)},updateHeaders:function updateHeadersFn(){var root=this.getRootItem(),headers=[root];g.searchVMLIs({item:root,comparator:this.search.isMatched.bind(this.search),noCollapsed:!0,headers:!0,outline:!0,pane:this,each:function eachFn(item){headers.push(item)}}),headers.equals(this.headers.get())||this.headers.set(headers)},clearItems:function clearItemsFn(notify){this.items.set([],notify)},onLoad:function onLoadFn(){this.isLoaded=!0,!platform.android&&!platform.mobileie||platform.script||android.setPaneRoot(this),requestAnimationFrame(this.onAfterLoaded.bind(this))},onAfterLoaded:function onAfterLoadedFn(){isNaN(this.initialOffset)&&(this.initialOffset=this.defaultOffset),0!==this.initialOffset&&this.setScrollOffset(this.initialOffset)
},getSize:function getSizeFn(){return g.vmMain.paneManager.paneSize},getWidth:function getWidthFn(){return this.getSize().get().width},getHeight:function getHeightFn(){var height=this.getSize().get().height;return height-this.headerHeight()},toggleOutlineVisibility:function toggleOutlineVisibilityFn(){this.getOutline().toggleDesktop()},notifyDropFrom:function notifyDropFromFn(droppedItem){},dropEffectCopyBehavior:function dropEffectCopyBehaviorFn(copyItem,targetItem){return copyItem.clone(targetItem,ChangeType.Local)},keydown:function keydownFn(e){if(e.handled)return!0;if(android.isEnabled()&&!android.passKeydown(e))return!0;if(g.autocomplete&&!g.autocomplete.onkeydown(e))e.preventDefault(),e.stopPropagation();else{platform.mobile||android.isEnabled()||0!==this.numItems()||g.hasClass(this.paneContent,"loading")||this.addItem(e);try{edit.keydown(this,e)||(e.preventDefault(),e.stopPropagation())}catch(err){g.reportError(err,e)}}},keypress:function keypressFn(e){if(!android.isEnabled()||android.passKeypress(e))try{edit.keypress(this,e)||(e.preventDefault(),e.stopPropagation())}catch(err){g.reportError(err,e)}},keyup:function keyupFn(e){g.vmMain.lastActivity=Date.now();try{edit.keyup(this,e)||(e.preventDefault(),e.stopPropagation())}catch(err){g.reportError(err,e)}},textInput:function textInputFn(e){if(!(platform.ios||platform.mac||platform.windows||platform.linux))return!0;try{return edit.textInputiOS(this,e)}catch(err){g.reportError(err,e)}},compositionEnd:function compositionEndFn(e){if(!platform.isFirefox)return!0;try{return edit.textInputiOS(this,e)}catch(err){g.reportError(err,e)}},setupContextMenu:function setupContextMenuFn(item){return g.element("contextMenuItem")},addItemToPane:function addItemToPaneFn(text,index){var target=this.getItem();text||(text=""),tracker.beginAction();var item=d.createVMLI({text:text},{parent:target,changeType:ChangeType.AllLocal});return target.insertItem(item,index),tracker.performAction(TrackerType.Create,{itemID:item.id,parent:target.id,position:isNaN(index)?target.numItems()-1:index,text:text}),tracker.endAction(),item},onTapTitle:{onClick:function onClickFn(e,item){var oldItem=g.focusedItem;platform.ios||item===this.getItem()&&this.search.reset();var parents=this.getItem().parents();return parents.length<=1?void(this.isOutlineVisible()&&this.toggleOutlineVisibility()):(g.vmMain.zoomout(item),void g.sendEvent("Menu","Title"))}},onTap:{onStart:function onStartFn(e){if(this._disableClick)return void e.preventDefault();if(platform.mobile&&(g.touchHoldTimeout&&clearTimeout(g.touchHoldTimeout),g.phoneMenu.multiSelectMode()||this.useCustomScroller&&this.iScroller.moved||(g.touchHoldTimeout=setTimeout(this.onTouchHoldTimeout,g.isKeyboardOpen?g.iOSDragTimeKeyboardOpen:g.iOSDragTime,e))),!platform.mobile||g.ScreenManager&&!g.ScreenManager.checkSwipeStart(e)){if(g.menus&&g.phoneMenu&&(g.menus.startedInMultiSelectMode=g.phoneMenu.multiSelectMode()),Sel.setFocusedPane(this),!(this.useCustomScroller||!platform.isTouchDevice||platform.app||platform.ie&&!platform.mobileie||g.preventScrollPropagation(this.scrollElement)))return e.preventDefault(),!1;if(!android.isEnabled()||!android.isTargetBox(e)){var target=g.dataFor(e.srcElement,!0);platform.mobile&&target===this&&(target=g.focusedPane.getLastItem()),target&&target.onStart&&target.onStart(e)}}},onMove:function onMoveFn(e){platform.mobile&&g.touchHoldTimeout&&(clearTimeout(g.touchHoldTimeout),g.touchHoldTimeout=void 0),g.autocomplete&&platform.mobile&&g.autocomplete.hide();var sendMove=!0;if(platform.mobile&&(g.menus.startedInMultiSelectMode||DragDrop.isDragging||g.ScreenManager&&(sendMove=!g.ScreenManager.checkSwipeMove(e))),sendMove&&(!android.isEnabled()||!android.isTargetBox(e))){var target=g.dataFor(e.startSrc,!0),onPane=!1;platform.mobile&&target===this&&(target=g.focusedPane.getLastItem(),onPane=!0),DragDrop.isDragging&&(target=DragDrop.dragItem),target&&target.onMove&&target.onMove(e,onPane)}return!1},onClick:function onClickFn(e){if(!(platform.mobile&&(!g.ScreenManager||g.ScreenManager.checkSwipeClick(e))||android.isEnabled()&&android.isTargetBox(e))){var target=g.dataFor(e.startSrc,!0);platform.mobile&&target===this&&(target=g.focusedPane.getLastItem(),(target&&e.clientX<target.getPadding(this)||e.clientX>this.getWidth()-g.SPThresholdRight)&&(target=void 0)),target&&(e.targetItem=target),target&&target.onClick?target.onClick(e):this.isWriteable&&0===this.numItems()&&!g.hasClass(this.paneContent,"loading")?this.addItem(e):g.hasClass(e.startSrc,"paneDataPageLoad")?this.getItem().hasPaginationToken()&&this.requestDataPage(this.getItem()):e.preventDefault()}},onEnd:function onEndFn(e){if(platform.mobile&&g.touchHoldTimeout&&(clearTimeout(g.touchHoldTimeout),g.touchHoldTimeout=void 0),!(platform.mobile&&(!g.ScreenManager||g.ScreenManager.checkSwipeEnd(e))||android.isEnabled()&&android.isTargetBox(e))){var target=e.targetItem||g.dataFor(e.startSrc,!0);if(platform.mobile&&target===this&&(target=g.focusedPane.getLastItem()),DragDrop.isDragging&&(target=DragDrop.dragItem),!target)return;"paneContent"===e.startSrc.id&&(e.preventDefault(),platform.ios&&g.preventClick()),target&&target.onEnd&&target.onEnd(e)}},onDblClick:function onDblClickFn(e){var target=g.dataFor(e.startSrc,!0);target&&target.onDblClick&&target.onDblClick(e)},onRightClick:function onRightClickFn(e){if(!g.isDisplayModeActive(DisplayMode.NoRightClick)){if(Sel.setFocusedPane(this),!android.isEnabled()||!android.isTargetBox(e)){var target=g.dataFor(e.srcElement,!0);target&&target.onRightClick&&target.onRightClick(e)}tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.RightClick,data:{element:void 0}})}}},addItem:function addItemFn(e){Sel.reset();var item=this.addItemToPane("",0),pane=g.focusedPane;platform.mobileie&&android.isEnabled()?android.updateInput(item):pane&&pane.paneContent&&(Sel.focusPane(pane),Sel.selectIndex(0,0,0)),platform.mobile&&g.openKeyboardOnItem(e,pane,item,function(){pane.onFocus()},function(){pane.onBlur()}),g.sendEvent("Menu","AddItemButton")},onClose:function onCloseFn(){},onTapAddItem:{onStart:function onStartFn(e){e.preventDefault(),e.stopImmediatePropagation()},onClick:function onClickFn(e){platform.mobile&&this.isOutlineVisible()||(Sel.setFocusedPane(this),this.addItem(e))}},onTapOutlineButton:function onTapOutlineButtonFn(){this.toggleOutlineVisibility(),this.isOutlineVisible()?g.sendEvent("Menu","OpenOutline"):g.sendEvent("Menu","CloseOutline")},onTapClosePane:function onTapClosePaneFn(){var removedID=g.vmMain.paneManager.removePane(this);if(removedID){try{g.PAssert(3147,removedID===this.id,"Pane IDs must match")}catch(PERR){g.reportError(PERR)}tracker.performAction(TrackerType.UIAction,{type:TrackerUIAction.RemovePane,data:removedID}),g.sendEvent("Menu","ClosePane"),g.tooltip.hideTip(),this.onClose()}},onTapArchiveCompleted:{onStart:function onStartFn(e){e.stopImmediatePropagation()},onClick:function onClickFn(e){g.vmMain.beginUpdateItems(),this.archiveCompleted(),Sel.reset(),g.vmMain.commitUpdateItems(),g.sendEvent("Menu","ArchiveCompleted"),g.handlerPreventStop(e)}},onTapRefreshData:{onStart:function onStartFn(e){e.stopImmediatePropagation()},onClick:function onClickFn(e){try{g.PAssert(3148,this.supportDataRefresh,"How did this pane try to perform a data refresh if it is not supported",this.type)}catch(PERR){g.reportError(PERR)}this.refreshPaneData(),g.sendEvent("Menu","PaneDataRefresh"),g.handlerPreventStop(e)}},archiveCompleted:function archiveCompletedFn(){var archivedItems=[];g.searchVMLIs({item:this.getItem(),includeArchived:!1,comparator:function comparatorFn(item){return item.isComplete()},each:function eachFn(item){archivedItems.push(item)}}),tracker.beginAction();for(var i=archivedItems.length-1;i>=0;i--){var item=archivedItems[i];item.parent().archiveChild(item)}if(tracker.endAction(),archivedItems.length>0){var z=archivedItems.length>1?" items.":" item.";g.messageQueue.pushMessage({text:"Archived "+(archivedItems.length+z),action:MessageAction.Undo,hold:platform.mobile,timeout:platform.mobile?void 0:8e3})}else g.messageQueue.pushMessage({text:"No completed items to archive"});g.sendEvent("Menu","ArchiveCompleted")},onTapViewArchived:function onTapViewArchivedFn(){},updatePosition:function updatePositionFn(x,animate){var time=animate?150:0;g.setTransform(this.scrollElement,x,0,time)},showLoadMore:function showLoadMoreFn(){return!1},isSearchingRemote:function isSearchingRemoteFn(){return!1},itemTitle:function itemTitleFn(){return this.getItem().getParsedText()},onTapToggleModeMobile:function onTapToggleModeMobileFn(){var dstType=this.type===PaneMode.Normal?PaneMode.Timeline:PaneMode.Normal;g.vmMain.togglePaneModeMobile(this,dstType)},onTapSettingsMobile:{onClick:function onClickFn(e){g.menus.openModal(Modals.MobileSettings),g.handlerPreventStop(e),g.sendEvent("PhoneMenu","OpenSettings")}},onShowArchivedChanged:function onShowArchivedChangedFn(){this.showArchived.get()&&Dispatcher.fireEvent("showArchived",[]),this.updateItems()},getLastItem:function getLastItemFn(){var a=this.getItems();return a[a.length-1]},getFirstItem:function getFirstItemFn(){return this.getItems()[0]},onBlur:function onBlurFn(){this.isFocused&&this.blurTrigger.notify(),this.isFocused=!1},onFocus:function onFocusFn(){this.isFocused||this.focusTrigger.notify(),this.isFocused=!0},focus:function focusFn(){this.paneContent.focus(),this.onFocus(!0)},headerHeight:function headerHeightFn(){var MagicNumber_3=72,MagicNumber_4=39;return platform.mobile?0:this.getItem().parents().length>1?MagicNumber_3:MagicNumber_4},contentTop:function contentTopFn(){return g.paneTop+this.headerHeight()},indexPageUp:function indexPageUpFn(index){var list=this._infiniteList;return list.indexPageUp(index)},indexPageDown:function indexPageDownFn(index){var list=this._infiniteList;return list.indexPageDown(index)},adjustSelectionFromRemoteChanges:function adjustSelectionFromRemoteChangesFn(sel){try{g.PAssert(3149,sel,"Must pass in a valid saved selection")}catch(PERR){g.reportError(PERR)}var adjustedSelection=sel;return sel.startItem&&sel.endItem&&(sel.startIndex=this.indexOfItem(sel.startItem),sel.endIndex=this.indexOfItem(sel.endItem),(sel.startIndex<0||sel.endIndex<0)&&(adjustedSelection=void 0)),adjustedSelection},maxWidthOfItem:function maxWidthOfItemFn(item,isOutline){var spanWidth,padding;return isOutline&&platform.mobile?(padding=item.getPaddingOutline(this),spanWidth=this.getWidth()*g.outlineWidthPerc-padding-8):(padding=item.getPadding(this),spanWidth=this.getWidth()-padding-g.SPThresholdRight),spanWidth},saveScrollRelativeToIndex:function saveScrollRelativeToIndexFn(index){var ret={index:index,scrollOffset:this.getScrollOffset()-this.topOfIndex(index)};return ret},restoreScrollRelativeToIndex:function restoreScrollRelativeToIndexFn(obj){var top=this.topOfIndex(obj.index)+(obj.scrollOffset||0);this.setScrollOffset(top,ScrollDuration.Snap)},restoreSelectionAfterCollapse:function restoreSelectionAfterCollapseFn(saved,collapsed){if(saved){var startItem=saved.startItem,startIndex=this.indexOfItem(saved.startItem),endIndex=this.indexOfItem(saved.endItem),item,changedSel;if(startIndex>=0&&endIndex>=0)Sel.selectIndices(startIndex,saved.startOffset,endIndex,saved.endOffset),item=saved.startItem;else if(startIndex>=0)Sel.selectIndex(startIndex,saved.startOffset),item=saved.startItem,changedSel=!0;else if(endIndex>=0)Sel.selectIndex(endIndex,saved.endOffset),item=saved.endItem,changedSel=!0;else if(collapsed===!0)for(item=startItem;item;){var parent=item.parent();if(parent===g.focusedPane.item.get()){Sel.selectItem(item,item===startItem?Sel.getStartOffset():-1),changedSel=!0;break}item=parent}else Sel.reset();item&&changedSel&&g.focusedPane.scrollToMiddle(item,ScrollDuration.Snap)}},onOutlineToggled:function onOutlineToggledFn(isVisible){this.useCustomScroller&&(isVisible?this.iScroller.disable():(this.iScroller.enable(),this._disableClick=!1))},onTouchHoldTimeout:function onTouchHoldTimeoutFn(e){g.touchHoldTimeout=void 0,g.isKeyboardOpen&&!this.isOutlineVisible()&&(g.canRevealMenu=!1,this.useCustomScroller&&this.iScroller.disable()),Dispatcher.fireEvent("touchHoldTimeout",[e])}},util.defineBase(VMPane),util.extend(VMPane.prototype,EventDispatcher),g.VMPane=VMPane,VMPane}),define("VMTimelineBlock",["ko","globals","data","util","VMLI","International"],function(ko,g,d,util,VMLI,International){function VMTimelineBlock(p){this.pane=p.pane,this.date=p.date,this.id=this.dateKey=p.dateKey,this.text=p.name,this.search=this.pane.search,this.items=[],this.isStarred=p.isStarred,this.isImportant=p.isImportant,this.isToday=p.isToday,this.isNow=p.isNow}return VMTimelineBlock.prototype={heightOfFirstHeader:function heightOfFirstHeaderFn(){return 20},heightOfHeader:function heightOfHeaderFn(){return 44},heightOfTime:function heightOfTimeFn(){return 20},showTime:function showTimeFn(index){if(this.isNow)return!1;var items=this.items,item=items[index];if(!items[0].hasTime()||this.isStarred||this.isImportant||!this.search.isMatched(item))return!1;for(var previousVisible=index-1;previousVisible>0&&!this.search.isMatched(items[previousVisible]);)previousVisible--;if(0>previousVisible)return!0;var prevItem=items[previousVisible];if(item.hasTime()){if(prevItem.getTimeOfDay()===item.getTimeOfDay())return!1}else if(!prevItem.hasTime())return!1;return!0},comparePriority:function comparePriorityFn(left,right){var lPri=left.priority(),rPri=right.priority();return lPri>rPri?-1:rPri>lPri?1:0},compareDate:function compareDateFn(left,right){if(left.isComplete()&&!right.isComplete())return-1;if(!left.isComplete()&&right.isComplete())return 1;if(left.isComplete()&&right.isComplete())return left.dateCompleted>right.dateCompleted?1:-1;var leftDate=left.date()||left.repeatDate(),rightDate=right.date()||right.repeatDate();if(leftDate&&!rightDate)return-1;if(!leftDate&&rightDate)return 1;if(leftDate.hasTimeOfDay()&&rightDate.hasTimeOfDay()){var leftTime=leftDate.getTimeOfDay(),rightTime=rightDate.getTimeOfDay();return leftTime===rightTime?0:rightTime>leftTime?-1:1}return leftDate.hasTimeOfDay()?-1:rightDate.hasTimeOfDay()?1:0},compareOrder:function compareOrderFn(left,right){return-1},compareItems:function compareItemsFn(left,right){var cDate=this.isStarred||this.isImportant?0:this.compareDate(left,right);if(0===cDate){var cPriority=this.isStarred?0:this.comparePriority(left,right);if(0===cPriority){var cOrder=this.compareOrder(left,right);return cOrder}return cPriority}return cDate},addItem:function addItemFn(item){try{g.PAssert(3152,item&&item instanceof VMLI,"Must be adding a valid item: "+g.getObjectInfo(item))}catch(PERR){g.reportError(PERR)}this.items.insertSorted(item,this.compareItems.bind(this))},height:function heightFn(){var height=0,items=this.items;items.length>0&&(height+=44);for(var i=0;i<items.length;i++){var item=items[i];this.showTime(item,i)&&(height+=20),height+=item.heightInPane(this.pane)}return height}},VMTimelineBlock}),define("VMPane_Timeline",["globals","util","platform","data","VMTimelineBlock","RepeatDate","VMPane","Observable","ObservableArray","Trigger","International","Dispatcher"],function(g,util,platform,d,VMTimelineBlock,RepeatDate,VMPane,Observable,ObservableArray,Trigger,International,Dispatcher){function VMPane_Timeline(p){this._super.constructor.call(this,p),this.type=PaneMode.Timeline,this._allPaneItems=[],this.paneClass="paneTimeline",this.isWriteable=!1,this.overrideCopyBehavior=!1,this.supportCollapsing=!1,this.supportCompleting=!0,this.supportOffline=!0,this.supportViewArchived=!0,this.search.itemStoreFilter=ItemStoreFilter.Dates,this.initTimeline()}var dateKeyCache={},VMPane_TimelineFns={initTimeline:function initTimelineFn(){this.blocks=[],this.blockImportant=void 0,this.blockStarred=void 0,this.days={},this.updateNextTimeout=0,this.datesByItem={},this.starredItems={},this.priorityItems={},this.blocksByKey={},this.loadTimeline(),this._loadedTimeline=!0;var gcalPlugin=g.vmMain.pluginManager.getPlugin(PluginID.GCalendar);gcalPlugin.isActive()&&gcalPlugin.loadRemoteAPIs()},getPaneIcon:function getPaneIconFn(){return"icon-calendar2"},updateItems:function updateItemsFn(updateSearch){this._super.updateItems.call(this,updateSearch)},indexOfItem:function indexOfItemFn(item){for(var items=this.getItems(),i=0;i<items.length;i++)if(items[i].item===item)return i;return-1},getItemSearchParams:function getItemSearchParamsFn(){var params={itemStoreFilter:this.search.itemStoreFilter,item:this.item.get(),comparator:this.search.isMatched.bind(this.search),noCollapsed:!0,includeArchived:this.showArchived.get(),pane:this};return params},setItems:function setItemsFn(items){this._allPaneItems=items,this.loadTimeline()},onTapViewArchived:function onTapViewArchivedFn(){g.vmMain.beginUpdateItems(),this.showArchived.set(!this.showArchived.get()),g.vmMain.commitUpdateItems(),g.vmMain.paneManager.updatePaneStateForPane(this),g.sendEvent("Menu","ShowArchivedTimeline")},onAfterLoaded:function onAfterLoadedFn(){var index=this.findIndexOfNextBlock();if(index>=0){var top=this.topOfIndex(index);this.initialOffset=top}else this.initialOffset=0;this._super.onAfterLoaded.call(this)},blockCompare:function blockCompareFn(left,right){return left.date.compareTo(right.date)},findIndexOfNextBlock:function findIndexOfNextBlockFn(){for(var index=0,now=new Date,i=0;i<this.blocks.length;i++){var block=this.blocks[i];if(block.isNow||block.isToday||block.isStarred||block.isImportant||block.date>=now)return index;index++;for(var u=0;u<block.items.length;u++)index+=block.showTime(u)?2:1}return-1},getDateKey:function getDateKeyFn(item,date){try{g.PAssert(3153,date,"Cannot get date key if no date")}catch(PERR){g.reportError(PERR)}var dateKey=dateKeyCache[date]||dateKeyCache[item.dateText];if(dateKey)return dateKey;if(date instanceof RepeatDate){var schedDates=date.getDates();dateKey=[];for(var i=0;i<schedDates.length;++i)dateKey.push(this.getDateKey(item,schedDates[i]));dateKeyCache[date]=dateKey}else if(g.isDateSoft(item.dateText))dateKey=item.dateText.toUpperCase(),dateKeyCache[item.dateText]=dateKey;else{var today=Date.today(),text="",timeDiff=Math.floor((date-today)/864e5);switch(timeDiff){case-1:text="YESTERDAY ";break;case 0:text="TODAY ";break;case 1:text="TOMORROW ";break;default:text=date.toString("dddd").toUpperCase()}var showYear=date.getYear()!==today.getYear(),dateFormatEnum=showYear?DFormat.MonthDayYear:DFormat.ShortDate,dateFormat=International.getFormat(dateFormatEnum);dateKey=text+" "+date.toString(dateFormat),dateKeyCache[date]=dateKey}return dateKey},loadTimeline:function loadTimelineFn(){var i,item;for(this!==g.focusedPane&&this.search.update(),this.blocks=[],this.blocksByKey={},i=0;i<this._allPaneItems.length;i++)this.addToBlock(this._allPaneItems[i]);var numByID={},items=[];for(i=0;i<this.blocks.length;i++){var block=this.blocks[i];items.push({type:"agendaHeader",block:block,id:block.id,heightInPane:0===i?block.heightOfFirstHeader:block.heightOfHeader});for(var u=0;u<block.items.length;u++){item=block.items[u];var itemID=item.id+"_"+block.id;if(block.showTime(u)){var header={type:"agendaTime",text:item.time(),id:itemID+"_time",heightInPane:block.heightOfTime};item.isComplete()&&(header.isComplete=!0),items.push(header)}items.push({item:item,id:itemID,heightInPane:item.heightInPane.bind(item)})}}this.items.set(items)},addToBlock:function addToBlockFn(item){if(item.isStarred()){var blockStarred=this.getBlock("STARRED");blockStarred.addItem(item)}if(item.isImportant()){var blockImportant=this.getBlock("IMPORTANT");blockImportant.addItem(item)}var date;if(item.repeatDate()?date=item.repeatDate():item.date()?date=item.date():item.isComplete()&&(date=item.dateCompleted),date){var dateKey=this.getDateKey(item,date);if(g.isArray(dateKey))for(var schedDates=date.getDates(),i=0;i<dateKey.length;++i){var block=this.getBlock(dateKey[i],schedDates[i]);block.addItem(item)}else{var block=this.getBlock(dateKey,date);block.addItem(item)}}},getBlock:function getBlockFn(key,date){var block=this.blocksByKey[key];if(!block){var options={pane:this,dateKey:key,name:key};date&&(options.date=date.clone().clearTime()),g.isString(key)&&0===key.indexOf("TODAY")?options.isToday=!0:"NOW"===key?(options.isNow=!0,options.date=Date.today().add({hours:1})):"STARRED"===key?(options.date=Date.today().add({hours:2}),options.isStarred=!0):"IMPORTANT"===key&&(options.date=Date.today().add({hours:3}),options.isImportant=!0),block=new VMTimelineBlock(options),this.blocksByKey[key]=block,this.blocks.insertSorted(block,this.blockCompare)}return block},getStatusMessage:function getStatusMessageFn(){var reason=this.isSearched()?"No search results":"Nothing on the agenda";return reason},maxWidthOfItem:function maxWidthOfItemFn(item){return this.getWidth()-g.agendaPadding-g.SPThresholdRight},getLastItem:function getLastItemFn(){var a=this._super.getLastItem.call(this);return a&&a.item},getFirstItem:function getFirstItemFn(){var a=this._super.getFirstItem.call(this);return a&&a.item}};return util.inherit(VMPane,VMPane_Timeline),util.extend(VMPane_Timeline.prototype,VMPane_TimelineFns),VMPane_Timeline}),define("PaneFactory",["ko","globals","data","VMPane","VMPane_Timeline"],function(ko,g,d,VMPane,VMPane_Timeline){function PaneFactory(){this._inactivePaneTypes={},this._activePaneTypes=ko.observableArray(),this._registeredTypes={},this.numInactivePanes=ko.observable(0),this.registerPaneType(void 0,PaneMode.Normal,"Normal",VMPane,"icon-align-left"),this.registerPaneType(void 0,PaneMode.Timeline,"Agenda",VMPane_Timeline,"icon-calendar2")}return PaneFactory.prototype={registerPaneType:function registerPaneTypeFn(plugin,type,name,constructor,icon){this._registeredTypes[type]={plugin:plugin,constructor:constructor};var paneTypeInfo={type:type,name:name,icon:icon,text:name+" Pane",tooltip:"Add "+name+" Pane"};!plugin||plugin.isActive()?this._activePaneTypes.push(paneTypeInfo):(this._inactivePaneTypes[type]=paneTypeInfo,this.numInactivePanes(this.numInactivePanes()+1))},activatePaneType:function activatePaneTypeFn(type){var paneTypeInfo=this._inactivePaneTypes[type];try{g.PAssert(3154,paneTypeInfo,"Must have previously registered pane type")}catch(PERR){g.reportError(PERR)}this._inactivePaneTypes[type]=void 0,this._activePaneTypes.push(paneTypeInfo),this.numInactivePanes(this.numInactivePanes()-1)},deactivatePaneType:function deactivatePaneTypeFn(type){var paneTypeInfo=this._activePaneTypes.remove(function(entry){return entry.type===type})[0];try{g.PAssert(3155,paneTypeInfo,"Must have previously activated pane type")}catch(PERR){g.reportError(PERR)}g.vmMain.paneManager.removePanesByType(type),this._inactivePaneTypes[type]=paneTypeInfo,this.numInactivePanes(this.numInactivePanes()+1)},createPane:function createPaneFn(type,options){var paneInfo=this._registeredTypes[type];if(paneInfo)return!paneInfo.plugin||paneInfo.plugin.isActive()&&!paneInfo.plugin.isPluginBlocked()?new paneInfo.constructor(options):void 0;try{g.PAssert(3156,!1,"Invalid pane type requested")}catch(PERR){g.reportError(PERR)}return void 0},isPaneTypeActive:function isPaneTypeActiveFn(type){var isRegistered=!!this._registeredTypes[type],isInactive=!!this._inactivePaneTypes[type];return isRegistered&&!isInactive},getRegisteredPanes:function getRegisteredPanesFn(){return this._activePaneTypes}},new PaneFactory}),define("VMDocument",["ko","globals","platform","data","goog","tracker"],function(ko,g,platform,d,goog,tracker){function VMDocument(p,isRemoteData){this._remoteData=isRemoteData?p:void 0,p=p||{},this.id=p.id,this._title=ko.observable(p.title||""),this._isShared=ko.observable(p.shared||!1),this._isOwned=ko.observable(!this._remoteData),this._isOpen=ko.observable(!1),this._isDeleted=!1,this._docFolderID=void 0,this._realtimeDoc=void 0,this._remoteData&&this.updateData(this._remoteData)}var LoadState={Creating:0,Closed:1,Opening:2,Opened:3};return VMDocument.prototype={updateData:function updateDataFn(remoteData,isRemoteData){try{g.PAssert(3157,remoteData,"Must supply remote data to update doc")}catch(PERR){g.reportError(PERR)}if(remoteData){if(this._remoteData){try{g.PAssert(3158,!remoteData.id||remoteData.id===this.id,"ID must either not exist or be the same")}catch(PERR){g.reportError(PERR)}for(var prop in remoteData)remoteData.hasOwnProperty(prop)&&(this._remoteData[prop]=remoteData[prop])}else this._remoteData=remoteData,this.id=remoteData.id;g.settings.get(Settings.gdocId)===this._remoteData.id&&g.settings.set(Settings.gdocTitle,this._remoteData.title),this._title(this._remoteData.title),this._isShared(this._remoteData.shared);var userPermission=this._remoteData.userPermission;this._isOwned(userPermission&&"me"===userPermission.id&&"owner"===userPermission.role?!0:!1)}},setRealtimeDoc:function setRealtimeDocFn(realtimeDoc){try{g.PAssert(3159,!this._realtimeDoc,"Must only have a single realtime doc instance per doc")}catch(PERR){g.reportError(PERR)}this._realtimeDoc=realtimeDoc},hasDriveBacking:function hasDriveBackingFn(){return!!this._remoteData},insertPermission:function insertPermissionFn(addr,cb){try{g.PAssert(3160,this._remoteData,"Must have remote data to add permissions")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3161,this.id,"Must specify a valid document ID to operate on")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3162,addr,"Must specify a valid email to add")}catch(PERR){g.reportError(PERR)}var docURL="https://www.moo.do/app/#login=true&file="+this.id,successCB=function(result){g.XHR_PrivateAPI({type:"POST",path:"/sharing/shareDoc",data:{fromUser:g.getUserIdentifier(),toEmail:addr,docURL:docURL},requireAuth:!0,cb:function cbFn(xhr){200!==xhr.status}}),this.getDocumentFolder(function(folderID){var folderSuccessCB=function(result){},folderFailureCB=function(result){};g.vmMain.remoteAPI().drivePermissionsInsert(folderID,addr,folderSuccessCB,folderFailureCB)}),result&&(this._remoteData.permissions.push(result),this._remoteData.shared=!0,this._isShared(!0)),cb(!!result)}.bind(this),failureCB=function(result){cb(!1)};g.vmMain.remoteAPI().drivePermissionsInsert(this.id,addr,successCB,failureCB)},deletePermission:function deletePermissionFn(permissionID,cb){try{g.PAssert(3163,this._remoteData,"Must have valid remote data to remove permissions")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3164,this.id,"Must specify a valid document ID to operate on")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3165,permissionID,"Must specify a valid permissionID to remove")}catch(PERR){g.reportError(PERR)}var successCB=function(result){for(var j=0;j<this._remoteData.permissions.length;++j)if(this._remoteData.permissions[j].id===permissionID){this._remoteData.permissions.removeAt(j);break}1===this._remoteData.permissions.length&&(this._remoteData.shared=!1,this._isShared(!1)),cb(!0)}.bind(this),failureCB=function(result){cb(!1)};g.vmMain.remoteAPI().drivePermissionsDelete(this.id,permissionID,successCB,failureCB),this.getDocumentFolder(function(folderID){var folderSuccessCB=function(result){},folderFailureCB=function(result){};g.vmMain.remoteAPI().drivePermissionsDelete(folderID,permissionID,folderSuccessCB,folderFailureCB)})},listPermissions:function listPermissionsFn(cb){try{g.PAssert(3166,this._remoteData,"Must have valid remote data to list permissions")}catch(PERR){g.reportError(PERR)}var successCB=function(result){cb(result.items)},failureCB=function(result){cb(void 0)};g.vmMain.remoteAPI().drivePermissionsList(this.id,successCB,failureCB)},getDocumentFolder:function getDocumentFolderFn(cb){try{g.PAssert(3167,!g.isDemoMode(),"Should not be creating file structure in demo mode")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3168,cb,"Must provide a valid callback when getting the doc folder")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3169,this.id,"Must have a valid id")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3170,this.getTitle(),"Must have a valid doc title")}catch(PERR){g.reportError(PERR)}if(this._docFolderID)return cb(this._docFolderID);var folderID;g.loadGoogleAPI("drive","v2",function(){var createDocFolder=function(){this.createDocumentFileStructure(function(newFolderID){return newFolderID?(this._docFolderID=newFolderID,cb(newFolderID)):cb(folderID)})}.bind(this);if(folderID)try{var successCB=function(result){return result?(this._docFolderID=folderID,this.updateDocumentFolderProps(result),cb(folderID)):void createDocFolder()}.bind(this),failureCB=function(result){return cb(folderID)};g.vmMain.remoteAPI().driveFilesGet(folderID,successCB,failureCB)}catch(err){return g.reportError(err),cb()}else{var docPropValue=goog.DocFolderPropertyPrefix+this.id;try{var q="properties has {key='"+goog.DocFolderProperty+"' and value='"+docPropValue+"' and visibility='PRIVATE'} and trashed=false",options={getAllPages:!0},successCB=function(results){if(0!==results.length){try{g.PAssert(3171,1===results.length,"Must have only a single document folder")}catch(PERR){g.reportError(PERR)}var docFolderInfo=results[0];return this._docFolderID=docFolderInfo.id,this.updateDocumentFolderProps(docFolderInfo),cb(docFolderInfo.id)}createDocFolder()}.bind(this),failureCB=function(response){return cb()};g.vmMain.remoteAPI().driveFilesList(q,successCB,failureCB,options)}catch(err){return g.reportError(err),cb()}}}.bind(this))},updateDocumentFolderProps:function updateDocumentFolderPropsFn(docFolderInfo){try{g.PAssert(3172,docFolderInfo,"Must provide valid doc folder info")}catch(PERR){g.reportError(PERR)}if(this.getTitle()){var needTitleUpdate=!1,needTitleInsert=!1;if(docFolderInfo.properties){for(var i=0;i<docFolderInfo.properties.length;++i)if(docFolderInfo.properties[i].key===goog.DocFolderTitleProperty){docFolderInfo.properties[i].value!==this.getTitle()&&(needTitleUpdate=!0);break}}else needTitleInsert=!0;if(needTitleInsert){var successCB=function(){},failureCB=function(response){g.reportError(new Error("Unable to update drive folder title property"))};g.vmMain.remoteAPI().drivePropertiesInsert(docFolderInfo.id,goog.DocFolderTitleProperty,this.getTitle(),successCB,failureCB)}else if(needTitleUpdate){var successCB=function(){},failureCB=function(response){g.reportError(new Error("Unable to update drive folder title property"))};g.vmMain.remoteAPI().drivePropertiesUpdate(docFolderInfo.id,goog.DocFolderTitleProperty,this.getTitle(),successCB,failureCB)}}goog.getRootFolder(function(rootFolderID){if(rootFolderID){var hasRootFolderAsParent=!1;if(docFolderInfo.parents)for(var i=0;i<docFolderInfo.parents.length;++i)if(docFolderInfo.parents[i].id===rootFolderID){hasRootFolderAsParent=!0;break}if(!hasRootFolderAsParent){var successCB=function(){},failureCB=function(response){g.reportError(new Error("Unable to add shared doc folder to root folder"))};g.vmMain.remoteAPI().driveParentsInsert(docFolderInfo.id,rootFolderID,successCB,failureCB)}}}),this.hasDriveBacking()&&this.ensureFolderPermissions(docFolderInfo)},createDocumentFileStructure:function createDocumentFileStructureFn(cb){try{g.PAssert(3173,this.id,"In order to create a valid folder structure we must have a valid document ID")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3174,this.getTitle(),"Must provide a valid document title")}catch(PERR){g.reportError(PERR)}goog.getRootFolder(function(rootFolderID){if(!rootFolderID)return cb();var props=[{key:goog.DocFolderProperty,value:goog.DocFolderPropertyPrefix+this.id,visibility:"PRIVATE"}];this.getTitle()&&props.push({key:goog.DocFolderTitleProperty,value:this.getTitle(),visibility:"PRIVATE"});var requestFn=gapi.client.drive.files.insert,requestData={resource:{fields:"createdDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,userPermission(id,role,type)",mimeType:goog.FOLDER_MIMETYPE,title:goog.DocFolderTitlePrefix+this.id,writersCanShare:!1,parents:[{id:rootFolderID}],properties:props}},successCB=function(result){return this._docFolderID=result.id,this.hasDriveBacking()&&this.ensureFolderPermissions(result),cb(result.id)
}.bind(this),failureCB=function(result){return cb()};g.vmMain.remoteAPI().runRemoteSingleRequest(requestFn,requestData,successCB,failureCB)}.bind(this))},ensureFolderPermissions:function ensureFolderPermissionsFn(folderInfo){function folderHasPermission(email){var hasPermission=!1;if(folderPermissionList)for(var i=0;i<folderPermissionList.length;++i)if(folderPermissionList[i].emailAddress===email){hasPermission=!0;break}return hasPermission}try{g.PAssert(3175,this._remoteData,"Must have valid remote data to take permissions from")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3176,folderInfo,"Must supply a valid folder ID to set permissions on")}catch(PERR){g.reportError(PERR)}var successCB=function(result){},failureCB=function(result){},folderPermissionList=folderInfo.permissions,docPermissionList=this._remoteData.permissions;try{g.PAssert(3177,docPermissionList,"Must always have a valid list of permissions for this doc")}catch(PERR){g.reportError(PERR)}if(docPermissionList)for(var i=0;i<docPermissionList.length;++i){var email=docPermissionList[i].emailAddress;try{g.PAssert(3178,email,"Each permission must have a valid email address associated with it")}catch(PERR){g.reportError(PERR)}email&&"owner"!==docPermissionList[i].role&&(folderHasPermission(email)||g.vmMain.remoteAPI().drivePermissionsInsert(folderInfo.id,email,successCB,failureCB))}},rename:function renameFn(newTitle,cb){if(this._remoteData||this.getTitle()){try{g.PAssert(3179,newTitle,"Must specify a valid title to rename to")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3180,g.isFunction(cb),"Must supply a valid callback fn")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3181,this.getTitle(),"Must have a valid title set already")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3182,this.getTitle()!==newTitle,"Should always be setting to a different title")}catch(PERR){g.reportError(PERR)}var requestFn=gapi.client.drive.files.patch,requestData={fileId:this.id,resource:{title:newTitle}},successCB=function(result){this.getDocumentFolder(function(folderID){var folderSuccessCB=function(result){},folderFailureCB=function(result){g.reportError(new Error("Unable to update drive folder title property"))};g.vmMain.remoteAPI().drivePropertiesUpdate(folderID,goog.DocFolderTitleProperty,newTitle,folderSuccessCB,folderFailureCB)}.bind(this)),this._title(newTitle),this._remoteData.title=newTitle,log("File renamed to:"+newTitle),cb(!0)}.bind(this),failureCB=function(result){cb(!1)};g.vmMain.remoteAPI().runRemoteSingleRequest(requestFn,requestData,successCB,failureCB)}else this._title(newTitle),cb(!0)},shareFile:function shareFileFn(fileID,cb){try{g.PAssert(3183,fileID,"Must specify a valid fileID to share")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3184,cb,"Must specify a valid callback for sharing")}catch(PERR){g.reportError(PERR)}this.getDocumentFolder(function(folderID){var successCB=function(result){cb(!0,result)},failureCB=function(result){cb(!1,result)};g.vmMain.remoteAPI().driveParentsInsert(fileID,folderID,successCB,failureCB)})},unshareFile:function unshareFileFn(fileID,cb){try{g.PAssert(3185,fileID,"Must specify a valid fileID to unshare")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3186,cb,"Must specify a valid callback for unsharing")}catch(PERR){g.reportError(PERR)}this.getDocumentFolder(function(folderID){var successCB=function(result){cb(!0)},failureCB=function(result){cb(!1)};g.vmMain.remoteAPI().driveParentsDelete(fileID,folderID,successCB,failureCB)})},deleteData:function deleteDataFn(cb){var delsExpected=0,errorInDelete=!1,delSuccessCB=function(){delsExpected--,checkDelCompleted()},delFailureCB=function(){errorInDelete=!0,delsExpected--,checkDelCompleted()},checkDelCompleted=function(){0!==delsExpected||errorInDelete||this.getDocumentFolder(function(folderID){var folderSuccessCB=function(){this._docFolderID=void 0},folderFailureCB=function(){};g.vmMain.remoteAPI().driveFilesTrash(folderID,folderSuccessCB,folderFailureCB)})}.bind(this),successCB=function(result){this.getDocumentFolder(function(folderID){var options={getAllPages:!0,maxPageResults:500},listSuccessCB=function(result){for(var i=0;i<result.length;++i){var delRequestFn=gapi.client.drive.children.delete,delRequestData={folderId:folderID,childId:result[i].id};delsExpected++,g.vmMain.remoteAPI().runRemoteSingleRequest(delRequestFn,delRequestData,delSuccessCB,delFailureCB)}},listFailureCB=function(result){};g.vmMain.remoteAPI().driveChildrenList(folderID,listSuccessCB,listFailureCB,options)}),this._isDeleted=!0,this._remoteData&&(this._remoteData.trashed=!0),cb(!0)}.bind(this),failureCB=function(result){cb(!1)};g.vmMain.remoteAPI().driveFilesTrash(this.id,successCB,failureCB)},isShared:function isSharedFn(){return this._isShared()},isOwned:function isOwnedFn(){return this._isOwned()},open:function openFn(){try{g.PAssert(3187,!this._isOpen(),"Document must be closed to be opened")}catch(PERR){g.reportError(PERR)}this._isOpen(!0),g.vmMain.docManager.setDocOpened(this.id)},close:function closeFn(){try{g.PAssert(3188,this._isOpen(),"Document must be opened to be closed")}catch(PERR){g.reportError(PERR)}this._isOpen(!1),g.vmMain.docManager.setDocClosed(this.id)},isOpen:function isOpenFn(){return this._isOpen()},getTitle:function getTitleFn(){return this._title()},getData:function getDataFn(){return this._remoteData}},VMDocument}),define("ModalBase",["ko","globals","util"],function(ko,g,util){function ModalBase(id){try{g.PAssert(3189,id,"Must supply each modal with a valid ID")}catch(PERR){g.reportError(PERR)}this.id=id,this.isRegistered=!1,this.isVisible=ko.observable(!1),this.openFn=void 0,this.closeFn=void 0}return ModalBase.prototype={registerModal:function registerModalFn(openFn,closeFn){try{g.PAssert(3190,!openFn||g.isFunction(openFn),"May only supply a function as an open callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3191,!closeFn||g.isFunction(closeFn),"May only supply a function as an open callback")}catch(PERR){g.reportError(PERR)}this.openFn=openFn,this.closeFn=closeFn,this.isRegistered=!0,g.menus.registerModal(this.id,this)},openModal:function openModalFn(){setTimeout(function(){this.isVisible(!0)}.bind(this),0),this.openFn&&this.openFn.apply(this,arguments)},closeModal:function closeModalFn(){this.isVisible(!1),this.closeFn&&this.closeFn.apply(this,arguments)},close:function closeFn(){g.menus.closeModal(this.id,!0)}},util.defineBase(ModalBase),ModalBase}),define("ModalConfirm",["ko","globals","util","platform","ModalBase"],function(ko,g,util,platform,ModalBase){function ModalConfirm(){this._super.constructor.call(this,Modals.Confirm),this.activeCallback=void 0,this.activeText=ko.observable(""),this.init()}var ModalConfirmFns={init:function initFn(){this.registerModal(void 0,this.onClose.bind(this))},openDialog:function openDialogFn(text,cb){try{g.PAssert(3192,text,"Must have valid text to display")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3193,cb,"Must supply a valid callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3194,!this.activeCallback,"Must not already have an active callback")}catch(PERR){g.reportError(PERR)}this.activeText(text),this.activeCallback=cb,g.menus.openModal(this.id)},closeNo:function closeNoFn(){this.close(!1)},closeYes:function closeYesFn(){this.close(!0)},close:function closeFn(val){try{g.PAssert(3195,this.activeCallback,"Must have an active callback")}catch(PERR){g.reportError(PERR)}var cb=this.activeCallback;g.menus.closeModal(this.id),cb(val),this.clearModalData()},onClose:function onCloseFn(){this.clearModalData()},clearModalData:function clearModalDataFn(){this.activeCallback=void 0,this.activeText("")}};return util.inherit(ModalBase,ModalConfirm),util.extend(ModalConfirm.prototype,ModalConfirmFns),ModalConfirm}),define("ModalAlert",["ko","globals","util","platform","ModalBase"],function(ko,g,util,platform,ModalBase){function ModalAlert(){this._super.constructor.call(this,Modals.Alert),this.activeCallback=void 0,this.activeDescriptionText=ko.observable(""),this.activeActionText=ko.observable(""),this.isBig=ko.observable(!1),this.init()}var ModalAlertFns={init:function initFn(){this.registerModal()},openDialog:function openDialogFn(params){this.activeCallback=params.action,this.activeDescriptionText(params.text),this.activeActionText(params.actionText),this.isBig(params.big),g.menus.openModal(this.id)},onTapAlertClose:function onTapAlertCloseFn(){g.menus.closeModal(this.id),this.activeCallback&&this.activeCallback(),this.clearModalData()},clearModalData:function clearModalDataFn(){this.activeCallback=void 0,this.activeDescriptionText(""),this.activeActionText(""),this.isBig(!1)}};return util.inherit(ModalBase,ModalAlert),util.extend(ModalAlert.prototype,ModalAlertFns),ModalAlert}),define("ModalSettings",["ko","globals","data","util","platform","goog","tracker","ModalBase"],function(ko,g,d,util,platform,goog,tracker,ModalBase){function ModalSettings(){this._super.constructor.call(this,Modals.Settings),this.billingManager=g.billingManager,g.modalSettings=this,this.sectionOpened=ko.observable(SettingsSections.Plugins),this._pluginsEnabled={},this.pluginsAvailable=[PluginID.Drive],this._pluginOptions={},this.isAllDayTimeValid=ko.observable(!0),this.isRefreshingContacts=ko.observable(!1),this.numContacts=ko.observable(),this.init()}window.SettingsSections={Plugins:"plugins",Account:"account",Early:"early"};var ModalSettingsFns={init:function initFn(){this.registerModal(this.onModalOpen.bind(this),this.onModalClose.bind(this)),this.sectionOpened.subscribe(this.onSectionOpened.bind(this))},addSetting:function addSettingFn(name,value){this[name]=ko.observable(value),this[name].subscribe(g.curry(this.save.bind(this),name))},isOpen:function isOpenFn(section){return this.sectionOpened()===section},isPluginEnabled:function isPluginEnabledFn(id){return this._pluginsEnabled[id]},getPluginOption:function getPluginOptionFn(id,option){return this._pluginOptions[id][option]},isPluginAnOption:function isPluginAnOptionFn(id){return id===PluginID.Mailbird?platform.embed===EmbedApps.Mailbird:this.pluginsAvailable.indexOf(id)>=0},hasPremiumFeatures:function hasPremiumFeaturesFn(){return g.billingManager.hasPremiumFeatures()},hasEarlyAccess:function hasEarlyAccessFn(){return g.billingManager.hasEarlyAccess()},_updatePluginStatus:function _updatePluginStatusFn(pluginID,status){this._pluginsEnabled[pluginID]?this._pluginsEnabled[pluginID](status):this._pluginsEnabled[pluginID]=ko.observable(status)},_updatePluginOptionStatus:function _updatePluginOptionStatusFn(pluginID,option){this._pluginOptions[pluginID]||(this._pluginOptions[pluginID]={});var status=g.vmMain.pluginManager.getSetting(pluginID,option);this._pluginOptions[pluginID][option]?this._pluginOptions[pluginID][option](status):this._pluginOptions[pluginID][option]=ko.observable(status)},onModalOpen:function onModalOpenFn(section){section&&this.sectionOpened(section),this._updatePluginStatus(PluginID.Contacts,g.settings.get(Settings.syncContacts)),this.numContacts(d.contactManager.numContacts());for(var i=0;i<this.pluginsAvailable.length;i++){var pluginID=this.pluginsAvailable[i],authed=g.vmMain.pluginManager.isAuthorized(pluginID);this._updatePluginStatus(pluginID,authed)}this._updatePluginOptionStatus(PluginID.Drive,"writeAccess"),this._updatePluginOptionStatus(PluginID.GCalendar,"writeAccess")},onModalClose:function onModalCloseFn(){},save:function saveFn(e1,e2){log(e1,"changed to to",e2)},onSectionOpened:function onSectionOpenedFn(section){section===SettingsSections.Account&&this.billingManager.initUI()},onTapSection:function onTapSectionFn(e){var id=e.target.id;if(id){id=id.replace("btn-settings-","");try{g.PAssert(3196,id,"Must have a valid section defined",id)}catch(PERR){g.reportError(PERR)}id&&this.sectionOpened(id)}},onFailedAuthenticate:function onFailedAuthenticateFn(name){g.messageQueue.pushMessage({text:"We failure to successfully authenticate you for "+name+", please try again.",actionText:"OKAY"})},togglePlugin:function togglePluginFn(name){var enabled=!this._pluginsEnabled[name]();name===PluginID.Contacts?enabled?this.enableSyncContacts():(g.sendEvent("Settings","DisableContacts"),goog.loadedContacts=!1,g.settings.set(Settings.syncContacts,!1),d.clearContacts(),this._pluginsEnabled[name](!1)):enabled?g.vmMain.pluginManager.authorizePlugin(name,function(success){success?(this._pluginsEnabled[name](!0),g.sendEvent(name,"PluginEnabled")):(this.onFailedAuthenticate(name),g.sendEvent(name,"PluginEnableFailed"))}.bind(this)):g.vmMain.pluginManager.deauthorizePlugin(name,function(){this._pluginsEnabled[name](!1),g.sendEvent(name,"PluginDisabled")}.bind(this))},togglePluginOption:function togglePluginOptionFn(pluginID,name){var enabled=!this._pluginOptions[pluginID][name]();g.vmMain.pluginManager.setSetting(pluginID,name,enabled),enabled?g.vmMain.pluginManager.authorizePlugin(pluginID,function(success){success?(g.vmMain.pluginManager.onAuthorizedSetting(pluginID,name,enabled),this._pluginOptions[pluginID][name](!0),g.sendEvent(pluginID,"OptionEnabled_"+name)):(this.onFailedAuthenticate(name),g.vmMain.pluginManager.setSetting(pluginID,name,!enabled),g.sendEvent(pluginID,"OptionEnableFailed_"+name))}.bind(this)):(this._pluginOptions[pluginID][name](!1),g.sendEvent(pluginID,"OptionDisabled_"+name))},onTapAccount:function onTapAccountFn(){g.modalSettings.sectionOpened(SettingsSections.Account)},onTapEarlyAccess:function onTapEarlyAccessFn(){g.modalSettings.sectionOpened(SettingsSections.Early)},toggleContacts:function toggleContactsFn(e){this.togglePlugin(PluginID.Contacts)},enableSyncContacts:function enableSyncContactsFn(handler){function handleContactsLoaded(numContacts){0>numContacts?(g.messageQueue.pushMessage({text:"There was an error syncing your contacts. Please try again.",actionText:"SYNC",action:function actionFn(){this.enableSyncContacts(handler)}.bind(this)}),handler&&handler(!1)):numContacts>0&&(g.vmMain.parseSubtree(g.vmMain.root(),ChangeType.Auto),handler&&handler(!0)),this.numContacts(d.contactManager.numContacts())}g.sendEvent("Settings","EnableContacts"),goog.runAuthenticate([GScope.Contacts],!1,!1,function(token){token&&!token.error?(g.settings.set(Settings.syncContacts,!0),goog.loadContacts(handleContactsLoaded.bind(this)),tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SyncContacts,data:[{value:!0}]}),this._pluginsEnabled[PluginID.Contacts](!0),g.settings.set(Settings.syncContacts,!0)):(this._pluginsEnabled[PluginID.Contacts](!1),g.settings.set(Settings.syncContacts,!1),g.messageQueue.pushMessage({text:"To sync your contacts we need permission to access them. Please try again.",actionText:"SYNC",action:function actionFn(){this.enableSyncContacts(handler)}.bind(this)}),handler&&handler(!1))}.bind(this))},onTapRefreshContacts:function onTapRefreshContactsFn(){this.isRefreshingContacts()||(this.isRefreshingContacts(!0),d.clearLocalContacts(),goog.loadedContacts=!1,goog.authAndLoadContacts(!0,function(success){this.numContacts(d.contactManager.numContacts()),setTimeout(function(){this.isRefreshingContacts(!1)}.bind(this),1e3)}.bind(this)),g.sendEvent("Menu","RefreshContacts"))},textContacts:function textContactsFn(){return this.numContacts()+" contacts loaded"},toggleDrive:function toggleDriveFn(e){this.togglePlugin(PluginID.Drive)},toggleSharedDrive:function toggleSharedDriveFn(e){this.togglePluginOption(PluginID.Drive,"writeAccess")},toggleGmail:function toggleGmailFn(e){this.togglePlugin(PluginID.Gmail)},toggleGCalendar:function toggleGCalendarFn(e){this.togglePlugin(PluginID.GCalendar)},toggleWritableCalendar:function toggleWritableCalendarFn(e){this.togglePluginOption(PluginID.GCalendar,"writeAccess")},isPremiumEnabled:function isPremiumEnabledFn(){return!g.isDemoMode()&&g.billingManager.isPremiumEnabled()},onAllDayTimeValid:function onAllDayTimeValidFn(value){this.isAllDayTimeValid(value),value&&this.datesAllDayTime(g.element("settings-allday").value)}};return util.inherit(ModalBase,ModalSettings),util.extend(ModalSettings.prototype,ModalSettingsFns),ModalSettings}),define("ModalBilling",["ko","globals","util","platform","ModalBase"],function(ko,g,util,platform,ModalBase){function ModalBilling(){this._super.constructor.call(this,Modals.Billing),this._braintreeRequested=!1,this._braintreeLoaded=!1,this._clientTokenRequested=!1,this._clientTokenLoaded=!1,this._clientToken=void 0,this._btClient=void 0,this._pricingSelected=Pricing.Monthly,this.isSubmitting=ko.observable(),this.isLoading=ko.observable(!0),this._billingFailureCode=ko.observable(BillingFailureCode.None),this._signupFailureCode=ko.observable(SignupFailureCode.None),this.init()}var Pricing={None:-1,Monthly:0,Yearly:1},BillingFailureCode={None:0,NoBraintreeGlobal:1,AddScriptFailure:2,NoRemoteToken:3,RemoteTokenParse:4,ContactingServer:5,NoClientIdentifier:6},SignupFailureCode={None:0,MissingNonce:1,MissingPlanID:2,ServerFailure:3,UnauthorizedUser:4,InvalidParameter:5,MissingParameter:6,BraintreeUnknown:7},premiumPlans=["2m4b","gjgm"],ModalBillingFns={init:function initFn(){this.registerModal(this.onModalOpen.bind(this),this.onModalClose.bind(this))},onModalOpen:function onModalOpenFn(){this._billingFailureCode(BillingFailureCode.None),this._signupFailureCode(SignupFailureCode.None),this._ensureBraintreeLib(),this._ensureClientToken()},onModalClose:function onModalCloseFn(){},onTapClose:function onTapCloseFn(){g.menus.closeModal(this.id)},hasBillingError:function hasBillingErrorFn(){return this._billingFailureCode()!==BillingFailureCode.None},getBillingErrorMessage:function getBillingErrorMessageFn(){return"There was an error loading our payment system. Please contact support@moo.do with code "+this._billingFailureCode()+" or try again in a few minutes."},hasSignupError:function hasSignupErrorFn(){return this._signupFailureCode()!==SignupFailureCode.None},getSignupErrorMessage:function getSignupErrorMessageFn(){return"There was an error processing your payment. Please check your billing information or contact support@moo.do with code "+this._signupFailureCode()+"."},_notifyDependencyLoaded:function _notifyDependencyLoadedFn(){this._braintreeLoaded&&this._clientTokenLoaded&&(this._btClient=new braintree.api.Client({clientToken:this._clientToken}),braintree.setup(this._clientToken,"dropin",{container:"braintreeDropin",onPaymentMethodReceived:function onPaymentMethodReceivedFn(obj){obj&&obj.nonce?this._processPaymentNonce(void 0,obj.nonce):this._processPaymentNonce({error:!0},void 0)}.bind(this),onError:function onErrorFn(err){g.reportError(err)},onReady:function onReadyFn(){this.isLoading(!1)}.bind(this)}))},_notifyDependencyLoadError:function _notifyDependencyLoadErrorFn(code){this._billingFailureCode(code),g.reportError(new Error("Client hit error in billing: "+code)),g.billingManager.setLastSignupError(code),g.sendEvent("Billing","SignupError_"+code)},_ensureBraintreeLib:function _ensureBraintreeLibFn(){this._braintreeRequested||(this._braintreeRequested=!0,g.addScriptHack("https://js.braintreegateway.com/v2/braintree.js","braintreeScript",function(){window.braintree?(this._braintreeLoaded=!0,this._notifyDependencyLoaded()):(this._braintreeRequested=!1,this._notifyDependencyLoadError(BillingFailureCode.NoBraintreeGlobal))}.bind(this),function(){this._braintreeRequested=!1,this._notifyDependencyLoadError(BillingFailureCode.AddScriptFailure)}.bind(this)))},_ensureClientToken:function _ensureClientTokenFn(){var clientId=g.billingManager.getBillingIdentifier();clientId?this._clientTokenRequested||(this._clientTokenRequested=!0,g.XHR_PrivateAPI({type:"POST",path:"/billing/getToken",data:{email:clientId},requireAuth:!0,autoRetry:!0,maxRetries:1,cb:function cbFn(xhr){if(200===xhr.status){this._clientTokenLoaded=!0;try{var response=JSON.parse(xhr.responseText).data;response&&response.token?(this._clientToken=response.token,this._notifyDependencyLoaded()):this._notifyDependencyLoadError(BillingFailureCode.NoRemoteToken)}catch(err){g.reportError(err),this._notifyDependencyLoadError(BillingFailureCode.RemoteTokenParse)}}else this._clientTokenRequested=!1,this._notifyDependencyLoadError(BillingFailureCode.ContactingServer)}.bind(this)})):this._notifyDependencyLoadError(BillingFailureCode.NoClientIdentifier)},_processPaymentNonce:function _processPaymentNonceFn(err,nonce){if(g.sendEvent("Billing","PremiumSignup"),!err&&nonce){this._signupFailureCode(SignupFailureCode.None);var planID=premiumPlans[this._pricingSelected];try{g.PAssert(3197,planID,"Must have selected a valid plan to signup")}catch(PERR){g.reportError(PERR)}planID?this.isSubmitting()||(this.isSubmitting(!0),g.XHR_PrivateAPI({type:"POST",path:"/billing/signup",data:{email:g.billingManager.getBillingIdentifier(),nonce:nonce,planID:planID},requireAuth:!0,cb:function cbFn(xhr){if(this.isSubmitting(!1),200===xhr.status)g.billingManager.setPremiumStatus(PremiumStatus.Active),g.menus.isModalOpen(this.id)&&this.onTapClose(),g.menus.alert({text:"Thank you for signing up for <b>Moo.do</b> premium!",actionText:"OKAY"}),g.sendEvent("Billing","PremiumSignupSUCCESS");else{if(xhr.response)try{var statusData=JSON.parse(xhr.response);switch(statusData.code){case PrivateAPIErrorCodes.UnauthorizedUser:this._signupFailureCode(SignupFailureCode.UnauthorizedUser);break;case PrivateAPIErrorCodes.InvalidParameter:this._signupFailureCode(SignupFailureCode.InvalidParameter);break;case PrivateAPIErrorCodes.MissingParameter:this._signupFailureCode(SignupFailureCode.MissingParameter);break;case PrivateAPIErrorCodes.BraintreeUnknown:this._signupFailureCode(SignupFailureCode.BraintreeUnknown);break;default:this._signupFailureCode(SignupFailureCode.ServerFailure)}}catch(parseErr){g.reportError(parseErr),this._signupFailureCode(SignupFailureCode.ServerFailure)}else this._signupFailureCode(SignupFailureCode.ServerFailure);g.sendEvent("Billing","PremiumSignupFAILURE")}}.bind(this)})):(this._signupFailureCode(SignupFailureCode.MissingPlanID),g.sendEvent("Billing","PremiumSignupFAILURE"))}else this._signupFailureCode(SignupFailureCode.MissingNonce),g.sendEvent("Billing","PremiumSignupFAILURE")}};return util.inherit(ModalBase,ModalBilling),util.extend(ModalBilling.prototype,ModalBillingFns),ModalBilling}),define("ModalDeleteAccount",["ko","globals","util","platform","ModalBase"],function(ko,g,util,platform,ModalBase){function ModalDeleteAccount(){this._super.constructor.call(this,Modals.DeleteAccount),this.activeCallback=void 0,this.deleteReason=ko.observable(),this.init()}var ModalDeleteAccountFns={init:function initFn(){this.registerModal(this.onOpen)},onOpen:function onOpenFn(cb){this.activeCallback=cb},_close:function _closeFn(value){g.menus.closeModal(this.id),this.activeCallback&&this.activeCallback(value),this.clearModalData()},onTapDelete:function onTapDeleteFn(){var desc=this.deleteReason()||g.element("deleteReason").value;if(desc&&desc.length>0){var name="Account Deleted";g.sendFeedback(name,desc,function(){this.deleteReason("")}.bind(this))}this._close(!0)},onTapCancel:function onTapCancelFn(){this._close(!1)},clearModalData:function clearModalDataFn(){this.activeCallback=void 0}};return util.inherit(ModalBase,ModalDeleteAccount),util.extend(ModalDeleteAccount.prototype,ModalDeleteAccountFns),ModalDeleteAccount}),define("VMMenus",["ko","globals","data","gdata","edit","VMLI","tracker","platform","VMDocument","ModalBase","ModalConfirm","ModalAlert","ModalSettings","ModalBilling","PaneFactory","ModalDeleteAccount","Sel"],function(ko,g,d,gdata,edit,VMLI,tracker,platform,VMDocument,ModalBase,ModalConfirm,ModalAlert,ModalSettings,ModalBilling,PaneFactory,ModalDeleteAccount,Sel){function VMMenus(){try{g.PAssert(3198,!g.menus,"Should only have a single instance of VMMenus")}catch(PERR){g.reportError(PERR)}g.menus=this,this.linkAddress=ko.observable(),this.rightMenuThresh=8,this.rightMenuWidth=55,this.rightItemMenuWidth=55,this.phoneLastTop=0,this.rightMenuPhone=void 0,this.itemIsHeader=ko.observable(!1),this.itemHasChildren=ko.observable(!1),this.itemIsCollapsed=ko.observable(!1),this.itemIsArchived=ko.observable(!1),this.itemIsComplete=ko.observable(!1),this.itemCanIndent=ko.observable(!1),this.itemCanUnindent=ko.observable(!1),this.itemCanZoom=ko.observable(!1),this.itemCanAddNote=ko.observable(!1),this.itemCanArchive=ko.observable(!1),this.mobileExternalAppText=ko.observable(""),this.mobileExternalAppTap=void 0,this.contextBottomOpen=void 0,this._openedContextMenu=ko.observable(void 0),this.isModalVisible=ko.observable(!1),this.menusBound=!1,this.billingManager=g.billingManager,this._registeredModals={},this._openModals=[],this.main=function(){return g.vmMain},this.init()}return VMMenus.prototype={init:function initFn(){window.addEventListener("closeKeyboard",this.onCloseKeyboard.bind(this)),g.addCustomEventListener("keyEscape",this.onEscapeKey.bind(this),100),platform.mobile||this.isModalVisible.subscribe(function(newValue){requestAnimationFrame(newValue?function(){requestAnimationFrame(function(){g.addClass(g.element("main"),"modalOpen"),g.addClass(g.element("desktopMenu"),"modalOpen")})}:function(){g.removeClass(g.element("main"),"modalOpen"),g.removeClass(g.element("desktopMenu"),"modalOpen")})}),g.applyBindings(this,"modals"),this.modalConfirm=new ModalConfirm,this.modalAlert=new ModalAlert,new ModalSettings,new ModalBilling,new ModalDeleteAccount},vmPicker:function vmPickerFn(){return g.vmMain.vmPicker},bind:function bindFn(){this.menusBound||(this.menusBound=!0,g.applyBindings(this,"contextMenus"),platform.mobile&&(this.rightMenuPhone=g.element("rightMenuPhone"),this.rightMenuPhoneItems=g.element("rightMenuPhoneItems"),g.applyBindings(this,"rightMenuPhoneItems")))},onEscapeKey:function onEscapeKeyFn(){return this.closeAllMenus(),this.isModalVisible()?this._closeModalInternal(!1):void 0},selectionHasChildren:function selectionHasChildrenFn(){for(var i=0;i<g.vmMain.selected().length;i++)if(g.vmMain.selected()[i].hasChildren())return!0;return!1},selectionIsHeader:function selectionIsHeaderFn(){return 1===g.vmMain.selected().length&&g.vmMain.selected()[0].isHeader()},openLinkMenu:function openLinkMenuFn(target,address,left,top){this.linkAddress(address),g.menuOnItem=target;var menuLink=document.getElementById("contextMenuLink");menuLink.style.left=left+"px",menuLink.style.top=top+"px",menuLink.style.display="block",g.vmMain.handleFullscreenClick()},closeLinkMenu:function closeLinkMenuFn(){g.menuOnItem=void 0,this.linkAddress("");var menuLink=document.getElementById("contextMenuLink");menuLink.style.display="none",g.vmMain.cancelFullscreenClick()},onTapLink:{onClick:function onClickFn(){this.closeLinkMenu()}},closeAllMenus:function closeAllMenusFn(){this.closeLinkMenu(),this.closeContextMenu(),this.closeAddPaneMenu(),this.closeOptionsMenu(),this.closeDocumentsMenu(),this.closeHeartMenu(),this.closeItemMenu()},setupItemMenu:function setupItemMenuFn(){g.element("menuGoto").style.display=g.focusedPane.isSearched()?"block":"none"},onTapHover:{onStart:function onStartFn(e){e.preventDefault()},onClick:function onClickFn(e){var id=e.srcElement.id;g.sendEvent("Menu",id)}},revealGestureMenu:function revealGestureMenuFn(item){try{g.PAssert(3200,g.revealingMenu===!1,"Must not have already started a gesture")}catch(PERR){g.reportError(PERR)}g.revealingMenu=!0,this.startedInMultiSelectMode=g.phoneMenu.multiSelectMode(),g.menuOnItem=item;var height=40,top=g.focusedPane.topOfItem(item)-g.topBarHeight,spanHeight=item.heightInPane(g.focusedPane)+8;top+=(spanHeight-height)/2,this.phoneLastTop!==top&&(this.phoneLastTop=top),this.startedInMultiSelectMode||(g.setTransformStyle(this.rightMenuPhone,0,0),g.addClass(this.rightMenuPhone,"open")),g.closeKeyboard()},updateRevealGestureMenu:function updateRevealGestureMenuFn(e){try{g.PAssert(3201,g.revealingMenu===!0,"Must have already started a gesture to perform an update")}catch(PERR){g.reportError(PERR)}var xOffset=e.diffX;if(this.startedInMultiSelectMode){xOffset-=this.rightMenuWidth;var offset=g.clamp(xOffset,-this.rightMenuWidth,0);g.setTransformStyle(this.rightMenuPhone,offset,0)}else{var offset=g.clamp(xOffset,-this.rightMenuWidth,0);g.setTransformStyle(this.rightMenuPhone,offset,0),g.isKeyboardOpen||g.vmMain.setSelected([g.menuOnItem])}},stopRevealGestureMenu:function stopRevealGestureMenuFn(e){try{g.PAssert(3202,g.revealingMenu===!0,"Must have already started a gesture")}catch(PERR){g.reportError(PERR)}var xOffset=e.diffX;if(g.revealingMenu=!1,this.startedInMultiSelectMode){xOffset-=this.rightMenuWidth;var offset=g.clamp(xOffset,-this.rightMenuWidth,0);offset<=.6*-this.rightMenuWidth?g.setTransform(this.rightMenuPhone,-this.rightMenuWidth,0,200,"ease-out"):(this.closeMultiSelect(),g.vmMain.clearSelected(),g.removeClass(this.rightMenuPhone,"open"))}else xOffset<=.6*-this.rightMenuWidth?(g.setTransform(this.rightMenuPhone,-this.rightMenuWidth,0,200,"ease-out"),g.phoneMenu.multiSelectMode(!0),g.closeKeyboard(),g.vmMain.setSelected([g.menuOnItem])):(g.setTransform(this.rightMenuPhone,0,0,200,"ease-out"),g.isKeyboardOpen||g.vmMain.clearSelected(),g.removeClass(this.rightMenuPhone,"open"))},closeMultiSelect:function closeMultiSelectFn(){g.setTransform(this.rightMenuPhone,0,0,200,"ease-out"),g.phoneMenu.multiSelectMode(!1),g.vmMain.clearSelected()},onResize:function onResizeFn(){},onTapMenuPhone:{onStart:g.handlerPreventStop,onClick:function onClickFn(e){if(0!==g.vmMain.selected().length){var id=e.srcElement.id,fn,val;switch(id){case"phoneMenuComplete":fn="isComplete",val=!g.vmMain.getFirstSelectedItem().isComplete();break;case"phoneMenuStar":fn="isStarred",val=!g.vmMain.getFirstSelectedItem().isStarred();break;case"phoneMenuPriorityNone":fn="priority",val=VMLIFlag.None;break;case"phoneMenuPriorityHigh":fn="priority",val=g.vmMain.getFirstSelectedItem().priority()===VMLIFlag.P0?VMLIFlag.None:VMLIFlag.P0;break;case"phoneMenuPriorityMed":fn="priority",val=g.vmMain.getFirstSelectedItem().priority()===VMLIFlag.P1?VMLIFlag.None:VMLIFlag.P1;break;case"phoneMenuPriorityLow":fn="priority",val=g.vmMain.getFirstSelectedItem().priority()===VMLIFlag.P2?VMLIFlag.None:VMLIFlag.P2;break;case"phoneMenuZoom":g.vmMain.zoomin(g.vmMain.getFirstSelectedItem()),this.closeMultiSelect();break;case"phoneMenuDelete":fn="deleteSelf"}if(fn){g.vmMain.beginUpdateItems();for(var selectedItems=g.vmMain.selected(),i=0;i<selectedItems.length;++i)selectedItems[i][fn](val);g.vmMain.commitUpdateItems()}"phoneMenuDelete"===id&&g.vmMain.clearSelected()}}},openDocumentsMenu:function openDocumentsMenuFn(){var menu=g.element("contextMenuDocuments");g.addClass(menu,"open"),this.isDocumentsOpen=!0,g.vmMain.vmPicker.refreshFiles(),g.vmMain.handleFullscreenClick()},closeDocumentsMenu:function closeDocumentsMenuFn(){var menu=g.element("contextMenuDocuments");g.removeClass(menu,"open"),this.isDocumentsOpen=!1,g.vmMain.cancelFullscreenClick()},openOptionsMenu:function openOptionsMenuFn(){var menu=g.element("contextMenuOptions");g.addClass(menu,"open"),this.isOptionsMenuOpen=!0,g.vmMain.handleFullscreenClick()},closeOptionsMenu:function closeOptionsMenuFn(){var menu=g.element("contextMenuOptions");g.removeClass(menu,"open"),this.isOptionsMenuOpen=!1,g.vmMain.cancelFullscreenClick()},openHeartMenu:function openHeartMenuFn(){var menu=g.element("contextMenuHeart");g.addClass(menu,"open"),g.vmMain.handleFullscreenClick()},closeHeartMenu:function closeHeartMenuFn(){var menu=g.element("contextMenuHeart");g.removeClass(menu,"open"),this.isOptionsMenuOpen=!1,g.vmMain.cancelFullscreenClick()},openAddPaneMenu:function openAddPaneMenuFn(){var menu=g.element("contextMenuAddPane");g.addClass(menu,"open"),this.isAddPaneOpen=!0,g.vmMain.handleFullscreenClick()},closeAddPaneMenu:function closeAddPaneMenuFn(){var menu=g.element("contextMenuAddPane");g.removeClass(menu,"open"),this.isAddPaneOpen=!1,g.vmMain.cancelFullscreenClick()},openContextMenu:function openContextMenuFn(pane,item,offset,toLeft){this.closeContextMenu();var menu=pane.setupContextMenu(item);this._openedContextMenu(menu),g.autocomplete&&g.autocomplete.hide();var styles={top:offset.top},menuWidth=g.width(menu);toLeft||offset.left+menuWidth>platform.windowWidth()&&(toLeft=!0),styles.left=toLeft?offset.left-menuWidth-2:offset.left+2;
var menuHeight=g.height(menu);offset.top+menuHeight>platform.windowHeight()&&(styles.top-=menuHeight),g.css(menu,styles),g.addClass(menu,"open");var windowBounds=document.documentElement.getBoundingClientRect(),rect=menu.getBoundingClientRect(),autoRect={left:rect.left,right:rect.right,top:rect.top,bottom:rect.bottom},origin=g.adjustOriginToBeInsideBounds(windowBounds,autoRect);(origin.x!==autoRect.left||origin.y!==autoRect.top)&&(menu.style.left=origin.x+"px",menu.style.top=origin.y+"px"),g.vmMain.handleFullscreenClick()},closeContextMenu:function closeContextMenuFn(){var menu=this._openedContextMenu();menu&&(g.removeClass(menu,"open"),this._openedContextMenu(void 0),g.vmMain.cancelFullscreenClick())},getModalForId:function getModalForIdFn(id){return this._registeredModals[id]},isModalBound:function isModalBoundFn(id){var element=document.getElementById(id);return g.dataFor(element.firstElementChild)!==this},isModalOpen:function isModalOpenFn(id){return this._openModals.indexOf(id)>=0},getTopModal:function getTopModalFn(){return this._openModals[this._openModals.length-1]},removeTopModal:function removeTopModalFn(){return this._openModals.pop()},addTopModal:function addTopModalFn(id){log(id),this._openModals.push(id)},isTopModal:function isTopModalFn(id){return this.getTopModal()===id},registerModal:function registerModalFn(id,modalObj){try{g.PAssert(3203,id,"Must have a valid modal id")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3204,modalObj,"Must have a valid modal object to bind to")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3205,!this._registeredModals[id],"Should only register a modal a single time: "+id)}catch(PERR){g.reportError(PERR)}try{g.PAssert(3206,modalObj instanceof ModalBase,"Can only register valid modals")}catch(PERR){g.reportError(PERR)}this._registeredModals[id]=modalObj},openModal:function openModalFn(id){try{g.PAssert(3207,this._registeredModals[id],"Must have registered the modal before opening it")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3208,!this.isModalOpen(id),"Must not have the same modal open multiple times: "+id)}catch(PERR){g.reportError(PERR)}if(!this.isModalOpen(id)){Sel.reset();var activeModal=this.getModalForId(id);activeModal.openModal.apply(activeModal,Array.prototype.slice.call(arguments,1)),this.isModalBound(id)||g.applyBindings(activeModal,id),this.addTopModal(id),this.isModalVisible(!0)}},closeModal:function closeModalFn(id){try{g.PAssert(3209,this._registeredModals[id],"Must have registered the modal before closing it")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3210,this.isModalOpen(id),"Modal must be open to be closed: "+id)}catch(PERR){g.reportError(PERR)}try{g.PAssert(3211,this.isTopModal(id),"Tried to close the wrong modal: "+id+", "+this.getTopModal())}catch(PERR){g.reportError(PERR)}arguments.length>1?this._closeModalInternal.apply(this,Array.prototype.slice.call(arguments,1)):this._closeModalInternal()},_closeModalInternal:function _closeModalInternalFn(){try{g.PAssert(3212,this._openModals.length>0,"Tried to close when no modal was open")}catch(PERR){g.reportError(PERR)}if(0!==this._openModals.length){var currentModal=this.getModalForId(this.removeTopModal());this.modalInputOn=void 0,0===this._openModals.length&&this.isModalVisible(!1),g.fireCustomEvent("closeKeyboard"),currentModal.closeModal.apply(currentModal,arguments)}},focusModalInputMobile:function focusModalInputMobileFn(e,element){try{g.PAssert(3213,platform.mobile,"Should not call this from non-mobile")}catch(PERR){g.reportError(PERR)}var currentModal=this.getModalForId(this.getTopModal());this.modalInputOn?this.modalInputOn!==element?(element.focus(),currentModal.onKeyboardOpened&&requestAnimationFrame(function(){currentModal.onKeyboardOpened(e)}.bind(this)),e.preventDefault(),e.stopPropagation(),g.enforceScroll()):g.enforceScroll():g.openKeyboardOnElement(e,element,function(){platform.app?(currentModal&&currentModal.onKeyboardOpened&&currentModal.onKeyboardOpened(e),requestAnimationFrame(function(){requestAnimationFrame(function(){element.focus(),g.enforceScroll()})})):element.focus()}.bind(this))},onTapModal:{onClick:function onClickFn(e){var prevent=!0;if("modals"===e.srcElement.id){var topModal=this.getTopModal();topModal&&this.closeModal(topModal),this.modalInputOn=void 0}else e.srcElement===this.modalInputOn?prevent=!1:g.isKeyboardInputElement(e.srcElement)||g.hasClass(e.srcElement,"input")?(platform.mobile&&(prevent=!1,this.focusModalInputMobile(e,e.srcElement)),this.modalInputOn=e.srcElement):this.modalInputOn=void 0;prevent&&platform.mobile&&(e.preventDefault(),e.stopPropagation())}},onCloseKeyboard:function onCloseKeyboardFn(){this.modalInputOn=void 0},openItemMenu:function openItemMenuFn(item,e){var pane=g.getPaneForElement(e.srcElement);this.openContextMenu(pane,item,{left:e.pageX,top:e.pageY},!1);var firstItem,foundZoomCandidate=!1,anyIncomplete=!1;g.vmMain.applyToSelection(function(item,index,total){try{g.PAssert(3214,item,"Item must be defined")}catch(PERR){g.reportError(PERR)}item&&0===index&&(firstItem=item,this.itemIsHeader(item.isHeader()),this.itemHasChildren(item.isHeader()||item.hasChildren()),this.itemIsCollapsed(item.isCollapsed(pane,!1)),this.itemIsArchived(item.isArchived()),this.itemCanIndent(!item.isNote()&&0!==item.getIndex()),this.itemCanUnindent(!item.isNote()&&item.parent()!==g.focusedItem),this.itemCanAddNote(!item.isNote()),this.itemCanArchive(!item.isNote())),item.isComplete()||(anyIncomplete=!0),foundZoomCandidate||(pane.isWriteable&&item.canZoom()||!pane.isWriteable&&(item.isHeader()||item.hasChildren()))&&(foundZoomCandidate=!0,this.itemCanZoom(!0)),foundZoomCandidate||index!==total-1||this.itemCanZoom(!1)}.bind(this),{passExtraInfo:!0}),this.itemIsComplete(!anyIncomplete)},closeItemMenu:function closeItemMenuFn(){this.closeContextMenu()},itemContextText:function itemContextTextFn(){return this.itemIsCollapsed()?"Expand":"Collapse"},itemArchivedText:function itemArchivedTextFn(){return this.itemIsArchived()?"Unarchive":"Archive"},itemCompleteText:function itemCompleteTextFn(){return this.itemIsComplete()?"Uncomplete":"Complete"},hotkeyText:function hotkeyTextFn(key){return platform.secModKey+" + "+key},onTapItemMenu:{onStart:g.handlerPreventStop,onClick:function onClickFn(e){var id=e.srcElement.id,close=!0;switch(id||(id=e.srcElement.parentNode.id),id){case"itemComplete":g.vmMain.applyFnToSelection("isComplete",{toggle:!0});break;case"itemStar":g.vmMain.applyFnToSelection("isStarred",{toggle:!0});break;case"itemIndent":g.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!1});break;case"itemUnindent":g.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!0});break;case"contextMenuPriority":break;case"itemPriorityNone":g.vmMain.applyPriorityToSelection(VMLIFlag.None);break;case"itemPriorityLow":g.vmMain.applyPriorityToSelection(VMLIFlag.P2);break;case"itemPriorityMed":g.vmMain.applyPriorityToSelection(VMLIFlag.P1);break;case"itemPriorityHigh":g.vmMain.applyPriorityToSelection(VMLIFlag.P0);break;case"itemAddNote":g.fireKeyEvent(void 0,{normCode:KeyCode.Enter,shiftKey:!0});break;case"itemCollapseDrive":case"itemCollapse":g.vmMain.applyToSelection(function(item){item.toggleCollapsed(g.focusedPane)},{resetSelection:!0});break;case"itemZoomDrive":case"itemZoom":g.vmMain.applyToSelection(function(item){return item.canZoom()?(g.vmMain.zoomin(item),!1):!0});break;case"itemCopy":break;case"itemPaste":break;case"itemUndo":break;case"itemRedo":break;case"itemArchive":var numChanged=0,selectItem;if(g.focusedPane.isWriteable&&g.vmMain.applyToSelection(function(item){selectItem||(selectItem=g.getPreviousItem(item,g.focusedPane)),this.itemIsArchived()?item.parent().unarchiveChild(item)&&numChanged++:item.parent().archiveChild(item)&&numChanged++}.bind(this),{resetSelection:!0}),numChanged>0){var z=numChanged>1?" items.":" item.",verb=this.itemIsArchived()?"Unarchived":"Archived";g.messageQueue.pushMessage({text:verb+" "+numChanged+z,action:MessageAction.Undo,hold:platform.mobile,timeout:platform.mobile?void 0:8e3})}break;case"itemDelete":var selectItem;if(g.focusedPane.isWriteable&&(g.vmMain.applyToSelection(function(item){selectItem||(selectItem=g.getPreviousItem(item,g.focusedPane)),item.deleteSelf()},{resetSelection:!0}),selectItem===g.focusedPane.getItem())){var first=g.focusedPane.getFirstItem();first&&(selectItem=first)}break;case"contextMenuItemDrive":case"contextMenuItem":close=!1;break;default:if(g.hasClass(e.srcElement,"hotkey"))close=!1;else try{g.PAssert(3215,!1,"Unknown context menu item: ",g.elementToString(e.srcElement))}catch(PERR){g.reportError(PERR)}}close&&(g.sendEvent("ContextMenu",id),this.closeItemMenu())}},onTapAddPaneMenu:{onStart:g.handlerPreventStop,onClick:function onClickFn(e){var paneInfo=g.dataFor(e.srcElement);if(paneInfo)if(paneInfo!==this){var newPane=g.vmMain.paneManager.createPaneAtIndex(paneInfo.type);newPane&&(tracker.performAction(TrackerType.UIAction,{type:TrackerUIAction.AddPane,data:newPane.id}),g.sendEvent("Menu","AddPane_"+paneInfo.type),this.closeAddPaneMenu())}else g.menus.openModal(Modals.Settings,SettingsSections.Plugins)}},onTapOptionsMenu:{onStart:g.handlerPreventStop,onClick:function onClickFn(e){var id=e.srcElement.id;id||(id=e.srcElement.parentNode.id),g.sendEvent("Menu",id);var mode;if("optionsSettings"===id)g.menus.openModal("settings"),tracker.performAction(TrackerType.UIAction,{type:TrackerUIAction.OpenSettingsMenu});else if("optionsHelp"===id)g.vmMain.showHelp(HelpMode.Normal);else if("optionsImport"===id)g.menus.openModal("importData"),tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenImport,data:[{value:!0}]});else if("optionsExport"===id)g.menus.openModal("exportData"),tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenExport,data:[{value:!0}]});else if("optionsRecover"===id)g.menus.openModal("recoverData");else if("optionsSendFeedback"===id)g.menus.openModal("reportBug");else if("optionsBlog"===id)g.openUrl("/blog/");else if("optionsLogout"===id)g.vmSetup.logoutClicked();else if("contextMenuOptions"===id);else try{g.PAssert(3216,!1,"Invalid menu option selection",id)}catch(PERR){g.reportError(PERR)}this.closeOptionsMenu()}},confirm:function confirmFn(text,cb){this.modalConfirm.openDialog(text,cb)},alert:function alertFn(params){this.modalAlert.openDialog(params)},onTapAlertButton:function onTapAlertButtonFn(e){this.modalAlert.onTapAlertClose()},getUserEmail:function getUserEmailFn(){return g.getUserIdentifier()},getUserName:function getUserNameFn(){var user=gdata.authenticatedUser();return user?user.displayName:g.vmMain.gdriveStatus()===DriveStatus.Saved?"Connected":g.vmSetup.loginState()==LoginState.LOGGED_IN?"Connecting":"Demo"},addPaneMoreText:function addPaneMoreTextFn(){return g.billingManager.isPremiumEnabled()&&PaneFactory.numInactivePanes()>0?"Enable more panes":void 0},openMenuExternalApp:function openMenuExternalAppFn(html,onTap){var el=g.element("contextMenuMobileExternalApp");this.contextBottomOpen=el,this.mobileExternalAppText(html),g.addClass(el,"showing");try{g.PAssert(3217,onTap,"onTap must be defined")}catch(PERR){g.reportError(PERR)}onTap&&(this._mobileExternalAppTap=onTap)},closeContextBottom:function closeContextBottomFn(){var el=this.contextBottomOpen;g.removeClass(el,"showing"),this.contextBottomOpen=void 0},onTapMobileExternalApp:function onTapMobileExternalAppFn(e){var onTap=this._mobileExternalAppTap;try{g.PAssert(3218,onTap,"_mobileExternalAppTap must be defined")}catch(PERR){g.reportError(PERR)}onTap&&onTap(),this.closeContextBottom(),e.preventDefault(),e.stopPropagation()}},VMMenus}),define("ContactsAutocomplete",["ko","globals","util","platform","data"],function(ko,g,util,platform,d){function ContactsAutocomplete(onSelectedFn){try{g.PAssert(3219,onSelectedFn,"Must supply a valid selected callback")}catch(PERR){g.reportError(PERR)}this._matchedContacts=ko.observableArray(),this.selectedContactIndex=ko.observable(0),this._element=void 0,this._inputElement=void 0,this.onSelectedCallback=onSelectedFn,util.forceBind("_onInputBlur",this)}var ContactsAutocompleteFns={onLoad:function onLoadFn(element){this._element=element,this.contactsListEle=element.firstElementChild},setInputElement:function setInputElementFn(inputElement){this._inputElement!==inputElement&&(this._inputElement&&this._cleanupInputElement(),this._inputElement=inputElement,g.copyStyles(inputElement,this._element,["width"]),this._setupInputElement())},_setupInputElement:function _setupInputElementFn(){try{g.PAssert(3220,this._inputElement,"Must have specified a valid input element")}catch(PERR){g.reportError(PERR)}this._inputElement.addEventListener("blur",this._onInputBlur)},_cleanupInputElement:function _cleanupInputElementFn(){try{g.PAssert(3221,this._inputElement,"Must have specified a valid input element")}catch(PERR){g.reportError(PERR)}this._inputElement.removeEventListener("blur",this._onInputBlur)},_onInputBlur:function _onInputBlurFn(){this.forceHide()},onkeydown:function onkeydownFn(data,e){if(platform.normalizeKeys(e),e.normCode===KeyCode.Enter){var newEmailTextEle=this.contactsListEle.children[this.selectedContactIndex()];return newEmailTextEle&&this.onSelectedCallback(newEmailTextEle.textContent),e.preventDefault(),e.stopImmediatePropagation(),!1}if(e.normCode===KeyCode.UpArrow){var newIndex=this.selectedContactIndex()-1;return 0>newIndex&&(newIndex=this._matchedContacts().length-1),this.selectedContactIndex(newIndex),e.preventDefault(),e.stopImmediatePropagation(),g.scrollIntoView(this.contactsListEle.children[newIndex],200),!1}if(e.normCode===KeyCode.DownArrow){var newIndex=this.selectedContactIndex()+1;return newIndex>=this._matchedContacts().length&&(newIndex=0),this.selectedContactIndex(newIndex),e.preventDefault(),e.stopImmediatePropagation(),g.scrollIntoView(this.contactsListEle.children[newIndex],200),!1}return!0},onContactEmailUpdate:function onContactEmailUpdateFn(newEmail){if(newEmail){var contacts=d.contactManager.findEmailsLike(newEmail);contacts&&this._matchedContacts(contacts)}else this._matchedContacts([]);var inputElement=document.activeElement;"INPUT"===inputElement.nodeName&&this.setInputElement(inputElement)},showContactList:function showContactListFn(){return this._matchedContacts().length>0},forceHide:function forceHideFn(){this._matchedContacts([])},computeSelectionIndex:function computeSelectionIndexFn(e){var index=0,ele=e.srcElement||e.target;for("#text"===ele.tagName&&(ele=ele.parentNode);ele=ele.previousElementSibling;)++index;this.selectedContactIndex(index)},onTapContactList:function onTapContactListFn(e){this._matchedContacts([]);var selectedEmail=e.startSrc.innerText;return this.onSelectedCallback(selectedEmail),this.selectedContactIndex(0),e.preventDefault(),e.stopImmediatePropagation(),!1},onMouseoverContactList:function onMouseoverContactListFn(self,e){this.computeSelectionIndex(e)},isContactSelected:function isContactSelectedFn(index){return this.selectedContactIndex()===index()}};return util.extend(ContactsAutocomplete.prototype,ContactsAutocompleteFns),ContactsAutocomplete}),define("VMDocSharing",["ko","globals","util","platform","data","goog","ContactsAutocomplete","ModalBase"],function(ko,g,util,platform,d,goog,ContactsAutocomplete,ModalBase){function VMDocSharing(){this._super.constructor.call(this,Modals.ShareDoc),this.doc=ko.observable(),this.isLoading=ko.observable(!1),this.isCreating=ko.observable(!1),this.permissions=ko.observableArray(),this.permissionsNew=ko.observableArray(),this.permissionsRemove=[],this.newEmail=ko.observable(""),this.errorGlobal=ko.observable(!1),this.errorName=ko.observable(!1),this.errorInvite=ko.observable(!1),this.isSaving=ko.observable(!1),this.editing=ko.observable(!1),this.closeCallback=void 0,this.justCreated=!1,this._contactsAutocomplete=new ContactsAutocomplete(this.onContactSelected.bind(this)),this.newEmail.subscribe(this._contactsAutocomplete.onContactEmailUpdate.bind(this._contactsAutocomplete)),this.init()}var VMDocSharingFns={init:function initFn(){this.registerModal(this.open.bind(this),this.onClose.bind(this))},open:function openFn(doc,callback){this.doc(doc),this.closeCallback=callback,this.isLoading(!0),this.isCreating(!this.doc().hasDriveBacking()),this.permissions.removeAll(),this.permissionsNew.removeAll(),this.permissionsRemove=[],this.newEmail(""),this.errorGlobal(!1),this.errorName(!1),this.errorInvite(!1),this.isSaving(!1),this.editing(!1),this.justCreated=!1,this.inputName=document.getElementById("shareNameInput"),this.inputName.value=this.doc().getTitle(),this.shareLink=document.getElementById("shareLinkInput"),this.shareLink&&(this.shareLink.value="https://moo.do/app/#file="+this.doc().id),platform.mobile||setTimeout(function(){this.inputName.focus()}.bind(this),0),this.isCreating()?this.isLoading(!1):this.doc().listPermissions(this.permissionHandler.bind(this))},addPadding:function addPaddingFn(){var padSize=platform.windowHeight()-platform.getKBSize()+g.topBarHeight;platform.android&&(padSize=platform.getKBSize()+20),g.element("shareScroller").style.paddingBottom=padSize+"px"},removePadding:function removePaddingFn(){document.getElementById("shareScroller").style.paddingBottom=""},permissionHandler:function permissionHandlerFn(permissionList){if(permissionList){this.isLoading(!1);for(var permissions=[],i=0;i<permissionList.length;++i){var item=permissionList[i];item.emailAddress!==g.getUserIdentifier()&&(item.onRemove=this.onRemove.bind(this,item),"anyone"!==item.id&&(item.emailAddress||(item.emailAddress="owner"===item.role?"Owner":""),"owner"===item.role?permissions.splice(0,0,item):permissions.push(item)),item.emailDisplay="("+item.emailAddress+")")}this.permissions(permissions)}},isOwned:function isOwnedFn(){return this.doc().isOwned&&this.doc().isOwned()},saveText:function saveTextFn(){if(this.isCreating())return this.isSaving()?"CREATING...":"CREATE";if(platform.mobile&&this.editing()){switch(this.editing()){case"Name":return"SAVE";case"Invite User":return"INVITE"}return""}return this.newEmail().length>0?"INVITE":this.isSaving()?"SAVING...":"SAVE"},titleText:function titleTextFn(){return platform.mobile&&this.editing()?this.editing():this.isCreating()?"Create Document":"Edit Document"},onKeyboardOpened:function onKeyboardOpenedFn(e){this.editing(e.srcElement.title)},inviteUser:function inviteUserFn(){if(0===this.newEmail().length)return void this.errorInvite("");if(!g.isEmail(this.newEmail()))return this.errorInvite("Please enter a valid email address."),!1;var user={emailAddress:this.newEmail(),error:ko.observable(!1)},contact=d.contactManager.findContactByEmail(user.emailAddress.toLowerCase());return user.name=contact?contact.text:user.emailAddress,user.onRemove=this.onRemoveNew.bind(this,user),this.permissionsNew.push(user),this.newEmail(""),this.errorInvite(!1),!0},checkName:function checkNameFn(){var title=this.inputName.value.trim();return title.length>0&&title.length<255?(this.errorName(!1),!0):(this.errorName("Error: Document name must be >0 and <255 characters."),!1)},rename:function renameFn(){var title=this.inputName.value.trim();title!==this.doc().getTitle()&&this.doc().rename(title,function(success){success||this.errorName("Error: Unable to update name on remote server.")})},create:function createFn(callback){this.justCreated=!0,this.isSaving(!0);var title=this.inputName.value.trim();this.doc().rename(title,function(success){try{g.PAssert(3222,success,"Rename during create must be successful")}catch(PERR){g.reportError(PERR)}}),goog.createAndSetupDocument(this.doc(),!1,function(response){response&&!response.error?(this.isCreating(!this.doc().hasDriveBacking()),this.isSaving(!1),callback&&callback()):this.errorGlobal("Error: Unable to create new document.")}.bind(this))},save:function saveFn(){if(!this.isSaving()||this.justCreated){if(!goog.isDriveAPILoaded())return this.errorGlobal("Error communicating with Google Drive. Please reconnect and try again."),void g.blurActiveElement();if(this.checkName()){if(this.isCreating())return void this.create(this.save.bind(this));if(this.newEmail().length>0){if(!this.inviteUser())return}else this.errorInvite(!1);this.rename();for(var docWasShared=this.doc().isShared(),count=0,handleResponse=function(index,success){success?(count--,0>=count&&(g.menus.closeModal(Modals.ShareDoc,!1),this.doc().isOwned()&&this.doc().isOpen()&&g.vmMain.pluginManager.onDocumentShared(docWasShared))):(this.permissionsNew()[index].error(!0),this.errorInvite("Some people could not be invited."),this.isSaving(!1))}.bind(this),i=0;i<this.permissionsNew().length;i++){var newPermission=this.permissionsNew()[i];newPermission.error()||(count++,this.doc().insertPermission(newPermission.emailAddress,handleResponse.bind(this,i)))}for(var i=0;i<this.permissionsRemove.length;i++){var permission=this.permissionsRemove[i];this.doc().deletePermission(permission.id,function(success){})}this.errorInvite()||this.errorName()||(0===count?g.menus.closeModal(Modals.ShareDoc,!0):(this.isSaving(!0),this.onClose(!0)))}}},onClose:function onCloseFn(isSave){this.closeCallback&&(this.closeCallback(isSave),this.closeCallback=void 0),g.blurActiveElement()},onTapInviteMessage:{onStart:g.handlerPreventStop,onClick:function onClickFn(e){var el=g.element("inputShareInvite");platform.mobile?g.menus.focusModalInputMobile(e,el):el.focus()}},onTapSave:{onStart:g.handlerPreventStop,onClick:function onClickFn(){this.isSaving()||(this.editing()||this.newEmail().length>0?(g.blurActiveElement(),this.inviteUser(),this.editing("")):(this.save(),g.sendEvent("Menu","SharingSave")))}},onTapCancel:{onStart:g.handlerPreventStop,onClick:function onClickFn(){this.editing()?(g.blurActiveElement(),this.editing("")):(g.blurActiveElement(),g.menus.closeModal(Modals.ShareDoc,!1),g.sendEvent("Menu","SharingCancel"))}},onTapDelete:{onClick:function onClickFn(){g.sendEvent("Menu","SharingDelete"),g.menus.confirm("Are you sure you want to delete the file?",function(result){result&&(g.vmMain.docManager.deleteDoc(this.doc().id,function(success){log("Document Delete Response: ",success),success||g.messageQueue.pushMessage({text:"Unable to delete document on the remote server."})}),g.menus.closeModal(Modals.ShareDoc,!1))}.bind(this))}},onRemove:function onRemoveFn(user){this.permissionsRemove.push(user),this.permissions.remove(user),g.sendEvent("Menu","SharingRemoveUser")},onRemoveNew:function onRemoveNewFn(user){this.permissionsNew.remove(user)},onContactSelected:function onContactSelectedFn(emailAddr){emailAddr?(g.scrollIntoView(g.element("inputShareInvite"),0),this.newEmail(emailAddr)):this.newEmail("")},onkeydown:function onkeydownFn(data,e){return platform.normalizeKeys(e),this._contactsAutocomplete.onkeydown(data,e),e.normCode===KeyCode.Enter&&this.inviteUser(),!0}};return util.inherit(ModalBase,VMDocSharing),util.extend(VMDocSharing.prototype,VMDocSharingFns),VMDocSharing}),define("VMPicker",["ko","globals","util","platform","data","goog","VMDocument","VMDocSharing","tracker","Dispatcher"],function(ko,g,util,platform,d,goog,VMDocument,VMDocSharing,tracker,Dispatcher){function VMPicker(){this.fileMap={},this.isLoading=ko.observable(!1),this.needPermission=ko.observable(!1),this.showError=ko.observable(!1),this.documentButtonsCollapsed=ko.observable(!1),this.listHeight=void 0,this.scrollDebounced=!1,this._openFile=void 0,this.loadCallbacks=[],this.init()}return VMPicker.prototype={init:function initFn(){new VMDocSharing,platform.mobile&&setTimeout(function(){g.vmMain.docManager.getDocList().subscribe(function(){Dispatcher.fireEvent("documentsLoaded",[])}.bind(this))}.bind(this),0)},hasFiles:function hasFilesFn(){var docList=g.vmMain.docManager.getDocList();return docList().length>0},showLoading:function showLoadingFn(){return!this.hasFiles()&&!this.showError()},refreshFiles:function refreshFilesFn(){this.loadFileList()},runLoad:function runLoadFn(){g.vmMain.docManager.loadDocList(function(success){success||this.showError("Load Documents"),this.isLoading(!1)}.bind(this))},loadFileList:function loadFileListFn(){this.isLoading()||(this.isLoading(!0),this.showError(!1),g.loadGoogleAPI("drive","v2",this.runLoad.bind(this)))},getFileList:function getFileListFn(){return g.vmMain.docManager.getDocList()},requestOpenDocument:function requestOpenDocumentFn(id){var doc=g.vmMain.docManager.getDoc(id);doc?this.openDocument(doc):this.openDocumentFromId(id)},openDocumentFromId:function openDocumentFromIdFn(id,title){try{g.PAssert(3223,id,"Document should always have a valid id")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3224,title,"Document should always have a valid title")}catch(PERR){g.reportError(PERR)}var currentDoc=goog.getDocId();currentDoc!==id&&d.clearData(function(){goog.setDocInfo(id,title),util.hasURLParam("file")?util.removeURLParam("file",!0):util.hasURLParam("state")&&util.removeURLParam("state",!0),setTimeout(function(){g.reload()},500)},d.defaultSkipSettings)},openDocument:function openDocumentFn(doc){g.localDocChangeRequested=!0,this.openDocumentFromId(doc.id,doc.getTitle())},onTapReloadDocuments:function onTapReloadDocumentsFn(e){this.loadFileList()},openSharing:function openSharingFn(doc,callback){g.menus.openModal(Modals.ShareDoc,doc,callback)},onTapDocument:{onClick:function onClickFn(e){var doc=g.dataFor(e.srcElement);g.hasClass(e.srcElement,"documentTitle")?(this.openDocument(doc),tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenDocument,data:[{value:!0}]})):doc instanceof VMDocument?(this.openSharing(doc),g.sendEvent("Menu","OpenSharing"),tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenDocSharing,data:[{value:!0}]}),e.stopImmediatePropagation()):"documentsList"!==e.srcElement.id&&g.reportError(new Error("Incorrect document type: "+g.elementToString(e.srcElement))),e.preventDefault(),e.stopImmediatePropagation()}},onTapAdd:{onStart:g.handlerStopProp,onClick:function onClickFn(){if(g.vmMain&&g.vmMain.isOnline()){var doc=g.vmMain.docManager.createNewDoc();g.sendEvent("Menu","AddDocument"),this.openSharing(doc,function(saved){saved&&g.vmMain.docManager.setDoc(doc)}),tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.AddDocument,data:[{value:!0}]})}else g.messageQueue.pushMessage({text:"You must be online to create a new document."})}},onTapRefresh:{onStart:g.handlerStopProp,onClick:function onClickFn(){g.vmMain&&g.vmMain.isOnline()&&!this.isLoading()&&this.refreshFiles()}}},VMPicker}),define("VMSettings",["ko","data","globals","util","goog","platform","tracker","VMPicker","ModalBase"],function(ko,d,g,util,goog,platform,tracker,VMPicker,ModalBase){function VMSettings(){this._super.constructor.call(this,platform.mobile?Modals.MobileSettings:Modals.Settings),this.enabledSyncContacts=ko.observable(!1),this.enabledSounds=ko.observable(!1),this.enabledNotifications=ko.observable(!1),this.enabledMobileUI=ko.observable(!1),this.enabledPluginDrive=ko.observable(!1),this.enabledPluginGmail=ko.observable(!1),this.syncContactsEnabledOnOpen=ko.observable(!1),this.isRefreshingContacts=ko.observable(!1),this.refreshContactsSuccess=ko.observable(void 0),this.billingManager=g.billingManager,this.init()}var VMSettingsFns={init:function initFn(){if(platform.mobile&&this.registerModal(this.open.bind(this),this.close.bind(this)),this.loadSettings(),platform.mobile){var saveFn=this.save.bind(this);this.enabledSyncContacts.subscribe(saveFn),this.enabledSounds.subscribe(saveFn),this.enabledNotifications.subscribe(saveFn),this.enabledMobileUI.subscribe(saveFn)}g.settings.registerForChangeNotification(Settings.syncContacts,void 0,this.onSyncContactsChange.bind(this))},isLocal:function isLocalFn(){return"localhost"===window.location.hostname||!1},showMobileAppReview:function showMobileAppReviewFn(){return!!platform.appReviewLink},showMobileUIOptionOnDesktop:function showMobileUIOptionOnDesktopFn(){return!1},showMobileUIOptionOnMobile:function showMobileUIOptionOnMobileFn(){return parseInt(window.innerWidth)>767},onEnableNotificationsChange:function onEnableNotificationsChangeFn(){this.enabledNotifications()?g.timeline.updateNotifications():g.timeline.clearNotifications()},onSyncContactsChange:function onSyncContactsChangeFn(oldValue,newValue){this.enabledSyncContacts(newValue)},open:function openFn(){this.isClosing||(this.refreshContactsSuccess(void 0),this.loadSettings(),this.syncContactsEnabledOnOpen(this.enabledSyncContacts()))},close:function closeFn(save){if(save)this.save();else{var checkSyncContacts=!!g.settings.get(Settings.syncContacts),checkPluginDrive=g.vmMain.pluginManager.isAuthorized(PluginID.Drive),checkPluginGmail=g.vmMain.pluginManager.isAuthorized(PluginID.Gmail);this.enabledSyncContacts(checkSyncContacts),this.enabledSounds(!g.settings.get(Settings.noSounds)),this.enabledPluginDrive(checkPluginDrive),this.enabledPluginGmail(checkPluginGmail)}},onScreenStartOpen:function onScreenStartOpenFn(){this.loadSettings()},enableSyncContacts:function enableSyncContactsFn(handler){function handleContactsLoaded(numContacts){0>numContacts?(g.messageQueue.pushMessage({text:"There was an error syncing your contacts. Please try again.",actionText:"SYNC",action:function actionFn(){this.enableSyncContacts(handler)}.bind(this)}),handler&&handler(!1)):numContacts>0&&(g.vmMain.parseSubtree(g.vmMain.root(),ChangeType.Auto),handler&&handler(!0))}g.sendEvent("Settings","EnableContacts"),goog.runAuthenticate([GScope.Contacts],!1,!1,function(token){token&&!token.error?(goog.loadContacts(handleContactsLoaded.bind(this)),tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SyncContacts,data:[{value:!0}]}),this.enabledSyncContacts(!0),g.settings.set(Settings.syncContacts,!0)):(this.enabledSyncContacts(!1),g.settings.set(Settings.syncContacts,!1),g.messageQueue.pushMessage({text:"To sync your contacts we need permission to access them. Please try again.",actionText:"SYNC",action:function actionFn(){this.enabledSyncContacts(handler)}.bind(this)}),handler&&handler(!1))}.bind(this))},loadSettings:function loadSettingsFn(){this.enabledSyncContacts(!!g.settings.get(Settings.syncContacts)),this.enabledSounds(!g.settings.get(Settings.noSounds)),this.enabledNotifications(!g.settings.get(Settings.disableNotifications)),this.enabledPluginDrive(g.vmMain.pluginManager.isAuthorized(PluginID.Drive)),this.enabledPluginGmail(g.vmMain.pluginManager.isAuthorized(PluginID.Gmail))},save:function saveFn(){var changedContacts=this.enabledSyncContacts()!==!!g.settings.get(Settings.syncContacts),changedSounds=this.enabledSounds()!==!g.settings.get(Settings.noSounds),changedNotifications=this.enabledNotifications()!==!g.settings.get(Settings.disableNotifications),changedPluginDrive=this.enabledPluginDrive()!==g.vmMain.pluginManager.isAuthorized(PluginID.Drive),changedPluginGmail=this.enabledPluginGmail()!==g.vmMain.pluginManager.isAuthorized(PluginID.Gmail);changedContacts&&(g.settings.set(Settings.syncContacts,this.enabledSyncContacts()),this.enabledSyncContacts()?this.enableSyncContacts():(g.sendEvent("Settings","DisableContacts"),goog.loadedContacts=!1,d.clearContacts())),changedSounds&&g.settings.set(Settings.noSounds,!this.enabledSounds()),changedNotifications&&(g.settings.set(Settings.disableNotifications,!this.enabledNotifications()),this.enabledNotifications()?g.timeline.updateNotifications():g.timeline.clearNotifications()),changedPluginDrive&&(this.enabledPluginDrive()?g.vmMain.pluginManager.authorizePlugin(PluginID.Drive,function(success){success||(this.enabledPluginDrive(!1),g.messageQueue.pushMessage({text:"To sync GDrive we need permission to access your file names. Please try again."}))}.bind(this)):g.vmMain.pluginManager.deauthorizePlugin(PluginID.Drive,function(){this.enabledPluginDrive(!1)}.bind(this))),changedPluginGmail&&(this.enabledPluginGmail()?g.vmMain.pluginManager.authorizePlugin(PluginID.Gmail,function(success){success||(this.enabledPluginDrive(!1),g.messageQueue.pushMessage({text:"To sync Gmail we need permission to access your file names. Please try again."}))}.bind(this)):g.vmMain.pluginManager.deauthorizePlugin(PluginID.Gmail,function(){this.enabledPluginDrive(!1)
}.bind(this)))},isDemo:function isDemoFn(){return g.isDemoMode()},onTapSave:function onTapSaveFn(){g.menus.closeModal(platform.mobile?Modals.MobileSettings:Modals.Settings,!0)},onTapCancel:function onTapCancelFn(){g.menus.closeModal(platform.mobile?Modals.MobileSettings:Modals.Settings,!0)},isPremiumEnabled:function isPremiumEnabledFn(){return g.billingManager.isPremiumEnabled()},onTapLogout:function onTapLogoutFn(e){g.vmSetup.logoutClicked(),g.sendEvent("Menu","Logout"),e.preventDefault()},onTapRunPicker:function onTapRunPickerFn(){},onTapFeedback:function onTapFeedbackFn(e){g.menus.openModal(Modals.ReportBug),g.sendEvent("Menu","GiveFeedback"),e.preventDefault()},onTapLeaveDemo:function onTapLeaveDemoFn(){util.removeURLParam("demo")},onTapRestartClient:function onTapRestartClientFn(e){g.reload(),e.preventDefault()},onTapResetClient:function onTapResetClientFn(){d.clearData(function(){g.reload()}),g.sendEvent("Menu","ResetClient")},onForceReloadDoc:function onForceReloadDocFn(){d.clearDataAndReload(),g.sendEvent("Menu","ReloadDoc")},onTapSettings:function onTapSettingsFn(){g.menus.openModal(Modals.Settings),g.vmMain.cancelFullscreenClick(),g.sendEvent("Menu","Settings")},onlineStatusToggle:function onlineStatusToggleFn(){platform.offline?util.removeURLParam("offline"):util.insertURLParam("offline","true")},logoutButtonText:function logoutButtonTextFn(){return g.vmSetup.logoutButtonText()},isLoggedIn:function isLoggedInFn(){return g.vmSetup.loginState()==LoginState.LOGGED_IN},isOnline:function isOnlineFn(){return g.vmMain.isOnline()},showAppDebugInfo:function showAppDebugInfoFn(){return platform.debugApp},getHostName:function getHostNameFn(){return"Host: "+window.location.host},getLowMemText:function getLowMemTextFn(){return"LowMem: "+(g.hasSentLowMemoryWarning()?"TRUE":"FALSE")},getDebugUserText:function getDebugUserTextFn(){return"Premium: "+g.billingManager.getPremiumStatus()},getDebugPremiumText:function getDebugPremiumTextFn(){return"User: "+g.billingManager.getBillingIdentifier()},onTapRefreshContacts:function onTapRefreshContactsFn(){this.isRefreshingContacts()||(this.isRefreshingContacts(!0),this.refreshContactsSuccess(void 0),d.clearLocalContacts(),goog.loadedContacts=!1,goog.authAndLoadContacts(!0,function(success){this.refreshContactsSuccess(success),setTimeout(function(){this.isRefreshingContacts(!1)}.bind(this),1e3)}.bind(this)),g.sendEvent("Menu","RefreshContacts"))},contactsRefreshSuccessTest:function contactsRefreshSuccessTestFn(){return void 0===this.refreshContactsSuccess()?"":this.refreshContactsSuccess()===!0?"Success!":this.refreshContactsSuccess()===!1?"Failure!":void 0},onTapRestartIntro:function onTapRestartIntroFn(){g.intro?(g.intro.clearState(),g.intro.init()):g.vmMain.showHelp()},onTapSendToAppReview:function onTapSendToAppReviewFn(){platform.appReviewLink&&g.openUrl(platform.appReviewLink)}};return util.inherit(ModalBase,VMSettings),util.extend(VMSettings.prototype,VMSettingsFns),VMSettings}),define("VMPhoneMenu",["ko","globals","data","platform","tracker"],function(ko,g,d,platform,tracker){function VMPhoneMenu(){try{g.PAssert(3225,platform.mobile,"Should only initialize on mobile platforms")}catch(PERR){g.reportError(PERR)}this.mode=ko.observable(this.Modes.Normal),this.multiSelected=g.vmMain.selected,this.init()}return VMPhoneMenu.prototype={Modes:{Normal:0,Multiselect:1,Contact:2,Date:3},init:function initFn(){g.applyBindings(this,"phoneMenu"),this.mode.subscribe(function(newValue){newValue===this.Modes.Multiselect?(g.addClass(g.focusedPane.element,"multiSelectMode"),tracker.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.OpenMultiselect})):(g.removeClass(g.focusedPane.element,"multiSelectMode"),tracker.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.CloseMultiselect}))}.bind(this))},_modeHelper:function _modeHelperFn(val,mode){return void 0!==val&&(val&&this.mode(mode),val||mode!==this.mode()||this.mode(this.Modes.Normal)),this.mode()===mode},activeScreenClass:function activeScreenClassFn(){var name="";return name},normalMode:function normalModeFn(val){return this._modeHelper(val,this.Modes.Normal)},multiSelectMode:function multiSelectModeFn(val){return this._modeHelper(val,this.Modes.Multiselect)},contactMode:function contactModeFn(val){return this._modeHelper(val,this.Modes.Contact)},dateMode:function dateModeFn(val){return this._modeHelper(val,this.Modes.Date)},tagMode:function tagModeFn(val){return this._modeHelper(val,this.Modes.Tag)},onTapMultiSelectCancel:{onClick:function onClickFn(e){g.menus.closeMultiSelect(),g.handlerPreventStop(e)}},onTapAutocompleteClose:{onClick:function onClickFn(e){g.autocomplete.hide(),g.handlerPreventStop(e)}},onTapArchive:{onClick:function onClickFn(e){g.focusedPane.archiveCompleted(),g.sendEvent("PhoneMenu","ArchiveCompleted"),g.handlerPreventStop(e)}},onTapHeader:{onStart:function onStartFn(e){g.ScreenManager.checkSwipeStart(e)},onMove:function onMoveFn(e){g.ScreenManager.checkSwipeMove(e)},onEnd:function onEndFn(e){g.ScreenManager.checkSwipeEnd(e)}}},VMPhoneMenu}),define("VMKeyboardToolbar",["ko","globals","data","edit","platform","tracker","Sel","Dispatcher"],function(ko,g,d,edit,platform,tracker,Sel,Dispatcher){function VMKeyboardToolbar(){this.buttons=ko.observableArray(),this.priorityVisible=ko.observable(),this.isVisible=ko.observable(!1),this.element=void 0,this.aboutToShow=void 0,this.bottomPosition=void 0,this.topBarHidden=!1,this.init()}return VMKeyboardToolbar.prototype={Type:{Item:0,Search:1,Modal:2},init:function initFn(){this.element=g.element("mobileKeyboardToolbar"),g.applyBindings(this,"mobileKeyboardToolbar"),window.addEventListener("closeKeyboard",this.hide.bind(this)),Dispatcher.listen("itemsUpdated",function(pane){document.activeElement&&document.activeElement!==document.body||g.isKeyboardOpen&&g.closeKeyboard()}.bind(this))},onTap:{onStart:g.handlerPreventStop,onClick:function onClickFn(e){var id=e.srcElement.id;if("mobileKeyboardToolbar"===id&&(e.preventDefault(),e.returnFalse=!0),"closeKeyboardButton"===id)g.closeKeyboard();else if(g.getActiveSearch().isFocused.get()){var ch;"priorityButton"===id?ch="!":"dateButton"===id?ch=DatePrefix:"contactButton"===id?ch=ContactPrefix:"tagButton"===id&&(ch=TagPrefix),ch&&g.getActiveSearch().addToValue(ch)}else"outdentButton"===id?g.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!0}):"indentButton"===id?g.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!1}):"priorityButton"===id?this.priorityVisible(!this.priorityVisible()):"pNoneButton"===id?g.vmMain.applyPriorityToSelection(VMLIFlag.None,!1):"p0Button"===id?g.vmMain.applyPriorityToSelection(VMLIFlag.P0,!0):"p1Button"===id?g.vmMain.applyPriorityToSelection(VMLIFlag.P1,!0):"p2Button"===id?g.vmMain.applyPriorityToSelection(VMLIFlag.P2,!0):"pStarButton"===id?g.vmMain.applyFnToSelection("isStarred",{toggle:!0}):"dateButton"===id?(g.vmMain.insertCharacter(DatePrefix,!0),tracker.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.AtButton})):"contactButton"===id?g.vmMain.insertCharacter(ContactPrefix,!0):"tagButton"===id&&g.vmMain.insertCharacter(TagPrefix,!0);g.handlerPreventStop(e)}},preShow:function preShowFn(){this.aboutToShow=!0,this.priorityVisible(!1),setTimeout(function(){this.aboutToShow=!1}.bind(this),100)},show:function showFn(type){if(!type!==this.Type.Modal||platform.app){if(this.aboutToShow=!1,this.updatePosition(),g.isKeyboardOpen=!0,(!platform.ie||platform.ie&&(platform.mobro||platform.winphone))&&this.isVisible(!0),type===this.Type.Search)g.addClass(this.element,"kbsearch"),g.removeClass(this.element,"kbmodal");else if(type===this.Type.Modal)g.addClass(this.element,"kbmodal"),g.removeClass(this.element,"kbsearch");else if(type===this.Type.Item)g.removeClass(this.element,"kbmodal"),g.removeClass(this.element,"kbsearch");else try{g.PAssert(3226,!1,"Should pass a valid keyboard toolbar type",type)}catch(PERR){g.reportError(PERR)}setTimeout(function(){tracker.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.OpenKeyboard}),g.fireCustomEvent("keyboardOpened")},0)}},hide:function hideFn(){!this.aboutToShow&&g.isKeyboardOpen&&(g.isKeyboardOpen=!1,this.priorityVisible(!1),g.focusedPane.removePadding(),g.onCloseKeyboard(),this.hideTopBarIfLandscape(),this.isVisible(!1),tracker.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.CloseKeyboard}))},hideTopBarIfLandscape:function hideTopBarIfLandscapeFn(){platform.orientation!==Orientation.Landscape||!g.isKeyboardOpen&&!this.aboutToShow||g.getActiveSearch().UI.isFocused?this.topBarHidden&&(this.topBarHidden=!1,g.setTransform(g.element("container"),0,0),g.setTransform(g.element("phoneMenuTopWrapper"),0,0)):(g.setTransform(g.element("container"),0,-g.topBarHeight),g.setTransform(g.element("phoneMenuTopWrapper"),0,-g.topBarHeight),this.topBarHidden=!0)},updatePosition:function updatePositionFn(byResize){platform.app||(platform.kbsize=platform.orientation===Orientation.Portrait?platform.kbsizePortrait:platform.kbsizeLandscape);var bottom=platform.kbsize;bottom!==this.bottomPosition&&(this.bottomPosition=bottom,g.element("mobileKeyboardToolbar").style.bottom=platform.getKBSize()+"px"),g.isKeyboardOpen&&g.focusedPane.addPadding()}},VMKeyboardToolbar}),define("VMIntroSection",["ko","globals","platform"],function(ko,g,platform){function VMIntroSection(text,note){this.text=text,this.note=note,this.items=[],this.inOrder=!1,this.enforceOrder=!1,this.owner=void 0,this.numComplete=0,this.next=0,this.isComplete=ko.observable(!1)}return VMIntroSection.prototype={getHash:function getHashFn(){return g.introHash(this.text)},getStepHash:function getStepHashFn(index){return g.introHash(this.items[index].text)},defaultShow:function defaultShowFn(){this.isDisabled(!1)},loadFromSaveDataOld:function loadFromSaveDataOldFn(data){if(data===!0){for(var i=0;i<this.items.length;++i)this.items[i].isComplete(!0);this.numComplete=this.items.length,this.isComplete(!0)}else{for(var i=0;i<data.length;++i)for(var j=0;j<this.items.length;++j)data[i]===this.getStepHash(j)&&(this.items[j].isComplete(!0),this.numComplete++,this.inOrder&&(this.next=Math.max(this.next,j+1)));this.numComplete===this.items.length&&this.isComplete(!0)}if(this.inOrder&&0!==this.next&&this.next<this.items.length){var nextItem=this.items[this.next];nextItem&&(nextItem.show(),!g.isKeyboardOpen&&this.owner.needsKeyboardOpen&&g.tooltip.hideTip())}},loadFromSaveData:function loadFromSaveDataFn(data){for(var j=0;j<this.items.length;++j)data[this.getStepHash(j)]&&(this.items[j].isComplete(!0),this.numComplete++,this.inOrder&&(this.next=Math.max(this.next,j+1)));if(this.numComplete===this.items.length&&this.isComplete(!0),this.inOrder&&0!==this.next&&this.next<this.items.length){var nextItem=this.items[this.next];nextItem&&(nextItem.show(),!g.isKeyboardOpen&&this.owner.needsKeyboardOpen&&g.tooltip.hideTip())}},addStep:function addStepFn(item){try{g.PAssert(3227,item.text,"Invalid help step")}catch(PERR){g.reportError(PERR)}return item.isComplete||(item.isComplete=ko.observable(!1)),this.inOrder&&!platform.mobile?item.isDisabled||(item.isDisabled=ko.observable(this.items.length>0)):item.isDisabled=g.fFalse,item.show||(item.show=this.defaultShow.bind(item)),this.items.push(item),item},complete:function completeFn(item){item.isComplete()||(this.numComplete++,item.isComplete(!0),this.numComplete===this.items.length&&this.isComplete(!0),this.owner.notifyOfChange(item))},check:function checkFn(e){try{g.PAssert(3228,!this.isComplete(),"Should never be checking items in a completed section")}catch(PERR){g.reportError(PERR)}for(var i=0;i<this.items.length&&(this.items[i].isComplete()||((e===!0||this.items[i].check&&this.items[i].check(e))&&(this.complete(this.items[i]),this.inOrder&&i===this.next&&(this.next++,this.next<this.items.length&&this.items[this.next].show())),!this.enforceOrder));i++);this.numComplete===this.items.length&&this.isComplete(!0)},showFirstIncomplete:function showFirstIncompleteFn(){try{g.PAssert(3229,!this.isComplete(),"Should never be showing a tooltip for a completed section")}catch(PERR){g.reportError(PERR)}for(var i=0;i<this.items.length;i++)if(!this.items[i].isComplete()){this.items[i].show();break}}},VMIntroSection}),define("VMIntro",["ko","globals","util","platform","data","VMIntroSection","Observable"],function(ko,g,util,platform,d,VMIntroSection,Observable){function VMIntro(initState){this.mode=ko.observable(HelpMode.None),this.sections=ko.observableArray(),this.introSection=void 0,this.needsKeyboardOpen=!1,this.ModeClassIntro="helpIntro",this.ModeClassNormal="helpNormal",this.ModeClassHotkeys="helpHotkeys",this.priKey=platform.priModKey,this.secKey=platform.secModKey,this.isImportShowing=ko.observable(!1),g.intro=this,this.reactIsShowing=new Observable(this.isShowing()),this.mode.subscribe(function(){this.reactIsShowing.set(this.isShowing())}.bind(this)),this.isImportShowing.subscribe(function(){this.reactIsShowing.set(this.isShowing())}.bind(this))}return window.HelpMode={None:0,Normal:1,Intro:2,Hotkeys:3},VMIntro.prototype={isHelpShowing:function isHelpShowingFn(){return!platform.mobile&&(this.mode()===HelpMode.Intro||this.mode()===HelpMode.Normal||this.mode()===HelpMode.Hotkeys)},isShowing:function isShowingFn(){return this.isHelpShowing()||this.isImportShowing()},init:function initFn(){var helpState=g.settings.get(Settings.helpPaneState);if(void 0===helpState&&(helpState=HelpMode.Intro),helpState===HelpMode.None||g.isDemoMode()||(helpState=helpState||HelpMode.Intro,this.initState(helpState)),!platform.mobile){var importPaneState=util.storage.getItem("closedImport");importPaneState||g.isDemoMode()||this.isImportShowing(!0)}},applyBindings:function applyBindingsFn(){g.applyBindings(this,"paneHelp")},initState:function initStateFn(initState){try{g.PAssert(3230,void 0!==initState,"Must pass in a valid display state")}catch(PERR){g.reportError(PERR)}this.sections.removeAll(),this.setMode(initState),platform.mobile?this.initMobile():(this.initItemsDesktop(),this.isIntroMode()?this.initIntro():this.isHotkeyMode()?this.initHotkeys():this.initHelp()),this.loadStateOld(),this.loadState()},initItemsDesktop:function initItemsDesktopFn(){this.itemAddItem={text:"Write a list title, then press enter to add a new item",check:this.checkAddItem},this.itemIndent={text:'Press the <span class="hHotkey">Tab</span> key to add an item into a list',check:this.checkIndent},this.itemOutdent={text:'Press <span class="hHotkey">Shift + Tab</span> to move an item out of a list',check:this.checkOutdent},this.itemDateTime={text:"Add a date/time by typing @ in the text of an item",check:function checkFn(e){return e.type===TrackerType.Insert&&"@"===e.data[0].text}},this.itemRightClick={text:"Right click an item to explore more options",check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.RightClick}},this.itemAddPanes={text:'Click <i class="icon-add f18 g"></i> in the top right to add more panes',check:function checkFn(e){return e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.AddPane?!0:void 0}},this.itemPluginSettings={text:'Click <i class="icon-settings f18 g"></i> in the upper right to explore powerful integrations in the Settings menu',check:function checkFn(e){return e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.OpenSettingsMenu?!0:void 0}}},setMode:function setModeFn(mode){this.mode(mode),g.settings.set(Settings.helpPaneState,mode),g.vmMain.helpButtonHidden(mode===HelpMode.Intro)},isIntroMode:function isIntroModeFn(){return this.mode()===HelpMode.Intro},isHotkeyMode:function isHotkeyModeFn(){return this.mode()===HelpMode.Hotkeys},modeClass:function modeClassFn(){var modeClass="";return(platform.mobile||this.isHelpShowing())&&(modeClass=this.isIntroMode()?this.ModeClassIntro:this.isHotkeyMode()?this.ModeClassHotkeys:this.ModeClassNormal),modeClass},loadStateOld:function loadStateOldFn(){if(g.shouldWriteLocal())try{var stateString=util.storage.getItem(this.modeClass());if(stateString&&"{}"!==stateString){var state=JSON.parse(stateString);if(state){for(var i=0;i<this.sections().length;++i){var section=this.sections()[i],secHash=section.getHash();state[secHash]&&section.loadFromSaveDataOld(state[secHash])}this.sections().length>0&&(this.saveState(),util.storage.removeItem(this.modeClass()))}}}catch(err){g.reportError(err)}},loadState:function loadStateFn(){if(g.shouldWriteLocal())try{var stateString=util.storage.getItem("help");if(stateString){var state=JSON.parse(stateString);if(state)for(var i=0;i<this.sections().length;++i){var section=this.sections()[i];section.loadFromSaveData(state)}}}catch(err){g.reportError(err)}},saveState:function saveStateFn(){if(g.shouldWriteLocal())try{var state=this.getState();util.storage.setItem("help",JSON.stringify(state))}catch(err){g.reportError(err)}},getState:function getStateFn(){for(var saveData={},i=0;i<this.sections().length;++i)for(var section=this.sections()[i],j=0;j<section.items.length;++j){try{g.PAssert(3231,section.items[j],"Item entries must exist")}catch(PERR){g.reportError(PERR)}section.items[j].isComplete()&&(saveData[section.getStepHash(j)]=1)}return saveData},clearState:function clearStateFn(){g.shouldWriteLocal()&&(util.storage.setItem(this.ModeClassIntro,""),util.storage.setItem(this.ModeClassNormal,""))},notifyOfChange:function notifyOfChangeFn(change){this.saveState()},addSection:function addSectionFn(section){section.owner=this,this.sections.push(section)},initHotkeys:function initHotkeysFn(){var basic=new VMIntroSection("Basic");basic.addStep({text:'<span class="hHotkey">Tab</span> to indent an item'}),basic.addStep({text:'<span class="hHotkey">Shift + Tab</span> to un-indent an item'}),basic.addStep({text:'<span class="hHotkey">'+this.secKey+" + /</span> to complete an item"}),basic.addStep({text:'<span class="hHotkey">'+this.secKey+" + 1|2|3</span> to set item priority"}),basic.addStep({text:'<span class="hHotkey">'+this.secKey+" + 8</span> to star an item"}),basic.addStep({text:'<span class="hHotkey">'+this.secKey+" + ,</span> to collapse an item"}),basic.addStep({text:'<span class="hHotkey">'+this.secKey+" + F</span> to search for text"});var nav=new VMIntroSection("Navigation");nav.addStep({text:'<span class="hHotkey">'+this.secKey+" + Enter</span> to focus a pane on an item"}),nav.addStep({text:'<span class="hHotkey">'+this.secKey+" + Shift + Enter</span> to unfocus a pane"}),nav.addStep({text:'<span class="hHotkey">'+this.priKey+" + "+(platform.mac?"Up":"Home")+"</span> to go to the top of a pane"}),nav.addStep({text:'<span class="hHotkey">'+this.priKey+" + "+(platform.mac?"Down":"End")+"</span> to go to the bottom of a pane"});var advanced=new VMIntroSection("Advanced");advanced.addStep({text:'<span class="hHotkey">'+(platform.mac?"Ctrl + ⌘ + Up":"Alt + Shift + Up")+"</span> to move an item up in a list"}),advanced.addStep({text:'<span class="hHotkey">'+(platform.mac?"Ctrl + ⌘ + Down":"Alt + Shift + Down")+"</span> to move an item down in a list"}),advanced.addStep({text:'<span class="hHotkey">'+this.secKey+" + Shift + A</span>"+(platform.mac?' or <span class="hHotkey">'+this.secKey+" + L</span>":"")+" to select the current item"}),advanced.addStep({text:'<span class="hHotkey">'+this.secKey+" + Shift + ,</span> to collapse all top-level items"}),advanced.addStep({text:'<span class="hHotkey">Shift + F4</span> to close the current pane'});var editor=new VMIntroSection("Text Editor");editor.addStep({text:'<span class="hHotkey">'+this.secKey+" + Z</span> to undo your last action"}),editor.addStep({text:'<span class="hHotkey">'+this.secKey+" + Y</span> to redo your last action"}),editor.addStep({text:'<span class="hHotkey">'+(platform.mac?"Option":"Ctrl")+" + Backspace</span> to delete the previous word"}),editor.addStep({text:'<span class="hHotkey">'+(platform.mac?"Option":"Ctrl")+" + Delete</span> to delete the next word"}),this.addSection(basic),this.addSection(nav),this.addSection(advanced),this.addSection(editor)},initIntro:function initIntroFn(){this.introSection=new VMIntroSection("Welcome to Moo.do!","We'll walk you through the basics to get you started."),this.introSection.inOrder=!0,this.introSection.addStep(this.itemAddItem),this.introSection.addStep(this.itemIndent),this.introSection.addStep(this.itemOutdent),this.introSection.addStep(this.itemDateTime),this.introSection.addStep(this.itemRightClick),g.isDemoMode()||(this.introSection.addStep(this.itemAddPanes),this.introSection.addStep(this.itemPluginSettings)),this.addSection(this.introSection)},checkAddItem:function checkAddItemFn(e){if(e.type===TrackerType.Create){var item=d.getModel(e.data[0].itemID);return!item||item.parent()===d.getRootModel()&&0===e.data[0].position?!1:!0}},checkIndent:function checkIndentFn(e){if(e.type===TrackerType.Move){var oldParentItem=d.getItem(e.data[0].oldParent);if(oldParentItem&&oldParentItem.items.indexOf(e.data[0].newParent)>=0)return!0}},checkOutdent:function checkOutdentFn(e){if(e.type===TrackerType.Move){var newParentItem=d.getItem(e.data[0].newParent);if(newParentItem&&newParentItem.items.indexOf(e.data[0].oldParent)>=0)return!0}},checkSearch:function checkSearchFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged},checkComplete:function checkCompleteFn(e){if(e.type===TrackerType.Update){var v=e.data[0];return"isComplete"===v.field&&v.newValue}},checkOutline:function checkOutlineFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.ToggleOutline},initHelp:function initHelpFn(){this.sections.removeAll();var org=new VMIntroSection("Organization","Moo.do works like a text editor so you can organize like you're writing a document.");org.addStep(this.itemAddItem),org.addStep(this.itemIndent),org.addStep(this.itemOutdent),org.addStep({text:"Click and drag on the left edge of an item to move it",check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.DropItem&&g.vmMain.isLoaded?!0:void 0}}),org.addStep({text:'Press <span class="hHotkey">'+this.priKey+' + Z</span> to undo and <span class="hHotkey">'+this.priKey+" + Y</span> to redo",check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.UndoRedo?!0:void 0}}),org.addStep({text:'Click the left edge of a list or press <span class="hHotkey">'+this.secKey+" + ,</span> to collapse its subitems",check:function checkFn(e){if(e.type===TrackerType.Update){var v=e.data[0];return"isCollapsed"===v.field&&v.newValue}}}),this.addSection(org);var dates=new VMIntroSection("Dates","Scheduling items automatically puts them on your Agenda.");dates.addStep(this.itemDateTime),dates.addStep({text:'Write dates in plain English like <span class="date">@tomorrow</span>',check:function checkFn(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&g.vmMain.isLoaded){var date=e.data[0].date;return!!date}}}),dates.addStep({text:'Schedule a full date and time like <span class="date">@today 2:30pm</span> or <span class="date">@5/25 6:00</span>',check:function checkFn(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&g.vmMain.isLoaded){var date=e.data[0].date;if(date)return date.hasTimeOfDay()}}}),dates.addStep({text:'Describe urgency with <span class="date">@now</span>, <span class="date">@soon</span>, or <span class="date">@later</span>',check:function checkFn(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&g.vmMain.isLoaded){var item=d.getModel(e.data[0].itemID);return item?g.isDateSoft(item.dateText):!1}}}),dates.addStep({text:'Create a repeating date like <span class="date">@every friday</span> or <span class="date">@every other tuesday</span>',check:function checkFn(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&g.vmMain.isLoaded){var date=e.data[0].date;if(date)return date.isRepeatDate()}}}),dates.addStep({text:'Create a repeating date with a beginning or end <span class="date">@every friday from tomorrow</span> or <span class="date">@every other tuesday until october</span>',check:function checkFn(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&g.vmMain.isLoaded){var date=e.data[0].date;if(date&&date.isRepeatDate())return!date.getStartDate().equals(Date.today())||!!date.getEndDate()}}}),this.addSection(dates);var priority=new VMIntroSection("Priority","Prioritizing items automatically puts them on your agenda and lets you manage what to do next.");priority.addStep(this.itemRightClick),priority.addStep({text:'Set a priority with the right click menu or <span class="hHotkey">'+this.secKey+" + 1|2|3</span>",check:function checkFn(e){if(e.type===TrackerType.Update){var v=e.data[0];return"priority"===v.field&&v.newValue>0}}}),priority.addStep({text:'Click the right edge of an item or <span class="hHotkey">'+this.secKey+" + /</span> to complete it",check:this.checkComplete}),priority.addStep({text:'Press <span class="hHotkey">'+this.secKey+" + 8</span> to star an item which highlights it in yellow",check:function checkFn(e){if(e.type===TrackerType.Update){var v=e.data[0];return"isStarred"===v.field&&v.newValue}}}),this.addSection(priority);var contacts=new VMIntroSection("Contacts","Add a contact to an item to easily start a call or email.");contacts.addStep({text:"Add a contact by typing + in the text of an item",check:function checkFn(e){return e.type===TrackerType.Insert&&"+"===e.data[0].text}}),contacts.addStep({text:"Select a contact's name from the list or start typing a name to narrow the search",check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.AddContact}}),contacts.addStep({text:'Click on a <span class="contact">+contact</span> to start a call or email',check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenContact}}),this.addSection(contacts);var panes=new VMIntroSection("Panes","There are two types of panes: List and Agenda. The List pane is where you write and organize while the Agenda pane is organized automatically by time and priority.");panes.addStep(this.itemAddPanes),panes.addStep({text:'Click <i class="icon-close gd"></i> in the top right of a pane to close it',check:function checkFn(e){return e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.RemovePane}}),this.addSection(panes);var focus=new VMIntroSection("Focus","Focus on an item to show only the items under it");focus.addStep({text:'To focus on an item, right click it and select Focus, press <span class="hHotkey">'+this.secKey+' + Enter</span>, or hold <span class="hHotkey">'+this.secKey+"</span> and click its left edge",check:function checkFn(e){return e.type===TrackerType.Zoom&&!e.data[0].zoomOut}}),focus.addStep({text:"To bring focus back out, click the title of the list you want to focus on",check:function checkFn(e){return e.type===TrackerType.Zoom&&e.data[0].zoomOut}}),focus.addStep({text:'Press <i class="outlineButtonNormal icon-list g"></i> in the top left of a pane to open the outline',check:this.checkOutline}),focus.addStep({text:"Click the title of a list in the outline to focus on it",check:function checkFn(e){return e.type===TrackerType.Zoom&&!e.data[0].zoomOut&&g.focusedPane.outline.isVisible.get()}}),this.addSection(focus);var search=new VMIntroSection("Search","Filter for only the items you want to see right now");search.addStep({text:"Filter for a keyword by searching for that word",check:this.checkSearch}),search.addStep({text:'Mark similar items with a <span class="tag">#tag</span> to easily search for all items matching that tag',check:function checkFn(e){return e.type===TrackerType.Insert&&e.data[0].text===TagPrefix}}),search.addStep({text:"Filter by priority by searching for !, !!, or !!!",check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data[0].text.indexOf("!")>=0}}),search.addStep({text:"Show only starred items by searching for *",check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data[0].text.indexOf("*")>=0}}),search.addStep({text:"Hide items you're not interested in by starting a search with - (dash)",check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data[0].text.indexOf("-")>=0}}),search.addStep({text:"Hide completed items by searching for -// (dash, two slashes)",check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data[0].text.indexOf("-//")>=0}}),this.addSection(search);var documents=new VMIntroSection("Collaboration","Collaborate with others by sharing documents with different groups of people");documents.addStep({text:'Click <i class="icon-folder-o g c f18"></i> in the top left to open the documents menu',check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenDocumentsMenu&&e.data[0].value}}),documents.addStep({text:'Click <i class="icon-add f18 g"></i> to create a new document',check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.AddDocument&&e.data[0].value}}),documents.addStep({text:"Open your new document by clicking on it in the list of documents",check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenDocument&&e.data[0].value}}),documents.addStep({text:'Click <i class="icon-settings f18 c g"></i> to change the sharing settings',check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenDocSharing&&e.data[0].value}}),this.addSection(documents);var data=new VMIntroSection("Data","Import data from another app to use in Moo.do or export your data out of Moo.do");data.addStep({text:'Paste into Moo.do by pressing <span class="hHotkey">'+this.priKey+" + V</span> or finding Paste in your browsers edit menu",check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.Paste&&e.data[0].value}}),data.addStep({text:'Copy the selected text by pressing <span class="hHotkey">'+this.priKey+" + C</span> or finding Copy in your browsers edit menu",check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.Copy&&e.data[0].value}}),data.addStep({text:'Click on Import Data in the options menu in the top right, then choose the app to import from and follow the instructions. If you do not see your app, try using copy and paste to paste it in to Moo.do. If that does not work, please <a href="mailto:support@moo.do?subject=Import Request">contact us</a> and tell us what app you want to import from.',check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenImport&&e.data[0].value}}),data.addStep({text:"Click on Export Data in the options menu in the top right, then choose the format you'd like. You can see your data in a new tab so you may copy or download it.",check:function checkFn(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenExport&&e.data[0].value}}),this.addSection(data)},initMobile:function initMobileFn(){var t=g.tooltip,intro=new VMIntroSection("Mobile Intro");intro.inOrder=!0,intro.enforceOrder=!0;var self=this;intro.addStep({text:"Open Keyboard",show:function showFn(e){self.needsKeyboardOpen=!1},check:function checkFn(e){return e.type===TrackerType.Mobile&&e.misc===TrackerMiscMobile.OpenKeyboard}}),intro.addStep({text:"Press return to add another item",show:function showFn(e){self.needsKeyboardOpen=!0,t.displayTip({text:this.text,element:g.element("mobileKeyboardToolbar"),above:!0,offset:{y:-10},maxWidth:240})},check:this.checkAddItem}),intro.addStep({text:"Indent items into lists",show:function showFn(e){self.needsKeyboardOpen=!0,t.displayTip({text:this.text,element:g.element("indentButton"),above:!0,offset:{y:-10},arrow:"arrowBottom",time:200})},check:function checkFn(e){return this.checkIndent(e)||this.checkOutdent(e)}.bind(this)}),intro.addStep({text:"Add a date to a task",show:function showFn(e){self.needsKeyboardOpen=!0,t.displayTip({text:this.text,element:g.element("dateButton"),above:!0,offset:{x:0,y:-10},arrow:"arrowBottom",time:200})},check:function checkFn(e){return e.type===TrackerType.Mobile&&e.misc===TrackerMiscMobile.AtButton&&t.hideTip(),e.type===TrackerType.Mobile&&e.misc===TrackerMiscMobile.CloseAutocomplete
}}),intro.addStep({text:"Tap the right edge of an item to complete it",show:function showFn(e){self.needsKeyboardOpen=!1,t.displayTip({text:this.text,bottom:!0,offset:{y:-5}})},check:this.checkComplete}),intro.addStep({text:"Tap the left edge of a list to collapse its items",show:function showFn(e){self.needsKeyboardOpen=!1,t.displayTip({text:this.text,bottom:!0,offset:{y:-5}})},check:function checkFn(e){return e.type===TrackerType.Update&&e.data[0]&&"isCollapsed"===e.data[0].field}}),intro.addStep({text:"Open the Agenda",show:function showFn(e){self.needsKeyboardOpen=!1,t.displayTip({text:this.text,element:g.element("modeButton"),offset:{y:8},arrow:"arrowTop"})},check:function checkFn(e){return e.type===TrackerType.Mobile&&e.misc===TrackerMiscMobile.PaneAgenda}}),intro.addStep({text:"The agenda shows items with dates or priorities. Go back to the List view.",show:function showFn(e){self.needsKeyboardOpen=!1,t.displayTip({text:this.text,element:g.element("modeButton"),offset:{y:8},arrow:"arrowTop"})},check:function checkFn(e){return e.type===TrackerType.Mobile&&e.misc===TrackerMiscMobile.PaneNormal}}),intro.addStep({text:"Swipe from right to left to enter multiselect mode",show:function showFn(e){self.needsKeyboardOpen=!1,t.displayTip({text:this.text,bottom:!0,offset:{y:-5},time:200})},check:function checkFn(e){return e.type===TrackerType.Mobile&&e.misc===TrackerMiscMobile.OpenMultiselect}}),intro.addStep({text:"Wait close multiselect",show:function showFn(e){self.needsKeyboardOpen=!1,t.hideTip()},check:function checkFn(e){return e.type===TrackerType.Mobile&&e.misc===TrackerMiscMobile.CloseMultiselect}}),intro.addStep({text:"Swipe from left to right to open the Outline",show:function showFn(e){self.needsKeyboardOpen=!1,t.displayTip({text:this.text,bottom:!0,offset:{y:-5},time:200})},check:this.checkOutline}),intro.addStep({text:"Tap a list title to focus on it",show:function showFn(e){self.needsKeyboardOpen=!1,t.displayTip({text:this.text,bottom:!0,offset:{y:-5},time:200})},check:function checkFn(e){return e.type===TrackerType.Zoom}}),intro.addStep({text:"Open the outline again and tap on Home to go back",show:function showFn(e){self.needsKeyboardOpen=!1,t.displayTip({text:this.text,bottom:!0,offset:{y:-5},time:200})},check:function checkFn(e){return e.type===TrackerType.Zoom?e.data[0].itemID===g.vmMain.root().id:void 0}}),intro.addStep({text:"Finished! Open Moo.do on your computer for a more detailed introduction.",show:function showFn(e){self.needsKeyboardOpen=!1,t.displayTip({text:this.text,bottom:!0,offset:{y:-5},time:200})},check:function checkFn(e){return e.type===TrackerType.Zoom?e.data[0].itemID===g.vmMain.root().id:void 0}}),intro.addStep({text:"Intro Done",show:function showFn(e){this.hasShown=!0,self.needsKeyboardOpen=!1,t.hideTip(),self.setMode(HelpMode.None)},check:function checkFn(e){return!!this.hasShown}}),this.addSection(intro),platform.mobile&&(window.addEventListener("closeKeyboard",function(e){this.needsKeyboardOpen&&g.tooltip.hideTip()}.bind(this)),window.addEventListener("keyboardOpened",function(e){try{g.PAssert(3232,this.sections().length>0,"Should have one section on mobile")}catch(PERR){g.reportError(PERR)}this.sections()[0].isComplete()||this.sections()[0].showFirstIncomplete(e)}.bind(this)))},addMobileStep:function addMobileStepFn(step){this.sections.push(step)},onAction:function onActionFn(e){if(!g.menus.isModalOpen(Modals.ImportData))try{for(var scts=this.sections(),i=0;i<scts.length;++i)scts[i].isComplete()||scts[i].check(e)}catch(err){g.reportError(err)}},closeHelp:function closeHelpFn(e){g.tooltip.hideTip(),g.vmMain.helpButtonHidden(!1),this.setMode(HelpMode.None),g.sendEvent("Menu","CloseHelp")},onCloseImport:function onCloseImportFn(e){g.tooltip.hideTip(),this.isImportShowing(!1),g.shouldWriteLocal()&&util.storage.setItem("closedImport",!0)},introComplete:function introCompleteFn(){return this.introSection&&this.introSection.isComplete()},switchToHelp:function switchToHelpFn(){delete this.introSection,this.setMode(HelpMode.Normal),this.initHelp(),this.saveState(),g.sendEvent("Menu","OpenHelp")},nextStep:function nextStepFn(){for(var scts=this.sections(),i=0;i<scts.length;++i)scts[i].isComplete()||scts[i].check(!0)},onTapImport:function onTapImportFn(e){var el=e.target||e.srcElement,importer=el.id.replace("helpImport","");importer&&(g.sendEvent("Menu","HelpImport"+importer),g.menus.openModal(Modals.ImportData,importer))},onTapFeatures:function onTapFeaturesFn(e){this.initState(HelpMode.Normal)},onTapHotkeys:function onTapHotkeysFn(e){this.initState(HelpMode.Hotkeys)}},util.defineBase(VMIntro),VMIntro}),define("VMMessage",["ko","globals","util","data","tracker"],function(ko,g,util,d,tracker){function VMMessage(info,queue){try{g.PAssert(3233,info,"Must provide valid message info")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3234,queue,"Must provide a valid message owner")}catch(PERR){g.reportError(PERR)}if(this.id=info.id,this.owner=queue,this.timeout=info.timeout||4e3,this.text=info.text,this.action=info.action||MessageAction.Default,this.data=info.data,this.hold=!info.timeout&&(info.hold||this.action!==MessageAction.Default),this.noIgnore=info.noIgnore,this.onCloseFn=info.onClose,this.clearTimeout=void 0,this._isVisible=!1,this.actionText=info.actionText,!this.actionText)switch(this.action){case MessageAction.Default:this.actionText="";break;case MessageAction.Reload:case MessageAction.ResetClient:this.actionText="RELOAD";break;case MessageAction.Okay:this.actionText="OKAY";break;case MessageAction.Blog:this.actionText="BLOG";break;case MessageAction.Undo:this.actionText="UNDO";break;case MessageAction.LoginScreen:this.actionText="LOGIN";break;case MessageAction.Contact:this.actionText="CONTACT";break;case MessageAction.OpenSettings:this.actionText="LEARN MORE";break;case MessageAction.OpenAccountSettings:this.actionText="SETTINGS";break;case MessageAction.OpenGoogleDrive:this.actionText="GOOGLE DRIVE"}}return VMMessage.prototype={show:function showFn(){this._isVisible||(this._isVisible=!0,this.hold||(this.clearTimeout=setTimeout(this.hide.bind(this),this.timeout)),this.owner.onMessageShow(this))},hide:function hideFn(noNotify){this._isVisible&&(this._isVisible=!1,clearTimeout(this.clearTimeout),this.clearTimeout=void 0,this.onCloseFn&&this.onCloseFn(this),noNotify||this.owner.onMessageHide(this))},isVisible:function isVisibleFn(){return this._isVisible},doAction:function doActionFn(e){if(this.isVisible()){if(g.isFunction(this.action))this.action();else switch(this.action){case MessageAction.None:case MessageAction.Okay:case MessageAction.Default:break;case MessageAction.Reload:g.reload();break;case MessageAction.Login:util.removeURLParam("demo");break;case MessageAction.Demo:util.insertURLParam("demo","true");break;case MessageAction.ResetClient:d.clearData(function(){g.reload()});break;case MessageAction.OpenURL:var targetUrl=this.data?this.data.url:void 0;try{g.PAssert(3235,targetUrl,"Should always have a valid URL to navigate")}catch(PERR){g.reportError(PERR)}targetUrl&&g.openUrl(targetUrl);break;case MessageAction.Blog:g.openUrl("https://www.moo.do/blog/updates");break;case MessageAction.Undo:tracker.undoAction();break;case MessageAction.LoginScreen:util.removeURLParam("demo",!0),util.removeURLParam("dmode");break;case MessageAction.Contact:g.menus.openModal(Modals.ReportBug);break;case MessageAction.OpenSettings:g.menus.openModal(Modals.Settings,SettingsSections.Plugins);break;case MessageAction.OpenAccountSettings:g.menus.openModal(Modals.Settings,SettingsSections.Account);break;case MessageAction.OpenGoogleDrive:g.openUrl("https://drive.google.com");break;default:try{g.PAssert(3236,!1,"Invalid message action, add a new case here or pass in a function",this.action)}catch(PERR){g.reportError(PERR)}}this.hide(),e.preventDefault(),e.stopImmediatePropagation(),e.returnFalse=!0}},onTapIgnore:{onStart:g.handlerPreventStop,onClick:function onClickFn(e){this.isVisible()&&!this.noIgnore&&(this.hide(),e.preventDefault(),e.stopImmediatePropagation(),e.returnFalse=!0)}}},VMMessage}),define("VMMessageQueue",["ko","globals","util","platform","data","VMMessage"],function(ko,g,util,platform,d,VMMessage){function VMMessageQueue(){this.queue=ko.observableArray(),this.remoteMessages={},this.defaultMessages=[],this.defaultMessages[MessageID.Undefined]=void 0,g.messageQueue=this,this.init()}return VMMessageQueue.prototype={init:function initFn(){try{g.PAssert(3237,0===this.queue().length,"There should never be items in the queue when initializing the message queue: ",this.queue().length)}catch(PERR){g.reportError(PERR)}try{}catch(err){g.reportError(err,"Error binding message queue: ",this.queue().length)}},getMessageById:function getMessageByIdFn(id){void 0===this.defaultMessages[id]&&this.initMessageByid(id);try{g.PAssert(3238,void 0!==this.defaultMessages[id],"After init message should always be defined")}catch(PERR){g.reportError(PERR)}return this.defaultMessages[id]},testMessageById:function testMessageByIdFn(id){return!!this.defaultMessages[id]},initMessageByid:function initMessageByidFn(id){switch(id){case MessageID.ConnectionError:this.defaultMessages[id]=new VMMessage({text:"Connection error detected. Please reload to try again.",action:MessageAction.Reload},this);break;case MessageID.OfflineUndo:this.defaultMessages[id]=new VMMessage({text:"Offline undo/redo has been disabled temporarily.",hold:!0},this);break;case MessageID.FatalError:this.defaultMessages[id]=new VMMessage({text:"There was a fatal error in the application. "+platform.actionVerbCaps()+" to restart.",action:MessageAction.Reload},this);break;case MessageID.MailbirdClick:this.defaultMessages[id]=new VMMessage({text:"Sorry, emails can currently only be opened from inside Mailbird.",action:MessageAction.Okay},this);break;case MessageID.ExitDemo:this.defaultMessages[id]=new VMMessage({text:"Changes are not saved in demo",action:MessageAction.LoginScreen,hold:!0,noIgnore:!0},this);break;case MessageID.ShareFailure:this.defaultMessages[id]=new VMMessage({text:"There was an error sharing the file you attached.",action:MessageAction.OpenSettings,timeout:8e3},this);break;case MessageID.ThisIsDemo:this.defaultMessages[id]=new VMMessage({text:"Click anywhere to try this live demo of <b>Moo.do</b>",hold:!0},this);break;case MessageID.InviteFailure:this.defaultMessages[id]=new VMMessage({text:"Failed to use referral code. Please try again in your account settings.",action:MessageAction.OpenAccountSettings},this);break;case MessageID.InviteSuccess:this.defaultMessages[id]=new VMMessage({text:"You have successfully used your referral code. Enjoy your free month of premium Moo.do!",action:MessageAction.Okay},this);break;case MessageID.PremiumRequired:this.defaultMessages[id]=new VMMessage({text:"You must be a premium subscriber to use plugins.",action:MessageAction.OpenAccountSettings,actionText:"LEARN MORE"},this);break;case MessageID.TrialOver:this.defaultMessages[id]=new VMMessage({text:"Your free month of Premium has come to an end. Please sign up to continue using Premium features.",action:MessageAction.OpenAccountSettings,actionText:"SETTINGS"},this);break;case MessageID.TrialEndSoon:this.defaultMessages[id]=new VMMessage({text:"Your free month of Premium is ending soon. Please sign up to continue using Premium features after your trial ends.",action:MessageAction.OpenAccountSettings,actionText:"SETTINGS"},this);break;case MessageID.DisabledFolderDrop:this.defaultMessages[id]=new VMMessage({text:"Drag/dropping folders is currently disabled while we polish some rough edges. Sorry for the inconvienience, please contact support@moo.do if you need this.",action:MessageAction.Okay},this);break;case MessageID.WarnLargeFile:this.defaultMessages[id]=new VMMessage({text:"Warning: You are uploading a large file. If the upload is not successful, try uploading directly to Google Drive.",action:MessageAction.OpenGoogleDrive},this);break;case MessageID.InviteInvalid:this.defaultMessages[id]=new VMMessage({text:"Invalid referral code. Please try again in your account settings.",action:MessageAction.OpenAccountSettings,actionText:"OKAY"},this);break;case MessageID.NoSharingWarning:this.defaultMessages[id]=new VMMessage({text:"You have shared your document with someone else, however the files attached have not been shared due to your permissions settings.",action:MessageAction.OpenSettings,actionText:"SETTINGS"},this);break;case MessageID.LostPermission:this.defaultMessages[id]=new VMMessage({text:"Moo.do has lost permissions for a plugin or option you enabled. Please update your plugin settings.",action:MessageAction.OpenSettings,actionText:"SETTINGS"},this);break;default:try{g.PAssert(3239,!1,"Invalid MessageID")}catch(PERR){g.reportError(PERR)}}},pushMessage:function pushMessageFn(msg){var vmMsg;if(msg instanceof VMMessage)vmMsg=msg;else if(g.isObject(msg))vmMsg=new VMMessage(msg,this);else if(g.isString(msg))vmMsg=new VMMessage({text:msg},this);else if(vmMsg=this.getMessageById(msg),!vmMsg){try{g.PAssert(3240,!1,"Invalid data passed to message creation")}catch(PERR){g.reportError(PERR)}log("Message not created properly",msg)}return vmMsg&&vmMsg.show(),vmMsg},clearMessage:function clearMessageFn(msg){var vmMsg;return msg instanceof VMMessage?vmMsg=msg:this.testMessageById(msg)&&(vmMsg=this.getMessageById(msg)),vmMsg&&vmMsg.hide(),vmMsg},onMessageShow:function onMessageShowFn(msg){try{g.PAssert(3241,msg,"Must pass in a valid message to add to the queue")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3242,msg&&msg.doAction,"Message added to queue must have valid API exposed - doAction")}catch(PERR){g.reportError(PERR)}msg instanceof VMMessage?this.queue.push(msg):g.reportError(new Error("Overlay message must be an instance of VMMessage"),msg)},onMessageHide:function onMessageHideFn(msg){try{g.PAssert(3243,msg,"Must pass in a valid message to be removed from the queue")}catch(PERR){g.reportError(PERR)}var index=this.queue.indexOf(msg);if(0>index)try{g.PAssert(3244,!1,"Trying to remove an invalid message from the queue")}catch(PERR){g.reportError(PERR)}else this.queue.splice(index,1)}},VMMessageQueue}),define("VMAttachment",["globals","util","VMLI","International"],function(g,util,VMLI,International){function VMAttachment(plugin,id){this.id=id,this._plugin=plugin,this._loadState=LoadState.Unloaded,this._requestedLoadState=void 0,this._subscribers=[],this._countInUse=0,this._iteratingSubscribers=!1,this.init()}var LoadState={Unloaded:1,Waiting:2,Requesting:3,LoadedPreview:4,LoadedFull:5,FailedRequest:6,Updating:7};return VMAttachment.prototype={init:function initFn(){this.load()},load:function loadFn(requestedState){this._loadState=LoadState.Waiting,this._requestedLoadState=requestedState,this._plugin.requestData(this,requestedState)},notifyDataRequested:function notifyDataRequestedFn(){try{g.PAssert(3245,!this.isLoaded(),"Should not request additional data once loaded")}catch(PERR){g.reportError(PERR)}this._loadState=LoadState.Requesting},notifyDataLoaded:function notifyDataLoadedFn(type,isUpdate){try{g.PAssert(3246,isUpdate||this._loadState!==LoadState.LoadedFull||type!==PluginLoad.Preview,"Should not load preview data after full data has been loaded")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3247,!isUpdate||this._loadState===LoadState.LoadedPreview||type===PluginLoad.Full,"Incoming update much match previous type")}catch(PERR){g.reportError(PERR)}this._loadState=type===PluginLoad.Preview?LoadState.LoadedPreview:LoadState.LoadedFull,this.onUpdate(!0)},notifyDataRequestFailed:function notifyDataRequestFailedFn(){try{g.PAssert(3248,this._loadState===LoadState.Requesting||this._loadState===LoadState.LoadedPreview,"Must be requesting remote data or a preview cache was able to service after the request was sent")}catch(PERR){g.reportError(PERR)}if(this._loadState===LoadState.Requesting)this._loadState=LoadState.FailedRequest;else if(this._loadState===LoadState.LoadedPreview)try{g.PAssert(3249,!1,"Failed remote reuqest but serviced by preview cache, should not have made the request?")}catch(PERR){g.reportError(PERR)}else try{g.PAssert(3250,!1,"Invalid loadstate when remote request failed: ",this._loadState)}catch(PERR){g.reportError(PERR)}},isLoaded:function isLoadedFn(){return this._loadState===LoadState.LoadedPreview||this._loadState===LoadState.LoadedFull},needsRemoteData:function needsRemoteDataFn(){return this._loadState!==LoadState.LoadedFull},changeID:function changeIDFn(newID){var oldID=this.id;this.id=newID;try{g.PAssert(3251,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(PERR){g.reportError(PERR)}this._iteratingSubscribers=!0;for(var i=0;i<this._subscribers.length;++i)this._subscribers[i].onAttachmentIDChange(this,oldID);this._iteratingSubscribers=!1},delayChangeID:function delayChangeIDFn(){try{g.PAssert(3252,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(PERR){g.reportError(PERR)}this._iteratingSubscribers=!0;for(var i=0;i<this._subscribers.length;++i){var subscriber=this._subscribers[i],changeFn=subscriber.onAttachmentIDChange.bind(subscriber,this,this.id);setTimeout(changeFn,0)}this._iteratingSubscribers=!1},isFieldDefined:function isFieldDefinedFn(field){return this._plugin.isFieldDefined(field)},hasField:function hasFieldFn(field){return this._plugin.hasAttachField(this,field)},getField:function getFieldFn(field){return this._plugin.getAttachField(this,field)},updateField:function updateFieldFn(field,value){return this._plugin.updateAttachField(this,field,value)},isFieldDefault:function isFieldDefaultFn(field){return this._plugin.isAttachFieldDefault(this,field)},fieldNeedsWrite:function fieldNeedsWriteFn(field,value){return this._plugin.fieldNeedsWrite(this,field,value)},getFieldAsDate:function getFieldAsDateFn(field){var value=this._plugin.getAttachField(this,field);if(value){var date=new Date(value);return date.toString(International.getFormat(DFormat.MonthDay))}try{g.PAssert(3253,!1,"Invalid attachment date field: ",this._plugin.id,field)}catch(PERR){g.reportError(PERR)}return void 0},getPlugin:function getPluginFn(){return this._plugin},getData:function getDataFn(){return this._plugin.getCacheData(this.id)},getEmbedString:function getEmbedStringFn(){return this._plugin.getAttachmentEmbedString(this)},getTitleString:function getTitleStringFn(){return this._plugin.getAttachmentTitleString(this)},unload:function unloadFn(){this._loadState=LoadState.Unloaded,this._plugin.releaseAttachment(this)},match:function matchFn(text){return this.isLoaded()?this._plugin.matchAttachment(this,text):!1},markInUse:function markInUseFn(changeType){0===this._countInUse&&this._plugin.notifyAttachmentInUse(this,changeType),this._countInUse++},markUnused:function markUnusedFn(changeType){this._countInUse--,0===this._countInUse&&this._plugin.notifyAttachmentUnused(this,changeType);try{g.PAssert(3254,this._countInUse>=0,"Should never have negative users of the attachment")}catch(PERR){g.reportError(PERR)}},isInUse:function isInUseFn(){return this._countInUse>0},subscribe:function subscribeFn(subscriber){try{g.PAssert(3255,this._subscribers.indexOf(subscriber)<0,"Must not double subscribe")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3256,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(PERR){g.reportError(PERR)}this._subscribers.push(subscriber)},unsubscribe:function unsubscribeFn(subscriber){try{g.PAssert(3258,this._subscribers.indexOf(subscriber)>=0,"Subscriber should be active")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3259,!this._iteratingSubscribers,"Should not modify subscriptions during iteration")}catch(PERR){g.reportError(PERR)}this._subscribers.remove(subscriber)},forEachItem:function forEachItemFn(itemStore,cb){try{g.PAssert(3261,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(PERR){g.reportError(PERR)}this._iteratingSubscribers=!0;for(var i=0;i<this._subscribers.length;++i)this._subscribers[i]instanceof VMLI&&(!itemStore||this._subscribers[i].belongsToItemStore(itemStore))&&cb(this._subscribers[i]);this._iteratingSubscribers=!1},onUpdate:function onUpdateFn(dataUpdated){dataUpdated&&this.isInUse()&&this._plugin.notifyAttachmentUpdated(this);try{g.PAssert(3262,!this._iteratingSubscribers,"Should not nest subscriber iterations")}catch(PERR){g.reportError(PERR)}this._iteratingSubscribers=!0;for(var i=0;i<this._subscribers.length;++i)this._subscribers[i].onAttachmentUpdate(this);this._iteratingSubscribers=!1},isLocalOnlyAttachment:function isLocalOnlyAttachmentFn(){return g.isTempId(this.id)},shouldBeDeleted:function shouldBeDeletedFn(){return this.isFieldDefined("isDeleted")&&this.hasField("isDeleted")&&this.getField("isDeleted")&&this.isLocalOnlyAttachment()}},util.defineBase(VMAttachment),VMAttachment}),define("PluginRenderer",["globals","util","VMAttachment","Measure","International"],function(g,util,VMAttachment,Measure,International){function PluginRenderer(){this._registeredRenderers=[],this._registeredRenderers[PluginRenderTypes.Generic]={},this._registeredRenderers[PluginRenderTypes.StyledText]={},this._registeredRenderers[PluginRenderTypes.UnstyledText]={},this._registeredRenderers[PluginRenderTypes.AutocompleteText]={},this._registeredRenderers[PluginRenderTypes.AgendaEntry]={},this._registeredRenderers[PluginRenderTypes.Measure]={}}return PluginRenderer.prototype={registerDefaultRenderers:function registerDefaultRenderersFn(){var renderer=this;this.registerRenderer(PluginRenderTypes.StyledText,PluginRenderers.DriveFile,function(attach){return attach.isLoaded()?attach.hasField("isDeleted")&&attach.getField("isDeleted")?attach.getField("title")+"  (Deleted)":attach.getField("title"):attach.hasField("title")?attach.getField("title")+"  (Loading...)":"Loading..."},["title"]),this.registerRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.DriveFile,function(attach){return attach.hasField("title")?attach.getField("title"):"Loading..."},["title"]),this.registerRenderer(PluginRenderTypes.AutocompleteText,PluginRenderers.DriveFile,function(data,searchText){var text='<div class="autocompleteDrive">';if(data.parents||data.modifiedDate){if(text+='<div class="metadata">',data.parents){text+='<span class="folderNames">';for(var i=0;i<data.parents.length;++i){var t=data.parents[i].title;i>0&&(text+=", "),text+=t?t:"My Drive"}text+="</span>"}if(data.modifiedDate){var displayFormat;displayFormat=International.getFormat(data.modifiedDate.isToday()?DFormat.ShortTime:DFormat.MonthDay),text+='<span class="modified">'+data.modifiedDate.toString(displayFormat)+"</span>"}text+="</div>"}text+='<p class="plugin plugin_drive '+this.getMimetypeClass(data.mimeType)+'">';var text2="</p></div>",index=data.titleLower.indexOf(searchText);return index>=0&&(index+=text.length),{text:text+data.title+text2,index:index}},["mimeType","title","titleLower","parents","modifiedDate"]),this.registerRenderer(PluginRenderTypes.Measure,PluginRenderers.DriveFile,function(attach,pane,wordStyles){var renderFn=renderer.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.DriveFile);return Measure.measureWord(pane,renderFn(attach),wordStyles,!1)},["title"]),this.registerRenderer(PluginRenderTypes.StyledText,PluginRenderers.EmailThread,function(attach){var content;if(attach.isLoaded()){var subject=attach.getField("subject");subject&&""!==subject||(subject="(no subject)"),content='<span class="from">'+attach.getField("from")+'</span><span class="subject">'+subject+"</span>",attach.hasField("snippet")&&(content+='<span class="snippet">'+attach.getField("snippet")+"</span>")}else content="Loading...";return content},["from","subject","snippet"]),this.registerRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.EmailThread,function(attach){var subject=attach.getField("subject");return subject&&""!==subject||(subject="(no subject)"),attach.isLoaded()?"From: "+attach.getField("from")+" - "+subject:"Loading..."},["from","subject"]),this.registerRenderer(PluginRenderTypes.AutocompleteText,PluginRenderers.EmailThread,function(data,searchText){var subject=data.subject;subject&&""!==subject||(subject="(no subject)");var text='<p class="plugin plugin_gmail"><span class="from">',from=data.from,text2='</span><span class="subject">',text3=subject+"</span></p>",index=data.fromLower.indexOf(searchText);return index>=0?index+=text.length:(index=data.subjectLower.indexOf(searchText),index+=text.length+from.length+text2.length),{text:text+from+text2+text3,index:index}},["from","subject","fromLower","subjectLower"]),this.registerRenderer(PluginRenderTypes.Measure,PluginRenderers.EmailThread,function(attach,pane,wordStyles){var measureText;if(attach.isLoaded()){var measureText=attach.getField("subject");measureText&&""!==measureText||(measureText="(no subject)")}else measureText="Loading...";return Measure.measureWord(pane,measureText,wordStyles,!1)},[]),this.registerRenderer(PluginRenderTypes.AgendaEntry,PluginRenderers.CalendarEvent,function(attach){return"Agenda Entry!"},[]),this.registerRenderer(PluginRenderTypes.StyledText,PluginRenderers.CalendarEvent,function(attach){var content;return content=attach.isLoaded()?attach.getField("summary"):"Loading..."},["summary"]),this.registerRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.CalendarEvent,function(attach){return"Unstyled Text!"},[]),this.registerRenderer(PluginRenderTypes.AutocompleteText,PluginRenderers.CalendarEvent,function(data,searchText){return"ACText!"},[]),this.registerRenderer(PluginRenderTypes.Measure,PluginRenderers.CalendarEvent,function(attach,pane,wordStyles){var renderFn=renderer.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.CalendarEvent);return Measure.measureWord(pane,renderFn(attach),wordStyles,!1)},[])},registerRenderer:function registerRendererFn(type,id,fn,fields){try{g.PAssert(3263,this._registeredRenderers[type],"Invalid renderer type",type,id)}catch(PERR){g.reportError(PERR)}try{g.PAssert(3264,!this._registeredRenderers[type][id],"Cannot register a renderer twice",type,id)}catch(PERR){g.reportError(PERR)}this._registeredRenderers[type][id]={fn:fn,fields:fields}},useRenderer:function useRendererFn(type,id){try{g.PAssert(3265,this._registeredRenderers[type],"Invalid renderer type",type,id)}catch(PERR){g.reportError(PERR)}try{g.PAssert(3266,this._registeredRenderers[type][id],"Renderer has not been registered yet",type,id)}catch(PERR){g.reportError(PERR)}return this._registeredRenderers[type][id].fn},ensureRendererFields:function ensureRendererFieldsFn(type,id,plugin){}},PluginRenderer}),define("VMPlugin",["globals","util","data","goog","gdata","PaneFactory","PluginRenderer","VMAttachment","Measure"],function(g,util,d,goog,gdata,PaneFactory,PluginRenderer,VMAttachment,Measure){function VMPlugin(id,name){try{g.PAssert(3267,id,"Must supply a valid id")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3268,name,"Must supply a valid name")}catch(PERR){g.reportError(PERR)}this.id=id,this.name=name,this._previewCache="p_"+id,this._offlineCache="ocache_"+id,this._paneType="Pane"+id,this._rootId=id+"Root",this._acProviderId="AC"+id,this._settingsGroup="plugin"+this.id,this.loadedEvent="Plugin_"+id+"_Loaded",this._isActive=!1,this._isReady=!1,this._propertyDescriptors={},this._propertySets={},this._registeredAutocomplete=!1,this._attachKeys=[],this._attachCache={},this._dataKeys=[],this._dataCache={},this._scorchOfflineCache=!1,this._defaultItemStore=void 0,this._activeItemStore={},this._pastSearches={},this._searchBuckets={},this._activeSearchBucket={},this._numDeferredReqs=0,this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._activeAttachments=[],this._numActivePanes=0,this._requestCounter=0,this._unloadedDependencies=this.getDependencies(),this._isFirstLoad=!0,this._hasRunOfflineLoad=!1,this._loadedInitialData=!1,this._hasLoadedCaches=!1,this._registeredModals={},this._createdModals={},util.forceBind("_retryRemoteRequest",this),g.settings.registerGroup(this._settingsGroup),this.registerSetting("isEnabled",this._settingsGroup,!0),this.getDataPane()&&PaneFactory.registerPaneType(this,this._paneType,this.name,this.getDataPane(),this.getPaneIcon()),DETAILED_STATS&&(this.__Stats={requestData:0,remoteRequests:0,canceledRequests:0,dupedRequests:0,remoteBatches:0,remoteRetries:0,canceledBatches:0,actualRemoteCallsSent:0,cacheWrites:0,cacheUpdates:0,findByField:0,createdAttachments:0,previewCacheIsAvailable:0,previewCacheUpdate:0,previewCacheQuery:0},this.__ReqStats=[]),this.declareProperty("cssClass",PluginLoad.Runtime,!0),this.onSettingChanged("isEnabled",function(oldValue,newValue){newValue&&g.vmMain.pluginManager.activatePlugin(this)}.bind(this))}var retryTimeouts=[0,5,15,35,80,170],retryErrorCodes=[0,408,500,502,503,504],maxBatchSize=10,pluginDependencyInfo={};return pluginDependencyInfo[PluginDependency.DemoMode]={online:!1},pluginDependencyInfo[PluginDependency.DriveAPI]={online:!0},pluginDependencyInfo[PluginDependency.GmailAPI]={online:!0},pluginDependencyInfo[PluginDependency.CalendarAPI]={online:!0},pluginDependencyInfo[PluginDependency.GoogleLogin]={online:!0},pluginDependencyInfo[PluginDependency.PremiumSub]={online:!1},pluginDependencyInfo[PluginDependency.EarlyAccess]={online:!1},VMPlugin.prototype={getSetting:function getSettingFn(key){return g.settings.get(key,this._settingsGroup)},setSetting:function setSettingFn(key,value){return g.settings.set(key,value,this._settingsGroup)},onAuthorizedSetting:function onAuthorizedSettingFn(key,value){},registerSetting:function registerSettingFn(key,syncRemote){g.settings.registerSetting(key,this._settingsGroup,syncRemote),d.addDefaultSkipSetting(key,this._settingsGroup)},onSettingChanged:function onSettingChangedFn(key,cb){g.settings.registerForChangeNotification(key,this._settingsGroup,cb)},registerLocalCache:function registerLocalCacheFn(name,storageType){return g.vmMain.cacheManager.registerLocalCache(this.id,name,storageType)},createRecurringTask:function createRecurringTaskFn(id,options){return g.vmMain.taskManager.createRecurringTask(this.id+"_"+id,options)},getRecurringTask:function getRecurringTaskFn(id){return g.vmMain.taskManager.getRecurringTask(this.id+"_"+id)},registerModal:function registerModalFn(id,constructor){var modalID=this.id+"_"+id;try{g.PAssert(3269,!this._registeredModals[modalID],"Modal already registered with this ID: "+id)}catch(PERR){g.reportError(PERR)}this._registeredModals[modalID]=constructor},openModal:function openModalFn(id,data){var modalID=this.id+"_"+id;this._createdModals[modalID]||(this._createdModals[modalID]=new this._registeredModals[modalID](modalID));var modal=this._createdModals[modalID];modal.openDialog(data)},closeModal:function closeModalFn(id){var modalID=this.id+"_"+id,modal=this._createdModals[modalID];try{g.PAssert(3270,modal,"Must have already created modal to close it")}catch(PERR){g.reportError(PERR)}modal.closeDialog()},getStats:function getStatsFn(){return{fnCalls:DETAILED_STATS?this.__Stats:void 0,remoteReqs:DETAILED_STATS?this.__ReqStats:void 0,numItems:this._defaultItemStore?this._defaultItemStore.getCount():-1,activeAttachments:this._activeAttachments.length,numAttach:this._attachKeys.length,numDataCache:this._dataKeys.length}},isPluginPane:function isPluginPaneFn(pane){return pane.type===this._paneType},activate:function activateFn(loadedDeps){if(!this._isActive){if(this._isActive=!0,this.useItemStore()&&(this._defaultItemStore=g.vmMain.itemStoreManager.registerItemStore(this.id,this,this.itemStoreOptions()),this._defaultItemStore.createRoot(this._rootId,this.useItemStore())),this._hasLoadedCaches||(this.usesPreviewCache()&&this.registerPreviewCache(),this.supportOfflineCache()&&g.shouldWriteLocal()&&this.loadOfflineCache(),this._hasLoadedCaches=!0),this.ensurePaneTypeIsActive(),this.registerAutocomplete(),this._unloadedDependencies)for(var dep in loadedDeps)this.onDependencyLoaded(dep,loadedDeps[dep]);return this._unloadedDependencies||this.onAllDependenciesLoaded(),!0}return!1},deactivate:function deactivateFn(){try{g.PAssert(3271,this._isActive,"Must be active in order to deactivate pane")
}catch(PERR){g.reportError(PERR)}return this._isActive=!1,this.unregisterAutocomplete(),this.getDataPane()&&g.vmMain.paneFactory.deactivatePaneType(this._paneType),this.useItemStore()&&(g.vmMain.itemStoreManager.unregisterItemStore(this.id),this._defaultItemStore=void 0),this._loadedInitialData=!1,!0},ensurePaneTypeIsActive:function ensurePaneTypeIsActiveFn(){var premiumIsValid=!this.hasDependency(PluginDependency.PremiumSub)||g.billingManager.hasPremiumFeatures();premiumIsValid&&this.getDataPane()&&!PaneFactory.isPaneTypeActive(this._paneType)&&this.getSetting("isEnabled")&&PaneFactory.activatePaneType(this._paneType)},isActive:function isActiveFn(){return this._isActive},isReady:function isReadyFn(){return this._isReady},goOnline:function goOnlineFn(){},goOffline:function goOfflineFn(){},onDocumentShared:function onDocumentSharedFn(firstShare){},onDependencyLoaded:function onDependencyLoadedFn(dep,data){if(this._unloadedDependencies){var depIndex=this._unloadedDependencies.indexOf(dep);if(depIndex>=0&&(this.isDependencyLoaded(dep,data)&&this._unloadedDependencies.removeAt(depIndex),dep===PluginDependency.PremiumSub&&this.ensurePaneTypeIsActive()),0===this._unloadedDependencies.length)this._unloadedDependencies=void 0,this.onAllDependenciesLoaded();else if(this.supportOfflineLoad()&&!this._hasRunOfflineLoad){for(var hasOfflineDep=!1,i=0;i<this._unloadedDependencies.length;++i){var unloadedDep=this._unloadedDependencies[i];pluginDependencyInfo[unloadedDep].online||(hasOfflineDep=!0)}!hasOfflineDep&&this._isActive&&this.offlineLoad()}}},onAllDependenciesLoaded:function onAllDependenciesLoadedFn(){this._isActive&&(this._isReady=!0,g.vmMain.paneManager.runForEachPane(function(pane){pane.isNotReady=!1},this._paneType),this._updateAttachmentStates(),this.offlineLoad(),this.load())},areDependenciesLoaded:function areDependenciesLoadedFn(){return void 0===this._unloadedDependencies},isDependencyLoaded:function isDependencyLoadedFn(dep,data){return!0},getUnloadedDependencies:function getUnloadedDependenciesFn(){return this._unloadedDependencies},loadRemoteAPIs:function loadRemoteAPIsFn(){},forceLoad:function forceLoadFn(){this._loadedInitialData=!1,this.activate(),this._unloadedDependencies&&(this._unloadedDependencies=void 0,this.onAllDependenciesLoaded())},authorize:function authorizeFn(cb){try{g.PAssert(3272,cb&&g.isFunction(cb),"Must provide a valid authoirzation callback")}catch(PERR){g.reportError(PERR)}this.googleScopes()?this._authorizeGoogle(cb):cb(!0)},_authorizeGoogle:function _authorizeGoogleFn(cb){try{g.PAssert(3273,this.googleScopes(),"Must have a valid google scope to request")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3274,cb&&g.isFunction(cb),"Must provide a valid authoirzation callback")}catch(PERR){g.reportError(PERR)}goog.runAuthenticate(this.googleScopes(),!1,!1,function(token){cb(token&&!token.error?!0:!1)}.bind(this))},googleScopes:function googleScopesFn(){return void 0},getDependencies:function getDependenciesFn(){return void 0},hasDependency:function hasDependencyFn(dep){var deps=this.getDependencies();return deps?deps.indexOf(dep)>=0:!1},getOfflineCacheName:function getOfflineCacheNameFn(){return this._offlineCache},loadOfflineCache:function loadOfflineCacheFn(){try{g.PAssert(3275,0===this._dataKeys.length,"Must have no data already loaded")}catch(PERR){g.reportError(PERR)}if(this.supportOfflineCache()&&g.shouldWriteLocal()){var inString=util.storage.getItem(this.getOfflineCacheName());if(inString)try{var inObj=JSON.parse(inString);inObj&&this.loadDataFromObject(inObj)}catch(err){g.reportError(err)}}},loadDataFromObject:function loadDataFromObjectFn(inObj){try{g.PAssert(3276,inObj,"Must provide a valid dataset to load")}catch(PERR){g.reportError(PERR)}var props=inObj.props,data=inObj.data;try{g.PAssert(3277,data,"Load object must contain valid data")}catch(PERR){g.reportError(PERR)}this._dataKeys=Object.keys(data);for(var i=0;i<this._dataKeys.length;++i){var key=this._dataKeys[i];this._dataCache[key]=this.createEntryFromLocal(key,data[key]),this._dataCache[key].id=key}},saveOfflineCache:function saveOfflineCacheFn(){if(this.supportOfflineCache()&&g.shouldWriteLocal()&&!this._scorchOfflineCache){for(var numEntries=0,outObjData={},i=0;i<this._activeAttachments.length;++i){var attach=this._activeAttachments[i];try{g.PAssert(3278,attach.isInUse(),"Attachments in the active list should always be in use")}catch(PERR){g.reportError(PERR)}if(attach.isInUse()){var serialObj=this.serializeEntry(attach.id);serialObj&&(outObjData[attach.id]=serialObj,numEntries++)}}var outObj={data:outObjData,info:{writeDate:Date.now(),entries:numEntries}};try{var outString=JSON.stringify(outObj);util.storage.setItem(this.getOfflineCacheName(),outString)}catch(err){g.reportError(err)}}},clearOfflineCache:function clearOfflineCacheFn(noFutureSave){this.supportOfflineCache()&&g.shouldWriteLocal()&&(util.storage.removeItem(this.getOfflineCacheName()),noFutureSave&&(this._scorchOfflineCache=!0))},supportOfflineLoad:function supportOfflineLoadFn(){return!1},supportOfflineCache:function supportOfflineCacheFn(){return!1},createEntryFromLocal:function createEntryFromLocalFn(id,info){try{g.PAssert(3279,!1,"SubClass must override")}catch(PERR){g.reportError(PERR)}},clearData:function clearDataFn(){for(var i=0;i<this._attachKeys.length;++i)this._attachCache[this._attachKeys[i]].unload();this._attachKeys=[],this._attachCache={},this._dataKeys=[],this._dataCache={},this.useItemStore()&&(this.getDefaultItemStore().clearStore(),this._activeItemStore={}),this._pastSearches={},this._searchBuckets={},this._activeSearchBucket={},this._numDeferredReqs=0,this._numOutstandingReqs=0,this._pendingRequests=[],this._outstandingRequests=[],this._activeAttachments=[]},changeID:function changeIDFn(attach,oldID,newID){try{g.PAssert(3280,oldID!==newID,"Should never be switching to the same ID")}catch(PERR){g.reportError(PERR)}var checkNewAttachID=this._attachCache[newID];if(checkNewAttachID)attach.delayChangeID(newID),this._attachCache[oldID]=void 0,this._attachKeys.remove(oldID),this._dataCache[oldID]=void 0,this._dataKeys.remove(oldID);else{var attachEntry=this._attachCache[oldID];try{g.PAssert(3281,attach===attachEntry,"Attach entries must match")}catch(PERR){g.reportError(PERR)}attachEntry&&(this._attachCache[oldID]=void 0,this._attachCache[newID]=attachEntry,this._attachKeys.remove(oldID),this._attachKeys.push(newID));var entry=this._dataCache[oldID];this._dataCache[oldID]=void 0,this._dataCache[newID]=entry,this._dataKeys.remove(oldID),this._dataKeys.push(newID),attach.changeID(newID)}},_isPreviewData:function _isPreviewDataFn(data){for(var props=this.getPropertySet(PluginLoad.Preview),i=0;i<props.length;++i){var desc=this.getPropertyDescriptor(props[i]);if(!desc.isOpt&&!data.hasOwnProperty(props[i]))return!1}return!0},_isFullData:function _isFullDataFn(data){for(var props=this.getPropertySet(PluginLoad.Full),i=0;i<props.length;++i){var desc=this.getPropertyDescriptor(props[i]);if(!desc.isOpt&&!data.hasOwnProperty(props[i]))return!1}return!0},cacheData:function cacheDataFn(key,data,isUpdate){try{g.PAssert(3282,key,"Must supply a valid key for data")}catch(PERR){g.reportError(PERR)}DETAILED_STATS&&this.__Stats.cacheWrites++;var oldData=this._dataCache[key];if(this._dataCache[key]=data,oldData?DETAILED_STATS&&this.__Stats.cacheUpdates++:this._dataKeys.push(key),this._attachCache[key]){var attach=this._attachCache[key],loadState=this._getPluginLoadType(data);try{g.PAssert(3284,loadState,"Must either contain valid preview or full data")}catch(PERR){g.reportError(PERR)}attach.notifyDataLoaded(loadState,isUpdate)}},getCacheData:function getCacheDataFn(key){return this._dataCache[key]},isFieldDefined:function isFieldDefinedFn(field){return!!this.getPropertyDescriptor(field)},hasAttachField:function hasAttachFieldFn(attach,field){var hasField=!1,data=this._dataCache[attach.id];if(data)if(data.hasOwnProperty(field))hasField=!0;else{var desc=this.getPropertyDescriptor(field);try{g.PAssert(3286,desc,"Must have a valid field descriptor",field)}catch(PERR){g.reportError(PERR)}desc&&desc.isOpt&&(hasField=!0)}return hasField},getAttachField:function getAttachFieldFn(attach,field){var value,data=this._dataCache[attach.id];try{g.PAssert(3287,data,"Invalid field request: ",this.id,field)}catch(PERR){g.reportError(PERR)}if(data)if(data.hasOwnProperty(field))value=data[field];else{var desc=this.getPropertyDescriptor(field);try{g.PAssert(3288,desc,"Must have a valid field descriptor",field)}catch(PERR){g.reportError(PERR)}try{g.PAssert(3289,desc.isOpt,"Field must be optional if it is not defined",field)}catch(PERR){g.reportError(PERR)}value=desc?desc.defaultValue:void 0}return value},updateAttachField:function updateAttachFieldFn(attach,field,value){var didUpdate=!1,data=this._dataCache[attach.id];try{g.PAssert(3290,data,"Invalid field request: ",this.id,field)}catch(PERR){g.reportError(PERR)}return data&&(data[field]!==value&&(data[field]=value,this.cacheData(attach.id,data,!0)),didUpdate=!0),didUpdate},isAttachFieldDefault:function isAttachFieldDefaultFn(attach,field){var isDefault=!1,data=this._dataCache[attach.id];try{g.PAssert(3291,data,"Invalid field request: ",this.id,field)}catch(PERR){g.reportError(PERR)}if(data){var desc=this.getPropertyDescriptor(field);try{g.PAssert(3292,desc,"Must have a valid field descriptor",field)}catch(PERR){g.reportError(PERR)}data.hasOwnProperty(field)?desc&&desc.isOpt&&desc.defaultValue===data[field]&&(isDefault=!0):desc&&desc.isOpt&&(isDefault=!0)}return isDefault},fieldNeedsWrite:function fieldNeedsWriteFn(attach,field,value){var data=this._dataCache[attach.id];try{g.PAssert(3293,data,"Invalid field request: ",this.id,field)}catch(PERR){g.reportError(PERR)}return this.dataFieldNeedsWrite(data,field,value)},dataFieldNeedsWrite:function dataFieldNeedsWriteFn(data,field,value){var needsWrite=!1;if(data){var desc=this.getPropertyDescriptor(field);try{g.PAssert(3294,desc,"Must have a valid field descriptor",field)}catch(PERR){g.reportError(PERR)}var compactValue=this.compactCacheField(data,field);data.hasOwnProperty(field)?compactValue!==value&&(needsWrite=!0):void 0!==value&&(desc&&desc.isOpt&&desc.defaultValue===value||(needsWrite=!0))}return needsWrite},hasCacheData:function hasCacheDataFn(key){return!!this._dataCache[key]},findCachedItemsByField:function findCachedItemsByFieldFn(field,value,limit){DETAILED_STATS&&this.__Stats.findByField++;for(var matches=[],i=0;i<this._dataKeys.length;i++){var item=this._dataCache[this._dataKeys[i]];if(item[field]===value&&(matches.push(item),matches.length>=limit))break}return matches},findCachedItemsByFn:function findCachedItemsByFnFn(fn,limit){try{g.PAssert(3295,fn,"Must supply a valid match function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3296,g.isFunction(fn),"Match function must be a valid function")}catch(PERR){g.reportError(PERR)}DETAILED_STATS&&this.__Stats.findByFn++;for(var matches=[],i=0;i<this._dataKeys.length;i++){var item=this._dataCache[this._dataKeys[i]];if(fn(item)&&(matches.push(item),matches.length>=limit))break}return matches},notifyAttachmentInUse:function notifyAttachmentInUseFn(attach,changeType){try{g.PAssert(3297,this._activeAttachments.indexOf(attach)<0,"Attachment should not already be active")}catch(PERR){g.reportError(PERR)}this._activeAttachments.push(attach),g.isLocalChange(changeType)&&this.usesPreviewCache()&&this.isPreviewCacheAvailable()&&attach.isLoaded()&&this.writeAttachmentToPreviewCache(attach)},notifyAttachmentUpdated:function notifyAttachmentUpdatedFn(attach){this.usesPreviewCache()&&this.isPreviewCacheAvailable()&&attach.isLoaded()&&this.writeAttachmentToPreviewCache(attach)},notifyAttachmentUnused:function notifyAttachmentUnusedFn(attach,changeType){try{g.PAssert(3298,this._activeAttachments.indexOf(attach)>=0,"Attachment should be marked active")}catch(PERR){g.reportError(PERR)}this._activeAttachments.remove(attach),g.isLocalChange(changeType)&&this.usesPreviewCache()&&this.isPreviewCacheAvailable()&&attach.isLoaded()&&this.updatePreviewCache(attach.id,void 0)},getAttachment:function getAttachmentFn(key){try{g.PAssert(3299,key,"Must provide a valid key")}catch(PERR){g.reportError(PERR)}return this._attachCache[key]||(this._attachCache[key]=this._requestAttachment(key),this._attachKeys.push(key)),this._attachCache[key]},forEachActiveAttachment:function forEachActiveAttachmentFn(cb){for(var i=0;i<this._activeAttachments.length;++i)cb(this._activeAttachments[i])},numActiveAttachments:function numActiveAttachmentsFn(){return this._activeAttachments.length},getAttachmentEmbedString:function getAttachmentEmbedStringFn(attach){return this._getTextForItem(attach)},getAttachmentTitleString:function getAttachmentTitleStringFn(attach){return this.getUnstyledText(attach)},_getTextForItem:function _getTextForItemFn(item){try{g.PAssert(3300,item,"Must pass in a valid item to get text for")}catch(PERR){g.reportError(PERR)}return window.EmbedAttachChar+"p:"+this.id+",id:"+item.id+window.EmbedAttachChar},_requestAttachment:function _requestAttachmentFn(key){try{g.PAssert(3301,key,"Must provide a valid key")}catch(PERR){g.reportError(PERR)}DETAILED_STATS&&this.__Stats.createdAttachments++;var newAttach=new VMAttachment(this,key);return newAttach},releaseAttachment:function releaseAttachmentFn(attach){},registerPreviewCache:function registerPreviewCacheFn(){var remoteCache=gdata.ensureCache(this._previewCache);gdata.requestNotifyWhenAvailable(this.serviceRemoteRequestsFromPreview.bind(this)),remoteCache||gdata.requestNotifyWhenAvailable(this.writeActiveAttachmentsToPreviewCache.bind(this))},isPreviewCacheAvailable:function isPreviewCacheAvailableFn(){return DETAILED_STATS&&this.__Stats.previewCacheIsAvailable++,gdata.isCacheAvailable(this._previewCache)},updatePreviewCache:function updatePreviewCacheFn(key,value){try{g.PAssert(3302,g.isString(key),"Key must be a valid string")}catch(PERR){g.reportError(PERR)}return DETAILED_STATS&&this.__Stats.previewCacheUpdate++,gdata.updateCache(this._previewCache,key,value)},queryPreviewCache:function queryPreviewCacheFn(key){try{g.PAssert(3303,g.isString(key),"Key must be a valid string")}catch(PERR){g.reportError(PERR)}return DETAILED_STATS&&this.__Stats.previewCacheQuery++,gdata.queryCache(this._previewCache,key)},onPreviewCacheChange:function onPreviewCacheChangeFn(type,id,data){switch(type){case DataChangeType.Add:break;case DataChangeType.Remove:break;case DataChangeType.Change:break;default:try{g.PAssert(3304,!1,"Invalid or unhandled DataChangeType: ",type)}catch(PERR){g.reportError(PERR)}}log("Preview Cache Change: ",arguments)},writeActiveAttachmentsToPreviewCache:function writeActiveAttachmentsToPreviewCacheFn(){gdata.ensureCache(this._previewCache);for(var i=0;i<this._activeAttachments.length;++i){var attach=this._activeAttachments[i];attach.isLoaded()&&this.writeAttachmentToPreviewCache(attach)}},writeAttachmentToPreviewCache:function writeAttachmentToPreviewCacheFn(attach){try{g.PAssert(3305,attach.isLoaded(),"Attachments should have data before saving them")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3306,!attach.isLocalOnlyAttachment(),"Should never write a local-only attachment to the preview cache")}catch(PERR){g.reportError(PERR)}for(var previewProps=this.getPropertySet(PluginLoad.Preview),oldData=this.queryPreviewCache(attach.id),doPreviewUpdate=!oldData,i=0;!doPreviewUpdate&&i<previewProps.length;++i){var field=previewProps[i];attach.fieldNeedsWrite(field,oldData[field])&&(doPreviewUpdate=!0)}doPreviewUpdate&&this.updatePreviewCache(attach.id,this.serializePreview(attach))},dataHasChanged:function dataHasChangedFn(oldData,newData){for(var hasChanged=!oldData,props=this.getPropertySet(PluginLoad.Full),i=0;!hasChanged&&i<props.length;++i){var field=props[i];this.dataFieldNeedsWrite(oldData,field,newData[field])&&(hasChanged=!0)}return hasChanged},serviceRemoteRequestsFromPreview:function serviceRemoteRequestsFromPreviewFn(){for(var i=0;i<this._pendingRequests.length;++i){var requestData=this._pendingRequests[i];if(!g.isFunction(requestData)&&requestData.attach)for(var j=0;j<requestData.attach.length;++j){var previewData=this.queryPreviewCache(requestData.attach[j].id);previewData&&this.cacheData(requestData.attach[j].id,previewData)}}for(var i=0;i<this._activeAttachments.length;++i){var attach=this._activeAttachments[i];if(!attach.isLoaded()&&!attach.isLocalOnlyAttachment()){var previewData=this.queryPreviewCache(attach.id);previewData&&this.cacheData(attach.id,previewData)}}},usesPreviewCache:function usesPreviewCacheFn(){return!1},matchAttachment:function matchAttachmentFn(attach,text){try{g.PAssert(3307,!1,"SubClass must override")}catch(PERR){g.reportError(PERR)}},getStyledText:function getStyledTextFn(attach){try{g.PAssert(3308,!1,"SubClass must override")}catch(PERR){g.reportError(PERR)}},getUnstyledText:function getUnstyledTextFn(attach){try{g.PAssert(3309,!1,"SubClass must override")}catch(PERR){g.reportError(PERR)}},getBlockedText:function getBlockedTextFn(attach){return"Blocked"},useRenderer:function useRendererFn(type,id){var renderer=g.vmMain.pluginManager.useRenderer(type,id),fnName;switch(type){case PluginRenderTypes.StyledText:fnName="getStyledText";break;case PluginRenderTypes.UnstyledText:fnName="getUnstyledText";break;case PluginRenderTypes.AutocompleteText:fnName="getItemStyledText";break;case PluginRenderTypes.AgendaEntry:fnName="getAgendaStyledText";break;case PluginRenderTypes.Measure:fnName="getAttachMeasure";break;default:try{g.PAssert(3310,!1,"Unknown plugin renderer type")}catch(PERR){g.reportError(PERR)}}fnName&&(this[fnName]=renderer)},_getDisplayText:function _getDisplayTextFn(attach){var text;return text=this.isPluginBlocked()?this.getBlockedText(attach):this.getStyledText(attach)},createDisplayElement:function createDisplayElementFn(attach,padBefore,padAfter){var classes=this.getAttachmentClass(attach);try{g.PAssert(3311,g.isArray(classes),"Must have a valid class list")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3312,classes.indexOf("plugin")<0,"Should not already have plugin as a class")}catch(PERR){g.reportError(PERR)}classes.push("plugin"),this.isPluginBlocked()&&classes.push("blocked"),padBefore&&classes.push("padB"),padAfter&&classes.push("padA");var content=this._getDisplayText(attach);return{attrs:{cls:classes,plugin:this.id,"plugin-id":attach.id},text:content}},measureAttachment:function measureAttachmentFn(pane,wordStyles){try{g.PAssert(3313,wordStyles&&wordStyles.attrs&&wordStyles.attrs["plugin-id"],"Must have a valid word style obj with attachment ID")}catch(PERR){g.reportError(PERR)}var width,attach=this.getAttachment(wordStyles.attrs["plugin-id"]);try{g.PAssert(3314,attach,"Must have valid attachment to measure: ",wordStyles.attrs["plugin-id"])}catch(PERR){g.reportError(PERR)}width=this.isPluginBlocked()?Measure.measureWord(pane,this.getBlockedText(attach),attach,wordStyles):this.getAttachMeasure(attach,pane,wordStyles);var pluginMargin=12,pluginPadding=24;if(wordStyles.attrs&&wordStyles.attrs.cls){var cls=wordStyles.attrs.cls;width+=pluginMargin,cls.indexOf("padB")>=0&&(width+=pluginMargin)}return width+=pluginPadding},getAttachmentClass:function getAttachmentClassFn(attach){return""},isPluginBlocked:function isPluginBlockedFn(){return!g.billingManager.hasPremiumFeatures()&&this.hasDependency(PluginDependency.PremiumSub)},_displayMissingProperties:function _displayMissingPropertiesFn(attach,data){try{g.PAssert(3315,!1,"This function is DEBUG only")}catch(PERR){g.reportError(PERR)}var isMissingProps=!1,props=this.getPropertySet(PluginLoad.Preview);log("Displaying Missing Properties: ",attach.id);for(var i=0;i<props.length;++i){var desc=this.getPropertyDescriptor(props[i]);desc.isOpt||data.hasOwnProperty(props[i])||(console.log(" Missing Property: ",props[i]),isMissingProps=!0)}try{g.PAssert(3316,isMissingProps,"Must be missing props to run this")}catch(PERR){g.reportError(PERR)}},_getPluginLoadType:function _getPluginLoadTypeFn(data){try{g.PAssert(3317,data,"Must be querying loaded data for load state with valid data")}catch(PERR){g.reportError(PERR)}var loadState;return this._isPreviewData(data)&&(loadState=this._isFullData(data)?PluginLoad.Full:PluginLoad.Preview),loadState},requestData:function requestDataFn(attach,requestedState){DETAILED_STATS&&this.__Stats.requestData++;var cacheData=this.getCacheData(attach.id);if(cacheData){var loadState=this._getPluginLoadType(cacheData);loadState?attach.notifyDataLoaded(loadState,!1):!attach.isLocalOnlyAttachment()&&this.allowRemoteRequests()&&this.getRemoteAttachmentData(attach)}else if(!attach.isLocalOnlyAttachment()){var loadState;if(this.isPreviewCacheAvailable()){var previewData=this.queryPreviewCache(attach.id);previewData&&(previewData=this.createEntryFromLocal(attach.id,previewData),this.cacheData(attach.id,previewData),loadState=this._getPluginLoadType(previewData),loadState&&attach.notifyDataLoaded(loadState,!1))}this.allowRemoteRequests()&&loadState!==PluginLoad.Full&&this.getRemoteAttachmentData(attach)}},_appendDupeRequest:function _appendDupeRequestFn(queuedRequest,dupeRequest){try{g.PAssert(3318,queuedRequest,"Must provide a valid queued request")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3319,dupeRequest,"Must provide a valid duped request")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3320,!queuedRequest.duped,"Must never use an already duped request as a dupe for another request")}catch(PERR){g.reportError(PERR)}dupeRequest.attach&&(queuedRequest.attach||(queuedRequest.attach=[]),queuedRequest.attach.pushOnlyUniques(dupeRequest.attach)),queuedRequest.successCB.pushOnlyUniques(dupeRequest.successCB),queuedRequest.failureCB.pushOnlyUniques(dupeRequest.failureCB)},_areRequestsEqual:function _areRequestsEqualFn(reqA,reqB){try{g.PAssert(3321,reqA,"Must have a valid request A")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3322,reqB,"Must have a valid request B")}catch(PERR){g.reportError(PERR)}var areEqual=!0;if(reqA.id!==reqB.id&&reqA.requestFn===reqB.requestFn)if(reqA.data===reqB.data)areEqual=!0;else{for(var aProp in reqA.data){if(!reqA.data.hasOwnProperty(aProp)||!reqB.data.hasOwnProperty(aProp)){areEqual=!1;break}if(reqA.data[aProp]!==reqB.data[aProp]){areEqual=!1;break}}if(areEqual)for(var bProp in reqB.data){if(!reqA.data.hasOwnProperty(aProp)||!reqB.data.hasOwnProperty(aProp)){areEqual=!1;break}if(reqA.data[bProp]!==reqB.data[bProp]){areEqual=!1;break}}}else areEqual=!1;return areEqual},_getDupeRequest:function _getDupeRequestFn(request){for(var dupeRequest,i=0;!dupeRequest&&i<this._outstandingRequests.length;++i)!this._outstandingRequests[i].duped&&this._areRequestsEqual(this._outstandingRequests[i],request)&&(dupeRequest=this._outstandingRequests[i]);for(var i=0;!dupeRequest&&i<this._pendingRequests.length;++i)!this._pendingRequests[i].duped&&this._areRequestsEqual(this._pendingRequests[i],request)&&(dupeRequest=this._pendingRequests[i]);return dupeRequest},_handleBatchRequestResponse:function _handleBatchRequestResponseFn(success){this._numOutstandingReqs--;try{g.PAssert(3323,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(PERR){g.reportError(PERR)}},_handleRequestResponse:function _handleRequestResponseFn(attach,wasBatched){if(!wasBatched){this._numOutstandingReqs--;try{g.PAssert(3324,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(PERR){g.reportError(PERR)}}},_queueRemoteRequest:function _queueRemoteRequestFn(requestFn,data,successCB,failureCB,attach,type,options){try{g.PAssert(3325,g.isFunction(requestFn),"RequestFn must be a valid function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3326,data,"Must provide valid data for the request")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3328,successCB,"Must supply a callback for request success")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3329,g.isFunction(successCB),"Success callback must be a valid function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3330,failureCB,"Must supply a callback for request failure")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3331,g.isFunction(failureCB),"Failure callback must be a valid function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3332,type,"Request type must be specified")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3333,!attach||!attach.isLocalOnlyAttachment(),"Must either specify a valid remote attachment or none at all",attach?attach.id:"UNDEFINED")}catch(PERR){g.reportError(PERR)}DETAILED_STATS&&(this.__ReqStats[type]=this.__ReqStats[type]?this.__ReqStats[type]+1:1);var reqObj={id:++this._requestCounter,plugin:this,attach:attach?[attach]:void 0,request:void 0,requestFn:requestFn,data:data,successCB:[successCB],failureCB:[failureCB],type:type,handled:!1,duped:!1,canceled:!1,autoRetry:!options||options.autoRetry};reqObj.autoRetry&&(reqObj.numRetries=options?options.numRetries:3,reqObj.currentRetries=0),this._pendingRequests.push(reqObj),g.vmMain.pluginManager.notifyHasPendingRemoteRequest()},_queuePagedRemoteRequest:function _queuePagedRemoteRequestFn(requestFn,requestData,successCB,failureCB,attach,type,options){try{g.PAssert(3334,options,"Must supply a valid options param")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3335,!options.getAllPages||!options.maxPages,"Should only define either maxPages or getAllPages: ",options.getAllPages,options.maxPages)}catch(PERR){g.reportError(PERR)}options.maxPages=options.maxPages||1,options.getAllPages=options.getAllPages||!1,options.maxPageResults=options.maxPageResults||100,options.maxResults=options.maxResults||1/0;var pagesRequested=0,outResults=[],_requestData=g.clone(requestData);_requestData.maxResuls=options.maxPageResults;var _successCB=function(result){result.items&&outResults.pushArray(result.items),result.nextPageToken&&(options.getAllPages||options.maxPages>pagesRequested)&&outResults.length<options.maxResults?retrievePage(result.nextPageToken):result.nextPageToken||result.nextSyncToken?successCB(outResults,requestData,result):successCB(outResults)},_failureCB=function(response){failureCB(response,outResults)},retrievePage=function(token){token&&(_requestData.pageToken=token),pagesRequested++,this._queueRemoteRequest(requestFn,_requestData,_successCB,_failureCB,void 0,type)}.bind(this);retrievePage()},_retryRemoteRequest:function _retryRemoteRequestFn(requestData){DETAILED_STATS&&this.__Stats.remoteRetries++,setTimeout(function(){requestData.currentRetries=requestData.currentRetries?requestData.currentRetries+1:1,this._pendingRequests.push(requestData),g.vmMain.pluginManager.notifyHasPendingRemoteRequest()}.bind(this),1e3*retryTimeouts[requestData.currentRetries])},_queueDeferredRemoteRequest:function _queueDeferredRemoteRequestFn(fn){this._numDeferredReqs++,this._pendingRequests.push(fn)},getRemoteAttachmentData:function getRemoteAttachmentDataFn(attach){try{g.PAssert(3336,!1,"SubClass must override")}catch(PERR){g.reportError(PERR)}},_pumpRequestQueue:function _pumpRequestQueueFn(maxAllowed,cb,cbBatch){var numRequested=0,numProcessed=0,numCanceled=0,numDuped=0,batchCount=0,availReqs=maxAllowed-this._numOutstandingReqs;try{g.PAssert(3337,availReqs>=0,"Should never have more than max outstanding requests for a given plugin")}catch(PERR){g.reportError(PERR)}var batch;availReqs>1&&this._pendingRequests.length>1&&(batch=this.createBatch());for(var i=0;availReqs>0&&i<this._pendingRequests.length&&maxBatchSize>batchCount;++i){var requestData=this._pendingRequests[i];if(g.isFunction(requestData))requestData(),this._numDeferredReqs--,numProcessed++;else{try{g.PAssert(3338,requestData.handled===!1,"Should never service a request that has already been handled")}catch(PERR){g.reportError(PERR)}var dupeCandidate=this._getDupeRequest(requestData);if(dupeCandidate)DETAILED_STATS&&this.__Stats.dupedRequests++,requestData.duped=!0,numProcessed++,numDuped++,this._appendDupeRequest(dupeCandidate,requestData);else{var doPerformRequest=!1;if(requestData.attach)for(var j=0;j<requestData.attach.length;++j)requestData.attach[j].needsRemoteData()&&(requestData.attach[j].notifyDataRequested(),doPerformRequest=!0);else doPerformRequest=!0;if(doPerformRequest){var wasBatched=this._runRemoteRequest(batch,requestData,cb);DETAILED_STATS&&this.__Stats.remoteRequests++,wasBatched&&0!==batchCount||(numRequested++,availReqs--,this._numOutstandingReqs++,DETAILED_STATS&&this.__Stats.actualRemoteCallsSent++),wasBatched&&batchCount++}else DETAILED_STATS&&this.__Stats.canceledRequests++,requestData.canceled=!0,numCanceled++;numProcessed++}}}for(var sentRequests=this._pendingRequests.splice(0,numProcessed),i=0;i<sentRequests.length;++i)g.isFunction(sentRequests[i])||sentRequests[i].canceled||sentRequests[i].duped||this._outstandingRequests.push(sentRequests[i]);try{g.PAssert(3339,!batch||batchCount+numCanceled+numDuped>1,"Batches should always have multiple items in them")}catch(PERR){g.reportError(PERR)}return batch&&(batchCount>0?(DETAILED_STATS&&this.__Stats.remoteBatches++,this.commitBatch(batch,cbBatch)):DETAILED_STATS&&this.__Stats.canceledBatches++),numRequested},_clearRequestQueue:function _clearRequestQueueFn(){log("Clear Request Queue: ",this.id),this._pendingRequests=[],this._outstandingRequests=[],this._numDeferredReqs=0,this._numOutstandingReqs=0},_runRemoteRequest:function _runRemoteRequestFn(batch,requestData,cb){var wasBatched=!1;requestData.request=requestData.requestFn(requestData.data);try{g.PAssert(3340,requestData.request,"Must be able to provide a valid request object to be sent remotely")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3341,requestData.request.then,"Remote request must be thenable")}catch(PERR){g.reportError(PERR)}return batch&&(batch.add(requestData.request),wasBatched=!0,requestData.wasBatched=!0),requestData.request.then(function(response){try{g.PAssert(3342,requestData.handled===!1,"Must not handle the same request multiple times")}catch(PERR){g.reportError(PERR)}requestData.handled=!0;for(var i=0;i<requestData.successCB.length;++i)requestData.successCB[i](response.result);cb(requestData.attach,requestData.plugin,requestData.wasBatched),this._outstandingRequests.remove(requestData)}.bind(this),function(response){var hasRetryErrorCode=retryErrorCodes.indexOf(response.status)>=0;if(hasRetryErrorCode&&requestData.autoRetry&&requestData.currentRetries<requestData.numRetries)this._retryRemoteRequest(requestData);else{try{g.PAssert(3343,requestData.handled===!1,"Must not handle the same request multiple times")}catch(PERR){g.reportError(PERR)}if(requestData.handled=!0,requestData.attach)for(var i=0;i<requestData.attach.length;++i)requestData.attach[i].notifyDataRequestFailed();for(var i=0;i<requestData.failureCB.length;++i)requestData.failureCB[i](response.result);cb(requestData.attach,requestData.plugin,requestData.wasBatched),this._outstandingRequests.remove(requestData)}}.bind(this)),wasBatched},createPaginationToken:function createPaginationTokenFn(nextPageToken,q,maxResults,entryCB,doneCB){try{g.PAssert(3344,nextPageToken,"Must create the pagination token with a valid next page token")}catch(PERR){g.reportError(PERR)}return{nextPageToken:nextPageToken,q:q,maxResults:maxResults,entryCB:entryCB,doneCB:doneCB}},updatePaginationToken:function updatePaginationTokenFn(oldToken,nextPageToken){try{g.PAssert(3345,oldToken,"Must specify a valid token to update")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3346,nextPageToken,"Must update the pagination token with a valid next page token")}catch(PERR){g.reportError(PERR)}return oldToken.nextPageToken=nextPageToken,oldToken},createBatch:function createBatchFn(){return gapi.client.newBatch()},commitBatch:function commitBatchFn(batch,cb){try{g.PAssert(3347,batch,"Batch to commit must be specified")}catch(PERR){g.reportError(PERR)}batch.then(function(response){cb(this,!0)}.bind(this),function(){log("Remote batch failed: ",arguments),cb(this,!1)}.bind(this))},compactCacheField:function compactCacheFieldFn(entry,key){return entry[key]},_serializeObj:function _serializeObjFn(entry,props){try{g.PAssert(3348,entry,"Must specify a valid entry to serialize")
}catch(PERR){g.reportError(PERR)}try{g.PAssert(3349,props,"Must provide a valid property list")}catch(PERR){g.reportError(PERR)}for(var outObj={},i=0;i<props.length;++i){var prop=props[i],desc=this.getPropertyDescriptor(prop);if(!desc.isOpt||desc.defaultValue!==entry[prop]){var writeValue=this.compactCacheField(entry,prop);void 0!==writeValue&&(outObj[prop]=writeValue)}}var blobData=this.getBlobData(entry);return blobData&&(outObj._blob=blobData),outObj},serializeEntry:function serializeEntryFn(id){var props=this.getPropertySet(PluginLoad.Full),entry=this.getCacheData(id);return entry?this._serializeObj(entry,props):void 0},serializeExternalData:function serializeExternalDataFn(data){try{g.PAssert(3350,data,"Must supply valid data to serialize")}catch(PERR){g.reportError(PERR)}var props=this.getPropertySet(PluginLoad.Full),outData=this._serializeObj(data,props);return outData.id=data.id,data.parents&&(outData.parents=data.parents),outData},serializePreview:function serializePreviewFn(attach){var props=this.getPropertySet(PluginLoad.Preview),entry=this.getCacheData(attach.id);return entry?this._serializeObj(entry,props):void 0},registerAutocomplete:function registerAutocompleteFn(){if(g.autocomplete&&!this._registeredAutocomplete){var prefixes=this.getAutocompletePrefixes();if(prefixes){g.autocomplete.registerProvider(this._acProviderId,this);for(var i=0;i<prefixes.length;++i)g.autocomplete.registerPrefix(this._acProviderId,prefixes[i])}this._registeredAutocomplete=!0}},unregisterAutocomplete:function unregisterAutocompleteFn(){g.autocomplete&&this._registeredAutocomplete},declareProperty:function declarePropertyFn(name,requiredFor,isOpt,defaultValue){try{g.PAssert(3351,!this._propertyDescriptors[name],"Should not declare the same property twice")}catch(PERR){g.reportError(PERR)}requiredFor=requiredFor||PluginLoad.Preview|PluginLoad.Full,isOpt=isOpt||!1,g.forEachFlagSet(requiredFor,function(flag){this._propertySets[flag]||(this._propertySets[flag]=[]),this._propertySets[flag].push(name)}.bind(this)),this._propertyDescriptors[name]={isOpt:isOpt,defaultValue:defaultValue}},getPropertySet:function getPropertySetFn(name){return this._propertySets[name]||[]},getPropertyDescriptor:function getPropertyDescriptorFn(name){return this._propertyDescriptors[name]},getBlobData:function getBlobDataFn(entry){return void 0},_updateAttachmentStates:function _updateAttachmentStatesFn(){for(var i=0;i<this._attachKeys.length;++i){var attach=this._attachCache[this._attachKeys[i]];attach.onUpdate(!1)}},offlineLoad:function offlineLoadFn(){if(!this._hasRunOfflineLoad&&this.supportOfflineLoad()){this._hasRunOfflineLoad=!0;try{this._offlineLoad&&this._offlineLoad()}catch(err){g.reportError(err)}}},load:function loadFn(){if(this._isFirstLoad){this._isFirstLoad=!1;try{this._load&&this._load()}catch(err){g.reportError(err)}}this._loadedInitialData||!g.isDemoMode()&&!this.hasActiveDataPanes()||this.isPluginBlocked()||this.loadInitialData()},loadInitialData:function loadInitialDataFn(){try{g.PAssert(3352,!this._loadedInitialData,"Do not make multiple requests for initial data load")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3353,!this.isPluginBlocked(),"Should not load data for blocked plugins")}catch(PERR){g.reportError(PERR)}this._loadedInitialData=!0},finishedLoading:function finishedLoadingFn(){g.fireCustomEvent(this.loadedEvent)},getDataPane:function getDataPaneFn(){return void 0},getPaneIcon:function getPaneIconFn(){return"icon-question2"},useItemStore:function useItemStoreFn(){return void 0},itemStoreOptions:function itemStoreOptionsFn(){return void 0},getDefaultItemStore:function getDefaultItemStoreFn(){try{g.PAssert(3354,this.useItemStore(),"Must request an item store")}catch(PERR){g.reportError(PERR)}return this._defaultItemStore},getActiveItemStore:function getActiveItemStoreFn(paneID){try{g.PAssert(3355,paneID,"Must specify a valid paneID to get the item store for")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3356,this.useItemStore(),"Must request item store usage")}catch(PERR){g.reportError(PERR)}var activeStore=this._activeItemStore[paneID];return activeStore?activeStore:this._defaultItemStore},allowRemoteRequests:function allowRemoteRequestsFn(){return!1},handleDropEvent:function handleDropEventFn(e,cb){return!1},handleTapEvent:function handleTapEventFn(vmli,id,e){return!1},getAutocompletePrefixes:function getAutocompletePrefixesFn(){return void 0},notifyPaneCreated:function notifyPaneCreatedFn(){this._numActivePanes++,!this.isActive()||this._loadedInitialData||this.isPluginBlocked()||(this.areDependenciesLoaded()?this.loadInitialData():this.loadRemoteAPIs())},notifyPaneDestroyed:function notifyPaneDestroyedFn(){this._numActivePanes--;try{g.PAssert(3359,this._numActivePanes>=0,"Should never have negative active panes")}catch(PERR){g.reportError(PERR)}},hasActiveDataPanes:function hasActiveDataPanesFn(){return this._numActivePanes>0},_createSearchBucket:function _createSearchBucketFn(search){var searchBucketID,pastSearchID=this._pastSearches[search];if(pastSearchID&&this._searchBuckets[pastSearchID])searchBucketID=pastSearchID;else{searchBucketID=g.generateTempId(),this._pastSearches[search]=searchBucketID;var bucket=g.vmMain.itemStoreManager.registerItemStore(searchBucketID,this);bucket.createRoot(g.generateTempId(),"Search Results"),this._searchBuckets[searchBucketID]=bucket}return searchBucketID},_destroySearchBucket:function _destroySearchBucketFn(bucketID){var bucket=this._searchBuckets[bucketID];bucket.clearStore()},createSearchResultItem:function createSearchResultItemFn(bucketID,itemID,text,props){try{g.PAssert(3360,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3361,this._searchBuckets[bucketID],"Must have a valid search bucket to match id")}catch(PERR){g.reportError(PERR)}var bucket=this._searchBuckets[bucketID],rootItem=bucket.getRoot(),searchItem=bucket.createItem(itemID,text,rootItem.id,props);rootItem.insertItem(searchItem)},swapInSearchBucket:function swapInSearchBucketFn(bucketID,paneID){try{g.PAssert(3362,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(PERR){g.reportError(PERR)}var pane=g.vmMain.paneManager.getPaneById(paneID),bucket=this._searchBuckets[bucketID],root=bucket.getRoot();pane.setRootItem(root),this._activeItemStore[paneID]=bucket,this._activeSearchBucket[paneID]=bucket},swapOutSearchBucket:function swapOutSearchBucketFn(bucketID,paneID){try{g.PAssert(3363,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(PERR){g.reportError(PERR)}var pane=g.vmMain.paneManager.getPaneById(paneID),oldBucket=this._searchBuckets[bucketID];try{g.PAssert(3364,oldBucket,"Must have a valid bucket we are swapping from")}catch(PERR){g.reportError(PERR)}var oldRoot=pane.getRootItem();try{g.PAssert(3365,oldRoot===oldBucket.getRoot(),"Current root for pane should match bucket root")}catch(PERR){g.reportError(PERR)}var newRoot=this._defaultItemStore.getRoot();pane.setRootItem(newRoot),this._destroySearchBucket(bucketID),this._activeItemStore[paneID]=void 0,this._activeSearchBucket[paneID]=void 0},runSearch:function runSearchFn(search,paneID,cb){try{g.PAssert(3366,this.useItemStore(),"Must be marked as using an item store to support searches")}catch(PERR){g.reportError(PERR)}this.runRemoteSearch(search,paneID,cb)},getSearchRoot:function getSearchRootFn(bucketID){var bucket=this._searchBuckets[bucketID];try{g.PAssert(3367,bucket,"Should always reference a valid search bucket")}catch(PERR){g.reportError(PERR)}return bucket.getRoot()},runRemoteSearch:function runRemoteSearchFn(search,paneID){try{g.PAssert(3368,!1,"SubClass must override")}catch(PERR){g.reportError(PERR)}},clearSearch:function clearSearchFn(paneID){this._activeSearchBucket[paneID]&&this.swapOutSearchBucket(this._activeSearchBucket[paneID].id,paneID)},refreshCurrentView:function refreshCurrentViewFn(paneID){try{g.PAssert(3369,!1,"SubClass must override")}catch(PERR){g.reportError(PERR)}}},util.defineBase(VMPlugin),VMPlugin}),define("TokenHolder",["globals","util"],function(g,util){function TokenHolder(cb){this._cb=cb,this._pageToken=void 0}var TokenHolderFns={hasPaginationToken:function hasPaginationTokenFn(){return!!this._pageToken},setPaginationToken:function setPaginationTokenFn(token){this._pageToken=token,this._cb&&this._cb(this)},beginDataPageLoad:function beginDataPageLoadFn(){var token=this._pageToken;return this._pageToken=void 0,token},endDataPageLoad:function endDataPageLoadFn(token){token&&this.setPaginationToken(token)},notifyPaginationUpdate:function notifyPaginationUpdateFn(){log("Pagination Update")}};return util.defineBase(TokenHolder),util.extend(TokenHolder.prototype,TokenHolderFns),TokenHolder}),define("CachedSearch",["globals","util","TokenHolder"],function(g,util,TokenHolder){function CachedSearch(searchQuery,pageSize,remoteRequestCB){this._super.constructor.call(this),this._searchQuery=searchQuery,this._invalid=!1,this._hasError=!1,this._remoteRequestCB=remoteRequestCB,this._activePageRequest=void 0,this._lastPageRequest=void 0,this._cachedResults=[],this._localPageOffset=0,this._automaticPageRequests=0,this._pageSize=pageSize}var MaxAutomaticRequests=5,CachedSearchFns={invalidate:function invalidateFn(){this._invalid=!0},isValid:function isValidFn(){return!this._invalid},hasError:function hasErrorFn(){return this._hasError},getNextPage:function getNextPageFn(entryCB,doneCB){try{g.PAssert(3370,g.isFunction(entryCB)&&g.isFunction(doneCB)||this._lastPageRequest,"Must provide valid callbacks")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3371,!this._invalid,"Should never request another page from an invalidated search")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3372,this.hasMoreResults(),"Should never request another page if there are no possible results")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3373,!this._activePageRequest,"Should only run a single request at a time")}catch(PERR){g.reportError(PERR)}if(entryCB||doneCB||!this._lastPageRequest||(entryCB=this._lastPageRequest.entryCB,doneCB=this._lastPageRequest.doneCB),this._activePageRequest)doneCB(!1);else if(this._cachedResults.length>this._localPageOffset+this._pageSize){for(var i=0;i<this._pageSize;++i){var entry=this._cachedResults[this._localPageOffset+i];try{entryCB(entry)}catch(err){g.reportError(err)}}this._localPageOffset+=this._pageSize,doneCB(!0)}else if(this.hasPaginationToken()&&this._automaticPageRequests<MaxAutomaticRequests)this._activePageRequest={entryCB:entryCB,doneCB:doneCB},this._automaticPageRequests++,this._remoteRequestCB(this);else if(this._localPageOffset<this._cachedResults.length){for(var i=this._localPageOffset;i<this._cachedResults.length;++i){var entry=this._cachedResults[i];try{entryCB(entry)}catch(err){g.reportError(err)}this._localPageOffset++}doneCB(!0)}},onEntry:function onEntryFn(entry){this._invalid||entry.title.toUpperCase().indexOf(this._searchQuery.toUpperCase())>=0&&this._cachedResults.push(entry)},onDone:function onDoneFn(success){this._invalid||this._activePageRequest&&(this._lastPageRequest=this._activePageRequest,this._activePageRequest=void 0,success?this.getNextPage(this._lastPageRequest.entryCB,this._lastPageRequest.doneCB):(this._invalid=!0,this._hasError=!0,pageRequest.doneCB(success)))},hasResults:function hasResultsFn(){return this._cachedResults.length>0},hasMoreResults:function hasMoreResultsFn(){return this._cachedResults.length>this._localPageOffset||this.hasPaginationToken()}};return util.inherit(TokenHolder,CachedSearch),util.extend(CachedSearch.prototype,CachedSearchFns),CachedSearch}),define("plugins/Plugin_Drive_Pane",["ko","globals","util","data","VMPane"],function(ko,g,util,d,VMPane){function Plugin_Drive_Pane(p){this.plugin=g.vmMain.pluginManager.getPlugin(PluginID.Drive),this._super.constructor.call(this,p),this.type=this.plugin._paneType,this.paneClass="paneNormal panePlugin paneDrive noComplete",this.paneEmptyMessage="Loading Google Drive...",this.paneEmptySearchMessage="",this.dropEffect=DropEffect.Copy,this.isWriteable=!1,this.overrideCopyBehavior=!1,this.supportCollapsing=!0,this.supportCompleting=!1,this.supportOffline=!1,this.supportPerformArchive=!1,this.supportDataRefresh=!0,this.supportPagination=!0,this.supportSearchAutocomplete=!1,this._isSearchingRemote=ko.observable(),this.initDrive()}var searchDelay=2500,researchDelay=5e3,Plugin_Drive_PaneFns={initDrive:function initDriveFn(){this._searchUpdateSubscription=this.search.value.listen(this.notifySearchChanged.bind(this)),this._searchTimeout=void 0,this._lastSearchValue=void 0,this._lastSearchTime=0},destroy:function destroyFn(){this._searchUpdateSubscription.dispose(),this._searchUpdateSubscription=void 0,this._super.destroy.call(this)},_getNotReadyStatus:function _getNotReadyStatusFn(){var msg="Unknown Error: Unable to load pane data.",unloadedDeps=this.plugin.getUnloadedDependencies();return unloadedDeps&&(unloadedDeps.indexOf(PluginDependency.DriveAPI)>=0?msg="Pane data is only available while online.":unloadedDeps.indexOf(PluginDependency.PremiumSub)>=0?msg="Only available to premium subscribers.":unloadedDeps.indexOf(PluginDependency.GoogleLogin)>=0&&(msg="Missing permissions for Google Drive access.")),msg},getItemStore:function getItemStoreFn(){return this.plugin.getActiveItemStore(this.id)},getRootItem:function getRootItemFn(){var itemStore=this.getItemStore();return itemStore?itemStore.getRoot():void 0},showLoadMore:function showLoadMoreFn(){return!this.isSearched()&&this.getItem().hasPaginationToken()},templateName:function templateNameFn(pane,b){return"template-pane-normal"},searchACName:function searchACNameFn(){return void 0},getPaneIcon:function getPaneIconFn(){return this.plugin.getPaneIcon()},requestDemandLoadData:function requestDemandLoadDataFn(item){this.plugin.requestDemandLoadData(this.id,item)},requestDataPage:function requestDataPageFn(item){this.plugin.requestDataPage(item)},updateContents:function updateContentsFn(){this._super.updateContents.call(this)},onAfterLoaded:function onAfterLoadedFn(){this._super.onAfterLoaded.call(this)},onClose:function onCloseFn(){this._super.onClose.call(this)},_runRemoteSearch:function _runRemoteSearchFn(){if(g.vmMain.paneManager.isPaneActive(this.id)){clearTimeout(this._searchTimeout),this._searchTimeout=void 0;var search=this.search.getValue();this._lastSearchValue=search,this._lastSearchTime=Date.now(),this.isLoading.set(!0),this.paneTopText.set("Loading remote search results..."),this._isSearchingRemote(!0),this.plugin.runSearch(search,this.id,function(status){switch(this.isLoading.set(!1),status){case SearchResultStatus.Done:this.paneTopText.set("");break;case SearchResultStatus.TooMany:this.paneTopText.set("Too many search results! Be more specific.");break;case SearchResultStatus.None:this.paneTopText.set("There were no search results");break;case SearchResultStatus.Error:this.paneTopText.set("There was an error running your search, try again.");break;default:try{g.PAssert(3374,!1,"Invalid search state: ",status)}catch(PERR){g.reportError(PERR)}}}.bind(this))}},notifySearchChanged:function notifySearchChangedFn(force){var search=this.search.getValue();if(search!==this._lastSearchValue||Date.now()-this._lastSearchTime>researchDelay)if(clearTimeout(this._searchTimeout),this._searchTimeout=void 0,search){var actualDelay=force?0:searchDelay;this._searchTimeout=setTimeout(this._runRemoteSearch.bind(this),actualDelay)}else this._isSearchingRemote(!1),this.plugin.clearSearch(this.id),this.isLoading.set(!1),this.paneTopText.set("")},refreshPaneData:function refreshPaneDataFn(){this.plugin.refreshCurrentView(this.id)},notifyDropFrom:function notifyDropFromFn(droppedItem,toPane){this.plugin.notifyDropFrom(droppedItem,toPane)},dropEffectCopyBehavior:function dropEffectCopyBehaviorFn(copyItem,targetItem){return this.plugin.isItemDroppable(copyItem)?this._super.dropEffectCopyBehavior.call(this,copyItem,targetItem):void g.messageQueue.pushMessage(MessageID.DisabledFolderDrop)},setupContextMenu:function setupContextMenuFn(item){return g.element("contextMenuItem_Drive")},isSearchingRemote:function isSearchingRemoteFn(){return this._isSearchingRemote()},_onRemoteDataLoaded:function _onRemoteDataLoadedFn(){}};return util.inherit(VMPane,Plugin_Drive_Pane),util.extend(Plugin_Drive_Pane.prototype,Plugin_Drive_PaneFns),Plugin_Drive_Pane}),define("plugins/Plugin_Drive",["globals","util","platform","goog","TokenHolder","CachedSearch","PluginRenderer","VMPlugin","plugins/Plugin_Drive_Pane"],function(g,util,platform,goog,TokenHolder,CachedSearch,PluginRenderer,VMPlugin,Plugin_Drive_Pane){function Plugin_Drive(){this._super.constructor.call(this,PluginID.Drive,"Drive"),this.autocompleteReplace=!0,this.displaySharedWithMe=!g.isDemoMode(),this._currentSearch=void 0,util.forceBind("sortFn",this),this.registerSetting(PluginSettings.WriteAccess,!0),this.registerSetting(PluginSettings.LastChangeId),this.registerSetting(PluginSettings.DriveRootId),this._folderCache=this.registerLocalCache("FolderCache",StorageType.IndexedDB),this.declareProperty("titleLower",PluginLoad.Runtime,!1,""),this.declareProperty("pinToTop",PluginLoad.Runtime,!0,!1),this.declareProperty("title"),this.declareProperty("mimeType"),this.declareProperty("fileSize",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("alternateLink",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("isDeleted",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("modifiedDate",PluginLoad.Autocomplete,!0),this.declareProperty("parents",PluginLoad.Autocomplete,!0),this.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.DriveFile),this.useRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.DriveFile),this.useRenderer(PluginRenderTypes.AutocompleteText,PluginRenderers.DriveFile),this.useRenderer(PluginRenderTypes.Measure,PluginRenderers.DriveFile)}var MimeTypes={Unknown:"application/octet-stream",Folder:"application/vnd.google-apps.folder",Sheet:"application/vnd.google-apps.spreadsheet",Slide:"application/vnd.google-apps.presentation",Document:"application/vnd.google-apps.document",Moodo:goog.REALTIME_MIMETYPE+"."+goog.APP_ID,ImagePng:"image/png",ImageJpg:"image/jpg"},PluginSettings={WriteAccess:"writeAccess",LastChangeId:"lastChangeId",DriveRootId:"driveRootId"},RequestType={SingleFile:1,FolderStruct:2,SubFolder:3,Search:4,DataPage:5,ChangeList:6,SingleFolder:7},SpecialFolderIDs={SharedWithMe:"S~SharedWithMe"},openUrl="https://drive.google.com/open?id=",DEFAULT_FOLDER_MAX_RESULTS=999,DEFAULT_SEARCH_MAX_RESULTS=100,DEFAULT_SEARCH_DISPLAY_RESULTS=10,DEFAULT_FILE_MAX_RESULTS=70,MAX_CHANGE_ID=1e8,MAX_CHANGE_RESULTS=500,MAX_FILE_UPLOAD_SIZE=20971520,boundary="-------314159265358979323846",delimiter="\r\n--"+boundary+"\r\n",close_delim="\r\n--"+boundary+"--",requestFields="id,mimeType,title,alternateLink,modifiedDate,parents",Plugin_DriveFns={getDataPane:function getDataPaneFn(){try{g.PAssert(3375,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(PERR){g.reportError(PERR)}return g.billingManager.isPremiumEnabled()?Plugin_Drive_Pane:void 0},getPaneIcon:function getPaneIconFn(){return"icon-drive-file"},useItemStore:function useItemStoreFn(){return"Google Drive"},allowRemoteRequests:function allowRemoteRequestsFn(){return!0},onAuthorizedSetting:function onAuthorizedSettingFn(key,value){switch(key){case PluginSettings.WriteAccess:value&&this._ensureAttachmentsAreShared()}},_ensureSpecialFolders:function _ensureSpecialFoldersFn(){var itemStore=this.getDefaultItemStore(),rootItem=itemStore.getRoot();if(this.displaySharedWithMe&&!itemStore.hasItem(SpecialFolderIDs.SharedWithMe)){var sharedItemID=g.generateTempId();this.cacheData(sharedItemID,{title:"Shared With Me",titleLower:"shared with me",mimeType:MimeTypes.Folder,pinToTop:!0});var sharedAttach=this.getAttachment(sharedItemID),sharedWithMeItem=itemStore.createItem(SpecialFolderIDs.SharedWithMe,this.getAttachmentEmbedString(sharedAttach),rootItem.id,{demandLoadChildren:!0});rootItem.insertSorted(sharedWithMeItem,this.sortFn)}},_load:function _loadFn(){this._ensureSpecialFolders(),g.isDemoMode()||this.createRecurringTask("ChangeListUpdates",{delay:g.minutes(15),minDelay:g.minutes(5),runOnCreate:!0,pauseWhileIdle:!0,task:this.performChangeListUpdate.bind(this)})},loadInitialData:function loadInitialDataFn(){this._super.loadInitialData.call(this),this._ensureSpecialFolders();var folderManager=new TokenHolder(function(item){}.bind(this));setTimeout(function(){this._folderCache.onCacheMetadataReady(function(){this._folderCache.getMetadata("isSyncd",function(isSyncd){isSyncd||(log("Folder cache unsyncd - running folder sync"),this._folderCache.onCacheReady(function(){var numFolderRequests=0,numFolders=0,qFolderStruct="trashed=false and mimeType contains '"+MimeTypes.Folder+"'";this._requestRemoteFiles(RequestType.FolderStruct,folderManager,qFolderStruct,DEFAULT_FOLDER_MAX_RESULTS,function(entry){this._folderCache.cacheEntry(entry.id,this.serializeExternalData(entry)),numFolders++}.bind(this),function(success){numFolderRequests++}.bind(this)),this._folderCache.setMetadata("isSyncd",!0)}.bind(this)))}.bind(this))}.bind(this))}.bind(this),100);var firstRequestLoaded=!1,itemStore=this.getDefaultItemStore(),item=itemStore.getRoot(),qRootItems="trashed=false and 'root' in parents and mimeType != '"+MimeTypes.Moodo+"'";this._requestRemoteFiles(RequestType.SubFolder,item,qRootItems,DEFAULT_FILE_MAX_RESULTS,function(entry){if(this.hasCacheData(entry.id)||this._addRemoteEntry(entry),!this._hasSameItem(entry.id,item.id,itemStore)){var vmli=itemStore.createItem(this._createItemID(entry.id,itemStore),this._getTextForItem(entry),item.id,{demandLoadChildren:entry.mimeType===MimeTypes.Folder});item.insertSorted(vmli,this.sortFn)}if(!this.getSetting(PluginSettings.DriveRootId)&&entry.parents)for(var i=0;i<entry.parents.length;++i)entry.parents[i].isRoot&&this.setSetting(PluginSettings.DriveRootId,entry.parents[i].id)}.bind(this),function(){firstRequestLoaded||(firstRequestLoaded=!0,this.finishedLoading())}.bind(this))},performChangeListUpdate:function performChangeListUpdateFn(){var maxChangeId=-1,startChangeId=this.getSetting(PluginSettings.LastChangeId);this._requestChangeList(startChangeId,function(entry){try{g.PAssert(3376,!startChangeId||parseInt(entry.id)>parseInt(startChangeId),"Must have correctly ordered change entry")}catch(PERR){g.reportError(PERR)}maxChangeId=entry.id;try{!entry.fileId||entry.file&&entry.file.mimeType===MimeTypes.Moodo||this._handleChange(entry)}catch(err){g.reportError(err)}}.bind(this),function(success){success&&-1!=maxChangeId&&this.setSetting(PluginSettings.LastChangeId,maxChangeId)}.bind(this))},_handleChange:function _handleChangeFn(change){try{g.PAssert(3377,change&&(change.deleted||change.file),"Must have a valid formed change entry to handle")}catch(PERR){g.reportError(PERR)}(change.deleted||change.file.mimeType===MimeTypes.Folder)&&(change.deleted?this._folderCache.hasEntry(change.fileId,function(hasEntry){hasEntry&&this._folderCache.removeEntry(change.fileId)}.bind(this)):this._folderCache.cacheEntry(change.fileId,this.serializeExternalData(change.file)));var cacheEntry=this.getCacheData(change.fileId);if(cacheEntry){change.deleted||this.dataHasChanged(cacheEntry,change.file)&&this._addRemoteEntry(change.file);var itemStore=this.getDefaultItemStore();if(change.deleted){var attach=this.getAttachment(change.fileId);attach.forEachItem(itemStore,function(item){item.parent().removeChild(item),item.parent(void 0)}.bind(this)),attach.updateField("isDeleted",!0)}else{var seenParents=[],attach=this.getAttachment(change.fileId);attach.forEachItem(itemStore,function(item){for(var keepItem=!1,i=0;i<change.file.parents.length;++i){var tParent=change.file.parents[i];if(tParent.isRoot&&item.parent()&&item.parent().isRootItem()||item.parent()&&item.parent().hasAttachment(tParent.id)){keepItem=!0,seenParents.push(tParent.id);break}}item.parent()&&this._isSpecialFolder(item.parent().id)&&(keepItem=!0,seenParents.push(item.parent().id)),!keepItem&&item.parent()&&(item.parent().removeChild(item),item.parent(void 0))}.bind(this));for(var i=0;i<change.file.parents.length;++i){var tParent=change.file.parents[i];if(seenParents.indexOf(tParent.id)<0)if(tParent.isRoot){var storeRoot=itemStore.getRoot(),childItem=itemStore.createItem(this._createItemID(change.fileId,itemStore),this._getTextForItem(change.file),storeRoot.id,{demandLoadChildren:change.file.mimeType===MimeTypes.Folder});storeRoot.insertSorted(childItem,this.sortFn)}else{var parentAttach=this.getAttachment(tParent.id);parentAttach.forEachItem(itemStore,function(item){var childItem=itemStore.createItem(this._createItemID(change.fileId,itemStore),this._getTextForItem(change.file),item.id,{demandLoadChildren:change.file.mimeType===MimeTypes.Folder});item.insertSorted(childItem,this.sortFn)}.bind(this))}}if(this.displaySharedWithMe&&change.file.sharedWithMeDate&&seenParents.indexOf(SpecialFolderIDs.SharedWithMe)<0){var sharedItem=itemStore.getItem(SpecialFolderIDs.SharedWithMe),childItem=itemStore.createItem(this._createItemID(change.fileId,itemStore),this._getTextForItem(change.file),sharedItem.id,{demandLoadChildren:change.file.mimeType===MimeTypes.Folder});sharedItem.insertSorted(childItem,this.sortFn)}}}},_isValidFileID:function _isValidFileIDFn(fileID){return fileID.indexOf("~")<0},_createItemID:function _createItemIDFn(fileID,itemStore){try{g.PAssert(3378,fileID,"Must provide a fileID")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3379,this._isValidFileID(fileID),"Invalid fileID - "+fileID)}catch(PERR){g.reportError(PERR)}try{g.PAssert(3380,itemStore,"Must provide a valid itemStore")}catch(PERR){g.reportError(PERR)}for(var outID=fileID,dupeCounter=0;itemStore.hasItem(outID)&&50>dupeCounter;)outID=fileID+"~"+ ++dupeCounter;try{g.PAssert(3381,50>dupeCounter,"SANITY: Should not have items with 50+ parents")}catch(PERR){g.reportError(PERR)}return outID},_hasSameItem:function _hasSameItemFn(fileID,parentID,itemStore){for(var isSame=!1,itemID=fileID,dupeCounter=0;itemStore.hasItem(itemID)&&50>dupeCounter;){var existItem=itemStore.getItem(itemID);if(existItem&&existItem.parent()&&existItem.parent().id===parentID){isSame=!0;break}itemID=fileID+"~"+ ++dupeCounter}return isSame},_isSpecialFolder:function _isSpecialFolderFn(id){return id.startsWith("S~")},requestDemandLoadData:function requestDemandLoadDataFn(paneID,item){try{g.PAssert(3382,1===item.getNumAttachments(),"Should only have a single attachment for Drive Pane VMLIs")}catch(PERR){g.reportError(PERR)}var pane=g.vmMain.paneManager.getPaneById(paneID),attach=item.getAttachments()[0],q;if(this._isSpecialFolder(item.id))switch(item.id){case SpecialFolderIDs.SharedWithMe:q="trashed=false and sharedWithMe and mimeType != '"+MimeTypes.Moodo+"'";break;default:try{g.PAssert(3383,!1,"Invalid special folder ID")}catch(PERR){g.reportError(PERR)}}q||(q="trashed=false and '"+attach.id+"' in parents and mimeType != '"+MimeTypes.Moodo+"'");var itemStore=this.getActiveItemStore(paneID);this._requestRemoteFiles(RequestType.SubFolder,item,q,DEFAULT_FILE_MAX_RESULTS,function(entry){if(this.hasCacheData(entry.id)||this._addRemoteEntry(entry),!this._hasSameItem(entry.id,item.id,itemStore)){var vmli=itemStore.createItem(this._createItemID(entry.id,itemStore),this._getTextForItem(entry),item.id,{demandLoadChildren:entry.mimeType===MimeTypes.Folder});item.insertSorted(vmli,this.sortFn,!0)}}.bind(this),function(success){success||item.hasPaginationToken()||item.notifyLoadDataFailed(pane)}.bind(this)),g.sendEvent(this.id,"RequestDemandLoadData")},requestDataPage:function requestDataPageFn(item){this._requestRemoteFiles(RequestType.DataPage,item)},_ensureAncestorChain:function _ensureAncestorChainFn(itemStore,entry,successCB,errorCB){try{g.PAssert(3384,successCB,"Must provide a valid success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3385,errorCB,"Must provide a valid error callback")}catch(PERR){g.reportError(PERR)}if(entry.parents&&entry.parents.length)for(var expectedResponses=entry.parents.length,receivedResponses=0,updateOnSuccess=function(){++receivedResponses===expectedResponses&&successCB()},parseFileInfo=function(fileInfo){try{g.PAssert(3386,fileInfo,"Must provide valid fileInfo up ancestor chain")}catch(PERR){g.reportError(PERR)}this.hasCacheData(fileInfo.id)||this._addRemoteEntry(fileInfo),this._ensureAncestorChain(itemStore,fileInfo,updateOnSuccess,errorCB)}.bind(this),remoteSuccessCB=function(result){if(result){var resultInfo=this.serializeExternalData(result);this._folderCache.cacheEntry(resultInfo.id,resultInfo),parseFileInfo(resultInfo)}else errorCB({error:"Undefined success result."})}.bind(this),onFolderCacheResult=function(cacheResult,id){if(cacheResult)parseFileInfo(cacheResult);else{var remoteFolderRequestFn=gapi.client.drive.files.get,remoteFolderRequestData={fileId:id};this._queueRemoteRequest(remoteFolderRequestFn,remoteFolderRequestData,remoteSuccessCB,errorCB,void 0,RequestType.SingleFolder)}}.bind(this),i=0;i<entry.parents.length;++i){var parentId=entry.parents[i].id;try{g.PAssert(3387,parentId,"Must supply a valid parent ID to query")}catch(PERR){g.reportError(PERR)}this._folderCache.getEntry(parentId,onFolderCacheResult)}else successCB()},_hasAttachmentChild:function _hasAttachmentChildFn(item,attachID){for(var ret=!1,i=0;i<item.numItems();++i){var child=item.itemAtIndex(i);if(child.hasAttachment(attachID)){ret=!0;break}}return ret},_attachAncestorChain:function _attachAncestorChainFn(itemStore,entry){try{g.PAssert(3388,entry,"Must provide a valid cache entry to create items for")}catch(PERR){g.reportError(PERR)}if(entry.parents&&entry.parents.length>0)for(var i=0;i<entry.parents.length;++i){var parentEntry=entry.parents[i];try{g.PAssert(3389,parentEntry&&parentEntry.id,"Must supply a valid parent ID to query")}catch(PERR){g.reportError(PERR)}if(parentEntry.isRoot){var storeRoot=itemStore.getRoot();if(!this._hasAttachmentChild(storeRoot,entry.id)){var childItem=itemStore.createItem(this._createItemID(entry.id,itemStore),this._getTextForItem(entry),storeRoot.id,{demandLoadChildren:entry.mimeType===MimeTypes.Folder});storeRoot.insertSorted(childItem,this.sortFn)}}else this._folderCache.getEntry(parentEntry.id,function(folderEntry){this._attachAncestorChain(itemStore,folderEntry);var parentAttach=this.getAttachment(folderEntry.id);parentAttach.forEachItem(itemStore,function(item){if(!this._hasAttachmentChild(item,entry.id)){var childItem=itemStore.createItem(this._createItemID(entry.id,itemStore),this._getTextForItem(entry),item.id,{demandLoadChildren:entry.mimeType===MimeTypes.Folder});item.insertSorted(childItem,this.sortFn)}}.bind(this))}.bind(this))}},getNextSearchPage:function getNextSearchPageFn(){this._lastCompletedSearch&&this._lastCompletedSearch.isValid()&&this._lastCompletedSearch.getNextPage()},runRemoteSearch:function runRemoteSearchFn(search,paneID,cb){try{g.PAssert(3390,search,"Must provide a valid search")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3391,paneID,"Must provide a valid pane")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3392,g.isFunction(cb),"Must provide a valid search callback")}catch(PERR){g.reportError(PERR)}var doneProcessingEntries=!1,totalEntries=0,finishedEntries=0,errorEntries=0;this._currentSearch&&this._currentSearch.invalidate();var runningSearch=new CachedSearch(search,DEFAULT_SEARCH_DISPLAY_RESULTS,this.requestDataPage.bind(this));this._currentSearch=runningSearch;var checkSearchCompleted=function(){if(totalEntries===finishedEntries&&doneProcessingEntries){log("Done Searching! "+totalEntries);var resultStatus=SearchResultStatus.Done;if(runningSearch.isValid()){var pane=g.vmMain.paneManager.getPaneById(paneID);pane.search.update(!0),runningSearch.isValid()&&runningSearch.hasMoreResults()?(log("Too many search results"),resultStatus=SearchResultStatus.TooMany):runningSearch.hasError()||errorEntries>0?resultStatus=SearchResultStatus.Error:0===totalEntries&&(resultStatus=SearchResultStatus.None),this._lastCompletedSearch=runningSearch
}cb(resultStatus)}}.bind(this),entryCB=function(entry){totalEntries++,this.hasCacheData(entry.id)||this._addRemoteEntry(entry);var itemStore=this.getActiveItemStore(paneID);this._ensureAncestorChain(itemStore,entry,function(){runningSearch.isValid()&&this._attachAncestorChain(itemStore,entry),finishedEntries++,checkSearchCompleted()}.bind(this),function(err){g.reportError(new Error("Error during remote search: ",err)),finishedEntries++,errorEntries++,checkSearchCompleted()}.bind(this))}.bind(this),doneCB=function(success){doneProcessingEntries=!0,checkSearchCompleted()}.bind(this),firstSearchIsDone=!1,firstSearchDoneCB=function(success){runningSearch.onDone(success),firstSearchIsDone||(firstSearchIsDone=!0,runningSearch.isValid()&&(runningSearch.hasResults()?runningSearch.getNextPage(entryCB,doneCB):doneCB(success)))},q="trashed=false and (fullText contains '"+search+"')";this._requestRemoteFiles(RequestType.Search,this._currentSearch,q,DEFAULT_SEARCH_MAX_RESULTS,this._currentSearch.onEntry.bind(this._currentSearch),firstSearchDoneCB),g.sendEvent(this.id,"RemoteSearch")},addSearchResultToBucket:function addSearchResultToBucketFn(bucketID,result){var entry=this._createRemoteEntry(result);this._addRemoteEntry(entry),this.createSearchResultItem(bucketID,entry.id,this._getTextForItem(entry))},_requestRemoteFiles:function _requestRemoteFilesFn(type,reqItem,q,maxResults,entryCB,doneCB){var paginationToken;reqItem&&reqItem.hasPaginationToken()&&(paginationToken=reqItem.beginDataPageLoad(),q=paginationToken.q,maxResults=paginationToken.maxResults,entryCB=paginationToken.entryCB,doneCB=paginationToken.doneCB),maxResults=maxResults||DEFAULT_FILE_MAX_RESULTS;try{g.PAssert(3393,entryCB&&g.isFunction(entryCB),"Must define a valid entry callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3394,doneCB&&g.isFunction(doneCB),"Must define a valid done callback")}catch(PERR){g.reportError(PERR)}var requestFn=gapi.client.drive.files.list,requestData={fields:"items,nextPageToken",maxResults:maxResults,q:q,pageToken:paginationToken?paginationToken.nextPageToken:void 0},successCB=function(results){if(results.items){g.vmMain.beginUpdateItems();for(var i=0;i<results.items.length;++i)entryCB(results.items[i]);g.vmMain.commitUpdateItems()}var newPaginationToken;results.nextPageToken&&(newPaginationToken=paginationToken?this.updatePaginationToken(paginationToken,results.nextPageToken):this.createPaginationToken(results.nextPageToken,q,maxResults,entryCB,doneCB)),reqItem&&paginationToken?reqItem.endDataPageLoad(newPaginationToken):newPaginationToken&&reqItem.setPaginationToken(newPaginationToken),doneCB(!0)}.bind(this),failureCB=function(results){paginationToken&&reqItem.endDataPageLoad(paginationToken),doneCB(!1)}.bind(this);this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,type)},getRemoteAttachmentData:function getRemoteAttachmentDataFn(attach){function _doAction(){var requestFn=gapi.client.drive.files.get,requestData={fileId:attach.id},successCB=function(result){try{g.PAssert(3395,!result||result.id===attach.id,"If valid result, attachment should match remote file ID")}catch(PERR){g.reportError(PERR)}result&&this._addRemoteEntry(result)}.bind(this),failureCB=function(result){attach.notifyDataRequestFailed()}.bind(this);this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,attach,RequestType.SingleFile)}window.gapi&&window.gapi.client&&window.gapi.client.drive?_doAction.bind(this)():this._queueDeferredRemoteRequest(_doAction.bind(this))},_requestChangeList:function _requestChangeListFn(startChangeId,entryCB,doneCB){if(startChangeId){try{g.PAssert(3396,entryCB,"Must supply a valid entry CB")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3397,doneCB,"Must provide a valid done CB")}catch(PERR){g.reportError(PERR)}var requestFn=gapi.client.drive.changes.list,requestData={includeDeleted:!0,includeSubscribed:!0,maxResults:MAX_CHANGE_RESULTS,startChangeId:+startChangeId+1,fields:"items,nextPageToken"},successCB=function(results){for(var newMaxID=startChangeId,i=0;i<results.items.length;++i){var entry=results.items[i];try{g.PAssert(3398,entry,"Must have a valid change entry")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3399,parseInt(entry.id)<MAX_CHANGE_ID,"Must have a valid entry ID")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3400,parseInt(entry.id)>parseInt(newMaxID),"Must be ordered monotonic increasing")}catch(PERR){g.reportError(PERR)}newMaxID=entry.id,entryCB(entry)}results.nextPageToken?this._requestChangeList(newMaxID,entryCB,doneCB):doneCB(!0)}.bind(this),failureCB=function(results){doneCB(!1)}}else var requestFn=gapi.client.drive.changes.list,requestData={includeDeleted:!0,includeSubscribed:!0,maxResults:1,startChangeId:MAX_CHANGE_ID},successCB=function(results){var lastChangeId=results.largestChangeId;entryCB({id:lastChangeId}),doneCB(!0)},failureCB=function(results){doneCB(!1)};this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,RequestType.ChangeList)},_createRemoteEntry:function _createRemoteEntryFn(info){var entry={id:info.id,mimeType:info.mimeType,title:info.title,titleLower:info.title.toLowerCase(),alternateLink:info.alternateLink,fileSize:+info.fileSize,parents:info.parents,modifiedDate:info.modifiedDate?new Date(info.modifiedDate):void 0};if(entry.parents)for(var i=0;i<entry.parents.length;++i)this._updateParentsEntry(entry.parents[i]);if(info.properties)for(var i=0;i<info.properties.length;++i){if(info.properties[i].key===goog.DocFolderTitleProperty){entry.title=info.properties[i].value;break}if(info.properties[i].key===goog.DefaultRootFolderProperty){entry.title="Shared Files",entry.pinToTop=!0;break}}return this._isFolder(entry)&&(entry.items=[]),entry},_addRemoteEntry:function _addRemoteEntryFn(info){var entry=this._createRemoteEntry(info);this.cacheData(entry.id,entry)},createEntryFromLocal:function createEntryFromLocalFn(id,info){if(this._isFolder(info)&&(info.items=[]),info.titleLower=info.title.toLowerCase(),info.modifiedDate=info.modifiedDate?new Date(info.modifiedDate):void 0,info.isDeleted=info.isDeleted||g.isTempId(id),info.parents)for(var i=0;i<info.parents.length;++i)this._updateParentsEntry(info.parents[i]);return info},_updateParentsEntry:function _updateParentsEntryFn(data){this._folderCache.getEntry(data.id,function(parentEntry){parentEntry&&(data.title=parentEntry.title)})},_isFolder:function _isFolderFn(data){return data.mimeType===MimeTypes.Folder},_getCompStringForItem:function _getCompStringForItemFn(item){return item.hasAttachments()?item.getAttachments()[0].getTitleString():item.getParsedText()},_isItemPinnedToTop:function _isItemPinnedToTopFn(item){return item.hasAttachments()?item.getAttachments()[0].getField("pinToTop"):!1},sortFn:function sortFnFn(left,right){return this._isItemPinnedToTop(left)?-1:this._isItemPinnedToTop(right)?1:this._getCompStringForItem(left).localeCompare(this._getCompStringForItem(right))},getAttachmentClass:function getAttachmentClassFn(attach){var classes=["plugin_drive"];return classes.push(attach.hasField("mimeType")?this.getMimetypeClass(attach.getField("mimeType")):"plugin_drive_unk"),attach.hasField("isDeleted")&&attach.getField("isDeleted")&&classes.push("fileDeleted"),classes},getMimetypeClass:function getMimetypeClassFn(mimeType){switch(mimeType){case MimeTypes.Folder:return"plugin_drive_folder";case MimeTypes.Sheet:return"plugin_drive_sheet";case MimeTypes.Slide:return"plugin_drive_slide";case MimeTypes.Document:return"plugin_drive_doc";case MimeTypes.ImagePng:case MimeTypes.ImageJpg:return"plugin_drive_image";default:return"plugin_drive_unk"}},googleScopes:function googleScopesFn(){return this.getSetting(PluginSettings.WriteAccess)?[GScope.DriveFull]:[GScope.DriveMetadataRO]},getDependencies:function getDependenciesFn(){return[PluginDependency.PremiumSub,PluginDependency.DriveAPI,PluginDependency.GoogleLogin]},onDependencyLoaded:function onDependencyLoadedFn(dep,data){if(this._super.onDependencyLoaded.call(this,dep,data),dep===PluginDependency.GoogleLogin){try{g.PAssert(3401,g.isArray(data),"Must provide a valid scope array")}catch(PERR){g.reportError(PERR)}this.getSetting("isEnabled")&&data.indexOf(GScope.DriveMetadataRO)<0&&data.indexOf(GScope.DriveFull)<0&&(g.messageQueue.pushMessage(MessageID.LostPermission),this.setSetting("isEnabled",!1)),this.getSetting(PluginSettings.WriteAccess)&&data.indexOf(GScope.DriveFull)<0&&(g.messageQueue.pushMessage(MessageID.LostPermission),this.setSetting(PluginSettings.WriteAccess,!1))}},isDependencyLoaded:function isDependencyLoadedFn(dep,data){var isLoaded=!1;switch(dep){case PluginDependency.GoogleLogin:data&&(data.indexOf(GScope.DriveMetadataRO)>=0||data.indexOf(GScope.DriveFull)>=0)&&(isLoaded=!0);break;default:isLoaded=!0}return isLoaded},loadRemoteAPIs:function loadRemoteAPIsFn(){function loadDriveAPI(){g.loadGoogleAPI("drive","v2",function(){g.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.DriveAPI)})}window.gapi&&window.gapi.client?loadDriveAPI():g.addCustomEventListener("gapiLoaded",loadDriveAPI)},handleDropEvent:function handleDropEventFn(e,cb){var url=e.dataTransfer.getData("text/uri-list");if(url&&url.startsWith(openUrl)){var str=url.replace(openUrl,""),andIndex=str.indexOf("&"),id=str.substr(0,andIndex),attach=this.getAttachment(id);return cb(attach.getEmbedString()),!0}if(e.dataTransfer.files&&e.dataTransfer.files.length>0){for(var i=0,f;f=e.dataTransfer.files[i];i++)this._handleDropFile(f,e,cb);return!0}return!1},isItemDroppable:function isItemDroppableFn(item){var isDroppable=!0,attach=item.getAttachments()[0];try{g.PAssert(3402,attach,"Should always have a valid attachment when copying from a Drive pane.")}catch(PERR){g.reportError(PERR)}if(attach){var mimeType=attach.getField("mimeType");mimeType===MimeTypes.Folder&&(isDroppable=!1)}return isDroppable},_handleDropFile:function _handleDropFileFn(file,e,cb){for(var matched=!1,matches=this.findCachedItemsByField("title",file.name),dropPane=g.getPaneForElement(e.srcElement),i=0;i<matches.length;++i){var item=matches[i];if(item.fileSize===file.size&&!item.isDeleted){var attach=this.getAttachment(item.id);dropPane&&dropPane.isWriteable&&dropPane.plugin!==this?cb(this.getAttachmentEmbedString(attach),!1):dropPane&&dropPane.plugin===this&&attach.forEachItem(itemStore,function(item){item.highlight()}),matched=!0;break}}if(!matched){var itemID=g.generateTempId();this.cacheData(itemID,{title:file.name});var attach=this.getAttachment(itemID),doShare=dropPane&&dropPane.isWriteable&&dropPane.plugin!==this,itemStore=this.getDefaultItemStore(),destItem;if(dropPane&&dropPane.isWriteable&&dropPane.plugin!==this)cb(this.getAttachmentEmbedString(attach),!0);else if(this.getSetting(PluginSettings.WriteAccess)){var target=e.srcElement||e.target;destItem=g.hasClass(target,"paneContent")?dropPane.getItem():g.getItemForElement(target),destItem&&!destItem.isHeader()&&(destItem=destItem.parent())}var forceParentId;if(destItem){if(!destItem.isRootItem()){var destAttach=destItem.getAttachments()[0];try{g.PAssert(3403,destAttach,"Drive items must have valid attachments")}catch(PERR){g.reportError(PERR)}forceParentId=destAttach.id}}else destItem=itemStore.getRoot(),forceParentId=this.getSetting(PluginSettings.DriveRootId);this._upload(file,attach,doShare,dropPane.getPaneDoc(),forceParentId);try{g.PAssert(3404,!itemStore.hasItem(attach.id),"When uploading a new file, should never have duplicated items")}catch(PERR){g.reportError(PERR)}var newDriveItem=itemStore.createItem(attach.id,this.getAttachmentEmbedString(attach),destItem.id);destItem.insertSorted(newDriveItem,this.sortFn)}},notifyDropFrom:function notifyDropFromFn(droppedItem,toPane){try{g.PAssert(3405,droppedItem,"Must have a valid item that was dropped")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3406,toPane,"Must have a valid pane the item was dropped on")}catch(PERR){g.reportError(PERR)}if(!g.isDemoMode()){var attach=droppedItem.getAttachments()[0],paneDoc=toPane.getPaneDoc();paneDoc.shareFile(attach.id,function(success,result){success||(this.getSetting(PluginSettings.WriteAccess)&&403===result.code&&this.setSetting(PluginSettings.WriteAccess,!1),paneDoc.isShared()&&g.messageQueue.pushMessage(MessageID.ShareFailure))}.bind(this)),g.sendEvent(this.id,"AttachmentDropped")}},handleTapStart:function handleTapStartFn(vmli,id,e){return platform.mobile&&e.preventDefault(),!0},handleTapEvent:function handleTapEventFn(vmli,id,e){var item=this.getCacheData(id);if(item){if(this.isPluginPane(g.focusedPane)&&this._isFolder(item))g.vmMain.zoomin(vmli),g.sendEvent(this.id,"Tap_FolderZoom");else if(platform.mobile){var attach=this.getAttachment(id),html=this.createDisplayElement(attach).text;e.preventDefault(),g.preventClick(),g.menus.openMenuExternalApp(html,function(){item.alternateLink?g.openUrl(item.alternateLink,e):g.openUrl(this._createDriveURL(item.id,item.mimeType),e)}.bind(this)),g.sendEvent(this.id,"Tap_OpenFileMobile")}else g.isDemoMode()||(item.alternateLink?g.openUrl(item.alternateLink,e):g.openUrl(this._createDriveURL(item.id,item.mimeType),e),g.sendEvent(this.id,"Tap_OpenFileDesktop"));return!0}return!1},_createDriveURL:function _createDriveURLFn(id,mimeType){var startURL="https://docs.google.com/";switch(mimeType){case MimeTypes.Folder:return startURL+"folderview?id="+id+"&usp=drivesdk";case MimeTypes.Sheet:return startURL+"spreadsheets/d/"+id+"/edit?usp=drivesdk";case MimeTypes.Document:return startURL+"document/d/"+id+"/edit?usp=drivesdk";case MimeTypes.Slide:return startURL+"presentation/d/"+id+"/edit?usp=drivesdk";default:return startURL+"file/d/"+id+"/edit?usp=drivesdk"}},compactCacheField:function compactCacheFieldFn(entry,key){var outValue=void 0;switch(key){case"alternateLink":entry[key]!==this._createDriveURL(entry.id,entry.mimeType)&&(outValue=entry[key]);break;default:outValue=entry[key]}return outValue},supportOfflineCache:function supportOfflineCacheFn(){return!0},usesPreviewCache:function usesPreviewCacheFn(){return!0},matchAttachment:function matchAttachmentFn(attach,text){return attach.getField("titleLower").indexOf(text)>=0},getBlockedText:function getBlockedTextFn(attach){return"Go Premium to view Drive files"},onDocumentShared:function onDocumentSharedFn(firstShare){this.getSetting(PluginSettings.WriteAccess)?firstShare&&this._ensureAttachmentsAreShared():this.numActiveAttachments()>0&&g.messageQueue.pushMessage(MessageID.NoSharingWarning)},_ensureAttachmentsAreShared:function _ensureAttachmentsAreSharedFn(){var openDoc=g.vmMain.docManager.getOpenDoc();this.forEachActiveAttachment(function(attach){openDoc.shareFile(attach.id,function(success){})}.bind(this))},notifyAttachmentUnused:function notifyAttachmentUnusedFn(attach,changeType){this._super.notifyAttachmentUnused.call(this,attach,changeType);var openDoc=g.vmMain.docManager.getOpenDoc();openDoc.unshareFile(attach.id,function(success){})},_upload:function _uploadFn(fileData,attach,doShare,paneDoc,defaultParent){fileData.size>MAX_FILE_UPLOAD_SIZE?(g.messageQueue.pushMessage(MessageID.WarnLargeFile),g.sendEvent(this.id,"Upload_Large")):g.sendEvent(this.id,"Upload"),g.loadGoogleAPI("drive","v2",function(){var reader=new FileReader;reader.readAsBinaryString(fileData),reader.onload=function(e){var contentType=fileData.type||MimeTypes.Unknown,runUpload=function(folderID){var metadata={title:fileData.name,mimeType:contentType,parents:defaultParent?[{id:defaultParent}]:[]};doShare&&folderID&&metadata.parents.push({id:folderID});var base64Data=btoa(reader.result),body=delimiter+"Content-Type: application/json\r\n\r\n"+JSON.stringify(metadata)+delimiter+"Content-Type: "+contentType+"\r\nContent-Transfer-Encoding: base64\r\n\r\n"+base64Data+close_delim,request=gapi.client.request({path:"/upload/drive/v2/files",method:"POST",params:{uploadType:"multipart"},headers:{"Content-Type":'multipart/mixed; boundary="'+boundary+'"'},body:body}),callback=function(file){this.changeID(attach,attach.id,file.id),this._addRemoteEntry(file)}.bind(this);request.execute(callback)}.bind(this);if(doShare){try{g.PAssert(3407,paneDoc,"Must supply a valid paneDoc if sharing a file")}catch(PERR){g.reportError(PERR)}paneDoc.getDocumentFolder(function(folderID){runUpload(folderID)})}else runUpload()}.bind(this)}.bind(this))},findMatchExact:function findMatchExactFn(text){},findMatchLike:function findMatchLikeFn(text,maxCount){var textLower=text.toLowerCase(),results=this.findCachedItemsByFn(function(item){return item.titleLower.indexOf(textLower)>=0},maxCount);return results.sort(function(lEntry,rEntry){return lEntry.modifiedDate&&rEntry.modifiedDate?Date.compare(lEntry.modifiedDate,rEntry.modifiedDate):lEntry.modifiedDate?-1:rEntry.modifiedDate?1:lEntry.titleLower.localeCompare(rEntry.titleLower)}),results},previewTemplate:function previewTemplateFn(){return void 0},getItemText:function getItemTextFn(item){return this.getAttachmentEmbedString(item)},getItemTextLength:function getItemTextLengthFn(item){return 1},autocompleteWidth:function autocompleteWidthFn(){return 350}};return util.inherit(VMPlugin,Plugin_Drive),util.extend(Plugin_Drive.prototype,Plugin_DriveFns),Plugin_Drive}),define("plugins/Plugin_Mailbird",["globals","util","platform","goog","VMPlugin","DragDrop"],function(g,util,platform,goog,VMPlugin,DragDrop){function Plugin_Mailbird(){if(this._super.constructor.call(this,PluginID.Mailbird,"Mailbird"),this.autocompleteReplace=!0,this.declareProperty("subject",PluginLoad.Preview|PluginLoad.Full,!1,""),this.declareProperty("from",PluginLoad.Preview|PluginLoad.Full,!1,""),this.declareProperty("subjectLower",PluginLoad.Runtime,!1,""),this.declareProperty("fromLower",PluginLoad.Runtime,!1,""),this.declareProperty("unread",PluginLoad.Runtime,!0,!1),this.declareProperty("snippet",PluginLoad.Runtime,!0,""),this.declareProperty("latestMessageAt",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("provider",PluginLoad.Preview|PluginLoad.Full,!0),this.declareProperty("threadID",PluginLoad.Preview|PluginLoad.Full,!0),this.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.EmailThread),this.useRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.EmailThread),this.useRenderer(PluginRenderTypes.AutocompleteText,PluginRenderers.EmailThread),this.useRenderer(PluginRenderTypes.Measure,PluginRenderers.EmailThread),this.isMailbirdEmbed=platform.embed===EmbedApps.Mailbird,this.isMailbirdEmbed){this.setSetting("isEnabled",!0),g.nativeBridge.registerEmbedBridge(this);var nativeInAPI=g.nativeBridge.registerInboundAPI("mailbird");try{g.PAssert(3408,nativeInAPI,"Error creating native inbound API for mailbird")}catch(PERR){g.reportError(PERR)}nativeInAPI&&(nativeInAPI.registerVariable("_prevX"),nativeInAPI.registerVariable("_prevY"),nativeInAPI.registerFunction("dragOver",nativeAPIFns.dragOver,!0),nativeInAPI.registerFunction("drop",nativeAPIFns.drop,!0),nativeInAPI.registerFunction("dragLeave",nativeAPIFns.dragLeave,!0),nativeInAPI.registerFunction("reportError",nativeAPIFns.reportError,!0)),this._mailbirdOutAPI=g.nativeBridge.registerOutboundAPI("mailbird");try{g.PAssert(3409,this._mailbirdOutAPI,"Error creating native outbound API for mailbird")}catch(PERR){g.reportError(PERR)}this._mailbirdOutAPI&&(this._mailbirdOutAPI.requireFunction("selectConversation"),this._mailbirdOutAPI.requireFunction("selectConversationEx",!0),this._mailbirdOutAPI.requireFunction("scheduleNotifications",!0))}}var KnownEmailProviders={Gmail:"Gmail"},nativeAPIFns={dragOver:function dragOverFn(obj){var element=g.elementFromPoint(obj.x,obj.y);if(element){var diffX=void 0!==this._prevX?obj.x-this._prevX:0,diffY=void 0!==this._prevY?obj.y-this._prevY:0;this._prevX=obj.x,this._prevY=obj.y;var e={clientX:obj.x,clientY:obj.y,diffX:diffX,diffY:diffY,srcElement:element,target:element,dataTransfer:{}};DragDrop.handleDragOver(e)}},drop:function dropFn(obj){var element=g.elementFromPoint(obj.x,obj.y),options={clientX:obj.x,clientY:obj.y,target:element,srcElement:element,dataTransfer:{getData:function getDataFn(type){if("mailbird/email"===type){var inData={subject:obj.subject||"",from:obj.from||"",id:obj.mailMessageId?obj.mailMessageId:"mailbird_"+obj.id,latestMessageAt:obj.latestMessageAt};return obj.gmailID&&(inData.provider="Gmail",inData.threadID=obj.gmailID),inData}}},preventDefault:g.emptyFn,stopPropagation:g.emptyFn};setTimeout(function(){DragDrop.handleDrop(options)},0)},dragLeave:function dragLeaveFn(){DragDrop.handleDragLeave({target:document.getElementById("reactRoot")})},reportError:function reportErrorFn(errString){g.reportError(new Error(errString))}},Plugin_MailbirdFns={getPaneIcon:function getPaneIconFn(){return"icon-email"},useItemStore:function useItemStoreFn(){return"Mailbird"},_addRemoteEntry:function _addRemoteEntryFn(info){var entry={id:info.id,provider:info.provider,threadID:info.threadID,subject:info.subject,subjectLower:info.subject.toLowerCase(),from:info.from,fromLower:info.from.toLowerCase(),latestMessageAt:info.latestMessageAt};return this.cacheData(entry.id,entry),entry},createEntryFromLocal:function createEntryFromLocalFn(id,info){return info.subjectLower=info.subject.toLowerCase(),info.fromLower=info.from.toLowerCase(),info},getAttachmentClass:function getAttachmentClassFn(attach){return["plugin_mailbird"]},isPluginBlocked:function isPluginBlockedFn(){return!1},handleEmbedMessage:function handleEmbedMessageFn(method,data){switch(method){case"scheduledItems":if(this._mailbirdOutAPI.hasOptionalFunction("scheduleNotifications"))try{var notificationData=JSON.stringify(data);this._mailbirdOutAPI.call("scheduleNotifications",notificationData)}catch(err){g.reportError(err)}break;default:try{g.PAssert(3410,!1,"Unknown embed message: "+method)}catch(PERR){g.reportError(PERR)}}},handleDropEvent:function handleDropEventFn(e,cb){try{g.PAssert(3411,cb,"Must provide a valid callback to the drop event")}catch(PERR){g.reportError(PERR)}var info=e.dataTransfer.getData("mailbird/email");if(info){var email=this._addRemoteEntry(info);cb(this._getTextForItem(email));var newAttach=this.getAttachment(email.id);try{g.PAssert(3412,newAttach.isLoaded(),"Mailbird attachments must always be loaded after creation")}catch(PERR){g.reportError(PERR)}return this.writeAttachmentToPreviewCache(newAttach),!0}return!1},handleTapStart:function handleTapStartFn(vmli,id,e){return!0},handleTapEvent:function handleTapEventFn(vmli,id,e){var item=this.getCacheData(id);if(item){if(this.isMailbirdEmbed){var requireLegacySelect=item.id.startsWith("mailbird_"),returnValue;if(!requireLegacySelect&&this._mailbirdOutAPI.hasOptionalFunction("selectConversationEx")){var gmailID=null;if("Gmail"===item.provider){try{g.PAssert(3413,item.threadID,"Must provide a valid Gmail ID if it is defined as the provider")}catch(PERR){g.reportError(PERR)}gmailID=parseInt(item.threadID)}var id=item.id;returnValue=this._mailbirdOutAPI.call("selectConversationEx",gmailID,id,item.latestMessageAt)}else{var id=item.id.replace("mailbird_","");returnValue=this._mailbirdOutAPI.call("selectConversation",id)}try{g.PAssert(3414,void 0!==returnValue,"Must always receive a value back from Mailbird")}catch(PERR){g.reportError(PERR)}if(returnValue===!0||returnValue===!1)try{g.PAssert(3415,returnValue,"Must have successfully selected the email conversation in Mailbird: ",item.id,item.provider)}catch(PERR){g.reportError(PERR)}else{try{g.PAssert(3416,returnValue&&returnValue.then,"Must have a valid promise object returned")}catch(PERR){g.reportError(PERR)}returnValue.then(function(success){try{g.PAssert(3417,success,"Must have successfully selected the email conversation in Mailbird: ",item.id,item.provider)}catch(PERR){g.reportError(PERR)}},function(failure){try{g.PAssert(3418,!1,"Failed to successfully select the email conversation in Mailbird: ",item.id,item.provider)}catch(PERR){g.reportError(PERR)}})}}else switch(item.provider){case KnownEmailProviders.Gmail:g.openUrl("https://mail.google.com/mail/u/0/#inbox/"+item.threadID);break;default:g.messageQueue.pushMessage(MessageID.MailbirdClick)}return!0}return!1},matchAttachment:function matchAttachmentFn(attach,text){return attach.getField("fromLower").indexOf(text)>=0||attach.getField("subjectLower").indexOf(text)>=0},findMatchExact:function findMatchExactFn(text){},findMatchLike:function findMatchLikeFn(text,maxCount){var textLower=text.toLowerCase();return this.findCachedItemsByFn(function(item){return item.subjectLower.indexOf(textLower)>=0||item.fromLower.indexOf(textLower)>=0},maxCount)},supportOfflineCache:function supportOfflineCacheFn(){return!0},usesPreviewCache:function usesPreviewCacheFn(){return!0},previewTemplate:function previewTemplateFn(){return void 0},getItemText:function getItemTextFn(item){return this.getAttachmentEmbedString(item)},getItemTextLength:function getItemTextLengthFn(item){return 1},autocompleteWidth:function autocompleteWidthFn(){return 450},getAutocompletePrefixes:function getAutocompletePrefixesFn(){return["m:","mailbird:"]}};return util.inherit(VMPlugin,Plugin_Mailbird),util.extend(Plugin_Mailbird.prototype,Plugin_MailbirdFns),Plugin_Mailbird}),define("plugins/Plugin_Gmail_Pane",["ko","globals","util","data","VMPane"],function(ko,g,util,d,VMPane){function Plugin_Gmail_Pane(p){this.plugin=g.vmMain.pluginManager.getPlugin(PluginID.Gmail),this._super.constructor.call(this,p),this.type=this.plugin._paneType,this.paneClass="paneNormal panePlugin paneGmail",this.paneEmptyMessage="Loading Gmail...",this.dropEffect=g.isDemoMode()?DropEffect.Move:DropEffect.Copy,this.isWriteable=!1,this.overrideCopyBehavior=!1,this.supportCollapsing=!0,this.supportCompleting=!1,this.supportOffline=!1,this.supportPerformArchive=!1,this.supportDataRefresh=!0,this.supportPagination=!0,this.dragMarginTop=20,this.loadMoreOnScroll=ko.observable(!0),this.requestedPage=!1,this.numPagesLoaded=1,this.maxPagesOnScroll=4,this.shouldCheckHeight=!0,this.maxScrollOffset=0,this.loadingText=ko.observable(),util.forceBind("onScroll",this),this.initGmail()}var Plugin_Gmail_PaneFns={initGmail:function initGmailFn(){},onLoad:function onLoadFn(e){this._super.onLoad.call(this,e),this.addScrollListener(this.onScroll)},getItemStore:function getItemStoreFn(){return this.plugin.getActiveItemStore(this.id)},getRootItem:function getRootItemFn(){var itemStore=this.getItemStore();return itemStore?itemStore.getRoot():void 0},searchACName:function searchACNameFn(){return void 0},getPaneIcon:function getPaneIconFn(){return this.plugin.getPaneIcon()},requestDataPage:function requestDataPageFn(item){this.plugin.requestDataPage(item,this.onDataPagedIn.bind(this))},updateContents:function updateContentsFn(){this._super.updateContents.call(this)},onAfterLoaded:function onAfterLoadedFn(){this._super.onAfterLoaded.call(this)},onClose:function onCloseFn(){this._super.onClose.call(this)},onTapRunSearch:function onTapRunSearchFn(e,search){this.plugin.runSearch(search,this.id)},onTapClearSearch:function onTapClearSearchFn(e){this.plugin.clearSearch(this.id)},refreshPaneData:function refreshPaneDataFn(){this.plugin.refreshCurrentView(this.id)},onDataPagedIn:function onDataPagedInFn(){this.numPagesLoaded++,setTimeout(function(){this.numPagesLoaded>=this.maxPagesOnScroll&&(this.loadMoreOnScroll(!1),this.removeScrollListener(this.onScroll)),this.shouldCheckHeight=!0,this.requestedPage=!1}.bind(this),1e3)},onScroll:function onScrollFn(e){if(!this.requestedPage){if(this.shouldCheckHeight){var HeightCacheTime=5e3;this.maxScrollOffset=this.getMaxScrollOffset(),this.shouldCheckHeight=!1,setTimeout(function(){this.shouldCheckHeight=!0}.bind(this),HeightCacheTime)}var scroll=this.getScrollOffset();scroll>=maxScrollOffset&&(this.requestedPage=!0,this.requestDataPage(this.getItem()))}},showLoadMore:function showLoadMoreFn(){return this.supportPagination&&this.loadMoreOnScroll&&!this.loadMoreOnScroll()&&this.getItem().hasPaginationToken()},_onRemoteDataLoaded:function _onRemoteDataLoadedFn(){},heightOfItem:function heightOfItemFn(item,outline,isDragging){return isDragging?32:74}};return util.inherit(VMPane,Plugin_Gmail_Pane),util.extend(Plugin_Gmail_Pane.prototype,Plugin_Gmail_PaneFns),Plugin_Gmail_Pane}),define("plugins/Plugin_Gmail",["globals","util","platform","VMPlugin","plugins/Plugin_Gmail_Pane"],function(g,util,platform,VMPlugin,Plugin_Gmail_Pane){function Plugin_Gmail(){this._super.constructor.call(this,PluginID.Gmail,"Gmail"),this.autocompleteReplace=!0,this.declareProperty("subject"),this.declareProperty("from"),this.declareProperty("subjectLower",PluginLoad.Runtime),this.declareProperty("fromLower",PluginLoad.Runtime),this.declareProperty("unread",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("snippet",PluginLoad.Full),this.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.EmailThread),this.useRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.EmailThread),this.useRenderer(PluginRenderTypes.AutocompleteText,PluginRenderers.EmailThread),this.useRenderer(PluginRenderTypes.Measure,PluginRenderers.EmailThread)}var RequestType={Inbox:1,Thread:2,Search:3,DataPage:4},fromRegexp=/(?:\"?([^\"]*)\"?\s)?<(.*)>/g,DEFAULT_THREAD_MAX_RESULTS=20,MAX_EMAIL_PAGE_REQUESTS=1,requestFields="",Plugin_GmailFns={getDataPane:function getDataPaneFn(){try{g.PAssert(3419,!!this.getPaneIcon(),"Should have a pane icon specified")}catch(PERR){g.reportError(PERR)}return g.billingManager.isPremiumEnabled()?Plugin_Gmail_Pane:void 0},getPaneIcon:function getPaneIconFn(){return"icon-email"},useItemStore:function useItemStoreFn(){return"Gmail"},allowRemoteRequests:function allowRemoteRequestsFn(){return!0},loadInitialData:function loadInitialDataFn(){this._super.loadInitialData.call(this);var firstRequestLoaded=!1,itemStore=this.getDefaultItemStore(),item=itemStore.getRoot();this._requestRemoteThreads(RequestType.Inbox,item,void 0,DEFAULT_THREAD_MAX_RESULTS,function(entry){this._addRemoteEntry(entry),this.initVMLIsFromGmailThread(entry)}.bind(this),function(){firstRequestLoaded||(firstRequestLoaded=!0,this.finishedLoading())}.bind(this))},requestDataPage:function requestDataPageFn(item,doneCB){this._requestRemoteThreads(RequestType.DataPage,item,void 0,DEFAULT_THREAD_MAX_RESULTS,void 0,doneCB)},_requestRemoteThreads:function _requestRemoteThreadsFn(type,reqItem,q,maxResults,entryCB,doneCB){var paginationToken;reqItem&&reqItem.hasPaginationToken()&&(paginationToken=reqItem.beginDataPageLoad(),q=paginationToken.q,maxResults=paginationToken.maxResults,entryCB=paginationToken.entryCB,doneCB=doneCB||paginationToken.doneCB),maxResults=maxResults||DEFAULT_FILE_MAX_RESULTS;try{g.PAssert(3420,entryCB&&g.isFunction(entryCB),"Must define a valid entry callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3421,doneCB&&g.isFunction(doneCB),"Must define a valid done callback")}catch(PERR){g.reportError(PERR)}var requestFn=gapi.client.gmail.users.threads.list,requestData={userId:"me",maxResults:maxResults,q:q,pageToken:paginationToken?paginationToken.nextPageToken:void 0},successThreadCB=function(results){if(results.threads)for(var successThreadGetCB=function(result){result&&entryCB(result)}.bind(this),failureThreadGetCB=function(result){}.bind(this),i=0;i<results.threads.length;++i){var thread=results.threads[i],requestThreadFn=gapi.client.gmail.users.threads.get,requestThreadData={userId:"me",id:thread.id,format:"metadata"};this._queueRemoteRequest(requestThreadFn,requestThreadData,successThreadGetCB,failureThreadGetCB,void 0,RequestType.Thread)}var newPaginationToken;results.nextPageToken&&(newPaginationToken=paginationToken?this.updatePaginationToken(paginationToken,results.nextPageToken):this.createPaginationToken(results.nextPageToken,q,maxResults,entryCB,doneCB)),reqItem&&paginationToken?reqItem.endDataPageLoad(newPaginationToken):newPaginationToken&&reqItem.setPaginationToken(newPaginationToken),doneCB(!0)}.bind(this),failureThreadCB=function(results){paginationToken&&reqItem.endDataPageLoad(paginationToken),doneCB(!1)}.bind(this);this._queueRemoteRequest(requestFn,requestData,successThreadCB,failureThreadCB,void 0,type)},runRemoteSearch:function runRemoteSearchFn(search,paneID){},addSearchResultToBucket:function addSearchResultToBucketFn(bucketID,result){var entry=this._createRemoteEntry(result);
this.cacheData(entry.id,entry),this.createSearchResultItem(bucketID,entry.id,this._getTextForItem(entry))},getRemoteAttachmentData:function getRemoteAttachmentDataFn(attach){function _doAction(){var requestFn=gapi.client.gmail.users.threads.get,requestData={userId:"me",id:attach.id,format:"metadata"},successCB=function(result){result&&this._addRemoteEntry(result)}.bind(this),failureCB=function(result){attach.notifyDataRequestFailed()}.bind(this);this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,attach,RequestType.Thread)}window.gapi&&window.gapi.client&&window.gapi.client.gmail?_doAction.bind(this)():this._queueDeferredRemoteRequest(_doAction.bind(this))},_createRemoteEntry:function _createRemoteEntryFn(info){for(var entry={id:info.id,messages:[]},i=0;i<info.messages.length;++i){var msg=info.messages[i],msgEntry={id:msg.id,snippet:msg.snippet};msg.labelIds&&msg.labelIds.indexOf("UNREAD")>=0?(msg.unread=!0,entry.unread=!0,entry.cssClass="unread"):void 0===entry.unread&&(entry.unread=!1);for(var j=0;j<msg.payload.headers.length;++j){var header=msg.payload.headers[j];switch(header.name){case"From":msgEntry.from=header.value;break;case"Subject":msgEntry.subject=header.value}}msgEntry.subject||(msgEntry.subject=msg.snippet),entry.messages.push(msgEntry)}entry.snippet=entry.messages[entry.messages.length-1].snippet,fromRegexp.lastIndex=0;var fromMatch=fromRegexp.exec(entry.messages[0].from);return entry.subject=entry.messages[0].subject,entry.subjectLower=entry.subject.toLowerCase(),entry.from=fromMatch?fromMatch[1]||fromMatch[2]:entry.messages[0].from,entry.fromLower=entry.from.toLowerCase(),entry},_addRemoteEntry:function _addRemoteEntryFn(info){var entry=this._createRemoteEntry(info);this.cacheData(entry.id,entry)},createEntryFromLocal:function createEntryFromLocalFn(id,info){return info.subjectLower=info.subject.toLowerCase(),info.fromLower=info.from.toLowerCase(),info.unread&&(info.cssClass="unread"),info},finishedLoading:function finishedLoadingFn(){this._super.finishedLoading.call(this)},_getTextForThread:function _getTextForThreadFn(thread){try{g.PAssert(3422,thread,"Must be getting info for a valid thread")}catch(PERR){g.reportError(PERR)}return"From: "+thread.messages[0].from},initVMLIsFromGmailThread:function initVMLIsFromGmailThreadFn(thread){var itemStore=this.getDefaultItemStore(),root=itemStore.getRoot();if(!itemStore.hasItem(thread.id)){var threadVMLI=itemStore.createItem(thread.id,this._getTextForItem(thread),root.id);root.insertItem(threadVMLI)}},getAttachmentClass:function getAttachmentClassFn(){return["plugin_gmail"]},googleScopes:function googleScopesFn(){return[GScope.GmailRO]},getDependencies:function getDependenciesFn(){return[PluginDependency.DemoMode,PluginDependency.PremiumSub,PluginDependency.GmailAPI,PluginDependency.GoogleLogin]},isDependencyLoaded:function isDependencyLoadedFn(dep,data){var isLoaded=!1;switch(dep){case PluginDependency.GoogleLogin:data&&data.indexOf(GScope.GmailRO)>=0&&(isLoaded=!0);break;default:isLoaded=!0}return isLoaded},loadRemoteAPIs:function loadRemoteAPIsFn(){function loadGmailAPI(){g.loadGoogleAPI("gmail","v1",function(){g.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.GmailAPI)})}window.gapi&&window.gapi.client?loadGmailAPI():g.addCustomEventListener("gapiLoaded",loadGmailAPI)},handleTapStart:function handleTapStartFn(vmli,id,e){return platform.mobile&&e.preventDefault(),!0},handleTapEvent:function handleTapEventFn(vmli,id,e){if(!g.isDemoMode()){var gmailURL="https://mail.google.com/mail/u/0/#inbox/"+id;g.openUrl(gmailURL)}return platform.mobile&&(e.preventDefault(),g.preventClick()),!0},supportOfflineCache:function supportOfflineCacheFn(){return!0},usesPreviewCache:function usesPreviewCacheFn(){return!0},matchAttachment:function matchAttachmentFn(attach,text){return attach.getField("fromLower").indexOf(text)>=0||attach.getField("subjectLower").indexOf(text)>=0},findMatchExact:function findMatchExactFn(text){},findMatchLike:function findMatchLikeFn(text,maxCount){var textLower=text.toLowerCase();return this.findCachedItemsByFn(function(item){return item.subjectLower.indexOf(textLower)>=0||item.fromLower.indexOf(textLower)>=0},maxCount)},previewTemplate:function previewTemplateFn(){return void 0},getItemText:function getItemTextFn(item){return this.getAttachmentEmbedString(item)},getItemTextLength:function getItemTextLengthFn(item){return 1},autocompleteWidth:function autocompleteWidthFn(){return 350},getAutocompletePrefixes:function getAutocompletePrefixesFn(){return["g:","gmail:"]}};return util.inherit(VMPlugin,Plugin_Gmail),util.extend(Plugin_Gmail.prototype,Plugin_GmailFns),Plugin_Gmail}),define("plugins/Plugin_Moodo",["globals","util","platform","VMPlugin"],function(g,util,platform,VMPlugin){function Plugin_Moodo(){this._super.constructor.call(this,PluginID.Moodo,"Moodo"),this.setSetting("isEnabled",!0)}var RequestType={GenericSingle:1,GenericPaged:2,DrivePermissionsInsert:3,DrivePermissionsDelete:4,DrivePermissionsList:5,DriveFilesGet:6,DriveFilesList:7,DriveFilesTrash:8,DrivePropertiesInsert:9,DrivePropertiesUpdate:10,DriveParentsInsert:11,DriveParentsDelete:12,DriveChildrenList:13},drivePermissionFields="id,name,role,type,emailAddress",drivePermissionListFields="items("+drivePermissionFields+")",driveFileFields="createdDate,id,mimeType,owners(displayName,isAuthenticatedUser,permissionId,emailAddress),parents(id,isRoot),permissions(id,name,emailAddress,role,type),properties,shared,appDataContents,sharedWithMeDate,sharingUser(displayName,permissionId,emailAddress),title,userPermission(id,role,type)",driveFileListFields="items("+driveFileFields+"),nextPageToken",driveChildFields="id",driveChildListFields="items("+driveChildFields+"),nextPageToken",Plugin_MoodoFns={isPluginBlocked:function isPluginBlockedFn(){return!1},allowRemoteRequests:function allowRemoteRequestsFn(){return!0},runRemoteSingleRequest:function runRemoteSingleRequestFn(requestFn,requestData,successCB,failureCB){this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,RequestType.GenericSingle)},runRemotePagedRequest:function runRemotePagedRequestFn(requestFn,requestData,successCB,failureCB,options,type){this._queuePagedRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,type,options)},drivePermissionsInsert:function drivePermissionsInsertFn(fileID,emailAddr,successCB,failureCB){var requestFn=gapi.client.drive.permissions.insert,requestData={fileId:fileID,sendNotificationEmails:!1,resource:{value:emailAddr,type:"user",role:"writer",withLink:!1}};this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,RequestType.DrivePermissionsInsert)},drivePermissionsDelete:function drivePermissionsDeleteFn(fileID,permissionID,successCB,failureCB){var requestFn=gapi.client.drive.permissions.delete,requestData={fileId:fileID,permissionId:permissionID};this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,RequestType.DrivePermissionsDelete)},drivePermissionsList:function drivePermissionsListFn(fileID,successCB,failureCB){var requestFn=gapi.client.drive.permissions.list,requestData={fileId:fileID,fields:drivePermissionListFields};this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,RequestType.DrivePermissionsList)},driveFilesGet:function driveFilesGetFn(fileID,successCB,failureCB){var requestFn=gapi.client.drive.files.get,requestData={fileId:fileID,fields:driveFileFields};this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,RequestType.DriveFilesGet)},driveFilesList:function driveFilesListFn(q,successCB,failureCB,options){var requestFn=gapi.client.drive.files.list,requestData={q:q,fields:driveFileListFields};this.runRemotePagedRequest(requestFn,requestData,successCB,failureCB,options,RequestType.DriveFilesList)},driveFilesTrash:function driveFilesTrashFn(fileID,successCB,failureCB){var requestFn=gapi.client.drive.files.trash,requestData={fileId:fileID};this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,RequestType.DriveFilesTrash)},drivePropertiesInsert:function drivePropertiesInsertFn(fileID,key,value,successCB,failureCB){var requestFn=gapi.client.drive.properties.insert,requestData={fileId:fileID,resource:{key:key,value:value,visibility:"PRIVATE"}};this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,RequestType.DrivePropertiesInsert)},drivePropertiesUpdate:function drivePropertiesUpdateFn(fileID,key,value,successCB,failureCB){var requestFn=gapi.client.drive.properties.update,requestData={fileId:fileID,propertyKey:key,resource:{key:key,value:value,visibility:"PRIVATE"}};this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,RequestType.DrivePropertiesUpdate)},driveParentsInsert:function driveParentsInsertFn(fileID,parentID,successCB,failureCB){var requestFn=gapi.client.drive.parents.insert,requestData={fileId:fileID,resource:{id:parentID}};this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,RequestType.DriveParentsInsert)},driveParentsDelete:function driveParentsDeleteFn(fileID,parentID,successCB,failureCB){var requestFn=gapi.client.drive.parents.delete,requestData={fileId:fileID,parentId:parentID};this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,RequestType.DriveParentsDelete)},driveChildrenList:function driveChildrenListFn(folderID,successCB,failureCB,options){var requestFn=gapi.client.drive.children.list,requestData={folderId:folderID,fields:driveChildListFields};this.runRemotePagedRequest(requestFn,requestData,successCB,failureCB,options,RequestType.DriveChildrenList)}};return util.inherit(VMPlugin,Plugin_Moodo),util.extend(Plugin_Moodo.prototype,Plugin_MoodoFns),Plugin_Moodo}),define("plugins/Plugin_GCalendar_Modal_EventView",["ko","globals","util","ModalBase"],function(ko,g,util,ModalBase){function ModalEventView_GCalendar(id){this._super.constructor.call(this,id),this._attach=void 0,this._summary=ko.observable(""),this._description=ko.observable(""),this.init()}var ModalEventView_GCalendarFns={init:function initFn(){this.registerModal()},openDialog:function openDialogFn(attach){this._setModalData(attach),g.menus.openModal(this.id)},closeDialog:function closeDialogFn(){g.menus.closeModal(this.id),this.clearModalData()},_setModalData:function _setModalDataFn(attach){this._attach||(this._attach=attach,this._attach.subscribe(this)),attach.getField("startTime"),attach.getField("endTime"),this._summary(attach.getField("summary")),attach.getField("allDayEvent"),attach.getField("attendees"),attach.getField("location"),this._description(attach.getField("description")),attach.getField("organizer")},clearModalData:function clearModalDataFn(){this._attach.unsubscribe(this),this._attach=void 0,this._summary(""),this._description("")},getDisplayText:function getDisplayTextFn(){return this._summary()+":  "+this._description()},onAttachmentUpdate:function onAttachmentUpdateFn(attach){try{g.PAssert(3424,this._attach===attach,"Should only be receiving updates for the current attachment")}catch(PERR){g.reportError(PERR)}this._setModaldata(attach)},onAttachmentIDChange:function onAttachmentIDChangeFn(attach,oldID){}};return util.inherit(ModalBase,ModalEventView_GCalendar),util.extend(ModalEventView_GCalendar.prototype,ModalEventView_GCalendarFns),ModalEventView_GCalendar}),define("plugins/Plugin_GCalendar",["globals","util","platform","VMPlugin","International","plugins/Plugin_GCalendar_Modal_EventView"],function(g,util,platform,VMPlugin,International,ModalEventView){function Plugin_GCalendar(){this._super.constructor.call(this,PluginID.GCalendar,"Calendar"),this._updateSyncTimes(),this._numEntriesSyncd=0,this.registerSetting(PluginSettings.WriteAccess,!0),this.registerSetting(PluginSettings.CalSyncList,!0),this.registerModal(PluginModals.EventView,ModalEventView),this._eventCache=this.registerLocalCache("EventCache",StorageType.IndexedDB),this.declareProperty("isInvited",PluginLoad.Runtime),this.declareProperty("calendarID",PluginLoad.Preview|PluginLoad.Full),this.declareProperty("summary",PluginLoad.Preview|PluginLoad.Full),this.declareProperty("startTime",PluginLoad.Preview|PluginLoad.Full),this.declareProperty("endTime",PluginLoad.Preview|PluginLoad.Full),this.declareProperty("allDayEvent",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("eid",PluginLoad.Preview|PluginLoad.Full),this.declareProperty("isCompleted",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("starred",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("priority",PluginLoad.Preview|PluginLoad.Full,!0,VMLIFlag.None),this.declareProperty("isDeleted",PluginLoad.Preview|PluginLoad.Full,!0,!1),this.declareProperty("sourceTitle",PluginLoad.Full,!0),this.declareProperty("sourceURL",PluginLoad.Full,!0),this.declareProperty("location",PluginLoad.Full,!0),this.declareProperty("description",PluginLoad.Full,!0),this.declareProperty("attendees",PluginLoad.Full,!0),this.declareProperty("organizer",PluginLoad.Full,!0),this.useRenderer(PluginRenderTypes.AgendaEntry,PluginRenderers.CalendarEvent),this.useRenderer(PluginRenderTypes.StyledText,PluginRenderers.CalendarEvent),this.useRenderer(PluginRenderTypes.UnstyledText,PluginRenderers.CalendarEvent),this.useRenderer(PluginRenderTypes.AutocompleteText,PluginRenderers.CalendarEvent),this.useRenderer(PluginRenderTypes.Measure,PluginRenderers.CalendarEvent)}var requestFieldsEvent="id,description,end,location,start,status,summary,htmlLink,recurrence,attendees,source",PluginModals={EventView:"EventView"},PluginSettings={WriteAccess:"writeAccess",CalSyncList:"calSyncList"},CacheMetadata={SyncTokens:"syncTokens"},CalendarPropertiesPrefix="MDCProp_",CalendarProperties={IsCompleted:"isCompleted",Priority:"priority",Starred:"starred"},RequestType={Settings:1,EventSync:2,PropUpdate:3,CalendarList:4,Colors:5,SingleEvent:6},Plugin_GCalendarFns={allowRemoteRequests:function allowRemoteRequestsFn(){return!0},useItemStore:function useItemStoreFn(){return"Google Calendar"},itemStoreOptions:function itemStoreOptionsFn(){var enabledFilters=ItemStoreFilter.Dates;return{enabledFilters:enabledFilters}},supportOfflineLoad:function supportOfflineLoadFn(){return!0},supportOfflineCache:function supportOfflineCacheFn(){return!0},googleScopes:function googleScopesFn(){return this.getSetting(PluginSettings.WriteAccess)?[GScope.Calendar]:[GScope.CalendarRO]},getDependencies:function getDependenciesFn(){return[PluginDependency.EarlyAccess,PluginDependency.CalendarAPI,PluginDependency.GoogleLogin]},onDependencyLoaded:function onDependencyLoadedFn(dep,data){if(this._super.onDependencyLoaded.call(this,dep,data),dep===PluginDependency.GoogleLogin){try{g.PAssert(3425,g.isArray(data),"Must provide a valid scope array")}catch(PERR){g.reportError(PERR)}this.getSetting("isEnabled")&&data.indexOf(GScope.CalendarRO)<0&&data.indexOf(GScope.Calendar)<0&&(g.messageQueue.pushMessage(MessageID.LostPermission),this.setSetting("isEnabled",!1)),this.getSetting(PluginSettings.WriteAccess)&&data.indexOf(GScope.Calendar)<0&&(g.messageQueue.pushMessage(MessageID.LostPermission),this.setSetting(PluginSettings.WriteAccess,!1))}},isDependencyLoaded:function isDependencyLoadedFn(dep,data){var isLoaded=!1;switch(dep){case PluginDependency.GoogleLogin:data&&(data.indexOf(GScope.CalendarRO)>=0||data.indexOf(GScope.Calendar)>=0)&&(isLoaded=!0);break;default:isLoaded=!0}return isLoaded},loadRemoteAPIs:function loadRemoteAPIsFn(){function loadCalendarAPI(){g.loadGoogleAPI("calendar","v3",function(){g.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.CalendarAPI)})}window.gapi&&window.gapi.client?loadCalendarAPI():g.addCustomEventListener("gapiLoaded",loadCalendarAPI)},_updateSyncTimes:function _updateSyncTimesFn(){this._minSyncStartTime=(new Date).addWeeks(-2),this._maxSyncStartTime=(new Date).addWeeks(2),this._minDisplayStartTime=(new Date).addWeeks(-1),this._maxDisplayStartTime=(new Date).addWeeks(1)},_shouldDisplayTime:function _shouldDisplayTimeFn(startDate,endDate){return endDate>=this._minDisplayStartTime&&endDate<=this._maxDisplayStartTime||startDate>=this._minDisplayStartTime&&startDate<=this._maxDisplayStartTime},_offlineLoad:function _offlineLoadFn(){this._eventCache.onCacheReady(function(){this._eventCache.getBoundEntries("startTime",this._minDisplayStartTime,this._maxDisplayStartTime,function(entries){for(var itemStore=this.getDefaultItemStore(),parent=itemStore.getRoot(),i=0;i<entries.length;++i){var entry=entries[i],cacheEntry=this.createEntryFromLocal(entry.id,entry);this.cacheData(cacheEntry.id,cacheEntry);try{g.PAssert(3426,!itemStore.hasItem(cacheEntry.id),"Load should never try to create a VMLI that has already been created")}catch(PERR){g.reportError(PERR)}var vmli=itemStore.createItem(cacheEntry.id,this._createItemText(cacheEntry),parent.id);parent.insertItem(vmli)}}.bind(this))}.bind(this))},_load:function _loadFn(){g.isDemoMode()||this.createRecurringTask("CalendarEventSync",{delay:g.minutes(15),minDelay:g.minutes(5),runOnCreate:!0,pauseWhileIdle:!0,task:this.runCalendarSync.bind(this)})},handleTapStart:function handleTapStartFn(vmli,id,e){return platform.mobile&&e.preventDefault(),!0},handleTapEvent:function handleTapEventFn(vmli,id,e){var item=this.getCacheData(id);if(item){if(this.isPluginPane(g.focusedPane));else if(platform.mobile){var attach=this.getAttachment(id),html=this.createDisplayElement(attach);e.preventDefault(),e.preventClick(),g.menus.openMenuExternalApp(html,function(){item.eid&&(url="https://www.google.com/calendar/event?eid="+item.eid),url&&g.openUrl(url,e)}.bind(this)),g.sendEvent(this.id,"Tap_OpenGCalendarMobile")}else if(!g.isDemoMode()){var attach=this.getAttachment(id);this.openModal(PluginModals.EventView,attach),g.sendEvent(this.id,"Tap_OpenGCalendarDesktop")}return!0}return!1},_createItemText:function _createItemTextFn(entry){try{g.PAssert(3427,entry,"Must specify a valid attachment")}catch(PERR){g.reportError(PERR)}var outText,startTimeStr=entry.startTime.toString(International.getFormat(DFormat.ShortDayTime));return outText=this._getTextForItem(entry)+" "+DatePrefix+startTimeStr},getRemoteAttachmentData:function getRemoteAttachmentDataFn(attach){function _doAction(){var requestFn=gapi.client.calendar.events.get,requestData={eventId:attach.id,calendarId:attach.getField("calendarID")},successCB=function(result){},failureCB=function(result){attach.notifyDataRequestFailed()};this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,attach,RequestType.SingleEvent)}try{g.PAssert(3428,attach.hasField("calendarID"),"Must have a valid calendarID for an event")}catch(PERR){g.reportError(PERR)}window.gapi&&window.gapi.client&&window.gapi.client.calendar?_doAction.bind(this)():this._queueDeferredRemoteRequest(_doAction.bind(this))},_createRemoteEntry:function _createRemoteEntryFn(calendarID,info){var startTime,endTime,eid,allDayEvent=!1;try{g.PAssert(3429,info.start,"Must always have valid start data")}catch(PERR){g.reportError(PERR)}if(info.start.dateTime){try{g.PAssert(3430,info.end.dateTime,"End date format should always match start")}catch(PERR){g.reportError(PERR)}startTime=new Date(info.start.dateTime),endTime=new Date(info.end.dateTime)}else if(info.start.date){try{g.PAssert(3431,info.end.date,"End date format should always match start")}catch(PERR){g.reportError(PERR)}startTime=new Date(info.start.date),endTime=new Date(info.end.date),allDayEvent=!0}info.htmlLink&&(eid=info.htmlLink.split("?eid=")[1]);var entry={id:info.id,calendarID:calendarID,status:info.status,summary:info.summary,startTime:startTime,endTime:endTime,allDayEvent:allDayEvent,eid:eid,isCompleted:this._getRemoteProperty(info,CalendarProperties.Iscompleted),starred:this._getRemoteProperty(info,CalendarProperties.Starred),priority:this._getRemoteProperty(info,CalendarProperties.Priority),attendees:info.attendees,location:info.location,description:info.description,organizer:info.organizer.displayName||info.organizer.email||info.organizer.id};return info.source&&(entry.sourceTitle=info.source.title,entry.sourceURL=info.source.url),entry},_addRemoteEntry:function _addRemoteEntryFn(info){var entry=this._createRemoteEntry(info);this.cacheData(entry.id,entry)},createEntryFromLocal:function createEntryFromLocalFn(id,info){return info},_getRemoteSettings:function _getRemoteSettingsFn(cb){var requestFn=gapi.client.calendar.settings.list,requestData={},successCB=function(result){cb(result)},failureCB=function(result){cb()};this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,RequestType.Settings)},_getRemoteColors:function _getRemoteColorsFn(cb){var requestFn=gapi.client.calendar.colors.get,requestData={},successCB=function(result){cb(result)},failureCB=function(result){cb()};this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,RequestType.Colors)},_getRemoteProperty:function _getRemotePropertyFn(info,prop){var value;try{g.PAssert(3432,info,"Must provide valid event info")}catch(PERR){g.reportError(PERR)}return info.extendedProperties&&info.extendedProperties.private&&(value=info.extendedProperties.private[CalendarPropertiesPrefix+prop]),value},_updateRemoteProperty:function _updateRemotePropertyFn(calendarId,eventId,prop,value,cb){var propObj={};propObj[CalendarPropertiesPrefix+prop]=value;var requestFn=gapi.client.calendar.events.patch,requestData={calendarId:calendarId,eventId:eventId,resource:{extendedProperties:{"private":propObj}}},successCB=function(result){cb(!0)},failureCB=function(result){cb(!1)};this._queueRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,RequestType.PropUpdate)},getReadableCalendarList:function getReadableCalendarListFn(cb){return this._getCalendarList("reader",cb)},getWritableCalendarList:function getWritableCalendarListFn(cb){return this._getCalendarList("writer",cb)},_getCalendarList:function _getCalendarListFn(minAccessRole,cb){var requestFn=gapi.client.calendar.calendarList.list,requestData={minAccessRole:minAccessRole},options={getAllPages:!0},successCB=function(result){cb(result)},failureCB=function(result){cb()};this._queuePagedRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,RequestType.CalendarList,options)},handleEventUpdate:function handleEventUpdateFn(calendarID,entry){this._numEntriesSyncd++;var itemStore=this.getDefaultItemStore();if("cancelled"===entry.status){if(this._eventCache.removeEntry(entry.id),this.hasCacheData(entry.id)){var attach=this.getAttachment(entry.id);attach.forEachItem(itemStore,function(item){item.parent().removeChild(item),item.parent(void 0)}.bind(this)),attach.updateField("isDeleted",!0)}}else{var cacheEntry=this._createRemoteEntry(calendarID,entry);this.cacheData(cacheEntry.id,cacheEntry),this._eventCache.cacheEntry(entry.id,this.serializeExternalData(cacheEntry));var parent=itemStore.getRoot(),vmli;itemStore.hasItem(cacheEntry.id)?(vmli=itemStore.getItem(cacheEntry.id),vmli.setText(this._createItemText(cacheEntry),!0,ChangeType.Auto)):this._shouldDisplayTime(cacheEntry.startTime,cacheEntry.endTime)&&(vmli=itemStore.createItem(cacheEntry.id,this._createItemText(cacheEntry),parent.id),parent.insertItem(vmli))}},setSyncToken:function setSyncTokenFn(calendarID,syncToken,cb){try{g.PAssert(3433,g.isString(calendarID),"Must provide a valid calendar ID to clear sync token for")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3434,g.isString(syncToken),"Must provide a valid calendar ID to clear sync token for")}catch(PERR){g.reportError(PERR)}this._eventCache.getMetadata(CacheMetadata.SyncTokens,function(syncTokens){syncTokens=syncTokens||{},syncTokens[calendarID]=syncToken,this._eventCache.setMetadata(CacheMetadata.SyncTokens,syncTokens)}.bind(this))},clearSyncToken:function clearSyncTokenFn(calendarID,cb){try{g.PAssert(3435,g.isString(calendarID),"Must provide a valid calendar ID to clear sync token for")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3436,g.isFunction(cb),"Must provide valid CB function when clearing sync token")}catch(PERR){g.reportError(PERR)}this._eventCache.getMetadata(CacheMetadata.SyncTokens,function(syncTokens){delete syncTokens[calendarID],this._eventCache.setMetadata(CacheMetadata.SyncTokens,syncTokens),cb()}.bind(this))},clearCalendarEventCache:function clearCalendarEventCacheFn(calendarID,cb){try{g.PAssert(3437,g.isString(calendarID),"Must provide a valid calendar ID to clear event cache for")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3438,g.isFunction(cb),"Must provide valid CB function when clearing event cache")}catch(PERR){g.reportError(PERR)}this._eventCache.clearCache(function(success){cb(success)})},_calendarSyncComplete:function _calendarSyncCompleteFn(syncSuccessCalendars,syncFailureCalendars){},runCalendarSync:function runCalendarSyncFn(){var numCalendarsSyncing=0,numCalendarsSyncd=0,calendarsSuccessfulSync=[],calendarsFailedSync=[],calendarSyncComplete=function(success,calendarID){try{g.PAssert(3439,numCalendarsSyncing>numCalendarsSyncd,"Should never have more calendars syncd than we tried to sync")}catch(PERR){g.reportError(PERR)}success?calendarsSuccessfulSync.push(calendarID):calendarsFailedSync.push(calendarID),++numCalendarsSyncd===numCalendarsSyncing&&this._calendarSyncComplete(calendarsSuccessfulSync,calendarsFailedSync)}.bind(this);this._eventCache.onCacheMetadataReady(function(){this._eventCache.getMetadata(CacheMetadata.SyncTokens,function(syncTokens){var syncList=this.getSetting(PluginSettings.CalSyncList)||["primary"];numCalendarsSyncing=syncList.length;for(var i=0;i<syncList.length;++i){var syncToken=syncTokens?syncTokens[syncList[i]]:void 0;this.performCalendarSync(syncList[i],syncToken,calendarSyncComplete)}}.bind(this))}.bind(this))},performCalendarSync:function performCalendarSyncFn(calendarID,syncToken,cb){try{g.PAssert(3440,g.isString(calendarID),"Must provide a valid calendar ID for each sync op")}catch(PERR){g.reportError(PERR)}var requestFn=gapi.client.calendar.events.list,requestData={calendarId:calendarID},options={getAllPages:!0};syncToken?requestData.syncToken=syncToken:(requestData.timeMin=this._minSyncStartTime.toISOString(),requestData.timeMax=this._maxSyncStartTime.toISOString(),requestData.singleEvents=!0);var successCB=function(result,outData,response){var nextSyncToken;response&&(nextSyncToken=response.nextSyncToken,this.setSyncToken(calendarID,nextSyncToken));for(var i=0;i<result.length;++i)this.handleEventUpdate(calendarID,result[i]);cb(!0,calendarID)}.bind(this),failureCB=function(result){result&&410===result.error?this.clearSyncToken(calendarID,function(){this.clearCalendarEventCache(calendarID,function(success){success?this.performCalendarSync(calendarID,void 0,cb):cb(!1,calendarID)}.bind(this))}.bind(this)):cb(!1,calendarID)}.bind(this);this._queuePagedRemoteRequest(requestFn,requestData,successCB,failureCB,void 0,RequestType.EventSync,options)},getAttachmentClass:function getAttachmentClassFn(attach){return["plugin_gcalendar"]},matchAttachment:function matchAttachmentFn(attach,text){var startTimeStr=DatePrefix+attach.getField("startTime").toString(International.getFormat(DFormat.ShortDayTime));return attach.getField("summary").indexOf(text)>=0||startTimeStr.indexOf(text)>=0}};return util.inherit(VMPlugin,Plugin_GCalendar),util.extend(Plugin_GCalendar.prototype,Plugin_GCalendarFns),Plugin_GCalendar}),define("VMPluginManager",["globals","util","platform","Dispatcher","PluginRenderer","VMPlugin","plugins/Plugin_Drive","plugins/Plugin_Mailbird","plugins/Plugin_Gmail","plugins/Plugin_Moodo","plugins/Plugin_GCalendar"],function(g,util,platform,Dispatcher,PluginRenderer,VMPlugin,Plugin_Drive,Plugin_Mailbird,Plugin_Gmail,Plugin_Moodo,Plugin_GCalendar){function VMPluginManager(){this._plugins={},this._activePlugins=[],this._loadedDependencies={},this._iteratingPlugins=!1,this._queueTimeout=void 0,this._forcedLastPossible=!1,this._numOutstandingReqs=0,this._pluginRenderer=new PluginRenderer,this.init()}var maxRequestsAtOnce=6,maxSinglePluginRequestsAtOnce=4,queueRequestTimeoutTime=g.seconds(15);return VMPluginManager.prototype={init:function initFn(){util.forceBind("_pumpRequestQueues",this),util.forceBind("_handleRequestResponse",this),util.forceBind("_handleBatchRequestResponse",this),this._setupRequestQueues(),this._pluginRenderer.registerDefaultRenderers(),g.billingManager.hasPremiumFeatures()?(this.notifyDependencyLoad(PluginDependency.EarlyAccess),this.notifyDependencyLoad(PluginDependency.PremiumSub)):g.billingManager.hasEarlyAccess()&&this.notifyDependencyLoad(PluginDependency.EarlyAccess),g.isDemoMode()&&this.notifyDependencyLoad(PluginDependency.DemoMode),Dispatcher.listen("resetEverything",this._clearRequestQueues.bind(this))},printStats:function printStatsFn(){var pluginKeys=Object.keys(this._plugins);log("---- Plugin Stats ----");for(var i=0;i<pluginKeys.length;++i){var plugin=this._plugins[pluginKeys[i]],pStat=plugin.getStats();log(plugin.name),log(" Stats: ",pStat)}log("----------------------")},getStats:function getStatsFn(){for(var stats={},pluginKeys=Object.keys(this._plugins),i=0;i<pluginKeys.length;++i){var plugin=this._plugins[pluginKeys[i]];stats[plugin.id]=plugin.getStats()}return stats},registerPlugins:function registerPluginsFn(){try{this.registerPlugin(new Plugin_Moodo)}catch(err){g.reportError(err)}try{this.registerPlugin(new Plugin_Drive)}catch(err){g.reportError(err)}if(g.isDemoMode())try{this.registerPlugin(new Plugin_Gmail)}catch(err){g.reportError(err)}try{this.registerPlugin(new Plugin_GCalendar)}catch(err){g.reportError(err)}try{this.registerPlugin(new Plugin_Mailbird)}catch(err){g.reportError(err)}},registerPlugin:function registerPluginFn(plugin){try{g.PAssert(3441,!this._plugins[plugin.id],"Should never double-register a plguin")}catch(PERR){g.reportError(PERR)}this._plugins[plugin.id]=plugin,this.isAuthorized(plugin.id)&&this.loadPlugin(plugin.id)},getPlugin:function getPluginFn(id){return this._plugins[id]},loadPlugin:function loadPluginFn(id){var plugin=this.getPlugin(id);try{g.PAssert(3442,plugin,"Must register a plugin before loading it")}catch(PERR){g.reportError(PERR)}this.activatePlugin(plugin)},unloadPlugin:function unloadPluginFn(id){},authorizePlugin:function authorizePluginFn(id,cb){try{g.PAssert(3443,cb&&g.isFunction(cb),"Must provide a valid callback fn")}catch(PERR){g.reportError(PERR)}var plugin=this.getPlugin(id);try{g.PAssert(3444,plugin,"Must register a plugin before loading it")}catch(PERR){g.reportError(PERR)}plugin.authorize(function(success){plugin.setSetting("isEnabled",success),success&&this.activatePlugin(plugin),cb(success)}.bind(this))},deauthorizePlugin:function deauthorizePluginFn(id,cb){try{g.PAssert(3445,cb&&g.isFunction(cb),"Must provide a valid callback fn")}catch(PERR){g.reportError(PERR)}var plugin=this.getPlugin(id);try{g.PAssert(3446,plugin,"Must register a plugin before loading it")}catch(PERR){g.reportError(PERR)}plugin.setSetting("isEnabled",!1),this.deactivatePlugin(plugin),cb(!0)},activatePlugin:function activatePluginFn(plugin){try{g.PAssert(3447,plugin,"Plugin must be valid to be activated")}catch(PERR){g.reportError(PERR)}if(this._activePlugins.indexOf(plugin.id)<0){var success=plugin.activate(this._loadedDependencies);success&&this._activePlugins.push(plugin.id)}else plugin.ensurePaneTypeIsActive()},deactivatePlugin:function deactivatePluginFn(plugin){try{g.PAssert(3448,plugin,"Plugin must be valid to be deactivated")}catch(PERR){g.reportError(PERR)}if(this._activePlugins.indexOf(plugin.id)>=0){var success=plugin.deactivate();success&&this._activePlugins.remove(plugin.id)}},goOnline:function goOnlineFn(){for(var i=0;i<this._activePlugins.length;++i){var plugin=this._plugins[this._activePlugins[i]];try{plugin.goOnline()}catch(err){this._reportPluginError(err)}}},goOffline:function goOfflineFn(){for(var i=0;i<this._activePlugins.length;++i){var plugin=this._plugins[this._activePlugins[i]];try{plugin.goOffline()}catch(err){this._reportPluginError(err)}}},onDocumentShared:function onDocumentSharedFn(firstShare){for(var i=0;i<this._activePlugins.length;++i){var plugin=this._plugins[this._activePlugins[i]];
try{plugin.onDocumentShared(firstShare)}catch(err){this._reportPluginError(err)}}},writeCaches:function writeCachesFn(){for(var i=0;i<this._activePlugins.length;++i){var plugin=this._plugins[this._activePlugins[i]];try{plugin.saveOfflineCache()}catch(err){this._reportPluginError(err)}}},onShutdown:function onShutdownFn(writeCaches){writeCaches&&this.writeCaches()},onPurgeData:function onPurgeDataFn(){for(var i=0;i<this._activePlugins.length;++i){var plugin=this._plugins[this._activePlugins[i]];try{plugin.clearOfflineCache(!0)}catch(err){this._reportPluginError(err)}}},onClearData:function onClearDataFn(){for(var i=0;i<this._activePlugins.length;++i){var plugin=this._plugins[this._activePlugins[i]];try{plugin.clearData()}catch(err){this._reportPluginError(err)}}},validatePlugin:function validatePluginFn(id){},runForEachPlugin:function runForEachPluginFn(fn){this._iteratingPlugins=!0;for(var i=0;i<this._activePlugins.length;++i)try{fn(this.getPlugin(this._activePlugins[i]))}catch(err){g.reportError(err)}this._iteratingPlugins=!1},getAttachment:function getAttachmentFn(obj){try{g.PAssert(3449,obj.p,"Must specify the plugin string to be used")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3450,obj.id,"Must specify the ID of the data to use from the plugin")}catch(PERR){g.reportError(PERR)}var plugin=this.getPlugin(obj.p);try{g.PAssert(3451,plugin,"Must specify a valid plugin")}catch(PERR){g.reportError(PERR)}return plugin?(plugin.isActive()||this.activatePlugin(plugin),plugin.getAttachment(obj.id)):void 0},createDisplayElement:function createDisplayElementFn(obj,padBefore,padAfter){try{g.PAssert(3452,obj.p,"Must specify the plugin string to be used")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3453,obj.id,"Must specify the ID of the data to use from the plugin")}catch(PERR){g.reportError(PERR)}var styledText,plugin=this.getPlugin(obj.p);if(plugin){var attach=this.getAttachment(obj);try{styledText=plugin.createDisplayElement(attach,padBefore,padAfter)}catch(err){this._reportPluginError(err)}}else styledText=this.createUnknownPluginElement(obj.p);return styledText},createUnknownPluginElement:function createUnknownPluginElementFn(id){return{}},measureAttachment:function measureAttachmentFn(pane,wordStyles){try{g.PAssert(3454,wordStyles&&wordStyles.attrs&&wordStyles.attrs.plugin,"Must have a valid plugin ID for measuring")}catch(PERR){g.reportError(PERR)}var width=0,plugin=this.getPlugin(wordStyles.attrs.plugin);try{g.PAssert(3455,plugin,"Should always be able to find a valid plugin: ",wordStyles.attrs.plugin)}catch(PERR){g.reportError(PERR)}return plugin&&(width=plugin.measureAttachment(pane,wordStyles)),width},parseAttachmentEmbedString:function parseAttachmentEmbedStringFn(str,padBefore,padAfter){try{g.PAssert(3456,str,"Must provide a valid string to parse")}catch(PERR){g.reportError(PERR)}var properties=str.replace(/&quot;/g,'"').split(","),obj={};return properties.forEach(function(property){var indexColon=property.indexOf(":"),key=property.substr(0,indexColon),value=property.substr(indexColon+1,property.length-indexColon-1);obj[key]=value}),obj.displayElement=this.createDisplayElement(obj,padBefore,padAfter),obj},getAttachmentFromElement:function getAttachmentFromElementFn(element){var pluginName=element.getAttribute("plugin"),pluginID=element.getAttribute("plugin-id");try{g.PAssert(3457,pluginName,"Element must have a plugin set")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3458,pluginID,"Element must have a plugin ID set")}catch(PERR){g.reportError(PERR)}var plugin=this.getPlugin(pluginName),attachment=plugin.getAttachment(pluginID);return attachment},handleDropEvent:function handleDropEventFn(e,cb){for(var handled=!1,i=0;i<this._activePlugins.length&&!handled;++i){var pluginID=this._activePlugins[i],plugin=this.getPlugin(pluginID);try{handled=plugin.handleDropEvent(e,cb)}catch(err){this._reportPluginError(err)}}return handled},handleTapStart:function handleTapStartFn(vmli,e){var handled=!1,pluginElement=g.getPluginForElement(e.srcElement);if(pluginElement){var pluginName=pluginElement.getAttribute("plugin"),itemID=pluginElement.getAttribute("plugin-id"),plugin=this.getPlugin(pluginName);try{g.PAssert(3459,plugin,"Must be able to get a valid plugin from a plugin element")}catch(PERR){g.reportError(PERR)}try{handled=plugin.handleTapStart(vmli,itemID,e)}catch(err){this._reportPluginError(err)}}return handled},handleTapEvent:function handleTapEventFn(vmli,e){var handled=!1,pluginElement=g.getPluginForElement(e.srcElement);if(pluginElement){var pluginName=pluginElement.getAttribute("plugin"),plugin=this.getPlugin(pluginName);try{g.PAssert(3460,plugin,"Must be able to get a valid plugin from a plugin element")}catch(PERR){g.reportError(PERR)}if(plugin.isPluginBlocked())g.messageQueue.pushMessage(MessageID.PremiumRequired);else{var itemID=pluginElement.getAttribute("plugin-id");try{g.PAssert(3461,itemID,"Must have a valid item ID for a plugin element")}catch(PERR){g.reportError(PERR)}try{handled=plugin.handleTapEvent(vmli,itemID,e)}catch(err){this._reportPluginError(err)}}}return handled},isAuthorized:function isAuthorizedFn(id){return g.isDemoMode()?!0:this.getPlugin(id)?!!this.getSetting(id,"isEnabled"):!1},getSetting:function(pluginID,key){return this.getPlugin(pluginID).getSetting(key)},setSetting:function setSettingFn(pluginID,key,value){return this.getPlugin(pluginID).setSetting(key,value)},onAuthorizedSetting:function onAuthorizedSettingFn(pluginID,key,value){this.getPlugin(pluginID).onAuthorizedSetting(key,value)},isDependencyLoaded:function isDependencyLoadedFn(dep){return!!this._loadedDependencies[dep]},notifyDependencyLoad:function notifyDependencyLoadFn(dep,data){this._loadedDependencies[dep]=data||!0;for(var id in this._plugins)try{this.getPlugin(id).onDependencyLoaded(dep,data)}catch(err){this._reportPluginError(err)}},notifyDependencyUnload:function notifyDependencyUnloadFn(dep,data){},_handleBatchRequestResponse:function _handleBatchRequestResponseFn(plugin,success){try{g.PAssert(3463,plugin,"Plugin must be passed to response to know who is handling it")}catch(PERR){g.reportError(PERR)}this._numOutstandingReqs--;try{g.PAssert(3464,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(PERR){g.reportError(PERR)}try{plugin._handleBatchRequestResponse(success)}catch(err){this._reportPluginError(err)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()},_handleRequestResponse:function _handleRequestResponseFn(attach,plugin,wasBatched){try{g.PAssert(3465,plugin,"Plugin must be passed to response to know who is handling it")}catch(PERR){g.reportError(PERR)}if(!wasBatched){this._numOutstandingReqs--;try{g.PAssert(3466,this._numOutstandingReqs>=0,"Outstanding requests cannot be negative")}catch(PERR){g.reportError(PERR)}}try{plugin._handleRequestResponse(attach,wasBatched)}catch(err){this._reportPluginError(err)}0===this._numOutstandingReqs&&this.notifyNoOutstandingReqs()},notifyNoOutstandingReqs:function notifyNoOutstandingReqsFn(){try{g.PAssert(3467,0===this._numOutstandingReqs,"Should only notify when there are no outstanding reqs left")}catch(PERR){g.reportError(PERR)}0===this._numOutstandingReqs&&this._setupRequestQueues(!0)},notifyHasPendingRemoteRequest:function notifyHasPendingRemoteRequestFn(){this._numOutstandingReqs<maxRequestsAtOnce&&this._setupRequestQueues(!0)},_setupRequestQueues:function _setupRequestQueuesFn(nextPossible){var delay=nextPossible?0:queueRequestTimeoutTime;this._forcedLastPossible||(clearTimeout(this._queueTimeout),this._queueTimeout=setTimeout(this._pumpRequestQueues,delay)),this._forcedLastPossible=nextPossible},_pumpRequestQueues:function _pumpRequestQueuesFn(){var numRequested=0,availReqs=maxRequestsAtOnce-this._numOutstandingReqs;try{g.PAssert(3468,availReqs>=0,"Should never have more than max outstanding requests at any given point in time")}catch(PERR){g.reportError(PERR)}for(var i=0;availReqs>0&&i<this._activePlugins.length;++i){var pluginID=this._activePlugins[i],plugin=this.getPlugin(pluginID),pluginMaxRequests=Math.min(availReqs,maxSinglePluginRequestsAtOnce);if(pluginMaxRequests>0&&plugin.isReady()){var numReqSent=0;try{numReqSent=plugin._pumpRequestQueue(pluginMaxRequests,this._handleRequestResponse,this._handleBatchRequestResponse);try{g.PAssert(3469,numReqSent>=0,"Number of requests sent can never be negative")}catch(PERR){g.reportError(PERR)}}catch(err){this._reportPluginError(err)}numRequested+=numReqSent,availReqs-=numReqSent,this._numOutstandingReqs+=numReqSent}}return this._forcedLastPossible=!1,this._setupRequestQueues(),numRequested},_clearRequestQueues:function _clearRequestQueuesFn(){this._numOutstandingReqs=0;for(var i=0;i<this._activePlugins.length;++i){var pluginID=this._activePlugins[i],plugin=this.getPlugin(pluginID);try{plugin._clearRequestQueue()}catch(err){this._reportPluginError(err)}}},useRenderer:function useRendererFn(type,id){return this._pluginRenderer.useRenderer(type,id)},_reportPluginError:function _reportPluginErrorFn(err){g.reportError(err)}},VMPluginManager}),define("PaneManager",["globals","util","platform","PaneFactory","Dispatcher","Trigger","Sel","Observable","ObservableArray"],function(g,util,platform,PaneFactory,Dispatcher,Trigger,Sel,Observable,ObservableArray){function PaneManager(){this._panesById={},this._panes=new ObservableArray,this._iteratingPanes=!1,this._savedPaneState=void 0,this._activePaneState=[],this._swappedOutPanes=[],this.paneSize=new Observable,this.init()}return window.__TOTAL_PANES=0,PaneManager.prototype={init:function initFn(){var onResize=this.onResize.bind(this);this._panes.listen(onResize),platform.onResize.listen(onResize),setTimeout(function(){g.intro.reactIsShowing.listen(onResize)},0),this.onResize()},trackPaneState:function trackPaneStateFn(){return!g.isRunningScript()&&!g.isDemoMode()},getPanePadding:function getPanePaddingFn(){var MAGIC_VALUE_1=45;return MAGIC_VALUE_1},onResize:function onResizeFn(){var pane=this.getPaneAtIndex(0);if(pane){var size={width:this.calculatePaneWidth(),height:platform.windowHeight()-this.getPanePadding()};this.paneSize.set(size),Dispatcher.fireEvent("paneSizeChanged",[])}},getNextPaneID:function getNextPaneIDFn(){return++window.__TOTAL_PANES},getAllPerPaneState:function getAllPerPaneStateFn(itemID,field){for(var state=[],paneCount=this.paneCount(),i=0;paneCount>i;++i){var pane=this.getPaneAtIndex(i);state.push(pane.getPerPaneState(itemID,field))}return state},setAllPerPaneState:function setAllPerPaneStateFn(itemID,field,data){for(var paneCount=this.paneCount(),i=0;paneCount>i;++i){var pane=this.getPaneAtIndex(i);pane.setPerPaneState(itemID,field,data)}},deletePerPaneState:function deletePerPaneStateFn(paneID,itemID){var pane=this.getPaneById(paneID);pane&&pane.deletePerPaneState(itemID)},getPaneState:function getPaneStateFn(){if(this.trackPaneState()){var activeDocId=g.settings.get(Settings.gdocId);void 0===this._savedPaneState&&(this._savedPaneState=this.loadPaneState()),this._activePaneState=this._savedPaneState[activeDocId]||[]}try{g.PAssert(3470,this._activePaneState,"Must always return a valid pane state to callers")}catch(PERR){g.reportError(PERR)}return this._activePaneState},loadPaneState:function loadPaneStateFn(){if(this.trackPaneState()){var savedState=util.storage.getItem("paneState"),savedObj;try{savedObj=JSON.parse(savedState),g.isString(savedObj)&&(g.reportError(new Error("Invalid saved PaneState: "+savedObj)),util.storage.removeItem("paneState"),savedObj=void 0)}catch(err){util.storage.removeItem("paneState"),savedObj=void 0,g.reportError(err)}return savedObj||{}}return{}},savePaneState:function savePaneStateFn(){if(this.trackPaneState()){var activeDocId=g.settings.get(Settings.gdocId);if(activeDocId){this._savedPaneState[activeDocId]=this._activePaneState;try{var paneStateString=JSON.stringify(this._savedPaneState);util.storage.setItem("paneState",paneStateString)}catch(err){if("Safari"!==platform.browser||!err||"QuotaExceededError"!==err.name){g.reportError(err);try{this._activePaneState=this.recreatePaneState(),this._savedPaneState[activeDocId]=this._activePaneState,paneStateString=JSON.stringify(this._savedPaneState),util.storage.setItem("paneState",paneStateString)}catch(err2){g.reportError(err2)}}}}}},clearPaneState:function clearPaneStateFn(){this._activePaneState=[],this.savePaneState()},updatePaneStateForPane:function updatePaneStateForPaneFn(pane){try{g.PAssert(3471,pane,"Must pass in a valid pane to update")}catch(PERR){g.reportError(PERR)}if(this.trackPaneState()){for(var paneState=this.getPaneState(),found=!1,i=0;i<paneState.length;++i){var info=paneState[i];if(info.id===pane.id){paneState[i]=pane.getSaveInfo(),found=!0;break}}found||(paneState=this.recreatePaneState()),this._activePaneState=paneState,this.savePaneState()}},recreatePaneState:function recreatePaneStateFn(){var paneState=[];return this.runForEachPane(function(tPane){paneState.push(tPane.getSaveInfo())}),paneState},updatePaneScrollState:function updatePaneScrollStateFn(){if(this.trackPaneState()){var paneState=this.getPaneState();this.runForEachPane(function(pane){for(var i=0;i<paneState.length;++i){var entry=paneState[i];if(pane.id===entry.id){entry.offset=pane.getScrollOffset();break}}}),this.savePaneState()}},isPaneActive:function isPaneActiveFn(id){return!!this._panesById[id]},createPaneAtIndex:function createPaneAtIndexFn(type,index){try{g.PAssert(3472,type,"Must supply a valid pane type")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3473,!this._iteratingPanes,"Should not change pane array while iterating")}catch(PERR){g.reportError(PERR)}isNaN(index)&&(index=this.paneCount());var newPane=PaneFactory.createPane(type,{id:this.getNextPaneID()});return newPane?this.addPaneAtIndex(newPane,index):g.reportError(new Error("Invalid pane created: "+type+" | "+index)),newPane},addPaneAtIndex:function addPaneAtIndexFn(pane,index,noSaveState){try{g.PAssert(3474,pane,"Must supply a valid pane")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3475,!this._panesById[pane.id],"Should never add the same pane twice")}catch(PERR){g.reportError(PERR)}if(this._panesById[pane.id]=pane,pane.init(),isNaN(index)?this._panes.push(pane):this._panes.splice(index,0,pane),this.trackPaneState()&&pane.search.value.listen(g.curry(this.updatePaneStateForPane.bind(this),pane)),!noSaveState&&this.trackPaneState()){var paneState=this.getPaneState();paneState.push(pane.getSaveInfo()),this.savePaneState()}},removePaneAtIndex:function removePaneAtIndexFn(index){try{g.PAssert(3476,!isNaN(index),"Must supply a valid index to remove from")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3477,!this._iteratingPanes,"Should not change pane array while iterating")}catch(PERR){g.reportError(PERR)}if(this.paneCount()>1){var removedPane=this._panes.splice(index,1)[0];try{g.PAssert(3478,removedPane,"Must have removed a valid pane")}catch(PERR){g.reportError(PERR)}Dispatcher.fireEvent("paneRemoved",[removedPane]);try{g.PAssert(3479,this._panesById[removedPane.id],"Should never add the same pane twice")}catch(PERR){g.reportError(PERR)}if(this._panesById[removedPane.id]=void 0,removedPane.destroy(),this.trackPaneState()){var paneState=this.getPaneState();return paneState.splice(index,1),this.savePaneState(),removedPane.id}}return void 0},removePanesByType:function removePanesByTypeFn(type){var removePanes=[];this.runForEachPane(function(pane){pane.type===type&&removePanes.push(pane)});for(var i=0;i<removePanes.length;++i)this.removePane(removePanes[i])},swapPaneAtIndex:function swapPaneAtIndexFn(index,pane){try{g.PAssert(3480,!isNaN(index)&&0===index,"Must supply a valid index to remove from")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3481,platform.mobile,"We only perform pane swapping on mobile currently")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3482,pane,"Must supply a valid pane to swap out")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3483,!this._iteratingPanes,"Should not change pane array while iterating")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3484,1===this.paneCount(),"Swapping panes should only happen when there is a single pane present")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3485,1===this._swappedOutPanes.length,"Swapping panes should only happen when there is a single pane swapped out")}catch(PERR){g.reportError(PERR)}var prevPaneInfo=this._swappedOutPanes.pop();try{g.PAssert(3486,prevPaneInfo.pane===pane,"Swapped out pane must match")}catch(PERR){g.reportError(PERR)}var currentPane=this._panes.get()[index];if(this._swappedOutPanes.push({pane:currentPane,data:{offset:currentPane.getScrollOffset()}}),this._panesById[currentPane.id]=void 0,this._panesById[pane.id]=pane,this._panes.set([pane]),pane.notifySwappedIn(prevPaneInfo.data.offset),!g.isRunningScript()&&!g.isDemoMode()&&this.trackPaneState()){var paneState=this.getPaneState();paneState.splice(index,1,pane.getSaveInfo());try{g.PAssert(3487,1===paneState.length,"Must only have a single entry when swapping panes")}catch(PERR){g.reportError(PERR)}this.savePaneState()}},getSwappedPaneByType:function getSwappedPaneByTypeFn(type){try{g.PAssert(3488,platform.mobile,"Mobile platform will only ever have a single instance of each pane type")}catch(PERR){g.reportError(PERR)}for(var i=0;i<this._swappedOutPanes.length;++i){var swapInfo=this._swappedOutPanes[i];if(swapInfo&&swapInfo.pane&&swapInfo.pane.type===type)return swapInfo.pane}var newPane=PaneFactory.createPane(type,{id:this.getNextPaneID()});return newPane.init(),this._swappedOutPanes.push({pane:newPane,data:{offset:0}}),newPane},removeFocusedPane:function removeFocusedPaneFn(){return this.removePane(g.focusedPane)},removePane:function removePaneFn(pane){var index=this.getPaneIndex(pane);return this.removePaneAtIndex(index)},movePane:function movePaneFn(indexFrom,indexTo){try{g.PAssert(3489,!this._iteratingPanes,"Should not change pane array while iterating")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3490,!1,"Not Implemented")}catch(PERR){g.reportError(PERR)}},clearPanes:function clearPanesFn(){try{g.PAssert(3491,g.isDemoMode(),"Should only be clearing panes in demo mode")}catch(PERR){g.reportError(PERR)}this.runForEachPane(function(pane){pane.destroy()}),this._panes.set([]),Sel.setFocusedPane(void 0)},getPaneAtIndex:function getPaneAtIndexFn(index){return this._panes.get()[index]},getPaneIndex:function getPaneIndexFn(pane){return this._panes.get().indexOf(pane)},getPaneById:function getPaneByIdFn(id){try{g.PAssert(3494,this._panesById[id],"Should never request a pane that is not currently loaded")}catch(PERR){g.reportError(PERR)}return this._panesById[id]},getPanesByType:function getPanesByTypeFn(type){for(var panes=[],paneCount=this.paneCount(),i=0;paneCount>i;++i){var pane=this.getPaneAtIndex(i);type&&pane.type!==type||panes.push(pane)}return panes},paneCount:function paneCountFn(){return this._panes.get().length},runForEachPane:function runForEachPaneFn(fn,type){this._iteratingPanes=!0;for(var paneCount=this.paneCount(),i=0;paneCount>i;++i){var pane=this.getPaneAtIndex(i);if(!type||pane.type===type)try{fn(pane)}catch(err){g.reportError(err)}}this._iteratingPanes=!1},applyFnToPanes:function applyFnToPanesFn(fnName,type){this._iteratingPanes=!0;for(var paneCount=this.paneCount(),i=0;paneCount>i;++i){var pane=this.getPaneAtIndex(i);if(!type||pane.type===type){var fn=pane[fnName];try{g.PAssert(3495,fn,"Must provide a valid function name for the given pane type")}catch(PERR){g.reportError(PERR)}try{fn.apply(pane,Array.prototype.slice.call(arguments,2))}catch(err){g.reportError(err)}}}this._iteratingPanes=!1},calculatePaneWidth:function calculatePaneWidthFn(){var windowWidth=platform.windowWidth();if(platform.mobile)return windowWidth;var SpaceBetween=12,ScrollWidth=8,MinWidth=g.isMinMode?0:g.minPaneWidth,MaxWidth=g.maxPaneWidth,HelpWidth=400,MaxActualPaneWidth=MaxWidth-ScrollWidth;g.intro.reactIsShowing.get()&&(windowWidth-=HelpWidth+SpaceBetween);var numPanes=this._panes.get().length,paneWidth=(windowWidth-SpaceBetween*(numPanes-1))/numPanes-ScrollWidth;return paneWidth=Math.max(Math.min(paneWidth,MaxActualPaneWidth),MinWidth-ScrollWidth)}},util.defineBase(PaneManager),PaneManager}),define("RemoteDoc",["ko","globals","data","util","platform","goog"],function(ko,g,d,util,platform,goog){function RemoteDoc(type,name){this._type=type,this._name=name,this._doc=void 0,this._loadFn=void 0,this._errorFn=void 0,this._initFn=void 0}return RemoteDoc.prototype={open:function openFn(id,loadFn,initFn,errorFn){try{g.PAssert(3496,!1,"SubClass must override")}catch(PERR){g.reportError(PERR)}},close:function closeFn(){try{g.PAssert(3497,!1,"SubClass must override")}catch(PERR){g.reportError(PERR)}},_getDocument:function _getDocumentFn(){return this._doc},getModel:function getModelFn(){return this._doc.getModel()},setLoadFn:function setLoadFnFn(loadFn){return this._loadFn=loadFn,this._onLoad.bind(this)},setInitFn:function setInitFnFn(initFn){return this._initFn=initFn,this._onInit.bind(this)},setErrorFn:function setErrorFnFn(errorFn){return this._errorFn=errorFn,this._onError.bind(this)},_onLoad:function _onLoadFn(doc){this._doc=doc;try{this._loadFn(doc)}catch(err){g.reportError(err)}},_onError:function _onErrorFn(err){this._errorFn(err)},_onInit:function _onInitFn(model){try{this._initFn(model)}catch(err){g.reportError(err)}}},util.defineBase(RemoteDoc),RemoteDoc}),define("GRealtimeDoc",["ko","globals","data","util","platform","goog","RemoteDoc"],function(ko,g,d,util,platform,goog,RemoteDoc){function GRealtimeDoc(name){this._super.constructor.call(this,DocType.GRealtime,name),this.init()}var GRealtimeDocFns={init:function initFn(){},open:function openFn(id,loadFn,initFn,errorFn){gdata.driveRealtimeLoad(id,this.setLoadFn(loadFn),this.setInitFn(initFn),this.setErrorFn(errorFn))},close:function closeFn(){}};return util.inherit(RemoteDoc,GRealtimeDoc),util.extend(GRealtimeDoc.prototype,GRealtimeDocFns),GRealtimeDoc}),define("GAppDataDoc",["ko","globals","data","util","platform","goog","RemoteDoc"],function(ko,g,d,util,platform,goog,RemoteDoc){function GAppDataDoc(name){this._super.constructor.call(this,DocType.GAppData,name),this.init()}var GAppDataDocFns={init:function initFn(){},open:function openFn(id,loadFn,initFn,errorFn){gapi.drive.realtime.loadAppDataDocument(this.setLoadFn(loadFn),this.setInitFn(initFn),this.setErrorFn(errorFn))},close:function closeFn(){}};return util.inherit(RemoteDoc,GAppDataDoc),util.extend(GAppDataDoc.prototype,GAppDataDocFns),GAppDataDoc}),define("RealtimeDocManager",["ko","globals","data","util","platform","goog","GRealtimeDoc","GAppDataDoc"],function(ko,g,d,util,platform,goog,GRealtimeDoc,GAppDataDoc){function RealtimeDocManager(){this._activeDocuments={},this._activeTypes={},this._authorizedTypes={},this._listeners=[],this.init()}return window.DocType={GRealtime:0,GAppData:1},RealtimeDocManager.prototype={init:function initFn(){var checkDrive=function(){window.gapi.drive?(this._activateType(DocType.GRealtime),this._activateType(DocType.GAppData)):(g.reportError(new Error("Fatal error while loading google drive - did not add self to gapi")),window.addEventListener("gapiDriveLoaded",checkDrive.bind(this)))};window.gapi&&window.gapi.drive?checkDrive():window.addEventListener("gapiDriveLoaded",checkDrive.bind(this))},_activateType:function _activateTypeFn(type){if(this._activeTypes[type])try{g.PAssert(3498,!1,"Should only be activating a doc type once")}catch(PERR){g.reportError(PERR)}else this._activeTypes[type]=!0,this._authorizedTypes[type]&&this._notifyListeners(type)},_authorizeType:function _authorizeTypeFn(type){this._authorizedTypes[type]||(this._authorizedTypes[type]=!0,this._activeTypes[type]&&this._notifyListeners(type))},registerForReadyNotification:function registerForReadyNotificationFn(type,cb){if(g.isArray(this._listeners[type]))this._listeners[type].push(cb);else if(void 0===this._listeners[type])this._listeners[type]=[cb];else{try{g.PAssert(3499,-1===this._listeners[type],"After a type is loaded, do not queue listners")}catch(PERR){g.reportError(PERR)}cb()}},_notifyListeners:function _notifyListenersFn(type){if(g.isArray(this._listeners[type]))for(var i=0;i<this._listeners[type].length;++i)this._listeners[type][i]();this._listeners[type]=-1},notifyGoogleAuthorization:function notifyGoogleAuthorizationFn(){for(var scopes=goog.getAuthorizedScopes(),i=0;i<scopes.length;++i)switch(scopes[i]){case GScope.Drive:case GScope.DriveFull:this._authorizeType(DocType.GRealtime);break;case GScope.DriveAppData:this._authorizeType(DocType.GAppData)}},createDocument:function createDocumentFn(type,name){try{g.PAssert(3500,type,"Must provide a document type")}catch(PERR){g.reportError(PERR)}name=name||g.generateTempId();try{g.PAssert(3501,!this._activeDocuments[name],"Should not name two documents the same thing")}catch(PERR){g.reportError(PERR)}var remoteDoc;switch(type){case DocType.GRealtime:remoteDoc=new GRealtimeDoc(name);break;case DocType.GAppData:remoteDoc=new GAppDataDoc(name);break;default:try{g.PAssert(3502,!1,"Invalid document type requested",type)}catch(PERR){g.reportError(PERR)}}return this._activeDocuments[name]=remoteDoc,remoteDoc}},util.defineBase(RealtimeDocManager),RealtimeDocManager}),define("RecurringTimedTask",["ko","globals","util"],function(ko,g,util){function RecurringTimedTask(id,options){try{g.PAssert(3503,options,"Must provide a valid set of task options")}catch(PERR){g.reportError(PERR)}this._id=id;try{g.PAssert(3504,options.task&&g.isFunction(options.task),"Must provide a valid task function")}catch(PERR){g.reportError(PERR)}this._task=options.task,this._delay=options.delay,this._pauseWhileIdle=options.pauseWhileIdle||!1,this._suspended=!1,this._remainingTime=0,this._lastUpdate=options.runOnCreate?0:Date.now(),this._numUpdatesRun=0,this._numUpdatesSkipped=0,this._minDelay=options.minDelay||0,this._lastSetDelay=this._delay,this._runningTimeout=void 0,this._updateIsRunning=!1,this.init()}var RecurringTimedTaskFns={init:function initFn(){util.forceBind("_runUpdate",this),this._lastUpdate>0?this._runningTimeout=setTimeout(this._runUpdate,this._delay):this._runUpdate()},getStats:function getStatsFn(){return{numUpdatesRun:this._numUpdatesRun,numUpdatesSkipped:this._numUpdatesSkipped}},cancel:function cancelFn(){},notifyOfSuspend:function notifyOfSuspendFn(){this._pauseWhileIdle&&(this._suspended=!0,this._remainingTime=this._lastSetDelay-this._timeSinceLastUpdate(),clearTimeout(this._runningTimeout),this._runningTimeout=void 0)},notifyOfResume:function notifyOfResumeFn(){this._pauseWhileIdle&&(this._suspended=!1,this._runningTimeout=setTimeout(this._runUpdate,this._remainingTime),this._remainingTime=0)},_notifyUpdateSkipped:function _notifyUpdateSkippedFn(){this._numUpdatesSkipped++},_notifyUpdateRun:function _notifyUpdateRunFn(){this._lastUpdate=Date.now(),this._numUpdatesRun++},_timeSinceLastUpdate:function _timeSinceLastUpdateFn(){return Date.now()-this._lastUpdate},_runUpdate:function _runUpdateFn(){try{g.PAssert(3505,!this._updateIsRunning,"Should not run another update while already running one")}catch(PERR){g.reportError(PERR)}if(!this._updateIsRunning){this._updateIsRunning=!0,clearTimeout(this._runningTimeout),this._runningTimeout=void 0,this._notifyUpdateRun();try{this._task()}catch(err){g.reportError(err)}this._runningTimeout=setTimeout(this._runUpdate,this._delay),this._lastSetDelay=this._delay,this._updateIsRunning=!1}},requestUpdate:function requestUpdateFn(){if(this._timeSinceLastUpdate()>this._minDelay)this._runUpdate();else{this._notifyUpdateSkipped();var minDelayTime=this._minDelay-this._timeSinceLastUpdate();clearTimeout(this._runningTimeout),this._runningTimeout=setTimeout(this._runUpdate,minDelayTime),this._lastSetDelay=this._minDelay}},forceUpdate:function forceUpdateFn(){this._runUpdate()}};return util.extend(RecurringTimedTask.prototype,RecurringTimedTaskFns),RecurringTimedTask}),define("RecurringTaskManager",["ko","globals","util","platform","RecurringTimedTask"],function(ko,g,util,platform,RecurringTimedTask){function RecurringTaskManager(){this._tasks={},this.init()}var RecurringTaskManagerFns={init:function initFn(){platform.pageVisibilityChange&&document.addEventListener(platform.pageVisibilityChange,this._handleVisibilityChange.bind(this))},getStats:function getStatsFn(){var outStats={};for(var id in this._tasks)outStats[id]=this._tasks[id].getStats();return outStats},createRecurringTask:function createRecurringTaskFn(id,options){try{g.PAssert(3506,!this._tasks[id],"Must not register multiple tasks with the same ID")}catch(PERR){g.reportError(PERR)}var newTask=new RecurringTimedTask(id,options);return this._tasks[id]=newTask,newTask},getRecurringTask:function getRecurringTaskFn(id){try{g.PAssert(3507,this._tasks[id],"Must only retreive a valid recurring task")}catch(PERR){g.reportError(PERR)}return this._tasks[id]},_handleVisibilityChange:function _handleVisibilityChangeFn(){var isPageVisible=platform.isPageVisible();for(var id in this._tasks)isPageVisible?this._tasks[id].notifyOfResume():this._tasks[id].notifyOfSuspend()}};return util.extend(RecurringTaskManager.prototype,RecurringTaskManagerFns),RecurringTaskManager}),define("DocManager",["ko","globals","data","util","platform","goog","VMDocument","ObservableArray"],function(ko,g,d,util,platform,goog,VMDocument,ObservableArray){function DocManager(){this._openDocuments={},this._docMap={},this._docList=ko.observableArray(),this.docListObs=new ObservableArray,this.docListObs.wrapKOArray(this._docList),this._isLoading=!1,this._hasError=!1,this._loadingCallbacks=[],this.init()}var MaxFilePageRequests=12;return DocManager.prototype={init:function initFn(){},loadDocList:function loadDocListFn(cb){if(goog.isDriveAPILoaded()){if(this._loadingCallbacks.push(cb),!this._isLoading){this._isLoading=!0;var q="mimeType='"+goog.MoodoMimetype+"' and trashed=false",options={maxPageResults:999,maxPages:MaxFilePageRequests},successCB=function(results,hasMoreResults){try{g.PAssert(3508,!hasMoreResults,"Should not have additional results when requesting a file list")}catch(PERR){g.reportError(PERR)}for(var i=0;i<results.length;++i)results[i].appDataContents||this.loadDocFromData(results[i],!0);for(var i=0;i<this._loadingCallbacks.length;++i)try{this._loadingCallbacks[i](!0)}catch(err){g.reportError(err)}this._isLoading=!1}.bind(this),failureCB=function(response,partialResults){this._hasError=!0;for(var i=0;i<this._loadingCallbacks.length;++i){try{this._loadingCallbacks[i](!1)}catch(err){g.reportError(err)}this._isLoading=!1}}.bind(this);g.vmMain.remoteAPI().driveFilesList(q,successCB,failureCB,options)}}else cb(!1)},loadDocFromData:function loadDocFromDataFn(data,isRemoteData){try{g.PAssert(3509,data,"Must provide valid data to load doc from")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3510,data.id,"Must have valid doc id in data")}catch(PERR){g.reportError(PERR)}var currentDoc=this._docMap[data.id];return currentDoc?currentDoc.updateData(data,isRemoteData):(currentDoc=new VMDocument(data,isRemoteData),this.setDoc(currentDoc)),currentDoc},setDoc:function setDocFn(doc){try{g.PAssert(3511,doc,"Must supply a valid doc to set")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3512,!this._docMap[doc.id],"Should never override an existing doc with a new one")}catch(PERR){g.reportError(PERR)}this._docMap[doc.id]=doc,this._docList.insertSorted(doc,this.sortFn)},sortFn:function sortFnFn(left,right){return left.getTitle().localeCompare(right.getTitle())},getDoc:function getDocFn(id){return this._docMap[id]},hasDoc:function hasDocFn(id){return!!this._docMap[id]},getDocList:function getDocListFn(){return this._docList},deleteDoc:function deleteDocFn(id,cb){var doc=this._docMap[id];try{g.PAssert(3513,doc,"Must be deleting a document that we know about")}catch(PERR){g.reportError(PERR)}doc.deleteData(function(success){success&&(delete this._docMap[id],this._docList.remove(doc),doc.isOpen()&&(delete this._openDocuments[id],d.clearDataAndReload())),cb(success)}.bind(this))},deleteAllDocs:function deleteAllDocsFn(cb){goog.deleteAllFiles(this._docList(),cb)
},createNewDoc:function createNewDocFn(){return new VMDocument},isLoading:function isLoadingFn(){return this._isLoading},getOpenDoc:function getOpenDocFn(){var openDoc;for(var id in this._openDocuments){openDoc=this._openDocuments[id];break}return openDoc},isDocOpen:function isDocOpenFn(id){return!!this._openDocuments[id]},setDocOpened:function setDocOpenedFn(id){try{g.PAssert(3514,id,"Must specify a valid ID when opening a doc")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3515,!this._openDocuments[id],"Document must not have already been opened")}catch(PERR){g.reportError(PERR)}var doc=this._docMap[id];try{g.PAssert(3516,doc,"Must supply a valid ID matching a created doc")}catch(PERR){g.reportError(PERR)}this._openDocuments[id]=doc},setDocClosed:function setDocClosedFn(id){var doc=this._openDocuments[id];try{g.PAssert(3517,doc,"Must have a valid opened doc")}catch(PERR){g.reportError(PERR)}delete this._openDocuments[id]}},util.defineBase(DocManager),DocManager}),define("ItemStoreManager",["ko","globals","util","EventDispatcher","ItemStore"],function(ko,g,util,EventDispatcher,ItemStore){function ItemStoreManager(){this._itemStores={},this._iteratingStores=!1,this.Events={StoreAdded:"StoreAdded",StoreRemoved:"StoreRemoved"},this.init()}var DefaultItemStoreID="DefaultStore";return window.ItemStoreFilter={None:0,Dates:1,Contacts:2},ItemStoreManager.prototype={init:function initFn(){var enabledFilters=ItemStoreFilter.Dates;defaultItemStore=this.registerItemStore(DefaultItemStoreID,void 0,{isReadonly:!1,isDestructible:!1,enabledFilters:enabledFilters})},registerItemStore:function registerItemStoreFn(id,owner,options){try{g.PAssert(3518,!this._itemStores[id],"Should only register a single item store per plugin: ",id)}catch(PERR){g.reportError(PERR)}try{g.PAssert(3519,!this._iteratingStores,"Should never add a store while iterating")}catch(PERR){g.reportError(PERR)}var isReadonly=!0,isDestructible=!0,enabledFilters=!1;options&&(void 0!==options.isReadonly&&(isReadonly=options.isReadonly),void 0!==options.isDestructible&&(isDestructible=options.isDestructible),void 0!==options.enabledFilters&&(enabledFilters=options.enabledFilters));var newStore=new ItemStore(id,isReadonly,isDestructible,enabledFilters,owner);return this._itemStores[id]=newStore,this.fireEvent(this.Events.StoreAdded,newStore.getEnabledFilters(),[newStore]),newStore},unregisterItemStore:function unregisterItemStoreFn(id){try{g.PAssert(3520,this._itemStores[id],"Must register an item store before destroying it")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3521,!this._iteratingStores,"Should never remove a store while iterating")}catch(PERR){g.reportError(PERR)}var oldStore=this._itemStores[id];oldStore.destroy(),delete this._itemStores[id],this.fireEvent(this.Events.StoreRemoved,oldStore.getEnabledFilters(),[oldStore])},getItemStore:function getItemStoreFn(id){try{g.PAssert(3522,this._itemStores[id],"Must register an item store before using it")}catch(PERR){g.reportError(PERR)}return this._itemStores[id]},getDefaultItemStore:function getDefaultItemStoreFn(){return this._itemStores[DefaultItemStoreID]},runForEachStore:function runForEachStoreFn(fn,filter){filter=filter||ItemStoreFilter.None,this._iteratingStores=!0;for(var storeID in this._itemStores){var store=this._itemStores[storeID];if(filter===ItemStoreFilter.None||store.areFiltersEnabled(filter))try{fn(store)}catch(err){g.reportError(err)}}this._iteratingStores=!1}},util.defineBase(ItemStoreManager),util.extend(ItemStoreManager.prototype,EventDispatcher),ItemStoreManager}),define("MooReact",["ko","globals","Observable","ObservableArray","Trigger"],function(ko,g,Observable,ObservableArray,Trigger){var MooReact={};return MooReact.MooReactMixin={getInitialState:function getInitialStateFn(){this.init&&this.init();var stateObject=this.getState();return this.setupListeners(stateObject),this.transformState(stateObject)},_addListener:function _addListenerFn(listener){try{g.PAssert(3523,listener&&listener.target,"Must add a valid listener")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3524,!this._hasListener(listener.target),"Must not double register the same observable/trigger")}catch(PERR){g.reportError(PERR)}this._listeners.push(listener)},setupListeners:function setupListenersFn(stateObject){this._listeners||(this._listeners=[],this._permanentListeners=[]),stateObject||(stateObject=this.getState());for(var prop in stateObject)if(stateObject.hasOwnProperty(prop)){var value=stateObject[prop];value instanceof Observable?this._addListener(value.listen(this.updateState)):ko.isObservable(value)&&this._addListener(value.subscribe(this.updateState))}},disposeListeners:function disposeListenersFn(permanent){if(this._listeners){for(var i=0;i<this._listeners.length;++i)this._listeners[i].dispose();if(this._listeners=[],permanent)for(var i=0;i<this._permanentListeners.length;++i)this._permanentListeners[i].dispose()}},listenTo:function listenToFn(obj,canDispose){try{g.PAssert(3525,obj instanceof Trigger||obj instanceof Observable,"Can only listen to an Observable or a Trigger object")}catch(PERR){g.reportError(PERR)}if(obj instanceof Trigger||obj instanceof Observable){var v=obj.listen(this.updateState);canDispose!==!1?this._addListener(v):this._permanentListeners.push(v)}},_hasListener:function _hasListenerFn(target){try{g.PAssert(3526,target,"Must have a valid target")}catch(PERR){g.reportError(PERR)}for(var hasListener=!1,i=0;i<this._listeners.length;++i)if(this._listeners[i].target===target){hasListener=!0;break}return hasListener},_getState:function _getStateFn(){var stateObject=this.getState();return this.transformState(stateObject)},transformState:function transformStateFn(stateObject){for(var prop in stateObject)if(stateObject.hasOwnProperty(prop)){var value=stateObject[prop];value instanceof Observable?(stateObject[prop]=value.get(),value instanceof ObservableArray&&(stateObject[prop+"_arrVer"]=value.version)):ko.isObservable(value)&&(stateObject[prop]=value())}return stateObject},updateState:function updateStateFn(){var shouldChanged=!0;if(this.onBeforeChanged&&(shouldChanged=this.onBeforeChanged()),shouldChanged!==!1){var oldState=this.state,newState=this._getState();this.setState(newState),this.onAfterChanged&&this.onAfterChanged(newState,oldState)}},setData:function setDataFn(obj,arr){this.__elementData||(this.__elementData=[]);for(var i=0;i<arr.length;++i)this.__elementData.push(arr[i]),g.setDataFor(arr[i],obj)},componentWillUnmount:function componentWillUnmountFn(){if(this.disposeListeners(!0),this.__elementData)for(var i=0;i<this.__elementData.length;++i)g.setDataFor(this.__elementData[i],void 0);this.onUnmount&&this.onUnmount(this.state)},addTap:function addTapFn(refName,obj,handler){var ref=this.refs[refName];try{g.PAssert(3530,ref,"Invalid refName to add tap to: ",refName)}catch(PERR){g.reportError(PERR)}ref&&g.setupClick(ref.getDOMNode(),obj,handler)},refElement:function refElementFn(refName){return this.refs[refName].getDOMNode()}},MooReact}),define("AutosizeInput",["React"],function(React){var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},sizerStyle={position:"absolute",visibility:"hidden",height:0,width:0,overflow:"scroll",whiteSpace:"nowrap"},AutosizeInput=React.createClass({displayName:"AutosizeInput",propTypes:{value:React.PropTypes.any,defaultValue:React.PropTypes.any,onChange:React.PropTypes.func,style:React.PropTypes.object,className:React.PropTypes.string,minWidth:React.PropTypes.oneOfType([React.PropTypes.number,React.PropTypes.string]),inputStyle:React.PropTypes.object,inputClassName:React.PropTypes.string},getDefaultProps:function getDefaultProps(){return{minWidth:1}},getInitialState:function getInitialState(){return{inputWidth:this.props.minWidth}},componentDidMount:function componentDidMount(){this.copyInputStyles(),requestAnimationFrame(this.updateInputWidth)},componentDidUpdate:function componentDidUpdate(){this.updateInputWidth()},copyInputStyles:function copyInputStyles(){if(this.isMounted()&&window.getComputedStyle){var inputStyle=window.getComputedStyle(this.refs.input.getDOMNode()),widthNode=this.refs.sizer.getDOMNode();if(widthNode.style.fontSize=inputStyle.fontSize,widthNode.style.fontFamily=inputStyle.fontFamily,this.props.placeholder){var placeholderNode=this.refs.placeholderSizer.getDOMNode();placeholderNode.style.fontSize=inputStyle.fontSize,placeholderNode.style.fontFamily=inputStyle.fontFamily}}},updateInputWidth:function updateInputWidth(){if(this.isMounted()&&"undefined"!=typeof this.refs.sizer.getDOMNode().scrollWidth){var newInputWidth;newInputWidth=this.props.placeholder?Math.max(this.refs.sizer.getDOMNode().scrollWidth,this.refs.placeholderSizer.getDOMNode().scrollWidth)+2:this.refs.sizer.getDOMNode().scrollWidth+2,newInputWidth<this.props.minWidth&&(newInputWidth=this.props.minWidth),newInputWidth!==this.state.inputWidth&&Math.abs(newInputWidth-this.state.inputWidth)>1&&this.setState({inputWidth:newInputWidth})}},getInput:function getInput(){return this.refs.input},focus:function focus(){this.refs.input.getDOMNode().focus()},select:function select(){this.refs.input.getDOMNode().select()},render:function render(){var escapedValue=(this.props.value||"").replace(/ /g,"&nbsp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;"),wrapperStyle=this.props.style||{};wrapperStyle.display="inline-block";var inputStyle=this.props.inputStyle||{};inputStyle.width=this.state.inputWidth;var placeholder=this.props.placeholder?React.createElement("div",{ref:"placeholderSizer",style:sizerStyle},this.props.placeholder):null;return React.createElement("div",{className:this.props.className,style:wrapperStyle},React.createElement("input",_extends({},this.props,{ref:"input",className:this.props.inputClassName,style:inputStyle,autoComplete:"off"})),React.createElement("div",{ref:"sizer",style:sizerStyle,dangerouslySetInnerHTML:{__html:escapedValue}}),placeholder)}});return AutosizeInput}),define("ReactSearch",["globals","platform","VMPane","React","MooReact","AutosizeInput","Sel"],function(g,platform,VMPane,React,MooReact,AutosizeInput,Sel){var ReactSearch=React.createClass({mixins:[MooReact.MooReactMixin,React.addons.PureRenderMixin],displayName:"ReactSearch",propTypes:{pane:React.PropTypes.instanceOf(VMPane).isRequired},componentDidMount:function componentDidMount(){this.props.pane.search.UI=this;var input=this.searchEl=this.refs.search.getInput().getDOMNode();input.addEventListener("keydown",this.keyDown),input.addEventListener("keyup",this.keyUp),input.addEventListener("focus",this.onFocus),input.addEventListener("blur",this.onBlur),input.addEventListener("input",this.handleChange),this.addTap("searchX",this,this.onTapX),this.addTap("searchWrap",this,this.onTapBox)},getState:function getState(){var pane=this.props.pane,state={search:pane.search.value};return state},handleChange:function handleChange(event){this._selectionBeforeBlur=void 0;var search=this.props.pane.search;search.setValue(event.target.value)},onFocus:function onFocus(event){this.props.pane.search.isFocused.set(!0),platform.phone?g.sendEvent("SearchFocus","Mobile"):g.sendEvent("SearchFocus","Desktop")},onBlur:function onBlur(event){this.props.pane.search.isFocused.set(!1),platform.mobile&&g.keyboardToolbar.hide()},focus:function focus(){this._selectionBeforeBlur=Sel.save(),Sel.reset(),this.refs.search.focus(),this.props.pane.onBlur()},onTapBox:function onTapBox(e){if(platform.mobile)g.keyboardToolbar.preShow(),this.focus();else if("search"!==e.target.id){this.focus();var len=this.searchEl.value.length;this.searchEl.setSelectionRange(len,len)}platform.mobile&&(g.keyboardToolbar.show(g.keyboardToolbar.Type.Search),e.preventDefault())},onTapX:{onStart:function onStart(e){e.handled=!0,e.preventDefault(),e.stopPropagation()},onClick:function onClick(e){var search=this.props.pane.search;this.state.search.length>0?(search.reset(),e.preventDefault(),g.sendEvent("Menu","ClearSearch")):(platform.mobile,g.sendEvent("Menu","FocusSearch"))}},keyDown:function keyDown(e){var pane=this.props.pane;if(e.normCode===KeyCode.Enter){var search=pane.search;return search.update(!0),!1}if(e.normCode===KeyCode.Tab){var firstChild=pane.getFirstItem();if(firstChild){var index=0,s=this._selectionBeforeBlur;s?(Sel.restore(s),this._selectionBeforeBlur=void 0,index=s.startIndex):Sel.selectIndex(0,0),Sel.focusPane(pane),index>=0&&g.focusedPane.scrollIndexIntoView(index,ScrollDuration.Default)}else pane.addItem();return e.preventDefault(),!1}e.normCode===KeyCode.Escape&&this.refs.search.select()},keyUp:function keyUp(e){},render:function render(){var searchIcon=this.state.search.length>0?"icon-close":"icon-search";return React.createElement("span",{className:"searchWrap",ref:"searchWrap"},React.createElement("span",{ref:"searchX",className:"searchX g"},React.createElement("i",{className:searchIcon})),React.createElement(AutosizeInput,{ref:"search",className:"search",id:"search",placeholder:"Search",value:this.state.search,minWidth:45}))}});return ReactSearch}),define("ReactTitle",["globals","platform","VMPane","VMLI","React","MooReact","ReactSearch"],function(g,platform,VMPane,VMLI,React,MooReact,ReactSearch){var ReactTitle=React.createClass({mixins:[MooReact.MooReactMixin,React.addons.PureRenderMixin],displayName:"ReactTitle",propTypes:{pane:React.PropTypes.instanceOf(VMPane).isRequired,item:React.PropTypes.instanceOf(VMLI).isRequired},componentDidMount:function componentDidMount(){this.addTap("span",this,this.onTap),this.listenTo(this.props.item.itemChanged)},getState:function getState(){var pane=this.props.pane,item=this.props.item,text=item.generateTitleText(item.getParsedText());return{text:text}},onTap:{onStart:function onStart(e){e.handled=!0},onClick:function onClick(e){var pane=this.props.pane;pane.onTapTitle.onClick.call(pane,e,this.props.item)}},render:function render(){var pane=this.props.pane;return React.createElement("span",{className:"titleWrapper","data-tooltip":this.state.text,ref:"span"},React.createElement("span",{className:"titleOpen"},this.state.text))},onTitleClick:function onTitleClick(title,e){var pane=this.props.pane;pane.onTapTitle.onClick.call(pane,e,title.item)}});return ReactTitle}),define("ReactPaneHeader",["globals","platform","VMPane","React","MooReact","ReactSearch","ReactTitle"],function(g,platform,VMPane,React,MooReact,ReactSearch,ReactTitle){var ReactPaneHeader=React.createClass({mixins:[MooReact.MooReactMixin,React.addons.PureRenderMixin],displayName:"ReactPaneHeader",propTypes:{pane:React.PropTypes.instanceOf(VMPane).isRequired},componentDidMount:function componentDidMount(){var pane=this.props.pane;platform.mobile?(this.addTap("modeButton",pane,pane.onTapToggleModeMobile),this.addTap("settingsButton",pane,pane.onTapSettingsMobile),this.addTap("listTitle",this,this.onTapListTitle)):(pane.supportViewArchived&&this.addTap("viewArchived",pane,pane.onTapViewArchived),pane.supportDataRefresh&&this.addTap("refreshData",pane,pane.onTapRefreshData),pane.supportPerformArchive&&this.addTap("archiveCompleted",pane,pane.onTapArchiveCompleted),pane.supportSearchAutocomplete&&(this.addTap("searchAutocompleteWrap",pane.search,pane.search.onTapAutocomplete),this.addTap("searchAutocomplete",pane.search,pane.search.onTapSearchInsert)),this.addTap("outlineButton",pane,pane.onTapOutlineButton),this.addTap("closePane",pane,pane.onTapClosePane))},getState:function getState(){var pane=this.props.pane,state={numComplete:pane.numCompleteItems,isOutlineVisible:pane.outline.isVisible,item:pane.item,paneTitle:pane.itemTitle(),search:pane.search.value,showingArchived:pane.showArchived,isSearchFocused:pane.search.isFocused};return platform.mobile?state.modeIcon=g.vmMain.getPaneSwapIconMobile():state.parents=pane.getItem().parents(),state},onTapListTitle:function onTapListTitle(){g.ScreenManager.toggleOutline()},render:function render(){var pane=this.props.pane,headerTitle;headerTitle=platform.mobile?React.createElement("span",{className:"headerTitle",id:"listTitle",ref:"listTitle"},this.state.paneTitle):null;var searchClass=g.classNames("searchAutocomplete","popup",{hidden:!this.state.isSearchFocused}),searchAutocomplete=!platform.mobile&&pane.supportSearchAutocomplete?React.createElement("div",{className:searchClass,ref:"searchAutocompleteWrap"},React.createElement("div",{className:"searchAutocompleteDefault",ref:"searchAutocomplete"},React.createElement("div",{className:"searchNegate"},React.createElement("i",null,"-"),React.createElement("div",null,"Not")),React.createElement("div",{className:"searchP2"},React.createElement("i",null," "),React.createElement("div",null,"Low")),React.createElement("div",{className:"searchP1"},React.createElement("i",null," "),React.createElement("div",null,"Med")),React.createElement("div",{className:"searchP0"},React.createElement("i",null," "),React.createElement("div",null,"High")),React.createElement("div",{className:"searchStarred"},React.createElement("i",{className:"icon-star"}),React.createElement("div",null,"Star")),React.createElement("div",{className:"searchComplete"},React.createElement("i",{className:"icon-ok"}),React.createElement("div",null,"Done")))):null,searchDiv=React.createElement("div",{className:"searchDiv"},React.createElement("div",{ref:"searchDivWrap",className:"searchDivWrap"},headerTitle,React.createElement(ReactSearch,{pane:pane}),searchAutocomplete));return platform.mobile?React.createElement("div",{className:"paneHeader"},React.createElement("div",{ref:"modeButton",id:"modeButton",className:"phoneTop "+this.state.modeIcon+" "+(this.state.isOutlineVisible?"hidden":"")}),React.createElement("div",{ref:"settingsButton",id:"settingsButtonPhone",className:"icon-settings phoneTop "+(this.state.isOutlineVisible?"":"hidden")}),searchDiv):React.createElement("div",{className:"paneHeader"},React.createElement("div",{className:"paneOutlineButton c g","data-tooltip":"Open Outline",ref:"outlineButton"},React.createElement("i",{className:"icon-list"})),React.createElement("div",{className:"paneRightButtons"},pane.supportViewArchived?React.createElement("span",{ref:"viewArchived","data-tooltip":"View Archived Items",className:"paneArchiveView g mat-icon-button icon-inbox"+(this.state.showingArchived?" on":" off")}):null,pane.supportPerformArchive?React.createElement("span",{ref:"archiveCompleted","data-tooltip":"Archive Completed Items",className:"paneArchiveItems g mat-icon-button icon-task"+(0===this.state.numComplete?" disabled":"")}):null,pane.supportDataRefresh?React.createElement("span",{ref:"refreshData",style:{display:"none"},"data-tooltip":"Refresh Data",className:"paneRefreshData g mat-icon-button icon-spinner"}):null,React.createElement("span",{ref:"closePane","data-tooltip":"Close Pane",className:"paneClose g mat-icon-button icon-close"})),React.createElement("div",{className:"breadcrumbs"},React.createElement("span",{className:"titles"},this.state.parents.map(function(item,i){return React.createElement(ReactTitle,{key:"title_"+i,pane:pane,item:item})}))),searchDiv)},onTitleClick:function onTitleClick(title,e){var pane=this.props.pane;pane.onTapTitle.onClick.call(pane,e,title.item)}});return ReactPaneHeader}),define("ReactItem",["globals","platform","VMPane","React","VMLI","MooReact","Sel","Measure"],function(g,platform,VMPane,React,VMLI,MooReact,Sel,Measure){var ReactItem=React.createClass({mixins:[MooReact.MooReactMixin,React.addons.PureRenderMixin],displayName:"ReactItem",propTypes:{pane:React.PropTypes.instanceOf(VMPane).isRequired,item:React.PropTypes.instanceOf(VMLI).isRequired,offsetTop:React.PropTypes.number,index:React.PropTypes.number,height:React.PropTypes.number,outline:React.PropTypes.bool,rootLevel:React.PropTypes.number},componentDidMount:function componentDidMount(){var pane=this.props.pane,item=this.props.item;this.listenTo(item.itemChanged),this.element=this.refElement("li"),g.setReactItem(this,this.element);var outline=this.props.outline,field=outline?PerPaneStateField.NumLinesOutline:PerPaneStateField.NumLines;pane.setPerPaneState(item.id,field,this.state.lines.length),pane&&!this.props.outline&&item.onLoad(pane),this.setData(item,[this.element]),this.props.outline||this.props.agenda||pane.notifyElementMounted(this.props.index,this)},componentDidUpdate:function componentDidUpdate(prevProps,prevState){if(this.props.index!==prevProps.index){var pane=this.props.pane;pane.notifyElementUnmounted(prevProps.index,this),pane.notifyElementMounted(this.props.index,this)}},onUnmount:function onUnmount(){this.props.outline||this.props.agenda||this.props.pane.notifyElementUnmounted(this.props.index,this),g.clearReactItem(this,this.element)},componentWillReceiveProps:function componentWillReceiveProps(nextProps){this.updateState()},getState:function getState(){var item=this.props.item,pane=this.props.pane,outline=this.props.outline,state={flags:item.flags,levelsDeep:item.levelsDeep,styleProps:item.styleProps(pane),draggedInPane:item.draggedInPane,lines:item.metricsInPane(pane,outline).styledLines,isHovered:Sel.isItemHovered(item,pane)};if(!outline&&!this.props.agenda){state.selected=state.selectedText=state.selectedStart=state.selectedEnd=void 0;var isSelected=Sel.isSelected(this.props.index,pane);if(isSelected){var selection=Sel.getSelectionAtIndex(this.props.index);selection===!0?state.selected=!0:selection.start!==selection.end&&(state.selectedStart=selection.start,state.selectedEnd=selection.end)}else state.selectedText=void 0;platform.ios&&(state.isEditable=item.isEditable)}return outline?(state.outlineFocused=pane.getItem()===item,state.isHeader=item.hasHeaderChildren()):state.isHeader=item.isHeader(),state},renderSelection:function renderSelection(paddingLeft){var selection=[],props=this.props,state=this.state,item=props.item,pane=props.pane,spanWidth=item.getSpanWidth(pane);if(state.selected){var styleSel={left:paddingLeft,top:0,width:spanWidth,height:props.height};selection.push(React.createElement("span",{key:"selStart",className:"textSelected",style:styleSel}))}else if(void 0!==state.selectedStart){var textLength=item.getParsedText().length,isNextSelected,isPrevSelected,start=state.selectedStart,end=state.selectedEnd;0>start&&(start=0,isPrevSelected=!0),0>end&&(end=textLength,isNextSelected=!0);var itemHeight=props.height,startPos=Measure.getCaretOffset(item,pane,start,Sel.preferLineStart),endPos=Measure.getCaretOffset(item,pane,end,Sel.preferLineStart),pad=g.itemPad,lineHeight=g.itemLineHeight,multipleLines=endPos.line>startPos.line;if(startPos.lineOffset<startPos.lineLength||!multipleLines){var startTop=startPos.top,startHeight=lineHeight,width=multipleLines||isNextSelected?spanWidth-startPos.left:endPos.left-startPos.left;0===startTop?startHeight+=pad:startTop+=pad,startPos.top===itemHeight-lineHeight-2*pad&&(startHeight+=pad);var styleStart={left:startPos.left+paddingLeft,top:startTop,width:width,height:startHeight};selection.push(React.createElement("span",{key:"selStart",className:"textSelected",style:styleStart}))}if(multipleLines){var diff=endPos.top-startPos.top,endTop=endPos.top+pad,endHeight=lineHeight,endWidth=isNextSelected?spanWidth:endPos.left;if(diff>=2*lineHeight){var midHeight=endTop-startHeight-startTop,styleMid={left:paddingLeft,top:startPos.top+pad+lineHeight,width:spanWidth,height:midHeight};selection.push(React.createElement("span",{key:"selMid",className:"textSelected",style:styleMid}))}endPos.top===itemHeight-lineHeight-2*pad&&(endHeight+=pad);var styleEnd={left:paddingLeft,top:endTop,width:endWidth,height:endHeight};selection.push(React.createElement("span",{key:"selEnd",className:"textSelected",style:styleEnd}))}}return selection},render:function render(){var props=this.props,state=this.state,pane=props.pane,item=props.item,outline=props.outline,agenda=pane.type===PaneMode.Timeline&&!outline,liClassName=g.classNames("item",state.styleProps,{outlineItem:outline},{outlineFocused:outline&&state.outlineFocused},{collapsed:props.isCollapsed},{itemBeingDragged:state.draggedInPane===pane},{hovered:state.isHovered}),liStyles={};outline||item!==pane.getItem()||(liStyles.display="none");var linesHtml=[],height=pane.heightOfItem(item,outline,props.isInDragDrop);liStyles.height=height,this.props.offsetTop&&(liStyles.top=this.props.offsetTop+"px");var levelRender=outline?state.levelsDeep:state.levelsDeep-props.rootLevel-1,paddingLeft=agenda?34:item.getPaddingForLevel(levelRender,outline);try{g.PAssert(3532,!isNaN(paddingLeft),"Should always have a valid number for padding")}catch(PERR){g.reportError(PERR)}var lines=state.lines;try{g.PAssert(3533,lines,"If an item is being rendered it must have styled lines")}catch(PERR){g.reportError(PERR)}if(lines){for(var style,i=0;i<lines.length;++i)style={marginLeft:paddingLeft},linesHtml.push(React.createElement("span",{className:"line",key:"line_"+i,style:style,dangerouslySetInnerHTML:{__html:lines[i]||TextSpace}}));0===lines.length&&(style={marginLeft:paddingLeft},linesHtml.push(React.createElement("span",{className:"line",key:"line_"+i,style:style,dangerouslySetInnerHTML:{__html:TextSpace}})))}var selection=this.renderSelection(paddingLeft),collapser=null,checkbox=null;if(!props.isInDragDrop){if((props.isCollapsed||!platform.mobile&&state.isHovered)&&(!outline||0!==state.levelsDeep)){var isHeader=state.isHeader,collapserClass=g.classNames("collapser",{collapsed:isHeader&&props.isCollapsed},{"icon-caret-down":isHeader&&!props.isCollapsed},{"icon-caret-right":isHeader&&props.isCollapsed}),MAGIC_NUMBER_1=7,collapserStyle={width:paddingLeft-MAGIC_NUMBER_1};collapser=React.createElement("div",{className:collapserClass,style:collapserStyle})}if(pane.supportCompleting&&!outline&&!platform.mobile&&state.isHovered){var checkboxClass=g.classNames("itemCheckbox",{"icon-ok":!platform.mobile});checkbox=React.createElement("div",{className:checkboxClass})}}var isEditable=pane.isWriteable&&platform.ios&&state.isEditable?!0:null;return React.createElement("li",{className:liClassName,style:liStyles,ref:"li",contentEditable:isEditable},linesHtml,collapser,checkbox,selection)}});return ReactItem}),define("ReactInfiniteList",["globals","platform","data","VMPane","React","ReactItem","MooReact","Observable","ObservableArray","Sel","Dispatcher","DragDrop","InfiniteList"],function(g,platform,d,VMPane,React,ReactItem,MooReact,Observable,ObservableArray,Sel,Dispatcher,DragDrop,InfiniteList){var ReactInfiniteList=React.createClass({mixins:[MooReact.MooReactMixin,React.addons.PureRenderMixin],displayName:"ReactInfiniteList",propTypes:{owner:React.PropTypes.instanceOf(InfiniteList).isRequired,pane:React.PropTypes.instanceOf(VMPane).isRequired,outline:React.PropTypes.bool.isRequired,contentClass:React.PropTypes.string.isRequired,contentEditable:React.PropTypes.bool,emptyElement:React.PropTypes.bool,renderIndex:React.PropTypes.func.isRequired,minItemHeight:React.PropTypes.number.isRequired},componentWillMount:function componentWillMount(){this.props.owner.notifyWillMount()},componentDidMount:function componentDidMount(){this.props.owner.notifyMounted(this),this.props.emptyElement&&(this.props.pane.emptyElement=this.refElement("emptyElement"))},onUnmount:function onUnmount(){this.props.owner.notifyUnmounted()},getState:function getState(){var pane=this.props.pane,state={renderTiles:this.props.owner.renderTiles,paddingBottom:pane.paddingBottom,contentHeight:this.props.owner.contentHeight};return state},renderItems:function renderItems(){for(var owner=this.props.owner,renderedItems=[],i=0;i<this.state.renderTiles.length;++i)for(var tileIndex=this.state.renderTiles[i],itemsInTile=owner.itemsInTile(tileIndex),u=0;u<itemsInTile.length;u++){var renderItem=itemsInTile[u],renderedItem=this.props.renderIndex(renderItem.index,renderItem.height,renderItem.offsetTop);renderedItems.push(renderedItem)}return renderedItems},render:function render(){var pane=this.props.pane,cls=this.props.contentClass;if(!this.props.isLoading&&!this.props.owner.hasItems()){cls+=" noItems";var status=pane.getStatusMessage();status&&(cls+=status?" displayStatus":"")}var height=this.state.contentHeight+this.state.paddingBottom,styles={};this.props.pane.useCustomScroller||(styles.height=height>0?height+"px":"200px");var emptyElement=null;return this.props.emptyElement&&(emptyElement=React.createElement("div",{contentEditable:"true",className:"paneEmptyElement",ref:"emptyElement"},TextSpace)),React.createElement("ul",{className:cls,style:styles,spellCheck:"false",draggable:"false",ref:"contentElement","data-pane-status":status},emptyElement,this.renderItems())}});return ReactInfiniteList}),define("ReactFile",["globals","React","VMLI","MooReact"],function(g,React,VMLI,MooReact){var ReactFile=React.createClass({mixins:[MooReact.MooReactMixin,React.addons.PureRenderMixin],displayName:"ReactFile",propTypes:{file:React.PropTypes.object.isRequired},componentDidMount:function componentDidMount(){var file=this.props.file,element=this.getDOMNode();this.setData(file,[element,this.refElement("menuButton"),this.refElement("title")])},componentWillUnmount:function componentWillUnmount(){},getState:function getState(){var file=this.props.file;return{isShared:file._isShared,title:file._title,isOpen:file.isOpen()}},render:function render(){var state=this.state;return React.createElement("div",{className:"documentEntry mat-list-button "+(state.isOpen?"mat-selected":"")},React.createElement("div",{ref:"menuButton",className:"documentMenuButton icon-settings c g "+(state.isShared?"icon-users":"icon-settings")}),React.createElement("div",{ref:"title",className:"documentTitle flex1"},state.title))}});return ReactFile}),define("ReactOutline",["globals","platform","VMPane","React","ReactItem","ReactInfiniteList","ReactFile","MooReact"],function(g,platform,VMPane,React,ReactItem,ReactInfiniteList,ReactFile,MooReact){var ReactOutline=React.createClass({mixins:[MooReact.MooReactMixin,React.addons.PureRenderMixin],displayName:"ReactOutline",propTypes:{pane:React.PropTypes.instanceOf(VMPane).isRequired},componentDidMount:function componentDidMount(){var pane=this.props.pane,outline=pane.getOutline();if(outline.scrollElement=this.refElement("outlineScroller"),outline.contentElement=this.refElement("outlineContentElement"),outline.useCustomScroller&&outline.setupCustomScroller(),this.addTap("outlineScroller",pane.getOutline(),pane.getOutline().onTap),platform.mobile){var picker=g.vmMain.vmPicker;this.addTap("refreshButton",picker,picker.onTapRefresh),this.addTap("addDocument",picker,picker.onTapAdd),this.addTap("documentsList",picker,picker.onTapDocument)}},getState:function getState(){var pane=this.props.pane,outline=pane.getOutline(),state={focused:pane.item},picker=g.vmMain.vmPicker;return platform.mobile?(state.documentButtonsCollapsed=picker.documentButtonsCollapsed(),state.documentsLoading=picker.isLoading,state.files=g.vmMain.docManager.docListObs,state.isVisible=outline.isVisible,state.transform=outline.transform):(state.isVisible=outline.isVisible,state.transform=outline.transform,state.cursor=outline.cursor),state},renderIndex:function renderIndex(index,height,offsetTop){var item=this.props.pane.headers.get()[index],pane=this.props.pane;return React.createElement(ReactItem,{key:item.id,pane:pane,item:item,offsetTop:offsetTop,index:index,height:height,outline:!0,isCollapsed:item.isCollapsed(pane,!0),rootLevel:0})},heightAtIndex:function heightAtIndex(index){var pane=this.props.pane,item=pane.headers.get()[index];return item.heightInPane(pane,!0)},itemsObs:function itemsObs(){return this.props.pane.headers},render:function render(){var pane=this.props.pane,mobileDocuments;platform.mobile&&(mobileDocuments=React.createElement("div",{className:"mat-section",id:"mobileDocuments"},React.createElement("div",{id:"headerDocuments",className:"mat-subheader pad-left"},"Documents",React.createElement("div",{id:"documentButtons",className:this.state.documentButtonsCollapsed?"collapsed":""},React.createElement("span",{ref:"refreshButton",className:"refreshDocuments mat-icon-button "+(this.state.documentsLoading?" loading":""),"data-tooltip":"Refresh Documents"}),React.createElement("span",{ref:"addDocument",className:"addDocument mat-icon-button icon-add","data-tooltip":"Create Document"}))),React.createElement("div",{ref:"documentsList",id:"documentsList",className:"mat-list"},this.state.files.map(function(file){return React.createElement(ReactFile,{key:"file_"+file.id,file:file})
}))));var styleOutline={visibility:this.state.isVisible?"visible":"hidden"};platform.mobile||(styleOutline[platform.transform.react]="translate3d("+(100*this.state.transform+"%")+",0,0)",styleOutline.cursor=this.state.cursor);var scrollerClass=g.classNames("paneOutlineScroller","scroller",{customScroller:pane.useCustomScroller});return React.createElement("div",{className:scrollerClass,ref:"outlineScroller",style:styleOutline},React.createElement("div",{className:"outlineContent"},mobileDocuments,React.createElement("div",{className:"mat-section paneOutline",ref:"outline"},React.createElement("div",{className:"mat-subheader pad-left",id:"headerOutline"},"Outline"),React.createElement(ReactInfiniteList,{owner:pane.getInfiniteList(!0),pane:pane,outline:!0,renderIndex:this.renderIndex,itemsObs:this.itemsObs,minItemHeight:g.minItemHeight,contentClass:"outlineList noSelect mat-list",ref:"outlineContentElement"}))))}});return ReactOutline}),define("ReactCaret",["globals","platform","android","React","MooReact","Observable","Sel","VMPane"],function(g,platform,android,React,MooReact,Observable,Sel,VMPane){var ReactCaret=React.createClass({mixins:[MooReact.MooReactMixin,React.addons.PureRenderMixin],displayName:"ReactCursor",propTypes:{pane:React.PropTypes.instanceOf(VMPane).isRequired},componentDidMount:function componentDidMount(){document.addEventListener("mousedown",this.setOn),document.addEventListener("mouseup",this.startAnim),this.props.pane.caretPosition.listen(this.startAnim)},onUnmount:function onUnmount(){this.props.pane.caretPosition.unlisten(this.startAnim),document.removeEventListener("mouseup",this.startAnim),document.removeEventListener("mousedown",this.setOn),clearTimeout(this.animTimeout)},getState:function getState(){var pane=this.props.pane;return this.isOn||(this.isOn=new Observable(!1)),{position:pane.caretPosition,isOn:this.isOn,isWindowFocused:Sel.isWindowFocused,activePane:Sel.pane,isPaneActive:Sel.isWindowFocused.get()&&Sel.getPane()===pane}},onAfterChanged:function onAfterChanged(state,oldState){state.isPaneActive&&state.isPaneActive!==oldState.isPaneActive&&this.startAnim()},setOn:function setOn(){this.state.isPaneActive&&(clearTimeout(this.animTimeout),this.isOn.set(!0))},startAnim:function startAnim(){this.animTick(!0)},animTick:function animTick(on){this.state.isPaneActive&&(clearTimeout(this.animTimeout),this.isOn.set(on||!this.isOn.get()),this.animTimeout=setTimeout(this.animTick,500))},render:function render(){var state=this.state,position=this.state.position,style={};return style.opacity=state.isOn?1:0,style[platform.transform.react]=position&&state.isPaneActive?"translate3d("+position.left+"px, "+position.top+"px, 0)":"translate3d(-1000px, -1000px, 0)",React.createElement("div",{className:"caret",style:style})}});return ReactCaret}),define("ReactPane",["globals","data","platform","VMPane","React","ReactPaneHeader","ReactItem","ReactOutline","ReactInfiniteList","ReactCaret","MooReact","Dispatcher"],function(g,d,platform,VMPane,React,ReactPaneHeader,ReactItem,ReactOutline,ReactInfiniteList,ReactCaret,MooReact,Dispatcher){var ReactPane=React.createClass({mixins:[MooReact.MooReactMixin,React.addons.PureRenderMixin],displayName:"ReactPane",propTypes:{pane:React.PropTypes.instanceOf(VMPane).isRequired},componentDidMount:function componentDidMount(){var pane=this.props.pane;pane.element=this.refElement("pane"),pane.scrollElement=this.refElement("scrollElement"),pane.useCustomScroller&&pane.setupCustomScroller();var root=pane.rootElement=this.refElement("rootElement"),content=pane.paneContent=this.refElement("contentElement");this.setData(pane,[pane.element,pane.scrollElement,root,content]),root.addEventListener("textInput",pane.textInput),root.addEventListener("compositionend",pane.compositionEnd),this.addTap("scrollElement",pane,pane.onTap),pane.isWriteable&&this.addTap("addItemButton",pane,pane.onTapAddItem),platform.mobile&&this.addTap("archiveCompleted",pane,pane.onTapArchiveCompleted),pane.onLoad(),Dispatcher.fireEvent("paneAdded",[pane])},getState:function getState(){var pane=this.props.pane,state={showLoadMore:pane.showLoadMore(),hasOutlineOpened:pane.outline.hasOpened,isOutlineVisible:pane.outline.isVisible,outlineTransform:pane.outline.transform,isNotReady:pane.isNotReady,item:pane.item,paneTopText:pane.paneTopText,isLoading:g.vmMain.isLoadingRemoteDoc};return platform.mobile?state.numComplete=pane.numCompleteItems:(state.parents=pane.getItem().parents(),state.cursor=pane.cursor),state},renderIndex:function renderIndex(index,height,offsetTop){var pane=this.props.pane,item=pane.itemAtIndex(index),rootLevel=pane.item.get().levelsDeep.get();return React.createElement(ReactItem,{key:item.id,pane:pane,item:item,offsetTop:offsetTop,index:index,height:height,isCollapsed:item.isCollapsed(pane,!1),rootLevel:rootLevel})},itemsObs:function itemsObs(){return this.props.pane.items},render:function render(){var pane=this.props.pane,addItemButton,paneTopText,archiveCompletedButton,showLoadMore;if(pane.isWriteable?addItemButton=React.createElement("div",{className:"addItemButton mat-icon-button","data-tooltip":"Add Item",ref:"addItemButton"}):this.state.paneTopText&&(paneTopText=React.createElement("span",{className:"loadingText"},this.state.paneTopText)),this.state.showLoadMore&&(showLoadMore=React.createElement("div",{className:"paneDataPageLoad requestDataPage mat-button-flat g"},"LOAD MORE")),platform.mobile){var cls="mat-icon-button icon-task"+(0===this.state.numComplete?" disabled":"");archiveCompletedButton=React.createElement("div",{className:cls,ref:"archiveCompleted"})}var paneClass=g.classNames("pane",pane.paneClass,{paneOutlineVisible:this.state.isOutlineVisible},{hasTitles:platform.mobile?!1:this.state.parents.length>1}),paneScrollerClass=g.classNames("paneScroller","scroller",{loading:this.state.isLoading},{customScroller:pane.useCustomScroller}),paneScrollerStyle={};!platform.mobile&&this.state.isOutlineVisible&&(paneScrollerStyle[platform.transform.react]="translate3d("+(100*(this.state.outlineTransform+1)+"%")+",0,0)");var paneRootClass=g.classNames("paneRoot",{isNotReady:this.state.isNotReady}),paneRootStyle={cursor:this.state.cursor},list=React.createElement(ReactInfiniteList,{owner:pane.getInfiniteList(!1),pane:pane,outline:!1,renderIndex:this.renderIndex,itemsObs:this.itemsObs,emptyElement:!platform.mobile,contentClass:"paneContent editable",minItemHeight:g.minItemHeight,isLoading:this.state.isLoading,ref:"contentElement"}),caret=platform.mobile?null:React.createElement(ReactCaret,{pane:pane}),outline=this.state.hasOutlineOpened?React.createElement(ReactOutline,{pane:pane}):null;return React.createElement("div",{ref:"pane",className:paneClass},React.createElement(ReactPaneHeader,{pane:pane}),outline,React.createElement("div",{className:paneScrollerClass,style:paneScrollerStyle,ref:"scrollElement"},React.createElement("div",{className:paneRootClass,ref:"rootElement",style:paneRootStyle},React.createElement("div",{className:"paneTopBox"},addItemButton,paneTopText,archiveCompletedButton),list,showLoadMore,caret)))}});return ReactPane}),define("ReactPaneAgenda",["globals","platform","VMPane","React","ReactPaneHeader","ReactOutline","MooReact","ReactInfiniteList","ReactItem","Dispatcher"],function(g,platform,VMPane,React,ReactPaneHeader,ReactOutline,MooReact,ReactInfiniteList,ReactItem,Dispatcher){var ReactPaneAgenda=React.createClass({mixins:[MooReact.MooReactMixin,React.addons.PureRenderMixin],displayName:"ReactPaneAgenda",propTypes:{pane:React.PropTypes.instanceOf(VMPane).isRequired},componentDidMount:function componentDidMount(){var pane=this.props.pane;this.id=pane.id,pane.element=this.refElement("pane");var root=pane.rootElement=this.refElement("rootElement");pane.scrollElement=this.refElement("scrollElement"),pane.paneContent=this.refElement("contentElement"),pane.useCustomScroller&&pane.setupCustomScroller(),this.setData(pane,[pane.element,pane.scrollElement,root,pane.paneContent]),root.addEventListener("textInput",pane.textInput.bind(pane)),root.addEventListener("compositionend",pane.compositionEnd.bind(pane)),this.addTap("scrollElement",pane,pane.onTap),platform.mobile&&this.addTap("archiveCompleted",pane,pane.onTapArchiveCompleted),setTimeout(function(){pane.onLoad()}),Dispatcher.fireEvent("paneAdded",[pane])},getState:function getState(){var pane=this.props.pane,outline=pane.outline,state={items:pane.items,hasOutlineOpened:outline.hasOpened,isOutlineVisible:outline.isVisible,outlineTransform:outline.transform};return platform.mobile?state.numComplete=pane.numCompleteItems:(state.parents=pane.getItem().parents(),state.cursor=pane.cursor),state},renderIndex:function renderIndex(index,height,offsetTop){var pane=this.props.pane,agendaItem=this.state.items[index];if(agendaItem){if("agendaHeader"===agendaItem.type){var block=agendaItem.block,cls=g.classNames("dateHeader",{starredBlock:block.isStarred},{importantBlock:block.isImportant},{todayBlock:block.isToday||block.isNow},{first:0===index}),styles={top:offsetTop};return React.createElement("li",{key:block.text,style:styles,className:cls},block.text)}if("agendaTime"===agendaItem.type){var styles={top:offsetTop};return React.createElement("li",{key:agendaItem.id+"_time",style:styles,className:"timelineItemTime"+(agendaItem.isComplete?" pComplete":"")},agendaItem.text)}var item=agendaItem.item,block=agendaItem.block;return React.createElement(ReactItem,{key:agendaItem.id,pane:pane,item:item,offsetTop:offsetTop,index:index,height:height})}return null},itemsObs:function itemsObs(){return this.props.pane.items},render:function render(){var pane=this.props.pane,archiveCompletedButton,showLoadMore,noBlocks;if(platform.mobile){var cls="mat-icon-button icon-task"+(0===this.state.numComplete?" disabled":"");archiveCompletedButton=React.createElement("div",{className:cls,ref:"archiveCompleted"})}var paneClass=g.classNames("pane",pane.paneClass,{paneOutlineVisible:this.state.isOutlineVisible},{hasTitles:platform.mobile?!1:this.state.parents.length>1}),scrollerClass=g.classNames("paneScroller","scroller",{customScroller:pane.useCustomScroller}),paneRootStyle={cursor:this.state.cursor},outline=this.state.hasOutlineOpened?React.createElement(ReactOutline,{pane:pane}):null;return React.createElement("div",{ref:"pane",className:paneClass},React.createElement(ReactPaneHeader,{pane:pane}),outline,React.createElement("div",{className:scrollerClass,ref:"scrollElement"},React.createElement("div",{className:"paneRoot",ref:"rootElement",style:paneRootStyle},React.createElement("div",{className:"paneTopBox"},archiveCompletedButton),noBlocks,React.createElement(ReactInfiniteList,{owner:pane.getInfiniteList(!1),pane:pane,outline:!1,renderIndex:this.renderIndex,itemsObs:this.itemsObs,contentClass:"paneContent",minItemHeight:20,ref:"contentElement"}),showLoadMore)))}});return ReactPaneAgenda}),define("ReactDragDrop",["globals","platform","React","MooReact","Observable","DragDrop","ReactItem"],function(g,platform,React,MooReact,Observable,DragDrop,ReactItem){var ReactDragDrop=React.createClass({mixins:[MooReact.MooReactMixin,React.addons.PureRenderMixin],displayName:"ReactDragDrop",componentDidMount:function componentDidMount(){},getState:function getState(){var d=DragDrop,val={items:d.draggingItems,draggingExternal:d.draggingExternal,activePane:d.activePane,startPane:d.startPane,position:d.position,transform:d.transform,isVisible:d.isVisible,linePosition:d.linePosition};return d.activePane&&(val.lastActivePane=d.activePane),val},render:function render(){var pane=this.state.lastActivePane,items=this.state.items;if(pane&&(items||this.state.draggingExternal)&&this.state.isVisible){var dragItems=null;if(items&&!this.state.draggingExternal){for(var rootLevel=pane.item.get().levelsDeep.get(),renderedItems=[],numItems=Math.min(items.length,10),i=0;numItems>i;++i)renderedItems.push(React.createElement(ReactItem,{key:"drag_"+i,pane:pane,item:items[i],isInDragDrop:!0,rootLevel:rootLevel}));var numMore=items.length-numItems;numMore>0&&renderedItems.push(React.createElement("div",{className:"dotdotdot"},"... plus "+numMore+" more ..."));var ulPos=this.state.position,styleUL={left:platform.mobile?0:ulPos.left,top:ulPos.top,width:pane.getWidth()},transform=this.state.transform;styleUL[platform.transform.react]="translate3d("+transform.left+"px, "+transform.top+"px, 0)",dragItems=React.createElement("ul",{id:"dragUL",style:styleUL},renderedItems)}var dragLine=null;if(this.state.linePosition&&this.state.activePane){var styleLine={},linePos=this.state.linePosition;styleLine[platform.transform.react]="translate("+linePos.left+"px, "+linePos.top+"px) scale("+linePos.width+",1)",dragLine=React.createElement("div",{id:"dragLine",style:styleLine})}return React.createElement("div",{id:"dragdrop",className:this.state.startPane.paneClass},dragItems,dragLine)}return null}});return ReactDragDrop}),define("ReactMain",["globals","platform","React","ReactPane","ReactPaneAgenda","ReactDragDrop","MooReact","Sel","DragDrop"],function(g,platform,React,ReactPane,ReactPaneAgenda,ReactDragDrop,MooReact,Sel,DragDrop){var ReactCSSTransitionGroup=React.addons.CSSTransitionGroup,ReactMain=React.createClass({mixins:[MooReact.MooReactMixin,React.addons.PureRenderMixin],displayName:"ReactMain",propTypes:{main:React.PropTypes.object.isRequired},componentDidMount:function componentDidMount(){var main=this.props.main;document.addEventListener("keydown",this.keydown),document.addEventListener("keypress",this.keypress),document.addEventListener("keyup",this.keyup),this.state.isHelpShowing&&g.applyBindings(g.intro,"paneHelp")},keydown:function keydown(e){if(Sel.isValid()&&!g.vmMain.isFullscreenClickHandled())Sel.getPane().keydown(e);else if(e.target===document.body&&e.normCode===KeyCode.Backspace)return e.handled=!0,e.preventDefault(),!1},keypress:function keypress(e){Sel.isValid()&&!g.vmMain.isFullscreenClickHandled()&&Sel.getPane().keypress(e)},keyup:function keyup(e){Sel.isValid()&&!g.vmMain.isFullscreenClickHandled()&&Sel.getPane().keyup(e)},getState:function getState(){var main=this.props.main;return{panes:main.paneManager._panes,isHelpShowing:g.intro.reactIsShowing,isWindowFocused:Sel.isWindowFocused,isDragging:DragDrop.isVisible,isDocLoading:g.vmMain.isLoadingRemoteDoc}},onAfterChanged:function onAfterChanged(state,oldState){var wasHelpShowing=oldState.isHelpShowing;!state.isHelpShowing||this.state.isDocLoading||oldState.isHelpShowing&&!oldState.isDocLoading||g.intro.applyBindings()},render:function render(){for(var state=this.state,panes=[],i=0;i<state.panes.length;++i){var pane=state.panes[i];panes[i]=pane.type===PaneMode.Timeline?React.createElement(ReactPaneAgenda,{key:"pane"+pane.id,pane:pane}):React.createElement(ReactPane,{key:"pane"+pane.id,pane:pane})}var cls=g.classNames("panes",{windowBlurred:!state.isWindowFocused},{draggingItems:!!state.isDragging}),help;help=state.isHelpShowing?React.createElement("div",{id:"paneHelp",className:"paneHelp","data-bind":"template: {name: 'template-help-pane'}"}):null;var styleMain=platform.mobile?null:{maxWidth:g.vmMain.maxWidth()},spacer=platform.mobile?null:React.createElement("div",{className:"paneSpacer ns noClick"}),loading,renderedContent;return renderedContent=state.isDocLoading?React.createElement("div",{key:"loadingRemote",id:"loadingRemote",className:"centerVH"},React.createElement("div",{className:"loading",style:{marginBottom:15}}),React.createElement("div",null,"Loading document")):React.createElement("div",{key:"renderedContent",className:cls,style:styleMain},spacer,panes,help,spacer,React.createElement(ReactDragDrop,null)),React.createElement(ReactCSSTransitionGroup,{transitionName:"reactFade"},renderedContent)}});return ReactMain}),define("VMMain",["ko","globals","Dispatcher","util","android","CacheManager","data","gdata","goog","edit","copypaste","VMLI","tracker","platform","VMPane","PaneFactory","VMMenus","VMSettings","VMPicker","VMPhoneMenu","VMKeyboardToolbar","VMIntro","VMMessageQueue","International","VMPluginManager","PaneManager","RealtimeDocManager","RecurringTaskManager","DocManager","ItemStoreManager","React","ReactMain","Measure","NativeSel","Sel","DragDrop","Observable"],function(ko,g,Dispatcher,util,android,CacheManager,d,gdata,goog,edit,copypaste,VMLI,tracker,platform,VMPane,PaneFactory,VMMenus,VMSettings,VMPicker,VMPhoneMenu,VMKeyboardToolbar,VMIntro,VMMessageQueue,International,VMPluginManager,PaneManager,RealtimeDocManager,RecurringTaskManager,DocManager,ItemStoreManager,React,ReactMain,Measure,NativeSel,Sel,DragDrop,Observable){var VMMain=function(){function runRemoteLoad(rootItem){g.isLoadingRemote=!0;try{d.beginTransaction();var lastServerVersion=g.settings.get(Settings.lastServerVersion),currentServerVersion=gdata.getServerVersion();lastServerVersion===currentServerVersion&&log("Client and Server Versions Match!"),g.startTimeEvent("PageLoad","RemoteData","Load Remote Data"),tracker.beginAction(!0);var previousLocalIntegrity=g.settings.get(Settings.localIntegrity);previousLocalIntegrity===!1&&(ShouldLog(LogLevels.Warning)&&log("Previous remote sync had an issue!"),g.reportError(new Error("Previous remote sync had an issue!"))),gdata.loadSeen={},g.settings.set(Settings.localIntegrity,!1),self.root().initFromGDrive(rootItem),g.settings.set(Settings.localIntegrity,!0),gdata.loadSeen={},tracker.endAction(),ShouldLog(LogLevels.Timing)&&log("Drive done init",log.now()),self.flushParseItems(),self.flushModifiedItems(),d.hasLocalData&&self.root().resetModified(),d.clearPendingUpdates(),g.endTimeEvent(),Dispatcher.fireEvent("remoteDataLoaded",[])}catch(err){g.reportError(err),g.messageQueue.pushMessage({text:"There was an error loading your data from the server. Please try again.",action:MessageAction.Reload})}finally{d.endTransaction(),g.isLoadingRemote=!1}}function setupPageVisibility(){function handleVisibilityChange(){platform.isPageVisible()?updateTimeout&&(clearTimeout(updateTimeout),updateTimeout=0):updateTimeout=setTimeout(function(){g.AppCache.checkForUpdate(!1,!0),g.vmMain.pluginManager.writeCaches()},5e3)}function checkActivity(){Date.now()>self.lastActivity+g.minutes(90)&&(g.AppCache.checkForUpdate(!1,!0),self.lastActivity=Date.now()),activityTimeout=setTimeout(checkActivity,g.minutes(60))}platform.pageVisibilityChange&&document.addEventListener(platform.pageVisibilityChange,handleVisibilityChange),platform.mobile||(activityTimeout=setTimeout(checkActivity,g.minutes(60)))}function updateWatchdog(){log("Last Update Items StacK: "+this._lastUpdateItemsStack);try{g.PAssert(3610,!1,"Update Watchdog Triggered - This should never happen.",self._isWaitingUpdateItems)}catch(PERR){g.reportError(PERR)}self._isWaitingUpdateItems=1,self.commitUpdateItems()}var self={root:ko.observable(void 0),isLoadingRemoteDoc:new Observable(!1),isLoaded:!1,hasResized:ko.observable(!1),_hasDisplayedArchivedItems:!1,helpButtonHidden:ko.observable(!1),showFeedback:ko.observable(!platform.mobile&&!platform.demo),gdriveStatus:ko.observable(-1),isPhone:platform.phone,vmSettings:void 0,selected:ko.observableArray(),help:void 0,messageQueue:new VMMessageQueue,lastActivity:0,cacheManager:CacheManager,taskManager:new RecurringTaskManager,itemStoreManager:new ItemStoreManager,pluginManager:new VMPluginManager,paneManager:new PaneManager,paneFactory:PaneFactory,docManager:new DocManager,realtimeDocManager:new RealtimeDocManager,vmPicker:new VMPicker};g.vmMain=self,self.pluginManager.registerPlugins(),self.remoteAPI=function remoteAPIFn(){return self.pluginManager.getPlugin(PluginID.Moodo)},self.loadPlugins=function loadPluginsFn(){var debugPlugin},self.statusClass=platform.mobile?function statusClassFn(){return self.gdriveStatus()===DriveStatus.Offline?"statusOffline":self.gdriveStatus()===DriveStatus.Connecting||self.gdriveStatus()===DriveStatus.Reconnecting?"statusConnecting":void 0}:function statusClassFn(){return""},platform.mobile&&(self.elPhoneMenu=g.element("phoneMenu")),g.vmSettings=self.vmSettings=new VMSettings(this),self.isOnline=function isOnlineFn(){return self.gdriveStatus()!==DriveStatus.Offline},self.isReconnecting=function isReconnectingFn(){return self.gdriveStatus()===DriveStatus.Reconnecting},self.isLocal=function isLocalFn(){return"localhost"===window.location.hostname},self.onlineText=function onlineTextFn(){if(self.isDemoMode())return"DEMO";switch(self.gdriveStatus()){case DriveStatus.Connecting:return"CONNECTING";case DriveStatus.Offline:return"OFFLINE";case DriveStatus.Saving:case DriveStatus.Saved:return"";case DriveStatus.Reconnecting:return"RETRYING"}},self.maxWidth=function maxWidthFn(){if(self.isPhone)return"";var num=self.paneManager.paneCount(),width=num*(g.maxPaneWidth+12)+(self.help.isShowing()?g.minPaneWidth+12:0);return width+"px"},self.getUserEmail=function getUserEmailFn(){return g.getUserIdentifier()},self.getUserImage=function getUserImageFn(){var user=gdata.authenticatedUser();return user?user.photoUrl:void 0},self.isDemoMode=function isDemoModeFn(){return g.isDemoMode()},window.addEventListener("scriptLoadError",function(e){self.handleScriptLoadError(e)}),self.handleScriptLoadError=function handleScriptLoadErrorFn(e){"gapiScript"===e.data.id&&(log("Failed to load GAPI!"),self.setGDriveStatus(DriveStatus.Offline),self.failedGapiLoad=!0,setTimeout(goog.goOnline,3e4))};var connectTimeout;self.connectFailed=function connectFailedFn(){self.setGDriveStatus(DriveStatus.Offline),connectTimeout=void 0,goog.ensureDocConnection()},self.setGDriveStatus=function setGDriveStatusFn(status){var prevStatus=self.gdriveStatus();status!==prevStatus&&status!==DriveStatus.Saving&&(self.gdriveStatus(status),status===DriveStatus.Connecting||status===DriveStatus.Reconnecting?gdata.loadedOnce&&(clearTimeout(connectTimeout),connectTimeout=setTimeout(self.connectFailed,gdata.offlineTimeoutMS)):(clearTimeout(connectTimeout),connectTimeout=void 0),status===DriveStatus.Offline?g.goOffline():prevStatus===DriveStatus.Offline&&g.goOnline())},self.init=function initFn(){g.settings._ensureRemoteSettings(),copypaste.init(),self.loadPlugins(),Dispatcher.listen("showArchived",function(){self._hasDisplayedArchivedItems||(self._hasDisplayedArchivedItems=!0,self.parseSubtreeArchive(self.root(),ChangeType.Auto))})},self.hasDisplayedArchivedItems=function hasDisplayedArchivedItemsFn(){return self._hasDisplayedArchivedItems},self.onLoad=function onLoadFn(){React.render(React.createElement(ReactMain,{main:this}),document.getElementById("reactRoot")),g.intro.init(),self.isDemoMode()&&platform.script&&g.setupClick(document.getElementById("main"),self,self.onTapMain)},self.addModifiedItem=function addModifiedItemFn(item,modFlags){},self.flushModifiedItems=function flushModifiedItemsFn(){},self.addParseItem=function addParseItemFn(item,changeType){self.runSingleParse(item,changeType)},self.flushParseItems=function flushParseItemsFn(){},self.runParseWorkerNewContacts=function runParseWorkerNewContactsFn(){self.root()&&self.parseWorkerNewContactsHelper(self.root(),ChangeType.Auto)},self.parseWorkerNewContactsHelper=function parseWorkerNewContactsHelperFn(item,changeType){try{g.PAssert(3539,item,"Must supply a valid item to parse")}catch(PERR){g.reportError(PERR)}var rawText=item.getRawText();rawText.indexOf(ContactPrefix)>=0&&self.runSingleParse(item,changeType);for(var items=item.getItems(),i=0;i<items.length;i++)self.parseWorkerNewContactsHelper(items[i],changeType)},self.parseSubtree=function parseSubtreeFn(item,changeType){try{g.PAssert(3542,item,"Must supply a valid item to parse")}catch(PERR){g.reportError(PERR)}self.runSingleParse(item,changeType);for(var items=item.getItems(),i=0;i<items.length;i++)self.parseSubtree(items[i],changeType)},self.parseSubtreeArchive=function parseSubtreeArchiveFn(item,changeType){try{g.PAssert(3543,item,"Must supply a valid item to parse")}catch(PERR){g.reportError(PERR)}self.runSingleParse(item,changeType);for(var items=item.getItems(),i=0;i<items.length;i++)self.parseSubtreeArchive(items[i],changeType);if(item.hasArchivedChildren())for(var archivedItems=item.archivedItems(!0),i=0;i<archivedItems.length;i++)self.parseSubtreeArchive(archivedItems[i],changeType)},self.runSingleParse=function runSingleParseFn(item,changeType){try{g.PAssert(3550,item,"Must have a valid item to parse")}catch(PERR){g.reportError(PERR)}var changedStyles={};item.parseText(!0,changeType,changedStyles)&&item.save(changedStyles,SaveFlag.None)};var lastDateRollover=0;self.setupDateRollover=function setupDateRolloverFn(){var currentTime=new Date,nextRolloverTime=currentTime.clone().addDays(1).clearTime();try{g.PAssert(3555,nextRolloverTime>currentTime,"Rollover time must be in the future")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3556,nextRolloverTime>lastDateRollover,"Rollover time must be after the last rollover")}catch(PERR){g.reportError(PERR)}return log("Next Rollover Time: ",nextRolloverTime),setTimeout(function(){function runRolloverWork(){self.parseSubtree(self.root(),ChangeType.Auto|ChangeType.Rollover),Dispatcher.fireEvent("itemStateChanged",[]),log("-------------------------------")}try{g.PAssert(3557,self.isLoaded,"Expect that we have fully loaded the page before performing rollover")}catch(PERR){g.reportError(PERR)}log("---- Running Date Rollover ----"),lastDateRollover=new Date,self.setupDateRollover(),Date.Parsing.Normalizer.buildReplaceData(),g.settings.get(Settings.syncContacts)?(goog.loadedContacts=!1,goog.loadContacts(runRolloverWork)):runRolloverWork(),Measure.clearItemCache()},nextRolloverTime-currentTime),nextRolloverTime};var hasLoadedRemoteData=!1;self.notifyDriveDisconnect=function notifyDriveDisconnectFn(){hasLoadedRemoteData=!1,tracker.resetAggregateActionCount()},self.notifyDriveOperationError=function notifyDriveOperationErrorFn(){tracker.resetAggregateActionCount()},self.loadGDriveData=function loadGDriveDataFn(){if(!hasLoadedRemoteData){hasLoadedRemoteData=!0,platform.mobile||(self.selectionOnLoad=Sel.save());var rootItem=gdata.rootItem,createRoot=!self.root();try{if(createRoot){d.createRootItem(rootItem.id);var rootVMLI=d.createVMLI(d.getRootItem(),{changeType:ChangeType.Auto});g.vmMain.itemStoreManager.getDefaultItemStore().setRoot(rootVMLI),self.root(rootVMLI)}self.root().linkToGDrive(rootItem)}catch(err){g.reportError(err),g.menus.alert({text:"There was a fatal error in the application. Please reload to try again.",actionText:"RELOAD",action:g.reload})}try{gdata.checkRemoteIntegrity()}catch(err){g.reportError(err)}g.vmMain.beginUpdateItems(),runRemoteLoad(rootItem),g.vmMain.commitUpdateItems(),createRoot&&g.vmMain.isLoadingRemoteDoc.set(!1),self.vmPicker.refreshFiles()}};var hasLoadedData=!1;self.loadDemoContacts=function loadDemoContactsFn(names){function addContact(name){contacts.push({id:"contact_"+contactId++,name:name,isDemo:!0,emails:[{address:"contact@moo.do",primary:!0}],phoneNumbers:[{number:"(555) 123-4567",type:"mobile"}]})}for(var contacts=[],contactId=0,i=0;i<names.length;i++)addContact(names[i]);d.contactManager.loadContacts(contacts,!0)},self.loadData=function loadDataFn(){if(!hasLoadedData){var start=log.now();if(hasLoadedData=!0,self.isDemoMode()){var contacts=["Jay","Grant","Ramada","Canyon Ranch","Jim Joseph","Miller Harris","Bob Johnson","Bill Wilson","Emily Edwards","Jane Johnson","Mike Thomas","Joe Lewis","Steve","Melissa","Mikey","Bart","Dad","Mom","James Rhodes","Neptures","Pepper","President Ellis"];self.loadDemoContacts(contacts)}if(g.startTimeEvent("PageLoad","LocalData","Load Local Data"),g.vmMain.beginUpdateItems(),d.getRootItem()){var rootVMLI=d.createVMLI(d.getRootItem(),{changeType:ChangeType.Auto});g.vmMain.itemStoreManager.getDefaultItemStore().setRoot(rootVMLI),self.root(rootVMLI)}g.vmMain.commitUpdateItems(),g.checkpoint(Checkpoint.LocalDocLoad),g.endTimeEvent(),self.isLoaded=!0,g.requireGDriveDataCallback&&self.loadGDriveData(),ShouldLog(LogLevels.Timing)&&log("Run loading/parseWorker",log.now()),setTimeout(function(){self.isDemoMode()&&(platform.script&&g.vmSetup.runScript(util.getURLParam("script")),window.parent.postMessage("loaded","*"))},0),self.isLoadingRemoteDoc.get()?self.isLoadingRemoteDoc.listen(function(value){value||(log("after loaded in callback"),self.afterLoaded())}):(log("after loaded"),self.afterLoaded()),g.startTimeEvent("PageLoad","ApplyBindings","Apply Bindings"),g.applyBindings(self,"container"),platform.mobile||g.applyBindings(self,"desktopMenu"),document.getElementById("container").style.display="block",platform.app&&g.nativeBridge.sendToApp("localLoaded"),ShouldLog(LogLevels.Timing)&&(log("DONE LOCALLY",log.now()),setTimeout(function(){var end=log.now();log("time react:",end-start,end)},0)),g.endTimeEvent()}},self.changeRoot=function changeRootFn(rootId){try{g.PAssert(3558,rootId,"Cannot use to reset root to undefined")}catch(PERR){g.reportError(PERR)}var newRoot=d.getModel(rootId);newRoot||(newRoot=d.createVMLI(d.getItem(rootId),{changeType:ChangeType.Auto}));try{g.PAssert(3559,newRoot,"Must have a new root VMLI at this point, otherwise failed creation")}catch(PERR){g.reportError(PERR)}newRoot&&(self.itemStoreManager.getDefaultItemStore().setRoot(newRoot),self.root(newRoot),self.paneManager.runForEachPane(function(pane){Sel.reset(),pane.clearItems(!1),pane.setItem(newRoot)}))},self.resetScrollOffsets=function resetScrollOffsetsFn(){self.paneManager.runForEachPane(function(pane){pane.setScrollOffset(pane.defaultOffset)})},self.onTapMain={onStart:function onStartFn(){g.fireCustomEvent("tapMain")},onClick:function onClickFn(){try{g.PAssert(3560,self.isDemoMode()&&platform.script,"Tap handler should only be active on demo page")}catch(PERR){g.reportError(PERR)}window.parent.postMessage("click","*")}},g.globalClickHandler=function(e){g.tooltip.hideTip()},self.loadDemoPanes=function loadDemoPanesFn(){self.paneManager.clearPanes();for(var i=0;i<g.demoPanes.length;i++){var paneInfo=g.demoPanes[i].split(",");if("help"===paneInfo[0])self.showHelp();else{var type=paneInfo[0];"1"===type?type=PaneMode.Normal:"2"===type&&(type=PaneMode.Timeline);var paneInit={id:self.paneManager.getNextPaneID()};if(paneInfo.length>1){paneInfo[1]&&(paneInit.search=paneInfo[1]);var focusModel;paneInfo[2]&&(focusModel=d.getModel(paneInfo[2])),paneInit.item=focusModel||self.root()}var addedPane=PaneFactory.createPane(type,paneInit);addedPane&&self.paneManager.addPaneAtIndex(addedPane)}}var firstPane=self.paneManager.getPaneAtIndex(0);try{g.PAssert(3565,firstPane,"Must always have at least one valid pane in demo mode")}catch(PERR){g.reportError(PERR)}firstPane&&(Sel.setFocusedPane(firstPane),self.zoomin(firstPane.getItem(),!0))},self.loadItemPane=function loadItemPaneFn(paneData){try{g.PAssert(3566,paneData,"Must specify valid pane data to load from")}catch(PERR){g.reportError(PERR)}var normalPanes=self.paneManager.getPanesByType(PaneMode.Normal),focusModel=d.getModel(paneData);if(focusModel){var focusPane;if(normalPanes.length>0)focusPane=normalPanes[0];else{var initData={id:self.paneManager.getNextPaneID(),item:focusModel};focusPane=PaneFactory.createPane(PaneMode.Normal,initData),focusPane&&self.paneManager.addPaneAtIndex(0)}focusPane&&(Sel.setFocusedPane(focusPane),self.zoomin(focusModel,!0))}},self.afterLoaded=function afterLoadedFn(){var paneState=self.paneManager.getPaneState();if(paneState.length>0){try{g.PAssert(3567,1===paneState.length||!platform.mobile,"Mobile will always have a single pane")}catch(PERR){g.reportError(PERR)}for(var i=0;i<paneState.length;++i){if(platform.mobile&&i>0){try{g.PAssert(3568,!1,"Loading invalid pane state")}catch(PERR){g.reportError(PERR)}break}var paneInfo=paneState[i],item=d.getModel(paneInfo.focus),paneType=paneInfo.type||(1===paneInfo.mode?PaneMode.Normal:PaneMode.Timeline),pane=PaneFactory.createPane(paneType,{id:self.paneManager.getNextPaneID(),item:item,search:paneInfo.search,offset:paneInfo.offset});pane?(paneInfo.id=pane.id,paneInfo.showarch&&pane.showArchived.set(!0),pane.applyItemState(paneInfo.itemState),self.paneManager.addPaneAtIndex(pane,void 0,!0),Sel.setFocusedPane(pane,!0),self.zoomin(pane.getItem(),!0)):(paneState.splice(i,1),self.paneManager.savePaneState(),--i)
}1!==self.paneManager.paneCount()&&Sel.setFocusedPane(pane,!0)}var loadPanes=util.getURLParam("panes");self.isDemoMode()&&g.demoPanes?self.loadDemoPanes():loadPanes?self.loadItemPane(loadPanes):0===self.paneManager.paneCount()&&d.getRootItem()&&self.createDefaultPane(),platform.mobile&&(g.phoneMenu=new VMPhoneMenu,g.keyboardToolbar=new VMKeyboardToolbar),platform.app&&(document.onreadystatechange=function(){platform.mobile&&g.nativeBridge.sendToApp("kbsize"),g.nativeBridge.sendToApp("loaded")},document.onreadystatechange()),g.timeline.updateNotifications()},self.createDefaultPane=function createDefaultPaneFn(){var pane=PaneFactory.createPane(PaneMode.Normal,{id:self.paneManager.getNextPaneID()});if(self.paneManager.addPaneAtIndex(pane),!platform.mobile&&g.activeDisplayMode&DisplayMode.ForceTwoPane){var pane2=PaneFactory.createPane(PaneMode.Timeline,{id:self.paneManager.getNextPaneID()});self.paneManager.addPaneAtIndex(pane2)}Sel.setFocusedPane(self.paneManager.getPaneAtIndex(0)),self.zoomin(self.root(),!0)},self.togglePaneModeMobile=function togglePaneModeMobileFn(srcPane,dstType){try{g.PAssert(3570,platform.mobile,"Should only call on mobile devices")}catch(PERR){g.reportError(PERR)}var dstPane=self.paneManager.getSwappedPaneByType(dstType);try{g.PAssert(3571,dstPane,"Must always have a pane of requested type available")}catch(PERR){g.reportError(PERR)}dstPane.copyStateFrom(srcPane),dstPane.outline.hasSetHeightOnce=!1,self.paneManager.swapPaneAtIndex(0,dstPane),g.keyboardToolbar.hide(),Sel.setFocusedPane(dstPane)},self.getPaneSwapIconMobile=function getPaneSwapIconMobileFn(){try{g.PAssert(3572,platform.mobile,"Should only call on mobile devices")}catch(PERR){g.reportError(PERR)}var activePane=self.paneManager.getPaneAtIndex(0);return activePane.type===PaneMode.Timeline?"icon-align-left":"icon-calendar2"},self.getFirstSelectedItem=function getFirstSelectedItemFn(){try{g.PAssert(3578,platform.mobile,"Selection tracking only available from mobile")}catch(PERR){g.reportError(PERR)}return self.selected().length>0?self.selected()[0]:void 0},self.setSelected=function setSelectedFn(selection){try{g.PAssert(3579,platform.mobile,"Selection tracking only available from mobile")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3580,g.isArray(selection),"Must pass in a valid array")}catch(PERR){g.reportError(PERR)}self._clearIsSelected(selection);for(var i=0;i<selection.length;++i){try{g.PAssert(3581,selection[i]&&!!selection[i].isSelected,"Must have a selectable item")}catch(PERR){g.reportError(PERR)}selection[i].isSelected(!0)}self.selected(selection)},self.getSelected=function getSelectedFn(){try{g.PAssert(3582,platform.mobile,"Selection tracking only available from mobile")}catch(PERR){g.reportError(PERR)}return self.selected()},self.toggleSelection=function toggleSelectionFn(item){try{g.PAssert(3583,platform.mobile,"Selection tracking only available from mobile")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3584,item,"Must be selecting a valid item")}catch(PERR){g.reportError(PERR)}if(item.isSelected(!item.isSelected()),item.isSelected()){try{g.PAssert(3585,self.selected.indexOf(item)<0,"Must not be double adding an item to selection")}catch(PERR){g.reportError(PERR)}self.selected.push(item)}else{try{g.PAssert(3586,self.selected.indexOf(item)>=0,"Item must be selected already to toggle")}catch(PERR){g.reportError(PERR)}self.selected.splice(self.selected.indexOf(item),1)}},self._clearIsSelected=function _clearIsSelectedFn(newSelected){try{g.PAssert(3587,platform.mobile,"Selection tracking only available from mobile")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3588,g.isArray(newSelected),"Must pass in a valid array")}catch(PERR){g.reportError(PERR)}for(var i=0;i<self.selected().length;++i){var selectedItem=self.selected()[i];if(newSelected.indexOf(selectedItem)<0){try{g.PAssert(3589,selectedItem&&!!selectedItem.isSelected,"Must have a selectable item")}catch(PERR){g.reportError(PERR)}selectedItem.isSelected(!1)}}},self.clearSelected=function clearSelectedFn(){try{g.PAssert(3590,platform.mobile,"Selection tracking only available from mobile")}catch(PERR){g.reportError(PERR)}self._clearIsSelected([]),self.selected([])},self.zoomin=function zoominFn(item,forLoad){try{g.PAssert(3606,item,"Must supply a valid item to zoom to")}catch(PERR){g.reportError(PERR)}var oldItem=g.focusedItem;self._zoom(item,forLoad);var pane=g.focusedPane;item.isDemandLoad()&&item.notifyDemandLoadUpdate(!0,pane),forLoad||g.sendEvent("Menu","ZoomIn"),!platform.mobile&&pane.paneContent&&pane.isWriteable&&(pane.numItems()>0?Sel.selectIndex(0,0,0):Sel.clearSelection()),pane.isLoaded&&pane.setScrollOffset(pane.defaultOffset),forLoad||tracker.performAction(TrackerType.Zoom,{itemID:item.id,oldItemID:oldItem.id,zoomIn:!0,time:g.zoomTime})},self.zoomout=function zoomoutFn(item,fromUndo){try{g.PAssert(3607,item,"Must supply a valid item to zoom to")}catch(PERR){g.reportError(PERR)}var oldItem=g.focusedItem,savedSel=Sel.save();self._zoom(item,!1),g.sendEvent("Menu","ZoomOut");var pane=g.focusedPane;pane.isWriteable&&savedSel&&pane.indexOfItem(savedSel.startItem)>=0&&pane.indexOfItem(savedSel.endItem)>=0&&(Sel.selectItems(savedSel.startItem,savedSel.startOffset,savedSel.endItem,savedSel.endOffset),g.focusedPane.scrollToMiddle(savedSel.startItem,ScrollDuration.Snap)),fromUndo||tracker.performAction(TrackerType.Zoom,{itemID:item.id,oldItemID:oldItem.id,zoomOut:!0,time:g.zoomTime})},self._zoom=function _zoomFn(item,forLoad){try{g.PAssert(3608,item,"Must supply a valid item to zoom to")}catch(PERR){g.reportError(PERR)}var oldItem=g.focusedItem;if(!oldItem||oldItem.id!==item.id){Sel.reset();var pane=g.focusedPane;pane.setItem(item,!0),g.focusedItem=item,forLoad||self.paneManager.updatePaneStateForPane(g.focusedPane)}},self.onHotkeyButtonClick=function onHotkeyButtonClickFn(e){self.showHelp(HelpMode.Hotkeys),g.sendEvent("Menu","HelpHotkeys"),e.preventDefault(),e.stopPropagation()};var fullscreenClickHandled=!1,_handleDown=function(e){(g.findParentID(e.target,"container")||g.findParentID(e.target,"desktopMenu"))&&self.cancelFullscreenClick(),g.findParentID(e.target,"desktopMenu")&&e.stopPropagation()};self.handleFullscreenClick=function handleFullscreenClickFn(){fullscreenClickHandled||(document.addEventListener(platform.downEvent,_handleDown,!0),document.addEventListener(platform.touchStartEvent,_handleDown,!0),fullscreenClickHandled=!0)},self.cancelFullscreenClick=function cancelFullscreenClickFn(){fullscreenClickHandled&&(document.removeEventListener(platform.downEvent,_handleDown,!0),document.removeEventListener(platform.touchStartEvent,_handleDown,!0),fullscreenClickHandled=!1,g.menus.closeAllMenus())},self.isFullscreenClickHandled=function isFullscreenClickHandledFn(){return fullscreenClickHandled},self.applyFnToSelection=function applyFnToSelectionFn(fn,params){var toggle=params&&params.toggle,value=params&&void 0!==params.value?params.value:!0;if(self.applyToSelection(function(item){toggle&&item[fn]()!==value&&(toggle=!1),toggle||item[fn](value)}),toggle){var emptyValue=emptyValue=params&&void 0!==params.emptyValue?params.emptyValue:!1;self.applyToSelection(function(item){item[fn](emptyValue)})}},self.applyPriorityToSelection=function applyPriorityToSelectionFn(pri,toggle){toggle?self.applyFnToSelection("priority",{toggle:!0,value:pri,emptyValue:VMLIFlag.None}):self.applyFnToSelection("priority",{value:pri})},self.insertCharacter=function insertCharacterFn(character,withSpace){var text;if(android.isEnabled()){text=android.getInputText();var prevChar=text[android.getSelectionStart()-1];withSpace&&" "!==prevChar&&0!==android.getSelectionStart()?android.insertText(android.getSelectionStart()," "+character):android.insertText(android.getSelectionStart(),character)}else if(Sel.isValid()){text=Sel.getStartItem().getRawText();var prevChar=text[Sel.getStartOffset()-1];withSpace&&" "!==prevChar&&0!==Sel.getStartOffset()&&g.fireKeyEvent(void 0,{normCode:KeyCode.Space}),g.fireKeyEvent(void 0,{normCode:character.charCodeAt(0)})}},self.applyToSelection=function applyToSelectionFn(action,options){try{g.PAssert(3609,!options||!options.restoreSelection,"restoreSelection is no longer a valid option")}catch(PERR){g.reportError(PERR)}var passExtraInfo=options&&options.passExtraInfo;tracker.beginAction();var items=Sel.getSelectedItems();options&&options.resetSelection&&Sel.reset(),self.beginUpdateItems();for(var i=0;i<items.length;++i){var actionRetVal=passExtraInfo?action(items[i],i,items.length):action(items[i]);if(actionRetVal===!1)break}return self.commitUpdateItems(),tracker.endAction(),items.length};var prevMove,prevHovered;self.updateCursorFromEvent=function updateCursorFromEventFn(e){if(prevMove){var hovered=prevMove.target,pane=g.getPaneForElement(hovered);pane&&(target=g.elementFromPoint(prevMove.clientX,prevMove.clientY,prevMove.target),target&&(item=g.dataFor(target,!0),self.updateCursor(e,pane,target,item)))}},self.getCursorForClass=function getCursorForClassFn(target,e,isOutline){for(var clsArr=target.classList,i=0;i<clsArr.length;i++){var cls=clsArr[i];switch(cls){case"tag":case"contact":case"itemCheckbox":return"pointer";case"a":case"date":return platform.mac&&e.metaKey||!platform.mac&&e.ctrlKey?"pointer":null;case"collapser":case"plugin":return isOutline?"pointer":DragDrop.startDragItem?platform.isFirefox?"-moz-grabbing":"-webkit-grabbing":platform.isFirefox?"-moz-grab":"-webkit-grab"}}return isOutline?"pointer":void 0},self.updateCursor=function updateCursorFn(e,pane,element,item){if(pane&&element&&item){var pluginParent=g.findParentInItem(element,"plugin");pluginParent&&(element=pluginParent);var cursor=void 0,isOutline=!!g.findParent(element,"paneOutlineScroller"),cursor=self.getCursorForClass(element,e,isOutline);isOutline?pane.outline.cursor.set(cursor):pane.cursor.set(cursor);var newHovered;cursor&&(newHovered=element),newHovered!==prevHovered&&(prevHovered&&g.removeClass(prevHovered,"hovered"),newHovered&&g.addClass(newHovered,"hovered"),prevHovered=newHovered)}},platform.touch||(self.mousemove=function mousemove(e){if(self.lastActivity=Date.now(),!(g.disableMouseMove||prevMove&&e.clientX===prevMove.clientX&&e.clientY===prevMove.clientY)){var itemHovered;if(g.findParent(e.target,"paneRoot")||g.findParent(e.target,"paneOutlineScroller")){platform.normalizeMouse(e);var hovered=e.target,pane=g.getPaneForElement(hovered);if(pane){var target=g.elementFromPoint(e.clientX,e.clientY,e.target),itemHovered=g.dataFor(target,!0);g.isVMLI(itemHovered)||(itemHovered=void 0),self.updateCursor(e,pane,target,itemHovered)}}Sel.setHovered(pane,itemHovered),prevMove&&prevMove.target===e.target||(prevMove&&prevMove.target&&Dispatcher.fireEvent("mouseout",[{target:prevMove.target}]),e.target&&Dispatcher.fireEvent("mouseover",[{target:e.target}])),prevMove={clientX:e.clientX,clientY:e.clientY,target:e.target}}},g.element("outerWrapper").addEventListener("mousemove",self.mousemove)),self.onTapDocuments=function onTapDocumentsFn(e){g.sendEvent("Menu","buttonDocuments"),g.menus.openDocumentsMenu(),tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenDocumentsMenu,data:[{value:!0}]})},self.isPremiumEnabled=function isPremiumEnabledFn(){return g.billingManager.isPremiumEnabled()},self.onTapHeart=function onTapHeartFn(e){g.sendEvent("Menu","buttonAddPane"),g.menus.openHeartMenu()},self.onTapAddPane=function onTapAddPaneFn(e){g.sendEvent("Menu","buttonAddPane"),g.menus.openAddPaneMenu()},self.onTapOptionsMenu=function onTapOptionsMenuFn(e){g.sendEvent("Menu","buttonOptionsMenu"),g.menus.openOptionsMenu()},self.showSearchSeparator=function showSearchSeparatorFn(){return!platform.mobile||g.phoneMenu.showSearchSeparator()},self.onTapSettingsPhone={onStart:function onStartFn(e){g.ScreenManager.checkSwipeStart(e)},onMove:function onMoveFn(e){g.ScreenManager.checkSwipeMove(e)},onEnd:function onEndFn(e){g.ScreenManager.checkSwipeEnd(e)}},self.onTapCloseFeedback=function onTapCloseFeedbackFn(e){self.showFeedback(!1),e.preventDefault()},self.help=new VMIntro,self.showHelp=function showHelpFn(helpState){self.help.initState(helpState||HelpMode.Intro),self.helpButtonHidden(helpState===HelpMode.Intro)};var activityTimeout=0,updateTimeout=0;if(self.isDemoMode()||setupPageVisibility(),self.paneManager.onResize(),g.shouldWriteLocal()){var setting="version"+(platform.mobile?"Mobile":"Desktop"),prevVersion=+util.storage.getItem(setting),ver=platform[setting];if(!g.isFirstRun&&!g.isDemoMode()&&(!prevVersion||ver>prevVersion))for(var messages=platform.getUpdateMessages(prevVersion),i=0;i<messages.length;++i)g.messageQueue.pushMessage({text:messages[i],hold:!0,action:MessageAction.Blog});util.storage.setItem(setting,ver)}return self._updateAllItems=function _updateAllItemsFn(){var forceNotify=self._forceNotify;self._forceNotify=!1,(self._itemsDirty||forceNotify)&&(self._itemsDirty=!1,self.paneManager.runForEachPane(function(pane){pane.updateItems(!1,forceNotify)}))},self._numFlushesInCommit=0,self._isWaitingUpdateItems=0,self._itemsDirty=!1,self._forceNotify=!1,self._itemsUpdateWatchdog=void 0,self._lastUpdateItemsStack=void 0,self.isUpdatingItems=function isUpdatingItemsFn(){return self._isWaitingUpdateItems>0&&self._itemsDirty},self.beginUpdateItems=function beginUpdateItemsFn(){self._isWaitingUpdateItems++,1===self._isWaitingUpdateItems&&(this._lastUpdateItemsStack=g.getCurrentStack("Update Items Stack"),self._itemsUpdateWatchdog=setTimeout(updateWatchdog,0))},self.commitUpdateItems=function commitUpdateItemsFn(){try{g.PAssert(3611,self._isWaitingUpdateItems>0,"Missing a call to beginUpdateItems: ",self._isWaitingUpdateItems)}catch(PERR){g.reportError(PERR)}self._isWaitingUpdateItems--,0===self._isWaitingUpdateItems&&(clearTimeout(self._itemsUpdateWatchdog),self._itemsUpdateWatchdog=void 0,this._lastUpdateItemsStack=void 0,self._numFlushesInCommit=0),self._itemsDirty&&self.updateAllItems()},self.flushItemsUpdate=function flushItemsUpdateFn(){self.isUpdatingItems()&&(self._numFlushesInCommit++,self._updateAllItems())},self.updateAllItems=function updateAllItemsFn(forceNotify){self._itemsDirty=!0,forceNotify&&(self._forceNotify=forceNotify),0===self._isWaitingUpdateItems&&self._updateAllItems()},Dispatcher.listen("itemStateChanged",self.updateAllItems),Dispatcher.listen("itemCollapsedChanged",self.updateAllItems),self.init(),self};return util.defineBase(VMMain),VMMain}),define("ModalReportBug",["ko","globals","util","platform","ModalBase"],function(ko,g,util,platform,ModalBase){function ModalReportBug(){this._super.constructor.call(this,Modals.ReportBug),this.bugDescription=ko.observable(""),this.init()}var ModalReportBugFns={init:function initFn(){this.registerModal(this.onModalOpen.bind(this))},onModalOpen:function onModalOpenFn(){platform.mobile||setTimeout(function(){document.getElementById("bugDescription").focus()})},onTapCancelBug:function onTapCancelBugFn(){g.menus.closeModal(this.id),g.blurActiveElement(),platform.mobile&&g.vmMain.clearSelected()},onTapSaveBug:function onTapSaveBugFn(){var desc=this.bugDescription()||g.element("bugDescription").value;if(desc&&desc.length>2){var name="Moo.do Feedback";g.sendFeedback(name,desc,function(){this.bugDescription("")}.bind(this)),g.menus.closeModal(Modals.ReportBug),g.messageQueue.pushMessage({text:"Thanks for taking the time to send us feedback!"}),g.sendEvent("Menu","SendFeedback"),g.blurActiveElement(),platform.mobile&&g.vmMain.clearSelected()}},onTapSocialTwitter:function onTapSocialTwitterFn(e){g.openUrl("https://www.twitter.com/MooDoApp",e),g.sendEvent("Menu","FeedbackTwitter")},onTapSocialFacebook:function onTapSocialFacebookFn(e){g.openUrl("https://www.facebook.com/MooDoApp",e),g.sendEvent("Menu","FeedbackFacebook")},onTapSocialGoogle:function onTapSocialGoogleFn(e){g.openUrl("https://www.google.com/+MooDoApp",e),g.sendEvent("Menu","FeedbackGoogle")},onTapSocialUserVoice:function onTapSocialUserVoiceFn(e){g.openUrl("https://feedback.moo.do/",e),g.sendEvent("Menu","FeedbackUserVoice")}};return util.inherit(ModalBase,ModalReportBug),util.extend(ModalReportBug.prototype,ModalReportBugFns),ModalReportBug}),define("dimport",["globals","platform","data","tracker","VMLI","parse","goog","International"],function(g,platform,d,tracker,VMLI,parser,goog,International){function dimport(){this.workflowy={login:this.workflowyLogin.bind(this),"import":this.workflowyImport.bind(this),save:this.workflowySave.bind(this)},this.wunderlist={login:this.wunderlistLogin.bind(this),"import":this.wunderlistImport.bind(this),save:this.wunderlistSave.bind(this)},this.opml={login:this.opmlLogin.bind(this),"import":this.opmlImport.bind(this),save:this.opmlSave.bind(this)},this.json={login:this.jsonLogin.bind(this),"import":this.jsonImport.bind(this),save:this.jsonSave.bind(this)},this.text={login:this.textLogin.bind(this),"import":this.textImport.bind(this),save:this.textSave.bind(this)},this.gtasks={login:this.gtasksLogin.bind(this),"import":this.gtasksImport.bind(this),save:this.gtasksSave.bind(this)},this.trello={preload:this.trelloPreload.bind(this),login:this.trelloLogin.bind(this),"import":this.trelloImport.bind(this),save:this.trelloSave.bind(this)},this.toodledo={login:this.toodledoLogin.bind(this),"import":this.toodledoImport.bind(this),save:this.toodledoSave.bind(this)},this.todoist={login:this.todoistLogin.bind(this),"import":this.todoistImport.bind(this),save:this.todoistSave.bind(this)}}return dimport.prototype={workflowyLogin:function workflowyLoginFn(username,password,cb,error){try{g.PAssert(3612,cb,"Workflowy requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3613,error,"Workflowy requires an error callback")}catch(PERR){g.reportError(PERR)}return username?password?void g.XHR_PrivateAPI({type:"POST",path:"/oauth/workflowy",data:{username:username,password:password},cb:function cbFn(xhr){if(200===xhr.status){try{var dataHolder=JSON.parse(xhr.response);this.workflowy.data=JSON.parse(dataHolder.data)}catch(err){return g.reportError(err),error("Error parsing response from server. The developers have been notified with details of the error.")}return!this.workflowy.data||this.workflowy.data.error?error("Invalid username or password."):cb()}var errorMsg;try{var parsedResponse=JSON.parse(xhr.response);switch(parsedResponse.code){case PrivateAPIErrorCodes.InvalidParameter:errorMsg="Must specify a username and password.";break;case PrivateAPIErrorCodes.UnauthorizedUser:errorMsg="Invalid username or password.";break;default:errorMsg="Error contacting server. The developers have been notified with details of the error."}}catch(err){errorMsg="Error parsing response from server. The developers have been notified with details of the error.",g.reportError(err)}return error(errorMsg)}.bind(this)}):error("Must provide a password."):error("Must provide a valid username.")},workflowyImport:function workflowyImportFn(cb,error){try{g.PAssert(3614,cb,"Workflowy requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3615,error,"Workflowy requires an error callback")}catch(PERR){g.reportError(PERR)}return cb(this.workflowy.data)},workflowyIterateItem:function workflowyIterateItemFn(item,parentVMLI){var IS_COMPLETE_VALUE=673732;try{g.PAssert(3616,item&&void 0!==item.lm&&void 0!==item.nm,"All items must exist and have stars and text, children and notes are optional",item)}catch(PERR){g.reportError(PERR)}try{g.PAssert(3618,parentVMLI,"A valid parent must always be defined")}catch(PERR){g.reportError(PERR)}if(item&&parentVMLI)try{var isComplete=item.lm===IS_COMPLETE_VALUE;if(!isComplete){var itemVMLI=d.createVMLI({text:item.nm,isComplete:isComplete},{parent:parentVMLI,changeType:ChangeType.AllLocal});if(parentVMLI.insertItem(itemVMLI),item.no){var noteVMLI=d.createVMLI({text:item.no},{parent:itemVMLI,changeType:ChangeType.AllLocal});itemVMLI.insertItem(noteVMLI)}if(item.ch)for(var i=0;i<item.ch.length;++i){var entry=item.ch[i];this.workflowyIterateItem(entry,itemVMLI)}}}catch(err){throw g.reportError(err),err}},workflowySave:function workflowySaveFn(data,cb,error){try{g.PAssert(3619,data,"Workflowy requires having valid data")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3620,cb,"Workflowy requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3621,error,"Workflowy requires an error callback")}catch(PERR){g.reportError(PERR)}try{try{g.PAssert(3622,data.projectTreeData,"Missing Workflowy projectTreeData")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3623,data.projectTreeData.mainProjectTreeInfo,"Missing Workflowy mainProjectTreeInfo")}catch(PERR){g.reportError(PERR)}var project=data.projectTreeData.mainProjectTreeInfo;try{g.PAssert(3624,project.rootProjectChildren,"Missing Workflowy rootProjectChildren")}catch(PERR){g.reportError(PERR)}tracker.beginAction();var docRoot=d.getRootModel();try{g.PAssert(3625,docRoot,"Root item must exist in order to import")}catch(PERR){g.reportError(PERR)}var impRoot=d.createVMLI({text:"Workflowy Import"},{parent:docRoot,changeType:ChangeType.AllLocal});docRoot.insertItem(impRoot);for(var i=0;i<project.rootProjectChildren.length;++i){var entry=project.rootProjectChildren[i];this.workflowyIterateItem(entry,impRoot)}return g.vmMain.parseSubtree(impRoot,ChangeType.Local|ChangeType.All),tracker.endAction(),cb()}catch(err){return error("There was an error parsing your Workflowy data. The developers have been notified with details of the error.",err)}},wunderlistLogin:function wunderlistLoginFn(username,password,cb,error){try{g.PAssert(3626,cb,"Wunderlist requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3627,error,"Wunderlist requires an error callback")}catch(PERR){g.reportError(PERR)}var clientID="localhost"===window.location.hostname?"f06a1334e250a9bb0b03":"ad988eeb954e9aabc288",redirectURL=window.location.protocol+"//"+window.location.host+"/oauthRelay.html";this.wunderlist.clientId=clientID;var state="Dchs"+(new Date).getTime(),url="https://www.wunderlist.com/oauth/authorize?client_id="+clientID+"&redirect_uri="+redirectURL+"&state="+state;window.open(url,"wunderlist","height=600,width=550");var handleRelayMessage=function(e){var validOrigin=g.getLocationOrigin(),validState=!1;try{validState=e.data.state===state}catch(err){g.reportError(err)}if(validOrigin&&validState)if(window.removeEventListener("message",handleRelayMessage),e.data.error)error("Error authenticating with Wunderlist");else{var code=e.data.code;code&&g.XHR_PrivateAPI({type:"POST",path:"/oauth/wunderlist",data:{code:code},requireAuth:!0,cb:function cbFn(xhr){if(200===xhr.status){try{var data=JSON.parse(xhr.response).data;this.wunderlist.token=data.access_token}catch(err){error("Error parsing response from remote server.",err)}this.wunderlist.token?cb():error("Invalid username or password.")}else error("Error contacting remote server.")}.bind(this)})}}.bind(this);window.addEventListener("message",handleRelayMessage)},wunderlistImport:function wunderlistImportFn(cb,error){try{g.PAssert(3628,cb,"Wunderlist requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3629,error,"Wunderlist requires an error callback")}catch(PERR){g.reportError(PERR)}var data={inbox:{title:"inbox",items:{},p:0}},listsCompleted=0;this.wunderlistGetLists(function(lists){for(var i=0;i<lists.length;++i){var list=lists[i];data[list.id]={title:list.title,items:{},p:list.position},this.wunderlistGetTasks(list.id,function(tasks){for(var j=0;j<tasks.length;++j){var task=tasks[j];if(task.parent_id){var taskParent=data[task.list_id].items[task.parent_id];taskParent?(taskParent.items||(taskParent.items=[]),taskParent.items.push(task)):data[task.list_id].items[task.parent_id]={items:[task]}}else{var prevData=data[task.list_id].items[task.id];data[task.list_id].items[task.id]=task,prevData&&(data[task.list_id].items[task.id].items=prevData.items)}}this.wunderlistGetSubtasks(list.id,function(subtasks){for(var j=0;j<subtasks.length;++j){var task=subtasks[j];if(task.parent_id){var taskParent=data[task.list_id].items[task.parent_id];taskParent?(taskParent.items||(taskParent.items=[]),taskParent.items.push(task)):data[task.list_id].items[task.parent_id]={items:[task]}}else{var prevData=data[task.list_id].items[task.id];data[task.list_id].items[task.id]=task,prevData&&(data[task.list_id].items[task.id].items=prevData.items)}}++listsCompleted===lists.length&&cb(data)}.bind(this),error)}.bind(this),error)}}.bind(this),error)},wunderlistGetLists:function wunderlistGetListsFn(cb,error){try{g.PAssert(3630,cb,"Wunderlist requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3631,error,"Wunderlist requires an error callback")}catch(PERR){g.reportError(PERR)}g.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/lists",headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId},cb:function cbFn(xhr){if(200===xhr.status){var data;try{data=JSON.parse(xhr.response)}catch(err){error("There was an error parsing your Wunderlist data. The developers have been notified with details of the error.",err)}cb(data)}else error("Error contacting remote server.")}.bind(this)})},wunderlistGetTasks:function wunderlistGetTasksFn(listId,cb,error){try{g.PAssert(3632,cb,"Wunderlist requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3633,error,"Wunderlist requires an error callback")}catch(PERR){g.reportError(PERR)}g.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/tasks?list_id="+listId,headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId},cb:function cbFn(xhr){if(200===xhr.status){var data=JSON.parse(xhr.response);cb(data)}else error("Error contacting remote server.")}.bind(this)})},wunderlistGetSubtasks:function wunderlistGetSubtasksFn(listId,cb,error){try{g.PAssert(3634,cb,"Wunderlist requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3635,error,"Wunderlist requires an error callback")}catch(PERR){g.reportError(PERR)}g.XHR({type:"GET",url:"https://a.wunderlist.com/api/v1/subtasks?list_id="+listId,headers:{"X-Access-Token":this.wunderlist.token,"X-Client-ID":this.wunderlist.clientId},cb:function cbFn(xhr){if(200===xhr.status){var data=JSON.parse(xhr.response);cb(data)}else error("Error contacting remote server.")}.bind(this)})},wunderlistSave:function wunderlistSaveFn(data,cb,error){try{g.PAssert(3636,cb,"Wunderlist requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3637,error,"Wunderlist requires an error callback")}catch(PERR){g.reportError(PERR)}try{tracker.beginAction();var docRoot=d.getRootModel();try{g.PAssert(3638,docRoot,"Root item must exist in order to import")}catch(PERR){g.reportError(PERR)}var impRoot=d.createVMLI({text:"Wunderlist Import"},{parent:docRoot,changeType:ChangeType.AllLocal});docRoot.insertItem(impRoot);for(var listId in data){var list=data[listId],listText=list.title,listVMLI=d.createVMLI({text:listText},{parent:impRoot,changeType:ChangeType.AllLocal});impRoot.insertItem(listVMLI);for(var taskId in list.items){var task=list.items[taskId],taskVMLI=d.createVMLI({text:task.title,isComplete:!!task.completed_at,dateCompleted:task.completed_at,isStarred:task.starred},{parent:listVMLI,changeType:ChangeType.AllLocal});if(listVMLI.insertItem(taskVMLI),task.note){var noteVMLI=d.createVMLI({text:task.note},{parent:taskVMLI,changeType:ChangeType.AllLocal});taskVMLI.insertItem(noteVMLI)}if(task.items)for(var j=0;j<task.items.length;++j){var subtask=task.items[j],subtaskVMLI=d.createVMLI({text:subtask.title,isComplete:!!subtask.completed_at,dateCompleted:subtask.completed_at,isStarred:subtask.starred},{parent:taskVMLI,changeType:ChangeType.AllLocal});taskVMLI.insertItem(subtaskVMLI)}}}g.vmMain.parseSubtree(impRoot,ChangeType.Local|ChangeType.All),tracker.endAction(),cb()}catch(err){error(void 0,err)}},opmlLogin:function opmlLoginFn(user,pw,cb,error){try{g.PAssert(3639,cb,"OPML requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3640,error,"OPML requires an error callback")}catch(PERR){g.reportError(PERR)}var input=document.getElementById("importFileUploadButton");input.onchange=cb,input.click()},opmlImport:function opmlImportFn(cb,error){try{g.PAssert(3641,cb,"OPML requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3642,error,"OPML requires an error callback")}catch(PERR){g.reportError(PERR)}try{var fReader=new FileReader,fileImport=document.forms.importFileUpload.importFile.files[0];fileImport?(fReader.onload=function(e){var data=e.target.result,xml;if((data.startsWith("<?xml ")||data.startsWith("<opml "))&&(xml=g.loadXML(data)),xml){var res=parser.parseOPML(xml,fileImport.name);res?cb():error("Error parsing OPML. Please validate your data.")}else error("Unable to load XML lib. Please update or try another browser.")},fReader.onerror=error,fReader.readAsText(fileImport)):error("You must select a file before importing.")}catch(err){error(void 0,err)}},opmlSave:function opmlSaveFn(data,cb,error){try{g.PAssert(3643,cb,"OPML requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3644,error,"OPML requires an error callback")}catch(PERR){g.reportError(PERR)}cb()},jsonLogin:function jsonLoginFn(user,pw,cb,error){try{g.PAssert(3645,cb,"JSON requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3646,error,"JSON requires an error callback")}catch(PERR){g.reportError(PERR)}var input=document.getElementById("importFileUploadButton");input.onchange=cb,input.click()},jsonImport:function jsonImportFn(cb,error){try{var fReader=new FileReader,fileImport=document.forms.importFileUpload.importFile.files[0];fileImport?(fReader.onload=function(e){var data=e.target.result;if(data)try{var parsedObj=JSON.parse(data),res=parser.parseJSON(parsedObj);res?cb():error("Invalid JSON format. The developers have been notified with details of the error.")}catch(errParse){error("The JSON file has errors. THe developers have been notified with details of the error.",errParse)}else error("Unable to import your requested file. Please try a different file.")},fReader.onerror=error,fReader.readAsText(fileImport)):error("You must select a file before importing.")}catch(err){error(void 0,err)}},jsonSave:function jsonSaveFn(data,cb,error){try{g.PAssert(3647,cb,"OPML requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3648,error,"OPML requires an error callback")}catch(PERR){g.reportError(PERR)}cb()},textLogin:function textLoginFn(user,pw,cb,error){try{g.PAssert(3649,cb,"OPML requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3650,error,"OPML requires an error callback")}catch(PERR){g.reportError(PERR)}cb()},textImport:function textImportFn(cb,error){var data=document.getElementById("importFileDataBox").textContent,xml;if(data.startsWith("<?xml ")||data.startsWith("<opml "))try{if(xml=g.loadXML(data)){var res=parser.parseOPML(xml,"Import Data");if(res)return void cb()}}catch(errParse){}if(data.startsWith("{")&&data.endsWith("}"))try{var parsedObj=JSON.parse(data),res=parser.parseJSON(parsedObj);if(res)return void cb()}catch(errParse){}error("Text Import Not Supported")},textSave:function textSaveFn(data,cb,error){try{g.PAssert(3651,cb,"OPML requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3652,error,"OPML requires an error callback")}catch(PERR){g.reportError(PERR)}cb()},gtasksLogin:function gtasksLoginFn(username,password,cb,error){try{g.PAssert(3653,cb,"GTasks requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3654,error,"GTasks requires an error callback")}catch(PERR){g.reportError(PERR)}goog.runAuthenticate([GScope.TasksRO],!1,!1,function(token){token&&!token.error?(this.gtasks.token=token,cb(token)):error("Unable to authenticate with Google. Please try again.",token)}.bind(this))},gtasksImport:function gtasksImportFn(cb,error){try{g.PAssert(3655,cb,"GTasks requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3656,error,"GTasks requires an error callback")}catch(PERR){g.reportError(PERR)
}var info={roots:[],remoteItems:{},unassigned:[]};this.gtasksGetLists(function(listData){try{g.PAssert(3657,g.isArray(listData),"List data must be an array")}catch(PERR){g.reportError(PERR)}for(var numLists=listData.length,listsCreated=0,i=0;i<listData.length;++i){var list=listData[i];info.remoteItems[list.id]={id:list.id,text:list.title,isComplete:!1,dateCompleted:void 0,isArchived:!1,due:void 0,notes:void 0,parent:void 0,items:[]},info.roots.push(list.id),this.gtasksGetTasks(list,function(taskData,activeList){if(taskData){try{g.PAssert(3658,g.isArray(taskData),"List data must be an array")}catch(PERR){g.reportError(PERR)}if(g.isArray(taskData)){for(var j=0;j<taskData.length;++j){var task=taskData[j];if(task&&"completed"!==task.status){info.remoteItems[task.id]={id:task.id,text:task.title,isComplete:"completed"===task.status,dateCompleted:task.completed?new Date(task.completed):void 0,isArchived:task.hidden,due:task.due?new Date(task.due):void 0,notes:task.notes,parent:task.parent||activeList.id,items:[]};var parent=info.remoteItems[task.parent||activeList.id];parent?parent.items.push(task.id):info.unassigned.push(task.id)}}listsCreated++,listsCreated===numLists&&cb(info)}else error("Invalid task list returned.")}else listsCreated++}.bind(this),error)}}.bind(this),error)},gtasksGetLists:function gtasksGetListsFn(cb,error){try{g.PAssert(3659,cb,"GTasks requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3660,error,"GTasks requires an error callback")}catch(PERR){g.reportError(PERR)}var maxResults=2e3;g.XHR({type:"GET",url:"https://www.googleapis.com/tasks/v1/users/@me/lists?maxResults="+maxResults+"&key="+window.gapiKey+"&access_token="+goog.getAccessToken(!0),cb:function cbFn(xhr){if(200===xhr.status)try{var data=JSON.parse(xhr.response);try{g.PAssert(3661,data&&data.items,"Must have a valid set of data to get tasks from")}catch(PERR){g.reportError(PERR)}data&&data.items?cb(data.items):error("Error getting data from remote server.")}catch(err){error(err)}else error("Error contacting remote server.")}.bind(this)})},gtasksGetTasks:function gtasksGetTasksFn(list,cb,error){try{g.PAssert(3662,list,"GTasks requires a valid list to get tasks from")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3663,cb,"GTasks requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3664,error,"GTasks requires an error callback")}catch(PERR){g.reportError(PERR)}var maxResults=2500;g.XHR({type:"GET",url:"https://www.googleapis.com/tasks/v1/lists/"+list.id+"/tasks?maxResults="+maxResults+"&key="+window.gapiKey+"&access_token="+goog.getAccessToken(!0),cb:function cbFn(xhr){if(200===xhr.status)try{var data=JSON.parse(xhr.response);try{g.PAssert(3665,data,"Must have a valid array of tasks")}catch(PERR){g.reportError(PERR)}data&&data.items?cb(data.items,list):cb([],list)}catch(err){error(err)}else error("Error contacting remote server.")}.bind(this)})},gtasksSave:function gtasksSaveFn(data,cb,error){function traverse(node,parentVMLI){var itemText=node.text;node.due&&(itemText+=" @"+node.due.toString(International.getFormat(DFormat.MonthDay)));var itemVMLI=d.createVMLI({text:itemText,isComplete:node.isComplete,dateCompleted:node.dateCompleted?node.dateCompleted.getTime():node.dateCompleted,isArchived:node.isArchived},{parent:parentVMLI,changeType:ChangeType.AllLocal});if(parentVMLI.insertItem(itemVMLI),node.notes){var notesVMLI=d.createVMLI({text:node.notes},{parent:itemVMLI,changeType:ChangeType.AllLocal});itemVMLI.insertItem(notesVMLI)}for(var i=0;i<node.items.length;++i)traverse(data.remoteItems[node.items[i]],itemVMLI)}try{g.PAssert(3666,cb,"GTasks requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3667,error,"GTasks requires an error callback")}catch(PERR){g.reportError(PERR)}try{try{g.PAssert(3668,0===data.unassigned.length,"We should never have unassigned tasks")}catch(PERR){g.reportError(PERR)}tracker.beginAction();var docRoot=d.getRootModel();try{g.PAssert(3669,docRoot,"Root item must exist in order to import")}catch(PERR){g.reportError(PERR)}var impRoot=d.createVMLI({text:"Google Tasks Import"},{parent:docRoot,changeType:ChangeType.AllLocal});docRoot.insertItem(impRoot);for(var i=0;i<data.roots.length;++i)traverse(data.remoteItems[data.roots[i]],impRoot);g.vmMain.parseSubtree(impRoot,ChangeType.Local|ChangeType.All),tracker.endAction(),cb()}catch(err){error(void 0,err)}},trelloPreload:function trelloPreloadFn(cb,error){var appKey="667ecf0c3d3e029c51d205b7173f6c38";this.trello.isLoaded?cb():(this.trello.isLoaded=!1,g.addScript("https://code.jquery.com/jquery-1.7.1.min.js","jqueryScript",function(){g.addScript("https://api.trello.com/1/client.js?key="+appKey,"trelloScript",function(){try{g.PAssert(3670,window.Trello,"The Trello client lib must have been loaded correctly")}catch(PERR){g.reportError(PERR)}window.Trello?(this.trello.isLoaded=!0,cb()):error("Error loading Trello API, please try again.")}.bind(this),error)}.bind(this),error))},trelloLogin:function trelloLoginFn(username,password,cb,error){try{g.PAssert(3671,Trello,"The Trello client lib must have been loaded correctly")}catch(PERR){g.reportError(PERR)}if(platform.appPlatform===AppPlatform.Chrome){var handleRelayMessage=function(e){var validOrigin=g.getLocationOrigin();validOrigin&&(window.removeEventListener("message",handleRelayMessage),e.data.error?error("Error authenticating with Trello."):(Trello.setToken(e.data.token),cb()))};window.addEventListener("message",handleRelayMessage)}Trello.authorize({type:platform.appPlatform===AppPlatform.Chrome?"redirect":"popup",name:"Moo.do",persist:!1,expiration:"1hour",success:cb,error:error})},trelloImport:function trelloImportFn(cb,error){var data=[];try{Trello.get("members/me/boards",function(boards){for(var doneBoards=0,totalLists=0,doneLists=0,totalCards=0,doneCards=0,i=0;i<boards.length;++i){var board=boards[i],boardItem={text:board.name,items:[]};data.push(boardItem),function handleBoard(boardItem){Trello.get("boards/"+board.id+"/lists",function(lists){totalLists+=lists.length;for(var j=0;j<lists.length;++j){var list=lists[j],listItem={text:list.name,items:[]};boardItem.items.push(listItem),function handleList(listItem){Trello.get("lists/"+list.id+"/cards",function(cards){totalCards+=cards.length;for(var k=0;k<cards.length;++k){var card=cards[k],cardItem={text:card.name};if(card.labels&&card.labels.length>0){for(var labelText="",z=0;z<card.labels.length;++z){var label=card.labels[z];labelText+=TagPrefix+(label.name.length>0?label.name:label.color)+" "}cardItem.text=labelText+cardItem.text}if(card.due&&(cardItem.text+=" "+DatePrefix+new Date(card.due).toString(International.getFormat(DFormat.MonthDay))),card.desc&&card.desc.length>0){cardItem.items=[];for(var descEntries=card.desc.split("\n"),z=0;z<descEntries.length;++z){var entry=descEntries[z];entry&&entry.length>0&&cardItem.items.push({text:entry})}}if(card.idChecklists&&card.idChecklists.length>0){cardItem.items||(cardItem.items=[]);for(var z=0;z<card.idChecklists.length;++z){var checklistId=card.idChecklists[z];!function handleChecklist(cardItem){Trello.get("checklists/"+checklistId+"/",function(checklist){doneCards++;for(var checklistItem={text:checklist.name,isCollapsed:!0,items:[]},x=0;x<checklist.checkItems.length;++x){var check=checklist.checkItems[x],isComplete="complete"===check.state;if(!isComplete){var checkItem={text:check.name,isComplete:isComplete};checklistItem.items.push(checkItem)}}cardItem.items.push(checklistItem),doneCards===totalCards&&doneLists===totalLists&&doneBoards===boards.length&&cb(data)},error)}(cardItem)}}else doneCards++;listItem.items.push(cardItem)}doneLists++,doneCards===totalCards&&doneLists===totalLists&&doneBoards===boards.length&&cb(data)},error)}(listItem)}doneBoards++},error)}(boardItem)}},error)}catch(err){error(err)}},trelloSave:function trelloSaveFn(data,cb,error){function traverse(node,parentVMLI){var nodeVMLI=d.createVMLI({text:node.text,isComplete:node.isComplete,isCollapsed:node.isCollapsed},{parent:parentVMLI,changeType:ChangeType.AllLocal});if(parentVMLI.insertItem(nodeVMLI),node.items)for(var i=0;i<node.items.length;++i)traverse(node.items[i],nodeVMLI);return nodeVMLI}try{tracker.beginAction();var docRoot=d.getRootModel();try{g.PAssert(3672,docRoot,"Root item must exist in order to import")}catch(PERR){g.reportError(PERR)}var impRoot=d.createVMLI({text:"Trello Import"},{parent:docRoot,changeType:ChangeType.AllLocal});docRoot.insertItem(impRoot);for(var i=0;i<data.length;++i)traverse(data[i],impRoot);tracker.endAction()}catch(err){return error(err)}cb()},toodledoLogin:function toodledoLoginFn(username,password,cb,error){var clientID="DuchessToodledoClientID",state="Dchs"+(new Date).getTime(),url="https://api.toodledo.com/3/account/authorize.php?response_type=code&client_id="+clientID+"&state="+state+"&scope=basic%20tasks%20notes%20outlines%20lists";window.open(url,"toodledo","height=600,width=550");var handleRelayMessage=function(e){var validOrigin=g.getLocationOrigin();validOrigin&&(window.removeEventListener("message",handleRelayMessage),e.data.error?error(e.data.error):(this.toodledo.token=e.data.access_token,cb()))}.bind(this);window.addEventListener("message",handleRelayMessage)},toodledoImport:function toodledoImportFn(cb,error){},toodledoSave:function toodledoSaveFn(data,cb,error){},todoistLogin:function todoistLoginFn(username,password,cb,error){try{g.PAssert(3673,cb,"Todoist requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3674,error,"Todoist requires an error callback")}catch(PERR){g.reportError(PERR)}username||(username=goog.getCurrentUserEmail()),g.XHR_PrivateAPI({type:"POST",path:"/oauth/todoist",data:{username:username,password:password},requireAuth:!password,cb:function cbFn(xhr){if(200===xhr.status){try{this.todoist.data=JSON.parse(xhr.response).data}catch(err){error("Error parsing response from remote server."),g.reportError(err)}!this.todoist.data||this.todoist.data.error?error("Invalid username or password."):cb()}else{var errorMsg;try{var parsedResponse=JSON.parse(xhr.response);switch(parsedResponse.code){case PrivateAPIErrorCodes.InvalidParameter:errorMsg="Must specify a username and password.";break;case PrivateAPIErrorCodes.UnauthorizedUser:errorMsg="Invalid username or password.";break;default:errorMsg="Error contacting server. Please contact support."}}catch(err){g.reportError(err),errorMsg="Error parsing response from server. Please contact support."}error(errorMsg)}}.bind(this)})},todoistImport:function todoistImportFn(cb,error){try{g.PAssert(3675,cb,"Todoist requires a success callback")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3676,error,"Todoist requires an error callback")}catch(PERR){g.reportError(PERR)}cb(this.todoist.data)},todoistSave:function todoistSaveFn(data,cb,error){function traverse(node,parentVMLI){node.priority&&(node.priority=priorityMap[node.priority]),node.due_date&&(node.text+=" @"+node.due_date.toString(International.getFormat(DFormat.MonthDay)));var nodeVMLI=d.createVMLI({text:node.text,isCollapsed:node.isCollapsed,priority:node.priority},{parent:parentVMLI,changeType:ChangeType.AllLocal});if(parentVMLI.insertItem(nodeVMLI),node.items)for(var i=0;i<node.items.length;++i)traverse(node.items[i],nodeVMLI);return nodeVMLI}var priorityMap=[VMLIFlag.None,VMLIFlag.None,VMLIFlag.P2,VMLIFlag.P1,VMLIFlag.P0];try{tracker.beginAction();var docRoot=d.getRootModel();try{g.PAssert(3677,docRoot,"Root item must exist in order to import")}catch(PERR){g.reportError(PERR)}var impRoot=d.createVMLI({text:"Todoist Import"},{parent:docRoot,changeType:ChangeType.AllLocal});docRoot.insertItem(impRoot);for(var i=0;i<data.length;++i)traverse(data[i],impRoot);tracker.endAction()}catch(err){return error(err)}cb()}},dimport}),define("ModalImportData",["ko","globals","util","platform","ModalBase","dimport"],function(ko,g,util,platform,ModalBase,dimport){function ModalImportData(){this._super.constructor.call(this,Modals.ImportData),this.importName=ko.observable("JSON"),this.importDisplayMessage=ko.observable(""),this.importing=ko.observable(!1),this.preloadDisable=ko.observable(!1),this.importer=new dimport,this.init()}var ModalImportDataFns={init:function initFn(){this.registerModal(this.onModalOpen.bind(this))},onModalOpen:function onModalOpenFn(importer){importer&&this.selectImporter(importer),this.importDisplayMessage("")},closeImport:function closeImportFn(){g.menus.closeModal(this.id)},disableImportCancelButton:function disableImportCancelButtonFn(){return this.importing()},disableImportImportButton:function disableImportImportButtonFn(){return this.importing()||this.preloadDisable()>0},isAreaVisible:function isAreaVisibleFn(area){switch(this.importName()){case"Wunderlist":return"OAuthArea"===area;case"Workflowy":return"LoginArea"===area;case"OPML":return"UploadArea"===area;case"JSON":return"UploadArea"===area;case"Text":return"TextArea"===area;case"Google Tasks":return"OAuthArea"===area;case"Trello":return"OAuthArea"===area;case"Todoist":return"LoginArea"===area;case"Toodledo":return"OAuthArea"===area;default:try{g.PAssert(3678,!1,"Must add valid importer")}catch(PERR){g.reportError(PERR)}}return!1},highlightImportButton:function highlightImportButtonFn(el){var btnParent=document.getElementById("importLocations");if(btnParent)for(var i=0;i<btnParent.children.length;++i){var btn=btnParent.children[i];btn!==el?g.removeClass(btn,"mat-selected"):g.addClass(btn,"mat-selected")}},onTapRunImportWunderlist:function onTapRunImportWunderlistFn(){this.selectImporter("Wunderlist")},onTapRunImportWorkflowy:function onTapRunImportWorkflowyFn(){this.selectImporter("Workflowy")},onTapRunImportOPML:function onTapRunImportOPMLFn(){this.selectImporter("OPML")},onTapRunImportJSON:function onTapRunImportJSONFn(){this.selectImporter("JSON")},onTapRunImportText:function onTapRunImportTextFn(){this.selectImporter("Text")},onTapRunImportGTasks:function onTapRunImportGTasksFn(){this.selectImporter("GTasks")},onTapRunImportTrello:function onTapRunImportTrelloFn(){this.selectImporter("Trello")},onTapRunImportTodoist:function onTapRunImportTodoistFn(){this.selectImporter("Todoist"),this.importDisplayMessage("To use your current Google account you don't need to re-enter your email or password. Just click Import.")},onTapRunImportToodledo:function onTapRunImportToodledoFn(){this.selectImporter("Toodledo")},selectImporter:function selectImporterFn(name){this.importName("GTasks"===name?"Google Tasks":name),document.getElementById("importEmail").value="",document.getElementById("importPW").value="",this.importDisplayMessage("");var el=document.getElementById("import"+name);this.highlightImportButton(el);var importFn=this.getImporterFromName(this.importName());importFn&&importFn.preload&&(this.preloadDisable(this.preloadDisable()+1),this.importDisplayMessage("Loading libraries..."),importFn.preload(function(){this.preloadDisable(this.preloadDisable()-1);var currentImporter=this.getImporterFromName(this.importName());0===this.preloadDisable()&&currentImporter&&currentImporter.preload&&this.importDisplayMessage("")}.bind(this),function(err){this.preloadDisable(this.preloadDisable()-1),this.onImportError(err)}.bind(this)))},getImporterFromName:function getImporterFromNameFn(name){var importFn;switch(name){case"Wunderlist":importFn=this.importer.wunderlist;break;case"Workflowy":importFn=this.importer.workflowy;break;case"OPML":importFn=this.importer.opml;break;case"JSON":importFn=this.importer.json;break;case"Text":importFn=this.importer.text;break;case"Google Tasks":importFn=this.importer.gtasks;break;case"Trello":importFn=this.importer.trello;break;case"Todoist":importFn=this.importer.todoist;break;case"Toodledo":importFn=this.importer.toodledo;break;default:try{g.PAssert(3679,!1,"Must add valid importer: ",name)}catch(PERR){g.reportError(PERR)}}return importFn},onImportError:function onImportErrorFn(msg,err){try{g.PAssert(3680,!msg||g.isString(msg),"Invalid message object to display to user")}catch(PERR){g.reportError(PERR)}try{var message=msg;message&&g.isString(message)||(message="Moo.do encountered an error importing your data. The developers have been notified with details of the error."),this.importing(!1),this.importDisplayMessage(message),g.reportError(err||msg,msg)}catch(errErr){g.reportError(errErr),this.importing(!1)}g.sendEvent("ImportFail",this.importName())},onTapRunImport:function onTapRunImportFn(){if(!(this.importing()||this.preloadDisable()>0)){var importFn=this.getImporterFromName(this.importName());if(importFn){g.sendEvent("Menu","Import"+this.importName()),this.importing(!0);try{this.importDisplayMessage("Importing..."),setTimeout(function(){var loginName=document.getElementById("importEmail").value,loginPW=document.getElementById("importPW").value;importFn.login(loginName,loginPW,function(){importFn.import(function(data){importFn.save(data,function(){this.importDisplayMessage("Your data was imported successfully!"),this.importing(!1),setTimeout(function(){g.menus.closeModal(Modals.ImportData)}.bind(this),500),g.sendEvent("ImportSuccess",this.importName())}.bind(this),this.onImportError.bind(this))}.bind(this),this.onImportError.bind(this))}.bind(this),this.onImportError.bind(this))}.bind(this),0)}catch(err){this.onImportError("There was an issue importing your data. Please try again later.",err)}}}},importTitle:function importTitleFn(){var name=this.importName();return"OPML"!==name&&"JSON"!==name&&"Text"!==name?"Import data from "+this.importName():"Upload "+name+" File"},importMessage:function importMessageFn(){return this.importDisplayMessage()}};return util.inherit(ModalBase,ModalImportData),util.extend(ModalImportData.prototype,ModalImportDataFns),ModalImportData});var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(view){var doc=view.document,get_URL=function(){return view.URL||view.webkitURL||view},URL=view.URL||view.webkitURL||view,save_link=doc.createElementNS("http://www.w3.org/1999/xhtml","a"),can_use_save_link="download"in save_link,click=function(node){var event=doc.createEvent("MouseEvents");event.initMouseEvent("click",!0,!1,view,0,0,0,0,0,!1,!1,!1,!1,0,null),node.dispatchEvent(event)},webkit_req_fs=view.webkitRequestFileSystem,req_fs=view.requestFileSystem||webkit_req_fs||view.mozRequestFileSystem,throw_outside=function(ex){(view.setImmediate||view.setTimeout)(function(){throw ex},0)},force_saveable_type="application/octet-stream",fs_min_size=0,deletion_queue=[],process_deletion_queue=function(){for(var i=deletion_queue.length;i--;){var file=deletion_queue[i];"string"==typeof file?URL.revokeObjectURL(file):file.remove()}deletion_queue.length=0},dispatch=function(filesaver,event_types,event){event_types=[].concat(event_types);for(var i=event_types.length;i--;){var listener=filesaver["on"+event_types[i]];if("function"==typeof listener)try{listener.call(filesaver,event||filesaver)}catch(ex){throw_outside(ex)}}},FileSaver=function(blob,name){var filesaver=this,type=blob.type,blob_changed=!1,object_url,target_view,get_object_url=function(){var object_url=get_URL().createObjectURL(blob);return deletion_queue.push(object_url),object_url},dispatch_all=function(){dispatch(filesaver,"writestart progress write writeend".split(" "))},fs_error=function(){(blob_changed||!object_url)&&(object_url=get_object_url(blob)),target_view?target_view.location.href=object_url:window.open(object_url,"_blank"),filesaver.readyState=filesaver.DONE,dispatch_all()},abortable=function(func){return function(){return filesaver.readyState!==filesaver.DONE?func.apply(this,arguments):void 0}},create_if_not_found={create:!0,exclusive:!1},slice;return filesaver.readyState=filesaver.INIT,name||(name="download"),can_use_save_link?(object_url=get_object_url(blob),save_link.href=object_url,save_link.download=name,click(save_link),filesaver.readyState=filesaver.DONE,void dispatch_all()):(view.chrome&&type&&type!==force_saveable_type&&(slice=blob.slice||blob.webkitSlice,blob=slice.call(blob,0,blob.size,force_saveable_type),blob_changed=!0),webkit_req_fs&&"download"!==name&&(name+=".download"),(type===force_saveable_type||webkit_req_fs)&&(target_view=view),req_fs?(fs_min_size+=blob.size,void req_fs(view.TEMPORARY,fs_min_size,abortable(function(fs){fs.root.getDirectory("saved",create_if_not_found,abortable(function(dir){var save=function(){dir.getFile(name,create_if_not_found,abortable(function(file){file.createWriter(abortable(function(writer){writer.onwriteend=function(event){target_view.location.href=file.toURL(),deletion_queue.push(file),filesaver.readyState=filesaver.DONE,dispatch(filesaver,"writeend",event)},writer.onerror=function(){var error=writer.error;error.code!==error.ABORT_ERR&&fs_error()},"writestart progress write abort".split(" ").forEach(function(event){writer["on"+event]=filesaver["on"+event]}),writer.write(blob),filesaver.abort=function(){writer.abort(),filesaver.readyState=filesaver.DONE},filesaver.readyState=filesaver.WRITING}),fs_error)}),fs_error)};dir.getFile(name,{create:!1},abortable(function(file){file.remove(),save()}),abortable(function(ex){ex.code===ex.NOT_FOUND_ERR?save():fs_error()}))}),fs_error)}),fs_error)):void fs_error())},FS_proto=FileSaver.prototype,saveAs=function(blob,name){return new FileSaver(blob,name)};return FS_proto.abort=function(){var filesaver=this;filesaver.readyState=filesaver.DONE,dispatch(filesaver,"abort")},FS_proto.readyState=FS_proto.INIT=0,FS_proto.WRITING=1,FS_proto.DONE=2,FS_proto.error=FS_proto.onwritestart=FS_proto.onprogress=FS_proto.onwrite=FS_proto.onabort=FS_proto.onerror=FS_proto.onwriteend=null,view.addEventListener("unload",process_deletion_queue,!1),saveAs}(self);define("FileSaver",function(){}),define("ModalExportData",["ko","globals","util","platform","data","ModalBase","NativeSel","FileSaver"],function(ko,g,util,platform,d,ModalBase,NativeSel){function ModalExportData(){this._super.constructor.call(this,Modals.ExportData),this.mode=ko.observable("html"),this.exportedContent="",this.exportedPreview=ko.observable(""),this.exportArchived=ko.observable(!0),this.exportArchived.subscribe(this.exportData.bind(this)),this.exportKeyHandler=void 0,this.init()}var ModalExportDataFns={init:function initFn(){this.registerModal(this.onModalOpen.bind(this),this.onModalClose.bind(this))},onModalOpen:function onModalOpenFn(){this.exportData(),this.exportKeyHandler=this.onExportKeydown.bind(this),document.addEventListener("keydown",this.exportKeyHandler,!0)},onModalClose:function onModalCloseFn(){document.removeEventListener("keydown",this.exportKeyHandler,!0),this.exportKeyHandler=void 0},onTapCloseExport:function onTapCloseExportFn(){g.menus.closeModal(this.id)},exportData:function exportDataFn(){var content,preview,root=d.getRootItem();if(g.vmMain.parseSubtreeArchive(g.vmMain.root(),ChangeType.Auto),"html"===this.mode())content=d.toHtml(root,this.exportArchived()),preview=content;else if("plain"===this.mode()){var tab="&nbsp;&nbsp;&nbsp;&nbsp;";content=d.toPlainText(root,0,this.exportArchived()),preview=content.replace(/\n/g,"<br>").replace(/\t/g,tab)}else"json"===this.mode()&&(content=d.toJSON(root,!1,this.exportArchived()),preview=content);this.exportedContent=content,this.exportedPreview(preview)},onTapHTML:function onTapHTMLFn(e){this.mode("html"),this.exportData(),this.highlightExportButton(e)},onTapPlain:function onTapPlainFn(e){this.mode("plain"),this.exportData(),this.highlightExportButton(e)},onTapJSON:function onTapJSONFn(e){this.mode("json"),this.exportData(),this.highlightExportButton(e)},highlightExportButton:function highlightExportButtonFn(e){e.srcElement||(e.srcElement=e.target);var btnParent=document.getElementById("exportTypes");if(btnParent)for(var i=0;i<btnParent.children.length;++i){var btn=btnParent.children[i];g.hasClass(btn,"mat-list-button")&&(btn!==e.srcElement?g.removeClass(btn,"mat-selected"):g.addClass(btn,"mat-selected"))}},onTapOpen:function onTapOpenFn(){var content="plain"===this.mode()?this.exportedPreview():this.exportedContent,newWin=open("url");newWin.document.write(content)},onTapSelect:function onTapSelectFn(){var range=NativeSel.createSelectionRange();range.selectNodeContents(document.getElementById("exportedContent")),NativeSel.setSelectionRange(range)},onTapSaveExport:function onTapSaveExportFn(){var ext;"html"===this.mode()?ext="html":"plain"===this.mode()?ext="txt":"json"===this.mode()&&(ext="json");try{g.saveFile(this.exportedContent,"moodo."+ext)}catch(err){g.reportError(err)}},onExportKeydown:function onExportKeydownFn(e){return platform.normalizeKeys(e),(platform.mac&&e.metaKey||!platform.mac&&e.ctrlKey)&&e.normCode===KeyCode.A?(this.onTapSelect(),e.preventDefault(),e.stopPropagation(),!1):void 0}};return util.inherit(ModalBase,ModalExportData),util.extend(ModalExportData.prototype,ModalExportDataFns),ModalExportData}),define("recovery",["globals"],function(g){function ref(o){return o.value}function val(o){return o.json}function makeConsumableOutput(docID,rev,perItemCB,doneCB){self.getRawRevisionData(docID,rev,function(rawData){return rawData?(self.transformRawRevisionData(rawData,perItemCB),void(doneCB&&doneCB())):log("Unable to get revision data")})}function padText(text,padding,padChar){var outText="";padChar=padChar||" ";for(var i=0;padding>i;++i)outText+=padChar;return outText+=text}var self={};return self.getCurrentRevision=function getCurrentRevisionFn(){var revision;try{revision=window.__remoteDoc.getModel().serverVersion}catch(err){g.reportError(err)}return revision},self.getCurrentDocID=function getCurrentDocIDFn(){var docID;try{docID=g.settings.get(Settings.gdocId)}catch(err){g.reportError(err)}return docID},self.getRawRevisionData=function getRawRevisionDataFn(docID,rev,cb){gapi.client.drive.realtime.get({fileId:docID||self.getCurrentDocID(),revision:rev}).execute(function(obj){return!obj||obj.error?(log("Error getting data from Drive: ",obj.error),cb()):void(cb?cb(obj.result):(console.log("Missing CB function, printing to console."),log(obj.result)))})},self.getDefaultRawRevisionData=function getDefaultRawRevisionDataFn(rev,cb){return self.getRawRevisionData(self.getCurrentDocID(),rev,cb)},self.transformRawRevisionData=function transformRawRevisionDataFn(obj,perItemCB){function traverse(node,level){if(level>=0&&perItemCB(node,level),node.i)for(var children=ref(node.i),i=0;i<children.length;++i){var child=ref(children[i]);traverse(child,level+1)}}var data=ref(obj.data),root=ref(data.root);traverse(root,-1)},self.printRevisionData=function printRevisionDataFn(docID,rev){makeConsumableOutput(docID,rev,function(node,level){console.log(padText(val(node.t),level))})},self.printDefaultRevisionData=function printDefaultRevisionDataFn(rev){return self.printRevisionData(self.getCurrentDocID(),rev)},self.printRevisionOffset=function printRevisionOffsetFn(offset){var rev=self.getCurrentRevision()-offset;return 0>rev?log("Maximum offset is: "+self.getCurrentRevision()):self.printDefaultRevisionData(rev)},self.saveRevisionData=function saveRevisionDataFn(docID,rev,format){var fullText="";makeConsumableOutput(docID,rev,function(node,level){fullText+=padText(val(node.t),level,"	")+"\r\n"},function(){var blob=new Blob([fullText],{type:"text/plain;charset=utf-8"});saveAs(blob,"DataRecovery_"+rev+".txt")})},self.saveDefaultRevisionData=function saveDefaultRevisionDataFn(rev,format){return self.saveRevisionData(self.getCurrentDocID(),rev,format)},self.saveRevisionOffset=function saveRevisionOffsetFn(offset,format){var rev=self.getCurrentRevision()-offset;return 0>rev?log("Maximum offset is: "+self.getCurrentRevision()):self.saveDefaultRevisionData(rev,format)},self.getHelp=function getHelpFn(){return console.log("To recover your data input __MoodoRecovery.saveRevisionOffset(<revision offset>)"),console.log("The maximum <revision offset> for this document is "+this.getCurrentRevision()),console.log("If you just lost data, an offset of 10 is a good place to start"),console.log("You may need to try larger offsets if the returned file does not contain the data you need"),console.log("This is a temporary tool to help recover data, please report any issues or data loss to support@moo.do"),window.__SendInfo("Recover Help Used!"),""},window.__MoodoRecovery={raw:self,help:self.getHelp,getCurrentRevision:self.getCurrentRevision,getCurrentDocID:self.getCurrentDocID,getRawData:self.getDefaultRawRevisionData,printRevision:self.printDefaultRevisionData,saveRevision:self.saveDefaultRevisionData,printRevisionOffset:self.printRevisionOffset,saveRevisionOffset:self.saveRevisionOffset},self}),define("ModalRecoverData",["ko","globals","util","platform","ModalBase","recovery"],function(ko,g,util,platform,ModalBase,recovery){function ModalRecoverData(){this._super.constructor.call(this,Modals.RecoverData),this._requestedRevision=200,this.init()}var ModalRecoverDataFns={init:function initFn(){this.registerModal()},onTapCloseRecovery:function onTapCloseRecoveryFn(){g.menus.closeModal(this.id)},onTapRecoverData:function onTapRecoverDataFn(){recovery.saveDefaultRevisionData(this._requestedRevision)}};return util.inherit(ModalBase,ModalRecoverData),util.extend(ModalRecoverData.prototype,ModalRecoverDataFns),ModalRecoverData}),define("VMDebug",["ko","globals","platform","data","ModalReportBug","ModalImportData","ModalExportData","ModalRecoverData"],function(ko,g,platform,d,ModalReportBug,ModalImportData,ModalExportData,ModalRecoverData){function VMDebug(){this.init()}return VMDebug.prototype={init:function initFn(){new ModalReportBug,new ModalImportData,new ModalExportData,new ModalRecoverData},addPadding:function addPaddingFn(){var padSize=platform.windowHeight()-platform.getKBSize()+g.topBarHeight;platform.android&&(padSize=platform.getKBSize()+20),g.element("feedbackScroller").style.paddingBottom=padSize+"px"},removePadding:function removePaddingFn(){document.getElementById("feedbackScroller").style.paddingBottom=""}},VMDebug}),define("VMTimeline",["ko","globals","platform","Dispatcher"],function(ko,g,platform,Dispatcher){function VMTimeline(){this.notificationItems={},this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0}return window.__FULL_NOTIFICATION_UPDATES=0,window.__SINGLE_NOTIFICATION_UPDATES=0,VMTimeline.prototype={addNotification:function addNotificationFn(item){try{g.PAssert(3681,item,"Must provide a valid item to schedule notifications for")}catch(PERR){g.reportError(PERR)}this.notificationItems[item.id]=item,this.numNotificationItemsChanged++,this.scheduleTimeout||(this.scheduleTimeout=setTimeout(this.pushNotificationsToNative.bind(this),500))},removeNotification:function removeNotificationFn(item){try{g.PAssert(3682,item,"Must provide a valid item to unschedule notifications for")}catch(PERR){g.reportError(PERR)}this.notificationItems[item.id]&&(this.notificationItems[item.id]=void 0,this.numNotificationItemsChanged++,this.scheduleTimeout||(this.scheduleTimeout=setTimeout(this.pushNotificationsToNative.bind(this),500)))},clearNotifications:function clearNotificationsFn(){for(var prop in this.notificationItems)this.notificationItems.hasOwnProperty(prop)&&(this.notificationItems[prop]=void 0,this.numNotificationItemsChanged++);this.scheduleTimeout||(this.scheduleTimeout=setTimeout(this.pushNotificationsToNative.bind(this),500))},shouldNotify:function shouldNotifyFn(item,now){return now||(now=new Date),!item.isComplete()&&!item.allDayDate()&&!item.isArchived()&&(item.date()&&item.date()>now||item.repeatDate())},updateNotifications:function updateNotificationsFn(item){if(platform.supportsNotifications()&&!g.isDemoMode()&&g.vmSettings.enabledNotifications()){var now=new Date;item?(window.__SINGLE_NOTIFICATION_UPDATES++,this.shouldNotify(item,now)?this.addNotification(item):this.removeNotification(item)):(window.__FULL_NOTIFICATION_UPDATES++,this.clearNotifications(),g.searchVMLIs({item:g.vmMain.root(),includeArchived:!1,each:function eachFn(item){this.shouldNotify(item,now)&&this.addNotification(item)}.bind(this)}))}},pushNotificationsToNative:function pushNotificationsToNativeFn(){try{g.PAssert(3683,platform.supportsNotifications(),"Platform must support notifications")
}catch(PERR){g.reportError(PERR)}var notifications=[];for(var prop in this.notificationItems)if(this.notificationItems.hasOwnProperty(prop)){var item=this.notificationItems[prop];if(item&&item.getNotificationEntries){var entries=item.getNotificationEntries();if(entries)if(g.isArray(entries))for(var i=0;i<entries.length;++i)notifications.push(entries[i]);else notifications.push(entries)}else delete this.notificationItems[prop]}g.nativeBridge.isEnabled()?g.nativeBridge.sendToApp("scheduledItems",notifications):g.nativeBridge.hasEmbedBridge()&&g.nativeBridge.sendToEmbed("scheduledItems",notifications),this.numNotificationItemsChanged=0,this.scheduleTimeout=void 0}},VMTimeline}),define("TemplateCache",["ko","globals"],function(ko,g){window.__TOTAL_TEMPLATES=0;var self={},cachedTemplatesDomDataKey="__cached_template__";self.templateSources=function templateSourcesFn(domElem){var templateSources={elem:domElem,__proto__:new ko.templateSources.domElement(domElem)};return templateSources.text=function(value){return 0===arguments.length?templateSources.elem.text:void(templateSources.elem.text=value)},templateSources.nodes=function(value){try{g.PAssert(3684,0===arguments.length)}catch(PERR){g.reportError(PERR)}if(0===arguments.length){var templateData=ko.utils.domData.get(templateSources.elem,cachedTemplatesDomDataKey);if(!templateData){for(var templateText=templateSources.text().replace(/(\r\n|\n|\r|\s*(?=<)|\s*$)/gm,""),parsedNodes=ko.utils.parseHtmlFragment(templateText),compiledNodes=document.createElement("div"),i=0;i<parsedNodes.length;i++)compiledNodes.appendChild(parsedNodes[i]);return ko.utils.domData.set(templateSources.elem,cachedTemplatesDomDataKey,{cachedNodes:compiledNodes}),compiledNodes}return templateData.cachedNodes}},templateSources},self.templateEngine=function templateEngineFn(){var templateEngine={__proto__:new ko.nativeTemplateEngine};return templateEngine.cachedDoc=void 0,templateEngine.makeTemplateSource=function(template,templateDocument){try{g.PAssert(3685,"string"==typeof template)}catch(PERR){g.reportError(PERR)}var incomingDoc=templateDocument||document,cachedDoc=templateEngine.cachedDoc;if(!templateEngine.cachedDoc){try{g.PAssert(3686,incomingDoc)}catch(PERR){g.reportError(PERR)}cachedDoc={doc:incomingDoc,cachedTemplates:{}},templateEngine.cachedDoc=cachedDoc}try{g.PAssert(3687,cachedDoc)}catch(PERR){g.reportError(PERR)}var elem=cachedDoc.cachedTemplates[template];if(!elem){var domElem=cachedDoc.doc.getElementById(template);try{g.PAssert(3688,domElem)}catch(PERR){g.reportError(PERR)}if(domElem)try{elem=new self.templateSources(domElem);try{g.PAssert(3689,elem)}catch(PERR){g.reportError(PERR)}}catch(err){g.reportError(err)}else g.reportError(new Error('Unable to find element for template "'+template+'". '+domElem));cachedDoc.cachedTemplates[template]=elem,window.__TOTAL_TEMPLATES++}return elem},templateEngine};var engine=self.templateEngine();return engine instanceof ko.templateEngine&&ko.setTemplateEngine(engine),self}),define("VMAutocompleteItem",["ko","data","globals"],function(ko,d,g){function VMAutocompleteItem(p){this.id=p.id,this.text=ko.observable(p.text||""),this.index=p.index,this.object=p.object,this.isVisible=ko.observable(!0),this.isSelected=ko.observable(!1),this.element=void 0,this.init()}return VMAutocompleteItem.prototype={init:function initFn(){},html:function htmlFn(){var searchText=g.autocomplete.text(),text=this.text();try{g.PAssert(3690,g.isString(searchText),"Search text must be a string: ",searchText)}catch(PERR){g.reportError(PERR)}try{g.PAssert(3691,g.isString(text),"Item text must be a string: ",text)}catch(PERR){g.reportError(PERR)}if(void 0!==text&&void 0!==searchText&&searchText.length>0){var index=text.toLowerCase().indexOf(searchText.toLowerCase()),newText="";return newText=index>=0?text.substr(0,index)+"<b>"+text.substr(index,searchText.length)+"</b>"+text.substr(index+searchText.length):text}return text},onLoad:function onLoadFn(element){this.element=element}},VMAutocompleteItem}),define("AutocompleteDates",["ko","data","globals","platform"],function(ko,d,g,platform){function AutocompleteDates(){this.soft=["now","soon","later","someday"],this.softDays=["today","tomorrow"],this.dayModifiers=["next"],this.days=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],this.months=["january","february","march","april","may","june","july","august","september","october","november","december"],this.repeatStart=["every"],this.repeatModifier=["first","other","last"],this.dict=this.soft.concat(this.repeatStart).concat(this.softDays).concat(this.repeatModifier).concat(this.dayModifiers).concat(this.days).concat(this.months),this.NextWordOptions={None:0,DayName:1,Days:2,Time:4,Repeat:8},this.nextDateWord=ko.observable(this.NextWordOptions.None),this.init()}return AutocompleteDates.prototype={init:function initFn(){},showAllDates:function showAllDatesFn(){return""===g.autocomplete.text()},showRepeat:function showRepeatFn(){return g.isFlagSet(this.nextDateWord(),this.NextWordOptions.Repeat)},showDate:function showDateFn(){return this.nextDateWord()===this.NextWordOptions.None||g.isFlagSet(this.nextDateWord(),this.NextWordOptions.DayName)},showDays:function showDaysFn(){return g.isFlagSet(this.nextDateWord(),this.NextWordOptions.Days)},showTime:function showTimeFn(){return g.isFlagSet(this.nextDateWord(),this.NextWordOptions.Time)},getShortMonth:function getShortMonthFn(index){return Date.CultureInfo.abbreviatedMonthNames[index]},getLongMonth:function getLongMonthFn(index){return Date.CultureInfo.monthNames[index]},getShortDay:function getShortDayFn(index){return Date.CultureInfo.abbreviatedDayNames[index]},getLongDay:function getLongDayFn(index){return Date.CultureInfo.dayNames[index]},previewTemplate:function previewTemplateFn(){return void 0},getItemText:function getItemTextFn(item){return item},getItemTextLength:function getItemTextLengthFn(item){return item?item.length:0},getItemStyledText:function getItemStyledTextFn(item){return item},findMatchLike:function findMatchLikeFn(like){for(var lower=like.toLowerCase(),results=[],i=0;i<this.dict.length;++i)0===this.dict[i].indexOf(lower)&&results.push(this.dict[i]);return results},findMatchExact:function findMatchExactFn(text){if(this.dict.indexOf(text)>=0){if(!platform.mobile)return text;if(this.nextWordOptions(text)===this.NextWordOptions.None)return text}return void 0},nextWordOptions:function nextWordOptionsFn(text){var words=text.toLowerCase().split(" "),lastWord=words[words.length-1];if(""===lastWord&&(lastWord=words[words.length-2]),this.soft.indexOf(lastWord)>=0)return this.NextWordOptions.None;if(this.repeatStart.indexOf(lastWord)>=0)return this.NextWordOptions.DayName|this.NextWordOptions.Repeat;if(this.repeatModifier.indexOf(lastWord)>=0)return this.NextWordOptions.DayName;if(this.softDays.indexOf(lastWord)>=0)return this.NextWordOptions.Time;if(this.dayModifiers.indexOf(lastWord)>=0)return this.NextWordOptions.DayName;if(this.days.indexOf(lastWord)>=0)return this.NextWordOptions.Time;if(this.months.indexOf(lastWord)>=0)return this.NextWordOptions.Days;var isInt=parseInt(lastWord,10);return isNaN(isInt)?lastWord.indexOf(":")>=0?this.NextWordOptions.Time:this.NextWordOptions.None:this.NextWordOptions.Time},getMonthList:function getMonthListFn(){var monthsInPast=1,monthsInFuture=5,currentIndex=(new Date).getMonth(),startIndex=currentIndex-monthsInPast;0>startIndex&&(startIndex=12+startIndex);for(var endIndex=startIndex+monthsInPast+monthsInFuture,output=[],i=startIndex;endIndex>i;++i){var monthIndex=i%12;output.push(monthIndex)}return output},getDayList:function getDayListFn(){return[0,1,2,3,4,5,6]},getSoftList:function getSoftListFn(){return this.repeatStart.concat(this.soft)},onTapDate:{onStart:g.handlerPreventStop,onClick:function onClickFn(e){var el=e.srcElement;if("SPAN"===el.nodeName){var parentDiv=el.parentNode;if(g.hasClass(parentDiv,"disabled"))return;var text=el.id?el.id+" ":el.textContent,next=this.nextWordOptions(text);this.nextDateWord(next);var hide=next===this.NextWordOptions.None;g.autocomplete.onTapped(text,text.length,hide)}}}},AutocompleteDates}),define("VMNoneManager",["ko","globals"],function(ko,g){function VMNoneManager(){}return VMNoneManager.prototype={init:function initFn(){},previewTemplate:function previewTemplateFn(){return void 0},getItemStyledText:function getItemStyledTextFn(item){return item},getItemText:function getItemTextFn(){return void 0},getItemTextLength:function getItemTextLengthFn(){return 0},findMatchExact:function findMatchExactFn(str){return void 0},findMatchLike:function findMatchLikeFn(str,maxCount){return void 0}},VMNoneManager}),define("VMAutocomplete",["ko","data","globals","goog","platform","android","tracker","VMAutocompleteItem","AutocompleteDates","VMNoneManager","Sel","Measure"],function(ko,d,g,goog,platform,android,tracker,VMAutocompleteItem,AutocompleteDates,VMNoneManager,Sel,Measure){function VMAutocomplete(){try{g.PAssert(3692,!g.autocomplete,"Autocomplete is a singleton")}catch(PERR){g.reportError(PERR)}g.autocomplete=this,this.isEnabled=!0,this.items=ko.observableArray(),this.isVisible=ko.observable(!1),this.contactsEnabled=ko.observable(!0),this.element=void 0,this.trackingTag=void 0,this._activeOwner=void 0,this.selectedIndex=ko.observable(-1).extend({notify:"always"}),this.exactMatch=ko.observable(!1),this.text=ko.observable(""),this.lastParams=void 0,this.autocompleteDates=new AutocompleteDates,this.previousSelectionRect={},this.mode=ko.observable(void 0),this._validProviders=[],this._provider=void 0,this.registerProvider(ACProvider.None,new VMNoneManager),this.registerProvider(ACProvider.Contact,d.contactManager),this.registerProvider(ACProvider.DatePicker,this.autocompleteDates),this.registerProvider(ACProvider.DateList,this.autocompleteDates),this.registerProvider(ACProvider.Tag,d.tagManager),this._prefixes=[ContactPrefix,DatePrefix,TagPrefix],this._prefixMap={},this._prefixMap[ContactPrefix]=ACProvider.Contact,this._prefixMap[TagPrefix]=ACProvider.Tag,this._prefixMap[DatePrefix]=platform.mobile&&platform.app?ACProvider.DatePicker:ACProvider.DateList,g.vmMain.pluginManager.runForEachPlugin(function(plugin){plugin.registerAutocomplete()}),this.mode(ACProvider.None),g.addCustomEventListener("keyEscape",this.hide.bind(this)),this.init()}return VMAutocomplete.prototype={showDates:function showDatesFn(){return this.mode()===ACProvider.DatePicker&&(""===this.text()||this.autocompleteDates.nextDateWord())},showList:function showListFn(){return!(this.exactMatch()||this.showDates()||this.mode()===ACProvider.Contact&&!this.contactsEnabled())},showPreview:function showPreviewFn(){return this.mode()&&this._provider.previewTemplate()&&this.items().length>0&&this.selectedIndex()>=0&&this.selectedItem()&&(!platform.mobile||this.exactMatch())},showEnableContactsUI:function showEnableContactsUIFn(){return this.mode()===ACProvider.Contact&&this.isVisible()&&!this.contactsEnabled()},hasContent:function hasContentFn(){return this.showDates()||this.showList()||this.showPreview()||!this.contactsEnabled()},previewTemplate:function previewTemplateFn(){try{g.PAssert(3693,this._provider,"Provider must be valid")}catch(PERR){g.reportError(PERR)}return this._provider.previewTemplate()},autocompleteWidth:function autocompleteWidthFn(){return this.mode()&&this._provider.autocompleteWidth?this._provider.autocompleteWidth()+"px":void 0},selectedItem:function selectedItemFn(){try{g.PAssert(3694,this.selectedIndex()>=0,"Should always have a valid selection index")}catch(PERR){g.reportError(PERR)}if(this.selectedIndex()<0)return void 0;try{g.PAssert(3695,void 0!==this.items()[this.selectedIndex()],"Autocomplete should always have valid entries")}catch(PERR){g.reportError(PERR)}return this.items()[this.selectedIndex()]},init:function initFn(){this.onkeydown=this.onkeydown.bind(this),window.addEventListener("closeKeyboard",this.hide.bind(this)),this.element=document.getElementById("autocomplete"),g.applyBindings(this,"autocomplete"),platform.isTouchDevice&&this.element.addEventListener(platform.touchStartEvent,function(e){return this.showPreview()||g.preventScrollPropagation(this.element)?void 0:(e.preventDefault(),!1)}.bind(this))},registerProvider:function registerProviderFn(provider,obj){try{g.PAssert(3696,!this._validProviders[provider],"Registering a provider that has already been registered")}catch(PERR){g.reportError(PERR)}this._validProviders[provider]=obj},registerPrefix:function registerPrefixFn(provider,prefix){try{g.PAssert(3697,!this._prefixMap[prefix],"Should only register a prefix once")}catch(PERR){g.reportError(PERR)}this._prefixes.push(prefix),this._prefixMap[prefix]=provider},setProviderMode:function setProviderModeFn(mode){if(this.mode()!==mode){this._provider=this._validProviders[mode];try{g.PAssert(3698,this._provider,"Provider must be valid",mode)}catch(PERR){g.reportError(PERR)}this.clear(),this.mode(mode)}},getProviderForPrefix:function getProviderForPrefixFn(prefix){var provider=this._prefixMap[prefix]||ACProvider.None;return provider},show:function showFn(elTapped){if(!this.isVisible()){var completionElement=elTapped;if(this.mode()===ACProvider.Contact&&tracker.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenContact,data:[{}]}),this.showList())try{g.PAssert(3700,this.element.children.length>0,"Must always have an items element when showing list")}catch(PERR){g.reportError(PERR)}var windowBounds=document.documentElement.getBoundingClientRect();if(!platform.mobile){var caretPos=Measure.getCaretScreenPosition(Sel.getPane(),Sel.getStartIndex(),Sel.getStartOffset()),selectionRect={left:caretPos.left,top:caretPos.top,right:caretPos.left,bottom:caretPos.top+g.itemLineHeight+5},yDiff=Math.abs(selectionRect.top-this.previousSelectionRect.top);if(!(yDiff>10||!this.isVisible()||elTapped))return;var position={left:selectionRect.left,top:selectionRect.bottom,bottom:selectionRect.bottom+600},newHeight=g.adjustHeightToBeInsideBounds(windowBounds,position,100,600,10),width=this.mode()===ACProvider.Contact?550:250;if(position.left=Math.max(10,g.adjustLeftToBeInsideBounds(windowBounds,position.left,width,10)),this.showList()){try{g.PAssert(3701,this.element.children.length>0,"Must always have an items element when showing list")}catch(PERR){g.reportError(PERR)}this.element.children[0].style.maxHeight=newHeight+"px"}var translate="translate("+position.left+"px, "+position.top+"px)";g.isDemoMode()&&window.__AUTOCOMPLETE_SCALE&&(translate+=" scale("+window.__AUTOCOMPLETE_SCALE+")"),this.element.style[platform.transform.style]=translate}if(this.isVisible(!0),platform.mobile&&this._activeOwner){var time=150,bottomOfItem=0;if(this.mode()===ACProvider.Contact&&elTapped)this.element.style.top="",g.isKeyboardOpen?(this.element.style.paddingBottom="30px",this.element.style.bottom=android.isEnabled()?platform.getKBSize()+"px":0):(this.element.style.paddingBottom=0,this.element.style.bottom=0);else{var pane=g.focusedPane,amtMoved=pane.scrollToTop(this._activeOwner,time)||0,bounds;if(completionElement)bounds=completionElement.getBoundingClientRect();else{var element=pane.elementAtIndex(this._activeIndex);try{g.PAssert(3702,element,"Element should exist in autocomplete")}catch(PERR){g.reportError(PERR)}var top=pane.topOfIndex(this._activeIndex)-(pane.getScrollOffset()+amtMoved)+g.topBoxHeight+g.topBarHeight,height=pane.heightAtIndex(this._activeIndex);bounds={top:top,bottom:top+height}}bottomOfItem=bounds.bottom,this.element.style.paddingBottom="",this.element.style.top=bottomOfItem+"px",this.element.style.bottom=platform.getKBSize()+"px",this.mode()===ACProvider.Contact?g.phoneMenu.contactMode(!0):this.mode()===ACProvider.DatePicker?g.phoneMenu.dateMode(!0):this.mode()===ACProvider.Tag&&g.phoneMenu.tagMode(!0)}g.keyboardToolbar.isVisible(!1);var trans=platform.windowHeight()-platform.kbsize-bottomOfItem;g.setTransform(this.element,0,trans),requestAnimationFrame(function(){g.setTransform(this.element,0,0,time,"ease-out")}.bind(this))}this.previousSelectionRect=selectionRect,tracker.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.OpenAutocomplete})}},clear:function clearFn(){this.items.removeAll(),this.selectedIndex(-1),this.trackingTag=!1},hide:function hideFn(){if(this.isVisible()){var time=200;if(platform.mobile){var trans=platform.windowHeight()-platform.kbsize;g.setTransform(this.element,0,trans,time,"ease-out"),setTimeout(function(){this.selectedIndex(-1),this.isVisible(!1),g.phoneMenu.normalMode(!0),g.isKeyboardOpen&&g.keyboardToolbar.isVisible(!0),this.clear()}.bind(this),time)}else this.selectedIndex(-1),this.isVisible(!1);tracker.miscAction({type:TrackerType.Mobile,misc:TrackerMiscMobile.CloseAutocomplete})}},onkeydown:function onkeydownFn(e){if(!this.isEnabled)return!0;if(0===this.items().length||!this.isVisible()||this.exactMatch()&&e.normCode!==KeyCode.Escape)return!0;if(e.normCode===KeyCode.UpArrow||e.normCode===KeyCode.DownArrow){if(this.items().length>1){var newIndex=this.selectedIndex()+(e.normCode===KeyCode.DownArrow?1:-1);this.selectedIndex(0>newIndex?this.items().length+newIndex:newIndex>=this.items().length?newIndex%this.items().length:newIndex);var listEle=document.getElementById("autocompleteItems");return g.scrollIntoView(listEle.children[this.selectedIndex()],200),!1}this.hide()}else{if(e.normCode===KeyCode.Enter){if(this.selectedIndex()>=0){var item=this.items()[this.selectedIndex()];this.onTapped(this._provider.getItemText(item),this._provider.getItemTextLength(item),!0)}return this.hide(),!1}if(e.normCode===KeyCode.Escape)return this.hide(),!1}return!0},onTap:{onClick:function onClickFn(e){var item=g.dataFor(e.srcElement);item&&item!==this&&this.onTapped(this._provider.getItemText(item),this._provider.getItemTextLength(item),!0),platform.mobile&&g.handlerPreventStop(e)}},onTapped:function onTappedFn(text,textLength,hide){try{g.PAssert(3703,!text||g.isString(text),"Text must be a valid string",text)}catch(PERR){g.reportError(PERR)}try{g.PAssert(3704,textLength,g.isNumber(textLength),"TextLength must be a valid number",textLength)}catch(PERR){g.reportError(PERR)}try{g.PAssert(3705,void 0===hide||g.isBoolean(hide),"Hide must be a boolean value",hide)}catch(PERR){g.reportError(PERR)}this.trackingTag&&(this.text(text),this._activeOwner&&this._activeOwner.onAutocompleteTapped(text,textLength,this.trackingTag)),hide&&this.hide()},find:function findFn(words,start,num,forceSpace){if(start+num>words.length-1)return void 0;if(this.mode()===ACProvider.None)return void 0;if(""===words[start]&&""===words[start+1])return void 0;try{g.PAssert(3706,this._provider,"Must have a valid AC provider in use")}catch(PERR){g.reportError(PERR)}var text=words[start];isNaN(num)&&(num=0);for(var i=0;num>i&&words[start+i+1];i++)text+=" "+words[start+i+1];forceSpace&&void 0!==words[start+num+1]&&(text+=" ");var MaxMatchCount=22,results=this._provider.findMatchLike(text,MaxMatchCount);return results.length>0?this.find(words,start,num+1,forceSpace)||{text:text,results:results}:void 0},setItems:function setItemsFn(items){this.selectedIndex()>=items.length&&this.selectedIndex(0),this.items(items)},checkPrefixes:function checkPrefixesFn(word){for(var i=0;i<this._prefixes.length;i++)if(word.startsWith(this._prefixes[i]))return this._prefixes[i].length},getAutocompleteInfo:function getAutocompleteInfoFn(words,selectionStart){for(var provider=ACProvider.None,lineIndex=0,startWord=-1,startChar=-1,prefixLength=0,prefix,i=0;i<words.length&&selectionStart>=lineIndex;++i){var word=words[i],tempLength=this.checkPrefixes(word);tempLength&&(startWord=i,startChar=lineIndex,prefixLength=tempLength),lineIndex+=word.length+1}return startWord>=0&&(prefix=words[startWord].substr(0,prefixLength),provider=this.getProviderForPrefix(prefix),words[startWord]=words[startWord].substr(prefixLength)),{startWord:startWord,startChar:startChar,provider:provider,prefix:prefix,prefixLength:prefixLength}},update:function updateFn(params){if(!this.isEnabled)return!0;try{g.PAssert(3707,params,"Params must be passed in")}catch(PERR){g.reportError(PERR)}this.lastParams=params,this._activeOwner=params.owner||this._activeOwner,this._activeIndex=params.index;var text=this._activeOwner.getACText()||"",selectionStart=params.start,fromArrows=params.fromArrows;this.trackingTag=!1;var words=text.split(" "),ch=text[params.start-1],forceSpace=" "===ch,acInfo;if(acInfo=this._activeOwner.getAutocompleteInfo?this._activeOwner.getAutocompleteInfo(words,selectionStart):this.getAutocompleteInfo(words,selectionStart),this.setProviderMode(acInfo.provider),acInfo.provider!==ACProvider.None){try{g.PAssert(3708,selectionStart>=acInfo.startChar,"Start of autocomplete word must be before selection start")}catch(PERR){g.reportError(PERR)}var result=this.find(words,acInfo.startWord,0,forceSpace),addAmount=acInfo.prefixLength;" "===ch&&text[params.start-2]!==acInfo.prefix&&addAmount++;var doShow=!1,acEnd=result&&acInfo.startChar+addAmount+result.text.length;if(result&&selectionStart>acInfo.startChar&&acEnd>=selectionStart){var exactMatch=this._provider.findMatchExact(result.text);this.exactMatch(!!exactMatch),this.selectedIndex(0),exactMatch?" "!==ch&&this.mode()===ACProvider.Contact&&acEnd!==selectionStart&&(this.setItems([exactMatch]),this.trackingTag=!0,fromArrows||platform.mobile||(doShow=!0)):(1!==result.results.length||result.results[0]!==result.text)&&(this.trackingTag={text:result.text,index:acInfo.startChar+acInfo.prefixLength,replaceLength:this._provider.autocompleteReplace?acInfo.prefixLength:0,length:result.text.length},this.text(result.text),this.setItems(result.results),fromArrows||(doShow=!0))}else if(!(result||this.mode()!==ACProvider.Contact||g.settings.get(Settings.syncContacts)||fromArrows||g.isDemoMode())){for(var hasSpace=!1,i=acInfo.startChar;selectionStart>i;++i)if(" "===text[i]){hasSpace=!0;break}hasSpace||(this.trackingTag=void 0,this.contactsEnabled(!1),doShow=!0)}doShow&&this.show()}if(this.autocompleteDates.nextDateWord(this.autocompleteDates.NextWordOptions.None),this.trackingTag===!1){try{g.PAssert(3709,!doShow,"Should never show then hide autocomplete in the same call")}catch(PERR){g.reportError(PERR)}this.hide()}},isItemSelected:function isItemSelectedFn(index){return this.selectedIndex()===index()},renderItem:function renderItemFn(item){var searchText=this.text(),itemText=this._provider.getItemStyledText(item,searchText);if(void 0!==itemText&&void 0!==searchText&&searchText.length>0){var index;g.isString(itemText)?index=itemText.toUpperCase().indexOf(searchText.toUpperCase()):(index=itemText.index,itemText=itemText.text);var newText;return newText=index>=0?itemText.substr(0,index)+"<b>"+itemText.substr(index,searchText.length)+"</b>"+itemText.substr(index+searchText.length):itemText}return g.isString(itemText)?itemText:itemText.text},onMouseover:function onMouseoverFn(UNUSED,e){if(this.showList()){var index=0,ele=e.srcElement||e.target,item=g.dataFor(ele);if(item&&item!==this){index=this.items.indexOf(item);try{g.PAssert(3710,index>=0,"Must be able to compute a valid selection index")}catch(PERR){g.reportError(PERR)}this.selectedIndex(index)}}},onTapEnableContacts:{onClick:function onClickFn(e){g.vmSettings.enableSyncContacts(function(value){if(value){this.contactsEnabled(!0),g.settings.set(Settings.syncContacts,!0);var last=this.lastParams;last&&(Sel.selectItem(last.owner,last.start,last.start),this.update(this.lastParams),this.show(this.completionElement))}}.bind(this)),e.preventDefault(),e.stopImmediatePropagation()}}},VMAutocomplete}),define("ScreenManager",["ko","util","globals","platform","DragDrop","Sel","Dispatcher"],function(ko,util,g,platform,DragDrop,Sel,Dispatcher){function ScreenManager(){this._isSwiping=!1,this.swipePoints=[],this.lastOffset=0,this.paneWidth=.85}return ScreenManager.prototype={getPane:function getPaneFn(){return g.focusedPane},isOutlineOpen:function isOutlineOpenFn(){return this.getPane().isOutlineVisible()},setIsOutlineOpen:function setIsOutlineOpenFn(isOpen){this.isOutlineOpen()!==isOpen&&(this.getPane().outline.setVisibility(isOpen),isOpen&&g.closeKeyboard())},isSwiping:function isSwipingFn(){return this._isSwiping},startSwipe:function startSwipeFn(){this._isSwiping||(this._isSwiping=!0,this.getPane().useCustomScroller&&this.isOutlineOpen()&&this.getPane().outline.iScroller.disable())},updateSwipe:function updateSwipeFn(diff,time){try{g.PAssert(3711,this.isSwiping(),"Must be swiping to perform an update")}catch(PERR){g.reportError(PERR)}var returnValue=!1;if(platform.ios||platform.android||platform.mobileie){var offset=this.lastOffset-diff,max=platform.windowWidth.peek()*this.paneWidth;offset=Math.max(Math.min(offset,max),0),this.swipePoints.splice(0,0,{time:time,x:diff}),this.swipePoints.length>20&&this.swipePoints.splice(this.swipePoints.length-1,1),this.setIsOutlineOpen(offset>0),this.lastOffset!==offset?(this.lastOffset=offset,returnValue=offset):returnValue=this.lastOffset}return returnValue},endSwipe:function endSwipeFn(){try{g.PAssert(3712,this.isSwiping(),"Must be swiping to end a swipe")}catch(PERR){g.reportError(PERR)}for(var snapIndex=-1,now=Date.now(),timeThresh=300,velThresh=200,sum=0,totalTime=0,i=0;i<this.swipePoints.length;i++){var p=this.swipePoints[i];if(!(now-p.time<timeThresh))break;sum+=p.x,totalTime=now-p.time}var v=sum/(totalTime/1e3);snapIndex=-velThresh>v?1:v>velThresh?0:Math.round(this.lastOffset/platform.windowWidth());var oldOutlineOpen=this.isOutlineOpen(),newOutlineOpen=snapIndex>0;return newOutlineOpen?this.setIsOutlineOpen(newOutlineOpen):setTimeout(function(){this.setIsOutlineOpen(newOutlineOpen)}.bind(this),150),this.lastOffset=this.updatePanePosition(newOutlineOpen),platform.ios&&g.preventClick(),this._isSwiping&&(this._isSwiping=!1),this.getPane().useCustomScroller&&this.getPane().outline.iScroller.enable(),oldOutlineOpen!==this.isOutlineOpen()},updatePanePosition:function updatePanePositionFn(isOutlineOpen){var x=isOutlineOpen?platform.windowWidth()*this.paneWidth:0;return g.focusedPane.updatePosition(x,!0),x},checkSwipeStart:function checkSwipeStartFn(e){var returnValue=!1;return g.canRevealMenu=!0,this.swipePoints.length=0,platform.ie&&!platform.mobile||platform.mobile&&(this.lastOffset=this.isOutlineOpen()?platform.windowWidth()*this.paneWidth:0,this.isOutlineOpen()&&e.eventX>this.paneWidth*platform.windowWidth()&&(e.preventDefault(),returnValue=!0)),returnValue},checkSwipeMove:function checkSwipeMoveFn(e){var returnValue=!1;if(g.canRevealMenu)if(platform.ie&&!platform.mobile);else if(platform.mobile){var hasHoriz=!this.isOutlineOpen()&&e.diffX>5||this.isOutlineOpen()&&e.diffX<-5;if(this.isSwiping()||Math.abs(e.distanceY)<10&&hasHoriz){this.isSwiping()||this.startSwipe(),e.preventDefault(),e.stopImmediatePropagation();var x=this.updateSwipe(-e.xThisFrame,e.timeStamp);g.focusedPane.updatePosition(x),returnValue=!0}}return returnValue},checkSwipeClick:function checkSwipeClickFn(e){return g.canRevealMenu&&this.isOutlineOpen()&&e.eventX>this.paneWidth*platform.windowWidth()?(this._isSwiping=!1,this.closeOutline(),!0):this._isSwiping},checkSwipeEnd:function checkSwipeEndFn(e){var returnValue=!1;return g.canRevealMenu&&this.isSwiping()&&(returnValue=this.endSwipe(e)),g.canRevealMenu=!0,this.getPane().useCustomScroller&&!this.isOutlineOpen()&&this.getPane().iScroller.enable(),returnValue},openOutline:function openOutlineFn(){this.lastOffset=this.updatePanePosition(platform.windowWidth()*this.paneWidth),this.setIsOutlineOpen(!0)},closeOutline:function closeOutlineFn(){this.lastOffset=this.updatePanePosition(0),this.setIsOutlineOpen(!1)},toggleOutline:function toggleOutlineFn(){this.isOutlineOpen()?this.closeOutline():this.openOutline()}},ScreenManager}),define("VMTooltip",["ko","globals","platform","DragDrop","Sel","Dispatcher"],function(ko,g,platform,DragDrop,Sel,Dispatcher){function VMTooltip(){this.listenerElement=void 0,this.displayElement=void 0,this.element=void 0,this.arrowElement=void 0,this.displayTimeout=void 0,this.extraTimeout=void 0,this.displayText=ko.observable(""),this.displayExtra=ko.observable(""),this.arrowClass=ko.observable("notVisible"),this.arrowX=ko.observable(0),this.tipExtras={},g.applyBindings(this,"tooltip"),this.init()}var displayDelay=400,extraDelay=1e3;return VMTooltip.prototype={init:function initFn(){},onLoad:function onLoadFn(){this.element=document.getElementById("tooltip"),this.tooltipArrow=document.getElementById("tooltipArrow"),platform.touch||(this.listenerElement=document.getElementById("outerWrapper"),this.listenerElement&&(Dispatcher.listen("mouseover",this.handleEleOver.bind(this)),Dispatcher.listen("mouseout",this.handleEleOut.bind(this))))},register:function registerFn(elem,text){this.update(elem,text)},update:function updateFn(elem,text){elem.setAttribute("tooltip",text)},tipIn:function tipInFn(e){this.displayElement===e.target||DragDrop.isDragging||Sel.isMouseDown()||(clearTimeout(this.displayTimeout),this.displayTimeout=setTimeout(this.displayTip.bind(this),displayDelay,{element:e.target,offset:{y:5}}))},adjustBounds:function adjustBoundsFn(options){var arrowSize=40,time=0,windowBounds=document.documentElement.getBoundingClientRect(),targetBounds;this.displayElement?targetBounds=this.displayElement.getBoundingClientRect():options&&options.bottom&&(targetBounds={left:0,width:platform.windowWidth(),top:platform.windowHeight()},g.vmMain.gdriveStatus()!==DriveStatus.Online&&(targetBounds.top-=20),options.above=!0);var width=g.width(this.element),x=targetBounds.left+targetBounds.width/2-width/2,y;y=options&&options.above?targetBounds.top-g.height(this.element):targetBounds.bottom;var offset=options&&options.offset;offset?(offset.x?x+=offset.x:offset.right?x=windowBounds.right-width-offset.right:offset.left&&(x=offset.left),offset.y&&(y+=offset.y)):options&&options.above?y-=5:y+=5;var newX=x;x+width>windowBounds.right?newX=windowBounds.right-width-8:0>x&&(newX=8);var arrow=options&&options.arrow;if(arrow){var arrowX=(width-arrowSize)/2;newX!==x&&(arrowX+=x-newX),this.arrowClass(arrow),this.arrowX(arrowX+"px")}else this.arrowClass("notVisible");options&&options.time&&(time=options.time),newX=Math.round(newX),y=Math.round(y),g.setTransform(this.element,newX,y,time)},displayTip:function displayTipFn(options){try{g.PAssert(3713,options,"When display a tooltip, must pass in some info")}catch(PERR){g.reportError(PERR)}if(options){clearTimeout(this.displayTimeout),this.displayTimeout=void 0,clearTimeout(this.extraTimeout),this.extraTimeout=void 0;var element=this.displayElement=options.element,text;if(!element||element.offsetWidth>0&&element.offsetHeight>0){options.text?text=options.text:element&&(text=element.getAttribute("tooltip")||element.getAttribute("data-tooltip"));try{g.PAssert(3714,text,"When display a tooltip, elements should always have valid data set")}catch(PERR){g.reportError(PERR)}if(text&&(this.displayText(text),this.element.style["max-width"]=options.maxWidth?options.maxWidth+"px":"",this.adjustBounds(options),!platform.mobile)){try{g.PAssert(3715,this.displayElement,"Display element must be valid")}catch(PERR){g.reportError(PERR)}this.extraTimeout=setTimeout(this.showExtra.bind(this),extraDelay)}}}},tipOut:function tipOutFn(e){var isAncestor=!1;e.target&&(isAncestor=g.isAncestor(e.target,this.element)),isAncestor||e.target===this.element||this.hideTip()},handleEleOver:function handleEleOverFn(e){var infoText=e.target&&(e.target.getAttribute("tooltip")||e.target.getAttribute("data-tooltip"));infoText&&this.tipIn(e)},handleEleOut:function handleEleOutFn(e){this.tipOut(e)},showExtra:function showExtraFn(){var extraString;try{g.PAssert(3716,this.displayElement,"There should be a display element when showing extra information")}catch(PERR){g.reportError(PERR)}if(this.displayElement){if(this.displayElement.id){var idString="#"+this.displayElement.id;this.tipExtras[idString]&&(extraString=idString)}if(!extraString)for(var i=0;i<this.displayElement.classList.length;++i){var classString="."+this.displayElement.classList[i];if(this.tipExtras[classString]){extraString=classString;
break}}if(extraString){var extraInfo=this.tipExtras[extraString];extraInfo&&(this.displayExtra(extraInfo),this.adjustBounds())}clearTimeout(this.extraTimeout),this.extraTimeout=void 0}},hideTip:function hideTipFn(){this.displayElement=void 0,clearTimeout(this.displayTimeout),this.displayTimeout=void 0,clearTimeout(this.extraTimeout),this.extraTimeout=void 0,this.displayText(""),this.displayExtra("")},onTap:function onTapFn(e){g.intro.nextStep(),e.stopImmediatePropagation(),e.preventDefault()}},VMTooltip}),define("AppCache",["ko","globals","platform"],function(ko,g,platform){function AppCache(){this.updateWaitTime=g.minutes(120),this.notifiedOfNew=!1,this.isFinished=!1,this.showCancel=ko.observable(!1),this.downloadingTimeout=0,this.lastUpdate=0,this.startStatus=window.applicationCache?window.applicationCache.status:-2,this.continuedUpdate=!1,this.updateActionDone=!1,this.fnToRun=[],this.requiredUpdate=!1,this.appUpdatePending=!1,this.runUpdate=!1,this.init()}return AppCache.prototype={init:function initFn(){log("Cache Status: "+this.startStatus),window.applicationCache?(window.applicationCache.addEventListener("noupdate",this.onCacheLoadFinished.bind(this)),window.applicationCache.addEventListener("cached",this.onFirstUpdateReady.bind(this)),window.applicationCache.addEventListener("downloading",this.onUpdateDownloading.bind(this)),window.applicationCache.addEventListener("updateready",this.onUpdateReady.bind(this)),window.applicationCache.addEventListener("obsolete",this.onCacheLoadFinished.bind(this)),window.applicationCache.addEventListener("error",this.onUpdateError.bind(this)),window.applicationCache.status>=window.applicationCache.UPDATEREADY||document.documentElement.attributes.getNamedItem("manifest")||this.onCacheLoadFinished()):this.onCacheLoadFinished()},isVisible:function isVisibleFn(value){value&&g.isDemoMode()&&g.reload(!0)},update:function updateFn(){if(Date.now()-this.lastUpdate>this.updateWaitTime&&window.applicationCache.status===window.applicationCache.IDLE){this.lastUpdate=Date.now();try{applicationCache.update()}catch(err){g.reportError(err)}}},checkForUpdate:function checkForUpdateFn(forceUpdate,runUpdate){this.requiredUpdate=!!forceUpdate,this.runUpdate=!!runUpdate,this.appUpdatePending?this.appUpdatePending&&this.runUpdate&&g.reload(!0):this.update()},endRunUpdate:function endRunUpdateFn(){this.runUpdate=!1},runOnFinish:function runOnFinishFn(cb,isTerminal){try{g.PAssert(3717,0===this.fnToRun.length,"Only a single callback is allowed to be run at this point.")}catch(PERR){g.reportError(PERR)}this.isFinished?setTimeout(cb,0):this.fnToRun.push(cb)},onUpdateReady:function onUpdateReadyFn(){log("Cache: New version available"),this.appUpdatePending=!0,this.startStatus===window.applicationCache.UNCACHED&&log("Cache Update from UNCACHED state. ERROR."),this.onCacheLoadFinished(),this.updateAction()},onFirstUpdateReady:function onFirstUpdateReadyFn(){log("Cache: first update")},onUpdateError:function onUpdateErrorFn(ev){platform.demo||g.vmMain&&!g.vmMain.isOnline()||log("Update Error: ",ev),this.isVisible(!1),this.onCacheLoadFinished()},onUpdateDownloading:function onUpdateDownloadingFn(){log("Cache: New version downloading")},onCacheLoadFinished:function onCacheLoadFinishedFn(){if(log("Cache: No update"),!this.isFinished){this.isFinished=!0;for(var i=0;i<this.fnToRun.length;++i)this.fnToRun[i]()}},notifyOfUpdate:function notifyOfUpdateFn(){this.notifiedOfNew||(this.notifiedOfNew=!0,g.setAppCacheUpdateState(!0),this.startStatus!==window.applicationCache.UNCACHED&&this.isVisible(!0))},updateAction:function updateActionFn(){this.runUpdate||!platform.isPageVisible()?g.reload(!0):this.requiredUpdate?g.menus.alert({text:"A software update is required to continue. Please reload to update.",actionText:"RELOAD",action:g.reload}):this.isVisible(!0),g.sendEvent("AppCache","Update")}},AppCache}),define("NativeAPI",["ko","globals","util"],function(ko,g,util){function NativeAPI(name){try{g.PAssert(3718,void 0===window.__MoodoBridge[name],"Registering an Inbound API that already exists on the window object",name)}catch(PERR){g.reportError(PERR)}this._name=name,this._publicObj={},this._privateObj={},window.__MoodoBridge[name]=this._publicObj,this.init()}return NativeAPI.prototype={init:function initFn(){},_createWrapper:function _createWrapperFn(fn){function wrapper(){try{return fn.apply(this,arguments)}catch(err){g.reportError(err)}}return wrapper},registerFunction:function registerFunctionFn(name,fn,isPublic){try{g.PAssert(3719,name,"Name must be provided to register function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3720,fn,"A valid function must be provided to register")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3721,void 0===this._privateObj[name],"Re-registering an api function on private obj",name)}catch(PERR){g.reportError(PERR)}try{g.PAssert(3722,void 0===this._publicObj[name],"Re-registering an api function on public obj",name)}catch(PERR){g.reportError(PERR)}this._privateObj[name]=fn.bind(this._privateObj),isPublic&&(this._publicObj[name]=this._createWrapper(this._privateObj[name]))},registerVariable:function registerVariableFn(name,value,isPublic){try{g.PAssert(3723,name,"Name must be provided to register variable")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3724,!isPublic,"Public variables are not currently supported")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3725,void 0===this._privateObj[name],"Re-registering an api variable on private obj")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3726,void 0===this._publicObj[name],"Re-registering an api variable on public obj")}catch(PERR){g.reportError(PERR)}this._privateObj[name]=value}},util.defineBase(NativeAPI),NativeAPI}),define("NativeOutAPI",["ko","globals","util"],function(ko,g,util){function NativeOutAPI(name){this._name=name,this._apiLoaded=!1,this._apiError=!1,this._listeners=void 0,this._requiredFns=[],this._missingFns=void 0,this.init()}var checkTimeout=1e3;return NativeOutAPI.prototype={init:function initFn(){g.isObject(window[this._name])?this.onAPILoaded():(util.forceBind("_checkAPI",this),setTimeout(this._checkAPI,checkTimeout))},_checkAPI:function _checkAPIFn(){try{g.PAssert(3727,!this._apiLoaded,"Should not be checking for API load if already loaded")}catch(PERR){g.reportError(PERR)}g.isObject(window[this._name])&&this.onAPILoaded(),this._apiLoaded||setTimeout(this._checkAPI,checkTimeout)},onAPILoaded:function onAPILoadedFn(){this._apiLoaded=!0;for(var i=0;i<this._requiredFns.length;++i)g.isFunction(window[this._name][name])||(this._apiError=!0,this._addMissingFn(name));this.notifyListeners()},requestNotification:function requestNotificationFn(cb){this._apiLoaded?setTimeout(cb,0):this._listeners?this._listeners.push(cb):this._listeners=[cb]},notifyListeners:function notifyListenersFn(){try{g.PAssert(3728,this._apiLoaded,"API must be loaded to notify listeners")}catch(PERR){g.reportError(PERR)}if(this._listeners)for(var i=0;i<this._listeners.length;++i)this._listeners[i]();this._listeners=void 0},requireFunction:function requireFunctionFn(name,optional){try{g.PAssert(3729,this._requiredFns.indexOf(name)<0,"Should not double require a single function")}catch(PERR){g.reportError(PERR)}this._requiredFns.push(name),this._apiLoaded&&(g.isFunction(window[this._name][name])||optional||(this._apiError=!0,this._addMissingFn(name)))},_addMissingFn:function _addMissingFnFn(name){if(this._missingFns){try{g.PAssert(3730,this._missingFns.indexOf(name)<0,"Should not be missing the same function multiple times")}catch(PERR){g.reportError(PERR)}this._missingFns.push(name)}else this._missingFns=[name]},hasOptionalFunction:function hasOptionalFunctionFn(name){try{g.PAssert(3731,this._requiredFns.indexOf(name)>=0,"Must be querying for a registered function")}catch(PERR){g.reportError(PERR)}return!!window[this._name][name]},call:function callFn(name){try{g.PAssert(3732,this._apiLoaded,"Trying to call an API function before it is loaded",name)}catch(PERR){g.reportError(PERR)}if(this._apiLoaded){var args=Array.prototype.slice.call(arguments,1);try{return window[this._name][name].apply(window[this._name],args)}catch(err){g.reportError(err)}}return void 0}},util.defineBase(NativeOutAPI),NativeOutAPI}),define("NativeBridge",["globals","platform","tracker","android","goog","gdata","NativeAPI","NativeOutAPI"],function(g,platform,tracker,android,goog,gdata,NativeAPI,NativeOutAPI){function NativeBridge(){if(platform.app)try{this.backlog=[],this._iOS7Queue=[],this._iOS7QueueTimeout=void 0,this.flushingBacklog=!1,this.isPokingBackground=!1,this.setupFns=[],this.setupFns[AppPlatform.iOS]=this.setupiOS.bind(this),this.setupFns[AppPlatform.Android]=this.setupAndroid.bind(this),this.setupFns[AppPlatform.WinPhone]=void 0,this.setupFns[AppPlatform.Chrome]=this.setupChrome.bind(this),this.sendFns=[],this.sendFns[AppPlatform.iOS]=this.sendToAppiOS.bind(this),this.sendFns[AppPlatform.Android]=this.sendToAppAndroid.bind(this),this.sendFns[AppPlatform.WinPhone]=void 0,this.sendFns[AppPlatform.Chrome]=this.sendToAppChrome.bind(this),this.setupFn=this.setupFns[platform.appPlatform],this.sendFn=this.sendFns[platform.appPlatform],this.init(),this._isEnabled=!0}catch(err){log("Native API Bridge Disabled"),g.reportError(err)}else this._isEnabled=!1;if(this._embedBridge=void 0,platform.app||platform.embed){try{g.PAssert(3733,void 0===window.__MoodoBridge,"Must not have a previous bridge in place")}catch(PERR){g.reportError(PERR)}window.__MoodoBridge={},this._canRegisterAPIs=!0,this._inboundAPIs={},this._outboundAPIs={}}}return NativeBridge.prototype={init:function initFn(){try{g.PAssert(3734,this.setupFn,"Must have a valid setup function")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3735,this.sendFn,"Must have a valid send function")}catch(PERR){g.reportError(PERR)}this.setupFn&&this.sendFn&&(this.initAppEvents(),this.setupFn(),this.backlog=g.nativeBacklog,this.flushBacklog(),window.__testNative=function(method,data){log("Sending To App: "+method),this.nativeBridge.sendToApp(method,data)}.bind(this))},isEnabled:function isEnabledFn(){return this._isEnabled},flushBacklog:function flushBacklogFn(){this.flushingBacklog=!0;for(var i=0;i<this.backlog.length;++i){var entry=this.backlog[i];this.sendToApp(entry.method,entry.data)}this.flushingBacklog=!1},addToBacklog:function addToBacklogFn(method,data){try{g.PAssert(3736,!this.flushingBacklog,"Should never be adding to backload while flushing it")}catch(PERR){g.reportError(PERR)}this.flushingBacklog||this.backlog.push({method:method,data:data})},registerEmbedBridge:function registerEmbedBridgeFn(bridge){try{g.PAssert(3737,bridge,"Must supply a valid embed bridge")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3738,platform.embed,"Must be embedded")}catch(PERR){g.reportError(PERR)}this._embedBridge=bridge},hasEmbedBridge:function hasEmbedBridgeFn(){return!!this._embedBridge},sendToEmbed:function sendToEmbedFn(method,data){try{g.PAssert(3739,this.hasEmbedBridge(),"Must have a valid embed bridge to send message: ",method)}catch(PERR){g.reportError(PERR)}this._embedBridge.handleEmbedMessage(method,data)},registerInboundAPI:function registerInboundAPIFn(name){try{g.PAssert(3740,!this._inboundAPIs[name],"Should not have already registered an outbound API with this name")}catch(PERR){g.reportError(PERR)}if(this._canRegisterAPIs){var api=new NativeAPI(name);return this._inboundAPIs[name]=api,api}return void 0},registerOutboundAPI:function registerOutboundAPIFn(name){try{g.PAssert(3741,!this._outboundAPIs[name],"Should not have already registered an outbound API with this name")}catch(PERR){g.reportError(PERR)}if(this._canRegisterAPIs){var api=new NativeOutAPI(name);return this._outboundAPIs[name]=api,api}return void 0},initAppEvents:function initAppEventsFn(){window.appEvents=this.appEvents,window.reportLowMemory=this.appEvents.reportLowMemory,window._SENDJSMESSAGE_=this.handleNativeMessage},setupChrome:function setupChromeFn(){window.addEventListener("message",this.onChromeMessage.bind(this))},setupAndroid:function setupAndroidFn(){},setupiOS:function setupiOSFn(){this.setupiOSUI(),gdata.registerSaveNotify(this.onSaveChange.bind(this))},setupiOSUI:function setupiOSUIFn(){this.iframeApp=document.createElement("IFRAME"),this.iframeApp.setAttribute("height","1px"),this.iframeApp.setAttribute("width","1px"),this.iframeApp.id="appComm",document.documentElement.appendChild(this.iframeApp)},onSaveChange:function onSaveChangeFn(numChanged){this.isPokingBackground&&(this.sendToApp("pokeChanged",numChanged>0?"true":"false"),this.isPokingBakground=!1)},onChromeMessage:function onChromeMessageFn(e){if(0===e.origin.indexOf("chrome"))if(this.appWindow&&this.appOrigin||(this.appWindow=event.source,this.appOrigin=event.origin,setTimeout(this.flushBacklog.bind(this),0)),e.data&&g.isString(e.data)){var index=e.data.indexOf(":"),action=e.data.substr(0,index),data=e.data.substr(index+1);switch(action){case"chrome":switch(log("Chrome Message: ",action,"->",data),data){case"start":this.sendToApp("loaded");break;default:log("Unhandled Chrome Message: ",data)}break;default:this.handleNativeMessage(action,data)}}else log("Invalid Chrome Message: ",data)},sendToApp:function sendToAppFn(method,data){try{g.PAssert(3742,platform.app,"Only use native bridge when creating an app")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3743,this.sendFn,"Must have a valid send method for the native bridge")}catch(PERR){g.reportError(PERR)}var returnValue=!1;try{var dataString;data&&(dataString=g.isString(data)?data:JSON.stringify(data)),this.sendFn&&(this.sendFn(method,dataString),returnValue=!0)}catch(err){g.reportError(err)}return returnValue},sendToAppiOS:function sendToAppiOSFn(method,data){platform.ioswk?this.sendToAppiOS8(method,data):this.sendToAppiOS7(method,data)},sendToAppiOS7:function sendToAppiOS7Fn(method,data){if(this.iframeApp){var href="duchess://"+method;void 0!==data&&(href+="//"+data),this._addiOS7Queue(href)}else this.addToBacklog(method,data)},_addiOS7Queue:function _addiOS7QueueFn(href){this._iOS7Queue.push(href),this._iOS7QueueTimeout||(this._iOS7QueueTimeout=setTimeout(this._pumpiOS7Queue.bind(this),17))},_pumpiOS7Queue:function _pumpiOS7QueueFn(){var href=this._iOS7Queue.shift();try{g.PAssert(3744,href,"Must have a valid href",href)}catch(PERR){g.reportError(PERR)}this.iframeApp.src=href,this._iOS7QueueTimeout=this._iOS7Queue.length>0?setTimeout(this._pumpiOS7Queue.bind(this),17):void 0},sendToAppiOS8:function sendToAppiOS8Fn(method,data){if(window.webkit.messageHandlers&&window.webkit.messageHandlers.MoodoEvents){var str=method;void 0!==data&&(str+="//"+data),window.webkit.messageHandlers.MoodoEvents.postMessage(str)}else this.addToBacklog(method,data)},sendToAppAndroid:function sendToAppAndroidFn(method,data){window.AppInterface&&void 0!==window.AppInterface.sendAppMessage&&null!==window.AppInterface.sendAppMessage?window.AppInterface.sendAppMessage(method,data):this.addToBacklog(method,data)},sendToAppChrome:function sendToAppChromeFn(method,data){if(this.appWindow){var msg=method+":";void 0!==data&&(msg+=data),this.appWindow.postMessage(msg,"*")}else this.addToBacklog(method,data)},handleNativeMessage:function handleNativeMessageFn(method,data){try{window.appEvents[method]?window.appEvents[method](data):g.reportError(new Error("Calling invalid JS method from native: "+method))}catch(err){g.reportError(err)}},appEvents:{undo:function undoFn(){log("Native Undo"),g.sendEvent("Hotkey","ShakeUndo"),tracker.undoAction()},redo:function redoFn(){log("Native Redo"),g.sendEvent("Hotkey","ShakeRedo"),tracker.redoAction()},kbsize:function kbsizeFn(e){e>0&&e!==platform.kbsize&&(platform.setKBSize(e),g.keyboardToolbar&&g.keyboardToolbar.updatePosition())},closeKeyboard:function closeKeyboardFn(){g.blurActiveElement(),g.vmMain&&g.vmMain.clearSelected()},enterBackground:function enterBackgroundFn(){g.AppCache&&g.AppCache.checkForUpdate(!1,!0),g.onunload()},enterForeground:function enterForegroundFn(){gdata.poke(),g.checkForRemoteChanges(),g.AppCache&&g.AppCache.endRunUpdate()},pokeBackground:function pokeBackgroundFn(){g.nativeBridge.isPokingBackground=!0,gdata.poke()},reportLowMemory:function reportLowMemoryFn(msg){g.handleLowMemory(msg)},statusBarTap:function statusBarTapFn(){var firstItem=g.focusedPane.getFirstItem();firstItem&&g.focusedPane.scrollToTop(firstItem,ScrollDuration.Default)},features:function featuresFn(features){try{var featuresObj=JSON.parse(features);featuresObj.oauth&&goog.addOAuthMethod(OAuthSchemeType.Native),featuresObj.customKeyboard&&android.isEnabled()&&android.notifyCustomKeyboard(featuresObj.customKeyboard);try{g.PAssert(3745,featuresObj.notifications,"Notifications should always be available on all platforms")}catch(PERR){g.reportError(PERR)}}catch(err){g.reportError(err)}},notifyOAuth:function notifyOAuthFn(info){try{goog.handleNativeOAuthResponse(JSON.parse(info))}catch(err){g.reportError(err)}}}},NativeBridge}),define("BillingManager",["ko","globals","util","platform","International","goog","gdata","ContactsAutocomplete","ModalBase"],function(ko,g,util,platform,International,goog,gdata,ContactsAutocomplete,ModalBase){function BillingManager(){this._isEnabled=ko.observable(!0),this._premiumStatus=ko.observable(PremiumStatus.Unknown),overridePremiumStatus&&(this._isEnabled(!0),this._premiumStatus(PremiumStatus.Active)),this._lastSignupError=-1,this._inviteCode=ko.observable(),this._referredBy=ko.observable(),this._joinDate=ko.observable(),this._premiumStartDate=ko.observable(),this._premiumEndDate=ko.observable(),this._nextBillingDate=ko.observable(),this._referralCount=ko.observable(0),this._usedReferrals=ko.observable(0),this._nextMonthReferrals=ko.observable(0),this._nonReferralDiscounts=ko.observable(0),this._trialStart=ko.observable(),this._trialDuration=ko.observable(),this._billingIdentifier=void 0,this.isHidden=ko.observable(!0),this.isCancelling=ko.observable(!1),this.isDeletingAccount=ko.observable(!1),this._isDialogOpened=!1,this._hasValidBillingData=ko.observable(!1),this.pricingSelected=ko.observable(Pricing.None),this.daysLeftInTrial=ko.observable(-1),this.inviteCodeEntered=ko.observable(""),this.inviteEmailEntered=ko.observable(""),this.communityBlocks=ko.observableArray(),this.alreadyBlocks=ko.observableArray(),this.thisBlocks=ko.observableArray(),this.nextBlocks=ko.observableArray(),this.inviteCodeError=ko.observable(),this.inviteEmailError=ko.observable(),this.inviteEmailSuccess=ko.observable(),this.isSettingInviteCode=ko.observable(),this.isSendingEmail=ko.observable(),this.hasPremiumFeatures=ko.computed(function(){return this.isPremiumEnabled()&&(this.hasPremium()||this._premiumStatus()===PremiumStatus.Trial||this.canceledUserHasPremiumAccess())}.bind(this)),this._contactsAutocomplete=new ContactsAutocomplete(this.onContactSelected.bind(this)),this.inviteEmailEntered.subscribe(this._contactsAutocomplete.onContactEmailUpdate.bind(this._contactsAutocomplete)),this.init()}var premiumWhitelist=[],Pricing={None:-1,Monthly:0,Yearly:1},NumReferralsTo100=5,EarlyAccessRequirement=5,overridePremiumStatus=!1||platform.demo,MS_IN_DAY=864e5,BillingManagerFns={init:function initFn(){if(this.hasPremiumFeatures.subscribe(function(newValue){g.vmMain&&g.vmMain.pluginManager&&(newValue?(g.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.EarlyAccess),g.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.PremiumSub)):g.vmMain.pluginManager.notifyDependencyUnload(PluginDependency.PremiumSub))}.bind(this)),this._referralCount.subscribe(function(newValue){g.vmMain&&g.vmMain.pluginManager&&newValue>=EarlyAccessRequirement&&g.vmMain.pluginManager.notifyDependencyLoad(PluginDependency.EarlyAccess)}.bind(this)),!overridePremiumStatus)if(this.isPremiumEnabled()){var localStoredPremiumStatus=g.settings.get(Settings.premiumStatus),showPremiumDialog=util.getURLParam("premium");if(void 0!==showPremiumDialog&&util.removeURLParam("premium",!0),void 0!==localStoredPremiumStatus){this.setPremiumStatus(localStoredPremiumStatus);var trialStart=g.settings.get(Settings.trialStart)||Date.now(),trialDuration=g.settings.get(Settings.trialDuration)||0;this._updateTrialDaysLeft(trialStart,trialDuration);var endDate=g.settings.get(Settings.premiumEndDate)||Date.now();this._premiumEndDate(new Date(endDate)),(localStoredPremiumStatus==PremiumStatus.Unknown||localStoredPremiumStatus==PremiumStatus.Never)&&showPremiumDialog&&setTimeout(function(){g.menus.openModal(Modals.Settings,SettingsSections.Account)},100)}this.checkRemotePremiumStatus()}else void 0===this.getBillingIdentifier()?this.onBillingIdentifierAvailable(function(){this.checkRemotePremiumStatus()}.bind(this)):this.checkRemotePremiumStatus()},checkRemotePremiumStatus:function checkRemotePremiumStatusFn(){try{g.PAssert(3746,!g.isDemoMode(),"Should not be querying for premium status in demo mode")}catch(PERR){g.reportError(PERR)}this.onBillingIdentifierAvailable(function(){g.onUserAuthorized(function(){var signupInfo=goog.getCurrentUserSignupInfo(),statusData={email:this.getBillingIdentifier(),fname:signupInfo.fname,lname:signupInfo.lname};g.XHR_PrivateAPI({type:"POST",path:"/billing/getStatus",data:statusData,requireAuth:!0,autoRetry:!0,cb:function cbFn(xhr){var hasInviteCode=util.hasURLParam("invite"),usedInviteCode=!1;if(200===xhr.status&&xhr.response)try{var statusData=JSON.parse(xhr.response).data;if(this.setBillingData(statusData),hasInviteCode){usedInviteCode=!0,g.sendEvent("Billing","URLReferralCode");var refCode=util.getURLParam("invite");g.XHR_PrivateAPI({type:"POST",path:"/sharing/setReferral",data:{email:this.getBillingIdentifier(),refCode:refCode},requireAuth:!0,autoRetry:!0,cb:function cbFn(xhrReferral){if(200===xhrReferral.status)g.messageQueue.pushMessage(MessageID.InviteSuccess),g.messageQueue.clearMessage(MessageID.InviteFailure),util.removeURLParam("invite",!0),this.checkRemotePremiumStatus();else try{var referralData=JSON.parse(xhrReferral.response).data;g.messageQueue.pushMessage(referralData.code===PrivateAPIErrorCodes.InvalidReferralCode||referralData.code===PrivateAPIErrorCodes.InvalidParameter?MessageID.InviteInvalid:MessageID.InviteFailure)}catch(referralParseErr){g.reportError(referralParseErr)}}.bind(this)})}if(statusData.premiumStatus===PremiumStatus.Trial){try{g.PAssert(3747,void 0!==statusData.trialStart,"Must have a valid trialStart set")}catch(PERR){g.reportError(PERR)}try{g.PAssert(3748,void 0!==statusData.trialDuration,"Must have a valid trialDuration set")}catch(PERR){g.reportError(PERR)}if(statusData.trialStart&&statusData.trialDuration)try{var trialStart=new Date(statusData.trialStart).getTime();g.settings.set(Settings.trialStart,trialStart),g.settings.set(Settings.trialDuration,statusData.trialDuration),this._updateTrialDaysLeft(trialStart,statusData.trialDuration)}catch(err2){g.reportError(err2)}else this.setPremiumStatus(PremiumStatus.TrialOver),g.settings.set(Settings.trialStart,Date.now()),g.settings.set(Settings.trialDuration,0)}else if(statusData.premiumStatus===PremiumStatus.CanceledUser||statusData.premiumStatus===PremiumStatus.CanceledPastDue)if(statusData.premiumEndDate)try{var premiumEnd=new Date(statusData.premiumEndDate).getTime();g.settings.set(Settings.premiumEndDate,premiumEnd)}catch(err2){g.reportError(err2)}else g.settings.set(Settings.premiumEndDate,Date.now());else statusData.premiumStatus===PremiumStatus.TrialOver?(this.daysLeftInTrial(-1),this.notifyTrialOver()):statusData.premiumStatus===PremiumStatus.Active&&(g.messageQueue.clearMessage(MessageID.TrialOver),g.settings.get(Settings.notifiedTrialOver)&&g.settings.set(Settings.notifiedTrialOver,!1))}catch(err){g.reportError(err)}else try{if(xhr.response){var statusData=JSON.parse(xhr.response);statusData.code===PrivateAPIErrorCodes.NoSignupFound?(usedInviteCode=!0,goog.onHaveUserSignupData(function(){g.sendEvent("Subscribe","NewUser"),g.reportSignup(goog.getCurrentUserEmail(),goog.getCurrentUserSignupInfo(),function(success){success?this.checkRemotePremiumStatus():this._reportRemoteStatusFailure()}.bind(this))}.bind(this))):this._reportRemoteStatusFailure()}else this._reportRemoteStatusFailure()}catch(err){this._reportRemoteStatusFailure(),g.reportError(err)}hasInviteCode&&!usedInviteCode&&g.messageQueue.pushMessage(MessageID.InviteFailure)}.bind(this)})}.bind(this))}.bind(this))},setLastSignupError:function setLastSignupErrorFn(code){this._lastSignupError=code},_reportRemoteStatusFailure:function _reportRemoteStatusFailureFn(){g.sendEvent("Billing","RemoteStatusFailure")},_updateTrialDaysLeft:function _updateTrialDaysLeftFn(trialStart,trialDuration){var remainingDays=trialDuration-Math.ceil((Date.now()-trialStart)/MS_IN_DAY);try{g.PAssert(3749,320>=remainingDays,"Sanity check on trial length",remainingDays)}catch(PERR){g.reportError(PERR)}this._trialStart(trialStart),this._trialDuration(trialDuration),this.daysLeftInTrial(remainingDays),this._premiumStatus()===PremiumStatus.Trial&&0>remainingDays?(this.setPremiumStatus(PremiumStatus.TrialOver),this.notifyTrialOver()):this._premiumStatus()===PremiumStatus.Trial&&5>remainingDays&&this.notifyTrialEndSoon()},getBillingIdentifier:function getBillingIdentifierFn(){if(!this._billingIdentifier){var user=goog.getCurrentUserEmail()||g.settings.get(Settings.activeUser);user&&(this._billingIdentifier=user)}return this._billingIdentifier},onBillingIdentifierAvailable:function onBillingIdentifierAvailableFn(cb){if(this._billingIdentifier)setTimeout(cb,0);else var infoSub=goog.authenticatedUserInfo.subscribe(function(){infoSub.dispose(),infoSub=void 0,setTimeout(cb,0)})},isPremiumEnabled:function isPremiumEnabledFn(){return this._isEnabled()},hasPremium:function hasPremiumFn(){return this.isPremiumEnabled()&&(this._premiumStatus()===PremiumStatus.Active||this._premiumStatus()===PremiumStatus.PastDue)},isTrialState:function isTrialStateFn(){return this.isPremiumEnabled()&&(this._premiumStatus()===PremiumStatus.Trial||this._premiumStatus()===PremiumStatus.TrialOver)},isCanceledState:function isCanceledStateFn(){return this.isPremiumEnabled()&&(this._premiumStatus()===PremiumStatus.CanceledUser||this._premiumStatus()===PremiumStatus.CanceledPastDue)},canceledUserHasPremiumAccess:function canceledUserHasPremiumAccessFn(){return this.isCanceledState()&&this.getPremiumEndDate().getTime()>Date.now()},isInFreeMonthAndPremium:function isInFreeMonthAndPremiumFn(){return(this.hasPremium()||this.canceledUserHasPremiumAccess())&&this._nonReferralDiscounts()>=100},setBillingData:function setBillingDataFn(data){try{g.PAssert(3750,data,"Must have a valid data bundle")}catch(PERR){g.reportError(PERR)}this.setPremiumStatus(data.premiumStatus),this._inviteCode(data.inviteCode),this._referredBy(data.referredBy),this._joinDate(data.joinDate?new Date(parseInt(data.joinDate)):new Date),this._premiumStartDate(data.premiumStartDate?new Date(parseInt(data.premiumStartDate)):new Date),this._premiumEndDate(data.premiumEndDate?new Date(parseInt(data.premiumEndDate)):new Date),this._nextBillingDate(data.nextBillingDate?new Date(parseInt(data.nextBillingDate)):new Date),this._referralCount(data.totalReferralCount||0),this._usedReferrals(data.totalReferralsUsed||0),this._nextMonthReferrals(data.nextMonthReferrals||0),this._trialStart(data.trialStart?new Date(parseInt(data.trialStart)):new Date),this._trialDuration(data.trialDuration||0),this._nonReferralDiscounts(data.nonReferralDiscounts||0),this._hasValidBillingData(!0),this.updatePremiumBlocks()},setPremiumStatus:function setPremiumStatusFn(status){try{g.PAssert(3751,g.isNumber(status),"Status must be a valid number",status)}catch(PERR){g.reportError(PERR)}try{g.PAssert(3752,status>0&&8>status,"Should be a valid status identifier",status)}catch(PERR){g.reportError(PERR)}var oldStatus=this._premiumStatus();status!==oldStatus&&(this._premiumStatus(status),g.settings.set(Settings.premiumStatus,status),g.fireCustomEvent("premiumStatusChanged"))},hasValidBillingData:function hasValidBillingDataFn(){return this._hasValidBillingData()},getPremiumStatus:function getPremiumStatusFn(){return this._premiumStatus()},getInviteCode:function getInviteCodeFn(){return this._inviteCode()},getJoinDate:function getJoinDateFn(){return this._joinDate()||new Date},getPremiumStartDate:function getPremiumStartDateFn(){return this._premiumStartDate()||new Date},getPremiumEndDate:function getPremiumEndDateFn(){return this._premiumEndDate()||new Date},getNextBillingDate:function getNextBillingDateFn(){return this._nextBillingDate()||new Date},getActiveReferrals:function getActiveReferralsFn(){return this._nextMonthReferrals()},getTotalReferrals:function getTotalReferralsFn(){return this._referralCount()},getUnusedReferrals:function getUnusedReferralsFn(){return this._referralCount()-this._usedReferrals()-this._nextMonthReferrals()},getPastReferrals:function getPastReferralsFn(){return this._usedReferrals()},hasEarlyAccess:function hasEarlyAccessFn(){return this._referralCount()>=EarlyAccessRequirement||this.hasPremium()||this.canceledUserHasPremiumAccess()},initUI:function initUIFn(){try{g.PAssert(3761,!g.isDemoMode(),"Should not be opening premium UI in demo mode")}catch(PERR){g.reportError(PERR)}var refCode=util.getURLParam("invite");refCode&&this.inviteCodeEntered(refCode)},modalOpen:function modalOpenFn(){this._isDialogOpened=!0},modalClose:function modalCloseFn(){},titleText:function titleTextFn(){return this.hasPremium()?"You are a pro":"Become a pro"},subtext:function subtextFn(){return this.hasPremium()?"You are subscribed to the monthly premium plan for $4.99 per month.":"Moo.do is available on every device with realtime collaboration and offline support for free. Signing up for Premium opens up our full suite of plugins and premium features."},trialText:function trialTextFn(){return this.daysLeftInTrial()>0?"You have "+this.daysLeftInTrial()+" days left in your free trial of Moo.do Premium.":"Your free trial has ended. Sign up below to continue using premium features or send us an email at support@moo.do if you need further time to evaluate Moo.do."},onTapMonthly:function onTapMonthlyFn(){this.pricingSelected(Pricing.Monthly),this.isHidden(!1)},onTapYearly:function onTapYearlyFn(){this.pricingSelected(Pricing.Yearly),this.isHidden(!1)},onTapCancel:function onTapCancelFn(){g.menus.closeModal(Modals.PremiumSignup,!1)},onTapCancelSubscription:function onTapCancelSubscriptionFn(){this.isCancelling()||(g.sendEvent("Billing","SubCancelTapped"),g.menus.confirm("Are you sure you want to cancel your subscription?",function(result){result?(g.sendEvent("Billing","SubCancelYES"),this.isCancelling(!0),g.XHR_PrivateAPI({type:"POST",path:"/billing/cancel",data:{email:this.getBillingIdentifier()},requireAuth:!0,cb:function cbFn(xhr){var msg;try{var parsedResponse=JSON.parse(xhr.response)}catch(err){g.reportError(err)}if(200===xhr.status&&parsedResponse){var data=parsedResponse.data,premiumEnd=new Date(data.premiumEndDate).getTime();this._premiumEndDate(new Date(premiumEnd)),g.settings.set(Settings.premiumEndDate,premiumEnd),this.setPremiumStatus(PremiumStatus.CanceledUser),msg="Your premium subscription has been canceled. Please contact support@moo.do if you need assistance."}else msg="There was a server error, please try again in a few minutes or contact support@moo.do.";g.menus.alert({text:msg,actionText:"OKAY"}),this.isCancelling(!1)}.bind(this)})):g.sendEvent("Billing","SubCancelNO")}.bind(this)))},onTapDeleteAccount:function onTapDeleteAccountFn(){g.sendEvent("Billing","DeleteAccountTapped"),g.menus.openModal(Modals.DeleteAccount,function(result){result?(g.sendEvent("Billing","DeleteAccountYES"),this.isDeletingAccount(!0),goog.deleteAccount(function(success,errorCode){success||errorCode===goog.DeleteErrorCode.RootFolder?g.vmMain.docManager.deleteAllDocs(function(fileSuccess){fileSuccess?g.XHR_PrivateAPI({type:"POST",path:"/tracking/delete",data:{email:this.getBillingIdentifier()},requireAuth:!0,cb:function cbFn(xhr){200===xhr.status?(this.isDeletingAccount(!1),g.menus.alert({text:"Your account has been successfully deleted.",actionText:"OKAY",action:function actionFn(){g.vmSetup.logout()
}.bind(this)})):(this.isDeletingAccount(!1),g.menus.alert({text:"There was an error removing your email address from our server. Please contact support@moo.do for further assistance with code 3.",actionText:"OKAY"}))}.bind(this)}):(this.isDeletingAccount(!1),g.menus.alert({text:"There was an error deleting your Moo.do documents. Please contact support@moo.do for further assistance with code 2.",actionText:"OKAY"}))}.bind(this)):(this.isDeletingAccount(!1),g.menus.alert({text:"There was an error deleting your shared account data. Please contact support@moo.do for further assistance with code 1.",actionText:"OKAY"}))}.bind(this))):g.sendEvent("Billing","DeleteAccountNO")}.bind(this))},shouldShowAlready:function shouldShowAlreadyFn(){return this.getPastReferrals()>0},shouldShowNext:function shouldShowNextFn(){return this.isInFreeMonthAndPremium()||this.getActiveReferrals()>2},alreadyText:function alreadyTextFn(){var str="Already saved: ",months=this.getPastReferrals()/NumReferralsTo100;return 1>months?str+100*months+"%":str+months+" months"},thisMonthSubtitle:function thisMonthSubtitleFn(){if(this.isInFreeMonthAndPremium())return"Next month is free!";var str="Next month: ",perc=this.getActiveReferrals()/NumReferralsTo100;return str+100*perc+"% saved"},thisMonthSubtext:function thisMonthSubtextFn(){var num=NumReferralsTo100-this.getActiveReferrals();return this.isInFreeMonthAndPremium()?"Be sure to thank to your friend for inviting you.":0===num?"You get next month for free!":"Invite "+num+" more friend"+(num>1?"s":"")+" to save 100%"},nextMonthSubtitle:function nextMonthSubtitleFn(){var str="Following month",numAvailReferrals=this.getUnusedReferrals();this.isInFreeMonthAndPremium()&&(numAvailReferrals+=this.getActiveReferrals()),numAvailReferrals>NumReferralsTo100&&(str+="s");var perc=numAvailReferrals/NumReferralsTo100;return 0===perc?str:str+": "+100*perc+"%"},nextMonthSubtext:function nextMonthSubtextFn(){var num=0;return num=this.getActiveReferrals()===NumReferralsTo100?this.isInFreeMonthAndPremium()?-this.getUnusedReferrals():NumReferralsTo100-this.getUnusedReferrals():this.isInFreeMonthAndPremium()?NumReferralsTo100-this.getActiveReferrals():NumReferralsTo100-this.getActiveReferrals()+NumReferralsTo100,0>=num?"You get the following month for free too!":"Invite "+num+(this.isInFreeMonthAndPremium()?"":" more")+" friend"+(num>1?"s":"")+" to save 100%"},earlySubtitle:function earlySubtitleFn(){var num=NumReferralsTo100-this.getTotalReferrals();return num>0?"Invite "+num+" "+(NumReferralsTo100>num?"more ":"")+"friend"+(num>1?"s":"")+" to become a Community Member":""},earlySubtext:function earlySubtextFn(){var num=NumReferralsTo100-this.getTotalReferrals();return 1===num?"You're almost there! Just one more!":""},updatePremiumBlocks:function updatePremiumBlocksFn(){if(this.shouldShowAlready()){this.alreadyBlocks.removeAll();for(var numPast=this.getPastReferrals(),i=0;i<Math.max(numPast,NumReferralsTo100);i++)this.alreadyBlocks.push({value:numPast>i})}var numActive=this.getActiveReferrals();this.isInFreeMonthAndPremium()&&(numActive=NumReferralsTo100),this.thisBlocks.removeAll();for(var i=0;NumReferralsTo100>i;i++)this.thisBlocks.push({value:numActive>i});if(this.shouldShowNext()){this.nextBlocks.removeAll();var numNext=this.getUnusedReferrals();this.isInFreeMonthAndPremium()&&(numNext+=this.getActiveReferrals());for(var i=0;NumReferralsTo100>i;i++)this.nextBlocks.push({value:numNext>i})}this.communityBlocks.removeAll();for(var numTotal=this.getTotalReferrals(),i=0;NumReferralsTo100>i;i++)this.communityBlocks.push({value:numTotal>i})},getUserName:function getUserNameFn(){var user=gdata.authenticatedUser();return user?user.displayName:void 0},getWelcomeText:function getWelcomeTextFn(){return"Hi "+this.getUserName()},getInviteUrl:function getInviteUrlFn(){return"https://www.moo.do/#invite="+this.getInviteCode()},getSelectText:function getSelectTextFn(){return"Select and press "+platform.cmdChar+" + C to copy to clipboard"},wasInvited:function wasInvitedFn(){return!!this._referredBy()},isInviteCodeButtonEnabled:function isInviteCodeButtonEnabledFn(){return this.inviteCodeEntered().length>0},isInviteEmailButtonEnabled:function isInviteEmailButtonEnabledFn(){return this.inviteEmailEntered().length>0},onInviteCodeKeyUp:function onInviteCodeKeyUpFn(src,e){e.normCode===KeyCode.Enter&&this.onTapInviteCode(e)},onTapInviteCode:function onTapInviteCodeFn(e){if(this.isInviteCodeButtonEnabled()){var refCode=this.inviteCodeEntered();refCode&&refCode.length>2?(g.sendEvent("Billing","EnterRefCode"),this.isSettingInviteCode(!0),g.XHR_PrivateAPI({type:"POST",path:"/sharing/setReferral",data:{email:this.getBillingIdentifier(),refCode:refCode},requireAuth:!0,autoRetry:!0,cb:function cbFn(xhr){if(this.isSettingInviteCode(!1),xhr.response){try{var parsedResponse=JSON.parse(xhr.response)}catch(err){g.reportError(err)}if(200===xhr.status&&parsedResponse){var data=parsedResponse.data;this._referredBy(data.referredBy),this._premiumStatus(data.premiumStatus),this._nonReferralDiscounts(data.nonReferralDiscounts||0);var trialStart=new Date(data.trialStart).getTime();this._updateTrialDaysLeft(trialStart,data.trialDuration),this.updatePremiumBlocks(),this.inviteCodeError(""),g.sendEvent("Billing","EnterRefCodeSuccess")}else{if(parsedResponse)switch(parsedResponse.code){case PrivateAPIErrorCodes.AlreadyReferred:this.inviteCodeEntered(""),this.inviteCodeError(""),this.checkRemotePremiumStatus();break;case PrivateAPIErrorCodes.InvalidReferralCode:this.inviteCodeError("Referral code not found");break;default:this.inviteCodeError("Unable to use referral code")}else this.inviteCodeError("Unable to contact server");g.sendEvent("Billing","EnterRefCodeFailure")}}else this.inviteCodeError("Unable to contact server"),g.sendEvent("Billing","EnterRefCodeFailure")}.bind(this)})):this.inviteCodeError("Must enter a valid code")}},onInviteEmailKeyUp:function onInviteEmailKeyUpFn(src,e){e.normCode===KeyCode.Enter&&this.onTapEmail(e)},onContactSelected:function onContactSelectedFn(emailAddr){this.inviteEmailEntered(emailAddr)},onTapEmail:function onTapEmailFn(e){if(this.isInviteEmailButtonEnabled()){var emails=this.inviteEmailEntered(),emailList=emails.split(/[,;]+/);if(emailList&&emailList.length>0){for(var localFailedEmails=[],basicEmailRegexp=/.+@.+\..+/i,i=0;i<emailList.length;++i)basicEmailRegexp.lastIndex=0,null===basicEmailRegexp.exec(emailList[i])&&localFailedEmails.push(emailList[i]);0===localFailedEmails.length?(this.isSendingEmail(!0),g.sendEvent("Billing","SendReferralEmail",emailList.length),g.XHR_PrivateAPI({type:"POST",path:"/sharing/sendReferral",data:{fromUser:this.getBillingIdentifier(),toEmailList:emailList},requireAuth:!0,autoRetry:!1,cb:function cbFn(xhr){if(this.isSendingEmail(!1),200===xhr.status&&xhr.response){var remoteFailedEmails;try{var parsedResponse=JSON.parse(xhr.response);remoteFailedEmails=parsedResponse.data}catch(err){g.reportError(err)}if(remoteFailedEmails&&0!==remoteFailedEmails.length){for(var emailList=[],i=0;remoteFailedEmails>i;++i)emailList.push(remoteFailedEmails[i].email);var emailString=emailList.join(",");this.inviteEmailEntered(emailString),this.inviteEmailError("One or more of your emails could not be sent.")}else this.inviteEmailEntered(""),this.inviteEmailSuccess("Invite emails sent!"),this.inviteEmailError(""),setTimeout(function(){this.inviteEmailSuccess("")}.bind(this),4e3)}else this.inviteEmailError("Sorry! There was an error sending emails, please try again later.")}.bind(this)})):this.inviteEmailError("Please enter a valid email: "+localFailedEmails[0])}}},joinDateText:function joinDateTextFn(){return this.getJoinDate().toString(International.getFormat(DFormat.LongStrDate))},premiumStartDateText:function premiumStartDateTextFn(){return this.getPremiumStartDate().toString(International.getFormat(DFormat.LongStrDate))},premiumEndDateText:function premiumEndDateTextFn(){return this.getPremiumEndDate().toString(International.getFormat(DFormat.LongStrDate))},nextBillingDateText:function nextBillingDateTextFn(){return this.getNextBillingDate().toString(International.getFormat(DFormat.LongStrDate))},onTapAccount:function onTapAccountFn(){g.modalSettings.sectionOpened(SettingsSections.Account)},onTapInviteUrl:{onStart:function onStartFn(e){var el=e.target;el!==document.activeElement&&(el.focus(),el.select(),e.preventDefault(),g.sendEvent("Billing","TapInviteUrl"))}},shareTwitter:function shareTwitterFn(){var message="I love this new organization app!",url="https://twitter.com/share?url="+escape(this.getInviteUrl())+"&text="+message;this.showPopup(url,550,420),g.sendEvent("Billing","ShareTwitter")},shareFacebook:function shareFacebookFn(){var url="https://www.facebook.com/sharer/sharer.php?u="+escape(this.getInviteUrl());this.showPopup(url,600,303),g.sendEvent("Billing","ShareFacebook")},shareGoogle:function shareGoogleFn(){var url="https://plus.google.com/share?url="+this.getInviteUrl();this.showPopup(url,500,650),g.sendEvent("Billing","ShareGoogle")},showPopup:function showPopupFn(url,width,height){var e="scrollbars=yes,resizable=yes,toolbar=no,location=yes",n=width,r=height,o=window.screen.height,i=window.screen.width,a=Math.round(i/2-n/2),c=Math.round(o/2-r/2),params=e+",width="+n+",height="+r+",left="+a+",top="+c;window.open(url,null,params)},shouldShowInvitedBy:function shouldShowInvitedByFn(context){return context.$root!==g.menus},onTapSignup:function onTapSignupFn(){g.menus.openModal(Modals.Billing),g.sendEvent("Billing","OpenSignupModal")},notifyTrialOver:function notifyTrialOverFn(){var notified=g.settings.get(Settings.notifiedTrialOver);if(!notified){if(!g.messageQueue)return void setTimeout(this.notifyTrialOver.bind(this),0);g.messageQueue.pushMessage(MessageID.TrialOver),g.settings.set(Settings.notifiedTrialOver,!0)}},notifyTrialEndSoon:function notifyTrialEndSoonFn(){var notified=g.settings.get(Settings.notifiedTrialEndSoon);if(!notified){if(!g.messageQueue)return void setTimeout(this.notifyTrialEndSoon.bind(this),0);g.messageQueue.pushMessage(MessageID.TrialEndSoon),g.settings.set(Settings.notifiedTrialEndSoon,!0)}},isTrialOver:function isTrialOverFn(){return this._premiumStatus()==PremiumStatus.TrialOver}};return util.inherit(ModalBase,BillingManager),util.extend(BillingManager.prototype,BillingManagerFns),BillingManager}),define("Hotkeys",["globals","platform","Sel","edit"],function(g,platform,Sel,edit){function Hotkeys(){function addHotkey(keyCode,primary,shift,callback,stopPropagation){platform.app&&primary!==Primary.Both&&(primary=Primary.Either),_addHotkey(keyCode,primary,shift,callback,stopPropagation)}function _addHotkey(keyCode,primary,shift,callback,stopPropagation){if(hotkeys[keyCode]=hotkeys[keyCode]||[],primary===Primary.Either)return _addHotkey(keyCode,Primary.No,shift,callback),void _addHotkey(keyCode,Primary.Yes,shift,callback);if(shift===Shift.Either)return _addHotkey(keyCode,primary,Shift.No,callback),void _addHotkey(keyCode,primary,Shift.Yes,callback);try{g.PAssert(3764,!platform.windows||primary!==Primary.Both,"Should never require AltGr combo on windows")}catch(PERR){g.reportError(PERR)}var hotkey={mods:{},call:callback};(primary===Primary.Yes||primary===Primary.Both)&&(hotkey.mods[platformPrimaryKey]=!0),(primary===Primary.No||primary===Primary.Both)&&(hotkey.mods[platformSecondaryKey]=!0),shift===Shift.Yes&&(hotkey.mods[Mods.Shift]=!0),hotkeys[keyCode].push(hotkey),hotkey.stopPropagation=stopPropagation}function ignoreKeyOnBody(e){return(platform.mac&&e.metaKey||!platform.mac&&e.ctrlKey)&&e.normCode===KeyCode.A}var hotkeys={},hotkeySearch=function(){var targetPane=g.focusedPane||g.vmMain.paneManager.getPaneAtIndex(0);if(targetPane){var search=targetPane.search;search.isFocused.get()||search.focus(),g.sendEvent("Hotkey","Search")}},hotkeyOutline=function(){g.focusedPane.toggleOutlineVisibility(),g.sendEvent("Hotkey","Outline")},hotkeyP0=function(){g.vmMain.applyPriorityToSelection(VMLIFlag.P0,!0),g.sendEvent("Hotkey","Important")},hotkeyP1=function(){g.vmMain.applyPriorityToSelection(VMLIFlag.P1,!0),g.sendEvent("Hotkey","Important")},hotkeyP2=function(){g.vmMain.applyPriorityToSelection(VMLIFlag.P2,!0),g.sendEvent("Hotkey","Important")},hotkeyStar=function(){g.vmMain.applyFnToSelection("isStarred",{toggle:!0,restoreSelection:!0}),g.sendEvent("Hotkey","Star")},hotkeyComplete=function(){g.vmMain.applyFnToSelection("isComplete",{toggle:!0,restoreSelection:!0}),g.sendEvent("Hotkey","Complete")},hotkeyZoomIn=function(){g.vmMain.applyToSelection(function(item){return item.isNote()||g.vmMain.zoomin(item),!1}),g.sendEvent("Hotkey","ZoomIn")},hotkeyZoomOut=function(){var item=g.focusedItem;item&&item.parent()&&g.vmMain.zoomout(item.parent()),g.sendEvent("Hotkey","ZoomOut")},hotkeyCollapse=function(){g.vmMain.applyToSelection(function(item){g.focusedPane.supportCollapsing&&item.toggleCollapsed(g.focusedPane)}),g.sendEvent("Hotkey","Collapse")},hotkeyCollapseAll=function(){if(g.focusedItem&&g.focusedPane&&g.focusedPane.supportCollapsing){var numChildren=g.focusedItem.numChildren(),children=g.focusedItem.getItems(),numCollapsed=0,numUncollapsed=0,savedSel=Sel.save();g.vmMain.beginUpdateItems();for(var i=0;numChildren>i;++i)children[i].hasChildren()&&(children[i].isCollapsed(g.focusedPane,!1)?numCollapsed++:numUncollapsed++);for(var doCollapse=numUncollapsed>=numCollapsed,i=0;numChildren>i;++i)children[i].hasChildren()&&children[i].setCollapsed(doCollapse,g.focusedPane,!1);g.vmMain.commitUpdateItems(),g.focusedPane.restoreSelectionAfterCollapse(savedSel,doCollapse)}g.sendEvent("Hotkey","CollapseAll")},hotkeyIndent=function(e){e.target!==document.body&&(g.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!1}),g.sendEvent("Hotkey","Indent"))},hotkeyUnindent=function(e){e.target!==document.body&&(g.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!0}),g.sendEvent("Hotkey","Unindent"))},hotkeyFireEvent=function(e){var name=g.enumToString(KeyCode,e.normCode);return g.sendEvent("Hotkey","FireEvent_"+name),name?g.fireCustomEvent("key"+name):void 0},hotkeyClosePane=function(e){var removedID=g.vmMain.paneManager.removeFocusedPane();if(void 0!==removedID){var tracker=require("tracker");tracker.performAction(TrackerType.UIAction,{type:TrackerUIAction.RemovePane,data:removedID}),g.sendEvent("Hotkey","ClosePane"),g.tooltip.hideTip(),e.stopImmediatePropagation()}},hotkeyNOP=function(){},hotkeyPassthrough=function(){return!1},Mods={Ctrl:0,Opt:1,Meta:2,Alt:3,Shift:4},Primary={No:0,Yes:1,Either:2,Both:3},Shift={No:0,Yes:1,Either:2},platformPrimaryKey=platform.mac?Mods.Meta:Mods.Ctrl,platformSecondaryKey=platform.mac?Mods.Ctrl:Mods.Alt;addHotkey(KeyCode.F,Primary.Either,Shift.No,hotkeySearch),addHotkey(KeyCode.O,Primary.No,Shift.No,hotkeyOutline),addHotkey(KeyCode.Slash,Primary.Either,Shift.Either,hotkeyComplete),addHotkey(KeyCode.D1,Primary.No,Shift.No,hotkeyP0),addHotkey(KeyCode.D2,Primary.No,Shift.No,hotkeyP1),addHotkey(KeyCode.D3,Primary.No,Shift.No,hotkeyP2),addHotkey(KeyCode.D8,Primary.Either,Shift.Either,hotkeyStar),addHotkey(KeyCode.Enter,Primary.Either,Shift.No,hotkeyZoomIn),addHotkey(KeyCode.Enter,Primary.Either,Shift.Yes,hotkeyZoomOut),addHotkey(KeyCode.Space,Primary.No,Shift.No,hotkeyCollapse),addHotkey(KeyCode.Space,Primary.No,Shift.Yes,hotkeyCollapseAll),addHotkey(KeyCode.Comma,Primary.No,Shift.No,hotkeyCollapse),addHotkey(KeyCode.Comma,Primary.No,Shift.Yes,hotkeyCollapseAll),addHotkey(KeyCode.Period,Primary.No,Shift.No,hotkeyCollapse),addHotkey(KeyCode.Period,Primary.No,Shift.Yes,hotkeyCollapseAll),addHotkey(KeyCode.LBracket,Primary.Either,Shift.No,hotkeyUnindent),addHotkey(KeyCode.RBracket,Primary.Either,Shift.No,hotkeyIndent),platform.mac?(addHotkey(KeyCode.UpArrow,Primary.Both,Shift.No,edit.moveUp.bind(edit),!0),addHotkey(KeyCode.DownArrow,Primary.Both,Shift.No,edit.moveDown.bind(edit),!0)):(addHotkey(KeyCode.UpArrow,Primary.No,Shift.Yes,edit.moveUp.bind(edit),!0),addHotkey(KeyCode.DownArrow,Primary.No,Shift.Yes,edit.moveDown.bind(edit),!0)),platform.mac&&(addHotkey(KeyCode.LeftArrow,Primary.No,Shift.Yes,hotkeyUnindent,!0),addHotkey(KeyCode.RightArrow,Primary.No,Shift.Yes,hotkeyIndent,!0),addHotkey(KeyCode.L,Primary.No,Shift.No,edit.handleSelectAllItem,!0)),addHotkey(KeyCode.Escape,void 0,Shift.No,hotkeyFireEvent),addHotkey(KeyCode.F4,void 0,Shift.Yes,hotkeyClosePane),addHotkey(KeyCode.Tilde,Primary.Either,Shift.No,hotkeyPassthrough),addHotkey(KeyCode.B,Primary.Yes,Shift.No,hotkeyNOP),addHotkey(KeyCode.I,Primary.Yes,Shift.No,hotkeyNOP),addHotkey(KeyCode.U,Primary.Either,Shift.No,hotkeyNOP),addHotkey(KeyCode.S,Primary.Either,Shift.No,hotkeyNOP);var lastGlobalKeyDown;g.globalKeyDown=function(e){platform.normalizeKeys(e),lastGlobalKeyDown=e.normCode;var result=hotkeys[e.normCode];if(result)if(g.isFunction(result)){try{g.PAssert(3765,!1,"We should not be using this option")}catch(PERR){g.reportError(PERR)}result(e)}else{for(var valid,i=0;i<result.length;i++){var entry=result[i],noMods=!entry.mods,ctrlValid,optValid,metaValid,altValid,shiftValid;if(noMods||(ctrlValid=!!entry.mods[Mods.Ctrl]==!!e.ctrlKey,optValid=!!entry.mods[Mods.Opt]==!!e.optKey,metaValid=!!entry.mods[Mods.Meta]==!!e.metaKey,altValid=!!entry.mods[Mods.Alt]==!!e.altKey,shiftValid=!!entry.mods[Mods.Shift]==!!e.shiftKey),noMods||ctrlValid&&optValid&&metaValid&&altValid&&shiftValid){valid=entry;break}}if(valid){var ret=valid.call(e);if(valid.stopPropagation&&e.stopPropagation(),ret!==!1)return e.handled=!0,e.preventDefault(),!1}}else g.vmMain.updateCursorFromEvent(e);if(platform.android&&e.srcElement===document.body){if(ignoreKeyOnBody(e))return e.preventDefault(),!1;edit.keydown(null,e)}},g.globalKeyUp=function(e){if(platform.normalizeKeys(e),g.vmMain.updateCursorFromEvent(e),platform.windows&&lastGlobalKeyDown!==e.normCode&&(e.normCode===KeyCode.D1||e.normCode===KeyCode.D2||e.normCode===KeyCode.D3||e.normCode===KeyCode.D8)){var result=hotkeys[e.normCode];result&&(g.globalKeyDown(e),lastGlobalKeyDown=void 0)}},document.addEventListener("keydown",g.globalKeyDown,!0),document.addEventListener("keyup",g.globalKeyUp,!0)}return Hotkeys.prototype={},Hotkeys}),"undefined"==typeof DETAILED_STATS&&(DETAILED_STATS=!0),Date.Config={DEBUG:!0,DisableCache:!0},Error.stackTraceLimit=1/0;try{window.__checkpoints|=1,window.__SESSION_ID=Math.round(1e4*Math.random())+"|"+Date.now();var empty=function(){};window.appEvents=window.appEvents||{kbsize:empty,enterBackground:empty,enterForeground:empty,statusBarTap:empty,closeKeyboard:empty,undo:empty,redo:empty,notifyOAuth:empty,features:empty,reportLowMemory:empty,pokeBackground:empty},window.console||(window.console={log:function(){},error:function(){}});var bindLog=!1;window.log=bindLog?function(){}:window.console.log.bind(window.console),window.__log=bindLog?function(){}:window.console.log.bind(window.console),window.__warn=bindLog?function(){}:window.console.warn.bind(window.console),window.__error=bindLog?function(){}:window.console.error.bind(window.console),window.performance&&window.performance.now?(window.log.start=window.performance.now(),window.log.now=function(){return window.performance.now()-window.log.start}):(window.log.start=Date.now(),window.performance={now:function(){return Date.now()-window.log.start}},window.log.now=window.performance.now),window.console.timeStamp||(Object.defineProperty?Object.defineProperty(window.console,"timeStamp",{value:function(){}}):window.console.timeStamp=function(){}),window.console.time||(Object.defineProperty?Object.defineProperty(console,"time",{value:function(){}}):window.console.time=function(){}),window.console.timeEnd||(Object.defineProperty?Object.defineProperty(window.console,"timeEnd",{value:function(){}}):window.console.timeEnd=function(){}),window.console.trace||(Object.defineProperty?Object.defineProperty(window.console,"trace",{value:function(){}}):window.console.trace=function(){}),window.LogLevels={Off:0,Error:1,Warning:2,Timing:4,Data:8,Status:16,Search:32,Timeline:64,Input:128,Tracker:256,Profile:512,PageLoad:1024,Toolbar:2048,Picker:4096,Intro:8192,Import:16384,Version:32768,Settings:65536,Selection:131072,ScrMgr:262144,NativeAuth:524288,DateRoll:1048576,DebugDOM:2097152,RepeatDate:4194304,Connection:8388608,Plugin:16777216,Folders:33554432,Verbose:67108864,Account:134217728,React:268435456},window.LogLevel=LogLevels.Error|LogLevels.Warning,window.ShouldLog=function(mask){return window.DEBUG===mask},window.inspectLocal=function(input){if(!input)return void log("Must specify either an item ID or item object to inspect");var item=input;return"string"==typeof input&&(item=window.getModel(input)),log("---- Inspecting Item:",item.id,"----"),log("  RawText:",item.getRawText()),log("  ParsedText:",item.getParsedText()),log("  Els:",item.els),log('  Parent: "'+item.parent().id+'"'),log("  Date:",item.date()),log("  AllDayDate:",item.allDayDate()),log("--------------------------------------------"),item}}catch(err){console.log("Error in main header",err),window.__ERRORINMAINHEADER=err}!function(){var rqConfig;rqConfig={paths:{ko:"lib/knockout-3.2.0",date:"lib/date",FileSaver:"lib/FileSaver",IndexedDBShim:"lib/IndexedDBShim.min",database:"lib/db",React:"lib/react-with-addons.min",IScroll:"lib/iscroll-probe"},shim:{IScroll:{exports:"IScroll"}},waitSeconds:0},require.config(rqConfig)}(),window.gapiKey="AIzaSyB9HEdSJ-nhLJG_ssSSqhI2DX74GSiKSao";var gapiCalled=!1,gapiLoadError=!1;requirejs(["data","globals","util","SettingsManager","gdata","goog","platform","android","edit","VMMain","VMSetup","VMDebug","VMTimeline","VMMessageQueue","TemplateCache","VMAutocomplete","VMMenus","ScreenManager","VMTooltip","AppCache","NativeBridge","copypaste","International","RepeatDate","BillingManager","Dispatcher","Hotkeys"],function(d,g,util,SettingsManager,gdata,goog,platform,android,edit,VMMain,VMSetup,VMDebug,VMTimeline,VMMessageQueue,TemplateCache,VMAutocomplete,VMMenus,ScreenManager,VMTooltip,AppCache,NativeBridge,copypaste,International,RepeatDate,BillingManager,Dispatcher,Hotkeys){g.checkpoint(Checkpoint.RequireLoaded),window.__ERRORINMAINHEADER&&g.reportError(window.__ERRORINMAINHEADER),g.nativeBridge=new NativeBridge,g.billingManager=new BillingManager,g.runOnLoad(function(){function onorientationchange(){platform.updateOrientation(),platform.mobile&&(g.keyboardToolbar&&g.keyboardToolbar.isVisible()&&g.keyboardToolbar.updatePosition(!0),document.body.scrollTop=0,g.keyboardToolbar&&g.keyboardToolbar.hideTopBarIfLandscape(),android.isEnabled()&&android.isVisible()&&setTimeout(function(){android.updateInputBounds(android.getCurrentVMLI())},0))}function windowResizeHandler(e){g.animFrameOnce("windowResize",windowResize)}function initialize(){initializeCalled||(initializeCalled=!0,g.checkpoint(Checkpoint.InitializeMain),g.openMainPage(),g.registerEvent("ItemCreated","ItemAction","Create"),g.registerEvent("ItemCompleted","ItemAction","Complete"),d.initData(onInitializedData),onInitializedData())}function onInitializedData(){try{if(initializeDataCalled||!initializeCalled||!d.localDataLoaded())return;initializeDataCalled=!0,g.checkpoint(Checkpoint.OnInitializedData),goog.loadClientDefaultFile(),g.isDemoMode()||g.vmMain.setupDateRollover(),g.vmMain.loadData(),ShouldLog(LogLevels.Timing)&&log("Data done loading: ",log.now()),g.menus&&g.menus.bind(),platform.mobile&&(g.ScreenManager=new ScreenManager),new VMAutocomplete}catch(err){g.reportError(err)}}try{g.checkpoint(Checkpoint.PageLoad);try{g.PAssert(3766,"loading"!==document.readyState,"Should only be calling mainjs after document is loaded"+document.readyState)}catch(PERR){g.reportError(PERR)}if("loading"===document.readyState){var errString="ERROR: MainJS running before document load! "+document.readyState;ShouldLog(LogLevels.Error)&&log(errString),g.reportError(new Error(errString))}window.scriptErrors=window.scriptErrors||{};for(var scriptError in window.scriptErrors)g.fireCustomEvent("scriptLoadError",{src:scriptError,id:window.scriptErrors[scriptError],firstChance:!0});if(window.handleLoadError=function handleLoadErrorSecondChanceFn(e){try{window.scriptErrors[e.target.src]=e.target.id,g.fireCustomEvent("scriptLoadError",{src:e.target.src,id:e.target.id,firstChance:!1})}catch(err){g.reportError(err)}},window.oncontextmenu=function(e){platform.normalizeMouse(e),"TEXTAREA"!==e.srcElement.tagName&&"INPUT"!==e.srcElement.tagName&&e.preventDefault()},g.isDemoMode()||platform.offline)var testFn;else{var e=document.createElement("script");e.type="text/javascript",e.src="https://apis.google.com/js/client.js?onload=GoogleApiLoaded",e.async=1,e.id="gapiScript",e.onerror=window.handleLoadError,document.getElementsByTagName("head")[0].appendChild(e),function(i,s,o,g,r,a,m){i.GoogleAnalyticsObject=r,i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date,a=s.createElement(o),m=s.getElementsByTagName(o)[0],a.async=1,a.src=g,m.parentNode.insertBefore(a,m)}(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-37740918-2",{cookieDomain:"auto",siteSpeedSampleRate:50}),ga("require","displayfeatures"),ga("send","pageview")}if(g.isDemoMode()){var panesStart=util.getURLParam("panes");panesStart&&(g.demoPanes=panesStart.split(":"))}setTimeout(function(){g.sendEvent("PageLoad","NewPage")},0);var setupEvent=function(name){document.documentElement.addEventListener(name,function(e){g.reportEvent(e)},!0)};setupEvent("keydown"),setupEvent("keyup"),setupEvent("keypress"),setupEvent("MSPointerDown"),setupEvent("MSPointerUp"),setupEvent("MSPointerHover"),setupEvent("MSPointerCancel"),setupEvent("mousedown"),setupEvent("mouseup"),setupEvent("touchstart"),setupEvent("touchend"),g.tooltip=new VMTooltip,g.AppCache=new AppCache;var erroredPlatform=platform.blockClient();if(void 0!==erroredPlatform){g.errorPlatformInfo=erroredPlatform;var text,showSignup=!1;if(erroredPlatform.platform?erroredPlatform.update?"Firefox"===erroredPlatform.platform?text='Please update your Firefox browser to use Moo.do. Moo.do requires at least Firefox 16. See <a href="https://support.mozilla.org/en-US/kb/update-firefox-latest-version">https://support.mozilla.org/en-US/kb/update-firefox-latest-version</a> for more information.':"Chrome"===erroredPlatform.platform?text='Please update your Chrome browser to use Moo.do. Moo.do requires at least Chrome 26. See <a href="https://support.google.com/chrome/answer/95414">https://support.google.com/chrome/answer/95414</a> for more information.':"Native Android"===erroredPlatform.platform?text="Please update your Android device to use Moo.do. Moo.do requires at least Android 2.1.":"Internet Explorer"===erroredPlatform.platform?text='Please update your Internet Explorer browser to use Moo.do. Moo.do requires at least Internet Explorer 10. See <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie">http://windows.microsoft.com/en-us/internet-explorer/download-ie</a> for more information.':"Safari"===erroredPlatform.platform?text=platform.mobile?"Please update your "+platform.OSName+" to use Moo.do. Moo.do requires at least iOS 6.":'Please update your Safari browser to use Moo.do. Moo.do requires at least Safari 6.1. See <a href="http://support.apple.com/kb/HT6103">http://support.apple.com/kb/HT6103</a> for more information.':(text="Please update your browser to use Moo.do. If you are unable to update your browser, please let us know. Thanks!",showSignup=!0):(showSignup=!0,text="Sorry, we don't support "+erroredPlatform.platform+" yet. Please let us know that you're interested in using "+erroredPlatform.platform+" and we will make it a higher priority. Thanks!"):erroredPlatform.version?text="There was a mandatory update, please update to the latest version of Moo.do. Thanks!":erroredPlatform.cacheUpdate&&(text="There was an issue while updating the app, "+platform.actionVerb()+" to try again.",g.AppCache.update(),erroredPlatform.error&&setTimeout(function(){g.AppCache.runOnFinish(function(){util.insertURLParam("cacheError",!0,!0),g.reload(!0)},!0)},100)),text){var submitFn=function(){return g.requestNotification(navigator.userAgent)},refreshFn=function(){g.AppCache.runOnFinish(function(){g.reload(!0)},!0)};g.applyBindings({platformError:text,showSignup:showSignup,onTapRefresh:refreshFn,onTapSubmit:submitFn},"OSError")}return g.removeDOM("outerWrapper"),g.removeDOM("setupWrapper"),void g.removeDOM("templates")}if(util.removeURLParam("cacheError",!0),g.removeDOM("OSError"),g.localDocChangeRequested=!1,!g.isDemoMode()){var notifiedDocChange=!1;g.settings.registerForChangeNotification(Settings.gdocId,void 0,function(oldValue,newValue){!g.localDocChangeRequested&&oldValue&&oldValue!==newValue&&(notifiedDocChange||(notifiedDocChange=!0,g.menus.alert({text:"The document was changed in another tab. Please close this tab or reload.",actionText:"RELOAD",action:g.reload})))})}new VMMenus,g.vmDebug=new VMDebug,g.vmSetup=new VMSetup,Dispatcher.listen("remoteDataLoaded",function(){var fileForceID=util.getURLParam("file"),stateInfo=util.getURLParam("state");if(fileForceID||stateInfo){if(!fileForceID)try{var stateObj=JSON.parse(stateInfo);"open"===stateObj.action&&stateObj.ids&&stateObj.ids.length>=0&&(fileForceID=stateObj.ids[0])}catch(err){g.reportError(err)}var currentDocID=goog.getDocId();fileForceID&&currentDocID!==fileForceID&&g.menus.alert({text:"You have requested to view another document.",actionText:"OPEN IT",action:function actionFn(){try{g.PAssert(3768,g.vmMain&&g.vmMain.vmPicker,"VMMain must be initialized before loading another doc")}catch(PERR){g.reportError(PERR)}g.vmMain.vmPicker.requestOpenDocument(fileForceID)}})}});var windowResize=function(e){var w=document.body.clientWidth,h=document.body.clientHeight,oldWidth=platform.windowWidth(),oldHeight=platform.windowHeight();if(platform.ipad&&!platform.app&&e!==!0&&e!==!1&&setTimeout(windowResize,0,!0),w!==oldWidth||h!==oldHeight){var savedScroll;if(platform.mobile&&g.focusedPane)if(g.vmMain.selected().length>0){var item=g.vmMain.selected()[0],index=g.focusedPane.indexOfItem(item);savedScroll={index:g.focusedPane.indexOfItem(item)}}else{var index=g.focusedPane.indexOfTop();savedScroll=g.focusedPane.saveScrollRelativeToIndex(index)}if(platform.windowWidth(w),platform.windowHeight(h),platform.onResize.notify(),g.documentHeight=h,g.isMainPageOpen){var heightDelta=h-oldHeight,kbClosed=(platform.android||platform.mobileie)&&h>oldHeight&&(!platform.app||heightDelta<=platform.kbsize)&&g.vmMain&&g.vmMain.isLoaded;kbClosed&&g.blurActiveElement(),g.autocomplete&&kbClosed&&g.autocomplete.hide(),oldWidth!==w&&e&&platform.mobile&&(g.menus&&g.menus.onResize(),g.ScreenManager&&g.ScreenManager.updatePanePosition(),g.isKeyboardOpen&&g.focusedPane.addPadding(),savedScroll&&g.focusedPane.restoreScrollRelativeToIndex(savedScroll)),platform.mobile||(g.fireCustomEvent("windowResize"),Dispatcher.fireEvent("windowResize",[]))}}};if(windowResize(!1),onorientationchange(),ShouldLog(LogLevels.Timing)&&log("Running main.js: ",log.now()),g.isDemoMode()||!platform.offline&&window.gapi&&window.gapi.auth&&!gapiCalled&&GoogleApiLoaded(),platform.mobile?(g.removeDOM("desktopMenu"),g.removeDOM("contextMenuItem"),g.removeDOM("contextMenuItem_Drive"),g.removeDOM("contextMenuDocuments"),g.removeDOM("contextMenuOptions"),g.removeDOM("contextMenuAddPane"),g.removeDOM("contextMenuLink"),g.removeDOM("contextMenuHeart"),g.removeDOM("exportData"),g.removeDOM("importData"),g.removeDOM("settings")):(g.removeDOM("phoneMenu"),g.removeDOM("mobileKeyboardToolbar"),g.removeDOM("mobileSettings"),g.removeDOM("contextMenuMobileExternalApp"),platform.touch||g.removeDOM("rightMenuPhone")),window.onblur=function(){g.hasFocus=!1},window.onfocus=function(){g.hasFocus=!0,goog.onFocusHandler()},new VMMain,g.timeline=new VMTimeline,platform.mobile?window.addEventListener("resize",windowResizeHandler):window.addEventListener("resize",windowResize),window.addEventListener("orientationchange",onorientationchange),platform.mobileie){document.addEventListener("focusin",function(e){if("HTML"===e.target.tagName)if(android.isEnabled())if(android.isVisible())android.finishInput(!1);
else{var activeSearch=g.getActiveSearch();activeSearch&&activeSearch.isFocused.get()&&activeSearch.onblur()}else log("Skipping Close - Not Android")});var lastScroll=0,preventScrollInterval;window.addEventListener("scroll",function(){lastScroll=Date.now(),preventScrollInterval||(preventScrollInterval=setInterval(function(){Date.now()-lastScroll>5e3&&(clearInterval(preventScrollInterval),preventScrollInterval=void 0),window.scrollTo(0,0)},15))})}window.addEventListener("dragstart",function(dragEvent){return dragEvent.preventDefault(),!1}),window.addEventListener("dragover",function(dragEvent){return dragEvent.preventDefault(),!1});var initializeCalled=!1,initializeDataCalled=!1;g.vmSetup.loginState.subscribe(function(loginState){loginState==LoginState.LOGGED_IN?(initialize(),g.openMainPage()):loginState==LoginState.LOGGED_OUT&&(g.isSetupPageOpen||(g.isSetupPageOpen=!0,util.hasURLParam("login","true")||g.openSetupPage(),g.vmSetup.openLogin())),g.vmMain.setGDriveStatus(platform.offline||!navigator.onLine?DriveStatus.Offline:DriveStatus.Connecting)}),g.vmSetup.init(),g.isDemoMode()&&initialize();var loginState=g.getLoginState();loginState!=LoginState.LOGGED_OUT?d.initData(initialize):!g.isDemoMode()&&platform.app&&g.nativeBridge.sendToApp("loaded"),platform.mobile||new Hotkeys;var liveReloadAddress}catch(mainErr){g.handleCriticalError(),g.reportError(mainErr,"Critical Error")}})}),define("main",function(){});
//# sourceMappingURL=main-min.js.map