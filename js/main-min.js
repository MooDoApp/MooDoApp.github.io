function dateWrapper(){this.dateLibLoaded=!0,Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"am",pmDesignator:"pm",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^sun(day)?/i,mon:/^mon(day)?/i,tue:/^tue(s(day)?)?/i,wed:/^wed(nesday)?/i,thu:/^thu(rsday)?/i,fri:/^fri(day)?/i,sat:/^sat(urday)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,yesterday:/^yesterday/i,today:/^today/i,tomorrow:/^tom(orrow)?/i,soon:/^soon/i,later:/^later/i,now:/^now/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]},function(){var e=Date,t=e.prototype,r=e.CultureInfo,i=function(e,t){return t||(t=2),("000"+e).slice(-1*t)};t.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},t.setTimeToNow=function(){var e=new Date;return this.setHours(e.getHours()),this.setMinutes(e.getMinutes()),this.setSeconds(e.getSeconds()),this.setMilliseconds(e.getMilliseconds()),this},e.today=function(){return(new Date).clearTime()},e.compare=function(e,t){if(isNaN(e)||isNaN(t))throw new Error(e+" - "+t);if(e instanceof Date&&t instanceof Date)return t>e?-1:e>t?1:0;throw new TypeError(e+" - "+t)},e.equals=function(e,t){return 0===e.compareTo(t)},e.getDayNumberFromName=function(e){for(var t=r.dayNames,i=r.abbreviatedDayNames,n=r.shortestDayNames,o=e.toLowerCase(),a=0;a<t.length;a++)if(t[a].toLowerCase()==o||i[a].toLowerCase()==o||n[a].toLowerCase()==o)return a;return-1},e.getMonthNumberFromName=function(e){for(var t=r.monthNames,i=r.abbreviatedMonthNames,n=e.toLowerCase(),o=0;o<t.length;o++)if(t[o].toLowerCase()==n||i[o].toLowerCase()==n)return o;return-1},e.isLeapYear=function(e){return e%4===0&&e%100!==0||e%400===0},e.getDaysInMonth=function(t,r){return[31,e.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][r]},e.getTimezoneAbbreviation=function(e){for(var t=r.timezones,i=0;i<t.length;i++)if(t[i].offset===e)return t[i].name;return null},e.getTimezoneOffset=function(e){for(var t=r.timezones,i=0;i<t.length;i++)if(t[i].name===e.toUpperCase())return t[i].offset;return null},t.clone=function(){var e=new Date(this.getTime());return e._explicitTime=this._explicitTime,e},t.compareTo=function(e){return Date.compare(this,e)},t.equals=function(e){return Date.equals(this,e||new Date)},t.between=function(e,t){return this.getTime()>=e.getTime()&&this.getTime()<=t.getTime()},t.isAfter=function(e){return 1===this.compareTo(e||new Date)},t.isBefore=function(e){return-1===this.compareTo(e||new Date)},t.isToday=function(){return this.isSameDay(new Date)},t.isSameDay=function(e){return this.clone().clearTime().equals(e.clone().clearTime())},t.addMilliseconds=function(e){return this.setMilliseconds(this.getMilliseconds()+e),this},t.addSeconds=function(e){return this.addMilliseconds(1e3*e)},t.addMinutes=function(e){return this.addMilliseconds(6e4*e)},t.addHours=function(e){return this.addMilliseconds(36e5*e)},t.addDays=function(e){return this.setDate(this.getDate()+e),this},t.addWeeks=function(e){return this.addDays(7*e)},t.addMonths=function(t){var r=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+t),this.setDate(Math.min(r,e.getDaysInMonth(this.getFullYear(),this.getMonth()))),this},t.addYears=function(e){return this.addMonths(12*e)},t.add=function(e){if("number"==typeof e)return this._orient=e,this;var t=e;return t.millisecond&&this.addMilliseconds(t.millisecond),t.second&&this.addSeconds(t.second),t.minute&&this.addMinutes(t.minute),t.hour&&this.addHours(t.hour),t.week&&this.addWeeks(t.week),t.month&&this.addMonths(t.month),t.years&&this.addYears(t.years),t.days&&this.addDays(t.days),t.setExplicitTime&&(this._explicitTime=!0),this};var n,o,a;t.getWeek=function(){var e,t,r,i,s,c,d,l,u,h;return n=n?n:this.getFullYear(),o=o?o:this.getMonth()+1,a=a?a:this.getDate(),2>=o?(e=n-1,t=(e/4|0)-(e/100|0)+(e/400|0),r=((e-1)/4|0)-((e-1)/100|0)+((e-1)/400|0),u=t-r,s=0,c=a-1+31*(o-1)):(e=n,t=(e/4|0)-(e/100|0)+(e/400|0),r=((e-1)/4|0)-((e-1)/100|0)+((e-1)/400|0),u=t-r,s=u+1,c=a+(153*(o-3)+2)/5+58+u),d=(e+t)%7,i=(c+d-s)%7,l=c+3-i|0,h=0>l?53-((d-u)/5|0):l>364+u?1:(l/7|0)+1,n=o=a=null,h},t.getISOWeek=function(){return n=this.getUTCFullYear(),o=this.getUTCMonth()+1,a=this.getUTCDate(),i(this.getWeek())},t.setWeek=function(e){return this.moveToDayOfWeek(1).addWeeks(e-this.getWeek())},e._validate=function(e,t,r,i){if("undefined"==typeof e)return!1;if("number"!=typeof e)throw new TypeError(e+" is not a Number.");if(t>e||e>r)throw new RangeError(e+" is not a valid value for "+i+".");return!0},e.validateMillisecond=function(t){return e._validate(t,0,999,"millisecond")},e.validateSecond=function(t){return e._validate(t,0,59,"second")},e.validateMinute=function(t){return e._validate(t,0,59,"minute")},e.validateHour=function(t){return e._validate(t,0,23,"hour")},e.validateDay=function(t,r,i){return e._validate(t,1,e.getDaysInMonth(r,i),"day")},e.validateMonth=function(t){return e._validate(t,0,11,"month")},e.validateYear=function(t){return e._validate(t,0,9999,"year")},t.set=function(t){return e.validateMillisecond(t.millisecond)&&this.addMilliseconds(t.millisecond-this.getMilliseconds()),e.validateSecond(t.second)&&this.addSeconds(t.second-this.getSeconds()),e.validateMinute(t.minute)&&this.addMinutes(t.minute-this.getMinutes()),e.validateHour(t.hour)&&this.addHours(t.hour-this.getHours()),e.validateMonth(t.month)&&this.addMonths(t.month-this.getMonth()),e.validateYear(t.year)&&this.addYears(t.year-this.getFullYear()),e.validateDay(t.day,this.getFullYear(),this.getMonth())&&this.addDays(t.day-this.getDate()),t.timezone&&this.setTimezone(t.timezone),t.timezoneOffset&&this.setTimezoneOffset(t.timezoneOffset),t.week&&e._validate(t.week,0,53,"week")&&this.setWeek(t.week),t.setExplicitTime&&(this._explicitTime=!0),this},t.moveToFirstDayOfMonth=function(){return this.set({day:1})},t.moveToLastDayOfMonth=function(){return this.set({day:e.getDaysInMonth(this.getFullYear(),this.getMonth())})},t.moveToNthOccurrence=function(e,t){var r=0;if(t>0)r=t-1;else if(-1===t)return this.moveToLastDayOfMonth(),this.getDay()!==e&&this.moveToDayOfWeek(e,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(e,1).addWeeks(r)},t.moveToDayOfWeek=function(e,t){var r=(e-this.getDay()+7*(t||1))%7;return this.addDays(0===r?r+=7*(t||1):r)},t.moveToMonth=function(e,t){var r=(e-this.getMonth()+12*(t||1))%12;return this.addMonths(0===r?r+=12*(t||1):r)},t.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1},t.getTimezone=function(){return e.getTimezoneAbbreviation(this.getUTCOffset())},t.setTimezoneOffset=function(e){var t=this.getTimezoneOffset(),r=-6*Number(e)/10;return this.addMinutes(r-t)},t.setTimezone=function(t){return this.setTimezoneOffset(e.getTimezoneOffset(t))},t.hasDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset()},t.isDaylightSavingTime=function(){return this.hasDaylightSavingTime()&&(new Date).getTimezoneOffset()===Date.today().set({month:6,day:1}).getTimezoneOffset()},t.getUTCOffset=function(){var e,t=-10*this.getTimezoneOffset()/6;return 0>t?(e=(t-1e4).toString(),e.charAt(0)+e.substr(2)):(e=(t+1e4).toString(),"+"+e.substr(1))},t.getElapsed=function(e){return(e||new Date)-this},t.toISOString||(t.toISOString=function(){function e(e){return 10>e?"0"+e:e}return'"'+this.getUTCFullYear()+"-"+e(this.getUTCMonth()+1)+"-"+e(this.getUTCDate())+"T"+e(this.getUTCHours())+":"+e(this.getUTCMinutes())+":"+e(this.getUTCSeconds())+'Z"'}),t._toString=t.toString,t.toString=function(e){var t=this;if(e&&1==e.length){var n=r.formatPatterns;switch(t.t=t.toString,e){case"d":return t.t(n.shortDate);case"D":return t.t(n.longDate);case"F":return t.t(n.fullDateTime);case"m":return t.t(n.monthDay);case"r":return t.t(n.rfc1123);case"s":return t.t(n.sortableDateTime);case"t":return t.t(n.shortTime);case"T":return t.t(n.longTime);case"u":return t.t(n.universalSortableDateTime);case"y":return t.t(n.yearMonth)}}var o=function(e){switch(1*e){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};return e?e.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(e){if("\\"===e.charAt(0))return e.replace("\\","");switch(t.h=t.getHours,e){case"hh":return i(t.h()<13?0===t.h()?12:t.h():t.h()-12);case"h":return t.h()<13?0===t.h()?12:t.h():t.h()-12;case"HH":return i(t.h());case"H":return t.h();case"mm":return i(t.getMinutes());case"m":return t.getMinutes();case"ss":return i(t.getSeconds());case"s":return t.getSeconds();case"yyyy":return i(t.getFullYear(),4);case"yy":return i(t.getFullYear());case"dddd":return r.dayNames[t.getDay()];case"ddd":return r.abbreviatedDayNames[t.getDay()];case"dd":return i(t.getDate());case"d":return t.getDate();case"MMMM":return r.monthNames[t.getMonth()];case"MMM":return r.abbreviatedMonthNames[t.getMonth()];case"MM":return i(t.getMonth()+1);case"M":return t.getMonth()+1;case"t":return t.h()<12?r.amDesignator.substring(0,1):r.pmDesignator.substring(0,1);case"tt":return t.h()<12?r.amDesignator:r.pmDesignator;case"S":return o(t.getDate());default:return e}}):this._toString()}}(),function(){var e=Date,t=e.prototype,r=e.CultureInfo,i=Number.prototype;t._orient=1,t._nth=null,t._is=!1,t._same=!1,t._explicitTime=!1,t._isSecond=!1,i._dateElement="day",t.next=function(){return this._orient=1,this},e.next=function(){return e.today().next()},t.last=t.prev=t.previous=function(){return this._orient=-1,this},e.last=e.prev=e.previous=function(){return e.today().last()},t.is=function(){return this._is=!0,this},t.same=function(){return this._same=!0,this._isSecond=!1,this},t.today=function(){return this.same().day()},t.weekday=function(){return this._is?(this._is=!1,!this.is().sat()&&!this.is().sun()):!1},t.at=function(t){return"string"==typeof t?e.parse(this.toString("d")+" "+t):this.set(t)},i.fromNow=i.after=function(e){var t={};return t[this._dateElement]=this,(e?e.clone():new Date).add(t)},i.ago=i.before=function(e){var t={};return t[this._dateElement]=-1*this,(e?e.clone():new Date).add(t)};var n,o="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),a="january february march april may june july august september october november december".split(/\s/),s=[],c=[],d="final first second third fourth fifth".split(/\s/);t.toObject=function(){for(var e={},t=0;t<s.length;t++)e[s[t].toLowerCase()]=this["get"+c[t]]();return e},e.fromObject=function(e){return e.week=null,Date.today().set(e)};for(var l=function(t){return function(){if(this._is)return this._is=!1,this.getDay()==t;if(null!==this._nth){this._isSecond&&this.addSeconds(-1*this._orient),this._isSecond=!1;var r=this._nth;this._nth=null;var i=this.clone().moveToLastDayOfMonth();if(this.moveToNthOccurrence(t,r),this>i)throw new RangeError(e.getDayName(t)+" does not occur "+r+" times in the month of "+e.getMonthName(i.getMonth())+" "+i.getFullYear()+".");return this}return this.moveToDayOfWeek(t,this._orient)}},u=function(t){return function(){var i=e.today(),n=t-i.getDay();return(0===t&&1===r.firstDayOfWeek&&0!==i.getDay()||0>n)&&(n+=7),i.addDays(n)}},h=0;h<o.length;h++)e[o[h].toUpperCase()]=e[o[h].toUpperCase().substring(0,3)]=h,e[o[h]]=e[o[h].substring(0,3)]=u(h),t[o[h]]=t[o[h].substring(0,3)]=l(h);for(var p=function(e){return function(){return this._is?(this._is=!1,this.getMonth()===e):this.moveToMonth(e,this._orient)}},m=function(t){return function(){return e.today().set({month:t,day:1})}},f=0;f<a.length;f++)e[a[f].toUpperCase()]=e[a[f].toUpperCase().substring(0,3)]=f,e[a[f]]=e[a[f].substring(0,3)]=m(f),t[a[f]]=t[a[f].substring(0,3)]=p(f);for(var g=function(e){return function(){if(this._isSecond)return this._isSecond=!1,this;if(this._same){this._same=this._is=!1;for(var t=this.toObject(),r=(arguments[0]||new Date).toObject(),i="",n=e.toLowerCase(),o=s.length-1;o>-1;o--){if(i=s[o].toLowerCase(),t[i]!=r[i])return!1;if(n==i)break}return!0}return"s"!=e.substring(e.length-1)&&(e+="s"),this["add"+e](this._orient)}},v=function(e){return function(){return this._dateElement=e,this}},y=0;y<s.length;y++)n=s[y].toLowerCase(),t[n]=t[n+"s"]=g(s[y]),i[n]=i[n+"s"]=v(n);t._ss=g("Second");for(var b=function(e){return function(t){return this._same?this._ss(arguments[0]):t||0===t?this.moveToNthOccurrence(t,e):(this._nth=e,2!==e||void 0!==t&&null!==t?this:(this._isSecond=!0,this.addSeconds(this._orient)))}},S=0;S<d.length;S++)t[d[S]]=b(0===S?-1:S)}(),function(){Date.Parsing={Exception:function(e){this.message="Parse error at '"+e.substring(0,10)+" ...'"}};for(var e=Date.Parsing,t=e.Operators={rtoken:function(t){return function(r){var i=r.match(t);if(i)return[i[0],r.substring(i[0].length)];throw new e.Exception(r)}},token:function(){return function(e){return t.rtoken(new RegExp("^s*"+e+"s*"))(e)}},stoken:function(e){return t.rtoken(new RegExp("^"+e))},until:function(e){return function(t){for(var r=[],i=null;t.length;){try{i=e.call(this,t)}catch(n){r.push(i[0]),t=i[1];continue}break}return[r,t]}},many:function(e){return function(t){for(var r=[],i=null;t.length;){try{i=e.call(this,t)}catch(n){return[r,t]}r.push(i[0]),t=i[1]}return[r,t]}},optional:function(e){return function(t){var r=null;try{r=e.call(this,t)}catch(i){return[null,t]}return[r[0],r[1]]}},not:function(t){return function(r){try{t.call(this,r)}catch(i){return[null,r]}throw new e.Exception(r)}},ignore:function(e){return e?function(t){var r=null;return r=e.call(this,t),[null,r[1]]}:null},product:function(){for(var e=arguments[0],r=Array.prototype.slice.call(arguments,1),i=[],n=0;n<e.length;n++)i.push(t.each(e[n],r));return i},cache:function(t){var r={},i=null;return function(n){try{i=r[n]=r[n]||t.call(this,n)}catch(o){i=r[n]=o}if(i instanceof e.Exception)throw i;return i}},any:function(){var t=arguments;return function(r){for(var i=null,n=0;n<t.length;n++)if(null!=t[n]){try{i=t[n].call(this,r)}catch(o){i=null}if(i)return i}throw new e.Exception(r)}},each:function(){var t=arguments;return function(r){for(var i=[],n=null,o=0;o<t.length;o++)if(null!=t[o]){try{n=t[o].call(this,r)}catch(a){throw new e.Exception(r)}i.push(n[0]),r=n[1]}return[i,r]}},all:function(){var e=arguments,t=t;return t.each(t.optional(e))},sequence:function(r,i,n){return i=i||t.rtoken(/^\s*/),n=n||null,1==r.length?r[0]:function(t){for(var o=null,a=null,s=[],c=0;c<r.length;c++){try{o=r[c].call(this,t)}catch(d){break}s.push(o[0]);try{a=i.call(this,o[1])}catch(l){a=null;break}t=a[1]}if(!o)throw new e.Exception(t);if(a)throw new e.Exception(a[1]);if(n)try{o=n.call(this,o[1])}catch(u){throw new e.Exception(o[1])}return[s,o?o[1]:t]}},between:function(e,i,n){n=n||e;var o=t.each(t.ignore(e),i,t.ignore(n));return function(e){var t=o.call(this,e);return[[t[0][0],r[0][2]],t[1]]}},list:function(e,r,i){return r=r||t.rtoken(/^\s*/),i=i||null,e instanceof Array?t.each(t.product(e.slice(0,-1),t.ignore(r)),e.slice(-1),t.ignore(i)):t.each(t.many(t.each(e,t.ignore(r))),px,t.ignore(i))},set:function(r,i,n){return i=i||t.rtoken(/^\s*/),n=n||null,function(o){for(var a=null,s=null,c=null,d=null,l=[[],o],u=!1,h=0;h<r.length;h++){c=null,s=null,a=null,u=1==r.length;try{a=r[h].call(this,o)}catch(p){continue}if(d=[[a[0]],a[1]],a[1].length>0&&!u)try{c=i.call(this,a[1])}catch(m){u=!0}else u=!0;if(u||0!==c[1].length||(u=!0),!u){for(var f=[],g=0;g<r.length;g++)h!=g&&f.push(r[g]);s=t.set(f,i).call(this,c[1]),s[0].length>0&&(d[0]=d[0].concat(s[0]),d[1]=s[1])}if(d[1].length<l[1].length&&(l=d),0===l[1].length)break}if(0===l[0].length)return l;if(n){try{c=n.call(this,l[1])}catch(v){throw new e.Exception(l[1])}l[1]=c[1]}return l}},forward:function(e,t){return function(r){return e[t].call(this,r)}},replace:function(e,t){return function(r){var i=e.call(this,r);return[t,i[1]]}},process:function(e,t){return function(r){var i=e.call(this,r);return[t.call(this,i[0]),i[1]]}},min:function(t,r){return function(i){var n=r.call(this,i);if(n[0].length<t)throw new e.Exception(i);return n}}},i=function(e){return function(){var t=null,r=[];if(arguments.length>1?t=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(t=arguments[0]),!t)return e.apply(null,arguments);for(var i=0,n=t.shift();i<n.length;i++)return t.unshift(n[i]),r.push(e.apply(null,t)),t.shift(),r}},n="optional not ignore cache".split(/\s/),o=0;o<n.length;o++)t[n[o]]=i(t[n[o]]);for(var a=function(e){return function(){return arguments[0]instanceof Array?e.apply(null,arguments[0]):e.apply(null,arguments)}},s="each any all".split(/\s/),c=0;c<s.length;c++)t[s[c]]=a(t[s[c]])}(),function(){var e=Date,t=(e.prototype,e.CultureInfo),r=function(e){for(var t=[],i=0;i<e.length;i++)e[i]instanceof Array?t=t.concat(r(e[i])):e[i]&&t.push(e[i]);return t};e.Grammar={},e.Translator={hour:function(e){return function(){this.hour=Number(e),this.setExplicitTime=!0}},minute:function(e){return function(){this.minute=Number(e),this.setExplicitTime=!0}},second:function(e){return function(){this.second=Number(e),this.setExplicitTime=!0}},meridian:function(e){return function(){this.meridian=e.slice(0,1).toLowerCase()}},timezone:function(e){return function(){var t=e.replace(/[^\d\+\-]/g,"");t.length?this.timezoneOffset=Number(t):this.timezone=e.toLowerCase()}},day:function(e){var t=e[0];return function(){this.day=Number(t.match(/\d+/)[0])}},month:function(e){return function(){this.month=3==e.length?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(e)/4:Number(e)-1}},year:function(e){return function(){var r=Number(e);this.year=e.length>2?r:r+(r+2e3<t.twoDigitYearMax?2e3:1900)}},rday:function(e){return function(){(new Date).getDate();switch(e){case"yesterday":this.days=-1;break;case"later":this.days=5;break;case"soon":this.days=2;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(t){t=t instanceof Array?t:[t];for(var r=0;r<t.length;r++)t[r]&&t[r].call(this);var i=new Date;if(!this.hour&&!this.minute||this.month||this.year||this.day||(this.day=i.getDate()),this.year||(this.year=i.getFullYear(),this.month<i.getMonth()&&this.year++),this.month||0===this.month||(this.month=i.getMonth()),this.day||(this.day=1),this.hour||(this.hour=0),this.minute||(this.minute=0),this.second||(this.second=0),this.meridian&&this.hour&&("p"==this.meridian&&this.hour<12?this.hour=this.hour+12:"a"==this.meridian&&12==this.hour&&(this.hour=0)),this.day>e.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");var n=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);return n._explicitTime=this.setExplicitTime,this.timezone?n.set({timezone:this.timezone}):this.timezoneOffset&&n.set({timezoneOffset:this.timezoneOffset}),n},finish:function(t){if(t=t instanceof Array?r(t):[t],0===t.length)return null;for(var i=0;i<t.length;i++)"function"==typeof t[i]&&t[i].call(this);var n=e.today();if(this.now&&!this.unit&&!this.operator)return new Date;this.now&&(n=new Date);var o,a,s,c=!!this.year,d=!!(this.days&&null!==this.days||this.orient||this.operator);if(s="past"==this.orient||"subtract"==this.operator?-1:1,this.now||-1=="hour minute second".indexOf(this.unit)||n.setTimeToNow(),(this.month||0===this.month)&&-1!="year day hour minute second".indexOf(this.unit)&&(this.value=this.month+1,this.month=null,d=!0),!d&&this.weekday&&!this.day&&!this.days){var l=Date[this.weekday]();this.day=l.getDate(),this.month||(this.month=l.getMonth()),this.year=l.getFullYear()}if(d&&this.weekday&&"month"!=this.unit&&(this.unit="day",o=e.getDayNumberFromName(this.weekday)-n.getDay(),a=7,this.days=o?(o+s*a)%a:s*a),this.month&&"day"==this.unit&&this.operator&&(this.value=this.month+1,this.month=null),null!=this.value&&null!=this.month&&null!=this.year&&(this.day=1*this.value),this.month&&!this.day&&this.value&&(n.set({day:1*this.value}),d||(this.day=1*this.value)),this.month||!this.value||"month"!=this.unit||this.now||(this.month=this.value,d=!0),d&&(this.month||0===this.month)&&"year"!=this.unit&&(this.unit="month",o=this.month-n.getMonth(),a=12,this.months=o?(o+s*a)%a:s*a,this.month=null),this.unit||(this.unit="day"),!this.value&&this.operator&&null!==this.operator&&this[this.unit+"s"]&&null!==this[this.unit+"s"]?this[this.unit+"s"]=this[this.unit+"s"]+("add"==this.operator?1:-1)+(this.value||0)*s:(null==this[this.unit+"s"]||null!=this.operator)&&(this.value||(this.value=1),this[this.unit+"s"]=this.value*s),this.meridian&&this.hour&&("p"==this.meridian&&this.hour<12?this.hour=this.hour+12:"a"==this.meridian&&12==this.hour&&(this.hour=0)),this.weekday&&!this.day&&!this.days){var l=Date[this.weekday]();this.day=l.getDate(),l.getMonth()!==n.getMonth()&&(this.month=l.getMonth())}return!this.month&&0!==this.month||this.day||(this.day=1),this.orient||this.operator||"week"!=this.unit||!this.value||this.day||this.month?(d&&this.timezone&&this.day&&this.days&&(this.day=this.days),!c&&this.month<n.getMonth()&&(this.year=n.getFullYear()+1),d?n.add(this):n.set(this)):Date.today().setWeek(this.value)}};var i,n=e.Parsing.Operators,o=e.Grammar,a=e.Translator;o.datePartDelimiter=n.rtoken(/^([\s\-\.\,\/\x27]+)/),o.timePartDelimiter=n.stoken(":"),o.whiteSpace=n.rtoken(/^\s*/),o.generalDelimiter=n.rtoken(/^(([\s\,]|at|@|on)+)/);var s={};o.ctoken=function(e){var r=s[e];if(!r){for(var i=t.regexPatterns,o=e.split(/\s+/),a=[],c=0;c<o.length;c++)a.push(n.replace(n.rtoken(i[o[c]]),o[c]));r=s[e]=n.any.apply(null,a)}return r},o.ctoken2=function(e){return n.rtoken(t.regexPatterns[e])},o.h=n.cache(n.process(n.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),a.hour)),o.hh=n.cache(n.process(n.rtoken(/^(0[0-9]|1[0-2])/),a.hour)),o.H=n.cache(n.process(n.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),a.hour)),o.HH=n.cache(n.process(n.rtoken(/^([0-1][0-9]|2[0-3])/),a.hour)),o.m=n.cache(n.process(n.rtoken(/^([0-5][0-9]|[0-9])/),a.minute)),o.mm=n.cache(n.process(n.rtoken(/^[0-5][0-9]/),a.minute)),o.s=n.cache(n.process(n.rtoken(/^([0-5][0-9]|[0-9])/),a.second)),o.ss=n.cache(n.process(n.rtoken(/^[0-5][0-9]/),a.second)),o.hms=n.cache(n.sequence([o.H,o.m,o.s],o.timePartDelimiter)),o.t=n.cache(n.process(o.ctoken2("shortMeridian"),a.meridian)),o.tt=n.cache(n.process(o.ctoken2("longMeridian"),a.meridian)),o.z=n.cache(n.process(n.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),a.timezone)),o.zz=n.cache(n.process(n.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),a.timezone)),o.zzz=n.cache(n.process(o.ctoken2("timezone"),a.timezone)),o.timeSuffix=n.each(n.ignore(o.whiteSpace),n.set([o.tt,o.zzz])),o.time=n.each(n.optional(n.ignore(n.stoken("T"))),o.hms,o.timeSuffix),o.d=n.cache(n.process(n.each(n.rtoken(/^([0-2]\d|3[0-1]|\d)/),n.optional(o.ctoken2("ordinalSuffix"))),a.day)),o.dd=n.cache(n.process(n.each(n.rtoken(/^([0-2]\d|3[0-1])/),n.optional(o.ctoken2("ordinalSuffix"))),a.day)),o.rday=n.cache(n.process(o.ctoken("yesterday tomorrow soon later today now"),a.rday)),o.ddd=o.dddd=n.cache(n.process(o.ctoken("sun mon tue wed thu fri sat"),function(e){return function(){this.weekday=e}})),o.M=n.cache(n.process(n.rtoken(/^(1[0-2]|0\d|\d)/),a.month)),o.MM=n.cache(n.process(n.rtoken(/^(1[0-2]|0\d)/),a.month)),o.MMM=o.MMMM=n.cache(n.process(o.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),a.month)),o.y=n.cache(n.process(n.rtoken(/^(\d\d?)/),a.year)),o.yy=n.cache(n.process(n.rtoken(/^(\d\d)/),a.year)),o.yyy=n.cache(n.process(n.rtoken(/^(\d\d?\d?\d?)/),a.year)),o.yyyy=n.cache(n.process(n.rtoken(/^(\d\d\d\d)/),a.year)),i=function(){return n.each(n.any.apply(null,arguments),n.not(o.ctoken2("timeContext")))},o.day=i(o.d,o.dd,o.rday),o.month=i(o.M,o.MMM),o.year=i(o.yyyy,o.yy),o.orientation=n.process(o.ctoken("past future"),function(e){return function(){this.orient=e}}),o.value=n.process(n.rtoken(/^\d\d?(st|nd|rd|th)?/),function(e){return function(){this.value=e.replace(/\D/g,"")}}),o.expression=n.set([o.rday,o.value,o.orientation,o.ddd,o.MMM]),i=function(){return n.set(arguments,o.datePartDelimiter)},o.mdy=i(o.ddd,o.month,o.day,o.year),o.ymd=i(o.ddd,o.year,o.month,o.day),o.dmy=i(o.ddd,o.day,o.month,o.year),o.date=function(e){return(o[t.dateElementOrder]||o.mdy).call(this,e)},o.format=n.process(n.many(n.any(n.process(n.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(t){if(o[t])return o[t];throw e.Parsing.Exception(t)}),n.process(n.rtoken(/^[^dMyhHmstz]+/),function(e){return n.ignore(n.stoken(e))}))),function(e){return n.process(n.each.apply(null,e),a.finishExact)});var c={},d=function(e){return c[e]=c[e]||o.format(e)[0]};o.formats=function(e){if(e instanceof Array){for(var t=[],r=0;r<e.length;r++)t.push(d(e[r]));return n.any.apply(null,t)}return d(e)};var l=["M/d H","M-d H","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy"];o._formats=o.formats(l),o._start=n.process(n.set([o.date,o.time,o.expression],o.generalDelimiter,o.whiteSpace),a.finish),o.start=function(e){try{var t=o._formats.call({},e);if(0===t[1].length)return t}catch(r){}return o._start.call({},e)},e._parse=e.parse,e.parse=function(t){var r=null;if(!t)return null;if(t instanceof Date)return t;try{r=e.Grammar.start.call({},t.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(i){return null}return 0===r[1].length?r[0]:null},e.getParseFunction=function(t){var r=e.Grammar.formats(t);return function(e){var t=null;try{t=r.call({},e)}catch(i){return null}return 0===t[1].length?t[0]:null}},e.parseExact=function(t,r){return e.getParseFunction(r)(t)}}()}function DuchessHelpersWrapper(e){function t(e){return String(e).replace(/[&\"<>]/g,function(e){return a[e]})}function r(e){var t=e.replace(/[:,\.\'\"\)\]]$/g,"");return t}this.helperLibLoaded=!0;var i="@",n="+",o=-1!=navigator.userAgent.indexOf("Win")?"ctrl":"⌘";String.prototype.insertTag=function(e,t,r,i){return this.substr(0,e)+t+this.substr(e,r)+i+this.substr(e+r)},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)});var a={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"},s=["YESTERDAY","TODAY","TOMORROW"],c=/(^#|[\(\s]#)([^\s\),]+)/g,d=/(?:^@|[\(\s]@)([^\s\)]+)(\s[^\s\)@]+)?(\s[^\s\)@]+)?/g,l=/\b((?:https?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/g,u=/(?:^|[\s\(\[])([^\(\[@\s]+\.(?:com|org|net))/gi;e.parseText=function(a,s,h,p){var m=!1,f=a,g=[];if(0===a.length)return{parsedText:void 0};var v=a,y=!1,b=a.length;a=t(a),b!==a.length&&(y=!0);var S,T,x,w=[];if(p&&p.___info___.count>0&&a.indexOf(n)>=0){for(var E=a.split(" "),M=0,C=0;C<E.length;C++){if(0===E[C].indexOf(n)){for(var I=void 0,P=E[C].substring(1),A=1;4>A;A++){var k=r(P);if(""===p[k]&&(I=k),!(C+A<E.length))break;P+=" "+E[C+A]}I&&g.push({name:I,lineIndex:M})}M+=E[C].length+1}if(g.length>0)for(var C=g.length-1;C>=0;C--)a=a.insertTag(g[C].lineIndex,'<p class="contact">',g[C].name.length+1,"</p>"),y=!0}for(c.lastIndex=0;S=c.exec(a);){var D=S.index+S[1].length-1,L=S[2].length+1;":"==S[2].charAt(S[2].length-1)&&L--,a=a.insertTag(D,'<p class="tag" title="'+o+'+click to search">',L,"</p>"),y=!0}for(d.lastIndex=0;S=d.exec(a);){for(var O,R=S[0].indexOf(i),_=!1,C=1;C<S.length&&S[C];++C)if(_)S[C]=void 0;else{var N=S[C][S[C].length-1];(":"===N||","===N||"."===N)&&(S[C]=S[C].slice(0,-1),_=!0)}O=S[1]+(S[2]?S[2]:"")+(S[3]?S[3]:"");var F=Date.parse(O);if(!F&&S[3]&&(O=S[1]+(S[2]?S[2]:""),F=Date.parse(O)),!F&&S[2]&&(O=S[1],F=Date.parse(O)),F){var V=e.computeDateInfo(s,h,F,O);if(V.replacedDate){dateLength=V.text.length+1;var B=S.index+R+1;a=a.substr(0,B)+V.text+a.substr(B+O.length),a=a.insertTag(S.index+R,'<p class="date">',dateLength,"</p>");var U=f.indexOf(O);f=f.substr(0,U)+V.text+f.substr(U+O.length),m=!0,w.push({date:V.date,text:V.text,explicitTime:F._explicitTime})}else dateLength=O.length+1,a=a.insertTag(S.index+R,'<p class="date">',dateLength,"</p>"),w.push({date:V.date,text:O,explicitTime:F._explicitTime});y=!0;break}}if(l.lastIndex=0,S=l.exec(a)){var q=S[0].startsWith("http")?S[0]:"http://"+S[0];T="<a target='_blank' href='"+q+"' title='"+o+"+click to navigate'>",x="</a>",a=a.insertTag(S.index,T,S[0].length,x),y=!0}else if(u.lastIndex=0,S=u.exec(a)){var R=S[0].length-S[1].length,q=S[1].startsWith("http")?S[1]:"http://"+S[1];T="<a target='_blank' href='"+q+"' title='"+o+"+click to navigate'>",x="</a>",a=a.insertTag(S.index+R,T,S[1].length,x),y=!0}return{text:v,styledText:a,parsedText:m?f:void 0,dates:w,hasStyle:y,numContacts:g.length}},e.computeDateInfo=function(e,t,r,i){function n(e){var t=864e5,r=new Date(e).clearTime()-(new Date).clearTime();return 0>r?r>=-t?"yesterday":e.toString("M/d"):t>=r&&e.isToday()?"today":2*t>=r?"tomorrow":void 0}var o,a=i,c=!1;if(t)o=r;else if(o=new Date(e),void 0!==e&&r.getTime()!==e){if(s.indexOf(i.toUpperCase())>=0){var d=r._explicitTime;o=new Date(e);var l=n(o);l&&(a=l,d&&(a+=" "+o.toString("h:mmtt")),c=!0)}}else void 0===e&&(o=r);return{text:a,date:o,replacedDate:c}}}function parseWorkerWrapper(){DuchessHelpersWrapper&&!this.helperLibLoaded&&DuchessHelpersWrapper(this.DuchessHelpers=this.DuchessHelpers||{}),dateWrapper&&!this.dateLibLoaded&&dateWrapper(),log=postMessage;var e;onmessage=function(t){if(t.data.contacts&&(e=t.data.contacts),t.data.items){for(var r=Date.now(),i=new Array(t.data.items.length),n=0;n<t.data.items.length;n++){var o=t.data.items[n];i[n]=DuchessHelpers.parseText(o.text,o.prevDate,o.isUpdate,e)}postMessage({id:t.data.id,styles:i,done:!0,start:r,end:Date.now()})}else postMessage({id:t.data.id,done:!1,msg:"ERROR: No items passed to the worker"})}}function makeLogger(e){window.log[e]=function(){window.DEBUG&&log.apply(console,arguments)}}function GoogleApiLoaded(){if(!gapiCalled){if(gapiCalled=!0,gapi.auth.init(),window.location.hash.indexOf("offline=true")>=0||window.location.hash.indexOf("offline%22:true")>=0||window.location.hash.indexOf('offline":true')>=0||window.location.hash.indexOf("demo=true")>=0)return void log("%cOffline","color: pink");gapi.client.setApiKey(window.gapiKey),gapi.load("drive-realtime",function(){if(gapi&&gapi.drive&&gapi.drive.realtime)require(["globals","goog"],function(e,t){t.loadClientDefaultFile(),e.removeDOM("blockedError")});else{require(["globals","platform"],function(e,t){var r;r=gapi?gapi.drive?gapi.drive.realtime?"all exist":"gapi.drive.realtime":"gapi.drive":"gapi",gapiCalled=!1,gapiLoadError=!0,e.reportError(new Error("Drive returned load, but unable to load "+r));var i=document.getElementById("blockedMessage");i.innerText=t.app?"There was an error loading the Google APIs, "+t.actionVerb()+" to try again.":"You are running an extension that blocked drive.google.com from loading, Moo.do requires access to function correctly.",document.getElementById("blockedError").classList.remove("none"),e.vmMain&&e.vmMain.gdriveStatus(DriveStatus.Offline)
})}}),require(["globals","util","platform","goog","VMSetup"],function(e,t,r,i){var n=!1;(!r.ie||r.mobile)&&(n=i.checkTokenInHash());var o=n||t.hasURLParam("login","true")||e.getLoginState()==LoginState.LOGGED_IN;i.runAuthenticate(i.requestScopes,!0,!1,function(r){t.removeURLParam("login",!0),r&&!r.error?(o&&(e.vmSetup?e.vmSetup.setLoginState(LoginState.LOGGED_IN):e.setLoginState(LoginState.LOGGED_IN),i.loadClientDefaultFile(),e.openMainPage()),i.ensureRequiredScopesAreRequested()):i.requiredScopes!==i.requestScopes?(e.settings.reset(Settings.authScopes),i.runAuthenticate(i.requiredScopes,!0,!1,function(t){t&&!t.error?o&&(e.vmSetup?e.vmSetup.setLoginState(LoginState.LOGGED_IN):e.setLoginState(LoginState.LOGGED_IN),i.loadClientDefaultFile(),e.openMainPage()):(e.vmSetup?e.vmSetup.setLoginState(LoginState.LOGGED_OUT):e.setLoginState(LoginState.LOGGED_OUT),e.openSetupPage())})):(e.vmSetup?e.vmSetup.setLoginState(LoginState.LOGGED_OUT):e.setLoginState(LoginState.LOGGED_OUT),e.openSetupPage())})})}}var requirejs,require,define;!function(e){function t(e,t){return v.call(e,t)}function r(e,t){var r,i,n,o,a,s,c,d,l,u,h=t&&t.split("/"),p=f.map,m=p&&p["*"]||{};if(e&&"."===e.charAt(0))if(t){for(h=h.slice(0,h.length-1),e=h.concat(e.split("/")),d=0;d<e.length;d+=1)if(u=e[d],"."===u)e.splice(d,1),d-=1;else if(".."===u){if(1===d&&(".."===e[2]||".."===e[0]))break;d>0&&(e.splice(d-1,2),d-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((h||m)&&p){for(r=e.split("/"),d=r.length;d>0;d-=1){if(i=r.slice(0,d).join("/"),h)for(l=h.length;l>0;l-=1)if(n=p[h.slice(0,l).join("/")],n&&(n=n[i])){o=n,a=d;break}if(o)break;!s&&m&&m[i]&&(s=m[i],c=d)}!o&&s&&(o=s,a=c),o&&(r.splice(0,a,o),e=r.join("/"))}return e}function i(t,r){return function(){return l.apply(e,y.call(arguments,0).concat([t,r]))}}function n(e){return function(t){return r(t,e)}}function o(e){return function(t){p[e]=t}}function a(r){if(t(m,r)){var i=m[r];delete m[r],g[r]=!0,d.apply(e,i)}if(!t(p,r)&&!t(g,r))throw new Error("No "+r);return p[r]}function s(e){var t,r=e?e.indexOf("!"):-1;return r>-1&&(t=e.substring(0,r),e=e.substring(r+1,e.length)),[t,e]}function c(e){return function(){return f&&f.config&&f.config[e]||{}}}var d,l,u,h,p={},m={},f={},g={},v=Object.prototype.hasOwnProperty,y=[].slice;u=function(e,t){var i,o=s(e),c=o[0];return e=o[1],c&&(c=r(c,t),i=a(c)),c?e=i&&i.normalize?i.normalize(e,n(t)):r(e,t):(e=r(e,t),o=s(e),c=o[0],e=o[1],c&&(i=a(c))),{f:c?c+"!"+e:e,n:e,pr:c,p:i}},h={require:function(e){return i(e)},exports:function(e){var t=p[e];return"undefined"!=typeof t?t:p[e]={}},module:function(e){return{id:e,uri:"",exports:p[e],config:c(e)}}},d=function(r,n,s,c){var d,l,f,v,y,b,S=[];if(c=c||r,"function"==typeof s){for(n=!n.length&&s.length?["require","exports","module"]:n,y=0;y<n.length;y+=1)if(v=u(n[y],c),l=v.f,"require"===l)S[y]=h.require(r);else if("exports"===l)S[y]=h.exports(r),b=!0;else if("module"===l)d=S[y]=h.module(r);else if(t(p,l)||t(m,l)||t(g,l))S[y]=a(l);else{if(!v.p)throw new Error(r+" missing "+l);v.p.load(v.n,i(c,!0),o(l),{}),S[y]=p[l]}f=s.apply(p[r],S),r&&(d&&d.exports!==e&&d.exports!==p[r]?p[r]=d.exports:f===e&&b||(p[r]=f))}else r&&(p[r]=s)},requirejs=require=l=function(t,r,i,n,o){return"string"==typeof t?h[t]?h[t](r):a(u(t,r).f):(t.splice||(f=t,r.splice?(t=r,r=i,i=null):t=e),r=r||function(){},"function"==typeof i&&(i=n,n=o),n?d(e,t,r,i):setTimeout(function(){d(e,t,r,i)},4),l)},l.config=function(e){return f=e,f.deps&&l(f.deps,f.callback),l},define=function(e,r,i){r.splice||(i=r,r=[]),t(p,e)||t(m,e)||(m[e]=[e,r,i])},define.amd={jQuery:!0}}(),define("lib/almond",function(){}),function(){!function(e){var t=this||(0,eval)("this"),r=t.document,i=t.navigator,n=t.jQuery,o=t.JSON;!function(e){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(module.exports||exports):"function"==typeof define&&define.amd?define("ko",["exports"],e):e(t.ko={})}(function(a){function s(e,t,r,i){d.d[e]={init:function(e){return d.a.f.set(e,p,{}),{controlsDescendantBindings:!0}},update:function(e,n,o,a,s){o=d.a.f.get(e,p),n=d.a.c(n()),a=!r!=!n;var c=!o.gb;(c||t||a!==o.wb)&&(c&&(o.gb=d.a.Pa(d.e.childNodes(e),!0)),a?(c||d.e.S(e,d.a.Pa(o.gb)),d.Ka(i?i(s,n):s,e)):d.e.ca(e),o.wb=a)}},d.g.V[e]=!1,d.e.N[e]=!0}function c(e,t,r){r&&t!==d.i.n(e)&&d.i.X(e,t),t!==d.i.n(e)&&d.o.P(d.a.Ha,null,[e,"change"])}var d="undefined"!=typeof a?a:{};d.b=function(e,t){for(var r=e.split("."),i=d,n=0;n<r.length-1;n++)i=i[r[n]];i[r[r.length-1]]=t},d.q=function(e,t,r){e[t]=r},d.version="2.3.0",d.b("version",d.version),d.a=function(){function a(e,t){for(var r in e)e.hasOwnProperty(r)&&t(r,e[r])}function s(e,t){if("input"!==d.a.u(e)||!e.type||"click"!=t.toLowerCase())return!1;var r=e.type;return"checkbox"==r||"radio"==r}var c={},l={};c[i&&/Firefox\/2/i.test(i.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],c.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),a(c,function(e,t){if(t.length)for(var r=0,i=t.length;i>r;r++)l[t[r]]=e});var u={propertychange:!0},h=r&&function(){for(var t=3,i=r.createElement("div"),n=i.getElementsByTagName("i");i.innerHTML="<!--[if gt IE "+ ++t+"]><i></i><![endif]-->",n[0];);return t>4?t:e}(),p={__proto__:[]}instanceof Array;return{Ua:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],r:function(e,t){for(var r=0,i=e.length;i>r;r++)t(e[r])},k:function(e,t){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(e,t);for(var r=0,i=e.length;i>r;r++)if(e[r]===t)return r;return-1},Ma:function(e,t,r){for(var i=0,n=e.length;n>i;i++)if(t.call(r,e[i]))return e[i];return null},la:function(e,t){var r=d.a.k(e,t);r>=0&&e.splice(r,1)},Na:function(e){e=e||[];for(var t=[],r=0,i=e.length;i>r;r++)0>d.a.k(t,e[r])&&t.push(e[r]);return t},$:function(e,t){e=e||[];for(var r=[],i=0,n=e.length;n>i;i++)r.push(t(e[i]));return r},Z:function(e,t){e=e||[];for(var r=[],i=0,n=e.length;n>i;i++)t(e[i])&&r.push(e[i]);return r},U:function(e,t){if(t instanceof Array)e.push.apply(e,t);else for(var r=0,i=t.length;i>r;r++)e.push(t[r]);return e},ka:function(e,t,r){var i=e.indexOf?e.indexOf(t):d.a.k(e,t);0>i?r&&e.push(t):r||e.splice(i,1)},extend:function(e,t){if(t)for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},w:a,pa:function(e){for(;e.firstChild;)d.removeNode(e.firstChild)},Ob:function(e){e=d.a.Q(e);for(var t=r.createElement("div"),i=0,n=e.length;n>i;i++)t.appendChild(d.J(e[i]));return t},Pa:function(e,t){for(var r=0,i=e.length,n=[];i>r;r++){var o=e[r].cloneNode(!0);n.push(t?d.J(o):o)}return n},S:function(e,t){if(d.a.pa(e),t)for(var r=0,i=t.length;i>r;r++)e.appendChild(t[r])},fb:function(e,t){var r=e.nodeType?[e]:e;if(0<r.length){for(var i=r[0],n=i.parentNode,o=0,a=t.length;a>o;o++)n.insertBefore(t[o],i);for(o=0,a=r.length;a>o;o++)d.removeNode(r[o])}},ib:function(e,t){7>h?e.setAttribute("selected",t):e.selected=t},H:function(t){return null===t||t===e?"":t.trim?t.trim():t.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},Yb:function(e,t){for(var r=[],i=(e||"").split(t),n=0,o=i.length;o>n;n++){var a=d.a.H(i[n]);""!==a&&r.push(a)}return r},Vb:function(e,t){return e=e||"",t.length>e.length?!1:e.substring(0,t.length)===t},zb:function(e,t){if(t.compareDocumentPosition)return 16==(16&t.compareDocumentPosition(e));for(;null!=e;){if(e==t)return!0;e=e.parentNode}return!1},ba:function(e){return d.a.zb(e,e.ownerDocument)},qb:function(e){return!!d.a.Ma(e,d.a.ba)},u:function(e){return e&&e.tagName&&e.tagName.toLowerCase()},p:function(e,t,r){var i=h&&u[t];if(i||"undefined"==typeof n)if(i||"function"!=typeof e.addEventListener){if("undefined"==typeof e.attachEvent)throw Error("Browser doesn't support addEventListener or attachEvent");var o=function(t){r.call(e,t)},a="on"+t;e.attachEvent(a,o),d.a.F.ja(e,function(){e.detachEvent(a,o)})}else e.addEventListener(t,r,!1);else{if(s(e,t)){var c=r;r=function(e,t){var r=this.checked;t&&(this.checked=!0!==t.tb),c.call(this,e),this.checked=r}}n(e).bind(t,r)}},Ha:function(e,i){if(!e||!e.nodeType)throw Error("element must be a DOM node when calling triggerEvent");if("undefined"!=typeof n){var o=[];s(e,i)&&o.push({tb:e.checked}),n(e).trigger(i,o)}else if("function"==typeof r.createEvent){if("function"!=typeof e.dispatchEvent)throw Error("The supplied element doesn't support dispatchEvent");o=r.createEvent(l[i]||"HTMLEvents"),o.initEvent(i,!0,!0,t,0,0,0,0,0,!1,!1,!1,!1,0,e),e.dispatchEvent(o)}else{if("undefined"==typeof e.fireEvent)throw Error("Browser doesn't support triggering events");s(e,i)&&(e.checked=!0!==e.checked),e.fireEvent("on"+i)}},c:function(e){return d.W(e)?e():e},za:function(e){return d.W(e)?e.t():e},ha:function(e,t,r){if(t){var i=/\S+/g,n=e.className.match(i)||[];d.a.r(t.match(i),function(e){d.a.ka(n,e,r)}),e.className=n.join(" ")}},jb:function(t,i){var n=d.a.c(i);(null===n||n===e)&&(n="");var o=d.e.firstChild(t);!o||3!=o.nodeType||d.e.nextSibling(o)?d.e.S(t,[r.createTextNode(n)]):o.data=n,d.a.Cb(t)},hb:function(e,t){if(e.name=t,7>=h)try{e.mergeAttributes(r.createElement("<input name='"+e.name+"'/>"),!1)}catch(i){}},Cb:function(e){h>=9&&(e=1==e.nodeType?e:e.parentNode,e.style&&(e.style.zoom=e.style.zoom))},Ab:function(e){if(h){var t=e.style.width;e.style.width=0,e.style.width=t}},Sb:function(e,t){e=d.a.c(e),t=d.a.c(t);for(var r=[],i=e;t>=i;i++)r.push(i);return r},Q:function(e){for(var t=[],r=0,i=e.length;i>r;r++)t.push(e[r]);return t},Wb:6===h,Xb:7===h,da:h,Va:function(e,t){for(var r=d.a.Q(e.getElementsByTagName("input")).concat(d.a.Q(e.getElementsByTagName("textarea"))),i="string"==typeof t?function(e){return e.name===t}:function(e){return t.test(e.name)},n=[],o=r.length-1;o>=0;o--)i(r[o])&&n.push(r[o]);return n},Pb:function(e){return"string"==typeof e&&(e=d.a.H(e))?o&&o.parse?o.parse(e):new Function("return "+e)():null},Da:function(e,t,r){if(!o||!o.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return o.stringify(d.a.c(e),t,r)},Qb:function(e,t,i){i=i||{};var n=i.params||{},o=i.includeFields||this.Ua,s=e;if("object"==typeof e&&"form"===d.a.u(e))for(var s=e.action,c=o.length-1;c>=0;c--)for(var l=d.a.Va(e,o[c]),u=l.length-1;u>=0;u--)n[l[u].name]=l[u].value;t=d.a.c(t);var h=r.createElement("form");h.style.display="none",h.action=s,h.method="post";for(var p in t)e=r.createElement("input"),e.name=p,e.value=d.a.Da(d.a.c(t[p])),h.appendChild(e);a(n,function(e,t){var i=r.createElement("input");i.name=e,i.value=t,h.appendChild(i)}),r.body.appendChild(h),i.submitter?i.submitter(h):h.submit(),setTimeout(function(){h.parentNode.removeChild(h)},0)},I:function(e,t){return p?(e.__proto__=t,!0):!1}}}(),d.b("utils",d.a),d.b("utils.arrayForEach",d.a.r),d.b("utils.arrayFirst",d.a.Ma),d.b("utils.arrayFilter",d.a.Z),d.b("utils.arrayGetDistinctValues",d.a.Na),d.b("utils.arrayIndexOf",d.a.k),d.b("utils.arrayMap",d.a.$),d.b("utils.arrayPushAll",d.a.U),d.b("utils.arrayRemoveItem",d.a.la),d.b("utils.extend",d.a.extend),d.b("utils.fieldsIncludedWithJsonPost",d.a.Ua),d.b("utils.getFormFields",d.a.Va),d.b("utils.peekObservable",d.a.za),d.b("utils.postJson",d.a.Qb),d.b("utils.parseJson",d.a.Pb),d.b("utils.registerEventHandler",d.a.p),d.b("utils.stringifyJson",d.a.Da),d.b("utils.range",d.a.Sb),d.b("utils.toggleDomNodeCssClass",d.a.ha),d.b("utils.triggerEvent",d.a.Ha),d.b("utils.unwrapObservable",d.a.c),d.b("utils.objectForEach",d.a.w),d.b("utils.addOrRemoveItem",d.a.ka),d.b("unwrap",d.a.c),Function.prototype.bind||(Function.prototype.bind=function(e){var t=this,r=Array.prototype.slice.call(arguments);return e=r.shift(),function(){return t.apply(e,r.concat(Array.prototype.slice.call(arguments)))}}),d.a.f=new function(){var t=0,r="__ko__"+(new Date).getTime(),i={};return{get:function(t,r){var i=d.a.f.qa(t,!1);return i===e?e:i[r]},set:function(t,r,i){(i!==e||d.a.f.qa(t,!1)!==e)&&(d.a.f.qa(t,!0)[r]=i)},qa:function(n,o){var a=n[r];if(!a||"null"===a||!i[a]){if(!o)return e;a=n[r]="ko"+t++,i[a]={}}return i[a]},clear:function(e){var t=e[r];return t?(delete i[t],e[r]=null,!0):!1}}},d.b("utils.domData",d.a.f),d.b("utils.domData.clear",d.a.f.clear),d.a.F=new function(){function t(t,r){var n=d.a.f.get(t,i);return n===e&&r&&(n=[],d.a.f.set(t,i,n)),n}function r(e){var i=t(e,!1);if(i)for(var i=i.slice(0),o=0;o<i.length;o++)i[o](e);if(d.a.f.clear(e),"function"==typeof n&&"function"==typeof n.cleanData&&n.cleanData([e]),a[e.nodeType])for(i=e.firstChild;e=i;)i=e.nextSibling,8===e.nodeType&&r(e)}var i="__ko_domNodeDisposal__"+(new Date).getTime(),o={1:!0,8:!0,9:!0},a={1:!0,9:!0};return{ja:function(e,r){if("function"!=typeof r)throw Error("Callback must be a function");t(e,!0).push(r)},eb:function(r,n){var o=t(r,!1);o&&(d.a.la(o,n),0==o.length&&d.a.f.set(r,i,e))},J:function(e){if(o[e.nodeType]&&(r(e),a[e.nodeType])){var t=[];d.a.U(t,e.getElementsByTagName("*"));for(var i=0,n=t.length;n>i;i++)r(t[i])}return e},removeNode:function(e){d.J(e),e.parentNode&&e.parentNode.removeChild(e)}}},d.J=d.a.F.J,d.removeNode=d.a.F.removeNode,d.b("cleanNode",d.J),d.b("removeNode",d.removeNode),d.b("utils.domNodeDisposal",d.a.F),d.b("utils.domNodeDisposal.addDisposeCallback",d.a.F.ja),d.b("utils.domNodeDisposal.removeDisposeCallback",d.a.F.eb),function(){d.a.ya=function(e){var i;if("undefined"!=typeof n){if(n.parseHTML)i=n.parseHTML(e)||[];else if((i=n.clean([e]))&&i[0]){for(e=i[0];e.parentNode&&11!==e.parentNode.nodeType;)e=e.parentNode;e.parentNode&&e.parentNode.removeChild(e)}}else{var o=d.a.H(e).toLowerCase();for(i=r.createElement("div"),o=o.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!o.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!o.indexOf("<td")||!o.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],e="ignored<div>"+o[1]+e+o[2]+"</div>","function"==typeof t.innerShiv?i.appendChild(t.innerShiv(e)):i.innerHTML=e;o[0]--;)i=i.lastChild;i=d.a.Q(i.lastChild.childNodes)}return i},d.a.ga=function(t,r){if(d.a.pa(t),r=d.a.c(r),null!==r&&r!==e)if("string"!=typeof r&&(r=r.toString()),"undefined"!=typeof n)n(t).html(r);else for(var i=d.a.ya(r),o=0;o<i.length;o++)t.appendChild(i[o])}}(),d.b("utils.parseHtmlFragment",d.a.ya),d.b("utils.setHtml",d.a.ga),d.s=function(){function t(e,r){if(e)if(8==e.nodeType){var i=d.s.ab(e.nodeValue);null!=i&&r.push({yb:e,Mb:i})}else if(1==e.nodeType)for(var i=0,n=e.childNodes,o=n.length;o>i;i++)t(n[i],r)}var r={};return{wa:function(e){if("function"!=typeof e)throw Error("You can only pass a function to ko.memoization.memoize()");var t=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return r[t]=e,"<!--[ko_memo:"+t+"]-->"},nb:function(t,i){var n=r[t];if(n===e)throw Error("Couldn't find any memo with ID "+t+". Perhaps it's already been unmemoized.");try{return n.apply(null,i||[]),!0}finally{delete r[t]}},ob:function(e,r){var i=[];t(e,i);for(var n=0,o=i.length;o>n;n++){var a=i[n].yb,s=[a];r&&d.a.U(s,r),d.s.nb(i[n].Mb,s),a.nodeValue="",a.parentNode&&a.parentNode.removeChild(a)}},ab:function(e){return(e=e.match(/^\[ko_memo\:(.*?)\]$/))?e[1]:null}}}(),d.b("memoization",d.s),d.b("memoization.memoize",d.s.wa),d.b("memoization.unmemoize",d.s.nb),d.b("memoization.parseMemoText",d.s.ab),d.b("memoization.unmemoizeDomNodeAndDescendants",d.s.ob),d.Ta={throttle:function(e,t){e.throttleEvaluation=t;var r=null;return d.h({read:e,write:function(i){clearTimeout(r),r=setTimeout(function(){e(i)},t)}})},notify:function(e,t){return e.equalityComparer="always"==t?function(){return!1}:d.l.fn.equalityComparer,e}},d.b("extenders",d.Ta),d.lb=function(e,t,r){this.target=e,this.ma=t,this.xb=r,d.q(this,"dispose",this.D)},d.lb.prototype.D=function(){this.Jb=!0,this.xb()},d.A=function(){this.B={},d.a.I(this,d.A.fn)||d.a.extend(this,d.A.fn),d.q(this,"subscribe",this.Ea),d.q(this,"extend",this.extend),d.q(this,"getSubscriptionsCount",this.Eb)},d.A.fn={Ea:function(e,t,r){r=r||"change";var i=new d.lb(this,t?e.bind(t):e,function(){d.a.la(this.B[r],i)}.bind(this));return this.B[r]||(this.B[r]=[]),this.B[r].push(i),i},notifySubscribers:function(e,t){if(t=t||"change",this.Fb(t))try{d.o.Oa();for(var r,i=this.B[t].slice(0),n=0;r=i[n];++n)r&&!0!==r.Jb&&r.ma(e)}finally{d.o.end()}},Fb:function(e){return this.B[e]&&this.B[e].length},Eb:function(){var e=0;return d.a.w(this.B,function(t,r){e+=r.length}),e},extend:function(e){var t=this;return e&&d.a.w(e,function(e,r){var i=d.Ta[e];"function"==typeof i&&(t=i(t,r))}),t}},d.a.I(d.A.fn,Function.prototype),d.Xa=function(e){return null!=e&&"function"==typeof e.Ea&&"function"==typeof e.notifySubscribers},d.b("subscribable",d.A),d.b("isSubscribable",d.Xa),d.o=function(){var e=[];return{Oa:function(t){e.push(t&&{ma:t,Sa:[]})},end:function(){e.pop()},cb:function(t){if(!d.Xa(t))throw Error("Only subscribable things can act as dependencies");if(0<e.length){var r=e[e.length-1];!r||0<=d.a.k(r.Sa,t)||(r.Sa.push(t),r.ma(t))}},P:function(t,r,i){try{return e.push(null),t.apply(r,i||[])}finally{e.pop()}}}}();var l={undefined:!0,"boolean":!0,number:!0,string:!0};d.l=function(e){function t(){return 0<arguments.length?(t.equalityComparer&&t.equalityComparer(r,arguments[0])||(t.M(),r=arguments[0],t.L()),this):(d.o.cb(t),r)}var r=e;return d.A.call(t),t.t=function(){return r},t.L=function(){t.notifySubscribers(r)},t.M=function(){t.notifySubscribers(r,"beforeChange")},d.a.I(t,d.l.fn)||d.a.extend(t,d.l.fn),d.q(t,"peek",t.t),d.q(t,"valueHasMutated",t.L),d.q(t,"valueWillMutate",t.M),t},d.l.fn={equalityComparer:function(e,t){return null===e||typeof e in l?e===t:!1}};var u=d.l.Rb="__ko_proto__";d.l.fn[u]=d.l,d.a.I(d.l.fn,d.A.fn),d.ra=function(t,r){return null===t||t===e||t[u]===e?!1:t[u]===r?!0:d.ra(t[u],r)},d.W=function(e){return d.ra(e,d.l)},d.Ya=function(e){return"function"==typeof e&&e[u]===d.l||"function"==typeof e&&e[u]===d.h&&e.Gb?!0:!1},d.b("observable",d.l),d.b("isObservable",d.W),d.b("isWriteableObservable",d.Ya),d.K=function(e){if(e=e||[],"object"!=typeof e||!("length"in e))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return e=d.l(e),d.a.I(e,d.K.fn)||d.a.extend(e,d.K.fn),e},d.K.fn={remove:function(e){for(var t=this.t(),r=[],i="function"==typeof e?e:function(t){return t===e},n=0;n<t.length;n++){var o=t[n];i(o)&&(0===r.length&&this.M(),r.push(o),t.splice(n,1),n--)}return r.length&&this.L(),r},removeAll:function(t){if(t===e){var r=this.t(),i=r.slice(0);return this.M(),r.splice(0,r.length),this.L(),i}return t?this.remove(function(e){return 0<=d.a.k(t,e)}):[]},destroy:function(e){var t=this.t(),r="function"==typeof e?e:function(t){return t===e};this.M();for(var i=t.length-1;i>=0;i--)r(t[i])&&(t[i]._destroy=!0);this.L()},destroyAll:function(t){return t===e?this.destroy(function(){return!0}):t?this.destroy(function(e){return 0<=d.a.k(t,e)}):[]},indexOf:function(e){var t=this();return d.a.k(t,e)},replace:function(e,t){var r=this.indexOf(e);r>=0&&(this.M(),this.t()[r]=t,this.L())}},d.a.r("pop push reverse shift sort splice unshift".split(" "),function(e){d.K.fn[e]=function(){var t=this.t();return this.M(),t=t[e].apply(t,arguments),this.L(),t}}),d.a.r(["slice"],function(e){d.K.fn[e]=function(){var t=this();return t[e].apply(t,arguments)}}),d.a.I(d.K.fn,d.l.fn),d.b("observableArray",d.K),d.h=function(t,r,i){function n(){d.a.r(y,function(e){e.D()}),y=[]}function o(){var e=s.throttleEvaluation;e&&e>=0?(clearTimeout(b),b=setTimeout(a,e)):a()}function a(){if(!h)if(u&&g())v();else{h=!0;try{var t=d.a.$(y,function(e){return e.target});d.o.Oa(function(r){var i;0<=(i=d.a.k(t,r))?t[i]=e:y.push(r.Ea(o))});for(var i=r?p.call(r):p(),n=t.length-1;n>=0;n--)t[n]&&y.splice(n,1)[0].D();u=!0,s.notifySubscribers(l,"beforeChange"),l=i,s.notifySubscribers(l)}finally{d.o.end(),h=!1}y.length||v()}}function s(){if(0<arguments.length){if("function"!=typeof m)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return m.apply(r,arguments),this}return u||a(),d.o.cb(s),l}function c(){return!u||0<y.length}var l,u=!1,h=!1,p=t;if(p&&"object"==typeof p?(i=p,p=i.read):(i=i||{},p||(p=i.read)),"function"!=typeof p)throw Error("Pass a function that returns the value of the ko.computed");var m=i.write,f=i.disposeWhenNodeIsRemoved||i.aa||null,g=i.disposeWhen||i.Ra||function(){return!1},v=n,y=[],b=null;if(r||(r=i.owner),s.t=function(){return u||a(),l},s.Db=function(){return y.length},s.Gb="function"==typeof i.write,s.D=function(){v()},s.ua=c,d.A.call(s),d.a.I(s,d.h.fn)||d.a.extend(s,d.h.fn),d.q(s,"peek",s.t),d.q(s,"dispose",s.D),d.q(s,"isActive",s.ua),d.q(s,"getDependenciesCount",s.Db),!0!==i.deferEvaluation&&a(),f&&c()){v=function(){d.a.F.eb(f,v),n()},d.a.F.ja(f,v);var S=g,g=function(){return!d.a.ba(f)||S()}}return s},d.Ib=function(e){return d.ra(e,d.h)},a=d.l.Rb,d.h[a]=d.l,d.h.fn={},d.h.fn[a]=d.h,d.a.I(d.h.fn,d.A.fn),d.b("dependentObservable",d.h),d.b("computed",d.h),d.b("isComputed",d.Ib),function(){function t(n,o,a){if(a=a||new i,n=o(n),"object"!=typeof n||null===n||n===e||n instanceof Date||n instanceof String||n instanceof Number||n instanceof Boolean)return n;var s=n instanceof Array?[]:{};return a.save(n,s),r(n,function(r){var i=o(n[r]);switch(typeof i){case"boolean":case"number":case"string":case"function":s[r]=i;break;case"object":case"undefined":var c=a.get(i);s[r]=c!==e?c:t(i,o,a)}}),s}function r(e,t){if(e instanceof Array){for(var r=0;r<e.length;r++)t(r);"function"==typeof e.toJSON&&t("toJSON")}else for(r in e)t(r)}function i(){this.keys=[],this.Ia=[]}d.mb=function(e){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return t(e,function(e){for(var t=0;d.W(e)&&10>t;t++)e=e();return e})},d.toJSON=function(e,t,r){return e=d.mb(e),d.a.Da(e,t,r)},i.prototype={save:function(e,t){var r=d.a.k(this.keys,e);r>=0?this.Ia[r]=t:(this.keys.push(e),this.Ia.push(t))},get:function(t){return t=d.a.k(this.keys,t),t>=0?this.Ia[t]:e}}}(),d.b("toJS",d.mb),d.b("toJSON",d.toJSON),function(){d.i={n:function(t){switch(d.a.u(t)){case"option":return!0===t.__ko__hasDomDataOptionValue__?d.a.f.get(t,d.d.options.xa):7>=d.a.da?t.getAttributeNode("value")&&t.getAttributeNode("value").specified?t.value:t.text:t.value;case"select":return 0<=t.selectedIndex?d.i.n(t.options[t.selectedIndex]):e;default:return t.value}},X:function(t,r){switch(d.a.u(t)){case"option":switch(typeof r){case"string":d.a.f.set(t,d.d.options.xa,e),"__ko__hasDomDataOptionValue__"in t&&delete t.__ko__hasDomDataOptionValue__,t.value=r;break;default:d.a.f.set(t,d.d.options.xa,r),t.__ko__hasDomDataOptionValue__=!0,t.value="number"==typeof r?r:""}break;case"select":""===r&&(r=e),(null===r||r===e)&&(t.selectedIndex=-1);for(var i=t.options.length-1;i>=0;i--)if(d.i.n(t.options[i])==r){t.selectedIndex=i;break}1<t.size||-1!==t.selectedIndex||(t.selectedIndex=0);break;default:(null===r||r===e)&&(r=""),t.value=r}}}}(),d.b("selectExtensions",d.i),d.b("selectExtensions.readValue",d.i.n),d.b("selectExtensions.writeValue",d.i.X),d.g=function(){function e(e,r){for(var i=null;e!=i;)i=e,e=e.replace(t,function(e,t){return r[t]});return e}var t=/\@ko_token_(\d+)\@/g,r=["true","false","null","undefined"],i=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;return{V:[],ea:function(t){var r=d.a.H(t);if(3>r.length)return[];"{"===r.charAt(0)&&(r=r.substring(1,r.length-1)),t=[];for(var i,n=null,o=0;o<r.length;o++){var a=r.charAt(o);if(null===n)switch(a){case'"':case"'":case"/":n=o,i=a}else if(a==i&&"\\"!==r.charAt(o-1)){a=r.substring(n,o+1),t.push(a);var s="@ko_token_"+(t.length-1)+"@",r=r.substring(0,n)+s+r.substring(o+1),o=o-(a.length-s.length),n=null}}i=n=null;for(var c=0,l=null,o=0;o<r.length;o++){if(a=r.charAt(o),null===n)switch(a){case"{":n=o,l=a,i="}";break;case"(":n=o,l=a,i=")";break;case"[":n=o,l=a,i="]"}a===l?c++:a===i&&(c--,0===c&&(a=r.substring(n,o+1),t.push(a),s="@ko_token_"+(t.length-1)+"@",r=r.substring(0,n)+s+r.substring(o+1),o-=a.length-s.length,n=null))}for(i=[],r=r.split(","),n=0,o=r.length;o>n;n++)c=r[n],l=c.indexOf(":"),l>0&&l<c.length-1?(a=c.substring(l+1),i.push({key:e(c.substring(0,l),t),value:e(a,t)})):i.push({unknown:e(c,t)});return i},fa:function(e){var t="string"==typeof e?d.g.ea(e):e,n=[];e=[];for(var o,a=0;o=t[a];a++)if(0<n.length&&n.push(","),o.key){var s;e:{s=o.key;var c=d.a.H(s);switch(c.length&&c.charAt(0)){case"'":case'"':break e;default:s="'"+c+"'"}}o=o.value,n.push(s),n.push(":"),n.push(o),o=d.a.H(o),0<=d.a.k(r,d.a.H(o).toLowerCase())?o=!1:(c=o.match(i),o=null===c?!1:c[1]?"Object("+c[1]+")"+c[2]:o),o&&(0<e.length&&e.push(", "),e.push(s+" : function(__ko_value) { "+o+" = __ko_value; }"))}else o.unknown&&n.push(o.unknown);return t=n.join(""),0<e.length&&(t=t+", '_ko_property_writers' : { "+e.join("")+" } "),t},Lb:function(e,t){for(var r=0;r<e.length;r++)if(d.a.H(e[r].key)==t)return!0;return!1},ia:function(e,t,r,i,n){e&&d.W(e)?!d.Ya(e)||n&&e.t()===i||e(i):(e=t()._ko_property_writers)&&e[r]&&e[r](i)}}}(),d.b("expressionRewriting",d.g),d.b("expressionRewriting.bindingRewriteValidators",d.g.V),d.b("expressionRewriting.parseObjectLiteral",d.g.ea),d.b("expressionRewriting.preProcessBindings",d.g.fa),d.b("jsonExpressionRewriting",d.g),d.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",d.g.fa),function(){function e(e){return 8==e.nodeType&&(o?e.text:e.nodeValue).match(a)}function t(e){return 8==e.nodeType&&(o?e.text:e.nodeValue).match(s)}function i(r,i){for(var n=r,o=1,a=[];n=n.nextSibling;){if(t(n)&&(o--,0===o))return a;a.push(n),e(n)&&o++}if(!i)throw Error("Cannot find closing comment tag to match: "+r.nodeValue);return null}function n(e,t){var r=i(e,t);return r?0<r.length?r[r.length-1].nextSibling:e.nextSibling:null}var o=r&&"<!--test-->"===r.createComment("test").text,a=o?/^\x3c!--\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*--\x3e$/:/^\s*ko(?:\s+(.+\s*\:[\s\S]*))?\s*$/,s=o?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,c={ul:!0,ol:!0};d.e={N:{},childNodes:function(t){return e(t)?i(t):t.childNodes},ca:function(t){if(e(t)){t=d.e.childNodes(t);for(var r=0,i=t.length;i>r;r++)d.removeNode(t[r])}else d.a.pa(t)},S:function(t,r){if(e(t)){d.e.ca(t);for(var i=t.nextSibling,n=0,o=r.length;o>n;n++)i.parentNode.insertBefore(r[n],i)}else d.a.S(t,r)},bb:function(t,r){e(t)?t.parentNode.insertBefore(r,t.nextSibling):t.firstChild?t.insertBefore(r,t.firstChild):t.appendChild(r)},Wa:function(t,r,i){i?e(t)?t.parentNode.insertBefore(r,i.nextSibling):i.nextSibling?t.insertBefore(r,i.nextSibling):t.appendChild(r):d.e.bb(t,r)},firstChild:function(r){return e(r)?!r.nextSibling||t(r.nextSibling)?null:r.nextSibling:r.firstChild},nextSibling:function(r){return e(r)&&(r=n(r)),r.nextSibling&&t(r.nextSibling)?null:r.nextSibling},pb:function(t){return(t=e(t))?t[1]:null},$a:function(r){if(c[d.a.u(r)]){var i=r.firstChild;if(i)do if(1===i.nodeType){var o;o=i.firstChild;var a=null;if(o)do if(a)a.push(o);else if(e(o)){var s=n(o,!0);s?o=s:a=[o]}else t(o)&&(a=[o]);while(o=o.nextSibling);if(o=a)for(a=i.nextSibling,s=0;s<o.length;s++)a?r.insertBefore(o[s],a):r.appendChild(o[s])}while(i=i.nextSibling)}}}}(),d.b("virtualElements",d.e),d.b("virtualElements.allowedBindings",d.e.N),d.b("virtualElements.emptyNode",d.e.ca),d.b("virtualElements.insertAfter",d.e.Wa),d.b("virtualElements.prepend",d.e.bb),d.b("virtualElements.setDomNodeChildren",d.e.S),function(){d.O=function(){this.sb={}},d.a.extend(d.O.prototype,{nodeHasBindings:function(e){switch(e.nodeType){case 1:return null!=e.getAttribute("data-bind");case 8:return null!=d.e.pb(e);default:return!1}},getBindings:function(e,t){var r=this.getBindingsString(e,t);return r?this.parseBindingsString(r,t,e):null},getBindingsString:function(e){switch(e.nodeType){case 1:return e.getAttribute("data-bind");case 8:return d.e.pb(e);default:return null}},parseBindingsString:function(e,t,r){try{var i,n=this.sb;if(!(i=n[e])){var o,a="with($context){with($data||{}){return{"+d.g.fa(e)+"}}}";o=new Function("$context","$element",a),i=n[e]=o}return i(t,r)}catch(s){throw s.message="Unable to parse bindings.\nBindings value: "+e+"\nMessage: "+s.message,s}}}),d.O.instance=new d.O}(),d.b("bindingProvider",d.O),function(){function r(e,t,r){for(var n=d.e.firstChild(t);t=n;)n=d.e.nextSibling(t),i(e,t,r)}function i(e,t,i){var o=!0,a=1===t.nodeType;a&&d.e.$a(t),(a&&i||d.O.instance.nodeHasBindings(t))&&(o=n(t,null,e,i).Ub),o&&r(e,t,!a)}function n(t,r,i,n){function a(e){return function(){return c[e]}}function s(){return c}var c,l,u=0,h=d.a.f.get(t,o);if(!r){if(h)throw Error("You cannot apply bindings multiple times to the same element."+t.id+" "+t.className);d.a.f.set(t,o,!0)}return d.h(function(){var o=i&&i instanceof d.C?i:new d.C(d.a.c(i)),p=o.$data;!h&&n&&d.kb(t,o),(c=("function"==typeof r?r(o,t):r)||d.O.instance.getBindings(t,o))&&(0===u&&(u=1,d.a.w(c,function(r){var i=d.d[r];if(i&&8===t.nodeType&&!d.e.N[r])throw Error("The binding '"+r+"' cannot be used with virtual elements");if(i&&"function"==typeof i.init&&(i=i.init(t,a(r),s,p,o))&&i.controlsDescendantBindings){if(l!==e)throw Error("Multiple bindings ("+l+" and "+r+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");l=r}}),u=2),2===u&&d.a.w(c,function(e){var r=d.d[e];r&&"function"==typeof r.update&&r.update(t,a(e),s,p,o)}))},null,{aa:t}),{Ub:l===e}}d.d={},d.C=function(e,t,r){t?(d.a.extend(this,t),this.$parentContext=t,this.$parent=t.$data,this.$parents=(t.$parents||[]).slice(0),this.$parents.unshift(this.$parent)):(this.$parents=[],this.$root=e,this.ko=d),this.$data=e,r&&(this[r]=e)},d.C.prototype.createChildContext=function(e,t){return new d.C(e,this,t)},d.C.prototype.extend=function(e){var t=d.a.extend(new d.C,this);return d.a.extend(t,e)};var o="__ko_boundElement";d.kb=function(e,t){return 2!=arguments.length?d.a.f.get(e,"__ko_bindingContext__"):void d.a.f.set(e,"__ko_bindingContext__",t)},d.La=function(e,t,r){return 1===e.nodeType&&d.e.$a(e),n(e,t,r,!0)},d.Ka=function(e,t){1!==t.nodeType&&8!==t.nodeType||r(e,t,!0)},d.Ja=function(e,r){if(r&&1!==r.nodeType&&8!==r.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");r=r||t.document.body,i(e,r,!0)},d.oa=function(t){switch(t.nodeType){case 1:case 8:var r=d.kb(t);if(r)return r;if(t.parentNode)return d.oa(t.parentNode)}return e},d.vb=function(t){return(t=d.oa(t))?t.$data:e},d.b("bindingHandlers",d.d),d.b("applyBindings",d.Ja),d.b("applyBindingsToDescendants",d.Ka),d.b("applyBindingsToNode",d.La),d.b("contextFor",d.oa),d.b("dataFor",d.vb)}();var h={"class":"className","for":"htmlFor"};d.d.attr={update:function(t,r){var i=d.a.c(r())||{};d.a.w(i,function(r,i){i=d.a.c(i);var n=!1===i||null===i||i===e;n&&t.removeAttribute(r),8>=d.a.da&&r in h?(r=h[r],n?t.removeAttribute(r):t[r]=i):n||t.setAttribute(r,i.toString()),"name"===r&&d.a.hb(t,n?"":i.toString())})}},d.d.checked={init:function(e,t,r){d.a.p(e,"click",function(){var i;if("checkbox"==e.type)i=e.checked;else{if("radio"!=e.type||!e.checked)return;i=e.value}var n=t(),o=d.a.c(n);"checkbox"==e.type&&o instanceof Array?d.a.ka(n,e.value,e.checked):d.g.ia(n,r,"checked",i,!0)}),"radio"!=e.type||e.name||d.d.uniqueName.init(e,function(){return!0})},update:function(e,t){var r=d.a.c(t());"checkbox"==e.type?e.checked=r instanceof Array?0<=d.a.k(r,e.value):r:"radio"==e.type&&(e.checked=e.value==r)}},d.d.css={update:function(e,t){var r=d.a.c(t());"object"==typeof r?d.a.w(r,function(t,r){r=d.a.c(r),d.a.ha(e,t,r)}):(r=String(r||""),d.a.ha(e,e.__ko__cssValue,!1),e.__ko__cssValue=r,d.a.ha(e,r,!0))}},d.d.enable={update:function(e,t){var r=d.a.c(t());r&&e.disabled?e.removeAttribute("disabled"):r||e.disabled||(e.disabled=!0)}},d.d.disable={update:function(e,t){d.d.enable.update(e,function(){return!d.a.c(t())})}},d.d.event={init:function(e,t,r,i){var n=t()||{};d.a.w(n,function(n){"string"==typeof n&&d.a.p(e,n,function(e){var o,a=t()[n];if(a){var s=r();try{var c=d.a.Q(arguments);c.unshift(i),o=a.apply(i,c)}finally{!0!==o&&(e.preventDefault?e.preventDefault():e.returnValue=!1)
}!1===s[n+"Bubble"]&&(e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation())}})})}},d.d.foreach={Za:function(e){return function(){var t=e(),r=d.a.za(t);return r&&"number"!=typeof r.length?(d.a.c(t),{foreach:r.data,as:r.as,includeDestroyed:r.includeDestroyed,afterAdd:r.afterAdd,beforeRemove:r.beforeRemove,afterRender:r.afterRender,beforeMove:r.beforeMove,afterMove:r.afterMove,templateEngine:d.G.ta}):{foreach:t,templateEngine:d.G.ta}}},init:function(e,t){return d.d.template.init(e,d.d.foreach.Za(t))},update:function(e,t,r,i,n){return d.d.template.update(e,d.d.foreach.Za(t),r,i,n)}},d.g.V.foreach=!1,d.e.N.foreach=!0,d.d.hasfocus={init:function(e,t,r){function i(i){e.__ko_hasfocusUpdating=!0;var n=e.ownerDocument;if("activeElement"in n){var o;try{o=n.activeElement}catch(a){o=n.body}i=o===e}n=t(),d.g.ia(n,r,"hasfocus",i,!0),e.__ko_hasfocusLastValue=i,e.__ko_hasfocusUpdating=!1}var n=i.bind(null,!0),o=i.bind(null,!1);d.a.p(e,"focus",n),d.a.p(e,"focusin",n),d.a.p(e,"blur",o),d.a.p(e,"focusout",o)},update:function(e,t){var r=!!d.a.c(t());e.__ko_hasfocusUpdating||e.__ko_hasfocusLastValue===r||(r?e.focus():e.blur(),d.o.P(d.a.Ha,null,[e,r?"focusin":"focusout"]))}},d.d.hasFocus=d.d.hasfocus,d.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t){d.a.ga(e,t())}};var p="__ko_withIfBindingData";s("if"),s("ifnot",!1,!0),s("with",!0,!1,function(e,t){return e.createChildContext(t)}),d.d.options={init:function(e){if("select"!==d.a.u(e))throw Error("options binding applies only to SELECT elements");for(;0<e.length;)e.remove(0);return{controlsDescendantBindings:!0}},update:function(t,i,n){function o(e,t,r){var i=typeof t;return"function"==i?t(e):"string"==i?e[t]:r}function a(e,t){if(h){var r=0<=d.a.k(h,d.i.n(t[0]));d.a.ib(t[0],r)}}var s=0==t.length,l=!s&&t.multiple?t.scrollTop:null;i=d.a.c(i());var u,h,p=n(),m=p.optionsIncludeDestroyed,f={};if(t.multiple?h=d.a.$(t.selectedOptions||d.a.Z(t.childNodes,function(e){return e.tagName&&"option"===d.a.u(e)&&e.selected}),function(e){return d.i.n(e)}):0<=t.selectedIndex&&(h=[d.i.n(t.options[t.selectedIndex])]),i){"undefined"==typeof i.length&&(i=[i]);var g=d.a.Z(i,function(t){return m||t===e||null===t||!d.a.c(t._destroy)});"optionsCaption"in p&&(u=d.a.c(p.optionsCaption),null!==u&&u!==e&&g.unshift(f))}else i=[];n=a,p.optionsAfterRender&&(n=function(t,r){a(0,r),d.o.P(p.optionsAfterRender,null,[r[0],t!==f?t:e])}),d.a.Ba(t,g,function(t,i,n){return n.length&&(h=n[0].selected&&[d.i.n(n[0])]),i=r.createElement("option"),t===f?(d.a.ga(i,u),d.i.X(i,e)):(n=o(t,p.optionsValue,t),d.i.X(i,d.a.c(n)),t=o(t,p.optionsText,n),d.a.jb(i,t)),[i]},null,n),h=null,s&&"value"in p&&c(t,d.a.za(p.value),!0),d.a.Ab(t),l&&20<Math.abs(l-t.scrollTop)&&(t.scrollTop=l)}},d.d.options.xa="__ko.optionValueDomData__",d.d.selectedOptions={init:function(e,t,r){d.a.p(e,"change",function(){var i=t(),n=[];d.a.r(e.getElementsByTagName("option"),function(e){e.selected&&n.push(d.i.n(e))}),d.g.ia(i,r,"selectedOptions",n)})},update:function(e,t){if("select"!=d.a.u(e))throw Error("values binding applies only to SELECT elements");var r=d.a.c(t());r&&"number"==typeof r.length&&d.a.r(e.getElementsByTagName("option"),function(e){var t=0<=d.a.k(r,d.i.n(e));d.a.ib(e,t)})}},d.d.style={update:function(e,t){var r=d.a.c(t()||{});d.a.w(r,function(t,r){r=d.a.c(r),e.style[t]!==r&&(e.style[t]=r||"")})}},d.d.submit={init:function(e,t,r,i){if("function"!=typeof t())throw Error("The value for a submit binding must be a function");d.a.p(e,"submit",function(r){var n,o=t();try{n=o.call(i,e)}finally{!0!==n&&(r.preventDefault?r.preventDefault():r.returnValue=!1)}})}},d.d.text={update:function(e,t){d.a.jb(e,t())}},d.e.N.text=!0,d.d.uniqueName={init:function(e,t){if(t()){var r="ko_unique_"+ ++d.d.uniqueName.ub;d.a.hb(e,r)}}},d.d.uniqueName.ub=0,d.d.value={init:function(e,t,r){function i(){a=!1;var i=t(),n=d.i.n(e);d.g.ia(i,r,"value",n)}var n=["change"],o=r().valueUpdate,a=!1;o&&("string"==typeof o&&(o=[o]),d.a.U(n,o),n=d.a.Na(n)),!d.a.da||"input"!=e.tagName.toLowerCase()||"text"!=e.type||"off"==e.autocomplete||e.form&&"off"==e.form.autocomplete||-1!=d.a.k(n,"propertychange")||(d.a.p(e,"propertychange",function(){a=!0}),d.a.p(e,"blur",function(){a&&i()})),d.a.r(n,function(t){var r=i;d.a.Vb(t,"after")&&(r=function(){setTimeout(i,0)},t=t.substring(5)),d.a.p(e,t,r)})},update:function(e,t){var r="select"===d.a.u(e),i=d.a.c(t()),n=d.i.n(e);i!==n&&(n=function(){d.i.X(e,i)},n(),r&&setTimeout(n,0)),r&&0<e.length&&c(e,i,!1)}},d.d.visible={update:function(e,t){var r=d.a.c(t()),i="none"!=e.style.display;r&&!i?e.style.display="":!r&&i&&(e.style.display="none")}},function(e){d.d[e]={init:function(t,r,i,n){return d.d.event.init.call(this,t,function(){var t={};return t[e]=r(),t},i,n)}}}("click"),d.v=function(){},d.v.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")},d.v.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")},d.v.prototype.makeTemplateSource=function(e,t){if("string"==typeof e){t=t||r;var i=t.getElementById(e);if(!i)throw Error("Cannot find template with ID "+e);return new d.m.j(i)}if(1==e.nodeType||8==e.nodeType)return new d.m.T(e);throw Error("Unknown template type: "+e)},d.v.prototype.renderTemplate=function(e,t,r,i){return e=this.makeTemplateSource(e,i),this.renderTemplateSource(e,t,r)},d.v.prototype.isTemplateRewritten=function(e,t){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(e,t).data("isRewritten")},d.v.prototype.rewriteTemplate=function(e,t,r){e=this.makeTemplateSource(e,r),t=t(e.text()),e.text(t),e.data("isRewritten",!0)},d.b("templateEngine",d.v),d.Fa=function(){function e(e,t,r,i){e=d.g.ea(e);for(var n=d.g.V,o=0;o<e.length;o++){var a=e[o].key;if(n.hasOwnProperty(a)){var s=n[a];if("function"==typeof s){if(a=s(e[o].value))throw Error(a)}else if(!s)throw Error("This template engine does not support the '"+a+"' binding within its templates")}}return r="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+d.g.fa(e)+" } })()},'"+r.toLowerCase()+"')",i.createJavaScriptEvaluatorBlock(r)+t}var t=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,r=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{Bb:function(e,t,r){t.isTemplateRewritten(e,r)||t.rewriteTemplate(e,function(e){return d.Fa.Nb(e,t)},r)},Nb:function(i,n){return i.replace(t,function(t,r,i,o,a){return e(a,r,i,n)}).replace(r,function(t,r){return e(r,"<!-- ko -->","#comment",n)})},rb:function(e,t){return d.s.wa(function(r,i){var n=r.nextSibling;n&&n.nodeName.toLowerCase()===t&&d.La(n,e,i)})}}}(),d.b("__tr_ambtns",d.Fa.rb),function(){d.m={},d.m.j=function(e){this.j=e},d.m.j.prototype.text=function(){var e=d.a.u(this.j),e="script"===e?"text":"textarea"===e?"value":"innerHTML";if(0==arguments.length)return this.j[e];var t=arguments[0];"innerHTML"===e?d.a.ga(this.j,t):this.j[e]=t},d.m.j.prototype.data=function(e){return 1===arguments.length?d.a.f.get(this.j,"templateSourceData_"+e):void d.a.f.set(this.j,"templateSourceData_"+e,arguments[1])},d.m.T=function(e){this.j=e},d.m.T.prototype=new d.m.j,d.m.T.prototype.text=function(){if(0==arguments.length){var t=d.a.f.get(this.j,"__ko_anon_template__")||{};return t.Ga===e&&t.na&&(t.Ga=t.na.innerHTML),t.Ga}d.a.f.set(this.j,"__ko_anon_template__",{Ga:arguments[0]})},d.m.j.prototype.nodes=function(){return 0==arguments.length?(d.a.f.get(this.j,"__ko_anon_template__")||{}).na:void d.a.f.set(this.j,"__ko_anon_template__",{na:arguments[0]})},d.b("templateSources",d.m),d.b("templateSources.domElement",d.m.j),d.b("templateSources.anonymousTemplate",d.m.T)}(),function(){function t(e,t,r){var i;for(t=d.e.nextSibling(t);e&&(i=e)!==t;)e=d.e.nextSibling(i),1!==i.nodeType&&8!==i.nodeType||r(i)}function r(e,r){if(e.length){var i=e[0],n=e[e.length-1];t(i,n,function(e){d.Ja(r,e)}),t(i,n,function(e){d.s.ob(e,[r])})}}function i(e){return e.nodeType?e:0<e.length?e[0]:null}function n(e,t,n,a,s){s=s||{};var c=e&&i(e),c=c&&c.ownerDocument,l=s.templateEngine||o;if(d.Fa.Bb(n,l,c),n=l.renderTemplate(n,a,s,c),"number"!=typeof n.length||0<n.length&&"number"!=typeof n[0].nodeType)throw Error("Template engine must return an array of DOM nodes");switch(c=!1,t){case"replaceChildren":d.e.S(e,n),c=!0;break;case"replaceNode":d.a.fb(e,n),c=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+t)}return c&&(r(n,a),s.afterRender&&d.o.P(s.afterRender,null,[n,a.$data])),n}var o;d.Ca=function(t){if(t!=e&&!(t instanceof d.v))throw Error("templateEngine must inherit from ko.templateEngine");o=t},d.Aa=function(t,r,a,s,c){if(a=a||{},(a.templateEngine||o)==e)throw Error("Set a template engine before calling renderTemplate");if(c=c||"replaceChildren",s){var l=i(s);return d.h(function(){var e=r&&r instanceof d.C?r:new d.C(d.a.c(r)),o="function"==typeof t?t(e.$data,e):t,e=n(s,c,o,e,a);"replaceNode"==c&&(s=e,l=i(s))},null,{Ra:function(){return!l||!d.a.ba(l)},aa:l&&"replaceNode"==c?l.parentNode:l})}return d.s.wa(function(e){d.Aa(t,r,a,e,"replaceNode")})},d.Tb=function(t,i,o,a,s){function c(e,t){r(t,u),o.afterRender&&o.afterRender(t,e)}function l(e,r){u=s.createChildContext(d.a.c(e),o.as),u.$index=r;var i="function"==typeof t?t(e,u):t;return n(null,"ignoreTargetNode",i,u,o)}var u;return d.h(function(){var t=d.a.c(i)||[];"undefined"==typeof t.length&&(t=[t]),t=d.a.Z(t,function(t){return o.includeDestroyed||t===e||null===t||!d.a.c(t._destroy)}),d.o.P(d.a.Ba,null,[a,t,l,o,c])},null,{aa:a})},d.d.template={init:function(e,t){var r=d.a.c(t());return"string"==typeof r||r.name||1!=e.nodeType&&8!=e.nodeType||(r=1==e.nodeType?e.childNodes:d.e.childNodes(e),r=d.a.Ob(r),new d.m.T(e).nodes(r)),{controlsDescendantBindings:!0}},update:function(t,r,i,n,o){r=d.a.c(r()),i={},n=!0;var a,s=null;"string"!=typeof r&&(i=r,r=d.a.c(i.name),"if"in i&&(n=d.a.c(i["if"])),n&&"ifnot"in i&&(n=!d.a.c(i.ifnot)),a=d.a.c(i.data)),"foreach"in i?s=d.Tb(r||t,n&&i.foreach||[],i,t,o):n?(o="data"in i?o.createChildContext(a,i.as):o,s=d.Aa(r||t,o,i,t)):d.e.ca(t),o=s,(a=d.a.f.get(t,"__ko__templateComputedDomDataKey__"))&&"function"==typeof a.D&&a.D(),d.a.f.set(t,"__ko__templateComputedDomDataKey__",o&&o.ua()?o:e)}},d.g.V.template=function(e){return e=d.g.ea(e),1==e.length&&e[0].unknown||d.g.Lb(e,"name")?null:"This template engine does not support anonymous templates nested within its templates"},d.e.N.template=!0}(),d.b("setTemplateEngine",d.Ca),d.b("renderTemplate",d.Aa),d.a.Qa=function(){function e(e,t,r,i,n){var o,a,s,c,d,l=Math.min,u=Math.max,h=[],p=e.length,m=t.length,f=m-p||1,g=p+m+1;for(o=0;p>=o;o++)for(c=s,h.push(s=[]),d=l(m,o+f),a=u(0,o-1);d>=a;a++)s[a]=a?o?e[o-1]===t[a-1]?c[a-1]:l(c[a]||g,s[a-1]||g)+1:a+1:o+1;for(l=[],u=[],f=[],o=p,a=m;o||a;)m=h[o][a]-1,a&&m===h[o][a-1]?u.push(l[l.length]={status:r,value:t[--a],index:a}):o&&m===h[o-1][a]?f.push(l[l.length]={status:i,value:e[--o],index:o}):(l.push({status:"retained",value:t[--a]}),--o);if(u.length&&f.length){e=10*p;var v;for(t=r=0;(n||e>t)&&(v=u[r]);r++){for(i=0;h=f[i];i++)if(v.value===h.value){v.moved=h.index,h.moved=v.index,f.splice(i,1),t=i=0;break}t+=i}}return l.reverse()}return function(t,r,i){return t=t||[],r=r||[],t.length<=r.length?e(t,r,"added","deleted",i):e(r,t,"deleted","added",i)}}(),d.b("utils.compareArrays",d.a.Qa),function(){function t(e){for(;e.length&&!d.a.ba(e[0]);)e.splice(0,1);if(1<e.length){for(var t=e[0],r=e[e.length-1],i=[t];t!==r;){if(t=t.nextSibling,!t)return;i.push(t)}Array.prototype.splice.apply(e,[0,e.length].concat(i))}return e}function r(r,i,n,o,a){var s=[];return r=d.h(function(){var e=i(n,a,t(s))||[];0<s.length&&(d.a.fb(s,e),o&&d.o.P(o,null,[n,e,a])),s.splice(0,s.length),d.a.U(s,e)},null,{aa:r,Ra:function(){return!d.a.qb(s)}}),{R:s,h:r.ua()?r:e}}d.a.Ba=function(i,n,o,a,s){function c(e,r){S=h[r],v!==r&&(w[e]=S),S.sa(v++),t(S.R),f.push(S),b.push(S)}function l(e,t){if(e)for(var r=0,i=t.length;i>r;r++)t[r]&&d.a.r(t[r].R,function(i){e(i,r,t[r].Y)})}n=n||[],a=a||{};var u=d.a.f.get(i,"setDomNodeChildrenFromArrayMapping_lastMappingResult")===e,h=d.a.f.get(i,"setDomNodeChildrenFromArrayMapping_lastMappingResult")||[],p=d.a.$(h,function(e){return e.Y}),m=d.a.Qa(p,n,a.dontLimitMoves),f=[],g=0,v=0,y=[],b=[];n=[];for(var S,T,x,w=[],p=[],E=0;T=m[E];E++)switch(x=T.moved,T.status){case"deleted":x===e&&(S=h[g],S.h&&S.h.D(),y.push.apply(y,t(S.R)),a.beforeRemove&&(n[E]=S,b.push(S))),g++;break;case"retained":c(E,g++);break;case"added":x!==e?c(E,x):(S={Y:T.value,sa:d.l(v++)},f.push(S),b.push(S),u||(p[E]=S))}l(a.beforeMove,w),d.a.r(y,a.beforeRemove?d.J:d.removeNode);for(var M,E=0,u=d.e.firstChild(i);S=b[E];E++){for(S.R||d.a.extend(S,r(i,o,S.Y,s,S.sa)),g=0;m=S.R[g];u=m.nextSibling,M=m,g++)m!==u&&d.e.Wa(i,m,M);!S.Hb&&s&&(s(S.Y,S.R,S.sa),S.Hb=!0)}l(a.beforeRemove,n),l(a.afterMove,w),l(a.afterAdd,p),d.a.f.set(i,"setDomNodeChildrenFromArrayMapping_lastMappingResult",f)}}(),d.b("utils.setDomNodeChildrenFromArrayMapping",d.a.Ba),d.G=function(){this.allowTemplateRewriting=!1},d.G.prototype=new d.v,d.G.prototype.renderTemplateSource=function(e){var t=(9>d.a.da?0:e.nodes)?e.nodes():null;return t?d.a.Q(t.cloneNode(!0).childNodes):(e=e.text(),d.a.ya(e))},d.G.ta=new d.G,d.Ca(d.G.ta),d.b("nativeTemplateEngine",d.G),function(){d.va=function(){var e=this.Kb=function(){if("undefined"==typeof n||!n.tmpl)return 0;try{if(0<=n.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(e){}return 1}();this.renderTemplateSource=function(t,i,o){if(o=o||{},2>e)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var a=t.data("precompiled");return a||(a=t.text()||"",a=n.template(null,"{{ko_with $item.koBindingContext}}"+a+"{{/ko_with}}"),t.data("precompiled",a)),t=[i.$data],i=n.extend({koBindingContext:i},o.templateOptions),i=n.tmpl(a,t,i),i.appendTo(r.createElement("div")),n.fragments={},i},this.createJavaScriptEvaluatorBlock=function(e){return"{{ko_code ((function() { return "+e+" })()) }}"},this.addTemplate=function(e,t){r.write("<script type='text/html' id='"+e+"'>"+t+"</script>")},e>0&&(n.tmpl.tag.ko_code={open:"__.push($1 || '');"},n.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},d.va.prototype=new d.v;var e=new d.va;0<e.Kb&&d.Ca(e),d.b("jqueryTmplTemplateEngine",d.va)}()})}()}(),define("util",[],function(){function e(e,t){e===URLPart.Search?window.location.search=t:e===URLPart.Hash&&(window.location.hash=t)}function t(e){return e===URLPart.Search?window.location.search:e===URLPart.Hash?window.location.hash:void 0}function r(e){return o[e]}function i(){}var n={};window.URLPart={Search:1,Hash:2};var o={demo:URLPart.Hash,login:URLPart.Hash,access_token:URLPart.Hash,error:URLPart.Hash,expires_in:URLPart.Hash,scope:URLPart.Hash,token_type:URLPart.Hash,data:URLPart.Hash,script:URLPart.Hash,dmode:URLPart.Hash,jasmine:URLPart.Hash,touch:URLPart.Hash,file:URLPart.Hash,panes:URLPart.Hash,offline:URLPart.Hash,live:URLPart.Hash,test:URLPart.Hash,nolocal:URLPart.Hash,nosync:URLPart.Hash,rdebug:URLPart.Hash,rsession:URLPart.Hash,cacheError:URLPart.Hash,state:URLPart.Search};n.hasURLParam=function(e,i){var n=e+"=";i&&(n+=i);var o=r(e);o||log("Invalid URL Part");var a=t(o);return a.indexOf(n)>=0},n.getURLParam=function(e,t){var i=t?t:r(e);if(i===URLPart.Search){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var n="[\\?&]"+e+"=([^&#]*)",o=new RegExp(n),a=o.exec(window.location.href);return null===a?void 0:decodeURIComponent(a[1].replace(/\+/g," "))}if(i===URLPart.Hash){for(var s,c=window.location.hash.substring(1),o=/([^&=]+)=([^&]*)/g;s=o.exec(c);)if(decodeURIComponent(s[1])===e)return decodeURIComponent(s[2]);return void 0}log("Invalid URL part")},n.insertURLParam=function(i,n,o){i=encodeURIComponent(i),n=encodeURIComponent(n);for(var a=r(i),s=t(a),c=s.substr(1).split("&"),d=c.length-1;d>=0;d--){var l=c[d].split("=");if(l[0]==i){l[1]=n,c[d]=l.join("=");break}}0>d&&(c[c.length]=[i,n].join("=")),e(a,c.join("&")),a!==URLPart.Hash||o||window.location.reload()},n.removeURLParam=function(i,n){i=encodeURIComponent(i);for(var o=r(i),a=t(o),s=a.substr(1).split("&"),c=s.length-1;c>=0;c--){var d=s[c].split("=");if(d[0]==i){s.splice(c,1);break}}e(o,s.join("&")),o!==URLPart.Hash||n||window.location.reload()};var a="chrome-extension:"===window.location.protocol;return n.__storage=a?chrome.storage.local:window.localStorage,n.storage={getItem:(n.__storage.getItem||function(e,t){return this.get(e,t||i)}).bind(n.__storage),setItem:(n.__storage.setItem||function(e,t){var r={};r[e]=t,n.__storage.set(r)}).bind(n.__storage),removeItem:(n.__storage.removeItem||function(e,t){this.remove(e,t)}).bind(n.__storage)},n}),define("platform",["ko","util"],function(e,t){function r(){this.versionRequired=4,this.requireCustomRedirect=!1,this.b=document.documentElement||document.body,this.orientation=Orientation.Portrait,this.windowWidth=e.observable(0),this.windowHeight=e.observable(0),this.kbsize=void 0,this.kbsizePortrait=void 0,this.kbsizeLandscape=void 0,this.hasBeenPortrait=!1,this.iframeApp=void 0,this.appState=void 0,this.isDevURL="dev.moo.do"===window.location.hostname,this.init();var t=!1||this.isDevURL||this.app&&this.debugApp||!this.app&&this.standalone;this.customRedirectString=window.location.protocol+"//"+(t?window.location.host:"www.moo.do"),this.app&&(this.customRedirectState={app:!0,appv:this.versionRequired}),this.keyboardOpenTime=this.app||this.android?200:this.winphone?200:this.mobileie?600:0}return window.Orientation={Portrait:0,Landscape:1},r.prototype={getPlatformInfo:function(e){e.os=this.OSName,e.browser=this.browser,e.appVersionRequired=this.versionRequired,e.app=this.app,e.standalone=this.standalone,e.packagedApp=this.packagedApp,e.requireCustomRedirect=this.requireCustomRedirect,e.isMobile=this.mobile,e.isPhone=this.phone,e.isTouch=this.touch,e.isTouchDevice=this.isTouchDevice,e.usePointerEvents=this.usePointerEvents,e.kbsize=this.kbsize,e.appState=this.appState,e.bodyClass=this.b.className,e.rawUA=navigator.userAgent},init:function(){this.initAppState();var e=navigator.userAgent,r="";if(this.app&&(r+=" app"),-1!==e.indexOf("Win")?(this.OSName="Windows",this.windows=!0,-1!==e.indexOf("Windows Phone")&&(this.phone=!0,this.touch=!0,this.mobile=!0)):-1!==e.indexOf("iPad")?(this.OSName="iPad",this.ios=!0,this.ipad=!0,this.phone=!0,this.touch=!0,this.mobile=!0):-1!==e.indexOf("iPhone")?(this.OSName="iPhone",this.ios=!0,this.iphone=!0,this.phone=!0,this.mobile=!0,this.touch=!0):-1!==e.indexOf("iPod")?(this.OSName="iPod",this.ios=!0,this.ipod=!0,this.phone=!0,this.mobile=!0,this.touch=!0):-1!==e.indexOf("Mac")?(this.OSName="MacOS",this.mac=!0):-1!==e.indexOf("X11")?(this.OSName="UNIX",this.unix=!0):-1!==e.indexOf("Android")?(this.OSName="Android",this.android=!0,this.touch=!0,this.mobile=!0,this.phone=!0,r+=" android"):-1!==e.indexOf("Linux")&&(this.OSName="Linux",this.linux=!0),this.ios&&(this.ios7=-1!==e.indexOf("OS 7"),this.ios70=-1!==e.indexOf("OS 7_0"),this.ios71=-1!==e.indexOf("OS 7_1"),this.ios7&&(r+=" ios7")),this.majorVersion=1e3,this.minorVersion=1e3,-1!==e.indexOf("MSIE")||-1!==e.indexOf("Trident")){this.browser="Trident",this.ie=!0,this.winphone=!!e.match(/IEMobile/i);var i;i=new RegExp(this.winphone||"Microsoft Internet Explorer"===navigator.appName?"MSIE ([0-9]{1,}[.0-9]{0,})":"Trident/.*rv:([0-9]{1,}[.0-9]{0,})"),null!=i.exec(e)&&(this.majorVersion=parseFloat(RegExp.$1))}else if(-1!==e.indexOf("Chrome")||-1!==e.indexOf("CriOS")){this.browser="Chrome",this.isChrome=!0;var i=new RegExp("Chrome/([0-9]{1,}).");null!=i.exec(e)&&(this.majorVersion=parseFloat(RegExp.$1))}else if(-1!==e.indexOf("Android")){this.browser="Native Android";var i=new RegExp("Linux; Android ([0-9]{1,}).([0-9]{1,}).");null!=i.exec(e)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))}else if(-1!==e.indexOf("Firefox")){this.browser="Firefox";var i=new RegExp("Firefox/([0-9]{1,}).");null!=i.exec(e)&&(this.majorVersion=parseFloat(RegExp.$1))}else if(-1!==e.indexOf("Safari")||"iPad"===this.OSName||"iPhone"===this.OSName||"iPod"===this.OSName){this.browser="Safari";var i;i=new RegExp(this.mobile?"OS ([0-9]{1,})_([0-9]{1,})":"Version/([0-9]{1,}).([0-9]{1,})."),null!=i.exec(e)&&(this.majorVersion=parseFloat(RegExp.$1),this.minorVersion=parseFloat(RegExp.$2))}else-1!==e.indexOf("Opera")&&(this.browser="Opera");this.isTouchDevice=!!("ontouchstart"in window||window.navigator.msMaxTouchPoints),this.usePointerEvents=!!window.navigator.msPointerEnabled,log("Touch Device: "+this.isTouchDevice+" Pointer Events: "+this.usePointerEvents),log("Browser: "+this.browser+"  Major Version: "+this.majorVersion+"  Minor Version: "+this.minorVersion),this.isTouchDevice&&(this.usePointerEvents?(this.touchStartEvent="MSPointerDown",this.touchMoveEvent="MSPointerMove",this.touchEndEvent="MSPointerUp",this.touchCancelEvent="MSPointerCancel"):(this.touchStartEvent="touchstart",this.touchMoveEvent="touchmove",this.touchEndEvent="touchend",this.touchCancelEvent="touchcancel")),this.usePointerEvents?(this.downEvent="MSPointerDown",this.moveEvent="MSPointerMove",this.upEvent="MSPointerUp"):(this.downEvent="mousedown",this.moveEvent="mousemove",this.upEvent="mouseup");try{var n=!!t.storage.getItem("forceFullUI")}catch(o){}t.hasURLParam("touch","false")||n?(this.touch=!1,this.phone=!1,this.mobile=!1,this.ios=!1,this.android=!1):(this.isTouchDevice||t.hasURLParam("touch","true"))&&(this.touch=!0,this.phone=!0,this.mobile=!0),this.windows&&(r+=" windows",this.ie?(r+=" ie",this.demo||(this.mobro=this.isMobro())):"Firefox"===this.browser&&(r+=" firefox")),this.phone&&(r+=" phone",r+=" nonbodyscroll",this.bodyscroll=!1),this.ipad&&(r+=" ipad"),this.mobileie=this.ie&&this.mobile,this.mobile&&!this.app&&this.calcKeyboardSize(),this.cmdChar=this.windows?"ctrl":"⌘",this.packagedApp="chrome-extension:"===window.location.protocol,this.standalone=!!window.navigator.standalone||this.packagedApp||window.navigator.userAgent.indexOf("FluidApp")>=0,(this.standalone||this.app||this.mobro)&&(this.requireCustomRedirect=!0),r&&r.length>0&&(this.b.className+=r),this.transition=this.addPrefix("transition"),this.animation=this.addPrefix("animation"),this.transform=this.addPrefix("transform"),this.transformOrigin=this.addPrefix("transformOrigin"),window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},this.ie&&(document.documentElement.addEventListener("MSHoldVisual",function(e){e.preventDefault()},!1),document.documentElement.addEventListener("contextmenu",function(e){e.preventDefault()},!1)),document.documentElement.addEventListener("keydown",this.normalizeKeys,!0),document.documentElement.addEventListener("keypress",this.normalizeKeys,!0),document.documentElement.addEventListener("keyup",this.normalizeKeys,!0)},isMobro:function(){var e=null;try{new ActiveXObject("")}catch(t){errorName=t.name}try{e=!!new ActiveXObject("htmlfile")}catch(t){e=!1}return e="ReferenceError"!=errorName&&0==e?!1:!0,!e},calcKeyboardSize:function(){this.ios?this.iphone||this.ipod?(this.kbsizePortrait=216,this.kbsizeLandscape=162,this.ios71&&(this.kbsizePortrait+=44,this.kbsizeLandscape+=44)):this.ipad&&(this.kbsizePortrait=264,this.kbsizeLandscape=352,this.kbsizePortrait+=44,this.kbsizeLandscape+=44):this.android||this.winphone?(this.kbsizePortrait=0,this.kbsizeLandscape=0):this.mobileie&&(this.kbsizePortrait=369,this.kbsizeLandscape=492)},normalizeKeys:function(e){void 0===e.normCode&&(e.normCode=null===e.keyCode||0===e.keyCode?null!=e.charCode?e.charCode:e.which:e.keyCode)},initAppState:function(){var e=location.hash.substring(1);if(e)for(var r,i=/([^&=]+)=([^&]*)/g;r=i.exec(e);)if("state"===decodeURIComponent(r[1])){var n=decodeURIComponent(r[2]);if(n){try{e=JSON.parse(n)}catch(o){log("Error parsing AppState: ",n),e=void 0}e&&(this.app=e.app===!0,this.appv=e.appv,this.debugApp=e.debug,this.live=e.live,this.offline=e.offline,this.syncContacts=e.syncContacts,this.test=e.test,this.appState=e)}break}this.live=this.live||t.hasURLParam("live","true"),this.test=!1,this.offline=this.offline||this.test||t.hasURLParam("offline","true")||!1,this.demo=t.hasURLParam("demo","true")||!1,this.script=t.hasURLParam("script")},addPrefix:function(e){var t="",r=["ms","webkit","moz","o"],i=this.b.style;if("string"==typeof i[e])t="";else for(var n=0;n<r.length;n++)if("string"==typeof i["-"+r[n]+"-"+e]){t=r[n];break}var o=t.length>0?e.charAt(0).toUpperCase()+e.slice(1):e;return t?{prop:"-"+t+"-"+e,style:t+o}:{prop:e,style:o}},blockClient:function(){switch(this.browser){case"Firefox":if(this.majorVersion<16)return{platform:"Firefox",browser:this.browser,update:!0};break;case"Chrome":if(this.majorVersion<26)return{platform:"Chrome",browser:this.browser,update:!0};break;case"Native Android":if(2===this.majorVersion&&this.minorVersion<1||this.majorVersion<2)return{platform:"Native Android",browser:"NativeAndroid",update:!0};break;case"Opera":return{platform:this.browser,browser:this.browser,update:!1};case"Trident":if(!this.isDevURL&&(this.majorVersion<10||this.phone&&!this.demo))return{platform:"Internet Explorer",browser:this.browser,update:this.majorVersion<10};break;case"Safari":if(this.mobile&&this.majorVersion<6)return{platform:"Safari",browser:this.browser,update:!0};if(!this.mobile&&(6==this.majorVersion&&this.minorVersion<1||this.majorVersion<6))return{platform:"Safari",browser:this.browser,update:!0}}if(this.app){if(this.appv<this.versionRequired)return log("App Version out of date."),{version:this.versionRequired};if(this.appv>this.versionRequired)return log("App is newer than the javascript, forcing an app cache update"),{cacheUpdate:!0,error:!1}}if("1402998159101"!==document.body.getAttribute("ver")){if(!t.hasURLParam("cacheError"))return g.reportError(new Error("VersionMismatch, CacheError: false")),this.sendToApp("resetCache"),{cacheUpdate:!0,error:!0};require(["globals"],function(e){e.reportError(new Error("VersionMismatch, CacheError: true"))})}},actionVerb:function(){return this.touch?"tap":"click"},actionVerbCaps:function(){return this.touch?"Tap":"Click"},updateOrientation:function(){var e=90==Math.abs(window.orientation)?Orientation.Landscape:Orientation.Portrait;return this.orientation==Orientation.Portrait&&(this.hasBeenPortrait=!0),this.orientation=e,this.app||(this.kbsize=this.orientation==Orientation.Portrait?this.kbsizePortrait:this.kbsizeLandscape),this.orientation},sendToApp:function(e,t){if(this.app)if(this.ios){this.iframeApp||(this.iframeApp=document.createElement("IFRAME"),this.iframeApp.setAttribute("height","1px"),this.iframeApp.setAttribute("width","1px"),document.documentElement.appendChild(this.iframeApp));var r="duchess://"+e;void 0!==t&&(r+="//"+t),this.iframeApp.setAttribute("src",r)}else this.android&&void 0!==AppInterface&&AppInterface.addNotification(t)}},new r}),this.document&&(window.dateWrapper=dateWrapper),this.dateLibLoaded||dateWrapper(),define("date",function(){}),define("globals",["ko","platform","util","date"],function(e,t,r){function i(e,t){var r,i,n,o,a,s,c,d;for(r=3&e.length,i=e.length-r,n=t,a=3432918353,s=461845907,d=0;i>d;)c=255&e.charCodeAt(d)|(255&e.charCodeAt(++d))<<8|(255&e.charCodeAt(++d))<<16|(255&e.charCodeAt(++d))<<24,++d,c=(65535&c)*a+(((c>>>16)*a&65535)<<16)&4294967295,c=c<<15|c>>>17,c=(65535&c)*s+(((c>>>16)*s&65535)<<16)&4294967295,n^=c,n=n<<13|n>>>19,o=5*(65535&n)+((5*(n>>>16)&65535)<<16)&4294967295,n=(65535&o)+27492+(((o>>>16)+58964&65535)<<16);switch(c=0,r){case 3:c^=(255&e.charCodeAt(d+2))<<16;case 2:c^=(255&e.charCodeAt(d+1))<<8;case 1:c^=255&e.charCodeAt(d),c=(65535&c)*a+(((c>>>16)*a&65535)<<16)&4294967295,c=c<<15|c>>>17,c=(65535&c)*s+(((c>>>16)*s&65535)<<16)&4294967295,n^=c}return n^=e.length,n^=n>>>16,n=2246822507*(65535&n)+((2246822507*(n>>>16)&65535)<<16)&4294967295,n^=n>>>13,n=3266489909*(65535&n)+((3266489909*(n>>>16)&65535)<<16)&4294967295,n^=n>>>16,n>>>0}function n(e){try{for(var t=JSON.parse(JSON.stringify(e)),r=0;r<t.length;++r)""!==t[r].search&&(t[r].search="HasSearch");return JSON.stringify(t)}catch(i){return"Failed to sanitize pane state"}}function o(e){try{var t=JSON.parse(e);return delete t.paneState,delete t.gdocTitle,JSON.stringify(t)}catch(r){return"Failed to parse settings"}}function a(e){try{return JSON.stringify(e)}catch(t){log("Error stringify object: "+t.message)}}function s(){var e=x.settings.get("activeUser");return e?"MooDoRDebug"+(new Date).getTime()+"_"+e:"Unknown"}function c(e){try{x.PAssert(782,e,"Must specify a callback")}catch(t){w.reportError(t)}return function(){try{if(e)return e.apply(void 0,arguments)}catch(t){throw x.reportError(t,arguments),t}}}function d(e,t){e.onloadDone=!1,e.onload=function(){e.onloadDone=!0,t&&t()},e.onReadystatechange=function(){"loaded"!==e.readyState||e.onloadDone||(e.onloadDone=!0,t&&t())}}function l(e){for(var t="",r=0;r<e.length;++r)t+=" "+a(e[r]);return t}function u(e){function t(e){if(e)if(e.nodeType===Node.TEXT_NODE)r.push(e);else for(var i=0;i<e.childNodes.length;++i){var n=e.childNodes[i];t(n)}}var r=[];return t(e),r}function h(e,t){for(var r=0,i=u(e),n=0;n<i.length;++n){var o=i[n].length;if(r+o>=t)return{element:i[n],offset:t-r};r+=o}try{x.PAssert(792,!1,"Unable to find offset child element")}catch(a){w.reportError(a)}return void 0}function p(e){for(var t=u(e),r=0,i=0;i<t.length;++i)r+=t[i].length;return r}function m(e){return x.hasClass(e,"text")||"androidInput"===e.id&&E.isEnabled()}function f(){var e=2,t=12,r=$.pane.getScroller(),i=e+t*$.speed;r.scrollTop+=i,Q&&requestAnimationFrame(f)}function g(e,t){for(var r=0;r<t.length;++r)e.comparator?e.comparator(t[r])&&e.action(t[r]):e.each&&e.each(t[r]),e.item=t[r],x.searchVMLIs(e)}function v(e,t){try{x.PAssert(829,"string"!=typeof e,"Should only pass objects to the obj mapping function",e)}catch(r){w.reportError(r)}var i={};for(var n in e){try{x.PAssert(830,e.hasOwnProperty(n),"This should always be the case, the prototype shouldn't be extended")}catch(r){w.reportError(r)}if(void 0!==e[n]&&null!==e[n]){var o=t[n];if(o)i[o]=e[n];else{try{x.PAssert(831,!1,"Incoming field should be added to the field map",n)}catch(r){w.reportError(r)}i[n]=e[n]}}}return i}function y(e,t,r){try{x.PAssert(838,void 0!==r,"Must pass in valid key data to type")}catch(i){w.reportError(i)}if(!e){var n=x.getSelectionInfo();n&&(e=n.node)}if(document.createEvent&&e){var o=document.createEvent("Event");o.normCode=r.normCode,o.shiftKey=!!r.shiftKey,o.synthetic=!0,o.initEvent(t,!0,!0),e.dispatchEvent(o)}else try{x.PAssert(839,!1,"Unable to fire key event")}catch(i){w.reportError(i)}}function b(e,t,r){try{x.PAssert(840,void 0!==r,"Must pass in a valid button to click with")}catch(i){w.reportError(i)}if(!e){var n=x.getSelectionInfo();n&&(e=n.node)}if(document.createEvent){var o=document.createEvent("Event");o.button=r,o.synthetic=!0,o.initEvent(t,!0,!0),e.dispatchEvent(o)}else try{x.PAssert(841,!1,"Unable to fire click event")}catch(i){w.reportError(i)}}function S(){document.removeEventListener("DOMContentLoaded",S,!1),window.removeEventListener("load",S,!1);for(var e=0;e<tt.length;++e)tt[e]();tt=void 0}function T(e){var t="";if("object"==typeof e){var r=[];for(key in e)r[r.length]=encodeURIComponent(key)+"="+encodeURIComponent(e[key]);t=r.join("&").replace(/%20/g,"+")}else{try{x.PAssert(870,"string"==typeof e,"Only Objects or Strings are currently supported")}catch(i){w.reportError(i)}t=e}return t}var x={vmMain:void 0,vmDebug:void 0,topBarHeight:40,phoneMainY:40,topBoxHeight:t.phone?50:150,keyboardToolbarHeight:40,hasFocus:!0,zoomTime:0,demoMode:!1,intro:void 0,focusedPaneID:void 0,focusedPane:void 0,focusedItem:void 0,isScrolling:!1,ClickThreshold:5,noLocalWrites:!1,isLoadingRemote:!1,revealingMenu:!1,isKeyboardOpen:!1,dragging:void 0,draggingHidden:void 0,dragStartInfo:{x:0,y:0},dragStartTimeout:void 0,startDrag:void 0,itemMenuOpenedOn:void 0,tempUL:document.getElementById("tempUL"),elements:{}},w=x,E={isEnabled:function(){return!!t.android}};require(["android"],function(e){E=e
});var M;require(["VMLI"],function(e){M=e}),window.KeyCode={BackSpace:8,Tab:9,Enter:13,Shift:16,Ctrl:17,Alt:18,Escape:27,Space:32,PageUp:33,PageDown:34,Hash:35,Home:36,LeftArrow:37,UpArrow:38,RightArrow:39,DownArrow:40,Delete:46,D1:49,D2:50,D3:51,D4:52,D5:53,D6:54,D8:56,LAngle:60,RAngle:62,At:64,A:65,B:66,E:69,F:70,G:71,I:73,N:78,O:79,S:83,U:85,V:86,Y:89,Z:90,LeftMeta:91,RightMeta:93,NumPlus:107,Equals:187,Comma:188,Dash:189,Period:190,Slash:191,Tilde:192,LBracket:219,RBracket:221,Apos:222},window.TextSpace="﻿",x.PhoneWidth=480,window.DriveStatus={Offline:0,Connecting:1,Saving:2,Saved:3},window.PaneMode={Normal:1,Timeline:2},window.MessageAction={Default:0,Reload:1,Login:2,Demo:3,ResetClient:4,None:5},window.MessageType={Info:0,Warning:1,Error:2,Fatal:3,Subtitle:4,Intro:5,RequiredUpdate:6,InfoGray:7,MobileOffline:8},window.MessageID={Undefined:0,ConnectionError:1,OfflineUndo:2,FatalError:3,DocChange:4,OfflineWarn:5,OnlineInfo:6,CacheReset:7,RequiredUpdate:8,Updated:9,MobileOffline:10,ApplicationError:11},window.VMLIFlag={None:0,Header:1,Collapsed:2,Selected:4,Highlighted:8,NumList:16,Complete:4096,P2:8192,P1:16384,P0:32768,Flagged:65536},window.VersionType={Structure:1,Text:2},window.SaveFlag={None:0,Prop:1,Text:2,All:3},window.PropChangeType={None:0,Date:2,Complete:4,Archive:8,Flagged:16,Priority:32,All:63},window.LoginState={NONE:0,LOGGED_OUT:1,LOGGED_IN:2},x.isFlagSet=function(e,t){return(e&t)===t},x.isAtLeastOneFlagSet=function(e,t){return 0!==(e&t)},x.PCFMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2|VMLIFlag.Complete|VMLIFlag.Flagged,x.PCMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2|VMLIFlag.Complete,x.PFMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2|VMLIFlag.Flagged,x.PMask=VMLIFlag.P0|VMLIFlag.P1|VMLIFlag.P2,x.fieldMapIn={id:"id",items:"i",archivedItems:"ai",text:"t",modifiedOffline:"l",modifiedOfflineText:"o",versionText:"u",version:"v",formats:"f",isArchived:"a",isDeleted:"x",isCollapsed:"m",date:"d",dateText:"s",allDayDate:"ad",dateCreated:"c",dateCompleted:"^",priority:"p",isComplete:"z",isFlagged:"*"},x.priorityMapOut={},x.priorityMapOut[VMLIFlag.None]=" ",x.priorityMapOut[VMLIFlag.P0]=" p0",x.priorityMapOut[VMLIFlag.P1]=" p1",x.priorityMapOut[VMLIFlag.P2]=" p2",window.NumListPrefix="#.",window.NumListPrefixOther="1.",window.DatePrefix="@",window.ContactPrefix="+",window.cmdChar=t.windows?"ctrl":"⌘",x.getTransitionClass=function(e){var t;switch(e){case 50:t="trans05";break;case 100:t="trans1";break;case 200:t="trans2";break;case 300:t="trans3";break;case 400:t="trans4";break;case 500:t="trans5";break;case 1e3:t="trans10";break;default:console.log("ERROR: no time for ",e)}return t},x.setTransformStyle=function(e,r,i){try{x.PAssert(743,e,"Must provide a valid element")}catch(n){w.reportError(n)}if(e){try{x.PAssert(744,void 0!==r,"Must supply a valid X offset")}catch(n){w.reportError(n)}try{x.PAssert(745,void 0!==i,"Must supply a valid Y offset")}catch(n){w.reportError(n)}e.style[t.transform.style]=t.ie?"translate("+r+"px, "+i+"px)":"translate3d("+r+"px, "+i+"px, 0px)"}},x.setTransitionStyle=function(e,r,i,n){try{x.PAssert(746,e,"Must provide a valid element")}catch(o){w.reportError(o)}e&&(n=n||"ease",e.style[t.transition.style]=r+" "+i+"ms "+n,setTimeout(function(){e.style[t.transition.style]=""},i))};var C=t.ie;x.setTransform=function(e,r,i,n,o){n>0?C?setTransformStyle(e,r,i):(x.setTransitionStyle(e,t.transform.prop,n,o),x.setTransformStyle(e,r,i)):r||i?x.setTransformStyle(e,r,i):e.style[t.transform.style]="none"},x.reload=function(){try{x.PAssert(747,!P,"Page should not be reloaded while waiting for an appcache update to finish.")}catch(e){w.reportError(e)}P&&x.reportError(new Error("Page requesting reload while waiting for AppCache update.")),window.location.reload()},x.isSetupPageOpen=!1,x.isMainPageOpen=!1,x.openMainPage=function(){x.isSetupPageOpen&&(x.isSetupPageOpen=!1),x.isMainPageOpen||(x.isMainPageOpen=!0);var e=document.getElementById("outerWrapper"),t=document.getElementById("setupWrapper");e&&t&&(x.removeClass(e,"none"),x.addClass(t,"none"))},x.openSetupPage=function(){x.isMainPageOpen&&(x.isMainPageOpen=!1),x.addClass(document.getElementById("outerWrapper"),"none"),x.removeClass(document.getElementById("setupWrapper"),"none")};var I=!1,P=!1;x.setAppCacheUpdateState=function(e){P=e,e&&(I=!0)},x.isEmpty=function(e){for(var t in e)return!1;return!0},x.isEmail=function(e){var t=new RegExp(/.+@.+\..+/i),r=t.exec(e);return!!r},x.removeDOM=function(e){var t=document.getElementById(e);try{x.PAssert(748,t,"DOM Element must exist to remove it")}catch(r){w.reportError(r)}t&&t.parentNode.removeChild(t)},x.isRunningScript=function(){return x.AScript&&x.AScript.isRunning};var A=!1;x.goOnline=function(){x.noLocalWrites&&!x.isDemoMode()&&(x.messageQueue.clearMessage(MessageID.OfflineWarn),x.messageQueue.pushMessage(MessageID.OnlineInfo)),A=!1},x.goOffline=function(){x.noLocalWrites&&!x.isDemoMode()&&(x.messageQueue.clearMessage(MessageID.OnlineInfo),x.messageQueue.pushMessage(MessageID.OfflineWarn)),A=!0},x.isOffline=function(){return A},x.preventLocalWrites=function(){ShouldLog(LogLevels.Warning)&&log("---- WARNING: Local Writes Disabled ----"),A&&!x.isDemoMode()&&(x.messageQueue.clearMessage(MessageID.OnlineInfo),x.messageQueue.pushMessage(MessageID.OfflineWarn)),x.noLocalWrites=!0},x.shouldWriteLocal=function(){return!x.noLocalWrites},x.enableDemoMode=function(){x.demoMode=!0,t.mobile||t.script||x.messageQueue.pushMessage({text:"You are in demo mode, your information is not being saved. Click here to leave.",type:MessageType.Info,action:MessageAction.Login}),x.preventLocalWrites()},x.isDemoMode=function(){return x.demoMode},window.DisplayMode={Default:0,NoTopBar:1,NoPaneHeaders:2,ForceTwoPane:4,NoScrollbars:8,NoBackground:16,NoPaneTop:32,NoInteraction:64,NoPanePadding:128,NoPaneStyle:256,NoRightClick:512,ShowBanner:1024,FullMin:2047},x.activeDisplayMode=DisplayMode.Default,x.isDisplayModeActive=function(e){return(x.activeDisplayMode&e)===e},x.enableMinMode=function(e){try{if(e=parseInt(e),("Trident"===t.browser||t.android===!0)&&(e|=DisplayMode.NoScrollbars,e|=DisplayMode.NoInteraction),!t.touch){if(e&DisplayMode.NoTopBar){var r=document.getElementById("desktopMenu");r&&x.addClass(r,"none");var i=document.getElementById("container");i&&(i.style.top="0px");for(var n=document.getElementsByClassName("pane"),o=0;o<n.length;++o)n[o]&&(n[o].style.marginTop="0px",n[o].style.height="100%")}e&DisplayMode.NoPaneHeaders&&x.addClass(document.body,"noPaneHeaders"),e&DisplayMode.NoPaneTop&&x.addClass(document.body,"noPaneTopBox"),e&DisplayMode.NoPaneStyle&&x.addClass(document.body,"noPaneStyle")}if(e&DisplayMode.NoPaneTop&&x.addClass(document.body,"noPanePadding"),e&DisplayMode.NoScrollbars&&x.addClass(document.body,"noScrollbars"),e&DisplayMode.NoBackground){var a=document.getElementsByTagName("html")[0];try{x.PAssert(749,a,"Must have a valid HTML element")}catch(s){w.reportError(s)}a&&x.addClass(a,"noBackground")}if(e&DisplayMode.NoInteraction){var c=document.getElementById("preventInteraction");c&&(x.removeClass(c,"none"),c.addEventListener("mousewheel",function(e){return e.stopImmediatePropagation(),!1},!0),c.addEventListener("mousedown",function(e){return e.preventDefault(),e.stopImmediatePropagation(),!1},!0),c.addEventListener("keydown",function(e){return e.preventDefault(),e.stopImmediatePropagation(),!1},!0))}e&DisplayMode.ShowBanner&&!(e&DisplayMode.NoInteraction)?x.removeClass(document.getElementById("cornerBannerMessage"),"none"):x.removeDOM("cornerBannerMessage"),x.activeDisplayMode=parseInt(e)}catch(d){x.reportError(d)}},x.sendEvent=function(e,t,r){try{x.PAssert(750,!x.isString(r),"Values must be numeric")}catch(i){w.reportError(i)}window.ga&&!x.isDemoMode()&&ga("send","event",e,t,x.getAnonUserIdentifier(),r)},x.sendTimeEvent=function(e,t,r){try{x.PAssert(751,!x.isString(r),"Values must be numeric")}catch(i){w.reportError(i)}window.ga&&!x.isDemoMode()&&ga("send","timing",e,t,r,x.getAnonUserIdentifier())};var k=void 0;x.startTimeEvent=function(e,t){if(log&&log.now){try{x.PAssert(752,void 0===k,"This function needs to be updated to allow nested timing events")}catch(r){w.reportError(r)}k={startTime:log.now(),category:e,variable:t}}},x.endTimeEvent=function(){if(log&&log.now){try{x.PAssert(753,void 0!==k,"Must have started a timing event")}catch(e){w.reportError(e)}var t=log.now()-k.startTime;x.sendTimeEvent(k.category,k.variable,t),k=void 0}};var D={};x.registerEvent=function(e,t,r){try{x.PAssert(754,!D.hasOwnProperty(e),"Should only register an event once")}catch(i){w.reportError(i)}try{x.PAssert(755,void 0!==e,"Must specify a name for the event")}catch(i){w.reportError(i)}try{x.PAssert(756,void 0!==t,"Must specify a category for the event")}catch(i){w.reportError(i)}try{x.PAssert(757,void 0!==r,"Must specify an action for the event")}catch(i){w.reportError(i)}var n={category:t,action:r,label:x.getAnonUserIdentifier(),count:0};D[e]=n},x.aggregateEvent=function(e,t){try{x.PAssert(758,D.hasOwnProperty(e),"Must register an event before using it")}catch(r){w.reportError(r)}void 0===t&&(t=1),D[e]&&(D[e].count+=t)};var L=!1;x.pageDataCleared=function(){L=!0},x.onunload=function(){log("Unloading the page");for(var e in D){var t=D[e];x.sendEvent(t.category,t.action,t.count),t.count=0}if(x.vmMain&&x.vmMain.failedGapiLoad?x.sendEvent("ScriptLoad","GapiFailed"):gapiCalled||x.sendEvent("ScriptLoad","GapiNotLoaded"),x.vmMain&&x.vmMain.updatePaneScrollState(),!L){var r=require("gdata");r&&x.settings.set(Settings.lastServerVersion,r.getServerVersion())}return x.isLoadingRemote?"We are still syncing your changes, are you sure you want to exit?":void 0},t.demo||t.packagedApp||(window.onbeforeunload=x.onunload);var O=LoginState.LOGGED_OUT;x.getLoginState=function(){var e=O;if(x.shouldWriteLocal())try{var t=r.storage.getItem("loginState");null!==t&&void 0!==t&&(e=parseInt(t))}catch(i){x.reportError(i)}return e},x.setLoginState=function(e){try{x.PAssert(759,null!==e&&void 0!==e&&!isNaN(e),"Should always be a valid LoginState enum value")}catch(t){w.reportError(t)}if(O=e,x.shouldWriteLocal())try{(isNaN(e)||null===e||void 0===e)&&(e=LoginState.LOGGED_OUT),r.storage.setItem("loginState",e)}catch(i){x.reportError(i)}},window.Settings={theme:"theme",syncContacts:"syncContacts",lastContactSync:"lastContactSync",disableNotifications:"disableNotifications",docSharing:"docSharing",authScopes:"authScopes",localIntegrity:"localIntegrity",paneState:"paneState",localDataVersion:"localDataVersion",shownTutorial:"shownTutorial",gdocId:"gdocId",gdocTitle:"gdocTitle",activeUser:"activeUser",noSounds:"noSounds",noLocalWrites:"noLocalWrites",lastMessageSync:"lastMessageSync",lastServerVersion:"lastServerVersion",helpPaneState:"helpPaneState",shownInstallInfo:"shownInstall"};var R=[Settings.localIntegrity,Settings.paneState,Settings.authScopes,Settings.localDataVersion,Settings.shownTutorial,Settings.lastContactSync,Settings.disableNotifications,Settings.gdocId,Settings.gdocTitle,Settings.activeUser,Settings.noSounds,Settings.lastMessageSync,Settings.lastServerVersion,Settings.noLocalWrites,Settings.lastMessageSync];if(x.settings={settings:{},prefix:"V~",init:function(){try{r.storage.setItem("poke",0)}catch(e){x.preventLocalWrites()}this.ensureLocalCopy()},initEvents:function(e){try{x.PAssert(760,e,"Must supply a callback function")}catch(t){w.reportError(t)}x.shouldWriteLocal()&&window.addEventListener("storage",function(t){if(t||(t=window.event),e(t),"localSettings"===t.key)try{this.settings=t.newValue?JSON.parse(t.newValue):{}}catch(r){x.reportError(r),this.settings={}}}.bind(this),!1)},ensureLocalCopy:function(e){try{x.PAssert(761,void 0===e,"Invalid caller param forceSync")}catch(t){w.reportError(t)}if(x.shouldWriteLocal()&&(e||x.isEmpty(this.settings)))try{var i=r.storage.getItem("localSettings");this.settings=i?JSON.parse(i):{}}catch(n){x.reportError(n),this.settings={}}},flushLocalCopy:function(){if(x.shouldWriteLocal())try{r.storage.setItem("localSettings",JSON.stringify(this.settings))}catch(e){x.reportError(e)}},set:function(e,t,r){try{x.PAssert(762,void 0!==e&&null!==e,"Must specify a valid property name")}catch(i){w.reportError(i)}try{x.PAssert(763,!e.startsWith(this.prefix),"Use setVersion to set version properties")}catch(i){w.reportError(i)}this.ensureLocalCopy(),null===r&&(r=0);var n=this.settings[e],o=this.getVersion(e),a=!1;if(n!==t||"object"==typeof t){if(void 0===r){if(a=!0,o>=0&&R.indexOf(e)<0){var s=this.getVersion(e);this.settings[this.prefix+e]=-(s+1)}}else{try{x.PAssert(764,r>=0,"Remote version must be positive")}catch(i){w.reportError(i)}a=this.isPropertyNewer(e,r),a&&(this.settings[this.prefix+e]=r)}a&&(this.settings[e]=t,R.indexOf(e)<0&&(x.fireCustomEvent("settingsChange",{property:this.prefix+e,value:this.settings[this.prefix+e],isRemote:void 0!==r}),x.fireCustomEvent("settingsChange",{property:e,value:t,isRemote:void 0!==r}))),this.flushLocalCopy()}return a},get:function(e,t){try{x.PAssert(765,void 0!==e&&null!==e,"Must specify a valid property name")}catch(r){w.reportError(r)}return this.ensureLocalCopy(t),this.settings[e]},getVersion:function(e,t){try{x.PAssert(766,void 0!==e&&null!==e,"Must specify a valid property name")}catch(r){w.reportError(r)}return this.ensureLocalCopy(t),this.settings[this.prefix+e]||0},setVersion:function(e,t,r){try{x.PAssert(767,void 0!==e&&null!==e,"Must specify a valid property name")}catch(i){w.reportError(i)}try{x.PAssert(768,e.startsWith(this.prefix),"Setting versions requires a version property name")}catch(i){w.reportError(i)}try{x.PAssert(769,t>=0,"Versions should always be positive")}catch(i){w.reportError(i)}this.ensureLocalCopy(r),this.settings[e]=t},reset:function(e){if(e)this.ensureLocalCopy(),delete this.settings[e],this.flushLocalCopy();else if(this.settings={},x.shouldWriteLocal())try{r.storage.setItem("localSettings","{}")}catch(t){x.reportError(t)}},resetAll:function(e){var t={};if(e)for(var i=0;i<e.length;++i)t[e[i]]=this.settings[e[i]];if(this.settings=t,e)this.flushLocalCopy();else if(x.shouldWriteLocal())try{r.storage.setItem("localSettings","{}")}catch(n){x.reportError(n)}},isPropertyNewer:function(e,t){try{x.PAssert(770,void 0!==t&&null!==t&&t>=0,"Remote versions should always be positive")}catch(r){w.reportError(r)}var i=this.getVersion(e);try{x.PAssert(771,void 0!==i&&null!==i,"Self version should always be valid")}catch(r){w.reportError(r)}return Math.abs(i)<Math.abs(t)},getRawSettings:function(){var e;if(x.shouldWriteLocal())try{e=r.storage.getItem("localSettings")}catch(t){x.reportError(t)}else try{return JSON.stringify(this.settings)}catch(t){return x.reportError(t),'{m: "Invalid Settings"}'}return e}},REPORT_ACTIONS){window.ResolveAction={Error:1,SetRemoteText:2,SetLocalText:4,DupeItem:8,AddLocalItem:16,RemoveRemoteItem:32,AddBackDeletedItem:64,LocalMoveCandidate:128,MoveLocalItem:256,DeleteLocalItem:512,MoveRemoteItem:1024},window.RATAG={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,O:13,P:14,Q:15,R:16,S:17};var _=r.hasURLParam("nosync")||r.hasURLParam("demo");_||console.log("%cGenerating Sync Report - use #noSync=true to disable and __syncReport.printList() to view.","color: green");var N=[];x.reportAction=function(e,t,r){_||N.push({tag:e,type:t,info:r,tagString:x.enumToString(window.RATAG,e),typeString:x.enumToString(window.ResolveAction,t)})},x.reportActionCrash=function(e){x.reportAction(RATAG.S,ResolveAction.Error,{msg:e.message,stack:e.stack})},window.DataSnapshot={Before:0,After:1};var F=[];x.reportData=function(e,t){F[t]=JSON.stringify(e)},window.__syncReport={print:function(){return N},printList:function(){if(_)return"Sync Report Disabled";if(0===N.length)return"No Actions Perfomed in Sync";for(var e=0;e<N.length;++e){var t=N[e];log("Action: ",{type:t.typeString,tag:t.tagString,info:t.info})}return"Actions Complete"},filterType:function(e){return N.filter(function(t){return t.type===e})},filterTag:function(e){return N.filter(function(t){return t.tag===e})},getData:function(){var e={snapshotBefore:F[DataSnapshot.Before],actions:JSON.stringify(N),snapshotAfter:F[DataSnapshot.After]};return e},getSaveData:function(){var e=this.getData();return JSON.stringify(e)},save:function(){var e=new Blob([this.getSaveData()],{type:"text/plain;charset=utf-8"});saveAs(e,"SyncReport.json")},view:function(){x.XHR({type:"POST",url:window.location.protocol+"//"+window.location.host+"/debug/sendSyncReport",data:this.getSaveData(),cb:function(e){if(log("SyncReport Response: ",e),200===e.status)try{var t=JSON.parse(e.responseText);window.location=window.location.protocol+"//"+window.location.host+"/syncReport?"+t.reportID}catch(r){log("Error parsing SyncReport Response: "+r.message)}else log("Remote Sync Report Error: ",e.status,e.responseText)}})}}}x.applyBindings=function(t,r){var i=document.getElementById(r);try{x.PAssert(772,t,"A valid model must be defined when apply bindings")}catch(n){w.reportError(n)}try{x.PAssert(773,i,"A valid element must be defined when apply bindings")}catch(n){w.reportError(n)}if(i&&t)try{e.applyBindings(t,i)}catch(o){throw o.message+=" | Binding on: "+x.elementToString(i),x.reportError(o),o}else{var a="Invalid model or element passed to applyBindings | ";a+=i?"NoModel - Elem: "+x.elementToString(i):t?"NoElem - Elem: #"+r:"NoModelNoElem - Elem: #"+r,x.reportError(new Error(a))}},e.observable.fn.toString=function(){return"observable: "+e.toJSON(this(),null,2)},e.computed.fn.toString=function(){return"computed: "+e.toJSON(this(),null,2)},e.bindingHandlers.load={init:function(e,t,r,i,n){try{x.PAssert(774,i.onLoad,"If no load function is specified, remove the binding from the template")}catch(o){w.reportError(o)}var a,s=n.$parents.length-2;s>=0&&(a=n.$parents[s]),i.onLoad(e,a)}},e.bindingHandlers.check={init:function(e,t,r,i){var n=t();n()&&x.addClass(e,"checked"),x.setupClick(e,i,{onClick:function(t){n(!n()),n()?x.addClass(e,"checked"):x.removeClass(e,"checked"),t.preventDefault(),t.stopPropagation()}})},update:function(e,t){var r=t();r()?x.addClass(e,"checked"):x.removeClass(e,"checked")}},e.bindingHandlers.tap={init:function(e,t,r,i){x.setupClick(e,i,t())}},e.bindingHandlers.stopBinding={init:function(){return{controlsDescendantBindings:!0}}},e.bindingHandlers.possHTML={init:function(){return{controlsDescendantBindings:!0}},update:function(t,r,i,n){n.isStyled?t.innerHTML=e.utils.unwrapObservable(r()):t.textContent=e.utils.unwrapObservable(r())}},e.bindingHandlers.tooltip={init:function(r,i){t.mobile||x.setupMouseOver(r,e.utils.unwrapObservable(i()),!1)},update:function(r,i){t.mobile||x.setupMouseOver(r,e.utils.unwrapObservable(i()),!0)}},x.setupMouseOver=function(e,r,i){try{x.PAssert(775,!t.mobile)}catch(n){w.reportError(n)}x.tooltip?i?x.tooltip.update(e,r):x.tooltip.register(e,r):x.reportError(new Error("Tooltips registered before VMTooltip created"))},"function"!=typeof String.prototype.startsWith&&(String.prototype.startsWith=function(e){return 0===this.lastIndexOf(e,0)}),"function"!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(e){return-1!==this.indexOf(e,this.length-e.length)}),e.bindingHandlers.css2=e.bindingHandlers.css,x.findFirstDiff=function(e,t,r){if(!e)return t.length;if(!t)return e.length;for(var i=Math.min(e.length,t.length),n=0;i>n;++n)if(r){if(e.charAt(n).toLowerCase()!==t.charAt(n).toLowerCase())return n}else if(e.charAt(n)!==t.charAt(n))return n;return Math.max(e.length,t.length)},x.findMatchingLength=function(e,t,r){if(!e||!t)return 0;for(var i=Math.min(e.length,t.length),n=0;i>n;++n)if(r){if(e.charAt(n).toLowerCase()!==t.charAt(n).toLowerCase())return n}else if(e.charAt(n)!==t.charAt(n))return n;return i},x.TEMP_PREFIX="~T^";var V=0;x.generateTempId=function(){return x.TEMP_PREFIX+Date.now()+ ++V},x.isLocalItem=function(e){try{x.PAssert(776,e.id,"All items should have an ID even if it is a temp one")}catch(t){w.reportError(t)}return e.id[0]===x.TEMP_PREFIX[0]&&e.id[1]===x.TEMP_PREFIX[1]&&e.id[2]===x.TEMP_PREFIX[2]},x.getClientInfo=function(e){x.XHR({type:"GET",url:"http://api.hostip.info/get_json.php",cb:function(t){if(200===t.status){var r=JSON.parse(t.responseText);e(r)}else e({ip:"Unknown"})}})},x.requestNotification=function(e){var t=document.forms.requestNotification,r=document.getElementById("notificationResult"),i=t.email.value;return void 0===i||null===i||i.length<5?r.innerText="Please enter a valid email address.":x.XHR({type:"POST",url:window.location.protocol+"//api.moo.do/requestNotification",data:{email:i,platform:e},cb:function(e){200===e.status?(t.email.value="",r.innerText="Thanks for your interest!"):r.innerText="There was an error processing your request, please try again in a few minutes."}}),!1};var B=void 0;x.getUserIdentifier=function(){if(!B){var e=require("goog"),t=e.authenticatedUserEmail()||x.settings.get("activeUser");if(!t)return"Unknown";B=t}return B};var U=void 0;x.getAnonUserIdentifier=function(){if(!U){var e=x.getUserIdentifier();U=e[0]+e[1]+e[2]+i(e,17124123)}return U},x.introHash=function(e){return i(e,347236113)},x.getRunningState=function(e){try{var t=x.settings.get(Settings.paneState)}catch(r){log("Failed to get paneState")}e.isDebug=!1,e.isDemo=x.isDemoMode(),e.localWrites=x.shouldWriteLocal(),e.url=window.location.href,e.paneState=n(t),e.localSettings=o(x.settings.getRawSettings()),e.loginState=x.getLoginState(),e.checkpoints=window.__checkpoints,e.gapiLoadError=gapiLoadError,e.windowWidth=window.innerWidth,e.windowHeight=window.innerHeight,e.selection=x.parseExtra(window.getSelection()),e.eventStream=x.getEventStream(),e.trackerStream=x.getTrackerStream()},x.getAppInfo=function(e){var r="Loaded";x.vmMain&&x.vmMain.failedGapiLoad?r="ErrorLoading":gapiCalled||(r="NotLoaded"),e.gapiStatus=r,e.sessionID=window.__SESSION_ID,e.appCacheUpdated=I,t.getPlatformInfo(e),x.getRunningState(e),require("gdata").getState(e)},x.reportSignup=function(e){try{x.PAssert(777,e,"Must specify a valid email address to signup with")}catch(t){w.reportError(t)}x.XHR({type:"POST",url:window.location.protocol+"//api.moo.do/reportSignup",data:{email:e},cb:function(e){200!==e.status&&ShouldLog(LogLevels.Error)&&log("Failed to report signup",e.responseText,e)}})};var q=!1;x.criticalErrorReported=function(){return q},x.handleCriticalError=function(){if(q=!0,x.isDemoMode())x.reload();else{var e=document.createElement("div");e.id="criticalError",e.textContent="There was a critical error while loading the app, "+t.actionVerb()+" to reload.",t.isTouchDevice?e.addEventListener(t.touchStartEvent,function(){x.reload()},!0):e.addEventListener(t.upEvent,function(){x.reload()},!0),x.prependChild(document.body,e),x.removeDOM("outerWrapper"),x.removeDOM("setupWrapper"),x.removeDOM("templates")}},x.reportEvent=function(e){if(!x.isDemoMode()){var t=x.parseExtra(e);x.eventStream.push(t)}},x.getEventStream=function(){return a(x.eventStream.ordered())},window.__getEventStream=x.getEventStream,x.getTrackerStream=function(){try{var e=require("tracker");return e.stringifyGroups()}catch(t){log("Error getting tracker stream: ",t.message)}},x.parseExtra=function(e){var t;if(e)try{var r;if(e instanceof KeyboardEvent)r={type:e.type,currentTarget:x.elementToString(e.currentTarget),target:x.elementToString(e.target||e.srcElement),keyCode:e.keyCode,normCode:e.normCode,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,tstamp:Date.now()};else if(e instanceof window.MouseEvent)r={type:e.type,currentTarget:x.elementToString(e.currentTarget),relatedTarget:x.elementToString(e.relatedTarget),target:x.elementToString(e.target||e.srcElement),clientX:e.clientX,clientY:e.clientY,ctrlKey:e.ctrlKey,shiftKey:e.shiftKey,metaKey:e.metaKey,altKey:e.altKey,which:e.which,button:e.button,tstamp:Date.now()};else if(window.TouchEvent&&e instanceof window.TouchEvent){r={type:e.type,currentTarget:x.elementToString(e.currentTarget),relatedTarget:x.elementToString(e.relatedTarget),target:x.elementToString(e.target||e.srcElement),tstamp:Date.now()};var i=e.touches[0];i&&(r.clientX=i.clientX,r.clientY=i.clientY)}else if(window.PointerEvent&&e instanceof window.PointerEvent)r={type:e.type,currentTarget:x.elementToString(e.currentTarget),relatedTarget:x.elementToString(e.relatedTarget),target:x.elementToString(e.target||e.srcElement),clientX:e.clientX,clientY:e.clientY,tstamp:Date.now()};else if(e instanceof window.Event)r={type:e.type,currentTarget:x.elementToString(e.currentTarget),relatedTarget:x.elementToString(e.relatedTarget),target:x.elementToString(e.target||e.srcElement),tstamp:Date.now()};else if(e instanceof Selection)if(0===e.rangeCount)r={rangeCount:0};else{var n=e.getRangeAt(0),o=n.startContainer,s=!1,c=0,d=n.endContainer,l=!1,u=0;o.nodeType===Node.TEXT_NODE&&(c=o.length,o=o.parentNode,s=!0),x.hasClass(o,"text")&&(c=p(o)),d.nodeType===Node.TEXT_NODE&&(u=d.length,d=d.parentNode,l=!0),x.hasClass(d,"text")&&(c=p(d)),r={rangeCount:e.rangeCount,startContainer:x.elementToString(o),startWasTextNode:s,startOffset:n.startOffset,startElementLength:c,endContainer:x.elementToString(d),endWasTextNode:l,endOffset:n.endOffset,endElementLength:u}}else r=e;t=a(r)}catch(h){log("Error parsing extra "+h.message)}return t},window.__jsVersion="1402998159101",x.handleJSError=function(e,t,r,i){function n(){var r={};x.getAppInfo(r),x.XHR({type:"POST",url:window.location.protocol+"//api.moo.do/debug/reportError",data:{msg:e,url:window.location.href,stack:t,logs:o,info:JSON.stringify(r),user:a,extra:s,jsVersion:window.__jsVersion,htmlVersion:document.body.getAttribute("ver")},cb:function(e){200!==e.status?log("Failed to report remote error",e.responseText,e):log("Reported Remote Error: ",e.responseText)}})}if(i||console.error("JS Error: "+e,"  Stack: ",t,"  Extra: ",r),e||t)try{var o=o=__LOG_BUFFER.ordered().join("\r\n"),a=x.getUserIdentifier(),s=x.parseExtra(r);"Unknown"!==a?n():x.getClientInfo(function(e){e&&(a=e.ip),n()})}catch(c){log("Badness happened reporting errors to server: ",c)}else;},window.onerror=function(e,t,r,i,n){n?(log("Reported Global OnError: "+e+" Script: "+t+" Line: "+r+" Column: "+i),x.reportError(n)):(log("Unreported Global OnError: "+e+" Script: "+t+" Line: "+r+" Column: "+i),x.reportError(e))},x.reportError=function(e,t){!e||t||e.message||e.stack||(t=e,e=void 0),e||(e={message:"Undefined error passed to reporter",stack:x.getCurrentStack("")}),x.handleJSError(e.message,e.stack,t)},window.__SendInfo=function(e){return x.handleJSError("Remote Client Info",void 0,e,!0),"Thank you for providing your client info!"},window.__CreateDebugSession=function(e){if(window.remote)return"Debug session already started";var t=e||s();window.rcon=window.console,x.handleJSError("Remote Debug Session",void 0,t,!0),x.addScript("http://jsconsole.com/remote.js?"+t,"rDebugScript");var r=!1,i=0,n="";return window.rdbg={startProfile:function(e){try{return r?"Profiler already running":(n=e?e:"RDBGProfile_"+i,window.rcon.profile(n),r=!0,"Profiler Started: "+n)}catch(t){return"Error starting profile: "+t.message}},stopProfile:function(){try{if(r){window.rcon.profileEnd(n),r=!1;var e="Profile Completed: "+n;return n="",i++,e}return"Profiler not running, use startProfile()"}catch(t){return"Error stopping profile: "+t.message}}},"Your remote debug session has started: "+t},r.hasURLParam("rdebug","true")&&setTimeout(function(){var e=r.getURLParam("rsession")||s();window.__CreateDebugSession(e),log("%c---- REMOTE DEBUGGING ENABLED: "+e+" ----","color: green")},2e3),t.demo||console.log('%cIf you have been asked to send us your client information or have been seeing issues, please use __SendInfo("MESSAGE") to give us your information.',"color: green"),window.Checkpoint={MainRun:1,RequireLoaded:2,PageLoad:4,LocalDocLoad:8,InitData:16,DBLoaded:32,OnInitializedData:64,InitializeMain:128,MaskRequired:255},x.checkpoint=function(e){window.__checkpoints|=e},x.hasSentLowMemoryWarning=e.observable(!1),x.handleLowMemory=function(e){x.hasSentLowMemoryWarning()||(x.hasSentLowMemoryWarning(!0),log("Low Memory Event: ",e),x.handleJSError("DeviceLowMemory: "+e,void 0))};var H=!0;x.getCurrentStack=function(e){if(H){try{var t=JSON.stringify(e)}catch(r){log("Error stringifying stack message",e)}var r=new Error(t||e);if(r.stack)return r.stack}return H=!1,""};var W=12e5,K=0;x.checkForRemoteChanges=function(){var e=Date.now();if(K-e>=W)try{x.AppCache.checkForUpdate(),x.messageQueue.updateRemoteMessages()}catch(t){x.reportError(t)}finally{K=e}},x.createRingBuffer=function(e){var t=0,r=[],i=e;return{get:function(e){return r[e]},push:function(e){r[t]=e,t=(i+t+1)%i},count:function(){return t},reset:function(){t=0,r=[]},buffer:function(){return r},limit:function(e){i=e},ordered:function(){return r.slice(t).concat(r.slice(0,t))},entries:function(){for(var e=this.ordered(),t=0;t<e.length;++t)console.log("---- Entry ["+t+"] ----"),console.log(e[t])}}},x.wrapFn=function(e){function t(){try{return e.apply(this,arguments)}catch(t){var r;try{r=JSON.stringify(arguments)}catch(i){log("Unable to stringify args: ",arguments)}finally{x.reportError(t,r)}}}return t},function(){var e=function(e){var t=window[e];window[e]=function(){var e=Array.prototype.slice.call(arguments),r=e[0];return"function"==typeof r&&(e[0]=x.wrapFn(r)),t.apply?t.apply(this,e):t(e[0],e[1])}};e("setTimeout"),e("setInterval")}();var j=t.mobile?20:40;window.__LOG_BUFFER=x.createRingBuffer(j);var G=window.log;window.log=function(){__LOG_BUFFER.push(Array.prototype.join.call(arguments," ")),console.log.apply(console,arguments)};for(var z in G)window.log[z]=G[z];x.isFunction=function(e){return!!(e&&e.constructor&&e.call&&e.apply)},x.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},x.isString=function(e){return"string"==typeof e},x.isObject=function(e){return"object"==typeof e&&null!==e},x.enumToString=function(e,t){for(var r in e)if(e[r]==t)return r;return null},x.elementToString=function(e,t){if(e){var r=e.nodeName;return e.id&&(r+="#"+e.id),e.className&&(r+="."+e.className),t&&e.innerText&&(r+=":"+e.innerText.length),"["+r+"]"}return"[UNDEFINED]"},x.highlightElement=function(e,t,r){try{x.PAssert(778,e,"Must have a valid element to highlight")}catch(i){w.reportError(i)}if(e){var n=t||.5,o=r||1,a=e.getBoundingClientRect(),s=a.top+a.height*o,c=a.left+a.width*n;x.showArrowAt(s,c)}},x.showArrowAt=function(e,r){var i=document.getElementById("iarrow");try{x.PAssert(780,i,"Must have a valid highlight arrow")}catch(n){w.reportError(n)}i.style.display="block";var o=t.mobile?-35:0;i.style.top=e+o+"px",i.style.left=r+"px"},x.hideHighlightElement=function(){var e=document.getElementById("iarrow");try{x.PAssert(781,e,"Must have a valid highlight arrow")}catch(t){w.reportError(t)}e.style.display="none"};var J=500;x.setupClick=function(e,r,i){function n(e){var t=e.eventX-this.lastX,n=e.eventY-this.lastY;if(0!==t||0!==n){var o=!this.moved;if(this.lastX=e.eventX,this.lastY=e.eventY,e.distanceX=this.distanceX=this.distanceX+Math.abs(t),e.distanceY=this.distanceY=this.distanceY+Math.abs(n),(this.moved||e.distanceX>x.ClickThreshold||e.distanceY>x.ClickThreshold)&&(this.moved=!0,e.moved=this.moved),(i.onMove||i.onFirstMove)&&(e.diffX=e.eventX-this.startX,e.diffY=e.eventY-this.startY,e.xThisFrame=t,e.yThisFrame=n,e.xFromTopLeft=this.xFromTopLeft,e.yFromTopLeft=this.yFromTopLeft,e.startX=this.startX,e.startY=this.startY,e.startClientX=this.startClientX,e.startClientY=this.startClientY,e.startSrc=this.startSrc,o&&i.onFirstMove&&i.onFirstMove.call(r,e),i.onMove)){var a=!1;a=i.onMove.call(r,e),a&&e.stopImmediatePropagation()}}}function o(e){e.srcElement||(e.srcElement=e.target);var t=Date.now(),n=this.lastTouch||t,o=Math.max(0,t-n);this.numClicks?this.numClicks++:this.numClicks=1,e.eventX=this.lastX,e.eventY=this.lastY,e.moved=this.moved,e.timeDelta=o,e.diffX=this.lastX-this.startX,e.diffY=this.lastY-this.startY,e.startX=this.startX,e.startY=this.startY,e.xFromTopLeft=this.xFromTopLeft,e.yFromTopLeft=this.yFromTopLeft,e.startSrc=this.startSrc,J>o&&o>0&&i.onDblClick&&!this.moved&&i.onDblClick.call(r,e),isNaN(e.button)||0===e.button?(this.lastTouch=t,i.onClick&&!this.moved&&i.onClick.call(r,e)):1==e.button&&i.onMiddleClick&&!this.moved&&i.onMiddleClick.call(r,e),(isNaN(e.button)||0===e.button)&&i.onEnd&&i.onEnd.call(r,e),setTimeout(function(){this.lastTouch=void 0,this.numClicks=void 0
}.bind(this),J)}function a(e){i.onCancel&&i.onCancel.call(r,e)}function s(e){e.timeStart=this.timeStart=Date.now(),e.srcElement||(e.srcElement=e.target),this.startSrc=e.srcElement,this.moved=!1,e.startX=this.startX=e.eventX,e.startY=this.startY=e.eventY,e.startClientX=this.startClientX=e.clientX,e.startClientY=this.startClientY=e.clientY,this.lastX=e.eventX,this.lastY=e.eventY,this.distanceX=0,this.distanceY=0;var t=x.offset(e.srcElement);e.xFromTopLeft=this.xFromTopLeft=e.eventX-t.left,e.yFromTopLeft=this.yFromTopLeft=e.eventY-t.top,(isNaN(e.button)||0===e.button)&&i.onStart&&i.onStart.call(r,e),isNaN(e.changeLastY)||(this.lastY+=e.changeLastY)}function d(r){var i=t.ie?r:r.touches[0];return r.eventX=i.pageX,r.eventY=i.pageY,r.clientX=i.clientX,r.clientY=i.clientY,n.call(e,r),r.returnFalse?!1:void 0}function l(r){return document.removeEventListener(t.touchMoveEvent,S,y),document.removeEventListener(t.touchEndEvent,T,y),document.removeEventListener(t.touchCancelEvent,M,y),C&&C.stop(),o.call(e,r),r.returnFalse?!1:void 0}function u(r){return document.removeEventListener(t.touchMoveEvent,S,y),document.removeEventListener(t.touchEndEvent,T,y),document.removeEventListener(t.touchCancelEvent,M,y),C&&C.stop(),a.call(e,r),r.returnFalse?!1:void 0}function h(r){if(!r.handled){this.lastInputTouch=!0;var i=t.ie?r:r.touches[0];return r.eventX=i.pageX,r.eventY=i.pageY,r.clientX=i.clientX,r.clientY=i.clientY,s.call(e,r),r.ignore||(document.addEventListener(t.touchMoveEvent,S,y),document.addEventListener(t.touchEndEvent,T,y),document.addEventListener(t.touchCancelEvent,M,y),C&&(log("Add Gesture Pointer: ",r.id,x.elementToString(r.target),x.elementToString(e)),C.addPointer(r.pointerId))),r.returnFalse?!1:void 0}}function p(t){return this.lastInputTouch?void 0:(t.eventX=t.pageX,t.eventY=t.pageY,n.call(e,t),t.returnFalse?!1:void 0)}function m(r){return r.handled||this.lastInputTouch?void 0:(document.removeEventListener(t.moveEvent,P,y),document.removeEventListener(t.upEvent,A,y),0===r.button&&o.call(e,r),r.returnFalse?!1:void 0)}function f(r){return r.handled||this.lastInputTouch?void 0:(this.lastInputTouch=!1,r.eventX=r.pageX,r.eventY=r.pageY,s.call(e,r),r.ignore||(0===r.button&&document.addEventListener(t.moveEvent,P,y),document.addEventListener(t.upEvent,A,y)),r.returnFalse?!1:void 0)}function g(e){e.handled||this.lastInputTouch||(e.srcElement||(e.srcElement=e.target),i.onRightClick&&i.onRightClick.call(r,e))}try{x.PAssert(783,e,"Expecting an object to bind the click hanlders to.")}catch(v){w.reportError(v)}if(!e)return void log("Skipping setupClick because no valid DOM object was provided to bind to");r||(r=e);var y=!1;x.isFunction(i)?i={onClick:i}:i&&i.useCapture&&(y=i.useCapture);var b=c(h),S=c(d),T=c(l),M=c(u),C=void 0,I=c(f),P=c(p),A=c(m),k=c(g);return t.isTouchDevice?e.addEventListener(t.touchStartEvent,b,y):e.addEventListener(t.downEvent,I,y),t.usePointerEvents&&t.mobile&&e.addEventListener("mousedown",function(e){return E.isEnabled()&&E.isTargetBox(e)||(e.preventDefault(),e.stopImmediatePropagation()),!1},y),i.onRightClick&&!t.mobile&&e.addEventListener("contextmenu",k,y),this};var Y=!1;x.StartSpinner=function(){t.mobile&&!Y&&(Y=!0,x.removeClass(document.getElementById("loading"),"hidden"))},x.StopSpinner=function(){var e=document.getElementById("loading");Y&&e&&x.addClass(document.getElementById("loading"),"hidden")},Array.prototype.removeAt=function(e){return this.splice(e,1)[0]},Array.prototype.remove=function(e){var t=this.indexOf(e);return t>=0&&this.removeAt.call(this,t),t},Array.prototype.findInsertIndex=function(e,t){try{x.PAssert(785,e,"Require a valid element to insert")}catch(r){w.reportError(r)}try{x.PAssert(786,t,"Require a valid comparison function")}catch(r){w.reportError(r)}for(var i=0,n=this.length-1;n>=i;){var o=i+n>>1,a=t(this[o],e);if(0>a)i=o+1;else{if(!(a>0))return o;n=o-1}}return i},Array.prototype.insertSorted=function(e,t){var r=this.findInsertIndex(e,t);this.splice.apply(this,[r,0,e])},e.observableArray.fn.insertSorted=function(e,t){this.peek().insertSorted(e,t),this.valueHasMutated()},x.clamp=function(e,t,r){return Math.max(t,Math.min(r,e))},x.randParam=function(){return"?t="+Date.now()},x.createPath=function(e){return window.location.protocol+"//"+window.location.host+"/"+e},x.addScript=function(e,t,r){var i=document.createElement("script");i.type="text/javascript",i.src=e,t&&(i.id=t),r&&d(i,r),"undefined"!=typeof i&&document.getElementsByTagName("head")[0].appendChild(i)},x.addStylesheet=function(e,t){var r=document.createElement("link");r.type="text/css",r.rel="stylesheet",r.href=e,t&&d(r,t),"undefined"!=typeof r&&document.getElementsByTagName("head")[0].appendChild(r)},x.PAssert=function(e,t){if(!t){var r={isAssert:!0,tag:e};try{var i=l(Array.prototype.slice.call(arguments,2));log(arguments.length>2?"Assert Failure: "+i:"Assert Failure"),x.reportError(new Error("Assert Failure: "+i),r)}catch(n){log("Exception in PAssert: ",n),x.reportError(n,r)}}},x.getSelectionInfo=function(){var e=window.getSelection(),t=e.anchorNode;return t?{node:t.nodeType===Node.TEXT_NODE?t.parentNode:t,selection:e}:void 0},x.getSelectionRange=function(){var e=window.getSelection();if(e.rangeCount>0){var t=e.getRangeAt(0);return t}return void 0},x.getItemForElement=function(t){if(E.isEnabled()){var r=E.getCurrentVMLI();if(r)return r}if(t&&t!==document.body){t.nodeType===Node.TEXT_NODE&&(t=t.parentNode);var i=e.dataFor(t);return i instanceof M?i:void 0}return void 0},x.getSelectedItem=function(){var e=window.getSelection();return x.getItemForElement(e.anchorNode)},x.clearSelection=function(){window.getSelection().removeAllRanges()},x.selectElement=function(e,t){if(e.textContent.length>0&&e.textContent!==TextSpace){var r=window.getSelection(),i=document.createRange(),n=t?e.textContent.length:0;i.setStart(e.childNodes[0],n),i.setEnd(e.childNodes[0],e.textContent.length),r.removeAllRanges(),r.addRange(i)}else e.focus()},x.selectChildren=function(e,t,r){if(e){var i=e.getParsedText().length-e.styleLength,t=Math.min(t,i),n=Math.min(t+r,i),o=window.getSelection(),a=document.createRange(),s=void 0,c=-1,d=void 0,l=-1,h=0,p=e.getSpan();if(p){for(var m=u(p),f=0;f<m.length;++f){var g=m[f].length;if(-1===c&&h+g>=t&&(s=m[f],c=t-h),h+g>=n){d=m[f],l=n-h;break}h+=g}try{x.PAssert(788,s&&c>=0)}catch(v){w.reportError(v)}try{x.PAssert(789,d&&l>=0)}catch(v){w.reportError(v)}try{x.PAssert(790,c<=s.length)}catch(v){w.reportError(v)}try{x.PAssert(791,l<=d.length)}catch(v){w.reportError(v)}c=0>c?0:c,l=0>l?0:l,a.setStart(s,c),a.setEnd(d,l),o.removeAllRanges(),o.addRange(a)}}else try{x.PAssert(787,!1,"Valid item and text required to perform selection")}catch(v){w.reportError(v)}},x.getOffsetOfSubNode=function(e,t){for(var r=0,i=u(e),n=u(t),o=0;o<i.length&&i[o]!=n[0];++o)r+=i[o].length;return r},x.selectMultiline=function(e,t,r,i){var n=!1,o=window.getSelection(),a=document.createRange(),s=h(e,t),c=h(r,i);try{x.PAssert(793,s&&s.element&&!isNaN(s.offset),"Start element is invalid")}catch(d){w.reportError(d)}try{x.PAssert(794,c&&c.element&&!isNaN(c.offset),"End element is invalid")}catch(d){w.reportError(d)}return s&&s.element&&c&&c.element&&(a.setStart(s.element,s.offset),a.setEnd(c.element,c.offset),o.removeAllRanges(),o.addRange(a),retval=!0),n},x.saveSelectionItem=function(e){if(!e){var t=x.getSelectionInfo();if(!t||0===t.rangeCount)return void 0;e=t.selection.getRangeAt(0)}var r=!0;if(e&&e.startContainer&&e.endContainer)try{var i=x.getItemForElement(e.startContainer),n=x.getItemForElement(e.endContainer);if(i&&n)var o=x.getSelectOffsetsInSpan(i,i.getSpan(),e),a=x.getSelectOffsetsInSpan(n,n.getSpan(),e),s=x.getPaneForElement(i.getSpan());else r=!1}catch(c){x.reportError(c),r=!1}else r=!1;var d=void 0;return r&&(d={start:o,end:a,startItem:i,endItem:n,pane:s}),d};var X={};x.saveSelection=function(e,t){X[e]=x.saveSelectionItem(t,e)},x.clearSavedSelection=function(e){X[e]=void 0},x.restoreSavedSelection=function(e,t){var r=X[e],i=void 0;if(r&&(!t||t===r.pane)){try{i=x.restoreSelectionItem(r),i&&x.scrollIntoView(i.getSpan(),0)}catch(n){x.reportError(n)}x.clearSavedSelection(e)}return!!i},x.restoreSelectionItem=function(e){try{x.PAssert(795,e,"Must restore to a valid selection")}catch(t){w.reportError(t)}var r=x.hasClass(e.startItem.getElement(),"hidden"),i=x.hasClass(e.endItem.getElement(),"hidden");if(r&&!i){var n=x.selectMultiline(e.endItem.getSpan(),e.end.end,e.endItem.getSpan(),e.end.end);return n?e.endItem:void 0}if(!r&&i){var n=x.selectMultiline(e.startItem.getSpan(),e.start.start,e.startItem.getSpan(),e.start.start);return n?e.startItem:void 0}var n=x.selectMultiline(e.startItem.getSpan(),e.start.start,e.endItem.getSpan(),e.end.end);return n?e.startItem:void 0},x.getSelectOffsetsInSpan=function(e,t,r,i){var n=e?e.styleLength:0,o={start:0,startText:n,end:0,endText:n,total:0,totalText:n};if(E.isEnabled()&&!i)o.start=E.getSelectionStart(),o.startText=o.start+n,o.end=E.getSelectionEnd(),o.endText=o.end+n,o.total=E.getInputText().length,o.totalText=o.total+n;else{try{x.PAssert(796,t&&"SPAN"==t.tagName,"Expected SPAN, Actual: ",t)}catch(a){w.reportError(a)}if(t&&t.textContent!==TextSpace&&(!E.isEnabled()||""!==t.textContent)){var s=r.startContainer,c=r.startOffset,d=r.endContainer,l=r.endOffset;try{x.PAssert(797,"#text"==s.nodeName,"Expected #text, Actual: ",s.nodeName)}catch(a){w.reportError(a)}for(var h=0,p=u(t),m=0;m<p.length;++m)p[m]==s&&(o.start=h+c,o.startText=h+c+n),p[m]==d&&(o.end=h+l,o.endText=h+l+n),h+=p[m].length;o.total=h,o.totalText=h+n}}return o},x.getSpanParent=function(e){if(E.isEnabled())return E.getInputBox();if(x.hasClass(e,"noItems"))return void 0;for(;e&&("SPAN"!==e.tagName||!m(e));)e=e.parentNode;if(e&&m(e))return e;try{x.PAssert(798,!1,"This shouldn't happen, spans should always be found")}catch(t){w.reportError(t)}return void 0},x.getLIParent=function(e){for(;e&&"LI"!==e.tagName;)e=e.parentNode;return e&&!x.hasClass(e,"item")?null:e},x.getPreviousItem=function(e,t,r){try{x.PAssert(800,e,"Item must be specified")}catch(i){w.reportError(i)}if(!e)return void 0;var n=void 0,o=r&&r.isTest,a=r&&r.ignoreSearch,s=e.parent();if(!s)return void 0;var c=s.getChildIndex(e);if(c>0){for(;!n;){for(var d=!1,l=c-1;l>=0;l--){var u=s.getChild(l);if(u.hasChildren()&&!u.isCollapsed()){if(a||!t||!x.hasClass(u.getElement(t.id),"hidden")){s=u,c=u.numChildren(),d=!0;break}}else if(a||!t||!x.hasClass(u.getElement(t.id),"hidden")){n=u,d=!0;break}}d||(n=s)}try{x.PAssert(801,o||!n||n.isCollapsed()||e===x.getNextItem(n,t,{isTest:!0,ignoreSearch:a}),"Previous/Next should always match")}catch(i){w.reportError(i)}}else n=e.parent();return n},x.getNextItem=function(e,t,r){try{x.PAssert(802,e,"Item must be specified")}catch(i){w.reportError(i)}if(!e)return void 0;var n=void 0,o=r&&r.isTest,a=r&&r.ignoreSearch;if(e.hasChildren()&&!e.isCollapsed())for(var s=e.numChildren(),c=0;s>c;++c){var d=e.getChild(c);if(a||!t||!x.hasClass(d.getElement(t.id),"hidden")){n=d,r&&r.numLevels++;break}}for(var l=e;!n;){var u=l.parent();if(!u)break;var h=u.getChildIndex(l),s=u.numChildren();if(!u.isCollapsed())for(var c=h+1;s>c;++c){var d=u.getChild(c);try{x.PAssert(803,!t||d.getElement(t.id),"next element should be visible in pane")}catch(i){w.reportError(i)}if(a||!t||!x.hasClass(d.getElement(t.id),"hidden")){n=d;break}}if(l=u,r&&!n&&r.numLevels--,t&&l===t.item())break}try{x.PAssert(804,o||!n||e===x.getPreviousItem(n,t,{isTest:!0,ignoreSearch:a}),"Previous/Next should always match")}catch(i){w.reportError(i)}return n},x.getFirstPaneItem=function(e){return x.getNextItem(e.item())},x.getLastPaneItem=function(e){for(var t=e.item().getLastChild();t.hasChildren();t=t.getLastChild());try{x.PAssert(805,t,"Must always have a valid pane item")}catch(r){w.reportError(r)}return t},x.getItemCounts=function(e,t,r){try{x.PAssert(806,e,"Start must be a valid item")}catch(i){w.reportError(i)}try{x.PAssert(807,t,"End must be a valid item")}catch(i){w.reportError(i)}var n=0,o=0,a=e;do{a=x.getNextItem(a,r);try{x.PAssert(808,a,"Items must exist")}catch(i){w.reportError(i)}a.parent()===r.item()&&a.isHeader()&&o++,n++}while(a!==t);return{fscount:o,icount:n}},x.getItemsBetween=function(e,t,r){try{x.PAssert(809,e,"Start must be a valid item")}catch(i){w.reportError(i)}try{x.PAssert(810,t,"End must be a valid item")}catch(i){w.reportError(i)}for(var n=[e],o=e;o!==t;){o=x.getNextItem(o,r);try{x.PAssert(811,o,"Items must exist")}catch(i){w.reportError(i)}n.push(o)}return n},x.getFirstItem=function(e,t){if(e.id==t.id||t.parent().id==e.id)return e;if(e.parent().id==t.id)return t;var r=e,i=void 0;do{var n=t,o=void 0;do{if(r.id==n.id){if(void 0===i)return e;if(void 0===o)return t;try{x.PAssert(812,void 0!==o,"Fix this assert by handling this edge case!")}catch(a){w.reportError(a)}try{x.PAssert(813,r.id==o.parent().id,"Must share a common parent")}catch(a){w.reportError(a)}try{x.PAssert(814,r.id==i.parent().id,"Must share a common parent")}catch(a){w.reportError(a)}try{x.PAssert(815,i.id!=o.id,"If both previous items match, they should have been the common ancestor")}catch(a){w.reportError(a)}return i.getIndex()<o.getIndex()?e:t}o=n}while(void 0!==(n=n.parent()));i=r}while(void 0!==(r=r.parent()));try{x.PAssert(816,!1,"One item must appear first in the tree")}catch(a){w.reportError(a)}return void 0},x.animateTransform=function(e,r){function i(){r.clearTransform&&(e.style[t.transform.style]="",e.style[t.transformOrigin.style]=""),r.onComplete&&r.onComplete()}var n=r.transform;if(!isNaN(r.delay)){var o=r.delay;return r.delay=void 0,void setTimeout(x.animateTransform,o,e,r)}if(r.time){var a=x.getTransitionClass(r.time);x.addClass(e,a),setTimeout(function(){x.removeClass(e,a),i()},r.time)}else i();isNaN(r.opacity)||(e.style.opacity=r.opacity),n||isNaN(r.left)||isNaN(r.top)||(n="translate3d("+left+"px,"+top+"px,0)"),r.origin&&(e.style[t.transformOrigin.style]=r.origin),e.style[t.transform.style]=n},x.easeOut=function(e,t,r){return-r*e*(e-2)+t},x.scrollTo=function(e,r,i,n,o){function a(e){c||(c=e-20);var n=Math.min((e-c)/r,1),u=x.easeOut(n,d,l);return i[s]=u,1==n?(x.isScrollingIntoView=!1,void(t.ios&&(x.setSelectionToWhatItAlreadyIs(),o&&o()))):void requestAnimationFrame(a)}i=i||x.focusedPane.rootElement;var s=n?"scrollLeft":"scrollTop";if(r>0){x.isScrollingIntoView=!0;var c,d=i[s],l=e-d;requestAnimationFrame(a)}else i&&(i[s]=e)},x.computeScrollSpeed=function(e,t,r){return(t-e-(t-r))/(t-e)};var $={speed:0,pane:void 0},Q=!1;x.repeatScroll=function(e,t){$.speed=e,$.pane=t,Q||(Q=!0,requestAnimationFrame(f))},x.cancelRepeatScroll=function(){Q=!1};var Z;x.getPaneForElement=function(t){if(Z||(Z=require("VMPane")),t){var r;r=e.contextFor(E&&E.isEnabled()&&"androidInput"==t.id?E.getCurrentVMLI().getSpan():t);var i=r?r.$parents[r.$parents.length-2]:void 0;if(!i&&r&&1===r.$parents.length&&(i=r.$data),i instanceof Z)return i}return void 0},x.elementInPane=function(t){if(t){var r=e.contextFor(t);if(r){var i=r.$parents[r.$parents.length-2];if(i)return x.hasClass(i.element,"pane")}}return!1},x.scrollToTop=function(e,r,i){if(e){var n=(i&&i.callback,x.findParent(e,"scroller"));if(n){var o=e.getBoundingClientRect().top,a=n.scrollTop,s=o-x.topBoxHeight+(t.orientation==Orientation.Landscape?x.topBarHeight:0),c=a+s;return x.scrollTo(c,r,n),s||!0}}return!1},x.scrollIntoView=function(r,i,n){var o=n&&n.callback,a=n&&n.noToolbar;isNaN(i)&&(i=200);var s=!1;if(r){var c=x.findParent(r,"scroller");if(c){var d,l=c.getBoundingClientRect(),u=l.bottom,h=r.getBoundingClientRect(),p=10,m=c.scrollTop;if(t.mobile&&(a||(u-=x.keyboardToolbarHeight),t.ios&&!t.ios71&&x.isKeyboardOpen||(u-=t.kbsize?t.kbsize:248)),h.top<l.top){var f=e.dataFor(r);d=t.mobile||f!=x.getFirstPaneItem(x.focusedPane)?m+h.top-l.top-p:0}else h.bottom>u&&(d=m+h.bottom-u+p);void 0!==d&&(x.scrollTo(d,i,c),o&&(i>0?setTimeout(o,i):o()),s=!0)}}return s},x.isKeyboardInputElement=function(e){return"checkbox"===e.type?!1:"INPUT"==e.nodeName||"textarea"==e.type?!0:!1},x.openKeyboardOn=function(e,r,i,n,o){try{x.PAssert(818,t.mobile,"Should only be opening keyboard on mobile devices")}catch(a){w.reportError(a)}var s=x.findParent(r,"scroller"),c=s?s.scrollTop:0,d=!1;if(i&&x.keyboardToolbar.preShow(),x.isKeyboardOpen)log("keyboard open");else if(t.app||t.android||t.mobileie){var l=function(){i?x.keyboardToolbar.show():x.isKeyboardOpen=!0,n&&n(),x.enforceScroll()};x.addClass(s,"padded"),d=x.scrollIntoView(r,t.keyboardOpenTime,{callback:l,noToolbar:!i})}else d=x.scrollIntoView(r,t.keyboardOpenTime);d&&t.app&&!t.android||(n&&n(),i&&x.keyboardToolbar.show()),x.onCloseKeyboard=function(){x.addClass(s,"padded"),x.scrollTo(c,t.keyboardOpenTime,s,!1,function(){x.removeClass(s,"padded")}),x.isKeyboardOpen=!1,o&&o(),window.removeEventListener("closeKeyboard",x.onCloseKeyboard),x.onCloseKeyboard=void 0},window.addEventListener("closeKeyboard",x.onCloseKeyboard),t.ios&&x.preventClick(),e.preventDefault(),e.stopImmediatePropagation(),e.returnFalse=!0,x.enforceScroll()},x.blurActiveElement=function(e){x.ignoreSelectionChange=!!e,x.fireCustomEvent("closeKeyboard"),document.activeElement.blur(),setTimeout(function(){x.ignoreSelectionChange=!1},100)},x.preventScrollPropagation=function(e){return e.scrollHeight===e.clientHeight?!1:(0===e.scrollTop?e.scrollTop=1:e.scrollTop+e.offsetHeight>=e.scrollHeight&&(e.scrollTop=e.scrollHeight-e.offsetHeight-1),!0)},x.setSelectionToWhatItAlreadyIs=function(){var e=window.getSelection();if(e.rangeCount>0){var t=e.getRangeAt(0);e.removeAllRanges(),e.addRange(t)}},x.setSelection=function(e,t,r){try{x.PAssert(820,e,"Must supply a valid element to set selection on")}catch(i){w.reportError(i)}try{x.PAssert(821,t>=0&&r>=0,"Must specify positive start and end offsets")}catch(i){w.reportError(i)}if(0>t||0>r)return!1;if(!e)return!1;var n,o=!0;try{var a=u(e),s=document.createRange();n=a.length>0?a[0]:e,s.setStart(n,t),s.setEnd(n,r);var c=window.getSelection();c.removeAllRanges(),c.addRange(s)}catch(d){x.reportError(d,{element:x.elementToString(e,!0),select:x.elementToString(n,!0),start:t,end:r,children:a.length>0?x.elementToString(e,!0):void 0}),o=!1}return o},x.restrictSelectionToText=function(){if(!E||!E.isEnabled()){var t,r,i,n,o,a,s=function(){return t=x.getSelectionInfo(),t&&0!==t.rangeCount?(r=t.selection.getRangeAt(0),i=r.startContainer,n=r.endContainer,o=r.startOffset,void(a=r.endOffset)):!0};if(s(),t){try{x.PAssert(822,"#text"==i.nodeName||"SPAN"==i.nodeName,"Expected #text or SPAN, Actual: "+i.nodeName)}catch(c){w.reportError(c)}try{x.PAssert(823,"#text"==n.nodeName||"LI"==n.tagName||"UL"==n.tagName||"SPAN"==n.tagName,"Expected LI, UL, #text, SPAN, Actual: "+n.tagName)}catch(c){w.reportError(c)}if("SPAN"===i.nodeName&&(x.selectMultiline(i,o,n,a),s()),"#text"===i.nodeName&&i.previousSibling&&"#comment"===i.previousSibling.nodeName){try{x.PAssert(824,!1,"This case shouldnt be getting hit")}catch(c){w.reportError(c)}x.selectChildren(x.getSpanParent(i),0,a),s()}if(i!==n&&0===a&&"P"==n.nodeName){n=n.parentNode.parentNode;var d=n.previousElementSibling;try{x.PAssert(825,!d||"LI"==d.tagName)}catch(c){w.reportError(c)}if(d){if(d.children.length>1){var l=d.children[1].children;d=l[l.length-1]}}else d=n.parentNode.parentNode;var u=e.dataFor(d).getParsedText().length;x.selectMultiline(i,o,d,u)}else if("LI"===n.tagName){var d=n.previousElementSibling;try{x.PAssert(826,!d||"LI"===d.tagName)}catch(c){w.reportError(c)}if(d){if(d.children.length>1){var l=d.children[1].children;d=l[l.length-1]}}else d=n.parentNode.parentNode,console.log(d);var h=d.firstChild;try{x.PAssert(827,"SPAN"===h.tagName,"Expected SPAN, Actual: "+h.tagName)}catch(c){w.reportError(c)}x.selectChildren(e.dataFor(h),0,h.textContent.length)}else if("UL"===n.nodeName){var h=n.parentElement.firstElementChild;try{x.PAssert(828,"SPAN"===h.tagName,"Expected SPAN, Actual: "+h.tagName)}catch(c){w.reportError(c)}x.selectChildren(e.dataFor(h),0,h.textContent.length)}}}},x.trimString=function(e){for(var e=e.replace(/^\s\s*/,""),t=/\s/,r=e.length;t.test(e.charAt(--r)););return e.slice(0,r+1)},x.enforceScroll=function(e,r){(e||(t.ios||t.android)&&(!t.app||t.ios71)&&!t.bodyscroll)&&(setTimeout(function(){window.scrollTo(0,r||0)},0),requestAnimationFrame(function(){window.scrollTo(0,r||0)}),window.scrollTo(0,r||0),document.body.scrollTop=0)},x.preventDefault=function(e){e.preventDefault()},x.preventClick=function(){x.addClass(x.element("outerWrapper"),"noClick"),window.ontouchstart=x.preventDefault,requestAnimationFrame(function(){window.ontouchstart=void 0,x.removeClass(x.element("outerWrapper"),"noClick")})},x.searchVMLIs=function(e){var t=e.item;t||(t=x.vmMain.root()),e.headers?g(e,t.headers()):g(e,t.items()),e.includeArchived&&t.hasArchivedChildren()&&g(e,t.archivedItems(!0))},x.getLastVisibleItem=function(e){for(var t=e.items(),r=t.length-1;r>=0;r--)if(!x.vmSearchPhone.hiddenItems[t[r].id]){var i=x.getLastVisibleItem(t[r]);return i?i:t[r]}return void 0},x.invertObject=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[e[r]]=r);return t},x.fieldMapOut=x.invertObject(x.fieldMapIn),x.translateFieldIn=function(e){try{x.PAssert(832,x.fieldMapIn[e],"Incoming field should be added to the field map",e)}catch(t){w.reportError(t)}try{x.PAssert(833,"string"==typeof e,"Should only pass strings to the field mapping function",e)}catch(t){w.reportError(t)}return x.fieldMapIn[e]||e},x.translateFieldOut=function(e){try{x.PAssert(834,x.fieldMapOut[e],"Incoming field should be added to the field map",e)}catch(t){w.reportError(t)}try{x.PAssert(835,"string"==typeof e,"Should only pass strings to the field mapping function",e)}catch(t){w.reportError(t)}return x.fieldMapOut[e]||e},x.translateObjIn=function(e){return v(e,x.fieldMapIn)},x.translateObjOut=function(e){return v(e,x.fieldMapOut)};var et={};x.addCustomEventListener=function(e,t,r){if(void 0!==r){var i=et[e],n={fn:t,pri:r};i?et[e].insertSorted(n,function(e,t){return t>e?1:-1}):(et[e]=[n],window.addEventListener(e,function(t){for(var r=0;r<et[e].length;++r){var i=et[e][r],n=i.fn(t);if(n===!1)break}}))}else window.addEventListener(e,t)},x.removeCustomEventListener=function(e,t,r){if(r){for(var i=et[e],n=!1,o=0;o<i.length;++o)if(i[o].fn===t){n=!0,i.removeAt(o);break}try{x.PAssert(836,n,"Event listener should always be found when removing")}catch(a){w.reportError(a)}}else window.removeEventListener(e,t)},x.fireCustomEvent=function(e,t,r){if(document.createEvent){var i=document.createEvent("Event");return t&&(i.data=t),i.initEvent(e,!0,!0),(r||window).dispatchEvent(i)}try{x.PAssert(837,!1,"Unable to fire custom event")}catch(n){w.reportError(n)}},x.fireKeyEvent=function(e,t){y(e,"keydown",t),y(e,"keypress",t),y(e,"keyup",t)},x.fireClickEvent=function(e,t){b(e,"mousedown",t),b(e,"mouseup",t),b(e,"mouseclick",t)},x.clone=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},x.alias=function(){for(var e=Array.prototype.slice.call(arguments),t=e[0],r=1;r<e.length;r++){var i=e[r];t[i]=t["_"+i]}},x.extend=function(e,t){try{x.PAssert(842,e&&t,"Invalid call to extend")}catch(r){w.reportError(r)}if(t)for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},x.loadXML=function(e){try{if("undefined"!=typeof window.DOMParser)return(new window.DOMParser).parseFromString(e,"text/xml");if("undefined"!=typeof window.ActiveXObject&&new window.ActiveXObject("Microsoft.XMLDOM")){var t=new window.ActiveXObject("Microsoft.XMLDOM");return t.async="false",t.loadXML(e),t}try{x.PAssert(843,!1,"No XML parser found")}catch(r){w.reportError(r)}return void 0}catch(i){return void x.reportError(i)}},x.adjustOriginToBeInsideBounds=function(e,t,r,i,n,o){var a={x:t.left,y:t.top};return r=r||0,i=i||0,n=n||0,o=o||0,t.bottom+o>e.bottom&&(a.y=Math.max(i,t.top-(t.bottom+o-e.bottom))),t.top-o<e.top&&(a.y=Math.max(i,t.top)),t.right+n>e.right&&(a.x=Math.max(r,t.left-(t.right+n-e.right))),a},x.setOrigin=function(e,t,r){var i=e.left-t,n=e.top-r;e.left-=i,e.right-=i,e.top-=n,e.bottom-=n},x.copyStyles=function(e,t,r){try{x.PAssert(844,e,"Must have a valid source element")}catch(i){w.reportError(i)}try{x.PAssert(845,t,"Must have a valid dest element")}catch(i){w.reportError(i)}try{x.PAssert(846,r,"Must have a valid list of styles to copy")}catch(i){w.reportError(i)}var n=window.getComputedStyle(e);if(n){for(var o=[],a=0;a<r.length;++a)o[a]=n[r[a]];for(var a=0;a<o.length;++a)t.style[r[a]]=o[a]}},x.hasClass=function(e,t){try{x.PAssert(847,e,"Must pass in a valid element")}catch(r){w.reportError(r)}return e&&e.classList?e.classList.contains(t):void 0},x.removeClass=function(e,t){try{x.PAssert(848,e,"Must pass in a valid element")}catch(r){w.reportError(r)}e&&e.classList&&e.classList.remove(t)},x.addClass=function(e,t){try{x.PAssert(849,e,"Must pass in a valid element")}catch(r){w.reportError(r)}e&&e.classList&&e.classList.add(t)},x.toggleClass=function(e,t){try{x.PAssert(850,e,"Must pass in a valid element")}catch(r){w.reportError(r)}e&&e.classList&&e.classList.toggle(t)},x.css=function(e,t){try{x.PAssert(851,e,"Must pass in a valid element")}catch(r){w.reportError(r)}if(e)for(var i in t)if(t.hasOwnProperty(i)){var n=t[i];"number"==typeof n&&(n+="px"),e.style[i]=n}},x.findChild=function(e,t){try{x.PAssert(852,e,"Must pass in a valid element")}catch(r){w.reportError(r)}if(e)for(var i=0;i<e.childElementCount;++i)if(x.hasClass(e.children[i],t))return e.children[i];return void 0},x.findParent=function(e,t,r){try{x.PAssert(853,e,"Must pass in a valid element")}catch(i){w.reportError(i)}if(r||(r=1e4),e){var n=e;try{x.PAssert(854,n,"Must have a valid parent element")}catch(i){w.reportError(i)}for(var o=0;r>o&&n;++o,n=n.parentNode)if(x.hasClass(n,t))return n}return void 0},x.isAncestor=function(e,t){try{x.PAssert(855,e,"Must have a valid element")}catch(r){w.reportError(r)}try{x.PAssert(856,t,"Must have a valid candidate")}catch(r){w.reportError(r)}for(;e&&e!==t;)e=e.parentNode;return!!e},x.firstChildTag=function(e,t){try{x.PAssert(857,e,"Must pass in a valid element")}catch(r){w.reportError(r)}try{x.PAssert(858,t,"Must pass in a valid tag to check")}catch(r){w.reportError(r)}if(e)for(var i=t.toUpperCase(),n=0;n<e.childElementCount;++n)if(e.children[n].tagName===i)return e.children[n];return void 0},x.insertAfter=function(e,t){try{x.PAssert(860,e,"Must pass in a valid element")}catch(r){w.reportError(r)}try{x.PAssert(861,t,"Must pass in a valid element")}catch(r){w.reportError(r)}e.parentNode.insertBefore(t,e.nextSibling)},x.prependChild=function(e,t){try{x.PAssert(862,e,"Must pass in a valid element")}catch(r){w.reportError(r)}try{x.PAssert(863,t,"Must pass in a valid element")}catch(r){w.reportError(r)}e.insertBefore(t,e.firstChild)},x.offset=function(e){try{x.PAssert(864,e,"Must pass in a valid element")}catch(t){w.reportError(t)}var r=e.getBoundingClientRect(),i=e.ownerDocument,n=e.ownerDocument.documentElement,o=i.defaultView,a={top:r.top+o.pageYOffset-n.clientTop,left:r.left+o.pageXOffset-n.clientLeft};return a},x.height=function(e){try{x.PAssert(866,e,"Must pass in a valid element")}catch(t){w.reportError(t)}var r=e.offsetHeight,i=window.getComputedStyle(e);return i?("border-box"!==e.style.boxSizing&&(r-=parseFloat(i.paddingTop)+parseFloat(i.paddingBottom)),r-=parseFloat(i.borderTopWidth)+parseFloat(i.borderBottomWidth)):ShouldLog(LogLevels.Error)&&log("GetComputedStyle failed in globals::height"),r},x.width=function(e){try{x.PAssert(868,e,"Must pass in a valid element")}catch(t){w.reportError(t)}var r=e.offsetWidth,i=window.getComputedStyle(e);return i?("border-box"!==i.boxSizing&&(r-=parseFloat(i.paddingLeft)+parseFloat(i.paddingRight)),r-=parseFloat(i.borderLeftWidth)+parseFloat(i.borderRightWidth)):ShouldLog(LogLevels.Error)&&log("GetComputedStyle failed in globals::width"),r};var tt=void 0;return x.runOnLoad=function(e){"complete"===document.readyState||"interactive"===document.readyState?setTimeout(e):(tt||(tt=[],document.addEventListener("DOMContentLoaded",S,!1),window.addEventListener("load",S,!1)),tt[tt.length]=e)},x.XHR=function(e){var t=e.url,r=e.type,i=e.cb,n=e.data,o=e.headers,a=e.username,s=e.password,c=new XMLHttpRequest;if(c.onreadystatechange=function(){4===c.readyState&&i(c)},a&&s?c.open(r.toUpperCase(),t,!0,a,s):c.open(r.toUpperCase(),t,!0),o)for(var d in o)c.setRequestHeader(d,o[d]);if(n){c.setRequestHeader("Accept","*/*"),c.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");var l=T(n);c.send(l)}else c.send()},x.element=function(e,t){try{x.PAssert(871,e,"Tried to get an element without an id")}catch(r){w.reportError(r)}(!x.elements[e]||t)&&(x.elements[e]=document.getElementById(e));try{x.PAssert(872,x.elements[e],"Tried to get an element that doesn't exist",e)}catch(r){w.reportError(r)}return x.elements[e]},x.waitingList={},x._waitForElement=function(e,t){var r=document.getElementById(e);return r?(t(r),delete x.waitingList[e],r):void setTimeout(x._waitForElement,100,e,t)},x.waitForElement=function(e,t){var r=x._waitForElement(e,t);r||(x.waitingList[e]=t)},x.getElementByClassName=function(e,t){if(!t)return document.getElementsByClassName(e)[0];for(var r=t.children.length,i=0;r>i;i++)if(t.children[i].className.indexOf(e)>=0)return t.children[i]},x.getElementsByClassName=function(e,t){if(t){for(var r=[],i=t.children.length,n=0;i>n;n++)t.children[n].className.indexOf(e)>=0&&r.push(t.children[n]);return r}return document.getElementsByClassName(e)},x.isDateSoft=function(e){if(e)switch(e.toUpperCase()){case"NEXT":case"SOON":case"LATER":case"NOW":return!0}return!1},x.handlerPreventStop=function(e){e.preventDefault(),e.stopImmediatePropagation()},x.fFalse=function(){return!1},x.emptyFn=function(){},r.hasURLParam("nolocal","true")&&(x.noLocalWrites=!0),x.settings.init(),x.eventStream=x.createRingBuffer(100),x}),define("gdata",["ko","globals","data","platform"],function(e,t,r,i){function n(e){function i(e){if(e)for(var i=0;i<e.length;++i){var o=e.get(i),a=g.get(o,"text");if(a.indexOf("@")>=0)for(var s=a.split(" "),c=0,i=0;i<s.length;++i){if(0===s[i].indexOf("@")){for(var d=void 0,l=s[i].substring(1),u=1;4>u;u++){var h=-1!==l.indexOf(":",l.length-1)?l.substr(0,l.length-1):l;if(r.contactsByName[h]&&(d=h),i+u<s.length){if(!(i+u<s.length))break;l+=" "+s[i+u]}}if(d){try{t.PAssert(890,"@"==a[c],"Explicitly matching @, should always match")}catch(m){t.reportError(m)}var f=a.substr(0,c)+"+"+a.substr(c+1);g.set(o,"text",f),p(o)}}c+=s[i].length+1}n(o)}}function n(e){var t=g.get(e,"items");t&&i(t);var r=g.get(e,"archivedItems");r&&i(r)}g.beginWriteAction();try{t.PAssert(889,e,"Must have a valid root item to migrate")}catch(o){t.reportError(o)}if(0===r.contacts.length)return void log("Skipping remote data migration four");var a=e.get("root");n(a)}function o(e){function r(e){if(e)for(var t=0;t<e.length;++t){var r=e.get(t),n=g.get(r,"text");n.startsWith("!")?(g.set(r,"priority",VMLIFlag.P0),g.set(r,"text",n.substr(1)),p(r)):n.startsWith("*")?(g.set(r,"isFlagged",!0),g.set(r,"text",n.substr(1)),p(r)):n.startsWith("^")&&(g.set(r,"isComplete",!0),g.set(r,"text",n.substr(1)),p(r)),i(r)}}function i(e){var t=g.get(e,"items");t&&r(t);var i=g.get(e,"archivedItems");i&&r(i)}g.beginWriteAction();try{t.PAssert(891,e,"Must have a valid root item to migrate")}catch(n){t.reportError(n)}var o=e.get("root");i(o)}function a(e){function r(e){if(e)for(var r=0;r<e.length;++r){var n=e.get(r);try{t.PAssert(893,n,"Remote item must exist")}catch(o){t.reportError(o)}try{t.PAssert(894,!t.isString(n),"New items must be collab maps not strings")}catch(o){t.reportError(o)}i(n)}}function i(e){var i=g.get(e,"text");t.isString(i)||(g.set(e,"text",i.getText()),log("Updated Text: ",g.get(e,"text")));var n=g.get(e,"items");n&&r(n);var o=g.get(e,"archivedItems");o&&r(o)}g.beginWriteAction();try{t.PAssert(892,e,"Must have a valid root item to migrate")}catch(n){t.reportError(n)}var o=e.get("root");i(o)}function s(e){function r(e){var r=[];if(e)for(var n=0;n<e.length;++n){var o=e.get(n);try{t.PAssert(896,t.isString(o),"Must be a valid ID string")}catch(s){t.reportError(s)}var c=a.get(o);try{t.PAssert(897,c,"Remote item must exist in DB")}catch(s){t.reportError(s)}try{t.PAssert(898,!t.isString(c),"New items must be collab maps not strings")
}catch(s){t.reportError(s)}r.push(c),i(c)}return r}function i(e){var i=g.get(e,"items");if(i){var n=r(i);try{t.PAssert(899,n.length===i.length,"New item list must be the same length as the old one")}catch(o){t.reportError(o)}n.length>0&&i.replaceRange(0,n)}var a=g.get(e,"archivedItems");if(a){var s=r(a);try{t.PAssert(900,s.length===a.length,"New item list must be the same length as the old one")}catch(o){t.reportError(o)}s.length>0&&a.replaceRange(0,s)}}g.beginWriteAction();try{t.PAssert(895,e,"Must have a valid root item to migrate")}catch(n){t.reportError(n)}var o=e.get("root"),a=e.get("items"),s=a.get(o);i(s),e.set("root",s)}function c(){try{t.PAssert(910,!g.inCompoundOperation,"Should never be in a compound operation after sync block finishes")}catch(e){t.reportError(e)}try{t.PAssert(911,!g.wantCompoundOperation,"Should never want a compound operation after a sync block finishes")}catch(e){t.reportError(e)}g.inCompoundOperation&&(g.model.endCompoundOperation(),t.reportError(new Error("Compound operation open after sync block finished"))),S=void 0}function d(e){try{t.PAssert(917,e,"Must have a valid local item to attach events to")}catch(r){t.reportError(r)}try{t.PAssert(918,e instanceof b,"Must pass in a valid instace of a local item")}catch(r){t.reportError(r)}try{t.PAssert(919,e.data,"Must have a valid remote item to attach events to")}catch(r){t.reportError(r)}e.data.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,e.onObjectChanged.bind(e))}function l(e){g.beginWriteAction();try{t.PAssert(941,e instanceof b)}catch(r){t.reportError(r)}try{t.PAssert(942,e.data,"Must have valid remote item to attach events to and create")}catch(r){t.reportError(r)}var i=g.get(e.data,"items");return i||(i=g.model.createList(),g.set(e.data,"items",i)),i}function u(e){g.beginWriteAction();try{t.PAssert(943,e instanceof b)}catch(r){t.reportError(r)}try{t.PAssert(944,e.data,"Must have valid remote item to attach events to and create")}catch(r){t.reportError(r)}var i=g.get(e.data,"archivedItems");return i||(i=g.model.createList(),g.set(e.data,"archivedItems",i)),i}function h(e){g.beginWriteAction();var t=g.getVersion(e,VersionType.Structure);t=t?t+1:1;g.set(e,"version",t)}function p(e){g.beginWriteAction();var t=g.getVersion(e,VersionType.Text);t=t?t+1:1;g.set(e,"versionText",t)}function m(e,i){var n=g.canSave(e);if(n){if(t.isEmpty(i))return void(ShouldLog(LogLevels.Warning)&&log("Skipped remote saving an empty object"));g.beginWriteAction(),r.addPendingUpdate(e.id);for(var o in i){try{t.PAssert(971,i.hasOwnProperty(o),"Changes should only contain properties they own")}catch(a){t.reportError(a)}if(i.hasOwnProperty(o))switch(o){case"text":try{t.PAssert(972,t.isString(i.text))}catch(a){t.reportError(a)}g.set(n,"text",i.text);break;case"date":try{t.PAssert(973,!i.date||"number"==typeof i.date)}catch(a){t.reportError(a)}g.set(n,"date",i.date);break;case"dateCreated":try{t.PAssert(974,"number"==typeof i.dateCreated)}catch(a){t.reportError(a)}g.set(n,"dateCreated",i.dateCreated);break;case"dateCompleted":try{t.PAssert(975,!i.dateCompleted||"number"==typeof i.dateCompleted)}catch(a){t.reportError(a)}g.set(n,"dateCompleted",i.dateCompleted);break;case"allDayDate":case"priority":case"isComplete":case"isFlagged":g.set(n,o,i[o]);break;case"isCollapsed":case"isArchived":try{t.PAssert(976,!1,"These properties are not set this way")}catch(a){t.reportError(a)}g.set(n,o,i[o]);break;case"modifiedOfflineText":case"dateText":break;default:try{t.PAssert(977,!1,"Attempting to remotely save an unknown field: ",o)}catch(a){t.reportError(a)}}}p(n)}}function f(e){for(var r=!1,i=0;i<e.events.length;++i){var n=e.events[i];n.isLocal||(n.property.startsWith(t.settings.prefix)||(r=!0),g.settingsLocal[n.property]=n.newValue,t.fireCustomEvent("settingsChange_"+n.property,n.newValue))}r&&g.onRemoteSettingsLoad()}var g={isClosed:!0,isInitialized:!0,wantCompoundOperation:!1,inCompoundOperation:!1,flushingDeferredActions:!1,itemsLoaded:!1,authenticatedUser:e.observable()},v=5,y={};g.cacheItem=function(e){try{t.PAssert(873,void 0===y[e.id]||y[e.id]===e,"Should not be caching different items with the same ID")}catch(r){t.reportError(r)}y[e.id]=e},g.getState=function(e){try{var t={};if(g.doc)try{var r=g.doc.getModel();t.isReadOnly=r.isReadOnly,t.serverVersion=r.serverVersion,t.size=r.bytesUsed}catch(i){e.docAccessError=!0}t.lastPending=P,t.lastSaving=A,t.isClosed=g.isClosed,t.initialized=g.initialized,e.gState=t}catch(n){log("Error getting information in gdata::getState()"+n.message)}};var r,b;g.checkRemoteIntegrity=function(){function e(e,t){if(e)for(var r=0;r<e.length;++r){var o=e.get(r).id;o||(log(o,": Child does not have a valid reference in our remote database"),i=!0),n[o]?n[o].ref?(log(o,": Item is referenced remotely multiple times: ",g.get(e.get(r),"text")),log("   ",n[o].ref,": ",g.get(y[n[o].ref],"text")),log("   ",s.id,": ",g.get(s,"text")),i=!0,g.beginWriteAction(),e.remove(r)):n[o].ref=s.id:n[o]={exist:!1,arch:t,ref:s.id}}}g.beginAction();var i=!1,n={},o=!1;for(var a in y){var s=y[a];n[s.id]?n[s.id].exist?(log(s.id,": Duplicated IDs in the remote database",s),i=!0):n[s.id].exist=!0:n[s.id]={exist:!0,ref:!1},s.id==g.rootID&&(o&&(log(s.id,": Multiple roots present remotely",s),i=!0),o=!0,n[s.id].isRoot=!0);var c=g.get(s,"items");e(c,!1);var d=g.get(s,"archivedItems");e(d,!0)}o||(log("No root present"),localDataError=!0);for(var l in n){var u=n[l];if(!u.exist){try{t.PAssert(875,!1,"This should never happen as the database is inline with the item tree now")}catch(h){t.reportError(h)}log(l,": Item is referenced remotely as a child but does not exist in the database");var p=y[u.ref];try{t.PAssert(876,p,"Parent must exist otherwise it couldn't reference this item")}catch(h){t.reportError(h)}var m=g.getItemList(p,u.arch);try{t.PAssert(877,m,"If the item has been seen here, we will always have a valid parent list")}catch(h){t.reportError(h)}if(m){var f=m.indexOf(l);if(f>=0)g.beginWriteAction(),m.remove(f);else try{t.PAssert(878,!1,"If we previously saw this item, we expect to be able to delete it from the parent list")}catch(h){t.reportError(h)}}}u.ref||u.isRoot||(log(l,": Item exists remotely but is not referenced by a parent"),log("   : ",g.get(y[l],"text")),delete y[l]),u.isRoot&&u.ref&&(log(l,": Remote root has a parent"),localDataError=!0)}r.removeDeletedItems(n),g.endAction()},g.migrateData=function(){function e(){p++,2===p&&t.reload()}var i=!1,c=!1,d=!1,l=g.root.get("dataVersion");if(v>l){g.beginAction(),log("Migrating to latest version: ",l);try{switch(l){case 1:s(g.root);case 2:a(g.root);case 3:o(g.root),d=!0;case 4:n(g.root);default:log("Remote Migration Completed")}}catch(u){d=!0,t.reportError(u)}g.endAction(),g.model.getRoot().set("dataVersion",v),log("Done Migrating Remote Data!",v)}else l>v&&(c=!0,i=!0);if(r.hasLocalData){var h=t.settings.get(Settings.localDataVersion)||0;if(v>h){try{switch(h){case 0:r.migrateLocalData_One(),c=!0,i=!0;case 4:r.migrateLocalData_Two();default:log("Local Migration Completed")}}catch(u){c=!0,t.reportError(u)}t.settings.set(Settings.localDataVersion,v),log("Done Migrating Local Data!",v)}}else t.settings.set(Settings.localDataVersion,l);if(c||d)if(c&&!d)t.AppCache.runOnFinish(function(){t.reload()},!0);else if(d&&!c)g.registerSaveNotify(function(){t.reload()});else{var p=0;t.AppCache.runOnFinish(e,!0),g.registerSaveNotify(e)}return i},g.beginAction=function(){if(g.model){try{t.PAssert(901,!g.flushingDeferredActions,"Should never begin a new action while flushing")}catch(e){t.reportError(e)}try{t.PAssert(902,!g.inCompoundOperation,"Should not nest compound operations")}catch(e){t.reportError(e)}try{t.PAssert(903,!g.wantCompoundOperation,"Should not nest compound operations")}catch(e){t.reportError(e)}try{t.PAssert(904,!g.isClosed,"Document must be open to make changes")}catch(e){t.reportError(e)}g.wantCompoundOperation=!0}};var S=void 0;g.beginWriteAction=function(){if(g.model&&!g.flushingDeferredActions){try{t.PAssert(905,g.inCompoundOperation||g.wantCompoundOperation,"If performing an action, we should have already requested a compound operation")}catch(e){t.reportError(e)}if(!g.inCompoundOperation&&g.wantCompoundOperation)g.flushDeferredActions(),setTimeout(c,0),g.model.beginCompoundOperation(),g.inCompoundOperation=!0,g.wantCompoundOperation=!1;else try{t.PAssert(906,!g.wantCompoundOperation,"Should not nest compound operations")}catch(e){t.reportError(e)}}},g.endAction=function(){if(g.model){try{t.PAssert(907,!g.flushingDeferredActions,"Should never end an action while flushing")}catch(e){t.reportError(e)}try{t.PAssert(908,!g.isClosed,"Document must be open to make changes")}catch(e){t.reportError(e)}try{t.PAssert(909,g.inCompoundOperation||g.wantCompoundOperation,"If ending an action, a beginning should have happened")}catch(e){t.reportError(e)}try{g.inCompoundOperation&&g.model.endCompoundOperation()}catch(r){t.goog.recoverFromError(r)}finally{g.inCompoundOperation=!1,g.wantCompoundOperation=!1,clearTimeout(S)}}};var T=800,x={},w=!1,E=void 0;g.performDeferredAction=function(e,r){try{t.PAssert(912,e,"Must supply a valid item to perform the action on")}catch(i){t.reportError(i)}try{t.PAssert(913,r,"Must supply a valid action to be performed")}catch(i){t.reportError(i)}if(g.model){try{t.PAssert(914,!g.inCompoundOperation,"Cannot perform deferred action after a compound operation has started")}catch(i){t.reportError(i)}if(x[e.id])for(var n in r)x[e.id].changes[n]=r[n];else x[e.id]={item:e,changes:r};w=!0,clearTimeout(E),E=setTimeout(g.flushDeferredActions,T)}},g.flushDeferredActions=function(){if(g.model&&!g.isClosed){try{t.PAssert(915,!g.flushingDeferredActions,"Should never recursively call flushDeferredActions")}catch(e){t.reportError(e)}try{t.PAssert(916,!g.inCompoundOperation,"Must flush deferred actions before starting a compound operation")}catch(e){t.reportError(e)}if(w){clearTimeout(E),E=void 0,g.flushingDeferredActions=!0;try{g.model.beginCompoundOperation();try{for(var r in x)m(x[r].item,x[r].changes);g.flushingDeferredActions=!1,w=!1,x={}}catch(i){t.reportError(n)}g.model.endCompoundOperation()}catch(n){t.reportError(n)}}}},g.createNewItem=function(e,r,i){g.beginWriteAction();try{t.PAssert(920,e instanceof b,"Must pass in a valid instace of a local item")}catch(n){t.reportError(n)}try{t.PAssert(921,g.inCompoundOperation,"Should always create an item inside of a compound operation")}catch(n){t.reportError(n)}try{t.PAssert(922,!g.isClosed,"Document must be open to make changes")}catch(n){t.reportError(n)}try{t.PAssert(923,g.model,"Need a valid model to create collaborative items")}catch(n){t.reportError(n)}try{t.PAssert(924,!e.data,"When initializing a new item, it should have no gdata components already")}catch(n){t.reportError(n)}var o=g.model.createMap();if(e.data=o,g.set(o,"text",e.getRawText()),r){var a=g.model.createList();g.set(o,"items",a)}if(i){var s=g.model.createList();g.set(o,"archivedItems",s)}return g.set(o,"dateCreated",e.dateCreated.getTime()),e.id=o.id,y[o.id]||(y[o.id]=o),o.id},g.initializeNewItem=function(e){g.beginWriteAction();try{t.PAssert(925,e instanceof b,"Must pass in a valid instace of a local item")}catch(r){t.reportError(r)}try{t.PAssert(926,!g.isClosed,"Document must be open to make changes")}catch(r){t.reportError(r)}try{t.PAssert(927,g.inCompoundOperation,"Should always initialize an item inside of a compound operation")}catch(r){t.reportError(r)}if(e.hasChildren()){var i=e.items(),n=l(e);try{t.PAssert(928,n)}catch(r){t.reportError(r)}for(var o=0;o<i.length;++o){try{t.PAssert(929,i[o].data,"Item must have a valid remote to be added to a collab list")}catch(r){t.reportError(r)}n.push(i[o].data)}}if(e.hasArchivedChildren()){var a=e.archivedItems(!0),s=u(e);try{t.PAssert(930,s)}catch(r){t.reportError(r)}for(var o=0;o<a.length;++o){try{t.PAssert(931,a[o].data,"Item must have a valid remote to be added to a collab list")}catch(r){t.reportError(r)}s.push(a[o].data)}}d(e)},g.attachEventsToItem=function(e){try{t.PAssert(932,e instanceof b,"Must pass in a valid local item")}catch(r){t.reportError(r)}try{t.PAssert(933,e.data,"Must have loaded data from gdrive before attaching events to item")}catch(r){t.reportError(r)}d(e)};var M;g.registerForUndoRedoStateChange=function(e){g.model?(g.model.addEventListener(gapi.drive.realtime.EventType.UNDO_REDO_STATE_CHANGED,e.stateChangeForUndoRedo),e.stateChangeForUndoRedo({canUndo:g.model.canUndo,canRedo:g.model.canRedo})):M=e},g.registerForSaveStateChange=function(e){try{t.PAssert(934,g.doc)}catch(r){t.reportError(r)}g.doc.addEventListener(gapi.drive.realtime.EventType.DOCUMENT_SAVE_STATE_CHANGED,e)},g.loadCollaborators=function(){for(var e=g.doc.getCollaborators(),t=void 0,r=0;r<e.length;++r){var i=e[r];i.isMe&&(t=i)}g.authenticatedUser(t)},g.undoAction=function(){g.flushDeferredActions();try{t.PAssert(935,!g.isClosed,"Document must be open to make changes")}catch(e){t.reportError(e)}try{t.PAssert(936,g.model.canUndo)}catch(e){t.reportError(e)}g.model.undo()},g.redoAction=function(){g.flushDeferredActions();try{t.PAssert(937,!g.isClosed,"Document must be open to make changes")}catch(e){t.reportError(e)}try{t.PAssert(938,g.model.canRedo)}catch(e){t.reportError(e)}g.model.redo()},g.getItemList=function(e,r){g.beginWriteAction();try{t.PAssert(939,!(e instanceof b),"Must pass in a valid remote item")}catch(i){t.reportError(i)}return r?g.get(e,"archivedItems"):g.get(e,"items")},g.ensureItemList=function(e,r){g.beginWriteAction();try{t.PAssert(940,e instanceof b,"Must pass in a valid local item")}catch(i){t.reportError(i)}return r?u(e):l(e)},g.canSave=function(e){if(g.initialized){var r=e instanceof b?e.data:e;try{t.PAssert(945,r&&!g.isClosed,"Document must be open to make changes")}catch(i){t.reportError(i)}return r&&!g.isClosed?r:!1}},g.deleteTree=function(e){g.beginWriteAction();try{t.PAssert(946,!(e instanceof b),"Must not be a VMLI, should be a remote item")}catch(r){t.reportError(r)}try{t.PAssert(947,!t.isString(e),"Must pass in a valid remote item not an ID")}catch(r){t.reportError(r)}var i=g.get(e,"items");if(i)for(var n=0;n<i.length;n++){var o=i.get(n);g.deleteTree(o)}delete y[e.id]},g.itemAdded=function(e){g.beginWriteAction();var i=e.item,n=e.addedItem,o=e.index,a=e.isArchived,s=e.noVersion;try{t.PAssert(948,void 0!==i&&void 0!==n&&void 0!==a,"itemAdded is missing parameters")}catch(c){t.reportError(c)}try{t.PAssert(949,o>=-1||void 0===o,"Invalid index",o)}catch(c){t.reportError(c)}var d=g.canSave(i);if(d){var l=n.data;try{t.PAssert(950,l,"Must have valid gdata for the item being inserted",l)}catch(c){t.reportError(c)}r.addPendingUpdate(i.id),r.addPendingUpdate(n.id);var u=g.ensureItemList(i,a);try{t.PAssert(951,u,"Must have a valid remote list to add the item to")}catch(c){t.reportError(c)}0>o||isNaN(o)||o>u.length?u.push(l):u.insert(o,l),s||h(n.data)}},g.itemsAdded=function(e){g.beginWriteAction();var i=e.item;try{t.PAssert(952,i instanceof b,"Passed in item must be a VMLI")}catch(n){t.reportError(n)}var o=e.addedItems,a=e.index,s=e.isArchived,c=e.noVersion;try{t.PAssert(953,void 0!==i&&void 0!==o&&void 0!==s,"itemsAdded is missing parameters")}catch(n){t.reportError(n)}var d=g.canSave(i);if(d){var l=g.ensureItemList(i,s);try{t.PAssert(954,l,"Must have a valid remote list to add the item to")}catch(n){t.reportError(n)}for(var u=new Array(o.length),p=0;p<o.length;++p)u[p]=o[p].data,r.addPendingUpdate(o[p].id),!c&&u[p]&&h(u[p]);if(r.addPendingUpdate(i.id),0>a||isNaN(a)){try{t.PAssert(955,s,"Only archived items should be inserted into a list by pushing")}catch(n){t.reportError(n)}l.pushAll(u)}else l.insertAll(a,u)}},g.itemRemoved=function(e){g.beginWriteAction();var i=e.item,n=e.index,o=e.numToRemove,a=e.isArchived,s=e.noDelete,c=e.noVersion;try{t.PAssert(956,void 0!==i&&void 0!==n&&void 0!==o&&void 0!==a,"itemRemoved is missing parameters")}catch(d){t.reportError(d)}try{t.PAssert(957,n>=0,"Must have a valid index to remove from")}catch(d){t.reportError(d)}var l=g.canSave(i);if(l){isNaN(o)&&(o=1);var u=g.getItemList(l,a);try{t.PAssert(958,u,"Must have a valid remote list to remove the item from")}catch(d){t.reportError(d)}for(var p=n;n+o>p;p++){var m=u.get(p);r.addPendingUpdate(m.id),c||h(m),s||g.deleteTree(m)}r.addPendingUpdate(i.id),1===o?u.remove(n):u.removeRange(n,n+o)}},g.itemMoved=function(e){g.beginWriteAction();var i=e.item,n=e.newInfo,o=e.oldParent,a=e.oldInfo,s=e.noVersion;try{t.PAssert(959,void 0!==i&&void 0!==n&&void 0!==o&&void 0!==a,"itemMoved is missing parameters")}catch(c){t.reportError(c)}try{t.PAssert(960,n&&n.index>=-1)}catch(c){t.reportError(c)}try{t.PAssert(961,n&&void 0!==n.isArchived)}catch(c){t.reportError(c)}try{t.PAssert(962,o)}catch(c){t.reportError(c)}try{t.PAssert(963,a&&a.index>=0)}catch(c){t.reportError(c)}try{t.PAssert(964,a&&void 0!==a.isArchived)}catch(c){t.reportError(c)}var d=g.canSave(i);d&&(r.addPendingUpdate(i.id),g.itemRemoved({item:o,index:a.index,numToRemove:1,isArchived:a.isArchived,noDelete:!0,noVersion:!0}),g.itemAdded({item:i.parent(),addedItem:i,index:n.index,isArchived:n.isArchived,noVersion:s}))},g.itemArchived=function(e,i,n){try{t.PAssert(965,n>=0,"Must have a valid index to remove from")}catch(o){t.reportError(o)}g.beginWriteAction();var a=g.canSave(e);if(a){r.addPendingUpdate(e.id),r.addPendingUpdate(i.id);var s=g.get(a,"items");try{t.PAssert(966,s,"Must be an items array present")}catch(o){t.reportError(o)}var c=u(e);try{t.PAssert(967,c,"Must be an archived items array present")}catch(o){t.reportError(o)}s.remove(n),c.push(i.data),h(i.data)}},g.itemUnarchived=function(e,i,n,o){try{t.PAssert(968,n>=0,"Must have a valid index to remove from")}catch(a){t.reportError(a)}g.beginWriteAction();var s=g.canSave(e);if(s){r.addPendingUpdate(e.id),r.addPendingUpdate(i.id);var c=g.get(s,"items");try{t.PAssert(969,c,"Must be an items array present")}catch(a){t.reportError(a)}var d=g.get(s,"archivedItems");try{t.PAssert(970,d,"Must be an archived items array present")}catch(a){t.reportError(a)}d.remove(n),c.insert(o,i.data),h(i.data)}},g.saveChanges=function(e,t){g.inCompoundOperation?m(e,t):g.performDeferredAction(e,t)},g.close=function(e){try{t.PAssert(978,!g.wantCompoundOperation,"Closing the doc with a deferred compound operation")}catch(r){t.reportError(r)}if(g.doc&&!g.isClosed){log("---- Closing Remote Document! ----"),g.isClosed=!0,t.messageQueue.pushMessage(MessageID.FatalError),t.vmMain.setGDriveStatus(DriveStatus.Offline);try{g.doc.close()}catch(i){log("Error Closing Doc: ",i)}t.reportError(new Error("Fatal Error"),e)}},g.onInitialized=function(e){log("Initializing",e),r||(r=require("data")),b||(b=require("VMLI"));var t=e.createMap(),i=e.createList();g.set(t,"text","Home"),g.set(t,"items",i),g.set(t,"archivedItems",e.createList()),g.set(t,"dateCreated",Date.now());var n=e.createMap();g.set(n,"text",""),g.set(n,"dateCreated",Date.now()),i.push(n);var o=e.getRoot();o.set("dataVersion",v),o.set("root",t)},g.saveSetting=function(e){g.flushDeferredActions();try{t.PAssert(979,g.settingsRemote,"Remote settings required to sync")}catch(r){t.reportError(r)}if(!e.data.isRemote){var i=e.data.value,n=e.data.property;n.startsWith(t.settings.prefix)&&(i=Math.abs(i),t.settings.setVersion(n,i)),g.settingsLocal[n]!==i&&(g.settingsLocal[n]=i,g.settingsRemote.set(n,i))}},g.onRemoteSettingsLoad=function(){t.settings.set(Settings.syncContacts,g.settingsLocal[Settings.syncContacts],g.settingsLocal[t.settings.prefix+Settings.syncContacts])&&t.goog.authAndLoadContacts(),t.settings.set(Settings.docSharing,g.settingsLocal[Settings.docSharing],g.settingsLocal[t.settings.prefix+Settings.docSharing])&&t.goog.authDocSharing(),window.addEventListener("settingsChange",g.saveSetting)},g.loadSettings=function(){g.settingsLocal={},g.settingsRemote=g.root.get("settings"),g.settingsRemote||(g.settingsRemote=g.model.createMap(),g.root.set("settings",g.settingsRemote));try{g.settingsLocal[Settings.syncContacts]=g.settingsRemote.get(Settings.syncContacts);var e=t.settings.prefix+Settings.syncContacts;g.settingsLocal[e]=g.settingsRemote.get(e),g.settingsLocal[Settings.docSharing]=g.settingsRemote.get(Settings.docSharing);var r=t.settings.prefix+Settings.docSharing;g.settingsLocal[r]=g.settingsRemote.get(r),g.settingsLocal[Settings.theme]=g.settingsRemote.get(Settings.theme);var i=t.settings.prefix+Settings.theme;g.settingsLocal[i]=g.settingsRemote.get(i),g.settingsRemote.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,f.bind(g))}catch(n){t.reportError(n)}},g.poke=function(){if(g.root&&!g.isClosed)try{var e=g.root.get("poke");e?g.root.set("poke",e+1):g.root.set("poke",1)}catch(t){g.setGDriveStatus(DriveStatus.Offline),g.isClosed=!0}else g.isClosed&&log("Failed to poke closed document")},window.__poke=g.poke,g.rootChanged=function(e){if(e.ocHandled||e.isLocal||g.root.id!==e.target.id)return!1;for(var r=0;r<e.events.length;++r)switch(e.events[r].type){case gapi.drive.realtime.EventType.VALUES_ADDED:case gapi.drive.realtime.EventType.VALUES_REMOVED:break;case gapi.drive.realtime.EventType.VALUE_CHANGED:"dataVersion"===e.property&&(e.newValue>v?t.AppCache.checkForUpdate(!0):e.newVersion<v&&t.reportError(new Error("Remote setting dataVersion to invalid value"+e.newVersion)));break;case gapi.drive.realtime.EventType.TEXT_DELETED:case gapi.drive.realtime.EventType.TEXT_INSERTED:case gapi.drive.realtime.EventType.VALUES_SET:default:try{t.PAssert(980,!1,"Unexpected event type")}catch(i){t.reportError(i)}}},g.isConnected=function(){return g.initialized&&!g.isClosed&&!!g.model},g.onLoad=function(e){try{try{t.PAssert(981,g.isClosed,"Document must not already be open when we are loading")}catch(n){t.reportError(n)}g.initialized=!0,r||(r=require("data")),b||(b=require("VMLI")),g.doc=e,g.model=e.getModel(),g.root=g.model.getRoot(),g.root.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,g.rootChanged),g.isClosed=!1,g.registerForSaveStateChange(g.onSaveStateChange);var o=g.migrateData();return o?(log("---- Skipping Document Load! ----"),g.isClosed=!0,g.initialized=!1,g.doc=void 0,g.model=void 0,g.root=void 0,!1):(g.loadSettings(),g.rootItem=g.root.get("root"),g.rootItem?(g.rootID=g.rootItem.id,g.itemsLoaded=!1,window.__remoteDoc=e,M&&(g.registerForUndoRedoStateChange(M),M=void 0),t.vmMain&&t.vmMain.root()?t.vmMain.loadGDriveData():t.requireGDriveDataCallback=!0,g.loadCollaborators(),!0):void t.messageQueue.pushMessage({text:"Document is corrupted, "+i.actionVerb()+" to reload. If the problem persists, please contact support.",type:MessageType.Fatal,action:MessageAction.ResetClient}))}catch(a){t.reportError(a)}},g.getServerVersion=function(){return g.model&&!g.isClosed?g.model.serverVersion:void 0};var C=[];g.registerSaveNotify=function(e){C.push(e)};var I,P=!1,A=!1;return g.onSaveStateChange=function(e){if(P!==e.isPending||A!==e.isSaving){if(e.isSaving||e.isPending)navigator.onLine?e.isSaving&&(e.isPending||t.vmMain.setGDriveStatus(DriveStatus.Saving),clearTimeout(I),I=i.mobile?setTimeout(g.onErrorSaving,12e3):setTimeout(g.onErrorSaving,8e3)):t.vmMain.setGDriveStatus(DriveStatus.Offline);else{t.vmMain.setGDriveStatus(DriveStatus.Saved),r.clearPendingUpdates(),clearTimeout(I),I=void 0,t.messageQueue.clearMessage(MessageID.ConnectionError);for(var n=0;n<C.length;++n)C[n]()}P=e.isPending,A=e.isSaving}},g.onErrorSaving=function(){t.vmMain.setGDriveStatus(DriveStatus.Offline),I=void 0},g.getVersion=function(e,r){try{t.PAssert(982,!(e instanceof b),"Must pass in a valid remote item")}catch(i){t.reportError(i)}var n;switch(r){case VersionType.Structure:n=e.get(t.translateFieldIn("version"));break;case VersionType.Text:n=e.get(t.translateFieldIn("versionText"));break;default:n=-2;try{t.PAssert(983,!1,"Invalid version type")}catch(i){t.reportError(i)}}return n?n:0},g.get=function(e,r){try{t.PAssert(984,!(e instanceof b),"Must pass in a valid remote item")}catch(i){t.reportError(i)}return e.get(t.translateFieldIn(r))},g.set=function(e,r,i){g.beginWriteAction();try{t.PAssert(985,!(e instanceof b),"Must pass in a valid remote item")}catch(n){t.reportError(n)}return void 0===i&&(i=null),e.set(t.translateFieldIn(r),i)},g.delete=function(e,r){g.beginWriteAction();try{t.PAssert(986,!(e instanceof b),"Must pass in a valid remote item")}catch(i){t.reportError(i)}return e.delete(t.translateFieldIn(r))},g.findInTree=function(e,t){function r(r,i){if(!r)return!1;for(var n=0;n<r.length;n++){var o=r.get(n);if(o.id==e.id)return{parent:t,index:n,isArchived:i};var a=g.findInTree(e,o);if(a)return a}return void 0}t||(t=g.rootItem);var i=g.get(t,"items"),n=r(i,!1);if(!n){var o=g.get(t,"archivedItems");n=r(o,!0)}return n},g});var idbModules={},cleanInterface=!1;!function(){var e={test:!0};if(Object.defineProperty)try{Object.defineProperty(e,"test",{enumerable:!1}),e.test&&(cleanInterface=!0)}catch(t){}}(),function(e){function t(e,t,r,i){r.target=t,"function"==typeof t[e]&&t[e].apply(t,[r]),"function"==typeof i&&i()}function r(e,t){var r=new DOMException.prototype.constructor(0,t);throw r.name=e,r.message=t,r}var i=function(){this.length=0,this._items=[],cleanInterface&&Object.defineProperty(this,"_items",{enumerable:!1})};if(i.prototype={contains:function(e){return-1!==this._items.indexOf(e)},item:function(e){return this._items[e]},indexOf:function(e){return this._items.indexOf(e)},push:function(e){this._items.push(e),this.length+=1;for(var t=0;t<this._items.length;t++)this[t]=this._items[t]},splice:function(){this._items.splice.apply(this._items,arguments),this.length=this._items.length;for(var e in this)e===String(parseInt(e,10))&&delete this[e];for(e=0;e<this._items.length;e++)this[e]=this._items[e]}},cleanInterface)for(var n in{indexOf:!1,push:!1,splice:!1})Object.defineProperty(i.prototype,n,{enumerable:!1});e.util={throwDOMException:r,callback:t,quote:function(e){return"'"+e+"'"},StringList:i}}(idbModules),function(idbModules){var Sca=function(){return{decycle:function(object,callback){function checkForCompletion(){0===queuedObjects.length&&returnCallback(derezObj)}function readBlobAsDataURL(e,t){var r=new FileReader;r.onloadend=function(e){var r=e.target.result,i="blob";updateEncodedBlob(r,t,i)},r.readAsDataURL(e)}function updateEncodedBlob(dataURL,path,blobtype){var encoded=queuedObjects.indexOf(path);path=path.replace("$","derezObj"),eval(path+'.$enc="'+dataURL+'"'),eval(path+'.$type="'+blobtype+'"'),queuedObjects.splice(encoded,1),checkForCompletion()}function derez(e,t){var r,i,n;if(!("object"!=typeof e||null===e||e instanceof Boolean||e instanceof Date||e instanceof Number||e instanceof RegExp||e instanceof Blob||e instanceof String)){for(r=0;r<objects.length;r+=1)if(objects[r]===e)return{$ref:paths[r]};if(objects.push(e),paths.push(t),"[object Array]"===Object.prototype.toString.apply(e))for(n=[],r=0;r<e.length;r+=1)n[r]=derez(e[r],t+"["+r+"]");else{n={};for(i in e)Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=derez(e[i],t+"["+JSON.stringify(i)+"]"))}return n}return e instanceof Blob?(queuedObjects.push(t),readBlobAsDataURL(e,t)):e instanceof Boolean?e={$type:"bool",$enc:e.toString()}:e instanceof Date?e={$type:"date",$enc:e.getTime()}:e instanceof Number?e={$type:"num",$enc:e.toString()}:e instanceof RegExp&&(e={$type:"regex",$enc:e.toString()}),e}var objects=[],paths=[],queuedObjects=[],returnCallback=callback,derezObj=derez(object,"$");checkForCompletion()},retrocycle:function retrocycle($){function dataURLToBlob(e){var t,r,i,n=";base64,";if(-1===e.indexOf(n))return r=e.split(","),t=r[0].split(":")[1],i=r[1],new Blob([i],{type:t});r=e.split(n),t=r[0].split(":")[1],i=window.atob(r[1]);for(var o=i.length,a=new Uint8Array(o),s=0;o>s;++s)a[s]=i.charCodeAt(s);return new Blob([a.buffer],{type:t})}function rez(value){var i,item,name,path;if(value&&"object"==typeof value)if("[object Array]"===Object.prototype.toString.apply(value))for(i=0;i<value.length;i+=1)item=value[i],item&&"object"==typeof item&&(path=item.$ref,value[i]="string"==typeof path&&px.test(path)?eval(path):rez(item));else if(void 0!==value.$type)switch(value.$type){case"blob":case"file":value=dataURLToBlob(value.$enc);break;case"bool":value=Boolean("true"===value.$enc);break;case"date":value=new Date(value.$enc);break;case"num":value=Number(value.$enc);break;case"regex":value=eval(value.$enc)}else for(name in value)"object"==typeof value[name]&&(item=value[name],item&&(path=item.$ref,value[name]="string"==typeof path&&px.test(path)?eval(path):rez(item)));return value}var px=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;return rez($),$},encode:function(e,t){function r(e){t(JSON.stringify(e))}this.decycle(e,r)},decode:function(e){return this.retrocycle(JSON.parse(e))}}}();idbModules.Sca=Sca}(idbModules),function(e){var t=["","number","string","boolean","object","undefined"],r=function(){return{encode:function(e){return t.indexOf(typeof e)+"-"+JSON.stringify(e)},decode:function(e){return"undefined"==typeof e?void 0:JSON.parse(e.substring(2))}}},i={number:r("number"),"boolean":r(),object:r(),string:{encode:function(e){return t.indexOf("string")+"-"+e},decode:function(e){return""+e.substring(2)}},undefined:{encode:function(){return t.indexOf("undefined")+"-undefined"},decode:function(){return void 0}}},n=function(){return{encode:function(e){return i[typeof e].encode(e)},decode:function(e){return i[t[e.substring(0,1)]].decode(e)}}}();e.Key=n}(idbModules),function(e){var t=function(e,t){return{type:e,debug:t,bubbles:!1,cancelable:!1,eventPhase:0,timeStamp:new Date}};e.Event=t}(idbModules),function(e){var t=function(){this.onsuccess=this.onerror=this.result=this.error=this.source=this.transaction=null,this.readyState="pending"},r=function(){this.onblocked=this.onupgradeneeded=null};r.prototype=t,e.IDBRequest=t,e.IDBOpenRequest=r}(idbModules),function(e,t){var r=function(e,t,r,i){this.lower=e,this.upper=t,this.lowerOpen=r,this.upperOpen=i};r.only=function(e){return new r(e,e,!1,!1)},r.lowerBound=function(e,i){return new r(e,t,i,t)},r.upperBound=function(e){return new r(t,e,t,open)},r.bound=function(e,t,i,n){return new r(e,t,i,n)},e.IDBKeyRange=r}(idbModules),function(e,t){function r(r,i,n,o,a,s){this.__range=r,this.source=this.__idbObjectStore=n,this.__req=o,this.key=t,this.direction=i,this.__keyColumnName=a,this.__valueColumnName=s,this.__valueDecoder="value"===s?e.Sca:e.Key,this.source.transaction.__active||e.util.throwDOMException("TransactionInactiveError - The transaction this IDBObjectStore belongs to is not active."),this.__offset=-1,this.__lastKeyContinued=t,this["continue"]()}r.prototype.__find=function(r,i,n,o,a){a=a||1;var s=this,c=["SELECT * FROM ",e.util.quote(s.__idbObjectStore.name)],d=[];c.push("WHERE ",s.__keyColumnName," NOT NULL"),s.__range&&(s.__range.lower||s.__range.upper)&&(c.push("AND"),s.__range.lower&&(c.push(s.__keyColumnName+(s.__range.lowerOpen?" >":" >= ")+" ?"),d.push(e.Key.encode(s.__range.lower))),s.__range.lower&&s.__range.upper&&c.push("AND"),s.__range.upper&&(c.push(s.__keyColumnName+(s.__range.upperOpen?" < ":" <= ")+" ?"),d.push(e.Key.encode(s.__range.upper)))),"undefined"!=typeof r&&(s.__lastKeyContinued=r,s.__offset=0),s.__lastKeyContinued!==t&&(c.push("AND "+s.__keyColumnName+" >= ?"),d.push(e.Key.encode(s.__lastKeyContinued))),c.push("ORDER BY ",s.__keyColumnName),c.push("LIMIT "+a+" OFFSET "+s.__offset),s.__prefetchedData=null,i.executeSql(c.join(" "),d,function(e,r){r.rows.length>1?(s.__prefetchedData=r.rows,s.__prefetchedIndex=0,s.__decode(r.rows.item(0),n)):1===r.rows.length?s.__decode(r.rows.item(0),n):n(t,t)},function(e,t){o(t)})},r.prototype.__decode=function(t,r){var i=e.Key.decode(t[this.__keyColumnName]),n=this.__valueDecoder.decode(t[this.__valueColumnName]),o=e.Key.decode(t.key);r(i,n,o)},r.prototype["continue"]=function(r){var i=e.cursorPreloadPackSize||1e4,n=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(e,o,a,s){n.__offset++;var c=function(e,r,i){n.key=e,n.value=r,n.primaryKey=i,a("undefined"!=typeof n.key?n:t,n.__req)};return n.__prefetchedData&&(n.__prefetchedIndex++,n.__prefetchedIndex<n.__prefetchedData.length)?void n.__decode(n.__prefetchedData.item(n.__prefetchedIndex),c):void n.__find(r,e,c,s,i)
})},r.prototype.advance=function(r){0>=r&&e.util.throwDOMException("Type Error - Count is invalid - 0 or negative",r);var i=this;this.__idbObjectStore.transaction.__addToTransactionQueue(function(e,n,o,a){i.__offset+=r,i.__find(t,e,function(e,r){i.key=e,i.value=r,o("undefined"!=typeof i.key?i:t,i.__req)},a)})},r.prototype.update=function(r){var i=this,n=this.__idbObjectStore.transaction.__createRequest(function(){});return e.Sca.encode(r,function(r){i.__idbObjectStore.transaction.__pushToQueue(n,function(n,o,a,s){i.__find(t,n,function(t,o,c){var d="UPDATE "+e.util.quote(i.__idbObjectStore.name)+" SET value = ? WHERE key = ?";n.executeSql(d,[r,e.Key.encode(c)],function(e,r){1===r.rowsAffected?a(t):s("No rows with key found"+t)},function(e,t){s(t)})},s)})}),n},r.prototype["delete"]=function(){var r=this;return this.__idbObjectStore.transaction.__addToTransactionQueue(function(i,n,o,a){r.__find(t,i,function(n,s,c){var d="DELETE FROM  "+e.util.quote(r.__idbObjectStore.name)+" WHERE key = ?";i.executeSql(d,[e.Key.encode(c)],function(e,i){1===i.rowsAffected?(r.__offset--,o(t)):a("No rows with key found"+n)},function(e,t){a(t)})},a)})},e.IDBCursor=r}(idbModules),function(idbModules,undefined){function IDBIndex(e,t){this.indexName=this.name=e,this.__idbObjectStore=this.objectStore=this.source=t;var r=t.__storeProps&&t.__storeProps.indexList;r&&(r=JSON.parse(r)),this.keyPath=r&&r[e]&&r[e].keyPath||e,["multiEntry","unique"].forEach(function(t){this[t]=!!(r&&r[e]&&r[e].optionalParams&&r[e].optionalParams[t])},this)}IDBIndex.prototype.__createIndex=function(indexName,keyPath,optionalParameters){var me=this,transaction=me.__idbObjectStore.transaction;transaction.__addToTransactionQueue(function(tx,args,success,failure){me.__idbObjectStore.__getStoreProps(tx,function(){function error(){idbModules.util.throwDOMException(0,"Could not create new index",arguments)}2!==transaction.mode&&idbModules.util.throwDOMException(0,"Invalid State error, not a version transaction",me.transaction);var idxList=JSON.parse(me.__idbObjectStore.__storeProps.indexList);"undefined"!=typeof idxList[indexName]&&idbModules.util.throwDOMException(0,"Index already exists on store",idxList);var columnName=indexName;idxList[indexName]={columnName:columnName,keyPath:keyPath,optionalParams:optionalParameters},me.__idbObjectStore.__storeProps.indexList=JSON.stringify(idxList);var sql=["ALTER TABLE",idbModules.util.quote(me.__idbObjectStore.name),"ADD",columnName,"BLOB"].join(" ");tx.executeSql(sql,[],function(tx,data){tx.executeSql("SELECT * FROM "+idbModules.util.quote(me.__idbObjectStore.name),[],function(tx,data){!function initIndexForRow(i){if(i<data.rows.length)try{var value=idbModules.Sca.decode(data.rows.item(i).value),indexKey=eval("value['"+keyPath+"']");tx.executeSql("UPDATE "+idbModules.util.quote(me.__idbObjectStore.name)+" set "+columnName+" = ? where key = ?",[idbModules.Key.encode(indexKey),data.rows.item(i).key],function(){initIndexForRow(i+1)},error)}catch(e){initIndexForRow(i+1)}else tx.executeSql("UPDATE __sys__ set indexList = ? where name = ?",[me.__idbObjectStore.__storeProps.indexList,me.__idbObjectStore.name],function(){me.__idbObjectStore.__setReadyState("createIndex",!0),success(me)},error)}(0)},error)},error)},"createObjectStore")})},IDBIndex.prototype.openCursor=function(e,t){{var r=new idbModules.IDBRequest;new idbModules.IDBCursor(e,t,this.source,r,this.indexName,"value")}return r},IDBIndex.prototype.openKeyCursor=function(e,t){{var r=new idbModules.IDBRequest;new idbModules.IDBCursor(e,t,this.source,r,this.indexName,"key")}return r},IDBIndex.prototype.__fetchIndexData=function(e,t){var r=this;return r.__idbObjectStore.transaction.__addToTransactionQueue(function(i,n,o,a){var s=["SELECT * FROM ",idbModules.util.quote(r.__idbObjectStore.name)," WHERE",r.indexName,"NOT NULL"],c=[];"undefined"!=typeof e&&(s.push("AND",r.indexName," = ?"),c.push(idbModules.Key.encode(e))),i.executeSql(s.join(" "),c,function(e,r){var i;i="count"===t?r.rows.length:0===r.rows.length?undefined:"key"===t?idbModules.Key.decode(r.rows.item(0).key):idbModules.Sca.decode(r.rows.item(0).value),o(i)},a)})},IDBIndex.prototype.get=function(e){return this.__fetchIndexData(e,"value")},IDBIndex.prototype.getKey=function(e){return this.__fetchIndexData(e,"key")},IDBIndex.prototype.count=function(e){return this.__fetchIndexData(e,"count")},idbModules.IDBIndex=IDBIndex}(idbModules),function(idbModules){var IDBObjectStore=function(e,t,r){this.name=e,this.transaction=t,this.__ready={},this.__setReadyState("createObjectStore","undefined"==typeof r?!0:r),this.indexNames=new idbModules.util.StringList};IDBObjectStore.prototype.__setReadyState=function(e,t){this.__ready[e]=t},IDBObjectStore.prototype.__waitForReady=function(e,t){var r=!0;if("undefined"!=typeof t)r="undefined"==typeof this.__ready[t]?!0:this.__ready[t];else for(var i in this.__ready)this.__ready[i]||(r=!1);if(r)e();else{var n=this;window.setTimeout(function(){n.__waitForReady(e,t)},100)}},IDBObjectStore.prototype.__getStoreProps=function(e,t,r){var i=this;this.__waitForReady(function(){i.__storeProps?t(i.__storeProps):e.executeSql("SELECT * FROM __sys__ where name = ?",[i.name],function(e,r){1!==r.rows.length?t():(i.__storeProps={name:r.rows.item(0).name,indexList:r.rows.item(0).indexList,autoInc:r.rows.item(0).autoInc,keyPath:r.rows.item(0).keyPath},t(i.__storeProps))},function(){t()})},r)},IDBObjectStore.prototype.__deriveKey=function(tx,value,key,callback){function getNextAutoIncKey(){tx.executeSql("SELECT * FROM sqlite_sequence where name like ?",[me.name],function(e,t){callback(1!==t.rows.length?0:t.rows.item(0).seq)},function(e,t){idbModules.util.throwDOMException(0,"Data Error - Could not get the auto increment value for key",t)})}var me=this;me.__getStoreProps(tx,function(props){if(props||idbModules.util.throwDOMException(0,"Data Error - Could not locate defination for this table",props),props.keyPath)if("undefined"!=typeof key&&idbModules.util.throwDOMException(0,"Data Error - The object store uses in-line keys and the key parameter was provided",props),value)try{var primaryKey=eval("value['"+props.keyPath+"']");primaryKey?callback(primaryKey):"true"===props.autoInc?getNextAutoIncKey():idbModules.util.throwDOMException(0,"Data Error - Could not eval key from keyPath")}catch(e){idbModules.util.throwDOMException(0,"Data Error - Could not eval key from keyPath",e)}else idbModules.util.throwDOMException(0,"Data Error - KeyPath was specified, but value was not");else"undefined"!=typeof key?callback(key):"false"===props.autoInc?idbModules.util.throwDOMException(0,"Data Error - The object store uses out-of-line keys and has no key generator and the key parameter was not provided. ",props):getNextAutoIncKey()})},IDBObjectStore.prototype.__insertData=function(tx,encoded,value,primaryKey,success,error){var paramMap={};"undefined"!=typeof primaryKey&&(paramMap.key=idbModules.Key.encode(primaryKey));var indexes=JSON.parse(this.__storeProps.indexList);for(var key in indexes)try{paramMap[indexes[key].columnName]=idbModules.Key.encode(eval("value['"+indexes[key].keyPath+"']"))}catch(e){error(e)}var sqlStart=["INSERT INTO ",idbModules.util.quote(this.name),"("],sqlEnd=[" VALUES ("],sqlValues=[];for(key in paramMap)sqlStart.push(key+","),sqlEnd.push("?,"),sqlValues.push(paramMap[key]);sqlStart.push("value )"),sqlEnd.push("?)"),sqlValues.push(encoded);var sql=sqlStart.join(" ")+sqlEnd.join(" ");tx.executeSql(sql,sqlValues,function(){success(primaryKey)},function(e,t){error(t)})},IDBObjectStore.prototype.add=function(e,t){var r=this,i=r.transaction.__createRequest(function(){});return idbModules.Sca.encode(e,function(n){r.transaction.__pushToQueue(i,function(i,o,a,s){r.__deriveKey(i,e,t,function(t){r.__insertData(i,n,e,t,a,s)})})}),i},IDBObjectStore.prototype.put=function(e,t){var r=this,i=r.transaction.__createRequest(function(){});return idbModules.Sca.encode(e,function(n){r.transaction.__pushToQueue(i,function(i,o,a,s){r.__deriveKey(i,e,t,function(t){var o="DELETE FROM "+idbModules.util.quote(r.name)+" where key = ?";i.executeSql(o,[idbModules.Key.encode(t)],function(i){r.__insertData(i,n,e,t,a,s)},function(e,t){s(t)})})})}),i},IDBObjectStore.prototype.get=function(e){var t=this;return t.transaction.__addToTransactionQueue(function(r,i,n,o){t.__waitForReady(function(){var i=idbModules.Key.encode(e);r.executeSql("SELECT * FROM "+idbModules.util.quote(t.name)+" where key = ?",[i],function(e,t){try{if(0===t.rows.length)return n();n(idbModules.Sca.decode(t.rows.item(0).value))}catch(r){n(void 0)}},function(e,t){o(t)})})})},IDBObjectStore.prototype["delete"]=function(e){var t=this;return t.transaction.__addToTransactionQueue(function(r,i,n,o){t.__waitForReady(function(){var i=idbModules.Key.encode(e);r.executeSql("DELETE FROM "+idbModules.util.quote(t.name)+" where key = ?",[i],function(){n()},function(e,t){o(t)})})})},IDBObjectStore.prototype.clear=function(){var e=this;return e.transaction.__addToTransactionQueue(function(t,r,i,n){e.__waitForReady(function(){t.executeSql("DELETE FROM "+idbModules.util.quote(e.name),[],function(){i()},function(e,t){n(t)})})})},IDBObjectStore.prototype.count=function(e){var t=this;return t.transaction.__addToTransactionQueue(function(r,i,n,o){t.__waitForReady(function(){var i="SELECT * FROM "+idbModules.util.quote(t.name)+("undefined"!=typeof e?" WHERE key = ?":""),a=[];"undefined"!=typeof e&&a.push(idbModules.Key.encode(e)),r.executeSql(i,a,function(e,t){n(t.rows.length)},function(e,t){o(t)})})})},IDBObjectStore.prototype.openCursor=function(e,t){{var r=new idbModules.IDBRequest;new idbModules.IDBCursor(e,t,this,r,"key","value")}return r},IDBObjectStore.prototype.index=function(e){var t=new idbModules.IDBIndex(e,this);return t},IDBObjectStore.prototype.createIndex=function(e,t,r){var i=this;r=r||{},i.__setReadyState("createIndex",!1);var n=new idbModules.IDBIndex(e,i);return i.__waitForReady(function(){n.__createIndex(e,t,r)},"createObjectStore"),i.indexNames.push(e),n},IDBObjectStore.prototype.deleteIndex=function(e){var t=new idbModules.IDBIndex(e,this,!1);return t.__deleteIndex(e),t},idbModules.IDBObjectStore=IDBObjectStore}(idbModules),function(e){var t=0,r=1,i=2,n=function(i,n,o){if("number"==typeof n)this.mode=n;else if("string"==typeof n)switch(n){case"readwrite":this.mode=r;break;case"readonly":this.mode=t;break;default:this.mode=t}this.storeNames="string"==typeof i?[i]:i;for(var a=0;a<this.storeNames.length;a++)o.objectStoreNames.contains(this.storeNames[a])||e.util.throwDOMException(0,"The operation failed because the requested database object could not be found. For example, an object store did not exist but was being opened.",this.storeNames[a]);this.__active=!0,this.__running=!1,this.__requests=[],this.__aborted=!1,this.db=o,this.error=null,this.onabort=this.onerror=this.oncomplete=null};n.prototype.__executeRequests=function(){if(!this.__running||this.mode===i){this.__running=!0;var t=this;window.setTimeout(function(){2===t.mode||t.__active||e.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",t.__active),t.db.__db.transaction(function(r){function i(t,r){r&&(a.req=r),a.req.readyState="done",a.req.result=t,delete a.req.error;var i=e.Event("success");e.util.callback("onsuccess",a.req,i),s++,o()}function n(){a.req.readyState="done",a.req.error="DOMError";var t=e.Event("error",arguments);e.util.callback("onerror",a.req,t),s++,o()}function o(){return s>=t.__requests.length?(t.__active=!1,void(t.__requests=[])):(a=t.__requests[s],void a.op(r,a.args,i,n))}t.__tx=r;var a=null,s=0;try{o()}catch(c){"function"==typeof t.onerror&&t.onerror()}},function(){"function"==typeof t.onerror&&t.onerror()},function(){"function"==typeof t.oncomplete&&t.oncomplete()})},1)}},n.prototype.__addToTransactionQueue=function(t,r){this.__active||this.mode===i||e.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished.",this.__mode);var n=this.__createRequest();return this.__pushToQueue(n,t,r),n},n.prototype.__createRequest=function(){var t=new e.IDBRequest;return t.source=this.db,t.transaction=this,t},n.prototype.__pushToQueue=function(e,t,r){this.__requests.push({op:t,args:r,req:e}),this.__executeRequests()},n.prototype.objectStore=function(t){return new e.IDBObjectStore(t,this)},n.prototype.abort=function(){!this.__active&&e.util.throwDOMException(0,"A request was placed against a transaction which is currently not active, or which is finished",this.__active)},n.prototype.READ_ONLY=0,n.prototype.READ_WRITE=1,n.prototype.VERSION_CHANGE=2,e.IDBTransaction=n}(idbModules),function(e){var t=function(t,r,i,n){this.__db=t,this.version=i,this.__storeProperties=n,this.objectStoreNames=new e.util.StringList;for(var o=0;o<n.rows.length;o++)this.objectStoreNames.push(n.rows.item(o).name);this.name=r,this.onabort=this.onerror=this.onversionchange=null};t.prototype.createObjectStore=function(t,r){var i=this;r=r||{},r.keyPath=r.keyPath||null;var n=new e.IDBObjectStore(t,i.__versionTransaction,!1),o=i.__versionTransaction;return o.__addToTransactionQueue(function(o,a,s){function c(){e.util.throwDOMException(0,"Could not create new object store",arguments)}i.__versionTransaction||e.util.throwDOMException(0,"Invalid State error",i.transaction);var d=["CREATE TABLE",e.util.quote(t),"(key BLOB",r.autoIncrement?", inc INTEGER PRIMARY KEY AUTOINCREMENT":"PRIMARY KEY",", value BLOB)"].join(" ");o.executeSql(d,[],function(e){e.executeSql("INSERT INTO __sys__ VALUES (?,?,?,?)",[t,r.keyPath,r.autoIncrement?!0:!1,"{}"],function(){n.__setReadyState("createObjectStore",!0),s(n)},c)},c)}),i.objectStoreNames.push(t),n},t.prototype.deleteObjectStore=function(t){var r=function(){e.util.throwDOMException(0,"Could not delete ObjectStore",arguments)},i=this;!i.objectStoreNames.contains(t)&&r("Object Store does not exist"),i.objectStoreNames.splice(i.objectStoreNames.indexOf(t),1);var n=i.__versionTransaction;n.__addToTransactionQueue(function(){i.__versionTransaction||e.util.throwDOMException(0,"Invalid State error",i.transaction),i.__db.transaction(function(i){i.executeSql("SELECT * FROM __sys__ where name = ?",[t],function(i,n){n.rows.length>0&&i.executeSql("DROP TABLE "+e.util.quote(t),[],function(){i.executeSql("DELETE FROM __sys__ WHERE name = ?",[t],function(){},r)},r)})})})},t.prototype.close=function(){},t.prototype.transaction=function(t,r){var i=new e.IDBTransaction(t,r||1,this);return i},e.IDBDatabase=t}(idbModules),function(e){var t=2097152;if(window.openDatabase){var r=window.openDatabase("__sysdb__",1,"System Database",t);r.transaction(function(e){e.executeSql("SELECT * FROM dbVersions",[],function(){a.notifyIsReady(!0)},function(){r.transaction(function(e){e.executeSql("CREATE TABLE IF NOT EXISTS dbVersions (name VARCHAR(255), version INT);",[],function(){a.notifyIsReady(!0)},function(){a.notifyIsReady(!1)})})})},function(){});var i=!1,n=!1,o=void 0,a={notifyIsReady:function(e){if(n=!0,i=e,o){for(var t=0;t<o.length;++t)o[t](i);o=void 0}},onIsReady:function(e){n?setTimeout(function(){e(i)},0):o?o.push(e):o=[e]},open:function(i,n){function o(){if(!c){var t=e.Event("error",arguments);s.readyState="done",s.error="DOMError",e.util.callback("onerror",s,t),c=!0}}function a(a){var c=window.openDatabase(i,1,i,t);s.readyState="done","undefined"==typeof n&&(n=a||1),(0>=n||a>n)&&e.util.throwDOMException(0,"An attempt was made to open a database using a lower version than the existing version.",n),c.transaction(function(t){t.executeSql("CREATE TABLE IF NOT EXISTS __sys__ (name VARCHAR(255), keyPath VARCHAR(255), autoInc BOOLEAN, indexList BLOB)",[],function(){t.executeSql("SELECT * FROM __sys__",[],function(t,d){var l=e.Event("success");s.source=s.result=new e.IDBDatabase(c,i,n,d),n>a?r.transaction(function(t){t.executeSql("UPDATE dbVersions set version = ? where name = ?",[n,i],function(){var t=e.Event("upgradeneeded");t.oldVersion=a,t.newVersion=n,s.transaction=s.result.__versionTransaction=new e.IDBTransaction([],2,s.source),e.util.callback("onupgradeneeded",s,t,function(){var t=e.Event("success");e.util.callback("onsuccess",s,t)})},o)},o):e.util.callback("onsuccess",s,l)},o)},o)},o)}var s=new e.IDBOpenRequest,c=!1;return r.transaction(function(e){e.executeSql("SELECT * FROM dbVersions where name = ?",[i],function(e,t){0===t.rows.length?e.executeSql("INSERT INTO dbVersions VALUES (?,?)",[i,n||1],function(){a(0)},o):a(t.rows.item(0).version)},o)},o),s},deleteDatabase:function(i){function n(t){if(!s){a.readyState="done",a.error="DOMError";var r=e.Event("error");r.message=t,r.debug=arguments,e.util.callback("onerror",a,r),s=!0}}function o(){r.transaction(function(t){t.executeSql("DELETE FROM dbVersions where name = ? ",[i],function(){a.result=void 0;var t=e.Event("success");t.newVersion=null,t.oldVersion=c,e.util.callback("onsuccess",a,t)},n)},n)}var a=new e.IDBOpenRequest,s=!1,c=null;return r.transaction(function(r){r.executeSql("SELECT * FROM dbVersions where name = ?",[i],function(r,s){if(0===s.rows.length){a.result=void 0;var d=e.Event("success");return d.newVersion=null,d.oldVersion=c,void e.util.callback("onsuccess",a,d)}c=s.rows.item(0).version;var l=window.openDatabase(i,1,i,t);l.transaction(function(t){t.executeSql("SELECT * FROM __sys__",[],function(t,r){var i=r.rows;!function a(r){r>=i.length?t.executeSql("DROP TABLE __sys__",[],function(){o()},n):t.executeSql("DROP TABLE "+e.util.quote(i.item(r).name),[],function(){a(r+1)},function(){a(r+1)})}(0)},function(){o()})},n)})},n),a},cmp:function(t,r){return e.Key.encode(t)>e.Key.encode(r)?1:t===r?0:-1}};e.shimIndexedDB=a}}(idbModules),function(e,t){"undefined"!=typeof e.openDatabase&&(e.shimIndexedDB=t.shimIndexedDB,e.shimIndexedDB&&(e.shimIndexedDB.__useShim=function(){console.log("---- Using SQL Shim ----"),e.indexedDB=t.shimIndexedDB,e.IDBDatabase=t.IDBDatabase,e.IDBTransaction=t.IDBTransaction,e.IDBCursor=t.IDBCursor,e.IDBKeyRange=t.IDBKeyRange,e.indexedDB!==t.shimIndexedDB&&Object.defineProperty&&Object.defineProperty(e,"indexedDB",{value:t.shimIndexedDB})},e.shimIndexedDB.__debug=function(){})),"indexedDB"in e||(e.indexedDB=e.indexedDB||e.webkitIndexedDB||e.mozIndexedDB||e.oIndexedDB||e.msIndexedDB);var r=!1;(navigator.userAgent.match(/Android 2/)||navigator.userAgent.match(/Android 3/)||navigator.userAgent.match(/Android 4\.[0-3]/))&&(navigator.userAgent.match(/Chrome/)||(r=!0));var i=e.location.hash.indexOf("forcesql=true")>=0;if(i||("undefined"==typeof e.indexedDB||r)&&"undefined"!=typeof e.openDatabase)e.shimIndexedDB.__useShim();else{e.IDBDatabase=e.IDBDatabase||e.webkitIDBDatabase,e.IDBTransaction=e.IDBTransaction||e.webkitIDBTransaction,e.IDBCursor=e.IDBCursor||e.webkitIDBCursor,e.IDBKeyRange=e.IDBKeyRange||e.webkitIDBKeyRange,e.IDBTransaction||(e.IDBTransaction={});try{e.IDBTransaction.READ_ONLY=e.IDBTransaction.READ_ONLY||"readonly",e.IDBTransaction.READ_WRITE=e.IDBTransaction.READ_WRITE||"readwrite"}catch(n){}}}(window,idbModules),define("IndexedDBShim",function(){}),define("db",["IndexedDBShim"],function(){var e=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.oIndexedDB||window.msIndexedDB,t=window.IDBKeyRange||window.webkitIDBKeyRange,r={readonly:"readonly",readwrite:"readwrite"},i=Object.prototype.hasOwnProperty;if(!e)return void console.log("IndexedDB is not available");var n=function(e){return e},o=function(){var e,t=[],r=function(r,i){if(t){i=i||[],e=e||[r,i];for(var n=0,o=t.length;o>n;n++)t[n].apply(e[0],e[1]);t=[]}};this.add=function(){for(var i=0,n=arguments.length;n>i;i++)t.push(arguments[i]);return e&&r(),this},this.execute=function(){return r(this,arguments),this}},a=function(e){var t="progress",r=[["resolve","done",new o,"resolved"],["reject","fail",new o,"rejected"],["notify","progress",new o]],i={},n={state:function(){return t},then:function(){var e=arguments;return a(function(t){r.forEach(function(r,n){var o=e[n];i[r[1]]("function"==typeof o?function(){var e=o.apply(this,arguments);e&&"function"==typeof e.promise&&e.promise().done(t.resolve).fail(t.reject).progress(t.notify)}:t[r[0]])})}).promise()},promise:function(e){return e?(Object.keys(n).forEach(function(t){e[t]=n[t]}),e):n}};return r.forEach(function(e){var r=e[2],o=e[3];n[e[1]]=r.add,o&&r.add(function(){t=o}),i[e[0]]=r.execute}),n.promise(i),e&&e.call(i,i),i},s=function(e,t){var n=this,o=!1;this.add=function(t){if(o)throw"Database has been closed";for(var i=[],s=0,c=0;c<arguments.length-1;c++)if(Array.isArray(arguments[c+1]))for(var d=0;d<arguments[c+1].length;d++)i[s]=arguments[c+1][d],s++;else i[s]=arguments[c+1],s++;var l=e.transaction(t,r.readwrite),u=l.objectStore(t),h=a();return i.forEach(function(e){var t;if(e.item&&e.key){var r=e.key;e=e.item,t=u.add(e,r)}else t=u.add(e);t.onsuccess=function(t){var r=t.target,i=r.source.keyPath;null===i&&(i="__id__"),Object.defineProperty(e,i,{value:r.result,enumerable:!0}),h.notify()}}),l.oncomplete=function(){h.resolve(i,n)},l.onerror=function(e){h.reject(i,e)},l.onabort=function(e){h.reject(i,e)},h.promise()},this.update=function(t){if(o)throw"Database has been closed";for(var i=[],s=0;s<arguments.length-1;s++)i[s]=arguments[s+1];var c=e.transaction(t,r.readwrite),d=c.objectStore(t),l=a();return i.forEach(function(e){var t;if(e.item&&e.key){var r=e.key;e=e.item,t=d.put(e,r)}else t=d.put(e);t.onsuccess=function(){l.notify()}}),c.oncomplete=function(){l.resolve(i,n)},c.onerror=function(e){l.reject(i,e)},c.onabort=function(e){l.reject(i,e)},l.promise()},this.updateObject=function(t){if(o)throw"Database has been closed";var i=e.transaction(t,r.readwrite),s=i.objectStore(t),c=a(),d=arguments[1];for(var l in d)s.put(d[l]);return i.oncomplete=function(){c.resolve(d,n)},i.onerror=function(e){c.reject(d,e)},i.onabort=function(e){c.reject(d,e)},c.promise()},this.remove=function(t,i){if(o)throw"Database has been closed";{var n=e.transaction(t,r.readwrite),s=n.objectStore(t),c=a();s.delete(i)}return n.oncomplete=function(){c.resolve(i)},n.onerror=function(e){c.reject(e)},c.promise()},this.clear=function(t){if(o)throw"Database has been closed";{var i=e.transaction(t,r.readwrite),n=i.objectStore(t),s=a();n.clear()}return i.oncomplete=function(){s.resolve()},i.onerror=function(e){s.reject(e)},s.promise()},this.close=function(){if(o)throw"Database has been closed";e.close(),o=!0,delete u[t]},this.get=function(t,r){if(o)throw"Database has been closed";var i=e.transaction(t),n=i.objectStore(t),s=a(),c=n.get(r);return c.onsuccess=function(e){s.resolve(e.target.result)},i.onerror=function(e){s.reject(e)},s.promise()},this.query=function(t,r){if(o)throw"Database has been closed";return new c(t,e,r)};for(var s=0,d=e.objectStoreNames.length;d>s;s++)!function(e){n[e]={};for(var t in n)i.call(n,t)&&"close"!==t&&(n[e][t]=function(t){return function(){var r=[e].concat([].slice.call(arguments,0));return n[t].apply(n,r)}}(t))}(e.objectStoreNames[s])},c=function(e,i,o){var s=this,c=!1,d=function(n,s,d,l,u,h,p){var m=i.transaction(e,c?r.readwrite:r.readonly),f=m.objectStore(e),g=o?f.index(o):f,v=n?t[n].apply(null,s):null,y=[],b=a(),S=[v],u=u?u:null,h=h?h:void 0,T=0;"count"!==d&&S.push(l||"next");var x=c?Object.keys(c):!1,w=function(e){for(var t=0;t<x.length;t++){var r=x[t],i=c[r];i instanceof Function&&(i=i(e)),e[r]=i}return e};return g[d].apply(g,S).onsuccess=function(e){var t=e.target.result;if("number"==typeof t)y=t;else if(t)if(null!==u&&u[0]>T)T=u[0],t.advance(u[0]);else if(null!==u&&T>=u[0]+u[1]);else{var r=!0,i="value"in t?t.value:t.key;h&&h.forEach(function(e){e&&e.length&&(r=2===e.length?i[e[0]]===e[1]:e[0].apply(void 0,[i]))}),r&&(T++,y.push(p(i)),c&&(i=w(i),t.update(i))),t.continue()}},m.oncomplete=function(){b.resolve(y)},m.onerror=function(e){b.reject(e)},m.onabort=function(e){b.reject(e)},b.promise()},l=function(e,t){var r="next",i="openCursor",o=[],a=null,s=n,l=!1,u=function(){return d(e,t,i,l?r+"unique":r,a,o,s)},h=function(){return a=Array.prototype.slice.call(arguments,0,2),1==a.length&&a.unshift(0),{execute:u}},p=function(){return r=null,i="count",{execute:u}},m=function(){return i="openKeyCursor",{desc:g,execute:u,filter:f,distinct:v,map:b}},f=function(){return o.push(Array.prototype.slice.call(arguments,0,2)),{keys:m,execute:u,filter:f,desc:g,distinct:v,modify:y,limit:h,map:b}},g=function(){return r="prev",{keys:m,execute:u,filter:f,distinct:v,modify:y,map:b}},v=function(){return l=!0,{keys:m,count:p,execute:u,filter:f,desc:g,modify:y,map:b}},y=function(e){return c=e,{execute:u}},b=function(e){return s=e,{execute:u,count:p,keys:m,filter:f,desc:g,distinct:v,modify:y,limit:h,map:b}};return{execute:u,count:p,keys:m,filter:f,desc:g,distinct:v,modify:y,limit:h,map:b}};"only bound upperBound lowerBound".split(" ").forEach(function(e){s[e]=function(){return new l(e,arguments)}}),this.filter=function(){var e=new l(null,null);return e.filter.apply(e,arguments)},this.all=function(){return this.filter()}},d=function(e,t,r){"function"==typeof t&&(t=t());for(var n in t){var o,a=t[n];o=!i.call(t,n)||r.objectStoreNames.contains(n)?e.currentTarget.transaction.objectStore(n):r.createObjectStore(n,a.key);for(var s in a.indexes)if(!o.indexNames.contains(s)){var c=a.indexes[s];o.createIndex(s,c.key||s,Object.keys(c).length?c:{unique:!1})}}},l=function(e,t){var r=e.target.result,i=new s(r,t),n=a();return n.resolve(i),u[t]=r,n.promise()},u={},h={version:"0.9.0",open:function(t){var r,i=a();return u[t.server]?l({target:{result:u[t.server]}},t.server,t.version,t.schema).done(i.resolve).fail(i.reject).progress(i.notify):(r=e.open(t.server,t.version),r.onsuccess=function(e){l(e,t.server,t.version,t.schema).done(i.resolve).fail(i.reject).progress(i.notify)},r.onupgradeneeded=function(e){d(e,t.schema,e.target.result)},r.onerror=function(e){i.reject(e)}),i.promise()}};return h}),define("demo",[],function(){return function(e){return e?1===e?[{text:"Home:",items:[{text:"Entertainment:",items:[{text:"Movies:",items:[{text:"In Theaters:",items:[{text:"Despicable Me 2 @11:00am +Miller Harris"},{text:"The Wolverine @Tuesday +Jane Johnson"}]},{text:"Netflix:",items:[{text:"Moonrise Kingdom",isComplete:!0},{text:"Citizen Kane",isComplete:!0},{text:"Tampopo"},{text:"Wreck it Ralph"},{text:"The Raid"}]}]},{text:"TV:",items:[{text:"King of the Nerds"},{text:"Sherlock"},{text:"Legend of Korra"},{text:"What the Ancients Knew",priority:VMLIFlag.P1},{text:"Black Mirror"},{text:"Men at Work"},{text:"Psych"}]},{text:"Games:",items:[{text:"Amnesia"},{text:"Strike Suit Zero"}]},{text:"Books:",items:[{text:"How to Win Friends and Influence People"},{text:"On the Road"},{text:"The Beat Generation"},{text:"Outliers"},{text:"Innovators Dilemma"}]}]},{text:"Todo List",items:[{text:"Call +Jim Joseph about fixing the blinds"},{text:"Upload pictures from trip to Barbados"},{text:"Insurance before @4/25"},{text:"Buy bitcoins"},{text:"Taxes @april"},{text:"Pay rent"},{text:"Lunch with +Miller Harris @12:30"},{text:"Dinner date with +Emily Edwards @8pm"},{text:"Check the mail @today"},{text:"Ask +Jane Johnson who her dentist is"},{text:"Learn Japanese",priority:VMLIFlag.P0,items:[{text:"http://memrise.com"},{text:"Try the new iPhone app"}]}]},{text:"Grocery List:",isFlagged:!0,items:[{text:"Apples"},{text:"Carrots"},{text:"Yogurt"},{text:"Celery"},{text:"Eggs"},{text:"Almond Milk"}]},{text:"Restaurants:",items:[{text:"SF:",items:[{text:"Ike's Sandwiches"},{text:"Sweet Woodruff"},{text:"Suzu Ramen"},{text:"Kate's Kitchen"},{text:"Otoro Sushi in Hayes Valley"},{text:"Domo in Hayes Valley"}]},{text:"New York:",items:[{text:"Grammarcy Tavern"},{text:"Cornelia Street Cafe"}]}]},{text:"Trip to Tobago:",items:[{text:"Hotels:",items:[{text:"Trinidad:",items:[{text:"Port of Spain",items:[{text:"The Carlton Savannah - $150 per night"},{text:"Marriott Courtyard - $200 per night"}]}]},{text:"Tobago:",items:[{text:"Scarborough:",items:[{text:"Bacolet Beach Club - $170 per night"},{text:"Coco Reef - $200"},{text:"Blue Haven Hotel - $299"}]},{text:"Castara:",items:[{text:"http://naturalist-tobago.com/bookings.html",items:[{text:"Has optional car rental"},{text:"Dolphin $90, ocean view veranda"},{text:"Tuna $85 ocean view + garden view"},{text:"We probably should do this - it's right on the beach"},{text:"Have to fill form to book"}]},{text:"http://www.hiddencottagetobago.com/hummingbird.htm",items:[{text:"3 minute walk to beach, can rent jeep"}]},{text:"http://www.angel-apartments.com/new.html",items:[{text:"60-80 pounds per night"}]},{text:"http://www.blue-mango.com/contact.php",items:[{text:"$70 - $150"}]}]},{text:"Manzanilla:",items:[{text:"http://dcoconutcove.com/rooms.php",items:[{text:"Seems like the only option here - have to book via email"}]}]}]}]},{text:"Activities:",items:[{text:"Things to do:",items:[{text:"Argyle Waterfall"},{text:"Plantation Beach Watersports/Island Girl Cruises"},{text:"Nylon Pool"},{text:"Pigeon Point Beach - Jet Skiing"}]},{text:"Tour operators:",items:[{text:"http://www.caribbeandiscoverytours.com",items:[{text:"Hikes, safaris, kayaking, waterfalls"},{text:"http://www.caribbeandiscoverytours.com/Tour4_nariva.html"},{text:"seems too expensive - $100 for a day hike"}]},{text:"http://chagdev.com",items:[{text:"waterfall and walking tours around Tucker Valley, caves"},{text:"I like this, $20-$30 tours"}]},{text:"Gasparee Caves Tour"},{text:"Steel pan: http://islandexperiencestt.com",items:[{text:"meh"}]},{text:"pariasprings.com",items:[{text:"Jungle camps http://pariasprings.com/events/kayaking.html"},{text:"A day of fun with rainforests, waterfalls, and kayaking"}]},{text:""}]}]}]}]}]:4===e?[{text:"Home",items:[{text:"Movies",items:[{text:"In Theaters",items:[{id:"movieItem",text:"The Lego Movie 3D"},{id:"movieItem2",text:"Frozen"}]}]},{id:"todoItem",text:"Todo List",items:[{id:"rentItem",text:"Pay rent"},{id:"groceriesItem",text:"Get groceries"}]},{id:"shoppingItem",text:"Shopping",items:[{text:"Shorts"},{text:"New Camera"},{id:"laptopItem",text:"Laptop for Dad",items:[{text:'15", touch screen, plus a mouse'},{text:"A hard case because he'll drop it a lot"}]}]},{text:"Blog topics",items:[{text:"Traveling in New Zealand"},{text:"Inner workings of web browsers"}]},{id:"vacationItem",text:"Vacation Plan"}]}]:5===e?[{text:"Home",items:[{text:"Action Items",items:[{text:"Follow up on expense reports with +Mike Thomas for team"},{text:"File brief with +Bill Wilson before board meeting about ethics policy @3/14"},{text:"Meeting with +Mike Thomas and +Joe Lewis to discuss quarterly earning projections @3/12 2:00pm"},{text:"Lunch with +Bill Wilson at Revel @3/13 12:30pm",items:[{text:"Discuss travel plans"}]},{text:"Confirm hotel booking for @3/20 for +Canyon Ranch"}]},{text:"Board Meeting @3/17",items:[{text:"Touch base with +Bill Wilson and +Bob Johnson about voting proxy"},{text:"Confirm catering with +Emily Edwards"},{text:"Agenda",items:[{text:"Approve previous board meeting minutes"},{text:"Offices report",items:[{text:"Contact +Emily Edwards about proper filing of report before"}]},{text:"Old business",items:[{text:"Talk about raise in maximum expenses per person for discretionary use"},{text:"Change in business code of ethics policy"}]},{text:"Items for board approval",items:[{text:"Increase in vacation days"},{text:"Executive compensation"}]},{text:"Feedback session"},{text:"Requests for action items"}]}]}]}]:6===e?[{text:"Home",items:[{text:"Physics",items:[{text:"Homework",items:[{text:"Read chapter 2 in Hawking @3/4"},{text:"4pg writeup on black holes @3/11",items:[{text:"http://www.nation.com.pk/snippets/27-Jan-2014/stephen-hawking-says-black-holes-don-t-exist"}]}]},{text:"Lab report @3/11",items:[{text:"Talk to +Jim Joseph about conclusion section and proofread introduction"},{text:"Create graphs for data section on air temperature increase over time"}]}]},{text:"Chemistry",items:[{text:"Order aluminum oxide @3/21",isFlagged:!0}]},{text:"Business Ethics",items:[{text:"Homework",items:[{text:"Read chapter 5 and write 500 word summary on one case study @3/5"},{text:"Read sections 6.1 through 6.5 and answer end of section questions @3/12"}]}]},{text:"Technical Writing",items:[{text:"Bring Alred book to class! @3/10"},{text:"Talk to +Mike Thomas about experience writing docs at a large company"},{text:"Prepare presentation for REST API documentation on example data @3/13"}]}]}]:7===e?[{text:"Home",items:[{text:"Open House @3/14",items:[{text:"Talk to +Emily Edwards to coordinate handouts for parents",items:[{text:"Finalize date of parent teacher conferences"},{text:"Double check PTA meeting agenda and date"}]},{text:"Get pencils for open house parent excercise",priority:VMLIFlag.P1}]},{text:"Lesson Plans",items:[{text:"Teaching the Seasons @3/17",items:[{text:"Objective",items:[{text:"Teach students the difference between Spring, Summer, Fall and Winter."}]},{text:"Materials",items:[{text:"Construction paper, calendar, photos of each season, arts and craft supplies, four childrens books"}]},{text:"Procedure",items:[{text:"@3/17 12:00pm Show different pictures of each season. Start with spring and progress through to winter. Explain the weather in each season with visual aid."},{text:"@3/17 12:15pm Read four short children's books, each telling a story about a different season."},{text:"@3/17 12:30pm Put the children at different tables and hand out art supplies. Demonstrate the project: a large piece of construction paper split into four parts, one for each season."},{text:"@3/17 12:45pm Walk around to help children with their projects, ask questions while helping about what occurs during each season."},{text:"@3/17 2:00pm Clean up art projects and hang them around classroom."},{text:"@3/17 2:15pm Final wrap up and discussion with Q&A for each season. Ask about the types of things they associate with each season including weather and personal memories."}]}]},{text:"Farm Animals @3/18:",items:[{text:"Objective:",items:[{text:"Teach students about the different types of animals that live on the farm."}]},{text:"Materials:",items:[{text:"Picture book, animal posters, soundboard, short story"}]},{text:"Procedure:",items:[{text:"@3/18 12:00pm Talk about what happens on a farm and broadly about the animals that live there. Show pictures of a few farm settings containing different animals."},{text:"@3/18 12:20pm Discuss anyones experience with farms or their favorite animals. See if the children have been to the petting zoo or visited a farm."},{text:"@3/18 12:45pm Go through the posters of farm animals and associate the noises the animals make with the pictures."},{text:"@3/18 1:15pm Read short story set on the farm to children and hold Q&A session. Check to see what animals they like and discuss life on a farm."}]}]}]}]}]:8===e?[{text:"Home",items:[{text:"Talk to +Joe Lewis about getting the checkin queue optimized",isFlagged:!0},{text:"Work Projects",items:[{text:"Code Reviews",items:[{text:"Talk to +Miller Harris about UX update @today 3:00pm"},{text:"Review code from +Emily Edwards for performance optimization during tap handling @tomorrow 11:00am"}]},{text:"Active Development",items:[{text:"Finish uploading design documents for improved UX"},{text:"Proofread wiki entry from +Jane Johnson for OS migration @friday"},{text:"Blocking Bugs",items:[{text:"Investigate sync issues when multiple clients are offline for long periods of time and three people edit",priority:VMLIFlag.P0},{text:"#mobile Find consistent repro scenario for input errors for fast typing on iOS"},{text:"#norepro Error at 'Deleting local item'",items:[{text:"See globals.js:1672 for additional reference"}]}]},{text:"Minor Bugs",items:[{text:"Flashing during pull to refresh after app running for long periods of time",priority:VMLIFlag.P1},{text:"Ensure copy/paste is correctly pulling from clipboard when html data is used"}]}]}]},{text:"Personal Projects",items:[{text:"Knockout Addon",items:[{text:"Ensure throttled observables plugin continues to work"},{text:"Add flush method for throttled observables"},{text:"Finish performance optimizations for large array sizes"},{text:"Prevent applyBindings from being called twice when elements get reused"}]}]}]}]:9===e?[{text:"Home",items:[{text:"Whistler",items:[{text:"Action Items",items:[{text:"Reserve rental car",priority:VMLIFlag.P0},{text:"Talk to +Bill Wilson about parking"}]},{text:"Itinerary",items:[{text:"Leave SEA -> Whistler @1/16/14"},{text:"Pickup +Emily Edwards @1/16/14 9:00pm from SEA Flight: 739"},{text:"Lodging at Whistler at Aspens 349"},{text:"Leave Whistler -> Vancouver @1/19/14 5:00pm"},{text:"Lodging in Vancouver: +Ramada",items:[{text:"Confirmation Number: 5245682",isFlagged:!0}]},{text:"Leave Vancouver -> SEA @1/20/14 3:00pm"},{text:"Drop +Emily Edwards @1/20/14 8:00pm at SEA Flight: 264"}]}]},{text:"Tobago Planning",items:[{text:"Hotels",items:[{text:"Scarborough",items:[{text:"Bacolet Beach Club - $170 / night"},{text:"Coco Reef - $200"},{text:"Blue Haven Hotel $300"}]},{text:"Castara",items:[{text:"http://naturalist-tobago.com/bookings.html",items:[{text:"Ocean view, right on the beach"},{text:"Optional car rental"}]},{text:"http://www.hiddencottagetobago.com/hummingbird.htm",items:[{text:"Three minute walk to beach"},{text:"Can rent jeep"}]},{text:"http://www.angel-apartments.com/new.html",items:[{text:"$100 - 150 / night"}]},{text:"http://www.blue-mango.com/contact.php",items:[{text:"$70 - $150 / night"}]}]},{text:"Manzanilla",items:[{text:"http://dcoconutcove.com/rooms.php",items:[{text:"Only option?"},{text:"Book by email"}]}]}]},{text:"Activities",items:[{text:"Argyle Waterfall"},{text:"Plantation Beach Watersports / Island Girl Cruises"},{text:"Nylon Pool"},{text:"Pigeon Point Beach - Jet Skiing"},{text:"Tour Operators",items:[{text:"http://www.caribbeandiscoverytours.com"},{text:"http://chagdev.com"},{text:"http://islandexperiencestt.com"},{text:"http://pariasprings.com"}]}]}]}]}]:10===e?[{text:"Home",items:[{text:"Events",items:[{text:"Frozen +Emily Edwards @Friday 6:55pm"}]},{text:"Restaurants",items:[{text:"Seattle",items:[{text:"Chan"},{text:"Joule"},{text:"Serious Pie"},{text:"Lola"}]},{text:"San Francisco",items:[{text:"Ike's Sandwhiches"},{text:"Sweet Woodruff"},{text:"Suzu Ramen"},{text:"Kate's Kitchen"}]}]},{text:"Movies",items:[{text:"Despicable Me 2"},{text:"Total Recall"}]},{text:"TV",items:[{text:"Sherlock - Season 3"},{text:"Legend of Korra"},{text:"Psych"},{text:"House of Cards"}]},{text:"Todo List",items:[{text:"Call +Jim Joseph about fixing the blinds"},{text:"Upload pictures from trip to Barbados"},{text:"Insurance before @4/25"},{text:"Buy bitcoins"},{text:"Taxes @april"},{text:"Pay rent"},{text:"Lunch with +Miller Harris @12:30"},{text:"Dinner date with +Emily Edwards @8pm"},{text:"Check the mail @today"},{text:"Ask +Jane Johnson who her dentist is"},{text:"Learn Japanese",priority:VMLIFlag.P0,items:[{text:"http://memrise.com"},{text:"Try the new iPhone app"}]}]},{text:"Grocery List:",isFlagged:!0,items:[{text:"Apples"},{text:"Carrots"},{text:"Yogurt"},{text:"Celery"},{text:"Eggs"},{text:"Almond Milk"}]},{text:"Games",items:[{text:"Amnesia"},{text:"XCOM"},{text:"Far Cry 3"}]},{text:"Chores",items:[{text:"Clean bathroom @wednesday"},{text:"Sweep floors @thursday"},{text:"Take out trash @thursday"},{text:"Check mail @soon"},{text:"Haircut @today 4:00pm"}]}]}]:11===e?[{text:"Home",items:[{text:"Title of a list"},{id:"itemIndent",text:"Something to do"}]}]:12===e?[{text:"Home",items:[{text:"Get a present for +Miller Harris"},{text:"Ask +Emily Edwards how she's doing"}]}]:13===e?[{text:"Home",items:[{text:"House work",items:[{id:"yard",text:"Get around to cleaning the yard"},{id:"roof",text:"Fix the hole in the roof"}]},{text:"Around Town",items:[{text:"Ask +Emily Edwards how she's doing"},{text:"Try that new restaurant I heard about"}]},{text:"Vacations",items:[{id:"vacation",text:"Plan next year's vacation"},{text:"+Jane Johnson said her trip to Japan was amazing"}]},{text:"Birthday party for +Miller Harris",items:[{id:"chips",text:"Buy chips before the party"},{id:"present",text:"Get a present for +Miller Harris"}]},{text:"Shopping",items:[{id:"shorts",text:"Shorts"},{text:"New Camera"},{id:"laptop",text:"Laptop for Dad",items:[{text:'15", touch screen, plus a mouse'},{text:"A hard case because he'll drop it a lot"}]}]},{text:"Reference",items:[{text:"New PIN number: 1234"}]},{text:"Massive lack of organization in my life",items:[{id:"app",text:"Check out this sweet app: http://www.moo.do"}]}]}]:14===e?[{text:"Home",items:[{text:"Todo List",items:[{text:"Check the mail @today #out"},{text:"Buy bitcoins. $900 is a great price!",isComplete:!0},{text:"Lunch with +Miller Harris @12:30"},{text:"Get a new drill from the hardware store #out"},{text:"Dinner date with +Emily Edwards @8pm"},{text:"Learn Japanese",priority:VMLIFlag.P2,items:[{text:"http://memrise.com"},{text:"Try the new iPhone app"}]},{text:"Go see that fancy new 3D movie"},{text:"Check out this sweet app: http://www.moo.do",priority:VMLIFlag.P0}]},{text:"Work Projects",items:[{text:"Write article about having solved cold fusion"},{text:"Fix the explosion problem everybody is complaining about",priority:VMLIFlag.P1},{text:"Get a computer for the new intern #out"},{text:"Hide the evidence",isComplete:!0},{text:"Email +Miller Harris re: new diagrams"}]},{text:"Japan trip",items:[{text:"Find the best cities to visit"},{text:"Book some hotels"},{text:"Get some Japanese candy I've been craving #out",priority:VMLIFlag.P2}]}]}]:15===e?[{text:"Home",items:[{text:"You have projects and todo lists"},{text:"Appointments to get to @Friday 4pm"},{text:"Important things to get done",priority:VMLIFlag.P0},{text:"Friends and family to talk to +Miller Harris"},{text:"Exciting places to visit online http://www.moo.do"},{text:"Complete things when you're done",isComplete:!0}]}]:16===e?[{text:"Home",items:[{text:"List titles automatically becomes bold",items:[{text:"When you indent text under it."},{text:"Your project hierarchy can be as deep",items:[{text:"As you want it to be."}]}]},{text:"To use dates or contacts, type @date or +contact",items:[{text:"Call +Jane Johnson @tomorrow"}]}]}]:17===e?[{text:"Home",items:[{text:"Dates can be specific @tomorrow 4:30pm"},{text:"Or they can be more vague @soon"},{text:"Mark as high priority",priority:VMLIFlag.P0},{text:"Highlight this to come back to it",isFlagged:!0}]}]:18===e?[{text:"Home",items:[{text:"Search for a #tag"},{text:"Show priority items",priority:VMLIFlag.P2},{text:"Or only the highest priority",priority:VMLIFlag.P0},{id:"searchItem",text:"Focus on a project",items:[{text:"To ignore other distractions"},{text:"Then you can search just within a list #tag"}]},{text:"See a list of things to talk to +Jane Johnson about"}]}]:void log("Invalid Data Index"):[{text:"Home",items:[{text:""}]}]
}}),define("data",["globals","util","gdata","db","demo","platform"],function(e,t,r,i,n,o){function a(){}function s(){log("Transaction Error: ",arguments)}function c(e){var t=g.getItem(e);if(t){var r=t.items;if(r)for(var i=0;i<r.length;++i)c(r[i]);g.dbDeleteItem(t.id)}}function d(e,t,r){e.save({items:e.getItemsArrayForSave()},SaveFlag.None),t.save({isArchived:r},SaveFlag.None)}function l(e,t){var r=e[t];return r?',"'+t+'":'+r:""}function u(e,t,r){var i="";t&&(i+=",");var n=g.getModel(e.id),o=String(n.getParsedText()).replace(/[\"]/g,function(e){return E[e]}),e=g.getItem(e.id),a=l(e,"dateCompleted"),s=l(e,"priority"),c=l(e,"isComplete"),d=l(e,"isFlagged"),h=l(e,"isArchived");if(i+='{"text": "'+o+'"'+a+s+c+d+h,e.items&&e.items.length>0){i+=',"items":[';for(var p=0;p<e.items.length;p++){var m=g.getItem(e.items[p]);(!m.isArchived||m.isArchived&&r)&&(i+=u(m,p>0))}i+="]"}return i+="}"}var h="ctcs",p="helpIntro",m="helpNormal",f={___info___:{count:0}},g={contacts:[],contactsByName:{},contactNames:f,pendingRemoteUpdates:{},itemsById:{},loadedItemCount:0,hasLocalData:!1,freezeUpdates:!1,dbi:void 0};REPORT_ACTIONS&&(g.reportData=function(r){if(!t.hasURLParam("nosync")){var i={};for(var n in g.itemsById)i[n]=g.itemsById[n].data;e.reportData(i,r)}});g.getModel=function(t){try{e.PAssert(989,t,"Tried to get a model that doesn't exist")}catch(r){e.reportError(r)}var i=g.itemsById[t];return i?i.model:void 0},g.setModel=function(t,r){try{e.PAssert(990,t,"Tried to set a model with an invalid id")}catch(i){e.reportError(i)}g.itemsById[t]?g.itemsById[t].model=r:g.itemsById[t]={model:r,data:void 0}},g.getItem=function(t){try{e.PAssert(991,t,"Tried to get an item that doesn't exist")}catch(r){e.reportError(r)}var i=g.itemsById[t];return i?i.data:void 0},g.setItem=function(t,r){try{e.PAssert(992,t,"Tried to set an item with an invalid id")}catch(i){e.reportError(i)}g.itemsById[t]?g.itemsById[t].data=r:g.itemsById[t]={model:void 0,data:r}},g.getRootItem=function(){return g.rootId?g.getItem(g.rootId):void 0},g.getRootModel=function(){return g.rootId?g.getModel(g.rootId):void 0},g.initializeIndexedDB=function(t){function r(r){r?i.open({server:"duchess",version:n,schema:{items:{key:{keyPath:"id"}},settings:{}}}).done(function(e){g.dbi=e,t()}).fail(function(r){log("Error loading local DB client",r),e.preventLocalWrites(),e.reportError(r),t()}):(log("Shim failed to init."),e.preventLocalWrites(),t())}var n=1;void 0!==window.indexedDB.onIsReady&&null!==window.indexedDB.onIsReady?window.indexedDB.onIsReady(r):setTimeout(function(){r(!0)},0)},g.migrateLocalData_One=function(){for(var e in g.itemsById){var t=!1,r={},i=g.getItem(e);if(i){var n=i.text;n.startsWith("!")?(r.priority=VMLIFlag.P0,r.text=n.substr(1),t=!0):n.startsWith("*")?(r.isFlagged=!0,r.text=n.substr(1),t=!0):n.startsWith("^")&&(r.isComplete=!0,r.text=n.substr(1),t=!0),t&&g.dbUpdateItem({id:e,changes:r,saveFlags:SaveFlag.None})}}},g.migrateLocalData_Two=function(){if(0===g.contacts.length)return void log("Skipping local data migration two");for(var t in g.itemsById){var r=!1,i={},n=g.getItem(t);if(n&&n.text.indexOf("@")>=0)for(var o=n.text.split(" "),a=0,s=0;s<o.length;++s){if(0===o[s].indexOf("@")){for(var c=void 0,d=o[s].substring(1),l=1;4>l;l++){var u=-1!==d.indexOf(":",d.length-1)?d.substr(0,d.length-1):d;if(g.contactsByName[u]&&(c=u),!(s+l<o.length))break;d+=" "+o[s+l]}if(c){try{e.PAssert(993,"@"==n.text[a],"Explicitly matching @, should always match")}catch(h){e.reportError(h)}var p=n.text.substr(0,a)+"+"+n.text.substr(a+1);i.text=p,r=!0;var m=g.getModel(t);m&&(m.setRawText(p),m.parseText(!0))}}a+=o[s].length+1}r&&g.dbUpdateItem({id:t,changes:i,saveFlags:SaveFlag.None})}};var v=!1;g.localDataLoaded=function(){return v},g.loadFromIndexedDB=function(t){try{e.PAssert(994,!v,"Should never load local data twice")}catch(r){e.reportError(r)}g.itemsById={},e.shouldWriteLocal()&&g.dbi&&g.dbi.items?g.dbi.items.query().all().execute().done(function(r){g.loadedItemCount=r.length;for(var i=0;i<r.length;++i)g.setItem(r[i].id,e.translateObjOut(r[i]));v=!0,g.dbi.settings?g.dbi.settings.get("root").done(function(r){if(!e.criticalErrorReported()){if(r){try{e.PAssert(995,g.getItem(r.root),"If there is a root item defined there should be a corresponding local item")}catch(i){e.reportError(i)}g.rootId=r.root}log("Root Item: ",g.rootId),t&&t()}}).fail(t):(log("Unable to load local settings DB"),t&&t())}):(log("Unable to load local items DB"),v=!0,e.preventLocalWrites(),t&&t())};var y=void 0;g.beginTransaction=function(){e.shouldWriteLocal()&&(y={})},g.transactionUpdate=function(t,r){try{e.PAssert(996,e.shouldWriteLocal(),"Should never be writing during a transaction if local writes are disabled")}catch(i){e.reportError(i)}if(y[t])for(var n in r)y[t][n]=r[n];else y[t]=r},g.endTransaction=function(){e.shouldWriteLocal()&&g.dbi&&g.dbi.items?g.dbi.items.updateObject(y).done(a).fail(s):void 0!==y&&e.reportError(new Error("Started a transaction and stopped writes halfway through")),y=void 0},g.dbUpdateItem=function(t){if(!g.freezeUpdates){g.hasLocalData||e.isLoadingRemote||t.skipLocalModification||(g.hasLocalData=!0);var r=t.changes||{},i=t.id?t.id:r.id,n=t.callback,o=t.saveFlags;try{e.PAssert(997,o===SaveFlag.None||o===SaveFlag.Prop||o===SaveFlag.Text||o===SaveFlag.All)}catch(a){e.reportError(a)}var s=g.getItem(i);if(e.shouldWriteLocal()){var c;try{e.PAssert(998,!o||void 0===r.modifiedOffline&&void 0===r.modifiedOfflineText,"Shouldn't be setting a modified flag while passing them in with changes")}catch(a){e.reportError(a)}if(e.isFlagSet(o,SaveFlag.Prop)){try{e.PAssert(999,void 0===r.modifiedOffline,"Shouldnt be passing in a value and assigning true")}catch(a){e.reportError(a)}r.modifiedOffline=!0;var d=g.getModel(i);d&&(d.modifiedOffline=!0)}if(e.isFlagSet(o,SaveFlag.Text)){try{e.PAssert(1e3,void 0===r.modifiedOfflineText,"Shouldnt be passing in a value and assigning true")}catch(a){e.reportError(a)}r.modifiedOfflineText=!0;var d=g.getModel(i);d&&(d.modifiedOfflineText=!0)}if(s){for(var l in r)if(r.hasOwnProperty(l)){s[l]=r[l]}c=e.translateObjIn(s)}else{try{e.PAssert(1001,r.id,"Item being modified does not already exist as expected",r)}catch(a){e.reportError(a)}g.setItem(i,r),c=e.translateObjIn(r)}if(y){try{e.PAssert(1003,!n,"Callbacks not supported for updates inside of a transaction")}catch(a){e.reportError(a)}g.transactionUpdate(i,c)}else n?g.dbi.items.update(c).done(n).fail(n):g.dbi.items.update(c)}else{if(s)for(var l in r)r.hasOwnProperty(l)&&(s[l]=r[l]);else g.setItem(i,r);n&&n()}}},g.dbDeleteItem=function(t,r){g.freezeUpdates||(g.setItem(t,void 0),e.shouldWriteLocal()&&(r?g.dbi.items.remove(t).done(r).fail(r):g.dbi.items.remove(t)))},g.setRoot=function(t){return g.freezeUpdates?void 0:(e.shouldWriteLocal()&&g.dbi.settings.update({key:"root",item:{root:t}}),g.rootId=t,g.getRootItem())};var b=0,S={};g.loadDemoData=function(e,t){function r(e){e.id||(e.id="demo"+b++),g.setItem(e.id,e);var t=e.items;if(t){for(var i=[],n=0;n<t.length;++n)t[n].id||(t[n].id="demo"+b++),i.push(t[n].id),r(t[n]);e.items=i}}if(void 0===e&&(e=10),void 0!==e&&""!==e&&void 0!==S[e]){log("Use Preloaded demo data: ",e);var i=S[e];g.setRoot(i.id),t&&t(i.id)}else{var o;if(""===e)o=n()[0];else{var a=parseInt(e),s=n(a);s&&(o=s[0])}o&&(r(o),g.setRoot(o.id),S[e]=o,v=!0,t&&t(o.id))}};var T=!1;g.initData=function(r){if(T)return!1;T=!0;try{e.isDemoMode()?setTimeout(function(){var e=t.getURLParam("data");g.loadDemoData(e,r)},0):(e.checkpoint(Checkpoint.InitData),g.initializeIndexedDB(function(){g.loadFromIndexedDB(function(){e.checkpoint(Checkpoint.DBLoaded),g.checkLocalIntegrity(function(){g.loadLocalContacts(),r(),g.hasLocalData||o.offline||!navigator.onLine||e.vmMain.isLoadingDoc(!0)})})}))}catch(i){e.reportError(i)}return!0},g.initializeItem=function(t){var i=t.id,n=!i||e.isLocalItem(t)||!t.data;if(n){var o=r.createNewItem(t,t.hasChildren(),t.hasArchivedChildren());i&&i!==o&&g.modifyItemId(i,o);for(var a=!1,s=t.items(),c=0;c<s.length;++c)a|=g.initializeItem(s[c]);if(t.hasArchivedChildren())for(var d=t.archivedItems(!0),c=0;c<d.length;++c)a|=g.initializeItem(d[c]);if(r.initializeNewItem(t),i&&i!==o){var l=t.parent();l&&l.save(null,SaveFlag.None)}}return n},g.checkLocalIntegrity=function(t){var r=!1,i=!1;g.ensureLocalCache(function(){var n=!1,o={};for(var a in g.itemsById)if(g.itemsById.hasOwnProperty(a)&&g.getItem(a)){var s=g.getItem(a);(s.i||s.t)&&(log("%cInvalid local properties on item: ","color: red",s),r=!0),o[s.id]?o[s.id].exist?(log(s.id,": Duplicated IDs in the local database",s),r=!0):(o[s.id].exist=!0,o[s.id].del=!!s.isDeleted):o[s.id]={exist:!0,ref:!1,del:!!s.isDeleted},s.id==g.rootId&&(n&&(log(s.id,": Multiple roots present locally",s),r=!0),n=!0,o[s.id].isRoot=!0),void 0==s.text&&(log("Found item with no text",s.id),s.text="",g.dbUpdateItem({id:a,changes:{text:""},saveFlags:SaveFlag.None}));for(var d=void 0,l=0;s.items&&l<s.items.length;++l)if(s.items[l]){var u=s.items[l],h=g.getItem(u);if(h?(h.isArchived&&(d=u),d&&!h.isArchived&&(log(u,": Unarchived child found after an archived one"),log("   ",s.id,": Parent with incorrectly ordered children"),r=!0)):(log(u,": Child does not have a valid reference on our local database"),r=!0),o[u])if(o[u].ref){log(u,": Item is referenced locally multiple times: ",h?g.getItem(u).id:"UNDEFINED"),log("   ",o[u].ref,": ",g.getItem(o[u].ref).id),log("   ",s.id,": <CLIENTDATA>"),r=!0;var p=s.items;p.removeAt(l),g.dbUpdateItem({id:a,changes:{items:p},saveFlags:SaveFlag.None})}else o[u].ref=s.id;else o[u]={exist:!1,ref:s.id}}else log(s.id,": Invalid item in local items array"),r=!0}n||(log("No root present"),r=!0);for(var m in o){var f=o[m];if(!f.exist){log(m,": Item is referenced locally as a child but does not exist in the database");var s=g.getItem(f.ref);try{e.PAssert(1004,s,"Parent of item must exist")}catch(v){e.reportError(v)}if(s){var p=s.items;p?p.remove(m):p=[],g.dbUpdateItem({id:s.id,changes:{items:p},saveFlags:SaveFlag.None})}}if(f.ref||f.isRoot||f.del||(log(m,": Item exists locally but is not referenced by a parent"),c(m)),f.ref&&f.del){log(m,": Item is referenced locally by a parent but has been deleted");var s=g.getItem(f.ref);try{e.PAssert(1005,s)}catch(v){e.reportError(v)}var p=s.items;p?p.remove(m):p=[],g.dbUpdateItem({id:s.id,changes:{items:p},saveFlags:SaveFlag.None})}if(f.isRoot&&f.ref&&(log(m,": Local root has a parent"),r=!0),f.del&&!f.ref){var s=g.getItem(m);e.isLocalItem(s)&&(log("Deleting Unreferenced Local Item: ",m),g.dbDeleteItem(m))}}t({error:r,local:i})})},g.removeDeletedItems=function(e){for(var t in g.itemsById){var r=g.getItem(t);r&&r.isDeleted&&(e[t]||(log("Deleting Removed Local Item: ",t),g.dbDeleteItem(t)))}},g.clearData=function(t,r){g.freezeUpdates=!0,setTimeout(function(){function i(){g.clearContacts(),g.clearHelp(),e.settings.resetAll(r),t&&t()}function n(){g.dbi.items&&g.dbi.items.clear().done(function(){i()}).fail(function(){log("Failed to reset items!",arguments),i()})}return e.pageDataCleared(),g.dbi?void(g.dbi.settings&&g.dbi.settings.clear().done(function(){n()}).fail(function(){log("Failed to reset settings!",arguments),n()})):void g.initializeIndexedDB(function(){g.clearData(t,r)})},0)},g.contactComparator=function(e,t){return e.text.localeCompare(t.text)},g.sortContacts=function(){g.contacts.sort(g.contactComparator)},g.addContact=function(t,r){try{e.PAssert(1006,t.id,"Incoming contacts must have a valid id")}catch(i){e.reportError(i)}try{e.PAssert(1007,t.text,"All contacts are expected to have a text")}catch(i){e.reportError(i)}r?g.contacts.insertSorted(t,g.contactComparator):g.contacts.push(t),t.text&&(g.contactNames[t.text]="",g.contactsByName[t.text]=t),g.contactNames.___info___.count=g.contacts.length},g.updateContact=function(t){try{e.PAssert(1008,t.id,"Incoming contacts must have a valid id")}catch(r){e.reportError(r)}try{e.PAssert(1009,t.text,"All contacts are expected to have a text")}catch(r){e.reportError(r)}for(var i=!1,n=0;n<g.contacts.length;++n)if(g.contacts[n].id===t.id){g.contacts[n]=t,i=!0;break}return i?void 0:(g.addContact(t),!0)};var x=!1;g.clearLocalContacts=function(){if(x=!1,e.shouldWriteLocal())try{t.storage.setItem(h,"[]")}catch(r){e.reportError(r)}g.contacts=[],e.settings.set(Settings.lastContactSync,void 0)},g.loadLocalContacts=function(){if(!x&&(x=!0,e.shouldWriteLocal()))try{g.loadContacts(JSON.parse(t.storage.getItem(h)),!1)}catch(r){e.reportError(r)}},g.loadContacts=function(t,r){try{e.PAssert(1010,0===g.contacts.length,"Should only load contacts once")}catch(i){e.reportError(i)}if(g.contacts=t,g.contacts){for(var n=!1,o=0;o<g.contacts.length;o++){var a=g.contacts[o];if(a.name&&(a.text=a.name,g.contacts[o].text=a.name,delete g.contacts[o].name,n=!0),!r&&a.isDemo||a.text&&!a.phoneNumbers&&!a.emails)g.contacts.removeAt(o--),n=!0;else{a.text&&(g.contactNames[a.text]="",g.contactsByName[a.text]=a);try{e.PAssert(1011,a.id,"Each contact must have a valid id")}catch(i){e.reportError(i)}}}n&&g.saveContacts(),g.contactNames.___info___.count=g.contacts.length}else g.contacts=[],g.contactsByName={},g.contactNames=f;log("Contacts Loaded: ",g.numContacts())},g.saveContacts=function(){e.shouldWriteLocal()&&t.storage.setItem(h,JSON.stringify(g.contacts))},g.clearContacts=function(){e.settings.set(Settings.syncContacts,!1),e.settings.reset(Settings.lastContactSync),e.shouldWriteLocal()&&t.storage.removeItem(h,void 0)},g.clearHelp=function(){e.shouldWriteLocal()&&(t.storage.removeItem(p,void 0),t.storage.removeItem(m,void 0))},g.contactRelevanceComparator=function(e,t){return e.index!=t.index?e.index<t.index?-1:1:e.object.text.localeCompare(t.object.text)},g.findContactsLike=function(e){for(var t=e.toLowerCase(),r=[],i=50,n=0;n<g.contacts.length;++n){var o=g.contacts[n].text.toLowerCase().indexOf(t);if(o>=0&&(r.push({index:o,object:g.contacts[n]}),r.length>i))break}return r.sort(g.contactRelevanceComparator),r},g.findContactsExact=function(e){return g.contactsByName[e]},g.findContactByEmail=function(e){for(var t=0;t<g.contacts.length;++t){var r=g.contacts[t];if(r.emails)for(var i=0;i<r.emails.length;++i)if(r.emails[i].address==e)return r}},g.getContacts=function(){return g.contactNames},g.numContacts=function(){try{e.PAssert(1012,g.contacts.length===g.contactNames.___info___.count,"Contact names count should match contacts value")}catch(t){e.reportError(t)}return g.contacts.length},g.areLocalContactsLoaded=function(){return x},g.insertItems=function(t,i,n){try{e.PAssert(1013,t,"Must pass in a valid item")}catch(o){e.reportError(o)}try{e.PAssert(1014,void 0===n||n>=0,"Must pass in a valid index")}catch(o){e.reportError(o)}t.save({items:t.getItemsArrayForSave()},SaveFlag.Prop),1===i.length?r.itemAdded({item:t,addedItem:i[0],index:n,isArchived:!1}):r.itemsAdded({item:t,addedItems:i,index:n,isArchived:!1})},g.removeItem=function(t,i,n,o){try{e.PAssert(1015,t,"Must pass in a valid item")}catch(a){e.reportError(a)}try{e.PAssert(1016,void 0===i||i>=0,"Must pass in a valid index")}catch(a){e.reportError(a)}t.save({items:t.getItemsArrayForSave()},SaveFlag.Prop),n&&n.data&&r.itemRemoved({item:t,index:i,numToRemove:1,isArchived:o})},g.moveItem=function(t){var i=t.item,n=t.newInfo,o=t.oldParent,a=t.oldInfo,s=t.isRemoteChange,c=t.noVersion,d=s?SaveFlag.None:SaveFlag.Prop;try{e.PAssert(1017,void 0!==i&&void 0!==n&&void 0!==o&&void 0!==a,"moveItem is missing parameters")}catch(l){e.reportError(l)}o.save({items:o.getItemsArrayForSave()},d),i.parent().save({items:i.parent().getItemsArrayForSave()},d),a.isArchived!==n.isArchived&&(i.isArchived(n.isArchived),i.save({isArchived:n.isArchived},d)),s||(g.saveChanges(i,{},d),r.itemMoved({item:i,newInfo:n,oldParent:o,oldInfo:a,noVersion:c}))},g.archiveItem=function(t,i,n){try{e.PAssert(1018,i>=0,"Must have a valid index to remove from")}catch(o){e.reportError(o)}d(t,n,!0),n.data&&r.itemArchived(t,n,i)},g.unarchiveItem=function(t,i,n){try{e.PAssert(1019,i>=0,"Must have a valid index to remove from")}catch(o){e.reportError(o)}d(t,n,!1),n.data&&r.itemUnarchived(t,n,i,t.items().length-1)},g.modifyItemId=function(t,r,i){var n=g.getItem(t),o=g.getModel(t);if(n.id=r,o.id=r,g.pendingRemoteUpdates[t]&&(g.pendingRemoteUpdates[t]=void 0,g.pendingRemoteUpdates[r]=!0),n.version=-1,n.versionText=-1,"root"===t)for(var a=n.items.length-1;a>=0;a--){var s=g.getItem(n.items[a]);if(e.isLocalItem(s)&&!s.modifiedOffline&&!s.modifiedOfflineText){n.items.removeAt(a);try{e.PAssert(1020,o.items()[a].id===s.id,"Item arrays should match")}catch(c){e.reportError(c)}o.items().removeAt(a)}}g.itemsById[r]={data:n,model:g.itemsById[t].model},g.dbDeleteItem(t),g.dbUpdateItem({changes:n,callback:i,skipLocalModification:!0,saveFlags:SaveFlag.None}),g.itemsById[t]=void 0,delete g.itemsById[t]},g.deleteItem=function(t){try{e.PAssert(1021,!t.isDeleted,"Should never try to delete an item that has already been deleted")}catch(r){e.reportError(r)}var i=g.getItem(t.id);if(i)t.isDeleted=!0,g.dbUpdateItem({id:t.id,changes:{isDeleted:!0},saveFlags:SaveFlag.Prop});else try{e.PAssert(1022,"Expected local item, didnt find one",t.id)}catch(r){e.reportError(r)}},g.undeleteItem=function(t){var r=g.getItem(t.id);if(r)t.isDeleted=!1,g.dbUpdateItem({id:t.id,changes:{isDeleted:void 0},saveFlags:SaveFlag.Prop});else try{e.PAssert(1023,"Expected local item, didnt find one",t.id)}catch(i){e.reportError(i)}},g.saveChanges=function(t,r,i){if(t)r||(r={}),g.dbUpdateItem({id:t.id,changes:r,saveFlags:i});else{log("Incoming item to save has no item!",t,r);try{e.PAssert(1024,!1,"Incoming item to save has no item!")}catch(n){e.reportError(n)}}},g.addPendingUpdate=function(t){try{e.PAssert(1025,t,"Invalid ID")}catch(r){e.reportError(r)}try{e.PAssert(1026,e.isString(t),"Must provide a valid id string")}catch(r){e.reportError(r)}g.pendingRemoteUpdates[t]||(g.pendingRemoteUpdates[t]=!0)},g.clearPendingUpdates=function(){for(var t in g.pendingRemoteUpdates){try{e.PAssert(1027,g.pendingRemoteUpdates.hasOwnProperty(t))}catch(i){e.reportError(i)}var n=g.getModel(t),o=g.getItem(t);if(o&&o.isDeleted)g.dbDeleteItem(t);else if(n&&n.data){var a={modifiedOffline:!1,modifiedOfflineText:!1};n.modifiedOffline=!1,n.modifiedOfflineText=!1;var s=r.getVersion(n.data,VersionType.Structure),c=r.getVersion(n.data,VersionType.Text);s!=n.getVersion(VersionType.Structure)&&(a.version=s,n.setVersion(VersionType.Structure,s)),c!=n.getVersion(VersionType.Text)&&(a.versionText=c,n.setVersion(VersionType.Text,c)),g.dbUpdateItem({id:t,changes:a,saveFlags:SaveFlag.None})}}g.pendingRemoteUpdates={},g.printIndexedDB("id","text","version","versionText","modifiedOffline","isArchived")};var w={"&":"&amp;",'"':"&quot;","<":"&lt;",">":"&gt;"},E={'"':'\\"'};return g.toHtml=function(e,t){var r="<ul>";if(e.items)for(var i=0;i<e.items.length;i++){var n=g.getItem(e.items[i]),o=g.getModel(n.id),a=String(o.getParsedText()).replace(/[&\"<>]/g,function(e){return w[e]});(!n.isArchived||n.isArchived&&t)&&(r+="<li>"+a,n.items&&n.items.length>0&&(r+=g.toHtml(n)),r+="</li>")}return r+="</ul>"},g.toPlainText=function(e,t,r){isNaN(t)&&(t=0);var i="";if(e.items)for(var n=0;n<e.items.length;n++){var o=g.getItem(e.items[n]),a=g.getModel(o.id);if(!o.isArchived||o.isArchived&&r){for(var s=0;t>s;s++)i+="	";i+=a.getParsedText()+"\n",o.items&&o.items.length>0&&(i+=g.toPlainText(o,t+1))}}return i},g.toJSON=function(t,r,i){var n=u(t,r,i);return'{"moodoVer":'+e.settings.get(Settings.localDataVersion)+',"moodoRoot":'+n+"}"},g.ensureLocalCache=function(t){var r=g.getRootItem();if(r)g.loadedItemCount>2&&(g.hasLocalData=!0),t();else{{var i=g.hasLocalData;e.generateTempId()}g.dbUpdateItem({changes:{id:"root",text:"Home",items:[]},skipLocalModification:!0,saveFlags:SaveFlag.None,callback:function(){g.setRoot("root"),g.hasLocalData=i,t()}})}},g.printIndexedDB=function(){},g}),define("goog",["ko","data","globals","util","gdata","platform"],function(e,t,r,i,n,o){function a(){var e=void 0;try{var t=gapi.auth.getToken();t&&(e=t.access_token)}catch(r){w.recoverFromError(r)}return e}function s(){r.messageQueue.pushMessage({text:"There was an internal error in Google Drive, refresh to try again in a couple minutes.",type:MessageType.Error,action:MessageAction.Reload}),r.vmMain.setGDriveStatus(DriveStatus.Offline)}function c(e){r.vmMain.setGDriveStatus(DriveStatus.Connecting),gapi.client.load("drive","v2",function(){if(!gapi.client.drive)return void s();var t="(title='"+w.LEGACY_DefaultDriveDocTitle+"' or properties has {key='"+w.DefaultProperty+"' and value='"+w.DefaultPropertyValue+"' and visibility='PRIVATE'}) and 'me' in owners and trashed=false";gapi.client.drive.files.list({fields:P,q:t}).execute(function(t){t&&t.items?e(t.items[0],!1):t&&200!==t.code&&t.error?s():d(e)})})}function d(e){gapi.client.load("drive","v2",function(){gapi.client.drive.files.insert({resource:{mimeType:w.REALTIME_MIMETYPE,title:w.DefaultDocTitle,writersCanShare:!1,properties:[{key:w.DefaultProperty,value:w.DefaultPropertyValue,visibility:"PRIVATE"}]}}).execute(function(t){if(200!==t.code&&t.error)s();else{var n=i.getURLParam("file");if(n)try{try{r.PAssert(1050,gapi.drive,"gapi.drive should exist")}catch(o){r.reportError(o)}i.removeURLParam("file"),gapi.drive.realtime.load(n,h,u,p)}catch(a){r.reportError(a)}else e(t,!0)}})})}function l(e){if(log("First Run Drive Document"),u(e),w.authenticatedUserEmail())r.sendEvent("Subscribe","NewUser"),r.reportSignup(w.authenticatedUserEmail());else var t=w.authenticatedUserEmail.subscribe(function(){t.dispose(),t=void 0,r.sendEvent("Subscribe","NewUser"),r.reportSignup(w.authenticatedUserEmail())})}function u(e){if(log("Drive Document Initialized"),n.onInitialized(e),w.authenticatedUserEmail())r.sendEvent("Documents","CreateNew");else var t=w.authenticatedUserEmail.subscribe(function(){t.dispose(),t=void 0,r.sendEvent("Documents","CreateNew")})}function h(e){r.vmMain.setGDriveStatus(DriveStatus.Saved);var t=n.onLoad(e);t&&(n.onRemoteSettingsLoad(),w.startWatchdog())}function p(e){switch(ShouldLog(LogLevels.Error)&&log("Doc Load Error - ",JSON.stringify(e)),e.type){case gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED:try{r.PAssert(1051,!e.isFatal,"Token refresh required causes a non-fatal error")}catch(i){r.reportError(i)}w.recoverFromError();break;case gapi.drive.realtime.ErrorType.INVALID_COMPOUND_OPERATION:try{r.PAssert(1052,e.isFatal,"Invalid compound operation causes a fatal error")}catch(i){r.reportError(i)}ShouldLog(LogLevels.Error)&&log("RealtimeAPI Error: ["+e.type+"] Fatal: "+e.isFatal);break;case gapi.drive.realtime.ErrorType.CONCURRENT_CREATION:case gapi.drive.realtime.ErrorType.CLIENT_ERROR:ShouldLog(LogLevels.Error)&&log("RealtimeAPI Error: ["+e.type+"] Fatal: "+e.isFatal),w.clearDocInfo(),f();break;case gapi.drive.realtime.ErrorType.FORBIDDEN:case gapi.drive.realtime.ErrorType.NOT_FOUND:ShouldLog(LogLevels.Error)&&log("Unable to access or find the requested document"),r.reportError(new Error("DocError Forbidden/NotFound: "+JSON.stringify(e))),t.clearData(function(){r.reload()});break;case gapi.drive.realtime.ErrorType.SERVER_ERROR:try{r.PAssert(1053,e.isFatal,"Server errors are always fatal")}catch(i){r.reportError(i)}r.vmMain.setGDriveStatus(DriveStatus.Offline);break;default:ShouldLog(LogLevels.Error)&&log("Unkown Doc Error - ",JSON.stringify(e))}e.isFatal&&n.close(e)}function m(e){var t=w.getDocId();if(t)try{var r=e?l:u;gapi.drive.realtime.load(t,h,r,p)}catch(i){w.recoverFromError(i)}else f()}function f(){c(function(e,t){e&&e.id?(w.setDocInfo(e.id,e.title),m(t)):r.reportError(new Error("We should always find a valid document with a defined id")),t&&r.fireCustomEvent("firstRun")})}function g(){for(var e=[],t=0;t<I.length;++t){var i=w.scopes.indexOf(I[t]),n=C.indexOf(I[t])>=0;i>=0&&!n&&e.push(i)}var o=JSON.stringify(e);r.settings.set(Settings.authScopes,o)}function v(e){e>0&&r.vmMain.runParseWorkerNewContacts()}function y(e){return parseInt(e.id.split("_")[1])}function b(t,i){if(t&&!t.error){try{r.PAssert(1055,t.scope,"Scopes must be valid")}catch(o){r.reportError(o)}r.isString(t.scope)&&(t.scope=t.scope.split(" "));var a=I,s=e.utils.arrayGetDistinctValues(t.scope);I=s,(a.length!==s.length||a!==s)&&g();var c=1e3*(parseInt(t.expires_in)-600);log("Token expires in",c/1e3),O=Date.now()+c,clearTimeout(L),L=setTimeout(function(){S()},c),_=E,n.poke(),setTimeout(function(){for(var e=document.getElementsByTagName("iframe"),t=0;t<e.length;++t)if(e[t].src.startsWith("https://accounts.google.com/o/oauth2/auth?"))if(""===e[t].id)e[t].id="auth_"+F++;else{var r=y(e[t]);r!==F&&r!==F-1&&e[t].parentElement.removeChild(e[t])}},0)}else log("Error authorizing token"+(t?t.error:""));i&&i(t)}function S(e){if(!gapi||!gapi.auth||!gapi.auth.authorize)return e(void 0),!1;try{r.PAssert(1057,I.length>=w.requiredScopes.length,"We lost some required scopes somewhere...")}catch(t){r.reportError(t)}R=!0;var i=w.authenticatedUserEmail()||r.settings.get("activeUser"),n={client_id:w.CLIENT_ID,scope:I,immediate:!0,user_id:i};return gapi.auth.authorize(n,function(t){V=!0,R=!1,b(t,e)}),!0}function T(){if(w.isRealtimeAPILoaded())q=!1;else{var e=document.getElementById("gapiScript");e&&e.parentNode.removeChild(e),r.addScript("https://apis.google.com/js/client.js?onload=GoogleApiLoaded","gapiScript",function(){q=!1}),U-->0?setTimeout(T,B):q=!1}}function x(){V?(r.vmMain.setGDriveStatus(DriveStatus.Saved),r.messageQueue.clearMessage(MessageID.ConnectionError)):(S(),setTimeout(x,B))}var w={CLIENT_ID:"597847337936.apps.googleusercontent.com",exportID:void 0,calendars:e.observable({}),eventSubscribers:[],authenticatedUserEmail:e.observable(void 0),gapiLoaded:!1};r.goog=w;var E=1e4,M=16e4;w.APP_ID="597847337936",w.REALTIME_MIMETYPE="application/vnd.google-apps.drive-sdk",window.GScope={Calendar:"https://www.googleapis.com/auth/calendar",CalendarRO:"https://www.googleapis.com/auth/calendar.readonly",Contacts:"https://www.google.com/m8/feeds",Drive:"https://www.googleapis.com/auth/drive.file",UserInfoEmail:"https://www.googleapis.com/auth/userinfo.email",DriveFull:"https://www.googleapis.com/auth/drive",TasksRO:"https://www.googleapis.com/auth/tasks.readonly",UserInfoProfile:"https://www.googleapis.com/auth/userinfo.profile",DriveInstall:"https://www.googleapis.com/auth/drive.install",DriveAppData:"https://www.googleapis.com/auth/drive.appdata"};var C=[GScope.TasksRO];w.LEGACY_DefaultDriveDocTitle="DuchessBeta",w.DefaultDocTitle="Moo.do Personal Document",w.DefaultProperty="MooDoDefault",w.DefaultPropertyValue="TRUE",w.requiredScopes=[GScope.Drive,GScope.UserInfoEmail,GScope.DriveInstall],w.requestScopes=[],w.scopes=[GScope.Calendar,GScope.CalendarRO,GScope.Contacts,GScope.Drive,GScope.UserInfoEmail,GScope.DriveFull,GScope.UserInfoProfile,GScope.DriveInstall,GScope.DriveAppData];var I=[],P="items(id,title)";w.isLoaded=!1,w.init=function(){var t=r.settings.get(Settings.authScopes);if(t){var n;try{n=JSON.parse(t)}catch(a){r.reportError(a)}if(n){for(var s=0;s<n.length;++s){try{r.PAssert(1036,n[s]>=0,"Each saved scope should be a valid array index")}catch(c){r.reportError(c)}n[s]>=0&&w.requestScopes.push(w.scopes[n[s]])}w.requestScopes=e.utils.arrayGetDistinctValues(w.requestScopes)}}else w.requestScopes=w.requiredScopes;I=w.requestScopes,o.syncContacts&&i.getURLParam("access_token")&&!i.hasURLParam("error")&&(I.indexOf(GScope.Contacts)<0&&(I.push(GScope.Contacts),g()),r.settings.set(Settings.syncContacts,!0));var d=w.authenticatedUserEmail.subscribe(function(e){void 0!==e&&(window.ga&&ga("set","&uid",r.getAnonUserIdentifier()),d.dispose(),d=void 0)})},w.ensureRequiredScopesAreRequested=function(){for(var e=!1,t=0;t<w.requiredScopes.length;++t)if(I.indexOf(w.requiredScopes[t])<0){e=!0;break}e&&w.runAuthenticate(w.requiredScopes,!0,!1,function(e){(!e||e.error)&&r.messageQueue.pushMessage({text:"We need additional permissions to give you the best experience, "+o.actionVerb()+" here to authenticate.",type:MessageType.Warning,action:function(){w.runAuthenticate(w.requiredScopes,!1,!1,function(e){(!e||e.error)&&r.messageQueue.pushMessage({text:"There was an error authenticating, "+o.actionVerb()+" here to try again.",type:MessageType.Error,action:w.ensureRequiredScopesAreRequested})})}})})};var A=96e4,k=void 0;w.startWatchdog=function(){k||(k=setInterval(w.watchdogFn,A))},w.stopWatchdog=function(){clearInterval(k),k=void 0};var D=0;w.watchdogFn=function(){var e=Date.now();if(D-e>=A){try{var t=gapi.auth.getToken();if(t){var i=1e3*parseInt(t.expires_at);e>i?(ShouldLog(LogLevels.Error)&&log("Active token is no longer valid: "+e+" vs. "+i),S(),r.reportError(new Error("Watchdog found expired token on client"))):n.poke()}else ShouldLog(LogLevels.Error)&&log("No active token on client!"),S(),r.reportError(new Error("Watchdog found client with no token set"))}catch(o){r.reportError(o)}finally{D=e}r.checkForRemoteChanges()}},w.hasPermission=function(e){return I.indexOf(e)>-1};var L=void 0,O=void 0,R=!0;w.onFocusHandler=function(){O&&Date.now()>O&&S()},w.onBlurHandler=function(){L&&clearTimeout(L)},w.getAccessToken=function(){var e=a();return e||w.recoverFromError(),e},w.getContactInfo=function(e,i){function n(e){if(200!==e.status)i();else{var t=JSON.parse(e.responseText);try{r.settings.set(Settings.lastContactSync,new Date(t.feed.updated.$t))}catch(n){r.reportError(n)}i(t)}}var o=w.getAccessToken();if(!o)return void i(void 0);var a=void 0,s="https://www.google.com/m8/feeds/contacts/default/full?v=3.0&alt=json";e?s+='&q="'+e+'"':a=r.settings.get(Settings.lastContactSync);var c=t.areLocalContactsLoaded()&&0===t.numContacts();if(a&&!c){var d=new Date(a);s+="&updated-min="+d.toString("yyyy-MM-ddTHH:mm:ss")}s+="&max-results=10000",s+="&access_token="+o,r.XHR({type:"GET",url:s,cb:n})},w.loadedContacts=!1,w.loadContacts=function(e){if(!w.loadedContacts){w.loadedContacts=!0,t.loadLocalContacts();var i=t.numContacts();w.getContactInfo(void 0,function(n){if(!n)return void e(-1);log("Loading Remote Contacts!",parseInt(n.feed.openSearch$totalResults.$t));var o=0,a=!1;if(n&&n.feed&&n.feed.entry&&n.feed.entry.length){r.vmMain.notifyContactsUpdated(),o=n.feed.entry.length;for(var s=n.feed.entry,c=0;c<s.length;c++){var d=s[c],l={id:/\/([^\s\/]+$)/gi.exec(d.id.$t)[1],text:""};if(d.gd$name&&d.gd$name.gd$fullName){var u=d.gd$name.gd$fullName.$t;l.text=u,"'"==l.text[0]&&(l.text=l.text.substr(1))}if(d.gd$email){var h=d.gd$email;l.emails=h;for(var p=0;p<h.length;p++)delete l.emails[p].rel,!l.text&&l.emails[p].primary&&(l.text=l.emails[p].address);!l.text&&h.length>0&&(l.text=l.emails[0].address)}if(d.gd$phoneNumber){var m=d.gd$phoneNumber;l.phoneNumbers=[];for(var p=0;p<m.length;p++){var f={number:m[p].$t};f.type=m[p].rel?m[p].rel.replace("http://schemas.google.com/g/2005#",""):m[p].label,l.phoneNumbers.push(f)}}if(l.text){if(d.link)for(var g=d.link,p=0;p<g.length;p++)if(g[p].type.startsWith("image")&&void 0!==g[p].gd$etag){var v=g[p].href;l.avatar=v}0===i?(t.addContact(l,!1),a=!0):a=t.updateContact(l,!1)||a}}}o>0&&t.saveContacts(),a&&t.sortContacts(),e&&e(o)})}},w.setDocInfo=function(e,t){r.settings.set(Settings.gdocId,e),r.settings.set(Settings.gdocTitle,t)},w.getDocId=function(){return r.settings.get(Settings.gdocId)},w.clearDocInfo=function(){r.settings.reset(Settings.gdocId),r.settings.reset(Settings.gdocTitle)};var _=E;w.recoverFromError=function(e){e&&(ShouldLog(LogLevels.Error)&&log("GDrive Error: ",e),r.reportError(e)),r.vmMain.setGDriveStatus(DriveStatus.Connecting),S(function(e){if(!e||e.error){r.messageQueue.pushMessage(MessageID.ConnectionError),r.vmMain.setGDriveStatus(DriveStatus.Offline);var t="Unable to refresh authentication token - ",i=!0;e?(t+=e.error,"immediate_failed"===e.error&&(i=!1)):t+="No Token",i&&r.reportError(new Error(t)),M>_&&(setTimeout(w.recoverFromError,_),_*=2)}})},w.getActiveUser=function(e){if(w.getAccessToken())if(w.authenticatedUserEmail())e&&e(w.authenticatedUserEmail());else{var t="https://www.googleapis.com/oauth2/v2/userinfo?alt=json&access_token="+w.getAccessToken();r.XHR({type:"GET",url:t,cb:function(t){if(200===t.status){var r=JSON.parse(t.responseText);w.authenticatedUserEmail(r.email)}e&&e(w.authenticatedUserEmail())}})}else e&&e(w.authenticatedUserEmail())
};var N=!1;w.loadClientDefaultFile=function(){var e=!!r.vmMain,i=!!window.gapi&&!!window.gapi.drive&&!!window.gapi.drive.realtime;if(!N&&e&&i){var n=a();n&&r.getLoginState()==LoginState.LOGGED_IN&&(N=!0,r.vmMain.setGDriveStatus(DriveStatus.Connecting),w.getActiveUser(function(e){var i=r.settings.get(Settings.activeUser);i&&e&&e!==i?t.clearData(function(){r.reload()}):!i&&e&&r.settings.set(Settings.activeUser,e)}),m(),w.loadCalendarAndContacts())}},w.authAndLoadContacts=function(e){r.settings.get(Settings.syncContacts)&&(I.indexOf(GScope.Contacts)<0?w.runAuthenticate([GScope.Contacts],!0,!0,function(t){!t||t.error?(I.push(GScope.Contacts),g(),r.messageQueue.pushMessage({text:"Contact sync is enabled but permissions have been lost, "+o.verb()+" here to find it again.",type:MessageType.Error,action:w.authAndLoadContacts}),e&&e(!1)):w.loadContacts(function(t){v(t),e&&t>0&&e(!0)})}):w.loadContacts(function(t){v(t),e&&t>0&&e(!0)}))},w.authDocSharing=function(){},w.loadCalendarAndContacts=function(){window.gapi&&w.authAndLoadContacts()},w.checkTokenInHash=function(){var e=!1;if(i.hasURLParam("access_token"))try{var t=i.getURLParam("scope"),n={access_token:i.getURLParam("access_token"),expires_in:i.getURLParam("expires_in"),scope:t.split("+")};gapi.auth.setToken(n),e=!0,i.removeURLParam("access_token",!0),i.removeURLParam("expires_in",!0),i.removeURLParam("scope",!0),i.removeURLParam("token_type",!0)}catch(o){r.reportError(o)}return e},w.runAuthenticate=function(e,t,n,a){if(!window.gapi||!window.gapi.auth)return a&&a(),!1;w.gapiLoaded||(r.fireCustomEvent("gapiLoaded"),w.gapiLoaded=!0);var s=void 0;try{s=gapi.auth.getToken()}catch(c){r.reportError(c)}var d;if(s){if(d=s.scope,!r.isArray(d)&&(r.reportError(new Error("Scopes are not an array: "+d)),r.isString(d)))try{d=s.scope.split(" ")}catch(c){r.reportError(c)}for(var l=0,u=0;u<e.length;++u)s.scope.indexOf(e[u])<0&&(d.push(e[u]),l++);0===l&&(d=[])}else d=e;if(d.length>0){d.indexOf(GScope.DriveFull)>=0&&d.remove(GScope.Drive);var h=w.authenticatedUserEmail()||r.settings.get("activeUser"),p={client_id:w.CLIENT_ID,scope:d,immediate:t,user_id:h,authuser:t?0:-1};o.requireCustomRedirect&&!t&&(p.redirect_uri=o.customRedirectString,o.customRedirectState&&(d.indexOf(GScope.Contacts)>=0&&(o.customRedirectState.syncContacts=!0),p.state=JSON.stringify(o.customRedirectState))),R=!0;gapi.auth.authorize(p,function(e){R=!1,(!e||e.error)&&t&&n?w.runAuthenticate(d,!1,!1,a):(e&&!e.error&&(o.app||i.hasURLParam("login","true"))&&(r.vmSetup?r.vmSetup.setLoginState(LoginState.LOGGED_IN):r.setLoginState(LoginState.LOGGED_IN),w.loadClientDefaultFile()),b(e,a))})}else ShouldLog(LogLevels.Error)&&log("Authorization request with no scopes: ",d),a&&a(s);return!0};var F=0,V=!1;w.isDriveAPILoaded=function(){return window.gapi&&window.gapi.client&&window.gapi.client.drive},w.isRealtimeAPILoaded=function(){return window.gapi&&window.gapi.client&&window.gapi.drive&&window.gapi.drive.realtime};var B=1e4,U=0,q=!1;return w.goOnline=function(){return U=2,w.isRealtimeAPILoaded()?(V=!1,setTimeout(x,2e3),!0):(q||(q=!0,setTimeout(T,2e3)),!1)},w.init(),w}),define("android",["ko","globals","platform"],function(e,t,r){var i,n,o,a,s,c={},d=!1,l=!1;c.isEnabled=function(){return l},c.getCurrentVMLI=function(){return s},c.getCurrentSpan=function(){return s?s.getSpan():void 0},c.isTargetBox=function(e){return a===(e.target||e.srcElement)},c.getInputBox=function(){return a},c.getSelectionStart=function(){return a.selectionStart},c.getSelectionEnd=function(){return a.selectionEnd},c.setPaneRoot=function(e){function u(){try{t.PAssert(1060,s,"VMLI must be selected in order to enforce selection offset")}catch(e){t.reportError(e)}try{t.PAssert(1061,c.getBoxHasTextSpace(),"Editor must always be prefixed with TextSpace")}catch(e){t.reportError(e)}0===a.selectionStart&&(a.selectionStart=1)}if(void 0===e.rootElement)return void(l=!1);if(l=!0,e.rootElement!==i){i=e.rootElement,n=e.scrollElement,o=e.paneContent,a=document.createElement("textarea"),a.id="androidInput",a.style.visibility="hidden",i.appendChild(a),a.onfocus=function(e){t.dragging||t.isKeyboardOpen||t.keyboardToolbar.show()},a.onblur=function(e){e.relatedTarget&&"searchPhone"!==e.relatedTarget.id||(c.finishInput(),t.keyboardToolbar.hide())};var h,p;a.oninput=function(e){try{t.PAssert(1058,s,"VMLI must be selected in order to get input events")}catch(r){t.reportError(r)}if(s){var i=!c.getBoxHasTextSpace();if(i){h=h||require("edit"),p=p||require("tracker");try{t.PAssert(1059,h&&p,"Should always be defined")}catch(r){t.reportError(r)}p.beginAction(),h.handleBackspace(e,s.getSpan(),void 0),p.endAction()}}},r.ie||(a.ontouchend=function(){setTimeout(u,30)}),d=null!==a.selectionStart&&void 0!==a.selectionStart&&null!==a.selectionEnd&&void 0!==a.selectionEnd,log("---- Android Editing Enabled ----")}};var u=!1,h=!1;c.updateInput=function(e){try{t.PAssert(1062,c.isEnabled(),"Must be enabled to update input")}catch(r){t.reportError(r)}var i=window.getSelection(),n=void 0;if(i.rangeCount>0&&i.getRangeAt(0).startContainer.nodeType===Node.TEXT_NODE){var o=i.getRangeAt(0);n=t.getSelectOffsetsInSpan(e,e.getSpan(),o,!0)}var l=!1;h||(h=!0,l=!0,a.style.visibility="visible"),t.isKeyboardOpen||t.keyboardToolbar.show();var p=e!==s;(p||e&&e.isHeader()!==u)&&(s&&p&&c.finishInput(!0),s=e,u=e.isHeader(),c.updateInputText(e),c.updateInputBounds(e)),l&&a.focus(),void 0!==n&&d&&(a.selectionStart=n.start+1,a.selectionEnd=n.end+1)},c.updateInputText=function(e){if(e&&s&&e.id===s.id){var t=s.getParsedText();c.setBoxValue(t)}},c.insertText=function(e,t){var r=c.getBoxValue(),i=r.substr(0,e)+t+r.substr(e);c.setBoxValue(i),d&&(a.selectionStart=e+t.length+1,a.selectionEnd=e+t.length+1)},c.getInputText=function(){try{t.PAssert(1063,c.isEnabled(),"Must be enabled to get input")}catch(e){t.reportError(e)}try{t.PAssert(1064,s,"Android input must be active to get input text")}catch(e){t.reportError(e)}return s?c.getBoxValue():""};var p=0;return c.updateInputBounds=function(e){if(e&&s&&e.id===s.id){var r=e.getSpan(),i=r.getBoundingClientRect(),o=8,c=40,d=n.scrollTop;t.copyStyles(r,a,["paddingLeft","paddingTop","paddingRight","paddingBottom","width","height","fontSize","lineHeight"]),a.style.top=Math.ceil(i.top+d-c)+"px",a.style.marginLeft=o+"px",a.style.paddingLeft=parseInt(a.style.paddingLeft)-o+"px",p=a.scrollHeight}},c.checkAndroidBounds=function(){try{t.PAssert(1065,s,"When updating Android bounds we should always have a current VMLI")}catch(e){t.reportError(e)}var r=a.scrollHeight;if(r!==p){var i=c.getBoxValue();if(l=!1,s){s.getRawText()!==i&&s.setText(i,!0,!0);var n=window.getComputedStyle(s.getSpan());a.style.height=n?n.height:"16px"}l=!0,p=r}},c.flushInput=function(){var e=c.getBoxValue();s.getRawText()!==e&&s.setText(e,!0,!0)},c.finishInput=function(e){try{t.PAssert(1066,c.isEnabled(),"Must be enabled to finish input")}catch(r){t.reportError(r)}s&&(h&&!e&&(h=!1,a.style.visibility="hidden"),c.flushInput(),s=void 0)},c.getBoxHasTextSpace=function(){var e=a.value;if(0===e.length||e[0]!==TextSpace){try{t.PAssert(1067,e.indexOf(TextSpace)<0,"If TextSpace is not at the front of the editor, it shouldnt appear in the rest of the string")}catch(r){t.reportError(r)}return!1}return!0},c.getBoxValue=function(){var e=a.value,t=e.replace(TextSpace,"");return t},c.setBoxValue=function(e){e&&0!==e.length||(e=TextSpace);var t=e[0]===TextSpace?e:TextSpace+e;a.value=t},c.passKeypress=function(e){return s?e.normCode===KeyCode.Enter||e.synthetic?!0:!1:!1},c.passKeydown=function(e){return s?e.normCode===KeyCode.Tab||e.normCode===KeyCode.BackSpace||e.synthetic?!0:!1:!1},c}),define("VMLI_TapHandlers",["ko","globals","platform","android","tracker"],function(e,t,r,i){var n=18,o=36,a=void 0,s={dragStart:function(e){try{t.PAssert(1068,!r.mobile||!t.focusedPane.isTimeline(),"Should not be able to drag/drop on timeline on mobile")}catch(n){t.reportError(n)}try{t.PAssert(1069,t.startDrag,"Should always have a valid item to start dragging from")}catch(n){t.reportError(n)}t.clearSelection(),i.isEnabled()&&i.finishInput();var o=t.startDrag.getElement();t.startDrag=void 0;try{t.PAssert(1070,void 0===t.dragging,"Only one element may be dragged or dropped at a time")}catch(n){t.reportError(n)}try{t.PAssert(1071,void 0===t.draggingHidden,"Only one element may be dragged or dropped at a time")}catch(n){t.reportError(n)}try{t.PAssert(1072,!t.tempUL.hasChildNodes(),"TempUL should never have children when starting a drag")}catch(n){t.reportError(n)}t.draggingHidden=o,t.dragging=o.cloneNode(!0),t.tempUL.appendChild(t.dragging);var a=document.getElementById("container").scrollTop,s=e.eventY+a-(r.mobile?t.phoneMainY:0),c=t.width(o);t.dragStartInfo={x:e.eventX,y:e.eventY},t.tempUL.style.display="block",r.mobile||(t.tempUL.style.left=e.eventX-e.xFromTopLeft+"px"),t.tempUL.style.top=s-e.yFromTopLeft+"px",t.tempUL.style.width=c+"px",t.addClass(t.draggingHidden,"itemBeingDragged"),t.disableMouseMove=!0},dragMove:function(e){e.preventDefault();var i=r.mobile?0:e.eventX-t.dragStartInfo.x,n=e.eventY-t.dragStartInfo.y,o="translate3d("+i+"px, "+n+"px, 0)";t.tempUL.style[r.transform.style]=o;var s=document.elementFromPoint(e.eventX,e.eventY);a||(a={dropEffect:"move",item:this}),t.vmMain.handleDragOver({srcElement:s,dataTransfer:a,diffY:e.diffY,offsetY:e.eventY,preventDefault:t.emptyFn,stopPropagation:t.emptyFn,stopImmediatePropagation:t.emptyFn})},dragEnd:function(e){r.ios&&t.preventClick(),t.disableMouseMove=!1;var i=t.dragging,n=t.draggingHidden;t.dragging=void 0,t.draggingHidden=void 0,t.removeClass(n,"itemBeingDragged"),i.parentNode.removeChild(i),t.tempUL.style.display="none",a||(a={dropEffect:"move",item:this}),t.vmMain.handleDrop({srcElement:e.srcElement,dataTransfer:a,preventDefault:t.emptyFn,stopPropagation:t.emptyFn,stopImmediatePropagation:t.emptyFn}),a=void 0,r.ios&&t.preventClick(),t.disableMouseMove=!1},onStart:function(e){t.dragStartTimeout&&(clearTimeout(t.dragStartTimeout),t.dragStartTimeout=void 0),t.scrollAtTouchStart=t.focusedPane.getScrollOffset(),t.canRevealMenu=!0,t.isKeyboardOpen&&(t.revealTimeout=setTimeout(function(){t.canRevealMenu=!1},400)),!r.mobile||r.ie||"UL"===e.srcElement.tagName||t.isKeyboardOpen||t.focusedPane.isTimeline()?"SPAN"===e.srcElement.tagName&&e.offsetX<=n&&(t.clearSelection(),t.startDrag=this,e.preventDefault(),e.stopImmediatePropagation()):t.dragStartTimeout=setTimeout(function(){t.clearSelection(),t.startDrag=this,this.dragStart(e),this.dragMove(e)}.bind(this),500)},onMove:function(e){t.revealTimeout&&(clearTimeout(t.revealTimeout),t.revealTimeout=void 0),this.isItemMenuOpen?e.preventDefault():t.startDrag&&(!r.touch||Math.abs(e.distanceY)>t.ClickThreshold&&Math.abs(e.distanceX)<t.ClickThreshold)&&t.startDrag===this&&this.dragStart(e),t.dragging?this.dragMove(e):r.touch&&t.canRevealMenu&&!t.focusedPane.isTimeline()&&(t.revealingMenu||t.revealingRightMenu||e.distanceY<t.ClickThreshold&&Math.abs(e.diffX)>t.ClickThreshold)&&(t.revealingMenu||t.menus.revealGestureMenu(this,e),t.menus.updateRevealGestureMenu(e),e.preventDefault())},onClick:function(e){if(r.mobile&&t.phoneMenu.multiSelectMode())t.menus.multiSelect(this);else if("SPAN"===e.srcElement.tagName&&e.offsetX<=n)this.isComplete()||t.messageQueue.pushMessage({text:"You completed an item, click again to undo",type:MessageType.Info,timeout:3e3}),this.isComplete(!this.isComplete());else if("LI"===e.srcElement.tagName&&this.isCollapsed()&&e.offsetX>=t.focusedPane.getWidth()-o)this.toggleCollapsed();else if(t.hasClass(e.srcElement,"tag")&&!r.mobile){if(r.mac&&e.metaKey||!r.mac&&e.ctrlKey){var a=e.srcElement.textContent;e.shiftKey?t.focusedPane.vmSearch.setSearch(a):t.focusedPane.vmSearch.addToSearch(a)}}else if(t.hasClass(e.srcElement,"contact")){var s=t.getOffsetOfSubNode(this.getSpan(),e.srcElement);t.autocomplete.update({item:this,start:s+1}),t.autocomplete.show(this,e.srcElement),e.preventDefault(),r.ios&&t.preventClick()}else if("itemOptions"===e.startSrc.id)t.itemMenuOpenedOn==this&&(t.itemMenuOpenedOn=void 0);else if("A"===e.srcElement.tagName){if(r.mac&&e.metaKey||!r.mac&&e.ctrlKey){var s=t.offset(e.srcElement);open(e.srcElement.href,"link"+e.srcElement.href)}}else{if(t.autocomplete&&t.autocomplete.hide(),r.ios||r.android||r.mobileie){var c=document.activeElement,d=t.focusedPane.getScrollOffset(),l=Math.abs(d-t.scrollAtTouchStart)>0;if(t.isKeyboardOpen&&c&&"searchPhone"!=c.id||l||t.focusedPane.isTimeline())r.mobileie&&i.isEnabled()&&i.updateInput(this);else{var u=this;r.mobile&&this==t.focusedPane.item()&&(u=t.getLastVisibleItem(t.focusedPane.item()));try{t.PAssert(1073,u,"Click on item should not happen")}catch(h){t.reportError(h)}r.ios&&t.vmMain.setSelected([u]),t.openKeyboardOn(e,u.getSpan(),!0,function(){t.selectChildren(u,u.getParsedText().length,0)})}}else!r.mobile;if(t.focusedPane.isTimeline()&&t.hasClass(e.srcElement,"text")){for(var p=0;p<this.elements.length;++p){var m=(this.getSpan(p),t.vmMain.panes()[p]);m&&m.vmSearch.isVisible(this)&&t.scrollIntoView(this.getSpan(p),200)}this.highlight(),t.sendEvent("Menu","GoTo")}}},onDblClick:function(e){if(t.hasClass(e.srcElement,"text")&&r.mobile){try{t.PAssert(1074,t.phoneMenu,"Phone menu should always be available on mobile")}catch(i){t.reportError(i)}t.phoneMenu.toggleMode(),e.preventDefault();for(var n=0;n<this.elements.length;++n)t.scrollIntoView(this.getSpan(n),200);this.highlight(),t.sendEvent("PhoneMenu","GoTo")}},onEnd:function(e){t.dragStartTimeout&&(clearTimeout(t.dragStartTimeout),t.dragStartTimeout=void 0),t.startDrag=void 0,t.itemMenuOpenedOn==this&&t.menus.menuItemSelected(e.srcElement),(t.revealingMenu||t.phoneMenu&&t.phoneMenu.multiSelectMode())&&(e.preventDefault(),e.stopImmediatePropagation(),e.returnFalse=!0,r.ios&&t.preventClick()),t.revealingMenu&&t.menus.stopRevealGestureMenu(e);t.dragging&&this.dragEnd(e)},onRightClick:function(e){!e.stopPropagation||!e.preventDefault,t.menus.openItemMenu(this,e),e.preventDefault(),e.stopPropagation()},onAutocompleteTapped:function(e,r){var e=this.getParsedText().substr(0,r.index)+e+this.getParsedText().substr(r.index+r.length);this.setText(e,!0),t.selectChildren(this,r.index+e.length,0)}};return s}),this.document&&(window.helperWrapper=DuchessHelpersWrapper),this.helperLibLoaded||DuchessHelpersWrapper(this.DuchessHelpers=this.DuchessHelpers||{}),define("DuchessHelpers",function(){}),define("VMLI_Text",["ko","data","gdata","globals","tracker","android","DuchessHelpers"],function(e,t,r,i,n,o){var a={_runAndGetSaveData:function(e,t){var r=this.getMetaTextSaveData();this.setRawText(e),this.parseText(t);var i=this.getMetaTextSaveData(),n={};for(var o in i)r[o]!==i[o]&&(n[o]=i[o]);return n},setText:function(e,t,i){var n=this._runAndGetSaveData(e,t);n.text=e,r.saveChanges(this,n),n.dateText=this.dateText,this.save(n,SaveFlag.Text),t&&!i&&o.isEnabled()&&o.updateInputText(this)},parseText:function(e){var r=void 0;e&&(r=DuchessHelpers.parseText(this.getRawText(),this.getDateTime(),this.isLoaded,t.getContacts()),r.numContacts>0&&n.miscAction({type:TrackerType.Misc,misc:TrackerMisc.AddContact,data:[{itemID:this.id}]})),this.styleText(r,e)},styleText:function(e,t,r){try{i.PAssert(1075,!(!e&&t),"In a full parse, styleInfo should always be defined")}catch(n){i.reportError(n)}var o,a=!1;if(e){if(o=void 0!==e.styledText?e.styledText:void 0!==e.text?e.text:this.getRawText(),t&&this.setParsedText(e.parsedText),e.dates){0===e.dates.length&&this.date()&&this.date()&&(this.allDayDate=void 0,this.dateText=void 0,this.date(null),r&&(a=!0,r.date=void 0,r.dateText=void 0,r.allDayDate=void 0));for(var s=0;s<e.dates.length;s++){var c=e.dates[s];this.dateText!==c.text&&(this.dateText=c.text,r&&(a=!0,r.dateText=c.text)),c.date&&this.date()&&c.date==this.date()||(!!c.date^!!this.date()||this.date()&&c.date.getTime()!==this.date().getTime())&&(c.explicitTime&&(c.date._explicitTime=c.explicitTime),this.allDayDate=!c.date._explicitTime,this.date(c.date),r&&(a=!0,r.date=c.date,r.allDayDate=c.date._explicitTime))}}else this.date()&&t&&(this.dateText=void 0,this.allDayDate=void 0,this.date(null),r&&(a=!0,r.date=void 0,r.dateText=void 0,r.allDayDate=void 0));this.isStyled=e.hasStyle}else o=this.getRawText();return 0===o.length&&(o=TextSpace,t=!0),this.setStyledText(o),a},checkFormats:function(e,t,r){try{i.PAssert(1076,!1,"No formats")}catch(n){i.reportError(n)}return!1},toggleFormat:function(e,t){try{i.PAssert(1077,!1,"No formats")}catch(r){i.reportError(r)}return!1},clearFormats:function(){try{i.PAssert(1078,!1,"No formats")}catch(e){i.reportError(e)}return!1},areFormatsEqual:function(e,t){try{i.PAssert(1079,!1,"No formats")}catch(r){i.reportError(r)}return!0},setFormats:function(e,t){try{i.PAssert(1080,!1,"No formats")}catch(r){i.reportError(r)}return!1},appendFormats:function(e,t){try{i.PAssert(1081,!1,"No formats")}catch(r){i.reportError(r)}return!1},getFormatsAfter:function(e){try{i.PAssert(1082,!1,"No formats")}catch(t){i.reportError(t)}return!1},removeFormatsAfter:function(e){try{i.PAssert(1083,!1,"No formats")}catch(t){i.reportError(t)}return!1},transformFormats:function(e,t){try{i.PAssert(1084,!1,"No formats")}catch(r){i.reportError(r)}return!1},saveFormats:function(e){try{i.PAssert(1086,!1,"No formats")}catch(t){i.reportError(t)}return!1}};return a}),define("VMLI_Drive",["globals","data","gdata","tracker"],function(e,t,r,i){var n=function(n){function o(e){r.cacheItem(e),a(r.get(e,"items")),a(r.get(e,"archivedItems"))}function a(r){if(r)for(var i=0;i<r.length;++i){var n=r.get(i);try{e.PAssert(1088,n,"Item must exist to get it from the array")}catch(a){e.reportError(a)}if(n){var s=t.getModel(n.id);s?s.linkToGDrive(n):o(n)}else r.remove(i),i--}}return{linkToGDrive:function(t,i){try{e.PAssert(1089,t,"Must be passing in valid data")}catch(n){e.reportError(n)}this.data||(this.data=t,r.cacheItem(t),this.setRemoteVersion(VersionType.Structure,r.getVersion(t,VersionType.Structure)),this.setRemoteVersion(VersionType.Text,r.getVersion(t,VersionType.Text)),i&&(this.setVersion(VersionType.Structure,this.getRemoteVersion(VersionType.Structure)),this.setVersion(VersionType.Text,this.getRemoteVersion(VersionType.Text))),a(r.get(t,"items")),a(r.get(t,"archivedItems")))},resetModified:function(){var t;try{e.PAssert(1090,this.data,"Can only reset modified if remote data exists")}catch(r){e.reportError(r)}var i=!1,n={};if(!this.modifiedOffline&&this.isRemoteVersionNewer(VersionType.Structure)){var o=this.getRemoteVersion(VersionType.Structure);this.setVersion(VersionType.Structure,o),n.version=o,i=!0}else this.modifiedOffline&&(n.modifiedOffline=!1,i=!0);if(!this.modifiedOfflineText&&this.isRemoteVersionNewer(VersionType.Text)){var a=this.getRemoteVersion(VersionType.Text);this.setVersion(VersionType.Text,a),n.versionText=a,i=!0}else this.modifiedOfflineText&&(n.modifiedOfflineText=!1,i=!0);i&&this.save(n,SaveFlag.None),this.setRemoteVersion(VersionType.Structure,void 0),this.setRemoteVersion(VersionType.Text,void 0);var s=this.items();for(t=0;t<s.length;++t)s[t].resetModified();if(this.hasArchivedChildren()){var c=this.archivedItems(!0);for(t=0;t<c.length;++t)c[t].resetModified()}},initFromGDrive:function(t,i){try{e.PAssert(1093,t,"To initialize from gdrive a valid remote data object must be passed in")}catch(n){e.reportError(n)}if(!t)return void e.reportError(new Error("FATAL ERROR - No remote data for item"));this.data=t;var o=void 0===this.id||this.forceModifiedItems,a=o?void 0:{},s=!1;this.id=t.id;try{s=this.resolveText(a)||s,s=this.resolveMisc(a)||s,s&&(e.vmMain.addParseItem(this,!0),e.vmMain.addModifiedItem(this)),this.resolveItems(a,i)}catch(c){if(e.reportError(c),REPORT_ACTIONS)try{e.reportAction(RATAG.R,ResolveAction.Error,{msg:c.message,stacK:c.stack,item:this.getDebugData()})}catch(d){e.reportActionCrash(d)}}if(o){try{e.PAssert(1096,void 0===a,"If doing a full save, remoteChanges should always be undefined")}catch(n){e.reportError(n)}this.setVersion(VersionType.Structure,this.getRemoteVersion(VersionType.Structure)),this.setVersion(VersionType.Text,this.getRemoteVersion(VersionType.Text)),this.save(null,SaveFlag.None)}else e.isEmpty(a)||(a.isDeleted!==!0&&(a.isDeleted=void 0),this.save(a,SaveFlag.None));r.attachEventsToItem(this)},resolveText:function(t){var i=!1;if(this.modifiedOfflineText&&!this.forceModifiedItems)if(this.isLocalVersionNewer(VersionType.Text)){if(REPORT_ACTIONS)try{e.reportAction(RATAG.A,ResolveAction.SetRemoteText,{text:this.getParsedText(),item:this.getDebugData()})}catch(o){e.reportActionCrash(o)}r.saveChanges(this,{text:this.getParsedText()})}else{var a=r.get(this.data,"text");try{e.PAssert(1097,void 0!==a,"Every item should have text associated with it from gdrive")}catch(s){e.reportError(s)}var c=this.getRawText(),d=!1;if(c!==a&&(d=!0),d){var l=this.getIndex(),u=new n({text:this.getParsedText()},{parent:this.parent(),forceSave:!0});if(this.parent().insertItem(u,l+1),this.setText(a,!0),REPORT_ACTIONS)try{e.reportAction(RATAG.B,ResolveAction.DupeItem,{remoteText:a,localText:this.getParsedText(),prevItem:this.getDebugData(),newItem:u.getDebugData()})}catch(o){e.reportActionCrash(o)}t&&(t.text=this.getParsedText()),i=!0}else t&&(t.modifiedOfflineText=!1);t&&(t.versionText=this.getRemoteVersion(VersionType.Text))}else if(this.isRemoteVersionNewer(VersionType.Text)){var a=r.get(this.data,"text");try{e.PAssert(1098,void 0!==a,"Every item should have text associated with it from gdrive")}catch(s){e.reportError(s)}if(this.getRawText()!=a){if(REPORT_ACTIONS)try{e.reportAction(RATAG.C,ResolveAction.SetLocalText,{oldText:this.getRawText(),newText:a,item:this.getDebugData()})}catch(o){e.reportActionCrash(o)}this.setRawText(a),t&&(t.text=this.getRawText()),i=!0}t&&this.getVersion(VersionType.Text)!==this.getRemoteVersion(VersionType.Text)&&(t.versionText=this.getRemoteVersion(VersionType.Text))}return i},resolveMisc:function(t){var i=this.modifiedOfflineText&&this.isLocalVersionNewer(VersionType.Text),n=!1,o=!1;if(i||this.isRemoteVersionNewer(VersionType.Structure)||this.isRemoteVersionNewer(VersionType.Text)){var a={},s=r.get(this.data,"date");if(s||this.date()){this.date()&&this.date().getTime()===s||(i&&this.date()?(a.date=this.date().getTime(),o=!0):(this.date(new Date(s),!0),this.date()._explicitTime=!!this.allDayDate,t&&(t.date=this.date().getTime()),n=!0));var c=r.get(this.data,"allDayDate");c&&this.allDayDate!==c&&(i?(a.allDayDate=this.allDayDate,o=!0):(this.allDayDate=c,t&&(t.allDayDate=c)))}try{e.PAssert(1099,void 0===this.allDayDate||void 0!==this.date(),"Cannot have an alldaydate with no date specified")}catch(d){e.reportError(d)}var l=r.get(this.data,"dateCreated");if(!this.dateCreated||!l||this.dateCreated.getTime()!==l)if(i)a.dateCreated=this.dateCreated?this.dateCreated.getTime():void 0,o=!0;else{var u=l;try{e.PAssert(1100,"string"!=typeof l,"Invalid date format stored")}catch(d){e.reportError(d)}this.dateCreated=new Date(u),t&&(t.dateCreated=u)}var h=r.get(this.data,"dateCompleted");if(!(!h&&!this.dateCompleted||this.dateCompleted&&h&&this.dateCompleted.getTime()===h))if(i)a.dateCompleted=this.dateCompleted?this.dateCompleted.getTime():void 0,o=!0;else{var u=h;try{e.PAssert(1101,"string"!=typeof h,"Invalid date format stored")}catch(d){e.reportError(d)}this.dateCompleted=new Date(u),t&&(t.dateCompleted=u)}var p=r.get(this.data,"priority");(p||this.priority())&&this.priority()!==p&&(i?(a.priority=this.priority(),o=!0):(null===p&&(p=VMLIFlag.None),this.priority(p,!0)));var m=r.get(this.data,"isFlagged");(m||this.isFlagged())&&this.isFlagged()!==m&&(i?(a.isFlagged=this.isFlagged(),o=!0):(null===m&&(m=!1),this.isFlagged(m,!0)));var f=r.get(this.data,"isComplete");if((f||this.isComplete())&&this.isComplete()!==f&&(i?(a.isComplete=this.isComplete(),o=!0):(null===f&&(f=!1),this.isComplete(f,!0))),i){try{e.PAssert(1102,o===!e.isEmpty(a),"Verify modLocal is computed properly. It should track any changes to localChanges")}catch(d){e.reportError(d)}o===!0&&r.saveChanges(this,a)}}return n},resolveItemsHelper:function(i,o,a){var s,c,d,l,u,h,p,m=r.getItemList(this.data,i);p=i?this.hasArchivedChildren()?this.archivedItems(!0):[]:this.items();try{e.PAssert(1103,p,"Item arrays must exist")}catch(f){e.reportError(f)}for(s=0;m&&s<m.length;s++)if(c=m.get(s)){try{e.PAssert(1105,void 0===r.loadSeen[c.id]||r.loadSeen[c.id]===!1,"Items can only be seen once on the remote.")}catch(f){e.reportError(f)}r.loadSeen[c.id]=this.id;var d=this.getIndexOf(c.id,i);if(d>=0)u=p[d],u.initFromGDrive(c);else if(l=t.getItem(c.id),u=t.getModel(c.id),l)if(l.isDeleted){try{e.PAssert(1106,!u,"The local model should never exist when an item has been marked as deleted locally")}catch(f){e.reportError(f)}try{e.PAssert(1107,l.modifiedOffline,"How did it get deleted if it wasn't modified offline?")}catch(f){e.reportError(f)}if(r.getVersion(c,VersionType.Structure)==l.version){if(r.itemRemoved({item:this,index:s,numToRemove:1,isArchived:i}),REPORT_ACTIONS)try{e.reportAction(RATAG.E,ResolveAction.RemoveRemoteItem,{item:this.getChild(s).getDebugData(),parent:this.getDebugData(),index:s,isArchived:i})}catch(g){e.reportActionCrash(g)}s--}else{try{e.PAssert(1108,!u,"The local model should never exist when an item has been marked as deleted locally")}catch(f){e.reportError(f)}if(t.undeleteItem(l),u=new n({data:c,isArchived:i},{parent:this,parse:a,forceSave:!0}),p.splice(s,0,u),h=!0,REPORT_ACTIONS)try{e.reportAction(RATAG.F,ResolveAction.AddBackDeletedItem,{item:u.getDebugData(),parent:this.getDebugData(),index:s,isArchived:i})}catch(g){e.reportActionCrash(g)}e.vmMain.addModifiedItem(u)}}else if(u&&u.modifiedOffline)if(u.isLocalVersionNewer(VersionType.Structure)){if(REPORT_ACTIONS)try{e.reportAction(RATAG.G,ResolveAction.LocalMoveCandidate,{item:u.getDebugData(),parent:this.getDebugData(),index:s,isArchived:i})}catch(g){e.reportActionCrash(g)}try{e.PAssert(1109,r.loadSeen[c.id]===this.id)}catch(f){e.reportError(f)}r.loadSeen[c.id]=!1}else{if(REPORT_ACTIONS)try{e.reportAction(RATAG.H,ResolveAction.MoveLocalItem,{item:u.getDebugData(),oldParent:u.parent(),oldIndex:u.getIndex(),newParent:this.getDebugData(),newIndex:s,isArchived:i})}catch(g){e.reportActionCrash(g)}u.moveTo({parent:this,index:s,isRemoteChange:!0,shouldBeArchived:i}),u.initFromGDrive(c),h=!0,e.vmMain.addModifiedItem(u)}else if(u){if(REPORT_ACTIONS)try{e.reportAction(RATAG.I,ResolveAction.MoveLocalItem,{item:u.getDebugData(),oldParent:u.parent().getDebugData(),oldIndex:u.getIndex(),newParent:this.getDebugData(),newIndex:s,isArchived:i})}catch(g){e.reportActionCrash(g)}u.moveTo({parent:this,index:s,isRemoteChange:!0,shouldBeArchived:i}),u.initFromGDrive(c),h=!0,e.vmMain.addModifiedItem(u)}else{if(REPORT_ACTIONS)try{e.reportAction(RATAG.Q,ResolveAction.Error,{msg:"Local model does not exist for local item that was not deleted",item:u.getDebugData(),localIndex:s,data:l})}catch(g){e.reportActionCrash(g)}e.reportError(new Error("Local model does not exist for local item that was not deleted."))}else{if(u=new n({data:c,isArchived:i},{parent:this,parse:a}),p.splice(s,0,u),h=!0,REPORT_ACTIONS)try{e.reportAction(RATAG.D,ResolveAction.AddLocalItem,{item:u.getDebugData(),parent:this.getDebugData(),index:s,isArchived:i})}catch(g){e.reportActionCrash(g)}e.vmMain.addModifiedItem(u)}}else try{e.PAssert(1104,c,"Item in remote list does not exist")}catch(f){e.reportError(f)}if(t.hasLocalData){for(s=0;s<p.length;s++)if(u=p[s],r.loadSeen[u.id]!==this.id)if(c=u.data){if(u.modifiedOffline&&u.isLocalVersionNewer(VersionType.Structure)){var v=r.findInTree(c);try{e.PAssert(1116,v,"Item should be found in tree")}catch(f){e.reportError(f)}if(v){if(REPORT_ACTIONS)try{var y=t.getModel(v.parent.id);e.reportAction(RATAG.M,ResolveAction.MoveRemoteItem,{item:u.getDebugData(),oldParent:y?y.getDebugData():void 0,oldIndex:v.index,newParent:u.parent().getDebugData(),newIndex:s,isArchived:i})}catch(g){e.reportActionCrash(g)}r.itemMoved({item:u,newInfo:{index:s,isArchived:i},oldParent:v.parent,oldInfo:v})}else if(REPORT_ACTIONS)try{e.reportAction(RATAG.N,ResolveAction.Error,{msg:"Item not found in local tree",item:u.getDebugData(),localIndex:s,data:l})}catch(g){e.reportActionCrash(g)}u.initFromGDrive(c)}}else if(u.modifiedOfflineText){var b,S=[];if(i?u.hasArchivedChildren()&&(b=u.archivedItems(!0)):b=u.items(),b)for(var T=0;T<b.length;++T)if(b[T].data&&b[T].isLocalVersionNewer(VersionType.Structure)){var v=r.findInTree(b[T].data);try{e.PAssert(1111,v,"Item should be found in tree")}catch(f){e.reportError(f)}v&&S.push({parent:v.parent,child:b[T]})}if(t.initializeItem(u),r.itemAdded({item:this,addedItem:u,index:s,isArchived:i}),REPORT_ACTIONS)try{e.reportAction(RATAG.J,ResolveAction.AddRemoteItem,{item:u.getDebugData(),parent:this.getDebugData(),index:s,isArchived:i})}catch(g){e.reportActionCrash(g)}for(var T=0;T<S.length;++T){var x=S[T];try{e.PAssert(1112,x,"Must have valid data to remove")}catch(f){e.reportError(f)}var w=x.child.isArchived(),E=r.getItemList(x.parent,w);try{e.PAssert(1113,E,"The item has children, it must have a list")}catch(f){e.reportError(f)}var M=E.indexOf(x.child.data);try{e.PAssert(1114,M>=0,"Remote item must be in the parents list")}catch(f){e.reportError(f)}if(r.itemRemoved({item:x.parent,index:M,numToRemove:1,isArchived:w}),REPORT_ACTIONS)try{e.reportAction(RATAG.K,ResolveAction.RemoveRemoteItem,{item:x.child.getDebugData(),parent:t.getModel(x.parent.id).getDebugData(),index:M,isArchived:w})}catch(g){e.reportActionCrash(g)}}u.initFromGDrive(u.data)}else{if(REPORT_ACTIONS)try{e.reportAction(RATAG.L,ResolveAction.DeleteLocalItem,{item:u.getDebugData(),parent:this.getDebugData(),index:u.getIndex(),isArchived:i})}catch(g){e.reportActionCrash(g)}try{e.PAssert(1115,t.getItem(u.id),"Trying to delete an item locally that doesn't exist locally")}catch(f){e.reportError(f)}this.deleteChild(u),s--,h=!0,e.vmMain.addModifiedItem(u)}if(!i&&m&&(m.length>0||p.length>0)){var C=[],I=void 0,P=[],A=m.asArray(),k=!1;for(s=0;s<A.length;++s){var D=A[s].id,L=t.getModel(D);try{e.PAssert(1117,L,"If the remote ID exists the local item should have been created.")}catch(f){e.reportError(f)}var d=this.getIndexOf(D);L&&L.modifiedOffline&&L.isLocalVersionNewer(VersionType.Structure)?d>=0?C.push(d):(I||(I=[]),log(this.id+": Item in remote array not found in local array: ",D),I.push(D)):d>=0?(P.push(D),d!==s&&(k=!0)):(I||(I=[]),log(this.id+": Item in remote array not found in local array: ",D),I.push(D))}if(k||C.length>0){for(C.sort(),s=0;s<C.length;s++){var l=p[C[s]];l&&P.splice(C[s],0,l.id)}I&&I.length>0&&(P=P.concat(I));for(s=0;s<P.length;++s)for(var O=P[s],T=s;T<m.length;++T){var R=m.get(T);if(O===R.id){if(s!==T){var _=t.getModel(R.id);if(REPORT_ACTIONS)try{e.reportAction(RATAG.O,ResolveAction.MoveRemoteItem,{item:_.getDebugData(),oldParent:this.getDebugData(),oldIndex:T,newParent:_.parent().getDebugData(),newIndex:s,isArchived:!1})}catch(g){e.reportActionCrash(g)}var N={index:T,isArchived:!1},F={index:s,isArchived:!1};r.itemMoved({item:_,newInfo:F,oldParent:this,oldInfo:N}),h=!0,e.vmMain.addModifiedItem(_)}break}}for(s=0;s<P.length;++s)for(var O=P[s],T=s;T<p.length;++T){var R=p[T];if(O===R.id){if(s!==T){if(REPORT_ACTIONS)try{e.reportAction(RATAG.P,ResolveAction.MoveLocalItem,{item:R.getDebugData(),oldParent:R.parent().getDebugData(),oldIndex:R.getIndex(),newParent:this.getDebugData(),newIndex:s,isArchived:!1})}catch(g){e.reportActionCrash(g)}R.moveTo({parent:this,index:s,isRemoteChange:!0,shouldBeArchived:!1}),h=!0,e.vmMain.addModifiedItem(R)}break}}}}}if(h){if(t.hasLocalData&&(i?this.hasArchivedChildren()&&this.archivedItems().valueHasMutated():this.items.valueHasMutated()),i&&!this.hasArchivedChildren()){try{e.PAssert(1122,p.length>0,"If saving an archive array it should have data in it")}catch(f){e.reportError(f)}this.archivedItems()(p)}o&&(o.items=this.getItemsArrayForSave())}},resolveItems:function(e,t){this.resolveItemsHelper(!1,e,t),this.resolveItemsHelper(!0,e,t)},onValueChanged:function(t){if(!t.isLocal||i.undoRedoActive){var n=e.translateFieldOut(t.property);if(this.id===t.target.id)switch(n){case"version":case"versionText":var o=r.get(this.data,n);
if(o>this[n]||void 0===this[n]){var a={modifiedOffline:!1};a[n]=this[n]=o,this.save(a,SaveFlag.None)}break;case"formats":var s=JSON.parse(JSON.stringify(r.get(this.data,"formats")));s||(s=[]),this.setFormats(s,!0);break;case"priority":this.priority(t.newValue,!0);break;case"isComplete":this.isComplete(t.newValue,!0);break;case"isFlagged":this.isFlagged(t.newValue,!0);break;case"dateCompleted":this.dateCompleted=new Date(t.newValue),this.save({dateCompleted:t.newValue},SaveFlag.None);break;case"isArchived":this.isArchived(t.newValue),this.save({isArchived:t.newValue},SaveFlag.None);break;case"date":this.date(new Date(t.newValue)),this.save({date:t.newValue},SaveFlag.None);break;case"allDayDate":this.allDayDate=t.newValue,this.save({allDayDate:t.newValue},SaveFlag.None);break;case"items":case"archivedItems":var c=!("items"===n);if(t.newValue){for(var d=0;d<t.newValue.length;++d)this.addRemoteItem(t.newValue.get(d),d,c);r.attachEventsToItem(this)}else{try{e.PAssert(1124,0===t.oldValue.length,"Expected no items in list")}catch(l){e.reportError(l)}this.removeAllRemoteItems(c)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None);break;case"dateCreated":break;case"text":this.onTextChanged(t);break;default:ShouldLog(LogLevels.Error)&&log("Unhandled value changed remotely: ",n,t)}}},onTextChanged:function(t){if(!t.isLocal||i.undoRedoActive){var n=r.get(this.data,"text");if(n!=this.getRawText()&&(this.setRawText(n),this.parseText(!0),this.save({text:this.getRawText()},SaveFlag.None),i.undoRedoActive)){var o=TrackerType.SetText;i.notifyStateChangedFromUndoRedo(o,{itemID:this.id,position:e.findFirstDiff(t.newValue,t.oldValue),text:t.newValue})}}},addRemoteItem:function(o,a,s){var c=o.id;r.cacheItem(o);var d=s?this.archivedItems():this.items;if(!(a<d().length&&d()[a].id===c)){var l=t.getModel(c);l?(clearTimeout(l.deleteTimeout),l.deleteTimeout=void 0):l=new n({data:o},{parent:this,parse:!0}),l.isDeleted&&(l.isDeleted=!1,l.save(null,SaveFlag.None)),l.isArchived()!==s&&(l.isArchived(s),l.save({isArchived:s},SaveFlag.None)),l.parent(this),d.splice(a,0,l),e.fireCustomEvent("itemAdded",{item:l,force:!0}),e.timeline.notifyStateChanged(l),i.undoRedoActive&&i.notifyStateChangedFromUndoRedo(TrackerType.Create,{itemID:l.id,parent:this.id,position:a,text:r.get(o,"text")})}},removeAllRemoteItems:function(e){e?this.hasArchivedChildren()&&this.archivedItems()([]):this.items([])},removeRemoteItem:function(t,r,n,o){var a;if(n){try{e.PAssert(1125,this.hasArchivedChildren(),"Must have a valid item list to remove from")}catch(s){e.reportError(s)}a=this.archivedItems()}else a=this.items;var c=a()[r];if(c&&c.id===t.id){try{e.PAssert(1126,c,"Expect a valid local item to remove")}catch(s){e.reportError(s)}try{e.PAssert(1127,t.id==c.id,"Remote item should match local items")}catch(s){e.reportError(s)}i.undoRedoActive&&i.notifyStateChangedFromUndoRedo(TrackerType.Delete,{itemID:c.id,parent:this.id,position:r,previous:e.getPreviousItem(c).id}),a.splice(r,1),c.deleteTimeout=o?setTimeout(c.deleteFromServer.bind(c),2e3):setTimeout(c.markDeleted.bind(c),2e3)}},onListAdded:function(t){if(!t.isLocal||i.undoRedoActive){var n=!1,o=r.get(this.data,"items");if(!o||t.target.id!==o.id){var a=r.get(this.data,"archivedItems");(a&&t.target.id===a.id||!o)&&(n=!0)}var s,c,d;t.values.length>0?(c=t.index,d=c+t.values.length,s=function(e){return t.values[e]}):(c=0,d=t.target.length,s=function(e){return t.target.get(e)});for(var l=c;d>l;++l){var u=l-c,h=s(u);try{e.PAssert(1128,h,"Always expect a valid item at each index")}catch(p){e.reportError(p)}this.addRemoteItem(h,l,n)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None)}},onListRemoved:function(t){if(!t.isLocal||i.undoRedoActive){var n,o=!1,a=r.get(this.data,"items");if(!a||t.target.id!==a.id){var s=r.get(this.data,"archivedItems");s&&t.target.id===s.id&&(o=!0)}for(var c=t.index,d=c+t.values.length,l=d-1;l>=c;l--){var u=l-c;try{e.PAssert(1130,!!t.values[u],"Always expect a valid item at each index")}catch(h){e.reportError(h)}var n=t.values[u],p=t.isLocal&&i.undoRedoActive;this.removeRemoteItem(n,l,o,p)}this.save({items:this.getItemsArrayForSave()},SaveFlag.None)}},onListSet:function(t){try{e.PAssert(1131,!1,"What? This shouldn't happen!",t)}catch(r){e.reportError(r)}},onObjectChanged:function(t){if(t.ocHandled)return!1;if(t.ocHandled=this.id,t.stopPropagation(),t.isLocal&&!i.undoRedoActive)return!1;for(var r=0;r<t.events.length;++r)switch(t.events[r].type){case gapi.drive.realtime.EventType.TEXT_DELETED:this.onTextChanged(t.events[r]);break;case gapi.drive.realtime.EventType.TEXT_INSERTED:this.onTextChanged(t.events[r]);break;case gapi.drive.realtime.EventType.VALUES_ADDED:this.onListAdded(t.events[r]);break;case gapi.drive.realtime.EventType.VALUES_REMOVED:this.onListRemoved(t.events[r]);break;case gapi.drive.realtime.EventType.VALUE_CHANGED:this.onValueChanged(t.events[r]);break;case gapi.drive.realtime.EventType.VALUES_SET:try{e.PAssert(1132,!1,"VALUES_SET should never be triggered")}catch(n){e.reportError(n)}break;default:try{e.PAssert(1133,!1,"Unexpected event type")}catch(n){e.reportError(n)}}return!1},deleteFromServer:function(){t.dbDeleteItem(this.id)},markDeleted:function(){t.deleteItem(this),e.timeline.notifyStateChanged(this)}}};return n}),define("sounds",["globals","platform"],function(e){function t(e,t){var r=document.createElement("source");r.src=t,e.appendChild(r)}var r={},i={};return r.add=function(e){if(r[e]=e,!i[e]){var n=document.createElement("audio");t(n,"sounds/"+e+".mp3"),n.preload="auto",i[e]=n}},r.play=function(t){if(!e.settings.get(Settings.noSounds)){if(!i[t])return log("Tried to play a sound that has not been loaded:",t),void console.trace();try{i[t].play()}catch(r){log("Failed to play audio",r)}}},r}),define("VMLI",["ko","globals","platform","data","gdata","VMLI_TapHandlers","VMLI_Text","VMLI_Drive","tracker","sounds"],function(e,t,r,i,n,o,a,s,c){function d(r,n){if(!r.id&&r.data&&r.data.id)r.id=r.data.id;else if(r.id&&r.data)try{t.PAssert(1134,r.id==r.data.id,"If passing in a local id and a remote ID, they should match")}catch(o){t.reportError(o)}if(r.id&&i.getModel[r.id]){ShouldLog(LogLevels.Warning)&&log("Attempting to create an already created VMLI: ",r.id);try{t.PAssert(1135,!1,"Should not be constructing a VMLI here")}catch(o){t.reportError(o)}return i.getModel[r.id]}try{t.PAssert(1136,void 0===r.v,"We should never be passing in 'v'")}catch(o){t.reportError(o)}try{t.PAssert(1137,void 0===r.extern,"We should never be passing in 'extern'")}catch(o){t.reportError(o)}this._parent=n?n.parent:void 0,this._rawText=r.data?"":r.text,this._searchText=r.data?"":r.text?r.text.toLowerCase():"",this._parsedText=void 0,this._styledText=e.observable(""),this._isArchived=r.isArchived||!1,this.items=e.observableArray(),this._archivedItems=void 0,this._date=e.observable(void 0);var a=VMLIFlag.None;r.isCollapsed&&(a|=VMLIFlag.Collapsed),r.isComplete&&(a|=VMLIFlag.Complete),r.isFlagged&&(a|=VMLIFlag.Flagged),r.priority&&(a|=r.priority),this._flags=e.observable(a),this.styleLength=0,this.dateText=r.dateText,this.allDayDate=void 0,this.dateCreated=r.dateCreated?new Date(r.dateCreated):new Date,this.dateCompleted=r.dateCompleted?new Date(r.dateCompleted):void 0,this.elements=[],this.outlineElements=[],this.isLoaded=!1,this.isDeleted=r.isDeleted||!1,this.isStyled=!1,this.modifiedOffline=void 0,this.modifiedOfflineText=void 0,this.deleteTimeout=void 0,this.highlightTimeout=void 0,this.data=void 0,this._version=-1,this._versionText=-1,this._versionRemote=void 0,this._versionRemoteText=void 0,this.levelsDeep=e.observable(this._parent?this._parent.levelsDeep()+1:0),__TOTAL_ITEMS++,r.isArchived&&__TOTAL_ARCHIVED_ITEMS++,this._needsParse=!1,this.init(r,n)}return window.__TOTAL_ITEMS=0,window.__TOTAL_ARCHIVED_ITEMS=0,window.__TOTAL_ARCHIVE_PARENTS=0,d.prototype={_getLineStyle:function(){return this._flags()&t.LSMask},_getPriority:function(){return this._flags()&t.PMask},stylePadding:function(e){var i,n;if(e){i=r.phone?15:24;var o=e.$parents[e.$parents.length-2];try{t.PAssert(1138,o&&o.item.peek(),"Invalid pane")}catch(a){t.reportError(a)}var s=o.item.peek().levelsDeep.peek();n=this.levelsDeep()-s-1}else i=r.phone?40:25,n=this.levelsDeep()-1;return i+20*n+"px"},_updateStylePadding:function(e,r){try{t.PAssert(1139,this._parent,"Must have a valid parent to update padding, root should never change")}catch(i){t.reportError(i)}var n=e+1,o=this.levelsDeep.peek()!==n;if(o||r){o?this.levelsDeep(n):this.levelsDeep.valueHasMutated();for(var a=this.items.peek(),s=0;s<a.length;++s)a[s]._updateStylePadding(n,r)}},styleProps:function(){var e=this._flags(),r=e&VMLIFlag.Header?"pHeader ":"";return e&VMLIFlag.Collapsed&&(r+="collapsed "),e&VMLIFlag.Selected&&(r+="selected "),e&VMLIFlag.Highlighted&&(r+="highlight "),e&VMLIFlag.NumList&&(r+="pNumList "),this.isArchived()&&(r+="archived "),r+=e&VMLIFlag.Complete?"pComplete ":e&t.PMask?t.priorityMapOut[e&t.PMask]+" ":"pNormal ",e&VMLIFlag.Flagged&&(r+="pStar "),r},copyProperties:function(e){this.isFlagged(e.isFlagged()),this.isComplete(e.isComplete()),this.priority(e.priority())},parent:function(){if(1===arguments.length){try{t.PAssert(1140,arguments[0]instanceof d||void 0===arguments[0],"Parent must be a VMLI")}catch(e){t.reportError(e)}this._parent=arguments[0],void 0!==arguments[0]&&this._updateStylePadding(this._parent.levelsDeep(),!1)}return this._parent},archivedItems:function(t){return this._archivedItems||(this._archivedItems=e.observableArray(),window.__TOTAL_ARCHIVE_PARENTS++),t?this._archivedItems():this._archivedItems},hasArchivedChildren:function(){return void 0!==this._archivedItems?this._archivedItems().length>0:!1},headers:function(){for(var e=[],t=this.items(),r=0;r<t.length;++r)t[r].isHeader()&&e.push(t[r]);return e},isArchived:function(){if(1===arguments.length){var e=this._isArchived;this._isArchived=arguments[0],arguments[0]!==e&&t.timeline.notifyStateChanged(this,PropChangeType.Archive)}return this._isArchived},getRawText:function(){return this._rawText},getParsedText:function(){try{t.PAssert(1141,this._needsParse===!1,"Text should be parsed before calling get")}catch(e){t.reportError(e)}return this._parsedText?this._parsedText:this._rawText},getStyledText:function(){return this._styledText()},getSearchText:function(){try{t.PAssert(1143,void 0!==this._searchText,"Item should always have search text")}catch(e){t.reportError(e)}return this._searchText},setRawText:function(e){(void 0===e||null===e)&&(e=""),this._rawText=e,e&&(this._searchText=e.toLowerCase()),this._parsedText=void 0,this._needsParse=!0},setParsedText:function(e){this._parsedText===e||void 0===e;this._parsedText=e,e&&(this._searchText=e.toLowerCase()),this._needsParse=!1},setStyledText:function(e){this._styledText(e)},priority:function(e,r){if(void 0===e)return this._getPriority();try{t.PAssert(1146,t.priorityMapOut[e],"Priority must be defined in globals")}catch(i){t.reportError(i)}var o=this._getPriority();if(e!==o){var a=this._flags()&~t.PCMask|e;if(this._flags(a),this.isLoaded){var s={priority:e};r||(n.saveChanges(this,s),s=t.clone(s));var d=r?SaveFlag.None:SaveFlag.Text;this.save(s,d),t.timeline.notifyStateChanged(this,PropChangeType.Priority|PropChangeType.Complete),c.performAction(TrackerType.Update,{itemID:this.id,field:"priority",newValue:e,oldValue:o})}}},date:function(e,r){return void 0!==e&&e!==this._date()&&(null===e&&(e=void 0),this._date(e),t.timeline.notifyStateChanged(this,PropChangeType.Date),this.isLoaded&&!r&&c.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ChangeDate,data:[{itemID:this.id,date:e}]})),this._date()},_isFlagHelper:function(e,t){if(void 0!==t){var r=t?this._flags()|e:this._flags()&~e;return void this._flags(r)}return!!(this._flags()&e)},isImportant:function(){return this._getPriority()},isComplete:function(e,r){if(void 0===e)return this._isFlagHelper(VMLIFlag.Complete);var i={isComplete:e};if(e!==this._isFlagHelper(VMLIFlag.Complete)&&(this._isFlagHelper(VMLIFlag.Complete,e),this.isLoaded)){e?(this.dateCompleted||(this.dateCompleted=new Date,i.dateCompleted=this.getDateCompletedTime()),t.vmMain.isLoaded&&t.aggregateEvent("ItemCompleted")):(this.dateCompleted=void 0,i.dateCompleted=void 0),r||(n.saveChanges(this,i),i=t.clone(i));var o=r?SaveFlag.None:SaveFlag.Text;this.save(i,o),t.timeline.notifyStateChanged(this,PropChangeType.Complete),c.performAction(TrackerType.Update,{itemID:this.id,field:"isComplete",newValue:e,oldValue:!e})}},isFlagged:function(e,r){if(void 0===e)return this._isFlagHelper(VMLIFlag.Flagged);if(e!==this._isFlagHelper(VMLIFlag.Flagged)){var i=e?this._flags()&~VMLIFlag.Complete:this._flags(),o=e?i|VMLIFlag.Flagged:i&~VMLIFlag.Flagged;if(this._flags(o),this.isLoaded){var a={isFlagged:e};r||(n.saveChanges(this,a),a=t.clone(a));var s=r?SaveFlag.None:SaveFlag.Text;this.save(a,s),t.timeline.notifyStateChanged(this,PropChangeType.Flagged|PropChangeType.Complete)}c.performAction(TrackerType.Update,{itemID:this.id,field:"isFlagged",newValue:e,oldValue:!e})}},isHeader:function(){try{t.PAssert(1147,0===arguments.length,"Shouldnt be passing arguemtns to isHeader")}catch(e){t.reportError(e)}var r=this.items().length>0,i=this._flags();if(!!(i&VMLIFlag.Header)!==r){var n=r?i|VMLIFlag.Header:i&~VMLIFlag.Header;this._flags(n),this._parent&&this._parent.isFullscreen()&&this._updateStylePadding(this._parent.levelsDeep(),!0)}return r},isCollapsed:function(e){return this._isFlagHelper(VMLIFlag.Collapsed,e)},isSelected:function(e){return r.mobile?this._isFlagHelper(VMLIFlag.Selected,e):!1},isHighlighted:function(e){return this._isFlagHelper(VMLIFlag.Highlighted,e)},isNumList:function(e){return this._isFlagHelper(VMLIFlag.NumList,e)},hasCompletedAncestor:function(){for(var e=this.parent();e;){if(e.isComplete())return!0;e=e.parent()}},hasTime:function(){return this.date()?"12:00am"!==this.date().toString("h:mmtt"):this.dateCompleted},time:function(){return this.date()?"12:00am"==this.date().toString("h:mmtt")?"Any Time":this.date().toString("h:mm tt"):this.dateCompleted?this.dateCompleted.toString("h:mmtt"):""},createDateString:function(e){return e.toString(e.isBefore(Date.today().addWeeks(1))?"dddd h:mm tt":"MM/dd h:mm tt")},fullTime:function(){var e=this.date();return e?void this.createDateString(e):""},setVersion:function(e,r){switch(e){case VersionType.Structure:this._version=r;break;case VersionType.Text:this._versionText=r;break;default:try{t.PAssert(1148,!1,"Invalid version type")}catch(i){t.reportError(i)}}},getVersion:function(e){var r;switch(e){case VersionType.Structure:r=this._version;break;case VersionType.Text:r=this._versionText;break;default:r=-2;try{t.PAssert(1149,!1,"Invalid version type")}catch(i){t.reportError(i)}}return r?r:0},setRemoteVersion:function(e,r){switch(e){case VersionType.Structure:this._versionRemote=r;break;case VersionType.Text:this._versionRemoteText=r;break;default:try{t.PAssert(1150,!1,"Invalid version type")}catch(i){t.reportError(i)}}},getRemoteVersion:function(e){var r;switch(e){case VersionType.Structure:r=this._versionRemote;break;case VersionType.Text:r=this._versionRemoteText;break;default:r=-2;try{t.PAssert(1151,!1,"Invalid version type")}catch(i){t.reportError(i)}}return r?r:0},isLocalVersionNewer:function(e){return this.getVersion(e)==this.getRemoteVersion(e)},isRemoteVersionNewer:function(e){return!this.isLocalVersionNewer(e)},init:function(e,r){if(e.data){var o=n.getVersion(e.data,VersionType.Structure),a=n.getVersion(e.data,VersionType.Text);this.setRemoteVersion(VersionType.Structure,o),this.setRemoteVersion(VersionType.Text,a),c.beginAction(),this.initFromGDrive(e.data,r&&r.parse),c.endAction(),this.setRemoteVersion(VersionType.Structure,void 0),this.setRemoteVersion(VersionType.Text,void 0)}else this.setVersion(VersionType.Structure,e.version),this.setVersion(VersionType.Text,e.versionText),this.modifiedOffline=e.modifiedOffline,this.modifiedOfflineText=e.modifiedOfflineText,this.modifiedOffline,this.modifiedOfflineText,t.vmMain.isLoaded&&n.isConnected()?i.initializeItem(this):this.id=e.id||t.generateTempId(),e.date&&(this.allDayDate=e.allDayDate,this.date(new Date(e.date)),this.date()._explicitTime=!this.allDayDate),e.dateCompleted&&(this.dateCompleted=new Date(e.dateCompleted)),e.items&&this.updateItems(e.items,r&&r.forceSave,r&&r.parse);this.parseText(r&&r.parse),r&&r.forceSave&&(this.save(void 0,SaveFlag.Prop),this.date()&&n.saveChanges(this,this.getMetaTextSaveData())),t.vmMain.isLoaded&&t.aggregateEvent("ItemCreated"),i.setModel(this.id,this)},onLoad:function(e,i){if(r.mobile&&(i=t.focusedPane),i&&i.trackDOM&&i.trackDOM()){try{t.PAssert(1152,i,"Items must be added to a pane")}catch(n){t.reportError(n)}var o=i.id;if(this.isLoaded=!0,t.hasClass(e,"outlineItem"))this.outlineElements[o]=e,i.vmSearch.checkItem(this,!0,!1);else{this.elements[o]=e;try{t.PAssert(1155,t.hasClass(this.elements[o].firstElementChild,"text"))}catch(n){t.reportError(n)}(!t.vmMain.isLoaded||i!=t.focusedPane||i.reloading)&&i.vmSearch.checkItem(this,!1,!0)}}},isFullscreen:function(){return t.focusedItem===this},findItem:function(e){var t=this.getIndexOf(e,!1);return t>=0?{index:t,arr:this.items,isArchived:!1}:this.hasArchivedChildren()&&(t=this.getIndexOf(e,!0),t>=0)?{index:t,arr:this.archivedItems(),isArchived:!0}:void 0},updateItems:function(e,r,o){var a,s;this.data&&(a=n.get(this.data,"items"),s=n.get(this.data,"archivedItems"));try{t.PAssert(1156,!this.hasChildren(),"Update items should only be called from initialize when there are no items already loaded")}catch(c){t.reportError(c)}try{t.PAssert(1157,!this.hasArchivedChildren(),"Update items should only be called from initialize when there are no items already loaded")}catch(c){t.reportError(c)}for(var l=!1,u=!1,h=0;h<e.length;++h){var p=e[h],m=i.getModel(p);if(m){var f=i.getItem(m.parent().id),g=f.items.indexOf(m.id);try{t.PAssert(1162,-1===g,"Expect that the old parent has been notified")}catch(c){t.reportError(c)}var v=m.getIndex();v>-1&&m.parent().removeChildAtIndex(v),m.parent(this)}else if("object"!=typeof p){var y=i.getItem(p);try{t.PAssert(1158,y,"Referenced item doesn't exist",p)}catch(c){t.reportError(c)}if(y)m=new d(y,{parent:this,forceSave:r,parse:o});else try{t.PAssert(1159,!1)}catch(c){t.reportError(c)}}else{try{t.PAssert(1160,p,"Item must exist otherwise we arent creating anything")}catch(c){t.reportError(c)}if(p)m=new d(p,{parent:this,forceSave:r,parse:o});else try{t.PAssert(1161,!1)}catch(c){t.reportError(c)}}try{t.PAssert(1163,m,"There must be a model at this point")}catch(c){t.reportError(c)}m&&(m.isArchived()?(u=!0,this.archivedItems(!0).push(m),!s&&this.data&&(s=n.ensureItemList(this,!0)),s&&s.push(m.data)):(l=!0,this.items().push(m),!a&&this.data&&(a=n.ensureItemList(this,!1)),a&&a.push(m.data)))}l&&this.items.valueHasMutated(),u&&this.archivedItems().valueHasMutated()},insertItem:function(e,r,n){var o=n?this.items():this.items;isNaN(r)?o.push(e):o.splice(r,0,e),i.insertItems(this,[e],r),t.fireCustomEvent("itemAdded",{item:e,force:!1})},moveTo:function(e){var r=e.parent,n=e.index,o=e.isRemoteChange,a=e.shouldBeArchived,s=e.noVersion,c=e.underlying;try{t.PAssert(1164,r instanceof d)}catch(l){t.reportError(l)}void 0===n&&(n=-1),void 0===o&&(o=!1),void 0===a&&(a=!1);var u=this.parent(),h=u.findItem(this);if(h){if(u===r){if(h.index===n)return;h.index<n&&n--}c&&(h.arr=h.arr()),h.arr.splice(h.index,1),this.parent(r);var p=a?r.archivedItems():r.items;c&&(p=p()),0>n?p.push(this):p.splice(n,0,this);var m={index:n,isArchived:a};i.moveItem({item:this,newInfo:m,oldParent:u,oldInfo:h,isRemoteChange:o,noVersion:s})}},getItemsArrayForSave:function(){for(var e=[],t=this.items(),r=0;r<t.length;++r)e.push(t[r].id);if(this.hasArchivedChildren())for(var i=this.archivedItems(!0),r=0;r<i.length;++r)e.push(i[r].id);return e},getDateTime:function(){return this.date()?this.date().getTime():void 0},getDateCompletedTime:function(){return this.dateCompleted?this.dateCompleted.getTime():void 0},getMetaTextSaveData:function(){var e,t,r=this.date();return void 0!==r&&(e=r.getTime(),t=!r._explicitTime),{date:e,allDayDate:t,dateCompleted:this.getDateCompletedTime()}},getBasicJSON:function(){try{t.PAssert(1165,this.date(),"Must have a valid date")}catch(e){t.reportError(e)}try{t.PAssert(1166,!this.allDayDate,"All day dates should not be scheduled")}catch(e){t.reportError(e)}if(this.allDayDate)return"";var r,i=this.date().toJSON();return r=this.allDayDate?this.date().addDays(-1).setHours(17).toJSON():this.date().addMinutes(-30).toJSON(),'{"id":"'+this.id+'","text":"'+this.getRawText()+'","date":"'+i+'","alertDate":"'+r+'"}'},getDebugData:function(){var e={id:this.id,parent:this._parent?this._parent.id:void 0,items:this.getItemsArrayForSave(),text:this.getRawText(),isArchived:this.isArchived(),isDeleted:this.isDeleted,version:this.getVersion(VersionType.Structure),versionText:this.getVersion(VersionType.Text),modifiedOffline:this.modifiedOffline,modifiedOfflineText:this.modifiedOfflineText};return e},getFullSaveData:function(){var e={id:this.id,text:this.getRawText(),date:this.getDateTime(),dateCreated:this.dateCreated.getTime(),dateCompleted:this.getDateCompletedTime(),priority:this._getPriority()||void 0,isComplete:this.isComplete()||void 0,isFlagged:this.isFlagged()||void 0,isCollapsed:this.isCollapsed()||void 0,allDayDate:this.allDayDate||void 0,isArchived:this.isArchived()||void 0,isDeleted:void 0,version:this.getVersion(VersionType.Structure),versionText:this.getVersion(VersionType.Text),modifiedOffline:this.modifiedOffline,modifiedOfflineText:this.modifiedOfflineText};return e.items=this.getItemsArrayForSave(),e},save:function(e,r){try{t.PAssert(1167,void 0!==r,"Must specify saveFlags for the changes that are being saved")}catch(n){t.reportError(n)}if(e){var o=i.getItem(this.id);o||e.id?(e.items&&(e.items=this.getItemsArrayForSave()),e.date&&!e.allDayDate&&(e.allDayDate=this.allDayDate||void 0),e.text&&t.fireCustomEvent("itemTextChanged",{item:this,force:r===SaveFlag.None})):e=this.getFullSaveData()}else e=this.getFullSaveData();i.saveChanges(this,e,r)},toggleCollapsed:function(){function e(){c.performAction(TrackerType.Update,{itemID:i.id,field:"isCollapsed",newValue:!i.isCollapsed(),oldValue:i.isCollapsed()}),i.isCollapsed(!i.isCollapsed()),i.save({isCollapsed:i.isCollapsed()},SaveFlag.Text)}if(!(this.items().length<=0)){var r=this.isCollapsed(),i=this,n=t.firstChildTag(this.getElement(),"ul");r?(e(),t.animateTransform(n,{time:200,delay:0,transform:"scale(1, 1) translate3d(0,0,0)",clearTransform:!0,origin:"50% 0"})):t.animateTransform(n,{time:200,transform:"scale(1, 0)",origin:"50% 0",onComplete:function(){e()}})}},highlight:function(){var e=this;this.highlightTimeout?(this.isHighlighted(!1),clearTimeout(this.highlightTimeout),this.highlightTimeout=0,setTimeout(function(){e.isHighlighted(!0)},0)):this.isHighlighted(!0),this.highlightTimeout=setTimeout(function(){e.isHighlighted(!1)},2e3)},getElement:function(e){return void 0===e&&(e=t.focusedPaneID),this.elements[e]},getSpan:function(e){var t=this.getElement(e);return t?t.firstElementChild:void 0},getOutlineElement:function(e){return void 0===e&&(e=t.focusedPaneID),this.outlineElements[e]},removeChild:function(e){var r;if(e.isArchived()){try{t.PAssert(1172,this.hasArchivedChildren(),"For a child to be archived, this item must have valid archived children")}catch(n){t.reportError(n)}this.hasArchivedChildren()&&(r=this.archivedItems(!0).remove(e),i.removeItem(this,r,e,!0),this.archivedItems().valueHasMutated())}else r=this.items().remove(e),i.removeItem(this,r,e,!1),this.items.valueHasMutated();return r},removeChildAtIndex:function(e){try{t.PAssert(1173,!this.items()[e].isArchived())}catch(r){t.reportError(r)}var n=this.items().removeAt(e);return i.removeItem(this,e,n,!1),this.items.valueHasMutated(),n},archiveChild:function(e){var t=!1;if(!e.isArchived()){c.beginAction(),e.isArchived(!0),this.archivedItems().push(e);var r=this.items().remove(e);i.archiveItem(this,r,e),this.items.valueHasMutated(),c.endAction(),t=!0}return t},unarchiveChild:function(e){var r=!1;if(e.isArchived()){c.beginAction();try{t.PAssert(1174,e.isArchived(),"Child must be archived to be unarchived")}catch(n){t.reportError(n)}try{t.PAssert(1175,this.hasArchivedChildren(),"Parent must have archived children to unarchive a child")}catch(n){t.reportError(n)}e.isArchived(!1);var o=this.archivedItems(!0).remove(e);this.items.push(e),i.unarchiveItem(this,o,e),this.archivedItems().valueHasMutated(),c.endAction(),r=!0}return r},_moveChildrenHelper:function(e){var r=e.newParent,i=e.index,n=e.isArchived;try{t.PAssert(1176,void 0!==r&&void 0!==n,"_moveChildrenHelper is missing parameters")}catch(o){t.reportError(o)}var a=n?this.archivedItems():this.items,s=a();if(s.length>0){var d=n?r.archivedItems():r.items;!n&&(isNaN(i)||0>i)&&(i=d().length);for(var l=0;s.length>0;){try{t.PAssert(1177,s[l]!=r)}catch(o){t.reportError(o)}var u=s[0];s[0].moveTo({parent:r,index:i+l,shouldBeArchived:n,underlying:!0}),c.performAction(TrackerType.Move,{itemID:u,oldParent:this.id,oldPosition:l,newParent:r.id,newPosition:i+l}),l++}a.valueHasMutated(),d.valueHasMutated()}},moveChildren:function(e,r){try{t.PAssert(1178,this.id!==e.id)}catch(i){t.reportError(i)}if(e.parent()===this){var n=this.removeChild(e);c.performAction(TrackerType.Delete,{itemID:e.id,parent:this.id,position:n})}this._moveChildrenHelper({newParent:e,index:r,isArchived:!1}),this._moveChildrenHelper({newParent:e,index:r,isArchived:!0})},deleteSelf:function(){this.parent().deleteChild(this),this.parent(void 0)},deleteChild:function(e,r,n){if(c.beginAction(),e.hasChildren()||e.hasArchivedChildren())if(r)e.moveChildren(r,n);else for(var o=e.items(),a=o.length-1;a>=0;a--)e.deleteChild(o[a]);if(!e.isDeleted){var s=this.removeChild(e);c.performAction(TrackerType.Delete,{itemID:e.id,parent:this.id,position:s}),i.deleteItem(e)}t.timeline.notifyStateChanged(e),c.endAction()},replaceChild:function(e,t){var r=e.getIndex();this.items().removeAt(r),c.performAction(TrackerType.Delete,{itemID:e.id,parent:this.id,position:r}),i.deleteItem(e),t.moveTo({parent:this,index:r}),i.removeItem(this,r+1,e,!1),e.moveChildren(t,t.numChildren());var n=t.parent().id;if(n!==this.id){var o=t.parent().items().remove(t);c.performAction(TrackerType.Move,{itemID:t.id,oldParent:n,oldPosition:o,newParent:this.id,newPosition:r})}this.items.valueHasMutated()},getChild:function(e){try{t.PAssert(1179,e<this.items().length)}catch(r){t.reportError(r)}return this.items()[e]},getFirstChild:function(){return this.hasChildren()?this.items()[0]:void 0},isFirstChild:function(){return this.parent()?this.parent().getFirstChild()===this:!1},getLastChild:function(){return this.hasChildren()?this.items()[this.items().length-1]:void 0},isLastChild:function(){return this.parent()?this.parent().getLastChild()===this:!1},getChildIndex:function(e){return this.getIndexOf(e.id,e.isArchived())},getIndexOf:function(e,t){e.id&&(e=e.id);var r,i=-1;if(t?this.hasArchivedChildren()&&(r=this.archivedItems(!0)):r=this.items(),r)for(var n=0;n<r.length;++n)if(r[n].id===e){i=n;break}return i},getRemoteIndexOf:function(e,t){var r=n.getItemList(this.data,t),i=-1;return r&&(i=r.indexOf(e)),i},getIndex:function(){return this.parent().getChildIndex(this)},hasChildren:function(){return this.items().length>0},numChildren:function(){return this.items().length},canZoom:function(){return this.numChildren()>0||this.getParsedText().length>0},parents:function(){for(var e=[],t=this;t;)e.splice(0,0,t),t=t.parent();return e},getSiblings:function(e){e=e||0;var t=[];if(this.parent())for(var r=this.parent().items(),i=0,n=r.length;n>i;i++)r[i]!==this&&t.push(r[i]);return t},outline:function(e){if(e)for(var r=e.$parents.length-1;r>0;r--)if(e.$parents[r]instanceof t.VMOutline)return e.$parents[r];return t.focusedPane.outline}},t.extend(d.prototype,o),t.extend(d.prototype,a),t.extend(d.prototype,s(d)),d}),define("tracker",["globals","platform","data","gdata","VMLI"],function(e,t,r,i){function n(){return _.groupID+1}function o(){return++_.groupID}function a(){return _.groups[_.cursor]}function s(){return _.groups[_.cursor].events[_.groups[_.cursor].events.length-1]}function c(t){for(var r=0;r<t.events.length;++r){var i=t.events[r];switch(i.type){case TrackerType.Insert:break;case TrackerType.Remove:break;case TrackerType.Create:break;case TrackerType.Delete:break;case TrackerType.Move:break;case TrackerType.Update:break;case TrackerType.Format:break;case TrackerType.Zoom:break;case TrackerType.UIAction:break;default:try{e.PAssert(1182,!1,"Expected TrackerType, received: ",type)}catch(n){e.reportError(n)}}}}function d(){var e=o();return _.groups.push({id:e,events:[],persisted:!1}),_.cursor<N-1&&_.cursor++,_.groups.length>N&&c(_.groups.shift()),e}function l(t,r){var i=a();try{e.PAssert(1183,i,"Expected group to exist")}catch(n){e.reportError(n)}var o={type:t,data:r};switch(t){case TrackerType.Insert:o.cb={undo:m,redo:f};break;case TrackerType.Remove:o.cb={undo:g,redo:v};break;case TrackerType.Create:o.cb={undo:y,redo:b};break;case TrackerType.Delete:o.cb={undo:S,redo:T};break;case TrackerType.Move:o.cb={undo:x,redo:w};break;case TrackerType.Update:o.cb={undo:E,redo:M};break;case TrackerType.Format:o.cb={undo:C,redo:I};break;case TrackerType.Zoom:o.cb={undo:P,redo:A};break;case TrackerType.UIAction:o.cb={undo:k,redo:D};break;default:try{e.PAssert(1184,!1,"Expected TrackerType, received: ",t)}catch(n){e.reportError(n)}}i.events.push(o)}function u(t,r){log("Tracker Action Merged: ",t,r);var i=s();try{e.PAssert(1185,i,"Expected action to exist")}catch(n){e.reportError(n)}switch(t){case TrackerType.Insert:break;case TrackerType.Remove:break;case TrackerType.Create:break;case TrackerType.Delete:break;case TrackerType.Move:break;case TrackerType.Update:break;case TrackerType.Format:try{e.PAssert(1186,!1,"Formats cannot be merged")}catch(n){e.reportError(n)}break;case TrackerType.Zoom:try{e.PAssert(1187,!1,"Zooms cannot be merged")}catch(n){e.reportError(n)}break;case TrackerType.UIAction:try{e.PAssert(1188,!1,"UIActions cannot be merged")}catch(n){e.reportError(n)}break;default:try{e.PAssert(1189,!1,"Expected TrackerType, received: ",t)}catch(n){e.reportError(n)}}}function h(e){var t=!1,r=a();return r&&r.events.length>0&&(r.events[r.events.length-1].type===e?e===TrackerType.Insert&&(t=!0):t=!1),t}function p(e,t){var r=a();return r&&(r.id===t||0===r.events.length)}function m(t){for(var i=0;i<t.length;++i){var n=t[i],o=r.getModel(n.itemID);try{e.PAssert(1190,o,"Expected model to exist: ",n)}catch(a){e.reportError(a)}var s=o.getParsedText(),c=0;"﻿"==s[0]&&(c=1);var d=s.slice(c,n.position)+s.slice(n.position+n.text.length);o.setText(d,!0),e.selectChildren(o,n.position,0)}}function f(t){for(var i=0;i<t.length;++i){var n=t[i],o=r.getModel(n.itemID);try{e.PAssert(1191,o,"Expected model to exist: ",n)}catch(a){e.reportError(a)}var s=o.getParsedText(),c=s.slice(0,n.position)+n.text+s.slice(n.position);0===c.length&&(c="﻿"),o.setText(c,!0),e.selectChildren(o,n.position,n.text.length)}}function g(t){for(var i=0;i<t.length;++i){var n=t[i],o=r.getModel(n.itemID);try{e.PAssert(1192,o,"Expected model to exist: ",n)}catch(a){e.reportError(a)}var s=o.getParsedText(),c=0;"﻿"==s[0]&&(c=1);var d=s.slice(c,n.position)+n.text+s.slice(n.position);o.setText(d,!0),e.selectChildren(o,n.position,n.text.length)}}function v(t){for(var i=0;i<t.length;++i){var n=t[i],o=r.getModel(n.itemID);try{e.PAssert(1193,o,"Expected model to exist: ",n)}catch(a){e.reportError(a)}var s=o.getParsedText(),c=s.slice(0,n.position)+s.slice(n.position+n.text.length);0===c.length&&(c="﻿"),o.setText(c,!0),e.selectChildren(o,n.position,0)}}function y(t){for(var i=0;i<t.length;++i){var n=t[i],o=r.getModel(n.parent);try{e.PAssert(1194,o,"Expected model to exist: ",n)}catch(a){e.reportError(a)}var s=o.removeChildAtIndex(n.position);try{e.PAssert(1195,s.id===n.itemID,"Expected data to match removed child: ",s,n)}catch(a){e.reportError(a)}s.parent(void 0),r.deleteItem(s);var c=o;n.position>0&&(c=o.getChild(n.position-1)),e.selectChildren(c,c.getParsedText().length,0),o.save({items:o.getItemsArrayForSave()},SaveFlag.None)
}}function b(t){for(var i=0;i<t.length;++i){var n=t[i],o=r.getModel(n.parent);try{e.PAssert(1196,o,"Expected parent model to exist: ",n)}catch(a){e.reportError(a)}var s=r.getModel(n.itemID);try{e.PAssert(1197,s,"Expected child model to exist: ",n)}catch(a){e.reportError(a)}r.undeleteItem(s),o.items.splice(n.position,0,s),s.parent(o),e.selectChildren(s,0,0),o.save({items:o.getItemsArrayForSave()},SaveFlag.None)}}function S(t){for(var i=0;i<t.length;++i){var n=t[i],o=r.getModel(n.parent);try{e.PAssert(1199,o,"Expected model to exist: ",n)}catch(a){e.reportError(a)}var s=r.getModel(n.itemID);try{e.PAssert(1200,s,"Expected model to exist: ",n)}catch(a){e.reportError(a)}r.undeleteItem(s),o.items.splice(n.position,0,s),s.parent(o),e.selectChildren(s,0,0),o.save({items:o.getItemsArrayForSave()},SaveFlag.None)}}function T(t){for(var i=0;i<t.length;++i){var n=t[i],o=r.getModel(n.parent);try{e.PAssert(1202,o,"Expected model to exist: ",n)}catch(a){e.reportError(a)}var s=o.removeChildAtIndex(n.position);try{e.PAssert(1203,s.id===n.itemID,"Expected data to match removed child: ",s,n)}catch(a){e.reportError(a)}s.parent(void 0),r.deleteItem(s);var c=o;n.position>0&&(c=o.getChild(n.position-1)),e.selectChildren(c,c.getParsedText().length,0),o.save({items:o.getItemsArrayForSave()},SaveFlag.None)}}function x(t){for(var i=0;i<t.length;++i){var n=t[i],o=r.getModel(n.oldParent);try{e.PAssert(1204,o,"Expected oldParent model to exist: ",n)}catch(a){e.reportError(a)}var s=r.getModel(n.newParent);try{e.PAssert(1205,s,"Expected newParent model to exist: ",n)}catch(a){e.reportError(a)}var c=s.removeChildAtIndex(n.newPosition);try{e.PAssert(1206,c.id===n.itemID,"Expected data to match child: ",c,n)}catch(a){e.reportError(a)}c.parent(o),o.items.splice(n.oldPosition,0,c),e.selectChildren(c,0,0),s.save({items:s.getItemsArrayForSave()},SaveFlag.None),o.save({items:o.getItemsArrayForSave()},SaveFlag.None)}}function w(t){for(var i=0;i<t.length;++i){var n=t[i],o=r.getModel(n.oldParent);try{e.PAssert(1207,o,"Expected oldParent model to exist: ",n)}catch(a){e.reportError(a)}var s=r.getModel(n.newParent);try{e.PAssert(1208,s,"Expected newParent model to exist: ",n)}catch(a){e.reportError(a)}var c=o.removeChildAtIndex(n.oldPosition);try{e.PAssert(1209,c.id===n.itemID)}catch(a){e.reportError(a)}c.parent(s),s.items.splice(n.newPosition,0,c),e.selectChildren(c,0,0),s.save({items:s.getItemsArrayForSave()},SaveFlag.None),o.save({items:o.getItemsArrayForSave()},SaveFlag.None)}}function E(t){for(var i=0;i<t.length;++i){var n=t[i],o=r.getModel(n.itemID);try{e.PAssert(1210,o,"Expected model to exist: ",n)}catch(a){e.reportError(a)}try{e.PAssert(1211,o[n.field],"Expected field to exist: ",n)}catch(a){e.reportError(a)}o[n.field](n.oldValue)}}function M(t){for(var i=0;i<t.length;++i){var n=t[i],o=r.getModel(n.itemID);try{e.PAssert(1212,o,"Expected model to exist: ",n)}catch(a){e.reportError(a)}try{e.PAssert(1213,o[n.field],"Expected field to exist: ",n)}catch(a){e.reportError(a)}o[n.field](n.newValue)}}function C(t){for(var i=0;i<t.length;++i){var n=t[i],o=r.getModel(n.itemID);try{e.PAssert(1214,o,"Expected model to exist: ",n)}catch(a){e.reportError(a)}}}function I(t){for(var i=0;i<t.length;++i){var n=t[i],o=r.getModel(n.itemID);try{e.PAssert(1215,o,"Expected model to exist: ",n)}catch(a){e.reportError(a)}}}function P(t){var i=t[0],n=r.getModel(i.oldItemID);try{e.PAssert(1216,n,"Expected model to exist: ",i)}catch(o){e.reportError(o)}if(i.zoomIn)n.zoomOut(i.time);else if(i.zoomOut)n.zoomin({time:i.time});else try{e.PAssert(1217,!1,"Zoom action must define either zoomIn or zoomOut")}catch(o){e.reportError(o)}}function A(t){var i=t[0],n=r.getModel(i.itemID);try{e.PAssert(1218,n,"Expected model to exist: ",i)}catch(o){e.reportError(o)}if(i.zoomIn)n.zoomin({time:i.time});else if(i.zoomOut)n.zoomOut(i.time);else try{e.PAssert(1219,!1,"Zoom action must define either zoomIn or zoomOut")}catch(o){e.reportError(o)}}function k(t){var r=t[0];switch(r.type){case TrackerUIAction.RemovePane:break;case TrackerUIAction.SwitchPaneMode:break;default:try{e.PAssert(1220,!1,"Invalid UIAction")}catch(i){e.reportError(i)}}}function D(){}function L(){return!e.vmMain.isLoaded||e.isLoadingRemote}function O(t){try{e.PAssert(1228,!_.undoRedoActive)}catch(i){e.reportError(i)}for(var n=void 0,o=0,a=0,s=0;s<t.length;++s){var c=t[s],d=c.data,l=r.getModel(d.itemID);try{e.PAssert(1229,l,"Expected model to exist: ",d)}catch(i){e.reportError(i)}switch(c.type){case TrackerType.Insert:n=l,o=d.position,a=d.text.length;break;case TrackerType.Remove:n=l,o=d.position,a=0;break;case TrackerType.SetText:l.deleteTimeout||(n=l,o=d.position,a=0);break;case TrackerType.Create:n=l,o=0,a=0;break;case TrackerType.Delete:var u=r.getModel(d.previous);n=u,o=u.getParsedText().length,a=0}}n&&(e.selectChildren(n,o,a),e.scrollIntoView(n.getSpan(),200)),U=[]}function R(){return _.groups.slice(_.cursor).concat(_.groups.slice(0,_.cursor))}var _={disabled:!1,allowOfflineUndo:!1,cursor:-1,groupID:0,groups:[],externalUndoRedo:!1,undoRedoActive:!1,canRedo:!1,canUndo:!1};window.TrackerType={Insert:1,Remove:2,SetText:3,Create:4,Delete:5,Move:6,Update:7,Format:8,Zoom:9,UIAction:10,Misc:11},window.TrackerMisc={ToggleOutline:1,RightClick:2,CloseMessage:3,ChangeDate:4,AddContact:5,DropItem:6,SyncContacts:7,OpenContact:8,SearchChanged:10,ToggleSidebar:11,AddDocument:12,OpenDocument:13,OpenDocSharing:14,Copy:15,Paste:16,OpenImport:17,OpenExport:18,UndoRedo:19},window.TrackerUIAction={AddPane:1,RemovePane:2,SwitchPaneMode:3};var N=75,F=!1;_.performActions=function(t){try{e.PAssert(1221,!_.disabled||e.intro)}catch(r){e.reportError(r)}try{e.PAssert(1222,!F)}catch(r){e.reportError(r)}if(F=!0,t&&t.length>0){if(!_.disabled){var i=void 0;_.cursor!=_.groups.length-1?(_.groups.splice(_.cursor+1,_.groups.length-(_.cursor+1)),i=d()):i=n()}for(var o=0;o<t.length;++o){var a=t[o];e.intro&&e.intro.onAction(a),_.disabled||(p(a.type,i)?h(a.type)?u(a.type,a.data):l(a.type,a.data):(i=d(),l(a.type,a.data)))}}F=!1};var V=[],B=0;_.beginAction=function(){try{e.PAssert(1223,!F)}catch(t){e.reportError(t)}if(0===B){i.beginAction();try{e.PAssert(1224,0===V.length,"Current actions should always be empty when starting a new action")}catch(t){e.reportError(t)}}B++},_.performAction=function(t,r){try{e.PAssert(1225,!F)}catch(i){e.reportError(i)}var n=L();_.disabled?e.intro&&(n||_.performActions([{type:t,data:[r]}])):B?V.push({type:t,data:[r]}):_.performActions([{type:t,data:[r]}])},_.endAction=function(){try{e.PAssert(1226,!F)}catch(t){e.reportError(t)}try{e.PAssert(1227,0!==B,"Must have called beginAction before calling endAction")}catch(t){e.reportError(t)}1===B&&((!_.disabled||e.intro)&&_.performActions(V),V.length=0,i.endAction()),B--};var U=[];return _.notifyStateChangedFromUndoRedo=function(t,r){try{e.PAssert(1230,_.undoRedoActive)}catch(i){e.reportError(i)}U.push({type:t,data:r})},_.undoAction=function(){e.vmMain.isOnline()||_.allowOfflineUndo||e.messageQueue.pushMessage(MessageID.OfflineUndo),_.undoRedoActive=!0;try{e.PAssert(1231,!F)}catch(t){e.reportError(t)}if(!_.disabled&&_.allowOfflineUndo){if(_.cursor>=0)for(var r=_.groups[_.cursor--],n=r.events.length-1;n>=0;n--){var o=r.events[n];o.cb.undo(o.data)}}else if(_.canUndo){try{e.PAssert(1232,_.externalUndoRedo)}catch(t){e.reportError(t)}i.undoAction()}_.undoRedoActive=!1,O(U),_.miscAction({type:TrackerType.Misc,misc:TrackerMisc.UndoRedo,data:[{undo:!0}]})},_.redoAction=function(){e.vmMain.isOnline()||_.allowOfflineUndo||e.messageQueue.pushMessage(MessageID.OfflineUndo),_.undoRedoActive=!0;try{e.PAssert(1233,!F)}catch(t){e.reportError(t)}if(!_.disabled&&_.allowOfflineUndo){if(_.cursor>=-1&&_.cursor<_.groups.length-1)for(var r=_.groups[++_.cursor],n=0;n<r.events.length;++n){var o=r.events[n];o.cb.redo(o.data)}}else if(_.canRedo){try{e.PAssert(1234,_.externalUndoRedo)}catch(t){e.reportError(t)}i.redoAction()}_.undoRedoActive=!1,O(U),_.miscAction({type:TrackerType.Misc,misc:TrackerMisc.UndoRedo,data:[{redo:!0}]})},_.miscAction=function(t){e.intro&&e.intro.onAction(t)},_.resetState=function(){F=!1,U=[],V=[],_.undoRedoActive=!1,_.cursor=-1,_.groupID=0,_.groups=[]},_.stringifyGroups=function(){var e=R();return"Tracker: "+e.length},_.stateChangeForUndoRedo=function(e){_.externalUndoRedo=!0,_.disabled=!0,_.canRedo=e.canRedo,_.canUndo=e.canUndo},i.registerForUndoRedoStateChange(_),_}),define("edit",["ko","globals","platform","android","VMLI","tracker"],function(e,t,r,i,n,o){function a(){if(i.isEnabled()){if(!i.getCurrentVMLI())return!0;s={},c=void 0,d=l=i.getCurrentSpan(),u=i.getSelectionStart(),h=i.getSelectionEnd()}else{if(s=t.getSelectionInfo(),!s||0===s.rangeCount)return!0;c=s.selection.getRangeAt(0),d=c.startContainer,l=c.endContainer,u=c.startOffset,h=c.endOffset}}var s,c,d,l,u,h,p,m,f={},g=[KeyCode.Tab,KeyCode.BackSpace,KeyCode.Delete,KeyCode.Period],v=[KeyCode.UpArrow,KeyCode.DownArrow,KeyCode.LeftArrow,KeyCode.RightArrow,KeyCode.Home,KeyCode.End],y={},b=String.fromCharCode(10);return f.updateAutocomplete=function(r){var i=r.normCode&&v.indexOf(r.normCode)>=0;if(t.autocomplete){var n=t.getSelectionInfo();if(n&&n.selection.rangeCount>0){var o=n.selection.getRangeAt(0),a=t.getLIParent(o.startContainer),s=t.getLIParent(o.endContainer);if(a&&a===s&&o.startOffset===o.endOffset&&"UL"!==o.startContainer.tagName){var c=e.dataFor(a),d=c.getSpan();try{t.PAssert(1235,d,"Items should always have a valid span if we are performing updates in a VMPane")}catch(l){t.reportError(l)}if(d){var u=t.getSelectOffsetsInSpan(c,d,o);u.start===u.end&&t.autocomplete.update({item:c,start:u.start,fromArrows:i})}else t.autocomplete.hide()}}}},f.onTextInput=function(e){if(y.item&&y.waitAutocorrect&&" "!=e.data&&e.data!=b){var r=y.item,i="enter"==y.waitAutocorrect?p:r.getSpan(),n=r.getParsedText();a();var o=t.getSelectOffsetsInSpan(r,i,c),s=o.endText-o.startText,d="space"==y.waitAutocorrect?" ":"";y.text=n.substr(0,o.startText)+e.data+d+n.substr(o.endText),y.start+=e.data.length-s,y.waitAutocorrect=void 0}},f.keyup=function(e,r){y.item&&(o.beginAction(),void 0!=y.text&&y.item.setText(y.text,!0),y.nextItem?t.selectChildren(y.nextItem,0,0):t.selectChildren(y.item,y.start,0),f.updateAutocomplete(r),o.endAction()),y.item=void 0,y.nextItem=void 0,y.text=void 0,y.start=void 0,y.waitAutocorrect=void 0,(r.normCode===KeyCode.Enter||r.normCode===KeyCode.PageUp||r.normCode===KeyCode.PageDown)&&f.scrollTextIntoView();try{t.PAssert(1236,r.stopImmediatePropagation,"Should always be defined")}catch(i){t.reportError(i)}r.stopImmediatePropagation&&r.stopImmediatePropagation();try{t.PAssert(1237,r.preventDefault,"Should always be defined")}catch(i){t.reportError(i)}return r.preventDefault&&r.preventDefault(),r.handled?!0:void 0},f.scrollTextIntoView=function(r,i){try{t.PAssert(1238,0!==r,"Cannot have a null scroll direction")}catch(n){t.reportError(n)}if(isNaN(i)&&(i=200),!t.isScrolling&&(a(),l&&"UL"!==l.tagName&&"LI"!==l.tagName)){var o=t.getSpanParent(l),s=e.dataFor(o);if(s){var c;0>r?c=t.getPreviousItem(s,t.focusedPane)||s:r>0&&(c=t.getNextItem(s,t.focusedPane)||s);var d=c?c.getSpan():o;t.scrollIntoView(d,i)}}},f.handleSelectAll=function(e){a();var r=t.getFirstPaneItem(e),i=t.getLastPaneItem(e);return t.selectMultiline(r.getSpan(),0,i.getSpan(),i.getParsedText().length),!1},f.handleArrows=function(i,n){if(t.restrictSelectionToText(),a(),r.mac&&n.metaKey&&n.normCode===KeyCode.UpArrow||!r.mac&&n.ctrlKey&&n.normCode===KeyCode.Home){var o=t.getFirstPaneItem(t.focusedPane);return n.shiftKey?t.selectMultiline(o.getSpan(),0,l,h):t.selectChildren(o,0,0),t.scrollIntoView(o.getSpan()),!1}if(r.mac&&n.metaKey&&n.normCode===KeyCode.DownArrow||!r.mac&&n.ctrlKey&&n.normCode===KeyCode.End){var s=t.getLastPaneItem(t.focusedPane);return n.shiftKey?t.selectMultiline(d,u,s.getSpan(),s.getParsedText().length):t.selectChildren(s,s.getParsedText().length,0),t.scrollIntoView(s.getSpan()),!1}if(!r.mac&&n.ctrlKey&&n.normCode===KeyCode.UpArrow&&d){var p,m=e.dataFor(t.getSpanParent(d));if(m.parent()===t.focusedItem){if(!m.isFirstChild()){try{t.PAssert(1240,m.getIndex()>0,"Should never hit this with the first item in the list")}catch(g){t.reportError(g)}p=m.parent().getChild(m.getIndex()-1)}}else{for(;m.parent()!==t.focusedItem;)m=m.parent();p=m}return void 0!==p&&(t.selectChildren(p,p.getParsedText().length,0),t.scrollIntoView(p.getSpan())),!1}if(!r.mac&&n.ctrlKey&&n.normCode===KeyCode.DownArrow&&l){var p,m=e.dataFor(t.getSpanParent(l));if(m.parent()===t.focusedItem)m.isLastChild()||(p=m.parent().getChild(m.getIndex()+1));else{for(;m.parent()!==t.focusedItem;)m=m.parent();m.isLastChild()||(p=m.parent().getChild(m.getIndex()+1))}return void 0!==p&&(t.selectChildren(p,p.getParsedText().length,0),t.scrollIntoView(p.getSpan())),!1}if(void 0===d||void 0===l)return!0;if(n.normCode===KeyCode.LeftArrow||n.normCode===KeyCode.RightArrow){a();var v=t.getLIParent(d),y=t.getLIParent(l);if(v==y){var m=e.dataFor(v);if(0===m.getParsedText().length){if(n.normCode===KeyCode.LeftArrow){var b=t.getPreviousItem(m,t.focusedPane);b&&t.selectChildren(b,b.getParsedText().length,0)}else if(n.normCode===KeyCode.RightArrow){var S=t.getNextItem(m,t.focusedPane);S&&t.selectChildren(S,0,0)}return!1}}}else if(r.ie&&(n.normCode===KeyCode.UpArrow||n.normCode===KeyCode.DownArrow)){if(a(),n.normCode===KeyCode.UpArrow)var T=e.dataFor(t.getLIParent(d)),x=t.getPreviousItem(T,t.focusedPane);else if(n.normCode===KeyCode.DownArrow)var T=e.dataFor(t.getLIParent(l)),x=t.getNextItem(T,t.focusedPane);if(x){if(d===l)var w=t.getSelectOffsetsInSpan(void 0,l,c),E=Math.min(w.start,x.getParsedText().length);else var E=x.getParsedText().length;return t.selectChildren(x,E,0),!1}}return f.updateAutocomplete(n),!0},f.keydown=function(e,t){var n=!0;if(g.indexOf(t.normCode)>=0)n=f.keypress(e,t,!0);else if(v.indexOf(t.normCode)>=0)n=f.handleArrows(e,t);else if(r.mac&&t.metaKey||!r.mac&&t.ctrlKey){if(t.normCode===KeyCode.A)return f.handleSelectAll(e,t);if(t.normCode===KeyCode.Y||t.normCode===KeyCode.Z)return f.keypress(e,t,!0)}switch(t.normCode){case KeyCode.Enter:(!r.mobile||i.isEnabled())&&f.scrollTextIntoView();break;case KeyCode.UpArrow:r.mac&&!t.metaKey&&f.scrollTextIntoView(-1,10);break;case KeyCode.DownArrow:r.mac&&!t.metaKey&&f.scrollTextIntoView(1,10);break;default:var o=t.normCode>=32&&t.normCode<=90&&t.normCode!==KeyCode.Period||t.normCode===KeyCode.Enter;!o||r.mac&&t.metaKey||!r.mac&&t.ctrlKey||f.scrollTextIntoView()}return n},f.keypress=function(u,h,p){var g=[KeyCode.Enter];try{t.PAssert(1241,h.stopPropagation,"Should always be defined")}catch(v){t.reportError(v)}h.stopPropagation&&h.stopPropagation();var b=!0,S=h.normCode>=32&&h.normCode!==KeyCode.Period||g.indexOf(h.normCode)>=0,T=r.mobile&&h.normCode===KeyCode.Delete||0===h.which;if(!T&&(p||S)){if(a(),!s&&!i.isEnabled())return!0;if(r.mac&&h.metaKey||!r.mac&&h.ctrlKey){if(h.normCode===KeyCode.Y||h.normCode===KeyCode.Z){h.normCode!==KeyCode.Z||h.shiftKey?(o.redoAction(),t.sendEvent("Hotkey","Redo")):(o.undoAction(),t.sendEvent("Hotkey","Undo")),h.handled=!0;try{t.PAssert(1242,h.preventDefault,"Should always be defined")}catch(v){t.reportError(v)}return h.preventDefault&&h.preventDefault(),!0}var x=String.fromCharCode(h.normCode);switch(x){case"c":case"C":return h.handled=!0,!0;case"v":case"V":return h.handled=!0,!0;case"r":case"R":case"a":case"A":return h.handled=!0,!0}}var w;if("UL"==d.nodeName){var E=e.dataFor(d);E instanceof n||(w=E.addItemToPane("",0),P=w.getSpan(),t.selectChildren(w,0,0))}t.restrictSelectionToText(),a();try{t.PAssert(1243,i.isEnabled()||"#text"==d.nodeName||"SPAN"==d.nodeName,"Expected SPAN, Actual: "+d.tagName)}catch(v){t.reportError(v)}var M=t.getSpanParent(d);try{t.PAssert(1244,i.isEnabled()||"#text"==l.nodeName||"SPAN"==l.nodeName,"Expected SPAN, Actual: "+l.tagName)}catch(v){t.reportError(v)}var C=t.getSpanParent(l);if(!M||!C)return h.stopPropagation(),h.preventDefault(),!1;o.beginAction(),M!=C&&h.normCode!==KeyCode.Tab&&(b=b&&f.handleMultiselect(h,M,C,c));var I=[KeyCode.Tab,KeyCode.Enter,KeyCode.BackSpace,KeyCode.Delete];if(b&&I.indexOf(h.normCode)>=0){var P=t.getSpanParent(s.node);try{t.PAssert(1245,i.isEnabled()||P&&"SPAN"===P.tagName,"Expected SPAN, Actual: "+P.tagName)}catch(v){t.reportError(v)}if(P){var A=!1;if(h.shiftKey&&h.normCode===KeyCode.BackSpace){var k=t.getSelectOffsetsInSpan(void 0,P,c);0===k.start&&(A=!0)}h.normCode===KeyCode.Tab||A?b=b&&f.handleTab(h,c):h.normCode===KeyCode.Enter?b=b&&f.handleEnter(h,P,c):h.normCode===KeyCode.BackSpace?(b=b&&f.handleBackspace(h,P,c),y.item||f.updateAutocomplete(h)):h.normCode===KeyCode.Delete&&(b=b&&f.handleDelete(h,P,c))}}var D=h.normCode;h.normCode===KeyCode.Period&&(D=h.shiftKey?KeyCode.RAngle:KeyCode.Delete);var L=String.fromCharCode(D);if(b&&L&&h.normCode!==KeyCode.BackSpace&&h.normCode!==KeyCode.Enter&&!h.ctrlKey){a();try{t.PAssert(1246,t.getSpanParent(d)==t.getSpanParent(l))}catch(v){t.reportError(v)}var P=t.getSpanParent(s.node);try{t.PAssert(1247,i.isEnabled()||"SPAN"===P.tagName,"Expected SPAN, Actual: "+P.tagName)}catch(v){t.reportError(v)}w||(w=t.getItemForElement(P));try{t.PAssert(1248,w,"Must be able to get a valid item from the selected span")}catch(v){t.reportError(v)}var O,R=t.getSelectOffsetsInSpan(w,P,c);O=i.isEnabled()?i.getInputText():w.getParsedText();var _=!0,N=O.substr(0,R.startText)+L+O.substr(R.endText);if(R.startText!==R.endText&&(_=!1,o.performAction(TrackerType.Remove,{itemID:w.id,position:R.startText,text:O.slice(R.startText,R.endText)})),o.performAction(TrackerType.Insert,{itemID:w.id,position:R.startText,text:L}),r.ios)y.text=N,y.start=R.start+1,y.waitAutocorrect=" "==L?"space":void 0,y.item=w,b=!0;else{t.clearSelection(),w.setText(N,!0),t.selectChildren(w,R.start+1,0),b=!1;try{t.PAssert(1249,h.preventDefault,"Should always be defined")}catch(v){t.reportError(v)}h.preventDefault&&h.preventDefault(),f.updateAutocomplete(h)}}o.endAction()}return m=h.normCode,b},f.handleMultiselect=function(i,n,a,s){var c=[],d=0,l=!0,u=n.parentNode,h=a.parentNode;try{t.PAssert(1250,"LI"==u.tagName,"Expected LI, Actual: ",u)}catch(p){t.reportError(p)}try{t.PAssert(1251,"LI"==h.tagName,"Expected LI, Actual: ",h)}catch(p){t.reportError(p)}try{t.PAssert(1252,u!=h)}catch(p){t.reportError(p)}var m=e.dataFor(u),f=e.dataFor(h),g=m,v=t.getSelectOffsetsInSpan(m,n,s),y=t.getSelectOffsetsInSpan(f,a,s),b=0;do{var S={numLevels:0};g=t.getNextItem(g,t.focusedPane,S),g.parent()===t.focusedPane.item()&&g.isHeader()&&b++,d+=S.numLevels,(g!==f||y.end===y.total)&&c.push(g)}while(g!==f);var T=!0;if(c.length>=16&&b>=2&&(r.packagedApp||(T=confirm("You have selected a large number of items to delete, please confirm you want to perform this action."))),T){var x;if(v.start>0||y.end<y.total){var w=m.getParsedText(),E=f.getParsedText().substring(y.endText);x=w.substring(0,v.startText)+E,o.performAction(TrackerType.Remove,{itemID:m.id,position:v.startText,text:w.slice(v.startText)}),o.performAction(TrackerType.Insert,{itemID:m.id,position:v.startText,text:E}),c.indexOf(f)<0&&c.push(f),0===v.start&&m.copyProperties(f)}else o.performAction(TrackerType.Remove,{itemID:m.id,position:0,text:m.getParsedText()}),x="";if((i.normCode===KeyCode.BackSpace||i.normCode===KeyCode.Delete||i.normCode===KeyCode.Enter)&&(l=!1),f.moveChildren(m,0),d>0){var M,C=[];M=h.children.length>1?h.children[1].children[0]:h.nextElementSibling;for(var I=M;d>0&&I;){for(d--;void 0!==I&&null!==I;)C.push(I),I=I.nextElementSibling;M=M.parentElement.parentElement,I=M.nextElementSibling}if(C.length>0)for(var P=m,A=P.parent(),k=P.getIndex()+1,D=0;D<C.length;D++){var L=e.dataFor(C[D]),O=L.parent();L.moveTo({parent:A,index:k});var R=L.parent().getIndexOf(L);o.performAction(TrackerType.Move,{itemID:L.id,oldParent:O.id,oldPosition:R,newParent:A.id,newPosition:k}),k++}}for(var D=0;D<c.length;D++){var L=c[D];try{t.PAssert(1253,L,"Item must exist")}catch(p){t.reportError(p)}L.isDeleted||L.parent().deleteChild(L)}m.setText(x,!0),t.selectChildren(m,v.start,0)}else l=!1;return l},f.handleTab=function(r,n){if(i.isEnabled())var a=i.getCurrentVMLI(),s=i.getCurrentVMLI();else{var c=t.getSpanParent(n.startContainer),d=t.getSpanParent(n.endContainer),l=t.getSelectOffsetsInSpan(void 0,c,n),u=t.getSelectOffsetsInSpan(void 0,d,n);try{t.PAssert(1254,"LI"==c.parentNode.tagName,"Expected LI, Actual: ",c.parentNode)}catch(h){t.reportError(h)}try{t.PAssert(1255,"LI"==d.parentNode.tagName,"Expected LI, Actual: ",d.parentNode)}catch(h){t.reportError(h)}var a=e.dataFor(c.parentNode),s=e.dataFor(d.parentNode)}var p,m,f=a,g={},v=[a],y={},b={};if(b[a.id]=!0,a!==s)do{var S={numLevels:0,ignoreSearch:!0};f=t.getNextItem(f,void 0,S),p=f.parent(),v.push(f),b[f.id]=!0}while(f!==s);var T,x,w;if(r.shiftKey)var E=function(){T=v.length-1},x=function(){return T>=0},w=function(){T--};else var E=function(){T=0},x=function(){return T<v.length},w=function(){T++};for(E();x();w()){var M,C,I=v[T],p=I.parent(),P=p.items().indexOf(I);if(r.shiftKey){if(M=I.parent()!=t.focusedItem){m=I.parent().parent();{var A=p.items();A.length-P-1}for(C=P+1;A[P+1];){var k=A[P+1];b[k.id]||t.hasClass(k.getElement(),"hidden")?P++:(g[k.parent().id]=k.parent(),g[I.id]=I,k.moveTo({parent:I,underlying:!0}),y[k.id]=!0,o.performAction(TrackerType.Move,{itemID:k.id,oldParent:p.id,oldPosition:C,newParent:I.id,newPosition:I.items().length-1})),C++}if(b[p.id]>=0&&(!p.parent()||p.parent()!=t.focusedItem))continue;var D=m.items().indexOf(p);g[I.parent().id]=I.parent(),g[m.id]=m,I.moveTo({parent:m,index:D+1,underlying:!0}),y[I.id]=!0,o.performAction(TrackerType.Move,{itemID:I.id,oldParent:p.id,oldPosition:P,newParent:m.id,newPosition:D+1})}}else{if(M=P>0){for(m=p.items()[P-1];t.hasClass(m.getElement(),"hidden");){if(P--,0>=P)return!1;m=p.items()[P-1]}y[p.id]||(g[I.parent().id]=I.parent(),g[m.id]=m,I.moveTo({parent:m,underlying:!0})),y[I.id]=!0,o.performAction(TrackerType.Move,{itemID:I.id,oldParent:p.id,oldPosition:P,newParent:m.id,newPosition:m.items().length-1})}else m=p,y[I.id]=y[p.id];for(var L=!1,O=I;O;){if(y[O.id]){L=!0;break}O=O.parent()}var R=I.getIndex()+1;if(L){var _=I.items(),N=0;for(C=0;C<_.length;C++){var F=_[C];if(!b[F.id]){if(t.hasClass(F.getElement(),"hidden"))continue;g[F.parent().id]=F.parent(),g[I.parent().id]=I.parent();var V=R+N;F.moveTo({parent:I.parent(),index:V,underlying:!0}),y[F.id]=!0,o.performAction(TrackerType.Move,{itemID:F.id,oldParent:I.id,oldPosition:C,newParent:I.parent().id,newPosition:V}),N++,C--}}}}}for(var B in g)g[B].items.valueHasMutated();if(i.isEnabled())i.updateInputBounds(a);else if(a||s){try{t.PAssert(1256,a&&s)}catch(h){t.reportError(h)}t.selectMultiline(a.getSpan(),l.start,s.getSpan(),u.end)}r.handled=!0;try{t.PAssert(1257,r.preventDefault,"Should always be defined")}catch(h){t.reportError(h)}return r.preventDefault&&r.preventDefault(),!1},f.handleEnter=function(e,a,s){var c=t.getItemForElement(a),d=c.parent(),l=d.items().indexOf(c),u=t.getSelectOffsetsInSpan(c,a,s);i.isEnabled()&&i.finishInput(!0);var h,m=c.getParsedText(),f=!1,g=d,v=!0;if(0===u.end)h=c.isNumList()?new n({text:NumListPrefix},{parent:g,forceSave:!0}):new n({text:""},{parent:g,forceSave:!0}),l--,v=!1;else if(u.start>=u.total){f=!e.shiftKey&&!c.isCollapsed()&&(c.items().length>0||c.isHeader()),f&&(g=c);var b="";c.isNumList()&&(b=NumListPrefix),h=new n({text:b},{parent:g,forceSave:!0})}else if(0===u.start&&u.end===u.total)h=new n({text:""},{parent:g,forceSave:!0}),c.setText("",!0),o.performAction(TrackerType.Remove,{itemID:c.id,position:0,text:m});else{var S=u.start>0?m.substring(0,u.startText):"";secondText=u.endText<m.length?m.substring(u.endText):"",c.isNumList()&&(secondText=NumListPrefix+secondText),h=new n({text:S},{parent:g,forceSave:!0}),c.setText(secondText,!0),o.performAction(TrackerType.Remove,{itemID:c.id,position:u.startText,text:m.substring(u.startText)}),h.copyProperties(c),l--,v=!1}h.parseText(!0),f?(c.insertItem(h,0),o.performAction(TrackerType.Create,{itemID:h.id,parent:c.id,position:0,text:h.getParsedText()})):(g.insertItem(h,l+1),o.performAction(TrackerType.Create,{itemID:h.id,parent:g.id,position:l+1,text:h.getParsedText()}));var T=v?h:c;try{t.PAssert(1259,T,"Expected another item to exist")}catch(x){t.reportError(x)}if(r.ios)return y.start=u.start,y.waitAutocorrect="enter",y.item=v?c:h,y.nextItem=v?h:c,p||(p=t.element("tempInput")),p.innerHTML=y.item.getStyledText(),t.selectMultiline(p,u.start,p,u.start),!0;if(i.isEnabled()){i.updateInput(T);try{t.PAssert(1260,e.preventDefault,"Should always be defined")}catch(x){t.reportError(x)}return e.preventDefault&&e.preventDefault(),!1}t.selectChildren(T,0,0);try{t.PAssert(1261,e.preventDefault,"Should always be defined")}catch(x){t.reportError(x)}return e.preventDefault&&e.preventDefault(),!1},f.handleBackspace=function(e,n,a){var s=t.getItemForElement(n),c=s.parent(),d=t.getSelectOffsetsInSpan(s,n,a);i.isEnabled()&&i.finishInput(!0),r.ie&&(e.preventDefault(),e.stopImmediatePropagation());var l=s.getParsedText(),u=(s.getSpan(),""),h=0;if(0===d.startText&&0===d.endText||""===l){var p=t.getPreviousItem(s,t.focusedPane),f=t.getNextItem(s,t.focusedPane);if(p&&(!p.isFullscreen()||""===l&&f)){var g=p.getParsedText().length;c.deleteChild(s,p,0),l.length>0&&""!==l&&(0===p.getParsedText().length&&p.copyProperties(s),p.setText(p.getParsedText()+l,!0),o.performAction(TrackerType.Insert,{itemID:p.id,position:g,text:l}));var v=p.isFullscreen()?p.getFirstChild():p,b=p.isFullscreen()?0:g;return t.selectChildren(v,b,0),!1}return!1}if(e.metaKey&&d.startText===l.length||0===d.startText&&d.endText===l.length)o.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:s.getParsedText()}),u="",h=0;else if(e.metaKey)u=l.substring(d.startText),o.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:l.slice(0,d.startText)}),h=0;else if((r.mac&&e.altKey||!r.mac&&e.ctrlKey)&&d.start===d.end){for(var S=l.substring(d.startText),T=!1,x=!1,w=d.startText-1;w>=0&&!x;w--)if(T=T||" "!==l[w],!(" "==l[w]&&" "==l[w-1]||0!==w&&" "!==l[w]&&"@"!==l[w])){var E=0===w||w===d.startText-1?w:w+1;(T||" "!==l[w])&&(o.performAction(TrackerType.Remove,{itemID:s.id,position:E,text:l.slice(E,d.startText)}),u=l.substring(0,E)+S,h=E,x=!0)}x||(d.startText===l.length?0===d.start&&(u="",o.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:l})):(o.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:l.slice(0,d.startText)}),u=S),h=0)}else if(1===d.start&&1===d.end&&1===l.length&&""!=l[0])o.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:s.getParsedText()}),u="",h=0;else{try{t.PAssert(1264,d.start>=0)}catch(M){t.reportError(M)}if(d.start!=d.end)o.performAction(TrackerType.Remove,{itemID:s.id,position:d.startText,text:l.slice(d.startText,d.endText)}),u=l.substr(0,d.startText)+l.substr(d.endText),h=d.start;else{var C=1;l.length>1&&""==l[d.startText-1]&&C++,u=l.substr(0,d.startText-C)+l.substr(d.startText),o.performAction(TrackerType.Remove,{itemID:s.id,position:d.startText-C,text:l.slice(d.startText-C,d.startText)}),h=d.startText-C}}return r.phone&&m!==KeyCode.BackSpace?(y.text=u,y.start=h,y.item=s,0===u.length&&(s.setStyledText(TextSpace+" ",!0),t.selectChildren(s,1,0)),!0):(s.setText(u,!0),t.selectChildren(s,h,0),!1)},f.handleDelete=function(i,n,a){var s=e.dataFor(n.parentNode),c=t.getSelectOffsetsInSpan(s,n,a);try{t.PAssert(1265,s)}catch(d){t.reportError(d)}{var l=s.parent(),u=s.getIndex(),h=s.getParsedText();s.getSpan()}if(""===h){var p=t.getNextItem(s,t.focusedPane),m=0;p||(p=t.getPreviousItem(s,t.focusedPane),m=p.getParsedText().length),p&&!p.isFullscreen()&&(s.hasChildren()?l.replaceChild(s,s.getFirstChild()):l.deleteChild(s,l,u),t.selectChildren(p,m,m))}else if(c.start===c.total&&c.end===c.total||c.start===c.total-1&&c.end===c.total-1&&""===n.textContent[c.endText]){var f=t.getNextItem(s,t.focusedPane);f&&(s.setText(h+f.getParsedText(),!0),o.performAction(TrackerType.Insert,{itemID:s.id,position:h.length,text:f.getParsedText()}),f.parent().deleteChild(f,s,0),t.selectChildren(s,c.total,0))}else if(0===c.start&&0===c.end&&1===h.length&&""!=h[0])s.setText("",!0),o.performAction(TrackerType.Remove,{itemID:s.id,position:0,text:h});else if((r.mac&&i.altKey||!r.mac&&i.ctrlKey)&&c.start===c.end){for(var g=h.substring(0,c.startText),v=!1,y=!1,b=c.startText;b<h.length&&!y;b++)if(v=v||" "!==h[b],b===h.length-1||" "===h[b]){var S=" "===h[b]&&" "==h[c.startText]?b:b+1;if(v||" "!==h[b]){var T=g+h.substring(S);s.setText(T,!0),o.performAction(TrackerType.Remove,{itemID:s.id,position:S,text:T}),t.selectChildren(s,c.start,0),y=!0}}}else if(c.start!=c.end){var T=h.substr(0,c.startText)+h.substr(c.endText);s.setText(T,!0),o.performAction(TrackerType.Remove,{itemID:s.id,position:c.startText,text:h.slice(c.startText,c.endText)}),t.selectChildren(s,c.start,0)}else{var T=h.substr(0,c.startText)+h.substr(c.startText+1);s.setText(T,!0),o.performAction(TrackerType.Remove,{itemID:s.id,position:c.startText,text:h.slice(c.startText,c.startText+1)}),t.selectChildren(s,c.start,0)}return!1},f}),define("AScript",["globals","platform","data","tracker","VMLI","edit"],function(e,t,r){function i(){this.hasSelection=!1,this.isTyping=!1,this.isRunning=!1,this.isDisabled=!1,this.activeScript=void 0,this.index=0,this.repeat=!1,this.onScriptDone=void 0,this.selectedItem=void 0,this.needsFinish=!1,this.lastCreatedItem=void 0,this.lastLoadedData=5,this._scriptQueue=[],this.startText={},window.addEventListener("message",function(t){if(t.data.indexOf("{")<0){var r=t.data.split(":");try{e.PAssert(1266,r.length>=0,"Invalid number of params in message")}catch(i){e.reportError(i)}switch(r[0]){case"script":this.finishAndRunScript(r[1]);break;case"data":this.loadScriptData(r[1])}}}.bind(this),!1),window.pauseScript=function(){this.isDisabled||(log("pause script"),this.isDisabled=!0)}.bind(this)}var n={Run:1,Reset:2};return i.prototype={runScript:function(t,r){if(!this.isDisabled){switch(t){case"power":this._scriptQueue.push(this.demoPower("power0",0)),this._scriptQueue.push(this.demoPower("power1",1)),this._scriptQueue.push(this.demoPower("power2",2)),this._scriptQueue.push(this.demoPower("power3",3)),this._scriptQueue.push(this.demoPower("power4",4));var i=this.createScript("delay");i.queue(n.Run,"delay",5e3),this._scriptQueue.push(i);break;case"main":this._scriptQueue.push(this.demoMain(t));break;case"mainp":this._scriptQueue.push(this.demoMain(t,!0));break;case"search":this._scriptQueue.push(this.demoSearch(t));break;case"power0":case"power1":case"power2":case"power3":case"power4":var o=parseInt(t.replace("power",""),10);this._scriptQueue.push(this.demoPower(t,o));break;case"p0":case"p1":case"p2":case"p3":case"p4":case"p5":var o=parseInt(t.replace("p",""),10);this._scriptQueue.push(this.demoPrioritize(t,o)),r=!1;break;case"f0":case"f1":case"f2":case"f3":case"f4":case"f5":var o=parseInt(t.replace("f",""),10);this._scriptQueue.push(this.demoFocus(t,o)),r=!1;break;case"indent":this._scriptQueue.push(this.demoIndent(t));break;case"none":return;default:try{e.PAssert(1267,!1,"Invalid script request")}catch(a){e.reportError(a)}}this.repeat=r,this.activeScript=this._scriptQueue[0],!this.isRunning&&this.activeScript&&(this.onScriptStart(this.activeScript),this.reset(),this.run())}},forceFinish:function(t){try{e.PAssert(1268,t,"Must supply a callback to force finish")}catch(r){e.reportError(r)}if(this.isRunning)this.needsFinish=!0,this.delayTimeout&&(clearTimeout(this.delayTimeout),this.delayCb(),this.delayCb=this.delayTimeout=void 0),this.onScriptDone=function(){this.needsFinish=!1,t(),this.onScriptDone=void 0}.bind(this);else{try{e.PAssert(1269,this.needsFinish===!1,"Should never be forcing a finish if not actively running")}catch(r){e.reportError(r)}t()}},finishAndRunScript:function(e){this._scriptQueue=[],this.repeat=!1,this.forceFinish(function(){this.runScript(e,!1)}.bind(this))},loadScriptData:function(t){function i(){this.lastLoadedData=t,e.vmMain.resetScrollOffsets(),r.loadDemoData(t,e.vmMain.changeRoot)}log("Load Script Data: ",t),this._scriptQueue=[],this.repeat=!1,this.lastLoadedData!==t&&i()},onScriptStart:function(e){e&&window.parent.postMessage(e.getName(),"*")},getRoot:function(){return r.getRootModel()
},getFirstItem:function(){return r.getRootModel().getChild(0)},setSelection:function(t,r,i,n){try{e.PAssert(1271,t,"Must provide a valid item to select")}catch(o){e.reportError(o)}e.focusedPaneID!==r&&e.vmMain.setFocusedPane(e.vmMain.panes[r]),void 0===i||null===i?i=0:0>i&&(i=t.getParsedText().length+i+1),e.selectChildren(t,i,0),this.hasSelection=!0,this.selectedItem=t,n&&n()},selectEndOfLine:function(e,t,r){this.setSelection(e,t,-1,r)},clearSelection:function(t){e.clearSelection(),this.hasSelection=!1,this.selectedItem=void 0,t&&t()},scrollTo:function(t,r,i){var n=e.vmMain.panes()[t];try{e.PAssert(1272,n,"Must have selected a valid pane")}catch(o){e.reportError(o)}n.setScrollOffset(r),i&&i()},setText:function(e,t,r){e.setText(t,!0),r&&r()},appendText:function(e,t,r){e.setText(e.getRawText()+t,!0),r&&r()},removeText:function(e,t,r){var i=e.getRawText().replace(t,"");e.setText(i,!0),r&&r()},setPriority:function(e,t,r){e.priority(t),r&&r()},setFlagged:function(e,t,r){e.isFlagged(t),r&&r()},setComplete:function(e,t,r,i){e.dateCompleted=r,e.isComplete(t),i&&i()},indent:function(t,r){var i={normCode:KeyCode.Tab,shiftKey:t};e.fireKeyEvent(void 0,i),r&&r()},_deleteChildren:function(e){for(var t=0;t<e.items().length;t++)this._deleteChildren(e.items()[t]),delete r.itemsById[e.items()[t].id]},clearChildren:function(e,t){this._deleteChildren(e),e.items.removeAll(),t&&t()},typeString:function(t,r,i,n){function o(){e.fireKeyEvent(void 0,{normCode:r.charCodeAt(c)}),++c>=r.length&&(s&&clearInterval(s),this.isTyping=!1,n&&n())}try{e.PAssert(1273,n,"typeString should always have a callback")}catch(a){e.reportError(a)}this.needsFinish&&(i=0),this.selectEndOfLine(t||this.lastCreatedItem,0);try{e.PAssert(1274,this.hasSelection,"Must set selection before typing")}catch(a){e.reportError(a)}try{e.PAssert(1275,!this.isTyping,"Must wait until previous typing is finished")}catch(a){e.reportError(a)}try{e.PAssert(1276,void 0!==r,"Must supply a string to be typed")}catch(a){e.reportError(a)}try{e.PAssert(1277,void 0!==i,"Must specify a delay between each typed character")}catch(a){e.reportError(a)}this.isTyping=!0;var s,c=0;s=setInterval(o.bind(this),i)},resetSearch:function(t){for(var r=0;r<e.vmMain.panes().length;r++)e.vmMain.panes()[r].vmSearch.setSearch("");t&&t()},hideAutoComplete:function(t){e.autocomplete&&e.autocomplete.hide(),t&&t()},setSearch:function(t,r,i){e.vmMain.panes()[r].vmSearch.setSearch(t),i&&i()},searchString:function(t,r,i,n,o){try{e.PAssert(1278,!this.isTyping,"Must wait until previous typing is finished")}catch(a){e.reportError(a)}try{e.PAssert(1279,void 0!==t,"Must supply a string to be typed")}catch(a){e.reportError(a)}try{e.PAssert(1280,void 0!==r,"Must specify a delay between each typed character")}catch(a){e.reportError(a)}this.isTyping=!0;var s=e.vmMain.panes()[n].vmSearch,c=i?"":s.search(),d=0,l=setInterval(function(){s.setSearch(c+t.substr(0,d+1)),++d>=t.length&&(clearInterval(l),this.isTyping=!1,o&&o())}.bind(this),r)},createItemAfter:function(t,r){t?this.setSelection(t,0,t.getParsedText().length):t=this.selectedItem||this.lastCreatedItem,e.fireKeyEvent(void 0,{normCode:KeyCode.Enter}),this.clearSelection(function(){var e;e=t.isHeader()?t.getChild(0):t.parent().getChild(t.getIndex()+1),this.lastCreatedItem=e,this.setSelection(e,0,-1,r)}.bind(this))},clickElement:function(t,r){try{e.PAssert(1281,t,"Requesting selection in an invalid element")}catch(i){e.reportError(i)}e.fireClickEvent(t,Button.Left),r&&r()},zoomItem:function(t,r){e.vmMain.zoomin(t,!1),r&&r()},openOutline:function(t,r){var i=e.vmMain.panes()[t];i.outlineVisible()||i.toggleOutlineVisibility(),r&&r()},closeOutline:function(t,r){var i=e.vmMain.panes()[t];i.outlineVisible()&&i.toggleOutlineVisibility(),r&&r()},openContextMenu:function(t,r){try{e.PAssert(1282,t,"Requesting selection in an invalid item")}catch(i){e.reportError(i)}var n=t.getElement().getBoundingClientRect(),o=n.left+150,a=n.top+10;e.menus.openItemMenu(t,{x:o,y:a}),r&&r()},closeContextMenu:function(t){e.menus.closeItemMenu(),t&&t()},hoverMenuItem:function(t,r){try{e.PAssert(1283,t,"Requesting selection in an invalid element")}catch(i){e.reportError(i)}try{e.PAssert(1284,!e.hasClass(t,"menuHover"),"Dont apply hover twice to an element")}catch(i){e.reportError(i)}e.addClass(t,"menuHover"),r&&r()},unhoverMenuItem:function(t,r){try{e.PAssert(1285,t,"Requesting selection in an invalid element")}catch(i){e.reportError(i)}try{e.PAssert(1286,e.hasClass(t,"menuHover"),"Cant unhover when not previously hovered")}catch(i){e.reportError(i)}e.removeClass(t,"menuHover"),r&&r()},delay:function(e,t){t&&(this.needsFinish?t&&t():(this.delayCb=t,this.delayTimeout=setTimeout(function(){this.delayCb=this.delayTimeout=void 0,t()}.bind(this),e)))},setPaneModeAnim:function(e,t,r){var i=document.getElementsByClassName("paneOptionsButton")[e];this.clickElement(i),this.delay(function(){var i=t===PaneMode.Timeline?"paneTimelineView":"paneListView",n=document.getElementsByClassName(i)[e];this.hoverMenuItem(n),this.delay(function(){this.clickElement(n),this.unhoverMenuItem(n),r&&r()}.bind(this),800)}.bind(this),300)},setPaneModeInstant:function(t,r,i){var n=e.vmMain.panes()[t];n.mode(r),i&&i()},addPane:function(t,r){e.vmMain.addPaneToRight(t),r&&r()},removePaneAnim:function(e,t){var r=document.getElementsByClassName("paneOptionsButton")[e];this.clickElement(r),this.delay(function(){var r=document.getElementsByClassName("paneClose")[e];this.hoverMenuItem(r),this.delay(function(){this.clickElement(r),this.unhoverMenuItem(r),t&&t()}.bind(this),800)}.bind(this),300)},removePaneInstant:function(t,r){var i=e.vmMain.panes()[t];e.vmMain.removePane(i),r&&r()},setSubtitle:function(t,r,i){var n=e.messageQueue.pushMessage({text:t,type:MessageType.Subtitle});setTimeout(function(){e.messageQueue.clearMessage(n),i&&i()}.bind(this),r)},createScript:function(e){var t={owner:this,_name:e,index:0,isResetting:!1,_repeat:!1,noDelay:!1,runQueue:[],resetQueue:[],_activeQueue:function(){return this.isResetting?this.resetQueue:this.runQueue},queue:function(e,t){var r=Array.prototype.slice.call(arguments,2),i=e==n.Run?this.runQueue:this.resetQueue;return i.push({name:t,args:r}),i},repeat:function(e){this._repeat=e},reset:function(){this.index=0;for(var e=0;e<this.resetQueue.length;e++){var t=this.resetQueue[e];this.owner[t.name].apply(this.owner,t.args)}},nextStep:function(){var e=this.runQueue;return e[this.index++]},getName:function(){return this._name}};return t},reset:function(){this.index=0;for(var e=0;e<this._scriptQueue.length;e++)this._scriptQueue[e].reset()},run:function(){if(!this.isDisabled){try{e.PAssert(1289,this.activeScript,"Must have a script active to be running")}catch(t){e.reportError(t)}var r=this.activeScript.nextStep();if(!r){if(this.index++,this.index>=this._scriptQueue.length){if(!this.repeat)return this.isRunning=!1,void(this.onScriptDone&&this.onScriptDone());this.reset()}this.activeScript=this._scriptQueue[this.index],this.activeScript.reset(),this.onScriptStart(this.activeScript),r=this.activeScript.nextStep()}var i=r.args;i.push(this.run.bind(this)),i.push(this.activeScript),this.isRunning=!0,setTimeout(function(){try{this[r.name].apply(this,i)}catch(t){e.reportError(t),this.onDisable()}}.bind(this),0)}},onDisable:function(){this.isDisabled=!0},demoIndent:function(e){var t=this.createScript(e),i=r.itemsById.itemIndent.model;return t.queue(n.Run,"delay",2e3),t.queue(n.Run,"setSelection",i,0,0),t.queue(n.Run,"indent",!1),t.queue(n.Run,"delay",2e3),t.queue(n.Run,"setSelection",i,0,0),t.queue(n.Run,"indent",!0),t},demoMain:function(e){var t=this.createScript(e);return t.queue(n.Run,"delay",500),t.queue(n.Reset,"delay",500),t;var t},demoSearch:function(e){var t=this.createScript(e),i=2e3,o=r.itemsById.searchItem.model;return t.queue(n.Run,"delay",i),t.queue(n.Run,"setSearch","#tag",0),t.queue(n.Run,"delay",i),t.queue(n.Run,"resetSearch"),t.queue(n.Run,"delay",i),t.queue(n.Run,"setSearch","!",0),t.queue(n.Run,"delay",i),t.queue(n.Run,"setSearch","!!!",0),t.queue(n.Run,"delay",i),t.queue(n.Run,"resetSearch"),t.queue(n.Run,"delay",i),t.queue(n.Run,"zoomItem",o),t.queue(n.Run,"delay",i),t.queue(n.Run,"setSearch","#tag",0),t.queue(n.Run,"delay",i),t.queue(n.Run,"zoomItem",this.getRoot()),t.queue(n.Run,"resetSearch"),t.queue(n.Run,"delay",i),t.queue(n.Run,"setSearch","+Jane",0),t.queue(n.Run,"delay",i),t.queue(n.Reset,"resetSearch"),t},loadItemAndReset:function(e,t){var i,o=r.itemsById[e].model;return i=this.startText[e]?this.startText[e]:this.startText[e]=r.itemsById[e].data.text,log("reset text = ",i),t.queue(n.Reset,"setText",o,i),t.queue(n.Reset,"setPriority",o,VMLIFlag.None),t.queue(n.Reset,"setFlagged",o,!1),t.queue(n.Reset,"setComplete",o,!1,void 0),o},demoPrioritize:function(e,t){var r=this.createScript(e),i=this.loadItemAndReset("yard",r),o=this.loadItemAndReset("roof",r),a=this.loadItemAndReset("vacation",r),s=this.loadItemAndReset("chips",r),c=this.loadItemAndReset("present",r),d=this.loadItemAndReset("shorts",r),l=this.loadItemAndReset("laptop",r),u=this.loadItemAndReset("app",r);return 0===t?(r.queue(n.Run,"appendText",i," @later"),r.queue(n.Run,"appendText",o," @soon"),r.queue(n.Run,"appendText",a," @later"),r.queue(n.Run,"appendText",s," @now"),r.queue(n.Run,"appendText",c," @now"),r.queue(n.Run,"appendText",d," @later"),r.queue(n.Run,"appendText",l," @soon"),r.queue(n.Run,"appendText",u," @now")):1===t?(r.queue(n.Run,"appendText",i," @next friday"),r.queue(n.Run,"appendText",o," @tomorrow"),r.queue(n.Run,"appendText",a," @"+Date.today().addDays(42).toString("M/dd")),r.queue(n.Run,"appendText",s," @today 6pm"),r.queue(n.Run,"appendText",c," @today 3pm"),r.queue(n.Run,"appendText",d," @"+Date.today().addDays(4).toString("M/dd")),r.queue(n.Run,"appendText",l," @"+Date.today().addDays(3).toString("M/dd")),r.queue(n.Run,"appendText",u," @today "+(new Date).toString("h:mmtt"))):2===t?(r.queue(n.Run,"setPriority",i,VMLIFlag.P2),r.queue(n.Run,"setPriority",o,VMLIFlag.P1),r.queue(n.Run,"setPriority",a,VMLIFlag.P2),r.queue(n.Run,"setPriority",s,VMLIFlag.P0),r.queue(n.Run,"setPriority",c,VMLIFlag.P0),r.queue(n.Run,"setPriority",d,VMLIFlag.P2),r.queue(n.Run,"setPriority",l,VMLIFlag.P1),r.queue(n.Run,"setPriority",u,VMLIFlag.P0)):3===t?(r.queue(n.Run,"setFlagged",s,!0),r.queue(n.Run,"setFlagged",c,!0),r.queue(n.Run,"setFlagged",u,!0)):4===t?(r.queue(n.Run,"setComplete",o,!0,(new Date).addDays(-2)),r.queue(n.Run,"setComplete",s,!0,(new Date).addMinutes(-10)),r.queue(n.Run,"setComplete",c,!0,(new Date).addMinutes(-10)),r.queue(n.Run,"setComplete",l,!0,(new Date).addDays(-11)),r.queue(n.Run,"setComplete",u,!0,new Date)):5===t&&(r.queue(n.Run,"appendText",i," @later"),r.queue(n.Run,"setPriority",o,VMLIFlag.P1),r.queue(n.Run,"appendText",a," @tomorrow"),r.queue(n.Run,"appendText",s," @today 6pm"),r.queue(n.Run,"appendText",c," @today 3pm"),r.queue(n.Run,"setPriority",c,VMLIFlag.P0),r.queue(n.Run,"setPriority",d,VMLIFlag.P2),r.queue(n.Run,"setComplete",l,!0,(new Date).addDays(-1)),r.queue(n.Run,"setFlagged",u,!0),r.queue(n.Run,"appendText",u," @now")),r},demoFocus:function(e,t){var r=this.createScript(e);return 0===t?r.queue(n.Run,"setSearch","#out",1):1===t?(r.queue(n.Run,"setSearch","!",1),r.queue(n.Run,"delay",2e3),r.queue(n.Run,"setSearch","!!!",1)):2===t?r.queue(n.Run,"setSearch","+Miller Harris",1):3===t?r.queue(n.Run,"setSearch","-//",1):4===t?r.queue(n.Run,"setSearch","Japan",1):5===t&&(r.queue(n.Run,"setSearch","!",1),r.queue(n.Run,"delay",1e3),r.queue(n.Run,"setSearch","! todo",1),r.queue(n.Run,"delay",1e3),r.queue(n.Run,"setSearch","! todo ! app",1),r.queue(n.Run,"delay",1e3),r.queue(n.Run,"setSearch","! todo ! app -jap",1)),r},demoPower:function(e,t){var i=this.createScript(e);if(0===t){var o=r.itemsById.groceriesItem.model;i.queue(n.Run,"delay",500),i.queue(n.Run,"resetSearch"),i.queue(n.Run,"createItemAfter",o),i.queue(n.Run,"indent",!1),i.queue(n.Run,"typeString",void 0,"Peaches",60),i.queue(n.Run,"createItemAfter",void 0),i.queue(n.Run,"typeString",void 0,"Apples",60),i.queue(n.Run,"createItemAfter",void 0),i.queue(n.Run,"typeString",void 0,"Almonds",60);var a=r.itemsById.vacationItem.model;i.queue(n.Run,"createItemAfter",a),i.queue(n.Run,"typeString",void 0,"Hotels",60),i.queue(n.Run,"createItemAfter",void 0),i.queue(n.Run,"typeString",void 0,"Cliff Cottage - $199 - View of beach",30),i.queue(n.Run,"createItemAfter",void 0),i.queue(n.Run,"typeString",void 0,"Beach Resort - $399 - On the beach",30),i.queue(n.Run,"delay",500),i.queue(n.Reset,"clearChildren",a),i.queue(n.Reset,"clearChildren",o),i.queue(n.Reset,"removeText",a,":"),i.queue(n.Reset,"removeText",o,":")}else if(1===t){var s=" @Fri 4pm",c=" @Tues 8pm",d=" @Monday",l=r.itemsById.movieItem.model;i.queue(n.Run,"delay",500),i.queue(n.Run,"resetSearch"),i.queue(n.Run,"typeString",l,s,40);var u=r.itemsById.movieItem2.model;i.queue(n.Run,"delay",500),i.queue(n.Run,"typeString",u,c,40);var h=r.itemsById.rentItem.model;i.queue(n.Run,"delay",500),i.queue(n.Run,"typeString",h,d,40),i.queue(n.Run,"delay",500),i.queue(n.Reset,"removeText",l,s),i.queue(n.Reset,"removeText",u,c),i.queue(n.Reset,"removeText",h,d),i.queue(n.Run,"delay",500),i.queue(n.Run,"resetSearch"),i.queue(n.Run,"hideAutoComplete"),i.queue(n.Run,"setPriority",h,VMLIFlag.P1),i.queue(n.Run,"delay",1e3);var o=r.itemsById.groceriesItem.model;i.queue(n.Run,"setPriority",o,VMLIFlag.P2),i.queue(n.Run,"delay",1e3);var p=r.itemsById.laptopItem.model;i.queue(n.Run,"setPriority",p,VMLIFlag.P0),i.queue(n.Run,"delay",1e3);var a=r.itemsById.vacationItem.model;i.queue(n.Run,"setFlagged",a,!0),i.queue(n.Run,"delay",1e3),i.queue(n.Reset,"setPriority",h,VMLIFlag.None),i.queue(n.Reset,"setPriority",o,VMLIFlag.None),i.queue(n.Reset,"setFlagged",a,!1)}else if(2===t){var m=" +Jay",f=" +Grant",g=" +Honey Bear",l=r.itemsById.movieItem.model;i.queue(n.Run,"delay",500),i.queue(n.Run,"resetSearch"),i.queue(n.Run,"typeString",l,m,50),i.queue(n.Run,"delay",1e3),i.queue(n.Run,"typeString",l,f,50),i.queue(n.Run,"delay",1e3);var o=r.itemsById.groceriesItem.model;i.queue(n.Run,"typeString",o,g,50),i.queue(n.Run,"delay",1e3),i.queue(n.Run,"hideAutoComplete"),i.queue(n.Reset,"removeText",l,m),i.queue(n.Reset,"removeText",l,f),i.queue(n.Reset,"removeText",o,g)}else if(3===t){var v=r.itemsById.todoItem.model;i.queue(n.Run,"resetSearch"),i.queue(n.Run,"delay",500),i.queue(n.Run,"openOutline",0),i.queue(n.Run,"delay",1e3),i.queue(n.Run,"zoomItem",v),i.queue(n.Run,"delay",300),i.queue(n.Run,"closeOutline",0),i.queue(n.Run,"delay",2e3),i.queue(n.Run,"openOutline",0),i.queue(n.Run,"delay",1e3),i.queue(n.Run,"zoomItem",this.getRoot()),i.queue(n.Run,"delay",300),i.queue(n.Run,"closeOutline",0),i.queue(n.Run,"delay",500),i.queue(n.Reset,"zoomItem",this.getRoot())}else if(4===t){{var y=" #out",o=r.itemsById.groceriesItem.model;o.getRawText()}i.queue(n.Run,"delay",500),i.queue(n.Run,"resetSearch"),i.queue(n.Run,"typeString",o,y,40),i.queue(n.Run,"delay",500);{var b=r.itemsById.shoppingItem.model;b.getRawText()}i.queue(n.Run,"typeString",b,y,40),i.queue(n.Run,"delay",1e3),i.queue(n.Run,"searchString","#out",40,!0,0),i.queue(n.Run,"delay",1500),i.queue(n.Run,"searchString"," !",40,!1,0),i.queue(n.Run,"delay",1500),i.queue(n.Run,"searchString"," -gro",40,!1,0),i.queue(n.Run,"scrollTo",0,0),i.queue(n.Run,"delay",1500),i.queue(n.Run,"searchString","!",40,!0,1),i.queue(n.Run,"delay",1e3),i.queue(n.Run,"searchString","!",40,!1,1),i.queue(n.Run,"delay",1e3),i.queue(n.Run,"searchString","!",40,!1,1),i.queue(n.Reset,"removeText",b,y),i.queue(n.Reset,"removeText",o,y),i.queue(n.Reset,"resetSearch"),i.queue(n.Reset,"scrollTo",0,30)}return i}},i}),define("VMSetup",["ko","data","globals","util","platform","goog","AScript"],function(e,t,r,i,n,o,a){function s(){this.loginState=e.observable(LoginState.NONE),this.loginEnabled=e.observable(!0),this.loginStatus=e.observable(""),o.gapiLoaded||(this.loginDisableTimeout=setTimeout(function(){this.loginEnabled(!1),this.loginStatus("Must be online to login")}.bind(this),1e3),window.addEventListener("gapiLoaded",function(){clearTimeout(this.loginDisableTimeout),this.loginEnabled(!0),this.loginStatus("")}.bind(this),!0))}return s.prototype={init:function(){if(r.isDemoMode())return LoginState.LOGGED_OUT;var e=r.getLoginState();return this.setLoginState(e),r.applyBindings(this,"setup"),window.addEventListener("offline",function(){log("Browser going offline."),r.vmMain.setGDriveStatus(DriveStatus.Offline)}),window.addEventListener("online",function(){if(log("Browser going online."),r.getLoginState()==LoginState.LOGGED_IN&&!n.offline){r.vmMain.setGDriveStatus(DriveStatus.Connecting);var e=o.goOnline();log("Coming online. Already online:",e)}}),e},logoutButtonText:function(){return r.isDemoMode()?"Leave Introduction":"Logout"},setLoginState:function(e){e!=this.loginState()&&(r.setLoginState(e),this.loginState(e))},userLogin:function(){o.runAuthenticate(o.requiredScopes,!1,!0,function(e){e&&!e.error?(r.settings.set(Settings.localIntegrity,!0),this.setLoginState(LoginState.LOGGED_IN),gapi.load("drive-realtime",function(){o.loadClientDefaultFile()})):log("Invalid token returned when calling userLogin")}.bind(this))},openLogin:function(){this.loginState(LoginState.NONE),r.StopSpinner()},logout:function(){r.settings.reset(),this.setLoginState(LoginState.LOGGED_OUT),t.clearData(function(){i.hasURLParam("login")?i.removeURLParam("login"):n.app?n.app&&n.sendToApp("logout"):r.reload()})},logoutClicked:function(){if(r.isDemoMode())i.removeURLParam("demo");else{var e=!0;for(var o in t.pendingRemoteUpdates)if(t.pendingRemoteUpdates.hasOwnProperty(o)){n.packagedApp||(e=confirm("You have unsaved changes which will be lost if you log out. Are you sure?"));break}e&&this.logout()}},isLocal:function(){return"localhost"==window.location.hostname},onlineStatusToggle:function(){n.offline?i.removeURLParam("offline"):i.insertURLParam("offline","true")},runScript:function(e){r.AScript||(r.AScript=new a),r.AScript.runScript(e,!0)},onTapLogin:function(){r.vmMain.isOnline()&&this.userLogin()},onTapInput:{onClick:function(e){n.ios&&(e.srcElement.focus(),r.enforceScroll())}},onTap:{onMove:function(e){e.diffY<0&&e.preventDefault()}},onTapLanding:function(){window.location.pathname="/about/"},onPrivacyPolicy:{onClick:function(){open("/privacy")}}},s}),define("kos",[],function(){return null}),define("parse",["globals","VMLI","tracker","data"],function(e,t,r,i){function n(e){for(var t={},r=0;r<e.childElementCount;++r){var i=e.children[r],n=i.nodeName;if(i.firstChild){var o=i.firstChild.textContent;t[n]=o}}return t}function o(e){if(e.parent=void 0,e.items)for(var t=0;t<e.items.length;t++)o(e.items[t])}var a={};return a.parseOPML=function(e,o){function a(e,r){var c=!0,d=void 0;switch(e.nodeName){case"#document":case"body":case"opml":break;case"head":c=!1;var l=n(e);l&&l.title&&!s&&(s=new t({text:l.title},{parent:i.getRootModel(),parse:!0,forceSave:!0}),i.getRootModel().insertItem(s));break;case"outline":r||(s?r=s:(r=s=new t({text:o},{parent:i.getRootModel(),parse:!0,forceSave:!0}),i.getRootModel().insertItem(s))),d=new t({text:e.attributes.text.value},{parent:r,parse:!0,forceSave:!0}),r.insertItem(d);break;default:log("Unknown OPML Node: ",e)}if(c)for(var u=0;u<e.childElementCount;++u)a(e.children[u],d);return d}var s;return r.beginAction(),a(e),r.endAction(),!0},a.parseJSON=function(e,n){function o(e,r){var a=r||n||i.getRootModel(),s={text:e.text,dateCompleted:e.dateCompleted,priority:e.priority,isComplete:e.isComplete,isFlagged:e.isFlagged},c=new t(s,{parent:a,parse:!0,forceSave:!0});if(a.insertItem(c),e.items)for(var d=0;d<e.items.length;++d)o(e.items[d],c)}var a;if(void 0!==e.moodoVer&&void 0!==e.moodoRoot)try{return a=parseInt(e.moodoVer),r.beginAction(),o(e.moodoRoot),r.endAction(),!0}catch(s){}else if(void 0!==e.text&&void 0!==e.items)try{return r.beginAction(),o(e),r.endAction(),!0}catch(s){}return!1},a.traverseDOM=function(e){function t(e){if(e.nodeType===Node.TEXT_NODE){(m||p)&&(u.text=u.text.trim(),""!==u.text&&(h={text:"",parent:u.parent},u.parent.items.push(h),u=h)),m=!1,p=!1;var t=e.nodeValue;""===u.text&&(t=e.nodeValue.replace(/^\s+/g,"")),u.text+=t}else e.nodeType===Node.COMMENT_NODE||("BR"==e.tagName||"P"==e.tagName||"LI"==e.tagName||"DIV"==e.tagName?p=!0:("UL"==e.tagName||"OL"==e.tagName)&&(p=!1,u.text=u.text.trim(),h={text:"",parent:u},u.items?u.items.push(h):u.items=[h],u=h))}function r(e){e.nodeType!==Node.TEXT_NODE&&("UL"==e.tagName||"OL"==e.tagName?(u=u.parent,m=!0):("DIV"==e.tagName||"P"==e.tagName)&&(p=!0))}function i(e,t){isNaN(t)&&(t=0);for(var r="",n=0;t>n;n++)r+="--";if(t&&console.log(r,e.text),e.items)for(var n=0;n<e.items.length;n++)i(e.items[n],t+1)}var n=e.root,a=e.stripParents,s=e.shouldPrint,d=n.firstChild,l={items:[]},u={text:"",parent:l};l.items.push(u);var h,p=!1,m=!1;do if(t(d),c=d.firstChild)d=c;else if(c=d.nextSibling)d=c;else{do c=d.parentNode.nextSibling,c?(r(d.parentNode),d=c):(d=d.parentNode,r(d));while(!c&&d&&d.parentNode);if(!c)break}while(d);return a&&o(l),s&&i(l),l},a}),define("copypaste",["ko","globals","platform","edit","VMLI","tracker","parse"],function(e,t,r,i,n,o,a){function s(e){try{t.PAssert(1291,e.preventDefault,"Should always be defined")}catch(r){t.reportError(r)}try{t.PAssert(1292,e.stopPropagation,"Should always be defined")}catch(r){t.reportError(r)}e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation()}function c(c){c.srcElement||(c.srcElement=c.target);var d=c&&c.clipboardData?c.clipboardData:window.clipboardData,l=r.ie?"Text":"text/plain",u="",h=t.getSelectionInfo();if(h&&h.selection){var p=h.selection.getRangeAt(0),m=t.getPaneForElement(c.srcElement);if(t.hasClass(c.srcElement,"search"))return(/text\/plain/.test(d.types)||r.ie)&&(c.srcElement.textContent=d.getData(l).replace(/[\r\n\t]/g,""),t.selectElement(c.srcElement,!0)),c.preventDefault(),!1;if(m){if(m.mode()!==PaneMode.Normal)return!1;var f=t.getSpanParent(p.startContainer),g=t.getSpanParent(p.endContainer);if(!f||!g){if(p.startContainer!=m.paneContent&&p.endContainer!=m.paneContent){try{t.PAssert(1293,!1,"There should always be something to paste into")}catch(v){t.reportError(v)}return}var y=m.addItemToPane("",0);f=g=y.getSpan(),t.selectChildren(y,0,0)}if(d&&d.getData){o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.Paste,data:[{value:!0}]}),s(c);var b;if(/text\/html/.test(d.types)){if(u=d.getData("text/html"),!u)return;var S,T=document.createElement("div"),x=u.replace(/[\n\t]/g," ").replace(/[\r]|<head(.|\s)*?\/head>|<script(.|\s)*?\/script>|<style(.|\s)*?\/style>/g,"").replace(/\s+/g," ").replace(/onload/gi,"never"),w=/<body(.|\s)*?\/body>/g;(S=w.exec(x))&&(x=S[0]),T.innerHTML=x,b=a.traverseDOM({root:T,shouldPrint:!1,stripParents:!0}),1===b.items.length&&""===b.items[0].text&&(b=b.items[0])}else if(/text\/plain/.test(d.types)||r.ie){u=d.getData(l).trim();var E,M=u.startsWith("<?xml "),C=u.startsWith("<?opml ");if((M||C)&&(E=t.loadXML(u)),E){if(M)return t.messageQueue.pushMessage({text:"We currently do not support pasting generic XML documents, try convering to OPML. If you need to import XML send us a message and we will work through your scenario with you.",type:MessageType.Error}),!1;if(C)return a.parseOPML(E,"OPML Import"),!1}else{if(u.startsWith("{")&&u.endsWith("}"))try{var I=JSON.parse(u),P=e.dataFor(f.parentElement),A=a.parseJSON(I,P);if(A)return!1}catch(k){}var x=u.replace(/[\t]/g," "),D=x.split("\n");b={items:[]};for(var L=0;L<D.length;L++)0!==D[L].length&&b.items.push({text:t.trimString(D[L]),parent:b})}}if(!b||0===b.items.length)return!1;try{t.PAssert(1294,void 0!==f&&void 0!==g,"Must have a valid selection to perform paste")}catch(v){t.reportError(v)}o.beginAction();var O,R,_=e.dataFor(f.parentElement),N=e.dataFor(g.parentElement),F=t.getSelectOffsetsInSpan(_,f,p),V=t.getSelectOffsetsInSpan(N,g,p),B=_.parent(),U=_.getIndex(),q=_.getParsedText(),H=N.getParsedText();_!=N&&i.handleMultiselect({},f,g,p);var W=_;if(b&&1===b.items.length&&!b.items[0].items){var K=b.items[0].text.trim(),j=q.substring(0,F.startText)+K+H.substring(V.endText);O=_.getSpan(),o.performAction(TrackerType.Remove,{itemID:_.id,position:0,text:_.getParsedText()}),_.setText(j,!0),o.performAction(TrackerType.Insert,{itemID:_.id,position:0,text:j}),R=F.start+K.length,t.selectChildren(_,R,0)}else{for(var G=(B.items(),[]),L=0;b&&L<b.items.length;++L){var z=b.items[L];if(z.text=z.text.trim(),""!==z.text||z.items)if(0===L){if(z.text[0]==q&&(z.text=z.text.substr(1)),z.text=q.substring(0,F.startText)+z.text,_.setText(z.text,!0),o.performAction(TrackerType.Insert,{itemID:_.id,position:0,text:z.text}),U++,z.items){for(var J=0;J<z.items.length;J++){var Y=z.items[J];(""!==Y.text||Y.items)&&_.insertItem(new n(Y,{parent:_,parse:!0,forceSave:!0}))}-1==G.indexOf(_)&&G.push(_)}}else{var X=new n(z,{parent:B,parse:!0,forceSave:!0});B.insertItem(X,U++,!0),-1==G.indexOf(B)&&G.push(B),o.performAction(TrackerType.Create,{itemID:X.id,parent:B.id,position:U-1,text:X.getParsedText()})}}for(L=0;L<G.length;L++)G[L].items.valueHasMutated();for(W=B.getChild(U-1);W.hasChildren();)W=W.getLastChild();R=W.getParsedText().length,W.setRawText(W.getParsedText()+H.substring(V.endText)),t.vmMain.runParseWorker(B,function(){setTimeout(function(){t.selectChildren(W,R,0)},0)})}}return o.endAction(),t.scrollIntoView(W.getSpan(),200),!1}}}function d(e){var t=!l(e);return t?(i.keydown(void 0,{normCode:KeyCode.BackSpace}),s(e),!1):!0}function l(i){var n=i&&i.clipboardData?i.clipboardData:window.clipboardData;if(n){i.srcElement||(i.srcElement=i.target);var a=t.getSelectionInfo();if(!a)return!0;var c=a.selection.getRangeAt(0).startContainer;if("#text"==c.nodeName&&(c=c.parentNode),"exportedArea"===i.srcElement.id||"exportedContent"===i.srcElement.id){var d=r.ie?"Text":"text/plain";n.setData(d,i.srcElement.textContent)}else{var l=t.elementInPane(c);if(!l||"searchDiv"===a.node.id||t.hasClass(a.node,"search"))return!0;t.restrictSelectionToText(),a=t.getSelectionInfo();var u=a.selection.getRangeAt(0);try{t.PAssert(1295,"#text"==u.startContainer.nodeName,"Expected #text, Actual: "+u.startContainer.tagName)}catch(h){t.reportError(h)}var p=t.getSpanParent(u.startContainer);try{t.PAssert(1296,"#text"==u.endContainer.nodeName||"SPAN"==u.endContainer.nodeName,"Expected #text or SPAN, Actual: "+u.endContainer.tagName)}catch(h){t.reportError(h)}var m=t.getSpanParent(u.endContainer),f=p.parentElement;try{t.PAssert(1297,"LI"==f.tagName,"Expected LI, Actual: ",f)}catch(h){t.reportError(h)}var g=m.parentElement;try{t.PAssert(1298,"LI"==g.tagName,"Expected LI, Actual: ",g)}catch(h){t.reportError(h)}var v=e.dataFor(f),y=e.dataFor(g),b=t.getSelectOffsetsInSpan(v,p,u);try{t.PAssert(1299,v)}catch(h){t.reportError(h)}var S,T,x=!r.ie,w=v.getParsedText().substring(b.startText);if(f==g)w=b.start==b.end?v.getParsedText():v.getParsedText().substr(b.startText,b.endText-b.startText),x&&(S=w),T=w;else{var E=0;E++,x&&(S="<ul><li>"+w+"</li>"),T=w;do{var M={numLevels:0};for(v=t.getNextItem(v,t.focusedPane,M),M.numLevels>0&&(x&&(S+="<ul>"),E++);M.numLevels<0&&E>=0;)x&&(S+="</ul>"),E--,M.numLevels++;if(0>=E&&(x&&(S+="<ul>"),E++),v!==y)w=v.getParsedText(),x&&(S+="<li>"+w+"</li>");else{var C=t.getSelectOffsetsInSpan(v,v.getSpan(),u);w=v.getParsedText().substring(0,C.endText),x&&(S+="<li>"+w+"</li></ul>"),E--}T+="\r\n"+w}while(v!==y);for(;E>0;)x&&(S+="</ul>"),E--}x&&S&&n.setData("text/html",S);var d=r.ie?"Text":"text/plain";n.setData(d,T)}}return s(i),o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.Copy,data:[{value:!0}]}),!1}var u={};return u.init=function(){try{t.PAssert(1290,"complete"===document.readyState||"interactive"===document.readyState,"Setting up copy/paste too early")}catch(e){t.reportError(e)}document.body.addEventListener("paste",c,!1),document.body.addEventListener("cut",d,!1),document.body.addEventListener("copy",l,!1)},u}),define("VMSearch",["ko","globals","platform","data","VMLI","tracker"],function(e,t,r,i,n,o){function a(t,r){this.elSearch=void 0,this.search=e.observable(r||""),this.isFocused=e.observable(!1),this.placeholderActive=e.observable(!0),this.searchLoaded=!1,this.pane=t,this.searchArr=[],this.matches={},this.hiddenItems={},this.numMatches=e.observable(0),this.previousSearch="",this.titles=e.observableArray(),this.initialized=!1,this.isPaneTimeline=t.mode()==PaneMode.Timeline,this.isSearchBoxSmall=e.observable(),this.onUpdated=e.observable()}return a.prototype={getSearchBox:function(){return this.elSearch},init:function(){try{t.PAssert(1300,!this.initialized)}catch(e){t.reportError(e)}if(!this.initialized){if(this.pane.showArchived.subscribe(function(){this.updateSearch()}.bind(this)),this.pane.mode.subscribe(function(){this.isPaneTimeline=this.pane.isTimeline()}.bind(this)),window.addEventListener("itemAdded",function(e){if(e.data.force||t.focusedPane.id!==this.pane.id){var r=this.checkItem(e.data.item);r===!0&&this.updateNumMatches(e.data.item,!0)}else t.focusedPane.id===this.pane.id&&this.updateNumMatches(e.data.item,!0)}.bind(this),!0),window.addEventListener("itemTextChanged",function(e){if(e.data.force||t.focusedPane.id!==this.pane.id){var r=e.data.item,i=this.matches[r.id],n=this.checkItem(r);(n===!0&&i!==!0||n!==!0&&i===!0)&&this.updateNumMatches(r,n===!0),this.checkChildren(r,!1,!0)}}.bind(this),!0),r.mobile||window.addEventListener("windowResize",this.checkSearchBoxSize.bind(this)),this.search())this.updateSearch();else{var i=0,n=this.isPaneTimeline&&this.pane.showArchived();t.searchVMLIs({item:this.pane.item(),includeArchived:n,each:function(e){var t=this.amountIncrementNumMatches(e,!0);t&&(i+=t)}.bind(this)}),this.setNumMatches(i)}this.initialized=!0}},onLoad:function(e){this.elSearch=e,this.elSearchWrap=e.parentNode,this.elAutocomplete=t.getElementByClassName("searchAutocomplete",this.elSearchWrap),this.elSearch.addEventListener("focus",this.onfocus.bind(this),!1),this.elSearch.addEventListener("blur",this.onblur.bind(this),!1),this.search()?setTimeout(function(){this.setDisplayText(this.search()),this.searchLoaded=!0}.bind(this),0):setTimeout(function(){this.searchLoaded=!0}.bind(this),0)},checkSearchBoxSize:function(){try{t.PAssert(1301,!r.mobile,"Only update search box size on non-mobile platforms")}catch(e){t.reportError(e)}if(this.isFocused()){var i=this.elAutocomplete.getBoundingClientRect(),n=this.elSearchWrap.getBoundingClientRect(),o=this.pane.scrollElement.getBoundingClientRect();o.right-n.left-10<i.width?(this.elAutocomplete.style.right=0,this.elAutocomplete.style.left="auto"):n.left<40?(this.elAutocomplete.style.left=0,this.elAutocomplete.style.right="auto"):(this.elAutocomplete.style.left="auto",this.elAutocomplete.style.right="auto")}},onfocus:function(){this.isFocused(!0),t.vmMain.setFocusedPane(this.pane),r.phone?t.sendEvent("SearchFocus","Mobile"):(this.clearPlaceholder(),this.checkSearchBoxSize(),t.sendEvent("SearchFocus","Desktop"))},onblur:function(){this.isFocused(!1),t.fireCustomEvent("closeKeyboard"),""===this.getDisplayText()?this.setDisplayText(TextSpace):this.getDisplayText()===TextSpace&&this.setDisplayToPlaceholder(),t.clearSavedSelection("StoredSearch")},focusBox:function(){t.vmMain.setFocusedPane(this.pane),t.keyboardToolbar&&t.keyboardToolbar.preShow(),this.getSearchBox().focus(),t.enforceScroll(),t.keyboardToolbar&&t.keyboardToolbar.show()},blurBox:function(){this.getSearchBox().blur()},focusAndSelectEnd:function(){this.focusBox(),t.selectElement(this.elSearch,!0)},resetSearch:function(){this.search(""),this.setDisplayText(TextSpace);for(var e in this.matches)this.updateMatchState(i.getModel(e),void 0,void 0);this.matches[this.pane.item().id]=!1,this.updateSearch()},setSearch:function(e){this.setDisplayText(e||TextSpace),this.search(e),this.updateSearch()},addToSearch:function(e){if(e){var t=this.search()+" "+e;this.setDisplayText(t||TextSpace),this.search(t),this.updateSearch()}},isSearching:function(){return this.search().length>0},isShowing:function(){return this.isFocused()||this.isSearching()},isMatched:function(e){return(void 0===this.matches[e.id]||!!this.matches[e.id])&&-1!==this.matches[e.id]},isVisible:function(e){return!this.hiddenItems[e.id]
},hideItem:function(e,r){if(r){var i=e.getOutlineElement(this.pane.id);i&&t.addClass(i,"hidden")}else{var n=e.getElement(this.pane.id);n&&(t.addClass(n,"hidden"),this.hiddenItems[e.id]=!0)}},showItem:function(e,r){if(r){var i=e.getOutlineElement(this.pane.id);i&&t.removeClass(i,"hidden")}else{var n=e.getElement(this.pane.id);n&&(this.hiddenItems[e.id]=!1,t.removeClass(n,"hidden"))}},updateMatchState:function(e,r){var i=!1;if(e!=this.pane.item.peek()&&e!=t.vmMain.root.peek()){if(e){var n=this.matches[e.id];this.matches[e.id]=r,n===r||void 0===n&&r===!0||(i=!0,this.isPaneTimeline&&this.pane.notifySearchStateChanged(e,r))}return i}},amountIncrementNumMatches:function(e,r){return e==this.pane.item.peek()||e==t.vmMain.root.peek()?0:r?1:-1},updateNumMatches:function(e,r){var i=this.amountIncrementNumMatches(e,r);i&&this.setNumMatches(this.numMatches()+i);try{t.PAssert(1302,this.numMatches()>=0)}catch(n){t.reportError(n)}},setNumMatches:function(e){var t=this.numMatches();t!==e&&(this.numMatches(e),this.pane.paneContent&&!!t!=!!e&&this.pane.setNoItems(!!e))},isMatch:function(e,t,r){var i=!0;return r.indexOf("!")>=0&&(i=e.priority()>=VMLIFlag.P2,r.indexOf("!!")>=0&&(i=e.priority()>=VMLIFlag.P1,r.indexOf("!!!")>=0&&(i=e.priority()>=VMLIFlag.P0)),r=r.replace(/!/g,"")),r.indexOf("''")>=0&&i&&(i=e.isFlagged()&&!e.isComplete(),r=r.replace(/\'/g,"")),r.indexOf("//")>=0&&i&&(i=e.isComplete(),r=r.replace(/\//g,"")),r.length>0&&i&&(i=t.indexOf(r)>=0),i},checkItem:function(e,r,n){for(var o,a=r?t.vmMain.root.peek():this.pane.item.peek(),s=!0,c=e.getSearchText(),d=0;d<this.searchArr.length;d++){var l=this.searchArr[d],u=l.isNegated;if(u){var h=l.text;try{t.PAssert(1303,h,"Each value in the search array should be valid at this point")}catch(p){t.reportError(p)}var m=this.isMatch(e,c,h);if(m){s=-1;break}}}if(s===!0)for(var d=0;d<this.searchArr.length;d++){var l=this.searchArr[d],u=l.isNegated,h=l.text;try{t.PAssert(1304,h,"Each value in the search array should be valid at this point")}catch(p){t.reportError(p)}if(!u){var m=this.isMatch(e,c,h);if(!m)for(o=e;o;){if(o=o.parent(),!o||o==i.getRootModel()){s=!1;break}if(this.isMatch(o,o.getSearchText(),h))break}}if(s!==!0)break}if(s===!0&&e.isLoaded){var f=e,g=this.matches[e.id];for(this.updateMatchState(e,!0,r);f;){if(-1===this.matches[f.id]){this.matches[e.id]=!1;break}if(f.isLoaded&&this.showItem(f,r),f==a)break;if(f=f.parent()){if(this.matches[f.id]===!0)break;g=this.matches[f.id]}}n&&!r&&this.search()&&this.updateNumMatches(e,!0)}else if(e.isLoaded){{this.updateMatchState(e,s,r)}this.hideItem(e,r)}return this.matches[e.id]},checkChildren:function(e,r,i){var n=this.numMatches();r&&(n=0);var o=this.isPaneTimeline&&this.pane.showArchived();t.searchVMLIs({item:e,includeArchived:o,each:function(e){var t=this.matches[e.id],o=this.checkItem(e);if(r&&o===!0||i&&(o===!0&&t!==!0||o!==!0&&t===!0)){var a=this.amountIncrementNumMatches(e,o===!0);a&&(n+=a)}}.bind(this)}),this.setNumMatches(n)},checkChildrenOutline:function(){this.isPaneTimeline&&this.pane.showArchived();t.searchVMLIs({headers:!0,each:function(e){this.checkItem(e,!0)}.bind(this)})},updateSearch:function(e){if(e===!0||this.search()!=this.previousSearch){this.searchLoaded&&t.vmMain.updatePaneState(this.pane);var i=this.search().toLowerCase().trim().split(/\s+/);i=i.filter(function(e){return!(!e||"-"===e)}),this.searchArr=[];for(var n=0;n<i.length;++n){var o=i[n].startsWith("-"),a=o?i[n].substr(1):i[n];this.searchArr.push({text:a,isNegated:o})}this.search()?(this.pane.isSearching=!0,r.mobile&&this.clearPlaceholder()):(this.pane.isSearching=!1,r.mobile&&this.setDisplayToPlaceholder()),this.previousSearch=this.search(),this.matches[this.pane.item().id]=!1,this.initialized&&(this.checkChildren(this.pane.item(),!0),this.checkChildrenOutline()),this.onUpdated.valueHasMutated()}},keydown:function(e,r){if(r.normCode===KeyCode.Enter)return!1;if(r.normCode===KeyCode.BackSpace){var i=this.getDisplayText();if(""===i||i===TextSpace)return!1;if(r.metaKey)this.setDisplayText(TextSpace);else{var n=t.getSelectionRange();0===n.startOffset&&n.endOffset===i.length&&this.setDisplayText(TextSpace)}}return!0},keyup:function(e,i){var n=this.getDisplayText();if(r.mobile||""!==n||this.setDisplayText(TextSpace),i.normCode===KeyCode.Escape)t.selectElement(this.elSearch,!1);else{var a=n.replace(TextSpace,"").replace("\n","");this.search(a),o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SearchChanged,data:[{pane:this.pane.id,text:a}]});var s=i.normCode===KeyCode.Enter;if(this.updateSearch(s),r.mobile||this.checkSearchBoxSize(),i.normCode===KeyCode.Enter)if(r.android&&t.keyboardToolbar)t.clearSavedSelection("StoredSearch"),t.clearSelection();else if(!t.restoreSavedSelection("StoredSearch",t.focusedPane)){var c=t.focusedItem.getFirstChild();c&&(t.selectChildren(c,0,0),t.scrollIntoView(c.getSpan(),0))}}return!0},insert:function(e,r){var i=t.getSelectionRange(),n=i.startOffset;1===n&&this.getDisplayText()===TextSpace&&n--;try{t.PAssert(1305,this.search().indexOf(TextSpace)<0,"TextSpace should never be in the search string")}catch(a){t.reportError(a)}var s=this.search().replace(TextSpace,"");if(r&&s.length>0){var c=s[n-1];" "!==c&"-"!==c&&(e=" "+e)}var d=e.length,l=s.substr(0,i.startOffset)+e+s.substr(i.endOffset);this.search(l),o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SearchChanged,data:[{pane:this.pane.id,text:l}]}),this.setDisplayText(l),this.updateSearch(),t.setSelection(this.elSearch,n+d,n+d)},onTapAutocomplete:{onStart:function(e){e.preventDefault()}},onTapSearchInsert:{onStart:function(e){e.preventDefault()},onClick:function(e){var r=e.srcElement.className;switch(0!==r.indexOf("search")&&(r=e.srcElement.parentNode.className),r){case"searchNegate":var i=t.getSelectionRange();if(i.startOffset!==i.endOffset){var n=i.startOffset,o=i.endOffset;this.getDisplayText[0]===TextSpace&&(n>0&&n--,o--);var a=this.search();if("-"!==a[n]){var s=a.substring(0,n)+"-"+a.substring(n);this.setSearch(s),t.setSelection(this.elSearch,n,o+1)}else{var s=a.substring(0,n)+a.substring(n+1);this.setSearch(s),t.setSelection(this.elSearch,n,Math.max(0,o-1))}}else this.insert("-",!0);break;case"searchP2":this.insert("!",!0);break;case"searchP1":this.insert("!!",!0);break;case"searchP0":this.insert("!!!",!0);break;case"searchFlagged":this.insert("''",!0);break;case"searchComplete":this.insert("//",!0)}t.sendEvent("Menu",r)}},requestFocusBoxForEvent:function(e){var t=document.activeElement;t&&"searchPhone"==t.id||(this.open(),e.preventDefault())},onTapBox:{onClick:function(e){r.mobile?(t.phoneMenu.activeScreen()!==Screens.Settings&&t.phoneMenu.mode()==t.phoneMenu.Modes.Normal&&this.open()&&e.stopImmediatePropagation(),e.preventDefault()):this.requestFocusBoxForEvent(e)}},onTapX:{onStart:function(e){e.handled=!0,e.preventDefault()},onClick:function(e){this.isSearchActive()?(this.resetSearch(),e.preventDefault(),t.sendEvent("Menu","ClearSearch")):(this.requestFocusBoxForEvent(e),t.sendEvent("Menu","FocusSearch"))}},isSearchActive:function(){return 0!==this.search().length},getTitleText:function(){return this.isSearchActive()?"Clear Search":"Search"},getSearchIcon:function(){return this.isSearchActive()?"icon-remove":"icon-search"},open:function(){return this.isFocused()?void 0:(r.mobile?this.focusAndSelectEnd():this.focusBox(),!0)},getDisplayText:function(){return this.elSearch.textContent},setDisplayText:function(e){try{t.PAssert(1306,void 0!==e&&""!==e||r.mobile,"Search text should always be defined, either with a TextSpace or actual text")}catch(i){t.reportError(i)}this.elSearch.textContent=e,this.placeholderActive(e===TextSpace&&r.mobile?!0:!1)},setDisplayToPlaceholder:function(){this.placeholderActive(!0),this.elSearch.textContent=TextSpace},clearPlaceholder:function(){this.placeholderActive(!1)}},a}),define("VMTitle",["ko","globals","data","tracker","platform"],function(e,t){function r(t){this.text=t.text,this.item=t.item,this.home=t.home,this.isTruncated=e.observable(!1),this.pane=t.pane,this.init(t)}return r.prototype={init:function(){this.text=this.item.getParsedText(),this.text.length>25&&(this.text=this.text.substr(0,25),this.isTruncated(!0))},onTap:{onStart:function(e){e.handled=!0,t.vmMain.setFocusedPane(this.pane)},onClick:function(e){t.focusedPane.onTapTitle.onClick.call(t.focusedPane,e,this.item)}}},r}),define("VMTimelineBlock",["ko","globals","data","VMLI"],function(e,t){function r(t){this.owner=t.owner,this.date=t.date,this.dateKey=t.dateKey,this.text=t.text,this.name=t.name,this.searchProvider=void 0,this.items=e.observableArray(),this.searchCount=e.observable(0),this.hasDeferredUpdate=!1,this.element=void 0,this.timeCount=e.observable(0),this.isFlagged=t.isFlagged,this.isImportant=t.isImportant,this.isToday=!1,this.init(t)}return r.prototype={showBlock:function(){return this.items().length>0&&this.searchCount()>0},specialClass:function(){return this.isFlagged?"flaggedBlock":this.isImportant?"importantBlock":this.isToday||this.isNow?"todayBlock":void 0},showTime:function(e){var t=e.$data,r=e.$index;if(this.isNow)return!1;this.searchProvider.onUpdated();if(0===this.timeCount()||this.isFlagged||this.isImportant||!this.searchProvider.isVisible(t))return!1;for(var i=r()-1;i>0&&!this.searchProvider.isVisible(this.items()[i]);)i--;if(0>i)return!0;var n=this.items()[i];if(t.hasTime()){if(0===this.compareDate(n,t))return!1}else if(!n.hasTime())return!1;return!0},processDeferredUpdates:function(){this.hasDeferredUpdate&&(this.hasDeferredUpdate=!1)},init:function(e){try{t.PAssert(1307,this.date)}catch(r){t.reportError(r)}if(this.dateKey||(this.dateKey=this.date.clone().clearTime().getTime(),e.name&&(this.dateKey=this.dateKey+e.name)),this.name)this.text=this.name.toUpperCase(),"NOW"==this.name&&(this.isNow=!0);else{if(this.text="",this.date){var i=Math.floor((this.date-Date.today())/864e5);switch(i){case-1:this.text="YESTERDAY ";break;case 0:this.text="TODAY ",this.isToday=!0;break;case 1:this.text="TOMORROW ";break;default:this.text=this.date.toString("dddd").toUpperCase()}}this.text=this.text+" "+this.date.toString("M/d")}},comparePriority:function(e,t){var r=e.priority(),i=t.priority();return r>i?-1:i>r?1:0},compareDate:function(e,t){if(e.isComplete()&&!t.isComplete())return-1;if(!e.isComplete()&&t.isComplete())return 1;if(e.isComplete()&&t.isComplete())return e.dateCompleted>t.dateCompleted?1:-1;if(e.date()&&!t.date())return-1;if(!e.date()&&t.date())return 1;var r=new Date(e.date()),i=r.toString("h:mmtt"),n=new Date(t.date()),o=n.toString("h:mmtt");return"12:00am"!=i&&"12:00am"!=o?isNaN(r.getYear())||isNaN(n.getYear())?0:Date.compare(r,n):"12:00am"!=i?-1:"12:00am"!=o?1:0},compareOrder:function(e,r){var i=t.getFirstItem(e,r);try{t.PAssert(1308,void 0!==i)}catch(n){t.reportError(n)}return i.id==e.id?-1:1},compareItems:function(e,r){var i=this.isFlagged||this.isImportant?0:this.compareDate(e,r);if(0===i){var n=this.isFlagged?0:this.comparePriority(e,r);if(0===n){var o=this.compareOrder(e,r);try{t.PAssert(1309,0!==o,"This should always result in a tie break")}catch(a){t.reportError(a)}return o}return n}return i},addItem:function(e){return this.items.indexOf(e)>=0?void this.updateItem(e):(this.searchProvider.isMatched(e)&&(this.searchCount(this.searchCount()+1),e.hasTime()&&this.timeCount(this.timeCount()+1)),void(this.owner.deferModelUpdates?(this.items().insertSorted(e,this.compareItems.bind(this)),this.hasDeferredUpdate=!0):this.items.insertSorted(e,this.compareItems.bind(this))))},removeItem:function(e){this.searchProvider.isMatched(e)&&(this.searchCount(this.searchCount()-1),e.hasTime()&&this.timeCount(this.timeCount()-1)),this.owner.deferModelUpdates?(this.items().remove(e),this.hasDeferredUpdate=!0):this.items.remove(e)},updateItem:function(e){this.owner.deferModelUpdates?(this.items().remove(e),this.items().insertSorted(e,this.compareItems.bind(this)),this.hasDeferredUpdate=!0):(this.items.remove(e),this.items.insertSorted(e,this.compareItems.bind(this)));for(var t=0,r=0;r<this.items().length;r++)this.items()[r].hasTime()&&t++;this.timeCount(t)},onLoad:function(e){this.element=e},notifySearchStateChanged:function(e,r){try{t.PAssert(1310,void 0!==r||this.searchProvider,"Must supply a value or a valid search provider")}catch(i){t.reportError(i)}void 0===r&&(r=this.searchProvider.isMatched(e)),r===!0?(this.searchCount(this.searchCount()+1),e.hasTime()&&this.timeCount(this.timeCount()+1)):(this.searchCount(this.searchCount()-1),e.hasTime()&&this.timeCount(this.timeCount()-1))},setSearchProvider:function(e){this.searchProvider=e}},r}),define("VMPane_Timeline",["ko","globals","data","VMTimelineBlock"],function(e,t,r,i){var n={initTimeline:function(){this.blocks=e.observableArray(),this.blockImportant=void 0,this.blockStarred=void 0,this.days={},this.updateNextTimeout=0,this.datesByItem={},this.flaggedItems={},this.priorityItems={},this.isLoading=!1,this.deferModelUpdates=0;var t=this;this.showArchived.subscribe(function(e){t.reloadTimeline()})},hasBlocks:function(){for(var e=0,t=0;t<this.blocks().length;t++)e+=this.blocks()[t].searchCount();return e>0},reasonEmpty:function(){return this.vmSearch&&this.vmSearch.search().length>0?"No search results":"Nothing on the agenda"},blockCompare:function(e,t){return e.isNow&&t.isToday?-1:e.isToday&&t.isNow?1:Date.compare(e.date,t.date)},removeDate:function(e){var t=this.datesByItem[e.id];t.removeItem(e),this.datesByItem[e.id]=void 0},addBlock:function(e){e.setSearchProvider(this.vmSearch),this.deferModelUpdates?this.blocks().insertSorted(e,this.blockCompare):this.blocks.insertSorted(e,this.blockCompare)},dumpBlocks:function(){log("Dump Timeline Blocks:");for(var e=0;e<this.blocks().length;++e){var t=this.blocks()[e];log("  Block: ",t.text),log("  Count: ",t.searchCount);for(var r=0;r<t.items().length;++r){var i=t.items()[r];log("    Item: ",i.getParsedText())}}},findNextBlock:function(){for(var e=new Date,t=0;t<this.blocks().length;t++){var r=this.blocks()[t];if(r.isToday||r.isFlagged||r.isImportant||r.date>e)return r}},hideDescendants:function(e){for(var t=0;t<e.items().length;t++){var r=e.items()[t];this.datesByItem[r.id]&&this.removeDate(r),this.flaggedItems[r.id]&&(this.blockStarred.removeItem(r),this.flaggedItems[r.id]=void 0),this.priorityItems[r.id]&&(this.blockImportant.removeItem(r),this.priorityItems[r.id]=void 0),r.items().length>0&&this.hideDescendants(r)}},notifyDescendants:function(e){for(var t=0;t<e.items().length;t++){var r=e.items()[t];this.notifyStateChanged(r),r.items().length>0&&this.notifyDescendants(r)}},notifyPositionChanged:function(e){this.mode()===PaneMode.Timeline&&(this.isLoading||(this.datesByItem[e.id]&&this.datesByItem[e.id].updateItem(e),this.flaggedItems[e.id]&&this.blockStarred.updateItem(e),this.priorityItems[e.id]&&this.blockImportant.updateItem(e)))},notifySearchStateChanged:function(e,t){this.mode()===PaneMode.Timeline&&(this.isLoading||(this.datesByItem[e.id]&&this.datesByItem[e.id].notifySearchStateChanged(e,t),this.flaggedItems[e.id]&&this.blockStarred.notifySearchStateChanged(e,t),this.priorityItems[e.id]&&this.blockImportant.notifySearchStateChanged(e,t)))},notifyStateChanged:function(e,i){if(this.mode()===PaneMode.Timeline&&!this.isLoading&&!e.hasCompletedAncestor()){var n=r.getItem(e.id);try{t.PAssert(1311,!n||!!n.isDeleted==!!e.isDeleted||t.isDemoMode(),"isDeleted should match loaded item and item info")}catch(o){t.reportError(o)}if(this.vmSearch.checkItem(e),n&&n.isDeleted){var a=this.datesByItem[e.id];a&&a.removeItem(e),e.isImportant()&&this.updateSpecialBlock(e,this.priorityItems,this.blockImportant,!1),e.isFlagged()&&this.updateSpecialBlock(e,this.flaggedItems,this.blockStarred,!1)}else{if(!i||t.isAtLeastOneFlagSet(i,PropChangeType.Date|PropChangeType.Complete|PropChangeType.Archive))if(e.date()||e.isComplete()){var s=e.date()?e.date():e.dateCompleted;this.dateUpdated(e,s)}else{var c=this.datesByItem[e.id];c&&this.removeDate(e)}t.isAtLeastOneFlagSet(i,PropChangeType.Complete|PropChangeType.Archive)&&(e.isComplete()||e.isArchived()?this.hideDescendants(e):this.notifyDescendants(e)),(!i||t.isAtLeastOneFlagSet(i,PropChangeType.Priority|PropChangeType.Complete|PropChangeType.Archive))&&this.updateSpecialBlock(e,this.priorityItems,this.blockImportant,e.isImportant()&&!e.isComplete()),(!i||t.isAtLeastOneFlagSet(i,PropChangeType.Flagged|PropChangeType.Complete|PropChangeType.Archive))&&this.updateSpecialBlock(e,this.flaggedItems,this.blockStarred,e.isFlagged()&&!e.isComplete())}}},updateSpecialBlock:function(e,t,r,i){!i||e.isDeleted||e.isArchived()&&!this.showArchived()?t[e.id]&&(r.removeItem(e),t[e.id]=void 0):t[e.id]?r.updateItem(e):(r.addItem(e),t[e.id]=e)},dateUpdated:function(e,r,n){if(this.mode()===PaneMode.Timeline&&!this.isLoading){if(e.isArchived()&&!this.showArchived())return void(this.datesByItem[e.id]&&this.removeDate(e));if(this.vmSearch.checkItem(e),r){var o,a=t.isDateSoft(e.dateText);o=a?e.dateText.toUpperCase():r.clone().clearTime().getTime();var s=this.days[o];if(!s&&!this.days[o]){var c={owner:this,date:r.clone().clearTime(),dateKey:o};a&&(c.name=o);var s=new i(c);this.days[o]=s,this.addBlock(s,n)}if(s){var d=this.datesByItem[e.id];d?d.dateKey!==o&&(this.removeDate(e),this.datesByItem[e.id]=s):this.datesByItem[e.id]=s,this.days[o].addItem(e)}}else this.datesByItem[e.id]&&this.removeDate(e)}},ensureSpecialBlocks:function(){this.blockStarred||(this.blockStarred=new i({owner:this,name:"Flagged",date:Date.today().add({hour:1}),isFlagged:!0}),this.addBlock(this.blockStarred)),this.blockImportant||(this.blockImportant=new i({owner:this,name:"Important",date:Date.today().add({hour:2}),isImportant:!0}),this.addBlock(this.blockImportant))},loadTimeline:function(){try{t.PAssert(1312,this.mode()==PaneMode.Timeline)}catch(e){t.reportError(e)}try{t.PAssert(1313,0===this.blocks().length,"When loading the timeline we expect it to be empty")}catch(e){t.reportError(e)}this.setDeferUpdates(!0),this.ensureSpecialBlocks(),t.searchVMLIs({item:this.item(),includeArchived:this.showArchived(),each:this.notifyStateChanged.bind(this)}),this.setDeferUpdates(!1),this.vmSearch.onUpdated.valueHasMutated()},unloadTimeline:function(){this.datesByItem={},this.flaggedItems={},this.priorityItems={},this.days={},this.deferModelUpdates?this.blocks().splice(0,this.blocks().length):this.blocks([]),this.blockStarred=void 0,this.blockImportant=void 0},reloadTimeline:function(){this.mode()===PaneMode.Timeline&&(this.reloading=!0,this.unloadTimeline(),this.loadTimeline(),this.reloading=!1)},setDeferUpdates:function(e){try{t.PAssert(1315,this.mode()==PaneMode.Timeline)}catch(r){t.reportError(r)}this.deferModelUpdates+=e?1:-1;try{t.PAssert(1316,this.deferModelUpdates>=0,"Mismatching defer update calls")}catch(r){t.reportError(r)}if(0===this.deferModelUpdates){for(var i=this.blocks().length,n=0;i>n;++n)this.blocks()[n].processDeferredUpdates();this.blocks.valueHasMutated()}},startLoading:function(){if(this.mode()===PaneMode.Timeline){try{t.PAssert(1317,!this.isLoading,"Should only notify the timeline a single time when loading starts")}catch(e){t.reportError(e)}this.isLoading=!0}},endLoading:function(){if(this.mode()===PaneMode.Timeline){try{t.PAssert(1318,this.isLoading,"Must have started loading the timeline to stop loading it")}catch(e){t.reportError(e)}this.isLoading=!1,this.setDeferUpdates(!0),this.reloadTimeline(),this.setDeferUpdates(!1)}}};return n}),define("VMOutline",["ko","globals","data","gdata","VMSearch","platform","tracker"],function(e,t,r,i,n,o,a){function s(r){this.pane=r,this.root=t.vmMain.root(),o.mobile||(this.isVisible=e.observable(!1)),this.init()}return s.prototype={init:function(){t.outline=this,o.mobile&&t.ScreenManager.addScreen(this,Screens.Outline)},getTopElement:function(){return document.getElementsByClassName("paneOutline")[0]},onTap:{onStart:function(e){t.ScreenManager.checkSwipeStart(e)},onMove:function(e){t.ScreenManager.checkSwipeMove(e)},onClick:function(r){if(!(o.mobile&&t.ScreenManager.checkSwipeClick(r)||!t.hasClass(r.srcElement,"outlineText")&&!t.hasClass(r.srcElement.parentElement,"outlineText"))){var i=e.dataFor(r.srcElement);o.mobile||t.vmMain.setFocusedPane(this.pane),t.vmMain.zoomin(i),o.mobile?t.ScreenManager.scrollToScreen(Screens.List):t.focusedPane.toggleOutlineVisibility(),r.preventDefault(),t.sendEvent("Menu","OutlineZoom")}},onEnd:function(e){t.ScreenManager.checkSwipeEnd(e)}},onTapCollapse:{onStart:function(e){if(t.hasClass(e.srcElement,"outlineArrow")){var r=e.srcElement.parentNode;t.hasClass(r,"collapsed")?(t.removeClass(r,"collapsed"),t.sendEvent("Menu","OutlineMinimize")):(t.addClass(r,"collapsed"),t.sendEvent("Menu","OutlineMaximize")),e.handled=!0,e.preventDefault()}}},onScreenStartOpen:function(){},onScreenOpen:function(){t.isKeyboardOpen&&!t.vmSearchPhone.isFocused()&&t.blurActiveElement(),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleOutline,data:{element:this.getTopElement()}})},onScreenUpdate:function(){},onScreenClose:function(){a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleOutline,data:{element:this.getTopElement()}})},toggleDesktop:function(){var e=t.width(this.pane.element),r=150;this.isVisible()?(t.setTransform(this.pane.outlineElement,1*-e,0,r,"ease-out"),t.setTransform(this.pane.paneContent,0,0,r,"ease-out"),setTimeout(function(){this.isVisible(!this.isVisible()),this.pane.outlineElement.style.visibility="hidden"}.bind(this),r)):(this.isVisible(!this.isVisible()),this.pane.outlineElement.style.visibility="visible",t.setTransform(this.pane.outlineElement,1*-e,0),requestAnimationFrame(function(){t.setTransform(this.pane.outlineElement,0,0,r,"ease-in-out"),t.setTransform(this.pane.paneContent,e,0,r,"ease-in-out")}.bind(this))),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleOutline,data:{element:this.getTopElement()}})}},t.VMOutline=s,s}),define("VMPane",["ko","globals","android","data","gdata","VMSearch","VMTitle","edit","VMLI","tracker","VMPane_Timeline","VMOutline","platform"],function(e,t,r,i,n,o,a,s,c,d,l,u,h){function p(r){this.id=r.id,this.item=e.observable(r.item),this.mode=e.observable(r.mode||PaneMode.Normal),this.rootElement=void 0,this.scrollElement=void 0,this.element=void 0,this.paneContent=void 0,this.titleMenu=void 0,this.vmSearch=void 0,this.titles=e.observableArray(),this.showArchived=e.observable(!1),this.reloading=!1,this.width=-1,this.initialOffset=r.offset,this.defaultOffset=h.mobile?50:0,h.mobile?(t.vmSearchPhone=this.vmSearch=new o(this,r.search),this.outline=t.vmMain.outline=new u(this)):(this.vmSearch=new o(this,r.search),this.outline=new u(this)),this.initTimeline(),this.init(r)}return p.prototype={init:function(){this.vmSearch.init(),this.mode.subscribe(this.onModeChanged,this),h.mobile&&t.ScreenManager.addScreen(this,Screens.List),this.updateContents()},getScroller:function(){return h.bodyscroll?document.body:this.scrollElement},getScrollOffset:function(){var e=0;return h.bodyscroll?e=document.body.scrollTop:this.scrollElement&&(e=this.scrollElement.scrollTop),e},setScrollOffset:function(e){try{t.PAssert(1319,this.scrollElement,"Pane must have loaded a scrollable element")}catch(r){t.reportError(r)}void 0===e&&(e=this.defaultOffset),t.scrollTo(e,0,this.scrollElement)},setMode:function(e){this.mode(e),t.sendEvent("Menu","PaneModeSwitchTo",e),modeChanged=!0,t.vmMain.updatePaneState(this),this.vmSearch.updateSearch(!0)},getTopElement:function(){return this.element},trackDOM:function(){return!0},templateName:function(e){return e.mode()===PaneMode.Normal?"template-pane-normal":e.mode()===PaneMode.Timeline?"template-pane-timeline":void 0},itemHasChildren:function(){return this.item().items().length>0},isTimeline:function(){return this.mode()==PaneMode.Timeline},onModeChanged:function(e){e===PaneMode.Timeline?this.loadTimeline():this.unloadTimeline(),(h.ios||h.ie)&&this.setupFocusEvents()},setupFocusEvents:function(){if(h.phone&&(log("setting up focus"),h.ios)){try{t.PAssert(1320,!r.isEnabled(),"Android sets up its own focus/blur events in android.js")}catch(e){t.reportError(e)}try{t.PAssert(1321,!h.ie,"IE does not rely on focus/blur events to be fired")}catch(e){t.reportError(e)}this.paneContent.addEventListener("textInput",s.onTextInput,!1)}},onLoad:function(e){if(t.hasClass(e,"pane"))this.element=e,h.mobile&&(this.itemMenuPhone=t.element("itemMenuPhone"),this.rightMenuPhone=t.element("rightMenuPhone"));else{this.paneContent=e,this.rootElement=e.parentElement,this.scrollElement=this.rootElement.parentElement,this.outlineElement=this.scrollElement.previousElementSibling;try{t.PAssert(1323,t.hasClass(this.rootElement,"paneRoot"))}catch(i){t.reportError(i)}try{t.PAssert(1324,t.hasClass(this.paneContent,"paneContent"))}catch(i){t.reportError(i)}!h.android&&!h.mobileie||h.script||r.setPaneRoot(this),window.addEventListener("windowResize",function(){this.width=t.width(this.element)}.bind(this)),setTimeout(function(){if(this.width=t.width(this.element),(h.ios||h.ie)&&this.setupFocusEvents(),this.mode()===PaneMode.Normal&&isNaN(this.initialOffset))this.initialOffset=this.defaultOffset;else if(this.mode()===PaneMode.Timeline){var e=this.findNextBlock();this.initialOffset=e&&e.element?h.mobile?e.element.getBoundingClientRect().top:e.element.getBoundingClientRect().top-this.scrollElement.getBoundingClientRect().top-25:0}0!==this.initialOffset&&this.setScrollOffset(this.initialOffset)}.bind(this),0),h.ios&&(this.scrollElement.onscroll=function(e){return Math.abs(this.scrollElement.scrollTop-t.scrollAtTouchStart)>100&&(t.dragStartTimeout&&(clearTimeout(t.dragStartTimeout),t.dragStartTimeout=void 0),t.startDrag=void 0),0===this.scrollElement.scrollTop?(e.preventDefault(),e.stopImmediatePropagation(),!1):!0}.bind(this)),this.setNoItems(!!this.vmSearch.numMatches())}},setNoItems:function(e){e?t.removeClass(this.paneContent,"noItems"):t.addClass(this.paneContent,"noItems")},getWidth:function(){return this.width},toggleOutlineVisibility:function(){try{t.PAssert(1325,this.outline,"Outline must exist")}catch(e){t.reportError(e)}try{t.PAssert(1326,this.outlineElement,"Outline element must be valid")}catch(e){t.reportError(e)}this.outline.toggleDesktop()},updateContents:function(){this.mode()==PaneMode.Normal||this.mode()===PaneMode.Timeline&&this.reloadTimeline(),this.updateTitles()},notifyOfZoom:function(){this.updateContents(),this.vmSearch.updateSearch(!0)},updateTitles:function(){var e=this.item().parents();this.titles.removeAll();for(var t=0;t<e.length;t++){var r=new a({item:e[t],pane:this});this.titles.push(r)}},keydown:function(e,i){if(r.isEnabled()&&!r.passKeydown(i))return!0;if(t.autocomplete&&!t.autocomplete.onkeydown(i))return!1;try{return s.keydown(e,i)}catch(n){t.reportError(n,i)}},keypress:function(e,i){if(r.isEnabled()&&!r.passKeypress(i))return!0;try{return s.keypress(e,i)}catch(n){t.reportError(n,i)}},keyup:function(e,i){if(r.isEnabled())return r.checkAndroidBounds(),!0;try{return s.keyup(e,i)}catch(n){t.reportError(n,i)}},addItemToPane:function(e,t){var r=this.item();e||(e=""),d.beginAction();var i=new c({text:e},{parent:r,forceSave:!0});return r.insertItem(i,t),d.performAction(TrackerType.Create,{itemID:i.id,parent:r.id,position:isNaN(t)?r.items().length-1:t,text:e}),d.endAction(),i},onTapTitle:{onClick:function(e,r){var i=t.focusedItem;return h.ios||r==this.item()&&this.vmSearch.resetSearch(),this.titles().length<=1?void(this.outline.isVisible()&&this.toggleOutlineVisibility()):(t.vmMain.zoomout(r,i),void t.sendEvent("Menu","Title"))}},onTap:{onStart:function(i){if(!h.mobile||!t.ScreenManager.checkSwipeStart(i)){if(h.phone,t.menus&&t.phoneMenu&&(t.menus.startedInMultiSelectMode=t.phoneMenu.multiSelectMode()),t.vmMain.setFocusedPane(this),h.isTouchDevice&&!h.app&&!h.ie&&!h.bodyscroll){var n=this.scrollElement;if(!t.preventScrollPropagation(n))return i.preventDefault(),!1}if(!r.isEnabled()||!r.isTargetBox(i)){var o=e.dataFor(i.srcElement);h.mobile&&o===this&&(o=t.getLastVisibleItem(t.focusedPane.item())),o&&o.onStart&&o.onStart(i)}}},onMove:function(i){t.autocomplete&&h.mobile&&t.autocomplete.hide(),t.dragStartTimeout&&(clearTimeout(t.dragStartTimeout),t.dragStartTimeout=void 0);var n=!0;if(h.mobile&&(t.menus.startedInMultiSelectMode||(n=!t.ScreenManager.checkSwipeMove(i))),n&&(!r.isEnabled()||!r.isTargetBox(i))){var o=e.dataFor(i.startSrc);h.mobile&&o===this&&(o=t.getLastVisibleItem(t.focusedPane.item())),o&&o.onMove&&o.onMove(i)}return!1},onClick:function(i){if(!(h.mobile&&t.ScreenManager.checkSwipeClick(i)||r.isEnabled()&&r.isTargetBox(i))){var n=e.dataFor(i.startSrc);h.mobile&&n===this&&(n=t.getLastVisibleItem(t.focusedPane.item())),n&&n.onClick?n.onClick(i):t.hasClass(this.paneContent,"noItems")?this.addItem(i):i.preventDefault()}},onEnd:function(i){if(!(h.mobile&&t.ScreenManager.checkSwipeEnd(i)||r.isEnabled()&&r.isTargetBox(i))){var n=e.dataFor(i.startSrc);if(h.mobile&&n==this&&(n=t.getLastVisibleItem(t.focusedPane.item())),!n)return;"paneContent"===i.startSrc.id&&(i.preventDefault(),h.ios&&t.preventClick()),n&&n.onEnd&&n.onEnd(i)}},onDblClick:function(t){if(this.isTimeline()){var r=e.dataFor(t.startSrc);r&&r.onDblClick&&r.onDblClick(t)}},onRightClick:function(i){if(!t.isDisplayModeActive(DisplayMode.NoRightClick)){if(t.vmMain.setFocusedPaneFromElement(i.srcElement),!r.isEnabled()||!r.isTargetBox(i)){var n=e.dataFor(i.srcElement);n&&n.onRightClick&&n.onRightClick(i)}d.miscAction({type:TrackerType.Misc,misc:TrackerMisc.RightClick,data:{element:void 0}})}}},addItem:function(e){var r=this.addItemToPane("",0);t.selectChildren(r,0,0),t.sendEvent("Menu","AddItemButton"),h.mobile&&t.openKeyboardOn(e,r.getSpan(),!0)},onTapAddItem:{onStart:function(e){e.preventDefault(),e.stopImmediatePropagation()},onClick:function(e){this.addItem(e)}},onTapOutlineButton:function(){this.toggleOutlineVisibility(),this.outline.isVisible()?t.sendEvent("Menu","OpenOutline"):t.sendEvent("Menu","CloseOutline")},onTapSwitchList:function(){var e=this.setMode(PaneMode.Normal);d.performAction(TrackerType.UIAction,{type:TrackerUIAction.SwitchPaneMode,data:{from:e,to:PaneMode.Normal}}),t.sendEvent("Menu","SwitchPaneMode")},onTapSwitchTimeline:function(){var e=this.setMode(PaneMode.Timeline);d.performAction(TrackerType.UIAction,{type:TrackerUIAction.SwitchPaneMode,data:{from:e,to:PaneMode.Timeline}}),t.sendEvent("Menu","SwitchPaneMode")},onTapClosePane:function(){if(t.vmMain.panes().length>1){var e=t.vmMain.removePane(this);d.performAction(TrackerType.UIAction,{type:TrackerUIAction.RemovePane,data:e}),t.sendEvent("Menu","ClosePane"),t.tooltip.hideTip()}},onTapArchiveCompleted:{onStart:t.handlerPreventStop,onClick:function(){this.archiveCompleted(),t.sendEvent("Menu","ArchiveCompleted")}},archiveCompleted:function(){var e=[];t.searchVMLIs({item:this.item(),includeArchived:!1,comparator:function(e){return e.isComplete()},action:function(t){e.push(t)}}),d.beginAction();for(var r=e.length-1;r>=0;r--){var i=e[r];i.parent().archiveChild(i)}if(d.endAction(),e.length>0){var n=e.length>1?" items.":" item.";t.messageQueue.pushMessage({text:"Successfully archived "+e.length+n,type:MessageType.Info,action:MessageAction.Default,timeout:2e3})}t.sendEvent("Menu","ArchiveCompleted")},onTapViewArchived:function(){if(this.mode()===PaneMode.Timeline)this.showArchived(!this.showArchived()),t.vmMain.updatePaneState(this),t.sendEvent("Menu","ShowArchivedTimeline");else if(this.mode()===PaneMode.Normal){var e=[];t.searchVMLIs({item:this.item(),includeArchived:!0,comparator:function(e){return e.isArchived()},action:function(t){e.push(t)}});for(var r=0;r<e.length;++r){var i=e[r];i.parent().unarchiveChild(i)}t.sendEvent("Menu","UnarchiveItems")}},onScreenOpen:function(){},onScreenClose:function(){}},t.extend(p.prototype,l),p}),define("VMMain_DragDrop",["ko","globals","platform","tracker","VMPane","VMLI"],function(e,t,r,i,n,o){var a=function(a){function s(){p&&(t.removeClass(p,"itemDraggingAbove"),t.removeClass(p,"itemDraggingBelow"))}function c(e){log(e.target.result)}function d(e){var t=e.dataTransfer.files[0],r=new FileReader;r.onload=c,r.readAsDataURL(t)}var l=void 0,u=void 0,h=void 0,p=void 0,m=void 0,f=!1;a.handleDragOver=function(i){if(u!==i.srcElement){i.srcElement&&(l=t.getPaneForElement(i.srcElement));
var c=i.srcElement;if(!c||!l||"SPAN"!==c.tagName&&"P"!==c.tagName&&"LI"!==c.tagName&&"UL"!==c.tagName);else{s();var d=t.getPaneForElement(c);try{t.PAssert(1329,d,"Must have a valid pane to update our drag target on")}catch(g){t.reportError(g)}var v=e.dataFor(c);try{t.PAssert(1330,v,"Should always have a valid drop target")}catch(g){t.reportError(g)}var y=void 0,b=!1;v instanceof n?(b=!0,v=h?h:t.getLastPaneItem(v),highLightAbove=i.diffY<0?!0:!1):v instanceof o?d.isTimeline()||!v.isFullscreen()&&"LI"!==c.tagName?y=!0:h&&(v=h,y=i.diffY<0||f?!0:!1):v=a.getDropItem(i);try{t.PAssert(1331,v,"Should always have a valid drop target")}catch(g){t.reportError(g)}p=d.isTimeline()?void 0:v.getSpan(d.id),m=y?"itemDraggingAbove":"itemDraggingBelow",d.isTimeline()||t.addClass(p,m);try{t.PAssert(1332,!(v instanceof n),"Drop target shouldnt be a pane")}catch(g){t.reportError(g)}h=v,u=c,f=b}}if(l){var S=70,T=110,x=r.windowHeight()-40,w=r.windowHeight()+40;if(i.offsetY<T){var E=-(1-t.computeScrollSpeed(S,T,i.offsetY));t.repeatScroll(E,l)}else if(i.offsetY>x&&i.offsetY<w){var E=t.computeScrollSpeed(x,w,i.offsetY);t.repeatScroll(E,l)}else t.cancelRepeatScroll()}else t.cancelRepeatScroll();return!1},a.handleDropItem=function(e){if(t.cancelRepeatScroll(),e!==h){for(var r=h.parent();r;){if(r===e)return;r=r.parent()}if(t.getNextItem(e,t.focusedPane)===h&&"itemDraggingAbove"===m)return;var n=t.getPaneForElement(u);if(!n.isTimeline()){var o=e.parent(),a=e.getIndex(),s=void 0,c=-1;h.isFullscreen()?(s=h,c=s.numChildren()):(s=h.parent(),c="itemDraggingAbove"===m?h.getIndex():h.getIndex()+1),i.beginAction();try{t.PAssert(1333,s,"Trying to move without a target")}catch(d){t.reportError(d)}try{t.PAssert(1334,!isNaN(c),"Trying to move without a target index")}catch(d){t.reportError(d)}e.moveTo({parent:s,index:c}),i.performAction(TrackerType.Move,{itemID:e.id,oldParent:o.id,oldPosition:a,newParent:s.id,newPosition:c}),i.miscAction({type:TrackerType.Misc,misc:TrackerMisc.DropItem,data:[{itemID:e.id}]}),i.endAction(),t.timeline.reloadTimelines()}}},a.getDropItem=function(e){try{t.PAssert(1337,e.dataTransfer.item,"We do not support HTML5 drag/drop")}catch(r){t.reportError(r)}return e.dataTransfer.item},a.handleDrop=function(t){if(t.stopPropagation(),u){s();var r=a.getDropItem(t);if(r)a.handleDropItem(r,t);else{var i=t.dataTransfer.getData("itemid");if(i){var n=e.dataFor(document.getElementById(i));a.handleDropItem(n,t)}else t.dataTransfer.files&&t.dataTransfer.files.length>0&&(d(t),t.stopPropagation(),t.preventDefault())}}}};return a}),define("VMDocument",["ko","globals","platform","data","goog","tracker"],function(e,t,r,i,n,o){function a(t){this.file=t,this.id=t&&t.id,this.title=e.observable(t&&t.title||""),this.shared=t&&t.shared,this.isOpen=void 0,this.isOwned=e.observable(!1),this.init()}return a.prototype={init:function(){this.file&&"me"===this.file.userPermission.id&&"owner"===this.file.userPermission.role&&this.isOwned(!0)},onTapMenu:function(){this.openSharing(),t.sendEvent("Menu","OpenSharing"),o.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenDocSharing,data:[{value:!0}]})},openSharing:function(e){t.menus.openModal("shareDoc",this,e)},closeMenu:function(){t.menus.closeContextMenu(t.element("contextMenuDocument"))},onTapContextMenu:function(e){var t=e.srcElement.id;switch(t||(t=e.srcElement.parentNode.id),t){case"documentDelete":break;case"documentShare":}this.closeMenu()}},a}),define("VMMenus",["ko","globals","data","gdata","VMSearch","VMTitle","edit","VMLI","tracker","platform","VMDocument"],function(e,t,r,i,n,o,a,s,c,d){function l(){this.linkAddress=e.observable(),this.linkTitle=e.observable("temporary title"),this.itemMenuPhoneWidth=-240,this.rightMenuWidth=50,this.phoneLastTop=0,this.itemMenuPhone=void 0,this.itemMenuBG=void 0,this.itemMenuPhoneMode=e.observable(0),this.rightMenuPhone=void 0,this.rightMenuPhoneBG=void 0,this.lastSwipeMove=0,this.lastSwipeMoveTime=0,this.canClosePane=e.observable(!1),this.showArchivedMenuOption=e.observable(!1),this.archivedMenuText=e.observable(""),this.itemIsHeader=e.observable(!1),this.itemHasChildren=e.observable(!1),this.itemIsCollapsed=e.observable(!1),this.itemIsArchived=e.observable(!1),this.itemCanIndent=e.observable(!1),this.itemCanUnindent=e.observable(!1),this.itemCanZoom=e.observable(!1),this.lastZIndex=37,this.contextMenuOpenedOn=e.observable(void 0),this.isModalVisible=e.observable(!1),this.isModalOpen=e.observable(!1),this.modalOpened=void 0,this.modalOpenedBound=void 0,this.modalsBound=!1,this.menusBound=!1,this.init()}return l.prototype={init:function(){window.addEventListener("closeKeyboard",this.onCloseKeyboard.bind(this)),t.addCustomEventListener("keyEscape",this.onEscapeKey.bind(this),100),d.mobile||this.isModalOpen.subscribe(function(e){requestAnimationFrame(e?function(){requestAnimationFrame(function(){t.addClass(t.element("main"),"modalOpen"),t.addClass(t.element("desktopMenu"),"modalOpen"),t.addClass(t.element("desktopSidebar"),"modalOpen")})}:function(){t.removeClass(t.element("main"),"modalOpen"),t.removeClass(t.element("desktopMenu"),"modalOpen"),t.removeClass(t.element("desktopSidebar"),"modalOpen")})})},bind:function(){this.menusBound||(this.menusBound=!0,t.applyBindings(this,"contextMenus"),d.mobile&&(this.itemMenuPhone=t.element("itemMenuPhone"),this.rightMenuPhoneBG=t.element("rightMenuPhoneBG"),this.rightMenuPhone=t.element("rightMenuPhone"),this.rightMenuPhoneItems=t.element("rightMenuPhoneItems"),this.itemMenuBG=t.element("itemMenuBG"),t.applyBindings(this,"itemMenuPhone"),t.applyBindings(this,"rightMenuPhoneItems")))},onEscapeKey:function(){return this.isModalOpen()?this.closeModalInternal(!1):void 0},itemMenuPhoneClass:function(){var e=this.itemMenuPhoneMode();return 0===e?"complete completeDisabled":1==e?"complete":2==e?"notVisible":void 0},selectionHasChildren:function(){for(var e=0;e<t.vmMain.selected().length;e++)if(t.vmMain.selected()[e].hasChildren())return!0;return!1},selectionIsHeader:function(){return 1===t.vmMain.selected().length&&t.vmMain.selected()[0].isHeader()},openLinkMenu:function(e,r,i,n){this.linkAddress(r),t.menuOnItem=e;var o=document.getElementById("contextMenuLink");o.style.left=i+"px",o.style.top=n+"px",o.style.display="block",t.vmMain.handleFullscreenClick(function(){this.closeLinkMenu()}.bind(this))},closeLinkMenu:function(){t.menuOnItem=void 0,this.linkAddress("");var e=document.getElementById("contextMenuLink");e.style.display="none",t.vmMain.cancelFullscreenClick()},onTapLink:{onClick:function(){this.closeLinkMenu()}},closeAllMenus:function(){this.linkAddress("");var e=document.getElementById("contextMenuLink");e.style.display="none",t.menuOnItem=void 0},setupItemMenu:function(){t.element("menuGoto").style.display=t.focusedPane.isSearching?"block":"none"},onTapHover:{onStart:function(e){e.preventDefault()},onClick:function(e){var r=e.srcElement.id;t.sendEvent("Menu",r)}},multiSelect:function(e){e.isSelected(!e.isSelected()),e.isSelected()?t.vmMain.selected.push(e):t.vmMain.selected.splice(t.vmMain.selected.indexOf(e),1)},revealGestureMenu:function(e){try{t.PAssert(1338,t.revealingMenu===!1,"Must not have already started a gesture")}catch(r){t.reportError(r)}t.revealingMenu=!0,this.startedInMultiSelectMode=t.phoneMenu.multiSelectMode(),t.menuOnItem=e;var i=e.getSpan(),n=40,o=t.offset(i).top,a=o-t.phoneMainY,s=t.height(i)+8;a+=(s-n)/2;var c=a;this.phoneLastTop!==c&&(this.phoneLastTop=c),this.itemMenuPhone.style[d.transition.style]="",t.setTransformStyle(this.itemMenuPhone,0,this.phoneLastTop),this.startedInMultiSelectMode||t.setTransformStyle(this.rightMenuPhone,0,0),this.rightMenuThresh=this.rightMenuWidth/200*d.windowWidth.peek()},updateRevealGestureMenu:function(e){try{t.PAssert(1339,t.revealingMenu===!0,"Must have already started a gesture to perform an update")}catch(r){t.reportError(r)}var i=e.diffX;if(this.lastSwipeMove=e.xThisFrame,this.lastSwipeMoveTime=e.timeStamp,this.startedInMultiSelectMode){i-=this.rightMenuWidth;var n=t.clamp(i,-this.rightMenuWidth,0);t.setTransformStyle(this.rightMenuPhone,n,0)}else{var o=t.clamp(i,-this.rightMenuWidth,0);t.setTransformStyle(this.itemMenuPhone,d.windowWidth.peek()+o,this.phoneLastTop);var a=-this.rightMenuWidth-this.rightMenuThresh,s=t.clamp((-i-this.rightMenuWidth)/this.rightMenuThresh,0,1);this.itemMenuBG.style[d.transform.style]="scale3d(1,"+s+", 1)";var n=t.clamp(i+this.rightMenuWidth+this.rightMenuThresh,-this.rightMenuWidth,0);t.setTransformStyle(this.rightMenuPhone,n,0);var c=t.clamp((-i+a)/(.75*this.rightMenuWidth),0,1);this.itemMenuPhone.style.opacity=1-c,t.isKeyboardOpen||t.vmMain.setSelected([t.menuOnItem]),i<=-this.rightMenuWidth?1!==this.itemMenuPhoneMode.peek()&&this.itemMenuPhoneMode(1):0!==this.itemMenuPhoneMode.peek()&&this.itemMenuPhoneMode(0)}},stopRevealGestureMenu:function(e){try{t.PAssert(1340,t.revealingMenu===!0,"Must have already started a gesture")}catch(r){t.reportError(r)}var i=200,n=e.diffX;t.revealingMenu=!1;e.timeStamp-this.lastSwipeMoveTime;if(this.startedInMultiSelectMode){n-=this.rightMenuWidth;var o=t.clamp(n,-this.rightMenuWidth,0);o<=-this.rightMenuWidth/2?t.setTransform(this.rightMenuPhone,-this.rightMenuWidth,0,200,"ease-out"):(this.closeMultiSelect(),t.vmMain.clearSelected())}else n<=-this.rightMenuWidth-this.rightMenuThresh?(t.setTransform(this.rightMenuPhone,-this.rightMenuWidth,0,200,"ease-out"),t.phoneMenu.multiSelectMode(!0),t.blurActiveElement(!0),t.vmMain.setSelected([t.menuOnItem])):(n<=-this.rightMenuWidth&&t.menuOnItem.isComplete(!t.menuOnItem.isComplete()),t.setTransform(this.rightMenuPhone,0,0,200,"ease-out"),t.isKeyboardOpen||t.vmMain.clearSelected());this.closePhoneMenu(i)},closeMultiSelect:function(){t.setTransform(this.rightMenuPhone,0,0,200,"ease-out"),t.phoneMenu.multiSelectMode(!1),t.vmMain.clearSelected()},closePhoneMenu:function(){var e=200;t.setTransform(this.itemMenuPhone,d.windowWidth(),this.phoneLastTop,e,"ease-out"),t.menuOnItem=void 0},onResize:function(){t.menuOnItem||t.setTransform(this.itemMenuPhone,d.windowWidth(),this.phoneLastTop)},onTapMenuPhone:{onStart:t.handlerPreventStop,onClick:function(e){if(0!==t.vmMain.selected().length){var r,i,n=e.srcElement.id;switch(n){case"phoneMenuComplete":r="isComplete",i=!t.vmMain.getFirstSelectedItem().isComplete();break;case"phoneMenuFlag":r="isFlagged",i=!t.vmMain.getFirstSelectedItem().isFlagged();break;case"phoneMenuPriorityNone":r="priority",i=VMLIFlag.None;break;case"phoneMenuPriorityHigh":r="priority",i=t.vmMain.getFirstSelectedItem().priority()==VMLIFlag.P0?VMLIFlag.None:VMLIFlag.P0;break;case"phoneMenuPriorityMed":r="priority",i=t.vmMain.getFirstSelectedItem().priority()==VMLIFlag.P1?VMLIFlag.None:VMLIFlag.P1;break;case"phoneMenuPriorityLow":r="priority",i=t.vmMain.getFirstSelectedItem().priority()==VMLIFlag.P2?VMLIFlag.None:VMLIFlag.P2;break;case"phoneMenuZoom":t.vmMain.zoomin(t.vmMain.getFirstSelectedItem()),this.closeMultiSelect();break;case"phoneMenuDelete":r="deleteSelf";break;case"phoneMenuCollapse":if(this.selectionHasChildren())for(var o=0;o<t.vmMain.selected().length;o++)t.vmMain.selected()[o].hasChildren()&&(i||(i=!t.vmMain.selected()[o].isCollapsed()),t.vmMain.selected()[o].isCollapsed(i))}if(r)for(var o=0;o<t.vmMain.selected().length;o++)t.vmMain.selected()[o][r](i);"phoneMenuDelete"===n&&t.vmMain.clearSelected()}}},onTapComplete:{onClick:function(){t.menuOnItem.isComplete(!t.menuOnItem.isComplete())}},onTapPriority:{onClick:function(){var e=t.menuOnItem.priority(),r=e!==VMLIFlag.None?VMLIFlag.None:VMLIFlag.P0;t.menuOnItem.priority(r)}},onTapCollapse:{onClick:function(){t.menuOnItem.toggleCollapsed()}},onTapDelete:{onClick:function(){c.beginAction(),t.menuOnItem.deleteSelf(),c.endAction()}},paneTapped:function(){t.menuOnItem&&this.closePhoneMenu(100)},openContextMenu:function(e,r,i){t.autocomplete&&t.autocomplete.hide();var n={visibility:"visible",top:e.top},o=t.width(r);i||e.left+o>d.windowWidth()&&(i=!0),n.left=i?e.left-o-2:e.left+2;var a=t.height(r);e.top+a>d.windowHeight()&&(n.top-=a),t.css(r,n);var s=document.documentElement.getBoundingClientRect(),c=r.getBoundingClientRect(),l={left:c.left,right:c.right,top:c.top,bottom:c.bottom},u=t.adjustOriginToBeInsideBounds(s,l);(u.x!==l.left||u.y!==l.top)&&(r.style.left=u.x+"px",r.style.top=u.y+"px"),t.vmMain.handleFullscreenClick(function(){this.closeContextMenu(r)}.bind(this))},closeContextMenu:function(e){t.css(e,{visibility:"hidden"}),t.vmMain.cancelFullscreenClick()},registerModal:function(r,i,n,o){try{t.PAssert(1341,r&&i,"Must have a valid name and object to bind modal to")}catch(a){t.reportError(a)}this[r+"Item"]=e.observable(i),this[r+"Visible"]=e.observable(!1),this[r+"Loading"]=e.observable(!1),n&&(this[r+"OpenFn"]=n),o&&(this[r+"CloseFn"]=o)},openModal:function(e){try{t.PAssert(1342,!this.modalOpened,"Only a single modal should be opened at a time")}catch(r){t.reportError(r)}this[e+"OpenFn"]&&this[e+"OpenFn"].apply(this[e+"Item"](),Array.prototype.slice.call(arguments,1)),this.modalsBound||(t.applyBindings(this,"modals"),this.modalsBound=!0);var i=this[e+"Visible"];try{t.PAssert(1343,i,"Visible variable does not exist")}catch(r){t.reportError(r)}this.modalOpened=e,this.modalOpenedBound=this[e+"Item"](),i(!0),this.isModalVisible(!0),this.isModalOpen(!0)},closeModal:function(e){if(this.modalOpened){try{t.PAssert(1344,!e||e===this.modalOpened,"Tried to close the wrong modal")}catch(r){t.reportError(r)}arguments.length>1?this.closeModalInternal.apply(this,Array.prototype.slice.call(arguments,1)):this.closeModalInternal()}},closeModalInternal:function(){if(this.modalOpened){try{t.PAssert(1345,this.modalOpened,"Tried to close when no modal was open")}catch(e){t.reportError(e)}var r=this[this.modalOpened+"Visible"];try{t.PAssert(1346,r,"Visible variable does not exist")}catch(e){t.reportError(e)}var i=this.modalOpened;return r(!1),this.isModalOpen(!1),this.isModalVisible(!1),this.modalOpened=void 0,this.modalOpenedBound=void 0,this.modalInputOn=void 0,t.fireCustomEvent("closeKeyboard"),this[i+"CloseFn"]&&this[i+"CloseFn"].apply(this[i+"Item"](),arguments),!1}},focusModalInputMobile:function(e,r){try{t.PAssert(1347,d.mobile,"Should not call this from non-mobile")}catch(i){t.reportError(i)}this.modalInputOn?this.modalInputOn!=r?(r.focus(),this.modalOpenedBound.onKeyboardOpened&&requestAnimationFrame(function(){this.modalOpenedBound.onKeyboardOpened(e)}.bind(this)),e.preventDefault(),e.stopPropagation(),t.enforceScroll()):t.enforceScroll():t.openKeyboardOn(e,r,!1,function(){d.app?(this.modalOpenedBound.onKeyboardOpened(e),requestAnimationFrame(function(){requestAnimationFrame(function(){r.focus(),t.enforceScroll()})})):r.focus()}.bind(this))},onTapModal:{onStart:function(e){d.mobile&&e.srcElement!=this.modalInputOn&&(t.isKeyboardInputElement(e.srcElement)||t.hasClass(e.srcElement,"input"))&&(log("start",t.isKeyboardOpen),t.isKeyboardOpen||(e.preventDefault(),e.stopPropagation()))},onClick:function(e){var r=!0;"modals"==e.srcElement.id?(this.closeModal(),this.modalInputOn=void 0):e.srcElement==this.modalInputOn?r=!1:t.isKeyboardInputElement(e.srcElement)||t.hasClass(e.srcElement,"input")?(d.mobile&&this.focusModalInputMobile(e,e.srcElement),this.modalInputOn=e.srcElement):this.modalInputOn=void 0,r&&d.mobile&&(e.preventDefault(),e.stopPropagation())}},onCloseKeyboard:function(){this.modalInputOn=void 0},paneIsTimeline:function(){return this.contextMenuOpenedOn()?this.contextMenuOpenedOn().isTimeline&&this.contextMenuOpenedOn().isTimeline():!1},openItemMenu:function(e,r){this.openContextMenu({left:r.pageX,top:r.pageY},t.element("contextMenuItem"),!1),this.contextMenuOpenedOn(t.getPaneForElement(r.srcElement));var i,n=!1;t.vmMain.applyToSelection(function(e,r,o){try{t.PAssert(1348,e,"Item must be defined")}catch(a){t.reportError(a)}return e&&0===r&&(i=e,this.itemIsHeader(e.isHeader()),this.itemHasChildren(e.isHeader()||e.hasChildren()),this.itemIsCollapsed(e.isCollapsed()),this.itemIsArchived(e.isArchived()),this.itemCanIndent(0!==e.getIndex()),this.itemCanUnindent(e.parent()!==t.focusedItem)),n||e.canZoom()&&(n=!0,this.itemCanZoom(!0)),n||r!==o-1||this.itemCanZoom(!1),!n}.bind(this),{passExtraInfo:!0})},closeItemMenu:function(){this.closeContextMenu(t.element("contextMenuItem")),this.contextMenuOpenedOn(void 0)},itemContextText:function(){return this.itemIsCollapsed()?"Expand":"Collapse"},itemArchivedText:function(){return this.itemIsArchived()?"Unarchive":"Archive"},hotkeyText:function(e){return d.windows?d.cmdChar+"+"+e:d.cmdChar+""+e},onTapItemMenu:{onStart:t.handlerPreventStop,onClick:function(e){var r=e.srcElement.id;switch(r||(r=e.srcElement.parentNode.id),r){case"itemComplete":t.vmMain.applyFnToSelection("isComplete",!0);break;case"itemFlag":t.vmMain.applyFnToSelection("isFlagged",!0);break;case"itemIndent":t.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!1});break;case"itemUnindent":t.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!0});break;case"itemPriorityNone":t.vmMain.applyPriorityToSelection(VMLIFlag.None);break;case"itemPriorityLow":t.vmMain.applyPriorityToSelection(VMLIFlag.P2);break;case"itemPriorityMed":t.vmMain.applyPriorityToSelection(VMLIFlag.P1);break;case"itemPriorityHigh":t.vmMain.applyPriorityToSelection(VMLIFlag.P0);break;case"itemCollapse":t.vmMain.applyToSelection(function(e){e.toggleCollapsed()});break;case"itemZoom":t.vmMain.applyToSelection(function(e){return e.canZoom()?(t.vmMain.zoomin(e),!1):!0});break;case"itemCopy":break;case"itemPaste":break;case"itemUndo":break;case"itemRedo":break;case"itemArchive":{var i=0;t.vmMain.applyToSelection(function(e){this.itemIsArchived()?e.parent().unarchiveChild(e)&&i++:e.parent().archiveChild(e)&&i++}.bind(this))}if(i>0){var n=i>1?" items.":" item.",o=this.itemIsArchived()?"unarchived":"archived";t.messageQueue.pushMessage({text:"Successfully "+o+" "+i+n,type:MessageType.Info,action:MessageAction.Default,timeout:2e3})}break;case"itemDelete":t.vmMain.applyToSelection(function(e){e.deleteSelf()});break;case"contextMenuItem":break;default:try{t.PAssert(1349,!1,"Unknown context menu item: ",r)}catch(a){t.reportError(a)}}t.sendEvent("ContextMenu",r),this.closeItemMenu()}}},l}),define("VMDocSharing",["ko","globals","platform","data","goog"],function(e,t,r,i,n){function o(){this.doc=e.observable({isOwned:function(){return!1}}),this.isLoading=e.observable(!1),this.isCreating=e.observable(!1),this.permissions=e.observableArray(),this.permissionsNew=e.observableArray(),this.permissionsRemove=[],this.newEmail=e.observable(""),this.errorGlobal=e.observable(!1),this.errorName=e.observable(!1),this.errorInvite=e.observable(!1),this.isSaving=e.observable(!1),this.editing=e.observable(""),this.closeCallback=void 0,this.justCreated=!1}return o.prototype={open:function(e,t){this.doc(e),this.closeCallback=t,this.permissions.removeAll(),this.permissionsNew.removeAll(),this.permissionsRemove=[],this.newEmail(""),this.editing(""),this.isLoading(!0),this.errorGlobal(!1),this.errorName(!1),this.errorInvite(!1),this.isSaving(!1),this.isCreating(!this.doc().file),this.justCreated=!1,this.inputName=document.getElementById("shareNameInput"),this.inputName.value=this.doc().title(),this.shareLink=document.getElementById("shareLinkInput"),this.shareLink&&(this.shareLink.value="moo.do/#file="+this.doc().id),r.mobile||setTimeout(function(){this.inputName.focus()}.bind(this),0),this.isCreating()?this.isLoading(!1):gapi.client.drive.permissions.list({fileId:this.doc().id}).execute(this.permissionHandler.bind(this))},permissionHandler:function(e){if(!e.error){this.isLoading(!1);for(var r=[],i=0;i<e.items.length;++i){var n=e.items[i];n.emailAddress!==t.getUserIdentifier()&&(n.onRemove=this.onRemove.bind(this,n),"anyone"!=n.id&&(n.emailAddress||(n.emailAddress="owner"===n.role?"Owner":""),"owner"===n.role?r.splice(0,0,n):r.push(n)),n.emailDisplay="("+n.emailAddress+")")}this.permissions(r)}},isOwned:function(){return this.doc().isOwned&&this.doc().isOwned()},saveText:function(){return this.isCreating()?this.isSaving()?"Creating...":"Create":r.mobile&&this.editing()?"Close":this.newEmail().length>0?"Invite":this.isSaving()?"Saving...":"Save"},titleText:function(){return r.mobile&&this.editing()?this.editing():this.isCreating()?"Create Document":"Edit Document"},onkeydown:function(e,i){return r.normalizeKeys(i),i.normCode==KeyCode.Escape?(this.newEmail(""),i.preventDefault(),i.stopImmediatePropagation(),!1):i.normCode==KeyCode.Enter?(this.inviteUser(),t.scrollIntoView(t.element("inputShareInvite"),0),i.preventDefault(),i.stopImmediatePropagation(),!1):!0},onKeyboardOpened:function(e){this.editing(e.srcElement.title)},inviteUser:function(){if(0===this.newEmail().length)return void this.errorInvite("");if(!t.isEmail(this.newEmail()))return this.errorInvite("Please enter a valid email address."),!1;var r={emailAddress:this.newEmail(),error:e.observable(!1)},n=i.findContactByEmail(r.emailAddress.toLowerCase());return r.name=n?n.text:r.emailAddress,r.onRemove=this.onRemoveNew.bind(this,r),this.permissionsNew.push(r),this.newEmail(""),this.errorInvite(!1),!0},checkName:function(){var e=this.inputName.value.trim();return e.length>0&&e.length<255?(this.errorName(!1),!0):(this.errorName("Error: Document name must be >0 and <255 characters."),!1)},rename:function(){var e=this.inputName.value.trim();e!=this.doc().title()&&(this.doc().title(e),gapi.client.drive.files.patch({fileId:this.doc().id,resource:{title:e}}).execute(function(t){t.error?this.errorName("Error: Unable to update name on remote server."):log("File renamed to",e)}.bind(this)))},create:function(e){this.justCreated=!0,this.isSaving(!0);var t=this.inputName.value.trim();this.tooltip=t,this.isSaving(!0),gapi.client.drive.files.insert({resource:{mimeType:n.REALTIME_MIMETYPE,title:t,writersCanShare:!1}}).execute(function(t){t.error?this.errorGlobal("Error: Unable to create new document."):(this.doc().id=t.id,this.doc().file=t,this.isCreating(!this.doc().file),this.isSaving(!1),e&&e())}.bind(this))},save:function(){function e(e,n){n.error?(console.error("UH OH",n),this.permissionsNew()[i].error(!0),this.errorInvite("Some people could not be invited."),this.isSaving(!1)):(r--,0>=r&&t.menus.closeModal("shareDoc",!1))}if(!this.isSaving()||this.justCreated){if(this.editing())return t.blurActiveElement(),void this.editing("");if(!n.isDriveAPILoaded())return void this.errorGlobal("Error communicating with Google Drive. Please reconnect and try again.");if(this.checkName()){if(this.isCreating())return void this.create(this.save.bind(this));if(this.newEmail().length>0){if(!this.inviteUser())return}else this.errorInvite(!1);this.rename();for(var r=0,i=0;i<this.permissionsNew().length;i++){var o=this.permissionsNew()[i];if(!o.error()){r++;var a={value:o.emailAddress,type:"user",role:"writer",withLink:!1},s="Come collaborate with me at Moo.do!\r\nhttp://www.moo.do/#login=true&file="+this.doc().id;gapi.client.drive.permissions.insert({fileId:this.doc().id,emailMessage:s,resource:a}).execute(e.bind(this,i))}}for(var i=0;i<this.permissionsRemove.length;i++){var c=this.permissionsRemove[i];gapi.client.drive.permissions.delete({fileId:this.doc().id,permissionId:c.id}).execute(function(e){})}this.errorInvite()||this.errorName()||(0===r?t.menus.closeModal("shareDoc",!0):(this.isSaving(!0),this.onClose(!0)))}}},onClose:function(e){this.closeCallback&&(this.closeCallback(e),this.closeCallback=void 0)},onTapInviteMessage:{onStart:t.handlerPreventStop,onClick:function(e){var i=t.element("inputShareInvite");r.mobile?t.menus.focusModalInputMobile(e,i):i.focus()}},onTapSave:{onStart:t.handlerPreventStop,onClick:function(){this.save(),t.sendEvent("Menu","SharingSave")}},onTapCancel:{onStart:t.handlerPreventStop,onClick:function(){t.menus.closeModal("shareDoc",!1),t.sendEvent("Menu","SharingCancel")}},onTapDelete:{onStart:t.handlerPreventStop,onClick:function(){t.sendEvent("Menu","SharingDelete"),setTimeout(function(){var e=prompt("This will delete the file. Type DELETE to confirm.");e&&"delete"==e.trim().toLowerCase()&&(gapi.client.drive.files.delete({fileId:this.doc().id}).execute(function(e){log("Document Delete Response: ",e),e.error&&t.messageQueue.pushMessage({text:"Unable to delete document on the remote server.",type:MessageType.Error})}.bind(this)),t.vmMain.vmPicker.removeFile(this.doc()),t.menus.closeModal("shareDoc",!1))}.bind(this),0)}},onRemove:function(e){this.permissionsRemove.push(e),this.permissions.remove(e),t.sendEvent("Menu","SharingRemoveUser")},onRemoveNew:function(e){this.permissionsNew.remove(e)}},o}),define("VMPicker",["ko","globals","util","platform","data","goog","VMDocument","VMDocSharing","tracker"],function(e,t,r,i,n,o,a,s,c){function d(){this.files=e.observableArray(),this.permissions=e.observableArray(),this.isPublic=e.observable(),this.fileMap={},this.isLoading=e.observable(!1),this.needPermission=e.observable(!1),this.showError=e.observable(!1),this.loadCallbacks=[],this.init()}return d.prototype={init:function(){var e=new s;t.menus.registerModal("shareDoc",e,e.open.bind(e),e.onClose.bind(e))},refreshFiles:function(){this.runOnFileLoad(this.markFileProperties.bind(this)),gapi.client.load("drive","v2",function(){this.loadFileList()}.bind(this))},setFiles:function(e,t){this.files.removeAll();for(var r=0;r<e.length;r++){var i=e[r],n=new a(i);n.isOpen=r===t,this.files.push(n)}this.setMinHeight()},loadFileList:function(e){this.isLoading()||(this.isLoading(!0),this.showError(!1),gapi.client.load("drive","v2",function(){gapi.client.drive.files.list({fields:"items(appDataContents,createdDate,description,editable,etag,exportLinks,iconLink,id,indexableText,kind,labels,md5Checksum,mimeType,ownerNames,owners,parents,permissions,properties,quotaBytesUsed,shared,sharedWithMeDate,sharingUser,title,userPermission,version,writersCanShare),kind,nextLink,nextPageToken",q:"trashed=false and mimeType='"+o.REALTIME_MIMETYPE+"."+o.APP_ID+"'"}).execute(function(t){if(!t.items||t.error)this.showError("Load Documents");else{for(var r=0,i=o.getDocId(),n=0;n<t.items.length;++n){var a=t.items[n];this.fileMap[a.id]=a,i===a.id&&(r=n)}this.setFiles(t.items,r)}this.isLoading(!1),e&&e(t),this.onFilesLoaded(t)}.bind(this))}.bind(this)))},markFileProperties:function(e){if(e&&e.items)for(var t=0;t<e.items.length;++t){var r=e.items[t];if(!r.properties&&r.title===o.LEGACY_DefaultDriveDocTitle&&"me"===r.userPermission.id&&"owner"===r.userPermission.role){gapi.client.drive.properties.insert({fileId:r.id,resource:{key:o.DefaultProperty,value:o.DefaultPropertyValue,visibility:"PRIVATE"}}).execute(function(e){(e.error||"drive#property"!==e.kind)&&ShouldLog(LogLevels.Error)&&log("Error adding default file property: ",e)});break}}},onFilesLoaded:function(e){if(this.loadCallbacks.length>0){for(var t=0;t<this.loadCallbacks.length;++t)this.loadCallbacks[t]&&this.loadCallbacks[t](e);this.loadCallbacks=[]}},runOnFileLoad:function(e){this.loadCallbacks.push(e)},requestOpenDocument:function(e){var t=this.getFile(e);t?this.openDocument(t):this.needPermission()?this.doRequestPermission(function(){this.openDocumentFromId(e)}.bind(this)):this.onFilesLoaded(function(){this.openDocumentFromId(e)}.bind(this))},openDocumentFromId:function(e,i){var a=o.getDocId();if(a!==e){var s=[Settings.docSharing,Settings.authScopes,Settings.shownTutorial,Settings.lastMessageSync];n.clearData(function(){o.setDocInfo(e,i),r.hasURLParam("file")?r.removeURLParam("file",!0):r.hasURLParam("state")&&r.removeURLParam("state",!0),setTimeout(function(){t.reload()},500)},s)}},openDocument:function(e){t.localDocChangeRequested=!0,this.openDocumentFromId(e.id,e.title)},doRequestPermission:function(){},onRequestPermission:function(){this.doRequestPermission()},onTapReloadDocuments:function(){this.loadFileList()},onTapDocument:{onClick:function(r){var i=e.dataFor(r.srcElement);t.hasClass(r.srcElement,"documentTitle")?(this.openDocument(i),c.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenDocument,data:[{value:!0}]})):i instanceof a?(i.onTapMenu(),r.stopImmediatePropagation()):t.reportError("Incorrect document type: "+t.elementToString(r.srcElement))}},onTapAdd:{onStart:t.handlerPreventStop,onClick:function(){if(t.vmMain&&t.vmMain.isOnline()){var e=new a;e.isOwned(!0),this.files.push(e),this.setMinHeight(),t.sendEvent("Menu","AddDocument"),e.openSharing(function(t){t||(this.files.remove(e),this.setMinHeight())}.bind(this)),c.miscAction({type:TrackerType.Misc,misc:TrackerMisc.AddDocument,data:[{value:!0}]})}else t.messageQueue.pushMessage({text:"You must be online to create a new document",type:MessageType.Warning,timeout:8e3})}},getFile:function(e){return this.fileMap[e]},removeFile:function(e){this.files.remove(e),this.setMinHeight(),e.isOpen&&n.clearData(function(){setTimeout(function(){t.reload()},0)})},setMinHeight:function(){if(!i.mobile){var e=document.getElementById("documentsList");if(!e)return void setTimeout(this.setMinHeight.bind(this),0);var r=e.clientHeight;t.element("sidebarDocumentContainer").style.minHeight=r+50+"px"}}},d}),define("VMSettings",["ko","data","globals","util","goog","platform","tracker","VMPicker"],function(e,t,r,i,n,o,a){function s(){this.enabledSyncContacts=e.observable(!1),this.enabledSounds=e.observable(!1),this.enabledNotifications=e.observable(!1),this.enabledMobileUI=e.observable(!1),this.syncContactsEnabledOnOpen=e.observable(!1),this.refreshingContacts=!1,this.refreshContactsSuccess=e.observable(void 0),this.init()}return s.prototype={init:function(){if(r.menus.registerModal("settings",this,this.open.bind(this),this.close.bind(this)),this.loadSettings(),o.mobile){var e=this.save.bind(this);this.enabledSyncContacts.subscribe(e),this.enabledSounds.subscribe(e),this.enabledNotifications.subscribe(e),this.enabledMobileUI.subscribe(e)}if(o.isTouchDevice&&!o.app){var t=document.getElementById("paneSettings");t&&t.addEventListener(o.touchStartEvent,function(e){return r.preventScrollPropagation(t)||"paneSettings"!=e.srcElement.id?void 0:(e.preventDefault(),!1)})}o.mobile&&r.ScreenManager.addScreen(this,Screens.Settings),window.addEventListener("settingsChange_"+Settings.syncContacts,this.onSyncContactsChange.bind(this))},isLocal:function(){return"localhost"===window.location.hostname},showMobileUIOptionOnDesktop:function(){try{return!!i.storage.getItem("forceFullUI")}catch(e){return!1}},showMobileUIOptionOnMobile:function(){return parseInt(window.innerWidth)>767},onEnableNotificationsChange:function(){this.enabledNotifications()?r.timeline.updateNotifications():r.timeline.clearNotifications()},onSyncContactsChange:function(e){this.enabledSyncContacts(e.data)},getTopElement:function(){return document.getElementById("paneSettings")},open:function(){this.isClosing||(this.refreshContactsSuccess(void 0),this.loadSettings(),this.syncContactsEnabledOnOpen(this.enabledSyncContacts()))},close:function(e){if(e)this.save();else{var t=!!r.settings.get(Settings.syncContacts);this.enabledSyncContacts(t),this.enabledSounds(!r.settings.get(Settings.noSounds))}},onScreenStartOpen:function(){this.loadSettings()},enableSyncContacts:function(){function e(e){0>e?r.messageQueue.pushMessage({text:'There was an error syncing your contacts, please try again using the "Refresh Contacts" button in settings.',type:MessageType.Error}):e>0&&(r.messageQueue.pushMessage({text:"Your contacts were successfully syncd with Moo.do.",type:MessageType.Info}),r.vmMain.runParseWorker())}r.sendEvent("Settings","EnableContacts"),n.runAuthenticate([GScope.Contacts],!1,!1,function(t){t&&!t.error?(n.loadContacts(e),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.SyncContacts,data:[{value:!0}]})):(this.enabledSyncContacts(!this.enabledSyncContacts()),r.settings.set(Settings.syncContacts,this.enabledSyncContacts()),r.messageQueue.pushMessage({text:"If you would like to sync your contacts we need permission to access them, please try again.",type:MessageType.Error,timeout:1e4}))}.bind(this))},loadSettings:function(){this.enabledSyncContacts(!!r.settings.get(Settings.syncContacts)),this.enabledSounds(!r.settings.get(Settings.noSounds)),this.enabledNotifications(!r.settings.get(Settings.disableNotifications));
try{this.enabledMobileUI(!i.storage.getItem("forceFullUI"))}catch(e){this.enabledMobileUI(!1)}},save:function(){var e,o=this.enabledSyncContacts()!==!!r.settings.get(Settings.syncContacts),a=this.enabledSounds()!==!r.settings.get(Settings.noSounds),s=this.enabledNotifications()!==!r.settings.get(Settings.disableNotifications);try{e=this.enabledMobileUI()!==!i.storage.getItem("forceFullUI")}catch(c){e=!1}o&&(r.settings.set(Settings.syncContacts,this.enabledSyncContacts()),this.enabledSyncContacts()?this.enableSyncContacts():(r.sendEvent("Settings","DisableContacts"),n.loadedContacts=!1,t.clearContacts())),a&&r.settings.set(Settings.noSounds,!this.enabledSounds()),s&&r.settings.set(Settings.disableNotifications,!this.enabledNotifications()),e&&r.shouldWriteLocal()&&(this.enabledMobileUI()?i.storage.removeItem("forceFullUI"):i.storage.setItem("forceFullUI",!0))},isDemo:function(){return r.isDemoMode()},onTapSave:function(){r.menus.closeModal("settings",!0)},onTapCancel:function(){r.menus.closeModal("settings",!1)},onScreenOpen:function(){r.isKeyboardOpen&&r.blurActiveElement()},onScreenClose:function(){this.save()},onTapLogout:function(e){r.vmSetup.logoutClicked(),r.sendEvent("Menu","Logout"),e.preventDefault()},onTapRunPicker:function(){},onTapFeedback:function(e){r.menus.openModal("reportBug"),r.sendEvent("Menu","GiveFeedback"),e.preventDefault()},onTapLeaveDemo:function(){i.removeURLParam("demo")},onTapRestartClient:function(e){r.reload(),e.preventDefault()},onTapPromptResetClient:function(e){r.messageQueue.pushMessage(MessageID.CacheReset),e.preventDefault()},onTapResetClient:function(){t.clearData(function(){r.reload()}),r.sendEvent("Menu","ResetClient")},onForceReloadDoc:function(){var e=[Settings.docSharing,Settings.authScopes,Settings.shownTutorial,Settings.gdocId,Settings.gdocTitle];t.clearData(function(){r.reload()},e),r.sendEvent("Menu","ReloadDoc")},onTapSettings:function(){r.menus.openModal("settings"),r.vmMain.cancelFullscreenClick(),r.sendEvent("Menu","Settings")},onTapHelp:function(){r.vmMain.showHelp(HelpMode.Normal),r.sendEvent("Menu","HelpSidebar")},onlineStatusToggle:function(){o.offline?i.removeURLParam("offline"):i.insertURLParam("offline","true")},logoutButtonText:function(){return r.vmSetup.logoutButtonText()},isLoggedIn:function(){return r.vmSetup.loginState()==LoginState.LOGGED_IN},showAppDebugInfo:function(){return o.debugApp},getHostName:function(){return"Host: "+window.location.host},getAppDebugText:function(){return"LowMem: "+(r.hasSentLowMemoryWarning()?"TRUE":"FALSE")},onTapRefreshContacts:function(){this.refreshingContacts||(this.refreshingContacts=!0,this.refreshContactsSuccess(void 0),t.clearLocalContacts(),n.loadedContacts=!1,n.authAndLoadContacts(function(e){this.refreshContactsSuccess(e),setTimeout(function(){this.refreshingContacts=!1}.bind(this),1e3)}.bind(this)),r.sendEvent("Menu","RefreshContacts"))},contactsRefreshSuccessTest:function(){return void 0===this.refreshContactsSuccess()?"":this.refreshContactsSuccess()===!0?"Success!":this.refreshContactsSuccess()===!1?"Failure!":void 0},onTapImport:function(){r.menus.openModal("importData"),r.sendEvent("Menu","ImportData"),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenImport,data:[{value:!0}]})},onTapExport:function(){r.menus.openModal("exportData"),r.sendEvent("Menu","ExportData"),a.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenExport,data:[{value:!0}]})}},s}),define("VMPhoneMenu",["ko","globals","data","platform","tracker","gdata"],function(e,t,r,i,n,o){function a(){try{t.PAssert(1350,i.mobile,"Should only initialize on mobile platforms")}catch(r){t.reportError(r)}this.searchScale="",this.searchTranslate="",this.search=t.vmSearchPhone,this.mode=e.observable(this.Modes.Normal),this.multiSelected=t.vmMain.selected,this.activeScreen=e.observable(Screens.List),this.init()}return a.prototype={Modes:{Normal:0,Multiselect:1,Contact:2,Date:3},init:function(){try{t.PAssert(1351,t.vmSearchPhone,"Phone search must be initialized at this point")}catch(e){t.reportError(e)}t.applyBindings(this,"phoneMenu"),window.appEvents=this.appEvents,i.app&&i.sendToApp("kbsize"),this.mode.subscribe(function(e){e==this.Modes.Multiselect?t.addClass(t.focusedPane.element,"multiSelectMode"):t.removeClass(t.focusedPane.element,"multiSelectMode")}.bind(this)),window.addEventListener("screenScroll",function(){this.activeScreen(t.ScreenManager.activeScreen)}.bind(this))},_modeHelper:function(e,t){return void 0!==e&&this.mode(e?t:this.Modes.Normal),this.mode()===t},activeScreenClass:function(){var e=this.activeScreen(),t="";return e==Screens.List?t="listActive":e==Screens.Outline?t="outlineActive":e==Screens.Settings&&(t="settingsActive"),this.search.isShowing()&&(t+=" searchShowing"),this.search.isFocused()&&(t+=" searchFocused"),t},normalMode:function(e){return this._modeHelper(e,this.Modes.Normal)},multiSelectMode:function(e){return this._modeHelper(e,this.Modes.Multiselect)},contactMode:function(e){return this._modeHelper(e,this.Modes.Contact)},dateMode:function(e){return this._modeHelper(e,this.Modes.Date)},isSaved:function(){return log("IsSaved DriveStatus: ",t.vmMain.gdriveStatus()),i.offline||t.vmMain.gdriveStatus()===DriveStatus.Saved},showSearchSeparator:function(){return this.search.showSearchSeparator()},isTimeline:function(){return t.focusedPane.mode()==PaneMode.Timeline},titleText:function(){var e=t.focusedPane.item(),r=e.getParsedText();return r},isMenuMain:function(){return t.ScreenManager.isScreenOpen(Screens.List)},isMenuContext:function(){return t.ScreenManager.isScreenOpen(Screens.Outline)},isMenuSettings:function(){return t.ScreenManager.isScreenOpen(Screens.Settings)},updateSearchDOM:function(){},onTapMultiSelectCancel:{onClick:function(e){t.menus.closeMultiSelect(),t.handlerPreventStop(e)}},onTapContactCancel:{onClick:function(e){t.autocomplete.hide(),t.handlerPreventStop(e)}},onTapList:{onClick:function(e){t.ScreenManager.scrollToScreen(Screens.List),t.handlerPreventStop(e),t.sendEvent("PhoneMenu","CloseOutline")}},onTapOutline:{onClick:function(e){t.ScreenManager.scrollToScreen(Screens.Outline),t.handlerPreventStop(e),t.sendEvent("PhoneMenu","OpenOutline")}},onTapSettings:{onClick:function(e){log("tap settings"),t.ScreenManager.scrollToScreen(t.ScreenManager.activeScreen==Screens.Settings?Screens.Outline:Screens.Settings),t.handlerPreventStop(e),t.sendEvent("PhoneMenu","OpenSettings")}},onTapMode:{onClick:function(e){log("mode",e),this.toggleMode(),t.handlerPreventStop(e),t.sendEvent("PhoneMenu","SwitchMode")}},onTapArchive:{onClick:function(e){t.focusedPane.archiveCompleted(),t.sendEvent("PhoneMenu","ArchiveCompleted"),t.handlerPreventStop(e)}},onTapHeader:{onStart:function(e){t.ScreenManager.checkSwipeStart(e)},onMove:function(e){t.ScreenManager.checkSwipeMove(e)},onEnd:function(e){t.ScreenManager.checkSwipeEnd(e)}},paneTapped:function(){},updateSearchTransform:function(){t.element("searchDivPhone").style[i.transform.style]=this.searchTranslate+" "+this.searchScale},toggleMode:function(){t.blurActiveElement(),t.focusedPane.initialOffset=void 0,t.focusedPane.mode()==PaneMode.Normal?(t.vmMain.clearSelected(),t.focusedPane.mode(PaneMode.Timeline)):t.focusedPane.mode(PaneMode.Normal),t.focusedPane.vmSearch.updateSearch(!0),t.vmMain.updatePaneState(t.focusedPane)},appEvents:{undo:function(){log("shake to undo"),n.undoAction()},redo:function(){log("shake to redo"),n.redoAction()},kbsize:function(e){i.kbsize=e},enterBackground:function(){t.onunload()},enterForeground:function(){o.poke(),t.checkForRemoteChanges()},reportLowMemory:function(e){t.handleLowMemory(e)},statusBarTap:function(){var e=t.getFirstPaneItem(t.focusedPane);t.scrollToTop(e.getSpan(),200)}}},a}),define("VMKeyboardToolbar",["ko","globals","data","edit","platform"],function(e,t,r,i,n){function o(){this.buttons=e.observableArray(),this.priorityVisible=e.observable(),this.isVisible=e.observable(!1),this.element=void 0,this.aboutToShow=void 0,this.bottomPosition=void 0,this.init()}return o.prototype={init:function(){this.element=document.getElementById("mobileKeyboardToolbar"),t.applyBindings(this,"mobileKeyboardToolbar"),window.addEventListener("closeKeyboard",this.hide.bind(this))},onTap:{onStart:t.handlerPreventStop,onClick:function(e){var r=e.srcElement.id;if("mobileKeyboardToolbar"==r&&(e.preventDefault(),e.returnFalse=!0),"closeKeyboardButton"==r)t.blurActiveElement(),t.vmMain.clearSelected();else if(t.vmSearchPhone.isFocused()){var i;"priorityButton"==r?i="!":"dateButton"==r?i="@":"contactButton"==r?i="+":"tagButton"==r&&(i="#"),t.vmSearchPhone.insert(i)}else"outdentButton"==r?t.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!0}):"indentButton"==r?t.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!1}):"priorityButton"==r?this.priorityVisible(!this.priorityVisible()):"pNoneButton"==r?t.vmMain.applyPriorityToSelection(VMLIFlag.None,!1):"p0Button"==r?t.vmMain.applyPriorityToSelection(VMLIFlag.P0,!0):"p1Button"==r?t.vmMain.applyPriorityToSelection(VMLIFlag.P1,!0):"p2Button"==r?t.vmMain.applyPriorityToSelection(VMLIFlag.P2,!0):"pStarButton"==r?t.vmMain.applyFnToSelection("isFlagged",!0):"dateButton"==r?t.vmMain.insertCharacter("@",!0):"contactButton"==r?t.vmMain.insertCharacter("+",!0):"tagButton"==r&&t.vmMain.insertCharacter("#",!0);e.stopImmediatePropagation(),e.preventDefault(),e.returnFalse=!0}},preShow:function(){this.aboutToShow=!0,this.priorityVisible(!1),setTimeout(function(){this.aboutToShow=!1}.bind(this),100)},show:function(){this.aboutToShow=!1,this.updatePosition(),t.isKeyboardOpen=!0,n.ie||this.isVisible(!0),this.hideTopBarIfLandscape(),t.vmSearchPhone.isFocused()?t.addClass(this.element,"kbsearch"):t.removeClass(this.element,"kbsearch")},hide:function(){!this.aboutToShow&&t.isKeyboardOpen&&(this.priorityVisible(!1),t.isKeyboardOpen=!1,this.hideTopBarIfLandscape(),this.isVisible(!1))},hideTopBarIfLandscape:function(){if(n.orientation===Orientation.Landscape&&t.isKeyboardOpen){if(t.setTransform(t.element("container"),0,-40),t.setTransform(t.element("phoneMenuTopWrapper"),0,-40),t.vmMain.selected().length>0){var e=t.vmMain.selected()[0];t.scrollToTop(e.getSpan())}}else t.setTransform(t.element("container"),0,0),t.setTransform(t.element("phoneMenuTopWrapper"),0,0)},updatePosition:function(e){n.app||(n.kbsize=n.orientation==Orientation.Portrait?n.kbsizePortrait:n.kbsizeLandscape);var r=n.kbsize;r!=this.bottomPosition&&(this.bottomPosition=r,t.element("mobileKeyboardToolbar").style.bottom=this.bottomPosition+"px",e&&(this.isVisible(!1),setTimeout(function(){this.isVisible(!0)}.bind(this),400)))}},o}),define("VMHelp",["ko","globals"],function(e,t){function r(){this.isVisible=e.observable(!1),this.helpContentEle=void 0,this.iframe=void 0,this.init()}return r.prototype={init:function(){t.menus.registerModal("help",this)},onLoad:function(e){this.helpContentEle=e,this.iframe||(this.iframe=document.createElement("iframe"),this.iframe.id="helpContentFrame",this.iframe.src="help.html",this.iframe.setAttribute("seamless","seamless")),this.helpContentEle.insertBefore(this.iframe,this.helpContentEle.firstElementChild)},onTapClose:function(){t.menus.closeModal("help")}},r}),this.document||(importScripts("lib/date.js"),importScripts("DuchessHelpers.js")),this.document?window.parseWorkerWrapper=parseWorkerWrapper:parseWorkerWrapper(),define("parseWorker",function(){}),define("VMIntroSection",["ko","globals","platform","data"],function(e,t){function r(t,r){this.text=t,this.note=r,this.items=[],this.inOrder=!1,this.owner=void 0,this.numComplete=0,this.next=0,this.isComplete=e.observable(!1)}return r.prototype={getHash:function(){return t.introHash(this.text)},getStepHash:function(e){return t.introHash(this.items[e].text)},loadFromSaveData:function(e){if(e===!0){for(var t=0;t<this.items.length;++t)this.items[t].isChecked(!0);this.numComplete=this.items.length,this.isComplete(!0)}else{for(var t=0;t<e.length;++t)for(var r=0;r<this.items.length;++r)e[t]===this.getStepHash(r)&&(this.items[r].isChecked(!0),this.numComplete++);this.numComplete===this.items.length&&this.isComplete(!0)}},addStep:function(r){return r.check||(r.check=function(){}),r.isChecked||(r.isChecked=e.observable(!1)),this.inOrder?r.isDisabled||(r.isDisabled=e.observable(this.items.length>0)):r.isDisabled=t.fFalse,this.items.push(r),r},complete:function(e){e.isChecked(!0),this.owner.notifyOfChange(e)},check:function(e){for(var t=0;t<this.items.length;t++)!this.items[t].isChecked()&&this.items[t].check(e)&&(this.complete(this.items[t]),this.inOrder&&(this.numComplete++,t===this.next&&(this.next++,this.next<this.items.length&&this.items[this.next].isDisabled(!1))));this.numComplete===this.items.length&&this.isComplete(!0)}},r}),define("VMIntro",["ko","globals","util","platform","data","VMIntroSection"],function(e,t,r,i,n,o){function a(r){try{t.PAssert(1354,void 0!==r,"Must pass in a valid display state")}catch(i){t.reportError(i)}this.mode=e.observable(r),this.sections=e.observableArray(),this.introSection=void 0,this.init(),t.intro=this}return window.HelpMode={None:0,Normal:1,Intro:2},a.prototype={init:function(){this.isIntroMode()?this.initIntro():this.initHelp(),this.loadState()},checkContactsEnable:function(){this.itemContactsEnable.isChecked(!0),this.saveState()},setMode:function(e){this.mode(e),t.settings.set(Settings.helpPaneState,e),t.vmMain.helpButtonHidden(e===HelpMode.Intro)},isIntroMode:function(){return this.mode()===HelpMode.Intro},modeClass:function(){return this.isIntroMode()?"helpIntro":"helpNormal"},loadState:function(){if(t.shouldWriteLocal())try{var e=r.storage.getItem(this.modeClass());if(e){var i=JSON.parse(e);if(i)for(var n=0;n<this.sections().length;++n){var o=this.sections()[n],a=o.getHash();i[a]&&o.loadFromSaveData(i[a])}}}catch(s){t.reportError(s)}},saveState:function(){if(t.shouldWriteLocal())try{var e=this.getState();r.storage.setItem(this.modeClass(),JSON.stringify(e))}catch(i){t.reportError(i)}},getState:function(){for(var e={},r=0;r<this.sections().length;++r){var i=this.sections()[r];if(i.isComplete())e[i.getHash()]=!0;else{for(var n=[],o=0;o<i.items.length;++o){try{t.PAssert(1355,i.items[o],"Item entries must exist")}catch(a){t.reportError(a)}if(i.items[o].isChecked()){var s=i.getStepHash(o);n.push(s)}}n.length>0&&(e[i.getHash()]=n)}}return e},notifyOfChange:function(){this.saveState()},addSection:function(e){e.owner=this,this.sections.push(e)},initIntro:function(){this.introSection=new o("Welcome to Moo.do!","We'll walk you through the basics to get you started."),this.introSection.inOrder=!0,this.introSection.addStep(this.itemAddItem),this.introSection.addStep(this.itemIndent),this.introSection.addStep(this.itemOutdent),this.introSection.addStep(this.itemDateTime),this.introSection.addStep(this.itemRightClick),this.introSection.addStep(this.itemAddAgenda),this.addSection(this.introSection)},itemAddItem:{text:"Write a list header and press enter to add a new item",check:function(e){if(e.type===TrackerType.Create){var t=n.itemsById[e.data[0].itemID].model;return t.parent()!=n.getRootModel()||0!==e.data[0].position?!0:!1}}},itemIndent:{text:"Press the Tab key to add an item into a list",check:function(e){if(e.type===TrackerType.Move){var t=n.itemsById[e.data[0].oldParent].data;if(t.items.indexOf(e.data[0].newParent)>=0)return!0}}},itemOutdent:{text:"Press Shift + Tab to remove an item out of a list",check:function(e){if(e.type===TrackerType.Move){var t=n.itemsById[e.data[0].newParent].data;if(t.items.indexOf(e.data[0].oldParent)>=0)return!0}}},itemDateTime:{text:"Add a date/time by typing @ in the text of an item",check:function(e){return e.type===TrackerType.Insert&&"@"===e.data[0].text}},itemRightClick:{text:"Right click an item to explore more options",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.RightClick}},itemAddAgenda:{text:'Click <i class="icon-calendar2 f22 gd"></i> in the top right to add an Agenda pane',check:function(e){if(e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.AddPane){var r=t.vmMain.panes()[e.data[0].data];if(r.mode()===PaneMode.Timeline)return!0}}},itemContactsEnable:{text:'<div id="buttonHelpEnableContacts" class="button bBlue" style="margin-right: 3px;">Enable</div> syncing contacts with your Google account',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SyncContacts&&e.data[0].value}},initHelp:function(){var e=new o("Organization","Moo.do works like a text editor so you can organize like you're writing a document.");e.addStep(this.itemAddItem),e.addStep(this.itemIndent),e.addStep(this.itemOutdent),e.addStep({text:"Click and drag on the left edge of an item to move it around",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.DropItem&&t.vmMain.isLoaded?!0:void 0}}),e.addStep({text:"Press "+cmdChar+" + Z to undo and "+cmdChar+" + Y to redo",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.UndoRedo?!0:void 0}}),e.addStep({text:"To collapse an item and hide its children press "+cmdChar+" + , or select collapse from the right click menu",check:function(e){var t=e.data[0];return e.type===TrackerType.Update&&"isCollapsed"===t.field&&t.newValue}}),this.addSection(e);var r=new o("Dates","Scheduling items automatically puts them on your Agenda.");r.addStep(this.itemDateTime),r.addStep({text:'Write dates in plain English like <span class="date">@tomorrow</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&t.vmMain.isLoaded){var r=e.data[0].date;return!!r}}}),r.addStep({text:'Schedule a full date and time like <span class="date">@today 2:30pm</span> or <span class="date">@5/25 6:00</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&t.vmMain.isLoaded){var r=e.data[0].date;if(r)return r._explicitTime}}}),r.addStep({text:'Describe urgency with <span class="date">@now</span>, <span class="date">@soon</span>, or <span class="date">@later</span>',check:function(e){if(e.type===TrackerType.Misc&&e.misc===TrackerMisc.ChangeDate&&t.vmMain.isLoaded){var r=n.itemsById[e.data[0].itemID].model;return r?t.isDateSoft(r.dateText):!1}}}),this.addSection(r);var i=new o("Priority","Prioritizing items automatically puts them on your agenda and lets you manage what to do next.");i.addStep(this.itemRightClick),i.addStep({text:"Set a priority with the right click menu or "+cmdChar+" + 1/2/3",check:function(e){var t=e.data[0];return e.type===TrackerType.Update&&"priority"===t.field&&t.newValue>0}}),i.addStep({text:"Click the left of an item or "+cmdChar+" + / to mark it complete",check:function(e){var t=e.data[0];return e.type===TrackerType.Update&&"isComplete"===t.field&&t.newValue}}),i.addStep({text:"Press "+cmdChar+" + ' to flag an item which highlights it in yellow",check:function(e){var t=e.data[0];return e.type===TrackerType.Update&&"isFlagged"===t.field&&t.newValue}}),this.addSection(i);var a=new o("Contacts","Add a contact to an item to easily start a call or email.");a.addStep(this.itemContactsEnable),t.waitForElement("buttonHelpEnableContacts",function(e){e.onclick=function(){t.vmSettings.enableSyncContacts()}},100),a.addStep({text:"Add a contact by typing + in the text of an item",check:function(e){return e.type===TrackerType.Insert&&"+"===e.data[0].text}}),a.addStep({text:"Select a contact's name from the list or start typing a name to narrow the search",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.AddContact}}),a.addStep({text:'Click on a <span class="contact">+contact</span> to start a call or email',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenContact}}),this.addSection(a);var s=new o("Panes","There are two types of panes: List and Agenda. The List pane is where you write and organize while the Agenda pane is organized automatically by time and priority.");s.addStep({text:'Click <i class="icon-align-left f22 gd"></i> in the top right to add a List pane',check:function(e){if(e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.AddPane){var r=t.vmMain.panes()[e.data[0].data];if(r.mode()===PaneMode.Normal)return!0}}}),s.addStep(this.itemAddAgenda),s.addStep({text:'Click <i class="icon-remove gd"></i> in the top right of a pane to close it',check:function(e){return e.type===TrackerType.UIAction&&e.data[0].type===TrackerUIAction.RemovePane}}),this.addSection(s);var c=new o("Focus","Focus on an item to show only the items under it");c.addStep({text:"To focus on an item, right click on it and select zoom or press "+cmdChar+" + Enter",check:function(e){return e.type===TrackerType.Zoom&&!e.data[0].zoomOut}}),c.addStep({text:'To bring focus back out, click the <span class="titleWrapper"><span class="titleOpen">title of the list</span></span> you want to focus on',check:function(e){return e.type===TrackerType.Zoom&&e.data[0].zoomOut}}),c.addStep({text:'Press <i class="outlineButtonNormal icon-list"></i> in the top left of a pane to open the outline',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.ToggleOutline}}),c.addStep({text:"Click the title of a list in the outline to focus on it",check:function(e){return e.type===TrackerType.Zoom&&!e.data[0].zoomOut&&t.focusedPane.outline.isVisible()}}),this.addSection(c);var d=new o("Search","Filter for only the items you want to see right now");d.addStep({text:"Filter for a keyword by searching for that word",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged}}),d.addStep({text:'Mark similar items with a <span class="tag">#tag</span> to easily search for all items matching that tag',check:function(e){return e.type===TrackerType.Insert&&"#"===e.data[0].text}}),d.addStep({text:"Filter by priority by searching for !, !!, or !!!",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data[0].text.indexOf("!")>=0}}),d.addStep({text:"Show only flagged items by searching for '' (two apostrophes)",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data[0].text.indexOf("''")>=0}}),d.addStep({text:"Hide items you're not interested in by starting a search with - (dash)",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data[0].text.indexOf("-")>=0}}),d.addStep({text:"Hide completed items by searching for -// (dash, two slashes)",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.SearchChanged&&e.data[0].text.indexOf("-//")>=0}}),this.addSection(d);var l=new o("Collaboration","Collaborate with others by sharing documents with different groups of people");l.addStep({text:'Click <i class="icon-reorder f22 gd"></i> in the top left to open the sidebar',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.ToggleSidebar&&e.data[0].value}}),l.addStep({text:'Click <i class="icon-plus f18 g"></i> to create a new document',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.AddDocument&&e.data[0].value}}),l.addStep({text:"Open your new document by clicking on it in the list of documents",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenDocument&&e.data[0].value}}),l.addStep({text:'Click <i class="icon-user f18 c g"></i> to change the sharing settings',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenDocSharing&&e.data[0].value}}),this.addSection(l);var u=new o("Data","Import data from another app to use in Moo.do or export your data out of Moo.do");u.addStep({text:"Paste into Moo.do by pressing "+cmdChar+" + V or finding Paste in your browsers edit menu",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.Paste&&e.data[0].value}}),u.addStep({text:"Copy the selected text by pressing "+cmdChar+" + C or finding Copy in your browsers edit menu",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.Copy&&e.data[0].value}}),u.addStep({text:'Click on Import Data in the sidebar, then choose the app to import from and follow the instructions. If you do not see your app, try using copy and paste to paste it in to Moo.do. If that does not work, please <a href="mailto:support@moo.do?subject=Import Request">contact us</a> and tell us what app you want to import from.',check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenImport&&e.data[0].value}}),u.addStep({text:"Click on Export Data in the sidebar, then choose the format you'd like. You can see your data in a new tab so you may copy or download it.",check:function(e){return e.type===TrackerType.Misc&&e.misc===TrackerMisc.OpenExport&&e.data[0].value}}),this.addSection(u),!this.itemContactsEnable.isChecked()&&t.settings.get(Settings.syncContacts)&&this.checkContactsEnable(),window.addEventListener("settingsChange",function(e){"syncContacts"==e.data.property&&this.checkContactsEnable()}.bind(this))},onAction:function(e){try{for(var r=0;r<this.sections().length;r++)this.sections()[r].check(e)}catch(i){t.reportError(i)}},onClosePane:function(){t.tooltip.hideTip(),t.vmMain.closeHelp()},introComplete:function(){return this.introSection&&this.introSection.isComplete()},switchToHelp:function(){this.initHelp(),this.setMode(HelpMode.Normal),this.sections.splice(0,1),delete this.introSection,this.saveState()}},a}),define("VMMain",["ko","globals","util","android","data","gdata","goog","edit","copypaste","VMMain_DragDrop","VMLI","VMTitle","tracker","platform","VMSearch","VMPane","VMMenus","VMSettings","VMPicker","VMPhoneMenu","VMKeyboardToolbar","VMHelp","parseWorker","VMIntro"],function(e,t,r,i,n,o,a,s,c,d,l,u,h,p,m,f,g,v,y,b,S,T,x,w){var E=function(){function s(){try{t.PAssert(1360,window.helperWrapper,"helperWrapper must be defined for worker to be created")}catch(e){t.reportError(e)}try{t.PAssert(1361,window.dateWrapper,"dateWrapper must be defined for worker to be created")}catch(e){t.reportError(e)}try{t.PAssert(1362,window.parseWorkerWrapper,"parseWorkerWrapper must be defined for worker to be created")}catch(e){t.reportError(e)}var r;if(p.ie)r="js/parseWorker.js",window.helperWrapper=void 0,window.dateWrapper=void 0,window.parseWorkerWrapper=void 0,delete window.helperWrapper,delete window.dateWrapper,delete window.parseWorkerWrapper;else try{var i=window.helperWrapper.toString(),n=window.dateWrapper.toString(),o=window.parseWorkerWrapper.toString(),a="parseWorkerWrapper();";window.URL=window.URL||window.webkitURL,r=window.URL.createObjectURL(new Blob([i,n,o,a],{type:"text/javascript"}))}catch(s){ShouldLog(LogLevels.Warning)&&log("---- WARNING: Blob URLs not supported, falling back to default web worker support! ----"),ShouldLog(LogLevels.Warning)&&log(JSON.stringify(s)),r="js/parseWorker.js"}finally{window.helperWrapper=void 0,window.dateWrapper=void 0,window.parseWorkerWrapper=void 0,delete window.helperWrapper,delete window.dateWrapper,delete window.parseWorkerWrapper}return r}function u(){if(!E.worker){if(!window.Worker)return ShouldLog(LogLevels.Warning)&&log("---- WARNING: Running without WebWorker support! ----"),E.supportWebWorker=!1,void(E.worker=void 0);var e=s();try{E.worker=new Worker(e)}catch(r){if(18===r.code)try{E.worker=new Worker("js/parseWorker.js")}catch(i){t.reportError(i)}else t.reportError(r)}E.worker?(E.worker.onmessage=function(e){if(t.isString(e.data))return void log("Message from worker: ",e.data);log("Worker Finished: ",e.data.end-e.data.start,"ms");for(var r,i=-1,o=0;o<P.length;++o)P[o].id===e.data.id&&(r=P[o],i=o);try{t.PAssert(1363,r,"Must have a valid response handler")}catch(a){t.reportError(a)}try{t.PAssert(1364,r.id===e.data.id,"Respose handler should match request")}catch(a){t.reportError(a)}if(P.splice(i,1),e.data.styles)for(var o=0;o<e.data.styles.length;++o){var s=e.data.styles[o],c=n.getModel(r.items[o].id);if(c){var d={};c.styleText(s,!0,d)&&c.save(d,SaveFlag.None)}}e.data.done&&r.cb&&r.cb(),e.data.styles||e.data.done||log("Error in parse worker: ",e)},E.worker.onerror=function(e){log("Error in ParseWorker: ",e,e.message),t.reportError(new Error("Worker reported error"))}):E.supportWebWorker=!1}}function m(e,r){try{t.PAssert(1365,E.worker,"Worker must exist")}catch(i){t.reportError(i)}if(E.supportWebWorker){var o=I++;P.push({id:o,cb:r,items:e});var a={id:o,items:e};A||(a.contacts=n.getContacts(),A=!0),E.worker.postMessage(a)}}function g(e){t.isLoadingRemote=!0;try{n.beginTransaction(),t.timeline.startLoading();var r=t.settings.get(Settings.lastServerVersion),i=o.getServerVersion();r===i&&log("Client and Server Versions Match!"),t.startTimeEvent("PageLoad","RemoteData","Load Remote Data"),h.beginAction();var a=t.settings.get(Settings.localIntegrity);a===!1&&(ShouldLog(LogLevels.Warning)&&log("Previous remote sync had an issue!"),t.reportError(new Error("Previous remote sync had an issue!"))),o.loadSeen={},REPORT_ACTIONS&&n.reportData(DataSnapshot.Before),t.settings.set(Settings.localIntegrity,!1),E.root().initFromGDrive(e),t.settings.set(Settings.localIntegrity,!0),REPORT_ACTIONS&&n.reportData(DataSnapshot.After),o.loadSeen={},h.endAction(),E.flushParseItems(function(){for(var e=0;e<E.panes().length;e++)E.panes()[e].vmSearch.updateSearch(!0)}),E.flushModifiedItems(function(e){log("Flushing Modified: ",Object.keys(e).length)}),t.timeline.endLoading(),n.hasLocalData&&E.root().resetModified(),n.clearPendingUpdates(),t.endTimeEvent(),t.fireCustomEvent("remoteDataLoaded")}catch(s){t.reportError(s),t.messageQueue.pushMessage({text:"There was an error loading your data from the server, consider reloading the app.",type:MessageType.Error,action:MessageAction.Reload})}finally{n.endTransaction(),t.isLoadingRemote=!1,t.vmMain.isLoadingDoc(!1),t.StopSpinner()}}function x(){if(!p.mobile){var e=t.restoreSavedSelection("loadData");if(!e&&t.focusedPane&&!t.focusedPane.isTimeline()){var r=t.getFirstPaneItem(t.focusedPane);r&&t.setSelection(r.getSpan(),0,0)}}}var E={root:e.observable(void 0),panes:e.observableArray(),height:e.observable(0),isHelpShowing:e.observable(!1),isLoaded:!1,numCols:e.observable(),hasResized:e.observable(!1),isSidebarOpen:!1,helpButtonHidden:e.observable(!1),gdriveStatus:e.observable(-1),main:void 0,mainTransform:0,isPhone:p.phone,outline:void 0,vmSettings:new v(this),supportWebWorker:!0,swipingScreens:!1,swipeDirection:0,lastSwipeMove:0,lastSwipeMoveTime:0,vmPicker:new y,vmHelp:new T,selected:e.observableArray(),help:void 0};p.mobile&&(E.elPhoneMenu=t.element("phoneMenu")),t.vmSettings=E.vmSettings,E.isOnline=function(){return E.gdriveStatus()!==DriveStatus.Offline},E.isLocal=function(){return"localhost"==window.location.hostname},E.onlineText=function(){if(E.isDemoMode())return"DEMO";switch(E.gdriveStatus()){case DriveStatus.Offline:return"OFFLINE";case DriveStatus.Saving:case DriveStatus.Saved:return"ONLINE"}},d(E);var M=0;E.maxWidth=e.computed({read:function(){if(E.isPhone)return p.windowWidth()+"px";var e=800*E.panes().length+(E.isHelpShowing()?400:0);return e+"px"},deferEvaluation:!0}),E.needsPadTop=e.computed({read:function(){return E.isPhone?void 0:800*E.panes().length+(E.isHelpShowing()?400:0)+170>p.windowWidth()}}),E.pinButtons=e.computed({read:function(){return p.windowWidth()>800*E.panes().length},deferEvaluation:!0}),E.getUserName=e.computed({read:function(){var e=o.authenticatedUser();return e?e.displayName:E.gdriveStatus()===DriveStatus.Saved?"Connected":t.vmSetup.loginState()==LoginState.LOGGED_IN?"Connecting":"Demo"},deferEvaluation:!0}),E.getUserImage=function(){var e=o.authenticatedUser();return e?e.photoUrl:void 0},E.isDemoMode=function(){return t.isDemoMode()},window.addEventListener("scriptLoadError",function(e){E.handleScriptLoadError(e)}),E.handleScriptLoadError=function(e){"gapiScript"===e.data.id&&(log("Failed to load GAPI!"),E.setGDriveStatus(DriveStatus.Offline),E.failedGapiLoad=!0,setTimeout(a.goOnline,3e4))},E.setGDriveStatus=function(e){var r=E.gdriveStatus();e!==r&&e!==DriveStatus.Saving&&(E.gdriveStatus(e),e===DriveStatus.Offline?(t.goOffline(),p.mobile&&t.messageQueue.pushMessage(MessageID.MobileOffline)):r===DriveStatus.Offline&&(t.goOnline(),p.mobile&&t.messageQueue.clearMessage(MessageID.MobileOffline)))
},E.init=function(){c.init()},E.onLoad=function(){if(p.isTouchDevice&&!p.app)for(var e=document.getElementsByClassName("paneOutline"),r=0;r<e.length;++r)e[r].addEventListener(p.touchStartEvent,function(e){return t.preventScrollPropagation(ele)?void 0:(e.preventDefault(),!1)});p.touch&&setTimeout(function(){t.ScreenManager.computeSnapPoints()}.bind(this),0)},E.addModifiedItem=function(){},E.flushModifiedItems=function(){};var C=[];E.addParseItem=function(e,t){E.addItemToArrayForWorker(e,t,C)},E.flushParseItems=function(e){try{t.PAssert(1357,e,"Callback required")}catch(r){t.reportError(r)}C.length>0&&!a.loadingContacts&&E.runParseWorker(C,e),C=[]},E.runParseWorkerNewContacts=function(){if(E.root()){var e=[];E.parseWorkerNewContactsHelper(E.root(),e),e.length>0&&E.runParseWorker(e)}},E.parseWorkerNewContactsHelper=function(e,r){try{t.PAssert(1358,e,"Must supply a valid item to parse")}catch(i){t.reportError(i)}var n=e.getRawText();n.indexOf(ContactPrefix)>=0&&r.push({id:e.id,text:e.getRawText(),isUpdate:!1,prevDate:e.getDateTime()});for(var o=e.items(),a=0;a<o.length;a++)E.parseWorkerNewContactsHelper(o[a],r)},E.addItemToArrayForWorker=function(e,t,r){r.push({id:e.id,text:e.getRawText(),isUpdate:!t&&e.isLoaded,prevDate:e.getDateTime()})},E.addChildrenToArrayForWorker=function(e,r,i){try{t.PAssert(1359,e,"Must supply a valid item to parse")}catch(n){t.reportError(n)}i.push({id:e.id,text:e.getRawText(),isUpdate:!r&&e.isLoaded,prevDate:e.getDateTime()});for(var o=e.items(),a=0;a<o.length;a++)E.addChildrenToArrayForWorker(o[a],r,i)};var I=0,P=[],A=!1;E.notifyContactsUpdated=function(){A=!1},E.runParseWorker=function(e,r){{var i;performance.now()}if(e&&e instanceof Array){try{t.PAssert(1366,e instanceof Array,"Inputs to runParseWorker must either be: undefined, single item or an array")}catch(o){t.reportError(o)}try{t.PAssert(1367,e.length>0,"Shouldnt run the parse worker with no items in the input array")}catch(o){t.reportError(o)}log("Running Parse Worker for Array: ",e.length),i=e}else{i=[];var a=e;e?log("Running Parse Worker for Item: ",e.id):(a=E.root(),log("Running Parse Worker for Root.")),a&&E.addChildrenToArrayForWorker(a,!1,i)}u(),E.supportWebWorker?(log("Parsing Items Async: ",i.length),m(i,r)):setTimeout(function(){log("Parsing Items Sync: ",i.length);for(var e=n.getContacts(),t=0;t<i.length;++t){var r=i[t],o=DuchessHelpers.parseText(r.text,r.prevDate,r.isUpdate,e),a=n.getModel(r.id);if(a){var s={};a.styleText(o,!0,s)&&a.save(s,SaveFlag.None)}}},0)},E.createPane=function(e,t){isNaN(e)&&(e=E.panes().length);var r=new f({id:M++,item:E.root(),mode:t});return E.addPane(r,e),E.setFocusedPane(r),r},E.removePane=function(e){for(var t=E.panes(),r=0;r<t.length;r++)if(e==t[r])return E.removePaneAtIndex(r),E.setFocusedPane(t[0]),r;return-1},E.paneCount=function(){return E.panes().length};var k=0;E.setupDateRollover=function(){var e=new Date,r=e.clone().addDays(1).clearTime();try{t.PAssert(1368,r>e,"Rollover time must be in the future")}catch(i){t.reportError(i)}try{t.PAssert(1369,r>k,"Rollover time must be after the last rollover")}catch(i){t.reportError(i)}return log("Next Rollover Time: ",r),setTimeout(function(){function e(){E.runParseWorker(),t.timeline.reloadTimelines(),log("-------------------------------")}try{t.PAssert(1370,E.isLoaded,"Expect that we have fully loaded the page before performing rollover")}catch(r){t.reportError(r)}log("---- Running Date Rollover ----"),lastDateRollver=new Date;E.setupDateRollover();t.settings.get(Settings.syncContacts)?(a.loadedContacts=!1,a.loadContacts(e)):e()},r-e),r};var D=!1;E.loadGDriveData=function(){if(!D){D=!0,p.mobile||t.saveSelection("loadData");var e=o.rootItem;E.root().linkToGDrive(e),o.itemsLoaded=!0;try{o.checkRemoteIntegrity()}catch(r){t.reportError(r)}var i=n.getRootItem();i.id!==e.id?n.modifyItemId(i.id,e.id,function(){var r=n.getModel(e.id);try{t.PAssert(1371,i.id===e.id,"IDs should have been modified in modifyItemId")}catch(o){t.reportError(o)}i.id=e.id,n.setRoot(e.id),r.forceModifiedItems=!0,g(e),n.hasLocalData||r.items.valueHasMutated(),x()}):(g(e),x()),E.vmPicker.refreshFiles()}};var L=!1;E.loadData=function(){function e(e){var t="fake_"+e.replace(" ","");i.push({id:"contact_"+o++,name:e,isDemo:!0,emails:[{address:t+"@moo.do",primary:!0}],phoneNumbers:[{number:"(555) 123-4567",type:"mobile"}]})}if(!L&&n.localDataLoaded()){if(L=!0,t.startTimeEvent("PageLoad","LocalData","Load Local Data"),E.root(new l(n.getRootItem())),t.checkpoint(Checkpoint.LocalDocLoad),t.endTimeEvent(),t.requireGDriveDataCallback&&E.loadGDriveData(),E.isDemoMode()){var i=[],o=0;e("Ramada"),e("Canyon Ranch"),e("Jim Joseph"),e("Miller Harris"),e("Bob Johnson"),e("Bill Wilson"),e("Emily Edwards"),e("Jane Johnson"),e("Mike Thomas"),e("Joe Lewis"),e("Grant"),e("Jay"),e("Honey Bear"),n.loadContacts(i,!0)}E.runParseWorker(void 0,function(){r.getURLParam("data");E.isDemoMode()&&(p.script&&t.vmSetup.runScript(r.getURLParam("script")),window.parent.postMessage("loaded","*"))}),E.afterLoaded(),t.startTimeEvent("PageLoad","ApplyBindings","Apply Bindings"),t.applyBindings(E,"container");for(var a=0;a<E.panes().length;a++)E.panes()[a].vmSearch.onUpdated.valueHasMutated();E.isLoaded=!0,document.getElementById("container").style.display="block",t.endTimeEvent()}},E.changeRoot=function(e){try{t.PAssert(1372,e,"Cannot use to reset root to undefined")}catch(r){t.reportError(r)}var i=!1,o=n.getModel(e);o||(o=new l(n.getItem(e)),i=!0);try{t.PAssert(1373,o,"Must have a new root VMLI at this point, otherwise failed creation")}catch(r){t.reportError(r)}if(o){E.root(o);for(var a=0;a<E.panes().length;a++)E.panes()[a].item(o),E.panes()[a].notifyOfZoom();i&&E.runParseWorker(void 0)}},E.resetScrollOffsets=function(){for(var e=0;e<E.panes().length;e++){var t=E.panes()[e];t.setScrollOffset(t.defaultOffset)}},E.helpMessage=function(){return p.mobile?"Welcome to Moo.do! If this is your first time here take a minute to orient yourself, otherwise your data will be here shortly.":"Welcome to Moo.do! If this is your first time here take a minute to orient yourself and import your data, otherwise your data will be here shortly. You can access the introduction at a later time through the top-right menu."},E.onTapMain={onClick:function(){E.isDemoMode()&&p.script&&window.parent.postMessage("click","*")}},E.addPane=function(e,r){try{t.PAssert(1374,e,"Must pass in a valid pane to update")}catch(i){t.reportError(i)}var n=t.settings.get(Settings.paneState);n||(n=[]);try{t.PAssert(1375,n.length===E.panes().length,"Pane state does not match currently loaded pane set")}catch(i){t.reportError(i)}void 0===r?E.panes.push(e):E.panes.splice(r,0,e),n.push({id:e.id,focus:e.item().id,mode:e.mode(),showarch:e.showArchived(),search:e.vmSearch.search(),offset:0}),t.settings.set(Settings.paneState,n)},E.removePaneAtIndex=function(e){try{t.PAssert(1376,void 0!==e,"Must pass in a valid index to remove")}catch(r){t.reportError(r)}var i=t.settings.get(Settings.paneState);try{t.PAssert(1377,i,"Pane state should always be valid when removing panes")}catch(r){t.reportError(r)}try{t.PAssert(1378,i.length===E.panes().length,"Pane state does not match currently loaded pane set")}catch(r){t.reportError(r)}E.panes.splice(e,1),i.splice(e,1),t.settings.set(Settings.paneState,i)},E.afterLoaded=function(){var e;if(E.isDemoMode()?E.clearPaneState():e=t.settings.get(Settings.paneState),e){for(var r=0;r<e.length&&!(p.mobile&&r>0);++r){var i=e[r];i.id=M;var o=n.getModel(i.focus);o||(o=E.root(),i.focus=o.id,i.offset=0,i.search="");try{t.PAssert(1379,o,"Should always have a valid item at this point")}catch(a){t.reportError(a)}var s=new f({id:M++,item:o,mode:i.mode,search:i.search,offset:i.offset});i.showarch&&s.showArchived(!0),E.panes.push(s),E.setFocusedPane(s,!0),E.zoomin(o,!0)}1!==E.panes().length&&E.setFocusedPane(E.panes()[0],!0)}if(E.isDemoMode()&&t.demoPanes){for(var r=0;r<t.demoPanes.length;r++)E.addPane(new f({id:M++,item:E.root(),mode:+t.demoPanes[r]}));var s=E.panes()[0];t.focusedPaneID=s.id,t.focusedPane=s,t.focusedItem=s.item(),E.zoomin(s.item(),!0)}else if(0===E.panes().length){var s=new f({id:M++,item:E.root()});if(E.addPane(s),!p.mobile&&t.activeDisplayMode&DisplayMode.ForceTwoPane){var c=new f({id:M++,item:E.root(),mode:PaneMode.Timeline});E.addPane(c)}t.focusedPaneID=s.id,t.focusedPane=s,t.focusedItem=E.root(),E.zoomin(E.root(),!0)}p.mobile&&(t.phoneMenu=new b,t.keyboardToolbar=new S),t.timeline.updateNotifications()},E.clearPaneState=function(){t.settings.reset(Settings.paneState)},E.updatePaneState=function(e){if(!t.isRunningScript()&&!p.mobile){try{t.PAssert(1381,e,"Must pass in a valid pane to update")}catch(r){t.reportError(r)}var i=t.settings.get(Settings.paneState);try{t.PAssert(1382,i,"Pane state should always be valid when updating state")}catch(r){t.reportError(r)}try{t.PAssert(1383,i.length===E.panes().length,"Pane state does not match currently loaded pane set")}catch(r){t.reportError(r)}for(var n=!1,o=0;o<i.length;++o){var a=i[o];if(a.id===e.id){a.focus=e.item().id,a.mode=e.mode(),a.showarch=e.showArchived(),a.search=e.vmSearch.search(),t.settings.set(Settings.paneState,i),n=!0;break}}try{t.PAssert(1384,n,"Pane state should always be found")}catch(r){t.reportError(r)}}},E.updatePaneScrollState=function(){if(!t.isRunningScript()&&!p.mobile){var e=t.settings.get(Settings.paneState);if(e&&E.panes().length>0){try{t.PAssert(1385,e.length===E.panes().length,"Pane state does not match currently loaded pane set")}catch(r){t.reportError(r)}for(var i=0;i<e.length;++i){var n=e[i],o=E.panes()[i];n.offset=o?o.getScrollOffset():0}t.settings.set(Settings.paneState,e)}}};var O;E.getFirstSelectedItem=function(){try{t.PAssert(1387,p.mobile,"Selection tracking only available from mobile")}catch(e){t.reportError(e)}return E.selected().length>0?E.selected()[0]:void 0},E.setSelected=function(e){try{t.PAssert(1388,p.mobile,"Selection tracking only available from mobile")}catch(r){t.reportError(r)}e=e||[],E._clearIsSelected(e);for(var i=0;i<e.length;i++)e[i].isSelected(!0);E.selected(e)},E._clearIsSelected=function(e){try{t.PAssert(1389,p.mobile,"Selection tracking only available from mobile")}catch(r){t.reportError(r)}e=e||[];for(var i=0;i<E.selected().length;i++){var n=E.selected()[i];e.indexOf(n)<0&&n.isSelected(!1)}},E.clearSelected=function(e){try{t.PAssert(1390,p.mobile,"Selection tracking only available from mobile")}catch(r){t.reportError(r)}E._clearIsSelected(e),E.selected([])},p.mobile&&(document.onselectionchange=function(){var r,n=t.getSelectionInfo(),o=!0;if(t.ignoreSelectionChange)return t.ignoreSelectionChange=!1,void(O=void 0);if(n){if(p.android&&t.dragging)return void t.clearSelection();var a=n.selection.getRangeAt(0);if(o=!O||a.startContainer!==O.startContainer||a.endContainer!==O.endContainer,O&&!o&&a.startOffset==O.startOffset&&a.endOffset==O.endOffset)return;if("itemOptions"===a.startContainer.id||"fullscreenClickGrabber"===a.startContainer.id)return;if(O=a,t.focusedPane&&t.focusedPane.mode()===PaneMode.Normal){var s=t.getLIParent(a.startContainer),c=s?e.dataFor(s):void 0,d=!c||!c instanceof f&&!c instanceof l;if(d);else{t.restrictSelectionToText(),n=t.getSelectionInfo(),a=n.selection.getRangeAt(0);var u=t.getLIParent(a.startContainer),h=t.getLIParent(a.endContainer);if(u&&h&&!t.hasClass(u,"emptyPaneItem")&&!t.hasClass(h,"emptyPaneItem")){var m=e.dataFor(u);if(o)if(u!==h){var g=e.dataFor(h);r=t.getItemsBetween(m,g,t.focusedPane)}else r=[m],i.isEnabled()&&i.updateInput(m)}}}}else(p.android||p.mobileie||p.ios&&(!p.app||p.ipad))&&t.fireCustomEvent("closeKeyboard");n||(O=void 0),!o||p.android||p.mobileie||E.setSelected(r)}),E.setFocusedPaneFromElement=function(r){if(r){var i=t.hasClass(r,"paneRoot")?r:t.getPaneForElement(r).rootElement,n=e.dataFor(i);try{t.PAssert(1391,n,"Could not find matching pane")}catch(o){t.reportError(o)}E.setFocusedPane(n)}};var R=!1;E.setFocusedPane=function(e,r){t.focusedPaneID!==e.id&&(R=!r,t.focusedPaneID=e.id,t.focusedPane=e,t.focusedItem=t.focusedPane.item())},E.zoomin=function(e,r){try{t.PAssert(1392,e,"Must supply a valid item to zoom to")}catch(i){t.reportError(i)}var n=t.focusedItem;E._zoom(e,r);var o=t.focusedPane;r||t.sendEvent("Menu","ZoomIn"),!p.mobile&&o.paneContent&&t.setSelection(o.paneContent,0,0),o.rootElement?o.setScrollOffset():setTimeout(function(){o.setScrollOffset()},0),e.isCollapsed()&&e.toggleCollapsed(),r||h.performAction(TrackerType.Zoom,{itemID:e.id,oldItemID:n.id,zoomOut:!1,time:t.zoomTime})},E.zoomout=function(e,r){try{t.PAssert(1393,e,"Must supply a valid item to zoom to")}catch(i){t.reportError(i)}var n=t.focusedItem;E._zoom(e,!1),t.sendEvent("Menu","ZoomOut"),t.selectChildren(r,r.getParsedText().length,0),t.scrollToTop(r.getSpan(),0),h.performAction(TrackerType.Zoom,{itemID:e.id,oldItemID:n.id,zoomOut:!0,time:t.zoomTime})},E._zoom=function(e,r){try{t.PAssert(1394,e,"Must supply a valid item to zoom to")}catch(i){t.reportError(i)}var n=t.focusedItem;n&&n.id===e.id||(t.focusedPane.item(e),t.focusedPane.notifyOfZoom(),t.focusedItem=e,r||E.updatePaneState(t.focusedPane))},E.onMenuButtonClick=function(){E.isSidebarOpen?(E.closeSidebar(),t.sendEvent("Menu","CloseSidebar")):(E.openSidebar(),t.sendEvent("Menu","OpenSidebar"))},E.onHelpButtonClick=function(){this.showHelp(HelpMode.Normal),t.sendEvent("Menu","HelpMain")},E.onHelpMouseOver=function(){},E.onHelpMouseOut=function(){};var _=document.getElementById("cheatSheetContainer");E.openCheatSheet=function(){var e=document.getElementById("desktopHelpButton").getBoundingClientRect();_.style.top=e.bottom+5+"px",t.removeClass(_,"none")},E.closeCheatSheet=function(){t.addClass(_,"none")},E.closeSidebarEvent=function(e){return E.isSidebarOpen?(E.closeSidebar(),e.preventDefault(),!1):void 0},t.addCustomEventListener("keyEscape",E.closeSidebarEvent,200),E.openSidebar=function(){E.isSidebarOpen=!0,t.autocomplete&&t.autocomplete.hide(),t.tooltip.hideTip(),t.setTransform(t.element("container"),250,0),setTimeout(function(){t.element("main").addEventListener("mouseup",E.closeSidebarEvent)},0),h.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleSidebar,data:[{value:!0}]})},E.closeSidebar=function(){E.isSidebarOpen=!1,t.setTransform(t.element("container"),0,0),t.element("main").removeEventListener("mouseup",E.closeSidebarEvent),t.hideHighlightElement(),h.miscAction({type:TrackerType.Misc,misc:TrackerMisc.ToggleSidebar,data:[{value:!1}]})};var N=document.getElementById("fullscreenClickGrabber"),F=!1;E.handleFullscreenClick=function(e){F||(t.setupClick(N,void 0,{onRightClick:function(e){N.style.display="none";var r=document.elementFromPoint(e.clientX,e.clientY),i=t.getPaneForElement(r);i&&i.onTap.onRightClick({srcElement:r,pageX:e.x,pageY:e.y,preventDefault:function(){e.preventDefault()},stopPropagation:function(){e.stopPropagation()},stopImmediatePropagation:function(){e.stopImmediatePropagation()}}),N.style.display=""},onEnd:function(){E.cancelFullscreenClick(),e()}}),t.removeClass(N,"none"),F=!0)},E.cancelFullscreenClick=function(){F&&(t.addClass(N,"none"),t.menus.closeAllMenus(),F=!1)},E.applyFnToSelection=function(e,t){var r=t&&t.toggle||t===!0,i=t&&void 0!==t.value?t.value:!0;if(E.applyToSelection(function(t){r&&t[e]()!==i&&(r=!1),r||t[e](i)}),r){var n=n=t&&void 0!==t.emptyValue?t.emptyValue:!1;E.applyToSelection(function(t){t[e](n)})}},E.applyPriorityToSelection=function(e,t){t?E.applyFnToSelection("priority",{toggle:!0,value:e,emptyValue:VMLIFlag.None}):E.applyFnToSelection("priority",{value:e})},E.insertCharacter=function(e,r){var n;if(i.isEnabled()){n=i.getInputText();var o=n[i.getSelectionStart()-1];r&&" "!==o?i.insertText(i.getSelectionStart()," "+e):i.insertText(i.getSelectionStart(),e)}else{var a=t.getSelectionRange();if(a){var s=t.getItemForElement(a.startContainer);if(s){n=s.getRawText();var o=n[a.startOffset-1];r&&" "!==o&&t.fireKeyEvent(void 0,{normCode:KeyCode.Space}),t.fireKeyEvent(void 0,{normCode:e.charCodeAt(0)})}}}},E.applyToSelection=function(e,r){var i=r&&r.passExtraInfo,n=t.getSelectionInfo();if(!n||0===n.rangeCount)return!0;if(n.node&&t.hasClass(n.node,"search"))return!0;var o=t.getPaneForElement(n.node);if(!o)return!0;if(t.restrictSelectionToText(),n=t.getSelectionInfo(),!n||0===n.rangeCount)return!0;var a=n.selection.getRangeAt(0);if(t.hasClass(a.startContainer.parentNode,"timelineItemTime"))return!0;var s=t.getItemForElement(a.startContainer),c=t.getItemForElement(a.endContainer);if(void 0===s||void 0===c)return!0;h.beginAction(),0===a.endOffset&&s!==c&&(c=t.getPreviousItem(c,t.focusedPane));for(var d=t.getItemsBetween(s,c,t.focusedPane),l=E.panes(),u=l.length,p=0;p<d.length;++p){var m=i?e(d[p],p,d.length):e(d[p]);if(m===!1)break;for(var f=0;u>f;f++)l[f]!=t.focusedPane&&l[f].vmSearch.checkItem(d[p])}return h.endAction(),d.length};var V={over:void 0,wasPointer:!1};E.updateCursor=function(e){V&&V.over&&(e&&("A"===V.over.tagName||t.hasClass(V.over,"tag"))?(V.wasPointer=!0,V.over.style.cursor="pointer"):!e&&V.wasPointer&&(V.wasPointer=!1,V.over.style.cursor="text"))},p.touch||(E.mousemove=function(e){if(!t.disableMouseMove&&(e.pageX!==V.pageX||e.pageY!==V.pageY)){V.pageX=e.pageX,V.pageY=e.pageY;var r=e.srcElement||e.target;if(e.offsetX>=0&&e.offsetX<=18){var i=t.getLIParent(V.over),n=t.getLIParent(r);n&&t.addClass(n,"hoveredFormatter"),i&&i!==n&&t.removeClass(i,"hoveredFormatter")}else{var i=t.getLIParent(V.over);i&&t.removeClass(i,"hoveredFormatter")}e.ctrlKey&&("A"===r.tagName||t.hasClass(r,"tag"))?(V.wasPointer&&(V.over.style.cursor="text"),V.wasPointer=!0,r.style.cursor="pointer"):V.wasPointer&&(V.wasPointer=!1,V.over.style.cursor="text"),V.over=r}},t.element("container").addEventListener("mousemove",E.mousemove)),E.addPaneToRight=function(e){var t=E.panes().length,r=E.createPane(t,e);E.cancelFullscreenClick(),e===PaneMode.Normal&&r.vmSearch.focusBox(),h.performAction(TrackerType.UIAction,{type:TrackerUIAction.AddPane,data:t})},E.onTapAddNormal=function(){E.addPaneToRight(PaneMode.Normal),t.sendEvent("Menu","AddPaneNormal")},E.onTapAddTimeline=function(){E.addPaneToRight(PaneMode.Timeline),t.sendEvent("Menu","AddPaneTimeline")},E.showSearchSeparator=function(){return!p.mobile||t.phoneMenu.showSearchSeparator()},E.onTapSettingsPhone={onStart:function(e){t.ScreenManager.checkSwipeStart(e)},onMove:function(e){t.ScreenManager.checkSwipeMove(e)},onEnd:function(e){t.ScreenManager.checkSwipeEnd(e)}},E.isLoadingDoc=function(e){for(var r=0;r<E.panes().length;r++)e?t.addClass(E.panes()[r].paneContent,"loading"):t.removeClass(E.panes()[r].paneContent,"loading")},E.showHelp=function(e){if(!p.mobile){var r=e||HelpMode.Intro;this.help||(this.help=new w(r),this.helpButtonHidden(r===HelpMode.Intro)),this.isHelpShowing(!0),t.settings.set(Settings.helpPaneState,r)}},E.closeHelp=function(){E.isHelpShowing(!1),E.helpButtonHidden(!1),t.settings.set(Settings.helpPaneState,HelpMode.None)};var B=t.settings.get(Settings.helpPaneState)||HelpMode.None;return B===HelpMode.None||t.isDemoMode()||E.showHelp(B),E.init(),E};return E});var saveAs=saveAs||navigator.msSaveBlob&&navigator.msSaveBlob.bind(navigator)||function(e){var t=e.document,r=function(){return e.URL||e.webkitURL||e},i=e.URL||e.webkitURL||e,n=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o="download"in n,a=function(r){var i=t.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(i)},s=e.webkitRequestFileSystem,c=e.requestFileSystem||s||e.mozRequestFileSystem,d=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l="application/octet-stream",u=0,h=[],p=function(){for(var e=h.length;e--;){var t=h[e];"string"==typeof t?i.revokeObjectURL(t):t.remove()}h.length=0},m=function(e,t,r){t=[].concat(t);for(var i=t.length;i--;){var n=e["on"+t[i]];if("function"==typeof n)try{n.call(e,r||e)}catch(o){d(o)}}},f=function(t,i){var d,p,f,g=this,v=t.type,y=!1,b=function(){var e=r().createObjectURL(t);return h.push(e),e},S=function(){m(g,"writestart progress write writeend".split(" "))},T=function(){(y||!d)&&(d=b(t)),p?p.location.href=d:window.open(d,"_blank"),g.readyState=g.DONE,S()},x=function(e){return function(){return g.readyState!==g.DONE?e.apply(this,arguments):void 0}},w={create:!0,exclusive:!1};return g.readyState=g.INIT,i||(i="download"),o?(d=b(t),n.href=d,n.download=i,a(n),g.readyState=g.DONE,void S()):(e.chrome&&v&&v!==l&&(f=t.slice||t.webkitSlice,t=f.call(t,0,t.size,l),y=!0),s&&"download"!==i&&(i+=".download"),(v===l||s)&&(p=e),c?(u+=t.size,void c(e.TEMPORARY,u,x(function(e){e.root.getDirectory("saved",w,x(function(e){var r=function(){e.getFile(i,w,x(function(e){e.createWriter(x(function(r){r.onwriteend=function(t){p.location.href=e.toURL(),h.push(e),g.readyState=g.DONE,m(g,"writeend",t)},r.onerror=function(){var e=r.error;e.code!==e.ABORT_ERR&&T()},"writestart progress write abort".split(" ").forEach(function(e){r["on"+e]=g["on"+e]}),r.write(t),g.abort=function(){r.abort(),g.readyState=g.DONE},g.readyState=g.WRITING}),T)}),T)};e.getFile(i,{create:!1},x(function(e){e.remove(),r()}),x(function(e){e.code===e.NOT_FOUND_ERR?r():T()}))}),T)}),T)):void T())},g=f.prototype,v=function(e,t){return new f(e,t)};return g.abort=function(){var e=this;e.readyState=e.DONE,m(e,"abort")},g.readyState=g.INIT=0,g.WRITING=1,g.DONE=2,g.error=g.onwritestart=g.onprogress=g.onwrite=g.onabort=g.onerror=g.onwriteend=null,e.addEventListener("unload",p,!1),v}(self);define("FileSaver",function(){}),define("dimport",["globals","data","tracker","VMLI","parse","goog"],function(e,t,r,i,n,o){function a(){this.workflowy={login:this.workflowyLogin.bind(this),"import":this.workflowyImport.bind(this),save:this.workflowySave.bind(this)},this.wunderlist={login:this.wunderlistLogin.bind(this),"import":this.wunderlistImport.bind(this),save:this.wunderlistSave.bind(this)},this.opml={login:this.opmlLogin.bind(this),"import":this.opmlImport.bind(this),save:this.opmlSave.bind(this)},this.json={login:this.jsonLogin.bind(this),"import":this.jsonImport.bind(this),save:this.jsonSave.bind(this)},this.text={login:this.textLogin.bind(this),"import":this.textImport.bind(this),save:this.textSave.bind(this)},this.gtasks={login:this.gtasksLogin.bind(this),"import":this.gtasksImport.bind(this),save:this.gtasksSave.bind(this)},this.trello={login:this.trelloLogin.bind(this),"import":this.trelloImport.bind(this),save:this.trelloSave.bind(this)},this.toodledo={login:this.toodledoLogin.bind(this),"import":this.toodledoImport.bind(this),save:this.toodledoSave.bind(this)}}return a.prototype={workflowyLogin:function(t,r,i,n){try{e.PAssert(1395,i,"Workflowy requires a success callback")}catch(o){e.reportError(o)}try{e.PAssert(1396,n,"Workflowy requires an error callback")}catch(o){e.reportError(o)}e.XHR({type:"POST",url:window.location.protocol+"//api.moo.do/oauth/workflowy",data:{username:t,password:r},cb:function(e){log("Login Response: ",e),200===e.status?(this.workflowy.data=JSON.parse(e.response),i()):(log("XHR Status: "+e.status),n("Error contacting remote server."))}.bind(this)})},workflowyImport:function(t,r){try{e.PAssert(1397,t,"Workflowy requires a success callback")}catch(i){e.reportError(i)}try{e.PAssert(1398,r,"Workflowy requires an error callback")}catch(i){e.reportError(i)}t(this.workflowy.data)},workflowyIterateItem:function(t,r){var n=673732,o=139527,a=139529,s=204343;try{e.PAssert(1399,t&&void 0!==t.lm&&void 0!==t.nm,"All items must exist and have flags and text, children and notes are optional",t)}catch(c){e.reportError(c)}try{e.PAssert(1400,t.lm===n||t.lm===o||t.lm===a||t.lm===s,"Unexpected lm value for workflowy import: "+t.lm)}catch(c){e.reportError(c)}try{e.PAssert(1401,r,"A valid parent must always be defined")}catch(c){e.reportError(c)}if(t&&r){var d=t.lm===n,l=new i({text:t.nm,isComplete:d},{parent:r,parse:!0,forceSave:!0});if(r.insertItem(l),t.no){var u=new i({text:t.no},{parent:l,parse:!0,forceSave:!0});l.insertItem(u)}if(t.ch)for(var h=0;h<t.ch.length;++h){var p=t.ch[h];this.workflowyIterateItem(p,l)}}},workflowySave:function(n,o,a){try{e.PAssert(1402,n,"Workflowy requires having valid data")}catch(s){e.reportError(s)}try{e.PAssert(1403,o,"Workflowy requires a success callback")}catch(s){e.reportError(s)}try{e.PAssert(1404,a,"Workflowy requires an error callback")}catch(s){e.reportError(s)}var c=n.projectTreeData.mainProjectTreeInfo;try{r.beginAction();var d=t.getRootModel();try{e.PAssert(1405,d,"Root item must exist in order to import")}catch(s){e.reportError(s)}var l=new i({text:"Workflowy Import:"},{parent:d,parse:!0,forceSave:!0});d.insertItem(l);for(var u=0;u<c.rootProjectChildren.length;++u){var h=c.rootProjectChildren[u];this.workflowyIterateItem(h,l)}e.vmMain.runParseWorker(l),r.endAction(),o()}catch(p){a(void 0,p)}},wunderlistLogin:function(t,r,i,n){try{e.PAssert(1406,i,"Wunderlist requires a success callback")}catch(o){e.reportError(o)}try{e.PAssert(1407,n,"Wunderlist requires an error callback")}catch(o){e.reportError(o)}e.XHR({type:"POST",url:"https://api.wunderlist.com/login",data:{email:t,password:r},cb:function(e){if(log("Login Response: ",e),200===e.status){var t=JSON.parse(e.response);this.wunderlist.token=t.token,i(t)}else log("XHR Status: "+e.status),n("Error contacting remote server.")}.bind(this)})},wunderlistImport:function(t,r){try{e.PAssert(1408,t,"Wunderlist requires a success callback")}catch(i){e.reportError(i)}try{e.PAssert(1409,r,"Wunderlist requires an error callback")}catch(i){e.reportError(i)}this.wunderlistGetLists(function(e){this.wunderlistGetTasks(function(r){for(var i={inbox:{title:"inbox",items:{},p:0}},n=0;n<e.length;++n){var o=e[n];i[o.id]={title:o.title,items:{},p:o.position}}for(var n=0;n<r.length;++n){var a=r[n];if(a.parent_id){var s=i[a.list_id].items[a.parent_id];s?(s.items||(s.items=[]),s.items.push(a)):i[a.list_id].items[a.parent_id]={items:[a]}}else{var c=i[a.list_id].items[a.id];i[a.list_id].items[a.id]=a,c&&(i[a.list_id].items[a.id].items=c.items)}}t(i)}.bind(this),r)}.bind(this),r)},wunderlistGetLists:function(t,r){try{e.PAssert(1410,t,"Wunderlist requires a success callback")}catch(i){e.reportError(i)}try{e.PAssert(1411,r,"Wunderlist requires an error callback")}catch(i){e.reportError(i)}e.XHR({type:"GET",url:"https://api.wunderlist.com/me/lists",headers:{Authorization:this.wunderlist.token},cb:function(e){if(200===e.status){var i=JSON.parse(e.response);t(i)}else log("XHR Status: "+e.status),r("Error contacting remote server.")}.bind(this)})},wunderlistGetTasks:function(t,r){try{e.PAssert(1412,t,"Wunderlist requires a success callback")}catch(i){e.reportError(i)}try{e.PAssert(1413,r,"Wunderlist requires an error callback")}catch(i){e.reportError(i)}e.XHR({type:"GET",url:"https://api.wunderlist.com/me/tasks",headers:{Authorization:this.wunderlist.token},cb:function(e){if(200===e.status){var i=JSON.parse(e.response);t(i)}else log("XHR Status: "+e.status),r("Error contacting remote server.")}.bind(this)})},wunderlistSave:function(n,o,a){try{e.PAssert(1414,o,"Wunderlist requires a success callback")}catch(s){e.reportError(s)}try{e.PAssert(1415,a,"Wunderlist requires an error callback")}catch(s){e.reportError(s)}try{r.beginAction();var c=t.getRootModel();try{e.PAssert(1416,c,"Root item must exist in order to import")}catch(s){e.reportError(s)}var d=new i({text:"Wunderlist Import:"},{parent:c,parse:!0,forceSave:!0});c.insertItem(d);for(var l in n){var u=n[l],h=u.title+(":"!==u.title[u.title.length-1]?":":""),p=new i({text:h},{parent:d,parse:!0,forceSave:!0});d.insertItem(p);for(var m in u.items){var f=u.items[m],g=new i({text:f.title,isComplete:!!f.completed_at,dateCompleted:f.completed_at,isFlagged:f.starred},{parent:p,parse:!0,forceSave:!0});if(p.insertItem(g),f.note){var v=new i({text:f.note},{parent:g,parse:!0,forceSave:!0});g.insertItem(v)}if(f.items)for(var y=0;y<f.items.length;++y){var b=f.items[y],S=new i({text:b.title,isComplete:!!b.completed_at,dateCompleted:b.completed_at,isFlagged:b.starred},{parent:g,parse:!0,forceSave:!0});g.insertItem(S)}}}e.vmMain.runParseWorker(d),r.endAction(),o()}catch(T){a(void 0,T)}},opmlLogin:function(t,r,i,n){try{e.PAssert(1417,i,"OPML requires a success callback")}catch(o){e.reportError(o)}try{e.PAssert(1418,n,"OPML requires an error callback")}catch(o){e.reportError(o)}i()},opmlImport:function(t,r){try{e.PAssert(1419,t,"OPML requires a success callback")}catch(i){e.reportError(i)}try{e.PAssert(1420,r,"OPML requires an error callback")}catch(i){e.reportError(i)}try{var o=new FileReader,a=document.forms.importFileUpload.importFile.files[0];a?(o.onload=function(i){var o,s=i.target.result;if((s.startsWith("<?xml ")||s.startsWith("<opml "))&&(o=e.loadXML(s)),o){var c=n.parseOPML(o,a.name);c?t():r("Error parsing OPML, please validate your data")}else r("Unable to load XML lib, please update or try another browser")},o.onerror=r,o.readAsText(a)):r("You must select a file before importing")}catch(s){r(void 0,s)}},opmlSave:function(t,r,i){try{e.PAssert(1421,r,"OPML requires a success callback")}catch(n){e.reportError(n)}try{e.PAssert(1422,i,"OPML requires an error callback")}catch(n){e.reportError(n)}log("OPML Save: ",t),r()},jsonLogin:function(t,r,i,n){try{e.PAssert(1423,i,"OPML requires a success callback")}catch(o){e.reportError(o)}try{e.PAssert(1424,n,"OPML requires an error callback")}catch(o){e.reportError(o)}i()},jsonImport:function(e,t){try{var r=new FileReader,i=document.forms.importFileUpload.importFile.files[0];i?(r.onload=function(r){var i=r.target.result;if(i)try{var o=JSON.parse(i),a=n.parseJSON(o);a?e():t("Error parsing JSON, please validate your data")}catch(s){t(void 0,s)}else t("Unable to import your requested file, please try agani")},r.onerror=t,r.readAsText(i)):t("You must select a file before importing")}catch(o){t(void 0,o)}},jsonSave:function(t,r,i){try{e.PAssert(1425,r,"OPML requires a success callback")}catch(n){e.reportError(n)}try{e.PAssert(1426,i,"OPML requires an error callback")}catch(n){e.reportError(n)}log("JSON Save: ",t),r()},textLogin:function(t,r,i,n){try{e.PAssert(1427,i,"OPML requires a success callback")}catch(o){e.reportError(o)}try{e.PAssert(1428,n,"OPML requires an error callback")}catch(o){e.reportError(o)}i()},textImport:function(t,r){var i,o=document.getElementById("importFileDataBox").textContent;if(o.startsWith("<?xml ")||o.startsWith("<opml "))try{if(i=e.loadXML(o)){var a=n.parseOPML(i,fileImport.name);if(a)return void t()}}catch(s){}if(o.startsWith("{")&&o.endsWith("}"))try{var c=JSON.parse(o),a=n.parseJSON(c);if(a)return void t()}catch(s){}r("Text Import Not Supported")},textSave:function(t,r,i){try{e.PAssert(1429,r,"OPML requires a success callback")}catch(n){e.reportError(n)}try{e.PAssert(1430,i,"OPML requires an error callback")}catch(n){e.reportError(n)}log("Text Save: ",t),r()},gtasksLogin:function(t,r,i,n){try{e.PAssert(1431,i,"GTasks requires a success callback")}catch(a){e.reportError(a)}try{e.PAssert(1432,n,"GTasks requires an error callback")}catch(a){e.reportError(a)}o.runAuthenticate([GScope.TasksRO],!1,!1,function(e){e&&!e.error?(this.gtasks.token=e,i(e)):n("Unable to authenticate with Google, please try again",e)}.bind(this))},gtasksImport:function(t,r){try{e.PAssert(1433,t,"GTasks requires a success callback")}catch(i){e.reportError(i)}try{e.PAssert(1434,r,"GTasks requires an error callback")}catch(i){e.reportError(i)}var n={roots:[],remoteItems:{},unassigned:[]};this.gtasksGetLists(function(i){try{e.PAssert(1435,e.isArray(i),"List data must be an array")}catch(o){e.reportError(o)}for(var a=0;a<i.length;++a){var s=i[a];n.remoteItems[s.id]={id:s.id,text:s.title,isComplete:!1,dateCompleted:void 0,isArchived:!1,due:void 0,notes:void 0,parent:void 0,items:[]},n.roots.push(s.id),this.gtasksGetTasks(s,function(r){try{e.PAssert(1436,e.isArray(r),"List data must be an array")}catch(i){e.reportError(i)}for(var o=0;o<r.length;++o){var a=r[o];n.remoteItems[a.id]={id:a.id,text:a.title,isComplete:"completed"===a.status,dateCompleted:a.completed?new Date(a.completed):void 0,isArchived:a.hidden,due:a.due?new Date(a.due):void 0,notes:a.notes,parent:a.parent||s.id,items:[]};var c=n.remoteItems[a.parent||s.id];
c?c.items.push(a.id):n.unassigned.push(a.id)}t(n)}.bind(this),r)}}.bind(this),r)},gtasksGetLists:function(t,r){try{e.PAssert(1437,t,"GTasks requires a success callback")}catch(i){e.reportError(i)}try{e.PAssert(1438,r,"GTasks requires an error callback")}catch(i){e.reportError(i)}var n=2e3;e.XHR({type:"GET",url:"https://www.googleapis.com/tasks/v1/users/@me/lists?maxResults="+n+"&key="+window.gapiKey+"&access_token="+o.getAccessToken(),cb:function(i){if(200===i.status){var n=JSON.parse(i.response);try{e.PAssert(1439,n.items,"Must have a valid array of lists")}catch(o){e.reportError(o)}t(n.items)}else log("XHR Status: "+i.status),r("Error contacting remote server.")}.bind(this)})},gtasksGetTasks:function(t,r,i){try{e.PAssert(1440,t,"GTasks requires a valid list to get tasks from")}catch(n){e.reportError(n)}try{e.PAssert(1441,r,"GTasks requires a success callback")}catch(n){e.reportError(n)}try{e.PAssert(1442,i,"GTasks requires an error callback")}catch(n){e.reportError(n)}var a=5e3;e.XHR({type:"GET",url:"https://www.googleapis.com/tasks/v1/lists/"+t.id+"/tasks?maxResults="+a+"&key="+window.gapiKey+"&access_token="+o.getAccessToken(),cb:function(t){if(200===t.status){var n=JSON.parse(t.response);try{e.PAssert(1443,n.items,"Must have a valid array of tasks")}catch(o){e.reportError(o)}r(n.items)}else log("XHR Status: "+t.status),i("Error contacting remote server.")}.bind(this)})},gtasksSave:function(n,o,a){function s(e,t){var r=e.text;e.due&&(r+=" "+e.due.toString("MM/dd h:mm"));var o=new i({text:r,isComplete:e.isComplete,dateCompleted:e.dateCompleted?e.dateCompleted.getTime():e.dateCompleted,isArchived:e.isArchived},{parent:t,parse:!0,forceSave:!0});if(t.insertItem(o),e.notes){var a=new i({text:e.notes},{parent:o,parse:!0,forceSave:!0});o.insertItem(a)}for(var c=0;c<e.items.length;++c)s(n.remoteItems[e.items[c]],o)}try{e.PAssert(1444,o,"GTasks requires a success callback")}catch(c){e.reportError(c)}try{e.PAssert(1445,a,"GTasks requires an error callback")}catch(c){e.reportError(c)}try{try{e.PAssert(1446,0===n.unassigned.length,"We should never have unassigned tasks")}catch(c){e.reportError(c)}r.beginAction();var d=t.getRootModel();try{e.PAssert(1447,d,"Root item must exist in order to import")}catch(c){e.reportError(c)}var l=new i({text:"Google Tasks Import:"},{parent:d,parse:!0,forceSave:!0});d.insertItem(l);for(var u=0;u<n.roots.length;++u)s(n.remoteItems[n.roots[u]],l);e.vmMain.runParseWorker(l),r.endAction(),o()}catch(h){a(void 0,h)}},trelloLogin:function(t,r,i,n){function o(){Trello.members("me",function(){},n)}function a(){n()}var s="667ecf0c3d3e029c51d205b7173f6c38";e.addScript("http://code.jquery.com/jquery-1.7.1.min.js","jqueryScript",function(){e.addScript("https://api.trello.com/1/client.js?key="+s,"trelloScript",function(){try{e.PAssert(1448,Trello,"The Trello client lib musthave been loaded correctly")}catch(t){e.reportError(t)}Trello.authorize({type:"popup",name:"Moo.do",persist:!1,expiration:"1hour",success:o,error:a})}.bind(this))}.bind(this))},trelloImport:function(){},trelloSave:function(){},toodledoLogin:function(e,t,r,i){var n="DuchessToodledoClientID",o="Dchs"+(new Date).getTime(),a="https://api.toodledo.com/3/account/authorize.php?response_type=code&client_id="+n+"&state="+o+"&scope=basic%20tasks%20notes%20outlines%20lists",s=(window.open(a,"toodledo","height=600,width=550"),function(e){var t=e.origin===location.origin;t&&(window.removeEventListener("message",s),e.data.error?i(e.data.error):(this.toodledo.token=e.data.access_token,r()))}.bind(this));window.addEventListener("message",s)},toodledoImport:function(){},toodledoSave:function(){}},a}),define("VMDebug",["ko","globals","platform","data","FileSaver","goog","dimport"],function(e,t,r,i,n,o,a){function s(){this.bugDescription=e.observable(""),this.mode=e.observable("html"),this.exportedContent="",this.exportedPreview=e.observable(""),this.exportArchived=e.observable(!0),this.importName=e.observable("JSON"),this.importDisplayMessage=e.observable(""),this.importing=!1,this.importer=new a,this.init()}return s.prototype={init:function(){this.exportArchived.subscribe(this.exportData.bind(this)),t.menus.registerModal("reportBug",this,this.reportBug),t.menus.registerModal("importData",this),t.menus.registerModal("exportData",this,this.openExport.bind(this),this.closeExport.bind(this))},reportBug:function(){setTimeout(function(){document.getElementById("bugDescription").focus()})},onTapSaveBug:function(){var e={};t.getAppInfo(e);var r=this.bugDescription()+"\r\n\r\n\r\n"+JSON.stringify(e,void 0,3),i=this.bugDescription().indexOf("\n"),n=this.bugDescription().substr(0,i>=0?i:Math.min(this.bugDescription().length,120)),o={name:n,notes:r};o.email=t.getUserIdentifier();var a=function(){t.XHR({type:"POST",url:window.location.protocol+"//api.moo.do/debug/reportIssue",data:o,cb:function(e){log("XHR Response: ",e),this.bugDescription("")}.bind(this)})}.bind(this);"Unknown"!==o.email?a():t.getClientInfo(function(e){e&&(o.email=e.ip),a()}),t.menus.closeModal("reportBug"),t.messageQueue.pushMessage({text:"Thanks for taking the time to send us feedback!",type:MessageType.Info,action:MessageAction.Default,timeout:1500}),t.blurActiveElement(),t.vmMain.clearSelected()},onTapCancelBug:function(){t.menus.closeModal("reportBug"),t.blurActiveElement(),t.vmMain.clearSelected()},openExport:function(){this.exportData(),this.exportKeyHandler=this.onExportKeydown.bind(this),document.addEventListener("keydown",this.exportKeyHandler,!0)},closeExport:function(){document.removeEventListener("keydown",this.exportKeyHandler,!0),this.exportKeyHandler=void 0},onTapCloseExport:function(){t.menus.closeModal("exportData")},exportData:function(){var e,t,r=i.getRootItem();if("html"==this.mode())e=i.toHtml(r,this.exportArchived()),t=e;else if("plain"==this.mode()){var n="&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;";e=i.toPlainText(r,0,this.exportArchived()),t=e.replace(/\n/g,"<br>").replace(/\t/g,n)}else"json"==this.mode()&&(e=i.toJSON(r,!1,this.exportArchived()),t=e);this.exportedContent=e,this.exportedPreview(t)},onTapHTML:function(e){this.mode("html"),this.exportData(),this.highlightExportButton(e)},onTapPlain:function(e){this.mode("plain"),this.exportData(),this.highlightExportButton(e)},onTapJSON:function(e){this.mode("json"),this.exportData(),this.highlightExportButton(e)},highlightExportButton:function(e){e.srcElement||(e.srcElement=e.target);var r=document.getElementById("exportTypes");if(r)for(var i=0;i<r.children.length;++i){var n=r.children[i];t.hasClass(n,"button")&&(n!==e.srcElement?t.removeClass(n,"bSelected"):t.addClass(n,"bSelected"))}},onTapOpen:function(){var e="plain"==this.mode()?this.exportedPreview():this.exportedContent,t=open("url");t.document.write(e)},onTapSelect:function(){var e=document.createRange();e.selectNodeContents(document.getElementById("exportedContent"));var t=window.getSelection();t.removeAllRanges(),t.addRange(e)},onTapSaveExport:function(){var e;"html"==this.mode()?e="html":"plain"==this.mode()?e="txt":"json"==this.mode()&&(e="json");try{var r=new Blob([this.exportedContent],{type:"text/plain;charset=utf-8"});saveAs(r,"moodo."+e)}catch(i){t.reportError(i)}},onExportKeydown:function(e){return r.normalizeKeys(e),(r.mac&&e.metaKey||!r.mac&&e.ctrlKey)&&e.normCode===KeyCode.A?(this.onTapSelect(),e.preventDefault(),e.stopPropagation(),!1):void 0},closeImport:function(){t.menus.closeModal("importData")},isAreaVisible:function(e){switch(this.importName()){case"Wunderlist":return"LoginArea"===e;case"Workflowy":return"LoginArea"===e;case"OPML":return"UploadArea"===e;case"JSON":return"UploadArea"===e;case"Text":return"TextArea"===e;case"Google Tasks":return"OAuthArea"===e;case"Trello":return"LoginArea"===e;case"Toodledo":return"OAuthArea"===e;default:try{t.PAssert(1449,!1,"Must add valid importer")}catch(r){t.reportError(r)}}return!1},highlightImportButton:function(e){e.srcElement||(e.srcElement=e.target);var r=document.getElementById("importLocations");if(r)for(var i=0;i<r.children.length;++i){var n=r.children[i];n!==e.srcElement?t.removeClass(n,"bSelected"):t.addClass(n,"bSelected")}},onTapRunImportWunderlist:function(e){this.importName("Wunderlist"),this.highlightImportButton(e)},onTapRunImportWorkflowy:function(e){this.importName("Workflowy"),this.highlightImportButton(e)},onTapRunImportOPML:function(e){this.importName("OPML"),this.highlightImportButton(e)},onTapRunImportJSON:function(e){this.importName("JSON"),this.highlightImportButton(e)},onTapRunImportText:function(e){this.importName("Text"),this.highlightImportButton(e)},onTapRunImportGTasks:function(e){this.importName("Google Tasks"),this.highlightImportButton(e)},onTapRunImportTrello:function(e){this.importName("Trello"),this.highlightImportButton(e)},onTapRunImportToodledo:function(e){this.importName("Toodledo"),this.highlightImportButton(e)},onTapRunImport:function(){if(!this.importing){var e=function(e,r){try{var i=e;i&&t.isString(i)||(i="There was an unexpected error, please double check your data"),this.importing=!1,this.importDisplayMessage(i),t.reportError(r||e,e)}catch(n){t.reportError(n)}}.bind(this),r=document.getElementById("importEmail").value,i=document.getElementById("importPW").value,n=void 0;switch(this.importName()){case"Wunderlist":n=this.importer.wunderlist;break;case"Workflowy":n=this.importer.workflowy;break;case"OPML":n=this.importer.opml;break;case"JSON":n=this.importer.json;break;case"Text":n=this.importer.text;break;case"Google Tasks":n=this.importer.gtasks;break;case"Trello":n=this.importer.trello;break;case"Toodledo":n=this.importer.toodledo;break;default:try{t.PAssert(1450,!1,"Must add valid importer")}catch(o){t.reportError(o)}}n&&(this.importing=!0,n.login(r,i,function(){n.import(function(r){n.save(r,function(){this.importDisplayMessage("Your data was imported successfully!"),this.importing=!1,setTimeout(function(){t.menus.closeModal("importData")}.bind(this),2e3)}.bind(this),e)}.bind(this),e)}.bind(this),e))}},importTitle:function(){var e=this.importName();return"OPML"!==e&&"JSON"!==e&&"Text"!==e?"Importing data from "+this.importName():"Upload "+e+" File"},importMessage:function(){return this.importDisplayMessage()}},s}),define("VMTimeline",["ko","globals","platform","data"],function(e,t,r){function i(){this.itemsToSchedule={},this.scheduleTimeout=0}return i.prototype={shouldNotify:function(e,t){return t||(t=new Date),!e.isComplete()&&e.date()&&e.date()>t&&!e.allDayDate&&!e.isArchived()},updateNotifications:function(e){if((r.ios||r.android)&&r.app&&!t.isDemoMode()&&t.vmSettings.enabledNotifications()){var i=0,n=new Date;if(e)this.shouldNotify(e,n)&&(this.itemsToSchedule[e.id]=e,i=1);else{var o=this;t.searchVMLIs({item:t.vmMain.root(),includeArchived:!1,comparator:function(e){return o.shouldNotify(e,n)},action:function(e){i++,o.itemsToSchedule[e.id]=e}})}this.scheduleTimeout&&clearTimeout(this.scheduleTimeout),i>0&&(this.scheduleTimeout=setTimeout(this.sendNotifications.bind(this),500))}},clearNotifications:function(){r.sendToApp("scheduledItems","[]")},sendNotifications:function(){var e="[",t=!0;for(var i in this.itemsToSchedule)if(this.itemsToSchedule.hasOwnProperty(i)){var n=this.itemsToSchedule[i];n.date()&&(t||(e+=","),e+=n.getBasicJSON(),t=!1)}e+="]",r.sendToApp("scheduledItems",e),this.itemsToSchedule={}},notifyPositionChanged:function(e){for(var r=0;r<t.vmMain.panes().length;++r)t.vmMain.panes()[r].notifyPositionChanged(e)},notifyStateChanged:function(e,r){if(e.date()&&r==PropChangeType.Date)this.dateUpdated(e);else for(var i=0;i<t.vmMain.panes().length;++i)t.vmMain.panes()[i].notifyStateChanged(e,r)},dateUpdated:function(e){t.vmMain.root()&&this.updateNotifications(e);for(var r=0;r<t.vmMain.panes().length;r++)t.vmMain.panes()[r].notifyStateChanged(e,PropChangeType.Date)},reloadTimelines:function(){for(var e=0;e<t.vmMain.panes().length;e++)t.vmMain.panes()[e].reloadTimeline()},load:function(){},startLoading:function(){for(var e=0;e<t.vmMain.panes().length;e++)t.vmMain.panes()[e].startLoading()},endLoading:function(){for(var e=0;e<t.vmMain.panes().length;e++)t.vmMain.panes()[e].endLoading()}},i}),define("VMMessage",["ko","globals","util","data"],function(e,t,r,i){function n(e,t){this.id=e.id,this.owner=t,this.text=e.text,this.type=e.type||MessageType.Info,this.action=e.action||MessageAction.Default,this.block=e.block||!1,this.bottom=e.bottom||!1,this.onCloseFn=e.onClose,this.timeout=e.timeout,this.clearTimeout=void 0,this._isVisible=!1}return n.prototype={show:function(){this._isVisible||(this._isVisible=!0,this.timeout&&(this.clearTimeout=setTimeout(this.hide.bind(this),this.timeout)),this.block&&t.removeClass(document.getElementById("overlayBlocker"),"none"),this.owner.onMessageShow(this))},hide:function(e){this._isVisible&&(this._isVisible=!1,clearTimeout(this.clearTimeout),this.clearTimeout=void 0,this.onCloseFn&&this.onCloseFn(this),e||this.owner.onMessageHide(this))},isVisible:function(){return this._isVisible},getClass:function(){var e;switch(this.type){case MessageType.Info:e="messageInfo";break;case MessageType.Intro:e="messageIntro";break;case MessageType.Warning:e="messageWarning";break;case MessageType.Error:e="messageError";break;case MessageType.Fatal:e="messageFatal";break;case MessageType.Subtitle:e="messageSubtitle";break;case MessageType.RequiredUpdate:e="messageRequiredUpdate";break;case MessageType.InfoGray:e="messageInfoGray";break;case MessageType.MobileOffline:e="messageMobileOffline";break;default:try{t.PAssert(1452,!1,"Invalid message type, add to globals.js")}catch(r){t.reportError(r)}e="messageInfo"}return this.bottom&&(e+=" bottom"),e},doAction:function(e){if(this.isVisible()){if(t.isFunction(this.action))this.action();else switch(this.action){case MessageAction.Default:this.hide();break;case MessageAction.Reload:t.reload(),this.hide();break;case MessageAction.Login:r.removeURLParam("demo"),this.hide();break;case MessageAction.Demo:r.insertURLParam("demo","true"),this.hide();break;case MessageAction.ResetClient:i.clearData(function(){t.reload()}),this.hide();break;case MessageAction.None:break;default:try{t.PAssert(1453,!1,"Invalid message action, add a new case here or pass in a function",this.action)}catch(n){t.reportError(n)}this.hide()}e.preventDefault(),e.stopImmediatePropagation(),e.returnFalse=!0}},onTapIgnore:{onStart:t.handlerPreventStop,onClick:function(e){this.isVisible()&&(this.hide(),e.preventDefault(),e.stopImmediatePropagation(),e.returnFalse=!0)}}},n}),define("VMMessageQueue",["ko","globals","util","platform","data","VMMessage"],function(e,t,r,i,n,o){function a(){this.queue=e.observableArray(),this.remoteMessages={},this.defaultMessages=[],this.defaultMessages[MessageID.Undefined]=void 0,this.hasConnectionError=!1,this.hasFatalError=!1,this.hasDocChange=!1,this.hasOfflineWarning=!1,this.hasOnlineInfo=!1,this.hasCacheReset=!1,this.hasRequiredUpdate=!1,this.currentFilter=0,this.FilterType={Mobile:1,Desktop:2,App:4},this.init()}return a.prototype={init:function(){t.applyBindings(this,"overlayArea"),i.demo||i.offline||setTimeout(this.updateRemoteMessages.bind(this),5e3),this.computeFilter()},getMessageById:function(e){void 0===this.defaultMessages[e]&&this.initMessageByid(e);try{t.PAssert(1454,void 0!==this.defaultMessages[e],"After init message should always be defined")}catch(r){t.reportError(r)}return this.defaultMessages[e]},testMessageById:function(e){return!!this.defaultMessages[e]},initMessageByid:function(e){switch(e){case MessageID.ConnectionError:this.defaultMessages[e]=new o({text:"Connection error detected, "+i.actionVerb()+" here to reconnect.",type:MessageType.Error,action:MessageAction.Reload},this);break;case MessageID.OfflineUndo:this.defaultMessages[e]=new o({text:"Offline undo/redo has been disabled temporarily",type:MessageType.Info},this);break;case MessageID.FatalError:this.defaultMessages[e]=new o({text:"There was a fatal error in the application, "+i.actionVerb()+" here to restart.",type:MessageType.Error,action:MessageAction.Reload},this);break;case MessageID.DocChange:this.defaultMessages[e]=new o({text:"The active document was changed in another tab, "+i.actionVerb()+" here to restart.",type:MessageType.Fatal,action:MessageAction.Reload,block:!0},this);break;case MessageID.OfflineWarn:this.defaultMessages[e]=new o({text:"You are offline and not saving your changes locally or remotely, you must reconnect before closing the window or you will lose your changes.",type:MessageType.Warning},this);break;case MessageID.OnlineInfo:this.defaultMessages[e]=new o({text:"You have gone back online, your changes have been saved.",type:MessageType.Info,timeout:1e4},this);break;case MessageID.CacheReset:this.defaultMessages[e]=new o({text:"To fix your issues we are going to clear the local cache. This will reload the page and your data, "+i.actionVerb()+" here to continue.",type:MessageType.Info,action:MessageAction.ResetClient},this);break;case MessageID.RequiredUpdate:this.defaultMessages[e]=new o({text:"A software update is required to continue, "+i.actionVerb()+" to update.",type:MessageType.RequiredUpdate,action:MessageAction.Reload,block:!0},this);break;case MessageID.Updated:this.defaultMessages[e]=new o({text:"An update was installed. "+i.actionVerbCaps()+" to reload.",type:MessageType.RequiredUpdate,action:MessageAction.Reload,bottom:!0},this);break;case MessageID.MobileOffline:this.defaultMessages[e]=new o({text:"OFFLINE",type:MessageType.MobileOffline,action:MessageAction.None,bottom:!0},this);break;default:try{t.PAssert(1455,!1,"Invalid MessageID")}catch(r){t.reportError(r)}}},pushMessage:function(e){var r;if(e instanceof o)r=e;else if(t.isObject(e))r=new o(e,this);else if(t.isString(e))r=new o({text:e},this);else if(r=this.getMessageById(e),!r){try{t.PAssert(1456,!1,"Invalid data passed to message creation")}catch(i){t.reportError(i)}log("Message not created properly",e)}return r&&r.show(),r},clearMessage:function(e){var t;return e instanceof o?t=e:this.testMessageById(e)&&(t=this.getMessageById(e)),t&&t.hide(),t},onMessageShow:function(e){this.queue.push(e)},onMessageHide:function(e){try{t.PAssert(1457,e,"Must pass in a valid message to be removed from the queue")}catch(r){t.reportError(r)}var i=this.queue.indexOf(e);if(0>i)try{t.PAssert(1458,!1,"Trying to remove an invalid message from the queue")}catch(r){t.reportError(r)}else this.queue.splice(i,1)},computeFilter:function(){i.isMobile&&(this.currentFilter|=this.FilterType.Mobile),i.isMobile||(this.currentFilter|=this.FilterType.Desktop),i.app&&(this.currentFilter|=this.FilterType.App)},updateRemoteMessages:function(){if(!t.isDemoMode()){var e=t.settings.get(Settings.lastMessageSync),r="";e&&(r="?lastSync="+new Date(e).toString("yyyy-MM-ddTHH:mm:ss"));var i=new Date;t.XHR({type:"GET",url:window.location.protocol+"//api.moo.do/debug/getMessages"+r,cb:function(e){if(200===e.status){t.settings.set(Settings.lastMessageSync,i);var r=JSON.parse(e.responseText);if(r)for(var n=r.m,o=0;n&&o<n.length;++o){var a=n[o],s=this.remoteMessages[a.id];if(!s){var c=!0;a.filter&&(c=0!==(a.filter&this.currentFilter),log("Remote Message Filter: "+a.filter+" "+this.currentFilter+" "+c)),c&&this.pushMessage({text:a.data,type:a.type,action:MessageAction.Default}),this.remoteMessages[a.id]=a}}}else log("Unable to get remote messages",e)}.bind(this)})}}},a}),define("TemplateCache",["ko","globals"],function(e,t){window.__TOTAL_TEMPLATES=0;var r={},i="__cached_template__";r.templateSources=function(r){var n={elem:r,__proto__:new e.templateSources.domElement(r)};return n.text=function(e){return 0===arguments.length?n.elem.text:void(n.elem.text=e)},n.nodes=function(){try{t.PAssert(1459,0===arguments.length)}catch(r){t.reportError(r)}if(0===arguments.length){var o=e.utils.domData.get(n.elem,i);if(!o){for(var a=n.text().replace(/(\r\n|\n|\r|\s*(?=<)|\s*$)/gm,""),s=e.utils.parseHtmlFragment(a),c=document.createElement("div"),d=0;d<s.length;d++)c.appendChild(s[d]);return e.utils.domData.set(n.elem,i,{cachedNodes:c}),c}return o.cachedNodes}},n},r.templateEngine=function(){var i={__proto__:new e.nativeTemplateEngine};return i.cachedDoc=void 0,i.makeTemplateSource=function(e,n){try{t.PAssert(1460,"string"==typeof e)}catch(o){t.reportError(o)}var a=n||document,s=i.cachedDoc;if(!i.cachedDoc){try{t.PAssert(1461,a)}catch(o){t.reportError(o)}s={doc:a,cachedTemplates:{}},i.cachedDoc=s}try{t.PAssert(1462,s)}catch(o){t.reportError(o)}var c=s.cachedTemplates[e];if(!c){var d=s.doc.getElementById(e);try{t.PAssert(1463,d)}catch(o){t.reportError(o)}if(d)try{c=new r.templateSources(d);try{t.PAssert(1464,c)}catch(o){t.reportError(o)}}catch(l){t.reportError(l)}else t.reportError(new Error('Unable to find element for template "'+e+'". '+d));s.cachedTemplates[e]=c,__TOTAL_TEMPLATES++}return c},i};var n=r.templateEngine();return n instanceof e.templateEngine&&e.setTemplateEngine(n),r}),define("VMContact",["ko","data","globals","goog","platform","tracker"],function(e,t,r,i,n){function o(t){this.templateName="template-contact",this.id=t.id,this.isSelected=e.observable(!1),this.text=t.text||"",this.image=void 0,this.phoneNumbers=t.phoneNumbers||[],this.emails=t.emails||[],this.dbItem=t,this.phone=void 0,this.phoneLink=void 0,this.email=void 0,this.emailLink=void 0,this.item=void 0,this.init()}return o.prototype={hasPreview:function(){return!0},init:function(){for(var e=0;e<this.phoneNumbers.length;e++)this.phoneNumbers[e].link=this.formatPhone(this.phoneNumbers[e].number);for(var e=0;e<this.emails.length;e++)this.emails[e].link="mailto:"+this.emails[e].address},onLoad:function(e){this.element=e},formatPhone:function(e){var t=/^(?:\+?1[-. ]?)?(?:\(?([0-9]{3})\)?[-. ]?)?([0-9]{3})[-. ]?([0-9]{4})$/;if(t.test(e)){var r=e.match(t),i="";r[1]&&(i+="("+r[1]+") "),i+=r[2]+"-"+r[3];var o="";return r[1]&&(o+="+1-"+r[1]+"-"),o+=r[2]+"-"+r[3],n.iphone?"tel:"+o:"callto:"+o}},onTapNumber:function(){},onTapEmail:function(){},onTap:{onClick:function(e){log(e.srcElement,this.text),r.hasClass(e.srcElement,"contactPhone")||r.hasClass(e.srcElement,"contactEmail")||r.autocomplete.onTapped(this.text)}}},o}),define("VMAutocompleteItem",["ko","data","globals","platform"],function(e,t,r){function i(t){this.id=t.id,this.text=t.text||"",this.object=t.object,this.index=t.index,this.isSelected=e.observable(!1),this.element=void 0,this.init()}return i.prototype={init:function(){},html:function(){var e=r.autocomplete.text(),t=this.text.toLowerCase().indexOf(e.toLowerCase()),i="";return t>=0&&(i=this.text.substr(0,t)+"<b>"+this.text.substr(t,e.length)+"</b>"+this.text.substr(t+e.length)),i},onLoad:function(e){this.element=e}},i}),define("AutocompleteDates",["ko","data","globals","platform"],function(){function e(){this.soft=["now","soon","later"],this.softDays=["today","tomorrow"],this.dayModifiers=["next"],this.days=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],this.months=["january","february","march","april","may","june","july","august","september","october","november","december"],this.dict=this.soft.concat(this.softDays).concat(this.dayModifiers).concat(this.days).concat(this.months),this.NextWordOptions={None:0,DayName:1,Days:2,Time:4},this.init()}return e.prototype={init:function(){},findDatesLike:function(e){for(var t=e.toLowerCase(),r=[],i=0;i<this.dict.length;++i)0===this.dict[i].indexOf(t)&&r.push({index:0,object:{id:this.dict[i],text:this.dict[i]}});return r},findExact:function(e){return this.dict.indexOf(e)>=0?this.nextWordOptions(e)==this.NextWordOptions.None:!1},nextWordOptions:function(e){var t=e.split(" "),r=t[t.length-1];if(""==r&&(r=t[t.length-2]),this.soft.indexOf(r)>=0)return this.NextWordOptions.None;if(this.softDays.indexOf(r)>=0)return this.NextWordOptions.Time;if(this.dayModifiers.indexOf(r)>=0)return this.NextWordOptions.DayName;if(this.days.indexOf(r)>=0)return this.NextWordOptions.Time;if(this.months.indexOf(r)>=0)return this.NextWordOptions.Days;var i=parseInt(r,10);return isNaN(i)?r.indexOf(":")>=0?this.NextWordOptions.Time:this.NextWordOptions.None:this.NextWordOptions.Time}},e}),define("VMAutocomplete",["ko","data","globals","platform","VMContact","VMAutocompleteItem","AutocompleteDates","tracker"],function(e,t,r,i,n,o,a,s){function c(){this.items=e.observableArray(),this.isVisible=e.observable(!1),this.element=void 0,this.trackingItem=void 0,this.trackingTag=void 0,this.selectedIndex=e.observable(-1),this.exactMatch=e.observable(!1),this.text=e.observable(""),this.autocompleteDates=new a,this.nextDateWord=e.observable(this.autocompleteDates.NextWordOptions.None),this.lastX=0,this.lastY=0,this.Modes={Contact:0,Date:1},this.mode=e.observable(-1),this.init()}return c.prototype={getDateText:function(e){switch(e){case 1:return e+"st ";case 2:return e+"nd ";case 3:return e+"rd ";default:return e+"th "}},getMinWidth:function(){return this.mode()===this.Modes.Contact?"350px":"180px"},showAllDates:function(){return""===this.text()},showDate:function(){return this.nextDateWord()==this.autocompleteDates.NextWordOptions.None||this.nextDateWord()==this.autocompleteDates.NextWordOptions.DayName},showDays:function(){return this.nextDateWord()==this.autocompleteDates.NextWordOptions.Days},showTime:function(){return this.nextDateWord()==this.autocompleteDates.NextWordOptions.Time},showDates:function(){return i.mobile&&i.app&&this.mode()==this.Modes.Date&&(""===this.text()||this.nextDateWord())},showList:function(){return!this.exactMatch()&&!this.showDates()},showPreview:function(){return this.selectedItem()&&this.mode()==this.Modes.Contact&&(!i.mobile||this.exactMatch)},hasContent:function(){return this.showDates()||this.showList()||this.showPreview()},templatePreview:function(){return"template-contact"},selectedItem:function(){return this.selectedIndex()<0?void 0:this.items()[this.selectedIndex()]},init:function(){this.onkeydown=this.onkeydown.bind(this),this.onMouseover=this.onMouseover.bind(this),this.element=document.getElementById("autocomplete"),r.applyBindings(this,"autocomplete"),window.addEventListener("closeKeyboard",this.hide.bind(this))},setMode:function(e){e==DatePrefix&&this.mode(this.Modes.Date),e==ContactPrefix&&this.mode(this.Modes.Contact)},show:function(e,t){if(!this.isVisible()){var n;if(!t&&(n=document.getSelection(),n&&n.baseNode)){var o=r.findParent(n.baseNode,"contact",2);t=o||r.findParent(n.baseNode,"date",2),o&&s.miscAction({type:TrackerType.Misc,misc:TrackerMisc.OpenContact,data:[{info:e}]})}var a=document.documentElement.getBoundingClientRect(),c=this.element.getBoundingClientRect(),d={left:c.left,right:c.right,top:c.top,bottom:c.bottom};if(0===c.width&&0===c.height&&(d.right=350,d.bottom=170),t){var l=t.getBoundingClientRect();r.setOrigin(d,l.left,l.bottom);var u=r.adjustOriginToBeInsideBounds(a,d,20,10,10,10);this.element.style.left=u.x+"px",this.element.style.top=u.y+"px"}else{if(!(n.rangeCount>0))return;var l=n.getRangeAt(0).getClientRects()[0];l.left-=20,r.setOrigin(d,l.left,l.bottom);var u=r.adjustOriginToBeInsideBounds(a,d,20,10,10,10);this.element.style.left=u.x+"px",this.element.style.top=u.y+"px"}if(this.isVisible(!0),this.element.scrollTop=0,i.mobile&&e){var h=150,p=r.scrollToTop(e.getSpan(),h),m=t?t.getBoundingClientRect():e.getSpan().getBoundingClientRect(),f=m.bottom-p;this.element.style.top=f-2+"px",this.mode()==this.Modes.Contact?r.phoneMenu.contactMode(!0):this.mode()==this.Modes.Date&&r.phoneMenu.dateMode(!0),r.keyboardToolbar.isVisible(!1);var g=i.windowHeight()-i.kbsize-f;r.setTransform(this.element,0,g),requestAnimationFrame(function(){r.setTransform(this.element,0,0,h,"ease-out")}.bind(this))}}},clear:function(){this.items.removeAll(),this.trackingTag=!1},hide:function(){if(this.isVisible()){var e=200;if(i.mobile){var t=i.windowHeight()-i.kbsize;r.setTransform(this.element,0,t,e,"ease-out"),setTimeout(function(){this.isVisible(!1),r.phoneMenu.contactMode(!1),r.isKeyboardOpen&&r.keyboardToolbar.isVisible(!0),this.clear()}.bind(this),e)}else this.isVisible(!1)}},onkeydown:function(e){if(0===this.items().length||!this.isVisible()||this.exactMatch()&&e.normCode!==KeyCode.Escape)return!0;if(e.normCode===KeyCode.UpArrow||e.normCode===KeyCode.DownArrow){if(this.items().length>1){this.selectedIndex()>=0&&this.items()[this.selectedIndex()].isSelected(!1);var t=this.selectedIndex()+(e.normCode==KeyCode.DownArrow?1:-1);return this.selectedIndex(0>t?this.items().length+t:t>=this.items().length?t%this.items().length:t),this.items()[this.selectedIndex()].isSelected(!0),!1}this.hide()}else{if(e.normCode===KeyCode.Enter){if(this.selectedIndex()>=0){var r=this.items()[this.selectedIndex()];this.onTapped(r.text,!0)}return this.hide(),!1}if(e.normCode===KeyCode.Escape)return this.hide(),!1}return!0},onTap:{onClick:function(t){var r=e.dataFor(t.srcElement);this.onTapped(r.text)}},onTapped:function(e,t){this.text(e),this.trackingItem&&this.trackingItem.onAutocompleteTapped(e,this.trackingTag),(t||this.mode()===this.Modes.Contact||!i.mobile)&&this.hide()},find:function(e,t,r){if(t+r>e.length-1)return!1;var i=e[t];isNaN(r)&&(r=0);for(var n=0;r>n&&e[t+n+1];n++)i+=" "+e[t+n+1];var o,a=-1!==i.indexOf(":",i.length-1)?i.substr(0,i.length-1):i;return this.mode()==this.Modes.Contact?o=this.findContact(a):this.mode()==this.Modes.Date&&(o=this.findDate(a)),o.length>0?this.find(e,t,r+1)||{start:t,num:r+1,text:a,results:o}:!1},findContact:function(e){return t.findContactsLike(e)},findDate:function(e){return this.autocompleteDates.findDatesLike(e)},findExact:function(e){return this.mode()==this.Modes.Contact?this.findContactExact(e):this.mode()==this.Modes.Date?this.findDateExact(e):void 0},findContactExact:function(e){return t.findContactsExact(e)},findDateExact:function(e){return this.autocompleteDates.findExact(e)},objectFromResult:function(e){return this.mode()==this.Modes.Contact?new n(e):this.mode()==this.Modes.Date?new n(e):void 0},getMinWordLength:function(){return this.mode()==this.Modes.Contact?1:this.mode()==this.Modes.Date?1:void 0},getLineIndexFromWordIndex:function(e,t){for(var r=0,i=0;t>i;i++)r+=e[i].length+1;return r},update:function(e){var t=e.item||this.trackingItem,r=t.getParsedText(),n=e.start,a=e.fromArrows;this.trackingItem=t,this.trackingTag=!1;var s,c=0,d=0,l=-1,u=-1,h=r.split(" ");for(c>0&&(h[0]=h[0].substr(c)),s=0;s<h.length;s++)(h[s].startsWith(ContactPrefix)||h[s].startsWith(DatePrefix))&&n>=d&&(l=s,u=d,this.setMode(h[s][0])),d+=h[s].length+1;this.getMinWordLength();if(l>=0){this.clear(),h[l]=h[l].substr(1);var p=this.find(h,l),m=1;if(""===h[l+1]&&m++,p&&u+m+p.text.length>=n){var f=this.findExact(p.text);if(this.exactMatch(!!f),f){var g={index:-1,text:f.text};g.object=this.objectFromResult(f),t=new o(g),this.items.push(t),this.selectedIndex(0),this.trackingTag=!0,a||i.mobile||this.show(this.trackingItem)}else{if(p&&p.num>0){this.trackingTag={text:p.text,index:this.getLineIndexFromWordIndex(h,p.start)+1,length:p.text.length},this.text(p.text);var t,v=p.results;for(s=0;s<v.length;s++){var y=v[s].object,g={index:s,text:y.text};g.object=this.objectFromResult(y),t=new o(g),this.items().push(t)}this.items.valueHasMutated(),this.selectedIndex(0),this.items()[0].isSelected(!0)}a||this.show(this.trackingItem)}}}this.nextDateWord(this.autocompleteDates.NextWordOptions.None),this.trackingTag||this.hide()},onMouseover:function(e){this.selectedIndex()>=0&&this.items()[this.selectedIndex()].isSelected(!1);var t=this.items.indexOf(e);t>=0&&(this.selectedIndex(t),e.isSelected(!0))},onTapDate:{onStart:r.handlerPreventStop,onClick:function(e){var t=e.srcElement;if("SPAN"==t.nodeName){var i=t.parentNode;if(r.hasClass(i,"disabled"))return;var n=t.id?t.id+" ":t.textContent,o=this.autocompleteDates.nextWordOptions(n);this.nextDateWord(o),log("next",o,this.trackingTag);var a=o==this.autocompleteDates.NextWordOptions.None;this.onTapped(n,a),this.trackingTag.index+=n.length}}}},c}),define("ScreenManager",["ko","globals","platform"],function(e,t,r){function i(e){this.snapPoints=[],this.screens=[],this.activeScreen=-1,this.screenAtSwipeStart=-1,this._isSwiping=!1,this.minOffset=0,this.maxOffset=0,this.owner=e,this.useScroll=!1,this.lastOffset=0,this.updateFunctions=[],this.paneWidth=.85,this.init()
}return window.Screens=r.mobile?{Settings:0,Outline:1,List:2,MAX:2}:{Outline:0,List:1,MAX:1},i.prototype={init:function(){this.activeScreen=Screens.MAX},getActiveScreen:function(){return this.activeScreen},setOwner:function(e){this.owner=e},isSwiping:function(){return this._isSwiping},isScreenOpen:function(e){return this.activeScreen===e},computeSnapPoints:function(){try{t.PAssert(1465,r.mobile,"Should only be computing snappoints on mobile")}catch(e){t.reportError(e)}try{t.PAssert(1466,this.owner,"Must have a valid owner to compute snap points")}catch(e){t.reportError(e)}for(var i=3*this.paneWidth,n=[0,this.paneWidth,2*this.paneWidth],o=this.useScroll?this.owner.scrollWidth:parseInt(t.width(this.owner))*i,a=0;a<n.length;++a)this.snapPoints[a]=Math.round(n[a]*(o/i));this.offsetMin=0,this.offsetMax=this.snapPoints[2],this.lastOffset=this.offsetMax},onResize:function(){if(r.mobile){var e=this.activeScreen;this.computeSnapPoints();var t=this.snapPoints[e];this.updateScreenOffset(e,t,0),this.lastOffset=t}},scrollToScreen:function(e){try{t.PAssert(1470,e<=Screens.MAX,"Must be a valid screen type")}catch(r){t.reportError(r)}this.activeScreen!==e&&(this.notifyScreenOfClose(this.activeScreen),this.notifyScreenOfOpen(e));var i=this.activeScreen;this.activeScreen=e;var n=this.snapPoints[e];return this.notifyScreenOfScroll(i,n,200),this.updateScreenOffset(e,n,200),this.lastOffset=n,n},updateScreenOffset:function(e,i,n){if(n=n||0,this.useScroll)if(n){var o=this.snapPoints[e];t.scrollTo(o,n,this.owner,!0)}else this.owner.scrollLeft=i;else for(var a=0;a<this.screens.length;++a){var s=this.screens[a].getTopElement();t.setTransform(s,-i,0,n,"ease-out");var c=i-(a-1)*r.windowWidth()*this.paneWidth,d=c/(r.windowWidth()*this.paneWidth);s.style.opacity=t.clamp(.4+.6*d,0,1)}t.setTransform(t.element("headers"),-i*(1/this.paneWidth),0,n),this.lastOffset=i},getCurrentScreenOffset:function(){return this.useScroll?this.owner.scrollLeft:this.lastOffset},addScreen:function(e,r){try{t.PAssert(1471,r<=Screens.MAX,"Must be a valid screen type")}catch(i){t.reportError(i)}try{t.PAssert(1472,void 0===this.screens[r],"Already have a screen at the given index")}catch(i){t.reportError(i)}this.screens[r]=e},getScreen:function(e){var r=this.screens[e];try{t.PAssert(1473,r,"Must have a valid screen")}catch(i){t.reportError(i)}return r},notifyScreenOfClose:function(e){if(-1!==e){var t=this.getScreen(e);t.onScreenClose&&t.onScreenClose()}},notifyScreenOfScroll:function(e,r,i){if(-1!==e)for(var n=0;n<this.screens.length;++n){var o=this.getScreen(n);o.onScreenScroll&&o.onScreenScroll(r,i)}t.fireCustomEvent("screenScroll")},notifyScreenOfStartOpen:function(e){if(-1!==e){var t=this.getScreen(e);t.onScreenStartOpen&&t.onScreenStartOpen()}},notifyScreenOfOpen:function(e){if(-1!==e){var t=this.getScreen(e);t.onScreenOpen&&t.onScreenOpen()}},startSwipe:function(){this._isSwiping||(this._isSwiping=!0,0===this.activeScreen?this.notifyScreenOfStartOpen(1):this.activeScreen===Screens.MAX?this.notifyScreenOfStartOpen(Screens.MAX-1):(this.notifyScreenOfStartOpen(this.activeScreen-1),this.notifyScreenOfStartOpen(this.activeScreen+1)))},updateSwipe:function(e){try{t.PAssert(1474,this.isSwiping(),"Must be swiping to perform an update")}catch(i){t.reportError(i)}if(r.ios||r.android||r.ie&&r.mobile){var n=this.getCurrentScreenOffset(),o=Math.max(Math.min(n+e,this.offsetMax),this.offsetMin);n!==o&&this.updateScreenOffset(this.activeScreen,o)}},endSwipe:function(){try{t.PAssert(1475,this.isSwiping(),"Must be swiping to end a swipe")}catch(e){t.reportError(e)}for(var i=this.getCurrentScreenOffset(this.activeScreen),n=-1,o=1e5,a=0;a<this.snapPoints.length;++a){var s=Math.abs(this.snapPoints[a]-i);o>s&&(n=a,o=s)}this.scrollToScreen(n),r.ios&&t.preventClick(),this._isSwiping&&(this._isSwiping=!1)},checkSwipeStart:function(e){var t=!1;return this.screenAtSwipeStart=this.activeScreen,r.ie&&!r.mobile||r.mobile&&this.activeScreen!==Screens.List&&e.eventX>this.paneWidth*r.windowWidth()&&(e.preventDefault(),t=!0),t},checkSwipeMove:function(e){var t=!1;if(r.ie&&!r.mobile);else if(r.mobile){var i=this.activeScreen!==Screens.MAX&&Math.abs(e.diffX)>5||this.activeScreen===Screens.MAX&&e.diffX>5;(this.isSwiping()||Math.abs(e.distanceY)<5&&i)&&(this.isSwiping()||this.startSwipe(),this.updateSwipe(-e.xThisFrame),e.preventDefault(),e.stopImmediatePropagation(),t=!0)}return t},checkSwipeClick:function(e){return this.activeScreen!==Screens.List&&e.eventX>this.paneWidth*r.windowWidth()?(this._isSwiping=!1,this.scrollToScreen(this.activeScreen+1),!0):this._isSwiping},checkSwipeEnd:function(){var e=!1;return this.activeScreen==this.screenAtSwipeStart?r.ie&&!r.mobile||r.mobile&&this.isSwiping()&&this.endSwipe():this.activeScreen!=this.screenAtSwipeStart&&(e=!0,log("return value is true")),e}},i}),define("VMTooltip",["ko","globals","platform"],function(e,t){function r(){this.listenerElement=void 0,this.displayElement=void 0,this.element=void 0,this.displayTimeout=void 0,this.extraTimeout=void 0,this.displayText=e.observable(""),this.displayExtra=e.observable(""),this.overTooltip=e.observable(!1),this.tipExtras={"#desktopMenuButton":"Access your settings and documents, view help",".addPaneNormal":"Open another editable view of your data",".addPaneTimeline":"View your agenda"},t.applyBindings(this,"tooltip"),this.init()}var i=300,n=1e3;return r.prototype={init:function(){},onLoad:function(){this.element=document.getElementById("tooltip"),this.element&&(this.element.addEventListener("mouseover",this.handleSelfOver.bind(this),!0),this.element.addEventListener("mouseout",this.handleSelfOut.bind(this),!0)),this.listenerElement=document.getElementById("outerWrapper"),this.listenerElement&&(this.listenerElement.addEventListener("mouseover",this.handleEleOver.bind(this),!0),this.listenerElement.addEventListener("mouseout",this.handleEleOut.bind(this),!0))},register:function(e,t){this.update(e,t)},update:function(e,t){e.setAttribute("tooltip",t)},tipIn:function(e){this.displayElement!==e.srcElement&&(this.displayElement=e.srcElement,clearTimeout(this.displayTimeout),this.displayTimeout=setTimeout(this.displayTip.bind(this),i))},adjustBounds:function(){var e=200,r=0,i=document.documentElement.getBoundingClientRect(),n=this.displayElement.getBoundingClientRect(),o=i.right-n.right,a=e>o;if(a){var s=t.width(this.element);s>o&&(r+=s-(i.right-n.right)+10)}var c=n.left+n.width/2;t.setTransform(this.element,c-r,n.bottom+5)},displayTip:function(){if(this.displayTimeout=void 0,this.displayElement){var e=this.displayElement.getAttribute("tooltip");try{t.PAssert(1476,e,"When display a tooltip, elements should always have valid data set")}catch(r){t.reportError(r)}e&&(this.displayText(e),this.adjustBounds(),this.extraTimeout=setTimeout(this.showExtra.bind(this),n))}},tipOut:function(e){e.srcElement||(e.srcElement=e.target);var r=!1,i=e.toElement||e.relatedTarget;i&&(r=t.isAncestor(i,e.srcElement)),r||e.srcElement===i||i===this.element||this.hideTip()},handleEleOver:function(e){e.srcElement||(e.srcElement=e.target);var t=e.srcElement.getAttribute("tooltip");t&&this.tipIn(e)},handleEleOut:function(e){e.srcElement||(e.srcElement=e.target);var t=e.srcElement.getAttribute("tooltip");t&&this.tipOut(e)},handleSelfOver:function(){this.displayElement&&(this.overTooltip(!0),this.showExtra())},handleSelfOut:function(e){e.srcElement||(e.srcElement=e.target);var r=!1,i=e.toElement||e.relatedTarget;i&&(r=t.isAncestor(i,e.srcElement)),r||e.srcElement===i||(this.overTooltip(!1),i!==this.displayElement&&this.hideTip())},showExtra:function(){var e=void 0;try{t.PAssert(1477,this.displayElement,"There should be a display element when showing extra information")}catch(r){t.reportError(r)}if(this.displayElement){if(this.displayElement.id){var i="#"+this.displayElement.id;this.tipExtras[i]&&(e=i)}if(!e)for(var n=0;n<this.displayElement.classList.length;++n){var o="."+this.displayElement.classList[n];if(this.tipExtras[o]){e=o;break}}if(e){var a=this.tipExtras[e];a&&(this.displayExtra(a),this.adjustBounds())}clearTimeout(this.extraTimeout),this.extraTimeout=void 0}},hideTip:function(){this.displayElement&&(this.displayElement=void 0,clearTimeout(this.displayTimeout),this.displayTimeout=void 0,clearTimeout(this.extraTimeout),this.extraTimeout=void 0,this.displayText(""),this.displayExtra(""))}},r}),define("AppCache",["ko","globals","platform"],function(e,t,r){function i(){this.minTimeShowUpdate=2e3,this.timeToCancelButton=2e3,this.notifiedOfNew=!1,this.isFinished=!1,this.timeShownUpdatingMessage=void 0,this.showCancel=e.observable(!1),this.downloadingTimeout=0,this.startStatus=window.applicationCache.status,this.continuedUpdate=!1,this.updateActionDone=!1,this.fnToRun=[],this.dynamicUpdateCheck=!1,this.requiredUpdate=!1,this.appUpdatePending=!1,this.isShowingProgress=!1,this.init()}return i.prototype={init:function(){log("Cache Status: "+this.startStatus),window.applicationCache.addEventListener("noupdate",this.onCacheLoadFinished.bind(this)),window.applicationCache.addEventListener("cached",this.onFirstUpdateReady.bind(this)),window.applicationCache.addEventListener("downloading",this.onUpdateDownloading.bind(this)),window.applicationCache.addEventListener("updateready",this.onUpdateReady.bind(this)),window.applicationCache.addEventListener("obsolete",this.onCacheLoadFinished.bind(this)),window.applicationCache.addEventListener("error",this.onUpdateError.bind(this)),window.applicationCache.status>=window.applicationCache.UPDATEREADY||document.documentElement.attributes.getNamedItem("manifest")||this.onCacheLoadFinished()},isVisible:function(e){t.isDemoMode()?e&&t.reload():t.messageQueue.pushMessage(MessageID.Updated)},update:function(){window.applicationCache.status===window.applicationCache.IDLE&&applicationCache.update()},checkForUpdate:function(e){this.requiredUpdate=!!e,this.appUpdatePending||(this.dynamicUpdateCheck=!0,this.update())},runOnFinish:function(e){try{t.PAssert(1478,0===this.fnToRun.length,"Only a single callback is allowed to be run at this point.")}catch(r){t.reportError(r)}this.isFinished?setTimeout(e,0):this.fnToRun.push(e)},onUpdateReady:function(){log("Cache: New version available"),this.appUpdatePending=!0,this.startStatus===window.applicationCache.UNCACHED&&log("Cache Update from UNCACHED state. ERROR."),this.onCacheLoadFinished(),this.updateAction()},onFirstUpdateReady:function(){log("Cache: first update")},onUpdateError:function(e){function i(){t.messageQueue&&t.messageQueue.pushMessage({text:"Error updating app, "+r.actionVerb()+" to retry.",type:MessageType.Error,action:MessageAction.Reload})}r.demo||t.vmMain&&!t.vmMain.isOnline()||(log("Update Error: ",e),t.reportError(new Error("Error during app update"),e),t.messageQueue?i():setTimeout(i,5e3)),this.isVisible(!1),this.onCacheLoadFinished()},onUpdateDownloading:function(){log("Cache: New version downloading")},onCacheLoadFinished:function(){if(log("Cache: No update"),!this.isFinished){this.isFinished=!0;for(var e=0;e<this.fnToRun.length;++e)this.fnToRun[e]()}},notifyOfUpdate:function(){this.notifiedOfNew||(this.notifiedOfNew=!0,t.setAppCacheUpdateState(!0),this.startStatus!==window.applicationCache.UNCACHED&&(t.StopSpinner(),this.isVisible(!0)))},updateAction:function(){this.requiredUpdate?t.messageQueue.pushMessage(MessageID.RequiredUpdate):this.isVisible(!0),t.sendEvent("AppCache","Update")}},i}),"undefined"==typeof REPORT_ACTIONS&&(REPORT_ACTIONS=!1),Error.stackTraceLimit=150;try{window.__checkpoints|=1,window.__SESSION_ID=Math.round(1e4*Math.random())+"|"+Date.now(),window.appEvents=window.appEvents||{kbsize:function(){},enterBackground:function(){}},window.log=console.log.bind(console),window.performance&&window.performance.now?(window.performance.start=window.performance.now(),window.log.now=function(){return window.performance.now()-window.performance.start}):(window.performance={now:function(){return Date.now()-window.performance.start}},window.performance.start=Date.now(),window.log.now=performance.now),console.timeStamp||(console.timeStamp=function(){}),console.time||(console.time=function(){}),console.timeEnd||(console.timeEnd=function(){}),console.trace||(console.trace=function(){}),window.LogLevels={Off:0,Error:1,Warning:2,Timing:4,Data:8,Status:16,Search:32,Timeline:64,Input:128,Tracker:256,Profile:512,PageLoad:1024,Toolbar:2048,Picker:4096,Intro:8192,Import:16384,Version:32768,Settings:65536,Selection:131072,Verbose:262144},window.LogLevel=LogLevels.Error|LogLevels.Warning,window.ShouldLog=function(e){return window.DEBUG===e},window.logIf=function(){var e=Array.prototype.slice.call(arguments);ShouldLog&&(e.splice(0,1),window.log.apply(this,e))};for(var i in LogLevels)makeLogger(i);window.inspectLocal=function(e){if(!e)return void log("Must specify either an item ID or item object to inspect");var t=e;return"string"==typeof e&&(t=window.getModel(e)),log("---- Inspecting Item:",t.id,"----"),log("  RawText:",t.getRawText()),log("  ParsedText:",t.getParsedText()),log("  StyledText:",t.getStyledText()),log('  Parent: "'+t.parent().id+'"'),log("  Date:",t.date()),log("  AllDayDate:",t.allDayDate),log("--------------------------------------------"),t}}catch(err){log("Error in main header"),window.__ERRORINMAINHEADER=err}!function(){var e,e,e={paths:{ko:"lib/knockout-2.3.0.custom",date:"lib/date",FileSaver:"lib/FileSaver",IndexedDBShim:"lib/IndexedDBShim.min",db:"lib/db"},waitSeconds:15};require.config(e)}(),window.gapiKey="AIzaSyB9HEdSJ-nhLJG_ssSSqhI2DX74GSiKSao",window.location.hash.indexOf("gtest=true")>=0&&(log("Loading DEBUG version of RealtimeAPI"),window.___gcfg={"drive-realtime":{server:"https://drive.sandbox.google.com/otservice"}});var gapiCalled=!1,gapiLoadError=!1;requirejs(["ko","kos","data","globals","util","gdata","goog","platform","edit","VMMain","VMSetup","VMDebug","VMTimeline","VMSearch","VMMessageQueue","TemplateCache","VMAutocomplete","VMMenus","ScreenManager","VMTooltip","AppCache","DuchessHelpers"],function(e,t,r,i,n,o,a,s,c,d,l,u,h,p,m,f,g,v,y,b,S){i.checkpoint(Checkpoint.RequireLoaded),window.__ERRORINMAINHEADER&&i.reportError(window.__ERRORINMAINHEADER);i.runOnLoad(function(){function e(e){document.documentElement.addEventListener(e,function(e){i.reportEvent(e)},!0),document.documentElement.addEventListener(e,function(e){},!1)}function t(){return i.requestNotification(navigator.userAgent)}function o(){i.AppCache.runOnFinish(function(){i.reload()},!0)}function p(){s.updateOrientation(),s.mobile&&!s.app&&(i.keyboardToolbar&&i.keyboardToolbar.isVisible()&&i.keyboardToolbar.updatePosition(!0),document.body.scrollTop=0),s.mobile&&i.keyboardToolbar&&i.keyboardToolbar.hideTopBarIfLandscape()}function f(){L||(L=!0,i.checkpoint(Checkpoint.InitializeMain),i.openMainPage(),i.registerEvent("ItemCreated","ItemAction","Create"),i.registerEvent("ItemCompleted","ItemAction","Complete"),r.initData(T),T())}function T(){try{if(O||!L||!r.localDataLoaded())return;O=!0,i.checkpoint(Checkpoint.OnInitializedData),a.loadClientDefaultFile(),i.isDemoMode()?s.script||(i.vmMain.openSidebar(),setTimeout(function(){i.highlightElement(document.getElementById("logoutButton"),.6,1)},0)):i.vmMain.setupDateRollover(),i.vmMain.loadData(),i.timeline.load(),i.StopSpinner(),setTimeout(function(){i.menus&&i.menus.bind(),i.autocomplete||(i.autocomplete=new g)})}catch(e){i.reportError(e)}}function x(e){return(s.mac&&e.metaKey||!s.mac&&e.ctrlKey)&&e.normCode==KeyCode.A}try{i.checkpoint(Checkpoint.PageLoad);try{i.PAssert(1480,"loading"!==document.readyState,"Should only be calling mainjs after document is loaded"+document.readyState)}catch(w){i.reportError(w)}if("loading"===document.readyState){var E="ERROR: MainJS running before document load! "+document.readyState;ShouldLog(LogLevels.Error)&&log(E),i.reportError(new Error(E))}for(var M in window.scriptErrors)i.fireCustomEvent("scriptLoadError",{src:M,id:window.scriptErrors[M],firstChance:!0});if(window.handleLoadError=function(e){try{window.scriptErrors[e.target.src]=e.target.id,i.fireCustomEvent("scriptLoadError",{src:e.target.src,id:e.target.id,firstChance:!1})}catch(t){i.reportError(t)}},window.oncontextmenu=function(e){e.preventDefault()},s.demo&&(i.messageQueue||(i.messageQueue=new m),i.enableDemoMode()),i.isDemoMode()&&s.script){var C=n.getURLParam("dmode");C&&i.enableMinMode(C);var I=n.getURLParam("panes");I&&(i.demoPanes=I.split(":"))}else i.removeDOM("preventInteraction");setTimeout(function(){i.sendEvent("PageLoad","NewPage")},0),e("keydown"),e("keyup"),e("keypress"),e("MSPointerDown"),e("MSPointerUp"),e("MSPointerHover"),e("MSPointerCancel"),e("mousedown"),e("mouseup"),e("touchstart"),e("touchend"),i.messageQueue||(i.messageQueue=new m),i.tooltip=new b,i.AppCache=new S,i.StartSpinner();var P=s.blockClient();if(void 0!==P){var A,k=!1;return P.platform?P.update?"Firefox"==P.platform?A='Please update your Firefox browser to use Moo.do. Moo.do requires at least Firefox 16. See <a href="https://support.mozilla.org/en-US/kb/update-firefox-latest-version">https://support.mozilla.org/en-US/kb/update-firefox-latest-version</a> for more information.':"Chrome"==P.platform?A='Please update your Chrome browser to use Moo.do. Moo.do requires at least Chrome 26. See <a href="https://support.google.com/chrome/answer/95414">https://support.google.com/chrome/answer/95414</a> for more information.':"Native Android"==P.platform?A="Please update your Android device to use Moo.do. Moo.do requires at least Android 2.1.":"Internet Explorer"==P.platform?A='Please update your Internet Explorer browser to use Moo.do. Moo.do requires at least Internet Explorer 10. See <a href="http://windows.microsoft.com/en-us/internet-explorer/download-ie">http://windows.microsoft.com/en-us/internet-explorer/download-ie</a> for more information.':"Safari"==P.platform?A=s.mobile?"Please update your "+s.OSName+" to use Moo.do. Moo.do requires at least iOS 6.":'Please update your Safari browser to use Moo.do. Moo.do requires at least Safari 6.1. See <a href="http://support.apple.com/kb/HT6103">http://support.apple.com/kb/HT6103</a> for more information.':(A="Please update your browser to use Moo.do. If you are unable to update your browser, please let us know. Thanks!",k=!0):(k=!0,A="Sorry, we don't support "+P.platform+" yet. Please let us know that you're interested in using "+P.platform+" and we will make it a higher priority. Thanks!"):P.version?A="Please update to the latest version of this app by opening the TestFlight app and installing the latest version. Thanks!":P.cacheUpdate&&(A="There was an issue while updating the app, "+s.actionVerb()+" to try again.",i.AppCache.update(),P.error&&i.AppCache.runOnFinish(function(){n.insertURLParam("cacheError",!0)},!0)),A&&i.applyBindings({platformError:A,showSignup:k,onTapRefresh:o,onTapSubmit:t},"OSError"),i.StopSpinner(),i.removeDOM("outerWrapper"),i.removeDOM("setupWrapper"),void i.removeDOM("templates")}n.removeURLParam("cacheError",!0),i.removeDOM("OSError"),i.localDocChangeRequested=!1,i.settings.initEvents(function(e){if("localSettings"===e.key){var t;e.oldValue&&(t=JSON.parse(e.oldValue));var r;e.newValue&&(r=JSON.parse(e.newValue)),t&&r&&!i.localDocChangeRequested&&t.gdocId&&t.gdocId!==r.gdocId&&(i.messageQueue.pushMessage(MessageID.DocChange),setTimeout(function(){i.reload()},1e4))}}),i.ScreenManager=new y(document.getElementById("main")),i.menus=new v,i.vmDebug=new u,window.addEventListener("remoteDataLoaded",function(){var e=n.getURLParam("file"),t=n.getURLParam("state");if(e||t){if(!e)try{var r=JSON.parse(t);"open"===r.action&&r.ids&&r.ids.length>=0&&(e=r.ids[0])}catch(o){i.reportError(o)}var c=a.getDocId();e&&c!==e&&i.messageQueue.pushMessage({text:"You have requested to view another document, "+s.actionVerb()+" here to open it.",type:MessageType.Info,action:function(){try{i.PAssert(1482,i.vmMain&&i.vmMain.vmPicker,"VMMain must be initialized before loading another doc")}catch(t){i.reportError(t)}i.vmMain.vmPicker.requestOpenDocument(e)}})}});var D=function(e){var t=window.innerWidth,r=window.innerHeight,n=s.windowWidth(),o=s.windowHeight();if(t!=n||r!=o&&r!=o+60){if(i.smallMode=480>=t,s.windowWidth(t),s.windowHeight(r),i.documentHeight=r,(s.android||s.mobileie)&&r>o&&i.vmMain&&i.vmMain.isLoaded&&i.blurActiveElement(),s.iphone&&!s.bodyscroll&&!s.standalone&&!s.app&&!s.ios7){var a=document.documentElement.clientHeight+60;document.documentElement.style.height=a+"px",setTimeout(i.enforceScroll,0)}i.autocomplete&&i.autocomplete.hide(),n!==t&&e&&s.mobile&&(i.ScreenManager&&i.ScreenManager.onResize(),i.menus&&i.menus.onResize()),s.mobile||i.fireCustomEvent("windowResize")}};D(),p(),i.isDemoMode()||(!s.offline&&window.gapi&&window.gapi.auth&&!gapiCalled&&GoogleApiLoaded(),!s.ios||s.app||s.standalone||i.settings.get(Settings.shownInstallInfo)||(i.messageQueue.pushMessage({text:'To add this app to the home screen: tap <span class="ath-action-icon">icon</span> then <strong>Add to Home Screen</strong>.',type:MessageType.InfoGray,bottom:!0}),i.settings.set(Settings.shownInstallInfo,!0))),s.mobile?(i.removeDOM("desktopMenu"),i.removeDOM("desktopSidebar"),i.removeDOM("contextMenuItem"),i.removeDOM("contextMenuLink"),i.removeDOM("exportData")):(i.removeDOM("phoneMenu"),i.removeDOM("mobileKeyboardToolbar"),i.removeDOM("paneSettings"),s.touch||(i.removeDOM("itemMenuPhone"),i.removeDOM("rightMenuPhone"))),window.onblur=function(){i.hasFocus=!1},window.onfocus=function(){i.hasFocus=!0,a.onFocusHandler()},i.vmMain=new d,i.timeline=new h,window.addEventListener("resize",D),window.addEventListener("orientationchange",D),window.addEventListener("orientationchange",p),window.addEventListener("dragstart",function(e){return e.preventDefault(),!1}),window.addEventListener("drop",function(e){return e.preventDefault(),!1});var L=!1,O=!1;i.vmSetup=new l,i.vmSetup.loginState.subscribe(function(e){e==LoginState.LOGGED_IN?(f(),i.openMainPage()):e==LoginState.LOGGED_OUT&&(i.isSetupPageOpen||(i.isSetupPageOpen=!0,n.hasURLParam("login","true")||i.openSetupPage(),i.vmSetup.openLogin())),i.vmMain.setGDriveStatus(s.offline||!navigator.onLine?DriveStatus.Offline:DriveStatus.Connecting)}),i.vmSetup.init(),i.isDemoMode()&&f();var R=i.getLoginState();if(R!=LoginState.LOGGED_OUT&&r.initData(f),!s.mobile){var _={},N=function(){i.focusedPane.vmSearch.isFocused()||i.saveSelection("StoredSearch"),i.selectElement(i.focusedPane.vmSearch.elSearch,!1),i.sendEvent("Hotkey","Search")},F=function(){i.focusedPane.toggleOutlineVisibility(),i.sendEvent("Hotkey","Outline")},V=function(){var e=i.getSelectedItem();if(e){for(var t=0;t<e.elements.length;++t)i.scrollIntoView(e.getSpan(t),200);e.highlight()}i.sendEvent("Hotkey","GoTo")},B=function(){i.vmMain.applyPriorityToSelection(VMLIFlag.P0,!0),i.sendEvent("Hotkey","Important")},U=function(){i.vmMain.applyPriorityToSelection(VMLIFlag.P1,!0),i.sendEvent("Hotkey","Important")},q=function(){i.vmMain.applyPriorityToSelection(VMLIFlag.P2,!0),i.sendEvent("Hotkey","Important")},H=function(){i.vmMain.applyFnToSelection("isFlagged",!0),i.sendEvent("Hotkey","Star")},W=function(){i.vmMain.applyFnToSelection("isComplete",!0),i.sendEvent("Hotkey","Complete")},K=function(){i.vmMain.applyToSelection(function(e){return i.vmMain.zoomin(e),!1}),i.sendEvent("Hotkey","ZoomIn")},j=function(){if(i.focusedItem&&i.focusedItem.parent()){var e=i.focusedItem;i.vmMain.zoomout(e.parent(),e)}i.sendEvent("Hotkey","ZoomOut")},G=function(){i.vmMain.applyToSelection(function(e){e.toggleCollapsed()}),i.sendEvent("Hotkey","Collapse")},z=function(e){e.target!=document.body&&(i.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!1}),i.sendEvent("Hotkey","Indent"))},J=function(e){e.target!=document.body&&(i.fireKeyEvent(void 0,{normCode:KeyCode.Tab,shiftKey:!0}),i.sendEvent("Hotkey","Unindent"))},Y=function(){},X=function(e){return e.target!=document.body?!1:void 0},$=function(e){var t=i.enumToString(KeyCode,e.normCode);return t?i.fireCustomEvent("key"+t):void i.sendEvent("Hotkey","FireEvent_"+t)};_[KeyCode.E]=_[KeyCode.F]=[{mods:{0:!0},call:N},{mods:{2:!0},call:N}],_[KeyCode.G]=[{mods:{0:!0},call:V},{mods:{2:!0},call:V}],_[KeyCode.O]=[{mods:{0:!0},call:F},{mods:{2:!0},call:F}],_[KeyCode.Slash]=[{mods:{0:!0},call:W},{mods:{2:!0},call:W}],_[KeyCode.D1]=[{mods:{0:!0},call:B},{mods:{2:!0},call:B}],_[KeyCode.D2]=[{mods:{0:!0},call:U},{mods:{2:!0},call:U}],_[KeyCode.D3]=[{mods:{0:!0},call:q},{mods:{2:!0},call:q}],_[KeyCode.Apos]=[{mods:{0:!0},call:H},{mods:{2:!0},call:H}],_[KeyCode.S]=[{mods:{0:!0},call:Y},{mods:{2:!0},call:Y}],_[KeyCode.Enter]=[{mods:{0:!0,4:!0},call:j},{mods:{2:!0,4:!0},call:j},{mods:{0:!0},call:K},{mods:{2:!0},call:K}],_[KeyCode.Comma]=[{mods:{0:!0},call:G},{mods:{2:!0},call:G}],_[KeyCode.Period]=[{mods:{0:!0},call:G},{mods:{2:!0},call:G}],_[KeyCode.LBracket]=[{mods:{0:!0},call:J},{mods:{2:!0},call:J}],_[KeyCode.RBracket]=[{mods:{0:!0},call:z},{mods:{2:!0},call:z}],_[KeyCode.Escape]=[{call:$}],_[KeyCode.BackSpace]=[{call:X}],i.globalKeyDown=function(e){var t=_[e.normCode];if(t)if(i.isFunction(t))t(e);else{for(var r,n=0;n<t.length;n++)if(!(t[n].mods&&(t[n].mods[0]&&!e.ctrlKey||t[n].mods[1]&&!e.optKey||t[n].mods[2]&&!e.metaKey||t[n].mods[3]&&!e.altKey||t[n].mods[4]&&!e.shiftKey))){r=t[n];break}if(r){var o=r.call(e);if(o!==!1)return e.handled=!0,e.preventDefault(),!1}}else e.normCode===KeyCode.Ctrl&&i.vmMain.updateCursor(!0);if(s.android&&e.srcElement===document.body){if(x(e))return e.preventDefault(),!1;c.keydown(null,e)}},i.globalKeyUp=function(e){s.normalizeKeys(e),e.normCode===KeyCode.Ctrl&&i.vmMain.updateCursor(!1)},document.addEventListener("keydown",i.globalKeyDown),document.addEventListener("keyup",i.globalKeyUp,!0)}}catch(Q){i.reportError(Q),i.handleCriticalError()}})}),define("main",function(){});
//# sourceMappingURL=main-min.js.map