webpackJsonp([2],{142:function(e,t,a){e.exports=a(143)},143:function(e,t,a){"use strict";function n(e){if(void 0===e)return void console.error("Autobind error: No context provided.");var t=Object.getPrototypeOf(e);o=arguments.length>1?Array.prototype.slice.call(arguments,1):Object.getOwnPropertyNames(t),o.forEach(function(e){var a=Object.getOwnPropertyDescriptor(t,e);if(void 0===a)return void console.warn('Autobind: "'+e+'" method not found in class.');-1===i.indexOf(e)&&"function"==typeof a.value&&Object.defineProperty(t,e,r(t,e,a))})}function r(e,t,a){var n=a.value;return{configurable:!0,get:function(){if(this===e||this.hasOwnProperty(t))return n;var a=n.bind(this);return Object.defineProperty(this,t,{value:a,configurable:!0,writable:!0}),a}}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var i=["constructor","render","componentWillMount","componentDidMount","componentWillReceiveProps","shouldComponentUpdate","componentWillUpdate","componentDidUpdate","componentWillUnmount"],o=[];e.exports=t.default},59:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var l=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),s=a(0),c=n(s),d=a(48),u=a(14),p=a(142),m=n(p),f=a(23),h=n(f),g=a(49),v=n(g),y=a(47),b=n(y),P={None:-1,EarlyMonthly:0,EarlyYearly:1,RegMonthly:2,RegYearly:3},E=["2m4b","gjgm","pmjw","5pm2"],k=["4.95","49.95","5","49"],S={None:0,AlreadyPremium:1,MissingNonce:2,ServerConnect:3,BraintreeConnect:4,FailedAuth:5,InvalidCode:6},_=function(e){function t(e){r(this,t);var a=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));(0,m.default)(a),"undefined"!=typeof window&&(window.GoogleApiLoaded=a.onGoogleAPILoaded),a.isGoogleApiLoaded=!1,a.planID=E[P.RegMonthly],a.submittingPayment=!1;var n=h.default.getURLHashParam("id_token"),o=h.default.getURLHashParam("email"),l=h.default.getURLHashParam("gid");return n&&o&&l?a._preparePurchase(l,o,n):a.state={phase:"login"},a}return o(t,e),l(t,[{key:"componentDidMount",value:function(){}},{key:"onGoogleAPILoaded",value:function(){this.isGoogleApiLoaded||(window.gapi&&window.gapi.auth?(this.isGoogleApiLoaded=!0,v.default.init(function(e){h.default.setSegment(h.default.Segment.ExistingUser)})):numRetries>0&&(numRetries--,setTimeout(GoogleApiLoaded,1e3)))}},{key:"runPurchaseAuthenticate",value:function(){var e=this;v.default.authenticate(!1,function(t){if(t){var a=gapi.auth.getToken(),n=v.default.decodeIDToken(a.id_token);e._preparePurchase(n.sub,n.email,a.id_token)}else e.displayPurchaseError(S.FailedAuth)})}},{key:"_preparePurchase",value:function(e,t,a){var n=this;this._gid=e,this._email=t,this._id_token=a,this.setState({phase:"pricing",emailDisplay:"Account: "+t}),h.default.XHR_PrivateAPI({type:"POST",path:"/billing/getStatus",data:{email:t,gid:e},headers:{id_token:a,gid:e},cb:function(e){if(200===e.status)try{var t=JSON.parse(e.response).data;t?4!==t.premiumStatus?n.getClientToken():n.displayPurchaseError(S.AlreadyPremium):n.displayPurchaseError(S.ServerConnect)}catch(e){n.displayPurchaseError(S.ServerConnect),h.default.reportError(e)}else n.displayPurchaseError(S.ServerConnect)}})}},{key:"getClientToken",value:function(){var e=this;h.default.XHR_PrivateAPI({type:"POST",path:"/billing/getToken",data:{email:this._email,gid:this._gid},headers:{id_token:this._id_token,gid:this._gid},cb:function(t){if(200===t.status)try{var a=JSON.parse(t.responseText).data;if(a&&a.token){var n=a.token;if(window.braintree){e.setState({phase:"purchase"});new window.braintree.api.Client({clientToken:n});window.braintree.setup(n,"dropin",{container:"braintreeDropin",onPaymentMethodReceived:function(t){e.handlePaymentMethodUpdate(t,e._email,e._gid,e._id_token)},onError:function(t){h.default.reportError(t),e.displayPurchaseError(S.BraintreeConnect)},onReady:function(e){document.getElementById("braintreeDropinLoader").classList.add("hidden"),document.getElementById("braintreeSubmitWrapper").classList.remove("hidden")}})}else e.displayPurchaseError(S.BraintreeConnect)}else e.displayPurchaseError(S.ServerConnect)}catch(t){h.default.reportError(t),e.displayPurchaseError(S.ServerConnect)}else e.displayPurchaseError(S.ServerConnect)}})}},{key:"displayPurchaseSuccess",value:function(){this.setState({phase:"success"})}},{key:"displayPurchaseError",value:function(e){var t;switch(e){case S.None:t="";break;case S.AlreadyPremium:t="You're already a premium user! Please visit the app to manage your account.",this.setState({phase:"login"});break;case S.ServerConnect:t="Failed to connect to our billing database. Please contact support@moo.do.";break;case S.MissingNonce:case S.BraintreeConnect:t="Failed to connect to our billing provider. Please try again later or contact support@moo.do.";break;case S.FailedAuth:t="Failed to authorize your account.";break;case S.InvalidCode:t="You entered an invalid code.";break;default:t="There was an error processing your information. Please contact support@moo.do or try again later."}this.setState({errorMessage:t})}},{key:"runPurchaseSendToApp",value:function(){v.default.sendToApp(email,!1,!0,!0)}},{key:"selectPlan",value:function(e){this.setState({selectedPrice:e}),this.planID=E[e]}},{key:"enterCode",value:function(){var e=this;this.setState({phase:"code",selectedPrice:"code"}),requestAnimationFrame(function(){return e.refs.enterCode.focus()})}},{key:"submitCode",value:function(){var e=this,t=this.refs.enterCode,a=t.value;t.value="",a&&a.length>10?(this.displayPurchaseError(S.None),h.default.XHR_PrivateAPI({type:"POST",path:"/billing/useCode",data:{code:a},headers:{id_token:id_token,gid:gid},cb:function(t){200===t.status?e.displayPurchaseSuccess():400===t.status?e.displayPurchaseError(S.InvalidCode):e.displayPurchaseError(S.ServerConnect)}})):this.displayPurchaseError(S.InvalidCode)}},{key:"handlePaymentMethodUpdate",value:function(e,t,a,n){var r=this;this.setState({errorMessage:null}),e&&e.nonce?this.submittingPayment||(this.submittingPayment=!0,h.default.XHR_PrivateAPI({type:"POST",path:"/billing/signup",data:{email:t,gid:a,nonce:e.nonce,planID:this.planID},headers:{id_token:n,gid:a},cb:function(e){r.submittingPayment=!1,200===e.status?(r.displayPurchaseSuccess(),r.reportAdConversion("ha4uCMXduXUQ6vTp0QM",parseInt(k[E.indexOf(r.planID)]))):r.displayPurchaseError(S.AlreadyPremium)}})):this.displayPurchaseError(S.MissingNonce)}},{key:"reportAdConversion",value:function(e,t){var a=new Image(1,1),n="//www.googleadservices.com/pagead/conversion/976910954/?label="+e+"&guid=ON";t&&(n+="&value="+t+"&currency_code=USD"),a.src=n,document.body.appendChild(a)}},{key:"render",value:function(){var e=this.state||{},t=e.phase,a=e.selectedPrice;return c.default.createElement("div",{id:"purchase"},c.default.createElement(u.Head,null,c.default.createElement("script",{src:"https://js.braintreegateway.com/v2/braintree.js"}),c.default.createElement("script",{src:"https://apis.google.com/js/client.js?onload=GoogleApiLoaded",defer:!0,async:!0})),c.default.createElement(b.default,{top:!0,title:"Purchase"}),c.default.createElement("div",{className:"section section-full section-first pageContent",id:"sectionPurchase"},c.default.createElement("h1",{className:"premiumTitle"},"Moo.do Premium"),c.default.createElement("div",{id:"tagline",className:"iSubtitle premiumSubtitle m4"},"Integrate more of your services together and unlock advanced organization and customization features."),"login"===t&&c.default.createElement("div",{id:"loginArea",className:"m4"},c.default.createElement("div",{className:"pricingButton center"},c.default.createElement("span",{className:"linkButton linkBlue ib",title:"Login",onClick:this.runPurchaseAuthenticate},"Select Account"))),("pricing"===t||"purchase"==t)&&c.default.createElement("div",{id:"pricingArea",className:"m4"},c.default.createElement("div",{id:"emailDisplay"},e.emailDisplay),c.default.createElement("br",null),c.default.createElement("br",null),(!a||2===a)&&c.default.createElement("div",{id:"pricing_2",className:"pricingButton"+(2===a?" pricingSelected":""),onClick:this.selectPlan.bind(this,2,3)},c.default.createElement("span",{className:"linkButton linkBlue ib",title:"$5 / month"},"$5 / month")),(!a||3===a)&&c.default.createElement("div",{id:"pricing_3",className:"pricingButton"+(3===a?" pricingSelected":""),onClick:this.selectPlan.bind(this,3,2)},c.default.createElement("span",{className:"linkButton linkBlue ib",title:"$49 / year"},"$49 / year")),(!a||"code"===a)&&c.default.createElement("div",{id:"enterCodeButton",className:"pricingButton"+("code"===a?" pricingSelected":""),onClick:this.enterCode},c.default.createElement("span",{className:"linkButton linkBlue ib",title:"Enter Code"},"Enter Code"))),"code"===t&&c.default.createElement("div",{id:"codeArea",className:"m4"},c.default.createElement("form",{id:"billingForm",className:"center",method:"post",action:"javascript:void(0);"},c.default.createElement("input",{id:"codeValue",style:{width:250},type:"text",className:"",placeholder:"code",ref:"enterCode"}),c.default.createElement("input",{id:"codeSubmit",type:"submit",className:"linkButton linkBlue ib",onclick:this.submitCode,value:"SUBMIT"}))),c.default.createElement("div",{id:"purchaseArea",className:"m4"+("purchase"!==t?" hidden":"")},c.default.createElement("form",{id:"billingForm",className:"center",method:"post",action:"javascript:void(0);"},c.default.createElement("div",{id:"braintreeDropin"}),c.default.createElement("div",{id:"braintreeDropinLoader"},"Loading..."),c.default.createElement("div",{id:"braintreeSubmitWrapper",className:"pricingButton center m2 hidden"},c.default.createElement("input",{id:"braintreeSubmit",type:"submit",className:"linkButton linkBlue ib",value:"SUBMIT"})))),"success"===t&&c.default.createElement("div",{id:"successArea",className:"m4"},"Thanks for signing up for Moo.do!",c.default.createElement("div",{className:"pricingButton center m4"},c.default.createElement("span",{className:"linkButton linkBlue ib",title:"Login",onclick:"runPurchaseSendToApp()"},"Back to the app!"))),e.errorMessage&&c.default.createElement("div",{id:"errorArea",className:"m4"},c.default.createElement("div",{id:"errorMessage"},e.errorMessage))))}}]),t}(c.default.Component);t.default=(0,d.hot)(e)(_)}).call(t,a(11)(e))}});
//# sourceMappingURL=Purchase.0626bbe7.js.map